/*! For license information please see y65ivh.32.c034d275.chunk.js.LICENSE.txt */
(self.k9ivgwsw3f=self.k9ivgwsw3f||[]).push([[32],{14699:(Y,b,C)=>{"use strict";var R=C(14702),q=C(14704),A=C(14706);C.g.__TYPEDARRAY_POOL||(C.g.__TYPEDARRAY_POOL={UINT8:q([32,0]),UINT16:q([32,0]),UINT32:q([32,0]),INT8:q([32,0]),INT16:q([32,0]),INT32:q([32,0]),FLOAT:q([32,0]),DOUBLE:q([32,0]),DATA:q([32,0]),UINT8C:q([32,0]),BUFFER:q([32,0])});var E="undefined"!==typeof Uint8ClampedArray,B=C.g.__TYPEDARRAY_POOL;B.UINT8C||(B.UINT8C=q([32,0])),B.BUFFER||(B.BUFFER=q([32,0]));var g=B.DATA,r=B.BUFFER;function O(Y){if(Y){var b=Y.length||Y.byteLength,C=R.log2(b);g[C].push(Y)}}function F(Y){Y=R.nextPow2(Y);var b=R.log2(Y),C=g[b];return C.length>0?C.pop():new ArrayBuffer(Y)}function y(Y){return new Uint8Array(F(Y),0,Y)}function S(Y){return new Uint16Array(F(2*Y),0,Y)}function n(Y){return new Uint32Array(F(4*Y),0,Y)}function t(Y){return new Int8Array(F(Y),0,Y)}function I(Y){return new Int16Array(F(2*Y),0,Y)}function w(Y){return new Int32Array(F(4*Y),0,Y)}function Q(Y){return new Float32Array(F(4*Y),0,Y)}function N(Y){return new Float64Array(F(8*Y),0,Y)}function p(Y){return E?new Uint8ClampedArray(F(Y),0,Y):y(Y)}function mY(Y){return new DataView(F(Y),0,Y)}b.free=function(Y){if(A(Y))r[R.log2(Y.length)].push(Y);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(Y)&&(Y=Y.buffer),!Y)return;var b=Y.length||Y.byteLength,C=0|R.log2(b);g[C].push(Y)}},b.freeUint8=b.freeUint16=b.freeUint32=b.freeInt8=b.freeInt16=b.freeInt32=b.freeFloat32=b.freeFloat=b.freeFloat64=b.freeDouble=b.freeUint8Clamped=b.freeDataView=function(Y){O(Y.buffer)},b.freeArrayBuffer=O,b.freeBuffer=function(Y){r[R.log2(Y.length)].push(Y)},b.malloc=function(Y,b){if(void 0===b||"arraybuffer"===b)return F(Y);switch(b){case"uint8":return y(Y);case"uint16":return S(Y);case"uint32":return n(Y);case"int8":return t(Y);case"int16":return I(Y);case"int32":return w(Y);case"float":case"float32":return Q(Y);case"double":case"float64":return N(Y);case"uint8_clamped":return p(Y);case"buffer":throw"Buffer not supported";case"data":case"dataview":return mY(Y);default:return null}return null},b.mallocArrayBuffer=F,b.mallocUint8=y,b.mallocUint16=S,b.mallocUint32=n,b.mallocInt8=t,b.mallocInt16=I,b.mallocInt32=w,b.mallocFloat32=b.mallocFloat=Q,b.mallocFloat64=b.mallocDouble=N,b.mallocUint8Clamped=p,b.mallocDataView=mY,b.clearCache=function(){for(var Y=0;Y<32;++Y)B.UINT8[Y].length=0,B.UINT16[Y].length=0,B.UINT32[Y].length=0,B.INT8[Y].length=0,B.INT16[Y].length=0,B.INT32[Y].length=0,B.FLOAT[Y].length=0,B.DOUBLE[Y].length=0,B.UINT8C[Y].length=0,g[Y].length=0,r[Y].length=0}},14789:(Y,b,C)=>{Y.exports=q;var R=C(13633);function q(Y,b){if(!(this instanceof q))return new q(Y,b);var C=R.create();R.add(C,Y,b),this.base=R.min(R.create(),Y,C),this.WO=R.clone(b),this.max=R.max(R.create(),Y,C),this.mag=R.length(this.WO)}var A=q.prototype;A.width=function(){return this.WO[0]},A.height=function(){return this.WO[1]},A.depth=function(){return this.WO[2]},A.x0=function(){return this.base[0]},A.y0=function(){return this.base[1]},A.z0=function(){return this.base[2]},A.x1=function(){return this.max[0]},A.y1=function(){return this.max[1]},A.z1=function(){return this.max[2]},A.translate=function(Y){return R.add(this.max,this.max,Y),R.add(this.base,this.base,Y),this},A.setPosition=function(Y){return R.add(this.max,Y,this.WO),R.k(this.base,Y),this},A.expand=function(Y){var b=R.create(),C=R.create();return R.max(b,Y.max,this.max),R.min(C,Y.base,this.base),R.EC(b,b,C),new q(C,b)},A.intersects=function(Y){return!(Y.base[0]>this.max[0])&&(!(Y.base[1]>this.max[1])&&(!(Y.base[2]>this.max[2])&&(!(Y.max[0]<this.base[0])&&(!(Y.max[1]<this.base[1])&&!(Y.max[2]<this.base[2])))))},A.touches=function(Y){var b=this.union(Y);return null!==b&&(0==b.width()||0==b.height()||0==b.depth())},A.union=function(Y){if(!this.intersects(Y))return null;var b=Math.max(Y.base[0],this.base[0]),C=Math.max(Y.base[1],this.base[1]),R=Math.max(Y.base[2],this.base[2]);return new q([b,C,R],[Math.min(Y.max[0],this.max[0])-b,Math.min(Y.max[1],this.max[1])-C,Math.min(Y.max[2],this.max[2])-R])}},14702:(Y,b)=>{"use strict";function C(Y){var b=32;return(Y&=-Y)&&b--,65535&Y&&(b-=16),16711935&Y&&(b-=8),252645135&Y&&(b-=4),858993459&Y&&(b-=2),1431655765&Y&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(Y){return(Y>0)-(Y<0)},b.abs=function(Y){var b=Y>>31;return(Y^b)-b},b.min=function(Y,b){return b^(Y^b)&-(Y<b)},b.max=function(Y,b){return Y^(Y^b)&-(Y<b)},b.isPow2=function(Y){return!(Y&Y-1)&&!!Y},b.log2=function(Y){var b,C;return b=(Y>65535)<<4,b|=C=((Y>>>=b)>255)<<3,b|=C=((Y>>>=C)>15)<<2,(b|=C=((Y>>>=C)>3)<<1)|(Y>>>=C)>>1},b.log10=function(Y){return Y>=1e9?9:Y>=1e8?8:Y>=1e7?7:Y>=1e6?6:Y>=1e5?5:Y>=1e4?4:Y>=1e3?3:Y>=100?2:Y>=10?1:0},b.popCount=function(Y){return 16843009*((Y=(858993459&(Y-=Y>>>1&1431655765))+(Y>>>2&858993459))+(Y>>>4)&252645135)>>>24},b.countTrailingZeros=C,b.nextPow2=function(Y){return Y+=0===Y,--Y,Y|=Y>>>1,Y|=Y>>>2,Y|=Y>>>4,Y|=Y>>>8,(Y|=Y>>>16)+1},b.prevPow2=function(Y){return Y|=Y>>>1,Y|=Y>>>2,Y|=Y>>>4,Y|=Y>>>8,(Y|=Y>>>16)-(Y>>>1)},b.parity=function(Y){return Y^=Y>>>16,Y^=Y>>>8,Y^=Y>>>4,27030>>>(Y&=15)&1};var R=new Array(256);!function(Y){for(var b=0;b<256;++b){var C=b,R=b,q=7;for(C>>>=1;C;C>>>=1)R<<=1,R|=1&C,--q;Y[b]=R<<q&255}}(R),b.reverse=function(Y){return R[255&Y]<<24|R[Y>>>8&255]<<16|R[Y>>>16&255]<<8|R[Y>>>24&255]},b.interleave2=function(Y,b){return(Y=1431655765&((Y=858993459&((Y=252645135&((Y=16711935&((Y&=65535)|Y<<8))|Y<<4))|Y<<2))|Y<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(Y,b){return(Y=65535&((Y=16711935&((Y=252645135&((Y=858993459&((Y=Y>>>b&1431655765)|Y>>>1))|Y>>>2))|Y>>>4))|Y>>>16))<<16>>16},b.interleave3=function(Y,b,C){return Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2),(Y|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},b.deinterleave3=function(Y,b){return(Y=1023&((Y=4278190335&((Y=251719695&((Y=3272356035&((Y=Y>>>b&1227133513)|Y>>>2))|Y>>>4))|Y>>>8))|Y>>>16))<<22>>22},b.nextCombination=function(Y){var b=Y|Y-1;return b+1|(~b&-~b)-1>>>C(Y)+1}},14691:(Y,b,C)=>{"use strict";Y.exports=function(Y,b,C){switch(arguments.length){case 1:return R=[],r(q=Y,q,O,!0),R;case 2:return"function"===typeof b?r(Y,Y,b,!0):function(Y,b){return R=[],r(Y,b,O,!1),R}(Y,b);case 3:return r(Y,b,C,!1);default:throw new Error("box-intersect: Invalid arguments")}var q};var R,q=C(14699),A=C(14712),E=C(14722);function B(Y,b){for(var C=0;C<Y;++C)if(!(b[C]<=b[C+Y]))return!0;return!1}function g(Y,b,C,R){for(var q=0,A=0,E=0,g=Y.length;E<g;++E){var r=Y[E];if(!B(b,r)){for(var O=0;O<2*b;++O)C[q++]=r[O];R[A++]=E}}return A}function r(Y,b,C,R){var B=Y.length,r=b.length;if(!(B<=0||r<=0)){var O=Y[0].length>>>1;if(!(O<=0)){var F,y=q.mallocDouble(2*O*B),S=q.mallocInt32(B);if((B=g(Y,O,y,S))>0){if(1===O&&R)A.init(B),F=A.sweepComplete(O,C,0,B,y,S,0,B,y,S);else{var n=q.mallocDouble(2*O*r),t=q.mallocInt32(r);(r=g(b,O,n,t))>0&&(A.init(B+r),F=1===O?A.sweepBipartite(O,C,0,B,y,S,0,r,n,t):E(O,C,R,B,y,S,r,n,t),q.free(n),q.free(t))}q.free(y),q.free(S)}return F}}}function O(Y,b){R.push([Y,b])}},14730:(Y,b)=>{"use strict";var C="d",R="ax",q="fp",A="es",E="rs",B="re",g="rb",r="bs",O="be",F="bb",y=[C,R,"vv",E,B,g,"ri",r,O,F,"bi"];function S(Y){var b="bruteForce"+(Y?"Full":"Partial"),R=[],E=y.slice();Y||E.splice(3,0,q);var B=["function "+b+"("+E.join()+"){"];function g(b,q){var E=function(Y,b,R){var q="bruteForce"+(Y?"Red":"Blue")+(b?"Flip":"")+(R?"Full":""),E=["function ",q,"(",y.join(),"){","var ",A,"=2*",C,";"],B="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",g="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(R?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return Y?E.push(B,"Q",":",g):E.push(g,"Q",":",B),R?E.push("if(y1<x0||x1<y0)continue;"):b?E.push("if(y0<=x0||x1<y0)continue;"):E.push("if(y0<x0||x1<y0)continue;"),E.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),b?E.push("yi,xi"):E.push("xi,yi"),E.push(");if(rv!==void 0)return rv;}}}"),{name:q,code:E.join("")}}(b,q,Y);R.push(E.code),B.push("return "+E.name+"("+y.join()+");")}B.push("if(re-rs>be-bs){"),Y?(g(!0,!1),B.push("}else{"),g(!1,!1)):(B.push("if(fp){"),g(!0,!0),B.push("}else{"),g(!0,!1),B.push("}}else{if(fp){"),g(!1,!0),B.push("}else{"),g(!1,!1),B.push("}")),B.push("}}return "+b);var r=R.join("")+B.join("");return new Function(r)()}b.partial=S(!1),b.full=S(!0)},14722:(Y,b,C)=>{"use strict";Y.exports=function(Y,b,C,A,O,j,T,P,v){!function(Y,b){var C=8*q.log2(b+1)*(Y+1)|0,A=q.nextPow2(p*C);L.length<A&&(R.free(L),L=R.mallocInt32(A));var E=q.nextPow2(mY*C);u.length<E&&(R.free(u),u=R.mallocDouble(E))}(Y,A+T);var z,J=0,U=2*Y;c(J++,0,0,A,0,T,C?16:0,-1/0,1/0),C||c(J++,0,0,T,0,A,1,-1/0,1/0);for(;J>0;){var o=(J-=1)*p,G=L[o],h=L[o+1],e=L[o+2],H=L[o+3],i=L[o+4],W=L[o+5],s=J*mY,D=u[s],d=u[s+1],V=1&W,k=!!(16&W),x=O,a=j,M=P,K=v;if(V&&(x=P,a=v,M=O,K=j),!(2&W&&h>=(e=I(Y,G,h,e,x,a,d)))&&!(4&W&&(h=w(Y,G,h,e,x,a,D))>=e)){var f=e-h,Z=i-H;if(k){if(Y*f*(f+Z)<S){if(void 0!==(z=g.scanComplete(Y,G,b,h,e,x,a,H,i,M,K)))return z;continue}}else{if(Y*Math.min(f,Z)<F){if(void 0!==(z=E(Y,G,b,V,h,e,x,a,H,i,M,K)))return z;continue}if(Y*f*Z<y){if(void 0!==(z=g.scanBipartite(Y,G,b,V,h,e,x,a,H,i,M,K)))return z;continue}}var YY=n(Y,G,h,e,x,a,D,d);if(h<YY)if(Y*(YY-h)<F){if(void 0!==(z=B(Y,G+1,b,h,YY,x,a,H,i,M,K)))return z}else if(G===Y-2){if(void 0!==(z=V?g.sweepBipartite(Y,b,H,i,M,K,h,YY,x,a):g.sweepBipartite(Y,b,h,YY,x,a,H,i,M,K)))return z}else c(J++,G+1,h,YY,H,i,V,-1/0,1/0),c(J++,G+1,H,i,h,YY,1^V,-1/0,1/0);if(YY<e){var bY=r(Y,G,H,i,M,K),CY=M[U*bY+G],RY=t(Y,G,bY,i,M,K,CY);if(RY<i&&c(J++,G,YY,e,RY,i,(4|V)+(k?16:0),CY,d),H<bY&&c(J++,G,YY,e,H,bY,(2|V)+(k?16:0),D,CY),bY+1===RY){if(void 0!==(z=k?X(Y,G,b,YY,e,x,a,bY,M,K[bY]):l(Y,G,b,V,YY,e,x,a,bY,M,K[bY])))return z}else if(bY<RY){var qY;if(k){if(YY<(qY=Q(Y,G,YY,e,x,a,CY))){var AY=t(Y,G,YY,qY,x,a,CY);if(G===Y-2){if(YY<AY&&void 0!==(z=g.sweepComplete(Y,b,YY,AY,x,a,bY,RY,M,K)))return z;if(AY<qY&&void 0!==(z=g.sweepBipartite(Y,b,AY,qY,x,a,bY,RY,M,K)))return z}else YY<AY&&c(J++,G+1,YY,AY,bY,RY,16,-1/0,1/0),AY<qY&&(c(J++,G+1,AY,qY,bY,RY,0,-1/0,1/0),c(J++,G+1,bY,RY,AY,qY,1,-1/0,1/0))}}else YY<(qY=V?N(Y,G,YY,e,x,a,CY):Q(Y,G,YY,e,x,a,CY))&&(G===Y-2?z=V?g.sweepBipartite(Y,b,bY,RY,M,K,YY,qY,x,a):g.sweepBipartite(Y,b,YY,qY,x,a,bY,RY,M,K):(c(J++,G+1,YY,qY,bY,RY,V,-1/0,1/0),c(J++,G+1,bY,RY,YY,qY,1^V,-1/0,1/0)))}}}}};var R=C(14699),q=C(14702),A=C(14730),E=A.partial,B=A.full,g=C(14712),r=C(14734),O=C(14741),F=128,y=1<<22,S=1<<22,n=O("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),t=O("lo===p0",["p0"]),I=O("lo<p0",["p0"]),w=O("hi<=p0",["p0"]),Q=O("lo<=p0&&p0<=hi",["p0"]),N=O("lo<p0&&p0<=hi",["p0"]),p=6,mY=2,L=R.mallocInt32(1024),u=R.mallocDouble(1024);function c(Y,b,C,R,q,A,E,B,g){var r=p*Y;L[r]=b,L[r+1]=C,L[r+2]=R,L[r+3]=q,L[r+4]=A,L[r+5]=E;var O=mY*Y;u[O]=B,u[O+1]=g}function l(Y,b,C,R,q,A,E,B,g,r,O){var F=2*Y,y=g*F,S=r[y+b];Y:for(var n=q,t=q*F;n<A;++n,t+=F){var I=E[t+b],w=E[t+b+Y];if(!(S<I||w<S)&&(!R||S!==I)){for(var Q,N=B[n],p=b+1;p<Y;++p){I=E[t+p],w=E[t+p+Y];var mY=r[y+p],L=r[y+p+Y];if(w<mY||L<I)continue Y}if(void 0!==(Q=R?C(O,N):C(N,O)))return Q}}}function X(Y,b,C,R,q,A,E,B,g,r){var O=2*Y,F=B*O,y=g[F+b];Y:for(var S=R,n=R*O;S<q;++S,n+=O){var t=E[S];if(t!==r){var I=A[n+b],w=A[n+b+Y];if(!(y<I||w<y)){for(var Q=b+1;Q<Y;++Q){I=A[n+Q],w=A[n+Q+Y];var N=g[F+Q],p=g[F+Q+Y];if(w<N||p<I)continue Y}var mY=C(t,r);if(void 0!==mY)return mY}}}}},14734:(Y,b,C)=>{"use strict";Y.exports=function(Y,b,C,E,B,g){if(E<=C+1)return C;var r=C,O=E,F=E+C>>>1,y=2*Y,S=F,n=B[y*F+b];for(;r<O;){if(O-r<q){A(Y,b,r,O,B,g),n=B[y*F+b];break}var t=O-r,I=Math.random()*t+r|0,w=B[y*I+b],Q=Math.random()*t+r|0,N=B[y*Q+b],p=Math.random()*t+r|0,mY=B[y*p+b];w<=N?mY>=N?(S=Q,n=N):w>=mY?(S=I,n=w):(S=p,n=mY):N>=mY?(S=Q,n=N):mY>=w?(S=I,n=w):(S=p,n=mY);for(var L=y*(O-1),u=y*S,c=0;c<y;++c,++L,++u){var l=B[L];B[L]=B[u],B[u]=l}var X=g[O-1];g[O-1]=g[S],g[S]=X;for(L=y*(O-1),u=y*(S=R(Y,b,r,O-1,B,g,n)),c=0;c<y;++c,++L,++u){l=B[L];B[L]=B[u],B[u]=l}X=g[O-1];if(g[O-1]=g[S],g[S]=X,F<S){for(O=S-1;r<O&&B[y*(O-1)+b]===n;)O-=1;O+=1}else{if(!(S<F))break;for(r=S+1;r<O&&B[y*r+b]===n;)r+=1}}return R(Y,b,C,F,B,g,B[y*F+b])};var R=C(14741)("lo<p0",["p0"]),q=8;function A(Y,b,C,R,q,A){for(var E=2*Y,B=E*(C+1)+b,g=C+1;g<R;++g,B+=E)for(var r=q[B],O=g,F=E*(g-1);O>C&&q[F+b]>r;--O,F-=E){for(var y=F,S=F+E,n=0;n<E;++n,++y,++S){var t=q[y];q[y]=q[S],q[S]=t}var I=A[O];A[O]=A[O-1],A[O-1]=I}}},14741:Y=>{"use strict";Y.exports=function(Y,C){var R="abcdef".split("").concat(C),q=[];Y.indexOf("lo")>=0&&q.push("lo=e[k+n]");Y.indexOf("hi")>=0&&q.push("hi=e[k+o]");return R.push(b.replace("_",q.join()).replace("$",Y)),Function.apply(void 0,R)};var b="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14718:Y=>{"use strict";Y.exports=function(Y,R){R<=4*b?C(0,R-1,Y):r(0,R-1,Y)};var b=32;function C(Y,b,C){for(var R=2*(Y+1),q=Y+1;q<=b;++q){for(var A=C[R++],E=C[R++],B=q,g=R-2;B-- >Y;){var r=C[g-2],O=C[g-1];if(r<A)break;if(r===A&&O<E)break;C[g]=r,C[g+1]=O,g-=2}C[g]=A,C[g+1]=E}}function R(Y,b,C){b*=2;var R=C[Y*=2],q=C[Y+1];C[Y]=C[b],C[Y+1]=C[b+1],C[b]=R,C[b+1]=q}function q(Y,b,C){b*=2,C[Y*=2]=C[b],C[Y+1]=C[b+1]}function A(Y,b,C,R){b*=2,C*=2;var q=R[Y*=2],A=R[Y+1];R[Y]=R[b],R[Y+1]=R[b+1],R[b]=R[C],R[b+1]=R[C+1],R[C]=q,R[C+1]=A}function E(Y,b,C,R,q){b*=2,q[Y*=2]=q[b],q[b]=C,q[Y+1]=q[b+1],q[b+1]=R}function B(Y,b,C){b*=2;var R=C[Y*=2],q=C[b];return!(R<q)&&(R!==q||C[Y+1]>C[b+1])}function g(Y,b,C,R){var q=R[Y*=2];return q<b||q===b&&R[Y+1]<C}function r(Y,O,F){var y=(O-Y+1)/6|0,S=Y+y,n=O-y,t=Y+O>>1,I=t-y,w=t+y,Q=S,N=I,p=t,mY=w,L=n,u=Y+1,c=O-1,l=0;B(Q,N,F)&&(l=Q,Q=N,N=l),B(mY,L,F)&&(l=mY,mY=L,L=l),B(Q,p,F)&&(l=Q,Q=p,p=l),B(N,p,F)&&(l=N,N=p,p=l),B(Q,mY,F)&&(l=Q,Q=mY,mY=l),B(p,mY,F)&&(l=p,p=mY,mY=l),B(N,L,F)&&(l=N,N=L,L=l),B(N,p,F)&&(l=N,N=p,p=l),B(mY,L,F)&&(l=mY,mY=L,L=l);for(var X=F[2*N],j=F[2*N+1],T=F[2*mY],P=F[2*mY+1],v=2*Q,z=2*p,J=2*L,U=2*S,o=2*t,G=2*n,h=0;h<2;++h){var e=F[v+h],H=F[z+h],i=F[J+h];F[U+h]=e,F[o+h]=H,F[G+h]=i}q(I,Y,F),q(w,O,F);for(var W=u;W<=c;++W)if(g(W,X,j,F))W!==u&&R(W,u,F),++u;else if(!g(W,T,P,F))for(;;){if(g(c,T,P,F)){g(c,X,j,F)?(A(W,u,c,F),++u,--c):(R(W,c,F),--c);break}if(--c<W)break}E(Y,u-1,X,j,F),E(O,c+1,T,P,F),u-2-Y<=b?C(Y,u-2,F):r(Y,u-2,F),O-(c+2)<=b?C(c+2,O,F):r(c+2,O,F),c-u<=b?C(u,c,F):r(u,c,F)}},14712:(Y,b,C)=>{"use strict";Y.exports={init:function(Y){var b=q.nextPow2(Y);g.length<b&&(R.free(g),g=R.mallocInt32(b));r.length<b&&(R.free(r),r=R.mallocInt32(b));O.length<b&&(R.free(O),O=R.mallocInt32(b));F.length<b&&(R.free(F),F=R.mallocInt32(b));y.length<b&&(R.free(y),y=R.mallocInt32(b));S.length<b&&(R.free(S),S=R.mallocInt32(b));var C=8*b;n.length<C&&(R.free(n),n=R.mallocDouble(C))},sweepBipartite:function(Y,b,C,R,q,B,y,S,w,Q){for(var N=0,p=2*Y,mY=Y-1,L=p-1,u=C;u<R;++u){var c=B[u],l=p*u;n[N++]=q[l+mY],n[N++]=-(c+1),n[N++]=q[l+L],n[N++]=c}for(u=y;u<S;++u){c=Q[u]+E;var X=p*u;n[N++]=w[X+mY],n[N++]=-c,n[N++]=w[X+L],n[N++]=c}var j=N>>>1;A(n,j);var T=0,P=0;for(u=0;u<j;++u){var v=0|n[2*u+1];if(v>=E)t(O,F,P--,v=v-E|0);else if(v>=0)t(g,r,T--,v);else if(v<=-E){v=-v-E|0;for(var z=0;z<T;++z){if(void 0!==(J=b(g[z],v)))return J}I(O,F,P++,v)}else{v=-v-1|0;for(z=0;z<P;++z){var J;if(void 0!==(J=b(v,O[z])))return J}I(g,r,T++,v)}}},sweepComplete:function(Y,b,C,R,q,E,B,w,Q,N){for(var p=0,mY=2*Y,L=Y-1,u=mY-1,c=C;c<R;++c){var l=E[c]+1<<1,X=mY*c;n[p++]=q[X+L],n[p++]=-l,n[p++]=q[X+u],n[p++]=l}for(c=B;c<w;++c){l=N[c]+1<<1;var j=mY*c;n[p++]=Q[j+L],n[p++]=1|-l,n[p++]=Q[j+u],n[p++]=1|l}var T=p>>>1;A(n,T);var P=0,v=0,z=0;for(c=0;c<T;++c){var J=0|n[2*c+1],U=1&J;if(c<T-1&&J>>1===n[2*c+3]>>1&&(U=2,c+=1),J<0){for(var o=-(J>>1)-1,G=0;G<z;++G){if(void 0!==(h=b(y[G],o)))return h}if(0!==U)for(G=0;G<P;++G){if(void 0!==(h=b(g[G],o)))return h}if(1!==U)for(G=0;G<v;++G){var h;if(void 0!==(h=b(O[G],o)))return h}0===U?I(g,r,P++,o):1===U?I(O,F,v++,o):2===U&&I(y,S,z++,o)}else{o=(J>>1)-1;0===U?t(g,r,P--,o):1===U?t(O,F,v--,o):2===U&&t(y,S,z--,o)}}},scanBipartite:function(Y,b,C,R,q,B,O,F,y,S,w,Q){var N=0,p=2*Y,mY=b,L=b+Y,u=1,c=1;R?c=E:u=E;for(var l=q;l<B;++l){var X=l+u,j=p*l;n[N++]=O[j+mY],n[N++]=-X,n[N++]=O[j+L],n[N++]=X}for(l=y;l<S;++l){X=l+c;var T=p*l;n[N++]=w[T+mY],n[N++]=-X}var P=N>>>1;A(n,P);var v=0;for(l=0;l<P;++l){var z=0|n[2*l+1];if(z<0){var J=!1;if((X=-z)>=E?(J=!R,X-=E):(J=!!R,X-=1),J)I(g,r,v++,X);else{var U=Q[X],o=p*X,G=w[o+b+1],h=w[o+b+1+Y];Y:for(var e=0;e<v;++e){var H=g[e],i=p*H;if(!(h<O[i+b+1]||O[i+b+1+Y]<G)){for(var W=b+2;W<Y;++W)if(w[o+W+Y]<O[i+W]||O[i+W+Y]<w[o+W])continue Y;var s,D=F[H];if(void 0!==(s=R?C(U,D):C(D,U)))return s}}}}else t(g,r,v--,z-u)}},scanComplete:function(Y,b,C,R,q,B,r,O,F,y,S){for(var t=0,I=2*Y,w=b,Q=b+Y,N=R;N<q;++N){var p=N+E,mY=I*N;n[t++]=B[mY+w],n[t++]=-p,n[t++]=B[mY+Q],n[t++]=p}for(N=O;N<F;++N){p=N+1;var L=I*N;n[t++]=y[L+w],n[t++]=-p}var u=t>>>1;A(n,u);var c=0;for(N=0;N<u;++N){var l=0|n[2*N+1];if(l<0){if((p=-l)>=E)g[c++]=p-E;else{var X=S[p-=1],j=I*p,T=y[j+b+1],P=y[j+b+1+Y];Y:for(var v=0;v<c;++v){var z=g[v],J=r[z];if(J===X)break;var U=I*z;if(!(P<B[U+b+1]||B[U+b+1+Y]<T)){for(var o=b+2;o<Y;++o)if(y[j+o+Y]<B[U+o]||B[U+o+Y]<y[j+o])continue Y;var G=C(J,X);if(void 0!==G)return G}}}}else{for(p=l-E,v=c-1;v>=0;--v)if(g[v]===p){for(o=v+1;o<c;++o)g[o-1]=g[o];break}--c}}}};var R=C(14699),q=C(14702),A=C(14718),E=1<<28,B=1024,g=R.mallocInt32(B),r=R.mallocInt32(B),O=R.mallocInt32(B),F=R.mallocInt32(B),y=R.mallocInt32(B),S=R.mallocInt32(B),n=R.mallocDouble(8192);function t(Y,b,C,R){var q=b[R],A=Y[C-1];Y[q]=A,b[A]=q}function I(Y,b,C,R){Y[C]=R,b[R]=C}},14704:Y=>{"use strict";function b(Y,C,R){var q=0|Y[R];if(q<=0)return[];var A,E=new Array(q);if(R===Y.length-1)for(A=0;A<q;++A)E[A]=C;else for(A=0;A<q;++A)E[A]=b(Y,C,R+1);return E}Y.exports=function(Y,C){switch("undefined"===typeof C&&(C=0),typeof Y){case"number":if(Y>0)return function(Y,b){var C,R;for(C=new Array(Y),R=0;R<Y;++R)C[R]=b;return C}(0|Y,C);break;case"object":if("number"===typeof Y.length)return b(Y,C,0)}return[]}},14662:(Y,b,C)=>{Y.exports=function(){var Y=this;this.components={},this.comps=this.components;var b=this.components,C=1,q={},A=[],E=[],B={timeout:!1,removals:[],multiComps:[]};function g(Y,C){var R=b[C],A=q[C],E=A.hash[Y];E&&(A.remove(Y),R.Ab&&(R.multi?(E.forEach((b=>{b&&R.Ab(Y,b)})),E.length=0):R.Ab(Y,E)),B.removals.push(A),r())}function r(){B.timeout||(B.timeout=!0,setTimeout(O,1))}function O(){B.timeout=!1,F()}function F(){B.multiComps.length&&function(Y){for(var b=0;b<Y.length;b++){var{entID:C,data:R}=Y[b],q=R.hash[C];if(q){for(var A=0;A<q.length;A++)q[A]||(q.splice(A,1),A--);0===q.length&&(R.remove(C),B.removals.push(R))}}Y.length=0}(B.multiComps),B.removals.length&&function(Y){for(var b=0;b<Y.length;b++){Y[b].flush()}Y.length=0}(B.removals)}this.Ry=q,this._systems=A,this._renderSystems=E,this.Jr=function(b){var R=C++;return Array.isArray(b)&&b.forEach((b=>Y.cr(R,b))),R},this.deleteEntity=function(b){return Object.keys(q).forEach((Y=>{q[Y].hash[b]&&g(b,Y)})),Y},this.BF=function(Y){if(!Y)throw new Error("Missing component definition");var C=Y.name;if(!C)throw new Error("Component definition must have a name property.");if("string"!==typeof C)throw new Error("Component name must be a string.");if(""===C)throw new Error("Component name must be a non-empty string.");if(q[C])throw new Error(`Component ${C} already exists.`);var B={};return B.name=C,B.multi=!!Y.multi,B.order=isNaN(Y.order)?99:Y.order,B.stateConstructor=Y.stateConstructor||null,B.state=Y.state||{},B.Og=Y.Og||null,B.Ab=Y.Ab||null,B.system=Y.system||null,B.wg=Y.wg||null,b[C]=B,q[C]=new R,q[C]._pendingMultiCleanup=!1,q[C]._multiCleanupIDs=B.multi?[]:null,B.system&&(A.push(C),A.sort(((Y,C)=>b[Y].order-b[C].order))),B.wg&&(E.push(C),E.sort(((Y,C)=>b[Y].order-b[C].order))),C},this.overwriteComponent=function(Y,C){var R=b[Y];if(!R)throw new Error(`Unknown component: ${Y}`);if(!C)throw new Error("Missing component definition");if(R.name!==C.name)throw new Error("Overwriting component must use the same name property.");var B={};B.name=Y,B.multi=!!C.multi,B.order=isNaN(C.order)?99:C.order,B.state=C.state||{},B.Og=C.Og||null,B.Ab=C.Ab||null,B.system=C.system||null,B.wg=C.wg||null,b[Y]=B,q[Y]._pendingMultiCleanup=!1,q[Y]._multiCleanupIDs=B.multi?[]:null;var g=A.indexOf(Y);B.system&&g<0&&A.push(Y),!B.system&&g>=0&&A.splice(g,1),A.sort(((Y,C)=>b[Y].order-b[C].order));var r=E.indexOf(Y);B.wg&&r<0&&E.push(Y),!B.wg&&r>=0&&E.splice(r,1),E.sort(((Y,C)=>b[Y].order-b[C].order));var O=B.state;return this.lO(Y).forEach((Y=>{for(var b in O)b in Y||(Y[b]=O[b]);B.Og&&B.Og(Y.ng,Y)})),Y},this.deleteComponent=function(C){var R=q[C];if(!R)throw new Error(`Unknown component: ${C}`);R.flush(),R.list.forEach((Y=>{Y&&g(Y.ng||Y[0].ng,C)}));var B=A.indexOf(C),r=E.indexOf(C);return B>-1&&A.splice(B,1),r>-1&&E.splice(r,1),q[C].dispose(),delete q[C],delete b[C],Y},this.cr=function(Y,C,R){var A,E=b[C],B=q[C];if(!B)throw new Error(`Unknown component: ${C}.`);if(B.hash[Y]&&!E.multi)throw new Error(`Entity ${Y} already has component: ${C}.`);if(E.stateConstructor){if(!(A=new E.stateConstructor).hasOwnProperty("ng"))throw new Error(`Component ${E.name} stateConstructor type does not have property __id`)}else A=Object.assign({},{ng:Y},E.state,R);if(A.ng=Y,E.multi){var g=B.hash[Y];g||(g=[],B.add(Y,g)),g.push(A)}else B.add(Y,A);return E.Og&&E.Og(Y,A),this},this.hr=function(Y,b){var C=q[b];if(!C)throw new Error(`Unknown component: ${b}.`);return!!C.hash[Y]},this.Tr=function(b,C){if(!q[C])throw new Error(`Unknown component: ${C}.`);return g(b,C),Y},this.getState=function(Y,b){var C=q[b];if(!C)throw new Error(`Unknown component: ${b}.`);return C.hash[Y]},this.lO=function(Y){var b=q[Y];if(!b)throw new Error(`Unknown component: ${Y}.`);return F(),b.list},this.Yn=function(Y){if(!q[Y])throw new Error(`Unknown component: ${Y}.`);var b=q[Y].hash;return Y=>b[Y]},this.Rn=function(Y){if(!q[Y])throw new Error(`Unknown component: ${Y}.`);var b=q[Y].hash;return Y=>!!b[Y]},this.rg=function(C){F();for(var R=0;R<A.length;R++){var E=A[R],B=b[E],g=q[E];B.system(C,g.list),F()}return Y},this.render=function(C){F();for(var R=0;R<E.length;R++){var A=E[R],B=b[A],g=q[A];B.wg(C,g.list),F()}return Y},this.removeMultiComponent=function(C,R,A){var E=b[R],g=q[R];if(!g)throw new Error(`Unknown component: ${R}.`);if(!E.multi)throw new Error("removeMultiComponent called on non-multi component");return function(Y,b,C,R){var q=C.hash[Y];if(q){var A=q[R];A&&(q[R]=null,b.Ab&&b.Ab(Y,A),B.multiComps.push({entID:Y,data:C}),r())}}(C,E,g,A),Y}};var R=C(14671)},14671:Y=>{function b(Y,b){var C=Y._map[b];if(delete Y.hash[b],delete Y._map[b],C===Y.list.length-1)Y.list.pop();else{var R=Y.list.pop();if(Y.list[C]=R,null===R||null===R[0]){var q=Y.list.length;for(var A in Y._map)if(Y._map[A]===q)return void(Y._map[A]=C)}else{var E=R.ng||R[0].ng;Y._map[E]=C}}}Y.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(Y,b){if("number"===typeof this._map[Y]){var C=this._map[Y];this.hash[Y]=b,this.list[C]=b}else this._map[Y]=this.list.length,this.hash[Y]=b,this.list.push(b)}remove(Y){var b=this._map[Y];this.hash[Y]=null,this.list[b]=null,this._pendingRemovals.push(Y)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var Y=0;Y<this._pendingRemovals.length;Y++){var C=this._pendingRemovals[Y];null===this.hash[C]&&b(this,C)}this._pendingRemovals.length=0}}},14625:Y=>{"use strict";var b,C="object"===typeof Reflect?Reflect:null,R=function(Y,b,C){return Function.prototype.apply.call(Y,b,C)};b=C&&"function"===typeof C.ownKeys?C.ownKeys:Object.getOwnPropertySymbols?function(Y){return Object.getOwnPropertyNames(Y).concat(Object.getOwnPropertySymbols(Y))}:function(Y){return Object.getOwnPropertyNames(Y)};var q=Number.isNaN||function(Y){return Y!==Y};function A(){A.init.call(this)}Y.exports=A,Y.exports.once=function(Y,b){return new Promise((function(C,R){function q(C){Y.removeListener(b,A),R(C)}function A(){"function"===typeof Y.removeListener&&Y.removeListener("error",q),C([].slice.call(arguments))}t(Y,b,A,{once:!0}),"error"!==b&&function(Y,b,C){"function"===typeof Y.on&&t(Y,"error",b,C)}(Y,q,{once:!0})}))},A.EventEmitter=A,A.prototype._events=void 0,A.prototype._eventsCount=0,A.prototype._maxListeners=void 0;var E=10;function B(Y){if("function"!==typeof Y)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Y)}function g(Y){return void 0===Y._maxListeners?A.defaultMaxListeners:Y._maxListeners}function r(Y,b,C,R){var q,A,E,r;if(B(C),void 0===(A=Y._events)?(A=Y._events=Object.create(null),Y._eventsCount=0):(void 0!==A.newListener&&(Y.emit("newListener",b,C.listener?C.listener:C),A=Y._events),E=A[b]),void 0===E)E=A[b]=C,++Y._eventsCount;else if("function"===typeof E?E=A[b]=R?[C,E]:[E,C]:R?E.unshift(C):E.push(C),(q=g(Y))>0&&E.length>q&&!E.warned){E.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.Rb=Y,O.type=b,O.count=E.length,r=O,console&&console.warn&&console.warn(r)}return Y}function O(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function F(Y,b,C){var R={fired:!1,wrapFn:void 0,target:Y,type:b,listener:C},q=O.bind(R);return q.listener=C,R.wrapFn=q,q}function y(Y,b,C){var R=Y._events;if(void 0===R)return[];var q=R[b];return void 0===q?[]:"function"===typeof q?C?[q.listener||q]:[q]:C?function(Y){for(var b=new Array(Y.length),C=0;C<b.length;++C)b[C]=Y[C].listener||Y[C];return b}(q):n(q,q.length)}function S(Y){var b=this._events;if(void 0!==b){var C=b[Y];if("function"===typeof C)return 1;if(void 0!==C)return C.length}return 0}function n(Y,b){for(var C=new Array(b),R=0;R<b;++R)C[R]=Y[R];return C}function t(Y,b,C,R){if("function"===typeof Y.on)R.once?Y.once(b,C):Y.on(b,C);else{if("function"!==typeof Y.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Y);Y.addEventListener(b,(function q(A){R.once&&Y.removeEventListener(b,q),C(A)}))}}Object.defineProperty(A,"defaultMaxListeners",{enumerable:!0,get:function(){return E},set:function(Y){if("number"!==typeof Y||Y<0||q(Y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Y+".");E=Y}}),A.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},A.prototype.setMaxListeners=function(Y){if("number"!==typeof Y||Y<0||q(Y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Y+".");return this._maxListeners=Y,this},A.prototype.getMaxListeners=function(){return g(this)},A.prototype.emit=function(Y){for(var b=[],C=1;C<arguments.length;C++)b.push(arguments[C]);var q="error"===Y,A=this._events;if(void 0!==A)q=q&&void 0===A.error;else if(!q)return!1;if(q){var E;if(b.length>0&&(E=b[0]),E instanceof Error)throw E;var B=new Error("Unhandled error."+(E?" ("+E.message+")":""));throw B.context=E,B}var g=A[Y];if(void 0===g)return!1;if("function"===typeof g)R(g,this,b);else{var r=g.length,O=n(g,r);for(C=0;C<r;++C)R(O[C],this,b)}return!0},A.prototype.addListener=function(Y,b){return r(this,Y,b,!1)},A.prototype.on=A.prototype.addListener,A.prototype.prependListener=function(Y,b){return r(this,Y,b,!0)},A.prototype.once=function(Y,b){return B(b),this.on(Y,F(this,Y,b)),this},A.prototype.prependOnceListener=function(Y,b){return B(b),this.prependListener(Y,F(this,Y,b)),this},A.prototype.removeListener=function(Y,b){var C,R,q,A,E;if(B(b),void 0===(R=this._events))return this;if(void 0===(C=R[Y]))return this;if(C===b||C.listener===b)0===--this._eventsCount?this._events=Object.create(null):(delete R[Y],R.removeListener&&this.emit("removeListener",Y,C.listener||b));else if("function"!==typeof C){for(q=-1,A=C.length-1;A>=0;A--)if(C[A]===b||C[A].listener===b){E=C[A].listener,q=A;break}if(q<0)return this;0===q?C.shift():function(Y,b){for(;b+1<Y.length;b++)Y[b]=Y[b+1];Y.pop()}(C,q),1===C.length&&(R[Y]=C[0]),void 0!==R.removeListener&&this.emit("removeListener",Y,E||b)}return this},A.prototype.off=A.prototype.removeListener,A.prototype.qb=function(Y){var b,C,R;if(void 0===(C=this._events))return this;if(void 0===C.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==C[Y]&&(0===--this._eventsCount?this._events=Object.create(null):delete C[Y]),this;if(0===arguments.length){var q,A=Object.keys(C);for(R=0;R<A.length;++R)"removeListener"!==(q=A[R])&&this.qb(q);return this.qb("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(b=C[Y]))this.removeListener(Y,b);else if(void 0!==b)for(R=b.length-1;R>=0;R--)this.removeListener(Y,b[R]);return this},A.prototype.listeners=function(Y){return y(this,Y,!0)},A.prototype.rawListeners=function(Y){return y(this,Y,!1)},A.listenerCount=function(Y,b){return"function"===typeof Y.listenerCount?Y.listenerCount(b):S.call(Y,b)},A.prototype.listenerCount=S,A.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]}},15102:Y=>{"use strict";Y.exports=function(Y,b,C,R,q,A){var E=+b[0],B=+b[1],g=+b[2],r=+C[0],O=+C[1],F=+C[2],y=Math.sqrt(r*r+O*O+F*F);if(0===y)throw new Error("Can't raycast along a zero vector");return function(Y,b,C,R,q,A,E,B,g,r){for(var O=0,F=Math.floor,y=0|F(b),S=0|F(C),n=0|F(R),t=q>0?1:-1,I=A>0?1:-1,w=E>0?1:-1,Q=Math.abs(1/q),N=Math.abs(1/A),p=Math.abs(1/E),mY=Q<1/0?Q*(t>0?y+1-b:b-y):1/0,L=N<1/0?N*(I>0?S+1-C:C-S):1/0,u=p<1/0?p*(w>0?n+1-R:R-n):1/0,c=-1;O<=B;){var l=Y(y,S,n);if(l)return g&&(g[0]=b+O*q,g[1]=C+O*A,g[2]=R+O*E),r&&(r[0]=r[1]=r[2]=0,0===c&&(r[0]=-t),1===c&&(r[1]=-I),2===c&&(r[2]=-w)),l;mY<L?mY<u?(y+=t,O=mY,mY+=Q,c=0):(n+=w,O=u,u+=p,c=2):L<u?(S+=I,O=L,L+=N,c=1):(n+=w,O=u,u+=p,c=2)}return g&&(g[0]=b+O*q,g[1]=C+O*A,g[2]=R+O*E),r&&(r[0]=r[1]=r[2]=0),0}(Y,E,B,g,r/=y,O/=y,F/=y,R="undefined"===typeof R?64:+R,q,A)}},15145:(Y,b,C)=>{"use strict";C.d(b,{e:()=>A});var R=C(14625);function q(){this.bS=!1,this.stopPropagation=!1,this.CS=!1,this.disabled=!1}class A{constructor(Y,b){this.version="0.7.0";var C=Object.assign({},new q,b||{});this.element=Y||document,this.bS=!!C.bS,this.stopPropagation=!!C.stopPropagation,this.CS=!!C.CS,this.disabled=!!C.disabled,this.filterEvents=(Y,b)=>!0,this.down=new R.EventEmitter,this.up=new R.EventEmitter,this.state={},this.pO={dx:0,dy:0,dS:0,NO:0,VS:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?B(this):document.addEventListener("DOMContentLoaded",(Y=>{B(this)}),{once:!0})}bind(Y){for(var b=arguments.length,C=new Array(b>1?b-1:0),R=1;R<b;R++)C[R-1]=arguments[R];C.forEach((b=>{var C=this._keyBindmap[b]||[];C.includes(Y)||(C.push(Y),this._keyBindmap[b]=C)})),this.state[Y]=!!this.state[Y],this.pressCount[Y]=this.pressCount[Y]||0,this.releaseCount[Y]=this.releaseCount[Y]||0}unbind(Y){for(var b in this._keyBindmap){var C=this._keyBindmap[b],R=C.indexOf(Y);R>-1&&C.splice(R,1)}}getBindings(){var Y={};for(var b in this._keyBindmap){this._keyBindmap[b].forEach((C=>{Y[C]=Y[C]||[],Y[C].push(b)}))}return Y}rg(){E(this.pO),E(this.pressCount),E(this.releaseCount)}}function E(Y){for(var b in Y)Y[b]=0}function B(Y){window.addEventListener("keydown",n.bind(null,Y,!0),!1),window.addEventListener("keyup",n.bind(null,Y,!1),!1);var b={passive:!0};Y.element.addEventListener("touchstart",F.bind(void 0,Y),{passive:!1}),Y.element.addEventListener("touchend",S.bind(void 0,Y),b),Y.element.addEventListener("mousedown",t.bind(null,Y,!0),b),window.document.addEventListener("mouseup",t.bind(null,Y,!1),b),Y.element.addEventListener("touchmove",I.bind(null,Y),b),Y.element.addEventListener("mousemove",I.bind(null,Y),b),window.PointerEvent,Y.element.addEventListener("wheel",w.bind(null,Y),b),Y.element.addEventListener("contextmenu",Q.bind(null,Y),!1),window.addEventListener("blur",N.bind(null,Y),!1)}var g=0,r=0,O=null;function F(Y,b){b.preventDefault(),y(b)}function y(Y){let b=!1;for(let C=0;C<Y.touches.length;++C)if(Y.touches[C].identifier===O){b=!0;break}if(!b){const b=Y.changedTouches[0];g=b.clientX,r=b.clientY,O=b.identifier}}function S(Y,b){for(var C=b.changedTouches,R=0;R<C.length;++R)C[R].identifier===O&&(O=null)}function n(Y,b,C){p(C.code,b,Y,C)}function t(Y,b,C){if("pointerId"in C)if(b){if(null!==Y._touches.currID)return;Y._touches.currID=C.pointerId}else{if(Y._touches.currID!==C.pointerId)return;Y._touches.currID=null}return p("Mouse"+("button"in C?C.button+1:1),b,Y,C),!1}function I(Y,b){var C=b.movementX||b.mozMovementX||0,R=b.movementY||b.mozMovementY||0;if(b.touches&&0===(C|R)){var q=function(Y){y(Y);for(let b=0;b<Y.changedTouches.length;++b)if(Y.changedTouches[b].identifier==O){const C=Y.changedTouches[b],R=[C.clientX-g,C.clientY-r];return g=C.clientX,r=C.clientY,R}return console.error(`Did not find touch id ${O}`),[0,0]}(b);C=q[0],R=q[1]}Y.pO.dx+=C,Y.pO.dy+=R}function w(Y,b){var C=1;switch(b.deltaMode){case 0:C=1;break;case 1:C=12;break;case 2:C=Y.element.clientHeight||window.innerHeight}Y.pO.dS+=(b.deltaX||0)*C,Y.pO.NO+=(b.deltaY||0)*C,Y.pO.VS+=(b.deltaZ||0)*C}function Q(Y,b){if(!Y.CS)return b.preventDefault(),!1}function N(Y){for(var b in Y._keyStates)Y._keyStates[b]&&(/^Mouse\d/.test(b)||p(b,!1,Y,{code:b,note:"mj82f7p3gss",preventDefault:()=>{},stopPropagation:()=>{}}))}function p(Y,b,C,R){var q=C._keyBindmap[Y];q&&(mY(C._keyStates[Y],b)&&(C._keyStates[Y]=b,q.forEach((Y=>{(!C.filterEvents||C.filterEvents(R,Y))&&function(Y,b,C,R){var q=b?C.pressCount:C.releaseCount;q[Y]=(q[Y]||0)+1;var A=C._bindPressCount[Y]||0;(A+=b?1:-1)<0&&(A=0);C._bindPressCount[Y]=A;var E=C.state[Y];if(mY(E,A)){C.state[Y]=A>0;var B=b?C.down:C.up;C.disabled||B.emit(Y,R)}}(Y,b,C,R)}))),"button"in R||(C.bS&&!R.defaultPrevented&&R.preventDefault(),C.stopPropagation&&R.stopPropagation()))}function mY(Y,b){return Y?!b:b}},13702:Y=>{Y.exports=function(Y,b,C){return Y[0]=b[0]+C[0],Y[1]=b[1]+C[1],Y[2]=b[2]+C[2],Y}},13654:(Y,b,C)=>{Y.exports=function(Y,b){var C=R(Y[0],Y[1],Y[2]),E=R(b[0],b[1],b[2]);q(C,C),q(E,E);var B=A(C,E);return B>1?0:Math.acos(B)};var R=C(13661),q=C(13669),A=C(13674)},13755:Y=>{Y.exports=function(Y,b){return Y[0]=Math.ceil(b[0]),Y[1]=Math.ceil(b[1]),Y[2]=Math.ceil(b[2]),Y}},13648:Y=>{Y.exports=function(Y){var b=new Float32Array(3);return b[0]=Y[0],b[1]=Y[1],b[2]=Y[2],b}},13679:Y=>{Y.exports=function(Y,b){return Y[0]=b[0],Y[1]=b[1],Y[2]=b[2],Y}},13644:Y=>{Y.exports=function(){var Y=new Float32Array(3);return Y[0]=0,Y[1]=0,Y[2]=0,Y}},13841:Y=>{Y.exports=function(Y,b,C){var R=b[0],q=b[1],A=b[2],E=C[0],B=C[1],g=C[2];return Y[0]=q*g-A*B,Y[1]=A*E-R*g,Y[2]=R*B-q*E,Y}},13786:(Y,b,C)=>{Y.exports=C(13777)},13777:Y=>{Y.exports=function(Y,b){var C=b[0]-Y[0],R=b[1]-Y[1],q=b[2]-Y[2];return Math.sqrt(C*C+R*R+q*q)}},13734:(Y,b,C)=>{Y.exports=C(13728)},13728:Y=>{Y.exports=function(Y,b,C){return Y[0]=b[0]/C[0],Y[1]=b[1]/C[1],Y[2]=b[2]/C[2],Y}},13674:Y=>{Y.exports=function(Y,b){return Y[0]*b[0]+Y[1]*b[1]+Y[2]*b[2]}},13639:Y=>{Y.exports=1e-6},13692:(Y,b,C)=>{Y.exports=function(Y,b){var C=Y[0],q=Y[1],A=Y[2],E=b[0],B=b[1],g=b[2];return Math.abs(C-E)<=R*Math.max(1,Math.abs(C),Math.abs(E))&&Math.abs(q-B)<=R*Math.max(1,Math.abs(q),Math.abs(B))&&Math.abs(A-g)<=R*Math.max(1,Math.abs(A),Math.abs(g))};var R=C(13639)},13697:Y=>{Y.exports=function(Y,b){return Y[0]===b[0]&&Y[1]===b[1]&&Y[2]===b[2]}},13750:Y=>{Y.exports=function(Y,b){return Y[0]=Math.floor(b[0]),Y[1]=Math.floor(b[1]),Y[2]=Math.floor(b[2]),Y}},13897:(Y,b,C)=>{Y.exports=function(Y,b,C,q,A,E){var B,g;b||(b=3);C||(C=0);g=q?Math.min(q*b+C,Y.length):Y.length;for(B=C;B<g;B+=b)R[0]=Y[B],R[1]=Y[B+1],R[2]=Y[B+2],A(R,R,E),Y[B]=R[0],Y[B+1]=R[1],Y[B+2]=R[2];return Y};var R=C(13644)()},13661:Y=>{Y.exports=function(Y,b,C){var R=new Float32Array(3);return R[0]=Y,R[1]=b,R[2]=C,R}},13633:(Y,b,C)=>{Y.exports={EPSILON:C(13639),create:C(13644),clone:C(13648),angle:C(13654),MB:C(13661),k:C(13679),set:C(13685),equals:C(13692),exactEquals:C(13697),add:C(13702),EC:C(13709),sub:C(13713),multiply:C(13719),mul:C(13725),divide:C(13728),div:C(13734),min:C(13737),max:C(13743),floor:C(13750),ceil:C(13755),round:C(13764),scale:C(13768),KB:C(13772),distance:C(13777),j:C(13786),squaredDistance:C(13792),sqrDist:C(13799),length:C(13801),len:C(13809),squaredLength:C(13817),fB:C(13821),negate:C(13823),inverse:C(13832),normalize:C(13669),dot:C(13674),cross:C(13841),iB:C(13850),random:C(13855),transformMat4:C(13859),transformMat3:C(13865),transformQuat:C(13870),ZB:C(13872),Yg:C(13880),bg:C(13888),forEach:C(13897)}},13832:Y=>{Y.exports=function(Y,b){return Y[0]=1/b[0],Y[1]=1/b[1],Y[2]=1/b[2],Y}},13809:(Y,b,C)=>{Y.exports=C(13801)},13801:Y=>{Y.exports=function(Y){var b=Y[0],C=Y[1],R=Y[2];return Math.sqrt(b*b+C*C+R*R)}},13850:Y=>{Y.exports=function(Y,b,C,R){var q=b[0],A=b[1],E=b[2];return Y[0]=q+R*(C[0]-q),Y[1]=A+R*(C[1]-A),Y[2]=E+R*(C[2]-E),Y}},13743:Y=>{Y.exports=function(Y,b,C){return Y[0]=Math.max(b[0],C[0]),Y[1]=Math.max(b[1],C[1]),Y[2]=Math.max(b[2],C[2]),Y}},13737:Y=>{Y.exports=function(Y,b,C){return Y[0]=Math.min(b[0],C[0]),Y[1]=Math.min(b[1],C[1]),Y[2]=Math.min(b[2],C[2]),Y}},13725:(Y,b,C)=>{Y.exports=C(13719)},13719:Y=>{Y.exports=function(Y,b,C){return Y[0]=b[0]*C[0],Y[1]=b[1]*C[1],Y[2]=b[2]*C[2],Y}},13823:Y=>{Y.exports=function(Y,b){return Y[0]=-b[0],Y[1]=-b[1],Y[2]=-b[2],Y}},13669:Y=>{Y.exports=function(Y,b){var C=b[0],R=b[1],q=b[2],A=C*C+R*R+q*q;A>0&&(A=1/Math.sqrt(A),Y[0]=b[0]*A,Y[1]=b[1]*A,Y[2]=b[2]*A);return Y}},13855:Y=>{Y.exports=function(Y,b){b=b||1;var C=2*Math.random()*Math.PI,R=2*Math.random()-1,q=Math.sqrt(1-R*R)*b;return Y[0]=Math.cos(C)*q,Y[1]=Math.sin(C)*q,Y[2]=R*b,Y}},13872:Y=>{Y.exports=function(Y,b,C,R){var q=C[1],A=C[2],E=b[1]-q,B=b[2]-A,g=Math.sin(R),r=Math.cos(R);return Y[0]=b[0],Y[1]=q+E*r-B*g,Y[2]=A+E*g+B*r,Y}},13880:Y=>{Y.exports=function(Y,b,C,R){var q=C[0],A=C[2],E=b[0]-q,B=b[2]-A,g=Math.sin(R),r=Math.cos(R);return Y[0]=q+B*g+E*r,Y[1]=b[1],Y[2]=A+B*r-E*g,Y}},13888:Y=>{Y.exports=function(Y,b,C,R){var q=C[0],A=C[1],E=b[0]-q,B=b[1]-A,g=Math.sin(R),r=Math.cos(R);return Y[0]=q+E*r-B*g,Y[1]=A+E*g+B*r,Y[2]=b[2],Y}},13764:Y=>{Y.exports=function(Y,b){return Y[0]=Math.round(b[0]),Y[1]=Math.round(b[1]),Y[2]=Math.round(b[2]),Y}},13768:Y=>{Y.exports=function(Y,b,C){return Y[0]=b[0]*C,Y[1]=b[1]*C,Y[2]=b[2]*C,Y}},13772:Y=>{Y.exports=function(Y,b,C,R){return Y[0]=b[0]+C[0]*R,Y[1]=b[1]+C[1]*R,Y[2]=b[2]+C[2]*R,Y}},13685:Y=>{Y.exports=function(Y,b,C,R){return Y[0]=b,Y[1]=C,Y[2]=R,Y}},13799:(Y,b,C)=>{Y.exports=C(13792)},13821:(Y,b,C)=>{Y.exports=C(13817)},13792:Y=>{Y.exports=function(Y,b){var C=b[0]-Y[0],R=b[1]-Y[1],q=b[2]-Y[2];return C*C+R*R+q*q}},13817:Y=>{Y.exports=function(Y){var b=Y[0],C=Y[1],R=Y[2];return b*b+C*C+R*R}},13713:(Y,b,C)=>{Y.exports=C(13709)},13709:Y=>{Y.exports=function(Y,b,C){return Y[0]=b[0]-C[0],Y[1]=b[1]-C[1],Y[2]=b[2]-C[2],Y}},13865:Y=>{Y.exports=function(Y,b,C){var R=b[0],q=b[1],A=b[2];return Y[0]=R*C[0]+q*C[3]+A*C[6],Y[1]=R*C[1]+q*C[4]+A*C[7],Y[2]=R*C[2]+q*C[5]+A*C[8],Y}},13859:Y=>{Y.exports=function(Y,b,C){var R=b[0],q=b[1],A=b[2],E=C[3]*R+C[7]*q+C[11]*A+C[15];return E=E||1,Y[0]=(C[0]*R+C[4]*q+C[8]*A+C[12])/E,Y[1]=(C[1]*R+C[5]*q+C[9]*A+C[13])/E,Y[2]=(C[2]*R+C[6]*q+C[10]*A+C[14])/E,Y}},13870:Y=>{Y.exports=function(Y,b,C){var R=b[0],q=b[1],A=b[2],E=C[0],B=C[1],g=C[2],r=C[3],O=r*R+B*A-g*q,F=r*q+g*R-E*A,y=r*A+E*q-B*R,S=-E*R-B*q-g*A;return Y[0]=O*r+S*-E+F*-g-y*-B,Y[1]=F*r+S*-B+y*-E-O*-g,Y[2]=y*r+S*-g+O*-B-F*-E,Y}},14644:Y=>{"use strict";Y.exports=function(Y){for(var b=new Array(Y),C=0;C<Y;++C)b[C]=C;return b}},14706:Y=>{Y.exports=function(Y){return null!=Y&&null!=Y.constructor&&"function"===typeof Y.constructor.isBuffer&&Y.constructor.isBuffer(Y)}},15111:(Y,b,C)=>{"use strict";C.d(b,{e:()=>R});class R{constructor(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.jF=!1,this.TF=!1,this.lF=30,this.XF=0,this.hF=!1,this.fullscreen=!1,this.vF=function(Y){},this.zF=function(){},this.oF=function(){},this.Eb=function(){},this.JF=function(Y){},this.onFullscreenChanged=function(Y){},r((()=>{!function(Y,b){Y._nowObject=performance||Date,Y._lastTick=0,Y._renderAccum=0,Y._rt=0,Y._frameCB=B.bind(null,Y),requestAnimationFrame(Y._frameCB),b>0&&(Y._intervalCB=E.bind(null,Y),Y._interval=setInterval(Y._intervalCB,Math.max(b,1e3/Y.lF/2)))}(this,b),function(Y,b){if(!b)return;var C=!1,R=!1;document.addEventListener("pointerlockchange",(R=>{C=document.pointerLockElement===b,Y.JF(C)})),document.addEventListener("fullscreenchange",(C=>{R=document.fullscreenElement===b,Y.onFullscreenChanged(R)})),Object.defineProperty(Y,"hF",{get:()=>C,set:Y=>{Y&&!C?g(b):C&&!Y&&function(Y){Y.exitPointerLock&&Y.exitPointerLock()}(document)}}),Object.defineProperty(Y,"fullscreen",{get:()=>R,set:Y=>{Y&&!R?b.requestFullscreen():R&&!Y&&document.exitFullscreen()}}),b.addEventListener("click",(q=>{Y.jF&&!C&&g(b),Y.TF&&!R&&b.requestFullscreen()}));var q=()=>Y.Eb();if(window.ResizeObserver){new ResizeObserver(q).observe(b)}else window.addEventListener("resize",q)}(this,Y),this.oF()}))}}var q=3,A=20;function E(Y){for(var b=1e3/Y.lF,C=Y._nowObject.now()+A,R=0;Y._nowObject.now()>=Y._lastTick+b&&Y._nowObject.now()<C&&++R<=q;)Y.vF(b),Y._lastTick+=b;var E=5*(b+5),B=Y._nowObject.now();if(B-Y._lastTick>E)for(;B>=Y._lastTick+b;)Y._lastTick+=b}function B(Y){requestAnimationFrame(Y._frameCB),E(Y);var b=Y._nowObject.now(),C=b-Y._rt;if(Y._rt=b,Y.XF>0){Y._renderAccum+=C;var R=1e3/Y.XF;if(Y._renderAccum<R)return;Y._renderAccum=Math.min(Y._renderAccum-R,R)}var q=1e3/Y.lF,A=(b-Y._lastTick)/q;Y.zF(C,A,q)}function g(Y){Y.requestPointerLock&&Y.requestPointerLock()}var r=Y=>{if("loading"===document.readyState){var b=()=>{document.removeEventListener("readystatechange",b),Y()};document.addEventListener("readystatechange",b)}else setTimeout(Y,1)}},14639:(Y,b,C)=>{var R=C(14644),q=C(14651),A="undefined"!==typeof Float64Array;function E(Y,b){return Y[0]-b[0]}function B(){var Y,b=this.stride,C=new Array(b.length);for(Y=0;Y<C.length;++Y)C[Y]=[Math.abs(b[Y]),Y];C.sort(E);var R=new Array(C.length);for(Y=0;Y<R.length;++Y)R[Y]=C[Y][1];return R}function g(Y,b){var C=["View",b,"d",Y].join("");b<0&&(C="View_Nil"+Y);var q="generic"===Y;if(-1===b){var A="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+Y+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(A)()}if(0===b){A="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+Y+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",A)(r[Y][0])}A=["'use strict'"];var E=R(b),g=E.map((function(Y){return"i"+Y})),O="this.offset+"+E.map((function(Y){return"this.stride["+Y+"]*i"+Y})).join("+"),F=E.map((function(Y){return"b"+Y})).join(","),y=E.map((function(Y){return"c"+Y})).join(",");A.push("function "+C+"(a,"+F+","+y+",d){this.data=a","this.shape=["+F+"]","this.stride=["+y+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+Y+"'","proto.dimension="+b),A.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+E.map((function(Y){return"this.shape["+Y+"]"})).join("*"),"}})"),1===b?A.push("proto.order=[0]"):(A.push("Object.defineProperty(proto,'order',{get:"),b<4?(A.push("function "+C+"_order(){"),2===b?A.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&A.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):A.push("ORDER})")),A.push("proto.set=function "+C+"_set("+g.join(",")+",v){"),q?A.push("return this.data.set("+O+",v)}"):A.push("return this.data["+O+"]=v}"),A.push("proto.get=function "+C+"_get("+g.join(",")+"){"),q?A.push("return this.data.get("+O+")}"):A.push("return this.data["+O+"]}"),A.push("proto.index=function "+C+"_index(",g.join(),"){return "+O+"}"),A.push("proto.hi=function "+C+"_hi("+g.join(",")+"){return new "+C+"(this.data,"+E.map((function(Y){return["(typeof i",Y,"!=='number'||i",Y,"<0)?this.shape[",Y,"]:i",Y,"|0"].join("")})).join(",")+","+E.map((function(Y){return"this.stride["+Y+"]"})).join(",")+",this.offset)}");var S=E.map((function(Y){return"a"+Y+"=this.shape["+Y+"]"})),n=E.map((function(Y){return"c"+Y+"=this.stride["+Y+"]"}));A.push("proto.lo=function "+C+"_lo("+g.join(",")+"){var b=this.offset,d=0,"+S.join(",")+","+n.join(","));for(var t=0;t<b;++t)A.push("if(typeof i"+t+"==='number'&&i"+t+">=0){d=i"+t+"|0;b+=c"+t+"*d;a"+t+"-=d}");A.push("return new "+C+"(this.data,"+E.map((function(Y){return"a"+Y})).join(",")+","+E.map((function(Y){return"c"+Y})).join(",")+",b)}"),A.push("proto.step=function "+C+"_step("+g.join(",")+"){var "+E.map((function(Y){return"a"+Y+"=this.shape["+Y+"]"})).join(",")+","+E.map((function(Y){return"b"+Y+"=this.stride["+Y+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(t=0;t<b;++t)A.push("if(typeof i"+t+"==='number'){d=i"+t+"|0;if(d<0){c+=b"+t+"*(a"+t+"-1);a"+t+"=ceil(-a"+t+"/d)}else{a"+t+"=ceil(a"+t+"/d)}b"+t+"*=d}");A.push("return new "+C+"(this.data,"+E.map((function(Y){return"a"+Y})).join(",")+","+E.map((function(Y){return"b"+Y})).join(",")+",c)}");var I=new Array(b),w=new Array(b);for(t=0;t<b;++t)I[t]="a[i"+t+"]",w[t]="b[i"+t+"]";A.push("proto.transpose=function "+C+"_transpose("+g+"){"+g.map((function(Y,b){return Y+"=("+Y+"===undefined?"+b+":"+Y+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+I.join(",")+","+w.join(",")+",this.offset)}"),A.push("proto.pick=function "+C+"_pick("+g+"){var a=[],b=[],c=this.offset");for(t=0;t<b;++t)A.push("if(typeof i"+t+"==='number'&&i"+t+">=0){c=(c+this.stride["+t+"]*i"+t+")|0}else{a.push(this.shape["+t+"]);b.push(this.stride["+t+"])}");return A.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),A.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+E.map((function(Y){return"shape["+Y+"]"})).join(",")+","+E.map((function(Y){return"stride["+Y+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",A.join("\n"))(r[Y],B)}var r={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Y.exports=function(Y,b,C,R){if(void 0===Y)return(0,r.array[0])([]);"number"===typeof Y&&(Y=[Y]),void 0===b&&(b=[Y.length]);var E=b.length;if(void 0===C){C=new Array(E);for(var B=E-1,O=1;B>=0;--B)C[B]=O,O*=b[B]}if(void 0===R){R=0;for(B=0;B<E;++B)C[B]<0&&(R-=(b[B]-1)*C[B])}for(var F=function(Y){if(q(Y))return"buffer";if(A)switch(Object.prototype.toString.call(Y)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Y)?"array":"generic"}(Y),y=r[F];y.length<=E+1;)y.push(g(F,y.length-1));return(0,y[E+1])(Y,b,C,R)}},14651:Y=>{function b(Y){return!!Y.constructor&&"function"===typeof Y.constructor.isBuffer&&Y.constructor.isBuffer(Y)}Y.exports=function(Y){return null!=Y&&(b(Y)||function(Y){return"function"===typeof Y.readFloatLE&&"function"===typeof Y.slice&&b(Y.slice(0,0))}(Y)||!!Y._isBuffer)}},14794:Y=>{"use strict";var b=[],C=[],R=[],q=[],A=[],E=[],B=[],g=[],r=[],O=[],F=[],y=[];Y.exports=function(Y,S,n,t,I,w){for(var Q=B,N=r,p=O,mY=y,L=0;L<3;L++)Q[L]=+n[L],p[L]=+S.max[L],N[L]=+S.base[L];w||(w=1e-10);var u=function(Y,B,r,O,y,S){var n=b,t=C,I=R,w=q,Q=A,N=E,p=g,mY=Math.floor,L=0,u=0,c=0,l=0,X=0;if(j(),0===c)return 0;for(l=v();u<=c;){if(T(l)&&P())return L;l=v()}for(L+=c,X=0;X<3;X++)O[X]+=r[X],y[X]+=r[X];return L;function j(){if(u=0,0!==(c=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])))for(var Y=0;Y<3;Y++){var b=r[Y]>=0;w[Y]=b?1:-1;var C=b?y[Y]:O[Y];n[Y]=b?O[Y]:y[Y],t[Y]=z(C,w[Y]),I[Y]=J(n[Y],w[Y]),p[Y]=r[Y]/c,Q[Y]=Math.abs(1/p[Y]);var R=b?t[Y]+1-C:C-t[Y];N[Y]=Q[Y]<1/0?Q[Y]*R:1/0}}function T(b){for(var C=w[0],R=0===b?t[0]:I[0],q=t[0]+C,A=w[1],E=1===b?t[1]:I[1],B=t[1]+A,g=w[2],r=2===b?t[2]:I[2],O=t[2]+g,F=R;F!=q;F+=C)for(var y=E;y!=B;y+=A)for(var S=r;S!=O;S+=g)if(Y(F,y,S))return!0;return!1}function P(){L+=u;var Y=w[l],b=u/c,C=F;for(X=0;X<3;X++){var R=r[X]*b;O[X]+=R,y[X]+=R,C[X]=r[X]-R}if(Y>0?y[l]=Math.round(y[l]):O[l]=Math.round(O[l]),B(L,l,Y,C))return!0;for(X=0;X<3;X++)r[X]=C[X];return j(),0===c}function v(){var Y=N[0]<N[1]?N[0]<N[2]?0:2:N[1]<N[2]?1:2,b=N[Y]-u;for(u=N[Y],t[Y]+=w[Y],N[Y]+=Q[Y],X=0;X<3;X++)n[X]+=b*p[X],I[X]=J(n[X],w[X]);return Y}function z(Y,b){return mY(Y-b*S)}function J(Y,b){return mY(Y+b*S)}}(Y,t,Q,N,p,w);if(!I){for(L=0;L<3;L++)mY[L]=n[L]>0?p[L]-S.max[L]:N[L]-S.base[L];S.translate(mY)}return u}},15151:(Y,b,C)=>{"use strict";C.d(b,{c:()=>F});var R=C(14789),q=C(13633);class A{constructor(Y,b,C,A,E,B,g){this.cO=new R(Y.base,Y.WO),this.lq=b,this.friction=C,this.restitution=A,this.JB=E,this.Fn=B,this.UB=!!g,this.iO=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Yt=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Wr=q.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=q.create(),this._impulses=q.create(),this._sleepFrameCount=10}loadFromCopy(Y){q.k(this.cO.base,Y.cO.base),q.k(this.cO.WO,Y.cO.WO),q.k(this.cO.max,Y.cO.max),this.cO.mag=Y.cO.mag,this.lq=Y.lq,this.friction=Y.friction,this.restitution=Y.restitution,this.JB=Y.JB,this.Fn=Y.Fn,this.UB=Y.UB,this.iO=Y.iO,this.fluidDrag=Y.fluidDrag,this.Yt=Y.Yt,this.preventFallOffEdge=Y.preventFallOffEdge,this.rolledBackLastTick=Y.rolledBackLastTick,q.k(this.Wr,Y.Wr),q.k(this.resting,Y.resting),this.inFluid=Y.inFluid,this._ratioInFluid=Y._ratioInFluid,q.k(this._forces,Y._forces),q.k(this._impulses,Y._impulses),this._sleepFrameCount=Y._sleepFrameCount}setPosition(Y){E(Y),q.EC(Y,Y,this.cO.base),this.cO.translate(Y),this.sr()}Bb(){return q.clone(this.cO.base)}applyForce(Y){E(Y),q.add(this._forces,this._forces,Y),this.sr()}applyImpulse(Y){E(Y),q.add(this._impulses,this._impulses,Y),this.sr()}sr(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var E=Y=>{};var B=C(14789),g=C(13633),r=C(14794);function O(){this.iO=.1,this.fluidDrag=.4,this.HB=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function F(Y,b,C){Y=Object.assign(new O,Y),this.gravity=Y.gravity||[0,-10,0],this.iO=Y.iO||.1,this.HB=Y.HB||2,this.fluidDrag=Y.fluidDrag||.4,this.minBounceImpulse=Y.minBounceImpulse,this.bodies=[],this.US=Y.US,this.testSolid=b,this.testFluid=C}F.prototype.Qn=function(Y,b,C,R,q,E){Y=Y||new B([0,0,0],[1,1,1]),"undefined"==typeof b&&(b=1),"undefined"==typeof C&&(C=1),"undefined"==typeof R&&(R=0),"undefined"==typeof q&&(q=1);var g=new A(Y,b,C,R,q,E);return this.bodies.push(g),g},F.prototype.Nn=function(Y){var b=this.bodies.indexOf(Y);b<0||(this.bodies.splice(b,1),Y.cO=Y.Fn=null)};var y=g.create(),S=g.create(),n=g.create(),t=g.create(),I=g.create(),w=g.create(),Q=g.create(),N=new B([0,0,0],[1,1,1]),p=new A(N,1,1,0,1,(()=>{}),!1);function mY(Y,b,C){return b=C,b*=1-(1-Y.ratioInFluid)**2}F.prototype.rg=function(Y){Y/=1e3;var b=e(0,g.squaredLength(this.gravity));this.bodies.forEach((C=>function(Y,b,C,R){g.k(I,b.resting),Y.US&&p.loadFromCopy(b);if(b.lq<=0)return g.set(b.Wr,0,0,0),g.set(b._forces,0,0,0),void g.set(b._impulses,0,0,0);var q=R||0===b.JB;if(function(Y,b,C,R){if(b._sleepFrameCount>0)return!1;if(R)return!0;var q=!1,A=.5*C*C*b.JB;return g.scale(h,Y.gravity,A),r(Y.testSolid,b.cO,h,(function(){return q=!0,!0}),!0),q}(Y,b,C,q))return;b._sleepFrameCount--,function(Y,b){var C=b.cO,R=Math.floor(C.base[0]),q=Math.floor(C.base[2]),A=Math.floor(C.base[1]),E=Math.floor(C.max[1]);if(!Y.testFluid(R,A,q))return b.inFluid=!1,void(b.ratioInFluid=0);var B=1,r=A+1;for(;r<=E&&Y.testFluid(R,r,q);)B++,r++;var O=(A+B-C.base[1])/C.WO[1];O>1&&(O=1);var F=C.WO[0]*C.WO[1]*C.WO[2]*O,y=u;g.scale(y,Y.gravity,-Y.HB*F*b.JB),b.applyForce(y),b.inFluid=!0,b.ratioInFluid=O}(Y,b),i(b._forces),i(b._impulses),i(b.Wr),i(b.resting),g.scale(y,b._forces,1/b.lq),g.KB(y,y,Y.gravity,b.JB),g.scale(S,b._impulses,1/b.lq),g.KB(S,S,y,C),g.add(b.Wr,b.Wr,S),b.friction&&(c(Y,0,b,S,C),c(Y,1,b,S,C),c(Y,2,b,S,C));var A=b.fluidDrag>=0?b.fluidDrag:Y.fluidDrag,E=b.iO>=0?b.iO:Y.iO,B=E,O=E;b.inFluid&&(B=mY(b,B,b.fluidDragHoriz>=0?b.fluidDragHoriz:A),O=mY(b,O,b.fluidDragVert>=0?b.fluidDragVert:A));B=Math.max(1-B*C/b.lq,0),O=Math.max(1-O*C/b.lq,0),g.set(L,B,O,B),g.multiply(b.Wr,b.Wr,L),g.scale(n,b.Wr,C),g.set(b._forces,0,0,0),g.set(b._impulses,0,0,0),b.UB&&H(j,b.cO);g.k(w,n),g.set(Q,0,0,0),b.preventFallOffEdge&&function(Y,b,C,R){if(!b.resting[1]||C[1]>0)return;var q=U;H(q,b.cO);for(var A=0;A<3;A+=2){g.set(J,0,0,0),J[A]=C[A];var E=!0;(E=(E=(E=(E=E&&!G(Y,q.base[0]+J[0]+1e-5,q.base[1],q.base[2]+J[2]+1e-5))&&!G(Y,q.max[0]+J[0]-1e-5,q.base[1],q.base[2]+J[2]+1e-5))&&!G(Y,q.base[0]+J[0]+1e-5,q.base[1],q.max[2]+J[2]-1e-5))&&!G(Y,q.max[0]+J[0]-1e-5,q.base[1],q.max[2]+J[2]-1e-5))?(R[A]=C[A]>0?1:-1,C[A]=0):0===A&&(g.set(o,C[0],0,0),X(Y,q,o,R,b.slideOnCollision))}}(Y,b,n,Q);X(Y,b.cO,n,b.resting,b.slideOnCollision),b.UB&&function(Y,b,C,R){if(b.resting[1]>=0&&!b.inFluid)return;var q=0!==b.resting[0],A=0!==b.resting[2];if(!q&&!A)return;var E=Math.abs(R[0]/R[2]),B=4;if(!q&&E>B)return;if(!A&&E<1/B)return;g.add(P,C.base,R);var O=Y.testSolid;r(O,C,R,(function(Y,b,C,R){if(1!==b)return!0;R[b]=0}));var F=C.base[1],y=b.inFluid?1.951:1.001,S=Math.floor(F+y)-F;g.set(v,0,S,0);var n=!1;if(r(O,C,v,(function(Y,b,C,R){return n=!0,!0})),n)return;g.EC(z,P,C.base),z[1]=0,X(Y,C,z,T,!0);var t=e(C.base[0],P[0]),I=e(C.base[2],P[2]);if(q&&!t&&(!I||!A))return;if(A&&(!t||!q)&&!I)return;var w=!0;if(w=w&&!G(Y,C.base[0]+1e-5,C.base[1],C.base[2]+1e-5),w=w&&!G(Y,C.max[0]-1e-5,C.base[1],C.base[2]+1e-5),w=w&&!G(Y,C.base[0]+1e-5,C.base[1],C.max[2]-1e-5),w=w&&!G(Y,C.max[0]-1e-5,C.base[1],C.max[2]-1e-5),w)return;H(b.cO,C),b.resting[0]=T[0],b.resting[2]=T[2],b.Yt&&b.Yt()}(Y,b,j,w);for(var F=0;F<3;++F)b.resting[F]=b.resting[F]||Q[F],t[F]=0,b.resting[F]&&(I[F]||(t[F]=-b.Wr[F]),b.Wr[F]=0);var N=g.length(t);N>.001&&(g.scale(t,t,b.lq),b.Fn&&b.Fn(t),b.restitution>0&&N>Y.minBounceImpulse&&(g.scale(t,t,b.restitution),b.applyImpulse(t)));var l=g.squaredLength(b.Wr);l>1e-5&&b.sr();Y.US&&Y.US(b)?(b.loadFromCopy(p),b.rolledBackLastTick=!0):b.rolledBackLastTick=!1}(this,C,Y,b)))};var L=g.create([0,0,0]);var u=g.create();function c(Y,b,C,R,q){var A=C.resting[b],E=R[b];if(!C.alwaysApplyHorizFriction||1!==b){if(0===A)return;if(A*E<=0)return}g.k(l,C.Wr),l[b]=0;var B=g.length(l);if(!e(B,0)){var r=Math.abs(C.friction*Y.gravity[b]*q),O=B>r?(B-r)/B:0;C.Wr[(b+1)%3]*=O,C.Wr[(b+2)%3]*=O}}var l=g.create();function X(Y,b,C,R,q){return g.set(R,0,0,0),r(Y.testSolid,b,C,(function(Y,b,C,A){R[b]=C,A[b]=0,q||(A[0]=0,A[1]=0,A[2]=0)}))}var j=new B([],[]),T=g.create(),P=g.create(),v=g.create(),z=g.create();var J=g.create(),U=new B([],[]),o=g.create();function G(Y,b,C,R){return Y.testSolid(Math.floor(b),Math.floor(C-1),Math.floor(R))}var h=g.create();function e(Y,b){return Math.abs(Y-b)<1e-5}function H(Y,b){for(var C=0;C<3;C++)Y.base[C]=b.base[C],Y.max[C]=b.max[C],Y.WO[C]=b.WO[C]}var i=function(Y){}},13505:function(Y,b){!function(Y){"use strict";var b=function(Y,C){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Y,b){Y.__proto__=b}||function(Y,b){for(var C in b)Object.prototype.hasOwnProperty.call(b,C)&&(Y[C]=b[C])},b(Y,C)};function C(Y,C){if("function"!==typeof C&&null!==C)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function R(){this.constructor=Y}b(Y,C),Y.prototype=null===C?Object.create(C):(R.prototype=C.prototype,new R)}function R(Y,b,C,R){var q,A=arguments.length,E=A<3?b:null===R?R=Object.getOwnPropertyDescriptor(b,C):R;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)E=Reflect.decorate(Y,b,C,R);else for(var B=Y.length-1;B>=0;B--)(q=Y[B])&&(E=(A<3?q(E):A>3?q(b,C,E):q(b,C))||E);return A>3&&E&&Object.defineProperty(b,C,E),E}function q(Y,b,C){if(C||2===arguments.length)for(var R,q=0,A=b.length;q<A;q++)!R&&q in b||(R||(R=Array.prototype.slice.call(b,0,q)),R[q]=b[q]);return Y.concat(R||Array.prototype.slice.call(b))}var A,E=255,B=213;Y.OPERATION=void 0,(A=Y.OPERATION||(Y.OPERATION={}))[A.ADD=128]="ADD",A[A.REPLACE=0]="REPLACE",A[A.DELETE=64]="DELETE",A[A.DELETE_AND_ADD=192]="DELETE_AND_ADD",A[A.TOUCH=1]="TOUCH",A[A.CLEAR=10]="CLEAR";var g=function(){function b(Y,b,C){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=Y,this.setParent(b,C)}return b.prototype.setParent=function(Y,b,C){var R=this;if(this.indexes||(this.indexes=this.ref instanceof zY?this.ref._definition.indexes:{}),this.parent=Y,this.parentIndex=C,b)if(this.root=b,this.ref instanceof zY){var q=this.ref._definition;for(var A in q.schema){var E=this.ref[A];if(E&&E.$changes){var B=q.indexes[A];E.$changes.setParent(this.ref,b,B)}}}else"object"===typeof this.ref&&this.ref.forEach((function(Y,b){if(Y instanceof zY){var C=Y.$changes,q=R.ref.$changes.indexes[b];C.setParent(R.ref,R.root,q)}}))},b.prototype.operation=function(Y){this.changes.set(--this.currentCustomOperation,Y)},b.prototype.change=function(b,C){void 0===C&&(C=Y.OPERATION.ADD);var R="number"===typeof b?b:this.indexes[b];this.assertValidIndex(R,b);var q=this.changes.get(R);q&&q.op!==Y.OPERATION.DELETE&&q.op!==Y.OPERATION.TOUCH||this.changes.set(R,{op:q&&q.op===Y.OPERATION.DELETE?Y.OPERATION.DELETE_AND_ADD:C,index:R}),this.allChanges.add(R),this.changed=!0,this.touchParents()},b.prototype.touch=function(b){var C="number"===typeof b?b:this.indexes[b];this.assertValidIndex(C,b),this.changes.has(C)||this.changes.set(C,{op:Y.OPERATION.TOUCH,index:C}),this.allChanges.add(C),this.touchParents()},b.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},b.prototype.getType=function(Y){if(this.ref._definition)return(b=this.ref._definition).schema[b.fieldsByIndex[Y]];var b,C=(b=this.parent._definition).schema[b.fieldsByIndex[this.parentIndex]];return Object.values(C)[0]},b.prototype.getChildrenFilter=function(){var Y=this.parent._definition.childFilters;return Y&&Y[this.parentIndex]},b.prototype.getValue=function(Y){return this.ref.getByIndex(Y)},b.prototype.delete=function(b){var C="number"===typeof b?b:this.indexes[b];if(void 0!==C){var R=this.getValue(C);this.changes.set(C,{op:Y.OPERATION.DELETE,index:C}),this.allChanges.delete(C),delete this.caches[C],R&&R.$changes&&(R.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(b," (").concat(C,")"))},b.prototype.discard=function(b,C){var R=this;void 0===b&&(b=!1),void 0===C&&(C=!1),this.ref instanceof zY||this.changes.forEach((function(b){if(b.op===Y.OPERATION.DELETE){var C=R.ref.getIndex(b.index);delete R.indexes[C]}})),this.changes.clear(),this.changed=b,C&&this.allChanges.clear(),this.currentCustomOperation=0},b.prototype.discardAll=function(){var Y=this;this.changes.forEach((function(b){var C=Y.getValue(b.index);C&&C.$changes&&C.$changes.discardAll()})),this.discard()},b.prototype.cache=function(Y,b){this.caches[Y]=b},b.prototype.clone=function(){return new b(this.ref,this.parent,this.root)},b.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},b.prototype.assertValidIndex=function(Y,b){if(void 0===Y)throw new Error('ChangeTree: missing index for field "'.concat(b,'"'))},b}();function r(Y,b,C,R){return Y[b]||(Y[b]=[]),Y[b].push(C),null===R||void 0===R||R.forEach((function(Y,b){return C(Y,b)})),function(){return F(Y[b],Y[b].indexOf(C))}}function O(b){var C=this,R="string"!==typeof this.$changes.getType();this.$items.forEach((function(q,A){b.push({refId:C.$changes.refId,op:Y.OPERATION.DELETE,field:A,value:void 0,previousValue:q}),R&&C.$changes.root.removeRef(q.$changes.refId)}))}function F(Y,b){if(-1===b||b>=Y.length)return!1;for(var C=Y.length-1,R=b;R<C;R++)Y[R]=Y[R+1];return Y.length=C,!0}var y=function(Y,b){var C=Y.toString(),R=b.toString();return C<R?-1:C>R?1:0};function S(Y){return Y.$proxy=!0,Y=new Proxy(Y,{get:function(Y,b){return"symbol"===typeof b||isNaN(b)?Y[b]:Y.at(b)},set:function(Y,b,C){if("symbol"===typeof b||isNaN(b))Y[b]=C;else{var R=Array.from(Y.$items.keys()),q=parseInt(R[b]||b);void 0===C||null===C?Y.deleteAt(q):Y.setAt(q,C)}return!0},deleteProperty:function(Y,b){return"number"===typeof b?Y.deleteAt(b):delete Y[b],!0}})}var n=function(){function b(){for(var Y=[],b=0;b<arguments.length;b++)Y[b]=arguments[b];this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,Y)}return b.prototype.Og=function(b,C){return void 0===C&&(C=!0),r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.ADD,b,C?this.$items:void 0)},b.prototype.Ab=function(b){return r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.REPLACE,b)},b.is=function(Y){return Array.isArray(Y)||void 0!==Y.array},Object.defineProperty(b.prototype,"length",{get:function(){return this.$items.size},set:function(Y){0===Y?this.clear():this.splice(Y,this.length-Y)},enumerable:!1,configurable:!0}),b.prototype.push=function(){for(var Y,b=this,C=[],R=0;R<arguments.length;R++)C[R]=arguments[R];return C.forEach((function(C){Y=b.$refId++,b.setAt(Y,C)})),Y},b.prototype.pop=function(){var Y=Array.from(this.$indexes.values()).pop();if(void 0!==Y){this.$changes.delete(Y),this.$indexes.delete(Y);var b=this.$items.get(Y);return this.$items.delete(Y),b}},b.prototype.at=function(Y){var b=Array.from(this.$items.keys())[Y];return this.$items.get(b)},b.prototype.setAt=function(b,C){var R,q;if(void 0!==C&&null!==C){if(this.$items.get(b)!==C){void 0!==C.$changes&&C.$changes.setParent(this,this.$changes.root,b);var A=null!==(q=null===(R=this.$changes.indexes[b])||void 0===R?void 0:R.op)&&void 0!==q?q:Y.OPERATION.ADD;this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,C),this.$changes.change(b,A)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},b.prototype.deleteAt=function(Y){var b=Array.from(this.$items.keys())[Y];return void 0!==b&&this.$deleteAt(b)},b.prototype.$deleteAt=function(Y){return this.$changes.delete(Y),this.$indexes.delete(Y),this.$items.delete(Y)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&O.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:Y.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.concat=function(){for(var Y,C=[],R=0;R<arguments.length;R++)C[R]=arguments[R];return new(b.bind.apply(b,q([void 0],(Y=Array.from(this.$items.values())).concat.apply(Y,C),!1)))},b.prototype.join=function(Y){return Array.from(this.$items.values()).join(Y)},b.prototype.reverse=function(){var Y=this,b=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(C,R){Y.setAt(b[R],C)})),this},b.prototype.shift=function(){var Y=Array.from(this.$items.keys()).shift();if(void 0!==Y){var b=this.$items.get(Y);return this.$deleteAt(Y),b}},b.prototype.slice=function(Y,C){var R=new b;return R.push.apply(R,Array.from(this.$items.values()).slice(Y,C)),R},b.prototype.sort=function(Y){var b=this;void 0===Y&&(Y=y);var C=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(Y).forEach((function(Y,R){b.setAt(C[R],Y)})),this},b.prototype.splice=function(Y,b){void 0===b&&(b=this.length-Y);for(var C=Array.from(this.$items.keys()),R=[],q=Y;q<Y+b;q++)R.push(this.$items.get(C[q])),this.$deleteAt(C[q]);return R},b.prototype.unshift=function(){for(var Y=this,b=[],C=0;C<arguments.length;C++)b[C]=arguments[C];var R=this.length,q=b.length,A=Array.from(this.$items.values());return b.forEach((function(b,C){Y.setAt(C,b)})),A.forEach((function(b,C){Y.setAt(q+C,b)})),R+q},b.prototype.indexOf=function(Y,b){return Array.from(this.$items.values()).indexOf(Y,b)},b.prototype.lastIndexOf=function(Y,b){return void 0===b&&(b=this.length-1),Array.from(this.$items.values()).lastIndexOf(Y,b)},b.prototype.every=function(Y,b){return Array.from(this.$items.values()).every(Y,b)},b.prototype.some=function(Y,b){return Array.from(this.$items.values()).some(Y,b)},b.prototype.forEach=function(Y,b){Array.from(this.$items.values()).forEach(Y,b)},b.prototype.map=function(Y,b){return Array.from(this.$items.values()).map(Y,b)},b.prototype.filter=function(Y,b){return Array.from(this.$items.values()).filter(Y,b)},b.prototype.reduce=function(Y,b){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},b.prototype.reduceRight=function(Y,b){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},b.prototype.find=function(Y,b){return Array.from(this.$items.values()).find(Y,b)},b.prototype.findIndex=function(Y,b){return Array.from(this.$items.values()).findIndex(Y,b)},b.prototype.fill=function(Y,b,C){throw new Error("ArraySchema#fill() not implemented")},b.prototype.copyWithin=function(Y,b,C){throw new Error("ArraySchema#copyWithin() not implemented")},b.prototype.toString=function(){return this.$items.toString()},b.prototype.toLocaleString=function(){return this.$items.toLocaleString()},b.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},b.prototype.includes=function(Y,b){return Array.from(this.$items.values()).includes(Y,b)},b.prototype.flatMap=function(Y,b){throw new Error("ArraySchema#flatMap() is not supported.")},b.prototype.flat=function(Y){throw new Error("ArraySchema#flat() is not supported.")},b.prototype.findLast=function(){var Y=Array.from(this.$items.values());return Y.findLast.apply(Y,arguments)},b.prototype.findLastIndex=function(){var Y=Array.from(this.$items.values());return Y.findLastIndex.apply(Y,arguments)},b.prototype.setIndex=function(Y,b){this.$indexes.set(Y,b)},b.prototype.getIndex=function(Y){return this.$indexes.get(Y)},b.prototype.getByIndex=function(Y){return this.$items.get(this.$indexes.get(Y))},b.prototype.deleteByIndex=function(Y){var b=this.$indexes.get(Y);this.$items.delete(b),this.$indexes.delete(Y)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){return this.toArray().map((function(Y){return"function"===typeof Y.toJSON?Y.toJSON():Y}))},b.prototype.clone=function(Y){return Y?new(b.bind.apply(b,q([void 0],Array.from(this.$items.values()),!1))):new(b.bind.apply(b,q([void 0],this.map((function(Y){return Y.$changes?Y.clone():Y})),!1)))},b}();function t(Y){return Y.$proxy=!0,Y=new Proxy(Y,{get:function(Y,b){return"symbol"!==typeof b&&"undefined"===typeof Y[b]?Y.get(b):Y[b]},set:function(Y,b,C){return"symbol"!==typeof b&&-1===b.indexOf("$")&&"Og"!==b&&"Ab"!==b&&"onChange"!==b?Y.set(b,C):Y[b]=C,!0},deleteProperty:function(Y,b){return Y.delete(b),!0}})}var I=function(){function b(Y){var C=this;if(this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Y)if(Y instanceof Map||Y instanceof b)Y.forEach((function(Y,b){return C.set(b,Y)}));else for(var R in Y)this.set(R,Y[R])}return b.prototype.Og=function(b,C){return void 0===C&&(C=!0),r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.ADD,b,C?this.$items:void 0)},b.prototype.Ab=function(b){return r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.REPLACE,b)},b.is=function(Y){return void 0!==Y.map},b.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(b.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.set=function(b,C){if(void 0===C||null===C)throw new Error("MapSchema#set('".concat(b,"', ").concat(C,"): trying to set ").concat(C," value on '").concat(b,"'."));b=b.toString();var R="undefined"!==typeof this.$changes.indexes[b],q=R?this.$changes.indexes[b]:this.$refId++,A=R?Y.OPERATION.REPLACE:Y.OPERATION.ADD,E=void 0!==C.$changes;if(E&&C.$changes.setParent(this,this.$changes.root,q),R){if(!E&&this.$items.get(b)===C)return;E&&this.$items.get(b)!==C&&(A=Y.OPERATION.ADD)}else this.$changes.indexes[b]=q,this.$indexes.set(q,b);return this.$items.set(b,C),this.$changes.change(b,A),this},b.prototype.get=function(Y){return this.$items.get(Y)},b.prototype.delete=function(Y){return this.$changes.delete(Y),this.$items.delete(Y)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&O.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:Y.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(Y){return this.$items.has(Y)},b.prototype.forEach=function(Y){this.$items.forEach(Y)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(Y,b){this.$indexes.set(Y,b)},b.prototype.getIndex=function(Y){return this.$indexes.get(Y)},b.prototype.getByIndex=function(Y){return this.$items.get(this.$indexes.get(Y))},b.prototype.deleteByIndex=function(Y){var b=this.$indexes.get(Y);this.$items.delete(b),this.$indexes.delete(Y)},b.prototype.toJSON=function(){var Y={};return this.forEach((function(b,C){Y[C]="function"===typeof b.toJSON?b.toJSON():b})),Y},b.prototype.clone=function(Y){var C;return Y?C=Object.assign(new b,this):(C=new b,this.forEach((function(Y,b){Y.$changes?C.set(b,Y.clone()):C.set(b,Y)}))),C},b}(),w={};function Q(Y,b){w[Y]=b}function N(Y){return w[Y]}var p=function(){function Y(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return Y.create=function(b){var C=new Y;return C.schema=Object.assign({},b&&b.schema||{}),C.indexes=Object.assign({},b&&b.indexes||{}),C.fieldsByIndex=Object.assign({},b&&b.fieldsByIndex||{}),C.descriptors=Object.assign({},b&&b.descriptors||{}),C.deprecated=Object.assign({},b&&b.deprecated||{}),C},Y.prototype.addField=function(Y,b){var C=this.getNextFieldIndex();this.fieldsByIndex[C]=Y,this.indexes[Y]=C,this.schema[Y]=Array.isArray(b)?{array:b[0]}:b},Y.prototype.hasField=function(Y){return void 0!==this.indexes[Y]},Y.prototype.addFilter=function(Y,b){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[Y]]=b,this.indexesWithFilters.push(this.indexes[Y]),!0},Y.prototype.addChildrenFilter=function(Y,b){var C=this.indexes[Y],R=this.schema[Y];if(N(Object.keys(R)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[C]=b,!0;console.warn("@filterChildren: field '".concat(Y,"' can't have children. Ignoring filter."))},Y.prototype.getChildrenFilter=function(Y){return this.childFilters&&this.childFilters[this.indexes[Y]]},Y.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},Y}();function mY(Y){return Y._context&&Y._context.useFilters}var L=function(){function Y(){this.types={},this.schemas=new Map,this.useFilters=!1}return Y.prototype.has=function(Y){return this.schemas.has(Y)},Y.prototype.get=function(Y){return this.types[Y]},Y.prototype.add=function(Y,b){void 0===b&&(b=this.schemas.size),Y._definition=p.create(Y._definition),Y._typeid=b,this.types[b]=Y,this.schemas.set(Y,b)},Y.create=function(b){return void 0===b&&(b={}),function(C){return b.context||(b.context=new Y),c(C,b)}},Y}(),u=new L;function c(Y,b){return void 0===b&&(b={}),function(C,R){var A=b.context||u,E=C.constructor;if(E._context=A,!Y)throw new Error("".concat(E.name,': @type() reference provided for "').concat(R,"\" is undefined. Make sure you don't have any circular dependencies."));A.has(E)||A.add(E);var B=E._definition;if(B.addField(R,Y),B.descriptors[R]){if(B.deprecated[R])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(R,"' definition on '").concat(E.name,"'.\nCheck @type() annotation"))}catch(w){var g=w.stack.split("\n")[4].trim();throw new Error("".concat(w.message," ").concat(g))}}var r=n.is(Y),O=!r&&I.is(Y);if("string"!==typeof Y&&!zY.is(Y)){var F=Object.values(Y)[0];"string"===typeof F||A.has(F)||A.add(F)}if(b.manual)B.descriptors[R]={enumerable:!0,configurable:!0,writable:!0};else{var y="_".concat(R);B.descriptors[y]={enumerable:!1,configurable:!1,writable:!0},B.descriptors[R]={get:function(){return this[y]},set:function(Y){Y!==this[y]&&(void 0!==Y&&null!==Y?(!r||Y instanceof n||(Y=new(n.bind.apply(n,q([void 0],Y,!1)))),!O||Y instanceof I||(Y=new I(Y)),void 0===Y.$proxy&&(O?Y=t(Y):r&&(Y=S(Y))),this.$changes.change(R),Y.$changes&&Y.$changes.setParent(this,this.$changes.root,this._definition.indexes[R])):this[y]&&this.$changes.delete(R),this[y]=Y)},enumerable:!0,configurable:!0}}}}function l(Y){return function(b,C){var R=b.constructor;R._definition.addFilter(C,Y)&&(R._context.useFilters=!0)}}function X(Y){return function(b,C){var R=b.constructor;R._definition.addChildrenFilter(C,Y)&&(R._context.useFilters=!0)}}function j(Y){return void 0===Y&&(Y=!0),function(b,C){var R=b.constructor._definition;R.deprecated[C]=!0,Y&&(R.descriptors[C]={get:function(){throw new Error("".concat(C," is deprecated."))},set:function(Y){},enumerable:!1,configurable:!0})}}function T(Y,b,C){for(var R in void 0===C&&(C={}),C.context||(C.context=Y._context||C.context||u),b)c(b[R],C)(Y.prototype,R);return Y}function P(Y){for(var b=0,C=0,R=0,q=Y.length;R<q;R++)(b=Y.charCodeAt(R))<128?C+=1:b<2048?C+=2:b<55296||b>=57344?C+=3:(R++,C+=4);return C}function v(Y,b,C){for(var R=0,q=0,A=C.length;q<A;q++)(R=C.charCodeAt(q))<128?Y[b++]=R:R<2048?(Y[b++]=192|R>>6,Y[b++]=128|63&R):R<55296||R>=57344?(Y[b++]=224|R>>12,Y[b++]=128|R>>6&63,Y[b++]=128|63&R):(q++,R=65536+((1023&R)<<10|1023&C.charCodeAt(q)),Y[b++]=240|R>>18,Y[b++]=128|R>>12&63,Y[b++]=128|R>>6&63,Y[b++]=128|63&R)}function z(Y,b){Y.push(255&b)}function J(Y,b){Y.push(255&b)}function U(Y,b){Y.push(255&b),Y.push(b>>8&255)}function o(Y,b){Y.push(255&b),Y.push(b>>8&255)}function G(Y,b){Y.push(255&b),Y.push(b>>8&255),Y.push(b>>16&255),Y.push(b>>24&255)}function h(Y,b){var C=b>>24,R=b>>16,q=b>>8,A=b;Y.push(255&A),Y.push(255&q),Y.push(255&R),Y.push(255&C)}function e(Y,b){var C=Math.floor(b/Math.pow(2,32));h(Y,b>>>0),h(Y,C)}function H(Y,b){var C=b/Math.pow(2,32)|0;h(Y,b>>>0),h(Y,C)}function i(Y,b){V(Y,b)}function W(Y,b){k(Y,b)}var s=new Int32Array(2),D=new Float32Array(s.buffer),d=new Float64Array(s.buffer);function V(Y,b){D[0]=b,G(Y,s[0])}function k(Y,b){d[0]=b,G(Y,s[0]),G(Y,s[1])}function x(Y,b){return J(Y,b?1:0)}function a(Y,b){b||(b="");var C=P(b),R=0;if(C<32)Y.push(160|C),R=1;else if(C<256)Y.push(217),J(Y,C),R=2;else if(C<65536)Y.push(218),o(Y,C),R=3;else{if(!(C<4294967296))throw new Error("String too long");Y.push(219),h(Y,C),R=5}return v(Y,Y.length,b),R+C}function M(Y,b){return isNaN(b)?M(Y,0):isFinite(b)?b!==(0|b)?(Y.push(203),k(Y,b),9):b>=0?b<128?(J(Y,b),1):b<256?(Y.push(204),J(Y,b),2):b<65536?(Y.push(205),o(Y,b),3):b<4294967296?(Y.push(206),h(Y,b),5):(Y.push(207),H(Y,b),9):b>=-32?(Y.push(224|b+32),1):b>=-128?(Y.push(208),z(Y,b),2):b>=-32768?(Y.push(209),U(Y,b),3):b>=-2147483648?(Y.push(210),G(Y,b),5):(Y.push(211),e(Y,b),9):M(Y,b>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var K=Object.freeze({__proto__:null,utf8Write:v,int8:z,uint8:J,int16:U,uint16:o,int32:G,uint32:h,int64:e,uint64:H,float32:i,float64:W,writeFloat32:V,writeFloat64:k,boolean:x,string:a,number:M});function f(Y,b,C){for(var R="",q=0,A=b,E=b+C;A<E;A++){var B=Y[A];0!==(128&B)?192!==(224&B)?224!==(240&B)?240!==(248&B)?console.error("Invalid byte "+B.toString(16)):(q=(7&B)<<18|(63&Y[++A])<<12|(63&Y[++A])<<6|63&Y[++A])>=65536?(q-=65536,R+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):R+=String.fromCharCode(q):R+=String.fromCharCode((15&B)<<12|(63&Y[++A])<<6|63&Y[++A]):R+=String.fromCharCode((31&B)<<6|63&Y[++A]):R+=String.fromCharCode(B)}return R}function Z(Y,b){return YY(Y,b)<<24>>24}function YY(Y,b){return Y[b.offset++]}function bY(Y,b){return CY(Y,b)<<16>>16}function CY(Y,b){return Y[b.offset++]|Y[b.offset++]<<8}function RY(Y,b){return Y[b.offset++]|Y[b.offset++]<<8|Y[b.offset++]<<16|Y[b.offset++]<<24}function qY(Y,b){return RY(Y,b)>>>0}function AY(Y,b){return yY(Y,b)}function EY(Y,b){return SY(Y,b)}function BY(Y,b){var C=qY(Y,b);return RY(Y,b)*Math.pow(2,32)+C}function gY(Y,b){var C=qY(Y,b);return qY(Y,b)*Math.pow(2,32)+C}var rY=new Int32Array(2),OY=new Float32Array(rY.buffer),FY=new Float64Array(rY.buffer);function yY(Y,b){return rY[0]=RY(Y,b),OY[0]}function SY(Y,b){return rY[0]=RY(Y,b),rY[1]=RY(Y,b),FY[0]}function nY(Y,b){return YY(Y,b)>0}function tY(Y,b){var C,R=Y[b.offset++];R<192?C=31&R:217===R?C=YY(Y,b):218===R?C=CY(Y,b):219===R&&(C=qY(Y,b));var q=f(Y,b.offset,C);return b.offset+=C,q}function IY(Y,b){var C=Y[b.offset];return C<192&&C>160||217===C||218===C||219===C}function wY(Y,b){var C=Y[b.offset++];return C<128?C:202===C?yY(Y,b):203===C?SY(Y,b):204===C?YY(Y,b):205===C?CY(Y,b):206===C?qY(Y,b):207===C?gY(Y,b):208===C?Z(Y,b):209===C?bY(Y,b):210===C?RY(Y,b):211===C?BY(Y,b):C>223?-1*(255-C+1):void 0}function QY(Y,b){var C=Y[b.offset];return C<128||C>=202&&C<=211}function NY(Y,b){return Y[b.offset]<160}function pY(Y,b){return Y[b.offset-1]===E&&(Y[b.offset]<128||Y[b.offset]>=202&&Y[b.offset]<=211)}var mb=Object.freeze({__proto__:null,int8:Z,uint8:YY,int16:bY,uint16:CY,int32:RY,uint32:qY,float32:AY,float64:EY,int64:BY,uint64:gY,readFloat32:yY,readFloat64:SY,boolean:nY,string:tY,stringCheck:IY,number:wY,numberCheck:QY,arrayCheck:NY,switchStructureCheck:pY}),LY=function(){function b(Y){var b=this;this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Y&&Y.forEach((function(Y){return b.add(Y)}))}return b.prototype.Og=function(b,C){return void 0===C&&(C=!0),r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.ADD,b,C?this.$items:void 0)},b.prototype.Ab=function(b){return r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.REPLACE,b)},b.is=function(Y){return void 0!==Y.collection},b.prototype.add=function(Y){var b=this.$refId++;return void 0!==Y.$changes&&Y.$changes.setParent(this,this.$changes.root,b),this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,Y),this.$changes.change(b),b},b.prototype.at=function(Y){var b=Array.from(this.$items.keys())[Y];return this.$items.get(b)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(Y){for(var b,C,R=this.$items.entries();(C=R.next())&&!C.done;)if(Y===C.value[1]){b=C.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&O.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:Y.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(Y){return Array.from(this.$items.values()).some((function(b){return b===Y}))},b.prototype.forEach=function(Y){var b=this;this.$items.forEach((function(C,R,q){return Y(C,R,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(Y,b){this.$indexes.set(Y,b)},b.prototype.getIndex=function(Y){return this.$indexes.get(Y)},b.prototype.getByIndex=function(Y){return this.$items.get(this.$indexes.get(Y))},b.prototype.deleteByIndex=function(Y){var b=this.$indexes.get(Y);this.$items.delete(b),this.$indexes.delete(Y)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var Y=[];return this.forEach((function(b,C){Y.push("function"===typeof b.toJSON?b.toJSON():b)})),Y},b.prototype.clone=function(Y){var C;return Y?C=Object.assign(new b,this):(C=new b,this.forEach((function(Y){Y.$changes?C.add(Y.clone()):C.add(Y)}))),C},b}(),uY=function(){function b(Y){var b=this;this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Y&&Y.forEach((function(Y){return b.add(Y)}))}return b.prototype.Og=function(b,C){return void 0===C&&(C=!0),r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.ADD,b,C?this.$items:void 0)},b.prototype.Ab=function(b){return r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.REPLACE,b)},b.is=function(Y){return void 0!==Y.set},b.prototype.add=function(b){var C,R;if(this.has(b))return!1;var q=this.$refId++;void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,q);var A=null!==(R=null===(C=this.$changes.indexes[q])||void 0===C?void 0:C.op)&&void 0!==R?R:Y.OPERATION.ADD;return this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,b),this.$changes.change(q,A),q},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(Y){for(var b,C,R=this.$items.entries();(C=R.next())&&!C.done;)if(Y===C.value[1]){b=C.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&O.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:Y.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(Y){for(var b,C=this.$items.values(),R=!1;(b=C.next())&&!b.done;)if(Y===b.value){R=!0;break}return R},b.prototype.forEach=function(Y){var b=this;this.$items.forEach((function(C,R,q){return Y(C,R,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(Y,b){this.$indexes.set(Y,b)},b.prototype.getIndex=function(Y){return this.$indexes.get(Y)},b.prototype.getByIndex=function(Y){return this.$items.get(this.$indexes.get(Y))},b.prototype.deleteByIndex=function(Y){var b=this.$indexes.get(Y);this.$items.delete(b),this.$indexes.delete(Y)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var Y=[];return this.forEach((function(b,C){Y.push("function"===typeof b.toJSON?b.toJSON():b)})),Y},b.prototype.clone=function(Y){var C;return Y?C=Object.assign(new b,this):(C=new b,this.forEach((function(Y){Y.$changes?C.add(Y.clone()):C.add(Y)}))),C},b}(),cY=function(){function Y(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return Y.prototype.addRefId=function(Y){this.refIds.has(Y)||(this.refIds.add(Y),this.containerIndexes.set(Y,new Set))},Y.get=function(b){return void 0===b.$filterState&&(b.$filterState=new Y),b.$filterState},Y}(),lY=function(){function Y(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return Y.prototype.getNextUniqueId=function(){return this.nextUniqueId++},Y.prototype.addRef=function(Y,b,C){void 0===C&&(C=!0),this.refs.set(Y,b),C&&(this.refCounts[Y]=(this.refCounts[Y]||0)+1)},Y.prototype.removeRef=function(Y){this.refCounts[Y]=this.refCounts[Y]-1,this.deletedRefs.add(Y)},Y.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},Y.prototype.garbageCollectDeletedRefs=function(){var Y=this;this.deletedRefs.forEach((function(b){if(!(Y.refCounts[b]>0)){var C=Y.refs.get(b);if(C instanceof zY)for(var R in C._definition.schema)"string"!==typeof C._definition.schema[R]&&C[R]&&C[R].$changes&&Y.removeRef(C[R].$changes.refId);else{var q=C.$changes.parent._definition,A=q.schema[q.fieldsByIndex[C.$changes.parentIndex]];"function"===typeof Object.values(A)[0]&&Array.from(C.values()).forEach((function(b){return Y.removeRef(b.$changes.refId)}))}Y.refs.delete(b),delete Y.refCounts[b]}})),this.deletedRefs.clear()},Y}(),XY=function(Y){function b(){return null!==Y&&Y.apply(this,arguments)||this}return C(b,Y),b}(Error);function jY(Y,b,C,R){var q,A=!1;switch(b){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":q="number",isNaN(Y)&&console.log('trying to encode "NaN" in '.concat(C.constructor.name,"#").concat(R));break;case"string":q="string",A=!0;break;case"boolean":return}if(typeof Y!==q&&(!A||A&&null!==Y)){var E="'".concat(JSON.stringify(Y),"'").concat(Y&&Y.constructor&&" (".concat(Y.constructor.name,")")||"");throw new XY("a '".concat(q,"' was expected, but ").concat(E," was provided in ").concat(C.constructor.name,"#").concat(R))}}function TY(Y,b,C,R){if(!(Y instanceof b))throw new XY("a '".concat(b.name,"' was expected, but '").concat(Y.constructor.name,"' was provided in ").concat(C.constructor.name,"#").concat(R))}function PY(Y,b,C,R,q){jY(C,Y,R,q);var A=K[Y];if(!A)throw new XY("a '".concat(Y,"' was expected, but ").concat(C," was provided in ").concat(R.constructor.name,"#").concat(q));A(b,C)}function vY(Y,b,C){return mb[Y](b,C)}var zY=function(){function b(){for(var Y=[],b=0;b<arguments.length;b++)Y[b]=arguments[b];Object.defineProperties(this,{$changes:{value:new g(this,void 0,new lY),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var C=this._definition.descriptors;C&&Object.defineProperties(this,C),Y[0]&&this.assign(Y[0])}return b.onError=function(Y){console.error(Y)},b.is=function(Y){return Y._definition&&void 0!==Y._definition.schema},b.prototype.onChange=function(b){return r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.REPLACE,b)},b.prototype.Ab=function(b){return r(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.DELETE,b)},b.prototype.assign=function(Y){return Object.assign(this,Y),this},Object.defineProperty(b.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),b.prototype.setDirty=function(Y,b){this.$changes.change(Y,b)},b.prototype.listen=function(Y,b,C){var R=this;return void 0===C&&(C=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[Y]||(this.$callbacks[Y]=[]),this.$callbacks[Y].push(b),C&&void 0!==this[Y]&&b(this[Y],void 0),function(){return F(R.$callbacks[Y],R.$callbacks[Y].indexOf(b))}},b.prototype.decode=function(C,R,q){var A;void 0===R&&(R={offset:0}),void 0===q&&(q=this);var B=[],g=this.$changes.root,r=C.length,O=0;for(g.refs.set(O,this);R.offset<r;){var F=C[R.offset++];if(F!=E){var y=q.$changes,S=void 0!==q._definition,t=S?F>>6<<6:F;if(t!==Y.OPERATION.CLEAR){var w=S?F%(t||255):wY(C,R),Q=S?q._definition.fieldsByIndex[w]:"",p=y.getType(w),mY=void 0,L=void 0,u=void 0;if(S?L=q["_".concat(Q)]:(L=q.getByIndex(w),(t&Y.OPERATION.ADD)===Y.OPERATION.ADD?(u=q instanceof I?tY(C,R):w,q.setIndex(w,u)):u=q.getIndex(w)),(t&Y.OPERATION.DELETE)===Y.OPERATION.DELETE&&(t!==Y.OPERATION.DELETE_AND_ADD&&q.deleteByIndex(w),L&&L.$changes&&g.removeRef(L.$changes.refId),mY=null),void 0!==Q){if(t===Y.OPERATION.DELETE);else if(b.is(p)){var c=wY(C,R);if(mY=g.refs.get(c),t!==Y.OPERATION.REPLACE){var l=this.getSchemaType(C,R,p);mY||((mY=this.createTypeInstance(l)).$changes.refId=c,L&&(mY.$callbacks=L.$callbacks,L.$changes.refId&&c!==L.$changes.refId&&g.removeRef(L.$changes.refId))),g.addRef(c,mY,mY!==L)}}else if("string"===typeof p)mY=vY(p,C,R);else{var X=N(Object.keys(p)[0]),j=wY(C,R),T=g.refs.has(j)?L||g.refs.get(j):new X.constructor;if((mY=T.clone(!0)).$changes.refId=j,L&&(mY.$callbacks=L.$callbacks,L.$changes.refId&&j!==L.$changes.refId)){g.removeRef(L.$changes.refId);for(var P=L.entries(),v=void 0;(v=P.next())&&!v.done;){var z=(A=v.value)[0],J=A[1];B.push({refId:j,op:Y.OPERATION.DELETE,field:z,value:void 0,previousValue:J})}}g.addRef(j,mY,T!==L)}if(null!==mY&&void 0!==mY)if(mY.$changes&&mY.$changes.setParent(y.ref,y.root,w),q instanceof b)q[Q]=mY;else if(q instanceof I)z=u,q.$items.set(z,mY),q.$changes.allChanges.add(w);else if(q instanceof n)q.setAt(w,mY);else if(q instanceof LY){var U=q.add(mY);q.setIndex(w,U)}else q instanceof uY&&!1!==(U=q.add(mY))&&q.setIndex(w,U);L!==mY&&B.push({refId:O,op:t,field:Q,dynamicIndex:u,value:mY,previousValue:L})}else{console.warn("@colyseus/schema: definition mismatch");for(var o={offset:R.offset};R.offset<r&&(!pY(C,R)||(o.offset=R.offset+1,!g.refs.has(wY(C,o))));)R.offset++}}else q.clear(B)}else{O=wY(C,R);var G=g.refs.get(O);if(!G)throw new Error('"refId" not found: '.concat(O));q=G}}return this._triggerChanges(B),g.garbageCollectDeletedRefs(),B},b.prototype.encode=function(C,R,q){void 0===C&&(C=!1),void 0===R&&(R=[]),void 0===q&&(q=!1);for(var A=this.$changes,B=new WeakSet,g=[A],r=1,O=0;O<r;O++){var F=g[O],y=F.ref,S=y instanceof b;F.ensureRefId(),B.add(F),F!==A&&(F.changed||C)&&(J(R,E),M(R,F.refId));for(var n=C?Array.from(F.allChanges):Array.from(F.changes.values()),t=0,w=n.length;t<w;t++){var Q=C?{op:Y.OPERATION.ADD,index:n[t]}:n[t],p=Q.index,mY=S?y._definition.fieldsByIndex&&y._definition.fieldsByIndex[p]:p,L=R.length;if(Q.op!==Y.OPERATION.TOUCH)if(S)J(R,p|Q.op);else{if(J(R,Q.op),Q.op===Y.OPERATION.CLEAR)continue;M(R,p)}if(S||(Q.op&Y.OPERATION.ADD)!=Y.OPERATION.ADD||y instanceof I&&a(R,F.ref.$indexes.get(p)),Q.op!==Y.OPERATION.DELETE){var u=F.getType(p),c=F.getValue(p);if(c&&c.$changes&&!B.has(c.$changes)&&(g.push(c.$changes),c.$changes.ensureRefId(),r++),Q.op!==Y.OPERATION.TOUCH){if(b.is(u))TY(c,u,y,mY),M(R,c.$changes.refId),(Q.op&Y.OPERATION.ADD)===Y.OPERATION.ADD&&this.tryEncodeTypeId(R,u,c.constructor);else if("string"===typeof u)PY(u,R,c,y,mY);else{var l=N(Object.keys(u)[0]);TY(y["_".concat(mY)],l.constructor,y,mY),M(R,c.$changes.refId)}q&&F.cache(p,R.slice(L))}}}C||q||F.discard()}return R},b.prototype.encodeAll=function(Y){return this.encode(!0,[],Y)},b.prototype.applyFilters=function(C,R){var q,A;void 0===R&&(R=!1);for(var B=this,g=new Set,r=cY.get(C),O=[this.$changes],F=1,y=[],S=function(S){var n=O[S];if(g.has(n.refId))return"continue";var t=n.ref,w=t instanceof b;J(y,E),M(y,n.refId);var Q=r.refIds.has(n),N=R||!Q;r.addRefId(n);var p=r.containerIndexes.get(n),mY=N?Array.from(n.allChanges):Array.from(n.changes.values());!R&&w&&t._definition.indexesWithFilters&&t._definition.indexesWithFilters.forEach((function(b){!p.has(b)&&n.allChanges.has(b)&&(N?mY.push(b):mY.push({op:Y.OPERATION.ADD,index:b}))}));for(var L=0,u=mY.length;L<u;L++){var c=N?{op:Y.OPERATION.ADD,index:mY[L]}:mY[L];if(c.op!==Y.OPERATION.CLEAR){var l=c.index;if(c.op!==Y.OPERATION.DELETE){var X=n.getValue(l),j=n.getType(l);if(w){if((T=t._definition.filters&&t._definition.filters[l])&&!T.call(t,C,X,B)){X&&X.$changes&&g.add(X.$changes.refId);continue}}else{var T,P=n.parent;if((T=n.getChildrenFilter())&&!T.call(P,C,t.$indexes.get(l),X,B)){X&&X.$changes&&g.add(X.$changes.refId);continue}}if(X.$changes&&(O.push(X.$changes),F++),c.op!==Y.OPERATION.TOUCH)if(c.op===Y.OPERATION.ADD||w)y.push.apply(y,null!==(q=n.caches[l])&&void 0!==q?q:[]),p.add(l);else if(p.has(l))y.push.apply(y,null!==(A=n.caches[l])&&void 0!==A?A:[]);else{if(p.add(l),J(y,Y.OPERATION.ADD),M(y,l),t instanceof I){var v=n.ref.$indexes.get(l);a(y,v)}X.$changes?M(y,X.$changes.refId):K[j](y,X)}else X.$changes&&!w&&(J(y,Y.OPERATION.ADD),M(y,l),t instanceof I&&(v=n.ref.$indexes.get(l),a(y,v)),M(y,X.$changes.refId))}else w?J(y,c.op|l):(J(y,c.op),M(y,l))}else J(y,c.op)}},n=0;n<F;n++)S(n);return y},b.prototype.clone=function(){var Y,b=new this.constructor,C=this._definition.schema;for(var R in C)"object"===typeof this[R]&&"function"===typeof(null===(Y=this[R])||void 0===Y?void 0:Y.clone)?b[R]=this[R].clone():b[R]=this[R];return b},b.prototype.toJSON=function(){var Y=this._definition.schema,b=this._definition.deprecated,C={};for(var R in Y)b[R]||null===this[R]||"undefined"===typeof this[R]||(C[R]="function"===typeof this[R].toJSON?this[R].toJSON():this["_".concat(R)]);return C},b.prototype.discardAllChanges=function(){this.$changes.discardAll()},b.prototype.getByIndex=function(Y){return this[this._definition.fieldsByIndex[Y]]},b.prototype.deleteByIndex=function(Y){this[this._definition.fieldsByIndex[Y]]=void 0},b.prototype.tryEncodeTypeId=function(Y,b,C){b._typeid!==C._typeid&&(J(Y,B),M(Y,C._typeid))},b.prototype.getSchemaType=function(Y,b,C){var R;return Y[b.offset]===B&&(b.offset++,R=this.constructor._context.get(wY(Y,b))),R||C},b.prototype.createTypeInstance=function(Y){var b=new Y;return b.$changes.root=this.$changes.root,b},b.prototype._triggerChanges=function(C){for(var R,q,A,E,B,g,r,O,F,y=new Set,S=this.$changes.root.refs,n=function(n){var t=C[n],I=t.refId,w=S.get(I),Q=w.$callbacks;if((t.op&Y.OPERATION.DELETE)===Y.OPERATION.DELETE&&t.previousValue instanceof b&&(null===(q=null===(R=t.previousValue.$callbacks)||void 0===R?void 0:R[Y.OPERATION.DELETE])||void 0===q||q.forEach((function(Y){return Y()}))),!Q)return"continue";if(w instanceof b){if(!y.has(I))try{null===(A=null===Q||void 0===Q?void 0:Q[Y.OPERATION.REPLACE])||void 0===A||A.forEach((function(Y){return Y()}))}catch(N){b.onError(N)}try{Q.hasOwnProperty(t.field)&&(null===(E=Q[t.field])||void 0===E||E.forEach((function(Y){return Y(t.value,t.previousValue)})))}catch(N){b.onError(N)}}else t.op===Y.OPERATION.ADD&&void 0===t.previousValue?null===(B=Q[Y.OPERATION.ADD])||void 0===B||B.forEach((function(Y){var b;return Y(t.value,null!==(b=t.dynamicIndex)&&void 0!==b?b:t.field)})):t.op===Y.OPERATION.DELETE?void 0!==t.previousValue&&(null===(g=Q[Y.OPERATION.DELETE])||void 0===g||g.forEach((function(Y){var b;return Y(t.previousValue,null!==(b=t.dynamicIndex)&&void 0!==b?b:t.field)}))):t.op===Y.OPERATION.DELETE_AND_ADD&&(void 0!==t.previousValue&&(null===(r=Q[Y.OPERATION.DELETE])||void 0===r||r.forEach((function(Y){var b;return Y(t.previousValue,null!==(b=t.dynamicIndex)&&void 0!==b?b:t.field)}))),null===(O=Q[Y.OPERATION.ADD])||void 0===O||O.forEach((function(Y){var b;return Y(t.value,null!==(b=t.dynamicIndex)&&void 0!==b?b:t.field)}))),t.value!==t.previousValue&&(null===(F=Q[Y.OPERATION.REPLACE])||void 0===F||F.forEach((function(Y){var b;return Y(t.value,null!==(b=t.dynamicIndex)&&void 0!==b?b:t.field)})));y.add(I)},t=0;t<C.length;t++)n(t)},b._definition=p.create(),b}();function JY(Y){for(var b=[Y.$changes],C=1,R={},q=R,A=function(Y){var C=b[Y];C.changes.forEach((function(Y){var b=C.ref,R=Y.index,A=b._definition?b._definition.fieldsByIndex[R]:b.$indexes.get(R);q[A]=C.getValue(R)}))},E=0;E<C;E++)A(E);return R}var UY={context:new L},oY=function(Y){function b(){return null!==Y&&Y.apply(this,arguments)||this}return C(b,Y),R([c("string",UY)],b.prototype,"name",void 0),R([c("string",UY)],b.prototype,"type",void 0),R([c("number",UY)],b.prototype,"referencedType",void 0),b}(zY),GY=function(Y){function b(){var b=null!==Y&&Y.apply(this,arguments)||this;return b.fields=new n,b}return C(b,Y),R([c("number",UY)],b.prototype,"id",void 0),R([c([oY],UY)],b.prototype,"fields",void 0),b}(zY),hY=function(Y){function b(){var b=null!==Y&&Y.apply(this,arguments)||this;return b.types=new n,b}return C(b,Y),b.encode=function(Y){var C=Y.constructor,R=new b;R.rootType=C._typeid;var q=function(Y,b){for(var C in b){var q=new oY;q.name=C;var A=void 0;if("string"===typeof b[C])A=b[C];else{var E=b[C],B=void 0;zY.is(E)?(A="ref",B=b[C]):"string"===typeof E[A=Object.keys(E)[0]]?A+=":"+E[A]:B=E[A],q.referencedType=B?B._typeid:-1}q.type=A,Y.fields.push(q)}R.types.push(Y)},A=C._context.types;for(var E in A){var B=new GY;B.id=Number(E),q(B,A[E]._definition.schema)}return R.encodeAll()},b.decode=function(Y,R){var q=new L,A=new b;A.decode(Y,R);var E=A.types.reduce((function(Y,b){var R=function(Y){function b(){return null!==Y&&Y.apply(this,arguments)||this}return C(b,Y),b}(zY),A=b.id;return Y[A]=R,q.add(R,A),Y}),{});A.types.forEach((function(Y){var b=E[Y.id];Y.fields.forEach((function(Y){var C;if(void 0!==Y.referencedType){var R=Y.type,A=E[Y.referencedType];if(!A){var B=Y.type.split(":");R=B[0],A=B[1]}"ref"===R?c(A,{context:q})(b.prototype,Y.name):c(((C={})[R]=A,C),{context:q})(b.prototype,Y.name)}else c(Y.type,{context:q})(b.prototype,Y.name)}))}));var B=E[A.rootType],g=new B;for(var r in B._definition.schema){var O=B._definition.schema[r];"string"!==typeof O&&(g[r]="function"===typeof O?new O:new(N(Object.keys(O)[0]).constructor))}return g},R([c([GY],UY)],b.prototype,"types",void 0),R([c("number",UY)],b.prototype,"rootType",void 0),b}(zY);Q("map",{constructor:I}),Q("array",{constructor:n}),Q("set",{constructor:uY}),Q("collection",{constructor:LY}),Y.ArraySchema=n,Y.CollectionSchema=LY,Y.Context=L,Y.MapSchema=I,Y.Reflection=hY,Y.ReflectionField=oY,Y.ReflectionType=GY,Y.Schema=zY,Y.SchemaDefinition=p,Y.SetSchema=uY,Y.decode=mb,Y.defineTypes=T,Y.deprecated=j,Y.dumpChanges=JY,Y.encode=K,Y.filter=l,Y.filterChildren=X,Y.hasFilter=mY,Y.registerType=Q,Y.type=c,Object.defineProperty(Y,"__esModule",{value:!0})}(b)},14985:function(Y,b,C){var R,q,A;function E(){const Y=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(E=function(){return Y})()}function B(Y,b){const C=E();return(B=function(Y,b){return C[Y-=212]})(Y,b)}Y=C.nmd(Y),function(Y){const b=B,C=Y();for(;;)try{if(368192===parseInt(b(328))/1+parseInt(b(379))/2*(-parseInt(b(226))/3)+parseInt(b(348))/4*(parseInt(b(264))/5)+parseInt(b(224))/6*(-parseInt(b(223))/7)+-parseInt(b(345))/8*(parseInt(b(325))/9)+-parseInt(b(215))/10+-parseInt(b(275))/11*(-parseInt(b(383))/12))break;C.push(C.shift())}catch(R){C.push(C.shift())}}(E),function(E,g){const r=B;r(262)==typeof b&&"object"==r(262)?Y[r(337)]=g():"function"==r(237)&&C.amdD[r(400)]?(q=[],void 0===(A="function"===typeof(R=g)?R.apply(b,q):R)||(Y.exports=A)):r(262)==typeof b?b[r(277)]=g():E[r(277)]=g()}(this,(()=>(()=>{var Y={646:function(Y){Y[B(337)]=function(){"use strict";function Y(Y){const b=B;for(var C=1;C<arguments[b(302)];C++){var R=arguments[C];for(var q in R)Y[q]=R[q]}return Y}return function b(C,R){const q=B;function A(b,q,A){const E=B;if(E(363)!=typeof document){"number"==typeof(A=Y({},R,A))[E(278)]&&(A[E(278)]=new Date(Date[E(235)]()+864e5*A[E(278)])),A[E(278)]&&(A[E(278)]=A[E(278)][E(351)]()),b=encodeURIComponent(b).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[E(320)](/[()]/g,escape);var g="";for(var r in A)A[r]&&(g+="; "+r,!0!==A[r]&&(g+="="+A[r][E(335)](";")[0]));return document[E(295)]=b+"="+C[E(349)](q,b)+g}}return Object[q(260)]({set:A,get:function(Y){const b=B;if(b(363)!=typeof document&&(!arguments[b(302)]||Y)){for(var R=document.cookie?document[b(295)][b(335)]("; "):[],q={},A=0;A<R[b(302)];A++){var E=R[A][b(335)]("="),g=E[b(396)](1)[b(323)]("=");try{var r=decodeURIComponent(E[0]);if(q[r]=C[b(366)](g,r),Y===r)break}catch(O){}}return Y?q[Y]:q}},remove:function(b,C){A(b,"",Y({},C,{expires:-1}))},withAttributes:function(C){return b(this[q(359)],Y({},this.attributes,C))},withConverter:function(C){const R=q;return b(Y({},this[R(359)],C),this[R(398)])}},{attributes:{value:Object[q(315)](R)},converter:{value:Object.freeze(C)}})}({read:function(Y){const b=B;return'"'===Y[0]&&(Y=Y[b(396)](1,-1)),Y.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(Y){const b=B;return encodeURIComponent(Y)[b(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(Y,b,C)=>{"use strict";const R=B;Object[R(228)](b,R(220),{value:!0}),b[R(382)]=void 0;const q=C(284);class A{static[R(218)](){const Y=R;console[Y(395)](Y(212)),window.addEventListener(Y(297),A[Y(258)])}static onBeforeUnload(){const Y=R;q[Y(313)][Y(236)]()}}b[R(382)]=A},719:(Y,b,C)=>{"use strict";const R=B;Object.defineProperty(b,"__esModule",{value:!0}),b[R(290)]=void 0;const q=C(284),A=C(878);b[R(290)]=class{static[R(307)](Y,b,C){const A=R;q.ByteBrewCore[A(307)](Y,b,C)}static[R(339)](){const Y=R;return q[Y(313)][Y(393)]}static[R(239)](Y,b){const C=R;void 0===b?q.ByteBrewCore[C(239)](Y):C(240)==typeof b?q.ByteBrewCore[C(247)](Y,b):C(270)==typeof b?q[C(313)][C(243)](Y,b):C(262)==typeof b&&q[C(313)][C(286)](Y,b)}static loadRemoteConfigs(Y){const b=R;A.RemoteConfigHandler[b(282)](Y)}static[R(233)](Y,b){const C=R;return A[C(272)][C(233)](Y,b)}static[R(369)](){const Y=R;return A[Y(272)][Y(369)]()}static[R(391)](){const Y=R;q[Y(313)][Y(391)]()}static[R(384)](){const Y=R;q[Y(313)][Y(384)]()}static[R(213)](){return q.ByteBrewCore.userID}}},441:function(Y,b,C){"use strict";const R=B;var q=this&&this[R(329)]||function(Y){return Y&&Y[R(220)]?Y:{default:Y}};Object[R(228)](b,R(220),{value:!0}),b[R(397)]=void 0;const A=q(C(646)),E=C(429);class g{static[R(332)](){const Y=R,b=A[Y(334)][Y(311)](g[Y(231)]);return b?{userID:b,isNewUser:!1,hasSuccessfullyInitialized:g[Y(394)]()}:{userID:g.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[R(230)](){const Y=R,b=(0,E.v4)();return A.default[Y(242)](g[Y(231)],b,{expires:365}),b}static setTrackingSettingsCookie(Y){const b=R,C=b(Y?248:367);A[b(334)].set(g[b(225)],C,{expires:365})}static[R(314)](){const Y=R,b=A[Y(334)][Y(311)](g.trackingSettingsIDCookieKey);return!b||"true"===b}static[R(356)](){return g.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const Y=R,b=A.default[Y(311)](g[Y(231)]);b&&A.default[Y(242)](g.userHasInitializedSuccessfullyCookieKey,b,{expires:365})}static[R(330)](){const Y=R,b=A[Y(334)][Y(311)](g[Y(326)]),C=A[Y(334)][Y(311)](g[Y(231)]);return!(!b||!C)&&b===C}static hasUserInitialized(){return g[R(330)]()}}b.ByteBrewCookieManager=g,g.userIDCookieKey=R(361),g.trackingSettingsIDCookieKey=R(357),g[R(326)]="bb_u_h_init"},284:(Y,b,C)=>{"use strict";const R=B;Object[R(228)](b,R(220),{value:!0}),b[R(313)]=void 0;const q=C(441),A=C(797),E=C(334),g=C(429),r=C(147);class O{static[R(246)](){const Y=R;let b=navigator[Y(281)][Y(335)]("-");return b.length<2?"??":b[b.length-1]||"??"}static[R(307)](Y,b,C){const A=R;if(O[A(393)])return;if(console[A(395)]("ByteBrew: Starting Initialization"),!Y||!b)return void console.log(A(256));if(O[A(221)]=q[A(397)][A(356)](),!O.trackingEnabled)return void console[A(395)](A(362));O[A(399)]=Y,O[A(249)]=b,O[A(336)]=C,O.sessionID=(0,g.v4)(),O.sessionKey="",O[A(300)]=r[A(305)],O.language=navigator[A(281)],O[A(385)]=O[A(246)]();const B=q[A(397)][A(332)]();O[A(308)]=B[A(308)],B.isNewUser||!B[A(293)]?O.createNewUserEvent():O[A(344)](),O[A(331)]=new Date,E[A(382)][A(218)]()}static reinitializeByteBrew(){const Y=R;console[Y(395)](Y(306)),O.initializeByteBrew(O[Y(399)],O[Y(249)],O[Y(336)])}static[R(387)](Y){const b=R;O[b(214)]=Y,O[b(393)]=!0,O.hasBeenInitializedWhilePageOpen=!0,q[b(397)][b(296)](),console[b(395)](b(386))}static[R(301)](){const Y=R;O[Y(303)]&&(console.log(Y(341)),this[Y(217)]())}static[R(372)](){return O[R(393)]&&O.trackingEnabled}static getScreenResolution(){return window[R(227)]+"x"+window.innerHeight}static[R(241)](){const Y=R;return{game_id:O[Y(399)],user_id:O[Y(308)],session_id:O[Y(318)],session_key:O.sessionKey,platform:O.platform}}static[R(244)](){const Y=R;return Object[Y(219)](Object[Y(219)]({},O[Y(241)]()),{version_number:O[Y(336)],sdk_version:O[Y(300)],deviceScreenSize:O[Y(280)](),tracking_enabled:O[Y(221)]})}static[R(283)](Y,b){const C=R;A.ByteBrewWebRequestor[C(380)](Y,b).then((Y=>{const b=C;if(Y&&Y.ok){const C=Y.headers.get(b(354));C?O.onInitializationSuccessful(C):console[b(395)](b(381))}else console[b(395)](b(232)+(Y?Y[b(259)]:"No Response"))}))}static createUserEvent(){const Y=R;if(!O[Y(221)])return;console.log(Y(353));let b={eventType:"game_open",userLocale:O[Y(281)]};const C=Object[Y(219)](Object[Y(219)]({},O[Y(244)]()),{category:Y(269),geo:O[Y(385)],externalData:b});O[Y(283)](A.ByteBrewWebRequestor[Y(238)],C)}static[R(285)](){const Y=R;if(!O[Y(221)])return;console[Y(395)](Y(352));let b={eventType:Y(309),userLocale:O[Y(281)]};const C=Object.assign(Object.assign({},O.getFullEventObject()),{category:Y(269),geo:O[Y(385)],externalData:b});O[Y(283)](A[Y(265)][Y(238)],C)}static endCurrentSession(){const Y=R;if(!O[Y(372)]())return;O[Y(393)]=!1,console.log(Y(350));const b=new Date;let C={sessionLength:Math[Y(287)]((b[Y(253)]()-O[Y(331)].getTime())/1e3)[Y(251)]()};const q=Object[Y(219)](Object[Y(219)]({},O[Y(244)]()),{category:Y(401),externalData:C});A.ByteBrewWebRequestor[Y(380)](A[Y(265)][Y(238)],q)}static[R(252)](Y){const b=R;let C="";if(!Y)return C;for(const[R,q]of Object.entries(Y))C+=R+"="+q+";";return C[b(302)]>0&&(C=C[b(396)](0,-1)),C}static[R(368)](Y,b){const C=R;if(!O.canSendData())return;console[C(395)](C(374)+Y);let q={eventType:Y};b&&(q=Object.assign(Object[C(219)]({},q),{value:"object"==typeof b?O[C(252)](b):b[C(251)]()}));const E=Object[C(219)](Object[C(219)]({},O[C(244)]()),{category:"custom",externalData:q});A.ByteBrewWebRequestor[C(380)](A[C(265)][C(238)],E)[C(378)]((Y=>{const b=C;Y&&Y.ok?console.log(b(274)):console[b(395)](b(294)+(Y?Y.status:b(267)))}))}static[R(239)](Y){O[R(368)](Y,null)}static[R(247)](Y,b){O.sendCustomEvent(Y,b)}static newCustomEventWithNumber(Y,b){O.sendCustomEvent(Y,b)}static[R(286)](Y,b){O[R(368)](Y,b)}static[R(391)](){const Y=R;console[Y(395)]("ByteBrew: Restarting Tracking"),O[Y(221)]=!0,q[Y(397)][Y(360)](!0),O[Y(217)]()}static[R(384)](){const Y=R;console[Y(395)](Y(257)),O[Y(221)]=!1,q.ByteBrewCookieManager[Y(360)](!1)}}b[R(313)]=O,O[R(393)]=!1,O[R(303)]=!1,O[R(261)]="Web"},797:function(Y,b,C){"use strict";const R=B;var q=this&&this[R(342)]||function(Y,b,C,R){return new(C||(C=Promise))((function(q,A){const E=B;function g(Y){try{O(R.next(Y))}catch(b){A(b)}}function r(Y){try{O(R.throw(Y))}catch(b){A(b)}}function O(Y){const b=B;var R;Y.done?q(Y.value):(R=Y[b(234)],R instanceof C?R:new C((function(Y){Y(R)})))[b(378)](g,r)}O((R=R[E(222)](Y,b||[]))[E(255)]())}))};Object[R(228)](b,R(220),{value:!0}),b[R(265)]=void 0;const A=C(284);class E{static sendBasicRequest(Y,b){return q(this,void 0,void 0,(function*(){const C=B;try{const R={method:"POST",mode:C(358),headers:{Accept:C(304),"Content-Type":C(289),"sdk-key":A[C(313)][C(249)]},body:JSON.stringify(b),keepalive:!0};return yield E[C(298)](Y,R)}catch(R){console[C(284)](R)}}))}static[R(343)](Y){return q(this,void 0,void 0,(function*(){const b=B;try{const C={method:b(392),mode:"cors",headers:{Accept:b(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":A[b(313)][b(249)],user_id:A[b(313)][b(308)]}};return yield E[b(298)](Y,C)}catch(C){console[b(284)](C)}}))}static[R(298)](Y,b){return q(this,void 0,void 0,(function*(){const C=B;try{const R=yield fetch(Y,b);return R.ok||console[C(284)]("Request failed with status "+R[C(259)]),R}catch(R){console[C(284)](R)}}))}}b.ByteBrewWebRequestor=E,E[R(238)]=R(390),E[R(268)]=R(389)},878:(Y,b,C)=>{"use strict";const R=B;Object.defineProperty(b,R(220),{value:!0}),b[R(272)]=void 0;const q=C(284),A=C(797);class E{static[R(292)](Y){E.remoteConfigs=Y}static hasRemoteConfigsBeenSet(){return!!E[R(216)]}static loadRemoteConfigs(Y){const b=R;A[b(265)][b(343)](A[b(265)][b(268)]+q[b(313)].appID)[b(378)]((C=>{const R=b;C&&C.ok?C[R(371)]()[R(378)]((b=>{const C=R;let q=null;try{q=new Map(Object[C(370)](JSON[C(250)](b))),console[C(395)](C(266))}catch(A){q=null,console[C(284)](C(388))}finally{E[C(292)](q),q&&Y(q)}})):C?console.error(R(322)+(C?C[R(259)]:R(267))+" "+(C?C.statusText:"")):console[R(284)](R(279))}))}static[R(233)](Y,b){const C=R;return E[C(369)]()&&E.remoteConfigs[C(364)](Y)?E[C(216)][C(311)](Y):b}}b[R(272)]=E,E[R(216)]=null},429:(Y,b,C)=>{"use strict";const R=B;Object.defineProperty(b,R(220),{value:!0}),Object[R(228)](b,R(319),{enumerable:!0,get:function(){return r[R(334)]}}),Object[R(228)](b,R(250),{enumerable:!0,get:function(){return S.default}}),Object[R(228)](b,R(333),{enumerable:!0,get:function(){return y[R(334)]}}),Object.defineProperty(b,"v1",{enumerable:!0,get:function(){return q[R(334)]}}),Object[R(228)](b,"v3",{enumerable:!0,get:function(){return A[R(334)]}}),Object[R(228)](b,"v4",{enumerable:!0,get:function(){return E[R(334)]}}),Object[R(228)](b,"v5",{enumerable:!0,get:function(){return g[R(334)]}}),Object.defineProperty(b,R(310),{enumerable:!0,get:function(){return F[R(334)]}}),Object[R(228)](b,"version",{enumerable:!0,get:function(){return O[R(334)]}});var q=n(C(990)),A=n(C(237)),E=n(C(355)),g=n(C(764)),r=n(C(314)),O=n(C(464)),F=n(C(435)),y=n(C(8)),S=n(C(222));function n(Y){return Y&&Y[R(220)]?Y:{default:Y}}},163:(Y,b)=>{"use strict";const C=B;function R(Y){return 14+(Y+64>>>9<<4)+1}function q(Y,b){const C=(65535&Y)+(65535&b);return(Y>>16)+(b>>16)+(C>>16)<<16|65535&C}function A(Y,b,C,R,A,E){return q((B=q(q(b,Y),q(R,E)))<<(g=A)|B>>>32-g,C);var B,g}function E(Y,b,C,R,q,E,B){return A(b&C|~b&R,Y,b,q,E,B)}function g(Y,b,C,R,q,E,B){return A(b&R|C&~R,Y,b,q,E,B)}function r(Y,b,C,R,q,E,B){return A(b^C^R,Y,b,q,E,B)}function O(Y,b,C,R,q,E,B){return A(C^(b|~R),Y,b,q,E,B)}Object.defineProperty(b,C(220),{value:!0}),b[C(334)]=void 0;b.default=function(Y){const b=C;if(b(240)==typeof Y){const C=unescape(encodeURIComponent(Y));Y=new Uint8Array(C[b(302)]);for(let R=0;R<C[b(302)];++R)Y[R]=C[b(312)](R)}return function(Y){const C=b,R=[],q=32*Y.length,A=C(276);for(let b=0;b<q;b+=8){const q=Y[b>>5]>>>b%32&255,E=parseInt(A[C(376)](q>>>4&15)+A[C(376)](15&q),16);R[C(288)](E)}return R}(function(Y,C){const A=b;Y[C>>5]|=128<<C%32,Y[R(C)-1]=C;let B=1732584193,F=-271733879,y=-1732584194,S=271733878;for(let b=0;b<Y[A(302)];b+=16){const C=B,R=F,A=y,n=S;B=E(B,F,y,S,Y[b],7,-680876936),S=E(S,B,F,y,Y[b+1],12,-389564586),y=E(y,S,B,F,Y[b+2],17,606105819),F=E(F,y,S,B,Y[b+3],22,-1044525330),B=E(B,F,y,S,Y[b+4],7,-176418897),S=E(S,B,F,y,Y[b+5],12,1200080426),y=E(y,S,B,F,Y[b+6],17,-1473231341),F=E(F,y,S,B,Y[b+7],22,-45705983),B=E(B,F,y,S,Y[b+8],7,1770035416),S=E(S,B,F,y,Y[b+9],12,-1958414417),y=E(y,S,B,F,Y[b+10],17,-42063),F=E(F,y,S,B,Y[b+11],22,-1990404162),B=E(B,F,y,S,Y[b+12],7,1804603682),S=E(S,B,F,y,Y[b+13],12,-40341101),y=E(y,S,B,F,Y[b+14],17,-1502002290),F=E(F,y,S,B,Y[b+15],22,1236535329),B=g(B,F,y,S,Y[b+1],5,-165796510),S=g(S,B,F,y,Y[b+6],9,-1069501632),y=g(y,S,B,F,Y[b+11],14,643717713),F=g(F,y,S,B,Y[b],20,-373897302),B=g(B,F,y,S,Y[b+5],5,-701558691),S=g(S,B,F,y,Y[b+10],9,38016083),y=g(y,S,B,F,Y[b+15],14,-660478335),F=g(F,y,S,B,Y[b+4],20,-405537848),B=g(B,F,y,S,Y[b+9],5,568446438),S=g(S,B,F,y,Y[b+14],9,-1019803690),y=g(y,S,B,F,Y[b+3],14,-187363961),F=g(F,y,S,B,Y[b+8],20,1163531501),B=g(B,F,y,S,Y[b+13],5,-1444681467),S=g(S,B,F,y,Y[b+2],9,-51403784),y=g(y,S,B,F,Y[b+7],14,1735328473),F=g(F,y,S,B,Y[b+12],20,-1926607734),B=r(B,F,y,S,Y[b+5],4,-378558),S=r(S,B,F,y,Y[b+8],11,-2022574463),y=r(y,S,B,F,Y[b+11],16,1839030562),F=r(F,y,S,B,Y[b+14],23,-35309556),B=r(B,F,y,S,Y[b+1],4,-1530992060),S=r(S,B,F,y,Y[b+4],11,1272893353),y=r(y,S,B,F,Y[b+7],16,-155497632),F=r(F,y,S,B,Y[b+10],23,-1094730640),B=r(B,F,y,S,Y[b+13],4,681279174),S=r(S,B,F,y,Y[b],11,-358537222),y=r(y,S,B,F,Y[b+3],16,-722521979),F=r(F,y,S,B,Y[b+6],23,76029189),B=r(B,F,y,S,Y[b+9],4,-640364487),S=r(S,B,F,y,Y[b+12],11,-421815835),y=r(y,S,B,F,Y[b+15],16,530742520),F=r(F,y,S,B,Y[b+2],23,-995338651),B=O(B,F,y,S,Y[b],6,-198630844),S=O(S,B,F,y,Y[b+7],10,1126891415),y=O(y,S,B,F,Y[b+14],15,-1416354905),F=O(F,y,S,B,Y[b+5],21,-57434055),B=O(B,F,y,S,Y[b+12],6,1700485571),S=O(S,B,F,y,Y[b+3],10,-1894986606),y=O(y,S,B,F,Y[b+10],15,-1051523),F=O(F,y,S,B,Y[b+1],21,-2054922799),B=O(B,F,y,S,Y[b+8],6,1873313359),S=O(S,B,F,y,Y[b+15],10,-30611744),y=O(y,S,B,F,Y[b+6],15,-1560198380),F=O(F,y,S,B,Y[b+13],21,1309151649),B=O(B,F,y,S,Y[b+4],6,-145523070),S=O(S,B,F,y,Y[b+11],10,-1120210379),y=O(y,S,B,F,Y[b+2],15,718787259),F=O(F,y,S,B,Y[b+9],21,-343485551),B=q(B,C),F=q(F,R),y=q(y,A),S=q(S,n)}return[B,F,y,S]}(function(Y){const C=b;if(0===Y[C(302)])return[];const q=8*Y[C(302)],A=new Uint32Array(R(q));for(let b=0;b<q;b+=8)A[b>>5]|=(255&Y[b/8])<<b%32;return A}(Y),8*Y[b(302)]))}},790:(Y,b)=>{"use strict";const C=B;Object[C(228)](b,C(220),{value:!0}),b[C(334)]=void 0;var R={randomUUID:C(363)!=typeof crypto&&crypto[C(273)]&&crypto[C(273)][C(229)](crypto)};b.default=R},314:(Y,b)=>{"use strict";const C=B;Object[C(228)](b,"__esModule",{value:!0}),b.default=void 0,b[C(334)]="00000000-0000-0000-0000-000000000000"},222:(Y,b,C)=>{"use strict";const R=B;Object.defineProperty(b,R(220),{value:!0}),b[R(334)]=void 0;var q,A=(q=C(435))&&q.__esModule?q:{default:q};b[R(334)]=function(Y){const b=R;if(!(0,A.default)(Y))throw TypeError(b(271));let C;const q=new Uint8Array(16);return q[0]=(C=parseInt(Y[b(396)](0,8),16))>>>24,q[1]=C>>>16&255,q[2]=C>>>8&255,q[3]=255&C,q[4]=(C=parseInt(Y[b(396)](9,13),16))>>>8,q[5]=255&C,q[6]=(C=parseInt(Y[b(396)](14,18),16))>>>8,q[7]=255&C,q[8]=(C=parseInt(Y[b(396)](19,23),16))>>>8,q[9]=255&C,q[10]=(C=parseInt(Y[b(396)](24,36),16))/1099511627776&255,q[11]=C/4294967296&255,q[12]=C>>>24&255,q[13]=C>>>16&255,q[14]=C>>>8&255,q[15]=255&C,q}},58:(Y,b)=>{"use strict";const C=B;Object[C(228)](b,"__esModule",{value:!0}),b[C(334)]=void 0,b[C(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(Y,b)=>{"use strict";const C=B;let R;Object[C(228)](b,"__esModule",{value:!0}),b[C(334)]=function(){const Y=C;if(!R&&(R="undefined"!=typeof crypto&&crypto[Y(254)]&&crypto.getRandomValues.bind(crypto),!R))throw new Error(Y(299));return R(q)};const q=new Uint8Array(16)},757:(Y,b)=>{"use strict";const C=B;function R(Y,b,C,R){switch(Y){case 0:return b&C^~b&R;case 1:case 3:return b^C^R;case 2:return b&C^b&R^C&R}}function q(Y,b){return Y<<b|Y>>>32-b}Object.defineProperty(b,C(220),{value:!0}),b[C(334)]=void 0;b[C(334)]=function(Y){const b=C,A=[1518500249,1859775393,2400959708,3395469782],E=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof Y){const C=unescape(encodeURIComponent(Y));Y=[];for(let R=0;R<C[b(302)];++R)Y[b(288)](C.charCodeAt(R))}else Array[b(338)](Y)||(Y=Array[b(340)][b(396)].call(Y));Y[b(288)](128);const B=Y[b(302)]/4+2,g=Math[b(375)](B/16),r=new Array(g);for(let C=0;C<g;++C){const b=new Uint32Array(16);for(let R=0;R<16;++R)b[R]=Y[64*C+4*R]<<24|Y[64*C+4*R+1]<<16|Y[64*C+4*R+2]<<8|Y[64*C+4*R+3];r[C]=b}r[g-1][14]=8*(Y[b(302)]-1)/Math.pow(2,32),r[g-1][14]=Math.floor(r[g-1][14]),r[g-1][15]=8*(Y.length-1)&4294967295;for(let C=0;C<g;++C){const Y=new Uint32Array(80);for(let b=0;b<16;++b)Y[b]=r[C][b];for(let b=16;b<80;++b)Y[b]=q(Y[b-3]^Y[b-8]^Y[b-14]^Y[b-16],1);let B=E[0],g=E[1],O=E[2],F=E[3],y=E[4];for(let C=0;C<80;++C){const E=Math[b(365)](C/20),r=q(B,5)+R(E,g,O,F)+y+A[E]+Y[C]>>>0;y=F,F=O,O=q(g,30)>>>0,g=B,B=r}E[0]=E[0]+B>>>0,E[1]=E[1]+g>>>0,E[2]=E[2]+O>>>0,E[3]=E[3]+F>>>0,E[4]=E[4]+y>>>0}return[E[0]>>24&255,E[0]>>16&255,E[0]>>8&255,255&E[0],E[1]>>24&255,E[1]>>16&255,E[1]>>8&255,255&E[1],E[2]>>24&255,E[2]>>16&255,E[2]>>8&255,255&E[2],E[3]>>24&255,E[3]>>16&255,E[3]>>8&255,255&E[3],E[4]>>24&255,E[4]>>16&255,E[4]>>8&255,255&E[4]]}},8:(Y,b,C)=>{"use strict";const R=B;Object[R(228)](b,R(220),{value:!0}),b[R(334)]=void 0,b[R(263)]=g;var q,A=(q=C(435))&&q[R(220)]?q:{default:q};const E=[];for(let B=0;B<256;++B)E[R(288)]((B+256)[R(251)](16)[R(396)](1));function g(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=R;return(E[Y[b+0]]+E[Y[b+1]]+E[Y[b+2]]+E[Y[b+3]]+"-"+E[Y[b+4]]+E[Y[b+5]]+"-"+E[Y[b+6]]+E[Y[b+7]]+"-"+E[Y[b+8]]+E[Y[b+9]]+"-"+E[Y[b+10]]+E[Y[b+11]]+E[Y[b+12]]+E[Y[b+13]]+E[Y[b+14]]+E[Y[b+15]])[C(317)]()}b[R(334)]=function(Y){const b=R,C=g(Y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,A.default)(C))throw TypeError(b(321));return C}},990:(Y,b,C)=>{"use strict";const R=B;Object.defineProperty(b,"__esModule",{value:!0}),b[R(334)]=void 0;var q,A=(q=C(319))&&q[R(220)]?q:{default:q},E=C(8);let g,r,O=0,F=0;b[R(334)]=function(Y,b,C){const q=R;let B=b&&C||0;const y=b||new Array(16);let S=(Y=Y||{}).node||g,n=void 0!==Y[q(324)]?Y[q(324)]:r;if(null==S||null==n){const b=Y[q(347)]||(Y[q(355)]||A[q(334)])();null==S&&(S=g=[1|b[0],b[1],b[2],b[3],b[4],b[5]]),null==n&&(n=r=16383&(b[6]<<8|b[7]))}let t=void 0!==Y[q(327)]?Y.msecs:Date.now(),I=void 0!==Y[q(316)]?Y.nsecs:F+1;const w=t-O+(I-F)/1e4;if(w<0&&void 0===Y[q(324)]&&(n=n+1&16383),(w<0||t>O)&&void 0===Y[q(316)]&&(I=0),I>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");O=t,F=I,r=n,t+=122192928e5;const Q=(1e4*(268435455&t)+I)%4294967296;y[B++]=Q>>>24&255,y[B++]=Q>>>16&255,y[B++]=Q>>>8&255,y[B++]=255&Q;const N=t/4294967296*1e4&268435455;y[B++]=N>>>8&255,y[B++]=255&N,y[B++]=N>>>24&15|16,y[B++]=N>>>16&255,y[B++]=n>>>8|128,y[B++]=255&n;for(let R=0;R<6;++R)y[B+R]=S[R];return b||(0,E[q(263)])(y)}},237:(Y,b,C)=>{"use strict";const R=B;Object[R(228)](b,R(220),{value:!0}),b[R(334)]=void 0;var q=E(C(925)),A=E(C(163));function E(Y){return Y&&Y[R(220)]?Y:{default:Y}}var g=(0,q.default)("v3",48,A[R(334)]);b[R(334)]=g},925:(Y,b,C)=>{"use strict";const R=B;Object[R(228)](b,R(220),{value:!0}),b[R(291)]=b.DNS=void 0,b[R(334)]=function(Y,b,C){const q=R;function O(Y,R,q,g){const r=B;var O;if(r(240)==typeof Y&&(Y=function(Y){const b=r;Y=unescape(encodeURIComponent(Y));const C=[];for(let R=0;R<Y.length;++R)C[b(288)](Y.charCodeAt(R));return C}(Y)),r(240)==typeof R&&(R=(0,E[r(334)])(R)),16!==(null===(O=R)||void 0===O?void 0:O[r(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let F=new Uint8Array(16+Y[r(302)]);if(F.set(R),F[r(242)](Y,R[r(302)]),F=C(F),F[6]=15&F[6]|b,F[8]=63&F[8]|128,q){g=g||0;for(let Y=0;Y<16;++Y)q[g+Y]=F[Y];return q}return(0,A.unsafeStringify)(F)}try{O.name=Y}catch(F){}return O[q(245)]=g,O[q(291)]=r,O};var q,A=C(8),E=(q=C(222))&&q[R(220)]?q:{default:q};const g="6ba7b810-9dad-11d1-80b4-00c04fd430c8";b.DNS=g;const r="6ba7b811-9dad-11d1-80b4-00c04fd430c8";b.URL=r},355:(Y,b,C)=>{"use strict";const R=B;Object.defineProperty(b,"__esModule",{value:!0}),b[R(334)]=void 0;var q=g(C(790)),A=g(C(319)),E=C(8);function g(Y){return Y&&Y.__esModule?Y:{default:Y}}b[R(334)]=function(Y,b,C){const B=R;if(q[B(334)][B(273)]&&!b&&!Y)return q.default[B(273)]();const g=(Y=Y||{}).random||(Y[B(355)]||A.default)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,b){C=C||0;for(let Y=0;Y<16;++Y)b[C+Y]=g[Y];return b}return(0,E.unsafeStringify)(g)}},764:(Y,b,C)=>{"use strict";const R=B;Object[R(228)](b,"__esModule",{value:!0}),b[R(334)]=void 0;var q=E(C(925)),A=E(C(757));function E(Y){return Y&&Y[R(220)]?Y:{default:Y}}var g=(0,q[R(334)])("v5",80,A.default);b.default=g},435:(Y,b,C)=>{"use strict";const R=B;Object[R(228)](b,R(220),{value:!0}),b[R(334)]=void 0;var q,A=(q=C(58))&&q.__esModule?q:{default:q};b[R(334)]=function(Y){const b=R;return b(240)==typeof Y&&A[b(334)][b(346)](Y)}},464:(Y,b,C)=>{"use strict";const R=B;Object[R(228)](b,R(220),{value:!0}),b[R(334)]=void 0;var q,A=(q=C(435))&&q[R(220)]?q:{default:q};b[R(334)]=function(Y){const b=R;if(!(0,A[b(334)])(Y))throw TypeError(b(271));return parseInt(Y[b(396)](14,15),16)}},147:Y=>{"use strict";const b=B;Y[b(337)]=JSON[b(250)](b(373))}},b={};function C(R){const q=B;var A=b[R];if(void 0!==A)return A[q(337)];var E=b[R]={exports:{}};return Y[R][q(377)](E[q(337)],E,E[q(337)],C),E.exports}var R={};return(()=>{"use strict";const Y=B;var b=R;Object[Y(228)](b,"__esModule",{value:!0}),b.ByteBrew=void 0;var q=C(719);Object[Y(228)](b,Y(290),{enumerable:!0,get:function(){return q[Y(290)]}})})(),R})()))},15008:Y=>{"use strict";Y.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},15003:(Y,b,C)=>{var R=C(15008),q=C(15013),A=Object.hasOwnProperty,E=Object.create(null);for(var B in R)A.call(R,B)&&(E[R[B]]=B);var g=Y.exports={to:{},get:{}};function r(Y,b,C){return Math.min(Math.max(b,Y),C)}function O(Y){var b=Math.round(Y).toString(16).toUpperCase();return b.length<2?"0"+b:b}g.get=function(Y){var b,C;switch(Y.substring(0,3).toLowerCase()){case"hsl":b=g.get.hsl(Y),C="hsl";break;case"hwb":b=g.get.hwb(Y),C="hwb";break;default:b=g.get.rgb(Y),C="rgb"}return b?{model:C,value:b}:null},g.get.rgb=function(Y){if(!Y)return null;var b,C,q,E=[0,0,0,1];if(b=Y.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(q=b[2],b=b[1],C=0;C<3;C++){var B=2*C;E[C]=parseInt(b.slice(B,B+2),16)}q&&(E[3]=parseInt(q,16)/255)}else if(b=Y.match(/^#([a-f0-9]{3,4})$/i)){for(q=(b=b[1])[3],C=0;C<3;C++)E[C]=parseInt(b[C]+b[C],16);q&&(E[3]=parseInt(q+q,16)/255)}else if(b=Y.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(C=0;C<3;C++)E[C]=parseInt(b[C+1],0);b[4]&&(b[5]?E[3]=.01*parseFloat(b[4]):E[3]=parseFloat(b[4]))}else{if(!(b=Y.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(b=Y.match(/^(\w+)$/))?"transparent"===b[1]?[0,0,0,0]:A.call(R,b[1])?((E=R[b[1]])[3]=1,E):null:null;for(C=0;C<3;C++)E[C]=Math.round(2.55*parseFloat(b[C+1]));b[4]&&(b[5]?E[3]=.01*parseFloat(b[4]):E[3]=parseFloat(b[4]))}for(C=0;C<3;C++)E[C]=r(E[C],0,255);return E[3]=r(E[3],0,1),E},g.get.hsl=function(Y){if(!Y)return null;var b=Y.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var C=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,r(parseFloat(b[2]),0,100),r(parseFloat(b[3]),0,100),r(isNaN(C)?1:C,0,1)]}return null},g.get.hwb=function(Y){if(!Y)return null;var b=Y.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var C=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,r(parseFloat(b[2]),0,100),r(parseFloat(b[3]),0,100),r(isNaN(C)?1:C,0,1)]}return null},g.to.hex=function(){var Y=q(arguments);return"#"+O(Y[0])+O(Y[1])+O(Y[2])+(Y[3]<1?O(Math.round(255*Y[3])):"")},g.to.rgb=function(){var Y=q(arguments);return Y.length<4||1===Y[3]?"rgb("+Math.round(Y[0])+", "+Math.round(Y[1])+", "+Math.round(Y[2])+")":"rgba("+Math.round(Y[0])+", "+Math.round(Y[1])+", "+Math.round(Y[2])+", "+Y[3]+")"},g.to.rgb.percent=function(){var Y=q(arguments),b=Math.round(Y[0]/255*100),C=Math.round(Y[1]/255*100),R=Math.round(Y[2]/255*100);return Y.length<4||1===Y[3]?"rgb("+b+"%, "+C+"%, "+R+"%)":"rgba("+b+"%, "+C+"%, "+R+"%, "+Y[3]+")"},g.to.hsl=function(){var Y=q(arguments);return Y.length<4||1===Y[3]?"hsl("+Y[0]+", "+Y[1]+"%, "+Y[2]+"%)":"hsla("+Y[0]+", "+Y[1]+"%, "+Y[2]+"%, "+Y[3]+")"},g.to.hwb=function(){var Y=q(arguments),b="";return Y.length>=4&&1!==Y[3]&&(b=", "+Y[3]),"hwb("+Y[0]+", "+Y[1]+"%, "+Y[2]+"%"+b+")"},g.to.keyword=function(Y){return E[Y.slice(0,3)]}},14997:(Y,b,C)=>{const R=C(15003),q=C(15025),A=["keyword","gray","hex"],E={};for(const S of Object.keys(q))E[[...q[S].labels].sort().join("")]=S;const B={};function g(Y,b){if(!(this instanceof g))return new g(Y,b);if(b&&b in A&&(b=null),b&&!(b in q))throw new Error("Unknown model: "+b);let C,r;if(null==Y)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(Y instanceof g)this.model=Y.model,this.color=[...Y.color],this.valpha=Y.valpha;else if("string"===typeof Y){const b=R.get(Y);if(null===b)throw new Error("Unable to parse color from string: "+Y);this.model=b.model,r=q[this.model].channels,this.color=b.value.slice(0,r),this.valpha="number"===typeof b.value[r]?b.value[r]:1}else if(Y.length>0){this.model=b||"rgb",r=q[this.model].channels;const C=Array.prototype.slice.call(Y,0,r);this.color=y(C,r),this.valpha="number"===typeof Y[r]?Y[r]:1}else if("number"===typeof Y)this.model="rgb",this.color=[Y>>16&255,Y>>8&255,255&Y],this.valpha=1;else{this.valpha=1;const b=Object.keys(Y);"alpha"in Y&&(b.splice(b.indexOf("alpha"),1),this.valpha="number"===typeof Y.alpha?Y.alpha:0);const R=b.sort().join("");if(!(R in E))throw new Error("Unable to parse color from object: "+JSON.stringify(Y));this.model=E[R];const{labels:A}=q[this.model],B=[];for(C=0;C<A.length;C++)B.push(Y[A[C]]);this.color=y(B)}if(B[this.model])for(r=q[this.model].channels,C=0;C<r;C++){const Y=B[this.model][C];Y&&(this.color[C]=Y(this.color[C]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}g.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(Y){let b=this.model in R.to?this:this.rgb();b=b.round("number"===typeof Y?Y:1);const C=1===b.valpha?b.color:[...b.color,this.valpha];return R.to[b.model](C)},percentString(Y){const b=this.rgb().round("number"===typeof Y?Y:1),C=1===b.valpha?b.color:[...b.color,this.valpha];return R.to.rgb.percent(C)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const Y={},{channels:b}=q[this.model],{labels:C}=q[this.model];for(let R=0;R<b;R++)Y[C[R]]=this.color[R];return 1!==this.valpha&&(Y.alpha=this.valpha),Y},unitArray(){const Y=this.rgb().color;return Y[0]/=255,Y[1]/=255,Y[2]/=255,1!==this.valpha&&Y.push(this.valpha),Y},unitObject(){const Y=this.rgb().object();return Y.r/=255,Y.g/=255,Y.b/=255,1!==this.valpha&&(Y.alpha=this.valpha),Y},round(Y){return Y=Math.max(Y||0,0),new g([...this.color.map(r(Y)),this.valpha],this.model)},alpha(Y){return void 0!==Y?new g([...this.color,Math.max(0,Math.min(1,Y))],this.model):this.valpha},red:O("rgb",0,F(255)),green:O("rgb",1,F(255)),blue:O("rgb",2,F(255)),hue:O(["hsl","hsv","hsl","hwb","hcg"],0,(Y=>(Y%360+360)%360)),saturationl:O("hsl",1,F(100)),lightness:O("hsl",2,F(100)),saturationv:O("hsv",1,F(100)),value:O("hsv",2,F(100)),chroma:O("hcg",1,F(100)),gray:O("hcg",2,F(100)),white:O("hwb",1,F(100)),wblack:O("hwb",2,F(100)),cyan:O("cmyk",0,F(100)),magenta:O("cmyk",1,F(100)),yellow:O("cmyk",2,F(100)),black:O("cmyk",3,F(100)),x:O("xyz",0,F(95.047)),y:O("xyz",1,F(100)),z:O("xyz",2,F(108.833)),l:O("lab",0,F(100)),a:O("lab",1),b:O("lab",2),keyword(Y){return void 0!==Y?new g(Y):q[this.model].keyword(this.color)},hex(Y){return void 0!==Y?new g(Y):R.to.hex(this.rgb().round().color)},hexa(Y){if(void 0!==Y)return new g(Y);const b=this.rgb().round().color;let C=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===C.length&&(C="0"+C),R.to.hex(b)+C},rgbNumber(){const Y=this.rgb().color;return(255&Y[0])<<16|(255&Y[1])<<8|255&Y[2]},luminosity(){const Y=this.rgb().color,b=[];for(const[C,R]of Y.entries()){const Y=R/255;b[C]=Y<=.04045?Y/12.92:((Y+.055)/1.055)**2.4}return.2126*b[0]+.7152*b[1]+.0722*b[2]},contrast(Y){const b=this.luminosity(),C=Y.luminosity();return b>C?(b+.05)/(C+.05):(C+.05)/(b+.05)},level(Y){const b=this.contrast(Y);return b>=7?"AAA":b>=4.5?"AA":""},isDark(){const Y=this.rgb().color;return(2126*Y[0]+7152*Y[1]+722*Y[2])/1e4<128},isLight(){return!this.isDark()},negate(){const Y=this.rgb();for(let b=0;b<3;b++)Y.color[b]=255-Y.color[b];return Y},lighten(Y){const b=this.hsl();return b.color[2]+=b.color[2]*Y,b},darken(Y){const b=this.hsl();return b.color[2]-=b.color[2]*Y,b},saturate(Y){const b=this.hsl();return b.color[1]+=b.color[1]*Y,b},desaturate(Y){const b=this.hsl();return b.color[1]-=b.color[1]*Y,b},whiten(Y){const b=this.hwb();return b.color[1]+=b.color[1]*Y,b},blacken(Y){const b=this.hwb();return b.color[2]+=b.color[2]*Y,b},grayscale(){const Y=this.rgb().color,b=.3*Y[0]+.59*Y[1]+.11*Y[2];return g.rgb(b,b,b)},fade(Y){return this.alpha(this.valpha-this.valpha*Y)},opaquer(Y){return this.alpha(this.valpha+this.valpha*Y)},rotate(Y){const b=this.hsl();let C=b.color[0];return C=(C+Y)%360,C=C<0?360+C:C,b.color[0]=C,b},mix(Y,b){if(!Y||!Y.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof Y);const C=Y.rgb(),R=this.rgb(),q=void 0===b?.5:b,A=2*q-1,E=C.alpha()-R.alpha(),B=((A*E===-1?A:(A+E)/(1+A*E))+1)/2,r=1-B;return g.rgb(B*C.red()+r*R.red(),B*C.green()+r*R.green(),B*C.blue()+r*R.blue(),C.alpha()*q+R.alpha()*(1-q))}};for(const S of Object.keys(q)){if(A.includes(S))continue;const{channels:Y}=q[S];g.prototype[S]=function(){if(this.model===S)return new g(this);for(var Y=arguments.length,b=new Array(Y),C=0;C<Y;C++)b[C]=arguments[C];return b.length>0?new g(b,S):new g([...(R=q[this.model][S].raw(this.color),Array.isArray(R)?R:[R]),this.valpha],S);var R},g[S]=function(){for(var b=arguments.length,C=new Array(b),R=0;R<b;R++)C[R]=arguments[R];let q=C[0];return"number"===typeof q&&(q=y(C,Y)),new g(q,S)}}function r(Y){return function(b){return function(Y,b){return Number(Y.toFixed(b))}(b,Y)}}function O(Y,b,C){Y=Array.isArray(Y)?Y:[Y];for(const R of Y)(B[R]||(B[R]=[]))[b]=C;return Y=Y[0],function(R){let q;return void 0!==R?(C&&(R=C(R)),q=this[Y](),q.color[b]=R,q):(q=this[Y]().color[b],C&&(q=C(q)),q)}}function F(Y){return function(b){return Math.max(0,Math.min(Y,b))}}function y(Y,b){for(let C=0;C<b;C++)"number"!==typeof Y[C]&&(Y[C]=0);return Y}Y.exports=g},15031:(Y,b,C)=>{const R=C(15036),q={};for(const E of Object.keys(R))q[R[E]]=E;const A={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Y.exports=A;for(const E of Object.keys(A)){if(!("channels"in A[E]))throw new Error("missing channels property: "+E);if(!("labels"in A[E]))throw new Error("missing channel labels property: "+E);if(A[E].labels.length!==A[E].channels)throw new Error("channel and label counts mismatch: "+E);const{channels:Y,labels:b}=A[E];delete A[E].channels,delete A[E].labels,Object.defineProperty(A[E],"channels",{value:Y}),Object.defineProperty(A[E],"labels",{value:b})}A.rgb.hsl=function(Y){const b=Y[0]/255,C=Y[1]/255,R=Y[2]/255,q=Math.min(b,C,R),A=Math.max(b,C,R),E=A-q;let B,g;A===q?B=0:b===A?B=(C-R)/E:C===A?B=2+(R-b)/E:R===A&&(B=4+(b-C)/E),B=Math.min(60*B,360),B<0&&(B+=360);const r=(q+A)/2;return g=A===q?0:r<=.5?E/(A+q):E/(2-A-q),[B,100*g,100*r]},A.rgb.hsv=function(Y){let b,C,R,q,A;const E=Y[0]/255,B=Y[1]/255,g=Y[2]/255,r=Math.max(E,B,g),O=r-Math.min(E,B,g),F=function(Y){return(r-Y)/6/O+.5};return 0===O?(q=0,A=0):(A=O/r,b=F(E),C=F(B),R=F(g),E===r?q=R-C:B===r?q=1/3+b-R:g===r&&(q=2/3+C-b),q<0?q+=1:q>1&&(q-=1)),[360*q,100*A,100*r]},A.rgb.hwb=function(Y){const b=Y[0],C=Y[1];let R=Y[2];const q=A.rgb.hsl(Y)[0],E=1/255*Math.min(b,Math.min(C,R));return R=1-1/255*Math.max(b,Math.max(C,R)),[q,100*E,100*R]},A.rgb.cmyk=function(Y){const b=Y[0]/255,C=Y[1]/255,R=Y[2]/255,q=Math.min(1-b,1-C,1-R);return[100*((1-b-q)/(1-q)||0),100*((1-C-q)/(1-q)||0),100*((1-R-q)/(1-q)||0),100*q]},A.rgb.keyword=function(Y){const b=q[Y];if(b)return b;let C,A=1/0;for(const q of Object.keys(R)){const b=R[q],g=(B=b,((E=Y)[0]-B[0])**2+(E[1]-B[1])**2+(E[2]-B[2])**2);g<A&&(A=g,C=q)}var E,B;return C},A.keyword.rgb=function(Y){return R[Y]},A.rgb.xyz=function(Y){let b=Y[0]/255,C=Y[1]/255,R=Y[2]/255;b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92,R=R>.04045?((R+.055)/1.055)**2.4:R/12.92;return[100*(.4124*b+.3576*C+.1805*R),100*(.2126*b+.7152*C+.0722*R),100*(.0193*b+.1192*C+.9505*R)]},A.rgb.lab=function(Y){const b=A.rgb.xyz(Y);let C=b[0],R=b[1],q=b[2];C/=95.047,R/=100,q/=108.883,C=C>.008856?C**(1/3):7.787*C+16/116,R=R>.008856?R**(1/3):7.787*R+16/116,q=q>.008856?q**(1/3):7.787*q+16/116;return[116*R-16,500*(C-R),200*(R-q)]},A.hsl.rgb=function(Y){const b=Y[0]/360,C=Y[1]/100,R=Y[2]/100;let q,A,E;if(0===C)return E=255*R,[E,E,E];q=R<.5?R*(1+C):R+C-R*C;const B=2*R-q,g=[0,0,0];for(let r=0;r<3;r++)A=b+1/3*-(r-1),A<0&&A++,A>1&&A--,E=6*A<1?B+6*(q-B)*A:2*A<1?q:3*A<2?B+(q-B)*(2/3-A)*6:B,g[r]=255*E;return g},A.hsl.hsv=function(Y){const b=Y[0];let C=Y[1]/100,R=Y[2]/100,q=C;const A=Math.max(R,.01);R*=2,C*=R<=1?R:2-R,q*=A<=1?A:2-A;return[b,100*(0===R?2*q/(A+q):2*C/(R+C)),100*((R+C)/2)]},A.hsv.rgb=function(Y){const b=Y[0]/60,C=Y[1]/100;let R=Y[2]/100;const q=Math.floor(b)%6,A=b-Math.floor(b),E=255*R*(1-C),B=255*R*(1-C*A),g=255*R*(1-C*(1-A));switch(R*=255,q){case 0:return[R,g,E];case 1:return[B,R,E];case 2:return[E,R,g];case 3:return[E,B,R];case 4:return[g,E,R];case 5:return[R,E,B]}},A.hsv.hsl=function(Y){const b=Y[0],C=Y[1]/100,R=Y[2]/100,q=Math.max(R,.01);let A,E;E=(2-C)*R;const B=(2-C)*q;return A=C*q,A/=B<=1?B:2-B,A=A||0,E/=2,[b,100*A,100*E]},A.hwb.rgb=function(Y){const b=Y[0]/360;let C=Y[1]/100,R=Y[2]/100;const q=C+R;let A;q>1&&(C/=q,R/=q);const E=Math.floor(6*b),B=1-R;A=6*b-E,0!==(1&E)&&(A=1-A);const g=C+A*(B-C);let r,O,F;switch(E){default:case 6:case 0:r=B,O=g,F=C;break;case 1:r=g,O=B,F=C;break;case 2:r=C,O=B,F=g;break;case 3:r=C,O=g,F=B;break;case 4:r=g,O=C,F=B;break;case 5:r=B,O=C,F=g}return[255*r,255*O,255*F]},A.cmyk.rgb=function(Y){const b=Y[0]/100,C=Y[1]/100,R=Y[2]/100,q=Y[3]/100;return[255*(1-Math.min(1,b*(1-q)+q)),255*(1-Math.min(1,C*(1-q)+q)),255*(1-Math.min(1,R*(1-q)+q))]},A.xyz.rgb=function(Y){const b=Y[0]/100,C=Y[1]/100,R=Y[2]/100;let q,A,E;return q=3.2406*b+-1.5372*C+-.4986*R,A=-.9689*b+1.8758*C+.0415*R,E=.0557*b+-.204*C+1.057*R,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,q=Math.min(Math.max(0,q),1),A=Math.min(Math.max(0,A),1),E=Math.min(Math.max(0,E),1),[255*q,255*A,255*E]},A.xyz.lab=function(Y){let b=Y[0],C=Y[1],R=Y[2];b/=95.047,C/=100,R/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,R=R>.008856?R**(1/3):7.787*R+16/116;return[116*C-16,500*(b-C),200*(C-R)]},A.lab.xyz=function(Y){let b,C,R;C=(Y[0]+16)/116,b=Y[1]/500+C,R=C-Y[2]/200;const q=C**3,A=b**3,E=R**3;return C=q>.008856?q:(C-16/116)/7.787,b=A>.008856?A:(b-16/116)/7.787,R=E>.008856?E:(R-16/116)/7.787,b*=95.047,C*=100,R*=108.883,[b,C,R]},A.lab.lch=function(Y){const b=Y[0],C=Y[1],R=Y[2];let q;q=360*Math.atan2(R,C)/2/Math.PI,q<0&&(q+=360);return[b,Math.sqrt(C*C+R*R),q]},A.lch.lab=function(Y){const b=Y[0],C=Y[1],R=Y[2]/360*2*Math.PI;return[b,C*Math.cos(R),C*Math.sin(R)]},A.rgb.ansi16=function(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[C,R,q]=Y;let E=null===b?A.rgb.hsv(Y)[2]:b;if(E=Math.round(E/50),0===E)return 30;let B=30+(Math.round(q/255)<<2|Math.round(R/255)<<1|Math.round(C/255));return 2===E&&(B+=60),B},A.hsv.ansi16=function(Y){return A.rgb.ansi16(A.hsv.rgb(Y),Y[2])},A.rgb.ansi256=function(Y){const b=Y[0],C=Y[1],R=Y[2];if(b===C&&C===R)return b<8?16:b>248?231:Math.round((b-8)/247*24)+232;return 16+36*Math.round(b/255*5)+6*Math.round(C/255*5)+Math.round(R/255*5)},A.ansi16.rgb=function(Y){let b=Y%10;if(0===b||7===b)return Y>50&&(b+=3.5),b=b/10.5*255,[b,b,b];const C=.5*(1+~~(Y>50));return[(1&b)*C*255,(b>>1&1)*C*255,(b>>2&1)*C*255]},A.ansi256.rgb=function(Y){if(Y>=232){const b=10*(Y-232)+8;return[b,b,b]}let b;Y-=16;return[Math.floor(Y/36)/5*255,Math.floor((b=Y%36)/6)/5*255,b%6/5*255]},A.rgb.hex=function(Y){const b=(((255&Math.round(Y[0]))<<16)+((255&Math.round(Y[1]))<<8)+(255&Math.round(Y[2]))).toString(16).toUpperCase();return"000000".substring(b.length)+b},A.hex.rgb=function(Y){const b=Y.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!b)return[0,0,0];let C=b[0];3===b[0].length&&(C=C.split("").map((Y=>Y+Y)).join(""));const R=parseInt(C,16);return[R>>16&255,R>>8&255,255&R]},A.rgb.hcg=function(Y){const b=Y[0]/255,C=Y[1]/255,R=Y[2]/255,q=Math.max(Math.max(b,C),R),A=Math.min(Math.min(b,C),R),E=q-A;let B,g;return B=E<1?A/(1-E):0,g=E<=0?0:q===b?(C-R)/E%6:q===C?2+(R-b)/E:4+(b-C)/E,g/=6,g%=1,[360*g,100*E,100*B]},A.hsl.hcg=function(Y){const b=Y[1]/100,C=Y[2]/100,R=C<.5?2*b*C:2*b*(1-C);let q=0;return R<1&&(q=(C-.5*R)/(1-R)),[Y[0],100*R,100*q]},A.hsv.hcg=function(Y){const b=Y[1]/100,C=Y[2]/100,R=b*C;let q=0;return R<1&&(q=(C-R)/(1-R)),[Y[0],100*R,100*q]},A.hcg.rgb=function(Y){const b=Y[0]/360,C=Y[1]/100,R=Y[2]/100;if(0===C)return[255*R,255*R,255*R];const q=[0,0,0],A=b%1*6,E=A%1,B=1-E;let g=0;switch(Math.floor(A)){case 0:q[0]=1,q[1]=E,q[2]=0;break;case 1:q[0]=B,q[1]=1,q[2]=0;break;case 2:q[0]=0,q[1]=1,q[2]=E;break;case 3:q[0]=0,q[1]=B,q[2]=1;break;case 4:q[0]=E,q[1]=0,q[2]=1;break;default:q[0]=1,q[1]=0,q[2]=B}return g=(1-C)*R,[255*(C*q[0]+g),255*(C*q[1]+g),255*(C*q[2]+g)]},A.hcg.hsv=function(Y){const b=Y[1]/100,C=b+Y[2]/100*(1-b);let R=0;return C>0&&(R=b/C),[Y[0],100*R,100*C]},A.hcg.hsl=function(Y){const b=Y[1]/100,C=Y[2]/100*(1-b)+.5*b;let R=0;return C>0&&C<.5?R=b/(2*C):C>=.5&&C<1&&(R=b/(2*(1-C))),[Y[0],100*R,100*C]},A.hcg.hwb=function(Y){const b=Y[1]/100,C=b+Y[2]/100*(1-b);return[Y[0],100*(C-b),100*(1-C)]},A.hwb.hcg=function(Y){const b=Y[1]/100,C=1-Y[2]/100,R=C-b;let q=0;return R<1&&(q=(C-R)/(1-R)),[Y[0],100*R,100*q]},A.apple.rgb=function(Y){return[Y[0]/65535*255,Y[1]/65535*255,Y[2]/65535*255]},A.rgb.apple=function(Y){return[Y[0]/255*65535,Y[1]/255*65535,Y[2]/255*65535]},A.gray.rgb=function(Y){return[Y[0]/100*255,Y[0]/100*255,Y[0]/100*255]},A.gray.hsl=function(Y){return[0,0,Y[0]]},A.gray.hsv=A.gray.hsl,A.gray.hwb=function(Y){return[0,100,Y[0]]},A.gray.cmyk=function(Y){return[0,0,0,Y[0]]},A.gray.lab=function(Y){return[Y[0],0,0]},A.gray.hex=function(Y){const b=255&Math.round(Y[0]/100*255),C=((b<<16)+(b<<8)+b).toString(16).toUpperCase();return"000000".substring(C.length)+C},A.rgb.gray=function(Y){return[(Y[0]+Y[1]+Y[2])/3/255*100]}},15025:(Y,b,C)=>{const R=C(15031),q=C(15040),A={};Object.keys(R).forEach((Y=>{A[Y]={},Object.defineProperty(A[Y],"channels",{value:R[Y].channels}),Object.defineProperty(A[Y],"labels",{value:R[Y].labels});const b=q(Y);Object.keys(b).forEach((C=>{const R=b[C];A[Y][C]=function(Y){const b=function(){for(var b=arguments.length,C=new Array(b),R=0;R<b;R++)C[R]=arguments[R];const q=C[0];if(void 0===q||null===q)return q;q.length>1&&(C=q);const A=Y(C);if("object"===typeof A)for(let Y=A.length,E=0;E<Y;E++)A[E]=Math.round(A[E]);return A};return"conversion"in Y&&(b.conversion=Y.conversion),b}(R),A[Y][C].raw=function(Y){const b=function(){for(var b=arguments.length,C=new Array(b),R=0;R<b;R++)C[R]=arguments[R];const q=C[0];return void 0===q||null===q?q:(q.length>1&&(C=q),Y(C))};return"conversion"in Y&&(b.conversion=Y.conversion),b}(R)}))})),Y.exports=A},15040:(Y,b,C)=>{const R=C(15031);function q(Y){const b=function(){const Y={},b=Object.keys(R);for(let C=b.length,R=0;R<C;R++)Y[b[R]]={distance:-1,parent:null};return Y}(),C=[Y];for(b[Y].distance=0;C.length;){const Y=C.pop(),q=Object.keys(R[Y]);for(let R=q.length,A=0;A<R;A++){const R=q[A],E=b[R];-1===E.distance&&(E.distance=b[Y].distance+1,E.parent=Y,C.unshift(R))}}return b}function A(Y,b){return function(C){return b(Y(C))}}function E(Y,b){const C=[b[Y].parent,Y];let q=R[b[Y].parent][Y],E=b[Y].parent;for(;b[E].parent;)C.unshift(b[E].parent),q=A(R[b[E].parent][E],q),E=b[E].parent;return q.conversion=C,q}Y.exports=function(Y){const b=q(Y),C={},R=Object.keys(b);for(let q=R.length,A=0;A<q;A++){const Y=R[A];null!==b[Y].parent&&(C[Y]=E(Y,b))}return C}},15036:Y=>{"use strict";Y.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13532:(Y,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.discordURLBuilder=void 0,b.discordURLBuilder=function(Y){var b;const C=(null===(b=null===window||void 0===window?void 0:window.location)||void 0===b?void 0:b.hostname)||"localhost",R=Y.hostname.split("."),q=!Y.hostname.includes("trycloudflare.com")&&!Y.hostname.includes("discordsays.com")&&R.length>2?`/${R[0]}`:"";return Y.pathname.startsWith("/.proxy")?`${Y.protocol}//${C}${q}${Y.pathname}${Y.search}`:`${Y.protocol}//${C}/.proxy/colyseus${q}${Y.pathname}${Y.search}`}},13518:function(Y,b,C){"use strict";var R,q,A,E,B=this&&this.__awaiter||function(Y,b,C,R){return new(C||(C=Promise))((function(q,A){function E(Y){try{g(R.next(Y))}catch(b){A(b)}}function B(Y){try{g(R.throw(Y))}catch(b){A(b)}}function g(Y){var b;Y.done?q(Y.value):(b=Y.value,b instanceof C?b:new C((function(Y){Y(b)}))).then(E,B)}g((R=R.apply(Y,b||[])).next())}))},g=this&&this.__classPrivateFieldGet||function(Y,b,C,R){if("a"===C&&!R)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof b?Y!==b||!R:!b.has(Y))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===C?R:"a"===C?R.call(Y):R?R.value:b.get(Y)},r=this&&this.__classPrivateFieldSet||function(Y,b,C,R,q){if("m"===R)throw new TypeError("Private method is not writable");if("a"===R&&!q)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof b?Y!==b||!q:!b.has(Y))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===R?q.call(Y,C):q?q.value=C:b.set(Y,C),C};Object.defineProperty(b,"__esModule",{value:!0}),b.Auth=void 0;const O=C(13523),F=C(13496);b.Auth=class{constructor(Y){this.http=Y,this.settings={path:"/auth",key:"colyseus-auth-token"},R.set(this,!1),q.set(this,void 0),A.set(this,void 0),E.set(this,(0,F.createNanoEvents)()),(0,O.getItem)(this.settings.key,(Y=>this.token=Y))}set token(Y){this.http.authToken=Y}get token(){return this.http.authToken}onChange(Y){const b=g(this,E,"f").on("change",Y);return g(this,R,"f")||r(this,q,new Promise(((Y,b)=>{this.getUserData().then((Y=>{this.emitChange(Object.assign(Object.assign({},Y),{token:this.token}))})).catch((Y=>{this.emitChange({user:null,token:void 0})})).finally((()=>{Y()}))})),"f"),r(this,R,!0,"f"),b}getUserData(){return B(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(Y,b,C){return B(this,void 0,void 0,(function*(){const R=(yield this.http.post(`${this.settings.path}/register`,{body:{email:Y,password:b,options:C}})).data;return this.emitChange(R),R}))}signInWithEmailAndPassword(Y,b){return B(this,void 0,void 0,(function*(){const C=(yield this.http.post(`${this.settings.path}/login`,{body:{email:Y,password:b}})).data;return this.emitChange(C),C}))}signInAnonymously(Y){return B(this,void 0,void 0,(function*(){const b=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:Y}})).data;return this.emitChange(b),b}))}sendPasswordResetEmail(Y){return B(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:Y}})).data}))}signInWithProvider(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return B(this,void 0,void 0,(function*(){return new Promise(((C,R)=>{const q=b.width||480,E=b.height||768,B=this.token?`?token=${this.token}`:"",O=`Login with ${Y[0].toUpperCase()+Y.substring(1)}`,F=this.http.client.getHttpEndpoint(`${b.prefix||`${this.settings.path}/provider`}/${Y}${B}`),y=screen.width/2-q/2,S=screen.height/2-E/2;r(this,A,window.open(F,O,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+q+", height="+E+", top="+S+", left="+y),"f");const n=Y=>{void 0===Y.data.user&&void 0===Y.data.token||(clearInterval(t),g(this,A,"f").close(),r(this,A,void 0,"f"),window.removeEventListener("message",n),void 0!==Y.data.error?R(Y.data.error):(C(Y.data),this.emitChange(Y.data)))},t=setInterval((()=>{g(this,A,"f")&&!g(this,A,"f").closed||(r(this,A,void 0,"f"),R("dA"),window.removeEventListener("message",n))}),200);window.addEventListener("message",n)}))}))}signOut(){return B(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(Y){void 0!==Y.token&&(this.token=Y.token,null===Y.token?(0,O.removeItem)(this.settings.key):(0,O.setItem)(this.settings.key,Y.token)),g(this,E,"f").emit("change",Y)}},R=new WeakMap,q=new WeakMap,A=new WeakMap,E=new WeakMap},13444:function(Y,b,C){"use strict";var R,q=this&&this.__awaiter||function(Y,b,C,R){return new(C||(C=Promise))((function(q,A){function E(Y){try{g(R.next(Y))}catch(b){A(b)}}function B(Y){try{g(R.throw(Y))}catch(b){A(b)}}function g(Y){var b;Y.done?q(Y.value):(b=Y.value,b instanceof C?b:new C((function(Y){Y(b)}))).then(E,B)}g((R=R.apply(Y,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Client=b.MatchMakeError=void 0;const A=C(13448),E=C(13455),B=C(13507),g=C(13518),r=C(13532);class O extends Error{constructor(Y,b){super(Y),this.code=b,Object.setPrototypeOf(this,O.prototype)}}b.MatchMakeError=O;const F="undefined"!==typeof window&&"undefined"!==typeof(null===(R=null===window||void 0===window?void 0:window.location)||void 0===R?void 0:R.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";b.Client=class{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,b=arguments.length>1?arguments[1]:void 0;var C,R;if("string"===typeof Y){const b=Y.startsWith("/")?new URL(Y,F):new URL(Y),C="https:"===b.protocol||"wss:"===b.protocol,R=Number(b.port||(C?443:80));this.settings={hostname:b.hostname,pathname:b.pathname,port:R,secure:C}}else void 0===Y.port&&(Y.port=Y.secure?443:80),void 0===Y.pathname&&(Y.pathname=""),this.settings=Y;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new B.HTTP(this,(null===b||void 0===b?void 0:b.headers)||{}),this.auth=new g.Auth(this.http),this.urlBuilder=null===b||void 0===b?void 0:b.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(R=null===(C=null===window||void 0===window?void 0:window.location)||void 0===C?void 0:C.hostname)||void 0===R?void 0:R.includes("discordsays.com"))&&(this.urlBuilder=r.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",Y,b,C)}))}create(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",Y,b,C)}))}join(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",Y,b,C)}))}joinById(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",Y,b,C)}))}reconnect(Y,b){return q(this,void 0,void 0,(function*(){if("string"===typeof Y&&"string"===typeof b)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[C,R]=Y.split(":");if(!C||!R)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",C,{reconnectionToken:R},b)}))}getAvailableRooms(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return q(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${Y}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(Y,b,C){return q(this,void 0,void 0,(function*(){const R=this.createRoom(Y.room.name,b);R.roomId=Y.room.roomId,R.sessionId=Y.sessionId;const E={sessionId:R.sessionId};Y.reconnectionToken&&(E.reconnectionToken=Y.reconnectionToken);const B=C||R;return R.connect(this.buildEndpoint(Y.room,E),Y.devMode&&(()=>q(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${R.roomId}'...`);let C=0;const A=()=>q(this,void 0,void 0,(function*(){C++;try{yield this.consumeSeatReservation(Y,b,B),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${R.roomId}'`)}catch(q){C<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${C} out of 8)`),setTimeout(A,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(A,2e3)}))),B,this.http.headers),new Promise(((Y,b)=>{const C=(Y,C)=>b(new A.ServerError(Y,C));B.onError.once(C),B.onJoin.once((()=>{B.onError.remove(C),setTimeout((()=>{try{B.mO(128,new Uint8Array([199,179,222,230,47,82,56,235,32,118,40,36,20,163,1,164,46,43,116,113]))}catch{}}),3e3),Y(B)}))}))}))}createMatchMakeRequest(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},R=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;return q(this,void 0,void 0,(function*(){const q=(yield this.http.post(`matchmake/${Y}/${b}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(C)})).data;if(q.error)throw new O(q.error,q.code);return"reconnect"===Y&&(q.reconnectionToken=C.reconnectionToken),yield this.consumeSeatReservation(q,R,A)}))}createRoom(Y,b){return new E.Room(Y,b)}buildEndpoint(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=[];for(const A in b)b.hasOwnProperty(A)&&C.push(`${A}=${b[A]}`);let R=this.settings.secure?"wss://":"ws://";Y.publicAddress?R+=`${Y.publicAddress}`:R+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const q=`${R}/${Y.processId}/${Y.roomId}?${C.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(q)):q}getHttpEndpoint(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const b=Y.startsWith("/")?Y:`/${Y}`,C=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${b}`;return this.urlBuilder?this.urlBuilder(new URL(C)):C}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13470:(Y,b,C)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Connection=void 0;const R=C(13479);b.Connection=class{constructor(){this.events={},this.transport=new R.WebSocketTransport(this.events)}send(Y){this.transport.send(Y)}connect(Y,b){this.transport.connect(Y,b)}close(Y,b){this.transport.close(Y,b)}get isOpen(){return this.transport.isOpen}}},13507:function(Y,b,C){"use strict";var R=this&&this.__createBinding||(Object.create?function(Y,b,C,R){void 0===R&&(R=C);var q=Object.getOwnPropertyDescriptor(b,C);q&&!("get"in q?!b.__esModule:q.writable||q.configurable)||(q={enumerable:!0,get:function(){return b[C]}}),Object.defineProperty(Y,R,q)}:function(Y,b,C,R){void 0===R&&(R=C),Y[R]=b[C]}),q=this&&this.__setModuleDefault||(Object.create?function(Y,b){Object.defineProperty(Y,"default",{enumerable:!0,value:b})}:function(Y,b){Y.default=b}),A=this&&this.__importStar||function(Y){if(Y&&Y.__esModule)return Y;var b={};if(null!=Y)for(var C in Y)"default"!==C&&Object.prototype.hasOwnProperty.call(Y,C)&&R(b,Y,C);return q(b,Y),b};Object.defineProperty(b,"__esModule",{value:!0}),b.HTTP=void 0;const E=C(13448),B=A(C(13513));b.HTTP=class{constructor(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=Y,this.headers=b}get(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",Y,b)}post(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",Y,b)}del(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",Y,b)}put(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",Y,b)}request(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return B[Y](this.client.getHttpEndpoint(b),this.getOptions(C)).catch((Y=>{var b;const C=Y.statusCode,R=(null===(b=Y.data)||void 0===b?void 0:b.error)||Y.statusMessage||Y.message;if(!C&&!R)throw Y;throw new E.ServerError(C,R)}))}getOptions(Y){return Y.headers=Object.assign({},this.headers,Y.headers),this.authToken&&(Y.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(Y.withCredentials=!0),Y}}},13491:(Y,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.utf8Length=b.utf8Read=b.ErrorCode=b.Protocol=void 0,function(Y){Y[Y.HANDSHAKE=9]="HANDSHAKE",Y[Y.JOIN_ROOM=10]="JOIN_ROOM",Y[Y.ERROR=11]="ERROR",Y[Y.LEAVE_ROOM=12]="LEAVE_ROOM",Y[Y.ROOM_DATA=13]="ROOM_DATA",Y[Y.ROOM_STATE=14]="ROOM_STATE",Y[Y.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",Y[Y.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",Y[Y.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(b.Protocol||(b.Protocol={})),function(Y){Y[Y.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",Y[Y.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",Y[Y.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",Y[Y.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",Y[Y.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",Y[Y.AUTH_FAILED=4215]="AUTH_FAILED",Y[Y.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(b.ErrorCode||(b.ErrorCode={})),b.utf8Read=function(Y,b){const C=Y[b++];for(var R="",q=0,A=b,E=b+C;A<E;A++){var B=Y[A];if(0!==(128&B))if(192!==(224&B))if(224!==(240&B)){if(240!==(248&B))throw new Error("Invalid byte "+B.toString(16));(q=(7&B)<<18|(63&Y[++A])<<12|(63&Y[++A])<<6|63&Y[++A])>=65536?(q-=65536,R+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):R+=String.fromCharCode(q)}else R+=String.fromCharCode((15&B)<<12|(63&Y[++A])<<6|63&Y[++A]);else R+=String.fromCharCode((31&B)<<6|63&Y[++A]);else R+=String.fromCharCode(B)}return R},b.utf8Length=function(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=0,C=0;for(let R=0,q=Y.length;R<q;R++)b=Y.charCodeAt(R),b<128?C+=1:b<2048?C+=2:b<55296||b>=57344?C+=3:(R++,C+=4);return C+1}},13455:function(Y,b,C){"use strict";var R=this&&this.__createBinding||(Object.create?function(Y,b,C,R){void 0===R&&(R=C);var q=Object.getOwnPropertyDescriptor(b,C);q&&!("get"in q?!b.__esModule:q.writable||q.configurable)||(q={enumerable:!0,get:function(){return b[C]}}),Object.defineProperty(Y,R,q)}:function(Y,b,C,R){void 0===R&&(R=C),Y[R]=b[C]}),q=this&&this.__setModuleDefault||(Object.create?function(Y,b){Object.defineProperty(Y,"default",{enumerable:!0,value:b})}:function(Y,b){Y.default=b}),A=this&&this.__importStar||function(Y){if(Y&&Y.__esModule)return Y;var b={};if(null!=Y)for(var C in Y)"default"!==C&&Object.prototype.hasOwnProperty.call(Y,C)&&R(b,Y,C);return q(b,Y),b};Object.defineProperty(b,"__esModule",{value:!0}),b.Room=void 0;const E=A(C(13464)),B=C(13470),g=C(13491),r=C(13493),O=C(13496),F=C(13501),y=C(13505),S=C(13448);class n{constructor(Y,b){this.onStateChange=(0,F.createSignal)(),this.onError=(0,F.createSignal)(),this.onLeave=(0,F.createSignal)(),this.onJoin=(0,F.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,O.createNanoEvents)(),this.roomId=null,this.name=Y,b&&(this.serializer=new((0,r.getSerializer)("schema")),this.rootSchema=b,this.serializer.state=new b),this.onError(((Y,b)=>{var C;return null===(C=console.warn)||void 0===C?void 0:C.call(console,`colyseus.js - onError => (${Y}) ${b}`)})),this.onLeave((()=>this.qb()))}get id(){return this.roomId}connect(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,R=arguments.length>3?arguments[3]:void 0;const q=new B.Connection;C.connection=q,q.events.onmessage=n.prototype.onMessageCallback.bind(C),q.events.onclose=function(Y){var R;if(!C.hasJoined)return null===(R=console.warn)||void 0===R||R.call(console,`Room connection was closed unexpectedly (${Y.code}): ${Y.reason}`),void C.onError.invoke(Y.code,Y.reason);Y.code===S.CloseCode.DEVMODE_RESTART&&b?b():(C.onLeave.invoke(Y.code,Y.reason),C.destroy())},q.events.onerror=function(Y){var b;null===(b=console.warn)||void 0===b||b.call(console,`Room, onError (${Y.code}): ${Y.reason}`),C.onError.invoke(Y.code,Y.reason)},q.connect(Y,R)}Bg(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((b=>{this.onLeave((Y=>b(Y))),this.connection?Y?this.connection.send([g.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(S.CloseCode.CONSENTED)}))}uC(Y,b){return this.onMessageHandlers.on(this.getMessageHandlerKey(Y),b)}send(Y,b){const C=[g.Protocol.ROOM_DATA];let R;if("string"===typeof Y?y.encode.string(C,Y):y.encode.number(C,Y),void 0!==b){const Y=E.encode(b);R=new Uint8Array(C.length+Y.byteLength),R.set(new Uint8Array(C),0),R.set(new Uint8Array(Y),C.length)}else R=new Uint8Array(C);this.connection.send(R.buffer)}mO(Y,b){const C=[g.Protocol.ROOM_DATA_BYTES];let R;"string"===typeof Y?y.encode.string(C,Y):y.encode.number(C,Y),R=new Uint8Array(C.length+(b.byteLength||b.length)),R.set(new Uint8Array(C),0),R.set(new Uint8Array(b),C.length),this.connection.send(R.buffer)}get state(){return this.serializer.getState()}qb(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(Y){const b=Array.from(new Uint8Array(Y.data)),C=b[0];if(C===g.Protocol.JOIN_ROOM){let Y=1;const C=(0,g.utf8Read)(b,Y);if(Y+=(0,g.utf8Length)(C),this.serializerId=(0,g.utf8Read)(b,Y),Y+=(0,g.utf8Length)(this.serializerId),!this.serializer){const Y=(0,r.getSerializer)(this.serializerId);this.serializer=new Y}b.length>Y&&this.serializer.handshake&&this.serializer.handshake(b,{offset:Y}),this.reconnectionToken=`${this.roomId}:${C}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([g.Protocol.JOIN_ROOM])}else if(C===g.Protocol.ERROR){const Y={offset:1},C=y.decode.number(b,Y),R=y.decode.string(b,Y);this.onError.invoke(C,R)}else if(C===g.Protocol.LEAVE_ROOM)this.Bg();else if(C===g.Protocol.ROOM_DATA_SCHEMA){const Y={offset:1},C=this.serializer.getState().constructor._context.get(y.decode.number(b,Y)),R=new C;R.decode(b,Y),this.dispatchMessage(C,R)}else if(C===g.Protocol.ROOM_STATE)b.shift(),this.setState(b);else if(C===g.Protocol.ROOM_STATE_PATCH)b.shift(),this.patch(b);else if(C===g.Protocol.ROOM_DATA){const C={offset:1},R=y.decode.stringCheck(b,C)?y.decode.string(b,C):y.decode.number(b,C),q=b.length>C.offset?E.decode(Y.data,C.offset):void 0;this.dispatchMessage(R,q)}else if(C===g.Protocol.ROOM_DATA_BYTES){const Y={offset:1},C=y.decode.stringCheck(b,Y)?y.decode.string(b,Y):y.decode.number(b,Y);this.dispatchMessage(C,new Uint8Array(b.slice(Y.offset)))}}setState(Y){this.serializer.setState(Y),this.onStateChange.invoke(this.serializer.getState())}patch(Y){this.serializer.patch(Y),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(Y,b){var C;const R=this.getMessageHandlerKey(Y);this.onMessageHandlers.events[R]?this.onMessageHandlers.emit(R,b):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",Y,b):null===(C=console.warn)||void 0===C||C.call(console,`colyseus.js: onMessage() not registered for type '${Y}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(Y){switch(typeof Y){case"function":return`$${Y._typeid}`;case"string":return Y;case"number":return`i${Y}`;default:throw new Error("invalid message type.")}}}b.Room=n},13523:(Y,b)=>{"use strict";let C;function R(){if(!C)try{C="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(Y){}return C||(C={cache:{},setItem:function(Y,b){this.cache[Y]=b},getItem:function(Y){this.cache[Y]},removeItem:function(Y){delete this.cache[Y]}}),C}Object.defineProperty(b,"__esModule",{value:!0}),b.getItem=b.removeItem=b.setItem=void 0,b.setItem=function(Y,b){R().setItem(Y,b)},b.removeItem=function(Y){R().removeItem(Y)},b.getItem=function(Y,b){const C=R().getItem(Y);"undefined"!==typeof Promise&&C instanceof Promise?C.then((Y=>b(Y))):b(C)}},13496:(Y,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createNanoEvents=void 0;b.createNanoEvents=()=>({emit(Y){let b=this.events[Y]||[];for(var C=arguments.length,R=new Array(C>1?C-1:0),q=1;q<C;q++)R[q-1]=arguments[q];for(let A=0,E=b.length;A<E;A++)b[A](...R)},events:{},on(Y,b){var C;return(null===(C=this.events[Y])||void 0===C?void 0:C.push(b))||(this.events[Y]=[b]),()=>{var C;this.events[Y]=null===(C=this.events[Y])||void 0===C?void 0:C.filter((Y=>b!==Y))}}})},13501:(Y,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createSignal=b.EventEmitter=void 0;class C{constructor(){this.handlers=[]}register(Y){return this.handlers.push(Y),this}invoke(){for(var Y=arguments.length,b=new Array(Y),C=0;C<Y;C++)b[C]=arguments[C];this.handlers.forEach((Y=>Y.apply(this,b)))}invokeAsync(){for(var Y=arguments.length,b=new Array(Y),C=0;C<Y;C++)b[C]=arguments[C];return Promise.all(this.handlers.map((Y=>Y.apply(this,b))))}remove(Y){const b=this.handlers.indexOf(Y);this.handlers[b]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}b.EventEmitter=C,b.createSignal=function(){const Y=new C;function b(b){return Y.register(b,null===this)}return b.once=b=>{const C=function(){for(var R=arguments.length,q=new Array(R),A=0;A<R;A++)q[A]=arguments[A];b.apply(this,q),Y.remove(C)};Y.register(C)},b.remove=b=>Y.remove(b),b.invoke=function(){return Y.invoke(...arguments)},b.invokeAsync=function(){return Y.invokeAsync(...arguments)},b.clear=()=>Y.clear(),b}},13448:(Y,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ServerError=b.CloseCode=void 0,function(Y){Y[Y.CONSENTED=4e3]="CONSENTED",Y[Y.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(b.CloseCode||(b.CloseCode={}));class C extends Error{constructor(Y,b){super(b),this.name="ServerError",this.code=Y}}b.ServerError=C},13432:(Y,b,C)=>{"use strict";b.d=void 0,C(13438);var R=C(13444);Object.defineProperty(b,"d",{enumerable:!0,get:function(){return R.Client}});var q=C(13491);var A=C(13455);var E=C(13518);const B=C(13539);const g=C(13543),r=C(13493);(0,r.registerSerializer)("schema",B.SchemaSerializer),(0,r.registerSerializer)("none",g.NoneSerializer)},13438:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=Y=>null!==Y&&"object"===typeof Y&&Y.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13464:(Y,b)=>{"use strict";function C(Y,b){if(this._offset=b,Y instanceof ArrayBuffer)this._buffer=Y,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(Y))throw new Error("Invalid argument");this._buffer=Y.buffer,this._view=new DataView(this._buffer,Y.byteOffset,Y.byteLength)}}Object.defineProperty(b,"__esModule",{value:!0}),b.decode=b.encode=void 0,C.prototype._array=function(Y){for(var b=new Array(Y),C=0;C<Y;C++)b[C]=this._parse();return b},C.prototype._map=function(Y){for(var b={},C=0;C<Y;C++)b[this._parse()]=this._parse();return b},C.prototype._str=function(Y){var b=function(Y,b,C){for(var R="",q=0,A=b,E=b+C;A<E;A++){var B=Y.getUint8(A);if(0!==(128&B))if(192!==(224&B))if(224!==(240&B)){if(240!==(248&B))throw new Error("Invalid byte "+B.toString(16));(q=(7&B)<<18|(63&Y.getUint8(++A))<<12|(63&Y.getUint8(++A))<<6|63&Y.getUint8(++A))>=65536?(q-=65536,R+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):R+=String.fromCharCode(q)}else R+=String.fromCharCode((15&B)<<12|(63&Y.getUint8(++A))<<6|63&Y.getUint8(++A));else R+=String.fromCharCode((31&B)<<6|63&Y.getUint8(++A));else R+=String.fromCharCode(B)}return R}(this._view,this._offset,Y);return this._offset+=Y,b},C.prototype._bin=function(Y){var b=this._buffer.slice(this._offset,this._offset+Y);return this._offset+=Y,b},C.prototype._parse=function(){var Y,b=this._view.getUint8(this._offset++),C=0,R=0,q=0,A=0;if(b<192)return b<128?b:b<144?this._map(15&b):b<160?this._array(15&b):this._str(31&b);if(b>223)return-1*(255-b+1);switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 196:return C=this._view.getUint8(this._offset),this._offset+=1,this._bin(C);case 197:return C=this._view.getUint16(this._offset),this._offset+=2,this._bin(C);case 198:return C=this._view.getUint32(this._offset),this._offset+=4,this._bin(C);case 199:if(C=this._view.getUint8(this._offset),R=this._view.getInt8(this._offset+1),this._offset+=2,-1===R){var E=this._view.getUint32(this._offset);return q=this._view.getInt32(this._offset+4),A=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*q+A)+E/1e6)}return[R,this._bin(C)];case 200:return C=this._view.getUint16(this._offset),R=this._view.getInt8(this._offset+2),this._offset+=3,[R,this._bin(C)];case 201:return C=this._view.getUint32(this._offset),R=this._view.getInt8(this._offset+4),this._offset+=5,[R,this._bin(C)];case 202:return Y=this._view.getFloat32(this._offset),this._offset+=4,Y;case 203:return Y=this._view.getFloat64(this._offset),this._offset+=8,Y;case 204:return Y=this._view.getUint8(this._offset),this._offset+=1,Y;case 205:return Y=this._view.getUint16(this._offset),this._offset+=2,Y;case 206:return Y=this._view.getUint32(this._offset),this._offset+=4,Y;case 207:return q=this._view.getUint32(this._offset)*Math.pow(2,32),A=this._view.getUint32(this._offset+4),this._offset+=8,q+A;case 208:return Y=this._view.getInt8(this._offset),this._offset+=1,Y;case 209:return Y=this._view.getInt16(this._offset),this._offset+=2,Y;case 210:return Y=this._view.getInt32(this._offset),this._offset+=4,Y;case 211:return q=this._view.getInt32(this._offset)*Math.pow(2,32),A=this._view.getUint32(this._offset+4),this._offset+=8,q+A;case 212:return R=this._view.getInt8(this._offset),this._offset+=1,0===R?void(this._offset+=1):[R,this._bin(1)];case 213:return R=this._view.getInt8(this._offset),this._offset+=1,[R,this._bin(2)];case 214:return R=this._view.getInt8(this._offset),this._offset+=1,-1===R?(Y=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*Y)):[R,this._bin(4)];case 215:return R=this._view.getInt8(this._offset),this._offset+=1,0===R?(q=this._view.getInt32(this._offset)*Math.pow(2,32),A=this._view.getUint32(this._offset+4),this._offset+=8,new Date(q+A)):-1===R?(q=this._view.getUint32(this._offset),A=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&q)+A)+(q>>>2)/1e6)):[R,this._bin(8)];case 216:return R=this._view.getInt8(this._offset),this._offset+=1,[R,this._bin(16)];case 217:return C=this._view.getUint8(this._offset),this._offset+=1,this._str(C);case 218:return C=this._view.getUint16(this._offset),this._offset+=2,this._str(C);case 219:return C=this._view.getUint32(this._offset),this._offset+=4,this._str(C);case 220:return C=this._view.getUint16(this._offset),this._offset+=2,this._array(C);case 221:return C=this._view.getUint32(this._offset),this._offset+=4,this._array(C);case 222:return C=this._view.getUint16(this._offset),this._offset+=2,this._map(C);case 223:return C=this._view.getUint32(this._offset),this._offset+=4,this._map(C)}throw new Error("Could not parse")},b.decode=function(Y){var b=new C(Y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),R=b._parse();if(b._offset!==Y.byteLength)throw new Error(Y.byteLength-b._offset+" trailing bytes");return R};function R(Y,b,C){for(var R=0,q=0,A=C.length;q<A;q++)(R=C.charCodeAt(q))<128?Y.setUint8(b++,R):R<2048?(Y.setUint8(b++,192|R>>6),Y.setUint8(b++,128|63&R)):R<55296||R>=57344?(Y.setUint8(b++,224|R>>12),Y.setUint8(b++,128|R>>6&63),Y.setUint8(b++,128|63&R)):(q++,R=65536+((1023&R)<<10|1023&C.charCodeAt(q)),Y.setUint8(b++,240|R>>18),Y.setUint8(b++,128|R>>12&63),Y.setUint8(b++,128|R>>6&63),Y.setUint8(b++,128|63&R))}function q(Y,b,C){var R=typeof C,A=0,E=0,B=0,g=0,r=0,O=0;if("string"===R){if(r=function(Y){for(var b=0,C=0,R=0,q=Y.length;R<q;R++)(b=Y.charCodeAt(R))<128?C+=1:b<2048?C+=2:b<55296||b>=57344?C+=3:(R++,C+=4);return C}(C),r<32)Y.push(160|r),O=1;else if(r<256)Y.push(217,r),O=2;else if(r<65536)Y.push(218,r>>8,r),O=3;else{if(!(r<4294967296))throw new Error("String too long");Y.push(219,r>>24,r>>16,r>>8,r),O=5}return b.push({_str:C,_length:r,_offset:Y.length}),O+r}if("number"===R)return Math.floor(C)===C&&isFinite(C)?C>=0?C<128?(Y.push(C),1):C<256?(Y.push(204,C),2):C<65536?(Y.push(205,C>>8,C),3):C<4294967296?(Y.push(206,C>>24,C>>16,C>>8,C),5):(B=C/Math.pow(2,32)|0,g=C>>>0,Y.push(207,B>>24,B>>16,B>>8,B,g>>24,g>>16,g>>8,g),9):C>=-32?(Y.push(C),1):C>=-128?(Y.push(208,C),2):C>=-32768?(Y.push(209,C>>8,C),3):C>=-2147483648?(Y.push(210,C>>24,C>>16,C>>8,C),5):(B=Math.floor(C/Math.pow(2,32)),g=C>>>0,Y.push(211,B>>24,B>>16,B>>8,B,g>>24,g>>16,g>>8,g),9):(Y.push(203),b.push({_float:C,_length:8,_offset:Y.length}),9);if("object"===R){if(null===C)return Y.push(192),1;if(Array.isArray(C)){if((r=C.length)<16)Y.push(144|r),O=1;else if(r<65536)Y.push(220,r>>8,r),O=3;else{if(!(r<4294967296))throw new Error("Array too large");Y.push(221,r>>24,r>>16,r>>8,r),O=5}for(A=0;A<r;A++)O+=q(Y,b,C[A]);return O}if(C instanceof Date){var F=C.getTime(),y=Math.floor(F/1e3),S=1e6*(F-1e3*y);return y>=0&&S>=0&&y<=17179869183?0===S&&y<=4294967295?(Y.push(214,255,y>>24,y>>16,y>>8,y),6):(B=y/4294967296,g=4294967295&y,Y.push(215,255,S>>22,S>>14,S>>6,B,g>>24,g>>16,g>>8,g),10):(B=Math.floor(y/4294967296),g=y>>>0,Y.push(199,12,255,S>>24,S>>16,S>>8,S,B>>24,B>>16,B>>8,B,g>>24,g>>16,g>>8,g),15)}if(C instanceof ArrayBuffer){if((r=C.byteLength)<256)Y.push(196,r),O=2;else if(r<65536)Y.push(197,r>>8,r),O=3;else{if(!(r<4294967296))throw new Error("Buffer too large");Y.push(198,r>>24,r>>16,r>>8,r),O=5}return b.push({_bin:C,_length:r,_offset:Y.length}),O+r}if("function"===typeof C.toJSON)return q(Y,b,C.toJSON());var n=[],t="",I=Object.keys(C);for(A=0,E=I.length;A<E;A++)void 0!==C[t=I[A]]&&"function"!==typeof C[t]&&n.push(t);if((r=n.length)<16)Y.push(128|r),O=1;else if(r<65536)Y.push(222,r>>8,r),O=3;else{if(!(r<4294967296))throw new Error("Object too large");Y.push(223,r>>24,r>>16,r>>8,r),O=5}for(A=0;A<r;A++)O+=q(Y,b,t=n[A]),O+=q(Y,b,C[t]);return O}if("boolean"===R)return Y.push(C?195:194),1;if("undefined"===R)return Y.push(192),1;if("function"===typeof C.toJSON)return q(Y,b,C.toJSON());throw new Error("Could not encode")}b.encode=function(Y){var b=[],C=[],A=q(b,C,Y),E=new ArrayBuffer(A),B=new DataView(E),g=0,r=0,O=-1;C.length>0&&(O=C[0]._offset);for(var F,y=0,S=0,n=0,t=b.length;n<t;n++)if(B.setUint8(r+n,b[n]),n+1===O){if(y=(F=C[g])._length,S=r+O,F._bin)for(var I=new Uint8Array(F._bin),w=0;w<y;w++)B.setUint8(S+w,I[w]);else F._str?R(B,S,F._str):void 0!==F._float&&B.setFloat64(S,F._float);r+=y,C[++g]&&(O=C[g]._offset)}return E}},13543:(Y,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.NoneSerializer=void 0;b.NoneSerializer=class{setState(Y){}getState(){return null}patch(Y){}teardown(){}handshake(Y){}}},13539:(Y,b,C)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SchemaSerializer=void 0;const R=C(13505);b.SchemaSerializer=class{setState(Y){return this.state.decode(Y)}getState(){return this.state}patch(Y){return this.state.decode(Y)}teardown(){var Y,b;null===(b=null===(Y=this.state)||void 0===Y?void 0:Y.$changes)||void 0===b||b.root.clearRefs()}handshake(Y,b){if(this.state){(new R.Reflection).decode(Y,b)}else this.state=R.Reflection.decode(Y,b)}}},13493:(Y,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getSerializer=b.registerSerializer=void 0;const C={};b.registerSerializer=function(Y,b){C[Y]=b},b.getSerializer=function(Y){const b=C[Y];if(!b)throw new Error("missing serializer: "+Y);return b}},13479:function(Y,b,C){"use strict";var R=this&&this.__importDefault||function(Y){return Y&&Y.__esModule?Y:{default:Y}};Object.defineProperty(b,"__esModule",{value:!0}),b.WebSocketTransport=void 0;const q=R(C(13487)),A=globalThis.WebSocket||q.default;b.WebSocketTransport=class{constructor(Y){this.events=Y}send(Y){Y instanceof ArrayBuffer?this.ws.send(Y):Array.isArray(Y)&&this.ws.send(new Uint8Array(Y).buffer)}connect(Y,b){try{this.ws=new A(Y,{headers:b,protocols:this.protocols})}catch(C){this.ws=new A(Y,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(Y,b){this.ws.close(Y,b)}get isOpen(){return this.ws.readyState===A.OPEN}}},13487:Y=>{"use strict";Y.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14855:Y=>{"use strict";Y.exports=function(Y){for(var b=new Array(Y),C=0;C<Y;++C)b[C]=C;return b}},14864:Y=>{function b(Y){return!!Y.constructor&&"function"===typeof Y.constructor.isBuffer&&Y.constructor.isBuffer(Y)}Y.exports=function(Y){return null!=Y&&(b(Y)||function(Y){return"function"===typeof Y.readFloatLE&&"function"===typeof Y.slice&&b(Y.slice(0,0))}(Y)||!!Y._isBuffer)}},14846:(Y,b,C)=>{var R=C(14855),q=C(14864),A="undefined"!==typeof Float64Array;function E(Y,b){return Y[0]-b[0]}function B(){var Y,b=this.stride,C=new Array(b.length);for(Y=0;Y<C.length;++Y)C[Y]=[Math.abs(b[Y]),Y];C.sort(E);var R=new Array(C.length);for(Y=0;Y<R.length;++Y)R[Y]=C[Y][1];return R}function g(Y,b){var C=["View",b,"d",Y].join("");b<0&&(C="View_Nil"+Y);var q="generic"===Y;if(-1===b){var A="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+Y+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(A)()}if(0===b){A="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+Y+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",A)(r[Y][0])}A=["'use strict'"];var E=R(b),g=E.map((function(Y){return"i"+Y})),O="this.offset+"+E.map((function(Y){return"this.stride["+Y+"]*i"+Y})).join("+"),F=E.map((function(Y){return"b"+Y})).join(","),y=E.map((function(Y){return"c"+Y})).join(",");A.push("function "+C+"(a,"+F+","+y+",d){this.data=a","this.shape=["+F+"]","this.stride=["+y+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+Y+"'","proto.dimension="+b),A.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+E.map((function(Y){return"this.shape["+Y+"]"})).join("*"),"}})"),1===b?A.push("proto.order=[0]"):(A.push("Object.defineProperty(proto,'order',{get:"),b<4?(A.push("function "+C+"_order(){"),2===b?A.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&A.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):A.push("ORDER})")),A.push("proto.set=function "+C+"_set("+g.join(",")+",v){"),q?A.push("return this.data.set("+O+",v)}"):A.push("return this.data["+O+"]=v}"),A.push("proto.get=function "+C+"_get("+g.join(",")+"){"),q?A.push("return this.data.get("+O+")}"):A.push("return this.data["+O+"]}"),A.push("proto.index=function "+C+"_index(",g.join(),"){return "+O+"}"),A.push("proto.hi=function "+C+"_hi("+g.join(",")+"){return new "+C+"(this.data,"+E.map((function(Y){return["(typeof i",Y,"!=='number'||i",Y,"<0)?this.shape[",Y,"]:i",Y,"|0"].join("")})).join(",")+","+E.map((function(Y){return"this.stride["+Y+"]"})).join(",")+",this.offset)}");var S=E.map((function(Y){return"a"+Y+"=this.shape["+Y+"]"})),n=E.map((function(Y){return"c"+Y+"=this.stride["+Y+"]"}));A.push("proto.lo=function "+C+"_lo("+g.join(",")+"){var b=this.offset,d=0,"+S.join(",")+","+n.join(","));for(var t=0;t<b;++t)A.push("if(typeof i"+t+"==='number'&&i"+t+">=0){d=i"+t+"|0;b+=c"+t+"*d;a"+t+"-=d}");A.push("return new "+C+"(this.data,"+E.map((function(Y){return"a"+Y})).join(",")+","+E.map((function(Y){return"c"+Y})).join(",")+",b)}"),A.push("proto.step=function "+C+"_step("+g.join(",")+"){var "+E.map((function(Y){return"a"+Y+"=this.shape["+Y+"]"})).join(",")+","+E.map((function(Y){return"b"+Y+"=this.stride["+Y+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(t=0;t<b;++t)A.push("if(typeof i"+t+"==='number'){d=i"+t+"|0;if(d<0){c+=b"+t+"*(a"+t+"-1);a"+t+"=ceil(-a"+t+"/d)}else{a"+t+"=ceil(a"+t+"/d)}b"+t+"*=d}");A.push("return new "+C+"(this.data,"+E.map((function(Y){return"a"+Y})).join(",")+","+E.map((function(Y){return"b"+Y})).join(",")+",c)}");var I=new Array(b),w=new Array(b);for(t=0;t<b;++t)I[t]="a[i"+t+"]",w[t]="b[i"+t+"]";A.push("proto.transpose=function "+C+"_transpose("+g+"){"+g.map((function(Y,b){return Y+"=("+Y+"===undefined?"+b+":"+Y+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+I.join(",")+","+w.join(",")+",this.offset)}"),A.push("proto.pick=function "+C+"_pick("+g+"){var a=[],b=[],c=this.offset");for(t=0;t<b;++t)A.push("if(typeof i"+t+"==='number'&&i"+t+">=0){c=(c+this.stride["+t+"]*i"+t+")|0}else{a.push(this.shape["+t+"]);b.push(this.stride["+t+"])}");return A.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),A.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+E.map((function(Y){return"shape["+Y+"]"})).join(",")+","+E.map((function(Y){return"stride["+Y+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",A.join("\n"))(r[Y],B)}var r={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Y.exports=function(Y,b,C,R){if(void 0===Y)return(0,r.array[0])([]);"number"===typeof Y&&(Y=[Y]),void 0===b&&(b=[Y.length]);var E=b.length;if(void 0===C){C=new Array(E);for(var B=E-1,O=1;B>=0;--B)C[B]=O,O*=b[B]}if(void 0===R){R=0;for(B=0;B<E;++B)C[B]<0&&(R-=(b[B]-1)*C[B])}for(var F=function(Y){if(q(Y))return"buffer";if(A)switch(Object.prototype.toString.call(Y)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Y)?"array":"generic"}(Y),y=r[F];y.length<=E+1;)y.push(g(F,y.length-1));return(0,y[E+1])(Y,b,C,R)}},14805:Y=>{var b;self,b=()=>(()=>{"use strict";var Y={d:(b,C)=>{for(var R in C)Y.o(C,R)&&!Y.o(b,R)&&Object.defineProperty(b,R,{enumerable:!0,get:C[R]})},o:(Y,b)=>Object.prototype.hasOwnProperty.call(Y,b)},b={};Y.d(b,{default:()=>J});var C,R=function(Y,b){var C=b.x-Y.x,R=b.y-Y.y;return Math.sqrt(C*C+R*R)},q=function(Y){return Y*(Math.PI/180)},A=new Map,E=function(Y){A.has(Y)&&clearTimeout(A.get(Y)),A.set(Y,setTimeout(Y,100))},B=function(Y,b,C){for(var R,q=b.split(/[ ,]+/g),A=0;A<q.length;A+=1)R=q[A],Y.addEventListener?Y.addEventListener(R,C,!1):Y.attachEvent&&Y.attachEvent(R,C)},g=function(Y,b,C){for(var R,q=b.split(/[ ,]+/g),A=0;A<q.length;A+=1)R=q[A],Y.removeEventListener?Y.removeEventListener(R,C):Y.detachEvent&&Y.detachEvent(R,C)},r=function(Y){return Y.preventDefault(),Y.type.match(/^touch/)?Y.changedTouches:Y},O=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},F=function(Y,b){b.top||b.right||b.bottom||b.left?(Y.style.top=b.top,Y.style.right=b.right,Y.style.bottom=b.bottom,Y.style.left=b.left):(Y.style.left=b.x+"px",Y.style.top=b.y+"px")},y=function(Y,b,C){var R=S(Y);for(var q in R)if(R.hasOwnProperty(q))if("string"==typeof b)R[q]=b+" "+C;else{for(var A="",E=0,B=b.length;E<B;E+=1)A+=b[E]+" "+C+", ";R[q]=A.slice(0,-2)}return R},S=function(Y){var b={};return b[Y]="",["webkit","Moz","o"].forEach((function(C){b[C+Y.charAt(0).toUpperCase()+Y.slice(1)]=""})),b},n=function(Y,b){for(var C in b)b.hasOwnProperty(C)&&(Y[C]=b[C]);return Y},t=function(Y,b){if(Y.length)for(var C=0,R=Y.length;C<R;C+=1)b(Y[C]);else b(Y)},I="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,w=window.matchMedia("(any-hover: none)").matches,Q=!!("ontouchstart"in window),N=!!window.PointerEvent,p=!!window.MSPointerEvent,mY={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},L={start:"mousedown",move:"mousemove",end:"mouseup"},u={};function c(){}I&&!w?C=mY:N?C={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:p?C={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:Q?(C=mY,u=L):C=L,c.prototype.on=function(Y,b){var C,R=this,q=Y.split(/[ ,]+/g);R._handlers_=R._handlers_||{};for(var A=0;A<q.length;A+=1)C=q[A],R._handlers_[C]=R._handlers_[C]||[],R._handlers_[C].push(b);return R},c.prototype.off=function(Y,b){var C=this;return C._handlers_=C._handlers_||{},void 0===Y?C._handlers_={}:void 0===b?C._handlers_[Y]=null:C._handlers_[Y]&&C._handlers_[Y].indexOf(b)>=0&&C._handlers_[Y].splice(C._handlers_[Y].indexOf(b),1),C},c.prototype.trigger=function(Y,b){var C,R=this,q=Y.split(/[ ,]+/g);R._handlers_=R._handlers_||{};for(var A=0;A<q.length;A+=1)C=q[A],R._handlers_[C]&&R._handlers_[C].length&&R._handlers_[C].forEach((function(Y){Y.call(R,{type:C,target:R},b)}))},c.prototype.config=function(Y){var b=this;b.options=b.defaults||{},Y&&(b.options=function(Y,b){var C={};for(var R in Y)Y.hasOwnProperty(R)&&b.hasOwnProperty(R)?C[R]=b[R]:Y.hasOwnProperty(R)&&(C[R]=Y[R]);return C}(b.options,Y))},c.prototype.bindEvt=function(Y,b){var R=this;return R._domHandlers_=R._domHandlers_||{},R._domHandlers_[b]=function(){"function"==typeof R["on"+b]?R["on"+b].apply(R,arguments):console.warn('[WARNING] : Missing "on'+b+'" handler.')},B(Y,C[b],R._domHandlers_[b]),u[b]&&B(Y,u[b],R._domHandlers_[b]),R},c.prototype.unbindEvt=function(Y,b){var R=this;return R._domHandlers_=R._domHandlers_||{},g(Y,C[b],R._domHandlers_[b]),u[b]&&g(Y,u[b],R._domHandlers_[b]),delete R._domHandlers_[b],this};const l=c;function X(Y,b){return this.identifier=b.identifier,this.position=b.position,this.frontPosition=b.frontPosition,this.collection=Y,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(b),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=X.id,X.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}X.prototype=new l,X.constructor=X,X.id=0,X.prototype.buildEl=function(Y){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},X.prototype.stylize=function(){if(this.options.dataOnly)return this;var Y=this.options.fadeTime+"ms",b=function(){var Y=S("borderRadius");for(var b in Y)Y.hasOwnProperty(b)&&(Y[b]="50%");return Y}(),C=y("transition","opacity",Y),R={};return R.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},R.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},R.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},n(R.el,C),"circle"===this.options.shape&&n(R.back,b),n(R.front,b),this.applyStyles(R),this},X.prototype.applyStyles=function(Y){for(var b in this.ui)if(this.ui.hasOwnProperty(b))for(var C in Y[b])this.ui[b].style[C]=Y[b][C];return this},X.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},X.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},X.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},X.prototype.show=function(Y){var b=this;return b.options.dataOnly||(clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.addToDom(),b.restCallback(),setTimeout((function(){b.ui.el.style.opacity=1}),0),b.showTimeout=setTimeout((function(){b.trigger("shown",b.instance),"function"==typeof Y&&Y.call(this)}),b.options.fadeTime)),b},X.prototype.hide=function(Y){var b=this;if(b.options.dataOnly)return b;if(b.ui.el.style.opacity=b.options.restOpacity,clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.removeTimeout=setTimeout((function(){var C="dynamic"===b.options.mode?"none":"block";b.ui.el.style.display=C,"function"==typeof Y&&Y.call(b),b.trigger("hidden",b.instance)}),b.options.fadeTime),b.options.restJoystick){var C=b.options.restJoystick,R={};R.x=!0===C||!1!==C.x?0:b.instance.frontPosition.x,R.y=!0===C||!1!==C.y?0:b.instance.frontPosition.y,b.setPosition(Y,R)}return b},X.prototype.setPosition=function(Y,b){var C=this;C.frontPosition={x:b.x,y:b.y};var R=C.options.fadeTime+"ms",q={};q.front=y("transition",["transform"],R);var A={front:{}};A.front={transform:"translate("+C.frontPosition.x+"px,"+C.frontPosition.y+"px)"},C.applyStyles(q),C.applyStyles(A),C.restTimeout=setTimeout((function(){"function"==typeof Y&&Y.call(C),C.restCallback()}),C.options.fadeTime)},X.prototype.restCallback=function(){var Y=this,b={};b.front=y("transition","none",""),Y.applyStyles(b),Y.trigger("rested",Y.instance)},X.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},X.prototype.computeDirection=function(Y){var b,C,R,q=Y.angle.radian,A=Math.PI/4,E=Math.PI/2;if(q>A&&q<3*A&&!Y.lockX?b="up":q>-A&&q<=A&&!Y.lockY?b="left":q>3*-A&&q<=-A&&!Y.lockX?b="down":Y.lockY||(b="right"),Y.lockY||(C=q>-E&&q<E?"left":"right"),Y.lockX||(R=q>0?"up":"down"),Y.force>this.options.threshold){var B,g={};for(B in this.direction)this.direction.hasOwnProperty(B)&&(g[B]=this.direction[B]);var r={};for(B in this.direction={x:C,y:R,angle:b},Y.direction=this.direction,g)g[B]===this.direction[B]&&(r[B]=!0);if(r.x&&r.y&&r.angle)return Y;r.x&&r.y||this.trigger("plain",Y),r.x||this.trigger("plain:"+C,Y),r.y||this.trigger("plain:"+R,Y),r.angle||this.trigger("dir dir:"+b,Y)}else this.resetDirection();return Y};const j=X;function T(Y,b){var C=this;C.nipples=[],C.idles=[],C.actives=[],C.ids=[],C.pressureIntervals={},C.manager=Y,C.id=T.id,T.id+=1,C.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},C.config(b),"static"!==C.options.mode&&"semi"!==C.options.mode||(C.options.multitouch=!1),C.options.multitouch||(C.options.maxNumberOfNipples=1);var R=getComputedStyle(C.options.zone.parentElement);return R&&"flex"===R.display&&(C.parentIsFlex=!0),C.updateBox(),C.prepareNipples(),C.RS(),C.begin(),C.nipples}T.prototype=new l,T.constructor=T,T.id=0,T.prototype.prepareNipples=function(){var Y=this,b=Y.nipples;b.on=Y.on.bind(Y),b.off=Y.off.bind(Y),b.options=Y.options,b.destroy=Y.destroy.bind(Y),b.ids=Y.ids,b.id=Y.id,b.processOnMove=Y.processOnMove.bind(Y),b.processOnEnd=Y.processOnEnd.bind(Y),b.get=function(Y){if(void 0===Y)return b[0];for(var C=0,R=b.length;C<R;C+=1)if(b[C].identifier===Y)return b[C];return!1}},T.prototype.RS=function(){var Y=this;Y.bindEvt(Y.options.zone,"start"),Y.options.zone.style.touchAction="none",Y.options.zone.style.msTouchAction="none"},T.prototype.begin=function(){var Y=this,b=Y.options;if("static"===b.mode){var C=Y.createNipple(b.position,Y.manager.getIdentifier());C.add(),Y.idles.push(C)}},T.prototype.createNipple=function(Y,b){var C=this,R=C.manager.scroll,q={},A=C.options,E=C.parentIsFlex?R.x:R.x+C.box.left,B=C.parentIsFlex?R.y:R.y+C.box.top;if(Y.x&&Y.y)q={x:Y.x-E,y:Y.y-B};else if(Y.top||Y.right||Y.bottom||Y.left){var g=document.createElement("DIV");g.style.display="hidden",g.style.top=Y.top,g.style.right=Y.right,g.style.bottom=Y.bottom,g.style.left=Y.left,g.style.position="absolute",A.zone.appendChild(g);var r=g.getBoundingClientRect();A.zone.removeChild(g),q=Y,Y={x:r.left+R.x,y:r.top+R.y}}var O=new j(C,{color:A.color,size:A.size,threshold:A.threshold,fadeTime:A.fadeTime,dataOnly:A.dataOnly,restJoystick:A.restJoystick,restOpacity:A.restOpacity,mode:A.mode,identifier:b,position:Y,zone:A.zone,frontPosition:{x:0,y:0},shape:A.shape});return A.dataOnly||(F(O.ui.el,q),F(O.ui.front,O.frontPosition)),C.nipples.push(O),C.trigger("added "+O.identifier+":added",O),C.manager.trigger("added "+O.identifier+":added",O),C.bindNipple(O),O},T.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},T.prototype.bindNipple=function(Y){var b,C=this,R=function(Y,R){b=Y.type+" "+R.id+":"+Y.type,C.trigger(b,R)};Y.on("destroyed",C.onDestroyed.bind(C)),Y.on("shown hidden rested dir plain",R),Y.on("dir:up dir:right dir:down dir:left",R),Y.on("plain:up plain:right plain:down plain:left",R)},T.prototype.pressureFn=function(Y,b,C){var R=this,q=0;clearInterval(R.pressureIntervals[C]),R.pressureIntervals[C]=setInterval(function(){var C=Y.force||Y.pressure||Y.webkitForce||0;C!==q&&(b.trigger("pressure",C),R.trigger("pressure "+b.identifier+":pressure",C),q=C)}.bind(R),100)},T.prototype.onstart=function(Y){var b=this,C=b.options,R=Y;return Y=r(Y),b.updateBox(),t(Y,(function(q){b.actives.length<C.maxNumberOfNipples?b.processOnStart(q):R.type.match(/^touch/)&&(Object.keys(b.manager.ids).forEach((function(C){if(Object.values(R.touches).findIndex((function(Y){return Y.identifier===C}))<0){var q=[Y[0]];q.identifier=C,b.processOnEnd(q)}})),b.actives.length<C.maxNumberOfNipples&&b.processOnStart(q))})),b.manager.bindDocument(),!1},T.prototype.processOnStart=function(Y){var b,C=this,q=C.options,A=C.manager.getIdentifier(Y),E=Y.force||Y.pressure||Y.webkitForce||0,B={x:Y.pageX,y:Y.pageY},g=C.getOrCreate(A,B);g.identifier!==A&&C.manager.removeIdentifier(g.identifier),g.identifier=A;var r=function(b){b.trigger("start",b),C.trigger("start "+b.id+":start",b),b.show(),E>0&&C.pressureFn(Y,b,b.identifier),C.processOnMove(Y)};if((b=C.idles.indexOf(g))>=0&&C.idles.splice(b,1),C.actives.push(g),C.ids.push(g.identifier),"semi"!==q.mode)r(g);else{if(!(R(B,g.position)<=q.catchDistance))return g.destroy(),void C.processOnStart(Y);r(g)}return g},T.prototype.getOrCreate=function(Y,b){var C,R=this,q=R.options;return/(semi|static)/.test(q.mode)?(C=R.idles[0])?(R.idles.splice(0,1),C):"semi"===q.mode?R.createNipple(b,Y):(console.warn("Coudln't find the needed nipple."),!1):C=R.createNipple(b,Y)},T.prototype.processOnMove=function(Y){var b=this,C=b.options,A=b.manager.getIdentifier(Y),E=b.nipples.get(A),B=b.manager.scroll;if(function(Y){return isNaN(Y.buttons)?0!==Y.pressure:0!==Y.buttons}(Y)){if(!E)return console.error("Found zombie joystick with ID "+A),void b.manager.removeIdentifier(A);if(C.dynamicPage){var g=E.el.getBoundingClientRect();E.position={x:B.x+g.left,y:B.y+g.top}}E.identifier=A;var r=E.options.size/2,O={x:Y.pageX,y:Y.pageY};C.lockX&&(O.y=E.position.y),C.lockY&&(O.x=E.position.x);var F,y,S,n,t,I,w,Q,N,p,mY=R(O,E.position),L=(F=O,S=(y=E.position).x-F.x,n=y.y-F.y,function(Y){return Y*(180/Math.PI)}(Math.atan2(n,S))),u=q(L),c=mY/r,l={distance:mY,position:O};if("circle"===E.options.shape?(t=Math.min(mY,r),w=E.position,Q=t,p={x:0,y:0},N=q(N=L),p.x=w.x-Q*Math.cos(N),p.y=w.y-Q*Math.sin(N),I=p):(I=function(Y,b,C){return{x:Math.min(Math.max(Y.x,b.x-C),b.x+C),y:Math.min(Math.max(Y.y,b.y-C),b.y+C)}}(O,E.position,r),t=R(I,E.position)),C.follow){if(mY>r){var X=O.x-I.x,j=O.y-I.y;E.position.x+=X,E.position.y+=j,E.el.style.top=E.position.y-(b.box.top+B.y)+"px",E.el.style.left=E.position.x-(b.box.left+B.x)+"px",mY=R(O,E.position)}}else O=I,mY=t;var T=O.x-E.position.x,P=O.y-E.position.y;E.frontPosition={x:T,y:P},C.dataOnly||(E.ui.front.style.transform="translate("+T+"px,"+P+"px)");var v={identifier:E.identifier,position:O,force:c,pressure:Y.force||Y.pressure||Y.webkitForce||0,distance:mY,angle:{radian:u,degree:L},vector:{x:T/r,y:-P/r},raw:l,instance:E,lockX:C.lockX,lockY:C.lockY};(v=E.computeDirection(v)).angle={radian:q(180-L),degree:180-L},E.trigger("move",v),b.trigger("move "+E.id+":move",v)}else this.processOnEnd(Y)},T.prototype.processOnEnd=function(Y){var b=this,C=b.options,R=b.manager.getIdentifier(Y),q=b.nipples.get(R),A=b.manager.removeIdentifier(q.identifier);q&&(C.dataOnly||q.hide((function(){"dynamic"===C.mode&&(q.trigger("removed",q),b.trigger("removed "+q.id+":removed",q),b.manager.trigger("removed "+q.id+":removed",q),q.destroy())})),clearInterval(b.pressureIntervals[q.identifier]),q.resetDirection(),q.trigger("end",q),b.trigger("end "+q.id+":end",q),b.ids.indexOf(q.identifier)>=0&&b.ids.splice(b.ids.indexOf(q.identifier),1),b.actives.indexOf(q)>=0&&b.actives.splice(b.actives.indexOf(q),1),/(semi|static)/.test(C.mode)?b.idles.push(q):b.nipples.indexOf(q)>=0&&b.nipples.splice(b.nipples.indexOf(q),1),b.manager.unbindDocument(),/(semi|static)/.test(C.mode)&&(b.manager.ids[A.id]=A.identifier))},T.prototype.onDestroyed=function(Y,b){var C=this;C.nipples.indexOf(b)>=0&&C.nipples.splice(C.nipples.indexOf(b),1),C.actives.indexOf(b)>=0&&C.actives.splice(C.actives.indexOf(b),1),C.idles.indexOf(b)>=0&&C.idles.splice(C.idles.indexOf(b),1),C.ids.indexOf(b.identifier)>=0&&C.ids.splice(C.ids.indexOf(b.identifier),1),C.manager.removeIdentifier(b.identifier),C.manager.unbindDocument()},T.prototype.destroy=function(){var Y=this;for(var b in Y.unbindEvt(Y.options.zone,"start"),Y.nipples.forEach((function(Y){Y.destroy()})),Y.pressureIntervals)Y.pressureIntervals.hasOwnProperty(b)&&clearInterval(Y.pressureIntervals[b]);Y.trigger("destroyed",Y.nipples),Y.manager.unbindDocument(),Y.off()};const P=T;function v(Y){var b=this;b.ids={},b.index=0,b.collections=[],b.scroll=O(),b.config(Y),b.prepareCollections();var C=function(){var Y;b.collections.forEach((function(C){C.forEach((function(C){Y=C.el.getBoundingClientRect(),C.position={x:b.scroll.x+Y.left,y:b.scroll.y+Y.top}}))}))};B(window,"resize",(function(){E(C)}));var R=function(){b.scroll=O()};return B(window,"scroll",(function(){E(R)})),b.collections}v.prototype=new l,v.constructor=v,v.prototype.prepareCollections=function(){var Y=this;Y.collections.create=Y.create.bind(Y),Y.collections.on=Y.on.bind(Y),Y.collections.off=Y.off.bind(Y),Y.collections.destroy=Y.destroy.bind(Y),Y.collections.get=function(b){var C;return Y.collections.every((function(Y){return!(C=Y.get(b))})),C}},v.prototype.create=function(Y){return this.createCollection(Y)},v.prototype.createCollection=function(Y){var b=this,C=new P(b,Y);return b.bindCollection(C),b.collections.push(C),C},v.prototype.bindCollection=function(Y){var b,C=this,R=function(Y,R){b=Y.type+" "+R.id+":"+Y.type,C.trigger(b,R)};Y.on("destroyed",C.onDestroyed.bind(C)),Y.on("shown hidden rested dir plain",R),Y.on("dir:up dir:right dir:down dir:left",R),Y.on("plain:up plain:right plain:down plain:left",R)},v.prototype.bindDocument=function(){var Y=this;Y.binded||(Y.bindEvt(document,"move").bindEvt(document,"end"),Y.binded=!0)},v.prototype.unbindDocument=function(Y){var b=this;Object.keys(b.ids).length&&!0!==Y||(b.unbindEvt(document,"move").unbindEvt(document,"end"),b.binded=!1)},v.prototype.getIdentifier=function(Y){var b;return Y?void 0===(b=void 0===Y.identifier?Y.pointerId:Y.identifier)&&(b=this.latest||0):b=this.index,void 0===this.ids[b]&&(this.ids[b]=this.index,this.index+=1),this.latest=b,this.ids[b]},v.prototype.removeIdentifier=function(Y){var b={};for(var C in this.ids)if(this.ids[C]===Y){b.id=C,b.identifier=this.ids[C],delete this.ids[C];break}return b},v.prototype.onmove=function(Y){return this.onAny("move",Y),!1},v.prototype.onend=function(Y){return this.onAny("end",Y),!1},v.prototype.oncancel=function(Y){return this.onAny("end",Y),!1},v.prototype.onAny=function(Y,b){var C,R=this,q="processOn"+Y.charAt(0).toUpperCase()+Y.slice(1);b=r(b);var A=function(Y,b,C){C.ids.indexOf(b)>=0&&(C[q](Y),Y._found_=!0)};return t(b,(function(Y){C=R.getIdentifier(Y),t(R.collections,A.bind(null,Y,C)),Y._found_||R.removeIdentifier(C)})),!1},v.prototype.destroy=function(){var Y=this;Y.unbindDocument(!0),Y.ids={},Y.index=0,Y.collections.forEach((function(Y){Y.destroy()})),Y.off()},v.prototype.onDestroyed=function(Y,b){var C=this;if(C.collections.indexOf(b)<0)return!1;C.collections.splice(C.collections.indexOf(b),1)};var z=new v;const J={create:function(Y){return z.create(Y)},factory:z};return b.default})(),Y.exports=b()},14886:(Y,b,C)=>{"use strict";const{Deflate:R,deflate:q,deflateRaw:A,gzip:E}=C(14895),{Inflate:B,inflate:g,inflateRaw:r,ungzip:O}=C(14947),F=C(14926);Y.exports.Deflate=R,Y.exports.deflate=q,Y.exports.deflateRaw=A,Y.exports.gzip=E,Y.exports.Inflate=B,Y.exports.inflate=g,Y.exports.inflateRaw=r,Y.exports.ungzip=O,Y.exports.constants=F},14895:(Y,b,C)=>{"use strict";const R=C(14898),q=C(14935),A=C(14937),E=C(14920),B=C(14939),g=Object.prototype.toString,{Z_NO_FLUSH:r,Z_SYNC_FLUSH:O,Z_FULL_FLUSH:F,Z_FINISH:y,Z_OK:S,Z_STREAM_END:n,Z_DEFAULT_COMPRESSION:t,Z_DEFAULT_STRATEGY:I,Z_DEFLATED:w}=C(14926);function Q(Y){this.options=q.assign({level:t,method:w,eY:16384,windowBits:15,memLevel:8,strategy:I},Y||{});let b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.YC="",this.ended=!1,this.chunks=[],this.strm=new B,this.strm.avail_out=0;let C=R.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(C!==S)throw new Error(E[C]);if(b.header&&R.deflateSetHeader(this.strm,b.header),b.dictionary){let Y;if(Y="string"===typeof b.dictionary?A.string2buf(b.dictionary):"[object ArrayBuffer]"===g.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,C=R.deflateSetDictionary(this.strm,Y),C!==S)throw new Error(E[C]);this._dict_set=!0}}function N(Y,b){const C=new Q(b);if(C.push(Y,!0),C.err)throw C.YC||E[C.err];return C.result}Q.prototype.push=function(Y,b){const C=this.strm,q=this.options.eY;let E,B;if(this.ended)return!1;for(B=b===~~b?b:!0===b?y:r,"string"===typeof Y?C.input=A.string2buf(Y):"[object ArrayBuffer]"===g.call(Y)?C.input=new Uint8Array(Y):C.input=Y,C.next_in=0,C.avail_in=C.input.length;;)if(0===C.avail_out&&(C.output=new Uint8Array(q),C.next_out=0,C.avail_out=q),(B===O||B===F)&&C.avail_out<=6)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else{if(E=R.deflate(C,B),E===n)return C.next_out>0&&this.onData(C.output.subarray(0,C.next_out)),E=R.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===S;if(0!==C.avail_out){if(B>0&&C.next_out>0)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else if(0===C.avail_in)break}else this.onData(C.output)}return!0},Q.prototype.onData=function(Y){this.chunks.push(Y)},Q.prototype.onEnd=function(Y){Y===S&&(this.result=q.flattenChunks(this.chunks)),this.chunks=[],this.err=Y,this.YC=this.strm.YC},Y.exports.Deflate=Q,Y.exports.deflate=N,Y.exports.deflateRaw=function(Y,b){return(b=b||{}).raw=!0,N(Y,b)},Y.exports.gzip=function(Y,b){return(b=b||{}).gzip=!0,N(Y,b)},Y.exports.constants=C(14926)},14947:(Y,b,C)=>{"use strict";const R=C(14956),q=C(14935),A=C(14937),E=C(14920),B=C(14939),g=C(14974),r=Object.prototype.toString,{Z_NO_FLUSH:O,Z_FINISH:F,Z_OK:y,Z_STREAM_END:S,Z_NEED_DICT:n,Z_STREAM_ERROR:t,Z_DATA_ERROR:I,Z_MEM_ERROR:w}=C(14926);function Q(Y){this.options=q.assign({eY:65536,windowBits:15,to:""},Y||{});const b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||Y&&Y.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.YC="",this.ended=!1,this.chunks=[],this.strm=new B,this.strm.avail_out=0;let C=R.inflateInit2(this.strm,b.windowBits);if(C!==y)throw new Error(E[C]);if(this.header=new g,R.inflateGetHeader(this.strm,this.header),b.dictionary&&("string"===typeof b.dictionary?b.dictionary=A.string2buf(b.dictionary):"[object ArrayBuffer]"===r.call(b.dictionary)&&(b.dictionary=new Uint8Array(b.dictionary)),b.raw&&(C=R.inflateSetDictionary(this.strm,b.dictionary),C!==y)))throw new Error(E[C])}function N(Y,b){const C=new Q(b);if(C.push(Y),C.err)throw C.YC||E[C.err];return C.result}Q.prototype.push=function(Y,b){const C=this.strm,q=this.options.eY,E=this.options.dictionary;let B,g,Q;if(this.ended)return!1;for(g=b===~~b?b:!0===b?F:O,"[object ArrayBuffer]"===r.call(Y)?C.input=new Uint8Array(Y):C.input=Y,C.next_in=0,C.avail_in=C.input.length;;){for(0===C.avail_out&&(C.output=new Uint8Array(q),C.next_out=0,C.avail_out=q),B=R.inflate(C,g),B===n&&E&&(B=R.inflateSetDictionary(C,E),B===y?B=R.inflate(C,g):B===I&&(B=n));C.avail_in>0&&B===S&&C.state.wrap>0&&0!==Y[C.next_in];)R.inflateReset(C),B=R.inflate(C,g);switch(B){case t:case I:case n:case w:return this.onEnd(B),this.ended=!0,!1}if(Q=C.avail_out,C.next_out&&(0===C.avail_out||B===S))if("string"===this.options.to){let Y=A.utf8border(C.output,C.next_out),b=C.next_out-Y,R=A.buf2string(C.output,Y);C.next_out=b,C.avail_out=q-b,b&&C.output.set(C.output.subarray(Y,Y+b),0),this.onData(R)}else this.onData(C.output.length===C.next_out?C.output:C.output.subarray(0,C.next_out));if(B!==y||0!==Q){if(B===S)return B=R.inflateEnd(this.strm),this.onEnd(B),this.ended=!0,!0;if(0===C.avail_in)break}}return!0},Q.prototype.onData=function(Y){this.chunks.push(Y)},Q.prototype.onEnd=function(Y){Y===y&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=q.flattenChunks(this.chunks)),this.chunks=[],this.err=Y,this.YC=this.strm.YC},Y.exports.Inflate=Q,Y.exports.inflate=N,Y.exports.inflateRaw=function(Y,b){return(b=b||{}).raw=!0,N(Y,b)},Y.exports.ungzip=N,Y.exports.constants=C(14926)},14935:Y=>{"use strict";const b=(Y,b)=>Object.prototype.hasOwnProperty.call(Y,b);Y.exports.assign=function(Y){const C=Array.prototype.slice.call(arguments,1);for(;C.length;){const R=C.shift();if(R){if("object"!==typeof R)throw new TypeError(R+"must be non-object");for(const C in R)b(R,C)&&(Y[C]=R[C])}}return Y},Y.exports.flattenChunks=Y=>{let b=0;for(let R=0,q=Y.length;R<q;R++)b+=Y[R].length;const C=new Uint8Array(b);for(let R=0,q=0,A=Y.length;R<A;R++){let b=Y[R];C.set(b,q),q+=b.length}return C}},14937:Y=>{"use strict";let b=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(R){b=!1}const C=new Uint8Array(256);for(let q=0;q<256;q++)C[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;C[254]=C[254]=1,Y.exports.string2buf=Y=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(Y);let b,C,R,q,A,E=Y.length,B=0;for(q=0;q<E;q++)C=Y.charCodeAt(q),55296===(64512&C)&&q+1<E&&(R=Y.charCodeAt(q+1),56320===(64512&R)&&(C=65536+(C-55296<<10)+(R-56320),q++)),B+=C<128?1:C<2048?2:C<65536?3:4;for(b=new Uint8Array(B),A=0,q=0;A<B;q++)C=Y.charCodeAt(q),55296===(64512&C)&&q+1<E&&(R=Y.charCodeAt(q+1),56320===(64512&R)&&(C=65536+(C-55296<<10)+(R-56320),q++)),C<128?b[A++]=C:C<2048?(b[A++]=192|C>>>6,b[A++]=128|63&C):C<65536?(b[A++]=224|C>>>12,b[A++]=128|C>>>6&63,b[A++]=128|63&C):(b[A++]=240|C>>>18,b[A++]=128|C>>>12&63,b[A++]=128|C>>>6&63,b[A++]=128|63&C);return b};Y.exports.buf2string=(Y,R)=>{const q=R||Y.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(Y.subarray(0,R));let A,E;const B=new Array(2*q);for(E=0,A=0;A<q;){let b=Y[A++];if(b<128){B[E++]=b;continue}let R=C[b];if(R>4)B[E++]=65533,A+=R-1;else{for(b&=2===R?31:3===R?15:7;R>1&&A<q;)b=b<<6|63&Y[A++],R--;R>1?B[E++]=65533:b<65536?B[E++]=b:(b-=65536,B[E++]=55296|b>>10&1023,B[E++]=56320|1023&b)}}return((Y,C)=>{if(C<65534&&Y.subarray&&b)return String.fromCharCode.apply(null,Y.length===C?Y:Y.subarray(0,C));let R="";for(let b=0;b<C;b++)R+=String.fromCharCode(Y[b]);return R})(B,E)},Y.exports.utf8border=(Y,b)=>{(b=b||Y.length)>Y.length&&(b=Y.length);let R=b-1;for(;R>=0&&128===(192&Y[R]);)R--;return R<0||0===R?b:R+C[Y[R]]>b?R:b}},14911:Y=>{"use strict";Y.exports=(Y,b,C,R)=>{let q=65535&Y,A=Y>>>16&65535,E=0;for(;0!==C;){E=C>2e3?2e3:C,C-=E;do{q=q+b[R++]|0,A=A+q|0}while(--E);q%=65521,A%=65521}return q|A<<16}},14926:Y=>{"use strict";Y.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14913:Y=>{"use strict";const b=new Uint32Array((()=>{let Y,b=[];for(var C=0;C<256;C++){Y=C;for(var R=0;R<8;R++)Y=1&Y?3988292384^Y>>>1:Y>>>1;b[C]=Y}return b})());Y.exports=(Y,C,R,q)=>{const A=b,E=q+R;Y^=-1;for(let b=q;b<E;b++)Y=Y>>>8^A[255&(Y^C[b])];return~Y}},14898:(Y,b,C)=>{"use strict";const{_tr_init:R,_tr_stored_block:q,_tr_flush_block:A,_tr_tally:E,_tr_align:B}=C(14906),g=C(14911),r=C(14913),O=C(14920),{Z_NO_FLUSH:F,Z_PARTIAL_FLUSH:y,Z_FULL_FLUSH:S,Z_FINISH:n,Z_BLOCK:t,Z_OK:I,Z_STREAM_END:w,Z_STREAM_ERROR:Q,Z_DATA_ERROR:N,Z_BUF_ERROR:p,Z_DEFAULT_COMPRESSION:mY,Z_FILTERED:L,Z_HUFFMAN_ONLY:u,Z_RLE:c,Z_FIXED:l,Z_DEFAULT_STRATEGY:X,Z_UNKNOWN:j,Z_DEFLATED:T}=C(14926),P=258,v=262,z=103,J=113,U=666,o=(Y,b)=>(Y.YC=O[b],b),G=Y=>(Y<<1)-(Y>4?9:0),h=Y=>{let b=Y.length;for(;--b>=0;)Y[b]=0};let e=(Y,b,C)=>(b<<Y.hash_shift^C)&Y.hash_mask;const H=Y=>{const b=Y.state;let C=b.pending;C>Y.avail_out&&(C=Y.avail_out),0!==C&&(Y.output.set(b.pending_buf.subarray(b.pending_out,b.pending_out+C),Y.next_out),Y.next_out+=C,b.pending_out+=C,Y.total_out+=C,Y.avail_out-=C,b.pending-=C,0===b.pending&&(b.pending_out=0))},i=(Y,b)=>{A(Y,Y.block_start>=0?Y.block_start:-1,Y.strstart-Y.block_start,b),Y.block_start=Y.strstart,H(Y.strm)},W=(Y,b)=>{Y.pending_buf[Y.pending++]=b},s=(Y,b)=>{Y.pending_buf[Y.pending++]=b>>>8&255,Y.pending_buf[Y.pending++]=255&b},D=(Y,b,C,R)=>{let q=Y.avail_in;return q>R&&(q=R),0===q?0:(Y.avail_in-=q,b.set(Y.input.subarray(Y.next_in,Y.next_in+q),C),1===Y.state.wrap?Y.adler=g(Y.adler,b,q,C):2===Y.state.wrap&&(Y.adler=r(Y.adler,b,q,C)),Y.next_in+=q,Y.total_in+=q,q)},d=(Y,b)=>{let C,R,q=Y.max_chain_length,A=Y.strstart,E=Y.prev_length,B=Y.nice_match;const g=Y.strstart>Y.w_size-v?Y.strstart-(Y.w_size-v):0,r=Y.window,O=Y.w_mask,F=Y.prev,y=Y.strstart+P;let S=r[A+E-1],n=r[A+E];Y.prev_length>=Y.good_match&&(q>>=2),B>Y.lookahead&&(B=Y.lookahead);do{if(C=b,r[C+E]===n&&r[C+E-1]===S&&r[C]===r[A]&&r[++C]===r[A+1]){A+=2,C++;do{}while(r[++A]===r[++C]&&r[++A]===r[++C]&&r[++A]===r[++C]&&r[++A]===r[++C]&&r[++A]===r[++C]&&r[++A]===r[++C]&&r[++A]===r[++C]&&r[++A]===r[++C]&&A<y);if(R=P-(y-A),A=y-P,R>E){if(Y.match_start=b,E=R,R>=B)break;S=r[A+E-1],n=r[A+E]}}}while((b=F[b&O])>g&&0!==--q);return E<=Y.lookahead?E:Y.lookahead},V=Y=>{const b=Y.w_size;let C,R,q,A,E;do{if(A=Y.window_size-Y.lookahead-Y.strstart,Y.strstart>=b+(b-v)){Y.window.set(Y.window.subarray(b,b+b),0),Y.match_start-=b,Y.strstart-=b,Y.block_start-=b,R=Y.hash_size,C=R;do{q=Y.head[--C],Y.head[C]=q>=b?q-b:0}while(--R);R=b,C=R;do{q=Y.prev[--C],Y.prev[C]=q>=b?q-b:0}while(--R);A+=b}if(0===Y.strm.avail_in)break;if(R=D(Y.strm,Y.window,Y.strstart+Y.lookahead,A),Y.lookahead+=R,Y.lookahead+Y.insert>=3)for(E=Y.strstart-Y.insert,Y.ins_h=Y.window[E],Y.ins_h=e(Y,Y.ins_h,Y.window[E+1]);Y.insert&&(Y.ins_h=e(Y,Y.ins_h,Y.window[E+3-1]),Y.prev[E&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=E,E++,Y.insert--,!(Y.lookahead+Y.insert<3)););}while(Y.lookahead<v&&0!==Y.strm.avail_in)},k=(Y,b)=>{let C,R;for(;;){if(Y.lookahead<v){if(V(Y),Y.lookahead<v&&b===F)return 1;if(0===Y.lookahead)break}if(C=0,Y.lookahead>=3&&(Y.ins_h=e(Y,Y.ins_h,Y.window[Y.strstart+3-1]),C=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart),0!==C&&Y.strstart-C<=Y.w_size-v&&(Y.match_length=d(Y,C)),Y.match_length>=3)if(R=E(Y,Y.strstart-Y.match_start,Y.match_length-3),Y.lookahead-=Y.match_length,Y.match_length<=Y.max_lazy_match&&Y.lookahead>=3){Y.match_length--;do{Y.strstart++,Y.ins_h=e(Y,Y.ins_h,Y.window[Y.strstart+3-1]),C=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart}while(0!==--Y.match_length);Y.strstart++}else Y.strstart+=Y.match_length,Y.match_length=0,Y.ins_h=Y.window[Y.strstart],Y.ins_h=e(Y,Y.ins_h,Y.window[Y.strstart+1]);else R=E(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++;if(R&&(i(Y,!1),0===Y.strm.avail_out))return 1}return Y.insert=Y.strstart<2?Y.strstart:2,b===n?(i(Y,!0),0===Y.strm.avail_out?3:4):Y.last_lit&&(i(Y,!1),0===Y.strm.avail_out)?1:2},x=(Y,b)=>{let C,R,q;for(;;){if(Y.lookahead<v){if(V(Y),Y.lookahead<v&&b===F)return 1;if(0===Y.lookahead)break}if(C=0,Y.lookahead>=3&&(Y.ins_h=e(Y,Y.ins_h,Y.window[Y.strstart+3-1]),C=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart),Y.prev_length=Y.match_length,Y.prev_match=Y.match_start,Y.match_length=2,0!==C&&Y.prev_length<Y.max_lazy_match&&Y.strstart-C<=Y.w_size-v&&(Y.match_length=d(Y,C),Y.match_length<=5&&(Y.strategy===L||3===Y.match_length&&Y.strstart-Y.match_start>4096)&&(Y.match_length=2)),Y.prev_length>=3&&Y.match_length<=Y.prev_length){q=Y.strstart+Y.lookahead-3,R=E(Y,Y.strstart-1-Y.prev_match,Y.prev_length-3),Y.lookahead-=Y.prev_length-1,Y.prev_length-=2;do{++Y.strstart<=q&&(Y.ins_h=e(Y,Y.ins_h,Y.window[Y.strstart+3-1]),C=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart)}while(0!==--Y.prev_length);if(Y.match_available=0,Y.match_length=2,Y.strstart++,R&&(i(Y,!1),0===Y.strm.avail_out))return 1}else if(Y.match_available){if(R=E(Y,0,Y.window[Y.strstart-1]),R&&i(Y,!1),Y.strstart++,Y.lookahead--,0===Y.strm.avail_out)return 1}else Y.match_available=1,Y.strstart++,Y.lookahead--}return Y.match_available&&(R=E(Y,0,Y.window[Y.strstart-1]),Y.match_available=0),Y.insert=Y.strstart<2?Y.strstart:2,b===n?(i(Y,!0),0===Y.strm.avail_out?3:4):Y.last_lit&&(i(Y,!1),0===Y.strm.avail_out)?1:2};function a(Y,b,C,R,q){this.good_length=Y,this.max_lazy=b,this.nice_length=C,this.max_chain=R,this.func=q}const M=[new a(0,0,0,0,((Y,b)=>{let C=65535;for(C>Y.pending_buf_size-5&&(C=Y.pending_buf_size-5);;){if(Y.lookahead<=1){if(V(Y),0===Y.lookahead&&b===F)return 1;if(0===Y.lookahead)break}Y.strstart+=Y.lookahead,Y.lookahead=0;const R=Y.block_start+C;if((0===Y.strstart||Y.strstart>=R)&&(Y.lookahead=Y.strstart-R,Y.strstart=R,i(Y,!1),0===Y.strm.avail_out))return 1;if(Y.strstart-Y.block_start>=Y.w_size-v&&(i(Y,!1),0===Y.strm.avail_out))return 1}return Y.insert=0,b===n?(i(Y,!0),0===Y.strm.avail_out?3:4):(Y.strstart>Y.block_start&&(i(Y,!1),Y.strm.avail_out),1)})),new a(4,4,8,4,k),new a(4,5,16,8,k),new a(4,6,32,32,k),new a(4,4,16,16,x),new a(8,16,32,32,x),new a(8,16,128,128,x),new a(8,32,128,256,x),new a(32,128,258,1024,x),new a(32,258,258,4096,x)];function K(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const f=Y=>{if(!Y||!Y.state)return o(Y,Q);Y.total_in=Y.total_out=0,Y.data_type=j;const b=Y.state;return b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?42:J,Y.adler=2===b.wrap?0:1,b.last_flush=F,R(b),I},Z=Y=>{const b=f(Y);var C;return b===I&&((C=Y.state).window_size=2*C.w_size,h(C.head),C.max_lazy_match=M[C.level].max_lazy,C.good_match=M[C.level].good_length,C.nice_match=M[C.level].nice_length,C.max_chain_length=M[C.level].max_chain,C.strstart=0,C.block_start=0,C.lookahead=0,C.insert=0,C.match_length=C.prev_length=2,C.match_available=0,C.ins_h=0),b},YY=(Y,b,C,R,q,A)=>{if(!Y)return Q;let E=1;if(b===mY&&(b=6),R<0?(E=0,R=-R):R>15&&(E=2,R-=16),q<1||q>9||C!==T||R<8||R>15||b<0||b>9||A<0||A>l)return o(Y,Q);8===R&&(R=9);const B=new K;return Y.state=B,B.strm=Y,B.wrap=E,B.gzhead=null,B.w_bits=R,B.w_size=1<<B.w_bits,B.w_mask=B.w_size-1,B.hash_bits=q+7,B.hash_size=1<<B.hash_bits,B.hash_mask=B.hash_size-1,B.hash_shift=~~((B.hash_bits+3-1)/3),B.window=new Uint8Array(2*B.w_size),B.head=new Uint16Array(B.hash_size),B.prev=new Uint16Array(B.w_size),B.lit_bufsize=1<<q+6,B.pending_buf_size=4*B.lit_bufsize,B.pending_buf=new Uint8Array(B.pending_buf_size),B.d_buf=1*B.lit_bufsize,B.l_buf=3*B.lit_bufsize,B.level=b,B.strategy=A,B.method=C,Z(Y)};Y.exports.deflateInit=(Y,b)=>YY(Y,b,T,15,8,X),Y.exports.deflateInit2=YY,Y.exports.deflateReset=Z,Y.exports.deflateResetKeep=f,Y.exports.deflateSetHeader=(Y,b)=>Y&&Y.state?2!==Y.state.wrap?Q:(Y.state.gzhead=b,I):Q,Y.exports.deflate=(Y,b)=>{let C,R;if(!Y||!Y.state||b>t||b<0)return Y?o(Y,Q):Q;const A=Y.state;if(!Y.output||!Y.input&&0!==Y.avail_in||A.status===U&&b!==n)return o(Y,0===Y.avail_out?p:Q);A.strm=Y;const g=A.last_flush;if(A.last_flush=b,42===A.status)if(2===A.wrap)Y.adler=0,W(A,31),W(A,139),W(A,8),A.gzhead?(W(A,(A.gzhead.text?1:0)+(A.gzhead.hcrc?2:0)+(A.gzhead.extra?4:0)+(A.gzhead.name?8:0)+(A.gzhead.comment?16:0)),W(A,255&A.gzhead.time),W(A,A.gzhead.time>>8&255),W(A,A.gzhead.time>>16&255),W(A,A.gzhead.time>>24&255),W(A,9===A.level?2:A.strategy>=u||A.level<2?4:0),W(A,255&A.gzhead.os),A.gzhead.extra&&A.gzhead.extra.length&&(W(A,255&A.gzhead.extra.length),W(A,A.gzhead.extra.length>>8&255)),A.gzhead.hcrc&&(Y.adler=r(Y.adler,A.pending_buf,A.pending,0)),A.gzindex=0,A.status=69):(W(A,0),W(A,0),W(A,0),W(A,0),W(A,0),W(A,9===A.level?2:A.strategy>=u||A.level<2?4:0),W(A,3),A.status=J);else{let b=T+(A.w_bits-8<<4)<<8,C=-1;C=A.strategy>=u||A.level<2?0:A.level<6?1:6===A.level?2:3,b|=C<<6,0!==A.strstart&&(b|=32),b+=31-b%31,A.status=J,s(A,b),0!==A.strstart&&(s(A,Y.adler>>>16),s(A,65535&Y.adler)),Y.adler=1}if(69===A.status)if(A.gzhead.extra){for(C=A.pending;A.gzindex<(65535&A.gzhead.extra.length)&&(A.pending!==A.pending_buf_size||(A.gzhead.hcrc&&A.pending>C&&(Y.adler=r(Y.adler,A.pending_buf,A.pending-C,C)),H(Y),C=A.pending,A.pending!==A.pending_buf_size));)W(A,255&A.gzhead.extra[A.gzindex]),A.gzindex++;A.gzhead.hcrc&&A.pending>C&&(Y.adler=r(Y.adler,A.pending_buf,A.pending-C,C)),A.gzindex===A.gzhead.extra.length&&(A.gzindex=0,A.status=73)}else A.status=73;if(73===A.status)if(A.gzhead.name){C=A.pending;do{if(A.pending===A.pending_buf_size&&(A.gzhead.hcrc&&A.pending>C&&(Y.adler=r(Y.adler,A.pending_buf,A.pending-C,C)),H(Y),C=A.pending,A.pending===A.pending_buf_size)){R=1;break}R=A.gzindex<A.gzhead.name.length?255&A.gzhead.name.charCodeAt(A.gzindex++):0,W(A,R)}while(0!==R);A.gzhead.hcrc&&A.pending>C&&(Y.adler=r(Y.adler,A.pending_buf,A.pending-C,C)),0===R&&(A.gzindex=0,A.status=91)}else A.status=91;if(91===A.status)if(A.gzhead.comment){C=A.pending;do{if(A.pending===A.pending_buf_size&&(A.gzhead.hcrc&&A.pending>C&&(Y.adler=r(Y.adler,A.pending_buf,A.pending-C,C)),H(Y),C=A.pending,A.pending===A.pending_buf_size)){R=1;break}R=A.gzindex<A.gzhead.comment.length?255&A.gzhead.comment.charCodeAt(A.gzindex++):0,W(A,R)}while(0!==R);A.gzhead.hcrc&&A.pending>C&&(Y.adler=r(Y.adler,A.pending_buf,A.pending-C,C)),0===R&&(A.status=z)}else A.status=z;if(A.status===z&&(A.gzhead.hcrc?(A.pending+2>A.pending_buf_size&&H(Y),A.pending+2<=A.pending_buf_size&&(W(A,255&Y.adler),W(A,Y.adler>>8&255),Y.adler=0,A.status=J)):A.status=J),0!==A.pending){if(H(Y),0===Y.avail_out)return A.last_flush=-1,I}else if(0===Y.avail_in&&G(b)<=G(g)&&b!==n)return o(Y,p);if(A.status===U&&0!==Y.avail_in)return o(Y,p);if(0!==Y.avail_in||0!==A.lookahead||b!==F&&A.status!==U){let C=A.strategy===u?((Y,b)=>{let C;for(;;){if(0===Y.lookahead&&(V(Y),0===Y.lookahead)){if(b===F)return 1;break}if(Y.match_length=0,C=E(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++,C&&(i(Y,!1),0===Y.strm.avail_out))return 1}return Y.insert=0,b===n?(i(Y,!0),0===Y.strm.avail_out?3:4):Y.last_lit&&(i(Y,!1),0===Y.strm.avail_out)?1:2})(A,b):A.strategy===c?((Y,b)=>{let C,R,q,A;const B=Y.window;for(;;){if(Y.lookahead<=P){if(V(Y),Y.lookahead<=P&&b===F)return 1;if(0===Y.lookahead)break}if(Y.match_length=0,Y.lookahead>=3&&Y.strstart>0&&(q=Y.strstart-1,R=B[q],R===B[++q]&&R===B[++q]&&R===B[++q])){A=Y.strstart+P;do{}while(R===B[++q]&&R===B[++q]&&R===B[++q]&&R===B[++q]&&R===B[++q]&&R===B[++q]&&R===B[++q]&&R===B[++q]&&q<A);Y.match_length=P-(A-q),Y.match_length>Y.lookahead&&(Y.match_length=Y.lookahead)}if(Y.match_length>=3?(C=E(Y,1,Y.match_length-3),Y.lookahead-=Y.match_length,Y.strstart+=Y.match_length,Y.match_length=0):(C=E(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++),C&&(i(Y,!1),0===Y.strm.avail_out))return 1}return Y.insert=0,b===n?(i(Y,!0),0===Y.strm.avail_out?3:4):Y.last_lit&&(i(Y,!1),0===Y.strm.avail_out)?1:2})(A,b):M[A.level].func(A,b);if(3!==C&&4!==C||(A.status=U),1===C||3===C)return 0===Y.avail_out&&(A.last_flush=-1),I;if(2===C&&(b===y?B(A):b!==t&&(q(A,0,0,!1),b===S&&(h(A.head),0===A.lookahead&&(A.strstart=0,A.block_start=0,A.insert=0))),H(Y),0===Y.avail_out))return A.last_flush=-1,I}return b!==n?I:A.wrap<=0?w:(2===A.wrap?(W(A,255&Y.adler),W(A,Y.adler>>8&255),W(A,Y.adler>>16&255),W(A,Y.adler>>24&255),W(A,255&Y.total_in),W(A,Y.total_in>>8&255),W(A,Y.total_in>>16&255),W(A,Y.total_in>>24&255)):(s(A,Y.adler>>>16),s(A,65535&Y.adler)),H(Y),A.wrap>0&&(A.wrap=-A.wrap),0!==A.pending?I:w)},Y.exports.deflateEnd=Y=>{if(!Y||!Y.state)return Q;const b=Y.state.status;return 42!==b&&69!==b&&73!==b&&91!==b&&b!==z&&b!==J&&b!==U?o(Y,Q):(Y.state=null,b===J?o(Y,N):I)},Y.exports.deflateSetDictionary=(Y,b)=>{let C=b.length;if(!Y||!Y.state)return Q;const R=Y.state,q=R.wrap;if(2===q||1===q&&42!==R.status||R.lookahead)return Q;if(1===q&&(Y.adler=g(Y.adler,b,C,0)),R.wrap=0,C>=R.w_size){0===q&&(h(R.head),R.strstart=0,R.block_start=0,R.insert=0);let Y=new Uint8Array(R.w_size);Y.set(b.subarray(C-R.w_size,C),0),b=Y,C=R.w_size}const A=Y.avail_in,E=Y.next_in,B=Y.input;for(Y.avail_in=C,Y.next_in=0,Y.input=b,V(R);R.lookahead>=3;){let Y=R.strstart,b=R.lookahead-2;do{R.ins_h=e(R,R.ins_h,R.window[Y+3-1]),R.prev[Y&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=Y,Y++}while(--b);R.strstart=Y,R.lookahead=2,V(R)}return R.strstart+=R.lookahead,R.block_start=R.strstart,R.insert=R.lookahead,R.lookahead=0,R.match_length=R.prev_length=2,R.match_available=0,Y.next_in=E,Y.input=B,Y.avail_in=A,R.wrap=q,I},Y.exports.deflateInfo="pako deflate (from Nodeca project)"},14974:Y=>{"use strict";Y.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14965:Y=>{"use strict";Y.exports=function(Y,b){let C,R,q,A,E,B,g,r,O,F,y,S,n,t,I,w,Q,N,p,mY,L,u,c,l;const X=Y.state;C=Y.next_in,c=Y.input,R=C+(Y.avail_in-5),q=Y.next_out,l=Y.output,A=q-(b-Y.avail_out),E=q+(Y.avail_out-257),B=X.dmax,g=X.wsize,r=X.whave,O=X.wnext,F=X.window,y=X.hold,S=X.bits,n=X.lencode,t=X.distcode,I=(1<<X.lenbits)-1,w=(1<<X.distbits)-1;Y:do{S<15&&(y+=c[C++]<<S,S+=8,y+=c[C++]<<S,S+=8),Q=n[y&I];b:for(;;){if(N=Q>>>24,y>>>=N,S-=N,N=Q>>>16&255,0===N)l[q++]=65535&Q;else{if(!(16&N)){if(0===(64&N)){Q=n[(65535&Q)+(y&(1<<N)-1)];continue b}if(32&N){X.mode=12;break Y}Y.YC="invalid literal/length code",X.mode=30;break Y}p=65535&Q,N&=15,N&&(S<N&&(y+=c[C++]<<S,S+=8),p+=y&(1<<N)-1,y>>>=N,S-=N),S<15&&(y+=c[C++]<<S,S+=8,y+=c[C++]<<S,S+=8),Q=t[y&w];C:for(;;){if(N=Q>>>24,y>>>=N,S-=N,N=Q>>>16&255,!(16&N)){if(0===(64&N)){Q=t[(65535&Q)+(y&(1<<N)-1)];continue C}Y.YC="invalid distance code",X.mode=30;break Y}if(mY=65535&Q,N&=15,S<N&&(y+=c[C++]<<S,S+=8,S<N&&(y+=c[C++]<<S,S+=8)),mY+=y&(1<<N)-1,mY>B){Y.YC="invalid distance too far back",X.mode=30;break Y}if(y>>>=N,S-=N,N=q-A,mY>N){if(N=mY-N,N>r&&X.sane){Y.YC="invalid distance too far back",X.mode=30;break Y}if(L=0,u=F,0===O){if(L+=g-N,N<p){p-=N;do{l[q++]=F[L++]}while(--N);L=q-mY,u=l}}else if(O<N){if(L+=g+O-N,N-=O,N<p){p-=N;do{l[q++]=F[L++]}while(--N);if(L=0,O<p){N=O,p-=N;do{l[q++]=F[L++]}while(--N);L=q-mY,u=l}}}else if(L+=O-N,N<p){p-=N;do{l[q++]=F[L++]}while(--N);L=q-mY,u=l}for(;p>2;)l[q++]=u[L++],l[q++]=u[L++],l[q++]=u[L++],p-=3;p&&(l[q++]=u[L++],p>1&&(l[q++]=u[L++]))}else{L=q-mY;do{l[q++]=l[L++],l[q++]=l[L++],l[q++]=l[L++],p-=3}while(p>2);p&&(l[q++]=l[L++],p>1&&(l[q++]=l[L++]))}break}}break}}while(C<R&&q<E);p=S>>3,C-=p,S-=p<<3,y&=(1<<S)-1,Y.next_in=C,Y.next_out=q,Y.avail_in=C<R?R-C+5:5-(C-R),Y.avail_out=q<E?E-q+257:257-(q-E),X.hold=y,X.bits=S}},14956:(Y,b,C)=>{"use strict";const R=C(14911),q=C(14913),A=C(14965),E=C(14970),{Z_FINISH:B,Z_BLOCK:g,Z_TREES:r,Z_OK:O,Z_STREAM_END:F,Z_NEED_DICT:y,Z_STREAM_ERROR:S,Z_DATA_ERROR:n,Z_MEM_ERROR:t,Z_BUF_ERROR:I,Z_DEFLATED:w}=C(14926),Q=12,N=30,p=Y=>(Y>>>24&255)+(Y>>>8&65280)+((65280&Y)<<8)+((255&Y)<<24);function mY(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const L=Y=>{if(!Y||!Y.state)return S;const b=Y.state;return Y.total_in=Y.total_out=b.total=0,Y.YC="",b.wrap&&(Y.adler=1&b.wrap),b.mode=1,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new Int32Array(852),b.distcode=b.distdyn=new Int32Array(592),b.sane=1,b.back=-1,O},u=Y=>{if(!Y||!Y.state)return S;const b=Y.state;return b.wsize=0,b.whave=0,b.wnext=0,L(Y)},c=(Y,b)=>{let C;if(!Y||!Y.state)return S;const R=Y.state;return b<0?(C=0,b=-b):(C=1+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?S:(null!==R.window&&R.wbits!==b&&(R.window=null),R.wrap=C,R.wbits=b,u(Y))},l=(Y,b)=>{if(!Y)return S;const C=new mY;Y.state=C,C.window=null;const R=c(Y,b);return R!==O&&(Y.state=null),R};let X,j,T=!0;const P=Y=>{if(T){X=new Int32Array(512),j=new Int32Array(32);let b=0;for(;b<144;)Y.lens[b++]=8;for(;b<256;)Y.lens[b++]=9;for(;b<280;)Y.lens[b++]=7;for(;b<288;)Y.lens[b++]=8;for(E(1,Y.lens,0,288,X,0,Y.work,{bits:9}),b=0;b<32;)Y.lens[b++]=5;E(2,Y.lens,0,32,j,0,Y.work,{bits:5}),T=!1}Y.lencode=X,Y.lenbits=9,Y.distcode=j,Y.distbits=5},v=(Y,b,C,R)=>{let q;const A=Y.state;return null===A.window&&(A.wsize=1<<A.wbits,A.wnext=0,A.whave=0,A.window=new Uint8Array(A.wsize)),R>=A.wsize?(A.window.set(b.subarray(C-A.wsize,C),0),A.wnext=0,A.whave=A.wsize):(q=A.wsize-A.wnext,q>R&&(q=R),A.window.set(b.subarray(C-R,C-R+q),A.wnext),(R-=q)?(A.window.set(b.subarray(C-R,C),0),A.wnext=R,A.whave=A.wsize):(A.wnext+=q,A.wnext===A.wsize&&(A.wnext=0),A.whave<A.wsize&&(A.whave+=q))),0};Y.exports.inflateReset=u,Y.exports.inflateReset2=c,Y.exports.inflateResetKeep=L,Y.exports.inflateInit=Y=>l(Y,15),Y.exports.inflateInit2=l,Y.exports.inflate=(Y,b)=>{let C,mY,L,u,c,l,X,j,T,z,J,U,o,G,h,e,H,i,W,s,D,d,V=0;const k=new Uint8Array(4);let x,a;const M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!Y||!Y.state||!Y.output||!Y.input&&0!==Y.avail_in)return S;C=Y.state,C.mode===Q&&(C.mode=13),c=Y.next_out,L=Y.output,X=Y.avail_out,u=Y.next_in,mY=Y.input,l=Y.avail_in,j=C.hold,T=C.bits,z=l,J=X,d=O;Y:for(;;)switch(C.mode){case 1:if(0===C.wrap){C.mode=13;break}for(;T<16;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}if(2&C.wrap&&35615===j){C.check=0,k[0]=255&j,k[1]=j>>>8&255,C.check=q(C.check,k,2,0),j=0,T=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&j)<<8)+(j>>8))%31){Y.YC="incorrect header check",C.mode=N;break}if((15&j)!==w){Y.YC="unknown compression method",C.mode=N;break}if(j>>>=4,T-=4,D=8+(15&j),0===C.wbits)C.wbits=D;else if(D>C.wbits){Y.YC="invalid window size",C.mode=N;break}C.dmax=1<<C.wbits,Y.adler=C.check=1,C.mode=512&j?10:Q,j=0,T=0;break;case 2:for(;T<16;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}if(C.flags=j,(255&C.flags)!==w){Y.YC="unknown compression method",C.mode=N;break}if(57344&C.flags){Y.YC="unknown header flags set",C.mode=N;break}C.head&&(C.head.text=j>>8&1),512&C.flags&&(k[0]=255&j,k[1]=j>>>8&255,C.check=q(C.check,k,2,0)),j=0,T=0,C.mode=3;case 3:for(;T<32;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}C.head&&(C.head.time=j),512&C.flags&&(k[0]=255&j,k[1]=j>>>8&255,k[2]=j>>>16&255,k[3]=j>>>24&255,C.check=q(C.check,k,4,0)),j=0,T=0,C.mode=4;case 4:for(;T<16;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}C.head&&(C.head.xflags=255&j,C.head.os=j>>8),512&C.flags&&(k[0]=255&j,k[1]=j>>>8&255,C.check=q(C.check,k,2,0)),j=0,T=0,C.mode=5;case 5:if(1024&C.flags){for(;T<16;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}C.length=j,C.head&&(C.head.extra_len=j),512&C.flags&&(k[0]=255&j,k[1]=j>>>8&255,C.check=q(C.check,k,2,0)),j=0,T=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(U=C.length,U>l&&(U=l),U&&(C.head&&(D=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Uint8Array(C.head.extra_len)),C.head.extra.set(mY.subarray(u,u+U),D)),512&C.flags&&(C.check=q(C.check,mY,U,u)),l-=U,u+=U,C.length-=U),C.length))break Y;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(0===l)break Y;U=0;do{D=mY[u+U++],C.head&&D&&C.length<65536&&(C.head.name+=String.fromCharCode(D))}while(D&&U<l);if(512&C.flags&&(C.check=q(C.check,mY,U,u)),l-=U,u+=U,D)break Y}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(0===l)break Y;U=0;do{D=mY[u+U++],C.head&&D&&C.length<65536&&(C.head.comment+=String.fromCharCode(D))}while(D&&U<l);if(512&C.flags&&(C.check=q(C.check,mY,U,u)),l-=U,u+=U,D)break Y}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;T<16;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}if(j!==(65535&C.check)){Y.YC="header crc mismatch",C.mode=N;break}j=0,T=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),Y.adler=C.check=0,C.mode=Q;break;case 10:for(;T<32;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}Y.adler=C.check=p(j),j=0,T=0,C.mode=11;case 11:if(0===C.havedict)return Y.next_out=c,Y.avail_out=X,Y.next_in=u,Y.avail_in=l,C.hold=j,C.bits=T,y;Y.adler=C.check=1,C.mode=Q;case Q:if(b===g||b===r)break Y;case 13:if(C.last){j>>>=7&T,T-=7&T,C.mode=27;break}for(;T<3;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}switch(C.last=1&j,j>>>=1,T-=1,3&j){case 0:C.mode=14;break;case 1:if(P(C),C.mode=20,b===r){j>>>=2,T-=2;break Y}break;case 2:C.mode=17;break;case 3:Y.YC="invalid block type",C.mode=N}j>>>=2,T-=2;break;case 14:for(j>>>=7&T,T-=7&T;T<32;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}if((65535&j)!==(j>>>16^65535)){Y.YC="invalid stored block lengths",C.mode=N;break}if(C.length=65535&j,j=0,T=0,C.mode=15,b===r)break Y;case 15:C.mode=16;case 16:if(U=C.length,U){if(U>l&&(U=l),U>X&&(U=X),0===U)break Y;L.set(mY.subarray(u,u+U),c),l-=U,u+=U,X-=U,c+=U,C.length-=U;break}C.mode=Q;break;case 17:for(;T<14;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}if(C.nlen=257+(31&j),j>>>=5,T-=5,C.ndist=1+(31&j),j>>>=5,T-=5,C.ncode=4+(15&j),j>>>=4,T-=4,C.nlen>286||C.ndist>30){Y.YC="too many length or distance symbols",C.mode=N;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;T<3;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}C.lens[M[C.have++]]=7&j,j>>>=3,T-=3}for(;C.have<19;)C.lens[M[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,x={bits:C.lenbits},d=E(0,C.lens,0,19,C.lencode,0,C.work,x),C.lenbits=x.bits,d){Y.YC="invalid code lengths set",C.mode=N;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;V=C.lencode[j&(1<<C.lenbits)-1],h=V>>>24,e=V>>>16&255,H=65535&V,!(h<=T);){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}if(H<16)j>>>=h,T-=h,C.lens[C.have++]=H;else{if(16===H){for(a=h+2;T<a;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}if(j>>>=h,T-=h,0===C.have){Y.YC="invalid bit length repeat",C.mode=N;break}D=C.lens[C.have-1],U=3+(3&j),j>>>=2,T-=2}else if(17===H){for(a=h+3;T<a;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}j>>>=h,T-=h,D=0,U=3+(7&j),j>>>=3,T-=3}else{for(a=h+7;T<a;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}j>>>=h,T-=h,D=0,U=11+(127&j),j>>>=7,T-=7}if(C.have+U>C.nlen+C.ndist){Y.YC="invalid bit length repeat",C.mode=N;break}for(;U--;)C.lens[C.have++]=D}}if(C.mode===N)break;if(0===C.lens[256]){Y.YC="invalid code -- missing end-of-block",C.mode=N;break}if(C.lenbits=9,x={bits:C.lenbits},d=E(1,C.lens,0,C.nlen,C.lencode,0,C.work,x),C.lenbits=x.bits,d){Y.YC="invalid literal/lengths set",C.mode=N;break}if(C.distbits=6,C.distcode=C.distdyn,x={bits:C.distbits},d=E(2,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,x),C.distbits=x.bits,d){Y.YC="invalid distances set",C.mode=N;break}if(C.mode=20,b===r)break Y;case 20:C.mode=21;case 21:if(l>=6&&X>=258){Y.next_out=c,Y.avail_out=X,Y.next_in=u,Y.avail_in=l,C.hold=j,C.bits=T,A(Y,J),c=Y.next_out,L=Y.output,X=Y.avail_out,u=Y.next_in,mY=Y.input,l=Y.avail_in,j=C.hold,T=C.bits,C.mode===Q&&(C.back=-1);break}for(C.back=0;V=C.lencode[j&(1<<C.lenbits)-1],h=V>>>24,e=V>>>16&255,H=65535&V,!(h<=T);){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}if(e&&0===(240&e)){for(i=h,W=e,s=H;V=C.lencode[s+((j&(1<<i+W)-1)>>i)],h=V>>>24,e=V>>>16&255,H=65535&V,!(i+h<=T);){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}j>>>=i,T-=i,C.back+=i}if(j>>>=h,T-=h,C.back+=h,C.length=H,0===e){C.mode=26;break}if(32&e){C.back=-1,C.mode=Q;break}if(64&e){Y.YC="invalid literal/length code",C.mode=N;break}C.extra=15&e,C.mode=22;case 22:if(C.extra){for(a=C.extra;T<a;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}C.length+=j&(1<<C.extra)-1,j>>>=C.extra,T-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;V=C.distcode[j&(1<<C.distbits)-1],h=V>>>24,e=V>>>16&255,H=65535&V,!(h<=T);){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}if(0===(240&e)){for(i=h,W=e,s=H;V=C.distcode[s+((j&(1<<i+W)-1)>>i)],h=V>>>24,e=V>>>16&255,H=65535&V,!(i+h<=T);){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}j>>>=i,T-=i,C.back+=i}if(j>>>=h,T-=h,C.back+=h,64&e){Y.YC="invalid distance code",C.mode=N;break}C.offset=H,C.extra=15&e,C.mode=24;case 24:if(C.extra){for(a=C.extra;T<a;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}C.offset+=j&(1<<C.extra)-1,j>>>=C.extra,T-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){Y.YC="invalid distance too far back",C.mode=N;break}C.mode=25;case 25:if(0===X)break Y;if(U=J-X,C.offset>U){if(U=C.offset-U,U>C.whave&&C.sane){Y.YC="invalid distance too far back",C.mode=N;break}U>C.wnext?(U-=C.wnext,o=C.wsize-U):o=C.wnext-U,U>C.length&&(U=C.length),G=C.window}else G=L,o=c-C.offset,U=C.length;U>X&&(U=X),X-=U,C.length-=U;do{L[c++]=G[o++]}while(--U);0===C.length&&(C.mode=21);break;case 26:if(0===X)break Y;L[c++]=C.length,X--,C.mode=21;break;case 27:if(C.wrap){for(;T<32;){if(0===l)break Y;l--,j|=mY[u++]<<T,T+=8}if(J-=X,Y.total_out+=J,C.total+=J,J&&(Y.adler=C.check=C.flags?q(C.check,L,J,c-J):R(C.check,L,J,c-J)),J=X,(C.flags?j:p(j))!==C.check){Y.YC="incorrect data check",C.mode=N;break}j=0,T=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;T<32;){if(0===l)break Y;l--,j+=mY[u++]<<T,T+=8}if(j!==(4294967295&C.total)){Y.YC="incorrect length check",C.mode=N;break}j=0,T=0}C.mode=29;case 29:d=F;break Y;case N:d=n;break Y;case 31:return t;default:return S}return Y.next_out=c,Y.avail_out=X,Y.next_in=u,Y.avail_in=l,C.hold=j,C.bits=T,(C.wsize||J!==Y.avail_out&&C.mode<N&&(C.mode<27||b!==B))&&v(Y,Y.output,Y.next_out,J-Y.avail_out)?(C.mode=31,t):(z-=Y.avail_in,J-=Y.avail_out,Y.total_in+=z,Y.total_out+=J,C.total+=J,C.wrap&&J&&(Y.adler=C.check=C.flags?q(C.check,L,J,Y.next_out-J):R(C.check,L,J,Y.next_out-J)),Y.data_type=C.bits+(C.last?64:0)+(C.mode===Q?128:0)+(20===C.mode||15===C.mode?256:0),(0===z&&0===J||b===B)&&d===O&&(d=I),d)},Y.exports.inflateEnd=Y=>{if(!Y||!Y.state)return S;let b=Y.state;return b.window&&(b.window=null),Y.state=null,O},Y.exports.inflateGetHeader=(Y,b)=>{if(!Y||!Y.state)return S;const C=Y.state;return 0===(2&C.wrap)?S:(C.head=b,b.done=!1,O)},Y.exports.inflateSetDictionary=(Y,b)=>{const C=b.length;let q,A,E;return Y&&Y.state?(q=Y.state,0!==q.wrap&&11!==q.mode?S:11===q.mode&&(A=1,A=R(A,b,C,0),A!==q.check)?n:(E=v(Y,b,C,C),E?(q.mode=31,t):(q.havedict=1,O))):S},Y.exports.inflateInfo="pako inflate (from Nodeca project)"},14970:Y=>{"use strict";const b=15,C=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),R=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),q=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),A=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);Y.exports=(Y,E,B,g,r,O,F,y)=>{const S=y.bits;let n,t,I,w,Q,N,p=0,mY=0,L=0,u=0,c=0,l=0,X=0,j=0,T=0,P=0,v=null,z=0;const J=new Uint16Array(16),U=new Uint16Array(16);let o,G,h,e=null,H=0;for(p=0;p<=b;p++)J[p]=0;for(mY=0;mY<g;mY++)J[E[B+mY]]++;for(c=S,u=b;u>=1&&0===J[u];u--);if(c>u&&(c=u),0===u)return r[O++]=20971520,r[O++]=20971520,y.bits=1,0;for(L=1;L<u&&0===J[L];L++);for(c<L&&(c=L),j=1,p=1;p<=b;p++)if(j<<=1,j-=J[p],j<0)return-1;if(j>0&&(0===Y||1!==u))return-1;for(U[1]=0,p=1;p<b;p++)U[p+1]=U[p]+J[p];for(mY=0;mY<g;mY++)0!==E[B+mY]&&(F[U[E[B+mY]]++]=mY);if(0===Y?(v=e=F,N=19):1===Y?(v=C,z-=257,e=R,H-=257,N=256):(v=q,e=A,N=-1),P=0,mY=0,p=L,Q=O,l=c,X=0,I=-1,T=1<<c,w=T-1,1===Y&&T>852||2===Y&&T>592)return 1;for(;;){o=p-X,F[mY]<N?(G=0,h=F[mY]):F[mY]>N?(G=e[H+F[mY]],h=v[z+F[mY]]):(G=96,h=0),n=1<<p-X,t=1<<l,L=t;do{t-=n,r[Q+(P>>X)+t]=o<<24|G<<16|h}while(0!==t);for(n=1<<p-1;P&n;)n>>=1;if(0!==n?(P&=n-1,P+=n):P=0,mY++,0===--J[p]){if(p===u)break;p=E[B+F[mY]]}if(p>c&&(P&w)!==I){for(0===X&&(X=c),Q+=L,l=p-X,j=1<<l;l+X<u&&(j-=J[l+X],!(j<=0));)l++,j<<=1;if(T+=1<<l,1===Y&&T>852||2===Y&&T>592)return 1;I=P&w,r[I]=c<<24|l<<16|Q-O}}return 0!==P&&(r[Q+P]=p-X<<24|64<<16),y.bits=c,0}},14920:Y=>{"use strict";Y.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14906:Y=>{"use strict";function b(Y){let b=Y.length;for(;--b>=0;)Y[b]=0}const C=256,R=286,q=30,A=15,E=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),B=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),g=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),r=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),O=new Array(576);b(O);const F=new Array(60);b(F);const y=new Array(512);b(y);const S=new Array(256);b(S);const n=new Array(29);b(n);const t=new Array(q);function I(Y,b,C,R,q){this.static_tree=Y,this.extra_bits=b,this.extra_base=C,this.elems=R,this.max_length=q,this.has_stree=Y&&Y.length}let w,Q,N;function p(Y,b){this.dyn_tree=Y,this.max_code=0,this.stat_desc=b}b(t);const mY=Y=>Y<256?y[Y]:y[256+(Y>>>7)],L=(Y,b)=>{Y.pending_buf[Y.pending++]=255&b,Y.pending_buf[Y.pending++]=b>>>8&255},u=(Y,b,C)=>{Y.bi_valid>16-C?(Y.bi_buf|=b<<Y.bi_valid&65535,L(Y,Y.bi_buf),Y.bi_buf=b>>16-Y.bi_valid,Y.bi_valid+=C-16):(Y.bi_buf|=b<<Y.bi_valid&65535,Y.bi_valid+=C)},c=(Y,b,C)=>{u(Y,C[2*b],C[2*b+1])},l=(Y,b)=>{let C=0;do{C|=1&Y,Y>>>=1,C<<=1}while(--b>0);return C>>>1},X=(Y,b,C)=>{const R=new Array(16);let q,E,B=0;for(q=1;q<=A;q++)R[q]=B=B+C[q-1]<<1;for(E=0;E<=b;E++){let b=Y[2*E+1];0!==b&&(Y[2*E]=l(R[b]++,b))}},j=Y=>{let b;for(b=0;b<R;b++)Y.dyn_ltree[2*b]=0;for(b=0;b<q;b++)Y.dyn_dtree[2*b]=0;for(b=0;b<19;b++)Y.bl_tree[2*b]=0;Y.dyn_ltree[512]=1,Y.opt_len=Y.static_len=0,Y.last_lit=Y.matches=0},T=Y=>{Y.bi_valid>8?L(Y,Y.bi_buf):Y.bi_valid>0&&(Y.pending_buf[Y.pending++]=Y.bi_buf),Y.bi_buf=0,Y.bi_valid=0},P=(Y,b,C,R)=>{const q=2*b,A=2*C;return Y[q]<Y[A]||Y[q]===Y[A]&&R[b]<=R[C]},v=(Y,b,C)=>{const R=Y.heap[C];let q=C<<1;for(;q<=Y.heap_len&&(q<Y.heap_len&&P(b,Y.heap[q+1],Y.heap[q],Y.depth)&&q++,!P(b,R,Y.heap[q],Y.depth));)Y.heap[C]=Y.heap[q],C=q,q<<=1;Y.heap[C]=R},z=(Y,b,R)=>{let q,A,g,r,O=0;if(0!==Y.last_lit)do{q=Y.pending_buf[Y.d_buf+2*O]<<8|Y.pending_buf[Y.d_buf+2*O+1],A=Y.pending_buf[Y.l_buf+O],O++,0===q?c(Y,A,b):(g=S[A],c(Y,g+C+1,b),r=E[g],0!==r&&(A-=n[g],u(Y,A,r)),q--,g=mY(q),c(Y,g,R),r=B[g],0!==r&&(q-=t[g],u(Y,q,r)))}while(O<Y.last_lit);c(Y,256,b)},J=(Y,b)=>{const C=b.dyn_tree,R=b.stat_desc.static_tree,q=b.stat_desc.has_stree,E=b.stat_desc.elems;let B,g,r,O=-1;for(Y.heap_len=0,Y.heap_max=573,B=0;B<E;B++)0!==C[2*B]?(Y.heap[++Y.heap_len]=O=B,Y.depth[B]=0):C[2*B+1]=0;for(;Y.heap_len<2;)r=Y.heap[++Y.heap_len]=O<2?++O:0,C[2*r]=1,Y.depth[r]=0,Y.opt_len--,q&&(Y.static_len-=R[2*r+1]);for(b.max_code=O,B=Y.heap_len>>1;B>=1;B--)v(Y,C,B);r=E;do{B=Y.heap[1],Y.heap[1]=Y.heap[Y.heap_len--],v(Y,C,1),g=Y.heap[1],Y.heap[--Y.heap_max]=B,Y.heap[--Y.heap_max]=g,C[2*r]=C[2*B]+C[2*g],Y.depth[r]=(Y.depth[B]>=Y.depth[g]?Y.depth[B]:Y.depth[g])+1,C[2*B+1]=C[2*g+1]=r,Y.heap[1]=r++,v(Y,C,1)}while(Y.heap_len>=2);Y.heap[--Y.heap_max]=Y.heap[1],((Y,b)=>{const C=b.dyn_tree,R=b.max_code,q=b.stat_desc.static_tree,E=b.stat_desc.has_stree,B=b.stat_desc.extra_bits,g=b.stat_desc.extra_base,r=b.stat_desc.max_length;let O,F,y,S,n,t,I=0;for(S=0;S<=A;S++)Y.bl_count[S]=0;for(C[2*Y.heap[Y.heap_max]+1]=0,O=Y.heap_max+1;O<573;O++)F=Y.heap[O],S=C[2*C[2*F+1]+1]+1,S>r&&(S=r,I++),C[2*F+1]=S,F>R||(Y.bl_count[S]++,n=0,F>=g&&(n=B[F-g]),t=C[2*F],Y.opt_len+=t*(S+n),E&&(Y.static_len+=t*(q[2*F+1]+n)));if(0!==I){do{for(S=r-1;0===Y.bl_count[S];)S--;Y.bl_count[S]--,Y.bl_count[S+1]+=2,Y.bl_count[r]--,I-=2}while(I>0);for(S=r;0!==S;S--)for(F=Y.bl_count[S];0!==F;)y=Y.heap[--O],y>R||(C[2*y+1]!==S&&(Y.opt_len+=(S-C[2*y+1])*C[2*y],C[2*y+1]=S),F--)}})(Y,b),X(C,O,Y.bl_count)},U=(Y,b,C)=>{let R,q,A=-1,E=b[1],B=0,g=7,r=4;for(0===E&&(g=138,r=3),b[2*(C+1)+1]=65535,R=0;R<=C;R++)q=E,E=b[2*(R+1)+1],++B<g&&q===E||(B<r?Y.bl_tree[2*q]+=B:0!==q?(q!==A&&Y.bl_tree[2*q]++,Y.bl_tree[32]++):B<=10?Y.bl_tree[34]++:Y.bl_tree[36]++,B=0,A=q,0===E?(g=138,r=3):q===E?(g=6,r=3):(g=7,r=4))},o=(Y,b,C)=>{let R,q,A=-1,E=b[1],B=0,g=7,r=4;for(0===E&&(g=138,r=3),R=0;R<=C;R++)if(q=E,E=b[2*(R+1)+1],!(++B<g&&q===E)){if(B<r)do{c(Y,q,Y.bl_tree)}while(0!==--B);else 0!==q?(q!==A&&(c(Y,q,Y.bl_tree),B--),c(Y,16,Y.bl_tree),u(Y,B-3,2)):B<=10?(c(Y,17,Y.bl_tree),u(Y,B-3,3)):(c(Y,18,Y.bl_tree),u(Y,B-11,7));B=0,A=q,0===E?(g=138,r=3):q===E?(g=6,r=3):(g=7,r=4)}};let G=!1;const h=(Y,b,C,R)=>{u(Y,0+(R?1:0),3),((Y,b,C,R)=>{T(Y),R&&(L(Y,C),L(Y,~C)),Y.pending_buf.set(Y.window.subarray(b,b+C),Y.pending),Y.pending+=C})(Y,b,C,!0)};Y.exports._tr_init=Y=>{G||((()=>{let Y,b,C,r,p;const mY=new Array(16);for(C=0,r=0;r<28;r++)for(n[r]=C,Y=0;Y<1<<E[r];Y++)S[C++]=r;for(S[C-1]=r,p=0,r=0;r<16;r++)for(t[r]=p,Y=0;Y<1<<B[r];Y++)y[p++]=r;for(p>>=7;r<q;r++)for(t[r]=p<<7,Y=0;Y<1<<B[r]-7;Y++)y[256+p++]=r;for(b=0;b<=A;b++)mY[b]=0;for(Y=0;Y<=143;)O[2*Y+1]=8,Y++,mY[8]++;for(;Y<=255;)O[2*Y+1]=9,Y++,mY[9]++;for(;Y<=279;)O[2*Y+1]=7,Y++,mY[7]++;for(;Y<=287;)O[2*Y+1]=8,Y++,mY[8]++;for(X(O,287,mY),Y=0;Y<q;Y++)F[2*Y+1]=5,F[2*Y]=l(Y,5);w=new I(O,E,257,R,A),Q=new I(F,B,0,q,A),N=new I(new Array(0),g,0,19,7)})(),G=!0),Y.l_desc=new p(Y.dyn_ltree,w),Y.d_desc=new p(Y.dyn_dtree,Q),Y.bl_desc=new p(Y.bl_tree,N),Y.bi_buf=0,Y.bi_valid=0,j(Y)},Y.exports._tr_stored_block=h,Y.exports._tr_flush_block=(Y,b,R,q)=>{let A,E,B=0;Y.level>0?(2===Y.strm.data_type&&(Y.strm.data_type=(Y=>{let b,R=4093624447;for(b=0;b<=31;b++,R>>>=1)if(1&R&&0!==Y.dyn_ltree[2*b])return 0;if(0!==Y.dyn_ltree[18]||0!==Y.dyn_ltree[20]||0!==Y.dyn_ltree[26])return 1;for(b=32;b<C;b++)if(0!==Y.dyn_ltree[2*b])return 1;return 0})(Y)),J(Y,Y.l_desc),J(Y,Y.d_desc),B=(Y=>{let b;for(U(Y,Y.dyn_ltree,Y.l_desc.max_code),U(Y,Y.dyn_dtree,Y.d_desc.max_code),J(Y,Y.bl_desc),b=18;b>=3&&0===Y.bl_tree[2*r[b]+1];b--);return Y.opt_len+=3*(b+1)+5+5+4,b})(Y),A=Y.opt_len+3+7>>>3,E=Y.static_len+3+7>>>3,E<=A&&(A=E)):A=E=R+5,R+4<=A&&-1!==b?h(Y,b,R,q):4===Y.strategy||E===A?(u(Y,2+(q?1:0),3),z(Y,O,F)):(u(Y,4+(q?1:0),3),((Y,b,C,R)=>{let q;for(u(Y,b-257,5),u(Y,C-1,5),u(Y,R-4,4),q=0;q<R;q++)u(Y,Y.bl_tree[2*r[q]+1],3);o(Y,Y.dyn_ltree,b-1),o(Y,Y.dyn_dtree,C-1)})(Y,Y.l_desc.max_code+1,Y.d_desc.max_code+1,B+1),z(Y,Y.dyn_ltree,Y.dyn_dtree)),j(Y),q&&T(Y)},Y.exports._tr_tally=(Y,b,R)=>(Y.pending_buf[Y.d_buf+2*Y.last_lit]=b>>>8&255,Y.pending_buf[Y.d_buf+2*Y.last_lit+1]=255&b,Y.pending_buf[Y.l_buf+Y.last_lit]=255&R,Y.last_lit++,0===b?Y.dyn_ltree[2*R]++:(Y.matches++,b--,Y.dyn_ltree[2*(S[R]+C+1)]++,Y.dyn_dtree[2*mY(b)]++),Y.last_lit===Y.lit_bufsize-1),Y.exports._tr_align=Y=>{u(Y,2,3),c(Y,256,O),(Y=>{16===Y.bi_valid?(L(Y,Y.bi_buf),Y.bi_buf=0,Y.bi_valid=0):Y.bi_valid>=8&&(Y.pending_buf[Y.pending++]=255&Y.bi_buf,Y.bi_buf>>=8,Y.bi_valid-=8)})(Y)}},14939:Y=>{"use strict";Y.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.YC="",this.state=null,this.data_type=2,this.adler=0}},13622:Y=>{function b(Y,b,C){for(var R=Y.length,q=-1/0,A=1/0,E=0;E<R;E++){var B=(C[0][E]-Y[E])/b[E],g=(C[1][E]-Y[E])/b[E];if(B>g){var r=B;B=g,g=r}if(g<q||B>A)return 1/0;B>q&&(q=B),g<A&&(A=g)}return q>A?1/0:q}Y.exports=function(Y,C,R,q){var A=b(C,R,q);if(A===1/0)Y=null;else{Y=Y||[];for(var E=0;E<C.length;E++)Y[E]=C[E]+R[E]*A}return Y},Y.exports.distance=b},15063:(Y,b,C)=>{"use strict";C.d(b,{c:()=>E});var R=C(33);const q=R.useLayoutEffect;const A=function(Y){var b=(0,R.useRef)(Y);return q((function(){b.current=Y})),b};var E=function(Y){var b=A(Y);(0,R.tb)((function(){var Y=function(Y){var C;if(null!=b.current&&(C=b.current(Y)),Y.defaultPrevented&&(Y.returnValue=""),"string"===typeof C)return Y.returnValue=C,C};return window.addEventListener("beforeunload",Y),function(){window.removeEventListener("beforeunload",Y)}}),[])}},15013:(Y,b,C)=>{"use strict";var R=C(15020),q=Array.prototype.concat,A=Array.prototype.slice,E=Y.exports=function(Y){for(var b=[],C=0,E=Y.length;C<E;C++){var B=Y[C];R(B)?b=q.call(b,A.call(B)):b.push(B)}return b};E.wrap=function(Y){return function(){return Y(E(arguments))}}},15020:Y=>{Y.exports=function(Y){return!(!Y||"string"===typeof Y)&&(Y instanceof Array||Array.isArray(Y)||Y.length>=0&&(Y.splice instanceof Function||Object.getOwnPropertyDescriptor(Y,Y.length-1)&&"String"!==Y.constructor.name))}},14831:(Y,b,C)=>{var R=C(14838);function q(Y){for(var b,C,q=0,A=Y.length,E=0;E<Y.length;){for(b=Y[E],C=0;E<A&&Y[E]===b;)++E,++C;q+=R.log2(C)/7|0,q+=R.log2(b>>>0)/7|0,q+=2}return q}b.size=q,b.encode=function(Y,b){b||(b=new Uint8Array(q(Y)));for(var C,R,A=0,E=b.length,B=0;B<Y.length;){for(C=Y[B],R=0;B<Y.length&&Y[B]===C;)++B,++R;for(;A<E&&R>=128;)b[A++]=128+(127&R),R>>>=7;if(A>=E)throw new Error("RLE buffer overflow");for(b[A++]=R,C>>>=0;A<E&&C>=128;)b[A++]=128+(127&C),C>>>=7;if(A>=E)throw new Error("RLE buffer overflow");b[A++]=C}return b},b.decode=function(Y,b){for(var C,R,q,A,E=b.length,B=Y.length,g=0,r=0;r<B;){for(C=0,R=0;r<B&&Y[r]>=128;)C+=(127&Y[r++])<<R,R+=7;if(C+=Y[r++]<<R,r>=B)throw new Error("RLE buffer underrun");if(g+C>E)throw new Error("Chunk buffer overflow");for(q=0,R=0;r<B&&Y[r]>=128;)q+=(127&Y[r++])<<R,R+=7;if(r>=B)throw new Error("RLE buffer underrun");for(q+=Y[r++]<<R,A=0;A<C;++A)b[g++]=q}return b}},14838:(Y,b)=>{"use strict";function C(Y){var b=32;return(Y&=-Y)&&b--,65535&Y&&(b-=16),16711935&Y&&(b-=8),252645135&Y&&(b-=4),858993459&Y&&(b-=2),1431655765&Y&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(Y){return(Y>0)-(Y<0)},b.abs=function(Y){var b=Y>>31;return(Y^b)-b},b.min=function(Y,b){return b^(Y^b)&-(Y<b)},b.max=function(Y,b){return Y^(Y^b)&-(Y<b)},b.isPow2=function(Y){return!(Y&Y-1)&&!!Y},b.log2=function(Y){var b,C;return b=(Y>65535)<<4,b|=C=((Y>>>=b)>255)<<3,b|=C=((Y>>>=C)>15)<<2,(b|=C=((Y>>>=C)>3)<<1)|(Y>>>=C)>>1},b.log10=function(Y){return Y>=1e9?9:Y>=1e8?8:Y>=1e7?7:Y>=1e6?6:Y>=1e5?5:Y>=1e4?4:Y>=1e3?3:Y>=100?2:Y>=10?1:0},b.popCount=function(Y){return 16843009*((Y=(858993459&(Y-=Y>>>1&1431655765))+(Y>>>2&858993459))+(Y>>>4)&252645135)>>>24},b.countTrailingZeros=C,b.nextPow2=function(Y){return Y+=0===Y,--Y,Y|=Y>>>1,Y|=Y>>>2,Y|=Y>>>4,Y|=Y>>>8,(Y|=Y>>>16)+1},b.prevPow2=function(Y){return Y|=Y>>>1,Y|=Y>>>2,Y|=Y>>>4,Y|=Y>>>8,(Y|=Y>>>16)-(Y>>>1)},b.parity=function(Y){return Y^=Y>>>16,Y^=Y>>>8,Y^=Y>>>4,27030>>>(Y&=15)&1};var R=new Array(256);!function(Y){for(var b=0;b<256;++b){var C=b,R=b,q=7;for(C>>>=1;C;C>>>=1)R<<=1,R|=1&C,--q;Y[b]=R<<q&255}}(R),b.reverse=function(Y){return R[255&Y]<<24|R[Y>>>8&255]<<16|R[Y>>>16&255]<<8|R[Y>>>24&255]},b.interleave2=function(Y,b){return(Y=1431655765&((Y=858993459&((Y=252645135&((Y=16711935&((Y&=65535)|Y<<8))|Y<<4))|Y<<2))|Y<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(Y,b){return(Y=65535&((Y=16711935&((Y=252645135&((Y=858993459&((Y=Y>>>b&1431655765)|Y>>>1))|Y>>>2))|Y>>>4))|Y>>>16))<<16>>16},b.interleave3=function(Y,b,C){return Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2),(Y|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},b.deinterleave3=function(Y,b){return(Y=1023&((Y=4278190335&((Y=251719695&((Y=3272356035&((Y=Y>>>b&1227133513)|Y>>>2))|Y>>>4))|Y>>>8))|Y>>>16))<<22>>22},b.nextCombination=function(Y){var b=Y|Y-1;return b+1|(~b&-~b)-1>>>C(Y)+1}},14880:Y=>{"use strict";Y.exports=function(Y,b,C,R){var q=self||window;try{try{var A;try{A=new q.Blob([Y])}catch(r){(A=new(q.BlobBuilder||q.WebKitBlobBuilder||q.MozBlobBuilder||q.MSBlobBuilder)).append(Y),A=A.getBlob()}var E=q.URL||q.webkitURL,B=E.createObjectURL(A),g=new q[b](B,C);return E.revokeObjectURL(B),g}catch(r){return new q[b]("data:application/javascript,".concat(encodeURIComponent(Y)),C)}}catch(r){if(!R)throw Error("Inline worker is not supported");return new q[b](R,C)}}},13605:(Y,b,C)=>{"use strict";function R(Y,b,C,R,q){var A={};return Object.keys(R).forEach((function(Y){A[Y]=R[Y]})),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=C.slice().reverse().reduce((function(C,R){return R(Y,b,C)||C}),A),q&&void 0!==A.initializer&&(A.value=A.initializer?A.initializer.call(q):void 0,A.initializer=void 0),void 0===A.initializer&&(Object.defineProperty(Y,b,A),A=null),A}C.d(b,{b:()=>R})},13600:(Y,b,C)=>{"use strict";function R(Y,b,C,R){C&&Object.defineProperty(Y,b,{enumerable:C.enumerable,configurable:C.configurable,writable:C.writable,value:C.initializer?C.initializer.call(R):void 0})}C.d(b,{d:()=>R})},15050:(Y,b,C)=>{"use strict";C.d(b,{b:()=>E,e:()=>F,g:()=>B,h:()=>A,i:()=>g,m:()=>q,o:()=>r,q:()=>O});var R=C(13046);class q{constructor(){this._easingMode=q.EASINGMODE_EASEIN}setEasingMode(Y){const b=Math.min(Math.max(Y,0),2);this._easingMode=b}getEasingMode(){return this._easingMode}easeInCore(Y){throw new Error("You must implement this method")}ease(Y){switch(this._easingMode){case q.EASINGMODE_EASEIN:return this.easeInCore(Y);case q.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-Y)}return Y>=.5?.5*(1-this.easeInCore(2*(1-Y)))+.5:.5*this.easeInCore(2*Y)}}q.EASINGMODE_EASEIN=0,q.EASINGMODE_EASEOUT=1,q.EASINGMODE_EASEINOUT=2;class A extends q{easeInCore(Y){return Y=Math.max(0,Math.min(1,Y)),1-Math.sqrt(1-Y*Y)}}class E extends q{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=Y}easeInCore(Y){const b=Math.max(0,this.amplitude);return Math.pow(Y,3)-Y*b*Math.sin(3.141592653589793*Y)}}class B extends q{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=Y,this.bounciness=b}easeInCore(Y){const b=Math.max(0,this.bounces);let C=this.bounciness;C<=1&&(C=1.001);const R=Math.pow(C,b),q=1-C,A=(1-R)/q+.5*R,E=Y*A,B=Math.log(-E*(1-C)+1)/Math.log(C),g=Math.floor(B),r=g+1,O=(1-Math.pow(C,g))/(q*A),F=.5*(O+(1-Math.pow(C,r))/(q*A)),y=Y-F,S=F-O;return-Math.pow(1/C,b-g)/(S*S)*(y-S)*(y+S)}}class g extends q{easeInCore(Y){return Y*Y*Y}}class r extends q{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=Y,this.springiness=b}easeInCore(Y){let b;const C=Math.max(0,this.oscillations),R=Math.max(0,this.springiness);return b=0==R?Y:(Math.exp(R*Y)-1)/(Math.exp(R)-1),b*Math.sin((6.283185307179586*C+1.5707963267948966)*Y)}}class O extends q{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=Y}easeInCore(Y){return this.exponent<=0?Y:(Math.exp(this.exponent*Y)-1)/(Math.exp(this.exponent)-1)}}class F extends q{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=Y,this.y1=b,this.x2=C,this.y2=R}easeInCore(Y){return R.d.Interpolate(Y,this.x1,this.y1,this.x2,this.y2)}}},14341:(Y,b,C)=>{"use strict";C.d(b,{d:()=>E});var R=C(12831),q=C(12846),A=C(13242);class E extends A.d{get _matrix(){return this._compose(),this.QS}set _matrix(Y){(Y.updateFlag!==this.QS.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.QS.q(Y),this._markAsDirtyAndDecompose())}constructor(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(Y,b.uY(),!1),this.name=Y,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=b,this.QS=(null===q||void 0===q?void 0:q.clone())??R.Matrix.Identity(),this._restMatrix=A??this.QS.clone(),this._bindMatrix=E??this.QS.clone(),this._index=B,this._absoluteMatrix=new R.Matrix,this._absoluteBindMatrix=new R.Matrix,this._absoluteInverseBindMatrix=new R.Matrix,this._finalMatrix=new R.Matrix,b.bones.push(this),this.setParent(C,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(Y){this.setParent(Y)}setParent(Y){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==Y){if(this.parent){const Y=this.parent.children.indexOf(this);-1!==Y&&this.parent.children.splice(Y,1)}this._parentNode=Y,this.parent&&this.parent.children.push(this),b&&this._updateAbsoluteBindMatrices(),this.JO()}}getLocalMatrix(){return this._compose(),this.QS}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(Y){this._restMatrix.q(Y)}setRestPose(Y){this.setRestMatrix(Y)}getBindPose(){return this.getBindMatrix()}setBindMatrix(Y){this.jb(Y)}setBindPose(Y){this.setBindMatrix(Y)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const Y=R.TmpVectors.AC[0],b=R.TmpVectors.Quaternion[0],C=R.TmpVectors.AC[1];this.getRestMatrix().decompose(Y,b,C),this._linkedTransformNode.position.q(C),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??R.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.q(b),this._linkedTransformNode.ob.q(Y)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(Y){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=Y,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.jg}set position(Y){this._decompose(),this.jg.q(Y),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(Y){this.setRotation(Y)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(Y){this.setRotationQuaternion(Y)}get ob(){return this.getScale()}set ob(Y){this.setScale(Y)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=R.AC.Zero(),this._localRotation=R.Quaternion.Zero(),this.jg=R.AC.Zero()),this.QS.decompose(this._localScaling,this._localRotation,this.jg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,R.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.jg,this.QS)):this._needToCompose=!1)}jb(Y){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.q(Y),b&&this._updateAbsoluteBindMatrices(),C?this._matrix=Y:this.JO()}_updateAbsoluteBindMatrices(Y){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Y||(Y=this._bindMatrix),this.parent?Y.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.q(Y),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),b)for(let C=0;C<this.children.length;C++)this.children[C]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}JO(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.JO(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.JO(),this._needToDecompose=!0}_updatePosition(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=this.getLocalMatrix();if(0==b)q?(A.addAtIndex(12,Y.x),A.addAtIndex(13,Y.y),A.addAtIndex(14,Y.z)):A.setTranslationFromFloats(Y.x,Y.y,Y.z);else{let b=null;C&&(b=C.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=E._TmpMats[0],g=E._TmpVecs[0];this.parent?C&&b?(B.q(this.parent.getAbsoluteMatrix()),B.multiplyToRef(b,B)):B.q(this.parent.getAbsoluteMatrix()):R.Matrix.IdentityToRef(B),q&&B.setTranslationFromFloats(0,0,0),B.invert(),R.AC.TransformCoordinatesToRef(Y,B,g),q?(A.addAtIndex(12,g.x),A.addAtIndex(13,g.y),A.addAtIndex(14,g.z)):A.setTranslationFromFloats(g.x,g.y,g.z)}this._markAsDirtyAndDecompose()}translate(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(Y,b,C,!0)}setPosition(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(Y,b,C,!1)}setAbsolutePosition(Y,b){this.setPosition(Y,1,b)}scale(Y,b,C){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=this.getLocalMatrix(),B=E._TmpMats[0];R.Matrix.ScalingToRef(Y,b,C,B),B.multiplyToRef(A,A),B.invert();for(const R of this.children){const q=R.getLocalMatrix();q.multiplyToRef(B,q),q.multiplyAtIndex(12,Y),q.multiplyAtIndex(13,b),q.multiplyAtIndex(14,C),R._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),q)for(const R of this.children)R.scale(Y,b,C,q)}setScale(Y){this._decompose(),this._localScaling.q(Y),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(Y){this._decompose(),Y.q(this._localScaling)}setYawPitchRoll(Y,b,C){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4?arguments[4]:void 0;if(0===q){const B=E._TmpQuat;return R.Quaternion.RotationYawPitchRollToRef(Y,b,C,B),void this.setRotationQuaternion(B,q,A)}const B=E._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,A))return;const g=E._TmpMats[1];R.Matrix.RotationYawPitchRollToRef(Y,b,C,g),B.multiplyToRef(g,g),this._rotateWithMatrix(g,q,A)}rotate(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3?arguments[3]:void 0;const A=E._TmpMats[0];A.setTranslationFromFloats(0,0,0),R.Matrix.RotationAxisToRef(Y,b,A),this._rotateWithMatrix(A,C,q)}setAxisAngle(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3?arguments[3]:void 0;if(0===C){const A=E._TmpQuat;return R.Quaternion.RotationAxisToRef(Y,b,A),void this.setRotationQuaternion(A,C,q)}const A=E._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,q))return;const B=E._TmpMats[1];R.Matrix.RotationAxisToRef(Y,b,B),A.multiplyToRef(B,B),this._rotateWithMatrix(B,C,q)}setRotation(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(Y.y,Y.x,Y.z,b,C)}setRotationQuaternion(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===b)return this._decompose(),this._localRotation.q(Y),void this._markAsDirtyAndCompose();const q=E._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,C))return;const A=E._TmpMats[1];R.Matrix.FromQuaternionToRef(Y,A),q.multiplyToRef(A,A),this._rotateWithMatrix(A,b,C)}setRotationMatrix(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===b){const q=E._TmpQuat;return R.Quaternion.FromRotationMatrixToRef(Y,q),void this.setRotationQuaternion(q,b,C)}const q=E._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,C))return;const A=E._TmpMats[1];A.q(Y),q.multiplyToRef(Y,A),this._rotateWithMatrix(A,b,C)}_rotateWithMatrix(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const R=this.getLocalMatrix(),q=R.m[12],A=R.m[13],B=R.m[14],g=this.getParent(),r=E._TmpMats[3],O=E._TmpMats[4];g&&1==b?(C?(r.q(C.getWorldMatrix()),g.getAbsoluteMatrix().multiplyToRef(r,r)):r.q(g.getAbsoluteMatrix()),O.q(r),O.invert(),R.multiplyToRef(r,R),R.multiplyToRef(Y,R),R.multiplyToRef(O,R)):1==b&&C?(r.q(C.getWorldMatrix()),O.q(r),O.invert(),R.multiplyToRef(r,R),R.multiplyToRef(Y,R),R.multiplyToRef(O,R)):R.multiplyToRef(Y,R),R.setTranslationFromFloats(q,A,B),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(Y,b){const C=E._TmpMats[2];return Y.q(this.getAbsoluteMatrix()),b?(Y.multiplyToRef(b.getWorldMatrix(),Y),R.Matrix.ScalingToRef(b.ob.x,b.ob.y,b.ob.z,C)):R.Matrix.IdentityToRef(C),Y.invert(),!isNaN(Y.m[0])&&(C.multiplyAtIndex(0,this._scalingDeterminant),Y.multiplyToRef(C,Y),!0)}Bb(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=R.AC.Zero();return this.getPositionToRef(Y,b,C),C}getPositionToRef(){let Y=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const Y=this.getLocalMatrix();b.x=Y.m[12],b.y=Y.m[13],b.z=Y.m[14]}else{let C=null;Y&&(C=Y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let R=E._TmpMats[0];Y&&C?(R.q(this.getAbsoluteMatrix()),R.multiplyToRef(C,R)):R=this.getAbsoluteMatrix(),b.x=R.m[12],b.y=R.m[13],b.z=R.m[14]}}getAbsolutePosition(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=R.AC.Zero();return this.getPositionToRef(1,Y,b),b}getAbsolutePositionToRef(Y,b){this.getPositionToRef(1,Y,b)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.QS.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.q(this.QS);const Y=this._skeleton.getPoseMatrix();Y&&this._absoluteMatrix.multiplyToRef(Y,this._absoluteMatrix)}const Y=this.children,b=Y.length;for(let C=0;C<b;C++)Y[C].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}rr(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=R.AC.Zero();return this.getDirectionToRef(Y,b,C),C}getDirectionToRef(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,q=null;b&&(q=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=E._TmpMats[0];A.q(this.getAbsoluteMatrix()),b&&q&&A.multiplyToRef(q,A),R.AC.TransformNormalToRef(Y,A,C),C.normalize()}getRotation(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=R.AC.Zero();return this.getRotationToRef(Y,b,C),C}getRotationToRef(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;const R=E._TmpQuat;this.getRotationQuaternionToRef(Y,b,R),R.toEulerAnglesToRef(C)}getRotationQuaternion(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=R.Quaternion.Identity();return this.getRotationQuaternionToRef(Y,b,C),C}getRotationQuaternionToRef(){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),b.q(this._localRotation);else{const C=E._TmpMats[0],R=this.getAbsoluteMatrix();Y?R.multiplyToRef(Y.getWorldMatrix(),C):C.q(R),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.decompose(void 0,b,void 0)}}getRotationMatrix(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0;const C=R.Matrix.Identity();return this.getRotationMatrixToRef(Y,b,C),C}getRotationMatrixToRef(){let Y=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(b);else{const C=E._TmpMats[0],R=this.getAbsoluteMatrix();Y?R.multiplyToRef(Y.getWorldMatrix(),C):C.q(R),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.getRotationMatrixToRef(b)}}getAbsolutePositionFromLocal(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=R.AC.Zero();return this.getAbsolutePositionFromLocalToRef(Y,b,C),C}getAbsolutePositionFromLocalToRef(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,q=null;b&&(q=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=E._TmpMats[0];A.q(this.getAbsoluteMatrix()),b&&q&&A.multiplyToRef(q,A),R.AC.TransformCoordinatesToRef(Y,A,C)}getLocalPositionFromAbsolute(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=R.AC.Zero();return this.getLocalPositionFromAbsoluteToRef(Y,b,C),C}getLocalPositionFromAbsoluteToRef(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,q=null;b&&(q=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=E._TmpMats[0];A.q(this.getAbsoluteMatrix()),b&&q&&A.multiplyToRef(q,A),A.invert(),R.AC.TransformCoordinatesToRef(Y,A,C)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const Y=this._skeleton.bones.indexOf(this);if(-1!==Y&&this._skeleton.bones.splice(Y,1),this._parentNode&&this._parentNode.children){const Y=this._parentNode.children,b=Y.indexOf(this);-1!==b&&Y.splice(b,1)}super.dispose()}}E._TmpVecs=(0,q.e)(2,R.AC.Zero),E._TmpQuat=R.Quaternion.Identity(),E._TmpMats=(0,q.e)(5,R.Matrix.Identity)},15046:(Y,b,C)=>{"use strict";C.d(b,{d:()=>J});var R=C(12818),q=C(12821),A=C(12652),E=C(12831),B=C(12852),g=C(13242),r=C(13273),O=C(13099),F=C(12681),y=C(12837);class S{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(Y){this._zoomStopsAnimation=Y}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(Y){this._idleRotationSpeed=Y}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(Y){this._idleRotationWaitTime=Y}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(Y){this._idleRotationSpinupTime=Y}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(Y){this._attachedCamera=Y;const b=this._attachedCamera.uY();this._onPrePointerObservableObserver=b.onPrePointerObservable.add((Y=>{Y.type!==O.d.POINTERDOWN?Y.type===O.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=Y.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const Y=F.d.Now;let b=0;null!=this._lastFrameTime&&(b=Y-this._lastFrameTime),this._lastFrameTime=Y,this._applyUserInteraction();const C=Y-this._lastInteractionTime-this._idleRotationWaitTime,R=Math.max(Math.min(C/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*R,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(b/1e3))}))}detach(){if(!this._attachedCamera)return;const Y=this._attachedCamera.uY();this._onPrePointerObservableObserver&&Y.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(Y){this._lastInteractionTime=Y??F.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<y.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let Y=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(Y=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?Y:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=F.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var n=C(15050),t=C(13351);class I{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(Y){if(this._autoTransitionRange===Y)return;this._autoTransitionRange=Y;const b=this._attachedCamera;b&&(Y?this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((Y=>{if(Y&&(Y.Tb(!0),Y.getBoundingInfo)){const b=Y.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*b,this.upperRadiusTransitionRange=.05*b}})):this._onMeshTargetChangedObserver&&b.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(Y){this._attachedCamera=Y,this._onAfterCheckInputsObserver=Y.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(Y){return!!this._attachedCamera&&(this._attachedCamera.radius===Y&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(Y){if(!this._attachedCamera)return;this._radiusBounceTransition||(I.EasingFunction.setEasingMode(I.EasingMode),this._radiusBounceTransition=t.e.CreateAnimation("radius",t.e.ANIMATIONTYPE_FLOAT,60,I.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const b=t.e.TransitionTo("radius",this._attachedCamera.radius+Y,this._attachedCamera,this._attachedCamera.uY(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));b&&this._animatables.push(b)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}I.EasingFunction=new n.b(.3),I.EasingMode=n.m.EASINGMODE_EASEOUT;class w{constructor(){this.onTargetFramingAnimationEndObservable=new A.d,this._mode=w.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(Y){this._mode=Y}get mode(){return this._mode}set radiusScale(Y){this._radiusScale=Y}get radiusScale(){return this._radiusScale}set positionScale(Y){this._positionScale=Y}get positionScale(){return this._positionScale}set defaultElevation(Y){this._defaultElevation=Y}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(Y){this._elevationReturnTime=Y}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(Y){this._elevationReturnWaitTime=Y}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(Y){this._zoomStopsAnimation=Y}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(Y){this._framingTime=Y}get framingTime(){return this._framingTime}init(){}attach(Y){this._attachedCamera=Y;const b=this._attachedCamera.uY();w.EasingFunction.setEasingMode(w.EasingMode),this._onPrePointerObservableObserver=b.onPrePointerObservable.add((Y=>{Y.type!==O.d.POINTERDOWN?Y.type===O.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=Y.onMeshTargetChangedObservable.add((Y=>{Y&&Y.getBoundingInfo&&this.zoomOnMesh(Y,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=Y.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const Y=this._attachedCamera.uY();this._onPrePointerObservableObserver&&Y.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Y.Tb(!0);const R=Y.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(R.minimumWorld,R.maximumWorld,b,C)}zoomOnMeshHierarchy(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Y.Tb(!0);const R=Y.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(R.min,R.max,b,C)}zoomOnMeshesHierarchy(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new E.AC(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),q=new E.AC(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let A=0;A<Y.length;A++){const b=Y[A].getHierarchyBoundingVectors(!0);E.AC.CheckExtends(b.min,R,q),E.AC.CheckExtends(b.max,R,q)}this.zoomOnBoundingInfo(R,q,b,C)}zoomOnBoundingInfo(Y,b){let C,R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const A=Y.y,B=A+(b.y-A)*this._positionScale,g=b.EC(Y).scale(.5);if(!isFinite(B))return!1;if(R)C=new E.AC(0,B,0);else{const b=Y.add(g);C=new E.AC(b.x,B,b.z)}this._vectorTransition||(this._vectorTransition=t.e.CreateAnimation("target",t.e.ANIMATIONTYPE_VECTOR3,60,w.EasingFunction)),this._betaIsAnimating=!0;let r=t.e.TransitionTo("target",C,this._attachedCamera,this._attachedCamera.uY(),60,this._vectorTransition,this._framingTime);r&&this._animatables.push(r);let O=0;if(this._mode===w.FitFrustumSidesMode){const C=this._calculateLowerRadiusFromModelBoundingSphere(Y,b);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=g.length()+this._attachedCamera.Xb),O=C}else this._mode===w.IgnoreBoundsSizeMode&&(O=this._calculateLowerRadiusFromModelBoundingSphere(Y,b),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Xb));if(this.autoCorrectCameraLimitsAndSensibility){const C=b.EC(Y).length();this._attachedCamera.panningSensibility=5e3/C,this._attachedCamera.wheelPrecision=100/O}return this._radiusTransition||(this._radiusTransition=t.e.CreateAnimation("radius",t.e.ANIMATIONTYPE_FLOAT,60,w.EasingFunction)),r=t.e.TransitionTo("radius",O,this._attachedCamera,this._attachedCamera.uY(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),q&&q(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),r&&this._animatables.push(r),!0}_calculateLowerRadiusFromModelBoundingSphere(Y,b){const C=this._attachedCamera;if(!C)return 0;let R=C._calculateLowerRadiusFromModelBoundingSphere(Y,b,this._radiusScale);return C.lowerRadiusLimit&&this._mode===w.IgnoreBoundsSizeMode&&(R=R<C.lowerRadiusLimit?C.lowerRadiusLimit:R),C.upperRadiusLimit&&(R=R>C.upperRadiusLimit?C.upperRadiusLimit:R),R}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const Y=F.d.Now-this._lastInteractionTime,b=.5*Math.PI-this._defaultElevation,C=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>C&&Y>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=t.e.CreateAnimation("beta",t.e.ANIMATIONTYPE_FLOAT,60,w.EasingFunction));const Y=t.e.TransitionTo("beta",b,this._attachedCamera,this._attachedCamera.uY(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));Y&&this._animatables.push(Y)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=F.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}w.EasingFunction=new n.q,w.EasingMode=n.m.EASINGMODE_EASEINOUT,w.IgnoreBoundsSizeMode=0,w.FitFrustumSidesMode=1;var Q=C(13279),N=C(13314),p=C(14334),mY=C(12645);class L{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(Y){Y=mY.Tools.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),C=b.getInputElement();let R=0,q=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=A=>{var E,B;const g=A.event,r="touch"===g.pointerType;if(A.type!==O.d.POINTERMOVE&&-1===this.buttons.indexOf(g.button))return;const F=g.target;if(this._altKey=g.altKey,this._ctrlKey=g.ctrlKey,this._metaKey=g.metaKey,this._shiftKey=g.shiftKey,this._buttonsPressed=g.buttons,b.isPointerLock){const Y=g.movementX,b=g.movementY;this.onTouch(null,Y,b),this._pointA=null,this._pointB=null}else{if(A.type!==O.d.POINTERDOWN&&A.type!==O.d.POINTERDOUBLETAP&&r&&(null===(E=this._pointA)||void 0===E?void 0:E.pointerId)!==g.pointerId&&(null===(B=this._pointB)||void 0===B?void 0:B.pointerId)!==g.pointerId)return;if(A.type!==O.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!r)if(A.type===O.d.POINTERDOUBLETAP)this.onDoubleTap(g.pointerType);else if(A.type!==O.d.POINTERUP||this._currentMousePointerIdDown!==g.pointerId&&!r){if(A.type===O.d.POINTERMOVE)if(Y||g.preventDefault(),this._pointA&&null===this._pointB){const Y=g.clientX-this._pointA.x,b=g.clientY-this._pointA.y;this._pointA.x=g.clientX,this._pointA.y=g.clientY,this.onTouch(this._pointA,Y,b)}else if(this._pointA&&this._pointB){const Y=this._pointA.pointerId===g.pointerId?this._pointA:this._pointB;Y.x=g.clientX,Y.y=g.clientY;const b=this._pointA.x-this._pointB.x,C=this._pointA.y-this._pointB.y,E=b*b+C*C,B={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:g.pointerId,type:A.type};this.onMultiTouch(this._pointA,this._pointB,R,E,q,B),q=B,R=E}}else{try{null===F||void 0===F||F.releasePointerCapture(g.pointerId)}catch(y){}r||(this._pointB=null),b._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==g.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==g.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==R||q)&&(this.onMultiTouch(this._pointA,this._pointB,R,0,q,null),R=0,q=null),this._currentMousePointerIdDown=-1,this.onButtonUp(g),Y||g.preventDefault()}else{try{null===F||void 0===F||F.setPointerCapture(g.pointerId)}catch(y){}if(null===this._pointA)this._pointA={x:g.clientX,y:g.clientY,pointerId:g.pointerId,type:g.pointerType};else{if(null!==this._pointB)return;this._pointB={x:g.clientX,y:g.clientY,pointerId:g.pointerId,type:g.pointerType}}-1!==this._currentMousePointerIdDown||r||(this._currentMousePointerIdDown=g.pointerId),this.onButtonDown(g),Y||(g.preventDefault(),C&&C.focus())}}},this._observer=this.camera.uY()._inputManager._addCameraPointerObserver(this._pointerInput,O.d.POINTERDOWN|O.d.POINTERUP|O.d.POINTERMOVE|O.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,R=0,q=null,this.onLostFocus()},this._contextMenuBind=Y=>this.onContextMenu(Y),C&&C.addEventListener("contextmenu",this._contextMenuBind,!1);const A=this.camera.uY().getEngine().getHostWindow();A&&mY.Tools.RegisterTopRootEvents(A,[{name:"blur",handler:this._onLostFocus}])}uy(){if(this._onLostFocus){const Y=this.camera.uY().getEngine().getHostWindow();Y&&mY.Tools.UnregisterTopRootEvents(Y,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.uY()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const Y=this.camera.uY().getEngine().getInputElement();Y&&Y.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(Y){}onTouch(Y,b,C){}onMultiTouch(Y,b,C,R,q,A){}onContextMenu(Y){Y.preventDefault()}onButtonDown(Y){}onButtonUp(Y){}onLostFocus(){}}(0,R.c)([(0,q.K)()],L.prototype,"buttons",void 0);class u extends L{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(Y,b){if(0!==this.panningSensibility&&Y&&b){const C=b.x-Y.x,R=b.y-Y.y;this.camera.inertialPanningX+=-C/this.panningSensibility,this.camera.inertialPanningY+=R/this.panningSensibility}}_computePinchZoom(Y,b){const C=this.camera.radius||u.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=C*Math.sqrt(Y)/Math.sqrt(b):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(b-Y)*C*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(b-Y)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(Y,b,C){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility):(this.camera.inertialAlphaOffset-=b/this.angularSensibilityX,this.camera.inertialBetaOffset-=C/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(Y,b,C,R,q,A){0===C&&null===q||0===R&&null===A||(this.multiTouchPanAndZoom?(this._computePinchZoom(C,R),this._computeMultiTouchPanning(q,A)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(R)-Math.sqrt(C))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(C,R),this._isPinching=!0):this._computeMultiTouchPanning(q,A)):this.multiTouchPanning?this._computeMultiTouchPanning(q,A):this.pinchZoom&&this._computePinchZoom(C,R))}onButtonDown(Y){this._isPanClick=Y.button===this.camera._panningMouseButton}onButtonUp(Y){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}u.MinimumRadiusForPinch=.001,(0,R.c)([(0,q.K)()],u.prototype,"buttons",void 0),(0,R.c)([(0,q.K)()],u.prototype,"angularSensibilityX",void 0),(0,R.c)([(0,q.K)()],u.prototype,"angularSensibilityY",void 0),(0,R.c)([(0,q.K)()],u.prototype,"pinchPrecision",void 0),(0,R.c)([(0,q.K)()],u.prototype,"pinchDeltaPercentage",void 0),(0,R.c)([(0,q.K)()],u.prototype,"useNaturalPinchZoom",void 0),(0,R.c)([(0,q.K)()],u.prototype,"pinchZoom",void 0),(0,R.c)([(0,q.K)()],u.prototype,"panningSensibility",void 0),(0,R.c)([(0,q.K)()],u.prototype,"multiTouchPanning",void 0),(0,R.c)([(0,q.K)()],u.prototype,"multiTouchPanAndZoom",void 0),p.c.ArcRotateCameraPointersInput=u;var c=C(13105);class l{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(Y){Y=mY.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.uY(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const C=b.event;if(!C.metaKey)if(b.type===c.c.KEYDOWN){if(this._ctrlPressed=C.ctrlKey,this._altPressed=C.altKey,-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),C.preventDefault&&(Y||C.preventDefault())}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){const b=this._keys.indexOf(C.keyCode);b>=0&&this._keys.splice(b,1),C.preventDefault&&(Y||C.preventDefault())}})))}uy(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Y=this.camera;for(let b=0;b<this._keys.length;b++){const C=this._keys[b];-1!==this.keysLeft.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Y.inertialPanningX-=1/this.panningSensibility:Y.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Y.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Y.inertialRadiusOffset+=1/this.zoomingSensibility:Y.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Y.inertialPanningX+=1/this.panningSensibility:Y.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Y.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Y.inertialRadiusOffset-=1/this.zoomingSensibility:Y.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(C)&&Y.useInputToRestoreState&&Y.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,R.c)([(0,q.K)()],l.prototype,"keysUp",void 0),(0,R.c)([(0,q.K)()],l.prototype,"keysDown",void 0),(0,R.c)([(0,q.K)()],l.prototype,"keysLeft",void 0),(0,R.c)([(0,q.K)()],l.prototype,"keysRight",void 0),(0,R.c)([(0,q.K)()],l.prototype,"keysReset",void 0),(0,R.c)([(0,q.K)()],l.prototype,"panningSensibility",void 0),(0,R.c)([(0,q.K)()],l.prototype,"zoomingSensibility",void 0),(0,R.c)([(0,q.K)()],l.prototype,"useAltToZoom",void 0),(0,R.c)([(0,q.K)()],l.prototype,"angularSpeed",void 0),p.c.ArcRotateCameraKeyboardMoveInput=l;var X=C(12889),j=C(13112);class T{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new E.AC(0,0,0),this._globalOffset=new E.AC(0,0,0),this._inertialPanning=E.AC.Zero()}_computeDeltaFromMouseWheelLegacyEvent(Y,b){let C=0;const R=.01*Y*this.wheelDeltaPercentage*b;return C=Y>0?R/(1+this.wheelDeltaPercentage):R*(1+this.wheelDeltaPercentage),C}attachControl(Y){Y=mY.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==O.d.POINTERWHEEL)return;const C=b.event;let R=0;const q=C.deltaMode===j.c.DOM_DELTA_LINE?40:1,A=-C.deltaY*q;if(this.customComputeDeltaFromMouseWheel)R=this.customComputeDeltaFromMouseWheel(A,this,C);else if(this.wheelDeltaPercentage){if(R=this._computeDeltaFromMouseWheelLegacyEvent(A,this.camera.radius),R>0){let Y=this.camera.radius,b=this.camera.inertialRadiusOffset+R;for(let C=0;C<20&&!(Y<=b)&&!(Math.abs(b*this.camera.inertia)<.001);C++)Y-=b,b*=this.camera.inertia;Y=(0,B.Clamp)(Y,0,Number.MAX_VALUE),R=this._computeDeltaFromMouseWheelLegacyEvent(A,Y)}}else R=A/(40*this.wheelPrecision);R&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(R)):this.camera.inertialRadiusOffset+=R),C.preventDefault&&(Y||C.preventDefault())},this._observer=this.camera.uY()._inputManager._addCameraPointerObserver(this._wheel,O.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Gb(0)}uy(){this._observer&&(this.camera.uY()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const Y=this.camera;0+Y.inertialAlphaOffset+Y.inertialBetaOffset+Y.inertialRadiusOffset&&(this._updateHitPlane(),Y.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(Y.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const Y=this.camera,b=Y.target.EC(Y.position);this._hitPlane=X.d.FromPositionAndNormal(Y.target,b)}_getPosition(){const Y=this.camera,b=Y.uY(),C=b.createPickingRay(b.pointerX,b.pointerY,E.Matrix.Identity(),Y,!1);0===Y.targetScreenOffset.x&&0===Y.targetScreenOffset.y||(this._viewOffset.set(Y.targetScreenOffset.x,Y.targetScreenOffset.y,0),Y.getViewMatrix().invertToRef(Y._cameraTransformMatrix),this._globalOffset=E.AC.TransformNormal(this._viewOffset,Y._cameraTransformMatrix),C.origin.addInPlace(this._globalOffset));let R=0;return this._hitPlane&&(R=C.intersectsPlane(this._hitPlane)??0),C.origin.addInPlace(C.direction.scaleInPlace(R))}_zoomToMouse(Y){const b=this.camera,C=1-b.inertia;if(b.lowerRadiusLimit){const R=b.lowerRadiusLimit??0;b.radius-(b.inertialRadiusOffset+Y)/C<R&&(Y=(b.radius-R)*C-b.inertialRadiusOffset)}if(b.upperRadiusLimit){const R=b.upperRadiusLimit??0;b.radius-(b.inertialRadiusOffset+Y)/C>R&&(Y=(b.radius-R)*C-b.inertialRadiusOffset)}const R=Y/C/b.radius,q=this._getPosition(),A=E.TmpVectors.AC[6];q.subtractToRef(b.target,A),A.scaleInPlace(R),A.scaleInPlace(C),this._inertialPanning.addInPlace(A),b.inertialRadiusOffset+=Y}_zeroIfClose(Y){Math.abs(Y.x)<y.e&&(Y.x=0),Math.abs(Y.y)<y.e&&(Y.y=0),Math.abs(Y.z)<y.e&&(Y.z=0)}}(0,R.c)([(0,q.K)()],T.prototype,"wheelPrecision",void 0),(0,R.c)([(0,q.K)()],T.prototype,"zoomToMouseLocation",void 0),(0,R.c)([(0,q.K)()],T.prototype,"wheelDeltaPercentage",void 0),p.c.ArcRotateCameraMouseWheelInput=T;class P extends p.d{constructor(Y){super(Y)}addMouseWheel(){return this.add(new T),this}addPointers(){return this.add(new u),this}addKeyboard(){return this.add(new l),this}}var v=C(12790);function z(Y,b){return isNaN(Y)?b:Y}g.d.AddNodeConstructor("ArcRotateCamera",((Y,b)=>()=>new J(Y,0,0,1,E.AC.Zero(),b)));class J extends N.c{get target(){return this._target}set target(Y){this.setTarget(Y)}get targetHost(){return this._targetHost}set targetHost(Y){Y&&this.setTarget(Y)}getTarget(){return this.target}get position(){return this._position}set position(Y){this.setPosition(Y)}set upVector(Y){this._upToYMatrix||(this._yToUpMatrix=new E.Matrix,this._upToYMatrix=new E.Matrix,this._upVector=E.AC.Zero()),Y.normalize(),this._upVector.q(Y),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){E.Matrix.RotationAlignToRef(E.AC.UpReadOnly,this._upVector,this._yToUpMatrix),E.Matrix.RotationAlignToRef(this._upVector,E.AC.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const Y=this.inputs.attached.pointers;return Y?Y.angularSensibilityX:0}set angularSensibilityX(Y){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityX=Y)}get angularSensibilityY(){const Y=this.inputs.attached.pointers;return Y?Y.angularSensibilityY:0}set angularSensibilityY(Y){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityY=Y)}get pinchPrecision(){const Y=this.inputs.attached.pointers;return Y?Y.pinchPrecision:0}set pinchPrecision(Y){const b=this.inputs.attached.pointers;b&&(b.pinchPrecision=Y)}get pinchDeltaPercentage(){const Y=this.inputs.attached.pointers;return Y?Y.pinchDeltaPercentage:0}set pinchDeltaPercentage(Y){const b=this.inputs.attached.pointers;b&&(b.pinchDeltaPercentage=Y)}get useNaturalPinchZoom(){const Y=this.inputs.attached.pointers;return!!Y&&Y.useNaturalPinchZoom}set useNaturalPinchZoom(Y){const b=this.inputs.attached.pointers;b&&(b.useNaturalPinchZoom=Y)}get panningSensibility(){const Y=this.inputs.attached.pointers;return Y?Y.panningSensibility:0}set panningSensibility(Y){const b=this.inputs.attached.pointers;b&&(b.panningSensibility=Y)}get keysUp(){const Y=this.inputs.attached.keyboard;return Y?Y.keysUp:[]}set keysUp(Y){const b=this.inputs.attached.keyboard;b&&(b.keysUp=Y)}get keysDown(){const Y=this.inputs.attached.keyboard;return Y?Y.keysDown:[]}set keysDown(Y){const b=this.inputs.attached.keyboard;b&&(b.keysDown=Y)}get keysLeft(){const Y=this.inputs.attached.keyboard;return Y?Y.keysLeft:[]}set keysLeft(Y){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=Y)}get keysRight(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRight:[]}set keysRight(Y){const b=this.inputs.attached.keyboard;b&&(b.keysRight=Y)}get wheelPrecision(){const Y=this.inputs.attached.mousewheel;return Y?Y.wheelPrecision:0}set wheelPrecision(Y){const b=this.inputs.attached.mousewheel;b&&(b.wheelPrecision=Y)}get zoomToMouseLocation(){const Y=this.inputs.attached.mousewheel;return!!Y&&Y.zoomToMouseLocation}set zoomToMouseLocation(Y){const b=this.inputs.attached.mousewheel;b&&(b.zoomToMouseLocation=Y)}get wheelDeltaPercentage(){const Y=this.inputs.attached.mousewheel;return Y?Y.wheelDeltaPercentage:0}set wheelDeltaPercentage(Y){const b=this.inputs.attached.mousewheel;b&&(b.wheelDeltaPercentage=Y)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(Y){Y!==this.useBouncingBehavior&&(Y?(this._bouncingBehavior=new I,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(Y){Y!==this.useFramingBehavior&&(Y?(this._framingBehavior=new w,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(Y){Y!==this.useAutoRotationBehavior&&(Y?(this._autoRotationBehavior=new S,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(Y,b,C,R,q,B){var g;let r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(Y,E.AC.Zero(),B,r),g=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=E.AC.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=E.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new E.Matrix,this.panningAxis=new E.AC(1,1,0),this._transformedDirection=new E.AC,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new A.d,this.checkCollisions=!1,this.collisionRadius=new E.AC(.5,.5,.5),this._previousPosition=E.AC.Zero(),this._collisionVelocity=E.AC.Zero(),this._newPosition=E.AC.Zero(),this._computationVector=E.AC.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new E.AC(NaN,NaN,NaN),this._goalTargetScreenOffset=new E.Vector2(NaN,NaN),this._onCollisionPositionChange=function(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C?(g.setPosition(b),g.Fn&&g.Fn(C)):g._previousPosition.q(g._position);const R=Math.cos(g.alpha),q=Math.sin(g.alpha),A=Math.cos(g.beta);let E=Math.sin(g.beta);0===E&&(E=1e-4);const B=g._getTargetPosition();g._computationVector.Ub(g.radius*R*E,g.radius*A,g.radius*q*E),B.addToRef(g._computationVector,g._newPosition),g._position.q(g._newPosition);let r=g.upVector;g.allowUpsideDown&&g.beta<0&&(r=r.clone(),r=r.negate()),g._computeViewMatrix(g._position,B,r),g._viewMatrix.addAtIndex(12,g.targetScreenOffset.x),g._viewMatrix.addAtIndex(13,g.targetScreenOffset.y),g._collisionTriggered=!1},this._target=E.AC.Zero(),q&&this.setTarget(q),this.alpha=b,this.beta=C,this.radius=R,this.getViewMatrix(),this.inputs=new P(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new E.AC(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=E.Vector2.Zero()}_updateCache(Y){Y||super._updateCache(),this._cache._target.q(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.q(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const Y=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?Y.addToRef(this._targetBoundingCenter,this._target):this._target.q(Y)}const Y=this._getLockedTargetPosition();return Y||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>y.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,A=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=A?this._currentInterpolationFactor=A:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=z(Y,this._goalAlpha),this._goalBeta=z(b,this._goalBeta),this._goalRadius=z(C,this._goalRadius),this._goalTarget.set(z(R.x,this._goalTarget.x),z(R.y,this._goalTarget.y),z(R.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(z(q.x,this._goalTargetScreenOffset.x),z(q.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,B.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,B.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,B.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,B.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(Y,b){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const q=arguments;b=mY.Tools.BackCompatCameraNoPreventDefault(q),this._useCtrlForPanning=C,this._panningMouseButton=R,"boolean"===typeof q[0]&&(q.length>1&&(this._useCtrlForPanning=q[1]),q.length>2&&(this._panningMouseButton=q[2])),this.inputs.attachElement(b),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}uy(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let Y=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){Y=!0;const b=this.invertRotation?-1:1,C=this._calculateHandednessMultiplier();let R=this.inertialAlphaOffset*C;this.beta<0&&(R*=-1),this.alpha+=R*b,this.beta+=this.inertialBetaOffset*b,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<y.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<y.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*y.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){Y=!0;const b=new E.AC(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),b.multiplyInPlace(this.panningAxis),E.AC.TransformNormalToRef(b,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const Y=this.upVector,b=E.AC.CrossToRef(this._transformedDirection,Y,this._transformedDirection);E.AC.CrossToRef(Y,b,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);E.AC.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.q(this._transformedDirection)}else{if(this.parent){const Y=E.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(Y),Y.transposeToRef(Y),E.AC.TransformCoordinatesToRef(this._transformedDirection,Y,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*y.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*y.e&&(this.inertialPanningY=0)}if(Y)this.stopInterpolation();else if(this._isInterpolating){let Y=!1;const b=this._scene.getEngine().getDeltaTime()/1e3,C=1-Math.pow(2,-b/this._currentInterpolationFactor),R=z(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const b=E.TmpVectors.AC[0].set(z(this._goalTarget.x,this._target.x),z(this._goalTarget.y,this._target.y),z(this._goalTarget.z,this._target.z));E.AC.LerpToRef(this.target,b,C,this._target),10*E.AC.Distance(this.target,b)/R<y.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.q(b),this.setTarget(this.target,!1,!0,!0)):Y=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const b=E.Quaternion.RotationAlphaBetaGammaToRef(z(this._goalAlpha,this.alpha),z(this._goalBeta,this.beta),0,E.TmpVectors.Quaternion[0]),R=E.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,E.TmpVectors.Quaternion[1]),q=E.Quaternion.SlerpToRef(R,b,C,E.TmpVectors.Quaternion[2]);q.normalize();const A=q.toAlphaBetaGammaToRef(E.TmpVectors.AC[0]);if(this.alpha=A.x,this.beta=A.y,q.isApprox(b,y.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const Y=b.toAlphaBetaGammaToRef(E.TmpVectors.AC[0]);this.alpha=Y.x,this.beta=Y.y}else Y=!0}if(isNaN(this._goalRadius)||(this.radius+=(R-this.radius)*C,Math.abs(R/this.radius-1)<y.e?(this._goalRadius=NaN,this.radius=R):Y=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const b=E.TmpVectors.Vector2[0].set(z(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),z(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));E.Vector2.LerpToRef(this.targetScreenOffset,b,C,this.targetScreenOffset),E.Vector2.Distance(this.targetScreenOffset,b)<y.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.q(b)):Y=!0}this._isInterpolating=Y}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||E.AC.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const Y=this.alpha;var b,C;this.alpha=function(Y){let b=Math.PI/2;return 0===Y.x&&0===Y.z||(b=Math.acos(Y.x/Math.sqrt(Math.pow(Y.x,2)+Math.pow(Y.z,2)))),Y.z<0&&(b=2*Math.PI-b),b}(this._computationVector),this.beta=(b=this._computationVector.y,C=this.radius,Math.acos(b/C));const R=Math.round((Y-this.alpha)/(2*Math.PI));this.alpha+=2*R*Math.PI,this._checkLimits()}setPosition(Y){this._position.equals(Y)||(this._position.q(Y),this.rebuildAnglesAndRadius())}setTarget(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(R=this.overrideCloneAlphaBetaRadius??R,Y.Tb)b&&Y.getBoundingInfo?this._targetBoundingCenter=Y.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,Y.Tb(),this._targetHost=Y,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const b=Y,R=this._getTargetPosition();if(R&&!C&&R.equals(b))return;this._targetHost=null,this._target=b,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}R||this.rebuildAnglesAndRadius()}_getViewMatrix(){const Y=Math.cos(this.alpha),b=Math.sin(this.alpha),C=Math.cos(this.beta);let R=Math.sin(this.beta);0===R&&(R=1e-4),0===this.radius&&(this.radius=1e-4);const q=this._getTargetPosition();if(this._computationVector.Ub(this.radius*Y*R,this.radius*C,this.radius*b*R),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||E.AC.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),q.addToRef(this._computationVector,this._newPosition),this.uY().collisionsEnabled&&this.checkCollisions){const Y=this.uY().collisionCoordinator;this._collider||(this._collider=Y.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,Y.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.q(this._newPosition);let Y=this.upVector;this.allowUpsideDown&&R<0&&(Y=Y.negate()),this._computeViewMatrix(this._position,q,Y),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.q(q),this._viewMatrix}zoomOn(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Y=Y||this.uY().meshes;const C=r.d.MinMax(Y);let R=this._calculateLowerRadiusFromModelBoundingSphere(C.min,C.max);if(R=Math.max(Math.min(R,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=R*this.zoomOnFactor,this.mode===Q.c.ORTHOGRAPHIC_CAMERA){const Y=this.uY().getEngine().getAspectRatio(this),b=R*this.zoomOnFactor/2;this.orthoLeft=-b*Y,this.orthoRight=b*Y,this.orthoBottom=-b,this.orthoTop=b}this.focusOn({min:C.min,max:C.max,distance:R},b)}focusOn(Y){let b,C,R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===Y.min){const R=Y||this.uY().meshes;b=r.d.MinMax(R),C=E.AC.Distance(b.min,b.max)}else{b=Y,C=Y.distance}this._target=r.d.Center(b),R||(this.maxZ=2*C)}createRigCamera(Y,b){let C=0;switch(this.cameraRigMode){case Q.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Q.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Q.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case Q.c.RIG_MODE_VR:C=this._cameraRigParams.stereoHalfAngle*(0===b?1:-1);break;case Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:C=this._cameraRigParams.stereoHalfAngle*(0===b?-1:1)}const R=new J(Y,this.alpha+C,this.beta,this.radius,this._target,this.uY());return R._cameraRigParams={},R.isRigCamera=!0,R.rigParent=this,R.upVector=this.upVector,R.mode=this.mode,R.orthoLeft=this.orthoLeft,R.orthoRight=this.orthoRight,R.orthoBottom=this.orthoBottom,R.orthoTop=this.orthoTop,R}_updateRigCameras(){const Y=this._rigCameras[0],b=this._rigCameras[1];switch(Y.beta=b.beta=this.beta,this.cameraRigMode){case Q.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Q.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Q.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case Q.c.RIG_MODE_VR:Y.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Y.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const R=E.AC.Distance(Y,b),q=this.uY().getEngine().getAspectRatio(this),A=Math.tan(this.fov/2),B=A*q,g=.5*R*C,r=g*Math.sqrt(1+1/(B*B)),O=g*Math.sqrt(1+1/(A*A));return Math.max(r,O)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,R.c)([(0,q.K)()],J.prototype,"alpha",void 0),(0,R.c)([(0,q.K)()],J.prototype,"beta",void 0),(0,R.c)([(0,q.K)()],J.prototype,"radius",void 0),(0,R.c)([(0,q.K)()],J.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,R.c)([(0,q.H)("target")],J.prototype,"_target",void 0),(0,R.c)([(0,q.A)("targetHost")],J.prototype,"_targetHost",void 0),(0,R.c)([(0,q.K)()],J.prototype,"inertialAlphaOffset",void 0),(0,R.c)([(0,q.K)()],J.prototype,"inertialBetaOffset",void 0),(0,R.c)([(0,q.K)()],J.prototype,"inertialRadiusOffset",void 0),(0,R.c)([(0,q.K)()],J.prototype,"lowerAlphaLimit",void 0),(0,R.c)([(0,q.K)()],J.prototype,"upperAlphaLimit",void 0),(0,R.c)([(0,q.K)()],J.prototype,"lowerBetaLimit",void 0),(0,R.c)([(0,q.K)()],J.prototype,"upperBetaLimit",void 0),(0,R.c)([(0,q.K)()],J.prototype,"lowerRadiusLimit",void 0),(0,R.c)([(0,q.K)()],J.prototype,"upperRadiusLimit",void 0),(0,R.c)([(0,q.K)()],J.prototype,"lowerTargetYLimit",void 0),(0,R.c)([(0,q.K)()],J.prototype,"inertialPanningX",void 0),(0,R.c)([(0,q.K)()],J.prototype,"inertialPanningY",void 0),(0,R.c)([(0,q.K)()],J.prototype,"pinchToPanMaxDistance",void 0),(0,R.c)([(0,q.K)()],J.prototype,"panningDistanceLimit",void 0),(0,R.c)([(0,q.H)()],J.prototype,"panningOriginTarget",void 0),(0,R.c)([(0,q.K)()],J.prototype,"panningInertia",void 0),(0,R.c)([(0,q.K)()],J.prototype,"zoomToMouseLocation",null),(0,R.c)([(0,q.K)()],J.prototype,"zoomOnFactor",void 0),(0,R.c)([(0,q.G)()],J.prototype,"targetScreenOffset",void 0),(0,R.c)([(0,q.K)()],J.prototype,"allowUpsideDown",void 0),(0,R.c)([(0,q.K)()],J.prototype,"useInputToRestoreState",void 0),(0,R.c)([(0,q.K)()],J.prototype,"restoreStateInterpolationFactor",void 0),(0,v.g)("BABYLON.ArcRotateCamera",J)},14334:(Y,b,C)=>{"use strict";C.d(b,{c:()=>E,d:()=>B});var R=C(12669),q=C(12870),A=C(13279),E={};class B{constructor(Y){this.attachedToElement=!1,this.attached={},this.camera=Y,this.checkInputs=()=>{}}add(Y){const b=Y.getSimpleName();this.attached[b]?R.e.Warn("camera input of type "+b+" already exists on camera"):(this.attached[b]=Y,Y.camera=this.camera,Y.checkInputs&&(this.checkInputs=this._addCheckInputs(Y.checkInputs.bind(Y))),this.attachedToElement&&Y.attachControl(this.noPreventDefault))}remove(Y){for(const b in this.attached){const C=this.attached[b];if(C===Y)return C.uy(),C.camera=null,delete this.attached[b],void this.rebuildInputCheck()}}removeByType(Y){for(const b in this.attached){const C=this.attached[b];C.getClassName()===Y&&(C.uy(),C.camera=null,delete this.attached[b],this.rebuildInputCheck())}}_addCheckInputs(Y){const b=this.checkInputs;return()=>{b(),Y()}}attachInput(Y){this.attachedToElement&&Y.attachControl(this.noPreventDefault)}attachElement(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){Y=!A.c.ForceAttachControlToAlwaysPreventDefault&&Y,this.attachedToElement=!0,this.noPreventDefault=Y;for(const b in this.attached)this.attached[b].attachControl(Y)}}detachElement(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const b in this.attached)this.attached[b].uy(),Y&&(this.attached[b].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const Y in this.attached){const b=this.attached[Y];b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(Y){const b={};for(const C in this.attached){const Y=this.attached[C],R=q.e.Serialize(Y);b[Y.getClassName()]=R}Y.inputsmgr=b}parse(Y){const b=Y.inputsmgr;if(b){this.clear();for(const Y in b){const C=E[Y];if(C){const R=b[Y],A=q.e.Parse((()=>new C),R,null);this.add(A)}}}else for(const C in this.attached){const b=E[this.attached[C].getClassName()];if(b){const R=q.e.Parse((()=>new b),Y,null);this.remove(this.attached[C]),this.add(R)}}}}},14327:(Y,b,C)=>{"use strict";C.d(b,{d:()=>L});var R=C(12818),q=C(12821),A=C(12831),E=C(13314),B=C(14334),g=C(13105),r=C(12645);class O{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(Y){Y=r.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.uY(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const C=b.event;if(!C.metaKey)if(b.type===g.c.KEYDOWN){if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),Y||C.preventDefault()}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){const b=this._keys.indexOf(C.keyCode);b>=0&&this._keys.splice(b,1),Y||C.preventDefault()}})))}uy(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Y=this.camera;for(let b=0;b<this._keys.length;b++){const C=this._keys[b],R=Y._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(C)?Y._localDirection.Ub(-R,0,0):-1!==this.keysUp.indexOf(C)?Y._localDirection.Ub(0,0,R):-1!==this.keysRight.indexOf(C)?Y._localDirection.Ub(R,0,0):-1!==this.keysDown.indexOf(C)?Y._localDirection.Ub(0,0,-R):-1!==this.keysUpward.indexOf(C)?Y._localDirection.Ub(0,R,0):-1!==this.keysDownward.indexOf(C)?Y._localDirection.Ub(0,-R,0):-1!==this.keysRotateLeft.indexOf(C)?(Y._localDirection.Ub(0,0,0),Y.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(C)?(Y._localDirection.Ub(0,0,0),Y.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(C)?(Y._localDirection.Ub(0,0,0),Y.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(C)&&(Y._localDirection.Ub(0,0,0),Y.cameraRotation.x+=this._getLocalRotation()),Y.uY().useRightHandedSystem&&(Y._localDirection.z*=-1),Y.getViewMatrix().invertToRef(Y._cameraTransformMatrix),A.AC.TransformNormalToRef(Y._localDirection,Y._cameraTransformMatrix,Y._transformedDirection),Y.cameraDirection.addInPlace(Y._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const Y=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*Y}}(0,R.c)([(0,q.K)()],O.prototype,"keysUp",void 0),(0,R.c)([(0,q.K)()],O.prototype,"keysUpward",void 0),(0,R.c)([(0,q.K)()],O.prototype,"keysDown",void 0),(0,R.c)([(0,q.K)()],O.prototype,"keysDownward",void 0),(0,R.c)([(0,q.K)()],O.prototype,"keysLeft",void 0),(0,R.c)([(0,q.K)()],O.prototype,"keysRight",void 0),(0,R.c)([(0,q.K)()],O.prototype,"rotationSpeed",void 0),(0,R.c)([(0,q.K)()],O.prototype,"keysRotateLeft",void 0),(0,R.c)([(0,q.K)()],O.prototype,"keysRotateRight",void 0),(0,R.c)([(0,q.K)()],O.prototype,"keysRotateUp",void 0),(0,R.c)([(0,q.K)()],O.prototype,"keysRotateDown",void 0),B.c.FreeCameraKeyboardMoveInput=O;var F=C(12652),y=C(13099);class S{constructor(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=Y,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new F.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(Y){Y=r.Tools.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),C=b.getInputElement();this._pointerInput||(this._pointerInput=R=>{const q=R.event,A="touch"===q.pointerType;if(!this.touchEnabled&&A)return;if(R.type!==y.d.POINTERMOVE&&-1===this.buttons.indexOf(q.button))return;const E=q.target;if(R.type===y.d.POINTERDOWN){if(A&&-1!==this._activePointerId||!A&&-1!==this._currentActiveButton)return;this._activePointerId=q.pointerId;try{null===E||void 0===E||E.setPointerCapture(q.pointerId)}catch(B){}-1===this._currentActiveButton&&(this._currentActiveButton=q.button),this._previousPosition={x:q.clientX,y:q.clientY},Y||(q.preventDefault(),C&&C.focus()),b.isPointerLock&&this._onMouseMove&&this._onMouseMove(R.event)}else if(R.type===y.d.POINTERUP){if(A&&this._activePointerId!==q.pointerId||!A&&this._currentActiveButton!==q.button)return;try{null===E||void 0===E||E.releasePointerCapture(q.pointerId)}catch(B){}this._currentActiveButton=-1,this._previousPosition=null,Y||q.preventDefault(),this._activePointerId=-1}else if(R.type===y.d.POINTERMOVE&&(this._activePointerId===q.pointerId||!A))if(b.isPointerLock&&this._onMouseMove)this._onMouseMove(R.event);else if(this._previousPosition){const b=this.camera._calculateHandednessMultiplier(),C=(q.clientX-this._previousPosition.x)*b,R=q.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=C/this.angularSensibility,this.camera.cameraRotation.x+=R/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:C,offsetY:R}),this._previousPosition={x:q.clientX,y:q.clientY},Y||q.preventDefault()}}),this._onMouseMove=C=>{if(!b.isPointerLock)return;const R=this.camera._calculateHandednessMultiplier(),q=C.movementX*R;this.camera.cameraRotation.y+=q/this.angularSensibility;const A=C.movementY;this.camera.cameraRotation.x+=A/this.angularSensibility,this._previousPosition=null,Y||C.preventDefault()},this._observer=this.camera.uY()._inputManager._addCameraPointerObserver(this._pointerInput,y.d.POINTERDOWN|y.d.POINTERUP|y.d.POINTERMOVE),C&&(this._contextMenuBind=Y=>this.onContextMenu(Y),C.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(Y){Y.preventDefault()}uy(){if(this._observer){if(this.camera.uY()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const Y=this.camera.getEngine().getInputElement();Y&&Y.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,R.c)([(0,q.K)()],S.prototype,"buttons",void 0),(0,R.c)([(0,q.K)()],S.prototype,"angularSensibility",void 0),B.c.FreeCameraMouseInput=S;var n,t=C(13112);class I{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new F.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(Y){Y=r.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==y.d.POINTERWHEEL)return;const C=b.event,R=C.deltaMode===t.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*R*C.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*R*C.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*R*C.deltaZ/this._normalize,C.preventDefault&&(Y||C.preventDefault())},this._observer=this.camera.uY()._inputManager._addCameraPointerObserver(this._wheel,y.d.POINTERWHEEL)}uy(){this._observer&&(this.camera.uY()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,R.c)([(0,q.K)()],I.prototype,"wheelPrecisionX",void 0),(0,R.c)([(0,q.K)()],I.prototype,"wheelPrecisionY",void 0),(0,R.c)([(0,q.K)()],I.prototype,"wheelPrecisionZ",void 0),function(Y){Y[Y.MoveRelative=0]="MoveRelative",Y[Y.RotateRelative=1]="RotateRelative",Y[Y.MoveScene=2]="MoveScene"}(n||(n={}));class w extends I{constructor(){super(...arguments),this._moveRelative=A.AC.Zero(),this._rotateRelative=A.AC.Zero(),this._moveScene=A.AC.Zero(),this._wheelXAction=n.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=n.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(Y){null===Y&&this._wheelXAction!==n.MoveRelative||(this._wheelXAction=n.MoveRelative,this._wheelXActionCoordinate=Y)}get wheelXMoveRelative(){return this._wheelXAction!==n.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(Y){null===Y&&this._wheelYAction!==n.MoveRelative||(this._wheelYAction=n.MoveRelative,this._wheelYActionCoordinate=Y)}get wheelYMoveRelative(){return this._wheelYAction!==n.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(Y){null===Y&&this._wheelZAction!==n.MoveRelative||(this._wheelZAction=n.MoveRelative,this._wheelZActionCoordinate=Y)}get wheelZMoveRelative(){return this._wheelZAction!==n.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(Y){null===Y&&this._wheelXAction!==n.RotateRelative||(this._wheelXAction=n.RotateRelative,this._wheelXActionCoordinate=Y)}get wheelXRotateRelative(){return this._wheelXAction!==n.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(Y){null===Y&&this._wheelYAction!==n.RotateRelative||(this._wheelYAction=n.RotateRelative,this._wheelYActionCoordinate=Y)}get wheelYRotateRelative(){return this._wheelYAction!==n.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(Y){null===Y&&this._wheelZAction!==n.RotateRelative||(this._wheelZAction=n.RotateRelative,this._wheelZActionCoordinate=Y)}get wheelZRotateRelative(){return this._wheelZAction!==n.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(Y){null===Y&&this._wheelXAction!==n.MoveScene||(this._wheelXAction=n.MoveScene,this._wheelXActionCoordinate=Y)}get wheelXMoveScene(){return this._wheelXAction!==n.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(Y){null===Y&&this._wheelYAction!==n.MoveScene||(this._wheelYAction=n.MoveScene,this._wheelYActionCoordinate=Y)}get wheelYMoveScene(){return this._wheelYAction!==n.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(Y){null===Y&&this._wheelZAction!==n.MoveScene||(this._wheelZAction=n.MoveScene,this._wheelZActionCoordinate=Y)}get wheelZMoveScene(){return this._wheelZAction!==n.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Gb(0),this._rotateRelative.Gb(0),this._moveScene.Gb(0),this._updateCamera(),this.camera.uY().useRightHandedSystem&&(this._moveRelative.z*=-1);const Y=A.Matrix.Zero();this.camera.getViewMatrix().invertToRef(Y);const b=A.AC.Zero();A.AC.TransformNormalToRef(this._moveRelative,Y,b),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(b),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(Y,b,C){if(0===Y)return;if(null===b||null===C)return;let R=null;switch(b){case n.MoveRelative:R=this._moveRelative;break;case n.RotateRelative:R=this._rotateRelative;break;case n.MoveScene:R=this._moveScene}switch(C){case 0:R.set(Y,0,0);break;case 1:R.set(0,Y,0);break;case 2:R.set(0,0,Y)}}}(0,R.c)([(0,q.K)()],w.prototype,"wheelXMoveRelative",null),(0,R.c)([(0,q.K)()],w.prototype,"wheelYMoveRelative",null),(0,R.c)([(0,q.K)()],w.prototype,"wheelZMoveRelative",null),(0,R.c)([(0,q.K)()],w.prototype,"wheelXRotateRelative",null),(0,R.c)([(0,q.K)()],w.prototype,"wheelYRotateRelative",null),(0,R.c)([(0,q.K)()],w.prototype,"wheelZRotateRelative",null),(0,R.c)([(0,q.K)()],w.prototype,"wheelXMoveScene",null),(0,R.c)([(0,q.K)()],w.prototype,"wheelYMoveScene",null),(0,R.c)([(0,q.K)()],w.prototype,"wheelZMoveScene",null),B.c.FreeCameraMouseWheelInput=w;class Q{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=Y,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=r.Tools.IsSafari()}attachControl(Y){Y=r.Tools.BackCompatCameraNoPreventDefault(arguments);let b=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=C=>{const R=C.event,q="mouse"===R.pointerType||this._isSafari&&"undefined"===typeof R.pointerType;if(this.allowMouse||!q)if(C.type===y.d.POINTERDOWN){if(Y||R.preventDefault(),this._pointerPressed.push(R.pointerId),1!==this._pointerPressed.length)return;b={x:R.clientX,y:R.clientY}}else if(C.type===y.d.POINTERUP){Y||R.preventDefault();const C=this._pointerPressed.indexOf(R.pointerId);if(-1===C)return;if(this._pointerPressed.splice(C,1),0!=C)return;b=null,this._offsetX=null,this._offsetY=null}else if(C.type===y.d.POINTERMOVE){if(Y||R.preventDefault(),!b)return;if(0!=this._pointerPressed.indexOf(R.pointerId))return;this._offsetX=R.clientX-b.x,this._offsetY=-(R.clientY-b.y)}}),this._observer=this.camera.uY()._inputManager._addCameraPointerObserver(this._pointerInput,y.d.POINTERDOWN|y.d.POINTERUP|y.d.POINTERMOVE),this._onLostFocus){const Y=this.camera.getEngine().getInputElement();Y&&Y.addEventListener("blur",this._onLostFocus)}}uy(){if(this._pointerInput){if(this._observer&&(this.camera.uY()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const Y=this.camera.getEngine().getInputElement();Y&&Y.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const Y=this.camera,b=Y._calculateHandednessMultiplier();Y.cameraRotation.y=b*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)Y.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const b=Y._computeLocalCameraSpeed(),C=new A.AC(0,0,0!==this.touchMoveSensibility?b*this._offsetY/this.touchMoveSensibility:0);A.Matrix.RotationYawPitchRollToRef(Y.rotation.y,Y.rotation.x,0,Y._cameraRotationMatrix),Y.cameraDirection.addInPlace(A.AC.TransformCoordinates(C,Y._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,R.c)([(0,q.K)()],Q.prototype,"touchAngularSensibility",void 0),(0,R.c)([(0,q.K)()],Q.prototype,"touchMoveSensibility",void 0),B.c.FreeCameraTouchInput=Q;class N extends B.d{constructor(Y){super(Y),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new O),this}addMouse(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new S(Y),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new w,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new Q),this}clear(){super.clear(),this._mouseInput=null}}var p=C(12790),mY=C(12733);class L extends E.c{get angularSensibility(){const Y=this.inputs.attached.mouse;return Y?Y.angularSensibility:0}set angularSensibility(Y){const b=this.inputs.attached.mouse;b&&(b.angularSensibility=Y)}get keysUp(){const Y=this.inputs.attached.keyboard;return Y?Y.keysUp:[]}set keysUp(Y){const b=this.inputs.attached.keyboard;b&&(b.keysUp=Y)}get keysUpward(){const Y=this.inputs.attached.keyboard;return Y?Y.keysUpward:[]}set keysUpward(Y){const b=this.inputs.attached.keyboard;b&&(b.keysUpward=Y)}get keysDown(){const Y=this.inputs.attached.keyboard;return Y?Y.keysDown:[]}set keysDown(Y){const b=this.inputs.attached.keyboard;b&&(b.keysDown=Y)}get keysDownward(){const Y=this.inputs.attached.keyboard;return Y?Y.keysDownward:[]}set keysDownward(Y){const b=this.inputs.attached.keyboard;b&&(b.keysDownward=Y)}get keysLeft(){const Y=this.inputs.attached.keyboard;return Y?Y.keysLeft:[]}set keysLeft(Y){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=Y)}get keysRight(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRight:[]}set keysRight(Y){const b=this.inputs.attached.keyboard;b&&(b.keysRight=Y)}get keysRotateLeft(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRotateLeft:[]}set keysRotateLeft(Y){const b=this.inputs.attached.keyboard;b&&(b.keysRotateLeft=Y)}get keysRotateRight(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRotateRight:[]}set keysRotateRight(Y){const b=this.inputs.attached.keyboard;b&&(b.keysRotateRight=Y)}get keysRotateUp(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRotateUp:[]}set keysRotateUp(Y){const b=this.inputs.attached.keyboard;b&&(b.keysRotateUp=Y)}get keysRotateDown(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRotateDown:[]}set keysRotateDown(Y){const b=this.inputs.attached.keyboard;b&&(b.keysRotateDown=Y)}constructor(Y,b,C){var R;super(Y,b,C,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),R=this,this.ellipsoid=new A.AC(.5,1,.5),this.ellipsoidOffset=new A.AC(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=A.AC.Zero(),this._diffPosition=A.AC.Zero(),this._newPosition=A.AC.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R._newPosition.q(b),R._newPosition.subtractToRef(R._oldPosition,R._diffPosition),R._diffPosition.length()>mY.b.CollisionsEpsilon&&(R.position.addToRef(R._diffPosition,R._deferredPositionUpdate),R._deferOnly?R._deferredUpdated=!0:R.position.q(R._deferredPositionUpdate),R.Fn&&C&&R.Fn(C))},this.inputs=new N(this),this.inputs.addKeyboard().addMouse()}attachControl(Y,b){b=r.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(b)}uy(){this.inputs.detachElement(),this.cameraDirection=new A.AC(0,0,0),this.cameraRotation=new A.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(Y){this._collisionMask=isNaN(Y)?-1:Y}_collideWithWorld(Y){let b;b=this.parent?A.AC.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,b.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const C=this.uY().collisionCoordinator;this._collider||(this._collider=C.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let R=Y;this.applyGravity&&(R=Y.add(this.uY().gravity)),C.getNewPosition(this._oldPosition,R,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=A.AC.Zero(),this._transformedDirection=A.AC.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(Y){this._needMoveForGravity=Y}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.uY().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"kb"}}(0,R.c)([(0,q.H)()],L.prototype,"ellipsoid",void 0),(0,R.c)([(0,q.H)()],L.prototype,"ellipsoidOffset",void 0),(0,R.c)([(0,q.K)()],L.prototype,"checkCollisions",void 0),(0,R.c)([(0,q.K)()],L.prototype,"applyGravity",void 0),(0,p.g)("BABYLON.FreeCamera",L)},15117:(Y,b,C)=>{"use strict";C.d(b,{e:()=>A});var R=C(12919),q=C(15121);class A{constructor(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=C,this.iF=[],this._maxBlockCapacity=b||64,this._selectionContent=new R.e(1024),this._creationFunc=Y}update(Y,b,C){q.e._CreateBlocks(Y,b,C,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}xO(Y){for(let b=0;b<this.EF.length;b++){this.EF[b].addEntry(Y)}}kO(Y){for(let b=0;b<this.EF.length;b++){this.EF[b].removeEntry(Y)}}select(Y,b){this._selectionContent.reset();for(let C=0;C<this.EF.length;C++){this.EF[C].select(Y,this._selectionContent,b)}return b?this._selectionContent.concat(this.iF):this._selectionContent.concatWithNoDuplicate(this.iF),this._selectionContent}intersects(Y,b,C){this._selectionContent.reset();for(let R=0;R<this.EF.length;R++){this.EF[R].intersects(Y,b,this._selectionContent,C)}return C?this._selectionContent.concat(this.iF):this._selectionContent.concatWithNoDuplicate(this.iF),this._selectionContent}intersectsRay(Y){this._selectionContent.reset();for(let b=0;b<this.EF.length;b++){this.EF[b].intersectsRay(Y,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.iF),this._selectionContent}}A.CreationFuncForMeshes=(Y,b)=>{const C=Y.getBoundingInfo();!Y.isBlocked&&C.boundingBox.intersectsMinMax(b.VF,b.kF)&&b.entries.push(Y)},A.CreationFuncForSubMeshes=(Y,b)=>{Y.getBoundingInfo().boundingBox.intersectsMinMax(b.VF,b.kF)&&b.entries.push(Y)}},15121:(Y,b,C)=>{"use strict";C.d(b,{e:()=>A});var R=C(12831),q=C(13159);class A{constructor(Y,b,C,R,q,A){this.entries=[],this.xF=new Array,this._capacity=C,this._depth=R,this._maxDepth=q,this._creationFunc=A,this._minPoint=Y,this._maxPoint=b,this.xF.push(Y.clone()),this.xF.push(b.clone()),this.xF.push(Y.clone()),this.xF[2].x=b.x,this.xF.push(Y.clone()),this.xF[3].y=b.y,this.xF.push(Y.clone()),this.xF[4].z=b.z,this.xF.push(b.clone()),this.xF[5].z=Y.z,this.xF.push(b.clone()),this.xF[6].x=Y.x,this.xF.push(b.clone()),this.xF[7].y=Y.y}get jC(){return this._capacity}get VF(){return this._minPoint}get kF(){return this._maxPoint}addEntry(Y){if(this.EF)for(let b=0;b<this.EF.length;b++){this.EF[b].addEntry(Y)}else this._creationFunc(Y,this),this.entries.length>this.jC&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(Y){if(this.EF){for(let b=0;b<this.EF.length;b++){this.EF[b].removeEntry(Y)}return}const b=this.entries.indexOf(Y);b>-1&&this.entries.splice(b,1)}addEntries(Y){for(let b=0;b<Y.length;b++){const C=Y[b];this.addEntry(C)}}select(Y,b,C){if(q.b.IsInFrustum(this.xF,Y)){if(this.EF){for(let R=0;R<this.EF.length;R++){this.EF[R].select(Y,b,C)}return}C?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersects(Y,b,C,R){if(q.b.IntersectsSphere(this._minPoint,this._maxPoint,Y,b)){if(this.EF){for(let q=0;q<this.EF.length;q++){this.EF[q].intersects(Y,b,C,R)}return}R?C.concat(this.entries):C.concatWithNoDuplicate(this.entries)}}intersectsRay(Y,b){if(Y.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.EF){for(let C=0;C<this.EF.length;C++){this.EF[C].intersectsRay(Y,b)}return}b.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){A._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(Y,b,C,q,E,B,g,r){g.EF=new Array;const O=new R.AC((b.x-Y.x)/2,(b.y-Y.y)/2,(b.z-Y.z)/2);for(let R=0;R<2;R++)for(let b=0;b<2;b++)for(let F=0;F<2;F++){const y=Y.add(O.multiplyByFloats(R,b,F)),S=Y.add(O.multiplyByFloats(R+1,b+1,F+1)),n=new A(y,S,q,E+1,B,r);n.addEntries(C),g.EF.push(n)}}}},15130:(Y,b,C)=>{"use strict";C.d(b,{c:()=>O});var R=C(13077),q=C(12831),A=C(13249),E=C(14089),B=C(13096),g=C(15117),r=C(12702);R.b.prototype.createOrUpdateSelectionOctree=function(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,C=this._getComponent(B.c.NAME_OCTREE);C||(C=new O(this),this.Ob(C)),this.eF||(this.eF=new g.e(g.e.CreationFuncForMeshes,Y,b));const R=this.getWorldExtends();return this.eF.update(R.min,R.max,this.meshes),this.eF},Object.defineProperty(R.b.prototype,"selectionOctree",{get:function(){return this.eF},enumerable:!0,configurable:!0}),A.b.prototype.createOrUpdateSubmeshesOctree=function(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const C=this.uY();let R=C._getComponent(B.c.NAME_OCTREE);R||(R=new O(C),C.Ob(R)),this._submeshesOctree||(this._submeshesOctree=new g.e(g.e.CreationFuncForSubMeshes,Y,b)),this.Tb(!0);const q=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(q.minimumWorld,q.maximumWorld,this.ub),this._submeshesOctree};class O{constructor(Y){this.name=B.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new E.e(q.AC.Zero(),new q.AC(1,1,1)),(Y=Y||r.d.LastCreatedScene)&&(this.BC=Y,this.BC.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.BC.getActiveSubMeshCandidates=Y=>this.getActiveSubMeshCandidates(Y),this.BC.getCollidingSubMeshCandidates=(Y,b)=>this.getCollidingSubMeshCandidates(Y,b),this.BC.getIntersectingSubMeshCandidates=(Y,b)=>this.getIntersectingSubMeshCandidates(Y,b))}register(){this.BC.onMeshRemovedObservable.add((Y=>{const b=this.BC.selectionOctree;if(void 0!==b&&null!==b){const C=b.iF.indexOf(Y);-1!==C&&b.iF.splice(C,1)}})),this.BC.onMeshImportedObservable.add((Y=>{const b=this.BC.selectionOctree;void 0!==b&&null!==b&&b.xO(Y)}))}getActiveMeshCandidates(){var Y;return(null===(Y=this.BC.eF)||void 0===Y?void 0:Y.select(this.BC.frustumPlanes))||this.BC._getDefaultMeshCandidates()}getActiveSubMeshCandidates(Y){if(Y._submeshesOctree&&Y.useOctreeForRenderingSelection){return Y._submeshesOctree.select(this.BC.frustumPlanes)}return this.BC._getDefaultSubMeshCandidates(Y)}getIntersectingSubMeshCandidates(Y,b){if(Y._submeshesOctree&&Y.useOctreeForPicking){E.e.TransformToRef(b,Y.getWorldMatrix(),this._tempRay);return Y._submeshesOctree.intersectsRay(this._tempRay)}return this.BC._getDefaultSubMeshCandidates(Y)}getCollidingSubMeshCandidates(Y,b){if(Y._submeshesOctree&&Y.useOctreeForCollisions){const C=b._velocityWorldLength+Math.max(b._radius.x,b._radius.y,b._radius.z);return Y._submeshesOctree.intersects(b._basePointWorld,C)}return this.BC._getDefaultSubMeshCandidates(Y)}rebuild(){}dispose(){}}},14089:(Y,b,C)=>{"use strict";C.d(b,{e:()=>S});var R=C(13077),q=C(13279),A=C(12837),E=C(12831),B=C(12846),g=C(13153),r=C(13093),O=C(12702),F=C(13117);const y={internalPickerForMesh:void 0};class S{constructor(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.e;this.origin=Y,this.direction=b,this.length=C,this.epsilon=R}clone(){return new S(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const R=S._TmpVector3[0].Ub(Y.x-C,Y.y-C,Y.z-C),q=S._TmpVector3[1].Ub(b.x+C,b.y+C,b.z+C);let A,E,B,g,r=0,O=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<R.x||this.origin.x>q.x)return!1}else if(A=1/this.direction.x,E=(R.x-this.origin.x)*A,B=(q.x-this.origin.x)*A,B===-1/0&&(B=1/0),E>B&&(g=E,E=B,B=g),r=Math.max(E,r),O=Math.min(B,O),r>O)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<R.y||this.origin.y>q.y)return!1}else if(A=1/this.direction.y,E=(R.y-this.origin.y)*A,B=(q.y-this.origin.y)*A,B===-1/0&&(B=1/0),E>B&&(g=E,E=B,B=g),r=Math.max(E,r),O=Math.min(B,O),r>O)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<R.z||this.origin.z>q.z)return!1}else if(A=1/this.direction.z,E=(R.z-this.origin.z)*A,B=(q.z-this.origin.z)*A,B===-1/0&&(B=1/0),E>B&&(g=E,E=B,B=g),r=Math.max(E,r),O=Math.min(B,O),r>O)return!1;return!0}intersectsBox(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(Y.minimum,Y.maximum,b)}intersectsSphere(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=Y.center.x-this.origin.x,R=Y.center.y-this.origin.y,q=Y.center.z-this.origin.z,A=C*C+R*R+q*q,E=Y.radius+b,B=E*E;if(A<=B)return!0;const g=C*this.direction.x+R*this.direction.y+q*this.direction.z;if(g<0)return!1;return A-g*g<=B}intersectsTriangle(Y,b,C){const R=S._TmpVector3[0],q=S._TmpVector3[1],A=S._TmpVector3[2],B=S._TmpVector3[3],r=S._TmpVector3[4];b.subtractToRef(Y,R),C.subtractToRef(Y,q),E.AC.CrossToRef(this.direction,q,A);const O=E.AC.Dot(R,A);if(0===O)return null;const F=1/O;this.origin.subtractToRef(Y,B);const y=E.AC.Dot(B,A)*F;if(y<-this.epsilon||y>1+this.epsilon)return null;E.AC.CrossToRef(B,R,r);const n=E.AC.Dot(this.direction,r)*F;if(n<-this.epsilon||y+n>1+this.epsilon)return null;const t=E.AC.Dot(q,r)*F;return t>this.length?null:new g.b(1-y-n,y,t)}intersectsPlane(Y){let b;const C=E.AC.Dot(Y.normal,this.direction);if(Math.abs(C)<9.99999997475243e-7)return null;{const R=E.AC.Dot(Y.normal,this.origin);return b=(-Y.d-R)/C,b<0?b<-9.99999997475243e-7?null:0:b}}intersectsAxis(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(Y){case"y":{const Y=(this.origin.y-b)/this.direction.y;return Y>0?null:new E.AC(this.origin.x+this.direction.x*-Y,b,this.origin.z+this.direction.z*-Y)}case"x":{const Y=(this.origin.x-b)/this.direction.x;return Y>0?null:new E.AC(b,this.origin.y+this.direction.y*-Y,this.origin.z+this.direction.z*-Y)}case"z":{const Y=(this.origin.z-b)/this.direction.z;return Y>0?null:new E.AC(this.origin.x+this.direction.x*-Y,this.origin.y+this.direction.y*-Y,b)}default:return null}}intersectsMesh(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=E.TmpVectors.Matrix[0];return Y.getWorldMatrix().invertToRef(B),this._tmpRay?S.TransformToRef(this,B,this._tmpRay):this._tmpRay=S.Transform(this,B),Y.intersects(this._tmpRay,b,C,R,q,A)}intersectsMeshes(Y,b,C){C?C.length=0:C=[];for(let R=0;R<Y.length;R++){const q=this.intersectsMesh(Y[R],b);q.hit&&C.push(q)}return C.sort(this._comparePickingInfo),C}_comparePickingInfo(Y,b){return Y.distance<b.distance?-1:Y.distance>b.distance?1:0}intersectionSegment(Y,b,C){const R=this.origin,q=E.TmpVectors.AC[0],A=E.TmpVectors.AC[1],B=E.TmpVectors.AC[2],g=E.TmpVectors.AC[3];b.subtractToRef(Y,q),this.direction.scaleToRef(S._Rayl,B),R.addToRef(B,A),Y.subtractToRef(R,g);const r=E.AC.Dot(q,q),O=E.AC.Dot(q,B),F=E.AC.Dot(B,B),y=E.AC.Dot(q,g),n=E.AC.Dot(B,g),t=r*F-O*O;let I,w,Q=t,N=t;t<S._Smallnum?(I=0,Q=1,w=n,N=F):(I=O*n-F*y,w=r*n-O*y,I<0?(I=0,w=n,N=F):I>Q&&(I=Q,w=n+O,N=F)),w<0?(w=0,-y<0?I=0:-y>r?I=Q:(I=-y,Q=r)):w>N&&(w=N,-y+O<0?I=0:-y+O>r?I=Q:(I=-y+O,Q=r));const p=Math.abs(I)<S._Smallnum?0:I/Q,mY=Math.abs(w)<S._Smallnum?0:w/N,L=E.TmpVectors.AC[4];B.scaleToRef(mY,L);const u=E.TmpVectors.AC[5];q.scaleToRef(p,u),u.addInPlace(g);const c=E.TmpVectors.AC[6];u.subtractToRef(L,c);return mY>0&&mY<=this.length&&c.lengthSquared()<C*C?u.length():-1}update(Y,b,C,R,q,A,B){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){S._RayDistant||(S._RayDistant=S.Zero()),S._RayDistant.unprojectRayToRef(Y,b,C,R,E.Matrix.IdentityReadOnly,A,B);const g=E.TmpVectors.Matrix[0];q.invertToRef(g),S.TransformToRef(S._RayDistant,g,this)}else this.unprojectRayToRef(Y,b,C,R,q,A,B);return this}static Zero(){return new S(E.AC.Zero(),E.AC.Zero())}static CreateNew(Y,b,C,R,q,A,E){return S.Zero().update(Y,b,C,R,q,A,E)}static CreateNewFromTo(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.Matrix.IdentityReadOnly;const R=new S(new E.AC(0,0,0),new E.AC(0,0,0));return S.CreateFromToToRef(Y,b,R,C)}static CreateFromToToRef(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E.Matrix.IdentityReadOnly;C.origin.q(Y);const q=b.subtractToRef(Y,C.direction),A=Math.sqrt(q.x*q.x+q.y*q.y+q.z*q.z);return C.length=A,C.direction.normalize(),S.TransformToRef(C,R,C)}static Transform(Y,b){const C=new S(new E.AC(0,0,0),new E.AC(0,0,0));return S.TransformToRef(Y,b,C),C}static TransformToRef(Y,b,C){E.AC.TransformCoordinatesToRef(Y.origin,b,C.origin),E.AC.TransformNormalToRef(Y.direction,b,C.direction),C.length=Y.length,C.epsilon=Y.epsilon;const R=C.direction,q=R.length();if(0!==q&&1!==q){const Y=1/q;R.x*=Y,R.y*=Y,R.z*=Y,C.length*=q}return C}unprojectRayToRef(Y,b,C,R,q,A,B){const g=E.TmpVectors.Matrix[0];q.multiplyToRef(A,g),g.multiplyToRef(B,g),g.invert();const r=O.d.LastCreatedEngine,F=E.TmpVectors.AC[0];F.x=Y/C*2-1,F.y=-(b/R*2-1),F.z=null!==r&&void 0!==r&&r.o?1:null!==r&&void 0!==r&&r.isNDCHalfZRange?0:-1;const y=E.TmpVectors.AC[1].Ub(F.x,F.y,1-1e-8),S=E.TmpVectors.AC[2],n=E.TmpVectors.AC[3];E.AC._UnprojectFromInvertedMatrixToRef(F,g,S),E.AC._UnprojectFromInvertedMatrixToRef(y,g,n),this.origin.q(S),n.subtractToRef(S,this.direction),this.direction.normalize()}}function n(Y,b,C,R,q){let A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const E=S.Zero();return t(Y,b,C,R,E,q,A),E}function t(Y,b,C,R,q,A){let B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const r=Y.getEngine();if(!A&&!(A=Y.activeCamera))return Y;const O=A.viewport,F=r.getRenderHeight(),{x:y,y:S,width:n,height:t}=O.toGlobal(r.getRenderWidth(),F),I=1/r.getHardwareScalingLevel();return b=b*I-y,C=C*I-(F-S-t),q.update(b,C,n,t,R||E.Matrix.IdentityReadOnly,B?E.Matrix.IdentityReadOnly:A.getViewMatrix(),A.getProjectionMatrix(),g),Y}function I(Y,b,C,R,q){if(!r.c)return Y;const A=Y.getEngine();if(!q&&!(q=Y.activeCamera))throw new Error("Active camera not set");const B=q.viewport,g=A.getRenderHeight(),{x:O,y:F,width:y,height:S}=B.toGlobal(A.getRenderWidth(),g),n=E.Matrix.Identity(),t=1/A.getHardwareScalingLevel();return b=b*t-O,C=C*t-(g-F-S),R.update(b,C,y,S,n,n,q.getProjectionMatrix()),Y}function w(Y,b,C,R,q,A,E,B){const g=b(R,C.enableDistantPicking),r=C.intersects(g,q,E,A,R,B);return r&&r.hit?!q&&null!=Y&&r.distance>=Y.distance?null:r:null}function Q(Y,b,C,R,q,A){let B=null;const g=!!(Y.activeCameras&&Y.activeCameras.length>1&&Y.cameraToUseForPointers!==Y.activeCamera),O=Y.cameraToUseForPointers||Y.activeCamera,F=y.internalPickerForMesh||w;for(let r=0;r<Y.meshes.length;r++){const y=Y.meshes[r];if(C){if(!C(y,-1))continue}else if(!y.isEnabled()||!y.isVisible||!y.Xr)continue;const S=g&&y.isWorldMatrixCameraDependent(),n=y.Tb(S,O);if(y.hasThinInstances&&y.OO){const Y=F(B,b,y,n,!0,!0,A);if(Y){if(q)return Y;const g=E.TmpVectors.Matrix[1],r=y.thinInstanceGetWorldMatrices();for(let Y=0;Y<r.length;Y++){if(C&&!C(y,Y))continue;r[Y].multiplyToRef(n,g);const E=F(B,b,y,g,R,q,A,!0);if(E&&(B=E,B.thinInstanceIndex=Y,R))return B}}}else{const Y=F(B,b,y,n,R,q,A);if(Y&&(B=Y,R))return B}}return B||new r.c}function N(Y,b,C,R){if(!r.c)return null;const q=[],A=!!(Y.activeCameras&&Y.activeCameras.length>1&&Y.cameraToUseForPointers!==Y.activeCamera),B=Y.cameraToUseForPointers||Y.activeCamera,g=y.internalPickerForMesh||w;for(let r=0;r<Y.meshes.length;r++){const O=Y.meshes[r];if(C){if(!C(O,-1))continue}else if(!O.isEnabled()||!O.isVisible||!O.Xr)continue;const F=A&&O.isWorldMatrixCameraDependent(),y=O.Tb(F,B);if(O.hasThinInstances&&O.OO){if(g(null,b,O,y,!0,!0,R)){const Y=E.TmpVectors.Matrix[1],A=O.thinInstanceGetWorldMatrices();for(let E=0;E<A.length;E++){if(C&&!C(O,E))continue;A[E].multiplyToRef(y,Y);const B=g(null,b,O,Y,!1,!1,R,!0);B&&(B.thinInstanceIndex=E,q.push(B))}}}else{const Y=g(null,b,O,y,!1,!1,R);Y&&q.push(Y)}}return q}function p(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,R=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;R||(R=Y.getWorldMatrix()),b.length=C,q?b.origin.q(q):b.origin.q(Y.position);const A=E.TmpVectors.AC[2];A.set(0,0,Y._scene.useRightHandedSystem?-1:1);const B=E.TmpVectors.AC[3];return E.AC.TransformNormalToRef(A,R,B),E.AC.NormalizeToRef(B,b.direction),b}var mY,L;S._TmpVector3=(0,B.e)(6,E.AC.Zero),S._RayDistant=S.Zero(),S._Smallnum=1e-8,S._Rayl=1e9,mY=R.b,(L=q.c)&&(L.prototype.getForwardRay=function(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,b=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;return p(this,new S(E.AC.Zero(),E.AC.Zero(),Y),Y,b,C)},L.prototype.getForwardRayToRef=function(Y){return p(this,Y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),mY&&(F.c._IsPickingAvailable=!0,mY.prototype.createPickingRay=function(Y,b,C,R){return n(this,Y,b,C,R,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),R.b.prototype.createPickingRayToRef=function(Y,b,C,R,q){return t(this,Y,b,C,R,q,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},R.b.prototype.createPickingRayInCameraSpace=function(Y,b,C){return function(Y,b,C,R){const q=S.Zero();return I(Y,b,C,q,R),q}(this,Y,b,C)},R.b.prototype.createPickingRayInCameraSpaceToRef=function(Y,b,C,R){return I(this,Y,b,C,R)},R.b.prototype.pickWithBoundingInfo=function(Y,b,C,R,q){return function(Y,b,C,R,q,A){if(!r.c)return null;const B=Q(Y,(R=>(Y._tempPickingRay||(Y._tempPickingRay=S.Zero()),t(Y,b,C,R,Y._tempPickingRay,A||null),Y._tempPickingRay)),R,q,!0);return B&&(B.ray=n(Y,b,C,E.Matrix.Identity(),A||null)),B}(this,Y,b,C,R,q)},R.b.prototype.AR=function(Y,b,C,R,q,A){return function(Y,b,C,R,q,A,B){const g=Q(Y,((R,q)=>(Y._tempPickingRay||(Y._tempPickingRay=S.Zero()),t(Y,b,C,R,Y._tempPickingRay,A||null,!1,q),Y._tempPickingRay)),R,q,!1,B);return g&&(g.ray=n(Y,b,C,E.Matrix.Identity(),A||null)),g}(this,Y,b,C,R,q,A)},R.b.prototype.pickWithRay=function(Y,b,C,R){return function(Y,b,C,R,q){const A=Q(Y,(C=>(Y._pickWithRayInverseMatrix||(Y._pickWithRayInverseMatrix=E.Matrix.Identity()),C.invertToRef(Y._pickWithRayInverseMatrix),Y._cachedRayForTransform||(Y._cachedRayForTransform=S.Zero()),S.TransformToRef(b,Y._pickWithRayInverseMatrix,Y._cachedRayForTransform),Y._cachedRayForTransform)),C,R,!1,q);return A&&(A.ray=b),A}(this,Y,b,C,R)},R.b.prototype.multiPick=function(Y,b,C,R,q){return function(Y,b,C,R,q,A){return N(Y,(R=>n(Y,b,C,R,q||null)),R,A)}(this,Y,b,C,R,q)},R.b.prototype.multiPickWithRay=function(Y,b,C){return function(Y,b,C,R){return N(Y,(C=>(Y._pickWithRayInverseMatrix||(Y._pickWithRayInverseMatrix=E.Matrix.Identity()),C.invertToRef(Y._pickWithRayInverseMatrix),Y._cachedRayForTransform||(Y._cachedRayForTransform=S.Zero()),S.TransformToRef(b,Y._pickWithRayInverseMatrix,Y._cachedRayForTransform),Y._cachedRayForTransform)),C,R)}(this,Y,b,C)}},14394:(Y,b,C)=>{"use strict";var R=C(12767),q=C(12669),A=C(12709),E=C(12799),B=C(12733),g=C(12779);B.b.prototype._partialLoadFile=function(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(Y,(Y=>{C[b]=Y,C._internalCount++,6===C._internalCount&&R(C)}),void 0,void 0,!0,((Y,b)=>{q&&Y&&q(Y.status+" "+Y.statusText,b)}))},B.b.prototype._cascadeLoadFiles=function(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const q=[];q._internalCount=0;for(let A=0;A<6;A++)this._partialLoadFile(C[A],A,q,b,R)},B.b.prototype._cascadeLoadImgs=function(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5?arguments[5]:void 0;const E=[];E._internalCount=0;for(let B=0;B<6;B++)this._partialLoadImg(R[B],B,E,Y,b,C,q,A)},B.b.prototype._partialLoadImg=function(Y,b,C,R,q,B){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7?arguments[7]:void 0;const O=(0,E.e)();(0,A.x)(Y,(Y=>{C[b]=Y,C._internalCount++,R&&R.removePendingData(O),6===C._internalCount&&B&&B(q,C)}),((Y,b)=>{R&&R.removePendingData(O),g&&g(Y,b)}),R?R.offlineProvider:null,r),R&&R.addPendingData(O)},B.b.prototype.createCubeTextureBase=function(Y,b,C,A){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6?arguments[6]:void 0,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,S=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,t=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,I=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,w=arguments.length>14&&void 0!==arguments[14]&&arguments[14],Q=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const N=n||new R.b(this,7);N.isCube=!0,N.url=Y,N.generateMipMaps=!A,N._lodGenerationScale=y,N._lodGenerationOffset=S,N._useSRGBBuffer=!!w&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!A),N!==n&&(N.label=Y.substring(0,60)),this._doNotHandleContextLost||(N._extension=O,N._files=C,N._buffer=Q);const p=Y;this._transformTextureUrl&&!n&&(Y=this._transformTextureUrl(Y));const mY=O??function(Y){const b=Y.split("?")[0],C=b.lastIndexOf(".");return C>-1?b.substring(C).toLowerCase():""}(Y),L=(0,g.c)(mY),u=(Y,b)=>{N.dispose(),B?B(Y,b):Y&&q.e.Warn(Y)},c=(R,B)=>{Y===p?R&&u(R.status+" "+R.statusText,B):(q.e.Warn(`Failed to load ${Y}, falling back to the ${p}`),this.createCubeTextureBase(p,b,C,!!A,E,u,r,O,F,y,S,N,t,I,w,Q))};if(L)L.then((R=>{const q=Y=>{t&&t(N,Y),R.loadCubeData(Y,N,F,E,((Y,b)=>{u(Y,b)}))};Q?q(Q):C&&6===C.length?R.supportCascades?this._cascadeLoadFiles(b,(Y=>q(Y.map((Y=>new Uint8Array(Y))))),C,u):u("Textures type does not support cascades."):this._loadFile(Y,(Y=>q(new Uint8Array(Y))),void 0,void 0,!0,c)}));else{if(!C||0===C.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(b,N,((Y,b)=>{I&&I(Y,b)}),C,u)}return this._internalTexturesCache.push(N),N}},15139:(Y,b,C)=>{"use strict";C(12669);var R=C(12957);C(12767),C(12907),C(12764),C(13003),C(12969);R.c},14420:(Y,b,C)=>{"use strict";C.d(b,{d:()=>q});var R=C(12790);class q{constructor(Y){this.value=this._toInt(Y)}_toInt(Y){return 0|Y}add(Y){return new q(this.value+Y.value)}EC(Y){return new q(this.value-Y.value)}multiply(Y){return new q(Math.imul(this.value,Y.value))}divide(Y){return new q(this.value/Y.value)}getClassName(){return q.ClassName}equals(Y){return this.value===Y.value}static FromValue(Y){return new q(Y)}toString(){return this.value.toString()}}q.ClassName="FlowGraphInteger",(0,R.g)("FlowGraphInteger",q)},14426:(Y,b,C)=>{"use strict";C.d(b,{b:()=>q,f:()=>A});var R=C(12831);class q{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Ib=Y}get m(){return this.Ib}transformVector(Y){return this.transformVectorToRef(Y,new R.Vector2)}transformVectorToRef(Y,b){return b.x=Y.x*this.Ib[0]+Y.y*this.Ib[1],b.y=Y.x*this.Ib[2]+Y.y*this.Ib[3],b}cb(){return this.toArray()}toArray(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let b=0;b<4;b++)Y[b]=this.Ib[b];return Y}ER(Y){for(let b=0;b<4;b++)this.Ib[b]=Y[b];return this}multiplyToRef(Y,b){const C=Y.Ib,R=this.Ib,q=b.Ib;return q[0]=C[0]*R[0]+C[1]*R[2],q[1]=C[0]*R[1]+C[1]*R[3],q[2]=C[2]*R[0]+C[3]*R[2],q[3]=C[2]*R[1]+C[3]*R[3],b}multiply(Y){return this.multiplyToRef(Y,new q)}divideToRef(Y,b){const C=this.Ib,R=Y.Ib,q=b.Ib;return q[0]=C[0]/R[0],q[1]=C[1]/R[1],q[2]=C[2]/R[2],q[3]=C[3]/R[3],b}divide(Y){return this.divideToRef(Y,new q)}addToRef(Y,b){const C=this.Ib,R=Y.m,q=b.m;return q[0]=C[0]+R[0],q[1]=C[1]+R[1],q[2]=C[2]+R[2],q[3]=C[3]+R[3],b}add(Y){return this.addToRef(Y,new q)}subtractToRef(Y,b){const C=this.Ib,R=Y.m,q=b.m;return q[0]=C[0]-R[0],q[1]=C[1]-R[1],q[2]=C[2]-R[2],q[3]=C[3]-R[3],b}EC(Y){return this.subtractToRef(Y,new q)}transpose(){const Y=this.Ib;return new q([Y[0],Y[2],Y[1],Y[3]])}determinant(){const Y=this.Ib;return Y[0]*Y[3]-Y[1]*Y[2]}inverse(){const Y=this.determinant();if(0===Y)throw new Error("Matrix is not invertible");const b=this.Ib,C=1/Y;return new q([b[3]*C,-b[1]*C,-b[2]*C,b[0]*C])}equals(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.Ib,R=Y.m;return 0===b?C[0]===R[0]&&C[1]===R[1]&&C[2]===R[2]&&C[3]===R[3]:Math.abs(C[0]-R[0])<b&&Math.abs(C[1]-R[1])<b&&Math.abs(C[2]-R[2])<b&&Math.abs(C[3]-R[3])<b}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Ib.join(", ")})`}}class A{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Ib=Y}get m(){return this.Ib}transformVector(Y){return this.transformVectorToRef(Y,new R.AC)}transformVectorToRef(Y,b){const C=this.Ib;return b.x=Y.x*C[0]+Y.y*C[1]+Y.z*C[2],b.y=Y.x*C[3]+Y.y*C[4]+Y.z*C[5],b.z=Y.x*C[6]+Y.y*C[7]+Y.z*C[8],b}multiplyToRef(Y,b){const C=Y.Ib,R=this.Ib,q=b.m;return q[0]=C[0]*R[0]+C[1]*R[3]+C[2]*R[6],q[1]=C[0]*R[1]+C[1]*R[4]+C[2]*R[7],q[2]=C[0]*R[2]+C[1]*R[5]+C[2]*R[8],q[3]=C[3]*R[0]+C[4]*R[3]+C[5]*R[6],q[4]=C[3]*R[1]+C[4]*R[4]+C[5]*R[7],q[5]=C[3]*R[2]+C[4]*R[5]+C[5]*R[8],q[6]=C[6]*R[0]+C[7]*R[3]+C[8]*R[6],q[7]=C[6]*R[1]+C[7]*R[4]+C[8]*R[7],q[8]=C[6]*R[2]+C[7]*R[5]+C[8]*R[8],b}multiply(Y){return this.multiplyToRef(Y,new A)}divideToRef(Y,b){const C=this.Ib,R=Y.m,q=b.m;return q[0]=C[0]/R[0],q[1]=C[1]/R[1],q[2]=C[2]/R[2],q[3]=C[3]/R[3],q[4]=C[4]/R[4],q[5]=C[5]/R[5],q[6]=C[6]/R[6],q[7]=C[7]/R[7],q[8]=C[8]/R[8],b}divide(Y){return this.divideToRef(Y,new A)}addToRef(Y,b){const C=this.Ib,R=Y.m,q=b.m;return q[0]=C[0]+R[0],q[1]=C[1]+R[1],q[2]=C[2]+R[2],q[3]=C[3]+R[3],q[4]=C[4]+R[4],q[5]=C[5]+R[5],q[6]=C[6]+R[6],q[7]=C[7]+R[7],q[8]=C[8]+R[8],b}add(Y){return this.addToRef(Y,new A)}subtractToRef(Y,b){const C=this.Ib,R=Y.m,q=b.m;return q[0]=C[0]-R[0],q[1]=C[1]-R[1],q[2]=C[2]-R[2],q[3]=C[3]-R[3],q[4]=C[4]-R[4],q[5]=C[5]-R[5],q[6]=C[6]-R[6],q[7]=C[7]-R[7],q[8]=C[8]-R[8],b}EC(Y){return this.subtractToRef(Y,new A)}toArray(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let b=0;b<9;b++)Y[b]=this.Ib[b];return Y}cb(){return this.toArray()}ER(Y){for(let b=0;b<9;b++)this.Ib[b]=Y[b];return this}transpose(){const Y=this.Ib;return new A([Y[0],Y[3],Y[6],Y[1],Y[4],Y[7],Y[2],Y[5],Y[8]])}determinant(){const Y=this.Ib;return Y[0]*(Y[4]*Y[8]-Y[5]*Y[7])-Y[1]*(Y[3]*Y[8]-Y[5]*Y[6])+Y[2]*(Y[3]*Y[7]-Y[4]*Y[6])}inverse(){const Y=this.determinant();if(0===Y)throw new Error("Matrix is not invertible");const b=this.Ib,C=1/Y;return new A([(b[4]*b[8]-b[5]*b[7])*C,(b[2]*b[7]-b[1]*b[8])*C,(b[1]*b[5]-b[2]*b[4])*C,(b[5]*b[6]-b[3]*b[8])*C,(b[0]*b[8]-b[2]*b[6])*C,(b[2]*b[3]-b[0]*b[5])*C,(b[3]*b[7]-b[4]*b[6])*C,(b[1]*b[6]-b[0]*b[7])*C,(b[0]*b[4]-b[1]*b[3])*C])}equals(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.Ib,R=Y.m;return 0===b?C[0]===R[0]&&C[1]===R[1]&&C[2]===R[2]&&C[3]===R[3]&&C[4]===R[4]&&C[5]===R[5]&&C[6]===R[6]&&C[7]===R[7]&&C[8]===R[8]:Math.abs(C[0]-R[0])<b&&Math.abs(C[1]-R[1])<b&&Math.abs(C[2]-R[2])<b&&Math.abs(C[3]-R[3])<b&&Math.abs(C[4]-R[4])<b&&Math.abs(C[5]-R[5])<b&&Math.abs(C[6]-R[6])<b&&Math.abs(C[7]-R[7])<b&&Math.abs(C[8]-R[8])<b}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Ib.join(", ")})`}}},14430:(Y,b,C)=>{"use strict";var R;function q(Y,b,C,R){switch(b){case"Animation":return R?Y.animations.find((Y=>Y.uniqueId===C))??null:Y.animations[C]??null;case"AnimationGroup":return R?Y.animationGroups.find((Y=>Y.uniqueId===C))??null:Y.animationGroups[C]??null;case"Mesh":return R?Y.meshes.find((Y=>Y.uniqueId===C))??null:Y.meshes[C]??null;case"Material":return R?Y.materials.find((Y=>Y.uniqueId===C))??null:Y.materials[C]??null;case"CF":return R?Y.cameras.find((Y=>Y.uniqueId===C))??null:Y.cameras[C]??null;case"Light":return R?Y.lights.find((Y=>Y.uniqueId===C))??null:Y.lights[C]??null;default:return null}}C.d(b,{b:()=>q}),function(Y){Y.Animation="Animation",Y.AnimationGroup="AnimationGroup",Y.Mesh="Mesh",Y.Material="Material",Y.CF="CF",Y.Light="Light"}(R||(R={}))},14460:(Y,b,C)=>{"use strict";C.d(b,{d:()=>q});var R=C(14466);class q extends R.d{constructor(Y,b){if(super(Y),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),b)for(const C of b)this._eventsSignalOutputs[C]=this._registerSignalOutput(C+"Event")}_executeOnTick(Y){}_startPendingTasks(Y){Y._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(Y),this._resetAfterCanceled(Y)),this._preparePendingTasks(Y),Y._addPendingBlock(this),this.out._activateSignal(Y),Y._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(Y){Y._deleteExecutionVariable(this,"_initialized"),Y._removePendingBlock(this)}}},14437:(Y,b,C)=>{"use strict";C.d(b,{e:()=>r});var R=C(12799),q=C(12790),A=C(14444),E=C(12652),B=C(14412);class g extends A.c{constructor(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:R.defaultValue,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(Y,b,C),this.richType=R,this._defaultValue=q,this._optional=A,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new E.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(Y){this._isDisabled!==Y&&(this._isDisabled=Y,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(Y,b){b._getConnectionValue(this)!==Y&&(b._setConnectionValue(this,Y),this.onValueChangedObservable.notifyObservers(Y))}resetToDefaultValue(Y){Y._setConnectionValue(this,this._defaultValue)}connectTo(Y){this._isDisabled||super.connectTo(Y)}_getValueOrDefault(Y){const b=Y._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(b):b}getValue(Y){if(1===this.connectionType){Y._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(Y);const b=this._getValueOrDefault(Y);return this._lastValue=b,this.richType.typeTransformer?this.richType.typeTransformer(b):b}const b=this.isConnected()?this._connectedPoint[0].getValue(Y):this._getValueOrDefault(Y);return this._lastValue=b,this.richType.typeTransformer?this.richType.typeTransformer(b):b}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Y),Y.richType={},this.richType.serialize(Y.richType),Y.optional=this._optional,(0,B.e)("defaultValue",this._defaultValue,Y)}}(0,q.g)("FlowGraphDataConnection",g);class r{constructor(Y){var b;this.config=Y,this.uniqueId=(0,R.e)(),this.name=(null===(b=this.config)||void 0===b?void 0:b.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(Y){}registerDataInput(Y,b,C){const R=new g(Y,0,this,b,C);return this.dataInputs.push(R),R}registerDataOutput(Y,b,C){const R=new g(Y,1,this,b,C);return this.dataOutputs.push(R),R}getDataInput(Y){return this.dataInputs.find((b=>b.name===Y))}getDataOutput(Y){return this.dataOutputs.find((b=>b.name===Y))}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.e;if(Y.uniqueId=this.uniqueId,Y.config={},this.config){const C=this.config,R=Object.keys(C);for(const q of R)b(q,C[q],Y.config)}Y.dataInputs=[],Y.dataOutputs=[],Y.className=this.getClassName();for(const C of this.dataInputs){const b={};C.serialize(b),Y.dataInputs.push(b)}for(const C of this.dataOutputs){const b={};C.serialize(b),Y.dataOutputs.push(b)}}deserialize(Y){}_log(Y,b,C){var R;null===(R=Y.logger)||void 0===R||R.addLogItem({action:b,BR:C,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14444:(Y,b,C)=>{"use strict";C.d(b,{c:()=>A});var R,q=C(12799);!function(Y){Y[Y.Input=0]="Input",Y[Y.Output=1]="Output"}(R||(R={}));class A{constructor(Y,b,C){this._ownerBlock=C,this._connectedPoint=[],this.uniqueId=(0,q.e)(),this.connectedPointIds=[],this.name=Y,this._connectionType=b}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(Y){if(this._connectionType===Y._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||Y._isSingularConnection()&&Y._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(Y),Y._connectedPoint.push(this)}disconnectFrom(Y){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=this._connectedPoint.indexOf(Y),R=Y._connectedPoint.indexOf(this);-1!==C&&-1!==R&&(b&&this._connectedPoint.splice(C,1),Y._connectedPoint.splice(R,1))}disconnectFromAll(){for(const Y of this._connectedPoint)this.disconnectFrom(Y,!1);this._connectedPoint.length=0}dispose(){for(const Y of this._connectedPoint)this.disconnectFrom(Y)}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Y.uniqueId=this.uniqueId,Y.name=this.name,Y._connectionType=this._connectionType,Y.connectedPointIds=[],Y.className=this.getClassName();for(const b of this._connectedPoint)Y.connectedPointIds.push(b.uniqueId)}getClassName(){return"FGConnection"}deserialize(Y){this.uniqueId=Y.uniqueId,this.name=Y.name,this._connectionType=Y._connectionType,this.connectedPointIds=Y.connectedPointIds}}},14409:(Y,b,C)=>{"use strict";C.d(b,{b:()=>N});var R,q=C(12652),A=C(12818),E=C(12821),B=C(12799),g=C(14412),r=C(14430),O=C(12669);!function(Y){Y.ExecuteBlock="ExecuteBlock",Y.ExecuteEvent="ExecuteEvent",Y.TriggerConnection="TriggerConnection",Y.ContextVariableSet="ContextVariableSet",Y.GlobalVariableSet="GlobalVariableSet",Y.GlobalVariableDelete="GlobalVariableDelete",Y.GlobalVariableGet="GlobalVariableGet",Y.AddConnection="AddConnection",Y.GetConnectionValue="GetConnectionValue",Y.SetConnectionValue="SetConnectionValue",Y.ActivateSignal="ActivateSignal",Y.ContextVariableGet="ContextVariableGet"}(R||(R={}));class F{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(Y){if(Y.time||(Y.time=Date.now()),this.log.push(Y),this.logToConsole){var b;const C=null===(b=Y.BR)||void 0===b?void 0:b.value;"object"===typeof C&&C.getClassName?O.e.Log(`[FGLog] ${Y.className}:${Y.uniqueId.split("-")[0]} ${Y.action} - ${JSON.stringify(C.getClassName())}: ${C.toString()}`):O.e.Log(`[FGLog] ${Y.className}:${Y.uniqueId.split("-")[0]} ${Y.action} - ${JSON.stringify(Y.BR)}`)}}getItemsOfType(Y){return this.log.filter((b=>b.action===Y))}}class y{get enableLogging(){return this._enableLogging}set enableLogging(Y){this._enableLogging!==Y&&(this._enableLogging=Y,this._enableLogging?(this.logger=new F,this.logger.logToConsole=!0):this.logger=null)}constructor(Y){this.uniqueId=(0,B.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new q.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=Y,this.assetsContext=Y.assetsContext??Y.BC}hasVariable(Y){return Y in this._userVariables}setVariable(Y,b){var C;this._userVariables[Y]=b,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",BR:{name:Y,value:b}})}getAsset(Y,b){return(0,r.b)(this.assetsContext,Y,b)}getVariable(Y){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",BR:{name:Y,value:this._userVariables[Y]}}),this._userVariables[Y]}get userVariables(){return this._userVariables}uY(){return this._configuration.BC}_getUniqueIdPrefixedName(Y,b){return`${Y.uniqueId}_${b}`}_getGlobalContextVariable(Y,b){var C;return null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",BR:{name:Y,defaultValue:b,possibleValue:this._globalContextVariables[Y]}}),this._hasGlobalContextVariable(Y)?this._globalContextVariables[Y]:b}_setGlobalContextVariable(Y,b){var C;null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",BR:{name:Y,value:b}}),this._globalContextVariables[Y]=b}_deleteGlobalContextVariable(Y){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",BR:{name:Y}}),delete this._globalContextVariables[Y]}_hasGlobalContextVariable(Y){return Y in this._globalContextVariables}_setExecutionVariable(Y,b,C){this._executionVariables[this._getUniqueIdPrefixedName(Y,b)]=C}_getExecutionVariable(Y,b,C){return this._hasExecutionVariable(Y,b)?this._executionVariables[this._getUniqueIdPrefixedName(Y,b)]:C}_deleteExecutionVariable(Y,b){delete this._executionVariables[this._getUniqueIdPrefixedName(Y,b)]}_hasExecutionVariable(Y,b){return this._getUniqueIdPrefixedName(Y,b)in this._executionVariables}_hasConnectionValue(Y){return Y.uniqueId in this._connectionValues}_setConnectionValue(Y,b){var C;this._connectionValues[Y.uniqueId]=b,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",BR:{connectionPointId:Y.uniqueId,value:b}})}_setConnectionValueByKey(Y,b){this._connectionValues[Y]=b}_getConnectionValue(Y){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",BR:{connectionPointId:Y.uniqueId,value:this._connectionValues[Y.uniqueId]}}),this._connectionValues[Y.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(Y){this._pendingBlocks.includes(Y)||(this._pendingBlocks.push(Y),this._pendingBlocks.sort(((Y,b)=>Y.priority-b.priority)))}_removePendingBlock(Y){const b=this._pendingBlocks.indexOf(Y);-1!==b&&this._pendingBlocks.splice(b,1)}_clearPendingBlocks(){for(const Y of this._pendingBlocks)Y._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(Y){var b;this.onNodeExecutedObservable.notifyObservers(Y),null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:Y.getClassName(),uniqueId:Y.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(Y){this._setGlobalContextVariable("timeSinceStart",Y.timeSinceStart),this._setGlobalContextVariable("deltaTime",Y.deltaTime);for(const C of this._pendingBlocks){var b;null===(b=C._executeOnTick)||void 0===b||b.call(C,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.e;Y.uniqueId=this.uniqueId,Y._userVariables={};for(const R in this._userVariables)b(R,this._userVariables[R],Y._userVariables);Y._connectionValues={};for(const R in this._connectionValues)b(R,this._connectionValues[R],Y._connectionValues);var C;this.assetsContext!==this.uY()&&(Y._assetsContext={meshes:this.assetsContext.meshes.map((Y=>Y.id)),materials:this.assetsContext.materials.map((Y=>Y.id)),textures:this.assetsContext.textures.map((Y=>Y.name)),animations:this.assetsContext.animations.map((Y=>Y.name)),lights:this.assetsContext.lights.map((Y=>Y.id)),cameras:this.assetsContext.cameras.map((Y=>Y.id)),PS:null===(C=this.assetsContext.PS)||void 0===C?void 0:C.map((Y=>Y.name)),skeletons:this.assetsContext.skeletons.map((Y=>Y.id)),xy:this.assetsContext.xy.map((Y=>Y.name)),geometries:this.assetsContext.geometries.map((Y=>Y.id)),multiMaterials:this.assetsContext.multiMaterials.map((Y=>Y.id)),transformNodes:this.assetsContext.transformNodes.map((Y=>Y.id))})}getClassName(){return"FlowGraphContext"}}(0,A.c)([(0,E.K)()],y.prototype,"uniqueId",void 0);var S=C(14433),n=C(13099);class t{constructor(Y){this.onEventTriggeredObservable=new q.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=Y,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Sb.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const Y=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",BR:{timeSinceStart:this._startingTime,deltaTime:Y}}),this._startingTime+=Y})),this._meshPickedObserver=this._scene.onPointerObservable.add((Y=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",BR:Y})}),n.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((Y=>{const b=Y.pointerId,C=Y.mesh,R=this._pointerUnderMeshState[b];!R&&C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",BR:{pointerId:b,mesh:C}}):R&&!C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",BR:{pointerId:b,mesh:R}}):R&&C&&R!==C&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",BR:{pointerId:b,mesh:R,over:C}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",BR:{pointerId:b,mesh:C,out:R}})),this._pointerUnderMeshState[b]=C}),n.d.POINTERMOVE)}dispose(){var Y,b,C,R,q;null===(Y=this._sceneDisposeObserver)||void 0===Y||Y.remove(),null===(b=this._sceneReadyObserver)||void 0===b||b.remove(),null===(C=this._sceneOnBeforeRenderObserver)||void 0===C||C.remove(),null===(R=this._meshPickedObserver)||void 0===R||R.remove(),null===(q=this._meshUnderPointerObserver)||void 0===q||q.remove(),this.onEventTriggeredObservable.clear()}}var I,w=C(14448);!function(Y){Y[Y.Stopped=0]="Stopped",Y[Y.Started=1]="Started"}(I||(I={}));class Q{get state(){return this._state}set state(Y){this._state=Y,this.onStateChangedObservable.notifyObservers(Y)}constructor(Y){this.onStateChangedObservable=new q.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=Y.BC,this._sceneEventCoordinator=new t(this._scene),this._coordinator=Y.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((Y=>{for(const b of this._executionContexts){const C=this._getContextualOrder(Y.type,b);for(const R of C)if(!R._executeEvent(b,Y.BR))break}switch(Y.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const b of this._executionContexts)b._notifyOnTick(Y.BR);break;case"SceneDispose":this.dispose()}}))}createContext(){const Y=new y({BC:this._scene,coordinator:this._coordinator});return this._executionContexts.push(Y),Y}getContext(Y){return this._executionContexts[Y]}addEventBlock(Y){if("PointerOver"!==Y.type&&"PointerOut"!==Y.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==Y.type&&this._eventBlocks[Y.type].push(Y),1===this.state)for(const b of this._executionContexts)Y._startPendingTasks(b);else this.onStateChangedObservable.addOnce((b=>{if(1===b)for(const C of this._executionContexts)Y._startPendingTasks(C)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((Y=>{1===Y&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const Y of this._executionContexts)for(const b in this._eventBlocks){const C=this._getContextualOrder(b,Y);for(const b of C)b._startPendingTasks(Y)}}_getContextualOrder(Y,b){const C=this._eventBlocks[Y].sort(((Y,b)=>b.initPriority-Y.initPriority));if("MeshPick"===Y){const Y=[];for(const R of C){const q=R.asset.getValue(b);let A=0;for(;A<C.length;A++){const Y=C[A].asset.getValue(b);if(q&&Y&&(0,w.g)(q,Y))break}Y.splice(A,0,R)}return Y}return C}dispose(){var Y;if(0!==this.state){this.state=0;for(const Y of this._executionContexts)Y._clearPendingBlocks();this._executionContexts.length=0;for(const Y in this._eventBlocks)this._eventBlocks[Y].length=0;null===(Y=this._eventObserver)||void 0===Y||Y.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(Y){const b=[],C=new Set;for(const R in this._eventBlocks)for(const Y of this._eventBlocks[R])b.push(Y),C.add(Y.uniqueId);for(;b.length>0;){const R=b.pop();Y(R);for(const Y of R.dataInputs)for(const R of Y._connectedPoint)C.has(R._ownerBlock.uniqueId)||(b.push(R._ownerBlock),C.add(R._ownerBlock.uniqueId));if(R instanceof S.d)for(const Y of R.signalOutputs)for(const R of Y._connectedPoint)C.has(R._ownerBlock.uniqueId)||(b.push(R._ownerBlock),C.add(R._ownerBlock.uniqueId))}}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;Y.allBlocks=[],this.visitAllBlocks((b=>{const C={};b.serialize(C),Y.allBlocks.push(C)})),Y.executionContexts=[];for(const C of this._executionContexts){const R={};C.serialize(R,b),Y.executionContexts.push(R)}}}class N{constructor(Y){this.config=Y,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.BC.Sb.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.BC.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const Y=this._executeOnNextFrame.slice(0);if(Y.length)for(const b of Y){this.notifyCustomEvent(b.id,b.data,!1);const Y=this._executeOnNextFrame.findIndex((Y=>Y.uniqueId===b.uniqueId));-1!==Y&&this._executeOnNextFrame.splice(Y,1)}}));(N.SceneCoordinators.get(this.config.BC)??[]).push(this)}createGraph(){const Y=new Q({BC:this.config.BC,coordinator:this});return this._flowGraphs.push(Y),Y}removeGraph(Y){const b=this._flowGraphs.indexOf(Y);-1!==b&&(Y.dispose(),this._flowGraphs.splice(b,1))}start(){for(const Y of this._flowGraphs)Y.start()}dispose(){var Y,b;for(const q of this._flowGraphs)q.dispose();this._flowGraphs.length=0,null===(Y=this._disposeObserver)||void 0===Y||Y.remove(),null===(b=this._onBeforeRenderObserver)||void 0===b||b.remove();const C=N.SceneCoordinators.get(this.config.BC)??[],R=C.indexOf(this);-1!==R&&C.splice(R,1)}serialize(Y,b){Y._flowGraphs=[];for(const C of this._flowGraphs){const R={};C.serialize(R,b),Y._flowGraphs.push(R)}Y.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(Y){let b=this._customEventsMap.get(Y);return b||(b=new q.d,this._customEventsMap.set(Y,b)),b}notifyCustomEvent(Y,b){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:Y,data:b,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(Y)){const b=this._eventExecutionCounter.get(Y);if(this._eventExecutionCounter.set(Y,b+1),b>=N.MaxEventTypeExecutionPerFrame)return void(b===N.MaxEventTypeExecutionPerFrame&&O.e.Warn(`FlowGraphCoordinator: Too many executions of event "${Y}".`))}else this._eventExecutionCounter.set(Y,1);const C=this._customEventsMap.get(Y);C&&C.notifyObservers(b)}}N.MaxEventsPerType=30,N.MaxEventTypeExecutionPerFrame=30,N.SceneCoordinators=new Map},14457:(Y,b,C)=>{"use strict";C.d(b,{c:()=>q});var R=C(14460);class q extends R.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(Y){Y._notifyExecuteNode(this),this.done._activateSignal(Y)}}},14433:(Y,b,C)=>{"use strict";C.d(b,{d:()=>B});var R=C(14437),q=C(14444),A=C(12790);class E extends q.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(Y){super.connectTo(Y),this._connectedPoint.sort(((Y,b)=>b.priority-Y.priority))}_activateSignal(Y){var b;if(null===(b=Y.logger)||void 0===b||b.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,BR:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)Y._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(Y,this),Y._increaseExecutionId();else for(const C of this._connectedPoint)C._activateSignal(Y)}}(0,A.g)("FlowGraphSignalConnection",E);class B extends R.e{constructor(Y){super(Y),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(Y){const b=new E(Y,0,this);return this.signalInputs.push(b),b}_registerSignalOutput(Y){const b=new E(Y,1,this);return this.signalOutputs.push(b),b}_unregisterSignalInput(Y){const b=this.signalInputs.findIndex((b=>b.name===Y));-1!==b&&(this.signalInputs[b].dispose(),this.signalInputs.splice(b,1))}_unregisterSignalOutput(Y){const b=this.signalOutputs.findIndex((b=>b.name===Y));-1!==b&&(this.signalOutputs[b].dispose(),this.signalOutputs.splice(b,1))}_reportError(Y,b){this.error.BR="string"===typeof b?new Error(b):b,this.error._activateSignal(Y)}getSignalInput(Y){return this.signalInputs.find((b=>b.name===Y))}getSignalOutput(Y){return this.signalOutputs.find((b=>b.name===Y))}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Y),Y.signalInputs=[],Y.signalOutputs=[];for(const b of this.signalInputs){const C={};b.serialize(C),Y.signalInputs.push(C)}for(const b of this.signalOutputs){const C={};b.serialize(C),Y.signalOutputs.push(C)}}deserialize(Y){for(let b=0;b<Y.signalInputs.length;b++){const C=this.getSignalInput(Y.signalInputs[b].name);if(!C)throw new Error("Could not find signal input with name "+Y.signalInputs[b].name+" in block "+Y.className);C.deserialize(Y.signalInputs[b])}for(let b=0;b<Y.signalOutputs.length;b++){const C=this.getSignalOutput(Y.signalOutputs[b].name);if(!C)throw new Error("Could not find signal output with name "+Y.signalOutputs[b].name+" in block "+Y.className);C.deserialize(Y.signalOutputs[b])}}getClassName(){return"FlowGraphExecutionBlock"}}},14466:(Y,b,C)=>{"use strict";C.d(b,{d:()=>q});var R=C(14433);class q extends R.d{constructor(Y){super(Y),this.out=this._registerSignalOutput("out")}}},14424:(Y,b,C)=>{"use strict";C.d(b,{A:()=>n,D:()=>t,F:()=>l,I:()=>X,J:()=>c,M:()=>u,b:()=>r,f:()=>y,i:()=>L,j:()=>I,m:()=>w,n:()=>Q,q:()=>F,t:()=>mY,u:()=>O,x:()=>S});var R,q=C(12831),A=C(12880),E=C(14420),B=C(14426);!function(Y){Y.Any="any",Y.String="string",Y.Number="number",Y.Boolean="boolean",Y.Object="object",Y.Integer="FlowGraphInteger",Y.Vector2="Vector2",Y.AC="AC",Y.Vector4="Vector4",Y.Quaternion="Quaternion",Y.Matrix="Matrix",Y.Matrix2D="Matrix2D",Y.Matrix3D="Matrix3D",Y.rC="rC",Y.hb="hb"}(R||(R={}));class g{constructor(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=Y,this.defaultValue=b,this.animationType=C}serialize(Y){Y.typeName=this.typeName,Y.defaultValue=this.defaultValue}}const r=new g("any",void 0),O=new g("string",""),F=new g("number",0,0),y=new g("boolean",!1),S=new g("Vector2",q.Vector2.Zero(),5),n=new g("AC",q.AC.Zero(),1),t=new g("Vector4",q.Vector4.Zero()),I=new g("Matrix",q.Matrix.Identity(),3),w=new g("Matrix2D",new B.b),Q=new g("Matrix3D",new B.f),N=new g("rC",A.rC.Black(),4),p=new g("hb",new A.hb(0,0,0,0),7),mY=new g("Quaternion",q.Quaternion.Identity(),2);mY.typeTransformer=Y=>{if(Y.getClassName){if("Vector4"===Y.getClassName())return q.Quaternion.OC(Y.cb());if("AC"===Y.getClassName())return q.Quaternion.FromEulerVector(Y);if("Matrix"===Y.getClassName())return q.Quaternion.FromRotationMatrix(Y)}return Y};const L=new g("FlowGraphInteger",new E.d(0),0);function u(Y){const b=Y;switch(typeof Y){case"string":return O;case"number":return F;case"boolean":return y;case"object":if(b.getClassName)switch(b.getClassName()){case"Vector2":return S;case"AC":return n;case"Vector4":return t;case"Matrix":return I;case"rC":return N;case"hb":return p;case"Quaternion":return mY;case"FlowGraphInteger":return L;case"Matrix2D":return w;case"Matrix3D":return Q}return r;default:return r}}function c(Y){switch(Y){case"string":return O;case"number":return F;case"boolean":return y;case"Vector2":return S;case"AC":return n;case"Vector4":return t;case"Matrix":return I;case"rC":return N;case"hb":return p;case"Quaternion":return mY;case"FlowGraphInteger":return L;case"Matrix2D":return w;case"Matrix3D":return Q;default:return r}}function l(Y){switch(Y){case"number":default:return 0;case"Vector2":return 5;case"AC":return 1;case"Matrix":return 3;case"rC":return 4;case"hb":return 7;case"Quaternion":return 2}}function X(Y){switch(Y){case 0:return F;case 5:return S;case 1:return n;case 3:return I;case 4:return N;case 7:return p;case 2:return mY;default:return r}}},14412:(Y,b,C)=>{"use strict";C.d(b,{c:()=>O,e:()=>r,h:()=>F});var R=C(12880),q=C(12831),A=C(14420),E=C(14424),B=C(14426);function g(Y){return"Vector2"===Y||"AC"===Y||"Vector4"===Y||"Quaternion"===Y||"rC"===Y||"hb"===Y}function r(Y,b,C){var R;const q=(null===b||void 0===b||null===(R=b.getClassName)||void 0===R?void 0:R.call(b))??"";if(g(q)||function(Y){return"Matrix"===Y||"Matrix2D"===Y||"Matrix3D"===Y}(q))C[Y]={value:b.cb(),className:q};else if("FlowGraphInteger"===q)C[Y]={value:b.value,className:q};else if(q&&(b.id||b.name))C[Y]={id:b.id,name:b.name,className:q};else{if("object"===typeof b)throw new Error(`Could not serialize value ${b}`);C[Y]=b}}function O(Y,b,C,r){const F=b[Y];let y;const S=(null===F||void 0===F?void 0:F.type)??(null===F||void 0===F?void 0:F.className);if(function(Y){return"Mesh"===Y||"AbstractMesh"===Y||"GroundMesh"===Y||"InstanceMesh"===Y||"LinesMesh"===Y||"GoldbergMesh"===Y||"GreasedLineMesh"===Y||"TrailMesh"===Y}(S)){let Y=r.meshes.filter((Y=>F.id?Y.id===F.id:Y.name===F.name));0===Y.length&&(Y=r.transformNodes.filter((Y=>F.id?Y.id===F.id:Y.name===F.name))),y=F.uniqueId?Y.find((Y=>Y.uniqueId===F.uniqueId)):Y[0]}else if(g(S))y=function(Y,b){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===Y)return q.Vector2.OC(b);if("AC"===Y)return C&&(b[2]*=-1),q.AC.OC(b);if("Vector4"===Y)return q.Vector4.OC(b);if("Quaternion"===Y)return C&&(b[2]*=-1,b[3]*=-1),q.Quaternion.OC(b);if("rC"===Y)return new R.rC(b[0],b[1],b[2]);if("hb"===Y)return new R.hb(b[0],b[1],b[2],b[3]);throw new Error(`Unknown vector class name ${Y}`)}(S,F.value);else if(function(Y){return"AnimationGroup"===Y}(S)){const Y=r.animationGroups.filter((Y=>Y.name===F.name));y=1===Y.length?Y[0]:Y.find((Y=>Y.uniqueId===F.uniqueId))}else y="Matrix"===S?q.Matrix.OC(F.value):"Matrix2D"===S?new B.b(F.value):"Matrix3D"===S?new B.f(F.value):"FlowGraphInteger"===S?A.d.FromValue(F.value):"number"===S||"string"===S||"boolean"===S?F.value[0]:F&&void 0!==F.value?F.value:Array.isArray(F)?F.reduce(((Y,b)=>b.eventData?(Y[b.id]={type:(0,E.J)(b.type)},"undefined"!==typeof b.value&&(Y[b.id].value=O("value",b,C,r)),Y):Y),{}):F;return y}function F(Y){return"FlowGraphJsonPointerParserBlock"===Y}},14448:(Y,b,C)=>{"use strict";function R(Y,b){return!(!Y.parent||Y.parent!==b&&!R(Y.parent,b))}function q(Y){if(Y.getClassName)return Y.getClassName()}function A(Y,b){return Y===b&&("Vector2"===Y||"AC"===Y||"Vector4"===Y||"Quaternion"===Y)}function E(Y,b){return Y===b&&("Matrix"===Y||"Matrix2D"===Y||"Matrix3D"===Y)}function B(Y,b){return"FlowGraphInteger"===Y&&"FlowGraphInteger"===b}function g(Y,b){const C="number"===typeof Y||"number"===typeof(null===Y||void 0===Y?void 0:Y.value);return C&&!b?!isNaN(r(Y)):C}function r(Y){return"number"===typeof Y?Y:Y.value}C.d(b,{b:()=>B,c:()=>E,d:()=>A,f:()=>q,g:()=>R,j:()=>r,m:()=>g})},14872:(Y,b,C)=>{"use strict";C.r(b),C.d(b,{SceneInstrumentation:()=>A});var R=C(12645),q=C(13050);class A{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(Y){Y!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=Y,Y?(this._onBeforeActiveMeshesEvaluationObserver=this.BC.onBeforeActiveMeshesEvaluationObservable.add((()=>{R.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.BC.onAfterActiveMeshesEvaluationObservable.add((()=>{R.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.BC.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.BC.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(Y){Y!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=Y,Y?(this._onBeforeRenderTargetsRenderObserver=this.BC.onBeforeRenderTargetsRenderObservable.add((()=>{R.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.BC.onAfterRenderTargetsRenderObservable.add((()=>{R.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.BC.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.BC.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(Y){Y!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=Y,Y?(this._onBeforeParticlesRenderingObserver=this.BC.onBeforeParticlesRenderingObservable.add((()=>{R.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.BC.onAfterParticlesRenderingObservable.add((()=>{R.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.BC.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.BC.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(Y){Y!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=Y,this.BC.spriteManagers&&(Y?(this._onBeforeSpritesRenderingObserver=this.BC.onBeforeSpritesRenderingObservable.add((()=>{R.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.BC.onAfterSpritesRenderingObservable.add((()=>{R.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.BC.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.BC.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(Y){Y!==this._capturePhysicsTime&&this.BC.onBeforePhysicsObservable&&(this._capturePhysicsTime=Y,Y?(this._onBeforePhysicsObserver=this.BC.onBeforePhysicsObservable.add((()=>{R.Tools.StartPerformanceCounter("xb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.BC.onAfterPhysicsObservable.add((()=>{R.Tools.EndPerformanceCounter("xb"),this._physicsTime.endMonitoring()}))):(this.BC.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.BC.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(Y){Y!==this._captureAnimationsTime&&(this._captureAnimationsTime=Y,Y?this._onAfterAnimationsObserver=this.BC.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.BC.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(Y){this._captureFrameTime=Y}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(Y){this._captureInterFrameTime=Y}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(Y){Y!==this._captureRenderTime&&(this._captureRenderTime=Y,Y?(this._onBeforeDrawPhaseObserver=this.BC.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),R.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.BC.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),R.Tools.EndPerformanceCounter("Main render")}))):(this.BC.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.BC.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(Y){Y!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=Y,Y?(this._onBeforeCameraRenderObserver=this.BC.onBeforeCameraRenderObservable.add((Y=>{this._cameraRenderTime.beginMonitoring(),R.Tools.StartPerformanceCounter(`Rendering camera ${Y.name}`)})),this._onAfterCameraRenderObserver=this.BC.onAfterCameraRenderObservable.add((Y=>{this._cameraRenderTime.endMonitoring(!1),R.Tools.EndPerformanceCounter(`Rendering camera ${Y.name}`)}))):(this.BC.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.BC.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.BC.getEngine()._drawCalls}constructor(Y){this.BC=Y,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new q.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new q.d,this._captureFrameTime=!1,this._frameTime=new q.d,this._captureRenderTime=!1,this._renderTime=new q.d,this._captureInterFrameTime=!1,this._interFrameTime=new q.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new q.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new q.d,this._capturePhysicsTime=!1,this._physicsTime=new q.d,this._captureAnimationsTime=!1,this._animationsTime=new q.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new q.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=Y.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(R.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.BC.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=Y.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(R.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.yb(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.yb(),this._captureParticlesRenderTime&&this._particlesRenderTime.yb(),this._captureSpritesRenderTime&&this._spritesRenderTime.yb(),this._captureRenderTime&&this._renderTime.yb(),this._captureCameraRenderTime&&this._cameraRenderTime.yb()}))}dispose(){this._disposed||(this.BC.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.BC.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.BC.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.BC.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.BC.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.BC.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.BC.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.BC.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.BC.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.BC.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.BC.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.BC.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.BC.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.BC.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.BC.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.BC.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.BC.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.BC=null,this._disposed=!0)}}},14404:(Y,b,C)=>{"use strict";C.d(b,{c:()=>O});var R=C(12818),q=C(12821),A=C(12831),E=C(13242),B=C(13366),g=C(13421),r=C(12790);E.d.AddNodeConstructor("Light_Type_1",((Y,b)=>()=>new O(Y,A.AC.Zero(),b)));class O extends g.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(Y){this._shadowFrustumSize=Y,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(Y){this._shadowOrthoScale=Y,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(Y){this._orthoLeft=Y}get orthoRight(){return this._orthoRight}set orthoRight(Y){this._orthoRight=Y}get orthoTop(){return this._orthoTop}set orthoTop(Y){this._orthoTop=Y}get orthoBottom(){return this._orthoBottom}set orthoBottom(Y){this._orthoBottom=Y}constructor(Y,b,C){super(Y,C),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=b.scale(-1),this.direction=b}getClassName(){return"ab"}getTypeID(){return B.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(Y,b,C){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(Y):this._setDefaultAutoExtendShadowProjectionMatrix(Y,b,C)}_setDefaultFixedFrustumShadowProjectionMatrix(Y){const b=this.uY().activeCamera;b&&A.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:b.Xb,void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,Y,this.uY().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(Y,b,C){const R=this.uY().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const Y=A.AC.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let R=Number.MAX_VALUE,q=-Number.MAX_VALUE;for(let E=0;E<C.length;E++){const B=C[E];if(!B)continue;const g=B.getBoundingInfo().boundingBox;for(let C=0;C<g.vectorsWorld.length;C++)A.AC.TransformCoordinatesToRef(g.vectorsWorld[C],b,Y),Y.x<this._orthoLeft&&(this._orthoLeft=Y.x),Y.y<this._orthoBottom&&(this._orthoBottom=Y.y),Y.x>this._orthoRight&&(this._orthoRight=Y.x),Y.y>this._orthoTop&&(this._orthoTop=Y.y),this.autoCalcShadowZBounds&&(Y.z<R&&(R=Y.z),Y.z>q&&(q=Y.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=R,this._shadowMaxZ=q)}const q=this._orthoRight-this._orthoLeft,E=this._orthoTop-this._orthoBottom,B=void 0!==this.shadowMinZ?this.shadowMinZ:(null===R||void 0===R?void 0:R.Xb)||0,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===R||void 0===R?void 0:R.maxZ)||1e4,r=this.uY().getEngine().o;A.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-q*this.shadowOrthoScale,this._orthoRight+q*this.shadowOrthoScale,this._orthoBottom-E*this.shadowOrthoScale,this._orthoTop+E*this.shadowOrthoScale,r?g:B,r?B:g,Y,this.uY().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Y,b){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,b),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,b),this)}transferToNodeMaterialEffect(Y,b){return this.computeTransformedInformation()?(Y.setFloat3(b,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(Y.setFloat3(b,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(Y){const b=this._scene.getEngine();return!b.o&&b.isNDCHalfZRange?0:1}getDepthMaxZ(Y){const b=this._scene.getEngine();return b.o&&b.isNDCHalfZRange?0:1}prepareLightSpecificDefines(Y,b){Y["DIRLIGHT"+b]=!0}}(0,R.c)([(0,q.K)()],O.prototype,"shadowFrustumSize",null),(0,R.c)([(0,q.K)()],O.prototype,"shadowOrthoScale",null),(0,R.c)([(0,q.K)()],O.prototype,"autoUpdateExtends",void 0),(0,R.c)([(0,q.K)()],O.prototype,"autoCalcShadowZBounds",void 0),(0,R.c)([(0,q.K)("orthoLeft")],O.prototype,"_orthoLeft",void 0),(0,R.c)([(0,q.K)("orthoRight")],O.prototype,"_orthoRight",void 0),(0,R.c)([(0,q.K)("orthoTop")],O.prototype,"_orthoTop",void 0),(0,R.c)([(0,q.K)("orthoBottom")],O.prototype,"_orthoBottom",void 0),(0,r.g)("BABYLON.DirectionalLight",O)},15055:(Y,b,C)=>{"use strict";C.d(b,{c:()=>O});var R=C(12818),q=C(12821),A=C(12831),E=C(12880),B=C(13242),g=C(13366),r=C(12790);B.d.AddNodeConstructor("Light_Type_3",((Y,b)=>()=>new O(Y,A.AC.Zero(),b)));class O extends g.e{constructor(Y,b,C){super(Y,C),this.groundColor=new E.rC(0,0,0),this.direction=b||A.AC.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Mb"}setDirectionToTarget(Y){return this.direction=A.AC.Normalize(Y.EC(A.AC.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(Y,b){const C=A.AC.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",C.x,C.y,C.z,0,b),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.ib),b),this}transferToNodeMaterialEffect(Y,b){const C=A.AC.Normalize(this.direction);return Y.setFloat3(b,C.x,C.y,C.z),this}Tb(){return this._worldMatrix||(this._worldMatrix=A.Matrix.Identity()),this._worldMatrix}getTypeID(){return g.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(Y,b){Y["HEMILIGHT"+b]=!0}}(0,R.c)([(0,q.m)()],O.prototype,"groundColor",void 0),(0,R.c)([(0,q.H)()],O.prototype,"direction",void 0),(0,r.g)("BABYLON.HemisphericLight",O)},14362:(Y,b,C)=>{"use strict";C.d(b,{c:()=>F});var R=C(12818),q=C(12821),A=C(12831),E=C(13242),B=C(13366),g=C(13421),r=C(12814),O=C(12790);E.d.AddNodeConstructor("Light_Type_2",((Y,b)=>()=>new F(Y,A.AC.Zero(),A.AC.Zero(),0,0,b)));class F extends g.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(Y){this._iesProfileTexture!==Y&&(this._iesProfileTexture=Y,this._iesProfileTexture&&F._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(Y){this._angle=Y,this._cosHalfAngle=Math.cos(.5*Y),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(Y){this._innerAngle=Y,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(Y){this._shadowAngleScale=Y,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(Y){this._projectionTextureLightNear=Y,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(Y){this._projectionTextureLightFar=Y,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(Y){this._projectionTextureUpDirection=Y,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(Y){this._projectionTexture!==Y&&(this._projectionTexture=Y,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(F._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):F._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(Y){return void 0!==Y.onGeneratedObservable}static _IsTexture(Y){return void 0!==Y.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(Y){this._projectionTextureProjectionLightMatrix=Y,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(Y,b,C,R,q,E){super(Y,E),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=A.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=A.AC.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=A.AC.Zero(),this._projectionTextureViewLightMatrix=A.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=A.Matrix.Zero(),this._projectionTextureScalingMatrix=A.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=b,this.direction=C,this.angle=R,this.exponent=q}getClassName(){return"SpotLight"}getTypeID(){return B.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(Y){super._setDirection(Y),this._projectionTextureViewLightDirty=!0}_setPosition(Y){super._setPosition(Y),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(Y,b,C){const R=this.uY().activeCamera;if(!R)return;this._shadowAngleScale=this._shadowAngleScale||1;const q=this._shadowAngleScale*this._angle,E=void 0!==this.shadowMinZ?this.shadowMinZ:R.Xb,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:R.maxZ,g=this.uY().getEngine().o;A.Matrix.PerspectiveFovLHToRef(q,1,g?B:E,g?E:B,Y,!0,this._scene.getEngine().isNDCHalfZRange,void 0,g)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),A.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const Y=this.projectionTextureLightFar,b=this.projectionTextureLightNear,C=Y/(Y-b),R=-C*b,q=1/Math.tan(this._angle/2);A.Matrix.FromValuesToRef(q/1,0,0,0,0,q,0,0,0,0,C,1,0,0,R,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof r.b){const Y=this._projectionTexture.uScale/2,b=this._projectionTexture.vScale/2;A.Matrix.FromValuesToRef(Y,0,0,0,0,b,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(Y,b){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),Y.setMatrix("textureProjectionMatrix"+b,this._projectionTextureMatrix),Y.setTexture("projectionLightTexture"+b,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&Y.setTexture("iesLightTexture"+b,this._iesProfileTexture),this}transferToEffect(Y,b){let C;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,b),C=A.AC.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,b),C=A.AC.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",C.x,C.y,C.z,this._cosHalfAngle,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,b),this}transferToNodeMaterialEffect(Y,b){let C;return C=this.computeTransformedInformation()?A.AC.Normalize(this.transformedDirection):A.AC.Normalize(this.direction),this.uY().useRightHandedSystem?Y.setFloat3(b,-C.x,-C.y,-C.z):Y.setFloat3(b,C.x,C.y,C.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(Y){const b=this._scene.getEngine(),C=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Y||void 0===Y?void 0:Y.Xb)??0;return b.o&&b.isNDCHalfZRange?C:this._scene.getEngine().isNDCHalfZRange?0:C}getDepthMaxZ(Y){const b=this._scene.getEngine(),C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Y||void 0===Y?void 0:Y.maxZ)??1e4;return b.o&&b.isNDCHalfZRange?0:C}prepareLightSpecificDefines(Y,b){Y["SPOTLIGHT"+b]=!0,Y["PROJECTEDLIGHTTEXTURE"+b]=!(!this.projectionTexture||!this.projectionTexture.isReady()),Y["IESLIGHTTEXTURE"+b]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,R.c)([(0,q.K)()],F.prototype,"angle",null),(0,R.c)([(0,q.K)()],F.prototype,"innerAngle",null),(0,R.c)([(0,q.K)()],F.prototype,"shadowAngleScale",null),(0,R.c)([(0,q.K)()],F.prototype,"exponent",void 0),(0,R.c)([(0,q.K)()],F.prototype,"projectionTextureLightNear",null),(0,R.c)([(0,q.K)()],F.prototype,"projectionTextureLightFar",null),(0,R.c)([(0,q.K)()],F.prototype,"projectionTextureUpDirection",null),(0,R.c)([(0,q.E)("projectedLightTexture")],F.prototype,"_projectionTexture",void 0),(0,O.g)("BABYLON.SpotLight",F)},14080:(Y,b,C)=>{"use strict";C.d(b,{b:()=>E,e:()=>A,f:()=>B});const R={},q={};function A(Y,b){R[Y]=b}function E(Y,b){q[Y]=b}function B(Y){return q[Y]?q[Y]:null}},13980:(Y,b,C)=>{"use strict";C.d(b,{e:()=>u,f:()=>o});var R,q=C(12645),A=C(12652),E=C(13077),B=C(12702),g=C(12669),r=C(13294),O=C(12709),F=C(12715),y=C(12799),S=C(12733),n=C(12696);!function(Y){Y[Y.Clean=0]="Clean",Y[Y.Stop=1]="Stop",Y[Y.Sync=2]="Sync",Y[Y.NoSync=3]="NoSync"}(R||(R={}));const t=new A.d,I={};let w=!1;function Q(){return I[".babylon"]}function N(Y,b){const C=I[Y];return C||(g.e.Warn("Unable to find a plugin to load "+Y+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),b?Q():void 0)}function p(Y,b,C){let R="Unable to load from "+(Y.rawData?"binary data":Y.url);return b?R+=`: ${b}`:C&&(R+=`: ${C}`),R}async function mY(Y,b,C,R,q,A,E,B,g){var r;const F="data:"===(y=Y.url).substring(0,5)?y.substring(5):null;var y;if(Y.rawData&&!E)throw"When using ArrayBufferView to load data the file extension must be provided.";const w=F||E?"":function(Y){const b=Y.indexOf("?");-1!==b&&(Y=Y.substring(0,b));const C=Y.lastIndexOf(".");return Y.substring(C,Y.length).toLowerCase()}(Y.url);let p=E?N(E,!0):F?function(Y){for(const b in I){const C=I[b].plugin;if(C.canDirectLoad&&C.canDirectLoad(Y))return I[b]}return Q()}(Y.url):N(w,!1);if(!p&&w){if(Y.url&&!Y.url.startsWith("blob:")){const b=await async function(Y,b){const C=b.method||"GET";return await new Promise(((R,q)=>{const A=new n.e;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const Y={};if(b.responseHeaders)for(const C of b.responseHeaders)Y[C]=A.getResponseHeader(C)||"";R({response:A.response,headerValues:Y})}else q(`Unable to fetch data from ${Y}. Error code: ${A.status}`)})),A.open(C,Y),A.send()}))}(Y.url,{method:"HEAD",responseHeaders:["Content-Type"]}),C=b.headerValues?b.headerValues["Content-Type"]:"";C&&(p=function(Y){for(const b in I){const C=I[b];if(C.mimeType===Y)return C}}(C))}p||(p=Q())}if(!p)throw new Error(`No plugin or fallback for ${E??Y.url}`);if(!1===(null===g||void 0===g||null===(r=g[p.plugin.name])||void 0===r?void 0:r.enabled))throw new Error(`The '${p.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(Y.rawData&&!p.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(Y=>{if(p.plugin.createPlugin){const b=p.plugin.createPlugin(g??{});return b instanceof Promise?(b.then(Y).catch((Y=>{q("Error instantiating plugin.",Y)})),null):(Y(b),b)}return Y(p.plugin),p.plugin})((g=>{var r;if(!g)throw`The loader plugin corresponding to the '${E}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(t.notifyObservers(g),F&&(g.canDirectLoad&&g.canDirectLoad(Y.url)||!(0,O.p)(Y.url))){if(g.directLoad){const Y=g.directLoad(b,F);Y instanceof Promise?Y.then((Y=>{C(g,Y)})).catch((Y=>{q("Error in directLoad of _loadData: "+Y,Y)})):C(g,Y)}else C(g,F);return}const y=p.isBinary,n=(Y,R)=>{b.O?q("Scene has been disposed"):C(g,Y,R)};let I=null,w=!1;null===(r=g.Sb)||void 0===r||r.add((()=>{w=!0,I&&(I.abort(),I=null),A()}));const Q=()=>{if(w)return;const C=(Y,b)=>{q(null===Y||void 0===Y?void 0:Y.statusText,b)};if(!g.loadFile&&Y.rawData)throw"Plugin does not support loading ArrayBufferView.";I=g.loadFile?g.loadFile(b,Y.rawData||Y.file||Y.url,Y.rootUrl,n,R,y,C,B):b._loadFile(Y.file||Y.url,n,R,!0,y,C)},N=b.getEngine();let mY=N.enableOfflineSupport;if(mY){let C=!1;for(const R of b.disableOfflineSupportExceptionRules)if(R.test(Y.url)){C=!0;break}mY=!C}mY&&S.b.OfflineProviderFactory?b.offlineProvider=S.b.OfflineProviderFactory(Y.url,Q,N.disableManifestCheck):Q()}))}function L(Y,b){let C,R,A=null,E=null;if(b)if(b.name)C=`file:${b.name}`,R=b.name,A=b;else if(ArrayBuffer.isView(b))C="",R=(0,y.e)(),E=b;else if(b.startsWith("data:"))C=b,R="";else if(Y){const A=b;if("/"===A.substring(0,1))return q.Tools.Error("Wrong sceneFilename parameter"),null;C=Y+A,R=A}else C=b,R=q.Tools.GetFilename(b),Y=q.Tools.GetFolderPath(b);else C=Y,R=q.Tools.GetFilename(Y),Y=q.Tools.GetFolderPath(Y);return{url:C,rootUrl:Y,name:R,file:A,rawData:E}}function u(Y){if("string"===typeof Y.extensions){const b=Y.extensions;I[b.toLowerCase()]={plugin:Y,isBinary:!1}}else{const b=Y.extensions,C=Object.keys(b);for(const R of C)I[R.toLowerCase()]={plugin:Y,isBinary:b[R].isBinary,mimeType:b[R].mimeType}}}async function c(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.d.LastCreatedScene,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!R)return g.e.Error("No scene available to import mesh to"),null;const S=L(b,C);if(!S)return null;const n={};R.addPendingData(n);const t=()=>{R.removePendingData(n)},I=(Y,b)=>{const C=p(S,Y,b);E?E(R,C,new F.i(C,F.e.SceneLoaderError,b)):g.e.Error(C),t()},w=A?Y=>{try{A(Y)}catch(b){I("Error in onProgress callback: "+b,b)}}:void 0,Q=(Y,b,C,A,E,B,g,r)=>{if(R.importedMeshesFiles.push(S.url),q)try{q(Y,b,C,A,E,B,g,r)}catch(O){I("Error in onSuccess callback: "+O,O)}R.removePendingData(n)};return await mY(S,R,((b,C,q)=>{if(b.rewriteRootURL&&(S.rootUrl=b.rewriteRootURL(S.rootUrl,q)),b.importMesh){const q=[],A=[],E=[];if(!b.importMesh(Y,R,C,S.rootUrl,q,A,E,I))return;R.loadingPluginName=b.name,Q(q,A,E,[],[],[],[],[])}else{b.importMeshAsync(Y,R,C,S.rootUrl,w,S.name).then((Y=>{R.loadingPluginName=b.name,Q(Y.meshes,Y.xy,Y.skeletons,Y.animationGroups,Y.transformNodes,Y.geometries,Y.lights,Y.spriteManagers)})).catch((Y=>{I(Y.message,Y)}))}}),w,I,t,r,O,y)}async function l(Y,b,C,R,q,A,E,B){return await new Promise(((g,r)=>{try{c(Y,b,C,R,((Y,b,C,R,q,A,E,B)=>{g({meshes:Y,xy:b,skeletons:C,animationGroups:R,transformNodes:q,geometries:A,lights:E,spriteManagers:B})}),q,((Y,b,C)=>{r(C||new Error(b))}),A,E,B).catch(r)}catch(F){r(F)}}))}async function X(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.d.LastCreatedEngine,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};C?await T(Y,b,new E.b(C),R,A,g,r,O,F):q.Tools.Error("No engine available")}async function j(Y,b,C,R,q,A,E){return await new Promise(((B,g)=>{X(Y,b,C,(Y=>{B(Y)}),R,((Y,b,C)=>{g(C||new Error(b))}),q,A,E)}))}async function T(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.d.LastCreatedScene,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return g.e.Error("No scene available to append to"),null;const S=L(Y,b);if(!S)return null;const n={};C.addPendingData(n);const t=()=>{C.removePendingData(n)};r.b.ShowLoadingScreen&&!w&&(w=!0,C.getEngine().displayLoadingUI(),C.executeWhenReady((()=>{C.getEngine().hideLoadingUI(),w=!1})));const I=(Y,b)=>{const R=p(S,Y,b);A?A(C,R,new F.i(R,F.e.SceneLoaderError,b)):g.e.Error(R),t()},Q=q?Y=>{try{q(Y)}catch(b){I("Error in onProgress callback",b)}}:void 0,N=()=>{if(R)try{R(C)}catch(Y){I("Error in onSuccess callback",Y)}C.removePendingData(n)};return await mY(S,C,((Y,b)=>{if(Y.load){if(!Y.load(C,b,S.rootUrl,I))return;C.loadingPluginName=Y.name,N()}else{Y.loadAsync(C,b,S.rootUrl,Q,S.name).then((()=>{C.loadingPluginName=Y.name,N()})).catch((Y=>{I(Y.message,Y)}))}}),Q,I,t,E,O,y)}async function P(Y,b,C,R,q,A,E){return await new Promise(((B,g)=>{try{T(Y,b,C,(Y=>{B(Y)}),R,((Y,b,C)=>{g(C||new Error(b))}),q,A,E).catch(g)}catch(F){g(F)}}))}async function v(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.d.LastCreatedScene,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return g.e.Error("No scene available to load asset container to"),null;const y=L(Y,b);if(!y)return null;const S={};C.addPendingData(S);const n=()=>{C.removePendingData(S)},t=(Y,b)=>{const R=p(y,Y,b);A?A(C,R,new F.i(R,F.e.SceneLoaderError,b)):g.e.Error(R),n()},I=q?Y=>{try{q(Y)}catch(b){t("Error in onProgress callback",b)}}:void 0,w=Y=>{if(R)try{R(Y)}catch(b){t("Error in onSuccess callback",b)}C.removePendingData(S)};return await mY(y,C,((Y,b)=>{if(Y.loadAssetContainer){const R=Y.loadAssetContainer(C,b,y.rootUrl,t);if(!R)return;R.populateRootNodes(),C.loadingPluginName=Y.name,w(R)}else if(Y.loadAssetContainerAsync){Y.loadAssetContainerAsync(C,b,y.rootUrl,I,y.name).then((b=>{b.populateRootNodes(),C.loadingPluginName=Y.name,w(b)})).catch((Y=>{t(Y.message,Y)}))}else t("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),I,t,n,E,r,O)}async function z(Y,b,C,R,q,A,E){return await new Promise(((B,g)=>{try{v(Y,b,C,(Y=>{B(Y)}),R,((Y,b,C)=>{g(C||new Error(b))}),q,A,E).catch(g)}catch(F){g(F)}}))}async function J(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.d.LastCreatedScene,R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",S=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!C)return void g.e.Error("No scene available to load animations to");if(R){for(const R of C.animatables)R.reset();C.stopAllAnimations();const Y=C.animationGroups.slice();for(const C of Y)C.dispose();const b=C.getNodes();for(const C of b)C.animations&&(C.animations=[])}else switch(q){case 0:const Y=C.animationGroups.slice();for(const b of Y)b.dispose();break;case 1:for(const b of C.animationGroups)b.stop();break;case 2:for(const b of C.animationGroups)b.reset(),b.restart();break;case 3:break;default:return void g.e.Error("Unknown animation group loading mode value '"+q+"'")}const n=C.animatables.length;await v(Y,b,C,(Y=>{Y.mergeAnimationsTo(C,C.animatables.slice(n),A),Y.dispose(),C.onAnimationFileImportedObservable.notifyObservers(C),E&&E(C)}),r,O,F,y,S)}async function U(Y,b,C,R,q,A,E,B,g,r){return await new Promise(((O,y)=>{try{J(Y,b,C,R,q,A,(Y=>{O(Y)}),E,((Y,b,C)=>{y(C||new Error(b))}),B,g,r).catch(y)}catch(F){y(F)}}))}class o{static get ForceFullSceneLoadingForIncremental(){return r.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(Y){r.b.ForceFullSceneLoadingForIncremental=Y}static get ShowLoadingScreen(){return r.b.ShowLoadingScreen}static set ShowLoadingScreen(Y){r.b.ShowLoadingScreen=Y}static get loggingLevel(){return r.b.loggingLevel}static set loggingLevel(Y){r.b.loggingLevel=Y}static get CleanBoneMatrixWeights(){return r.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(Y){r.b.CleanBoneMatrixWeights=Y}static GetDefaultPlugin(){return Q()}static GetPluginForExtension(Y){var b;return null===(b=N(Y,!0))||void 0===b?void 0:b.plugin}static IsPluginForExtensionAvailable(Y){return function(Y){return!!I[Y]}(Y)}static RegisterPlugin(Y){u(Y)}static ImportMesh(Y,b,C,R,q,A,E,g,r){c(Y,b,C,R,q,A,E,g,r).catch((Y=>null===E||void 0===E?void 0:E(B.d.LastCreatedScene,null===Y||void 0===Y?void 0:Y.message,Y)))}static async ImportMeshAsync(Y,b,C,R,q,A,E){return await l(Y,b,C,R,q,A,E)}static Load(Y,b,C,R,q,A,E,g){X(Y,b,C,R,q,A,E,g).catch((Y=>null===A||void 0===A?void 0:A(B.d.LastCreatedScene,null===Y||void 0===Y?void 0:Y.message,Y)))}static async LoadAsync(Y,b,C,R,q,A){return await j(Y,b,C,R,q,A)}static Append(Y,b,C,R,q,A,E,g){T(Y,b,C,R,q,A,E,g).catch((Y=>null===A||void 0===A?void 0:A(C??B.d.LastCreatedScene,null===Y||void 0===Y?void 0:Y.message,Y)))}static async AppendAsync(Y,b,C,R,q,A){return await P(Y,b,C,R,q,A)}static LoadAssetContainer(Y,b,C,R,q,A,E,g){v(Y,b,C,R,q,A,E,g).catch((Y=>null===A||void 0===A?void 0:A(C??B.d.LastCreatedScene,null===Y||void 0===Y?void 0:Y.message,Y)))}static async LoadAssetContainerAsync(Y,b,C,R,q,A){return await z(Y,b,C,R,q,A)}static ImportAnimations(Y,b,C,R,q,A,E,g,r,O,F){J(Y,b,C,R,q,A,E,g,r,O,F).catch((Y=>null===r||void 0===r?void 0:r(C??B.d.LastCreatedScene,null===Y||void 0===Y?void 0:Y.message,Y)))}static async ImportAnimationsAsync(Y,b,C,R,q,A,E,B,g,r,O){return await U(Y,b,C,R,q,A,B,r,O)}}o.NO_LOGGING=0,o.MINIMAL_LOGGING=1,o.SUMMARY_LOGGING=2,o.DETAILED_LOGGING=3,o.OnPluginActivatedObservable=t},14386:(Y,b,C)=>{"use strict";C.d(b,{b:()=>y});var R=C(12818),q=C(12821),A=C(12645),E=C(12831),B=C(12860),g=C(12814),r=C(12790),O=C(12652),F=C(12870);C(14394);class y extends B.c{set boundingBoxSize(Y){if(this._boundingBoxSize&&this._boundingBoxSize.equals(Y))return;this._boundingBoxSize=Y;const b=this.uY();b&&b.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(Y){this._rotationY=Y,this.setReflectionTextureMatrix(E.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(Y,b,C){let R="";for(const q of Y)R+=q;return new y(R,b,null,C,Y)}static CreateFromPrefilteredData(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=b.useDelayedTextureLoading;b.useDelayedTextureLoading=!1;const A=new y(Y,b,null,!1,null,null,null,void 0,!0,C,R);return b.useDelayedTextureLoading=q,A}constructor(Y,b){var C;let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,n=arguments.length>10&&void 0!==arguments[10]&&arguments[10],t=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,I=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,w=arguments.length>13?arguments[13]:void 0,Q=arguments.length>14?arguments[14]:void 0;super(b),this.onLoadObservable=new O.d,this.boundingBoxPosition=E.AC.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new E.Matrix,this._buffer=null,this.name=Y,this.url=Y,this._noMipmap=q,this.lb=!1,this.isCube=!0,this._textureMatrix=E.Matrix.Identity(),this.coordinatesMode=g.b.CUBIC_MODE;let N=null,p=null;null===R||Array.isArray(R)?(this._noMipmap=q,this._format=F,this._createPolynomials=n,N=R,this._loaderOptions=w,this._useSRGBBuffer=Q,this._lodScale=t,this._lodOffset=I):(N=R.extensions??null,this._noMipmap=R.noMipmap??!1,A=R.files??null,p=R.buffer??null,this._format=R.format??5,y=R.prefiltered??!1,S=R.forcedExtension??null,this._createPolynomials=R.createPolynomials??!1,this._lodScale=R.lodScale??.8,this._lodOffset=R.lodOffset??0,this._loaderOptions=R.loaderOptions,this._useSRGBBuffer=R.useSRGBBuffer,B=R.M??null,r=R.onError??null),(Y||A)&&this.updateURL(Y,S,B,y,r,N,null===(C=this.uY())||void 0===C?void 0:C.useDelayedTextureLoading,A,p)}getClassName(){return"CubeTexture"}updateURL(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=Y),this.url=Y,b&&(this._forcedExtension=b);const r=Y.lastIndexOf("."),O=b||(r>-1?Y.substring(r).toLowerCase():""),F=0===O.indexOf(".dds"),y=0===O.indexOf(".env"),S=0===O.indexOf(".basis");if(y?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=R,R&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),B)this._files=B;else if(S||y||F||A||(A=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,A){for(let b=0;b<A.length;b++)this._files.push(Y+A[b]);this._extensions=A}this._buffer=g,E?(this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=q):this._loadTexture(C,q)}delayLoad(Y){4===this.delayLoadState&&(Y&&(this._forcedExtension=Y),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(Y){var b,C;if(Y.updateFlag===this._textureMatrix.updateFlag)return;Y.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(C=this.uY())||void 0===C||C.markAllMaterialsAsDirty(1,(Y=>-1!==Y.getActiveTextures().indexOf(this))));if(this._textureMatrix=Y,null===(b=this.uY())||void 0===b||!b.useRightHandedSystem)return;const R=E.TmpVectors.AC[0],q=E.TmpVectors.Quaternion[0],A=E.TmpVectors.AC[1];this._textureMatrix.decompose(R,q,A),q.z*=-1,q.w*=-1,E.Matrix.ComposeToRef(R,q,A,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var Y;return null!==(Y=this.uY())&&void 0!==Y&&Y.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this.uY(),R=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const q=()=>{var b;(this.onLoadObservable.notifyObservers(this),R)&&(R.dispose(),null===(b=this.uY())||void 0===b||b.markAllMaterialsAsDirty(1));Y&&Y()},E=(Y,C)=>{this._loadingError=!0,this._errorObject={message:Y,exception:C},b&&b(Y,C),g.b.OnTextureLoadErrorObservable.notifyObservers(this)};var B;this._texture?this._texture.isReady?A.Tools.SetImmediate((()=>q())):this._texture.onLoadedObservable.add((()=>q())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,C,this._lodScale,this._lodOffset,Y,E,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,C,this._files,this._noMipmap,Y,E,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(B=this._texture)||void 0===B||B.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(Y,b,C){const R=F.e.Parse((()=>{let R=!1;return Y.prefiltered&&(R=Y.prefiltered),new y(C+(Y.url??Y.name),b,Y.extensions,!1,Y.files||null,null,null,void 0,R,Y.forcedExtension)}),Y,b);if(Y.boundingBoxPosition&&(R.boundingBoxPosition=E.AC.OC(Y.boundingBoxPosition)),Y.boundingBoxSize&&(R.boundingBoxSize=E.AC.OC(Y.boundingBoxSize)),Y.animations)for(let q=0;q<Y.animations.length;q++){const b=Y.animations[q],C=(0,r.c)("BABYLON.Animation");C&&R.animations.push(C.Parse(b))}return R}clone(){let Y=0;const b=F.e.Clone((()=>{const b=new y(this.url,this.uY()||this._getEngine(),this._extensions,this._noMipmap,this._files);return Y=b.uniqueId,b}),this);return b.uniqueId=Y,b}}(0,R.c)([(0,q.K)()],y.prototype,"url",void 0),(0,R.c)([(0,q.H)()],y.prototype,"boundingBoxPosition",void 0),(0,R.c)([(0,q.H)()],y.prototype,"boundingBoxSize",null),(0,R.c)([(0,q.K)("rotationY")],y.prototype,"rotationY",null),(0,R.c)([(0,q.K)("files")],y.prototype,"_files",void 0),(0,R.c)([(0,q.K)("forcedExtension")],y.prototype,"_forcedExtension",void 0),(0,R.c)([(0,q.K)("extensions")],y.prototype,"_extensions",void 0),(0,R.c)([(0,q.y)("textureMatrix")],y.prototype,"_textureMatrix",void 0),(0,R.c)([(0,q.y)("textureMatrixRefraction")],y.prototype,"_textureMatrixRefraction",void 0),g.b._CubeTextureParser=y.Parse,(0,r.g)("BABYLON.CubeTexture",y)},15071:(Y,b,C)=>{"use strict";C.d(b,{e:()=>g});var R=C(12669),q=C(12814),A=C(12805),E=C(12963),B=C(12767);E.ThinEngine.prototype.createDynamicTexture=function(Y,b,C,R){const q=new B.b(this,4);return q.baseWidth=Y,q.baseHeight=b,C&&(Y=this.needPOTTextures?(0,A.g)(Y,this._caps.maxTextureSize):Y,b=this.needPOTTextures?(0,A.g)(b,this._caps.maxTextureSize):b),q.width=Y,q.height=b,q.isReady=!1,q.generateMipMaps=C,q.samplingMode=R,this.updateTextureSamplingMode(R,q),this._internalTexturesCache.push(q),q},E.ThinEngine.prototype.updateDynamicTexture=function(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Y)return;const E=this._gl,B=E.TEXTURE_2D,g=this._bindTextureDirectly(B,Y,!0,A);this._unpackFlipY(void 0===C?Y.invertY:C),R&&E.pixelStorei(E.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const r=this._getWebGLTextureType(Y.type),O=this._getInternalFormat(q||Y.format),F=this._getRGBABufferInternalSizedFormat(Y.type,O);E.texImage2D(B,0,F,O,r,b),Y.generateMipMaps&&E.generateMipmap(B),g||this._bindTextureDirectly(B,null),R&&E.pixelStorei(E.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),q&&(Y.format=q),Y._dynamicTextureSource=b,Y._premulAlpha=R,Y.invertY=C||!1,Y.isReady=!0};class g extends q.b{constructor(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,B=arguments.length>6?arguments[6]:void 0;const g=!C||C._isScene;super(null,g?C:null===C||void 0===C?void 0:C.BC,g?!R:C,B,A,void 0,void 0,void 0,void 0,E),this.name=Y,this.wrapU=q.b.CLAMP_ADDRESSMODE,this.wrapV=q.b.CLAMP_ADDRESSMODE,this._generateMipMaps=R;const r=this._getEngine();if(!r)return;if(b.getContext)this._canvas=b,this._ownCanvas=!1,this._texture=r.createDynamicTexture(this._canvas.width,this._canvas.height,R,A);else{this._canvas=r.createCanvas(1,1),this._ownCanvas=!0;const Y=b;Y.width||0===Y.width?this._texture=r.createDynamicTexture(Y.width,Y.height,R,A):this._texture=r.createDynamicTexture(b,b,R,A)}const O=this.getSize();this._canvas.width!==O.width&&(this._canvas.width=O.width),this._canvas.height!==O.height&&(this._canvas.height=O.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(Y){this._canvas.width=Y.width,this._canvas.height=Y.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(Y.width,Y.height,this._generateMipMaps,this.samplingMode)}scale(Y){const b=this.getSize();b.width*=Y,b.height*=Y,this._recreate(b)}scaleTo(Y,b){const C=this.getSize();C.width=Y,C.height=b,this._recreate(C)}getContext(){return this._context}clear(Y){const b=this.getSize();Y&&(this._context.fillStyle=Y),this._context.clearRect(0,0,b.width,b.height)}update(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===Y||Y,b,this._format||void 0,void 0,C)}drawText(Y,b,C,R,q,A,E){let B=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const g=this.getSize();if(A&&(this._context.fillStyle=A,this._context.fillRect(0,0,g.width,g.height)),this._context.font=R,null===b||void 0===b){const C=this._context.measureText(Y);b=(g.width-C.width)/2}if(null===C||void 0===C){const Y=parseInt(R.replace(/\D/g,""));C=g.height/2+Y/3.65}this._context.fillStyle=q||"",this._context.fillText(Y,b,C),B&&this.update(E)}dispose(){var Y,b;(super.dispose(),this._ownCanvas)&&(null===(Y=this._canvas)||void 0===Y||null===(b=Y.remove)||void 0===b||b.call(Y));this._canvas=null,this._context=null}clone(){const Y=this.uY();if(!Y)return this;const b=this.getSize(),C=new g(this.name,b,Y,this._generateMipMaps);return C.lb=this.lb,C.level=this.level,C.wrapU=this.wrapU,C.wrapV=this.wrapV,C}serialize(){const Y=this.uY();Y&&!Y.isReady()&&R.e.Warn("The scene must be ready before serializing the dynamic texture");const b=super.serialize();return g._IsCanvasElement(this._canvas)&&(b.base64String=this._canvas.toDataURL()),b.invertY=this._invertY,b.samplingMode=this.samplingMode,b}static _IsCanvasElement(Y){return void 0!==Y.toDataURL}_rebuild(){this.update()}}},14286:(Y,b,C)=>{"use strict";C.d(b,{d:()=>q});var R=C(12814);class q extends R.b{get depth(){return this._depth}constructor(Y,b,C,q,A,E){let B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],g=arguments.length>7&&void 0!==arguments[7]&&arguments[7],r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:R.b.TRILINEAR_SAMPLINGMODE,O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,F=arguments.length>10?arguments[10]:void 0;super(null,E,!B,g),this.format=A,this._texture=E.getEngine().createRawTexture2DArray(Y,b,C,q,A,B,g,r,null,O,F),this._depth=q,this.is2DArray=!0}update(Y){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,Y,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(Y,b,C,R,A){return new q(Y,b,C,R,5,A,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14094:(Y,b,C)=>{"use strict";C.d(b,{e:()=>B,h:()=>g,k:()=>A,n:()=>E});var R=C(12852),q=C(12831);function A(Y,b){return`{X: ${Y.x.toFixed(b)} Y: ${Y.y.toFixed(b)}}`}function E(Y,b){return`{X: ${Y._x.toFixed(b)} Y: ${Y._y.toFixed(b)} Z: ${Y._z.toFixed(b)}}`}function B(Y,b){return 2*Math.acos((0,R.Clamp)(q.Quaternion.Dot(Y,b)))}function g(Y,b){const C=new q.Quaternion;return function(Y,b,C){const A=q.AC.Cross(Y,b),E=Math.acos((0,R.Clamp)(q.AC.Dot(Y,b),-1,1));q.Quaternion.RotationAxisToRef(A,E,C)}(Y,b,C),C}},13925:(Y,b,C)=>{"use strict";C.d(b,{d:()=>r});var R=C(12831),q=C(12880),A=C(13273),E=C(13258),B=C(12895);C(13932);function g(Y){let b=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const C=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],A=[];let g=[];const r=Y.width||Y.size||1,O=Y.height||Y.size||1,F=Y.depth||Y.size||1,y=Y.wrap||!1;let S=void 0===Y.topBaseAt?1:Y.topBaseAt,n=void 0===Y.bottomBaseAt?0:Y.bottomBaseAt;S=(S+4)%4,n=(n+4)%4;let t=[2,0,3,1][S],I=[2,0,1,3][n],w=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(y){b=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],w=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let Y=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],C=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const R=[17,18,19,16],q=[22,23,20,21];for(;t>0;)Y.unshift(Y.pop()),R.unshift(R.pop()),t--;for(;I>0;)C.unshift(C.pop()),q.unshift(q.pop()),I--;Y=Y.flat(),C=C.flat(),w=w.concat(Y).concat(C),b.push(R[0],R[2],R[3],R[0],R[1],R[2]),b.push(q[0],q[2],q[3],q[0],q[1],q[2])}const Q=[r/2,O/2,F/2];g=w.reduce(((Y,b,C)=>Y.concat(b*Q[C%3])),[]);const N=0===Y.sideOrientation?0:Y.sideOrientation||E.e.DEFAULTSIDE,p=Y.faceUV||new Array(6),mY=Y.faceColors,L=[];for(let E=0;E<6;E++)void 0===p[E]&&(p[E]=new R.Vector4(0,0,1,1)),mY&&void 0===mY[E]&&(mY[E]=new q.hb(1,1,1,1));for(let R=0;R<6;R++)if(A.push(p[R].z,B.b?1-p[R].w:p[R].w),A.push(p[R].x,B.b?1-p[R].w:p[R].w),A.push(p[R].x,B.b?1-p[R].y:p[R].y),A.push(p[R].z,B.b?1-p[R].y:p[R].y),mY)for(let Y=0;Y<4;Y++)L.push(mY[R].r,mY[R].g,mY[R].b,mY[R].a);E.e._ComputeSides(N,g,b,C,A,Y.frontUVs,Y.backUVs);const u=new E.e;if(u.indices=b,u.lY=g,u.XY=C,u.TY=A,mY){const Y=N===E.e.DOUBLESIDE?L.concat(L):L;u.jY=Y}return u}function r(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new A.d(Y,C);b.sideOrientation=A.d._GetDefaultSideOrientation(b.sideOrientation),R._originalBuilderSideOrientation=b.sideOrientation;return g(b).vY(R,b.updatable),R}E.e.CreateBox=g,A.d.CreateBox=function(Y,b){return r(Y,{size:b,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14084:(Y,b,C)=>{"use strict";C.d(b,{b:()=>B});var R=C(13273),q=C(13258),A=C(12895);function E(Y){const b=[],C=[],R=[],E=[],B=Y.radius||.5,g=Y.tessellation||64,r=Y.arc&&(Y.arc<=0||Y.arc>1)?1:Y.arc||1,O=0===Y.sideOrientation?0:Y.sideOrientation||q.e.DEFAULTSIDE;b.push(0,0,0),E.push(.5,.5);const F=2*Math.PI*r,y=1===r?F/g:F/(g-1);let S=0;for(let q=0;q<g;q++){const Y=Math.cos(S),C=Math.sin(S),R=(Y+1)/2,q=(1-C)/2;b.push(B*Y,B*C,0),E.push(R,A.b?1-q:q),S+=y}1===r&&(b.push(b[3],b[4],b[5]),E.push(E[2],A.b?1-E[3]:E[3]));const n=b.length/3;for(let q=1;q<n-1;q++)C.push(q+1,0,q);q.e.ComputeNormals(b,C,R),q.e._ComputeSides(O,b,C,R,E,Y.frontUVs,Y.backUVs);const t=new q.e;return t.indices=C,t.lY=b,t.XY=R,t.TY=E,t}function B(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new R.d(Y,C);b.sideOrientation=R.d._GetDefaultSideOrientation(b.sideOrientation),q._originalBuilderSideOrientation=b.sideOrientation;return E(b).vY(q,b.updatable),q}q.e.CreateDisc=E,R.d.CreateDisc=function(Y,b,C){return B(Y,{radius:b,tessellation:C,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13932:(Y,b,C)=>{"use strict";C.d(b,{f:()=>I,b:()=>Q,i:()=>w});var R=C(12831),q=C(12880),A=C(13273),E=C(13258),B=C(12903);A.d._GroundMeshParser=(Y,b)=>g.Parse(Y,b);class g extends A.d{constructor(Y,b){super(Y,b),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=Y,this._subdivisionsY=Y,this.subdivide(Y);const C=this;C.createOrUpdateSubmeshesOctree&&C.createOrUpdateSubmeshesOctree(b)}getHeightAtCoordinates(Y,b){const C=this.getWorldMatrix(),q=R.TmpVectors.Matrix[5];C.invertToRef(q);const A=R.TmpVectors.AC[8];if(R.AC.TransformCoordinatesFromFloatsToRef(Y,0,b,q,A),Y=A.x,b=A.z,Y<this._minX||Y>=this._maxX||b<=this._minZ||b>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const E=this._getFacetAt(Y,b),B=-(E.x*Y+E.z*b+E.w)/E.y;return R.AC.TransformCoordinatesFromFloatsToRef(0,B,0,C,A),A.y}getNormalAtCoordinates(Y,b){const C=new R.AC(0,1,0);return this.getNormalAtCoordinatesToRef(Y,b,C),C}getNormalAtCoordinatesToRef(Y,b,C){const q=this.getWorldMatrix(),A=R.TmpVectors.Matrix[5];q.invertToRef(A);const E=R.TmpVectors.AC[8];if(R.AC.TransformCoordinatesFromFloatsToRef(Y,0,b,A,E),Y=E.x,b=E.z,Y<this._minX||Y>this._maxX||b<this._minZ||b>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const B=this._getFacetAt(Y,b);return R.AC.TransformNormalFromFloatsToRef(B.x,B.y,B.z,q,C),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(Y,b){const C=Math.floor((Y+this._maxX)*this._subdivisionsX/this._width),R=Math.floor(-(b+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),q=this._heightQuads[R*this._subdivisionsX+C];let A;return A=b<q.slope.x*Y+q.slope.y?q.facet1:q.facet2,A}_initHeightQuads(){const Y=this._subdivisionsX,b=this._subdivisionsY;this._heightQuads=[];for(let C=0;C<b;C++)for(let b=0;b<Y;b++){const q={slope:R.Vector2.Zero(),facet1:new R.Vector4(0,0,0,0),facet2:new R.Vector4(0,0,0,0)};this._heightQuads[C*Y+b]=q}return this}_computeHeightQuads(){const Y=this.getVerticesData(B.e.PositionKind);if(!Y)return this;const b=R.TmpVectors.AC[3],C=R.TmpVectors.AC[2],q=R.TmpVectors.AC[1],A=R.TmpVectors.AC[0],E=R.TmpVectors.AC[4],g=R.TmpVectors.AC[5],r=R.TmpVectors.AC[6],O=R.TmpVectors.AC[7],F=R.TmpVectors.AC[8];let y=0,S=0,n=0,t=0,I=0,w=0,Q=0;const N=this._subdivisionsX,p=this._subdivisionsY;for(let B=0;B<p;B++)for(let p=0;p<N;p++){y=3*p,S=B*(N+1)*3,n=(B+1)*(N+1)*3,b.x=Y[S+y],b.y=Y[S+y+1],b.z=Y[S+y+2],C.x=Y[S+y+3],C.y=Y[S+y+4],C.z=Y[S+y+5],q.x=Y[n+y],q.y=Y[n+y+1],q.z=Y[n+y+2],A.x=Y[n+y+3],A.y=Y[n+y+4],A.z=Y[n+y+5],t=(A.z-b.z)/(A.x-b.x),I=b.z-t*b.x,C.subtractToRef(b,E),q.subtractToRef(b,g),A.subtractToRef(b,r),R.AC.CrossToRef(r,g,O),R.AC.CrossToRef(E,r,F),O.normalize(),F.normalize(),w=-(O.x*b.x+O.y*b.y+O.z*b.z),Q=-(F.x*C.x+F.y*C.y+F.z*C.z);const mY=this._heightQuads[B*N+p];mY.slope.Ub(t,I),mY.facet1.Ub(O.x,O.y,O.z,w),mY.facet2.Ub(F.x,F.y,F.z,Q)}return this}serialize(Y){super.serialize(Y),Y.subdivisionsX=this._subdivisionsX,Y.subdivisionsY=this._subdivisionsY,Y.minX=this._minX,Y.maxX=this._maxX,Y.Xb=this._minZ,Y.maxZ=this._maxZ,Y.width=this._width,Y.height=this._height}static Parse(Y,b){const C=new g(Y.name,b);return C._subdivisionsX=Y.subdivisionsX||1,C._subdivisionsY=Y.subdivisionsY||1,C._minX=Y.minX,C._maxX=Y.maxX,C._minZ=Y.Xb,C._maxZ=Y.maxZ,C._width=Y.width,C._height=Y.height,C}}var r=C(12645),O=C(12702),F=C(12837),y=C(12895);function S(Y){const b=[],C=[],q=[],A=[];let B,g;const r=Y.width||Y.size||1,O=Y.height||Y.size||1,F=0|(Y.subdivisionsX||Y.subdivisions||1),S=0|(Y.subdivisionsY||Y.subdivisions||1);for(B=0;B<=S;B++)for(g=0;g<=F;g++){const Y=new R.AC(g*r/F-r/2,0,(S-B)*O/S-O/2),b=new R.AC(0,1,0);C.push(Y.x,Y.y,Y.z),q.push(b.x,b.y,b.z),A.push(g/F,y.b?B/S:1-B/S)}for(B=0;B<S;B++)for(g=0;g<F;g++)b.push(g+1+(B+1)*(F+1)),b.push(g+1+B*(F+1)),b.push(g+B*(F+1)),b.push(g+(B+1)*(F+1)),b.push(g+1+(B+1)*(F+1)),b.push(g+B*(F+1));const n=new E.e;return n.indices=b,n.lY=C,n.XY=q,n.TY=A,n}function n(Y){const b=void 0!==Y.xmin&&null!==Y.xmin?Y.xmin:-1,C=void 0!==Y.zmin&&null!==Y.zmin?Y.zmin:-1,q=void 0!==Y.xmax&&null!==Y.xmax?Y.xmax:1,A=void 0!==Y.zmax&&null!==Y.zmax?Y.zmax:1,B=Y.subdivisions||{w:1,h:1},g=Y.precision||{w:1,h:1},r=[],O=[],F=[],y=[];let S,n,t,I;B.h=B.h<1?1:B.h,B.w=B.w<1?1:B.w,g.w=g.w<1?1:g.w,g.h=g.h<1?1:g.h;const w=(q-b)/B.w,Q=(A-C)/B.h;function N(Y,b,C,q){const A=O.length/3,E=g.w+1;for(S=0;S<g.h;S++)for(n=0;n<g.w;n++){const Y=[A+n+S*E,A+(n+1)+S*E,A+(n+1)+(S+1)*E,A+n+(S+1)*E];r.push(Y[1]),r.push(Y[2]),r.push(Y[3]),r.push(Y[0]),r.push(Y[1]),r.push(Y[3])}const B=R.AC.Zero(),t=new R.AC(0,1,0);for(S=0;S<=g.h;S++)for(B.z=S*(q-b)/g.h+b,n=0;n<=g.w;n++)B.x=n*(C-Y)/g.w+Y,B.y=0,O.push(B.x,B.y,B.z),F.push(t.x,t.y,t.z),y.push(n/g.w,S/g.h)}for(t=0;t<B.h;t++)for(I=0;I<B.w;I++)N(b+I*w,C+t*Q,b+(I+1)*w,C+(t+1)*Q);const p=new E.e;return p.indices=r,p.lY=O,p.XY=F,p.TY=y,p}function t(Y){const b=[],C=[],A=[],B=[];let g,r;const O=Y.colorFilter||new q.rC(.3,.59,.11),y=Y.alphaFilter||0;let S=!1;if(Y.minHeight>Y.maxHeight){S=!0;const b=Y.maxHeight;Y.maxHeight=Y.minHeight,Y.minHeight=b}for(g=0;g<=Y.subdivisions;g++)for(r=0;r<=Y.subdivisions;r++){const b=new R.AC(r*Y.width/Y.subdivisions-Y.width/2,0,(Y.subdivisions-g)*Y.height/Y.subdivisions-Y.height/2),q=4*(((b.x+Y.width/2)/Y.width*(Y.bufferWidth-1)|0)+((1-(b.z+Y.height/2)/Y.height)*(Y.bufferHeight-1)|0)*Y.bufferWidth);let E=Y.buffer[q]/255,n=Y.buffer[q+1]/255,t=Y.buffer[q+2]/255;const I=Y.buffer[q+3]/255;S&&(E=1-E,n=1-n,t=1-t);const w=E*O.r+n*O.g+t*O.b;b.y=I>=y?Y.minHeight+(Y.maxHeight-Y.minHeight)*w:Y.minHeight-F.e,Y.heightBuffer&&(Y.heightBuffer[g*(Y.subdivisions+1)+r]=b.y),C.push(b.x,b.y,b.z),A.push(0,0,0),B.push(r/Y.subdivisions,1-g/Y.subdivisions)}for(g=0;g<Y.subdivisions;g++)for(r=0;r<Y.subdivisions;r++){const R=r+1+(g+1)*(Y.subdivisions+1),q=r+1+g*(Y.subdivisions+1),A=r+g*(Y.subdivisions+1),E=r+(g+1)*(Y.subdivisions+1),B=C[3*R+1]>=Y.minHeight,O=C[3*q+1]>=Y.minHeight,F=C[3*A+1]>=Y.minHeight;B&&O&&F&&(b.push(R),b.push(q),b.push(A));C[3*E+1]>=Y.minHeight&&B&&F&&(b.push(E),b.push(R),b.push(A))}E.e.ComputeNormals(C,b,A);const n=new E.e;return n.indices=b,n.lY=C,n.XY=A,n.TY=B,n}function I(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=new g(Y,arguments.length>2?arguments[2]:void 0);C._setReady(!1),C._subdivisionsX=b.subdivisionsX||b.subdivisions||1,C._subdivisionsY=b.subdivisionsY||b.subdivisions||1,C._width=b.width||1,C._height=b.height||1,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ;return S(b).vY(C,b.updatable),C._setReady(!0),C}function w(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new A.d(Y,C);return n(b).vY(R,b.updatable),R}function Q(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=C.width||10,E=C.height||10,B=C.subdivisions||1,F=C.minHeight||0,y=C.maxHeight||1,S=C.colorFilter||new q.rC(.3,.59,.11),n=C.alphaFilter||0,I=C.updatable,w=C.onReady;R=R||O.d.LastCreatedScene;const Q=new g(Y,R);let N;Q._subdivisionsX=B,Q._subdivisionsY=B,Q._width=A,Q._height=E,Q._maxX=Q._width/2,Q._maxZ=Q._height/2,Q._minX=-Q._maxX,Q._minZ=-Q._maxZ,Q._setReady(!1),C.passHeightBufferInCallback&&(N=new Float32Array((B+1)*(B+1)));const p=(Y,b,C)=>{t({width:A,height:E,subdivisions:B,minHeight:F,maxHeight:y,colorFilter:S,buffer:Y,bufferWidth:b,bufferHeight:C,alphaFilter:n,heightBuffer:N}).vY(Q,I),w&&w(Q,N),Q._setReady(!0)};if("string"===typeof b){const Y=Y=>{var b;const C=Y.width,q=Y.height;if(R.O)return;const A=null===(b=R)||void 0===b?void 0:b.getEngine().resizeImageBitmap(Y,C,q);p(A,C,q)};r.Tools.LoadImage(b,Y,C.onError?C.onError:()=>{},R.offlineProvider)}else p(b.data,b.width,b.height);return Q}E.e.CreateGround=S,E.e.CreateTiledGround=n,E.e.CreateGroundFromHeightMap=t,A.d.CreateGround=(Y,b,C,R,q,A)=>I(Y,{width:b,height:C,subdivisions:R,updatable:A},q),A.d.CreateTiledGround=(Y,b,C,R,q,A,E,B,g)=>w(Y,{xmin:b,zmin:C,xmax:R,zmax:q,subdivisions:A,precision:E,updatable:g},B),A.d.CreateGroundFromHeightMap=(Y,b,C,R,q,A,E,B,g,r,O)=>Q(Y,b,{width:C,height:R,subdivisions:q,minHeight:A,maxHeight:E,updatable:g,onReady:r,alphaFilter:O},B)},14599:(Y,b,C)=>{"use strict";C.d(b,{c:()=>S,d:()=>F,e:()=>y});var R=C(12831),q=C(13273),A=C(13258),E=C(13374),B=C(12903),g=C(12669);function r(Y){const b=[],C=[],R=Y.lines,q=Y.jY,E=[];let B=0;for(let A=0;A<R.length;A++){const Y=R[A];for(let R=0;R<Y.length;R++){const{x:g,y:r,z:O}=Y[R];if(C.push(g,r,O),q){const Y=q[A],{r:b,g:C,b:B,a:g}=Y[R];E.push(b,C,B,g)}R>0&&(b.push(B-1),b.push(B)),B++}}const g=new A.e;return g.indices=b,g.lY=C,q&&(g.jY=E),g}function O(Y){const b=Y.dashSize||3,C=Y.gapSize||1,q=Y.dashNb||200,E=Y.points,B=[],g=[],r=R.AC.Zero();let O=0,F=0,y=0,S=0,n=0,t=0,I=0;for(I=0;I<E.length-1;I++)E[I+1].subtractToRef(E[I],r),O+=r.length();for(y=O/q,S=b*y/(b+C),I=0;I<E.length-1;I++){E[I+1].subtractToRef(E[I],r),F=Math.floor(r.length()/y),r.normalize();for(let Y=0;Y<F;Y++)n=y*Y,B.push(E[I].x+n*r.x,E[I].y+n*r.y,E[I].z+n*r.z),B.push(E[I].x+(n+S)*r.x,E[I].y+(n+S)*r.y,E[I].z+(n+S)*r.z),g.push(t,t+1),t+=2}const w=new A.e;return w.lY=B,w.indices=g,w}function F(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=b.instance,q=b.lines,A=b.jY;if(R){const Y=R.getVerticesData(B.e.PositionKind);let b,C;A&&(b=R.getVerticesData(B.e.ColorKind));let E=0,g=0;for(let R=0;R<q.length;R++){const B=q[R];for(let q=0;q<B.length;q++)Y[E]=B[q].x,Y[E+1]=B[q].y,Y[E+2]=B[q].z,A&&b&&(C=A[R],b[g]=C[q].r,b[g+1]=C[q].g,b[g+2]=C[q].b,b[g+3]=C[q].a,g+=4),E+=3}return R.updateVerticesData(B.e.PositionKind,Y,!1,!1),A&&b&&R.updateVerticesData(B.e.ColorKind,b,!1,!1),R.refreshBoundingInfo(),R}const g=!!A,O=new E.c(Y,C,null,void 0,void 0,g,b.useVertexAlpha,b.material);return r(b).vY(O,b.updatable),O}function y(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=b.jY?[b.jY]:null;return F(Y,{lines:[b.points],updatable:b.updatable,instance:b.instance,jY:R,useVertexAlpha:b.useVertexAlpha,material:b.material},C)}function S(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=b.points,B=b.instance,r=b.gapSize||1,F=b.dashSize||3;if(B){const Y=Y=>{const b=R.AC.Zero(),C=Y.length/6;let q=0,E=0,g=0,r=0,O=0,F=0,y=0,S=0;for(y=0;y<A.length-1;y++)A[y+1].subtractToRef(A[y],b),q+=b.length();g=q/C;const n=B._creationDataStorage.dashSize;for(r=n*g/(n+B._creationDataStorage.gapSize),y=0;y<A.length-1;y++)for(A[y+1].subtractToRef(A[y],b),E=Math.floor(b.length()/g),b.normalize(),S=0;S<E&&F<Y.length;)O=g*S,Y[F]=A[y].x+O*b.x,Y[F+1]=A[y].y+O*b.y,Y[F+2]=A[y].z+O*b.z,Y[F+3]=A[y].x+(O+r)*b.x,Y[F+4]=A[y].y+(O+r)*b.y,Y[F+5]=A[y].z+(O+r)*b.z,F+=6,S++;for(;F<Y.length;)Y[F]=A[y].x,Y[F+1]=A[y].y,Y[F+2]=A[y].z,F+=3};return(b.dashNb||b.dashSize||b.gapSize||b.useVertexAlpha||b.material)&&g.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),B.updateMeshPositions(Y,!1),B}const y=new E.c(Y,C,null,void 0,void 0,void 0,b.useVertexAlpha,b.material);return O(b).vY(y,b.updatable),y._creationDataStorage=new q.h,y._creationDataStorage.dashSize=F,y._creationDataStorage.gapSize=r,y}A.e.CreateLineSystem=r,A.e.CreateDashedLines=O,q.d.rO=function(Y,b){return y(Y,{points:b,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},q.d.CreateDashedLines=function(Y,b,C,R,q){return S(Y,{points:b,dashSize:C,gapSize:R,dashNb:q,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13987:(Y,b,C)=>{"use strict";C.d(b,{d:()=>B,e:()=>g});var R=C(13273),q=C(13258),A=C(12895);function E(Y){const b=[],C=[],R=[],E=[],B=void 0!==Y.width?Y.width:void 0!==Y.size?Y.size:1,g=void 0!==Y.height?Y.height:void 0!==Y.size?Y.size:1,r=0===Y.sideOrientation?0:Y.sideOrientation||q.e.DEFAULTSIDE,O=B/2,F=g/2;C.push(-O,-F,0),R.push(0,0,-1),E.push(0,A.b?1:0),C.push(O,-F,0),R.push(0,0,-1),E.push(1,A.b?1:0),C.push(O,F,0),R.push(0,0,-1),E.push(1,A.b?0:1),C.push(-O,F,0),R.push(0,0,-1),E.push(0,A.b?0:1),b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),q.e._ComputeSides(r,C,b,R,E,Y.frontUVs,Y.backUVs);const y=new q.e;return y.indices=b,y.lY=C,y.XY=R,y.TY=E,y}function B(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new R.d(Y,C);b.sideOrientation=R.d._GetDefaultSideOrientation(b.sideOrientation),q._originalBuilderSideOrientation=b.sideOrientation;return E(b).vY(q,b.updatable),b.sourcePlane&&(q.translate(b.sourcePlane.normal,-b.sourcePlane.d),q.setDirection(b.sourcePlane.normal.scale(-1))),q}const g={yO:B};q.e.yO=E,R.d.yO=(Y,b,C,R,q)=>B(Y,{size:b,width:b,height:b,sideOrientation:q,updatable:R},C)},14072:(Y,b,C)=>{"use strict";C.d(b,{c:()=>g});var R=C(12831),q=C(13273),A=C(13258),E=C(12895);function B(Y){const b=0|(Y.segments||32),C=Y.diameterX||Y.diameter||1,q=Y.diameterY||Y.diameter||1,B=Y.diameterZ||Y.diameter||1,g=Y.arc&&(Y.arc<=0||Y.arc>1)?1:Y.arc||1,r=Y.slice&&Y.slice<=0?1:Y.slice||1,O=0===Y.sideOrientation?0:Y.sideOrientation||A.e.DEFAULTSIDE,F=!!Y.dedupTopBottomIndices,y=new R.AC(C/2,q/2,B/2),S=2+b,n=2*S,t=[],I=[],w=[],Q=[];for(let A=0;A<=S;A++){const Y=A/S,b=Y*Math.PI*r;for(let C=0;C<=n;C++){const q=C/n,A=q*Math.PI*2*g,B=R.Matrix.RotationZ(-b),r=R.Matrix.RotationY(A),O=R.AC.TransformCoordinates(R.AC.Up(),B),F=R.AC.TransformCoordinates(O,r),S=F.multiply(y),t=F.divide(y).normalize();I.push(S.x,S.y,S.z),w.push(t.x,t.y,t.z),Q.push(q,E.b?1-Y:Y)}if(A>0){const Y=I.length/3;for(let b=Y-2*(n+1);b+n+2<Y;b++)F?(A>1&&(t.push(b),t.push(b+1),t.push(b+n+1)),(A<S||r<1)&&(t.push(b+n+1),t.push(b+1),t.push(b+n+2))):(t.push(b),t.push(b+1),t.push(b+n+1),t.push(b+n+1),t.push(b+1),t.push(b+n+2))}}A.e._ComputeSides(O,I,t,w,Q,Y.frontUVs,Y.backUVs);const N=new A.e;return N.indices=t,N.lY=I,N.XY=w,N.TY=Q,N}function g(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new q.d(Y,C);b.sideOrientation=q.d._GetDefaultSideOrientation(b.sideOrientation),R._originalBuilderSideOrientation=b.sideOrientation;return B(b).vY(R,b.updatable),R}A.e.CreateSphere=B,q.d.CreateSphere=(Y,b,C,R,q,A)=>g(Y,{segments:b,diameterX:C,diameterY:C,diameterZ:C,sideOrientation:A,updatable:q},R)},15086:(Y,b,C)=>{"use strict";C.d(b,{c:()=>B});var R=C(13392),q=C(14398),A=C(13410),E=C(13258);class B{static get Configuration(){return{get decoder(){return q.e.DefaultConfiguration},set decoder(Y){q.e.DefaultConfiguration=Y}}}static set Configuration(Y){q.e.DefaultConfiguration=Y.decoder}static get DecoderAvailable(){return(0,R.h)(q.e.DefaultConfiguration)}static get Default(){return B._Default??(B._Default=new B),B._Default}static ResetDefault(Y){B._Default&&(Y||B._Default.dispose(),B._Default=null)}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.DefaultNumWorkers;const b="number"===typeof Y?{...q.e.DefaultConfiguration,numWorkers:Y}:{...q.e.DefaultConfiguration,...Y};this._decoder=new q.e(b)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(Y,b,C){return this._decoder.decodeMeshToMeshDataAsync(Y,b,C)}async decodeMeshToGeometryAsync(Y,b,C,R){return await this._decoder.decodeMeshToGeometryAsync(Y,b,C,R)}async _decodeMeshToGeometryForGltfAsync(Y,b,C,R,q,A){return await this._decoder._decodeMeshToGeometryForGltfAsync(Y,b,C,R,q,A)}async decodeMeshAsync(Y,b){const C=await this._decoder.decodeMeshToMeshDataAsync(Y,b),R=new E.e;C.indices&&(R.indices=C.indices);for(const q of C.attributes){const Y=A.b.GetFloatData(q.data,q.size,A.b.GetDataType(q.data),q.byteOffset,q.byteStride,q.normalized,C.totalVertices);R.set(Y,q.kind)}return R}}B.DefaultNumWorkers=(0,R.e)(),B._Default=null},14398:(Y,b,C)=>{"use strict";C.d(b,{e:()=>r});var R=C(13392),q=C(12645),A=C(13287),E=C(13410),B=C(12669),g=C(13404);class r extends R.c{static get DefaultAvailable(){return(0,R.h)(r.DefaultConfiguration)}static get Default(){return r._Default??(r._Default=new r),r._Default}static ResetDefault(Y){r._Default&&(Y||r._Default.dispose(),r._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(Y,b){return{module:await(b||DracoDecoderModule)({wasmBinary:Y})}}_getWorkerContent(){return`${g.d}(${g.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.DefaultConfiguration)}decodeMeshToMeshDataAsync(Y,b,C){const R=Y instanceof ArrayBuffer?new Int8Array(Y):new Int8Array(Y.buffer,Y.byteOffset,Y.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async Y=>await new Promise(((q,A)=>{Y.push(((Y,E)=>{let g=null;const r=[],O=b=>{Y.removeEventListener("error",O),Y.removeEventListener("message",F),A(b),E()},F=b=>{const R=b.data;switch(R.id){case"indices":g=R.data;break;case"attribute":r.push({kind:R.kind,data:R.data,size:R.size,byteOffset:R.byteOffset,byteStride:R.byteStride,normalized:(A=R.kind,y=R.normalized,C&&void 0!==C[A]?(y!==C[A]&&B.e.Warn(`Normalized flag from Draco data (${y}) does not match normalized flag from glTF accessor (${C[A]}). Using flag from glTF accessor.`),C[A]):y)});break;case"decodeMeshDone":Y.removeEventListener("error",O),Y.removeEventListener("message",F),q({indices:g,attributes:r,totalVertices:R.totalVertices}),E()}var A,y};Y.addEventListener("error",O),Y.addEventListener("message",F);const y=R.slice();Y.postMessage({id:"decodeMesh",dataView:y,attributes:b},[y.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((Y=>{let C=null;const q=[],A=(0,g.d)(Y.module,R,b,(Y=>{C=Y}),((Y,b,C,R,A,E)=>{q.push({kind:Y,data:b,size:C,byteOffset:R,byteStride:A,normalized:E})}));return{indices:C,attributes:q,totalVertices:A}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(Y,b,C,R){const q=await this.decodeMeshToMeshDataAsync(C,R),B=new A.d(Y,b);q.indices&&B.setIndices(q.indices);for(const A of q.attributes)B.setVerticesBuffer(new E.b(b.getEngine(),A.data,A.kind,!1,void 0,A.byteStride,void 0,A.byteOffset,A.size,void 0,A.normalized,!0),q.totalVertices);return B}async _decodeMeshToGeometryForGltfAsync(Y,b,C,R,q,B){const g=await this.decodeMeshToMeshDataAsync(C,R,q),r=new A.d(Y,b);B&&(r._boundingInfo=B,r.useBoundingInfoFromGeometry=!0),g.indices&&r.setIndices(g.indices);for(const A of g.attributes)r.setVerticesBuffer(new E.b(b.getEngine(),A.data,A.kind,!1,void 0,A.byteStride,void 0,A.byteOffset,A.size,void 0,A.normalized,!0),g.totalVertices);return r}}r.DefaultConfiguration={wasmUrl:`${q.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${q.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${q.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},r._Default=null},14593:(Y,b,C)=>{"use strict";C.d(b,{c:()=>BY});var R=C(12831),q=C(13273),A=C(12903),E=C(13258),B=C(12895);function g(Y){let b=Y.pathArray;const C=Y.closeArray||!1,R=Y.closePath||!1,q=Y.invertUV||!1,g=Math.floor(b[0].length/2);let r=Y.offset||g;r=r>g?g:Math.floor(r);const O=0===Y.sideOrientation?0:Y.sideOrientation||E.e.DEFAULTSIDE,F=Y.TY,y=Y.jY,S=[],n=[],t=[],I=[],w=[],Q=[],N=[],p=[];let mY;const L=[],u=[];let c,l,X;if(b.length<2){const Y=[],C=[];for(l=0;l<b[0].length-r;l++)Y.push(b[0][l]),C.push(b[0][l+r]);b=[Y,C]}let j=0;const T=R?1:0,P=C?1:0;let v,z,J,U,o,G;for(mY=b[0].length,c=0;c<b.length+P;c++){for(N[c]=0,w[c]=[0],v=c===b.length?b[0]:b[c],z=v.length,mY=mY<z?mY:z,X=0;X<z;)S.push(v[X].x,v[X].y,v[X].z),X>0&&(J=v[X].EC(v[X-1]).length(),U=J+N[c],w[c].push(U),N[c]=U),X++;R&&(X--,S.push(v[0].x,v[0].y,v[0].z),J=v[X].EC(v[0]).length(),U=J+N[c],w[c].push(U),N[c]=U),L[c]=z+T,u[c]=j,j+=z+T}let h,e,H=null,i=null;for(l=0;l<mY+T;l++)for(p[l]=0,Q[l]=[0],c=0;c<b.length-1+P;c++)o=b[c],G=c===b.length-1?b[0]:b[c+1],l===mY?(H=o[0],i=G[0]):(H=o[l],i=G[l]),J=i.EC(H).length(),U=J+p[l],Q[l].push(U),p[l]=U;if(F)for(c=0;c<F.length;c++)I.push(F[c].x,B.b?1-F[c].y:F[c].y);else for(c=0;c<b.length+P;c++)for(l=0;l<mY+T;l++)h=0!=N[c]?w[c][l]/N[c]:0,e=0!=p[l]?Q[l][c]/p[l]:0,q?I.push(e,h):I.push(h,B.b?1-e:e);c=0;let W=0,s=L[c]-1,D=L[c+1]-1,d=s<D?s:D,V=u[1]-u[0];const k=L.length-1;for(;W<=d&&c<k;)n.push(W,W+V,W+1),n.push(W+V+1,W+1,W+V),W+=1,W===d&&(c++,V=u[c+1]-u[c],s=L[c]-1,D=L[c+1]-1,W=u[c],d=s<D?s+W:D+W);if(E.e.ComputeNormals(S,n,t),R){let Y=0,C=0;for(c=0;c<b.length;c++){Y=3*u[c],C=c+1<b.length?3*(u[c+1]-1):t.length-3,t[Y]=.5*(t[Y]+t[C]),t[Y+1]=.5*(t[Y+1]+t[C+1]),t[Y+2]=.5*(t[Y+2]+t[C+2]);const R=Math.sqrt(t[Y]*t[Y]+t[Y+1]*t[Y+1]+t[Y+2]*t[Y+2]);t[Y]/=R,t[Y+1]/=R,t[Y+2]/=R,t[C]=t[Y],t[C+1]=t[Y+1],t[C+2]=t[Y+2]}}if(C){let Y=3*u[0],C=3*u[b.length];for(l=0;l<mY+T;l++){t[Y]=.5*(t[Y]+t[C]),t[Y+1]=.5*(t[Y+1]+t[C+1]),t[Y+2]=.5*(t[Y+2]+t[C+2]);const b=Math.sqrt(t[Y]*t[Y]+t[Y+1]*t[Y+1]+t[Y+2]*t[Y+2]);t[Y]/=b,t[Y+1]/=b,t[Y+2]/=b,t[C]=t[Y],t[C+1]=t[Y+1],t[C+2]=t[Y+2],Y+=3,C+=3}}E.e._ComputeSides(O,S,n,t,I,Y.frontUVs,Y.backUVs);let x=null;if(y){x=new Float32Array(4*y.length);for(let Y=0;Y<y.length;Y++)x[4*Y]=y[Y].r,x[4*Y+1]=y[Y].g,x[4*Y+2]=y[Y].b,x[4*Y+3]=y[Y].a}const a=new E.e,M=new Float32Array(S),K=new Float32Array(t),f=new Float32Array(I);return a.indices=n,a.lY=M,a.XY=K,a.TY=f,x&&a.set(x,A.e.ColorKind),R&&(a._idx=u),a}function r(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=b.pathArray,O=b.closeArray,F=b.closePath,y=q.d._GetDefaultSideOrientation(b.sideOrientation),S=b.instance,n=b.updatable;if(S){const Y=R.TmpVectors.AC[0].Gb(Number.MAX_VALUE),C=R.TmpVectors.AC[1].Gb(-Number.MAX_VALUE),g=b=>{let R=r[0].length;const A=S;let E=0;const B=A._originalBuilderSideOrientation===q.d.DOUBLESIDE?2:1;for(let q=1;q<=B;++q)for(let B=0;B<r.length;++B){const q=r[B],g=q.length;R=R<g?R:g;for(let A=0;A<R;++A){const R=q[A];b[E]=R.x,b[E+1]=R.y,b[E+2]=R.z,Y.minimizeInPlaceFromFloats(R.x,R.y,R.z),C.maximizeInPlaceFromFloats(R.x,R.y,R.z),E+=3}if(A._creationDataStorage&&A._creationDataStorage.closePath){const Y=q[0];b[E]=Y.x,b[E+1]=Y.y,b[E+2]=Y.z,E+=3}}},O=S.getVerticesData(A.e.PositionKind);if(g(O),S.hasBoundingInfo?S.getBoundingInfo().reConstruct(Y,C,S._worldMatrix):S.buildBoundingInfo(Y,C,S._worldMatrix),S.updateVerticesData(A.e.PositionKind,O,!1,!1),b.jY){const Y=S.getVerticesData(A.e.ColorKind);for(let C=0,R=0;C<b.jY.length;C++,R+=4){const q=b.jY[C];Y[R]=q.r,Y[R+1]=q.g,Y[R+2]=q.b,Y[R+3]=q.a}S.updateVerticesData(A.e.ColorKind,Y,!1,!1)}if(b.TY){const Y=S.getVerticesData(A.e.UVKind);for(let C=0;C<b.TY.length;C++)Y[2*C]=b.TY[C].x,Y[2*C+1]=B.b?1-b.TY[C].y:b.TY[C].y;S.updateVerticesData(A.e.UVKind,Y,!1,!1)}if(!S.areNormalsFrozen||S.isFacetDataEnabled){const Y=S.zb(),b=S.getVerticesData(A.e.NormalKind),C=S.isFacetDataEnabled?S.getFacetDataParameters():null;if(E.e.ComputeNormals(O,Y,b,C),S._creationDataStorage&&S._creationDataStorage.closePath){let Y=0,C=0;for(let R=0;R<r.length;R++)Y=3*S._creationDataStorage.idx[R],C=R+1<r.length?3*(S._creationDataStorage.idx[R+1]-1):b.length-3,b[Y]=.5*(b[Y]+b[C]),b[Y+1]=.5*(b[Y+1]+b[C+1]),b[Y+2]=.5*(b[Y+2]+b[C+2]),b[C]=b[Y],b[C+1]=b[Y+1],b[C+2]=b[Y+2]}S.areNormalsFrozen||S.updateVerticesData(A.e.NormalKind,b,!1,!1)}return S}{const R=new q.d(Y,C);R._originalBuilderSideOrientation=y,R._creationDataStorage=new q.h;const A=g(b);return F&&(R._creationDataStorage.idx=A._idx),R._creationDataStorage.closePath=F,R._creationDataStorage.closeArray=O,A.vY(R,n),R}}E.e.CreateRibbon=g,q.d.CreateRibbon=function(Y,b){return r(Y,{pathArray:b,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var O=C(14084),F=C(13925),y=C(12880);function S(Y){const b=Y.pattern||q.d.NO_FLIP,C=Y.tileWidth||Y.tileSize||1,R=Y.tileHeight||Y.tileSize||1,A=Y.alignHorizontal||0,B=Y.alignVertical||0,g=Y.width||Y.size||1,r=Math.floor(g/C);let O=g-r*C;const F=Y.height||Y.size||1,y=Math.floor(F/R);let S=F-y*R;const n=C*r/2,t=R*y/2;let I=0,w=0,Q=0,N=0,p=0,mY=0;if(O>0||S>0){switch(Q=-n,N=-t,p=n,mY=t,A){case q.d.CENTER:O/=2,Q-=O,p+=O;break;case q.d.LEFT:p+=O,I=-O/2;break;case q.d.RIGHT:Q-=O,I=O/2}switch(B){case q.d.CENTER:S/=2,N-=S,mY+=S;break;case q.d.BOTTOM:mY+=S,w=-S/2;break;case q.d.TOP:N-=S,w=S/2}}const L=[],u=[],c=[];c[0]=[0,0,1,0,1,1,0,1],c[1]=[0,0,1,0,1,1,0,1],b!==q.d.ROTATE_TILE&&b!==q.d.ROTATE_ROW||(c[1]=[1,1,0,1,0,0,1,0]),b!==q.d.FLIP_TILE&&b!==q.d.FLIP_ROW||(c[1]=[1,0,0,0,0,1,1,1]),b!==q.d.FLIP_N_ROTATE_TILE&&b!==q.d.FLIP_N_ROTATE_ROW||(c[1]=[0,1,1,1,1,0,0,0]);let l=[];const X=[],j=[];let T=0;for(let E=0;E<y;E++)for(let Y=0;Y<r;Y++)L.push(Y*C-n+I,E*R-t+w,0),L.push((Y+1)*C-n+I,E*R-t+w,0),L.push((Y+1)*C-n+I,(E+1)*R-t+w,0),L.push(Y*C-n+I,(E+1)*R-t+w,0),j.push(T,T+1,T+3,T+1,T+2,T+3),l=b===q.d.FLIP_TILE||b===q.d.ROTATE_TILE||b===q.d.FLIP_N_ROTATE_TILE?l.concat(c[(Y%2+E%2)%2]):b===q.d.FLIP_ROW||b===q.d.ROTATE_ROW||b===q.d.FLIP_N_ROTATE_ROW?l.concat(c[E%2]):l.concat(c[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),T+=4;if(O>0||S>0){const Y=S>0&&(B===q.d.CENTER||B===q.d.TOP),E=S>0&&(B===q.d.CENTER||B===q.d.BOTTOM),g=O>0&&(A===q.d.CENTER||A===q.d.RIGHT),F=O>0&&(A===q.d.CENTER||A===q.d.LEFT);let c,P,v,z,J=[];if(Y&&g&&(L.push(Q+I,N+w,0),L.push(-n+I,N+w,0),L.push(-n+I,N+S+w,0),L.push(Q+I,N+S+w,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,c=1-O/C,P=1-S/R,v=1,z=1,J=[c,P,v,P,v,z,c,z],b===q.d.ROTATE_ROW&&(J=[1-c,1-P,1-v,1-P,1-v,1-z,1-c,1-z]),b===q.d.FLIP_ROW&&(J=[1-c,P,1-v,P,1-v,z,1-c,z]),b===q.d.FLIP_N_ROTATE_ROW&&(J=[c,1-P,v,1-P,v,1-z,c,1-z]),l=l.concat(J),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&F&&(L.push(n+I,N+w,0),L.push(p+I,N+w,0),L.push(p+I,N+S+w,0),L.push(n+I,N+S+w,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,c=0,P=1-S/R,v=O/C,z=1,J=[c,P,v,P,v,z,c,z],(b===q.d.ROTATE_ROW||b===q.d.ROTATE_TILE&&r%2===0)&&(J=[1-c,1-P,1-v,1-P,1-v,1-z,1-c,1-z]),(b===q.d.FLIP_ROW||b===q.d.FLIP_TILE&&r%2===0)&&(J=[1-c,P,1-v,P,1-v,z,1-c,z]),(b===q.d.FLIP_N_ROTATE_ROW||b===q.d.FLIP_N_ROTATE_TILE&&r%2===0)&&(J=[c,1-P,v,1-P,v,1-z,c,1-z]),l=l.concat(J),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),E&&g&&(L.push(Q+I,t+w,0),L.push(-n+I,t+w,0),L.push(-n+I,mY+w,0),L.push(Q+I,mY+w,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,c=1-O/C,P=0,v=1,z=S/R,J=[c,P,v,P,v,z,c,z],(b===q.d.ROTATE_ROW&&y%2===1||b===q.d.ROTATE_TILE&&y%1===0)&&(J=[1-c,1-P,1-v,1-P,1-v,1-z,1-c,1-z]),(b===q.d.FLIP_ROW&&y%2===1||b===q.d.FLIP_TILE&&y%2===0)&&(J=[1-c,P,1-v,P,1-v,z,1-c,z]),(b===q.d.FLIP_N_ROTATE_ROW&&y%2===1||b===q.d.FLIP_N_ROTATE_TILE&&y%2===0)&&(J=[c,1-P,v,1-P,v,1-z,c,1-z]),l=l.concat(J),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),E&&F&&(L.push(n+I,t+w,0),L.push(p+I,t+w,0),L.push(p+I,mY+w,0),L.push(n+I,mY+w,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,c=0,P=0,v=O/C,z=S/R,J=[c,P,v,P,v,z,c,z],(b===q.d.ROTATE_ROW&&y%2===1||b===q.d.ROTATE_TILE&&(y+r)%2===1)&&(J=[1-c,1-P,1-v,1-P,1-v,1-z,1-c,1-z]),(b===q.d.FLIP_ROW&&y%2===1||b===q.d.FLIP_TILE&&(y+r)%2===1)&&(J=[1-c,P,1-v,P,1-v,z,1-c,z]),(b===q.d.FLIP_N_ROTATE_ROW&&y%2===1||b===q.d.FLIP_N_ROTATE_TILE&&(y+r)%2===1)&&(J=[c,1-P,v,1-P,v,1-z,c,1-z]),l=l.concat(J),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y){const Y=[];c=0,P=1-S/R,v=1,z=1,Y[0]=[c,P,v,P,v,z,c,z],Y[1]=[c,P,v,P,v,z,c,z],b!==q.d.ROTATE_TILE&&b!==q.d.ROTATE_ROW||(Y[1]=[1-c,1-P,1-v,1-P,1-v,1-z,1-c,1-z]),b!==q.d.FLIP_TILE&&b!==q.d.FLIP_ROW||(Y[1]=[1-c,P,1-v,P,1-v,z,1-c,z]),b!==q.d.FLIP_N_ROTATE_TILE&&b!==q.d.FLIP_N_ROTATE_ROW||(Y[1]=[c,1-P,v,1-P,v,1-z,c,1-z]);for(let R=0;R<r;R++)L.push(R*C-n+I,N+w,0),L.push((R+1)*C-n+I,N+w,0),L.push((R+1)*C-n+I,N+S+w,0),L.push(R*C-n+I,N+S+w,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,l=b===q.d.FLIP_TILE||b===q.d.ROTATE_TILE||b===q.d.FLIP_N_ROTATE_TILE?l.concat(Y[(R+1)%2]):b===q.d.FLIP_ROW||b===q.d.ROTATE_ROW||b===q.d.FLIP_N_ROTATE_ROW?l.concat(Y[1]):l.concat(Y[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(E){const Y=[];c=0,P=0,v=1,z=S/R,Y[0]=[c,P,v,P,v,z,c,z],Y[1]=[c,P,v,P,v,z,c,z],b!==q.d.ROTATE_TILE&&b!==q.d.ROTATE_ROW||(Y[1]=[1-c,1-P,1-v,1-P,1-v,1-z,1-c,1-z]),b!==q.d.FLIP_TILE&&b!==q.d.FLIP_ROW||(Y[1]=[1-c,P,1-v,P,1-v,z,1-c,z]),b!==q.d.FLIP_N_ROTATE_TILE&&b!==q.d.FLIP_N_ROTATE_ROW||(Y[1]=[c,1-P,v,1-P,v,1-z,c,1-z]);for(let R=0;R<r;R++)L.push(R*C-n+I,mY-S+w,0),L.push((R+1)*C-n+I,mY-S+w,0),L.push((R+1)*C-n+I,mY+w,0),L.push(R*C-n+I,mY+w,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,l=b===q.d.FLIP_TILE||b===q.d.ROTATE_TILE||b===q.d.FLIP_N_ROTATE_TILE?l.concat(Y[(R+y)%2]):b===q.d.FLIP_ROW||b===q.d.ROTATE_ROW||b===q.d.FLIP_N_ROTATE_ROW?l.concat(Y[y%2]):l.concat(Y[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const Y=[];c=1-O/C,P=0,v=1,z=1,Y[0]=[c,P,v,P,v,z,c,z],Y[1]=[c,P,v,P,v,z,c,z],b!==q.d.ROTATE_TILE&&b!==q.d.ROTATE_ROW||(Y[1]=[1-c,1-P,1-v,1-P,1-v,1-z,1-c,1-z]),b!==q.d.FLIP_TILE&&b!==q.d.FLIP_ROW||(Y[1]=[1-c,P,1-v,P,1-v,z,1-c,z]),b!==q.d.FLIP_N_ROTATE_TILE&&b!==q.d.FLIP_N_ROTATE_ROW||(Y[1]=[c,1-P,v,1-P,v,1-z,c,1-z]);for(let C=0;C<y;C++)L.push(Q+I,C*R-t+w,0),L.push(Q+O+I,C*R-t+w,0),L.push(Q+O+I,(C+1)*R-t+w,0),L.push(Q+I,(C+1)*R-t+w,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,l=b===q.d.FLIP_TILE||b===q.d.ROTATE_TILE||b===q.d.FLIP_N_ROTATE_TILE?l.concat(Y[(C+1)%2]):b===q.d.FLIP_ROW||b===q.d.ROTATE_ROW||b===q.d.FLIP_N_ROTATE_ROW?l.concat(Y[C%2]):l.concat(Y[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){const Y=[];c=0,P=0,v=O/R,z=1,Y[0]=[c,P,v,P,v,z,c,z],Y[1]=[c,P,v,P,v,z,c,z],b!==q.d.ROTATE_TILE&&b!==q.d.ROTATE_ROW||(Y[1]=[1-c,1-P,1-v,1-P,1-v,1-z,1-c,1-z]),b!==q.d.FLIP_TILE&&b!==q.d.FLIP_ROW||(Y[1]=[1-c,P,1-v,P,1-v,z,1-c,z]),b!==q.d.FLIP_N_ROTATE_TILE&&b!==q.d.FLIP_N_ROTATE_ROW||(Y[1]=[c,1-P,v,1-P,v,1-z,c,1-z]);for(let C=0;C<y;C++)L.push(p-O+I,C*R-t+w,0),L.push(p+I,C*R-t+w,0),L.push(p+I,(C+1)*R-t+w,0),L.push(p-O+I,(C+1)*R-t+w,0),j.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,l=b===q.d.FLIP_TILE||b===q.d.ROTATE_TILE||b===q.d.FLIP_N_ROTATE_TILE?l.concat(Y[(C+r)%2]):b===q.d.FLIP_ROW||b===q.d.ROTATE_ROW||b===q.d.FLIP_N_ROTATE_ROW?l.concat(Y[C%2]):l.concat(Y[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const P=0===Y.sideOrientation?0:Y.sideOrientation||E.e.DEFAULTSIDE;E.e._ComputeSides(P,L,j,u,l,Y.frontUVs,Y.backUVs);const v=new E.e;v.indices=j,v.lY=L,v.XY=u,v.TY=l;const z=P===E.e.DOUBLESIDE?X.concat(X):X;return v.jY=z,v}function n(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new q.d(Y,C);b.sideOrientation=q.d._GetDefaultSideOrientation(b.sideOrientation),R._originalBuilderSideOrientation=b.sideOrientation;return S(b).vY(R,b.updatable),R}function t(Y){const b=Y.faceUV||new Array(6),C=Y.faceColors,A=Y.pattern||q.d.NO_FLIP,g=Y.width||Y.size||1,r=Y.height||Y.size||1,O=Y.depth||Y.size||1,F=Y.tileWidth||Y.tileSize||1,n=Y.tileHeight||Y.tileSize||1,t=Y.alignHorizontal||0,I=Y.alignVertical||0,w=0===Y.sideOrientation?0:Y.sideOrientation||E.e.DEFAULTSIDE;for(let q=0;q<6;q++)void 0===b[q]&&(b[q]=new R.Vector4(0,0,1,1)),C&&void 0===C[q]&&(C[q]=new y.hb(1,1,1,1));const Q=g/2,N=r/2,p=O/2,mY=[];for(let R=0;R<2;R++)mY[R]=S({pattern:A,tileWidth:F,tileHeight:n,width:g,height:r,alignVertical:I,alignHorizontal:t,sideOrientation:w});for(let R=2;R<4;R++)mY[R]=S({pattern:A,tileWidth:F,tileHeight:n,width:O,height:r,alignVertical:I,alignHorizontal:t,sideOrientation:w});let L=I;I===q.d.BOTTOM?L=q.d.TOP:I===q.d.TOP&&(L=q.d.BOTTOM);for(let R=4;R<6;R++)mY[R]=S({pattern:A,tileWidth:F,tileHeight:n,width:g,height:O,alignVertical:L,alignHorizontal:t,sideOrientation:w});let u=[],c=[],l=[],X=[];const j=[],T=[],P=[],v=[];let z=0,J=0;for(let q=0;q<6;q++){const Y=mY[q].lY.length;T[q]=[],P[q]=[];for(let b=0;b<Y/3;b++)T[q].push(new R.AC(mY[q].lY[3*b],mY[q].lY[3*b+1],mY[q].lY[3*b+2])),P[q].push(new R.AC(mY[q].XY[3*b],mY[q].XY[3*b+1],mY[q].XY[3*b+2]));z=mY[q].TY.length,v[q]=[];for(let C=0;C<z;C+=2)v[q][C]=b[q].x+(b[q].z-b[q].x)*mY[q].TY[C],v[q][C+1]=b[q].y+(b[q].w-b[q].y)*mY[q].TY[C+1],B.b&&(v[q][C+1]=1-v[q][C+1]);if(l=l.concat(v[q]),X=X.concat(mY[q].indices.map((Y=>Y+J))),J+=T[q].length,C)for(let b=0;b<4;b++)j.push(C[q].r,C[q].g,C[q].b,C[q].a)}const U=new R.AC(0,0,p),o=R.Matrix.RotationY(Math.PI);u=T[0].map((Y=>R.AC.TransformNormal(Y,o).add(U))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[]),c=P[0].map((Y=>R.AC.TransformNormal(Y,o))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[]),u=u.concat(T[1].map((Y=>Y.EC(U))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[])),c=c.concat(P[1].map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[]));const G=new R.AC(Q,0,0),h=R.Matrix.RotationY(-Math.PI/2);u=u.concat(T[2].map((Y=>R.AC.TransformNormal(Y,h).add(G))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[])),c=c.concat(P[2].map((Y=>R.AC.TransformNormal(Y,h))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[]));const e=R.Matrix.RotationY(Math.PI/2);u=u.concat(T[3].map((Y=>R.AC.TransformNormal(Y,e).EC(G))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[])),c=c.concat(P[3].map((Y=>R.AC.TransformNormal(Y,e))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[]));const H=new R.AC(0,N,0),i=R.Matrix.RotationX(Math.PI/2);u=u.concat(T[4].map((Y=>R.AC.TransformNormal(Y,i).add(H))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[])),c=c.concat(P[4].map((Y=>R.AC.TransformNormal(Y,i))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[]));const W=R.Matrix.RotationX(-Math.PI/2);u=u.concat(T[5].map((Y=>R.AC.TransformNormal(Y,W).EC(H))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[])),c=c.concat(P[5].map((Y=>R.AC.TransformNormal(Y,W))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,b)=>Y.concat(b)),[])),E.e._ComputeSides(w,u,X,c,l);const s=new E.e;if(s.indices=X,s.lY=u,s.XY=c,s.TY=l,C){const Y=w===E.e.DOUBLESIDE?j.concat(j):j;s.jY=Y}return s}function I(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new q.d(Y,C);b.sideOrientation=q.d._GetDefaultSideOrientation(b.sideOrientation),R._originalBuilderSideOrientation=b.sideOrientation;return t(b).vY(R,b.updatable),R}E.e.CreateTiledPlane=S;E.e.CreateTiledBox=t;var w=C(14072),Q=C(13077),N=C(13029);function p(Y){const b=Y.height||2;let C=0===Y.diameterTop?0:Y.diameterTop||Y.diameter||1,A=0===Y.diameterBottom?0:Y.diameterBottom||Y.diameter||1;C=C||1e-5,A=A||1e-5;const g=0|(Y.tessellation||24),r=0|(Y.subdivisions||1),O=!!Y.hasRings,F=!!Y.enclose,S=0===Y.cap?0:Y.cap||q.d.CAP_ALL,n=Y.arc&&(Y.arc<=0||Y.arc>1)?1:Y.arc||1,t=0===Y.sideOrientation?0:Y.sideOrientation||E.e.DEFAULTSIDE,I=Y.faceUV||new Array(3),w=Y.faceColors,Q=2+(1+(1!==n&&F?2:0))*(O?r:1);let p;for(p=0;p<Q;p++)w&&void 0===w[p]&&(w[p]=new y.hb(1,1,1,1));for(p=0;p<Q;p++)I&&void 0===I[p]&&(I[p]=new R.Vector4(0,0,1,1));const mY=[],L=[],u=[],c=[],l=[],X=2*Math.PI*n/g;let j,T,P;const v=(A-C)/2/b,z=R.AC.Zero(),J=R.AC.Zero(),U=R.AC.Zero(),o=R.AC.Zero(),G=R.AC.Zero(),h=N.c.Y;let e,H,i,W=1,s=1,D=0,d=0;for(e=0;e<=r;e++)for(T=e/r,P=(T*(C-A)+A)/2,W=O&&0!==e&&e!==r?2:1,i=0;i<W;i++){for(O&&(s+=i),F&&(s+=2*i),H=0;H<=g;H++)j=H*X,z.x=Math.cos(-j)*P,z.y=-b/2+T*b,z.z=Math.sin(-j)*P,0===C&&e===r?(J.x=u[u.length-3*(g+1)],J.y=u[u.length-3*(g+1)+1],J.z=u[u.length-3*(g+1)+2]):(J.x=z.x,J.z=z.z,J.y=Math.sqrt(J.x*J.x+J.z*J.z)*v,J.normalize()),0===H&&(U.q(z),o.q(J)),L.push(z.x,z.y,z.z),u.push(J.x,J.y,J.z),d=O?D!==s?I[s].y:I[s].w:I[s].y+(I[s].w-I[s].y)*T,c.push(I[s].x+(I[s].z-I[s].x)*H/g,B.b?1-d:d),w&&l.push(w[s].r,w[s].g,w[s].b,w[s].a);1!==n&&F&&(L.push(z.x,z.y,z.z),L.push(0,z.y,0),L.push(0,z.y,0),L.push(U.x,U.y,U.z),R.AC.CrossToRef(h,J,G),G.normalize(),u.push(G.x,G.y,G.z,G.x,G.y,G.z),R.AC.CrossToRef(o,h,G),G.normalize(),u.push(G.x,G.y,G.z,G.x,G.y,G.z),d=O?D!==s?I[s+1].y:I[s+1].w:I[s+1].y+(I[s+1].w-I[s+1].y)*T,c.push(I[s+1].x,B.b?1-d:d),c.push(I[s+1].z,B.b?1-d:d),d=O?D!==s?I[s+2].y:I[s+2].w:I[s+2].y+(I[s+2].w-I[s+2].y)*T,c.push(I[s+2].x,B.b?1-d:d),c.push(I[s+2].z,B.b?1-d:d),w&&(l.push(w[s+1].r,w[s+1].g,w[s+1].b,w[s+1].a),l.push(w[s+1].r,w[s+1].g,w[s+1].b,w[s+1].a),l.push(w[s+2].r,w[s+2].g,w[s+2].b,w[s+2].a),l.push(w[s+2].r,w[s+2].g,w[s+2].b,w[s+2].a))),D!==s&&(D=s)}const V=1!==n&&F?g+4:g;for(e=0,s=0;s<r;s++){let Y=0,b=0,C=0,R=0;for(H=0;H<g;H++)Y=e*(V+1)+H,b=(e+1)*(V+1)+H,C=e*(V+1)+(H+1),R=(e+1)*(V+1)+(H+1),mY.push(Y,b,C),mY.push(R,C,b);1!==n&&F&&(mY.push(Y+2,b+2,C+2),mY.push(R+2,C+2,b+2),mY.push(Y+4,b+4,C+4),mY.push(R+4,C+4,b+4)),e=O?e+2:e+1}const k=Y=>{const q=Y?C/2:A/2;if(0===q)return;let E,r,O;const F=Y?I[Q-1]:I[0];let y=null;w&&(y=Y?w[Q-1]:w[0]);const S=L.length/3,t=Y?b/2:-b/2,N=new R.AC(0,t,0);L.push(N.x,N.y,N.z),u.push(0,Y?1:-1,0);const p=F.y+.5*(F.w-F.y);c.push(F.x+.5*(F.z-F.x),B.b?1-p:p),y&&l.push(y.r,y.g,y.b,y.a);const X=new R.Vector2(.5,.5);for(O=0;O<=g;O++){E=2*Math.PI*O*n/g;const b=Math.cos(-E),C=Math.sin(-E);r=new R.AC(b*q,t,C*q);const A=new R.Vector2(b*X.x+.5,C*X.y+.5);L.push(r.x,r.y,r.z),u.push(0,Y?1:-1,0);const S=F.y+(F.w-F.y)*A.y;c.push(F.x+(F.z-F.x)*A.x,B.b?1-S:S),y&&l.push(y.r,y.g,y.b,y.a)}for(O=0;O<g;O++)Y?(mY.push(S),mY.push(S+(O+2)),mY.push(S+(O+1))):(mY.push(S),mY.push(S+(O+1)),mY.push(S+(O+2)))};S!==q.d.CAP_START&&S!==q.d.CAP_ALL||k(!1),S!==q.d.CAP_END&&S!==q.d.CAP_ALL||k(!0),E.e._ComputeSides(t,L,mY,u,c,Y.frontUVs,Y.backUVs);const x=new E.e;return x.indices=mY,x.lY=L,x.XY=u,x.TY=c,w&&(x.jY=l),x}function mY(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const R=new q.d(Y,C);b.sideOrientation=q.d._GetDefaultSideOrientation(b.sideOrientation),R._originalBuilderSideOrientation=b.sideOrientation;return p(b).vY(R,b.updatable),R}function L(Y){const b=[],C=[],q=[],A=[],g=Y.diameter||1,r=Y.thickness||.5,O=0|(Y.tessellation||16),F=0===Y.sideOrientation?0:Y.sideOrientation||E.e.DEFAULTSIDE,y=O+1;for(let E=0;E<=O;E++){const Y=E/O,F=E*Math.PI*2/O-Math.PI/2,S=R.Matrix.Translation(g/2,0,0).multiply(R.Matrix.RotationY(F));for(let g=0;g<=O;g++){const F=1-g/O,n=g*Math.PI*2/O+Math.PI,t=Math.cos(n),I=Math.sin(n);let w=new R.AC(t,I,0),Q=w.scale(r/2);const N=new R.Vector2(Y,F);Q=R.AC.TransformCoordinates(Q,S),w=R.AC.TransformNormal(w,S),C.push(Q.x,Q.y,Q.z),q.push(w.x,w.y,w.z),A.push(N.x,B.b?1-N.y:N.y);const p=(E+1)%y,mY=(g+1)%y;b.push(E*y+g),b.push(E*y+mY),b.push(p*y+g),b.push(E*y+mY),b.push(p*y+mY),b.push(p*y+g)}}E.e._ComputeSides(F,C,b,q,A,Y.frontUVs,Y.backUVs);const S=new E.e;return S.indices=b,S.lY=C,S.XY=q,S.TY=A,S}function u(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const R=new q.d(Y,C);b.sideOrientation=q.d._GetDefaultSideOrientation(b.sideOrientation),R._originalBuilderSideOrientation=b.sideOrientation;return L(b).vY(R,b.updatable),R}E.e.CreateCylinder=p,q.d.CreateCylinder=(Y,b,C,R,A,E,B,g,r)=>{void 0!==B&&B instanceof Q.b||(void 0!==B&&(r=g||q.d.DEFAULTSIDE,g=B),B=E,E=1);return mY(Y,{height:b,diameterTop:C,diameterBottom:R,tessellation:A,subdivisions:E,sideOrientation:r,updatable:g},B)};function c(Y){const b=[],C=[],q=[],A=[],g=Y.radius||2,r=Y.tube||.5,O=Y.radialSegments||32,F=Y.tubularSegments||32,y=Y.p||2,S=Y.q||3,n=0===Y.sideOrientation?0:Y.sideOrientation||E.e.DEFAULTSIDE,t=Y=>{const b=Math.cos(Y),C=Math.sin(Y),q=S/y*Y,A=Math.cos(q),E=g*(2+A)*.5*b,B=g*(2+A)*C*.5,r=g*Math.sin(q)*.5;return new R.AC(E,B,r)};let I,w;for(I=0;I<=O;I++){const Y=I%O/O*2*y*Math.PI,b=t(Y),q=t(Y+.01),E=q.EC(b);let g=q.add(b);const S=R.AC.Cross(E,g);for(g=R.AC.Cross(S,E),S.normalize(),g.normalize(),w=0;w<F;w++){const Y=w%F/F*2*Math.PI,R=-r*Math.cos(Y),q=r*Math.sin(Y);C.push(b.x+R*g.x+q*S.x),C.push(b.y+R*g.y+q*S.y),C.push(b.z+R*g.z+q*S.z),A.push(I/O),A.push(B.b?1-w/F:w/F)}}for(I=0;I<O;I++)for(w=0;w<F;w++){const Y=(w+1)%F,C=I*F+w,R=(I+1)*F+w,q=(I+1)*F+Y,A=I*F+Y;b.push(A),b.push(R),b.push(C),b.push(A),b.push(q),b.push(R)}E.e.ComputeNormals(C,b,q),E.e._ComputeSides(n,C,b,q,A,Y.frontUVs,Y.backUVs);const Q=new E.e;return Q.indices=b,Q.lY=C,Q.XY=q,Q.TY=A,Q}function l(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const R=new q.d(Y,C);b.sideOrientation=q.d._GetDefaultSideOrientation(b.sideOrientation),R._originalBuilderSideOrientation=b.sideOrientation;return c(b).vY(R,b.updatable),R}E.e.CreateTorus=L,q.d.CreateTorus=(Y,b,C,R,q,A,E)=>u(Y,{diameter:b,thickness:C,tessellation:R,sideOrientation:E,updatable:A},q);E.e.CreateTorusKnot=c,q.d.CreateTorusKnot=(Y,b,C,R,q,A,E,B,g,r)=>l(Y,{radius:b,tube:C,radialSegments:R,tubularSegments:q,p:A,q:E,sideOrientation:r,updatable:g},B);var X=C(14599),j=C(13381),T=C(13046);function P(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=b.path,A=b.shape,E=b.scale||1,B=b.rotation||0,g=0===b.cap?0:b.cap||q.d.NO_CAP,r=b.updatable,O=q.d._GetDefaultSideOrientation(b.sideOrientation),F=b.instance||null,y=b.invertUV||!1,S=b.closeShape||!1,n=b.closePath||!1,t=b.capFunction||null;return z(Y,A,R,E,B,null,null,n,S,g,!1,C,!!r,O,F,y,b.frontUVs||null,b.backUVs||null,b.firstNormal||null,!!b.adjustFrame,t)}function v(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=b.path,A=b.shape,E=b.scaleFunction||(()=>1),B=b.rotationFunction||(()=>0),g=b.closePath||b.ribbonCloseArray||!1,r=b.closeShape||b.ribbonClosePath||!1,O=0===b.cap?0:b.cap||q.d.NO_CAP,F=b.updatable,y=b.firstNormal||null,S=b.adjustFrame||!1,n=q.d._GetDefaultSideOrientation(b.sideOrientation),t=b.instance,I=b.invertUV||!1,w=b.capFunction||null;return z(Y,A,R,null,null,E,B,g,r,O,!0,C,!!F,n,t||null,I,b.frontUVs||null,b.backUVs||null,y,S,w||null)}function z(Y,b,C,A,E,B,g,O,F,y,S,n,t,I,w,Q,N,p,mY,L,u){const c=(Y,b,C,A,E,B,g,r,O,F,y)=>{const S=C.getTangents(),n=C.getNormals(),t=C.getBinormals(),I=C.getDistances();if(y)for(let q=0;q<S.length;q++)if(0==S[q].x&&0==S[q].y&&0==S[q].z&&S[q].q(S[q-1]),0==n[q].x&&0==n[q].y&&0==n[q].z&&n[q].q(n[q-1]),0==t[q].x&&0==t[q].y&&0==t[q].z&&t[q].q(t[q-1]),q>0){let Y=S[q-1];R.AC.Dot(Y,S[q])<0&&S[q].scaleInPlace(-1),Y=n[q-1],R.AC.Dot(Y,n[q])<0&&n[q].scaleInPlace(-1),Y=t[q-1],R.AC.Dot(Y,t[q])<0&&t[q].scaleInPlace(-1)}let w=0;const Q=F&&r?r:()=>null!==B?B:0,N=F&&g?g:()=>null!==E?E:1;let p=O===q.d.NO_CAP||O===q.d.CAP_END?0:2;const mY=R.TmpVectors.Matrix[0];for(let q=0;q<b.length;q++){const C=[],E=Q(q,I[q]),B=N(q,I[q]);R.Matrix.RotationAxisToRef(S[q],w,mY);for(let A=0;A<Y.length;A++){const E=S[q].scale(Y[A].z).add(n[q].scale(Y[A].x)).add(t[q].scale(Y[A].y)),g=R.AC.Zero();R.AC.TransformCoordinatesToRef(E,mY,g),g.scaleInPlace(B).addInPlace(b[q]),C[A]=g}A[p]=C,w+=E,p++}const L=u||(Y=>{const b=Array(),C=R.AC.Zero();let q;for(q=0;q<Y.length;q++)C.addInPlace(Y[q]);for(C.scaleInPlace(1/Y.length),q=0;q<Y.length;q++)b.push(C);return b});switch(O){case q.d.NO_CAP:break;case q.d.CAP_START:A[0]=L(A[2]),A[1]=A[2];break;case q.d.CAP_END:A[p]=A[p-1],A[p+1]=L(A[p-1]);break;case q.d.CAP_ALL:A[0]=L(A[2]),A[1]=A[2],A[p]=A[p-1],A[p+1]=L(A[p-1])}return A};let l,X;if(w){const Y=w._creationDataStorage;return l=mY?Y.path3D.update(C,mY):Y.path3D.update(C),X=c(b,C,Y.path3D,Y.pathArray,A,E,B,g,Y.cap,S,L),w=r("",{pathArray:X,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:w},n||void 0)}l=mY?new T.l(C,mY):new T.l(C);X=c(b,C,l,new Array,A,E,B,g,y=y<0||y>3?0:y,S,L);const j=r(Y,{pathArray:X,closeArray:O,closePath:F,updatable:t,sideOrientation:I,invertUV:Q,frontUVs:N||void 0,backUVs:p||void 0},n);return j._creationDataStorage.pathArray=X,j._creationDataStorage.path3D=l,j._creationDataStorage.cap=y,j}function J(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=b.arc?b.arc<=0||b.arc>1?1:b.arc:1,E=void 0===b.closed||b.closed,B=b.shape,g=b.radius||1,O=b.tessellation||64,F=b.clip||0,y=b.updatable,S=q.d._GetDefaultSideOrientation(b.sideOrientation),n=b.cap||q.d.NO_CAP,t=2*Math.PI,I=[],w=b.invertUV||!1;let Q=0,N=0;const p=t/O*A;let mY,L;for(Q=0;Q<=O-F;Q++){for(L=[],n!=q.d.CAP_START&&n!=q.d.CAP_ALL||(L.push(new R.AC(0,B[0].y,0)),L.push(new R.AC(Math.cos(Q*p)*B[0].x*g,B[0].y,Math.sin(Q*p)*B[0].x*g))),N=0;N<B.length;N++)mY=new R.AC(Math.cos(Q*p)*B[N].x*g,B[N].y,Math.sin(Q*p)*B[N].x*g),L.push(mY);n!=q.d.CAP_END&&n!=q.d.CAP_ALL||(L.push(new R.AC(Math.cos(Q*p)*B[B.length-1].x*g,B[B.length-1].y,Math.sin(Q*p)*B[B.length-1].x*g)),L.push(new R.AC(0,B[B.length-1].y,0))),I.push(L)}return r(Y,{pathArray:I,closeArray:E,sideOrientation:S,updatable:y,invertUV:w,frontUVs:b.frontUVs,backUVs:b.backUVs},C)}q.d.ExtrudeShape=function(Y,b,C,R,A,E){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7?arguments[7]:void 0,r=arguments.length>8?arguments[8]:void 0,O=arguments.length>9?arguments[9]:void 0;return P(Y,{shape:b,path:C,scale:R,rotation:A,cap:0===E?0:E||q.d.NO_CAP,sideOrientation:r,instance:O,updatable:g},B)},q.d.ExtrudeShapeCustom=(Y,b,C,R,A,E,B,g,r,O,F,y)=>v(Y,{shape:b,path:C,scaleFunction:R,rotationFunction:A,ribbonCloseArray:E,ribbonClosePath:B,cap:0===g?0:g||q.d.NO_CAP,sideOrientation:F,instance:y,updatable:O},r);q.d.CreateLathe=(Y,b,C,R,q,A,E)=>J(Y,{shape:b,radius:C,tessellation:R,sideOrientation:E,updatable:A},q);var U=C(13987),o=C(13932);function G(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=b.path;let E=b.instance,B=1;void 0!==b.radius?B=b.radius:E&&(B=E._creationDataStorage.radius);const g=b.tessellation||64,O=b.radiusFunction||null;let F=b.cap||q.d.NO_CAP;const y=b.invertUV||!1,S=b.updatable,n=q.d._GetDefaultSideOrientation(b.sideOrientation);b.arc=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1;const t=(Y,b,C,A,E,B,g,r)=>{const O=b.getTangents(),F=b.getNormals(),y=b.getDistances(),S=2*Math.PI/E*r,n=B||(()=>A);let t,I,w,Q;const N=R.TmpVectors.Matrix[0];let p=g===q.d.NO_CAP||g===q.d.CAP_END?0:2;for(let q=0;q<Y.length;q++){I=n(q,y[q]),t=Array(),w=F[q];for(let b=0;b<E;b++)R.Matrix.RotationAxisToRef(O[q],S*b,N),Q=t[b]?t[b]:R.AC.Zero(),R.AC.TransformCoordinatesToRef(w,N,Q),Q.scaleInPlace(I).addInPlace(Y[q]),t[b]=Q;C[p]=t,p++}const mY=(b,C)=>{const R=Array();for(let q=0;q<b;q++)R.push(Y[C]);return R};switch(g){case q.d.NO_CAP:break;case q.d.CAP_START:C[0]=mY(E,0),C[1]=C[2].slice(0);break;case q.d.CAP_END:C[p]=C[p-1].slice(0),C[p+1]=mY(E,Y.length-1);break;case q.d.CAP_ALL:C[0]=mY(E,0),C[1]=C[2].slice(0),C[p]=C[p-1].slice(0),C[p+1]=mY(E,Y.length-1)}return C};let I,w;if(E){const Y=E._creationDataStorage,C=b.arc||Y.arc;return I=Y.path3D.update(A),w=t(A,I,Y.pathArray,B,Y.tessellation,O,Y.cap,C),E=r("",{pathArray:w,instance:E}),Y.path3D=I,Y.pathArray=w,Y.arc=C,Y.radius=B,E}I=new T.l(A);F=F<0||F>3?0:F,w=t(A,I,new Array,B,g,O,F,b.arc);const Q=r(Y,{pathArray:w,closePath:!0,closeArray:!1,updatable:S,sideOrientation:n,invertUV:y,frontUVs:b.frontUVs,backUVs:b.backUVs},C);return Q._creationDataStorage.pathArray=w,Q._creationDataStorage.path3D=I,Q._creationDataStorage.tessellation=g,Q._creationDataStorage.cap=F,Q._creationDataStorage.arc=b.arc,Q._creationDataStorage.radius=B,Q}function h(Y){const b=[];b[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},b[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},b[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},b[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},b[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},b[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},b[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},b[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},b[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},b[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},b[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},b[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},b[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},b[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},b[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const C=Y.type&&(Y.type<0||Y.type>=b.length)?0:Y.type||0,q=Y.size,A=Y.sizeX||q||1,g=Y.sizeY||q||1,r=Y.sizeZ||q||1,O=Y.custom||b[C],F=O.face.length,S=Y.faceUV||new Array(F),n=Y.faceColors,t=void 0===Y.flat||Y.flat,I=0===Y.sideOrientation?0:Y.sideOrientation||E.e.DEFAULTSIDE,w=[],Q=[],N=[],p=[],mY=[];let L=0,u=0;const c=[];let l,X,j,T,P,v,z=0,J=0;if(t)for(J=0;J<F;J++)n&&void 0===n[J]&&(n[J]=new y.hb(1,1,1,1)),S&&void 0===S[J]&&(S[J]=new R.Vector4(0,0,1,1));if(t)for(J=0;J<F;J++){const Y=O.face[J].length;for(j=2*Math.PI/Y,T=.5*Math.tan(j/2),P=.5,z=0;z<Y;z++)w.push(O.vertex[O.face[J][z]][0]*A,O.vertex[O.face[J][z]][1]*g,O.vertex[O.face[J][z]][2]*r),c.push(L),L++,l=S[J].x+(S[J].z-S[J].x)*(.5+T),X=S[J].y+(S[J].w-S[J].y)*(P-.5),p.push(l,B.b?1-X:X),v=T*Math.cos(j)-P*Math.sin(j),P=T*Math.sin(j)+P*Math.cos(j),T=v,n&&mY.push(n[J].r,n[J].g,n[J].b,n[J].a);for(z=0;z<Y-2;z++)Q.push(c[0+u],c[z+2+u],c[z+1+u]);u+=Y}else{for(z=0;z<O.vertex.length;z++)w.push(O.vertex[z][0]*A,O.vertex[z][1]*g,O.vertex[z][2]*r),p.push(0,B.b?1:0);for(J=0;J<F;J++)for(z=0;z<O.face[J].length-2;z++)Q.push(O.face[J][0],O.face[J][z+2],O.face[J][z+1])}E.e.ComputeNormals(w,Q,N),E.e._ComputeSides(I,w,Q,N,p,Y.frontUVs,Y.backUVs);const U=new E.e;return U.lY=w,U.indices=Q,U.XY=N,U.TY=p,n&&t&&(U.jY=mY),U}function e(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new q.d(Y,C);b.sideOrientation=q.d._GetDefaultSideOrientation(b.sideOrientation),R._originalBuilderSideOrientation=b.sideOrientation;return h(b).vY(R,b.updatable),R}q.d.CreateTube=(Y,b,C,R,q,A,E,B,g,r)=>G(Y,{path:b,radius:C,tessellation:R,radiusFunction:q,arc:1,cap:A,updatable:B,sideOrientation:g,instance:r},E);function H(Y){const b=Y.sideOrientation||E.e.DEFAULTSIDE,C=Y.radius||1,q=void 0===Y.flat||Y.flat,A=0|(Y.subdivisions||4),g=Y.radiusX||C,r=Y.radiusY||C,O=Y.radiusZ||C,F=(1+Math.sqrt(5))/2,y=[-1,F,-0,1,F,0,-1,-F,0,1,-F,0,0,-1,-F,0,1,-F,0,-1,F,0,1,F,F,0,1,F,0,-1,-F,0,1,-F,0,-1],S=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],n=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],t=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],I=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],w=[],Q=[],N=[],p=[];let mY=0;const L=new Array(3),u=new Array(3);let c;for(c=0;c<3;c++)L[c]=R.AC.Zero(),u[c]=R.Vector2.Zero();for(let E=0;E<20;E++){for(c=0;c<3;c++){const Y=S[3*E+c];L[c].Ub(y[3*n[Y]],y[3*n[Y]+1],y[3*n[Y]+2]),L[c].normalize(),u[c].Ub(.134765625*t[2*Y]+.05859375+-.0390625*I[E],.2333984375*t[2*Y+1]+.025390625+.01953125*I[E])}const Y=(Y,b,C,E)=>{const F=R.AC.Lerp(L[0],L[2],b/A),y=R.AC.Lerp(L[1],L[2],b/A),S=A===b?L[2]:R.AC.Lerp(F,y,Y/(A-b));let n;if(S.normalize(),q){const Y=R.AC.Lerp(L[0],L[2],E/A),b=R.AC.Lerp(L[1],L[2],E/A);n=R.AC.Lerp(Y,b,C/(A-E))}else n=new R.AC(S.x,S.y,S.z);n.x/=g,n.y/=r,n.z/=O,n.normalize();const t=R.Vector2.Lerp(u[0],u[2],b/A),I=R.Vector2.Lerp(u[1],u[2],b/A),c=A===b?u[2]:R.Vector2.Lerp(t,I,Y/(A-b));Q.push(S.x*g,S.y*r,S.z*O),N.push(n.x,n.y,n.z),p.push(c.x,B.b?1-c.y:c.y),w.push(mY),mY++};for(let b=0;b<A;b++)for(let C=0;C+b<A;C++)Y(C,b,C+1/3,b+1/3),Y(C+1,b,C+1/3,b+1/3),Y(C,b+1,C+1/3,b+1/3),C+b+1<A&&(Y(C+1,b,C+2/3,b+2/3),Y(C+1,b+1,C+2/3,b+2/3),Y(C,b+1,C+2/3,b+2/3))}E.e._ComputeSides(b,Q,w,N,p,Y.frontUVs,Y.backUVs);const l=new E.e;return l.indices=w,l.lY=Q,l.XY=N,l.TY=p,l}function i(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new q.d(Y,C);b.sideOrientation=q.d._GetDefaultSideOrientation(b.sideOrientation),R._originalBuilderSideOrientation=b.sideOrientation;return H(b).vY(R,b.updatable),R}E.e.CreatePolyhedron=h,q.d.CreatePolyhedron=(Y,b,C)=>e(Y,b,C);E.e.CreateIcoSphere=H,q.d.CreateIcoSphere=(Y,b,C)=>i(Y,b,C);var W=C(12852);const s=new R.AC(1,0,0),D=new R.AC(-1,0,0),d=new R.AC(0,1,0),V=new R.AC(0,-1,0),k=new R.AC(0,0,1),x=new R.AC(0,0,-1);class a{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.AC.Zero(),b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.AC.Up(),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.Vector2.Zero(),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=Y,this.normal=b,this.uv=C,this.vertexIdx=q,this.vertexIdxForBones=A,this.localPositionOverride=E,this.localNormalOverride=B,this.matrixIndicesOverride=g,this.matrixWeightsOverride=r}clone(){var Y,b,C,R;return new a(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(Y=this.localPositionOverride)||void 0===Y?void 0:Y.slice(),null===(b=this.localNormalOverride)||void 0===b?void 0:b.slice(),null===(C=this.matrixIndicesOverride)||void 0===C?void 0:C.slice(),null===(R=this.matrixWeightsOverride)||void 0===R?void 0:R.slice())}}function M(Y,b,C){var g,r,O,F,y;const S=!!b.skeleton,n=!(null===(g=b.morphTargetManager)||void 0===g||!g.numTargets),t=C.localMode||S,I=b.zb(),w=S||n?b.yg(!0,!0):b.getVerticesData(A.e.PositionKind),Q=S||n?b.getNormalsData(!0,!0):b.getVerticesData(A.e.NormalKind),N=t?S?b.getVerticesData(A.e.PositionKind):w:null,p=t?S?b.getVerticesData(A.e.NormalKind):Q:null,mY=b.getVerticesData(A.e.UVKind),L=S?b.getVerticesData(A.e.MatricesIndicesKind):null,u=S?b.getVerticesData(A.e.MatricesWeightsKind):null,c=S?b.getVerticesData(A.e.MatricesIndicesExtraKind):null,l=S?b.getVerticesData(A.e.MatricesWeightsExtraKind):null,X=C.position||R.AC.Zero();let j=C.normal||R.AC.Up();const T=C.size||R.AC.One(),P=C.angle||0;if(!j){const Y=new R.AC(0,0,1),C=b.uY().activeCamera,q=R.AC.TransformCoordinates(Y,C.getWorldMatrix());j=C.globalPosition.EC(q)}const v=-Math.atan2(j.z,j.x)-Math.PI/2,z=Math.sqrt(j.x*j.x+j.z*j.z),J=Math.atan2(j.y,z),U=new E.e;U.indices=[],U.lY=[],U.XY=[],U.TY=[],U.matricesIndices=S?[]:null,U.matricesWeights=S?[]:null,U.matricesIndicesExtra=c?[]:null,U.matricesWeightsExtra=l?[]:null;let o=0;const G=(Y,b)=>{const q=new a;if(!I||!w||!Q)return q;const A=I[Y];if(q.vertexIdx=3*A,q.vertexIdxForBones=4*A,q.position=new R.AC(w[3*A],w[3*A+1],w[3*A+2]),R.AC.TransformCoordinatesToRef(q.position,b,q.position),q.normal=new R.AC(Q[3*A],Q[3*A+1],Q[3*A+2]),R.AC.TransformNormalToRef(q.normal,b,q.normal),C.captureUVS&&mY){const Y=mY[2*A+1];q.uv=new R.Vector2(mY[2*A],B.b?1-Y:Y)}return q},h=[0,0,0,0],e=(Y,b)=>{if(0===Y.length)return Y;const C=.5*Math.abs(R.AC.Dot(T,b)),q=(Y,b,C,R)=>{for(let q=0;q<R;++q)if(Y[C+q]===b)return C+q;return-1},A=(Y,A)=>{const E=R.AC.GetClipFactor(Y.position,A.position,b,C);let B=h,g=h;if(L&&u){const b=Y.matrixIndicesOverride?0:Y.vertexIdxForBones,C=Y.matrixIndicesOverride??L,R=Y.matrixWeightsOverride??u,r=A.matrixIndicesOverride?0:A.vertexIdxForBones,O=A.matrixIndicesOverride??L,F=A.matrixWeightsOverride??u;B=[0,0,0,0],g=[0,0,0,0];let y=0;for(let Y=0;Y<4;++Y)if(R[b+Y]>0){const A=q(O,C[b+Y],r,4);B[y]=C[b+Y],g[y]=(0,W.Lerp)(R[b+Y],A>=0?F[A]:0,E),y++}for(let Y=0;Y<4&&y<4;++Y){const R=O[r+Y];-1===q(C,R,b,4)&&(B[y]=R,g[y]=(0,W.Lerp)(0,F[r+Y],E),y++)}const S=g[0]+g[1]+g[2]+g[3];g[0]/=S,g[1]/=S,g[2]/=S,g[3]/=S}const r=Y.localPositionOverride?Y.localPositionOverride[0]:(null===N||void 0===N?void 0:N[Y.vertexIdx])??0,O=Y.localPositionOverride?Y.localPositionOverride[1]:(null===N||void 0===N?void 0:N[Y.vertexIdx+1])??0,F=Y.localPositionOverride?Y.localPositionOverride[2]:(null===N||void 0===N?void 0:N[Y.vertexIdx+2])??0,y=A.localPositionOverride?A.localPositionOverride[0]:(null===N||void 0===N?void 0:N[A.vertexIdx])??0,S=A.localPositionOverride?A.localPositionOverride[1]:(null===N||void 0===N?void 0:N[A.vertexIdx+1])??0,n=A.localPositionOverride?A.localPositionOverride[2]:(null===N||void 0===N?void 0:N[A.vertexIdx+2])??0,t=Y.localNormalOverride?Y.localNormalOverride[0]:(null===p||void 0===p?void 0:p[Y.vertexIdx])??0,I=Y.localNormalOverride?Y.localNormalOverride[1]:(null===p||void 0===p?void 0:p[Y.vertexIdx+1])??0,w=Y.localNormalOverride?Y.localNormalOverride[2]:(null===p||void 0===p?void 0:p[Y.vertexIdx+2])??0,Q=t+((A.localNormalOverride?A.localNormalOverride[0]:(null===p||void 0===p?void 0:p[A.vertexIdx])??0)-t)*E,mY=I+((A.localNormalOverride?A.localNormalOverride[1]:(null===p||void 0===p?void 0:p[A.vertexIdx+1])??0)-I)*E,c=w+((A.localNormalOverride?A.localNormalOverride[2]:(null===p||void 0===p?void 0:p[A.vertexIdx+2])??0)-w)*E,l=Math.sqrt(Q*Q+mY*mY+c*c);return new a(R.AC.Lerp(Y.position,A.position,E),R.AC.Lerp(Y.normal,A.normal,E).normalize(),R.Vector2.Lerp(Y.uv,A.uv,E),-1,-1,N?[r+(y-r)*E,O+(S-O)*E,F+(n-F)*E]:null,p?[Q/l,mY/l,c/l]:null,B,g)};let E=null;Y.length>3&&(E=[]);for(let B=0;B<Y.length;B+=3){let q=0,g=null,r=null,O=null,F=null;const y=R.AC.Dot(Y[B].position,b)-C>0,S=R.AC.Dot(Y[B+1].position,b)-C>0,n=R.AC.Dot(Y[B+2].position,b)-C>0;switch(q=(y?1:0)+(S?1:0)+(n?1:0),q){case 0:Y.length>3?(E.push(Y[B]),E.push(Y[B+1]),E.push(Y[B+2])):E=Y;break;case 1:if(E=E??new Array,y&&(g=Y[B+1],r=Y[B+2],O=A(Y[B],g),F=A(Y[B],r)),S){g=Y[B],r=Y[B+2],O=A(Y[B+1],g),F=A(Y[B+1],r),E.push(O),E.push(r.clone()),E.push(g.clone()),E.push(r.clone()),E.push(O.clone()),E.push(F);break}n&&(g=Y[B],r=Y[B+1],O=A(Y[B+2],g),F=A(Y[B+2],r)),g&&r&&O&&F&&(E.push(g.clone()),E.push(r.clone()),E.push(O),E.push(F),E.push(O.clone()),E.push(r.clone()));break;case 2:E=E??new Array,y||(g=Y[B].clone(),r=A(g,Y[B+1]),O=A(g,Y[B+2]),E.push(g),E.push(r),E.push(O)),S||(g=Y[B+1].clone(),r=A(g,Y[B+2]),O=A(g,Y[B]),E.push(g),E.push(r),E.push(O)),n||(g=Y[B+2].clone(),r=A(g,Y[B]),O=A(g,Y[B+1]),E.push(g),E.push(r),E.push(O))}}return E},H=b instanceof q.d?b:null,i=null===H||void 0===H?void 0:H._thinInstanceDataStorage.matrixData,M=(null===H||void 0===H?void 0:H.Hb)||1,K=R.TmpVectors.Matrix[0];K.q(R.Matrix.IdentityReadOnly);for(let q=0;q<M;++q){if(null!==H&&void 0!==H&&H.hasThinInstances&&i){const Y=16*q;K.setRowFromFloats(0,i[Y+0],i[Y+1],i[Y+2],i[Y+3]),K.setRowFromFloats(1,i[Y+4],i[Y+5],i[Y+6],i[Y+7]),K.setRowFromFloats(2,i[Y+8],i[Y+9],i[Y+10],i[Y+11]),K.setRowFromFloats(3,i[Y+12],i[Y+13],i[Y+14],i[Y+15])}const Y=R.Matrix.RotationYawPitchRoll(v,J,P).multiply(R.Matrix.Translation(X.x,X.y,X.z)),A=R.Matrix.Invert(Y),E=b.getWorldMatrix(),g=K.multiply(E).multiply(A),r=new Array(3);for(let b=0;b<I.length;b+=3){let Y=r;if(Y[0]=G(b,g),Y[1]=G(b+1,g),Y[2]=G(b+2,g),!(C.cullBackFaces&&-Y[0].normal.z<=0&&-Y[1].normal.z<=0&&-Y[2].normal.z<=0)&&(Y=e(Y,s),Y&&(Y=e(Y,D),Y&&(Y=e(Y,d),Y&&(Y=e(Y,V),Y&&(Y=e(Y,k),Y&&(Y=e(Y,x),Y)))))))for(let b=0;b<Y.length;b++){const R=Y[b];if(U.indices.push(o),t?(R.localPositionOverride?(U.lY[3*o]=R.localPositionOverride[0],U.lY[3*o+1]=R.localPositionOverride[1],U.lY[3*o+2]=R.localPositionOverride[2]):N&&(U.lY[3*o]=N[R.vertexIdx],U.lY[3*o+1]=N[R.vertexIdx+1],U.lY[3*o+2]=N[R.vertexIdx+2]),R.localNormalOverride?(U.XY[3*o]=R.localNormalOverride[0],U.XY[3*o+1]=R.localNormalOverride[1],U.XY[3*o+2]=R.localNormalOverride[2]):p&&(U.XY[3*o]=p[R.vertexIdx],U.XY[3*o+1]=p[R.vertexIdx+1],U.XY[3*o+2]=p[R.vertexIdx+2])):(R.position.toArray(U.lY,3*o),R.normal.toArray(U.XY,3*o)),U.matricesIndices&&U.matricesWeights&&(R.matrixIndicesOverride?(U.matricesIndices[4*o]=R.matrixIndicesOverride[0],U.matricesIndices[4*o+1]=R.matrixIndicesOverride[1],U.matricesIndices[4*o+2]=R.matrixIndicesOverride[2],U.matricesIndices[4*o+3]=R.matrixIndicesOverride[3]):(L&&(U.matricesIndices[4*o]=L[R.vertexIdxForBones],U.matricesIndices[4*o+1]=L[R.vertexIdxForBones+1],U.matricesIndices[4*o+2]=L[R.vertexIdxForBones+2],U.matricesIndices[4*o+3]=L[R.vertexIdxForBones+3]),c&&U.matricesIndicesExtra&&(U.matricesIndicesExtra[4*o]=c[R.vertexIdxForBones],U.matricesIndicesExtra[4*o+1]=c[R.vertexIdxForBones+1],U.matricesIndicesExtra[4*o+2]=c[R.vertexIdxForBones+2],U.matricesIndicesExtra[4*o+3]=c[R.vertexIdxForBones+3])),R.matrixWeightsOverride?(U.matricesWeights[4*o]=R.matrixWeightsOverride[0],U.matricesWeights[4*o+1]=R.matrixWeightsOverride[1],U.matricesWeights[4*o+2]=R.matrixWeightsOverride[2],U.matricesWeights[4*o+3]=R.matrixWeightsOverride[3]):(u&&(U.matricesWeights[4*o]=u[R.vertexIdxForBones],U.matricesWeights[4*o+1]=u[R.vertexIdxForBones+1],U.matricesWeights[4*o+2]=u[R.vertexIdxForBones+2],U.matricesWeights[4*o+3]=u[R.vertexIdxForBones+3]),l&&U.matricesWeightsExtra&&(U.matricesWeightsExtra[4*o]=l[R.vertexIdxForBones],U.matricesWeightsExtra[4*o+1]=l[R.vertexIdxForBones+1],U.matricesWeightsExtra[4*o+2]=l[R.vertexIdxForBones+2],U.matricesWeightsExtra[4*o+3]=l[R.vertexIdxForBones+3]))),C.captureUVS)R.uv.toArray(U.TY,2*o);else{U.TY.push(.5+R.position.x/T.x);const Y=.5+R.position.y/T.y;U.TY.push(B.b?1-Y:Y)}o++}}}0===U.indices.length&&(U.indices=null),0===U.lY.length&&(U.lY=null),0===U.XY.length&&(U.XY=null),0===U.TY.length&&(U.TY=null),0===(null===(r=U.matricesIndices)||void 0===r?void 0:r.length)&&(U.matricesIndices=null),0===(null===(O=U.matricesWeights)||void 0===O?void 0:O.length)&&(U.matricesWeights=null),0===(null===(F=U.matricesIndicesExtra)||void 0===F?void 0:F.length)&&(U.matricesIndicesExtra=null),0===(null===(y=U.matricesWeightsExtra)||void 0===y?void 0:y.length)&&(U.matricesWeightsExtra=null);const f=new q.d(Y,b.uY());return U.vY(f),t?(f.skeleton=b.skeleton,f.parent=b):(f.position=X.clone(),f.rotation=new R.AC(J,v,P)),f.Tb(!0),f.refreshBoundingInfo(!0,!0),f}function K(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const b=0|Math.max(Y.subdivisions?Y.subdivisions:2,1),C=0|Math.max(Y.tessellation?Y.tessellation:16,3),q=Math.max(Y.height?Y.height:1,0),A=Math.max(Y.radius?Y.radius:.25,0),g=0|Math.max(Y.capSubdivisions?Y.capSubdivisions:6,1),r=C,O=b,F=Math.max(Y.radiusTop?Y.radiusTop:A,0),y=Math.max(Y.radiusBottom?Y.radiusBottom:A,0),S=q-(F+y),n=2*Math.PI,t=Math.max(Y.topCapSubdivisions?Y.topCapSubdivisions:g,1),I=Math.max(Y.bottomCapSubdivisions?Y.bottomCapSubdivisions:g,1),w=Math.acos((y-F)/q);let Q=[];const N=[],p=[],mY=[];let L=0;const u=[],c=.5*S,l=.5*Math.PI;let X,j;const T=R.AC.Zero(),P=R.AC.Zero(),v=Math.cos(w),z=Math.sin(w),J=new R.Vector2(F*z,c+F*v).EC(new R.Vector2(y*z,y*v-c)).length(),U=F*w+J+y*(l-w);let o=0;for(j=0;j<=t;j++){const Y=[],b=l-w*(j/t);o+=F*w/t;const C=Math.cos(b),R=Math.sin(b),q=C*F;for(X=0;X<=r;X++){const b=X/r,A=b*n+0,E=Math.sin(A),g=Math.cos(A);P.x=q*E,P.y=c+R*F,P.z=q*g,N.push(P.x,P.y,P.z),T.set(C*E,R,C*g),p.push(T.x,T.y,T.z),mY.push(b,B.b?o/U:1-o/U),Y.push(L),L++}u.push(Y)}const G=q-F-y+v*F-v*y,h=z*(y-F)/G;for(j=1;j<=O;j++){const Y=[];o+=J/O;const b=z*(j*(y-F)/O+F);for(X=0;X<=r;X++){const C=X/r,R=C*n+0,q=Math.sin(R),A=Math.cos(R);P.x=b*q,P.y=c+v*F-j*G/O,P.z=b*A,N.push(P.x,P.y,P.z),T.set(q,h,A).normalize(),p.push(T.x,T.y,T.z),mY.push(C,B.b?o/U:1-o/U),Y.push(L),L++}u.push(Y)}for(j=1;j<=I;j++){const Y=[],b=l-w-(Math.PI-w)*(j/I);o+=y*w/I;const C=Math.cos(b),R=Math.sin(b),q=C*y;for(X=0;X<=r;X++){const b=X/r,A=b*n+0,E=Math.sin(A),g=Math.cos(A);P.x=q*E,P.y=R*y-c,P.z=q*g,N.push(P.x,P.y,P.z),T.set(C*E,R,C*g),p.push(T.x,T.y,T.z),mY.push(b,B.b?o/U:1-o/U),Y.push(L),L++}u.push(Y)}for(X=0;X<r;X++)for(j=0;j<t+O+I;j++){const Y=u[j][X],b=u[j+1][X],C=u[j+1][X+1],R=u[j][X+1];Q.push(Y),Q.push(b),Q.push(R),Q.push(b),Q.push(C),Q.push(R)}if(Q=Q.reverse(),Y.orientation&&!Y.orientation.equals(R.AC.Up())){const b=new R.Matrix;Y.orientation.clone().scale(.5*Math.PI).cross(R.AC.Up()).toQuaternion().toRotationMatrix(b);const C=R.AC.Zero();for(let Y=0;Y<N.length;Y+=3)C.set(N[Y],N[Y+1],N[Y+2]),R.AC.TransformCoordinatesToRef(C.clone(),b,C),N[Y]=C.x,N[Y+1]=C.y,N[Y+2]=C.z}const e=new E.e;return e.lY=N,e.XY=p,e.TY=mY,e.indices=Q,e}function f(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:R.AC.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new q.d(Y,C);return K(b).vY(A,b.updatable),A}q.d.CreateDecal=(Y,b,C,R,q,A)=>M(Y,b,{position:C,normal:R,size:q,angle:A});q.d.CreateCapsule=(Y,b,C)=>f(Y,b,C),E.e.CreateCapsule=K;var Z=C(12669),YY=C(12837);class bY{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=Y,this.y=b,Y!==Math.floor(Y)&&(Y=Math.floor(Y),Z.e.Warn("x is not an integer, floor(x) used")),b!==Math.floor(b)&&(b=Math.floor(b),Z.e.Warn("y is not an integer, floor(y) used"))}clone(){return new bY(this.x,this.y)}rotate60About(Y){const b=this.x;return this.x=Y.x+Y.y-this.y,this.y=b+this.y-Y.x,this}rotateNeg60About(Y){const b=this.x;return this.x=b+this.y-Y.y,this.y=Y.x+Y.y-b,this}rotate120(Y,b){Y!==Math.floor(Y)&&(Y=Math.floor(Y),Z.e.Warn("m not an integer only floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),Z.e.Warn("n not an integer only floor(n) used"));const C=this.x;return this.x=Y-C-this.y,this.y=b+C,this}rotateNeg120(Y,b){Y!==Math.floor(Y)&&(Y=Math.floor(Y),Z.e.Warn("m is not an integer, floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),Z.e.Warn("n is not an integer,   floor(n) used"));const C=this.x;return this.x=this.y-b,this.y=Y+b-C-this.y,this}toCartesianOrigin(Y,b){const C=R.AC.Zero();return C.x=Y.x+2*this.x*b+this.y*b,C.y=Y.y+Math.sqrt(3)*this.y*b,C}static Zero(){return new bY(0,0)}}class CY{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new RY("icosahedron","Regular",[[0,YY.h,-1],[-YY.h,1,0],[-1,0,-YY.h],[1,0,-YY.h],[YY.h,1,0],[0,YY.h,1],[-1,0,YY.h],[-YY.h,-1,0],[0,-YY.h,-1],[YY.h,-1,0],[1,0,YY.h],[0,-YY.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let Y=12;const b={},C=this.m,R=this.n;let q,A,E,B,g,r=C,O=1,F=0;0!==R&&(r=(0,W.HighestCommonFactor)(C,R)),O=C/r,F=R/r;const y=bY.Zero(),S=new bY(C,R),n=new bY(-R,C+R),t=bY.Zero(),I=bY.Zero(),w=bY.Zero();let Q,N,p,mY,L=[];const u=[],c=this.vertByDist,l=(C,R,q,A)=>{Q=C+"|"+q,N=R+"|"+A,Q in b||N in b?Q in b&&!(N in b)?b[N]=b[Q]:N in b&&!(Q in b)&&(b[Q]=b[N]):(b[Q]=Y,b[N]=Y,Y++),c[q][0]>2?u[b[Q]]=[-c[q][0],c[q][1],b[Q]]:u[b[Q]]=[L[c[q][0]],c[q][1],b[Q]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let X=0;X<20;X++){if(L=this.IDATA.face[X],E=L[2],B=L[1],g=L[0],p=y.x+"|"+y.y,Q=X+"|"+p,Q in b||(b[Q]=E,u[E]=[L[c[p][0]],c[p][1]]),p=S.x+"|"+S.y,Q=X+"|"+p,Q in b||(b[Q]=B,u[B]=[L[c[p][0]],c[p][1]]),p=n.x+"|"+n.y,Q=X+"|"+p,Q in b||(b[Q]=g,u[g]=[L[c[p][0]],c[p][1]]),q=this.IDATA.edgematch[X][0],A=this.IDATA.edgematch[X][1],"B"===A)for(let Y=1;Y<r;Y++)I.x=C-Y*(O+F),I.y=R+Y*O,w.x=-Y*F,w.y=Y*(O+F),p=I.x+"|"+I.y,mY=w.x+"|"+w.y,l(X,q,p,mY);if("O"===A)for(let Y=1;Y<r;Y++)w.x=-Y*F,w.y=Y*(O+F),t.x=Y*O,t.y=Y*F,p=w.x+"|"+w.y,mY=t.x+"|"+t.y,l(X,q,p,mY);if(q=this.IDATA.edgematch[X][2],A=this.IDATA.edgematch[X][3],A&&"A"===A)for(let Y=1;Y<r;Y++)t.x=Y*O,t.y=Y*F,I.x=C-(r-Y)*(O+F),I.y=R+(r-Y)*O,p=t.x+"|"+t.y,mY=I.x+"|"+I.y,l(X,q,p,mY);for(let C=0;C<this.vertices.length;C++)p=this.vertices[C].x+"|"+this.vertices[C].y,Q=X+"|"+p,Q in b||(b[Q]=Y++,c[p][0]>2?u[b[Q]]=[-c[p][0],c[p][1],b[Q]]:u[b[Q]]=[L[c[p][0]],c[p][1],b[Q]])}this.closestTo=u,this.vecToidx=b}calcCoeffs(){const Y=this.m,b=this.n,C=Math.sqrt(3)/3,R=Y*Y+b*b+Y*b;this.coau=(Y+b)/R,this.cobu=-b/R,this.coav=-C*(Y-b)/R,this.cobv=C*(2*Y+b)/R}createInnerFacets(){const Y=this.m,b=this.n;for(let C=0;C<b+Y+1;C++)for(let Y=this.min[C];Y<this.max[C]+1;Y++)Y<this.max[C]&&Y<this.max[C+1]+1&&this.innerFacets.push(["|"+Y+"|"+C,"|"+Y+"|"+(C+1),"|"+(Y+1)+"|"+C]),C>0&&Y<this.max[C-1]&&Y+1<this.max[C]+1&&this.innerFacets.push(["|"+Y+"|"+C,"|"+(Y+1)+"|"+C,"|"+(Y+1)+"|"+(C-1)])}edgeVecsABOB(){const Y=this.m,b=this.n,C=new bY(-b,Y+b);for(let R=1;R<Y+b;R++){const Y=new bY(this.min[R],R),b=new bY(this.min[R-1],R-1),q=new bY(this.min[R+1],R+1),A=Y.clone(),E=b.clone(),B=q.clone();A.rotate60About(C),E.rotate60About(C),B.rotate60About(C);const g=new bY(this.max[A.y],A.y),r=new bY(this.max[A.y-1],A.y-1),O=new bY(this.max[A.y-1]-1,A.y-1);A.x===g.x&&A.y===g.y||(A.x!==r.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Y,r,O]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Y,O,g])):A.y===B.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Y,b,r]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([Y,r,q])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Y,b,r]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Y,r,g])))}}mapABOBtoOBOA(){const Y=new bY(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const C=[];for(let R=0;R<3;R++)Y.x=this.isoVecsABOB[b][R].x,Y.y=this.isoVecsABOB[b][R].y,0===this.vertexTypes[b][R]&&Y.rotateNeg120(this.m,this.n),C.push(Y.clone());this.isoVecsOBOA.push(C)}}mapABOBtoBAOA(){const Y=new bY(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const C=[];for(let R=0;R<3;R++)Y.x=this.isoVecsABOB[b][R].x,Y.y=this.isoVecsABOB[b][R].y,1===this.vertexTypes[b][R]&&Y.rotate120(this.m,this.n),C.push(Y.clone());this.isoVecsBAOA.push(C)}}MapToFace(Y,b){const C=this.IDATA.face[Y],q=C[2],A=C[1],E=C[0],B=R.AC.OC(this.IDATA.vertex[q]),g=R.AC.OC(this.IDATA.vertex[A]),r=R.AC.OC(this.IDATA.vertex[E]),O=g.EC(B),F=r.EC(B),y=O.scale(this.coau).add(F.scale(this.cobu)),S=O.scale(this.coav).add(F.scale(this.cobv)),n=[];let t,I=R.TmpVectors.AC[0];for(let R=0;R<this.cartesian.length;R++)I=y.scale(this.cartesian[R].x).add(S.scale(this.cartesian[R].y)).add(B),n[R]=[I.x,I.y,I.z],t=Y+"|"+this.vertices[R].x+"|"+this.vertices[R].y,b.vertex[this.vecToidx[t]]=[I.x,I.y,I.z]}build(Y,b){const C=[],R=bY.Zero(),q=new bY(Y,b),A=new bY(-b,Y+b);C.push(R,q,A);for(let p=b;p<Y+1;p++)for(let b=0;b<Y+1-p;b++)C.push(new bY(b,p));if(b>0){const R=(0,W.HighestCommonFactor)(Y,b),q=Y/R,A=b/R;for(let B=1;B<R;B++)C.push(new bY(B*q,B*A)),C.push(new bY(-B*A,B*(q+A))),C.push(new bY(Y-B*(q+A),b+B*q));const E=Y/b;for(let B=1;B<b;B++)for(let R=0;R<B*E;R++)C.push(new bY(R,B)),C.push(new bY(R,B).rotate120(Y,b)),C.push(new bY(R,B).rotateNeg120(Y,b))}C.sort(((Y,b)=>Y.x-b.x)),C.sort(((Y,b)=>Y.y-b.y));const E=new Array(Y+b+1),B=new Array(Y+b+1);for(let p=0;p<E.length;p++)E[p]=1/0,B[p]=-1/0;let g=0,r=0;const O=C.length;for(let p=0;p<O;p++)r=C[p].x,g=C[p].y,E[g]=Math.min(r,E[g]),B[g]=Math.max(r,B[g]);const F=(C,R)=>{const q=C.clone();return"A"===R&&q.rotateNeg120(Y,b),"B"===R&&q.rotate120(Y,b),q.x<0?q.y:q.x+q.y},y=[],S=[],n=[],t=[],I={},w=[];let Q=-1,N=-1;for(let p=0;p<O;p++)y[p]=C[p].toCartesianOrigin(new bY(0,0),.5),S[p]=F(C[p],"O"),n[p]=F(C[p],"A"),t[p]=F(C[p],"B"),S[p]===n[p]&&n[p]===t[p]?(Q=3,N=S[p]):S[p]===n[p]?(Q=4,N=S[p]):n[p]===t[p]?(Q=5,N=n[p]):t[p]===S[p]&&(Q=6,N=S[p]),S[p]<n[p]&&S[p]<t[p]&&(Q=2,N=S[p]),n[p]<S[p]&&n[p]<t[p]&&(Q=1,N=n[p]),t[p]<n[p]&&t[p]<S[p]&&(Q=0,N=t[p]),w.push([Q,N,C[p].x,C[p].y]);w.sort(((Y,b)=>Y[2]-b[2])),w.sort(((Y,b)=>Y[3]-b[3])),w.sort(((Y,b)=>Y[1]-b[1])),w.sort(((Y,b)=>Y[0]-b[0]));for(let p=0;p<w.length;p++)I[w[p][2]+"|"+w[p][3]]=[w[p][0],w[p][1],p];return this.m=Y,this.n=b,this.vertices=C,this.vertByDist=I,this.cartesian=y,this.min=E,this.max=B,this}}class RY{constructor(Y,b,C,R){this.name=Y,this.category=b,this.vertex=C,this.face=R}}class qY extends RY{innerToData(Y,b){for(let C=0;C<b.innerFacets.length;C++)this.face.push(b.innerFacets[C].map((C=>b.vecToidx[Y+C])))}mapABOBtoDATA(Y,b){const C=b.IDATA.edgematch[Y][0];for(let R=0;R<b.isoVecsABOB.length;R++){const q=[];for(let A=0;A<3;A++)0===b.vertexTypes[R][A]?q.push(Y+"|"+b.isoVecsABOB[R][A].x+"|"+b.isoVecsABOB[R][A].y):q.push(C+"|"+b.isoVecsABOB[R][A].x+"|"+b.isoVecsABOB[R][A].y);this.face.push([b.vecToidx[q[0]],b.vecToidx[q[1]],b.vecToidx[q[2]]])}}mapOBOAtoDATA(Y,b){const C=b.IDATA.edgematch[Y][0];for(let R=0;R<b.isoVecsOBOA.length;R++){const q=[];for(let A=0;A<3;A++)1===b.vertexTypes[R][A]?q.push(Y+"|"+b.isoVecsOBOA[R][A].x+"|"+b.isoVecsOBOA[R][A].y):q.push(C+"|"+b.isoVecsOBOA[R][A].x+"|"+b.isoVecsOBOA[R][A].y);this.face.push([b.vecToidx[q[0]],b.vecToidx[q[1]],b.vecToidx[q[2]]])}}mapBAOAtoDATA(Y,b){const C=b.IDATA.edgematch[Y][2];for(let R=0;R<b.isoVecsBAOA.length;R++){const q=[];for(let A=0;A<3;A++)1===b.vertexTypes[R][A]?q.push(Y+"|"+b.isoVecsBAOA[R][A].x+"|"+b.isoVecsBAOA[R][A].y):q.push(C+"|"+b.isoVecsBAOA[R][A].x+"|"+b.isoVecsBAOA[R][A].y);this.face.push([b.vecToidx[q[0]],b.vecToidx[q[1]],b.vecToidx[q[2]]])}}orderData(Y){const b=[];for(let A=0;A<13;A++)b[A]=[];const C=Y.closestTo;for(let A=0;A<C.length;A++)C[A][0]>-1?C[A][1]>0&&b[C[A][0]].push([A,C[A][1]]):b[12].push([A,C[A][0]]);const R=[];for(let A=0;A<12;A++)R[A]=A;let q=12;for(let A=0;A<12;A++){b[A].sort(((Y,b)=>Y[1]-b[1]));for(let Y=0;Y<b[A].length;Y++)R[b[A][Y][0]]=q++}for(let A=0;A<b[12].length;A++)R[b[12][A][0]]=q++;for(let A=0;A<this.vertex.length;A++)this.vertex[A].push(R[A]);this.vertex.sort(((Y,b)=>Y[3]-b[3]));for(let A=0;A<this.vertex.length;A++)this.vertex[A].pop();for(let A=0;A<this.face.length;A++)for(let Y=0;Y<this.face[A].length;Y++)this.face[A][Y]=R[this.face[A][Y]];this.sharedNodes=b[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(Y,b){const C=[],R=[];let q=b.pop();R.push(q);let A=this.face[q].indexOf(Y);A=(A+2)%3;let E=this.face[q][A];C.push(E);let B=0;for(;b.length>0;)q=b[B],this.face[q].indexOf(E)>-1?(A=(this.face[q].indexOf(E)+1)%3,E=this.face[q][A],C.push(E),R.push(q),b.splice(B,1),B=0):B++;return this.adjacentFaces.push(C),R}toGoldbergPolyhedronData(){const Y=new RY("GeoDual","Goldberg",[],[]);Y.name="GD dual";const b=this.vertex.length,C=new Array(b);for(let g=0;g<b;g++)C[g]=[];for(let g=0;g<this.face.length;g++)for(let Y=0;Y<3;Y++)C[this.face[g][Y]].push(g);let R=0,q=0,A=0,E=[],B=[];this.adjacentFaces=[];for(let g=0;g<C.length;g++){Y.face[g]=this.setOrder(g,C[g].concat([]));for(const b of C[g]){R=0,q=0,A=0,E=this.face[b];for(let Y=0;Y<3;Y++)B=this.vertex[E[Y]],R+=B[0],q+=B[1],A+=B[2];Y.vertex[b]=[R/3,q/3,A/3]}}return Y}static BuildGeodesicData(Y){const b=new qY("Geodesic-m-n","Geodesic",[[0,YY.h,-1],[-YY.h,1,0],[-1,0,-YY.h],[1,0,-YY.h],[YY.h,1,0],[0,YY.h,1],[-1,0,YY.h],[-YY.h,-1,0],[0,-YY.h,-1],[YY.h,-1,0],[1,0,YY.h],[0,-YY.h,1]],[]);Y.setIndices(),Y.calcCoeffs(),Y.createInnerFacets(),Y.edgeVecsABOB(),Y.mapABOBtoOBOA(),Y.mapABOBtoBAOA();for(let C=0;C<Y.IDATA.face.length;C++)Y.MapToFace(C,b),b.innerToData(C,Y),"B"===Y.IDATA.edgematch[C][1]&&b.mapABOBtoDATA(C,Y),"O"===Y.IDATA.edgematch[C][1]&&b.mapOBOAtoDATA(C,Y),"A"===Y.IDATA.edgematch[C][3]&&b.mapBAOAtoDATA(C,Y);b.orderData(Y);return b.vertex=b.vertex.map((function(Y){const b=Y[0],C=Y[1],R=Y[2],q=Math.sqrt(b*b+C*C+R*R);return Y[0]*=1/q,Y[1]*=1/q,Y[2]*=1/q,Y})),b}}q.d._GoldbergMeshParser=(Y,b)=>AY.Parse(Y,b);class AY extends q.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(Y,b){return void 0===b?(Y>this.goldbergData.nbUnsharedFaces-1&&(Z.e.Warn("Maximum number of unshared faces used"),Y=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+Y):(Y>11&&(Z.e.Warn("Last pole used"),Y=11),b>this.goldbergData.nbFacesAtPole-1&&(Z.e.Warn("Maximum number of faces at a pole used"),b=this.goldbergData.nbFacesAtPole-1),12+Y*this.goldbergData.nbFacesAtPole+b)}_changeGoldbergFaceColors(Y){for(let C=0;C<Y.length;C++){const b=Y[C][0],R=Y[C][1],q=Y[C][2];for(let Y=b;Y<R+1;Y++)this.goldbergData.faceColors[Y]=q}const b=[];for(let C=0;C<12;C++)for(let Y=0;Y<5;Y++)b.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);for(let C=12;C<this.goldbergData.faceColors.length;C++)for(let Y=0;Y<6;Y++)b.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);return b}setGoldbergFaceColors(Y){const b=this._changeGoldbergFaceColors(Y);this.oY(A.e.ColorKind,b)}updateGoldbergFaceColors(Y){const b=this._changeGoldbergFaceColors(Y);this.updateVerticesData(A.e.ColorKind,b)}_changeGoldbergFaceUVs(Y){const b=this.getVerticesData(A.e.UVKind);for(let C=0;C<Y.length;C++){const R=Y[C][0],q=Y[C][1],A=Y[C][2],E=Y[C][3],B=Y[C][4],g=[],r=[];let O,F;for(let Y=0;Y<5;Y++)O=A.x+E*Math.cos(B+Y*Math.PI/2.5),F=A.y+E*Math.sin(B+Y*Math.PI/2.5),O<0&&(O=0),O>1&&(O=1),g.push(O,F);for(let Y=0;Y<6;Y++)O=A.x+E*Math.cos(B+Y*Math.PI/3),F=A.y+E*Math.sin(B+Y*Math.PI/3),O<0&&(O=0),O>1&&(O=1),r.push(O,F);for(let Y=R;Y<Math.min(12,q+1);Y++)for(let C=0;C<5;C++)b[10*Y+2*C]=g[2*C],b[10*Y+2*C+1]=g[2*C+1];for(let Y=Math.max(12,R);Y<q+1;Y++)for(let C=0;C<6;C++)b[12*Y-24+2*C]=r[2*C],b[12*Y-23+2*C]=r[2*C+1]}return b}setGoldbergFaceUVs(Y){const b=this._changeGoldbergFaceUVs(Y);this.oY(A.e.UVKind,b)}updateGoldbergFaceUVs(Y){const b=this._changeGoldbergFaceUVs(Y);this.updateVerticesData(A.e.UVKind,b)}placeOnGoldbergFaceAt(Y,b,C){const q=R.AC.RotationFromAxis(this.goldbergData.faceXaxis[b],this.goldbergData.faceYaxis[b],this.goldbergData.faceZaxis[b]);Y.rotation=q,Y.position=this.goldbergData.faceCenters[b].add(this.goldbergData.faceXaxis[b].scale(C.x)).add(this.goldbergData.faceYaxis[b].scale(C.y)).add(this.goldbergData.faceZaxis[b].scale(C.z))}serialize(Y){super.serialize(Y),Y.type="GoldbergMesh";const b={};if(b.adjacentFaces=this.goldbergData.adjacentFaces,b.nbSharedFaces=this.goldbergData.nbSharedFaces,b.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,b.nbFaces=this.goldbergData.nbFaces,b.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){b.faceColors=[];for(const Y of this.goldbergData.faceColors)b.faceColors.push(Y.cb())}if(this.goldbergData.faceCenters){b.faceCenters=[];for(const Y of this.goldbergData.faceCenters)b.faceCenters.push(Y.cb())}if(this.goldbergData.faceZaxis){b.faceZaxis=[];for(const Y of this.goldbergData.faceZaxis)b.faceZaxis.push(Y.cb())}if(this.goldbergData.faceYaxis){b.faceYaxis=[];for(const Y of this.goldbergData.faceYaxis)b.faceYaxis.push(Y.cb())}if(this.goldbergData.faceXaxis){b.faceXaxis=[];for(const Y of this.goldbergData.faceXaxis)b.faceXaxis.push(Y.cb())}Y.goldbergData=b}static Parse(Y,b){const C=Y.goldbergData;C.faceColors=C.faceColors.map((Y=>y.hb.OC(Y))),C.faceCenters=C.faceCenters.map((Y=>R.AC.OC(Y))),C.faceZaxis=C.faceZaxis.map((Y=>R.AC.OC(Y))),C.faceXaxis=C.faceXaxis.map((Y=>R.AC.OC(Y))),C.faceYaxis=C.faceYaxis.map((Y=>R.AC.OC(Y)));const q=new AY(Y.name,b);return q.goldbergData=C,q}}var EY=C(13377);const BY={CreateBox:F.d,CreateTiledBox:I,CreateSphere:w.c,CreateDisc:O.b,CreateIcoSphere:i,CreateRibbon:r,CreateCylinder:mY,CreateTorus:u,CreateTorusKnot:l,CreateLineSystem:X.d,rO:X.e,CreateDashedLines:X.c,ExtrudeShape:P,ExtrudeShapeCustom:v,CreateLathe:J,CreateTiledPlane:n,yO:U.d,CreateGround:o.f,CreateTiledGround:o.i,CreateGroundFromHeightMap:o.b,CreatePolygon:j.e,ExtrudePolygon:j.g,CreateTube:G,CreatePolyhedron:e,CreateGeodesic:function(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=b.m||1;R!==Math.floor(R)&&(R=Math.floor(R),Z.e.Warn("m not an integer only floor(m) used"));let q=b.n||0;if(q!==Math.floor(q)&&(q=Math.floor(q),Z.e.Warn("n not an integer only floor(n) used")),q>R){const Y=q;q=R,R=Y,Z.e.Warn("n > m therefore m and n swapped")}const A=new CY;return A.build(R,q),e(Y,{custom:qY.BuildGeodesicData(A),size:b.size,sizeX:b.sizeX,sizeY:b.sizeY,sizeZ:b.sizeZ,faceUV:b.faceUV,faceColors:b.faceColors,flat:b.flat,updatable:b.updatable,sideOrientation:b.sideOrientation,frontUVs:b.frontUVs,backUVs:b.backUVs},C)},CreateGoldberg:function(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=b.size,g=b.sizeX||A||1,r=b.sizeY||A||1,O=b.sizeZ||A||1;let F=b.m||1;F!==Math.floor(F)&&(F=Math.floor(F),Z.e.Warn("m not an integer only floor(m) used"));let S=b.n||0;if(S!==Math.floor(S)&&(S=Math.floor(S),Z.e.Warn("n not an integer only floor(n) used")),S>F){const Y=S;S=F,F=Y,Z.e.Warn("n > m therefore m and n swapped")}const n=new CY;n.build(F,S);const t=qY.BuildGeodesicData(n),I=t.toGoldbergPolyhedronData(),w=new AY(Y,C);b.sideOrientation=q.d._GetDefaultSideOrientation(b.sideOrientation),w._originalBuilderSideOrientation=b.sideOrientation;(function(Y,b){const C=Y.size,q=Y.sizeX||C||1,A=Y.sizeY||C||1,g=Y.sizeZ||C||1,r=0===Y.sideOrientation?0:Y.sideOrientation||E.e.DEFAULTSIDE,O=[],F=[],y=[],S=[];let n=1/0,t=-1/0,I=1/0,w=-1/0;for(let R=0;R<b.vertex.length;R++)n=Math.min(n,b.vertex[R][0]*q),t=Math.max(t,b.vertex[R][0]*q),I=Math.min(I,b.vertex[R][1]*A),w=Math.max(w,b.vertex[R][1]*A);let Q=0;for(let E=0;E<b.face.length;E++){const Y=b.face[E],C=R.AC.OC(b.vertex[Y[0]]),r=R.AC.OC(b.vertex[Y[2]]),N=R.AC.OC(b.vertex[Y[1]]),p=r.EC(C),mY=N.EC(C),L=R.AC.Cross(mY,p).normalize();for(let R=0;R<Y.length;R++){y.push(L.x,L.y,L.z);const C=b.vertex[Y[R]];O.push(C[0]*q,C[1]*A,C[2]*g);const E=(C[1]*A-I)/(w-I);S.push((C[0]*q-n)/(t-n),B.b?1-E:E)}for(let b=0;b<Y.length-2;b++)F.push(Q,Q+b+2,Q+b+1);Q+=Y.length}E.e._ComputeSides(r,O,F,y,S);const N=new E.e;return N.lY=O,N.indices=F,N.XY=y,N.TY=S,N})(b,I).vY(w,b.updatable),w.goldbergData.nbSharedFaces=t.sharedNodes,w.goldbergData.nbUnsharedFaces=t.poleNodes,w.goldbergData.adjacentFaces=t.adjacentFaces,w.goldbergData.nbFaces=w.goldbergData.nbSharedFaces+w.goldbergData.nbUnsharedFaces,w.goldbergData.nbFacesAtPole=(w.goldbergData.nbUnsharedFaces-12)/12;for(let q=0;q<t.vertex.length;q++)w.goldbergData.faceCenters.push(R.AC.OC(t.vertex[q])),w.goldbergData.faceCenters[q].x*=g,w.goldbergData.faceCenters[q].y*=r,w.goldbergData.faceCenters[q].z*=O,w.goldbergData.faceColors.push(new y.hb(1,1,1,1));for(let q=0;q<I.face.length;q++){const Y=I.face[q],b=R.AC.OC(I.vertex[Y[0]]),C=R.AC.OC(I.vertex[Y[2]]),A=R.AC.OC(I.vertex[Y[1]]),E=C.EC(b),B=A.EC(b),g=R.AC.Cross(B,E).normalize(),r=R.AC.Cross(B,g).normalize();w.goldbergData.faceXaxis.push(B.normalize()),w.goldbergData.faceYaxis.push(g),w.goldbergData.faceZaxis.push(r)}return w},CreateDecal:M,CreateCapsule:f,CreateText:EY.e}},14003:(Y,b,C)=>{"use strict";C.d(b,{d:()=>Bb});var R=C(12831),q=C(13207);class A extends q.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var E=C(12880),B=(C(12995),C(12790));class g{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Y){this._targetStopDuration!==Y&&(this._targetStopDuration=Y)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(Y){this._noiseTexture!==Y&&(this._noiseTexture=Y,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Y){this._animationSheetEnabled!==Y&&(this._animationSheetEnabled=Y)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(Y){this._isAnimationSheetEnabled!=Y&&(this._isAnimationSheetEnabled=Y,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(Y){this._useLogarithmicDepth=Y&&this.uY().getEngine().getCaps().fragmentDepthSupported}uY(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(Y){switch(Y){case g.BLENDMODE_MULTIPLYADD:return;case g.BLENDMODE_ADD:Y=1;break;case g.BLENDMODE_ONEONE:Y=6;break;case g.BLENDMODE_STANDARD:Y=2;break;case g.BLENDMODE_MULTIPLY:Y=4;break;case g.BLENDMODE_SUBTRACT:Y=3}this._engine.setAlphaMode(Y)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:R.AC.Zero()}set direction1(Y){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=Y)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:R.AC.Zero()}set direction2(Y){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=Y)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:R.AC.Zero()}set minEmitBox(Y){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=Y)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:R.AC.Zero()}set maxEmitBox(Y){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=Y)}get billboardMode(){return this._billboardMode}set billboardMode(Y){this._billboardMode!==Y&&(this._billboardMode=Y,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(Y){this._isBillboardBased!==Y&&(this._isBillboardBased=Y,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(Y){this._attachImageProcessingConfiguration(Y)}_attachImageProcessingConfiguration(Y){Y!==this._imageProcessingConfiguration&&(!Y&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=Y)}_reset(){}_removeGradientAndTexture(Y,b,C){if(!b)return this;let R=0;for(const q of b){if(q.gradient===Y){b.splice(R,1);break}R++}return C&&C.dispose(),this}constructor(Y){this.animations=[],this.renderingGroupId=0,this.Rb=R.AC.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new R.AC(10,10,10),this.onAnimationEnd=null,this.blendMode=g.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new R.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.EO=new R.AC(0,0,0),this._useLogarithmicDepth=!1,this.gravity=R.AC.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new E.hb(1,1,1,1),this.color2=new E.hb(1,1,1,1),this.colorDead=new E.hb(0,0,0,1),this.textureMask=new E.hb(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new A,this.id=Y,this.name=Y}createPointEmitter(Y,b){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new R.AC(0,1,0),arguments.length>2&&void 0!==arguments[2]||new R.AC(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new R.AC(0,1,0),arguments.length>4&&void 0!==arguments[4]||new R.AC(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new R.AC(0,1,0),arguments.length>3&&void 0!==arguments[3]||new R.AC(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(Y,b,C,R){throw new Error("Method not implemented.")}}g.BLENDMODE_ONEONE=0,g.BLENDMODE_STANDARD=1,g.BLENDMODE_ADD=2,g.BLENDMODE_MULTIPLY=3,g.BLENDMODE_MULTIPLYADD=4,g.BLENDMODE_SUBTRACT=-1,(0,B.g)("BABYLON.BaseParticleSystem",g);var r=C(12852),O=C(12678);class F{constructor(){this.direction1=new R.AC(0,1,0),this.direction2=new R.AC(0,1,0),this.minEmitBox=new R.AC(-.5,-.5,-.5),this.maxEmitBox=new R.AC(.5,.5,.5)}startDirectionFunction(Y,b,C,q){const A=(0,r.RandomRange)(this.direction1.x,this.direction2.x),E=(0,r.RandomRange)(this.direction1.y,this.direction2.y),B=(0,r.RandomRange)(this.direction1.z,this.direction2.z);if(q)return b.x=A,b.y=E,void(b.z=B);R.AC.TransformNormalFromFloatsToRef(A,E,B,Y,b)}startPositionFunction(Y,b,C,q){const A=(0,r.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),E=(0,r.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),B=(0,r.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(q)return b.x=A,b.y=E,void(b.z=B);R.AC.TransformCoordinatesFromFloatsToRef(A,E,B,Y,b)}clone(){const Y=new F;return O.c.DeepCopy(this,Y),Y}applyToShader(Y){Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2),Y.setVector3("minEmitBox",this.minEmitBox),Y.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(Y){Y.addUniform("direction1",3),Y.addUniform("direction2",3),Y.addUniform("minEmitBox",3),Y.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.direction1=this.direction1.cb(),Y.direction2=this.direction2.cb(),Y.minEmitBox=this.minEmitBox.cb(),Y.maxEmitBox=this.maxEmitBox.cb(),Y}parse(Y){R.AC.FromArrayToRef(Y.direction1,0,this.direction1),R.AC.FromArrayToRef(Y.direction2,0,this.direction2),R.AC.FromArrayToRef(Y.minEmitBox,0,this.minEmitBox),R.AC.FromArrayToRef(Y.maxEmitBox,0,this.maxEmitBox)}}class y{get radius(){return this._radius}set radius(Y){this._radius=Y,this._buildHeight()}get angle(){return this._angle}set angle(Y){this._angle=Y,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=C,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=b,this.radius=Y}startDirectionFunction(Y,b,C,q){q?R.TmpVectors.AC[0].q(C.jg).normalize():C.position.subtractToRef(Y.getTranslation(),R.TmpVectors.AC[0]).normalize();const A=(0,r.RandomRange)(0,this.directionRandomizer),E=(0,r.RandomRange)(0,this.directionRandomizer),B=(0,r.RandomRange)(0,this.directionRandomizer);b.x=R.TmpVectors.AC[0].x+A,b.y=R.TmpVectors.AC[0].y+E,b.z=R.TmpVectors.AC[0].z+B,b.normalize()}startPositionFunction(Y,b,C,q){const A=(0,r.RandomRange)(0,2*Math.PI);let E;this.emitFromSpawnPointOnly?E=1e-4:(E=(0,r.RandomRange)(0,this.heightRange),E=1-E*E);let B=this._radius-(0,r.RandomRange)(0,this._radius*this.radiusRange);B*=E;const g=B*Math.sin(A),O=B*Math.cos(A),F=E*this._height;if(q)return b.x=g,b.y=F,void(b.z=O);R.AC.TransformCoordinatesFromFloatsToRef(g,F,O,Y,b)}clone(){const Y=new y(this._radius,this._angle,this.directionRandomizer);return O.c.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat2("radius",this._radius,this.radiusRange),Y.setFloat("coneAngle",this._angle),Y.setFloat2("height",this._height,this.heightRange),Y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Y){Y.addUniform("radius",2),Y.addUniform("coneAngle",1),Y.addUniform("height",2),Y.addUniform("directionRandomizer",1)}getEffectDefines(){let Y="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(Y+="\n#define CONEEMITTERSPAWNPOINT"),Y}getClassName(){return"ConeParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.radius=this._radius,Y.angle=this._angle,Y.directionRandomizer=this.directionRandomizer,Y.radiusRange=this.radiusRange,Y.heightRange=this.heightRange,Y.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,Y}parse(Y){this.radius=Y.radius,this.angle=Y.angle,this.directionRandomizer=Y.directionRandomizer,this.radiusRange=void 0!==Y.radiusRange?Y.radiusRange:1,this.heightRange=void 0!==Y.radiusRange?Y.heightRange:1,this.emitFromSpawnPointOnly=void 0!==Y.emitFromSpawnPointOnly&&Y.emitFromSpawnPointOnly}}class S extends y{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.AC(0,1,0),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.AC(0,1,0);super(Y,b),this.direction1=C,this.direction2=q}startDirectionFunction(Y,b){const C=(0,r.RandomRange)(this.direction1.x,this.direction2.x),q=(0,r.RandomRange)(this.direction1.y,this.direction2.y),A=(0,r.RandomRange)(this.direction1.z,this.direction2.z);R.AC.TransformNormalFromFloatsToRef(C,q,A,Y,b)}clone(){const Y=new S(this.radius,this.angle,this.direction1,this.direction2);return O.c.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("radiusRange",this.radiusRange),Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("radiusRange",1),Y.addUniform("direction1",3),Y.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const Y=super.serialize();return Y.direction1=this.direction1.cb(),Y.direction2=this.direction2.cb(),Y}parse(Y){super.parse(Y),this.direction1.q(Y.direction1),this.direction2.q(Y.direction2)}}class n{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=Y,this.height=b,this.radiusRange=C,this.directionRandomizer=q,this._tempVector=R.AC.Zero()}startDirectionFunction(Y,b,C,q,A){C.position.subtractToRef(Y.getTranslation(),this._tempVector),this._tempVector.normalize(),R.AC.TransformNormalToRef(this._tempVector,A,this._tempVector);const E=(0,r.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let B=Math.atan2(this._tempVector.x,this._tempVector.z);B+=(0,r.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=E,this._tempVector.x=Math.sin(B),this._tempVector.z=Math.cos(B),this._tempVector.normalize(),q?b.q(this._tempVector):R.AC.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Y,b)}startPositionFunction(Y,b,C,q){const A=(0,r.RandomRange)(-this.height/2,this.height/2),E=(0,r.RandomRange)(0,2*Math.PI),B=(0,r.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),g=Math.sqrt(B)*this.radius,O=g*Math.cos(E),F=g*Math.sin(E);q?b.Ub(O,A,F):R.AC.TransformCoordinatesFromFloatsToRef(O,A,F,Y,b)}clone(){const Y=new n(this.radius,this.directionRandomizer);return O.c.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("height",this.height),Y.setFloat("radiusRange",this.radiusRange),Y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("height",1),Y.addUniform("radiusRange",1),Y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.radius=this.radius,Y.height=this.height,Y.radiusRange=this.radiusRange,Y.directionRandomizer=this.directionRandomizer,Y}parse(Y){this.radius=Y.radius,this.height=Y.height,this.radiusRange=Y.radiusRange,this.directionRandomizer=Y.directionRandomizer}}class t extends n{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.AC(0,1,0),A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new R.AC(0,1,0);super(Y,b,C),this.direction1=q,this.direction2=A}startDirectionFunction(Y,b,C,q){const A=(0,r.RandomRange)(this.direction1.x,this.direction2.x),E=(0,r.RandomRange)(this.direction1.y,this.direction2.y),B=(0,r.RandomRange)(this.direction1.z,this.direction2.z);q?b.Ub(A,E,B):R.AC.TransformNormalFromFloatsToRef(A,E,B,Y,b)}clone(){const Y=new t(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return O.c.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("height",this.height),Y.setFloat("radiusRange",this.radiusRange),Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("height",1),Y.addUniform("radiusRange",1),Y.addUniform("direction1",3),Y.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const Y=super.serialize();return Y.direction1=this.direction1.cb(),Y.direction2=this.direction2.cb(),Y}parse(Y){super.parse(Y),R.AC.FromArrayToRef(Y.direction1,0,this.direction1),R.AC.FromArrayToRef(Y.direction2,0,this.direction2)}}class I{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Y,this.radiusRange=b,this.directionRandomizer=C}startDirectionFunction(Y,b,C,q){const A=C.position.EC(Y.getTranslation()).normalize(),E=(0,r.RandomRange)(0,this.directionRandomizer),B=(0,r.RandomRange)(0,this.directionRandomizer),g=(0,r.RandomRange)(0,this.directionRandomizer);A.x+=E,A.y+=B,A.z+=g,A.normalize(),q?b.q(A):R.AC.TransformNormalFromFloatsToRef(A.x,A.y,A.z,Y,b)}startPositionFunction(Y,b,C,q){const A=this.radius-(0,r.RandomRange)(0,this.radius*this.radiusRange),E=(0,r.RandomRange)(0,1),B=(0,r.RandomRange)(0,2*Math.PI),g=Math.acos(2*E-1),O=A*Math.cos(B)*Math.sin(g),F=A*Math.cos(g),y=A*Math.sin(B)*Math.sin(g);q?b.Ub(O,Math.abs(F),y):R.AC.TransformCoordinatesFromFloatsToRef(O,Math.abs(F),y,Y,b)}clone(){const Y=new I(this.radius,this.directionRandomizer);return O.c.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("radiusRange",this.radiusRange),Y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("radiusRange",1),Y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.radius=this.radius,Y.radiusRange=this.radiusRange,Y.directionRandomizer=this.directionRandomizer,Y}parse(Y){this.radius=Y.radius,this.radiusRange=Y.radiusRange,this.directionRandomizer=Y.directionRandomizer}}class w{constructor(){this.direction1=new R.AC(0,1,0),this.direction2=new R.AC(0,1,0)}startDirectionFunction(Y,b,C,q){const A=(0,r.RandomRange)(this.direction1.x,this.direction2.x),E=(0,r.RandomRange)(this.direction1.y,this.direction2.y),B=(0,r.RandomRange)(this.direction1.z,this.direction2.z);q?b.Ub(A,E,B):R.AC.TransformNormalFromFloatsToRef(A,E,B,Y,b)}startPositionFunction(Y,b,C,q){q?b.Ub(0,0,0):R.AC.TransformCoordinatesFromFloatsToRef(0,0,0,Y,b)}clone(){const Y=new w;return O.c.DeepCopy(this,Y),Y}applyToShader(Y){Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2)}buildUniformLayout(Y){Y.addUniform("direction1",3),Y.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.direction1=this.direction1.cb(),Y.direction2=this.direction2.cb(),Y}parse(Y){R.AC.FromArrayToRef(Y.direction1,0,this.direction1),R.AC.FromArrayToRef(Y.direction2,0,this.direction2)}}class Q{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Y,this.radiusRange=b,this.directionRandomizer=C}startDirectionFunction(Y,b,C,q){const A=C.position.EC(Y.getTranslation()).normalize(),E=(0,r.RandomRange)(0,this.directionRandomizer),B=(0,r.RandomRange)(0,this.directionRandomizer),g=(0,r.RandomRange)(0,this.directionRandomizer);A.x+=E,A.y+=B,A.z+=g,A.normalize(),q?b.q(A):R.AC.TransformNormalFromFloatsToRef(A.x,A.y,A.z,Y,b)}startPositionFunction(Y,b,C,q){const A=this.radius-(0,r.RandomRange)(0,this.radius*this.radiusRange),E=(0,r.RandomRange)(0,1),B=(0,r.RandomRange)(0,2*Math.PI),g=Math.acos(2*E-1),O=A*Math.cos(B)*Math.sin(g),F=A*Math.cos(g),y=A*Math.sin(B)*Math.sin(g);q?b.Ub(O,F,y):R.AC.TransformCoordinatesFromFloatsToRef(O,F,y,Y,b)}clone(){const Y=new Q(this.radius,this.directionRandomizer);return O.c.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("radiusRange",this.radiusRange),Y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("radiusRange",1),Y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.radius=this.radius,Y.radiusRange=this.radiusRange,Y.directionRandomizer=this.directionRandomizer,Y}parse(Y){this.radius=Y.radius,this.radiusRange=Y.radiusRange,this.directionRandomizer=Y.directionRandomizer}}class N extends Q{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R.AC(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.AC(0,1,0);super(Y),this.direction1=b,this.direction2=C}startDirectionFunction(Y,b){const C=(0,r.RandomRange)(this.direction1.x,this.direction2.x),q=(0,r.RandomRange)(this.direction1.y,this.direction2.y),A=(0,r.RandomRange)(this.direction1.z,this.direction2.z);R.AC.TransformNormalFromFloatsToRef(C,q,A,Y,b)}clone(){const Y=new N(this.radius,this.direction1,this.direction2);return O.c.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("radiusRange",this.radiusRange),Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("radiusRange",1),Y.addUniform("direction1",3),Y.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const Y=super.serialize();return Y.direction1=this.direction1.cb(),Y.direction2=this.direction2.cb(),Y}parse(Y){super.parse(Y),this.direction1.q(Y.direction1),this.direction2.q(Y.direction2)}}class p{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(Y,b,C,q){const A=R.TmpVectors.AC[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,C,A);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,C,A);const Y=R.TmpVectors.AC[1];A.subtractToRef(C.position,Y),Y.scaleToRef(1/C.lifeTime,A)}else A.set(0,0,0);q?b.q(A):R.AC.TransformNormalToRef(A,Y,b)}startPositionFunction(Y,b,C,q){const A=R.TmpVectors.AC[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,C,A):A.set(0,0,0),q?b.q(A):R.AC.TransformCoordinatesToRef(A,Y,b)}clone(){const Y=new p;return O.c.DeepCopy(this,Y),Y}applyToShader(Y){}buildUniformLayout(Y){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.particlePositionGenerator=this.particlePositionGenerator,Y.particleDestinationGenerator=this.particleDestinationGenerator,Y}parse(Y){Y.particlePositionGenerator&&(this.particlePositionGenerator=Y.particlePositionGenerator),Y.particleDestinationGenerator&&(this.particleDestinationGenerator=Y.particleDestinationGenerator)}}var mY=C(12903);class L{get mesh(){return this._mesh}set mesh(Y){this._mesh!==Y&&(this._mesh=Y,Y?(this._indices=Y.zb(),this._positions=Y.getVerticesData(mY.e.PositionKind),this._normals=Y.getVerticesData(mY.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=R.AC.Zero(),this._mesh=null,this.direction1=new R.AC(0,1,0),this.direction2=new R.AC(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=Y}startDirectionFunction(Y,b,C,q){if(this.useMeshNormalsForDirection&&this._normals)return void R.AC.TransformNormalToRef(this._storedNormal,Y,b);const A=(0,r.RandomRange)(this.direction1.x,this.direction2.x),E=(0,r.RandomRange)(this.direction1.y,this.direction2.y),B=(0,r.RandomRange)(this.direction1.z,this.direction2.z);q?b.Ub(A,E,B):R.AC.TransformNormalFromFloatsToRef(A,E,B,Y,b)}startPositionFunction(Y,b,C,q){if(!this._indices||!this._positions)return;const A=3*(Math.random()*(this._indices.length/3)|0),E=Math.random(),B=Math.random()*(1-E),g=1-E-B,r=this._indices[A],O=this._indices[A+1],F=this._indices[A+2],y=R.TmpVectors.AC[0],S=R.TmpVectors.AC[1],n=R.TmpVectors.AC[2],t=R.TmpVectors.AC[3];R.AC.FromArrayToRef(this._positions,3*r,y),R.AC.FromArrayToRef(this._positions,3*O,S),R.AC.FromArrayToRef(this._positions,3*F,n),t.x=E*y.x+B*S.x+g*n.x,t.y=E*y.y+B*S.y+g*n.y,t.z=E*y.z+B*S.z+g*n.z,q?b.Ub(t.x,t.y,t.z):R.AC.TransformCoordinatesFromFloatsToRef(t.x,t.y,t.z,Y,b),this.useMeshNormalsForDirection&&this._normals&&(R.AC.FromArrayToRef(this._normals,3*r,y),R.AC.FromArrayToRef(this._normals,3*O,S),R.AC.FromArrayToRef(this._normals,3*F,n),this._storedNormal.x=E*y.x+B*S.x+g*n.x,this._storedNormal.y=E*y.y+B*S.y+g*n.y,this._storedNormal.z=E*y.z+B*S.z+g*n.z)}clone(){const Y=new L(this.mesh);return O.c.DeepCopy(this,Y),Y}applyToShader(Y){Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2)}buildUniformLayout(Y){Y.addUniform("direction1",3),Y.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var Y;const b={};return b.type=this.getClassName(),b.direction1=this.direction1.cb(),b.direction2=this.direction2.cb(),b.meshId=null===(Y=this.mesh)||void 0===Y?void 0:Y.id,b.useMeshNormalsForDirection=this.useMeshNormalsForDirection,b}parse(Y,b){R.AC.FromArrayToRef(Y.direction1,0,this.direction1),R.AC.FromArrayToRef(Y.direction2,0,this.direction2),Y.meshId&&b&&(this.mesh=b.getLastMeshById(Y.meshId)),this.useMeshNormalsForDirection=Y.useMeshNormalsForDirection}}class u{_isUbo(Y){return void 0!==Y.addUniform}constructor(Y){this._isUbo(Y)?(this.setMatrix3x3=Y.updateMatrix3x3.bind(Y),this.setMatrix2x2=Y.updateMatrix2x2.bind(Y),this.setFloat=Y.updateFloat.bind(Y),this.setFloat2=Y.updateFloat2.bind(Y),this.setFloat3=Y.updateFloat3.bind(Y),this.setFloat4=Y.updateFloat4.bind(Y),this.setFloatArray=Y.updateFloatArray.bind(Y),this.setArray=Y.updateArray.bind(Y),this.setIntArray=Y.updateIntArray.bind(Y),this.setMatrix=Y.jb.bind(Y),this.setMatrices=Y.updateMatrices.bind(Y),this.setVector3=Y.updateVector3.bind(Y),this.setVector4=Y.updateVector4.bind(Y),this.setColor3=Y.updateColor3.bind(Y),this.setColor4=Y.updateColor4.bind(Y),this.setDirectColor4=Y.updateDirectColor4.bind(Y),this.setInt=Y.updateInt.bind(Y),this.setInt2=Y.updateInt2.bind(Y),this.setInt3=Y.updateInt3.bind(Y),this.setInt4=Y.updateInt4.bind(Y)):(this.setMatrix3x3=Y.setMatrix3x3.bind(Y),this.setMatrix2x2=Y.setMatrix2x2.bind(Y),this.setFloat=Y.setFloat.bind(Y),this.setFloat2=Y.setFloat2.bind(Y),this.setFloat3=Y.setFloat3.bind(Y),this.setFloat4=Y.setFloat4.bind(Y),this.setFloatArray=Y.setFloatArray.bind(Y),this.setArray=Y.setArray.bind(Y),this.setIntArray=Y.setIntArray.bind(Y),this.setMatrix=Y.setMatrix.bind(Y),this.setMatrices=Y.setMatrices.bind(Y),this.setVector3=Y.setVector3.bind(Y),this.setVector4=Y.setVector4.bind(Y),this.setColor3=Y.setColor3.bind(Y),this.setColor4=Y.setColor4.bind(Y),this.setDirectColor4=Y.setDirectColor4.bind(Y),this.setInt=Y.setInt.bind(Y),this.setInt2=Y.setInt2.bind(Y),this.setInt3=Y.setInt3.bind(Y),this.setInt4=Y.setInt4.bind(Y))}}var c=C(12747);const l="gpuUpdateParticlesPixelShader",X="#version 300 es\nvoid main() {discard;}\n";c.b.ShadersStore[l]||(c.b.ShadersStore[l]=X);const j="gpuUpdateParticlesVertexShader",T="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";c.b.ShadersStore[j]||(c.b.ShadersStore[j]=T);(0,B.g)("BABYLON.WebGL2ParticleSystem",class{constructor(Y,b){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=Y,this._engine=b,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var Y;return(null===(Y=this._updateEffect)||void 0===Y?void 0:Y.isReady())??!1}createUpdateBuffer(Y){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof p&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=Y,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new u(this._updateEffect)}createVertexBuffers(Y,b){this._updateVAO.push(this._createUpdateVAO(Y)),this._renderVAO.push(this._engine.recordVertexArrayObject(b,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=b}createParticleBuffer(Y){return Y}bindDrawBuffers(Y,b,C){C?this._engine.bindBuffers(this._renderVertexBuffers,C,b):this._engine.bindVertexArrayObject(this._renderVAO[Y],null)}preUpdateParticleBuffer(){const Y=this._engine;if(this._engine.enableEffect(this._updateEffect),!Y.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(Y,b,C){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[Y],null);const R=this._engine;R.bindTransformFeedbackBuffer(b.getBuffer()),R.setRasterizerState(!1),R.beginTransformFeedback(!0),R.drawArraysType(3,0,C),R.endTransformFeedback(),R.setRasterizerState(!0),R.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let Y=0;Y<this._updateVAO.length;Y++)this._engine.releaseVertexArrayObject(this._updateVAO[Y]);this._updateVAO.length=0;for(let Y=0;Y<this._renderVAO.length;Y++)this._engine.releaseVertexArrayObject(this._renderVAO[Y]);this._renderVAO.length=0}_createUpdateVAO(Y){const b={};b.position=Y.createVertexBuffer("position",0,3);let C=3;b.age=Y.createVertexBuffer("age",C,1),C+=1,b.size=Y.createVertexBuffer("size",C,3),C+=3,b.life=Y.createVertexBuffer("life",C,1),C+=1,b.seed=Y.createVertexBuffer("seed",C,4),C+=4,b.direction=Y.createVertexBuffer("direction",C,3),C+=3,this._parent.particleEmitterType instanceof p&&(b.initialPosition=Y.createVertexBuffer("initialPosition",C,3),C+=3),this._parent._colorGradientsTexture||(b.color=Y.createVertexBuffer("color",C,4),C+=4),this._parent._isBillboardBased||(b.initialDirection=Y.createVertexBuffer("initialDirection",C,3),C+=3),this._parent.noiseTexture&&(b.noiseCoordinates1=Y.createVertexBuffer("noiseCoordinates1",C,3),C+=3,b.noiseCoordinates2=Y.createVertexBuffer("noiseCoordinates2",C,3),C+=3),this._parent._angularSpeedGradientsTexture?(b.angle=Y.createVertexBuffer("angle",C,1),C+=1):(b.angle=Y.createVertexBuffer("angle",C,2),C+=2),this._parent._isAnimationSheetEnabled&&(b.cellIndex=Y.createVertexBuffer("cellIndex",C,1),C+=1,this._parent.spriteRandomStartCell&&(b.cellStartOffset=Y.createVertexBuffer("cellStartOffset",C,1),C+=1));const R=this._engine.recordVertexArrayObject(b,null,this._updateEffect);return this._engine.bindArrayBuffer(null),R}});class P{constructor(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,R=arguments.length>3?arguments[3]:void 0;this._engine=Y,this._label=R,this._engine._storageBuffers.push(this),this._create(b,C)}_create(Y,b){this._bufferSize=Y,this._creationFlags=b,this._buffer=this._engine.createStorageBuffer(Y,b,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(Y,b,C){this._buffer&&this._engine.updateStorageBuffer(this._buffer,Y,b,C)}async read(Y,b,C,R){return await this._engine.readFromStorageBuffer(this._buffer,Y,b,C,R)}dispose(){const Y=this._engine._storageBuffers,b=Y.indexOf(this);-1!==b&&(Y[b]=Y[Y.length-1],Y.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var v=C(12818),z=C(12821),J=C(12870),U=C(12814),o=C(13119),G=C(12669),h=C(12771),e=C(13050);class H{constructor(){this._gpuTimeInFrameId=-1,this.counter=new e.d}_addDuration(Y,b){Y<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==Y?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(b,!1),this._gpuTimeInFrameId=Y):this.counter.addCount(b,!1))}}var i=C(12726);class W{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=Y,this._engine=b,this.uniqueId=o.b.UniqueId,b.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new H),this._engine.getCaps().supportComputeShaders?R.bindingsMapping?(this._context=b.createComputeContext(),this._shaderPath=C,this._options={bindingsMapping:{},defines:[],...R}):G.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):G.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(Y,b){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const R=this._bindings[Y];this._bindings[Y]={type:C?0:4,object:b,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!R||R.object!==b||R.type!==this._bindings[Y].type)}setStorageTexture(Y,b){const C=this._bindings[Y];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==b),this._bindings[Y]={type:1,object:b,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setExternalTexture(Y,b){const C=this._bindings[Y];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==b),this._bindings[Y]={type:6,object:b,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setVideoTexture(Y,b){return!!b.externalTexture&&(this.setExternalTexture(Y,b.externalTexture),!0)}setUniformBuffer(Y,b){const C=this._bindings[Y];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==b),this._bindings[Y]={type:W._BufferIsDataBuffer(b)?7:2,object:b,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setStorageBuffer(Y,b){const C=this._bindings[Y];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==b),this._bindings[Y]={type:W._BufferIsDataBuffer(b)?7:3,object:b,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setTextureSampler(Y,b){const C=this._bindings[Y];this._contextIsDirty||(this._contextIsDirty=!C||!b.compareSampler(C.object)),this._bindings[Y]={type:5,object:b,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}isReady(){let Y=this._effect;for(const q in this._bindings){const Y=this._bindings[q],b=Y.type,C=Y.object;switch(b){case 0:case 4:case 1:if(!C.isReady())return!1;break;case 6:if(!C.isReady())return!1;break}}const b=[],C=this._shaderPath;if(this._options.defines)for(let q=0;q<this._options.defines.length;q++)b.push(this._options.defines[q]);const R=b.join("\n");return this._cachedDefines!==R&&(this._cachedDefines=R,Y=this._engine.createComputeEffect(C,{defines:R,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=Y),!!Y.isReady()}dispatch(Y,b,C){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,Y,b,C,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const C=W._BufferIsDataBuffer(Y)?Y:Y.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,C,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const b in this._bindings){const C=this._bindings[b];if(!this._options.bindingsMapping[b])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+b+"'");switch(C.type){case 0:{const R=this._samplers[b],q=C.object;var Y;if(!R||!q._texture||!R.compareSampler(q._texture))this._samplers[b]=(new h.d).setParameters(q.wrapU,q.wrapV,q.wrapR,q.anisotropicFilteringLevel,q._texture.samplingMode,null===(Y=q._texture)||void 0===Y?void 0:Y._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const Y=C.object;Y.getBuffer()!==C.buffer&&(C.buffer=Y.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((q=>{(0,i.g)((()=>this.dispatch(Y,b,C)),q,void 0,R)}))}serialize(){const Y=J.e.Serialize(this);Y.options=this._options,Y.shaderPath=this._shaderPath,Y.RS={},Y.textures={};for(const b in this._bindings){const C=this._bindings[b],R=C.object;switch(C.type){case 0:case 4:case 1:{const q=R.serialize();q&&(Y.textures[b]=q,Y.RS[b]={type:C.type});break}}}return Y}static Parse(Y,b,C){const R=J.e.Parse((()=>new W(Y.name,b.getEngine(),Y.shaderPath,Y.options)),Y,b,C);for(const q in Y.textures){const A=Y.RS[q],E=U.b.Parse(Y.textures[q],b,C);0===A.type?R.setTexture(q,E):4===A.type?R.setTexture(q,E,!1):R.setStorageTexture(q,E)}return R}static _BufferIsDataBuffer(Y){return void 0!==Y.underlyingResource}}(0,v.c)([(0,z.K)()],W.prototype,"name",void 0),(0,v.c)([(0,z.K)()],W.prototype,"fastMode",void 0),(0,B.g)("BABYLON.ComputeShader",W);var s=C(13091);const D="gpuUpdateParticlesComputeShader",d="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";c.b.ShadersStoreWGSL[D]||(c.b.ShadersStoreWGSL[D]=d);(0,B.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(Y,b){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=Y,this._engine=b}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var Y;return(null===(Y=this._updateComputeShader)||void 0===Y?void 0:Y.isReady())??!1}createUpdateBuffer(Y){var b;const C={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(C.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(C.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(C.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(C.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(C.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(C.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(C.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new W("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:C,defines:Y.split("\n")}),null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=new s.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new u(this._simParamsComputeShader)}createVertexBuffers(Y,b){this._renderVertexBuffers.push(b)}createParticleBuffer(Y){const b=new P(this._engine,4*Y.length,11,"ComputeShaderParticleSystemBuffer");return b.update(Y),this._bufferComputeShader.push(b),b.getBuffer()}bindDrawBuffers(Y,b,C){this._engine.bindBuffers(this._renderVertexBuffers[Y],C,b)}preUpdateParticleBuffer(){}updateParticleBuffer(Y,b,C){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[Y]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^Y]),this._updateComputeShader.dispatch(Math.ceil(C/64))}releaseBuffers(){var Y;for(let b=0;b<this._bufferComputeShader.length;++b)this._bufferComputeShader[b].dispose();this._bufferComputeShader.length=0,null===(Y=this._simParamsComputeShader)||void 0===Y||Y.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class V{constructor(Y,b,C){this.gradient=Y,this.color1=b,this.color2=C}getColorToRef(Y){this.color2?E.hb.LerpToRef(this.color1,this.color2,Math.random(),Y):Y.q(this.color1)}}class k{constructor(Y,b){this.gradient=Y,this.color=b}}class x{constructor(Y,b,C){this.gradient=Y,this.factor1=b,this.factor2=C}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class a{static GetCurrentGradient(Y,b,C){if(b[0].gradient>Y)return void C(b[0],b[0],1);for(let q=0;q<b.length-1;q++){const R=b[q],A=b[q+1];if(Y>=R.gradient&&Y<=A.gradient){return void C(R,A,(Y-R.gradient)/(A.gradient-R.gradient))}}const R=b.length-1;C(b[R],b[R],1)}}var M=C(12652),K=C(13307),f=C(12702);class Z{constructor(Y){this.particleSystem=Y,this.position=R.AC.Zero(),this.direction=R.AC.Zero(),this.color=new E.hb(0,0,0,0),this.colorStep=new E.hb(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new R.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new E.hb(0,0,0,0),this._currentColor2=new E.hb(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=Z._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let Y=this.age,b=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===b?(b=1,Y=this._randomCellOffset):Y+=this._randomCellOffset);const C=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let R;R=this._initialSpriteCellLoop?(0,r.Clamp)(Y*b%this.lifeTime/this.lifeTime):(0,r.Clamp)(Y*b/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+R*C|0}_inheritParticleInfoToSubEmitter(Y){if(Y.particleSystem.Rb.position){const b=Y.particleSystem.Rb;if(b.position.q(this.position),Y.inheritDirection){const Y=R.TmpVectors.AC[0];this.direction.normalizeToRef(Y),b.setDirection(Y,0,Math.PI/2)}}else{Y.particleSystem.Rb.q(this.position)}this.direction.scaleToRef(Y.inheritedVelocityAmount/2,R.TmpVectors.AC[0]),Y.particleSystem._inheritedVelocityOffset.q(R.TmpVectors.AC[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const Y of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(Y)}_reset(){this.age=0,this.id=Z._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(Y){Y.position.q(this.position),this._initialDirection?Y._initialDirection?Y._initialDirection.q(this._initialDirection):Y._initialDirection=this._initialDirection.clone():Y._initialDirection=null,Y.direction.q(this.direction),this.jg&&(Y.jg?Y.jg.q(this.jg):Y.jg=this.jg.clone()),Y.color.q(this.color),Y.colorStep.q(this.colorStep),Y.lifeTime=this.lifeTime,Y.age=this.age,Y._randomCellOffset=this._randomCellOffset,Y.size=this.size,Y.scale.q(this.scale),Y.angle=this.angle,Y.angularSpeed=this.angularSpeed,Y.particleSystem=this.particleSystem,Y.cellIndex=this.cellIndex,Y.id=this.id,Y._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(Y._currentColorGradient=this._currentColorGradient,Y._currentColor1.q(this._currentColor1),Y._currentColor2.q(this._currentColor2)),this._currentSizeGradient&&(Y._currentSizeGradient=this._currentSizeGradient,Y._currentSize1=this._currentSize1,Y._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(Y._currentAngularSpeedGradient=this._currentAngularSpeedGradient,Y._currentAngularSpeed1=this._currentAngularSpeed1,Y._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(Y._currentVelocityGradient=this._currentVelocityGradient,Y._currentVelocity1=this._currentVelocity1,Y._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(Y._currentLimitVelocityGradient=this._currentLimitVelocityGradient,Y._currentLimitVelocity1=this._currentLimitVelocity1,Y._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(Y._currentDragGradient=this._currentDragGradient,Y._currentDrag1=this._currentDrag1,Y._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(Y._initialStartSpriteCellId=this._initialStartSpriteCellId,Y._initialEndSpriteCellId=this._initialEndSpriteCellId,Y._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(Y.remapData&&this.remapData?Y.remapData.q(this.remapData):Y.remapData=new R.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(Y._randomNoiseCoordinates1?(Y._randomNoiseCoordinates1.q(this._randomNoiseCoordinates1),Y._randomNoiseCoordinates2.q(this._randomNoiseCoordinates2)):(Y._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),Y._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}Z._Count=0;var YY=C(12943),bY=(C(12989),C(13187)),CY=C(13181),RY=C(13089);function qY(Y,b){const C=(0,r.RandomRange)(0,1);E.hb.LerpToRef(b.color1,b.color2,C,Y.color),b.colorDead.subtractToRef(Y.color,b._colorDiff),b._colorDiff.scaleToRef(1/Y.lifeTime,Y.colorStep)}function AY(Y,b){Y._currentColorGradient=b._colorGradients[0],Y._currentColorGradient.getColorToRef(Y.color),Y._currentColor1.q(Y.color),b._colorGradients.length>1?b._colorGradients[1].getColorToRef(Y._currentColor2):Y._currentColor2.q(Y.color)}function EY(Y,b){const C=b._colorGradients;a.GetCurrentGradient(b._ratio,C,((b,C,R)=>{b!==Y._currentColorGradient&&(Y._currentColor1.q(Y._currentColor2),C.getColorToRef(Y._currentColor2),Y._currentColorGradient=b),E.hb.LerpToRef(Y._currentColor1,Y._currentColor2,R,Y.color)}))}function BY(Y,b){Y.colorStep.scaleToRef(b._scaledUpdateSpeed,b._scaledColorStep),Y.color.addInPlace(b._scaledColorStep),Y.color.a<0&&(Y.color.a=0)}function gY(Y,b){a.GetCurrentGradient(b._ratio,b._angularSpeedGradients,((b,C,R)=>{b!==Y._currentAngularSpeedGradient&&(Y._currentAngularSpeed1=Y._currentAngularSpeed2,Y._currentAngularSpeed2=C.getFactor(),Y._currentAngularSpeedGradient=b),Y.angularSpeed=(0,r.Lerp)(Y._currentAngularSpeed1,Y._currentAngularSpeed2,R)}))}function rY(Y,b){Y.angle+=Y.angularSpeed*b._scaledUpdateSpeed}function OY(Y,b){b.particleEmitterType.startDirectionFunction(b._emitterWorldMatrix,Y.direction,Y,b.isLocal,b._emitterInverseWorldMatrix)}function FY(Y,b){b.startDirectionFunction(b._emitterWorldMatrix,Y.direction,Y,b.isLocal)}function yY(Y,b){Y._currentVelocityGradient=b._velocityGradients[0],Y._currentVelocity1=Y._currentVelocityGradient.getFactor(),b._velocityGradients.length>1?Y._currentVelocity2=b._velocityGradients[1].getFactor():Y._currentVelocity2=Y._currentVelocity1}function SY(Y,b){Y._currentLimitVelocityGradient=b._limitVelocityGradients[0],Y._currentLimitVelocity1=Y._currentLimitVelocityGradient.getFactor(),b._limitVelocityGradients.length>1?Y._currentLimitVelocity2=b._limitVelocityGradients[1].getFactor():Y._currentLimitVelocity2=Y._currentLimitVelocity1}function nY(Y,b){a.GetCurrentGradient(b._ratio,b._velocityGradients,((C,R,q)=>{C!==Y._currentVelocityGradient&&(Y._currentVelocity1=Y._currentVelocity2,Y._currentVelocity2=R.getFactor(),Y._currentVelocityGradient=C),b._directionScale*=(0,r.Lerp)(Y._currentVelocity1,Y._currentVelocity2,q)}))}function tY(Y,b){a.GetCurrentGradient(b._ratio,b._limitVelocityGradients,((C,R,q)=>{C!==Y._currentLimitVelocityGradient&&(Y._currentLimitVelocity1=Y._currentLimitVelocity2,Y._currentLimitVelocity2=R.getFactor(),Y._currentLimitVelocityGradient=C);const A=(0,r.Lerp)(Y._currentLimitVelocity1,Y._currentLimitVelocity2,q);Y.direction.length()>A&&Y.direction.scaleInPlace(b.limitVelocityDamping)}))}function IY(Y,b){Y.direction.scaleToRef(b._directionScale,b._scaledDirection)}function wY(Y,b){b.particleEmitterType.startPositionFunction(b._emitterWorldMatrix,Y.position,Y,b.isLocal)}function QY(Y,b){b.startPositionFunction(b._emitterWorldMatrix,Y.position,Y,b.isLocal)}function NY(Y,b){Y.jg?Y.jg.q(Y.position):Y.jg=Y.position.clone(),R.AC.TransformCoordinatesToRef(Y.jg,b._emitterWorldMatrix,Y.position)}function pY(Y,b){b.isLocal&&Y.jg?(Y.jg.addInPlace(b._scaledDirection),R.AC.TransformCoordinatesToRef(Y.jg,b._emitterWorldMatrix,Y.position)):Y.position.addInPlace(b._scaledDirection)}function mb(Y,b){Y._currentDragGradient=b._dragGradients[0],Y._currentDrag1=Y._currentDragGradient.getFactor(),b._dragGradients.length>1?Y._currentDrag2=b._dragGradients[1].getFactor():Y._currentDrag2=Y._currentDrag1}function LY(Y,b){a.GetCurrentGradient(b._ratio,b._dragGradients,((C,R,q)=>{C!==Y._currentDragGradient&&(Y._currentDrag1=Y._currentDrag2,Y._currentDrag2=R.getFactor(),Y._currentDragGradient=C);const A=(0,r.Lerp)(Y._currentDrag1,Y._currentDrag2,q);b._scaledDirection.scaleInPlace(1-A)}))}function uY(Y,b){Y._randomNoiseCoordinates1?(Y._randomNoiseCoordinates1.Ub(Math.random(),Math.random(),Math.random()),Y._randomNoiseCoordinates2.Ub(Math.random(),Math.random(),Math.random())):(Y._randomNoiseCoordinates1=new R.AC(Math.random(),Math.random(),Math.random()),Y._randomNoiseCoordinates2=new R.AC(Math.random(),Math.random(),Math.random()))}function cY(Y,b){const C=b._noiseTextureData,q=b._noiseTextureSize;if(C&&q&&Y._randomNoiseCoordinates1){const A=b._fetchR(Y._randomNoiseCoordinates1.x,Y._randomNoiseCoordinates1.y,q.width,q.height,C),E=b._fetchR(Y._randomNoiseCoordinates1.z,Y._randomNoiseCoordinates2.x,q.width,q.height,C),B=b._fetchR(Y._randomNoiseCoordinates2.y,Y._randomNoiseCoordinates2.z,q.width,q.height,C),g=R.TmpVectors.AC[0],r=R.TmpVectors.AC[1];g.Ub((2*A-1)*b.noiseStrength.x,(2*E-1)*b.noiseStrength.y,(2*B-1)*b.noiseStrength.z),g.scaleToRef(b._tempScaledUpdateSpeed,r),Y.direction.addInPlace(r)}}function lY(Y,b){b.gravity.scaleToRef(b._tempScaledUpdateSpeed,b._scaledGravity),Y.direction.addInPlace(b._scaledGravity)}function XY(Y,b){Y.size=(0,r.RandomRange)(b.minSize,b.maxSize),Y.scale.Ub((0,r.RandomRange)(b.minScaleX,b.maxScaleX),(0,r.RandomRange)(b.minScaleY,b.maxScaleY))}function jY(Y,b){Y._currentSizeGradient=b._sizeGradients[0],Y._currentSize1=Y._currentSizeGradient.getFactor(),Y.size=Y._currentSize1,b._sizeGradients.length>1?Y._currentSize2=b._sizeGradients[1].getFactor():Y._currentSize2=Y._currentSize1,Y.scale.Ub((0,r.RandomRange)(b.minScaleX,b.maxScaleX),(0,r.RandomRange)(b.minScaleY,b.maxScaleY))}function TY(Y,b){const C=b._actualFrame/b.targetStopDuration;a.GetCurrentGradient(C,b._startSizeGradients,((C,R,q)=>{C!==b._currentStartSizeGradient&&(b._currentStartSize1=b._currentStartSize2,b._currentStartSize2=R.getFactor(),b._currentStartSizeGradient=C);const A=(0,r.Lerp)(b._currentStartSize1,b._currentStartSize2,q);Y.scale.scaleInPlace(A)}))}function PY(Y,b){a.GetCurrentGradient(b._ratio,b._sizeGradients,((b,C,R)=>{b!==Y._currentSizeGradient&&(Y._currentSize1=Y._currentSize2,Y._currentSize2=C.getFactor(),Y._currentSizeGradient=b),Y.size=(0,r.Lerp)(Y._currentSize1,Y._currentSize2,R)}))}function vY(Y,b){Y.remapData=new R.Vector4(0,1,0,1)}function zY(Y,b){b._colorRemapGradients&&b._colorRemapGradients.length>0&&a.GetCurrentGradient(b._ratio,b._colorRemapGradients,((b,C,R)=>{const q=(0,r.Lerp)(b.factor1,C.factor1,R),A=(0,r.Lerp)(b.factor2,C.factor2,R);Y.remapData.x=q,Y.remapData.y=A-q})),b._alphaRemapGradients&&b._alphaRemapGradients.length>0&&a.GetCurrentGradient(b._ratio,b._alphaRemapGradients,((b,C,R)=>{const q=(0,r.Lerp)(b.factor1,C.factor1,R),A=(0,r.Lerp)(b.factor2,C.factor2,R);Y.remapData.z=q,Y.remapData.w=A-q}))}function JY(Y,b){const C=(0,r.Clamp)(b._actualFrame/b.targetStopDuration);a.GetCurrentGradient(C,b._lifeTimeGradients,((b,R)=>{const q=b,A=R,E=q.getFactor(),B=A.getFactor(),g=(C-q.gradient)/(A.gradient-q.gradient);Y.lifeTime=(0,r.Lerp)(E,B,g)})),b._emitPower=(0,r.RandomRange)(b.minEmitPower,b.maxEmitPower)}function UY(Y,b){Y.lifeTime=(0,r.RandomRange)(b.minLifeTime,b.maxLifeTime),b._emitPower=(0,r.RandomRange)(b.minEmitPower,b.maxEmitPower)}function oY(Y,b){0===b._emitPower?(Y._initialDirection?Y._initialDirection.q(Y.direction):Y._initialDirection=Y.direction.clone(),Y.direction.set(0,0,0)):(Y._initialDirection=null,Y.direction.scaleInPlace(b._emitPower)),Y.direction.addInPlace(b._inheritedVelocityOffset)}function GY(Y,b){Y.angularSpeed=(0,r.RandomRange)(b.minAngularSpeed,b.maxAngularSpeed),Y.angle=(0,r.RandomRange)(b.minInitialRotation,b.maxInitialRotation)}function hY(Y,b){Y._currentAngularSpeedGradient=b._angularSpeedGradients[0],Y.angularSpeed=Y._currentAngularSpeedGradient.getFactor(),Y._currentAngularSpeed1=Y.angularSpeed,b._angularSpeedGradients.length>1?Y._currentAngularSpeed2=b._angularSpeedGradients[1].getFactor():Y._currentAngularSpeed2=Y._currentAngularSpeed1,Y.angle=(0,r.RandomRange)(b.minInitialRotation,b.maxInitialRotation)}function eY(Y,b){Y._initialStartSpriteCellId=b.startSpriteCellID,Y._initialEndSpriteCellId=b.endSpriteCellID,Y._initialSpriteCellLoop=b.spriteCellLoop}function HY(Y,b){Y.previousItem=b.previousItem,Y.nextItem=b,b.previousItem&&(b.previousItem.nextItem=Y),b.previousItem=Y}function iY(Y,b){Y.previousItem=b,Y.nextItem=b.nextItem,b.nextItem&&(b.nextItem.previousItem=Y),b.nextItem=Y}function WY(Y,b){let C=b;for(;C.nextItem;)C=C.nextItem;Y.previousItem=C,Y.nextItem=C.nextItem,C.nextItem=Y}function sY(Y){Y.previousItem&&(Y.previousItem.nextItem=Y.nextItem),Y.nextItem&&(Y.nextItem.previousItem=Y.previousItem)}class DY extends g{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(Y){this._startDirectionFunction!==Y&&(this._startDirectionFunction=Y,this._directionProcessing.process=Y?FY:OY)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(Y){this._startPositionFunction!==Y&&(this._startPositionFunction=Y,this._positionCreation.process=Y?QY:wY)}set onDispose(Y){this._onDisposeObserver&&this.Sb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Sb.add(Y)}get O(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(Y){this._useRampGradients!==Y&&(this._useRampGradients=Y,this._resetEffect(),Y?(this._rampCreation={process:vY,previousItem:null,nextItem:null},iY(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:zY,previousItem:null,nextItem:null},iY(this._remapGradientProcessing,this._gravityProcessing)):(sY(this._rampCreation),sY(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(Y){this._isLocal!==Y&&(this._isLocal=Y,Y?(this._isLocalCreation={process:NY,previousItem:null,nextItem:null},iY(this._isLocalCreation,this._positionCreation)):sY(this._isLocalCreation))}get particles(){return this.Ky}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Y){this._animationSheetEnabled!==Y&&(this._animationSheetEnabled=Y,Y?(this._sheetCreation={process:eY,previousItem:null,nextItem:null},iY(this._sheetCreation,this._colorCreation)):sY(this._sheetCreation),this._reset())}getActiveCount(){return this.Ky.length}getClassName(){return"sb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var Y;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Y=this._customWrappers[b])||void 0===Y?void 0:Y.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Y]??this._customWrappers[0]}setCustomEffect(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new YY.c(this._engine),this._customWrappers[b].effect=Y,this._customWrappers[b].drawContext&&(this._customWrappers[b].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new M.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(Y){if(this.noiseTexture!==Y){if(this._noiseTexture=Y,!Y)return sY(this._noiseCreation),void sY(this._noiseProcessing);this._noiseCreation={process:uY,previousItem:null,nextItem:null},iY(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:cY,previousItem:null,nextItem:null},iY(this._noiseProcessing,this._positionProcessing)}}constructor(Y,b,C){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(Y),this._emitterInverseWorldMatrix=R.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new R.AC,this.Sb=new M.d,this.onStoppedObservable=new M.d,this.onStartedObservable=new M.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.Ky=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new E.hb(0,0,0,0),this._colorDiff=new E.hb(0,0,0,0),this._scaledDirection=R.AC.Zero(),this._scaledGravity=R.AC.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=Y=>{},this.recycleParticle=Y=>{const b=this.Ky.pop();b!==Y&&b.copyTo(Y),this._stockParticles.push(b)},this._createParticle=()=>{let Y;return 0!==this._stockParticles.length?(Y=this._stockParticles.pop(),Y._reset()):Y=new Z(this),this._prepareParticle(Y),Y},this.paused=!1,this._shadersLoaded=!1,this._capacity=b,this._epsilon=B,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=R.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||f.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xy.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:UY,previousItem:null,nextItem:null},this._positionCreation={process:wY,previousItem:null,nextItem:null},iY(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:OY,previousItem:null,nextItem:null},iY(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:oY,previousItem:null,nextItem:null},iY(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:XY,previousItem:null,nextItem:null},iY(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:GY,previousItem:null,nextItem:null},iY(this._angleCreation,this._sizeCreation),this._colorCreation={process:qY,previousItem:null,nextItem:null},iY(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,g||(this._colorProcessing={process:BY,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:rY,previousItem:null,nextItem:null},iY(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:IY,previousItem:null,nextItem:null},iY(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:pY,previousItem:null,nextItem:null},iY(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:lY,previousItem:null,nextItem:null},iY(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=A,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new YY.c(this._engine)},this._customWrappers[0].effect=q,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new F,this.updateFunction=Y=>{var b;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(b=this.noiseTexture.getContent())||void 0===b||b.then((Y=>{this._noiseTextureData=Y})));const C=Y===this.Ky;for(let R=0;R<Y.length;R++){const b=Y[R];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const q=b.age;if(b.age+=this._tempScaledUpdateSpeed,b.age>b.lifeTime){const Y=b.age-q,C=b.lifeTime-q;this._tempScaledUpdateSpeed=C*this._tempScaledUpdateSpeed/Y,b.age=b.lifeTime}this._ratio=b.age/b.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let A=this._updateQueueStart;for(;A;)A.process(b,this),A=A.nextItem;if(this._isAnimationSheetEnabled&&!g&&b.updateCellIndex(),b._inheritParticleInfoToSubEmitters(),b.age>=b.lifeTime){if(this._emitFromParticle(b),b._attachedSubEmitters){for(const Y of b._attachedSubEmitters)Y.particleSystem.disposeOnStop=!0,Y.particleSystem.stop();b._attachedSubEmitters=null}this.recycleParticle(b),C&&R--}else;}}}serialize(Y){throw new Error("Method not implemented.")}clone(Y,b){throw new Error("Method not implemented.")}_addFactorGradient(Y,b,C,R){const q=new x(b,C,R);Y.push(q),Y.sort(((Y,b)=>Y.gradient<b.gradient?-1:Y.gradient>b.gradient?1:0))}_removeFactorGradient(Y,b){if(!Y)return;let C=0;for(const R of Y){if(R.gradient===b){Y.splice(C,1);break}C++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=JY:this._lifeTimeCreation.process=UY}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:TY,previousItem:null,nextItem:null},iY(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(sY(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Y){this.targetStopDuration!==Y&&(this._targetStopDuration=Y,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(Y,b,C){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,Y,b,C),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(Y){return this._removeFactorGradient(this._lifeTimeGradients,Y),this._syncLifeTimeCreation(),this}addSizeGradient(Y,b,C){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=jY,this._sizeGradientProcessing={process:PY,previousItem:null,nextItem:null},HY(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,Y,b,C),this}removeSizeGradient(Y){var b;return this._removeFactorGradient(this._sizeGradients,Y),0===(null===(b=this._sizeGradients)||void 0===b?void 0:b.length)&&(sY(this._sizeGradientProcessing),this._sizeCreation.process=XY),this}addColorRemapGradient(Y,b,C){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,Y,b,C),this}removeColorRemapGradient(Y){return this._removeFactorGradient(this._colorRemapGradients,Y),this}addAlphaRemapGradient(Y,b,C){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,Y,b,C),this}removeAlphaRemapGradient(Y){return this._removeFactorGradient(this._alphaRemapGradients,Y),this}addAngularSpeedGradient(Y,b,C){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=hY,this._angularSpeedGradientProcessing={process:gY,previousItem:null,nextItem:null},HY(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,Y,b,C),this}removeAngularSpeedGradient(Y){var b;return this._removeFactorGradient(this._angularSpeedGradients,Y),0===(null===(b=this._angularSpeedGradients)||void 0===b?void 0:b.length)&&(this._angleCreation.process=GY,sY(this._angularSpeedGradientProcessing)),this}addVelocityGradient(Y,b,C){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:yY,previousItem:null,nextItem:null},iY(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:nY,previousItem:null,nextItem:null},HY(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,Y,b,C),this}removeVelocityGradient(Y){var b;return this._removeFactorGradient(this._velocityGradients,Y),0===(null===(b=this._velocityGradients)||void 0===b?void 0:b.length)&&(sY(this._velocityCreation),sY(this._velocityGradientProcessing)),this}addLimitVelocityGradient(Y,b,C){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:SY,previousItem:null,nextItem:null},iY(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:tY,previousItem:null,nextItem:null},iY(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,Y,b,C),this}removeLimitVelocityGradient(Y){var b;return this._removeFactorGradient(this._limitVelocityGradients,Y),0===(null===(b=this._limitVelocityGradients)||void 0===b?void 0:b.length)&&(sY(this._limitVelocityCreation),sY(this._limitVelocityGradientProcessing)),this}addDragGradient(Y,b,C){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:mb,previousItem:null,nextItem:null},HY(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:LY,previousItem:null,nextItem:null},HY(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,Y,b,C),this}removeDragGradient(Y){var b;return this._removeFactorGradient(this._dragGradients,Y),0===(null===(b=this._dragGradients)||void 0===b?void 0:b.length)&&(sY(this._dragCreation),sY(this._dragGradientProcessing)),this}addEmitRateGradient(Y,b,C){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,Y,b,C),this}removeEmitRateGradient(Y){return this._removeFactorGradient(this._emitRateGradients,Y),this}addStartSizeGradient(Y,b,C){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,Y,b,C),this._syncStartSizeCreation(),this}removeStartSizeGradient(Y){return this._removeFactorGradient(this._startSizeGradients,Y),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const Y=new Uint8Array(4*this._rawTextureWidth),b=E.TmpColors.rC[0];for(let C=0;C<this._rawTextureWidth;C++){const R=C/this._rawTextureWidth;a.GetCurrentGradient(R,this._rampGradients,((R,q,A)=>{E.rC.LerpToRef(R.color,q.color,A,b),Y[4*C]=255*b.r,Y[4*C+1]=255*b.g,Y[4*C+2]=255*b.b,Y[4*C+3]=255}))}this._rampGradientsTexture=K.b.CreateRGBATexture(Y,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((Y,b)=>Y.gradient<b.gradient?-1:Y.gradient>b.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(Y,b){this._rampGradients||(this._rampGradients=[]);const C=new k(Y,b);return this._rampGradients.push(C),this._syncRampGradientTexture(),this}removeRampGradient(Y){return this._removeGradientAndTexture(Y,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(Y,b,C){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=AY,this._colorProcessing.process=EY);const R=new V(Y,b,C);return this._colorGradients.push(R),this._colorGradients.sort(((Y,b)=>Y.gradient<b.gradient?-1:Y.gradient>b.gradient?1:0)),this}removeColorGradient(Y){if(!this._colorGradients)return this;let b=0;for(const C of this._colorGradients){if(C.gradient===Y){this._colorGradients.splice(b,1);break}b++}return 0===this._colorGradients.length&&(this._colorCreation.process=qY,this._colorProcessing.process=BY),this}resetDrawCache(){if(this._drawWrappers){for(const Y of this._drawWrappers)if(Y)for(const b of Y)null===b||void 0===b||b.dispose();this._drawWrappers=[]}}_fetchR(Y,b,C,R,q){return q[4*(((Y=.5*Math.abs(Y)+.5)*C%C|0)+((b=.5*Math.abs(b)+.5)*R%R|0)*C)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const Y=this._engine,b=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*b),this._vertexBuffer=new mY.d(Y,this._vertexData,!0,b);let C=0;const R=this._vertexBuffer.createVertexBuffer(mY.e.PositionKind,C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[mY.e.PositionKind]=R,C+=3;const q=this._vertexBuffer.createVertexBuffer(mY.e.ColorKind,C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[mY.e.ColorKind]=q,C+=4;const A=this._vertexBuffer.createVertexBuffer("angle",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=A,C+=1;const E=this._vertexBuffer.createVertexBuffer("size",C,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=E,C+=2,this._isAnimationSheetEnabled){const Y=this._vertexBuffer.createVertexBuffer("cellIndex",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=Y,C+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const Y=this._vertexBuffer.createVertexBuffer("direction",C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=Y,C+=3}if(this._useRampGradients){const Y=this._vertexBuffer.createVertexBuffer("remapData",C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=Y,C+=4}let B;if(this._useInstancing){const b=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new mY.d(Y,b,!1,2),B=this._spriteBuffer.createVertexBuffer("offset",0,2)}else B=this._vertexBuffer.createVertexBuffer("offset",C,2,this._vertexBufferSize,this._useInstancing),C+=2;this._vertexBuffers.offset=B,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const Y=[],b=[];let C=0;for(let R=0;R<this._capacity;R++)Y.push(C),Y.push(C+1),Y.push(C+2),Y.push(C),Y.push(C+2),Y.push(C+3),b.push(C,C+1,C+1,C+2,C+2,C+3,C+3,C,C,C+3),C+=4;this._indexBuffer=this._engine.createIndexBuffer(Y),this._linesIndexBuffer=this._engine.createIndexBuffer(b)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(Y)setTimeout((()=>{this.start(0)}),Y);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var b;-1!==(null===(b=this.Rb)||void 0===b?void 0:b.getClassName().indexOf("Mesh"))&&this.Rb.Tb(!0);const Y=this.noiseTexture;if(Y&&Y.onGeneratedObservable)Y.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),Y.render()}))}));else for(let b=0;b<this.preWarmCycles;b++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(Y))}_postStop(Y){}reset(){this._stockParticles.length=0,this.Ky.length=0}_appendParticleVertex(Y,b,C,q){let A=Y*this._vertexBufferSize;if(this._vertexData[A++]=b.position.x+this.EO.x,this._vertexData[A++]=b.position.y+this.EO.y,this._vertexData[A++]=b.position.z+this.EO.z,this._vertexData[A++]=b.color.r,this._vertexData[A++]=b.color.g,this._vertexData[A++]=b.color.b,this._vertexData[A++]=b.color.a,this._vertexData[A++]=b.angle,this._vertexData[A++]=b.scale.x*b.size,this._vertexData[A++]=b.scale.y*b.size,this._isAnimationSheetEnabled&&(this._vertexData[A++]=b.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[A++]=b.direction.x,this._vertexData[A++]=b.direction.y,this._vertexData[A++]=b.direction.z);else if(b._initialDirection){let Y=b._initialDirection;this.isLocal&&(R.AC.TransformNormalToRef(Y,this._emitterWorldMatrix,R.TmpVectors.AC[0]),Y=R.TmpVectors.AC[0]),0===Y.x&&0===Y.z&&(Y.x=.001),this._vertexData[A++]=Y.x,this._vertexData[A++]=Y.y,this._vertexData[A++]=Y.z}else{let Y=b.direction;this.isLocal&&(R.AC.TransformNormalToRef(Y,this._emitterWorldMatrix,R.TmpVectors.AC[0]),Y=R.TmpVectors.AC[0]),0===Y.x&&0===Y.z&&(Y.x=.001),this._vertexData[A++]=Y.x,this._vertexData[A++]=Y.y,this._vertexData[A++]=Y.z}this._useRampGradients&&b.remapData&&(this._vertexData[A++]=b.remapData.x,this._vertexData[A++]=b.remapData.y,this._vertexData[A++]=b.remapData.z,this._vertexData[A++]=b.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===C?C=this._epsilon:1===C&&(C=1-this._epsilon),0===q?q=this._epsilon:1===q&&(q=1-this._epsilon)),this._vertexData[A++]=C,this._vertexData[A++]=q)}_prepareParticle(Y){}_createNewOnes(Y){let b;for(let C=0;C<Y&&this.Ky.length!==this._capacity;C++){b=this._createParticle(),this.Ky.push(b);let Y=this._createQueueStart;for(;Y;)Y.process(b,this),Y=Y.nextItem;b._inheritParticleInfoToSubEmitters()}}_update(Y){if(this._alive=this.Ky.length>0,this.Rb.position){const Y=this.Rb;this._emitterWorldMatrix=Y.getWorldMatrix()}else{const Y=this.Rb;this._emitterWorldMatrix=R.Matrix.Translation(Y.x,Y.y,Y.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Ky),this._createNewOnes(Y)}static _GetAttributeNamesOrOptions(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R=[mY.e.PositionKind,mY.e.ColorKind,"angle","offset","size"];return Y&&R.push("cellIndex"),b||R.push("direction"),C&&R.push("remapData"),R}static _GetEffectCreationOptions(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,bY.c)(R),Y&&R.push("particlesInfos"),b&&R.push("logarithmicDepthConstant"),C&&(R.push("vFogInfos"),R.push("vFogColor")),R}fillDefines(Y,b){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bY.i)(this,this._scene,Y),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&Y.push("#define FOG")),this._isAnimationSheetEnabled&&Y.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&Y.push("#define LOGARITHMICDEPTH"),b===g.BLENDMODE_MULTIPLY&&Y.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&Y.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(Y.push("#define BILLBOARD"),this.billboardMode){case 2:Y.push("#define BILLBOARDY");break;case 8:case 9:Y.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&Y.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:Y.push("#define BILLBOARDMODE_ALL")}C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Y.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Y,b,C){b.push(...DY._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),Y.push(...DY._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,RY.f)(Y,this._imageProcessingConfigurationDefines),(0,RY.c)(C,this._imageProcessingConfigurationDefines))}_getWrapper(Y){const b=this._getCustomDrawWrapper(Y);if(null!==b&&void 0!==b&&b.effect)return b;const C=[];this.fillDefines(C,Y);const R=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let q=this._drawWrappers[R];q||(q=this._drawWrappers[R]=[]);let A=q[Y];A||(A=new YY.c(this._engine),A.drawContext&&(A.drawContext.useInstancing=this._useInstancing),q[Y]=A);const E=C.join("\n");if(A.defines!==E){const Y=[],b=[],C=[];this.fillUniformsAttributesAndSamplerNames(b,Y,C),A.setEffect(this._engine.createEffect("particles",Y,b,C,E,void 0,void 0,void 0,void 0,this._shaderLanguage),E)}return A}animate(){var Y;let b,C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!C&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(C?this.preWarmStepOffset:(null===(Y=this._scene)||void 0===Y?void 0:Y.getAnimationRatio())||1),this.manualEmitCount>-1)b=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let Y=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const b=this._actualFrame/this.targetStopDuration;a.GetCurrentGradient(b,this._emitRateGradients,((b,C,R)=>{b!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=C.getFactor(),this._currentEmitRateGradient=b),Y=(0,r.Lerp)(this._currentEmitRate1,this._currentEmitRate2,R)}))}b=Y*this._scaledUpdateSpeed|0,this._newPartsExcess+=Y*this._scaledUpdateSpeed-b}if(this._newPartsExcess>1&&(b+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?b=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(b),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!C){let Y=0;for(let b=0;b<this.Ky.length;b++){const C=this.Ky[b];this._appendParticleVertices(Y,C),Y+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Ky.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(Y,b){this._appendParticleVertex(Y++,b,0,0),this._useInstancing||(this._appendParticleVertex(Y++,b,1,0),this._appendParticleVertex(Y++,b,1,1),this._appendParticleVertex(Y++,b,0,1))}rebuild(){var Y;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(Y=this._spriteBuffer)||void 0===Y||Y._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!DY.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(C.bind(C,14180)),Promise.resolve().then(C.bind(C,14118))])):await Promise.all([Promise.resolve().then(C.bind(C,14108)),Promise.resolve().then(C.bind(C,14102))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Rb||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==g.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(g.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(g.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(Y){const b=this._getWrapper(Y),C=b.effect,q=this._engine;q.enableEffect(b);const A=this.defaultViewMatrix??this._scene.getViewMatrix();if(C.setTexture("diffuseSampler",this.particleTexture),C.setMatrix("view",A),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const Y=this.particleTexture.getBaseSize();C.setFloat3("particlesInfos",this.spriteCellWidth/Y.width,this.spriteCellHeight/Y.height,this.spriteCellWidth/Y.width)}if(C.setVector2("translationPivot",this.translationPivot),C.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const Y=this._scene.activeCamera;C.setVector3("eyePosition",Y.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),C.setTexture("rampSampler",this._rampGradientsTexture));const E=C.defines;var B,g,r,O,F,y;(this._scene&&((0,bY.g)(C,this,this._scene),this.applyFog&&(0,CY.h)(this._scene,void 0,C)),E.indexOf("#define BILLBOARDMODE_ALL")>=0&&(A.invertToRef(R.TmpVectors.Matrix[0]),C.setMatrix("invView",R.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?q.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,C):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,C)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?q.bindBuffers(this._vertexBuffers,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBuffer:this._indexBuffer,C):q.bindBuffers(this._vertexBuffers,null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._linesIndexBufferUseInstancing:null,C);(this.useLogarithmicDepth&&this._scene&&(0,CY.n)(E,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(Y),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),this._useInstancing)?null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?q.drawElementsType(6,0,10,this.Ky.length):q.drawArraysType(7,0,4,this.Ky.length):null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?q.drawElementsType(1,0,10*this.Ky.length):q.drawElementsType(0,0,6*this.Ky.length);return this.Ky.length}render(){if(!this.isReady()||!this.Ky.length)return 0;const Y=this._engine;Y.setState&&(Y.setState(!1),this.forceDepthWrite&&Y.setDepthWrite(!0));let b=0;return b=this.blendMode===g.BLENDMODE_MULTIPLYADD?this._render(g.BLENDMODE_MULTIPLY)+this._render(g.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),b}_onDispose(){}dispose(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),Y&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Y&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(b,C),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const Y=this._scene.xy.indexOf(this);Y>-1&&this._scene.xy.splice(Y,1),this._scene._activeParticleSystems.dispose()}this.Sb.notifyObservers(this),this.Sb.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}DY.ForceGLSL=!1;var dY,VY=C(12687);!function(Y){Y[Y.ATTACHED=0]="ATTACHED",Y[Y.END=1]="END"}(dY||(dY={}));class kY{constructor(Y){if(this.particleSystem=Y,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!Y.Rb||!Y.Rb.dispose){const b=(0,B.c)("BABYLON.AbstractMesh");Y.Rb=new b("SubemitterSystemEmitter",Y.uY()),Y._disposeEmitterOnDispose=!0}}clone(){let Y=this.particleSystem.Rb;if(Y){if(Y instanceof R.AC)Y=Y.clone();else if(-1!==Y.getClassName().indexOf("Mesh")){Y=new((0,B.c)("BABYLON.Mesh"))("",Y.uY()),Y.isVisible=!1}}else Y=new R.AC;const b=new kY(this.particleSystem.clone(this.particleSystem.name,Y));return b.particleSystem.name+="Clone",b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem._disposeEmitterOnDispose=!0,b.particleSystem.disposeOnStop=!0,b}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem=this.particleSystem.serialize(Y),b}static _ParseParticleSystem(Y,b,C){throw(0,VY.d)("ParseParticle")}static Parse(Y,b,C){const R=Y.particleSystem,q=new kY(kY._ParseParticleSystem(R,b,C,!0));return q.type=Y.type,q.inheritDirection=Y.inheritDirection,q.inheritedVelocityAmount=Y.inheritedVelocityAmount,q.particleSystem._isSubEmitter=!0,q}dispose(){this.particleSystem.dispose()}}var xY=C(12733);function aY(Y,b){const C=new w;return C.direction1=Y,C.direction2=b,C}function MY(){return new I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function KY(){return new Q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function fY(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R.AC(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.AC(0,1,0);return new N(Y,b,C)}function ZY(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Yb(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.AC(0,1,0),A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new R.AC(0,1,0);return new t(Y,b,C,q,A)}function bb(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new y(Y,b)}function Cb(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.AC(0,1,0),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.AC(0,1,0);return new S(Y,b,C,q)}const Rb=R.AC.Zero(),qb=R.AC.Zero(),Ab=R.AC.Zero();class Eb{constructor(){this.strength=0,this.position=R.AC.Zero()}_processParticle(Y,b){this.position.subtractToRef(Y.position,Rb);const C=Rb.lengthSquared()+1;Rb.normalize().scaleToRef(this.strength/C,qb),qb.scaleToRef(b._tempScaledUpdateSpeed,Ab),Y.direction.addInPlace(Ab)}serialize(){return{position:this.position.cb(),strength:this.strength}}}class Bb extends DY{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=Y=>{if(!this._subEmitters||0===this._subEmitters.length)return;const b=Math.floor(Math.random()*this._subEmitters.length);for(const C of this._subEmitters[b])if(1===C.type){const b=C.clone();Y._inheritParticleInfoToSubEmitter(b),b.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(b.particleSystem),b.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(Y,b){const C=aY(Y,b);return this.particleEmitterType=C,C}get flowMap(){return this._flowMap}set flowMap(Y){this._flowMap!==Y&&(this._flowMap=Y,this._flowMapUpdate&&(sY(this._flowMapUpdate),this._flowMapUpdate=null),Y&&(this._flowMapUpdate={process:Y=>{var b;const C=null===(b=this.uY())||void 0===b?void 0:b.getTransformMatrix();this._flowMap._processParticle(Y,this.flowMapStrength*this._tempScaledUpdateSpeed,C)},previousItem:null,nextItem:null},iY(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(Y){this._attractors.push(Y),1===this._attractors.length&&(this._attractorUpdate={process:Y=>{for(const b of this._attractors)b._processParticle(Y,this)},previousItem:null,nextItem:null},iY(this._attractorUpdate,this._directionProcessing))}removeAttractor(Y){const b=this._attractors.indexOf(Y);-1!==b&&this._attractors.splice(b,1),0===this._attractors.length&&sY(this._attractorUpdate)}start(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(Y)}createHemisphericEmitter(){const Y=MY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Y,Y}createSphereEmitter(){const Y=KY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Y,Y}createDirectedSphereEmitter(){const Y=fY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R.AC(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.AC(0,1,0));return this.particleEmitterType=Y,Y}createCylinderEmitter(){const Y=ZY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Y,Y}createDirectedCylinderEmitter(){const Y=Yb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.AC(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new R.AC(0,1,0));return this.particleEmitterType=Y,Y}createConeEmitter(){const Y=bb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Y,Y}createDirectedConeEmitter(){const Y=Cb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.AC(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.AC(0,1,0));return this.particleEmitterType=Y,Y}createBoxEmitter(Y,b,C,R){const q=new F;return this.particleEmitterType=q,this.direction1=Y,this.direction2=b,this.minEmitBox=C,this.maxEmitBox=R,q}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const Y of this.subEmitters)Y instanceof Bb?this._subEmitters.push([new kY(Y)]):Y instanceof kY?this._subEmitters.push([Y]):Y instanceof Array&&this._subEmitters.push(Y)}_stopSubEmitters(){if(this.activeSubSystems){for(const Y of this.activeSubSystems)Y.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const Y=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==Y&&this._rootParticleSystem.activeSubSystems.splice(Y,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(Y){Y&&this._stopSubEmitters()}_prepareParticle(Y){if(this._subEmitters&&this._subEmitters.length>0){const b=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];Y._attachedSubEmitters=[];for(const C of b)if(0===C.type){const b=C.clone();Y._attachedSubEmitters.push(b),b.particleSystem.start()}}}_onDispose(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),Y&&this.particles)for(const C of this.particles)if(C._attachedSubEmitters)for(let Y=C._attachedSubEmitters.length-1;Y>=0;Y-=1)C._attachedSubEmitters[Y].dispose();if(b&&this.activeSubSystems)for(let C=this.activeSubSystems.length-1;C>=0;C-=1)this.activeSubSystems[C].dispose();if(this._subEmitters&&this._subEmitters.length){for(let Y=0;Y<this._subEmitters.length;Y++)for(const b of this._subEmitters[Y])b.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Rb&&this.Rb.dispose&&this.Rb.dispose(!0)}static _Parse(Y,b,C,q){let A;A=C instanceof xY.b?null:C;const g=(0,B.c)("BABYLON.Texture");if(g&&A&&(Y.texture?b.particleTexture=g.Parse(Y.texture,A,q):Y.textureName&&(b.particleTexture=new g(q+Y.textureName,A,!1,void 0===Y.invertY||Y.invertY),b.particleTexture.name=Y.textureName)),Y.emitterId||0===Y.emitterId||void 0!==Y.Rb?Y.emitterId&&A?b.Rb=A.getLastMeshById(Y.emitterId):b.Rb=R.AC.OC(Y.Rb):b.Rb=R.AC.Zero(),b.isLocal=!!Y.isLocal,void 0!==Y.renderingGroupId&&(b.renderingGroupId=Y.renderingGroupId),void 0!==Y.isBillboardBased&&(b.isBillboardBased=Y.isBillboardBased),void 0!==Y.billboardMode&&(b.billboardMode=Y.billboardMode),void 0!==Y.useLogarithmicDepth&&(b.useLogarithmicDepth=Y.useLogarithmicDepth),Y.animations){for(let C=0;C<Y.animations.length;C++){const R=Y.animations[C],q=(0,B.c)("BABYLON.Animation");q&&b.animations.push(q.Parse(R))}b.beginAnimationOnStart=Y.beginAnimationOnStart,b.beginAnimationFrom=Y.beginAnimationFrom,b.beginAnimationTo=Y.beginAnimationTo,b.beginAnimationLoop=Y.beginAnimationLoop}if(Y.autoAnimate&&A&&A.beginAnimation(b,Y.autoAnimateFrom,Y.autoAnimateTo,Y.autoAnimateLoop,Y.autoAnimateSpeed||1),b.startDelay=0|Y.startDelay,b.minAngularSpeed=Y.minAngularSpeed,b.maxAngularSpeed=Y.maxAngularSpeed,b.minSize=Y.minSize,b.maxSize=Y.maxSize,Y.minScaleX&&(b.minScaleX=Y.minScaleX,b.maxScaleX=Y.maxScaleX,b.minScaleY=Y.minScaleY,b.maxScaleY=Y.maxScaleY),void 0!==Y.preWarmCycles&&(b.preWarmCycles=Y.preWarmCycles,b.preWarmStepOffset=Y.preWarmStepOffset),void 0!==Y.minInitialRotation&&(b.minInitialRotation=Y.minInitialRotation,b.maxInitialRotation=Y.maxInitialRotation),b.minLifeTime=Y.minLifeTime,b.maxLifeTime=Y.maxLifeTime,b.minEmitPower=Y.minEmitPower,b.maxEmitPower=Y.maxEmitPower,b.emitRate=Y.emitRate,b.gravity=R.AC.OC(Y.gravity),Y.noiseStrength&&(b.noiseStrength=R.AC.OC(Y.noiseStrength)),b.color1=E.hb.OC(Y.color1),b.color2=E.hb.OC(Y.color2),b.colorDead=E.hb.OC(Y.colorDead),b.updateSpeed=Y.updateSpeed,b.targetStopDuration=Y.targetStopDuration,b.blendMode=Y.blendMode,Y.colorGradients)for(const R of Y.colorGradients)b.addColorGradient(R.gradient,E.hb.OC(R.color1),R.color2?E.hb.OC(R.color2):void 0);if(Y.rampGradients){for(const C of Y.rampGradients)b.addRampGradient(C.gradient,E.rC.OC(C.color));b.useRampGradients=Y.useRampGradients}if(Y.colorRemapGradients)for(const R of Y.colorRemapGradients)b.addColorRemapGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(Y.alphaRemapGradients)for(const R of Y.alphaRemapGradients)b.addAlphaRemapGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(Y.sizeGradients)for(const R of Y.sizeGradients)b.addSizeGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(Y.angularSpeedGradients)for(const R of Y.angularSpeedGradients)b.addAngularSpeedGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(Y.velocityGradients)for(const R of Y.velocityGradients)b.addVelocityGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(Y.dragGradients)for(const R of Y.dragGradients)b.addDragGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(Y.emitRateGradients)for(const R of Y.emitRateGradients)b.addEmitRateGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(Y.startSizeGradients)for(const R of Y.startSizeGradients)b.addStartSizeGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(Y.lifeTimeGradients)for(const R of Y.lifeTimeGradients)b.addLifeTimeGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(Y.limitVelocityGradients){for(const C of Y.limitVelocityGradients)b.addLimitVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);b.limitVelocityDamping=Y.limitVelocityDamping}if(Y.noiseTexture&&A){const C=(0,B.c)("BABYLON.ProceduralTexture");b.noiseTexture=C.Parse(Y.noiseTexture,A,q)}let r;if(Y.particleEmitterType){switch(Y.particleEmitterType.type){case"SphereParticleEmitter":r=new Q;break;case"SphereDirectedParticleEmitter":r=new N;break;case"ConeEmitter":case"ConeParticleEmitter":r=new y;break;case"ConeDirectedParticleEmitter":r=new S;break;case"CylinderParticleEmitter":r=new n;break;case"CylinderDirectedParticleEmitter":r=new t;break;case"HemisphericParticleEmitter":r=new I;break;case"PointParticleEmitter":r=new w;break;case"MeshParticleEmitter":r=new L;break;case"CustomParticleEmitter":r=new p;break;default:r=new F}r.parse(Y.particleEmitterType,A)}else r=new F,r.parse(Y,A);b.particleEmitterType=r,b.startSpriteCellID=Y.startSpriteCellID,b.endSpriteCellID=Y.endSpriteCellID,b.spriteCellLoop=Y.spriteCellLoop??!0,b.spriteCellWidth=Y.spriteCellWidth,b.spriteCellHeight=Y.spriteCellHeight,b.spriteCellChangeSpeed=Y.spriteCellChangeSpeed,b.spriteRandomStartCell=Y.spriteRandomStartCell,b.disposeOnStop=Y.disposeOnStop??!1,b.manualEmitCount=Y.manualEmitCount??-1}static Parse(Y,b,C){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0;const B=Y.name;let g,r,O=null,F=null;if(b instanceof xY.b?g=b:(r=b,g=r.getEngine()),Y.customShader&&g.createEffectForParticles){F=Y.customShader;const b=F.shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"";O=g.createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,b)}const y=new Bb(B,A||Y.jC,b,O,Y.isAnimationSheetEnabled);if(y.customShader=F,y._rootUrl=C,Y.id&&(y.id=Y.id),Y.subEmitters){y.subEmitters=[];for(const R of Y.subEmitters){const Y=[];for(const q of R)Y.push(kY.Parse(q,b,C));y.subEmitters.push(Y)}}if(Y.attractors)for(const E of Y.attractors){const Y=new Eb;Y.position=R.AC.OC(E.position),Y.strength=E.strength,y.addAttractor(Y)}return Bb._Parse(Y,y,b,C),Y.textureMask&&(y.textureMask=E.hb.OC(Y.textureMask)),Y.EO&&(y.EO=R.AC.OC(Y.EO)),Y.preventAutoStart&&(y.preventAutoStart=Y.preventAutoStart),q||y.preventAutoStart||y.start(),y}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};if(Bb._Serialize(b,this,Y),b.textureMask=this.textureMask.cb(),b.customShader=this.customShader,b.preventAutoStart=this.preventAutoStart,b.EO=this.EO.cb(),this.subEmitters){b.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const C of this._subEmitters){const R=[];for(const b of C)R.push(b.serialize(Y));b.subEmitters.push(R)}}if(this._attractors&&this._attractors.length){b.attractors=[];for(const Y of this._attractors)b.attractors.push(Y.serialize())}return b}static _Serialize(Y,b,C){if(Y.name=b.name,Y.id=b.id,Y.jC=b.getCapacity(),Y.disposeOnStop=b.disposeOnStop,Y.manualEmitCount=b.manualEmitCount,b.Rb.position){const C=b.Rb;Y.emitterId=C.id}else{const C=b.Rb;Y.Rb=C.cb()}b.particleEmitterType&&(Y.particleEmitterType=b.particleEmitterType.serialize()),b.particleTexture&&(C?Y.texture=b.particleTexture.serialize():(Y.textureName=b.particleTexture.name,Y.invertY=!!b.particleTexture._invertY)),Y.isLocal=b.isLocal,J.e.AppendSerializedAnimations(b,Y),Y.beginAnimationOnStart=b.beginAnimationOnStart,Y.beginAnimationFrom=b.beginAnimationFrom,Y.beginAnimationTo=b.beginAnimationTo,Y.beginAnimationLoop=b.beginAnimationLoop,Y.startDelay=b.startDelay,Y.renderingGroupId=b.renderingGroupId,Y.isBillboardBased=b.isBillboardBased,Y.billboardMode=b.billboardMode,Y.minAngularSpeed=b.minAngularSpeed,Y.maxAngularSpeed=b.maxAngularSpeed,Y.minSize=b.minSize,Y.maxSize=b.maxSize,Y.minScaleX=b.minScaleX,Y.maxScaleX=b.maxScaleX,Y.minScaleY=b.minScaleY,Y.maxScaleY=b.maxScaleY,Y.minEmitPower=b.minEmitPower,Y.maxEmitPower=b.maxEmitPower,Y.minLifeTime=b.minLifeTime,Y.maxLifeTime=b.maxLifeTime,Y.emitRate=b.emitRate,Y.gravity=b.gravity.cb(),Y.noiseStrength=b.noiseStrength.cb(),Y.color1=b.color1.cb(),Y.color2=b.color2.cb(),Y.colorDead=b.colorDead.cb(),Y.updateSpeed=b.updateSpeed,Y.targetStopDuration=b.targetStopDuration,Y.blendMode=b.blendMode,Y.preWarmCycles=b.preWarmCycles,Y.preWarmStepOffset=b.preWarmStepOffset,Y.minInitialRotation=b.minInitialRotation,Y.maxInitialRotation=b.maxInitialRotation,Y.startSpriteCellID=b.startSpriteCellID,Y.spriteCellLoop=b.spriteCellLoop,Y.endSpriteCellID=b.endSpriteCellID,Y.spriteCellChangeSpeed=b.spriteCellChangeSpeed,Y.spriteCellWidth=b.spriteCellWidth,Y.spriteCellHeight=b.spriteCellHeight,Y.spriteRandomStartCell=b.spriteRandomStartCell,Y.isAnimationSheetEnabled=b.isAnimationSheetEnabled,Y.useLogarithmicDepth=b.useLogarithmicDepth;const R=b.getColorGradients();if(R){Y.colorGradients=[];for(const b of R){const C={gradient:b.gradient,color1:b.color1.cb()};b.color2?C.color2=b.color2.cb():C.color2=b.color1.cb(),Y.colorGradients.push(C)}}const q=b.getRampGradients();if(q){Y.rampGradients=[];for(const b of q){const C={gradient:b.gradient,color:b.color.cb()};Y.rampGradients.push(C)}Y.useRampGradients=b.useRampGradients}const A=b.getColorRemapGradients();if(A){Y.colorRemapGradients=[];for(const b of A){const C={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?C.factor2=b.factor2:C.factor2=b.factor1,Y.colorRemapGradients.push(C)}}const E=b.getAlphaRemapGradients();if(E){Y.alphaRemapGradients=[];for(const b of E){const C={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?C.factor2=b.factor2:C.factor2=b.factor1,Y.alphaRemapGradients.push(C)}}const B=b.getSizeGradients();if(B){Y.sizeGradients=[];for(const b of B){const C={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?C.factor2=b.factor2:C.factor2=b.factor1,Y.sizeGradients.push(C)}}const g=b.getAngularSpeedGradients();if(g){Y.angularSpeedGradients=[];for(const b of g){const C={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?C.factor2=b.factor2:C.factor2=b.factor1,Y.angularSpeedGradients.push(C)}}const r=b.getVelocityGradients();if(r){Y.velocityGradients=[];for(const b of r){const C={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?C.factor2=b.factor2:C.factor2=b.factor1,Y.velocityGradients.push(C)}}const O=b.getDragGradients();if(O){Y.dragGradients=[];for(const b of O){const C={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?C.factor2=b.factor2:C.factor2=b.factor1,Y.dragGradients.push(C)}}const F=b.getEmitRateGradients();if(F){Y.emitRateGradients=[];for(const b of F){const C={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?C.factor2=b.factor2:C.factor2=b.factor1,Y.emitRateGradients.push(C)}}const y=b.getStartSizeGradients();if(y){Y.startSizeGradients=[];for(const b of y){const C={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?C.factor2=b.factor2:C.factor2=b.factor1,Y.startSizeGradients.push(C)}}const S=b.getLifeTimeGradients();if(S){Y.lifeTimeGradients=[];for(const b of S){const C={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?C.factor2=b.factor2:C.factor2=b.factor1,Y.lifeTimeGradients.push(C)}}const n=b.getLimitVelocityGradients();if(n){Y.limitVelocityGradients=[];for(const b of n){const C={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?C.factor2=b.factor2:C.factor2=b.factor1,Y.limitVelocityGradients.push(C)}Y.limitVelocityDamping=b.limitVelocityDamping}b.noiseTexture&&(Y.noiseTexture=b.noiseTexture.serialize())}clone(Y,b){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R={...this._customWrappers};let q=null;const A=this._engine;if(A.createEffectForParticles&&null!=this.customShader){q=this.customShader;const Y=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"",b=A.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,Y);R[0]?R[0].effect=b:this.setCustomEffect(b,0)}const E=this.serialize(C),B=Bb.Parse(E,this._scene||this._engine,this._rootUrl);return B.name=Y,B.customShader=q,B._customWrappers=R,void 0===b&&(b=this.Rb),this.noiseTexture&&(B.noiseTexture=this.noiseTexture.clone()),B.Rb=b,this.preventAutoStart||B.start(),B}}Bb.BILLBOARDMODE_Y=2,Bb.BILLBOARDMODE_ALL=7,Bb.BILLBOARDMODE_STRETCHED=8,Bb.BILLBOARDMODE_STRETCHED_LOCAL=9,kY._ParseParticleSystem=Bb.Parse;var gb=C(13081),rb=C(13077),Ob=C(12957);Ob.c.prototype.createTransformFeedback=function(){const Y=this._gl.createTransformFeedback();if(!Y)throw new Error("Unable to create Transform Feedback");return Y},Ob.c.prototype.deleteTransformFeedback=function(Y){this._gl.deleteTransformFeedback(Y)},Ob.c.prototype.bindTransformFeedback=function(Y){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,Y)},Ob.c.prototype.beginTransformFeedback=function(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(Y?this._gl.POINTS:this._gl.TRIANGLES)},Ob.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Ob.c.prototype.setTranformFeedbackVaryings=function(Y,b){this._gl.transformFeedbackVaryings(Y,b,this._gl.INTERLEAVED_ATTRIBS)},Ob.c.prototype.bindTransformFeedbackBuffer=function(Y){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Y?Y.underlyingResource:null)},Ob.c.prototype.readTransformFeedbackBuffer=function(Y){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Y)};const Fb="clipPlaneFragmentDeclaration2",yb="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";c.b.IncludesShadersStore[Fb]||(c.b.IncludesShadersStore[Fb]=yb);C(14007),C(14016),C(14022),C(14029),C(14032),C(14035),C(14039),C(14042);const Sb="gpuRenderParticlesPixelShader",nb="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";c.b.ShadersStore[Sb]||(c.b.ShadersStore[Sb]=nb);const tb="clipPlaneVertexDeclaration2",Ib="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";c.b.IncludesShadersStore[tb]||(c.b.IncludesShadersStore[tb]=Ib);C(14050),C(14055),C(14058),C(14065);const wb="gpuRenderParticlesVertexShader",Qb="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";c.b.ShadersStore[wb]||(c.b.ShadersStore[wb]=Qb);class Nb extends g{static get IsSupported(){if(!f.d.LastCreatedEngine)return!1;const Y=f.d.LastCreatedEngine.getCaps();return Y.supportTransformFeedbacks||Y.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(Y){this._maxActiveParticleCount=Math.min(Y,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(Y){this.maxActiveParticleCount=Y}createPointEmitter(Y,b){const C=aY(Y,b);return this.particleEmitterType=C,C}createHemisphericEmitter(){const Y=MY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Y,Y}createSphereEmitter(){const Y=KY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Y,Y}createDirectedSphereEmitter(){const Y=fY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R.AC(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.AC(0,1,0));return this.particleEmitterType=Y,Y}createCylinderEmitter(){const Y=ZY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Y,Y}createDirectedCylinderEmitter(){const Y=Yb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.AC(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new R.AC(0,1,0));return this.particleEmitterType=Y,Y}createConeEmitter(){const Y=bb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Y,Y}createDirectedConeEmitter(){const Y=Cb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.AC(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.AC(0,1,0));return this.particleEmitterType=Y,Y}createBoxEmitter(Y,b,C,R){const q=new F;return this.particleEmitterType=q,this.direction1=Y,this.direction2=b,this.minEmitBox=C,this.maxEmitBox=R,q}get flowMap(){return this._flowMap}set flowMap(Y){this._flowMap!==Y&&(this._flowMap=Y)}isReady(){if(!this.Rb||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Bb.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Bb.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Bb.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";Y?setTimeout((()=>{this.start(0)}),Y):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var Y;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Y=this._customWrappers[b])||void 0===Y?void 0:Y.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Y]??this._customWrappers[0]}setCustomEffect(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new YY.c(this._engine),this._customWrappers[b].effect=Y}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new M.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(Y,b,C){return super._removeGradientAndTexture(Y,b,C),this._releaseBuffers(),this}addColorGradient(Y,b){this._colorGradients||(this._colorGradients=[]);const C=new V(Y,b);return this._colorGradients.push(C),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(Y&&this._colorGradients.sort(((Y,b)=>Y.gradient<b.gradient?-1:Y.gradient>b.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(Y){return this._removeGradientAndTexture(Y,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const b in this._drawWrappers){var Y;null===(Y=this._drawWrappers[b].drawContext)||void 0===Y||Y.reset()}}_addFactorGradient(Y,b,C){const R=new x(b,C);Y.push(R),this._releaseBuffers()}addSizeGradient(Y,b){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,Y,b),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(Y){return this._removeGradientAndTexture(Y,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(Y,b){if(!Y)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&Y.sort(((Y,b)=>Y.gradient<b.gradient?-1:Y.gradient>b.gradient?1:0));const C=this;C[b]&&(C[b].dispose(),C[b]=null)}addAngularSpeedGradient(Y,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,Y,b),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(Y){return this._removeGradientAndTexture(Y,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(Y,b){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,Y,b),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(Y){return this._removeGradientAndTexture(Y,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(Y,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,Y,b),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(Y){return this._removeGradientAndTexture(Y,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(Y,b){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,Y,b),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(Y){return this._removeGradientAndTexture(Y,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(Y){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(Y,b,C){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(Y),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Sb=new M.d,this.onStoppedObservable=new M.d,this.onStartedObservable=new M.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=R.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||f.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xy.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,B.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,B.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,B.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,B.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new YY.c(this._engine)},this._customWrappers[0].effect=q,this._drawWrappers={0:new YY.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(b=b??{}).randomTextureSize||delete b.randomTextureSize;const E={jC:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...b},g=b;isFinite(g)&&(E.jC=g),this._capacity=E.jC,this._maxActiveParticleCount=E.jC,this._currentActiveCount=0,this._isAnimationSheetEnabled=A,this.particleEmitterType=new F;const r=Math.min(this._engine.getCaps().maxTextureSize,E.randomTextureSize);let O=[];for(let R=0;R<r;++R)O.push(Math.random()),O.push(Math.random()),O.push(Math.random()),O.push(Math.random());this._randomTexture=new K.b(new Float32Array(O),r,1,5,C,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,O=[];for(let R=0;R<r;++R)O.push(Math.random()),O.push(Math.random()),O.push(Math.random()),O.push(Math.random());this._randomTexture2=new K.b(new Float32Array(O),r,1,5,C,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=r}_reset(){this._releaseBuffers()}_createVertexBuffers(Y,b,C){const R={};R.position=b.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let q=3;R.age=b.createVertexBuffer("age",q,1,this._attributesStrideSize,!0),q+=1,R.size=b.createVertexBuffer("size",q,3,this._attributesStrideSize,!0),q+=3,R.life=b.createVertexBuffer("life",q,1,this._attributesStrideSize,!0),q+=1,q+=4,this.billboardMode===Bb.BILLBOARDMODE_STRETCHED&&(R.direction=b.createVertexBuffer("direction",q,3,this._attributesStrideSize,!0)),q+=3,this._platform.alignDataInBuffer&&(q+=1),this.particleEmitterType instanceof p&&(q+=3,this._platform.alignDataInBuffer&&(q+=1)),this._colorGradientsTexture||(R.color=b.createVertexBuffer("color",q,4,this._attributesStrideSize,!0),q+=4),this._isBillboardBased||(R.initialDirection=b.createVertexBuffer("initialDirection",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1)),this.noiseTexture&&(R.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1),R.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1)),R.angle=b.createVertexBuffer("angle",q,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?q++:q+=2,this._isAnimationSheetEnabled&&(R.cellIndex=b.createVertexBuffer("cellIndex",q,1,this._attributesStrideSize,!0),q+=1,this.spriteRandomStartCell&&(R.cellStartOffset=b.createVertexBuffer("cellStartOffset",q,1,this._attributesStrideSize,!0),q+=1)),R.offset=C.createVertexBuffer("offset",0,2),R.uv=C.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(R),this._platform.createVertexBuffers(Y,R),this.resetDrawCache()}_initialize(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!Y)return;const b=this._engine,C=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof p&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const q=this.particleEmitterType instanceof p,A=R.TmpVectors.AC[0];let E=0;for(let R=0;R<this._capacity;R++)if(C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),q?(this.particleEmitterType.particleDestinationGenerator(R,null,A),C.push(A.x),C.push(A.y),C.push(A.z)):(C.push(0),C.push(0),C.push(0)),this._platform.alignDataInBuffer&&C.push(0),E+=16,q&&(this.particleEmitterType.particlePositionGenerator(R,null,A),C.push(A.x),C.push(A.y),C.push(A.z),this._platform.alignDataInBuffer&&C.push(0),E+=4),this._colorGradientsTexture||(C.push(0),C.push(0),C.push(0),C.push(0),E+=4),this.isBillboardBased||(C.push(0),C.push(0),C.push(0),this._platform.alignDataInBuffer&&C.push(0),E+=4),this.noiseTexture&&(C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),E+=8),C.push(0),E+=1,this._angularSpeedGradientsTexture||(C.push(0),E+=1),this._isAnimationSheetEnabled&&(C.push(0),E+=1,this.spriteRandomStartCell&&(C.push(0),E+=1)),this._platform.alignDataInBuffer){let Y=3-(E+3&3);for(E+=Y;Y-- >0;)C.push(0)}const B=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),g=this._platform.createParticleBuffer(C),r=this._platform.createParticleBuffer(C);this._buffer0=new mY.d(b,g,!1,this._attributesStrideSize),this._buffer1=new mY.d(b,r,!1,this._attributesStrideSize),this._spriteBuffer=new mY.d(b,B,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let Y=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(Y+="\n#define BILLBOARD"),this._colorGradientsTexture&&(Y+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(Y+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(Y+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(Y+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(Y+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(Y+="\n#define DRAGGRADIENTS"),this._flowMap&&(Y+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(Y+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(Y+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(Y+="\n#define NOISE"),this.isLocal&&(Y+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===Y||(this._cachedUpdateDefines=Y,this._updateBuffer=this._platform.createUpdateBuffer(Y)),this._platform.isUpdateBufferReady()}_getWrapper(Y){const b=this._getCustomDrawWrapper(Y);if(null!==b&&void 0!==b&&b.effect)return b;const C=[];this.fillDefines(C,Y);let R=this._drawWrappers[Y];R||(R=new YY.c(this._engine),R.drawContext&&(R.drawContext.useInstancing=!0),this._drawWrappers[Y]=R);const q=C.join("\n");if(R.defines!==q){const Y=[],b=[],C=[];this.fillUniformsAttributesAndSamplerNames(b,Y,C),R.setEffect(this._engine.createEffect("gpuRenderParticles",Y,b,C,q),q)}return R}static _GetAttributeNamesOrOptions(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const q=[mY.e.PositionKind,"age","life","size","angle"];return Y||q.push(mY.e.ColorKind),b&&q.push("cellIndex"),C||q.push("initialDirection"),R&&q.push("direction"),q.push("offset",mY.e.UVKind),q}static _GetEffectCreationOptions(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R=["emitterWM","EO","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,bY.c)(R),Y&&R.push("sheetInfos"),b&&R.push("logarithmicDepthConstant"),C&&(R.push("vFogInfos"),R.push("vFogColor")),R}fillDefines(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bY.i)(this,this._scene,Y),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==rb.b.FOGMODE_NONE&&Y.push("#define FOG")),b===Bb.BLENDMODE_MULTIPLY&&Y.push("#define BLENDMULTIPLYMODE"),this.isLocal&&Y.push("#define LOCAL"),this.useLogarithmicDepth&&Y.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(Y.push("#define BILLBOARD"),this.billboardMode){case Bb.BILLBOARDMODE_Y:Y.push("#define BILLBOARDY");break;case Bb.BILLBOARDMODE_STRETCHED:Y.push("#define BILLBOARDSTRETCHED");break;case Bb.BILLBOARDMODE_ALL:Y.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&Y.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&Y.push("#define ANIMATESHEET"),C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Y.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Y,b,C){b.push(...Nb._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Bb.BILLBOARDMODE_STRETCHED)),Y.push(...Nb._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(gb.d.PrepareUniforms(Y,this._imageProcessingConfigurationDefines),gb.d.PrepareSamplers(C,this._imageProcessingConfigurationDefines))}animate(){var Y;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(b?this.preWarmStepOffset:(null===(Y=this._scene)||void 0===Y?void 0:Y.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(Y,b){const C=this[b];if(!Y||!Y.length||C)return;const R=new Float32Array(this._rawTextureWidth);for(let q=0;q<this._rawTextureWidth;q++){const b=q/this._rawTextureWidth;a.GetCurrentGradient(b,Y,((Y,b,C)=>{R[q]=(0,r.Lerp)(Y.factor1,b.factor1,C)}))}this[b]=K.b.CreateRTexture(R,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[b].name=b.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const Y=new Uint8Array(4*this._rawTextureWidth),b=E.TmpColors.hb[0];for(let C=0;C<this._rawTextureWidth;C++){const R=C/this._rawTextureWidth;a.GetCurrentGradient(R,this._colorGradients,((R,q,A)=>{E.hb.LerpToRef(R.color1,q.color1,A,b),Y[4*C]=255*b.r,Y[4*C+1]=255*b.g,Y[4*C+2]=255*b.b,Y[4*C+3]=255*b.a}))}this._colorGradientsTexture=K.b.CreateRGBATexture(Y,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(Y,b){var C,q,A,E;const B=this._getWrapper(Y),g=B.effect;this._engine.enableEffect(B);const r=(null===(C=this._scene)||void 0===C?void 0:C.getViewMatrix())||R.Matrix.IdentityReadOnly;if(g.setMatrix("view",r),g.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),g.setTexture("diffuseSampler",this.particleTexture),g.setVector2("translationPivot",this.translationPivot),g.setVector3("EO",this.EO),this.isLocal&&g.setMatrix("emitterWM",b),this._colorGradientsTexture?g.setTexture("colorGradientSampler",this._colorGradientsTexture):g.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const Y=this.particleTexture.getBaseSize();g.setFloat3("sheetInfos",this.spriteCellWidth/Y.width,this.spriteCellHeight/Y.height,Y.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const Y=this._scene.activeCamera;g.setVector3("eyePosition",Y.globalPosition)}const O=g.defines;if(this._scene&&((0,bY.g)(g,this,this._scene),this.applyFog&&(0,CY.h)(this._scene,void 0,g)),O.indexOf("#define BILLBOARDMODE_ALL")>=0){const Y=r.clone();Y.invert(),g.setMatrix("invView",Y)}return this.useLogarithmicDepth&&this._scene&&(0,CY.n)(O,g,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(g),this._setEngineBasedOnBlendMode(Y),this._platform.bindDrawBuffers(this._targetIndex,g,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(g),null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(E=this._scene)&&void 0!==E&&E.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(Y){if(!this.Rb||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!Y)if(this.Rb.position){Y=this.Rb.getWorldMatrix()}else{const b=this.Rb;Y=R.TmpVectors.Matrix[0],R.Matrix.TranslationToRef(b.x,b.y,b.z,Y)}const b=this._engine,C=b.getDepthWrite();if(b.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const Y=this.uY();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",Y.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",Y),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=q,b.setDepthWrite(C)}render(){let Y,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!b&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let Y=0;Y<this.preWarmCycles;Y++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const Y=0|this._accumulatedCount;this._accumulatedCount-=Y,this._currentActiveCount+=Y}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Rb.position){Y=this.Rb.getWorldMatrix()}else{const b=this.Rb;Y=R.TmpVectors.Matrix[0],R.Matrix.TranslationToRef(b.x,b.y,b.z,Y)}const q=this._engine;this.updateInAnimate||this._update(Y);let A=0;return b||C||(q.setState(!1),this.forceDepthWrite&&q.setDepthWrite(!0),A=this.blendMode===Bb.BLENDMODE_MULTIPLYADD?this._render(Bb.BLENDMODE_MULTIPLY,Y)+this._render(Bb.BLENDMODE_ADD,Y):this._render(this.blendMode,Y),this._engine.setAlphaMode(0)),A}rebuild(){const Y=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(Y,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,Y()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const b in this._drawWrappers){this._drawWrappers[b].dispose()}if(this._drawWrappers={},this._scene){const Y=this._scene.xy.indexOf(this);Y>-1&&this._scene.xy.splice(Y,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let b=0;b<this._renderVertexBuffers.length;++b){const Y=this._renderVertexBuffers[b];for(const b in Y)Y[b].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),Y&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Y&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Sb.notifyObservers(this),this.Sb.clear()}clone(Y,b){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R={...this._customWrappers};let q=null;const A=this._engine;if(A.createEffectForParticles&&null!=this.customShader){q=this.customShader;const Y=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"";R[0]=A.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,Y,void 0,void 0,void 0,this)}const E=this.serialize(C),B=Nb.Parse(E,this._scene||this._engine,this._rootUrl);return B.name=Y,B.customShader=q,B._customWrappers=R,void 0===b&&(b=this.Rb),this.noiseTexture&&(B.noiseTexture=this.noiseTexture.clone()),B.Rb=b,B}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return Bb._Serialize(b,this,Y),b.activeParticleCount=this.activeParticleCount,b.randomTextureSize=this._randomTextureSize,b.customShader=this.customShader,b}static Parse(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0;const A=Y.name;let E,B;b instanceof xY.b?E=b:(B=b,E=B.getEngine());const g=new Nb(A,{jC:q||Y.jC,randomTextureSize:Y.randomTextureSize},b,null,Y.isAnimationSheetEnabled);if(g._rootUrl=C,Y.customShader&&E.createEffectForParticles){const b=Y.customShader,C=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",R=E.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,C,void 0,void 0,void 0,g);g.setCustomEffect(R,0),g.customShader=b}return Y.id&&(g.id=Y.id),Y.activeParticleCount&&(g.activeParticleCount=Y.activeParticleCount),Bb._Parse(Y,g,b,C),Y.preventAutoStart&&(g.preventAutoStart=Y.preventAutoStart),R||g.preventAutoStart||g.start(),g}}var pb=C(12645),mC=C(14072),Lb=C(13196);class ub{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(Y){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const b of this.systems)b.Rb=Y;this._emitterNode=Y}setEmitterAsSphere(Y,b,C){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:Y,renderingGroupId:b};const R=(0,mC.c)("emitterSphere",{diameter:Y.diameter,segments:Y.segments},C);R.renderingGroupId=b;const q=new Lb.gC("emitterSphereMaterial",C);q.emissiveColor=Y.color,R.material=q;for(const A of this.systems)A.Rb=R;this._emitterNode=R}start(Y){for(const b of this.systems)Y&&(b.Rb=Y),b.start()}dispose(){for(const Y of this.systems)Y.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={systems:[]};for(const C of this.systems)b.systems.push(C.serialize(Y));return this._emitterNode&&(b.Rb=this._emitterCreationOptions),b}static Parse(Y,b){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3?arguments[3]:void 0;const q=new ub,A=this.BaseAssetsUrl+"/textures/";b=b||f.d.LastCreatedScene;for(const E of Y.systems)q.systems.push(C?Nb.Parse(E,b,A,!0,R):Bb.Parse(E,b,A,!0,R));if(Y.Rb){const C=Y.Rb.options;if("Sphere"===Y.Rb.kind)q.setEmitterAsSphere({diameter:C.diameter,segments:C.segments,color:E.rC.OC(C.color)},Y.Rb.renderingGroupId,b)}return q}}ub.BaseAssetsUrl="https://assets.babylonjs.com/particles";var cb=C(12696);class lb{static CreateDefault(Y){let b,C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,R=arguments.length>2?arguments[2]:void 0;b=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Nb("default system",{jC:C},R):new Bb("default system",C,R),b.Rb=Y;const q=pb.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return b.particleTexture=new U.b(q,b.uY()),b.createConeEmitter(.1,Math.PI/4),b.color1=new E.hb(1,1,1,1),b.color2=new E.hb(1,1,1,1),b.colorDead=new E.hb(1,1,1,0),b.minSize=.1,b.maxSize=.1,b.minEmitPower=2,b.maxEmitPower=2,b.updateSpeed=1/60,b.emitRate=30,b}static CreateAsync(Y,b){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3?arguments[3]:void 0;b||(b=f.d.LastCreatedScene);const q={};return b.addPendingData(q),new Promise(((A,E)=>{if(C&&!Nb.IsSupported)return b.removePendingData(q),E("Particle system with GPU is not supported.");pb.Tools.LoadFile(`${lb.BaseAssetsUrl}/systems/${Y}.json`,(Y=>{b.removePendingData(q);const E=JSON.parse(Y.toString());return A(ub.Parse(E,b,C,R))}),void 0,void 0,void 0,(()=>(b.removePendingData(q),E(`An error occurred with the creation of your particle system. Check if your type '${Y}' exists.`))))}))}static ExportSet(Y){const b=new ub;for(const C of Y)b.systems.push(C);return b}static ParseFromFileAsync(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",A=arguments.length>5?arguments[5]:void 0;return new Promise(((E,B)=>{const g=new cb.e;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const b=JSON.parse(g.responseText);let B;B=R?Nb.Parse(b,C,q,!1,A):Bb.Parse(b,C,q,!1,A),Y&&(B.name=Y),E(B)}else B("Unable to load the particle system")})),g.open("GET",b),g.send()}))}static ParseFromSnippetAsync(Y,b){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",q=arguments.length>4?arguments[4]:void 0;if("_BLANK"===Y){const Y=this.CreateDefault(null);return Y.start(),Promise.resolve(Y)}return new Promise(((A,E)=>{const B=new cb.e;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const E=JSON.parse(JSON.parse(B.responseText).jsonPayload),g=JSON.parse(E.particleSystem);let r;r=C?Nb.Parse(g,b,R,!1,q):Bb.Parse(g,b,R,!1,q),r.snippetId=Y,A(r)}else E("Unable to load the snippet "+Y)})),B.open("GET",this.SnippetUrl+"/"+Y.replace(/#/g,"/")),B.send()}))}}lb.BaseAssetsUrl=ub.BaseAssetsUrl,lb.SnippetUrl="https://snippet.babylonjs.com",lb.CreateFromSnippetAsync=lb.ParseFromSnippetAsync;var Xb=C(13273),jb=C(13096),Tb=C(14080);(0,Tb.e)(jb.c.NAME_PARTICLESYSTEM,((Y,b,C,R)=>{const q=(0,Tb.f)(jb.c.NAME_PARTICLESYSTEM);if(q&&void 0!==Y.xy&&null!==Y.xy)for(let A=0,E=Y.xy.length;A<E;A++){const E=Y.xy[A];C.xy.push(q(E,b,R))}})),(0,Tb.b)(jb.c.NAME_PARTICLESYSTEM,((Y,b,C)=>{if(Y.activeParticleCount){return Nb.Parse(Y,b,C)}return Bb.Parse(Y,b,C)})),xY.b.prototype.createEffectForParticles=function(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",A=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0,g=arguments.length>7?arguments[7]:void 0,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,O=arguments.length>9?arguments[9]:void 0,F=[],y=[];const S=[];return g?g.fillUniformsAttributesAndSamplerNames(y,F,S):(F=Bb._GetAttributeNamesOrOptions(),y=Bb._GetEffectCreationOptions()),-1===q.indexOf(" BILLBOARD")&&(q+="\n#define BILLBOARD\n"),null!==g&&void 0!==g&&g.isAnimationSheetEnabled&&-1===q.indexOf(" ANIMATESHEET")&&(q+="\n#define ANIMATESHEET\n"),-1===R.indexOf("diffuseSampler")&&R.push("diffuseSampler"),this.createEffect({vertex:O??(null===g||void 0===g?void 0:g.vertexShaderName)??"particles",fragmentElement:Y},F,y.concat(b),S.concat(R),q,A,E,B,void 0,r,(async()=>{0===r?await Promise.resolve().then(C.bind(C,14108)):await Promise.resolve().then(C.bind(C,14180))}))},Xb.d.prototype.getEmittedParticleSystems=function(){const Y=[];for(let b=0;b<this.uY().xy.length;b++){const C=this.uY().xy[b];C.Rb===this&&Y.push(C)}return Y},Xb.d.prototype.getHierarchyEmittedParticleSystems=function(){const Y=[],b=this.getDescendants();b.push(this);for(let C=0;C<this.uY().xy.length;C++){const R=this.uY().xy[C],q=R.Rb;q.position&&-1!==b.indexOf(q)&&Y.push(R)}return Y};C(13156),C(13165),C(13249);C(13258),C(14084),C(13029),C(13151),C(13303);C(13022);var Pb;C(14089),C(12860);!function(Y){Y[Y.Color=2]="Color",Y[Y.UV=1]="UV",Y[Y.Random=0]="Random",Y[Y.Stated=3]="Stated"}(Pb||(Pb={}));var vb=C(13062);const zb=new R.AC(0,0,0),Jb=new R.AC(0,0,0),Ub=new R.AC(0,0,0);class ob{constructor(Y,b,C){this.width=Y,this.height=b,this.data=C}processFlowable(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;if(!C)return;C instanceof R.Matrix?R.AC.TransformCoordinatesToRef(Y.position,C,Ub):(Ub.x=C.x,Ub.y=C.y,Ub.z=C.z);const q=.5*Ub.x+.5,A=1-(.5*Ub.y+.5),E=Math.floor(q*this.width),B=Math.floor(A*this.height);if(E<0||E>=this.width||B<0||B>=this.height)return;const g=4*(B*this.width+E),r=this.data[g]/255*2-1,O=this.data[g+1]/255*2-1,F=this.data[g+2]/255*2-1,y=this.data[g+3]/255;zb.set(r,O,F),zb.scaleToRef(b*y,Jb),Y.direction.addInPlace(Jb)}_processParticle(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;this.processFlowable(Y,b,C)}static async FromUrlAsync(Y){return await new Promise(((b,C)=>{const R=document.createElement("canvas"),q=R.getContext("2d");let A=null;const E=new Image;E.crossOrigin="anonymous",E.src=Y,E.onerror=b=>{C(new Error(`Failed to load image: ${Y} : ${b}`))},E.onload=()=>{R.width=E.width,R.height=E.height,q.drawImage(E,0,0),A=q.getImageData(0,0,R.width,R.height),b(new ob(R.width,R.height,A.data))}}))}static async ExtractFromTextureAsync(Y){return await new Promise(((b,C)=>{if(!Y.isReady())return void Y.onLoadObservable.addOnce((async()=>{try{const C=await this.ExtractFromTextureAsync(Y);b(C)}catch(R){C(R)}}));const R=Y.getSize();vb.n.GetTextureDataAsync(Y,R.width,R.height).then((Y=>{b(new ob(R.width,R.height,new Uint8ClampedArray(Y)))})).catch(C)}))}}var Gb,hb,eb,Hb,ib,Wb,sb,Db,db;!function(Y){Y[Y.Int=1]="Int",Y[Y.Float=2]="Float",Y[Y.Vector2=4]="Vector2",Y[Y.AC=8]="AC",Y[Y.Matrix=16]="Matrix",Y[Y.Particle=32]="Particle",Y[Y.Texture=64]="Texture",Y[Y.hb=128]="hb",Y[Y.FloatGradient=256]="FloatGradient",Y[Y.Vector2Gradient=512]="Vector2Gradient",Y[Y.Vector3Gradient=1024]="Vector3Gradient",Y[Y.Color4Gradient=2048]="Color4Gradient",Y[Y.System=4096]="System",Y[Y.AutoDetect=8192]="AutoDetect",Y[Y.BasedOnInput=16384]="BasedOnInput",Y[Y.Undefined=32768]="Undefined",Y[Y.All=65535]="All"}(Gb||(Gb={})),function(Y){Y[Y.Compatible=0]="Compatible",Y[Y.TypeIncompatible=1]="TypeIncompatible",Y[Y.HierarchyIssue=2]="HierarchyIssue"}(hb||(hb={})),function(Y){Y[Y.Input=0]="Input",Y[Y.Output=1]="Output"}(eb||(eb={}));class Vb{get direction(){return this._direction}get type(){if(this._type===Gb.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Gb.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(Y){this._type=Y}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((Y=>Y.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(Y,b,C){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Gb.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new M.d,this.onDisconnectionObservable=new M.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=b,this.name=Y,this._direction=C}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(Y){var b;return this.isConnected?null!==(b=this._connectedPoint)&&void 0!==b&&b._storedFunction?this._connectedPoint._storedFunction(Y):this._connectedPoint._storedValue:this.value}canConnectTo(Y){return 0===this.checkCompatibilityState(Y)}checkCompatibilityState(Y){const b=this._ownerBlock,C=Y.ownerBlock;if(this.type!==Y.type&&Y.innerType!==Gb.AutoDetect)return Y.acceptedConnectionPointTypes&&-1!==Y.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(Y.excludedConnectionPointTypes&&-1!==Y.excludedConnectionPointTypes.indexOf(this.type))return 1;let R=C,q=b;return 0===this.direction&&(R=b,q=C),R.isAnAncestorOf(q)?2:0}connectTo(Y){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(Y))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${Y.ownerBlock.name}".${Y.name}`;return this._endpoints.push(Y),Y._connectedPoint=this,this.onConnectionObservable.notifyObservers(Y),Y.onConnectionObservable.notifyObservers(this),this}disconnectFrom(Y){const b=this._endpoints.indexOf(Y);return-1===b||(this._endpoints.splice(b,1),Y._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(Y),Y.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(Y){let b=1;for(;b<Gb.All;)Y&b||this.excludedConnectionPointTypes.push(b),b<<=1}serialize(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const b={};return b.name=this.name,b.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.cb?(b.valueType="BABYLON."+this.value.getClassName(),b.value=this.value.cb()):(b.valueType="number",b.value=this.value)),Y&&this.connectedPoint&&(b.inputName=this.name,b.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,b.targetConnectionName=this.connectedPoint.name,b.isExposedOnFrame=!0,b.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(b.isExposedOnFrame=!0,b.exposedPortPosition=this.exposedPortPosition),b}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class kb{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(Y){this._name=Y}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(Y){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new M.d,this.Sb=new M.d,this.onInputChangedObservable=new M.d,this.visibleOnFrame=!1,this._name=Y,this.uniqueId=o.b.UniqueId}_inputRename(Y){return Y}_outputRename(Y){return Y}isAnAncestorOf(Y){for(const b of this._outputs)if(b.hasEndpoints)for(const C of b.endpoints){if(C.ownerBlock===Y)return!0;if(C.ownerBlock.isAnAncestorOf(Y))return!0}return!1}isAnAncestorOfType(Y){if(this.getClassName()===Y)return!0;for(const b of this._outputs)if(b.hasEndpoints)for(const C of b.endpoints)if(C.ownerBlock.isAnAncestorOfType(Y))return!0;return!1}getInputByName(Y){const b=this._inputs.filter((b=>b.name===Y));return b.length?b[0]:null}_linkConnectionTypes(Y,b){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[b]._acceptedConnectionPointType=this._inputs[Y]:(this._inputs[Y]._linkedConnectionSource=this._inputs[b],this._inputs[Y]._isMainLinkSource=!0),this._inputs[b]._linkedConnectionSource=this._inputs[Y]}registerInput(Y,b){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0;const E=new Vb(Y,this,0);return E.type=b,E.isOptional=C,E.defaultValue=R,E.value=R,E.valueMin=q,E.valueMax=A,this._inputs.push(E),this.onInputChangedObservable.notifyObservers(E),this}registerOutput(Y,b,C){return(C=C??new Vb(Y,this,1)).type=b,this._outputs.push(C),this}_build(Y){}_customBuildStep(Y){}build(Y){if(this._buildId===Y.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((Y=>Y.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=Y.buildId;for(const b of this._inputs){if(!b.connectedPoint){b.isOptional||Y.notConnectedNonOptionalInputs.push(b);continue}const C=b.connectedPoint.ownerBlock;C&&C!==this&&!C.isSystem&&C.build(Y)}return this._customBuildStep(Y),Y.verbose&&G.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(Y),this.onBuildObservable.notifyObservers(this),!1}serialize(){const Y={};Y.customType="BABYLON."+this.getClassName(),Y.id=this.uniqueId,Y.name=this.name,Y.visibleOnFrame=this.visibleOnFrame,Y.inputs=[],Y.outputs=[];for(const b of this.inputs)Y.inputs.push(b.serialize());for(const b of this.outputs)Y.outputs.push(b.serialize(!1));return Y}_deserialize(Y){this._name=Y.name,this.comments=Y.comments,this.visibleOnFrame=!!Y.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(Y)}_deserializePortDisplayNamesAndExposedOnFrame(Y){const b=Y.inputs,C=Y.outputs;if(b)for(const R of b){const Y=this.inputs.find((Y=>Y.name===R.name));if(!Y)return;if(R.displayName&&(Y.displayName=R.displayName),R.isExposedOnFrame&&(Y.isExposedOnFrame=R.isExposedOnFrame,Y.exposedPortPosition=R.exposedPortPosition),void 0!==R.value&&null!==R.value)if("number"===R.valueType)Y.value=R.value;else{const b=(0,B.c)(R.valueType);b&&(Y.value=b.OC(R.value))}}if(C)for(let R=0;R<C.length;R++){const Y=C[R];Y.displayName&&(this.outputs[R].displayName=Y.displayName),Y.isExposedOnFrame&&(this.outputs[R].isExposedOnFrame=Y.isExposedOnFrame,this.outputs[R].exposedPortPosition=Y.exposedPortPosition)}}clone(){const Y=this.serialize(),b=(0,B.c)(Y.customType);if(b){const C=new b;return C._deserialize(Y),C}return null}dispose(){this.Sb.notifyObservers(this),this.Sb.clear();for(const Y of this.inputs)Y.dispose();for(const Y of this.outputs)Y.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function xb(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",R=arguments.length>3?arguments[3]:void 0;return(q,A)=>{let E=q._propStore;E||(E=[],q._propStore=E),E.push({propertyName:A,displayName:Y,type:b,groupName:C,options:R??{},className:q.getClassName()})}}(0,v.c)([(0,z.K)("comment")],kb.prototype,"comments",void 0),function(Y){Y[Y.Boolean=0]="Boolean",Y[Y.Float=1]="Float",Y[Y.Int=2]="Int",Y[Y.Vector2=3]="Vector2",Y[Y.List=4]="List",Y[Y.hb=5]="hb",Y[Y.SamplingMode=6]="SamplingMode",Y[Y.TextureFormat=7]="TextureFormat",Y[Y.TextureType=8]="TextureType"}(Hb||(Hb={})),function(Y){Y[Y.None=0]="None",Y[Y.Position=1]="Position",Y[Y.Direction=2]="Direction",Y[Y.Age=3]="Age",Y[Y.Lifetime=4]="Lifetime",Y[Y.Color=5]="Color",Y[Y.ScaledDirection=6]="ScaledDirection",Y[Y.Scale=7]="Scale",Y[Y.AgeGradient=8]="AgeGradient",Y[Y.Angle=9]="Angle",Y[Y.SpriteCellIndex=16]="SpriteCellIndex",Y[Y.SpriteCellStart=17]="SpriteCellStart",Y[Y.SpriteCellEnd=18]="SpriteCellEnd"}(ib||(ib={})),function(Y){Y[Y.None=0]="None",Y[Y.Time=1]="Time",Y[Y.Delta=2]="Delta",Y[Y.Emitter=3]="Emitter"}(Wb||(Wb={}));class ab{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let Y="";for(const b of this.notConnectedNonOptionalInputs)Y+=`input ${b.name} from block ${b.ownerBlock.name}[${b.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(Y)throw"Build of Node Particle System Set failed:\n"+Y}adapt(Y,b){const C=Y.getConnectedValue(this)||0;if(Y.type===b)return C;switch(b){case Gb.Vector2:return new R.Vector2(C,C);case Gb.AC:return new R.AC(C,C,C);case Gb.hb:return new E.hb(C,C,C,C)}return null}getContextualValue(Y){if(!this.particleContext||!this.systemContext)return null;switch(Y){case ib.Position:return this.particleContext.position;case ib.Direction:return this.particleContext.direction;case ib.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case ib.Color:return this.particleContext.color;case ib.Age:return this.particleContext.age;case ib.Lifetime:return this.particleContext.lifeTime;case ib.Angle:return this.particleContext.angle;case ib.Scale:return this.particleContext.scale;case ib.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case ib.SpriteCellEnd:return this.systemContext.endSpriteCellID;case ib.SpriteCellIndex:return this.particleContext.cellIndex;case ib.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Rb.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Rb.absolutePosition:this.systemContext.Rb:null}getSystemValue(Y){if(!this.particleContext||!this.systemContext)return null;switch(Y){case Wb.Time:return this.systemContext._actualFrame;case Wb.Delta:return this.systemContext._scaledUpdateSpeed;case Wb.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Rb.absolutePosition}return this.systemContext.Rb}return null}}function Mb(Y,b,C){const R=new ab;R.BC=b;const q=Y.createSystem(R);return q.canStart=()=>!0,q.Rb=C.clone(),q.disposeOnStop=!0,q.start(),q}class Kb extends kb{constructor(Y){super(Y),this.blendMode=g.BLENDMODE_ONEONE,this.jC=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Gb.Particle),this.registerInput("texture",Gb.Texture),this.registerInput("onStart",Gb.System,!0),this.registerInput("onEnd",Gb.System,!0),this.registerOutput("system",Gb.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(Y){Y.jC=this.jC,Y.buildId=this._buildId++,this.build(Y);const b=this.particle.getConnectedValue(Y);return b.particleTexture=this.texture.getConnectedValue(Y),b.emitRate=this.emitRate,b.blendMode=this.blendMode,b.name=this.name,b._nodeGenerated=!0,b._targetStopDuration=this.targetStopDuration,b.startDelay=this.startDelay,this.system._storedValue=this,b.canStart=()=>!this.doNoStart,b.onStartedObservable.add((C=>{const R=this.onStart.getConnectedValue(Y);R&&C.onStartedObservable.addOnce((()=>{Y.systemContext=b;const C=Mb(R,Y.BC,Y.emitterPosition);this.Sb.addOnce((()=>{C.dispose()}))}));const q=this.onEnd.getConnectedValue(Y);q&&C.onStoppedObservable.addOnce((()=>{Y.systemContext=b;const C=Mb(q,Y.BC,Y.emitterPosition);this.Sb.addOnce((()=>{C.dispose()}))}))})),this.Sb.addOnce((()=>{b.dispose()})),b}serialize(){const Y=super.serialize();return Y.jC=this.jC,Y.emitRate=this.emitRate,Y.blendMode=this.blendMode,Y.doNoStart=this.doNoStart,Y.targetStopDuration=this.targetStopDuration,Y.startDelay=this.startDelay,Y}_deserialize(Y){super._deserialize(Y),this.jC=Y.jC,this.emitRate=Y.emitRate,this.doNoStart=!!Y.doNoStart,void 0!==Y.blendMode&&(this.blendMode=Y.blendMode),void 0!==Y.targetStopDuration&&(this.targetStopDuration=Y.targetStopDuration),void 0!==Y.startDelay&&(this.startDelay=Y.startDelay)}}(0,v.c)([xb("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:g.BLENDMODE_ONEONE},{label:"Standard",value:g.BLENDMODE_STANDARD},{label:"Add",value:g.BLENDMODE_ADD},{label:"Multiply",value:g.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:g.BLENDMODE_MULTIPLYADD}]})],Kb.prototype,"blendMode",void 0),(0,v.c)([xb("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Kb.prototype,"jC",void 0),(0,v.c)([xb("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Kb.prototype,"emitRate",void 0),(0,v.c)([xb("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Kb.prototype,"targetStopDuration",void 0),(0,v.c)([xb("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Kb.prototype,"startDelay",void 0),(0,v.c)([xb("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Kb.prototype,"doNoStart",void 0),(0,B.g)("BABYLON.SystemBlock",Kb);class fb extends kb{get type(){if(this._type===Gb.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Gb.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Gb.Vector2,this._type;case"AC":return this._type=Gb.AC,this._type;case"hb":return this._type=Gb.hb,this._type;case"Matrix":return this._type=Gb.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===ib.None&&this._systemSource!==Wb.None}get systemSource(){return this._systemSource}set systemSource(Y){if(this._systemSource=Y,Y!==Wb.None){switch(this._contextualSource=ib.None,this._type=Gb.Float,Y){case Wb.Time:case Wb.Delta:this._type=Gb.Float;break;case Wb.Emitter:this._type=Gb.AC}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==ib.None}get contextualValue(){return this._contextualSource}set contextualValue(Y){if(this._contextualSource=Y,Y!==ib.None){switch(this._systemSource=Wb.None,Y){case ib.Scale:this._type=Gb.Vector2;break;case ib.Position:case ib.Direction:case ib.ScaledDirection:this._type=Gb.AC;break;case ib.Color:this._type=Gb.hb;break;case ib.Age:case ib.Lifetime:case ib.Angle:case ib.AgeGradient:this._type=Gb.Float;break;case ib.SpriteCellEnd:case ib.SpriteCellStart:case ib.SpriteCellIndex:this._type=Gb.Int}this.output&&(this.output.type=this._type)}}constructor(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gb.AutoDetect;super(Y),this._type=Gb.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new M.d,this._systemSource=Wb.None,this._contextualSource=ib.None,this._type=b,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",b)}get value(){return this._storedValue}set value(Y){this.type===Gb.Float&&this.min!==this.max&&(Y=Math.max(this.min,Y),Y=Math.min(this.max,Y)),this._storedValue=Y,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(Y){this._valueCallback=Y}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Gb.Int:case Gb.Float:this.value=0;break;case Gb.Vector2:this.value=R.Vector2.Zero();break;case Gb.AC:this.value=R.AC.Zero();break;case Gb.hb:this.value=new E.hb(1,1,1,1);break;case Gb.Matrix:this.value=R.Matrix.Identity()}}_build(Y){super._build(Y),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=Y=>Y.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=Y=>Y.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const Y=super.serialize();return Y.type=this.type,Y.contextualValue=this.contextualValue,Y.systemSource=this.systemSource,Y.min=this.min,Y.max=this.max,Y.groupInInspector=this.groupInInspector,Y.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.cb?(Y.valueType="BABYLON."+this._storedValue.getClassName(),Y.value=this._storedValue.cb()):(Y.valueType="number",Y.value=this._storedValue)),Y}_deserialize(Y){if(super._deserialize(Y),this._type=Y.type,this.contextualValue=Y.contextualValue,this.systemSource=Y.systemSource||Wb.None,this.min=Y.min||0,this.max=Y.max||0,this.groupInInspector=Y.groupInInspector||"",void 0!==Y.displayInInspector&&(this.displayInInspector=Y.displayInInspector),Y.valueType)if("number"===Y.valueType)this._storedValue=Y.value;else{const b=(0,B.c)(Y.valueType);b&&(this._storedValue=b.OC(Y.value))}}}(0,B.g)("BABYLON.ParticleInputBlock",fb);class Zb extends kb{get url(){return this._url}set url(Y){this._url!==Y&&(this._cachedData=null,this._url=Y,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(Y){this._textureDataUrl!==Y&&(this._cachedData=null,this._textureDataUrl=Y,this._url="",this._sourceTexture=null)}set sourceTexture(Y){this._sourceTexture!==Y&&(this._cachedData=null,this._sourceTexture=Y,this._url="",this._textureDataUrl="")}constructor(Y){super(Y),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Gb.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const Y=this.texture._storedValue;return await new Promise(((b,C)=>{if(!Y.isReady())return void Y.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),b(this._cachedData)}catch(Y){C(Y)}}));const R=Y.getSize();vb.n.GetTextureDataAsync(Y,R.width,R.height).then((C=>{this._cachedData={width:R.width,height:R.height,data:new Uint8ClampedArray(C)},Y.dispose(),b(this._cachedData)})).catch(C)}))}_build(Y){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new U.b(this._textureDataUrl,Y.BC):this.texture._storedValue=new U.b(this._url,Y.BC):this.texture._storedValue=null}serialize(){const Y=super.serialize();return Y.url=this.url,Y.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(Y.textureDataUrl=this.textureDataUrl),Y}_deserialize(Y){super._deserialize(Y),this.url=Y.url,this.serializedCachedData=!!Y.serializedCachedData,Y.textureDataUrl&&(this.textureDataUrl=Y.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,B.g)("BABYLON.ParticleTextureSourceBlock",Zb);class YC extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerInput("position",Gb.AC),this.registerOutput("output",Gb.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(Y){const b=this.particle.getConnectedValue(Y);if(this.output._storedValue=b,!this.position.isConnected)return;const C={process:C=>{Y.particleContext=C,Y.systemContext=b,C.position.q(this.position.getConnectedValue(Y))},previousItem:null,nextItem:null};b._updateQueueStart?WY(C,b._updateQueueStart):b._updateQueueStart=C}}(0,B.g)("BABYLON.UpdatePositionBlock",YC),function(Y){Y[Y.Add=0]="Add",Y[Y.Subtract=1]="Subtract",Y[Y.Multiply=2]="Multiply",Y[Y.Divide=3]="Divide",Y[Y.Max=4]="Max",Y[Y.Min=5]="Min"}(sb||(sb={}));class bC extends kb{constructor(Y){super(Y),this.operation=sb.Add,this.registerInput("left",Gb.AutoDetect),this.registerInput("right",Gb.AutoDetect),this.registerOutput("output",Gb.BasedOnInput),this.output._typeConnectionSource=this.left;const b=[Gb.Matrix,Gb.Particle,Gb.Texture,Gb.System,Gb.FloatGradient,Gb.Color4Gradient,Gb.Vector2Gradient,Gb.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...b),this.right.excludedConnectionPointTypes.push(...b),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(Y){let b;const C=this.left,q=this.right;if(!C.isConnected||!q.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const A=C.type===Gb.Float||C.type===Gb.Int,B=q.type===Gb.Float||q.type===Gb.Int,g=A&&B;switch(this.operation){case sb.Add:b=g?Y=>C.getConnectedValue(Y)+q.getConnectedValue(Y):A?Y=>Y.adapt(C,q.type).add(q.getConnectedValue(Y)):Y=>C.getConnectedValue(Y).add(Y.adapt(q,C.type));break;case sb.Subtract:b=g?Y=>C.getConnectedValue(Y)-q.getConnectedValue(Y):A?Y=>Y.adapt(C,q.type).EC(q.getConnectedValue(Y)):Y=>C.getConnectedValue(Y).EC(Y.adapt(q,C.type));break;case sb.Multiply:b=g?Y=>C.getConnectedValue(Y)*q.getConnectedValue(Y):A?Y=>Y.adapt(C,q.type).multiply(q.getConnectedValue(Y)):Y=>C.getConnectedValue(Y).multiply(Y.adapt(q,C.type));break;case sb.Divide:b=g?Y=>C.getConnectedValue(Y)/q.getConnectedValue(Y):A?Y=>Y.adapt(C,q.type).divide(q.getConnectedValue(Y)):Y=>C.getConnectedValue(Y).divide(Y.adapt(q,C.type));break;case sb.Min:if(g)b=Y=>Math.min(C.getConnectedValue(Y),q.getConnectedValue(Y));else{const[Y,B]=A?[q,C]:[C,q];switch(Y.type){case Gb.Vector2:b=b=>R.Vector2.Minimize(Y.getConnectedValue(b),b.adapt(B,Y.type));break;case Gb.AC:b=b=>R.AC.Minimize(Y.getConnectedValue(b),b.adapt(B,Y.type));break;case Gb.hb:b=b=>{const C=Y.getConnectedValue(b),{r:R,g:q,b:A,a:g}=b.adapt(B,Y.type);return new E.hb(Math.min(C.r,R),Math.min(C.g,q),Math.min(C.b,A),Math.min(C.a,g))}}}break;case sb.Max:if(!g){const[Y,B]=A?[q,C]:[C,q];switch(Y.type){case Gb.Vector2:b=b=>R.Vector2.Maximize(Y.getConnectedValue(b),b.adapt(B,Y.type));break;case Gb.AC:b=b=>R.AC.Maximize(Y.getConnectedValue(b),b.adapt(B,Y.type));break;case Gb.hb:b=b=>{const C=Y.getConnectedValue(b),{r:R,g:q,b:A,a:g}=b.adapt(B,Y.type);return new E.hb(Math.max(C.r,R),Math.min(C.g,q),Math.min(C.b,A),Math.min(C.a,g))}}break}b=Y=>Math.max(C.getConnectedValue(Y),q.getConnectedValue(Y))}this.output._storedFunction=Y=>C.type===Gb.Int?0|b(Y):b(Y)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Gb.Int||this.left.type===Gb.Float&&this.right.type!==Gb.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[Y,b]of[[this.left,this.right],[this.right,this.left]])Y.acceptedConnectionPointTypes=[Gb.Int,Gb.Float],b.isConnected&&(Y.acceptedConnectionPointTypes.push(b.type),b.type!==Gb.Int&&b.type!==Gb.Float||Y.acceptedConnectionPointTypes.push(Gb.Vector2,Gb.AC,Gb.hb))}dispose(){super.dispose();for(const Y of this._connectionObservers)Y.remove();this._connectionObservers.length=0}serialize(){const Y=super.serialize();return Y.operation=this.operation,Y}_deserialize(Y){super._deserialize(Y),this.operation=Y.operation}}(0,v.c)([xb("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:sb.Add},{label:"Subtract",value:sb.Subtract},{label:"Multiply",value:sb.Multiply},{label:"Divide",value:sb.Divide},{label:"Max",value:sb.Max},{label:"Min",value:sb.Min}]})],bC.prototype,"operation",void 0),(0,B.g)("BABYLON.ParticleMathBlock",bC);class CC extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerInput("direction1",Gb.AC,!0,new R.AC(0,1,0)),this.registerInput("direction2",Gb.AC,!0,new R.AC(0,1,0)),this.registerInput("minEmitBox",Gb.AC,!0,new R.AC(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Gb.AC,!0,new R.AC(.5,.5,.5)),this.registerOutput("output",Gb.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Y){const b=this.particle.getConnectedValue(Y);b._directionCreation.process=C=>{Y.particleContext=C,Y.systemContext=b;const q=this.direction1.getConnectedValue(Y),A=this.direction2.getConnectedValue(Y),E=(0,r.RandomRange)(q.x,A.x),B=(0,r.RandomRange)(q.y,A.y),g=(0,r.RandomRange)(q.z,A.z);Y.isEmitterTransformNode?R.AC.TransformNormalFromFloatsToRef(E,B,g,Y.emitterWorldMatrix,C.direction):C.direction.Ub(E,B,g)},b._positionCreation.process=C=>{Y.particleContext=C,Y.systemContext=b;const q=this.minEmitBox.getConnectedValue(Y),A=this.maxEmitBox.getConnectedValue(Y),E=(0,r.RandomRange)(q.x,A.x),B=(0,r.RandomRange)(q.y,A.y),g=(0,r.RandomRange)(q.z,A.z);Y.isEmitterTransformNode?R.AC.TransformCoordinatesFromFloatsToRef(E,B,g,Y.emitterWorldMatrix,C.position):(C.position.Ub(E,B,g),C.position.addInPlace(Y.emitterPosition))},this.output._storedValue=b}}(0,B.g)("BABYLON.BoxShapeBlock",CC);class RC extends kb{constructor(Y){super(Y),this.registerInput("emitPower",Gb.Float,!0,1),this.registerInput("lifeTime",Gb.Float,!0,1),this.registerInput("color",Gb.hb,!0,new E.hb(1,1,1,1)),this.registerInput("scale",Gb.Vector2,!0,new R.Vector2(1,1)),this.registerInput("angle",Gb.Float,!0,0),this.registerOutput("particle",Gb.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(Y){const b=new Bb(this.name,Y.jC,Y.BC,null,!1,void 0,!0);b.particleEmitterType=new w,b._lifeTimeCreation.process=(b,C)=>{Y.particleContext=b,b.lifeTime=this.lifeTime.getConnectedValue(Y),C._emitPower=this.emitPower.getConnectedValue(Y)},b._colorCreation.process=b=>{Y.particleContext=b,b.color.q(this.color.getConnectedValue(Y))},b._sizeCreation.process=b=>{Y.particleContext=b,b.size=1,b.scale.q(this.scale.getConnectedValue(Y))},b._angleCreation.process=b=>{Y.particleContext=b,b.angle=this.angle.getConnectedValue(Y)},this.particle._storedValue=b}}(0,B.g)("BABYLON.CreateParticleBlock",RC);class qC{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const Y=[];for(const b of this.attachedBlocks)b.isInput&&Y.push(b);return Y}constructor(Y){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new M.d,this.name=Y}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(Y){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(Y)&&this.attachedBlocks.push(Y);for(const C of Y.inputs){const R=C.connectedPoint;if(R){const C=R.ownerBlock;C!==Y&&this._initializeBlock(C,b)}}}async buildAsync(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((C=>{const R=new ub;for(const Y of this._systemBlocks)this._initializeBlock(Y);for(const q of this.systemBlocks){const C=new ab;C.buildId=this._buildId++,C.BC=Y,C.verbose=b;const A=q.createSystem(C);C.emitErrors(),R.systems.push(A)}this.onBuildObservable.notifyObservers(this),C(R)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const Y=new Kb("Particle system"),b=new YC("Update position");b.output.connectTo(Y.particle);const C=new fb("Position");C.contextualValue=ib.Position;const R=new fb("Scaled direction");R.contextualValue=ib.ScaledDirection;const q=new bC("Add");q.operation=sb.Add,C.output.connectTo(q.left),R.output.connectTo(q.right),q.output.connectTo(b.position);const A=new RC("Create particle"),E=new CC("Box shape");A.particle.connectTo(E.particle),E.output.connectTo(b.particle);const B=new Zb("Texture");B.texture.connectTo(Y.texture),B.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(Y)}removeBlock(Y){const b=this.attachedBlocks.indexOf(Y);if(b>-1&&this.attachedBlocks.splice(b,1),Y.isSystem){const b=this._systemBlocks.indexOf(Y);b>-1&&this._systemBlocks.splice(b,1)}}parseSerializedObject(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b||this.clear();const C={};for(const R of Y.EF){const Y=(0,B.c)(R.customType);if(Y){const b=new Y;b._deserialize(R),C[R.id]=b,this.attachedBlocks.push(b),b.isSystem&&this._systemBlocks.push(b)}}for(const R of this.attachedBlocks)if(R.isTeleportOut){const Y=R,b=Y._tempEntryPointUniqueId;if(b){const R=C[b];R&&R.attachToEndpoint(Y)}}for(let R=0;R<Y.EF.length;R++){const q=Y.EF[R],A=C[q.id];A&&(A.inputs.length&&q.inputs.some((Y=>Y.targetConnectionName))&&!b||this._restoreConnections(A,Y,C))}if(Y.locations||Y.editorData&&Y.editorData.locations){const R=Y.locations||Y.editorData.locations;for(const Y of R)C[Y.vR]&&(Y.vR=C[Y.vR].uniqueId);b&&this.editorData&&this.editorData.locations&&R.concat(this.editorData.locations),Y.locations?this.editorData={locations:R}:(this.editorData=Y.editorData,this.editorData.locations=R);const q=[];for(const Y in C)q[Y]=C[Y].uniqueId;this.editorData.map=q}this.comment=Y.comment}_restoreConnections(Y,b,C){for(const R of Y.outputs)for(const q of b.EF){const A=C[q.id];if(A)for(const E of q.inputs)if(C[E.targetBlockId]!==Y||E.targetConnectionName!==R.name);else{const Y=A.getInputByName(E.inputName);if(!Y||Y.isConnected)continue;R.connectTo(Y,!0),this._restoreConnections(A,b,C)}}}serialize(Y){const b=Y?{}:J.e.Serialize(this);b.editorData=JSON.parse(JSON.stringify(this.editorData));let C=[];Y?C=Y:b.customType="BABYLON.NodeParticleSystemSet",b.EF=[];for(const R of C)b.EF.push(R.serialize());if(!Y)for(const R of this.attachedBlocks)-1===C.indexOf(R)&&b.EF.push(R.serialize());return b}dispose(){for(const Y of this.attachedBlocks)Y.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(Y){const b=new qC(Y);return b.setToDefault(),b}static Parse(Y){const b=J.e.Parse((()=>new qC(Y.name)),Y,null);return b.parseSerializedObject(Y),b}static ParseFromSnippetAsync(Y,b){return"_BLANK"===Y?Promise.resolve(qC.CreateDefault("blank")):new Promise(((C,R)=>{const q=new cb.e;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const E=JSON.parse(JSON.parse(q.responseText).jsonPayload),B=JSON.parse(E.nodeParticle);b||(b=J.e.Parse((()=>new qC(Y)),B,null)),b.parseSerializedObject(B),b.snippetId=Y;try{C(b)}catch(A){R(A)}}else R("Unable to load the snippet "+Y)})),q.open("GET",this.SnippetUrl+"/"+Y.replace(/#/g,"/")),q.send()}))}}qC.EditorURL=`${pb.Tools._DefaultCdnUrl}/v${xY.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,qC.SnippetUrl="https://snippet.babylonjs.com",(0,v.c)([(0,z.K)()],qC.prototype,"name",void 0),(0,v.c)([(0,z.K)("comment")],qC.prototype,"comment",void 0),function(Y){Y[Y.None=0]="None",Y[Y.PerParticle=1]="PerParticle",Y[Y.PerSystem=2]="PerSystem"}(Db||(Db={}));class AC extends kb{constructor(Y){super(Y),this._currentLockId=-2,this.lockMode=Db.PerParticle,this.registerInput("min",Gb.AutoDetect,!0,0),this.registerInput("max",Gb.AutoDetect,!0,1),this.registerOutput("output",Gb.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Gb.Float|Gb.Int|Gb.Vector2|Gb.AC|Gb.hb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Gb.Float|Gb.Int|Gb.Vector2|Gb.AC|Gb.hb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Gb.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let Y=null;switch(this._currentLockId=-2,this.min.type){case Gb.AutoDetect:case Gb.Int:case Gb.Float:Y=Y=>{const b=this.min.getConnectedValue(Y)||0,C=this.max.getConnectedValue(Y)||1;return b+Math.random()*(C-b)};break;case Gb.Vector2:Y=Y=>{const b=this.min.getConnectedValue(Y)||R.Vector2.Zero(),C=this.max.getConnectedValue(Y)||R.Vector2.One();return new R.Vector2(b.x+Math.random()*(C.x-b.x),b.y+Math.random()*(C.y-b.y))};break;case Gb.AC:Y=Y=>{const b=this.min.getConnectedValue(Y)||R.AC.Zero(),C=this.max.getConnectedValue(Y)||R.AC.One();return new R.AC(b.x+Math.random()*(C.x-b.x),b.y+Math.random()*(C.y-b.y),b.z+Math.random()*(C.z-b.z))};break;case Gb.hb:Y=Y=>{const b=this.min.getConnectedValue(Y)||new E.hb(0,0,0,0),C=this.max.getConnectedValue(Y)||new E.hb(1,1,1,1);return new E.hb(b.x+Math.random()*(C.x-b.x),b.y+Math.random()*(C.y-b.y),b.z+Math.random()*(C.z-b.z),b.w+Math.random()*(C.w-b.w))}}this.output._storedFunction=b=>{var C;let R=0;switch(this.lockMode){case Db.PerParticle:R=(null===(C=b.particleContext)||void 0===C?void 0:C.id)||-1;break;case Db.PerSystem:R=b.buildId||0}return this._currentLockId!==R&&(this.lockMode!==Db.None&&(this._currentLockId=R),this.output._storedValue=Y(b)),this.output._storedValue}}serialize(){const Y=super.serialize();return Y.lockMode=this.lockMode,Y}_deserialize(Y){super._deserialize(Y),this.lockMode=Y.lockMode}}(0,v.c)([xb("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Db.None},{label:"Per particle",value:Db.PerParticle},{label:"Per system",value:Db.PerSystem}]})],AC.prototype,"lockMode",void 0),(0,B.g)("BABYLON.ParticleRandomBlock",AC);class EC extends kb{constructor(Y){super(Y),this._currentLockId=-2,this.lockMode=Db.PerParticle,this.registerInput("min",Gb.AutoDetect),this.registerInput("max",Gb.AutoDetect),this.registerOutput("output",Gb.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const b=[Gb.Matrix,Gb.Particle,Gb.Texture,Gb.System,Gb.FloatGradient,Gb.Color4Gradient,Gb.Vector2Gradient,Gb.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...b),this.max.excludedConnectionPointTypes.push(...b)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let Y=null;switch(this._currentLockId=-2,this.min.type){case Gb.Float:case Gb.Int:Y=Y=>{const b=this.min.getConnectedValue(Y),C=this.max.getConnectedValue(Y);return Math.random()*(C-b)+b};break;case Gb.Vector2:Y=Y=>{const b=this.min.getConnectedValue(Y),C=this.max.getConnectedValue(Y);return new R.Vector2(Math.random()*(C.x-b.x)+b.x,Math.random()*(C.y-b.y)+b.y)};break;case Gb.AC:Y=Y=>{const b=this.min.getConnectedValue(Y),C=this.max.getConnectedValue(Y);return new R.AC(Math.random()*(C.x-b.x)+b.x,Math.random()*(C.y-b.y)+b.y,Math.random()*(C.z-b.z)+b.z)};break;case Gb.hb:Y=Y=>{const b=this.min.getConnectedValue(Y),C=this.max.getConnectedValue(Y);return new E.hb(Math.random()*(C.r-b.r)+b.r,Math.random()*(C.g-b.g)+b.g,Math.random()*(C.b-b.b)+b.b,Math.random()*(C.a-b.a)+b.a)}}this.output._storedFunction=b=>{var C;let R=0;switch(this.lockMode){case Db.PerParticle:R=(null===(C=b.particleContext)||void 0===C?void 0:C.id)||-1;break;case Db.PerSystem:R=b.buildId||0}return this._currentLockId!==R&&(this.lockMode!==Db.None&&(this._currentLockId=R),this.output._storedValue=Y(b)),this.output._storedValue}}serialize(){const Y=super.serialize();return Y.lockMode=this.lockMode,Y}_deserialize(Y){super._deserialize(Y),void 0!==Y.lockMode&&(this.lockMode=Y.lockMode)}}(0,v.c)([xb("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Db.None},{label:"Per particle",value:Db.PerParticle},{label:"Per system",value:Db.PerSystem}]})],EC.prototype,"lockMode",void 0),(0,B.g)("BABYLON.RandomRangeBlock",EC);(0,B.g)("BABYLON.ParticleLerpBlock",class extends kb{constructor(Y){super(Y),this.registerInput("left",Gb.AutoDetect),this.registerInput("right",Gb.AutoDetect),this.registerInput("gradient",Gb.Float,!0,0,0,1),this.registerOutput("output",Gb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Gb.Float|Gb.Int|Gb.Vector2|Gb.AC|Gb.hb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Y=(Y,b,C)=>(1-Y)*b+Y*C;this.output._storedFunction=b=>{const C=this.left.getConnectedValue(b),q=this.right.getConnectedValue(b),A=this.gradient.getConnectedValue(b);switch(this.left.type){case Gb.Int:case Gb.Float:return Y(A,C,q);case Gb.Vector2:return new R.Vector2(Y(A,C.x,q.x),Y(A,C.y,q.y));case Gb.AC:return new R.AC(Y(A,C.x,q.x),Y(A,C.y,q.y),Y(A,C.z,q.z));case Gb.hb:return new E.hb(Y(A,C.r,q.r),Y(A,C.g,q.g),Y(A,C.b,q.b),Y(A,C.a,q.a))}return 0}}});(0,B.g)("BABYLON.UpdateDirectionBlock",class extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerInput("direction",Gb.AC),this.registerOutput("output",Gb.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(Y){const b=this.particle.getConnectedValue(Y);if(this.output._storedValue=b,!this.direction.isConnected)return;const C={process:C=>{Y.particleContext=C,Y.systemContext=b,C.direction.q(this.direction.getConnectedValue(Y))},previousItem:null,nextItem:null};b._updateQueueStart?WY(C,b._updateQueueStart):b._updateQueueStart=C}});(0,B.g)("BABYLON.UpdateColorBlock",class extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerInput("color",Gb.hb),this.registerOutput("output",Gb.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(Y){const b=this.particle.getConnectedValue(Y);if(this.output._storedValue=b,!this.color.isConnected)return;const C={process:C=>{Y.particleContext=C,Y.systemContext=b,C.color.q(this.color.getConnectedValue(Y))},previousItem:null,nextItem:null};b._updateQueueStart?WY(C,b._updateQueueStart):b._updateQueueStart=C}});(0,B.g)("BABYLON.UpdateScaleBlock",class extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerInput("scale",Gb.Vector2),this.registerOutput("output",Gb.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(Y){const b=this.particle.getConnectedValue(Y);if(this.output._storedValue=b,!this.scale.isConnected)return;const C={process:C=>{Y.particleContext=C,Y.systemContext=b,C.scale.q(this.scale.getConnectedValue(Y))},previousItem:null,nextItem:null};b._updateQueueStart?WY(C,b._updateQueueStart):b._updateQueueStart=C}});(0,B.g)("BABYLON.UpdateAngleBlock",class extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerInput("angle",Gb.Float),this.registerOutput("output",Gb.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(Y){const b=this.particle.getConnectedValue(Y);if(this.output._storedValue=b,!this.angle.isConnected)return;const C={process:C=>{Y.particleContext=C,Y.systemContext=b,C.angle=this.angle.getConnectedValue(Y)},previousItem:null,nextItem:null};b._updateQueueStart?WY(C,b._updateQueueStart):b._updateQueueStart=C}});(0,B.g)("BABYLON.BasicPositionUpdateBlock",class extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerOutput("output",Gb.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(Y){const b=this.particle.getConnectedValue(Y),C={process:C=>{Y.particleContext=C,Y.systemContext=b,C.direction.scaleToRef(b._directionScale,b._scaledDirection),C.position.addInPlace(b._scaledDirection)},previousItem:null,nextItem:null};b._updateQueueStart?WY(C,b._updateQueueStart):b._updateQueueStart=C,this.output._storedValue=b}});(0,B.g)("BABYLON.BasicSpriteUpdateBlock",class extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerOutput("output",Gb.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(Y){const b=this.particle.getConnectedValue(Y),C={process:C=>{Y.particleContext=C,Y.systemContext=b,C.updateCellIndex()},previousItem:null,nextItem:null};b._updateQueueStart?WY(C,b._updateQueueStart):b._updateQueueStart=C,this.output._storedValue=b}});(0,B.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerInput("cellIndex",Gb.Int),this.registerOutput("output",Gb.Particle),this.cellIndex.acceptedConnectionPointTypes=[Gb.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(Y){const b=this.particle.getConnectedValue(Y);if(this.output._storedValue=b,!this.cellIndex.isConnected)return;const C={process:C=>{Y.particleContext=C,Y.systemContext=b,C.cellIndex=Math.floor(this.cellIndex.getConnectedValue(Y))},previousItem:null,nextItem:null};b._updateQueueStart?WY(C,b._updateQueueStart):b._updateQueueStart=C}});class BC extends kb{constructor(Y){super(Y),this.strength=1,this.registerInput("particle",Gb.Particle),this.registerInput("flowMap",Gb.Texture),this.registerOutput("output",Gb.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(Y){var b;const C=this.particle.getConnectedValue(Y),R=Y.BC;let q;(null===(b=this.flowMap.connectedPoint)||void 0===b?void 0:b.ownerBlock).extractTextureContentAsync().then((Y=>{Y&&(q=new ob(Y.width,Y.height,Y.data))}));const A={process:Y=>{const b=R.getTransformMatrix();q&&q._processParticle(Y,this.strength*C._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null};C._updateQueueStart?WY(A,C._updateQueueStart):C._updateQueueStart=A,this.output._storedValue=C}serialize(){const Y=super.serialize();return Y.strength=this.strength,Y}_deserialize(Y){super._deserialize(Y),this.strength=Y.strength}}(0,v.c)([xb("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BC.prototype,"strength",void 0),(0,B.g)("BABYLON.UpdateFlowMapBlock",BC);(0,B.g)("BABYLON.SphereShapeBlock",class extends kb{constructor(Y){super(Y),this.registerInput("input",Gb.Particle),this.registerInput("radius",Gb.Float,!0,1),this.registerInput("radiusRange",Gb.Float,!0,1,0,1),this.registerInput("directionRandomizer",Gb.Float,!0,0,0,1),this.registerOutput("output",Gb.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(Y){const b=this.input.getConnectedValue(Y);b._directionCreation.process=C=>{Y.particleContext=C,Y.systemContext=b;const q=this.directionRandomizer.getConnectedValue(Y),A=C.position.EC(Y.emitterPosition).normalize(),E=(0,r.RandomRange)(0,q),B=(0,r.RandomRange)(0,q),g=(0,r.RandomRange)(0,q);A.x+=E,A.y+=B,A.z+=g,A.normalize(),Y.isEmitterTransformNode?R.AC.TransformNormalFromFloatsToRef(E,B,g,Y.emitterWorldMatrix,C.direction):C.direction.Ub(E,B,g)},b._positionCreation.process=C=>{Y.particleContext=C,Y.systemContext=b;const q=this.radius.getConnectedValue(Y),A=this.radiusRange.getConnectedValue(Y),E=q-(0,r.RandomRange)(0,q*A),B=(0,r.RandomRange)(0,1),g=(0,r.RandomRange)(0,2*Math.PI),O=Math.acos(2*B-1),F=E*Math.cos(g)*Math.sin(O),y=E*Math.cos(O),S=E*Math.sin(g)*Math.sin(O);Y.isEmitterTransformNode?R.AC.TransformCoordinatesFromFloatsToRef(F,y,S,Y.emitterWorldMatrix,C.position):(C.position.Ub(F,y,S),C.position.addInPlace(Y.emitterPosition))},this.output._storedValue=b}});(0,B.g)("BABYLON.PointShapeBlock",class extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerInput("direction1",Gb.AC,!0,new R.AC(0,1,0)),this.registerInput("direction2",Gb.AC,!0,new R.AC(0,1,0)),this.registerOutput("output",Gb.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Y){const b=this.particle.getConnectedValue(Y);b._directionCreation.process=C=>{Y.particleContext=C,Y.systemContext=b;const q=this.direction1.getConnectedValue(Y),A=this.direction2.getConnectedValue(Y),E=(0,r.RandomRange)(q.x,A.x),B=(0,r.RandomRange)(q.y,A.y),g=(0,r.RandomRange)(q.z,A.z);Y.isEmitterTransformNode?R.AC.TransformNormalFromFloatsToRef(E,B,g,Y.emitterWorldMatrix,C.direction):C.direction.Ub(E,B,g)},b._positionCreation.process=C=>{Y.systemContext=b,Y.isEmitterTransformNode?R.AC.TransformCoordinatesFromFloatsToRef(0,0,0,Y.emitterWorldMatrix,C.position):C.position.q(Y.emitterPosition)},this.output._storedValue=b}});(0,B.g)("BABYLON.CustomShapeBlock",class extends kb{constructor(Y){super(Y),this.registerInput("particle",Gb.Particle),this.registerInput("position",Gb.AC,!0,new R.AC(0,0,0)),this.registerInput("direction",Gb.AC,!0,new R.AC(0,1,0)),this.registerOutput("output",Gb.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Y){const b=this.particle.getConnectedValue(Y);b._directionCreation.process=C=>{Y.particleContext=C,Y.systemContext=b;const q=this.direction.getConnectedValue(Y);Y.isEmitterTransformNode?R.AC.TransformNormalToRef(q,Y.emitterWorldMatrix,C.direction):C.direction.q(q)},b._positionCreation.process=C=>{Y.particleContext=C,Y.systemContext=b;const q=this.position.getConnectedValue(Y);Y.isEmitterTransformNode?R.AC.TransformCoordinatesToRef(q,Y.emitterWorldMatrix,C.position):(C.position.q(q),C.position.addInPlace(Y.emitterPosition))},this.output._storedValue=b}});(0,B.g)("BABYLON.CylinderShapeBlock",class extends kb{constructor(Y){super(Y),this._tempVector=R.AC.Zero(),this.registerInput("particle",Gb.Particle),this.registerInput("radius",Gb.Float,!0,1),this.registerInput("height",Gb.Float,!0,1,0),this.registerInput("radiusRange",Gb.Float,!0,1,0,1),this.registerInput("directionRandomizer",Gb.Float,!0,0,0,1),this.registerOutput("output",Gb.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Y){const b=this.particle.getConnectedValue(Y);b._directionCreation.process=C=>{Y.particleContext=C,Y.systemContext=b;const q=this.directionRandomizer.getConnectedValue(Y);C.position.subtractToRef(Y.emitterPosition,this._tempVector),this._tempVector.normalize(),Y.isEmitterTransformNode&&R.AC.TransformNormalToRef(this._tempVector,Y.emitterInverseWorldMatrix,this._tempVector);const A=(0,r.RandomRange)(-q/2,q/2);let E=Math.atan2(this._tempVector.x,this._tempVector.z);E+=(0,r.RandomRange)(-Math.PI/2,Math.PI/2)*q,this._tempVector.y=A,this._tempVector.x=Math.sin(E),this._tempVector.z=Math.cos(E),this._tempVector.normalize(),Y.isEmitterTransformNode?R.AC.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Y.emitterWorldMatrix,C.direction):C.direction.q(this._tempVector)},b._positionCreation.process=C=>{Y.particleContext=C,Y.systemContext=b;const q=this.height.getConnectedValue(Y),A=this.radiusRange.getConnectedValue(Y),E=this.radius.getConnectedValue(Y),B=(0,r.RandomRange)(-q/2,q/2),g=(0,r.RandomRange)(0,2*Math.PI),O=(0,r.RandomRange)((1-A)*(1-A),1),F=Math.sqrt(O)*E,y=F*Math.cos(g),S=F*Math.sin(g);Y.isEmitterTransformNode?R.AC.TransformCoordinatesFromFloatsToRef(y,B,S,Y.emitterWorldMatrix,C.position):(C.position.Ub(y,B,S),C.position.addInPlace(Y.emitterPosition))},this.output._storedValue=b}});class gC extends kb{constructor(Y){super(Y),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Gb.Particle),this.registerOutput("output",Gb.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Y){super._build(Y);const b=this.particle.getConnectedValue(Y);b._isAnimationSheetEnabled=!0,b.spriteCellWidth=this.width,b.spriteCellHeight=this.height,b.startSpriteCellID=this.start,b.endSpriteCellID=this.end,b.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=b}serialize(){const Y=super.serialize();return Y.width=this.width,Y.height=this.height,Y.start=this.start,Y.end=this.end,Y.randomStartCell=this.randomStartCell,Y}_deserialize(Y){super._deserialize(Y),this.width=Y.width,this.height=Y.height,this.start=Y.start,this.end=Y.end,this.randomStartCell=Y.randomStartCell}}(0,v.c)([xb("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gC.prototype,"start",void 0),(0,v.c)([xb("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gC.prototype,"end",void 0),(0,v.c)([xb("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gC.prototype,"width",void 0),(0,v.c)([xb("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gC.prototype,"height",void 0),(0,v.c)([xb("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],gC.prototype,"loop",void 0),(0,v.c)([xb("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],gC.prototype,"randomStartCell",void 0),(0,B.g)("BABYLON.SetupSpriteSheetBlock",gC);class rC extends kb{constructor(Y){super(Y),this.reference=0,this.registerInput("value",Gb.AutoDetect),this.registerOutput("output",Gb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=Y=>{switch(Y){case Gb.Float:return Gb.FloatGradient;case Gb.Vector2:return Gb.Vector2Gradient;case Gb.AC:return Gb.Vector3Gradient;case Gb.hb:return Gb.Color4Gradient}return Y},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Gb.Float|Gb.Vector2|Gb.AC|Gb.hb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=Y=>null}serialize(){const Y=super.serialize();return Y.reference=this.reference,Y}_deserialize(Y){super._deserialize(Y),this.reference=Y.reference}}(0,v.c)([xb("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],rC.prototype,"reference",void 0),(0,B.g)("BABYLON.ParticleGradientValueBlock",rC);(0,B.g)("BABYLON.ParticleGradientBlock",class extends kb{constructor(Y){super(Y),this._entryCount=1,this.registerInput("gradient",Gb.Float,!0,1,0,1),this.registerInput("value0",Gb.AutoDetect),this.registerOutput("output",Gb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=Y=>{switch(Y){case Gb.FloatGradient:return Gb.Float;case Gb.Vector2Gradient:return Gb.Vector2;case Gb.Vector3Gradient:return Gb.AC;case Gb.Color4Gradient:return Gb.hb}return Y},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Gb.FloatGradient|Gb.Vector2Gradient|Gb.Vector3Gradient|Gb.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(Y){this._inputs[Y].onConnectionObservable.add((()=>{this._entryCount>Y||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Gb.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const Y=[];for(let C=1;C<this._inputs.length;C++){var b;if(this._inputs[C].isConnected)Y.push(null===(b=this._inputs[C].connectedPoint)||void 0===b?void 0:b.ownerBlock)}Y.sort(((Y,b)=>Y.reference-b.reference)),this.output._storedFunction=b=>{const C=this.gradient.getConnectedValue(b);if(1===Y.length)return Y[0].value.getConnectedValue(b);let q=null;for(let A=Y.length-1;A>=0;A--){const B=Y[A];if(B.reference<=C){const Y=B.value.getConnectedValue(b);if(q){const A=q.value.getConnectedValue(b),g=q.reference,O=B.reference,F=Math.max(0,Math.min(1,(C-O)/(g-O)));switch(this.output.type){case Gb.Float:return(0,r.Lerp)(Y,A,F);case Gb.Vector2:return R.Vector2.Lerp(Y,A,F);case Gb.AC:return R.AC.Lerp(Y,A,F);case Gb.hb:return E.hb.Lerp(Y,A,F)}}return Y}q=B}return 0}}});(0,B.g)("BABYLON.ParticleConverterBlock",class extends kb{constructor(Y){super(Y),this.registerInput("color ",Gb.hb,!0),this.registerInput("xyz ",Gb.AC,!0),this.registerInput("xy ",Gb.Vector2,!0),this.registerInput("zw ",Gb.Vector2,!0),this.registerInput("x ",Gb.Float,!0),this.registerInput("y ",Gb.Float,!0),this.registerInput("z ",Gb.Float,!0),this.registerInput("w ",Gb.Float,!0),this.registerOutput("color",Gb.hb),this.registerOutput("xyz",Gb.AC),this.registerOutput("xy",Gb.Vector2),this.registerOutput("zw",Gb.Vector2),this.registerOutput("x",Gb.Float),this.registerOutput("y",Gb.Float),this.registerOutput("z",Gb.Float),this.registerOutput("w",Gb.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(Y){return"color "===Y?"colorIn":"xyz "===Y?"xyzIn":"xy "===Y?"xyIn":"zw "===Y?"zwIn":"x "===Y?"xIn":"y "===Y?"yIn":"z "===Y?"zIn":"w "===Y?"wIn":Y}_outputRename(Y){switch(Y){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return Y}}_build(Y){super._build(Y);const b=this.xIn,C=this.yIn,q=this.zIn,A=this.wIn,B=this.xyIn,g=this.zwIn,r=this.xyzIn,O=this.colorIn,F=this.colorOut,y=this.xyzOut,S=this.xyOut,n=this.zwOut,t=this.xOut,I=this.yOut,w=this.zOut,Q=this.wOut,N=Y=>{if(O.isConnected)return O.getConnectedValue(Y);let R=0,F=0,y=0,S=0;if(b.isConnected&&(R=b.getConnectedValue(Y)),C.isConnected&&(F=C.getConnectedValue(Y)),q.isConnected&&(y=q.getConnectedValue(Y)),A.isConnected&&(S=A.getConnectedValue(Y)),B.isConnected){const b=B.getConnectedValue(Y);b&&(R=b.x,F=b.y)}if(g.isConnected){const b=g.getConnectedValue(Y);b&&(y=b.x,S=b.y)}if(r.isConnected){const b=r.getConnectedValue(Y);b&&(R=b.x,F=b.y,y=b.z)}return new E.hb(R,F,y,S)};F._storedFunction=Y=>N(Y),y._storedFunction=Y=>{const b=N(Y);return new R.AC(b.r,b.g,b.b)},S._storedFunction=Y=>{const b=N(Y);return new R.Vector2(b.r,b.g)},n._storedFunction=Y=>{const b=N(Y);return new R.Vector2(b.b,b.a)},t._storedFunction=Y=>N(Y).r,I._storedFunction=Y=>N(Y).g,w._storedFunction=Y=>N(Y).b,Q._storedFunction=Y=>N(Y).a}}),function(Y){Y[Y.Cos=0]="Cos",Y[Y.Sin=1]="Sin",Y[Y.Abs=2]="Abs",Y[Y.Exp=3]="Exp",Y[Y.Exp2=4]="Exp2",Y[Y.Round=5]="Round",Y[Y.Floor=6]="Floor",Y[Y.Ceiling=7]="Ceiling",Y[Y.Sqrt=8]="Sqrt",Y[Y.Log=9]="Log",Y[Y.Tan=10]="Tan",Y[Y.ArcTan=11]="ArcTan",Y[Y.ArcCos=12]="ArcCos",Y[Y.ArcSin=13]="ArcSin",Y[Y.Sign=14]="Sign",Y[Y.Negate=15]="Negate",Y[Y.OneMinus=16]="OneMinus",Y[Y.Reciprocal=17]="Reciprocal",Y[Y.ToDegrees=18]="ToDegrees",Y[Y.ToRadians=19]="ToRadians",Y[Y.Fract=20]="Fract"}(db||(db={}));class OC extends kb{constructor(Y){super(Y),this.operation=db.Cos,this.registerInput("input",Gb.AutoDetect),this.registerOutput("output",Gb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Gb.Float|Gb.Int|Gb.Vector2|Gb.AC|Gb.hb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Y){super._build(Y);let b=null;switch(this.operation){case db.Cos:b=Y=>Math.cos(Y);break;case db.Sin:b=Y=>Math.sin(Y);break;case db.Abs:b=Y=>Math.abs(Y);break;case db.Exp:b=Y=>Math.exp(Y);break;case db.Exp2:b=Y=>Math.pow(2,Y);break;case db.Round:b=Y=>Math.round(Y);break;case db.Floor:b=Y=>Math.floor(Y);break;case db.Ceiling:b=Y=>Math.ceil(Y);break;case db.Sqrt:b=Y=>Math.sqrt(Y);break;case db.Log:b=Y=>Math.log(Y);break;case db.Tan:b=Y=>Math.tan(Y);break;case db.ArcTan:b=Y=>Math.atan(Y);break;case db.ArcCos:b=Y=>Math.acos(Y);break;case db.ArcSin:b=Y=>Math.asin(Y);break;case db.Sign:b=Y=>Math.sign(Y);break;case db.Negate:b=Y=>-Y;break;case db.OneMinus:b=Y=>1-Y;break;case db.Reciprocal:b=Y=>1/Y;break;case db.ToRadians:b=Y=>Y*Math.PI/180;break;case db.ToDegrees:b=Y=>180*Y/Math.PI;break;case db.Fract:b=Y=>Y>=0?Y-Math.floor(Y):Y-Math.ceil(Y)}if(!b)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Gb.Int:case Gb.Float:this.output._storedFunction=Y=>{const C=this.input.getConnectedValue(Y);return b(C)};break;case Gb.Vector2:this.output._storedFunction=Y=>{const C=this.input.getConnectedValue(Y);return new R.Vector2(b(C.x),b(C.y))};break;case Gb.AC:this.output._storedFunction=Y=>{const C=this.input.getConnectedValue(Y);return new R.AC(b(C.x),b(C.y),b(C.z))};break;case Gb.hb:this.output._storedFunction=Y=>{const C=this.input.getConnectedValue(Y);return new E.hb(b(C.r),b(C.g),b(C.b),b(C.a))}}return this}serialize(){const Y=super.serialize();return Y.operation=this.operation,Y}_deserialize(Y){super._deserialize(Y),this.operation=Y.operation}}(0,v.c)([xb("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:db.Cos},{label:"Sin",value:db.Sin},{label:"Abs",value:db.Abs},{label:"Exp",value:db.Exp},{label:"Exp2",value:db.Exp2},{label:"Round",value:db.Round},{label:"Floor",value:db.Floor},{label:"Ceiling",value:db.Ceiling},{label:"Sqrt",value:db.Sqrt},{label:"Log",value:db.Log},{label:"Tan",value:db.Tan},{label:"ArcTan",value:db.ArcTan},{label:"ArcCos",value:db.ArcCos},{label:"ArcSin",value:db.ArcSin},{label:"Sign",value:db.Sign},{label:"Negate",value:db.Negate},{label:"OneMinus",value:db.OneMinus},{label:"Reciprocal",value:db.Reciprocal},{label:"ToDegrees",value:db.ToDegrees},{label:"ToRadians",value:db.ToRadians},{label:"Fract",value:db.Fract}]})],OC.prototype,"operation",void 0),(0,B.g)("BABYLON.ParticleTrigonometryBlock",OC);var FC,yC=C(14094);class SC extends kb{constructor(Y){super(Y),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Gb.AutoDetect),this.registerOutput("output",Gb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Gb.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Gb.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Gb.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Gb.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Gb.System),this._inputs[0].excludedConnectionPointTypes.push(Gb.Particle),this._inputs[0].excludedConnectionPointTypes.push(Gb.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Y){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const b=Y=>{const b=this.input.getConnectedValue(Y);if(this.log.length>=this.stackSize)return b;if(null===b||void 0===b)return this.log.push(["null",""]),b;switch(this.input.type){case Gb.Vector2:this.log.push([(0,yC.k)(b,4),b.toString()]);break;case Gb.AC:this.log.push([(0,yC.n)(b,4),b.toString()]);break;case Gb.hb:this.log.push([`{R: ${b.r.toFixed(4)} G: ${b.g.toFixed(4)} B: ${b.b.toFixed(4)} A: ${b.a.toFixed(4)}}`,b.toString()]);break;default:this.log.push([b.toString(),b.toString()])}return b};this.output.isConnected?this.output._storedFunction=b:this.output._storedValue=b(Y)}serialize(){const Y=super.serialize();return Y.stackSize=this.stackSize,Y}_deserialize(Y){super._deserialize(Y),this.stackSize=Y.stackSize}}(0,v.c)([xb("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],SC.prototype,"stackSize",void 0),(0,B.g)("BABYLON.ParticleDebugBlock",SC);(0,B.g)("BABYLON.ParticleElbowBlock",class extends kb{constructor(Y){super(Y),this.registerInput("input",Gb.AutoDetect),this.registerOutput("output",Gb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Y){super._build(Y);const b=this._outputs[0],C=this._inputs[0];b._storedFunction=Y=>C.getConnectedValue(Y)}});(0,B.g)("BABYLON.ParticleTeleportInBlock",class extends kb{get endpoints(){return this._endpoints}constructor(Y){super(Y),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Gb.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(Y){if(this.getClassName()===Y)return!0;for(const b of this.endpoints)if(b.isAnAncestorOfType(Y))return!0;return!1}isAnAncestorOf(Y){for(const b of this.endpoints){if(b===Y)return!0;if(b.isAnAncestorOf(Y))return!0}return!1}attachToEndpoint(Y){Y.detach(),this._endpoints.push(Y),Y._entryPoint=this,Y._outputs[0]._typeConnectionSource=this._inputs[0],Y._tempEntryPointUniqueId=null,Y.name="> "+this.name}detachFromEndpoint(Y){const b=this._endpoints.indexOf(Y);-1!==b&&(this._endpoints.splice(b,1),Y._outputs[0]._typeConnectionSource=null,Y._entryPoint=null)}_build(){for(const Y of this._endpoints)Y.output._storedFunction=Y=>this.input.getConnectedValue(Y)}});(0,B.g)("BABYLON.ParticleTeleportOutBlock",class extends kb{constructor(Y){super(Y),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Gb.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(Y){this.entryPoint&&this.entryPoint.build(Y)}clone(){const Y=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(Y),Y}serialize(){var Y;const b=super.serialize();return b.entryPoint=(null===(Y=this.entryPoint)||void 0===Y?void 0:Y.uniqueId)??"",b}_deserialize(Y){super._deserialize(Y),this._tempEntryPointUniqueId=Y.entryPoint}}),function(Y){Y[Y.Equal=0]="Equal",Y[Y.NotEqual=1]="NotEqual",Y[Y.LessThan=2]="LessThan",Y[Y.GreaterThan=3]="GreaterThan",Y[Y.LessOrEqual=4]="LessOrEqual",Y[Y.GreaterOrEqual=5]="GreaterOrEqual",Y[Y.Xor=6]="Xor",Y[Y.Or=7]="Or",Y[Y.And=8]="And"}(FC||(FC={}));class nC extends kb{constructor(Y){super(Y),this.test=FC.Equal,this.epsilon=0,this.registerInput("left",Gb.Float),this.registerInput("right",Gb.Float,!0,0),this.registerInput("ifTrue",Gb.AutoDetect,!0,1),this.registerInput("ifFalse",Gb.AutoDetect,!0,0),this.registerOutput("output",Gb.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Gb.Float,this._inputs[0].acceptedConnectionPointTypes.push(Gb.Int),this._inputs[1].acceptedConnectionPointTypes.push(Gb.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const Y=Y=>{const b=this.left.getConnectedValue(Y),C=this.right.getConnectedValue(Y);let R=!1;switch(this.test){case FC.Equal:R=(0,r.WithinEpsilon)(b,C,this.epsilon);break;case FC.NotEqual:R=!(0,r.WithinEpsilon)(b,C,this.epsilon);break;case FC.LessThan:R=b<C+this.epsilon;break;case FC.GreaterThan:R=b>C-this.epsilon;break;case FC.LessOrEqual:R=b<=C+this.epsilon;break;case FC.GreaterOrEqual:R=b>=C-this.epsilon;break;case FC.Xor:R=!!b&&!C||!b&&!!C;break;case FC.Or:R=!!b||!!C;break;case FC.And:R=!!b&&!!C}return R};this.output._storedFunction=b=>Y(b)?this.ifTrue.getConnectedValue(b):this.ifFalse.getConnectedValue(b)}serialize(){const Y=super.serialize();return Y.test=this.test,Y.epsilon=this.epsilon,Y}_deserialize(Y){super._deserialize(Y),this.test=Y.test,void 0!==Y.epsilon&&(this.epsilon=Y.epsilon)}}(0,v.c)([xb("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:FC.Equal},{label:"NotEqual",value:FC.NotEqual},{label:"LessThan",value:FC.LessThan},{label:"GreaterThan",value:FC.GreaterThan},{label:"LessOrEqual",value:FC.LessOrEqual},{label:"GreaterOrEqual",value:FC.GreaterOrEqual},{label:"Xor",value:FC.Xor},{label:"Or",value:FC.Or},{label:"And",value:FC.And}]})],nC.prototype,"test",void 0),(0,v.c)([xb("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],nC.prototype,"epsilon",void 0),(0,B.g)("BABYLON.ParticleConditionBlock",nC);class tC extends kb{constructor(Y){super(Y),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Gb.Particle),this.registerInput("condition",Gb.Float,!0,0),this.registerInput("system",Gb.System),this.registerOutput("output",Gb.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Y){this._triggerCount=0;const b=this.input.getConnectedValue(Y),C={process:C=>{if(Y.particleContext=C,Y.systemContext=b,0!==this.condition.getConnectedValue(Y)&&(0===this.limit||this._triggerCount<this.limit)){const R=(new Date).getTime();if(this._previousOne&&R-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=R;const q=this.system.getConnectedValue(Y);if(q){const R=Mb(q,Y.BC,C.position);R.Sb.addOnce((()=>{this._triggerCount--})),b.Sb.addOnce((()=>{R.dispose()}))}}},previousItem:null,nextItem:null};b._updateQueueStart?WY(C,b._updateQueueStart):b._updateQueueStart=C,this.output._storedValue=b}serialize(){const Y=super.serialize();return Y.limit=this.limit,Y.delay=this.delay,Y}_deserialize(Y){super._deserialize(Y),void 0!==Y.limit&&(this.limit=Y.limit),void 0!==Y.delay&&(this.delay=Y.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,v.c)([xb("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tC.prototype,"limit",void 0),(0,v.c)([xb("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tC.prototype,"delay",void 0),(0,B.g)("BABYLON.ParticleTriggerBlock",tC);C(14102),C(14108),C(14118),C(14180)},14159:(Y,b,C)=>{"use strict";var R=C(12747);const q="clipPlaneFragment",A="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14126:(Y,b,C)=>{"use strict";var R=C(12747);const q="clipPlaneFragmentDeclaration",A="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14195:(Y,b,C)=>{"use strict";var R=C(12747);const q="clipPlaneVertex",A="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14183:(Y,b,C)=>{"use strict";var R=C(12747);const q="clipPlaneVertexDeclaration",A="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14171:(Y,b,C)=>{"use strict";var R=C(12747);const q="fogFragment",A="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14153:(Y,b,C)=>{"use strict";var R=C(12747);const q="fogFragmentDeclaration",A="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14204:(Y,b,C)=>{"use strict";var R=C(12747);const q="fogVertex",A="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14191:(Y,b,C)=>{"use strict";var R=C(12747);const q="fogVertexDeclaration",A="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14149:(Y,b,C)=>{"use strict";var R=C(12747);const q="helperFunctions",A="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14135:(Y,b,C)=>{"use strict";var R=C(12747);const q="imageProcessingDeclaration",A="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14151:(Y,b,C)=>{"use strict";var R=C(12747);const q="imageProcessingFunctions",A="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14143:(Y,b,C)=>{"use strict";var R=C(12747);const q="logDepthDeclaration",A="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14165:(Y,b,C)=>{"use strict";var R=C(12747);const q="logDepthFragment",A="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14211:(Y,b,C)=>{"use strict";var R=C(12747);const q="logDepthVertex",A="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";R.b.IncludesShadersStoreWGSL[q]||(R.b.IncludesShadersStoreWGSL[q]=A)},14118:(Y,b,C)=>{"use strict";C.r(b),C.d(b,{particlesPixelShaderWGSL:()=>E});var R=C(12747);C(14126),C(14135),C(14143),C(14149),C(14151),C(14153),C(14159),C(14165),C(14171);const q="particlesPixelShader",A="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";R.b.ShadersStoreWGSL[q]||(R.b.ShadersStoreWGSL[q]=A);const E={name:q,shader:A}},14180:(Y,b,C)=>{"use strict";C.r(b),C.d(b,{particlesVertexShaderWGSL:()=>E});var R=C(12747);C(14183),C(14191),C(14143),C(14195),C(14204),C(14211);const q="particlesVertexShader",A="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";R.b.ShadersStoreWGSL[q]||(R.b.ShadersStoreWGSL[q]=A);const E={name:q,shader:A}},14035:(Y,b,C)=>{"use strict";var R=C(12747);const q="clipPlaneFragment",A="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14106:(Y,b,C)=>{"use strict";var R=C(12747);const q="clipPlaneFragmentDeclaration",A="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14055:(Y,b,C)=>{"use strict";var R=C(12747);const q="clipPlaneVertex",A="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14116:(Y,b,C)=>{"use strict";var R=C(12747);const q="clipPlaneVertexDeclaration",A="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14042:(Y,b,C)=>{"use strict";var R=C(12747);const q="fogFragment",A="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14032:(Y,b,C)=>{"use strict";var R=C(12747);const q="fogFragmentDeclaration",A="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14058:(Y,b,C)=>{"use strict";var R=C(12747);const q="fogVertex",A="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14050:(Y,b,C)=>{"use strict";var R=C(12747);const q="fogVertexDeclaration",A="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14022:(Y,b,C)=>{"use strict";var R=C(12747);const q="helperFunctions",A="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14007:(Y,b,C)=>{"use strict";var R=C(12747);const q="imageProcessingDeclaration",A="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14029:(Y,b,C)=>{"use strict";var R=C(12747);const q="imageProcessingFunctions",A="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14016:(Y,b,C)=>{"use strict";var R=C(12747);const q="logDepthDeclaration",A="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14039:(Y,b,C)=>{"use strict";var R=C(12747);const q="logDepthFragment",A="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14065:(Y,b,C)=>{"use strict";var R=C(12747);const q="logDepthVertex",A="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";R.b.IncludesShadersStore[q]||(R.b.IncludesShadersStore[q]=A)},14102:(Y,b,C)=>{"use strict";C.r(b),C.d(b,{particlesPixelShader:()=>E});var R=C(12747);C(14106),C(14007),C(14016),C(14022),C(14029),C(14032),C(14035),C(14039),C(14042);const q="particlesPixelShader",A="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";R.b.ShadersStore[q]||(R.b.ShadersStore[q]=A);const E={name:q,shader:A}},14108:(Y,b,C)=>{"use strict";C.r(b),C.d(b,{particlesVertexShader:()=>E});var R=C(12747);C(14116),C(14050),C(14016),C(14055),C(14058),C(14065);const q="particlesVertexShader",A="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";R.b.ShadersStore[q]||(R.b.ShadersStore[q]=A);const E={name:q,shader:A}},14468:(Y,b,C)=>{"use strict";C.r(b),C.d(b,{FlowGraphGLTFDataProvider:()=>A});var R=C(14437),q=C(14424);class A extends R.e{constructor(Y){var b,C;super();const R=Y.glTF,A=(null===(b=R.animations)||void 0===b?void 0:b.map((Y=>Y._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",q.b,A);const E=(null===(C=R.nodes)||void 0===C?void 0:C.map((Y=>Y._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",q.b,E)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14358:(Y,b,C)=>{"use strict";C.d(b,{c:()=>I,e:()=>n,h:()=>S,l:()=>t});var R=C(12831),q=C(13310),A=C(12880),E=C(14362);const B=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class g{constructor(Y,b){this._gltf=Y,this._infoTree=b}convert(Y){let b,C=this._gltf,R=this._infoTree;if(!Y.startsWith("/"))throw new Error("Path must start with a /");const q=Y.split("/");if(q.shift(),q[q.length-1].includes(".length")){const Y=q[q.length-1].split(".");q.pop(),q.push(...Y)}let A=!1;for(const g of q){const q="length"===g;if(q&&!R.__array__)throw new Error(`Path ${Y} is invalid`);if(R.__ignoreObjectTree__&&(A=!0),R.__array__&&!q)R=R.__array__;else if(R=R[g],!R)throw new Error(`Path ${Y} is invalid`);if(!A)if(void 0===C){if(!B.find((b=>b.regex.test(Y))))throw new Error(`Path ${Y} is invalid`)}else if(!q){var E;C=null===(E=C)||void 0===E?void 0:E[g]}(R.__target__||q)&&(b=C)}return{object:b,info:R}}}function r(Y,b,C,R){const q=O(Y,b);return R?q[C][R]:q[C]}function O(Y,b,C){var R,A;return null===(R=Y._data)||void 0===R||null===(A=R[(null===C||void 0===C?void 0:C.fillMode)??q.e.MATERIAL_TriangleFillMode])||void 0===A?void 0:A.babylonMaterial}function F(Y,b){return{offset:{componentsCount:2,type:"Vector2",get:(C,q,A)=>{const E=r(C,A,Y,b);return new R.Vector2(null===E||void 0===E?void 0:E.uOffset,null===E||void 0===E?void 0:E.vOffset)},getTarget:O,set:(C,R,q,A)=>{const E=r(R,A,Y,b);E.uOffset=C.x,E.vOffset=C.y},getPropertyName:[()=>`${Y}${b?"."+b:""}.uOffset`,()=>`${Y}${b?"."+b:""}.vOffset`]},rotation:{type:"number",get:(C,R,q)=>{var A;return null===(A=r(C,q,Y,b))||void 0===A?void 0:A.wAng},getTarget:O,set:(C,R,q,A)=>r(R,A,Y,b).wAng=C,getPropertyName:[()=>`${Y}${b?"."+b:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(C,q,A)=>{const E=r(C,A,Y,b);return new R.Vector2(null===E||void 0===E?void 0:E.uScale,null===E||void 0===E?void 0:E.vScale)},getTarget:O,set:(C,R,q,A)=>{const E=r(R,A,Y,b);E.uScale=C.x,E.vScale=C.y},getPropertyName:[()=>`${Y}${b?"."+b:""}.uScale`,()=>`${Y}${b?"."+b:""}.vScale`]}}}const y={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:Y=>{var b,C;return new R.Vector2((null===(b=Y._babylonCamera)||void 0===b?void 0:b.orthoLeft)??0,(null===(C=Y._babylonCamera)||void 0===C?void 0:C.orthoRight)??0)},set:(Y,b)=>{b._babylonCamera&&(b._babylonCamera.orthoLeft=Y.x,b._babylonCamera.orthoRight=Y.y)},getTarget:Y=>Y,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:Y=>{var b,C;return new R.Vector2((null===(b=Y._babylonCamera)||void 0===b?void 0:b.orthoBottom)??0,(null===(C=Y._babylonCamera)||void 0===C?void 0:C.orthoTop)??0)},set:(Y,b)=>{b._babylonCamera&&(b._babylonCamera.orthoBottom=Y.x,b._babylonCamera.orthoTop=Y.y)},getTarget:Y=>Y,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:Y=>{var b;return null===(b=Y._babylonCamera)||void 0===b?void 0:b.maxZ},set:(Y,b)=>{b._babylonCamera&&(b._babylonCamera.maxZ=Y)},getTarget:Y=>Y,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Y=>{var b;return null===(b=Y._babylonCamera)||void 0===b?void 0:b.Xb},set:(Y,b)=>{b._babylonCamera&&(b._babylonCamera.Xb=Y)},getTarget:Y=>Y,getPropertyName:[()=>"Xb"]}},perspective:{aspectRatio:{type:"number",get:Y=>{var b;return null===(b=Y._babylonCamera)||void 0===b?void 0:b.getEngine().getAspectRatio(Y._babylonCamera)},getTarget:Y=>Y,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:Y=>{var b;return null===(b=Y._babylonCamera)||void 0===b?void 0:b.fov},set:(Y,b)=>{b._babylonCamera&&(b._babylonCamera.fov=Y)},getTarget:Y=>Y,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:Y=>{var b;return null===(b=Y._babylonCamera)||void 0===b?void 0:b.maxZ},set:(Y,b)=>{b._babylonCamera&&(b._babylonCamera.maxZ=Y)},getTarget:Y=>Y,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Y=>{var b;return null===(b=Y._babylonCamera)||void 0===b?void 0:b.Xb},set:(Y,b)=>{b._babylonCamera&&(b._babylonCamera.Xb=Y)},getTarget:Y=>Y,getPropertyName:[()=>"Xb"]}}}},nodes:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>Y._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"AC",get:Y=>{var b;return null===(b=Y._babylonTransformNode)||void 0===b?void 0:b.position},set:(Y,b)=>{var C;return null===(C=b._babylonTransformNode)||void 0===C?void 0:C.position.q(Y)},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:Y=>{var b;return null===(b=Y._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion},set:(Y,b)=>{var C,R;return null===(C=b._babylonTransformNode)||void 0===C||null===(R=C.rotationQuaternion)||void 0===R?void 0:R.q(Y)},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"AC",get:Y=>{var b;return null===(b=Y._babylonTransformNode)||void 0===b?void 0:b.ob},set:(Y,b)=>{var C;return null===(C=b._babylonTransformNode)||void 0===C?void 0:C.ob.q(Y)},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"ob"]},weights:{length:{type:"number",get:Y=>Y._numMorphTargets,getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(Y,b)=>{var C,R;return void 0!==b?null===(C=Y._primitiveBabylonMeshes)||void 0===C||null===(R=C[0].morphTargetManager)||void 0===R?void 0:R.getTarget(b).influence:void 0},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(Y,b)=>[0],getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:Y=>{var b,C,q;return R.Matrix.Compose(null===(b=Y._babylonTransformNode)||void 0===b?void 0:b.ob,null===(C=Y._babylonTransformNode)||void 0===C?void 0:C.rotationQuaternion,null===(q=Y._babylonTransformNode)||void 0===q?void 0:q.position)},getTarget:Y=>Y._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:Y=>{var b,C,q,A;const E=R.Matrix.Identity();let B=Y.parent;for(;B&&B.parent;)B=B.parent;const g=(null===(b=Y._babylonTransformNode)||void 0===b?void 0:b.position._isDirty)||(null===(C=Y._babylonTransformNode)||void 0===C||null===(q=C.rotationQuaternion)||void 0===q?void 0:q._isDirty)||(null===(A=Y._babylonTransformNode)||void 0===A?void 0:A.ob._isDirty);if(B){var r;const b=null===(r=B._babylonTransformNode)||void 0===r?void 0:r.Tb(!0).invert();var O,F;if(b)null===(O=Y._babylonTransformNode)||void 0===O||null===(F=O.Tb(g))||void 0===F||F.multiplyToRef(b,E)}else Y._babylonTransformNode&&E.q(Y._babylonTransformNode.Tb(g));return E},getTarget:Y=>Y._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:Y=>{var b,C;return null===(b=Y._babylonTransformNode)||void 0===b||null===(C=b.getChildren((Y=>Y instanceof E.c),!0)[0])||void 0===C?void 0:C.ib},getTarget:Y=>{var b;return null===(b=Y._babylonTransformNode)||void 0===b?void 0:b.getChildren((Y=>Y instanceof E.c),!0)[0]},set:(Y,b)=>{if(b._babylonTransformNode){const C=b._babylonTransformNode.getChildren((Y=>Y instanceof E.c),!0)[0];C&&(C.ib=Y)}}},color:{type:"rC",get:Y=>{var b,C;return null===(b=Y._babylonTransformNode)||void 0===b||null===(C=b.getChildren((Y=>Y instanceof E.c),!0)[0])||void 0===C?void 0:C.Wb},getTarget:Y=>{var b;return null===(b=Y._babylonTransformNode)||void 0===b?void 0:b.getChildren((Y=>Y instanceof E.c),!0)[0]},set:(Y,b)=>{if(b._babylonTransformNode){const C=b._babylonTransformNode.getChildren((Y=>Y instanceof E.c),!0)[0];C&&(C.Wb=Y)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"rC",get:(Y,b,C)=>O(Y,b,C).emissiveColor,set:(Y,b,C,R)=>O(b,C,R).emissiveColor.q(Y),getTarget:(Y,b,C)=>O(Y,b,C),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:F("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(Y,b,C)=>{var R;return null===(R=r(Y,C,"bumpTexture"))||void 0===R?void 0:R.level},set:(Y,b,C,R)=>{const q=r(b,R,"bumpTexture");q&&(q.level=Y)},getTarget:(Y,b,C)=>O(Y,b,C),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:F("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(Y,b,C)=>O(Y,b,C).ambientTextureStrength,set:(Y,b,C,R)=>{const q=O(b,C,R);q&&(q.ambientTextureStrength=Y)},getTarget:(Y,b,C)=>O(Y,b,C),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:F("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"hb",get:(Y,b,C)=>{const R=O(Y,b,C);return A.hb.FromColor3(R.albedoColor,R.alpha)},set:(Y,b,C,R)=>{const q=O(b,C,R);q.albedoColor.set(Y.r,Y.g,Y.b),q.alpha=Y.a},getTarget:(Y,b,C)=>O(Y,b,C),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:F("albedoTexture")}},metallicFactor:{type:"number",get:(Y,b,C)=>O(Y,b,C).metallic,set:(Y,b,C,R)=>{const q=O(b,C,R);q&&(q.metallic=Y)},getTarget:(Y,b,C)=>O(Y,b,C),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(Y,b,C)=>O(Y,b,C).roughness,set:(Y,b,C,R)=>{const q=O(b,C,R);q&&(q.roughness=Y)},getTarget:(Y,b,C)=>O(Y,b,C),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:F("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(Y,b,C)=>O(Y,b,C).anisotropy.ib,set:(Y,b,C,R)=>{O(b,C,R).anisotropy.ib=Y},getTarget:(Y,b,C)=>O(Y,b,C),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(Y,b,C)=>O(Y,b,C).anisotropy.angle,set:(Y,b,C,R)=>{O(b,C,R).anisotropy.angle=Y},getTarget:(Y,b,C)=>O(Y,b,C),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:F("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(Y,b,C)=>O(Y,b,C).clearCoat.ib,set:(Y,b,C,R)=>{O(b,C,R).clearCoat.ib=Y},getTarget:(Y,b,C)=>O(Y,b,C),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(Y,b,C)=>O(Y,b,C).clearCoat.roughness,set:(Y,b,C,R)=>{O(b,C,R).clearCoat.roughness=Y},getTarget:(Y,b,C)=>O(Y,b,C),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:F("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(Y,b,C)=>{var R;return null===(R=O(Y,b,C).clearCoat.bumpTexture)||void 0===R?void 0:R.level},getTarget:O,set:(Y,b,C,R)=>O(b,C,R).clearCoat.bumpTexture.level=Y},extensions:{KHR_texture_transform:F("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:F("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(Y,b,C)=>O(Y,b,C).subSurface.dispersion,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).subSurface.dispersion=Y}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(Y,b,C)=>O(Y,b,C).emissiveIntensity,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).emissiveIntensity=Y}},KHR_materials_ior:{ior:{type:"number",get:(Y,b,C)=>O(Y,b,C).indexOfRefraction,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).indexOfRefraction=Y}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(Y,b,C)=>O(Y,b,C).iridescence.ib,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).iridescence.ib=Y},iridescenceIor:{type:"number",get:(Y,b,C)=>O(Y,b,C).iridescence.indexOfRefraction,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).iridescence.indexOfRefraction=Y},iridescenceTexture:{extensions:{KHR_texture_transform:F("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(Y,b,C)=>O(Y,b,C).iridescence.maximumThickness,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).iridescence.maximumThickness=Y},iridescenceThicknessMinimum:{type:"number",get:(Y,b,C)=>O(Y,b,C).iridescence.minimumThickness,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).iridescence.minimumThickness=Y},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:F("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"rC",get:(Y,b,C)=>O(Y,b,C).sheen.color,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).sheen.color.q(Y)},sheenColorTexture:{extensions:{KHR_texture_transform:F("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(Y,b,C)=>O(Y,b,C).sheen.ib,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).sheen.ib=Y},sheenRoughnessTexture:{extensions:{KHR_texture_transform:F("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(Y,b,C)=>O(Y,b,C).metallicF0Factor,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).metallicF0Factor=Y,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"rC",get:(Y,b,C)=>O(Y,b,C).metallicReflectanceColor,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).metallicReflectanceColor.q(Y),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:F("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:F("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(Y,b,C)=>O(Y,b,C).subSurface.refractionIntensity,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).subSurface.refractionIntensity=Y,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:F("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(Y,b,C)=>O(Y,b,C).subSurface.translucencyIntensity,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).subSurface.translucencyIntensity=Y},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:F("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"rC",get:(Y,b,C)=>O(Y,b,C).subSurface.translucencyColor,getTarget:O,set:(Y,b,C,R)=>{var q;return Y&&(null===(q=O(b,C,R).subSurface.translucencyColor)||void 0===q?void 0:q.q(Y))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:F("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"rC",get:(Y,b,C)=>O(Y,b,C).subSurface.tintColor,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).subSurface.tintColor.q(Y)},attenuationDistance:{type:"number",get:(Y,b,C)=>O(Y,b,C).subSurface.tintColorAtDistance,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).subSurface.tintColorAtDistance=Y},thicknessFactor:{type:"number",get:(Y,b,C)=>O(Y,b,C).subSurface.maximumThickness,getTarget:O,set:(Y,b,C,R)=>O(b,C,R).subSurface.maximumThickness=Y},thicknessTexture:{extensions:{KHR_texture_transform:F("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>Y._babylonLight)),getPropertyName:[Y=>"length"]},__array__:{__target__:!0,color:{type:"rC",get:Y=>{var b;return null===(b=Y._babylonLight)||void 0===b?void 0:b.Wb},set:(Y,b)=>{var C;return null===(C=b._babylonLight)||void 0===C?void 0:C.Wb.q(Y)},getTarget:Y=>Y._babylonLight,getPropertyName:[Y=>"diffuse"]},ib:{type:"number",get:Y=>{var b;return null===(b=Y._babylonLight)||void 0===b?void 0:b.ib},set:(Y,b)=>b._babylonLight?b._babylonLight.ib=Y:void 0,getTarget:Y=>Y._babylonLight,getPropertyName:[Y=>"intensity"]},range:{type:"number",get:Y=>{var b;return null===(b=Y._babylonLight)||void 0===b?void 0:b.range},set:(Y,b)=>b._babylonLight?b._babylonLight.range=Y:void 0,getTarget:Y=>Y._babylonLight,getPropertyName:[Y=>"range"]},spot:{innerConeAngle:{type:"number",get:Y=>{var b;return null===(b=Y._babylonLight)||void 0===b?void 0:b.innerAngle},set:(Y,b)=>b._babylonLight?b._babylonLight.innerAngle=Y:void 0,getTarget:Y=>Y._babylonLight,getPropertyName:[Y=>"innerConeAngle"]},outerConeAngle:{type:"number",get:Y=>{var b;return null===(b=Y._babylonLight)||void 0===b?void 0:b.angle},set:(Y,b)=>b._babylonLight?b._babylonLight.angle=Y:void 0,getTarget:Y=>Y._babylonLight,getPropertyName:[Y=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>Y._babylonLight)),getPropertyName:[Y=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>Y._babylonTexture)),getPropertyName:[Y=>"length"]},__array__:{__target__:!0,ib:{type:"number",get:Y=>{var b;return null===(b=Y._babylonTexture)||void 0===b?void 0:b.level},set:(Y,b)=>{b._babylonTexture&&(b._babylonTexture.level=Y)},getTarget:Y=>Y._babylonTexture},rotation:{type:"Quaternion",get:Y=>{var b;return Y._babylonTexture&&R.Quaternion.FromRotationMatrix(null===(b=Y._babylonTexture)||void 0===b?void 0:b.getReflectionTextureMatrix())},set:(Y,b)=>{var C;b._babylonTexture&&(null!==(C=b._babylonTexture.uY())&&void 0!==C&&C.useRightHandedSystem||(Y=R.Quaternion.Inverse(Y)),R.Matrix.FromQuaternionToRef(Y,b._babylonTexture.getReflectionTextureMatrix()))},getTarget:Y=>Y._babylonTexture}}}}},animations:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>Y._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>{var b;return null===(b=Y.primitives[0]._instanceData)||void 0===b?void 0:b.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function S(Y){return new g(Y,y)}function n(Y){const b=Y.split("/").map((Y=>Y.replace(/{}/g,"__array__")));let C=y;for(const R of b)R&&(C=C[R]);if(C&&C.type&&C.get)return C}function t(Y,b){const C=Y.split("/").map((Y=>Y.replace(/{}/g,"__array__")));let R=y;for(const q of C)q&&(R=R[q]);R&&R.type&&R.get&&(R.interpolation=b)}function I(Y,b){const C=Y.split("/").map((Y=>Y.replace(/{}/g,"__array__")));let R=y;for(const q of C)if(q){if(!R[q]){if("?"===q){R.__ignoreObjectTree__=!0;continue}R[q]={},"__array__"===q&&(R[q].__target__=!0)}R=R[q]}Object.assign(R,b)}},14368:(Y,b,C)=>{"use strict";C.r(b),C.d(b,{AnimationPropertyInfo:()=>r,TransformNodeAnimationPropertyInfo:()=>O,WeightAnimationPropertyInfo:()=>F,getQuaternion:()=>B,getVector3:()=>E,getWeights:()=>g});var R=C(13351),q=C(12831),A=C(14358);function E(Y,b,C,R){return q.AC.OC(b,C).scaleInPlace(R)}function B(Y,b,C,R){return q.Quaternion.OC(b,C).scaleInPlace(R)}function g(Y,b,C,R){const q=new Array(Y._numMorphTargets);for(let A=0;A<q.length;A++)q[A]=b[C++]*R;return q}class r{constructor(Y,b,C,R){this.type=Y,this.name=b,this.getValue=C,this.getStride=R}_buildAnimation(Y,b,C){const q=new R.e(Y,this.name,b,this.type);return q.setKeys(C),q}}class O extends r{buildAnimations(Y,b,C,R){const q=[];return q.push({babylonAnimatable:Y._babylonTransformNode,babylonAnimation:this._buildAnimation(b,C,R)}),q}}class F extends r{buildAnimations(Y,b,C,q){const A=[];if(Y._numMorphTargets)for(let E=0;E<Y._numMorphTargets;E++){const B=new R.e(`${b}_${E}`,this.name,C,this.type);if(B.setKeys(q.map((Y=>({frame:Y.frame,inTangent:Y.inTangent?Y.inTangent[E]:void 0,value:Y.value[E],outTangent:Y.outTangent?Y.outTangent[E]:void 0,interpolation:Y.interpolation})))),Y._primitiveBabylonMeshes)for(const b of Y._primitiveBabylonMeshes)if(b.morphTargetManager){const Y=b.morphTargetManager.getTarget(E),C=B.clone();Y.animations.push(C),A.push({babylonAnimatable:Y,babylonAnimation:C})}}return A}}(0,A.l)("/nodes/{}/translation",[new O(R.e.ANIMATIONTYPE_VECTOR3,"position",E,(()=>3))]),(0,A.l)("/nodes/{}/rotation",[new O(R.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",B,(()=>4))]),(0,A.l)("/nodes/{}/scale",[new O(R.e.ANIMATIONTYPE_VECTOR3,"ob",E,(()=>3))]),(0,A.l)("/nodes/{}/weights",[new F(R.e.ANIMATIONTYPE_FLOAT,"influence",g,(Y=>Y._numMorphTargets))])},14319:(Y,b,C)=>{"use strict";class R{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((Y,b)=>{this._resolve=Y,this._reject=b}))}}var q=C(12831),A=C(12880),E=C(12645),B=C(13279),g=C(14327),r=C(14341),O=C(12652),F=C(13307),y=C(13351),S=C(13353),n=C(12702),t=C(12669),I=C(12678);class w{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(Y){this._useTextureToStoreBoneMatrices=Y,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(Y){this._animationPropertiesOverride=Y}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(Y,b,C){this.name=Y,this.id=b,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=q.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new O.d,this.bones=[],this._scene=C||n.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const R=this._scene.getEngine().getCaps();this._canUseTextureForBones=R.textureFloat&&R.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((Y=>!Y.getParent()))}getTransformMatrices(Y){if(this.needInitialSkinMatrix){if(!Y)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return Y._bonesTransformMatrices||this.prepare(!0),Y._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(Y){return this.needInitialSkinMatrix&&Y._transformMatrixTexture?Y._transformMatrixTexture:this._transformMatrixTexture}uY(){return this._scene}toString(Y){let b=`Name: ${this.name}, nBones: ${this.bones.length}`;if(b+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,Y){b+=", Ranges: {";let Y=!0;for(const C in this._ranges)Y&&(b+=", ",Y=!1),b+=C;b+="}"}return b}getBoneIndexByName(Y){for(let b=0,C=this.bones.length;b<C;b++)if(this.bones[b].name===Y)return b;return-1}createAnimationRange(Y,b,C){if(!this._ranges[Y]){this._ranges[Y]=new S.c(Y,b,C);for(let R=0,q=this.bones.length;R<q;R++)this.bones[R].animations[0]&&this.bones[R].animations[0].createRange(Y,b,C)}}deleteAnimationRange(Y){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let C=0,R=this.bones.length;C<R;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].deleteRange(Y,b);this._ranges[Y]=null}getAnimationRange(Y){return this._ranges[Y]||null}getAnimationRanges(){const Y=[];let b;for(b in this._ranges)Y.push(this._ranges[b]);return Y}copyAnimationRange(Y,b){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[b]||!Y.getAnimationRange(b))return!1;let R=!0;const q=this._getHighestAnimationFrame()+1,A={},E=Y.bones;let B,g;for(g=0,B=E.length;g<B;g++)A[E[g].name]=E[g];this.bones.length!==E.length&&(t.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${E.length}`),R=!1);const r=C&&this.dimensionsAtRest&&Y.dimensionsAtRest?this.dimensionsAtRest.divide(Y.dimensionsAtRest):null;for(g=0,B=this.bones.length;g<B;g++){const Y=this.bones[g].name,E=A[Y];E?R=R&&this.bones[g].copyAnimationRange(E,b,q,C,r):(t.e.Warn("copyAnimationRange: not same rig, missing source bone "+Y),R=!1)}const O=Y.getAnimationRange(b);return O&&(this._ranges[b]=new S.c(b,O.from+q,O.to+q)),R}returnToRest(){for(const Y of this.bones)-1!==Y._index&&Y.returnToRest()}_getHighestAnimationFrame(){let Y=0;for(let b=0,C=this.bones.length;b<C;b++)if(this.bones[b].animations[0]){const C=this.bones[b].animations[0].getHighestFrame();Y<C&&(Y=C)}return Y}beginAnimation(Y,b,C,R){const q=this.getAnimationRange(Y);return q?this._scene.beginAnimation(this,q.from,q.to,b,C,R):null}static MakeAnimationAdditive(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const R=Y.getAnimationRange(C);if(!R)return null;const q=Y._scene.getAllAnimatablesByTarget(Y);let A=null;for(let B=0;B<q.length;B++){const Y=q[B];if(Y.fromFrame===(null===R||void 0===R?void 0:R.from)&&Y.toFrame===(null===R||void 0===R?void 0:R.to)){A=Y;break}}const E=Y.getAnimatables();for(let B=0;B<E.length;B++){const Y=E[B].animations;if(Y)for(let R=0;R<Y.length;R++)y.e.MakeAnimationAdditive(Y[R],b,C)}return A&&(A.isAdditive=!0),Y}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(Y){this._meshesWithPoseMatrix.push(Y)}_unregisterMeshWithPoseMatrix(Y){const b=this._meshesWithPoseMatrix.indexOf(Y);b>-1&&this._meshesWithPoseMatrix.splice(b,1)}_computeTransformMatrices(Y,b){this.onBeforeComputeObservable.notifyObservers(this);for(let C=0;C<this.bones.length;C++){const R=this.bones[C];R._childUpdateId++;const q=R.getParent();if(q?R.getLocalMatrix().multiplyToRef(q.getFinalMatrix(),R.getFinalMatrix()):b?R.getLocalMatrix().multiplyToRef(b,R.getFinalMatrix()):R.getFinalMatrix().q(R.getLocalMatrix()),-1!==R._index){const b=null===R._index?C:R._index;R.getAbsoluteInverseBindMatrix().multiplyToArray(R.getFinalMatrix(),Y,16*b)}}this._identity.copyToArray(Y,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const Y=this.uY().getRenderId();if(this._currentRenderId===Y)return;this._currentRenderId=Y}if(this._numBonesWithLinkedTransformNode>0)for(const Y of this.bones)if(Y._linkedTransformNode){const b=Y._linkedTransformNode;Y.position=b.position,b.rotationQuaternion?Y.rotationQuaternion=b.rotationQuaternion:Y.rotation=b.rotation,Y.ob=b.ob}if(this.needInitialSkinMatrix)for(const Y of this._meshesWithPoseMatrix){const b=Y.getPoseMatrix();let C=this._isDirty;if(Y._bonesTransformMatrices&&Y._bonesTransformMatrices.length===16*(this.bones.length+1)||(Y._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),C=!0),C){if(this._synchronizedWithMesh!==Y){this._synchronizedWithMesh=Y;for(const Y of this.bones)if(!Y.getParent()){Y.getBindMatrix().multiplyToRef(b,q.TmpVectors.Matrix[1]),Y._updateAbsoluteBindMatrices(q.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const b=4*(this.bones.length+1);Y._transformMatrixTexture&&Y._transformMatrixTexture.getSize().width===b||(Y._transformMatrixTexture&&Y._transformMatrixTexture.dispose(),Y._transformMatrixTexture=F.b.CreateRGBATexture(Y._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(Y._bonesTransformMatrices,b),this.isUsingTextureForMatrices&&Y._transformMatrixTexture&&Y._transformMatrixTexture.update(Y._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=F.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let Y=0;Y<this.bones.length;Y++)this._animatables.push(this.bones[Y])}return this._animatables}clone(Y,b){const C=new w(Y,b||Y,this._scene);C.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let R=0;R<this.bones.length;R++){const Y=this.bones[R];let b=null;const q=Y.getParent();if(q){const Y=this.bones.indexOf(q);b=C.bones[Y]}const A=new r.d(Y.name,C,b,Y.getBindMatrix().clone(),Y.getRestMatrix().clone());A._index=Y._index,Y._linkedTransformNode&&A.linkTransformNode(Y._linkedTransformNode),I.c.DeepCopy(Y.animations,A.animations)}if(this._ranges){C._ranges={};for(const Y in this._ranges){const b=this._ranges[Y];b&&(C._ranges[Y]=b.clone())}}return this._isDirty=!0,C.prepare(!0),C}enableBlending(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const b of this.bones)for(const C of b.animations)C.enableBlending=!0,C.blendingSpeed=Y}dispose(){if(this._meshesWithPoseMatrix.length=0,this.uY().stopAnimation(this),this.uY().removeSkeleton(this),this._parentContainer){const Y=this._parentContainer.skeletons.indexOf(this);Y>-1&&this._parentContainer.skeletons.splice(Y,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const Y={};Y.name=this.name,Y.id=this.id,this.dimensionsAtRest&&(Y.dimensionsAtRest=this.dimensionsAtRest.cb()),Y.bones=[],Y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){var b;const R=this.bones[C],q=R.getParent(),A={parentBoneIndex:q?this.bones.indexOf(q):-1,index:R.getIndex(),name:R.name,id:R.id,matrix:R.getBindMatrix().cb(),rest:R.getRestMatrix().cb(),linkedTransformNodeId:null===(b=R.getTransformNode())||void 0===b?void 0:b.id};Y.bones.push(A),R.length&&(A.length=R.length),R.metadata&&(A.metadata=R.metadata),R.animations&&R.animations.length>0&&(A.animation=R.animations[0].serialize()),Y.ranges=[];for(const b in this._ranges){const C=this._ranges[b];if(!C)continue;const R={};R.name=b,R.from=C.from,R.to=C.to,Y.ranges.push(R)}}return Y}static Parse(Y,b){const C=new w(Y.name,Y.id,b);let R;for(Y.dimensionsAtRest&&(C.dimensionsAtRest=q.AC.OC(Y.dimensionsAtRest)),C.needInitialSkinMatrix=Y.needInitialSkinMatrix,R=0;R<Y.bones.length;R++){const b=Y.bones[R],A=Y.bones[R].index;let E=null;b.parentBoneIndex>-1&&(E=C.bones[b.parentBoneIndex]);const B=b.rest?q.Matrix.OC(b.rest):null,g=new r.d(b.name,C,E,q.Matrix.OC(b.matrix),B,null,A);void 0!==b.id&&null!==b.id&&(g.id=b.id),b.length&&(g.length=b.length),b.metadata&&(g.metadata=b.metadata),b.animation&&g.animations.push(y.e.Parse(b.animation)),void 0!==b.linkedTransformNodeId&&null!==b.linkedTransformNodeId&&(C._hasWaitingData=!0,g._waitingTransformNodeId=b.linkedTransformNodeId)}if(Y.ranges)for(R=0;R<Y.ranges.length;R++){const b=Y.ranges[R];C.createAnimationRange(b.name,b.from,b.to)}return C}computeAbsoluteMatrices(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||Y)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(Y)}getPoseMatrix(){let Y=null;return this._meshesWithPoseMatrix.length>0&&(Y=this._meshesWithPoseMatrix[0].getPoseMatrix()),Y}sortBones(){const Y=[],b=new Array(this.bones.length);for(let C=0;C<this.bones.length;C++)this._sortBones(C,Y,b);this.bones=Y}_sortBones(Y,b,C){if(C[Y])return;C[Y]=!0;const R=this.bones[Y];if(!R)return;void 0===R._index&&(R._index=Y);const q=R.getParent();q&&this._sortBones(this.bones.indexOf(q),b,C),b.push(R)}setCurrentPoseAsRest(){for(const Y of this.bones)Y.setCurrentPoseAsRest()}}var Q=C(13143),N=C(13320),p=C(12814),mY=C(13239),L=C(12903),u=C(13287),c=C(13249),l=C(13273),X=C(13357),j=C(12919),T=C(14286);class P{set areUpdatesFrozen(Y){Y?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new j.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,Y||(Y=n.d.LastCreatedScene),this._scene=Y,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const Y=this._scene.getEngine().getCaps();this._canUseTextureForTargets=Y.canUseGLVertexID&&Y.textureFloat&&Y.maxVertexTextureImageUnits>0&&Y.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return P.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?P.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(Y){this._numMaxInfluencers!==Y&&(this._numMaxInfluencers=Y,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(Y){this._useTextureToStoreTargets!==Y&&(this._useTextureToStoreTargets=Y,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var Y;return P.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(Y=this._scene)&&void 0!==Y&&Y.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(Y){return this._activeTargets.data[Y]}getTarget(Y){return this._targets[Y]}getTargetByName(Y){for(const b of this._targets)if(b.name===Y)return b;return null}addTarget(Y){this._targets.push(Y),this._targetInfluenceChangedObservers.push(Y.onInfluenceChanged.add((Y=>{this.areUpdatesFrozen&&Y&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(Y)}))),this._targetDataLayoutChangedObservers.push(Y._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(Y){const b=this._targets.indexOf(Y);b>=0&&(this._targets.splice(b,1),Y.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(b,1)[0]),Y._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(b,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(Y)}_bind(Y){Y.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),Y.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),Y.setTexture("morphTargets",this._targetStoreTexture),Y.setInt("morphTargetCount",this.numInfluencers)}clone(){const Y=new P(this._scene);for(const b of this._targets)Y.addTarget(b.clone());return Y.enablePositionMorphing=this.enablePositionMorphing,Y.enableNormalMorphing=this.enableNormalMorphing,Y.enableTangentMorphing=this.enableTangentMorphing,Y.enableUVMorphing=this.enableUVMorphing,Y.enableUV2Morphing=this.enableUV2Morphing,Y.enableColorMorphing=this.enableColorMorphing,Y}serialize(){const Y={};Y.id=this.uniqueId,Y.targets=[];for(const b of this._targets)Y.targets.push(b.serialize());return Y}_syncActiveTargets(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const b=!!this._targetStoreTexture,C=this.isUsingTextureForTargets;(this._mustSynchronize||b!==C)&&(this._mustSynchronize=!1,this.synchronize());let R=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let q=-1;for(const A of this._targets)if(q++,0!==A.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=P.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(A),this._morphTargetTextureIndices[R]=q,this._tempInfluences[R++]=A.influence}this._morphTargetTextureIndices.length!==R&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,R)),this._influences&&this._influences.length===R||(this._influences=new Float32Array(R));for(let A=0;A<R;A++)this._influences[A]=this._tempInfluences[A];if(Y&&this._scene)for(const A of this._scene.meshes)A.morphTargetManager===this&&(C?A._markSubMeshesAsAttributesDirty():A._syncGeometryWithMorphTargetManager())}synchronize(){var Y;if(!this._scene||this.areUpdatesFrozen)return;const b=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(Y=this._targetStoreTexture)||void 0===Y||Y.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>b.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const C of this._targets){this._supportsPositions=this._supportsPositions&&C.hasPositions,this._supportsNormals=this._supportsNormals&&C.hasNormals,this._supportsTangents=this._supportsTangents&&C.hasTangents,this._supportsUVs=this._supportsUVs&&C.hasUVs,this._supportsUV2s=this._supportsUV2s&&C.hasUV2s,this._supportsColors=this._supportsColors&&C.hasColors;const Y=C.vertexCount;if(0===this._vertexCount)this._vertexCount=Y;else if(this._vertexCount!==Y)return void t.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${C.name}": ${Y}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const Y=b.getCaps().maxTextureSize;this._textureWidth>Y&&(this._textureHeight=Math.ceil(this._textureWidth/Y),this._textureWidth=Y);const C=this._targets.length,R=new Float32Array(C*this._textureWidth*this._textureHeight*4);let q=0;for(let b=0;b<C;b++){const Y=this._targets[b],C=Y.getPositions(),A=Y.getNormals(),E=Y.getUVs(),B=Y.getTangents(),g=Y.getUV2s(),r=Y.getColors();q=b*this._textureWidth*this._textureHeight*4;for(let b=0;b<this._vertexCount;b++)this._supportsPositions&&C&&(R[q]=C[3*b],R[q+1]=C[3*b+1],R[q+2]=C[3*b+2],q+=4),this._supportsNormals&&A&&(R[q]=A[3*b],R[q+1]=A[3*b+1],R[q+2]=A[3*b+2],q+=4),this._supportsUVs&&E&&(R[q]=E[2*b],R[q+1]=E[2*b+1],q+=4),this._supportsTangents&&B&&(R[q]=B[3*b],R[q+1]=B[3*b+1],R[q+2]=B[3*b+2],q+=4),this._supportsUV2s&&g&&(R[q]=g[2*b],R[q+1]=g[2*b+1],q+=4),this._supportsColors&&r&&(R[q]=r[4*b],R[q+1]=r[4*b+1],R[q+2]=r[4*b+2],R[q+3]=r[4*b+3],q+=4)}this._targetStoreTexture=T.d.CreateRGBATexture(R,this._textureWidth,this._textureHeight,C,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const C of this._scene.meshes)C.morphTargetManager===this&&C._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const Y=this._parentContainer.morphTargetManagers.indexOf(this);Y>-1&&this._parentContainer.morphTargetManagers.splice(Y,1),this._parentContainer=null}for(const Y of this._targets)this._scene.stopAnimation(Y)}}static Parse(Y,b){const C=new P(b);for(const R of Y.targets)C.addTarget(X.c.Parse(R,b));return C}}P.EnableTextureStorage=!0,P.MaxActiveMorphTargetsInVertexAttributeMode=8,P.ConstantTargetCountForTextureMode=0;var v=C(14347),z=C(12709),J=C(13156);const U=new Map,o=U;function G(Y,b,C){h(Y)&&t.e.Warn(`Extension with the name '${Y}' already exists`),U.set(Y,{isGLTFExtension:b,factory:C})}function h(Y){return U.delete(Y)}var e=C(14358),H=C(13417),i=C(12909);class W{static Get(Y,b,C){if(!b||void 0==C||!b[C])throw new Error(`${Y}: Failed to find index (${C})`);return b[C]}static TryGet(Y,b){return Y&&void 0!=b&&Y[b]?Y[b]:null}static Assign(Y){if(Y)for(let b=0;b<Y.length;b++)Y[b].index=b}}function s(Y){if(Y.min&&Y.max){const b=Y.min,C=Y.max,R=q.TmpVectors.AC[0].Ub(b[0],b[1],b[2]),A=q.TmpVectors.AC[1].Ub(C[0],C[1],C[2]);if(Y.normalized&&5126!==Y.componentType){let b=1;switch(Y.componentType){case 5120:b=127;break;case 5121:b=255;break;case 5122:b=32767;break;case 5123:b=65535}const C=1/b;R.scaleInPlace(C),A.scaleInPlace(C)}return new J.b(R,A)}return null}class D{static RegisterExtension(Y,b){G(Y,!1,b)}static UnregisterExtension(Y){return h(Y)}get Qb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(Y){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=Y}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((Y=>Y.dispose&&Y.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(Y,b,C,R,q,A){let E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=b,this._assetContainer=C,this._loadData(R);let A=null;if(Y){const b={};if(this._gltf.nodes)for(const Y of this._gltf.nodes)Y.name&&(b[Y.name]=Y.index);A=(Y instanceof Array?Y:[Y]).map((Y=>{const C=b[Y];if(void 0===C)throw new Error(`Failed to find node '${Y}'`);return C}))}return await this._loadAsync(q,E,A,(()=>({meshes:this._getMeshes(),xy:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=Y,this._loadData(b),await this._loadAsync(C,q,null,(()=>{}))}async _loadAsync(Y,b,C,R){return await Promise.resolve().then((async()=>{this._rootUrl=Y,this._uniqueRootUrl=!Y.startsWith("file:")&&b?Y:`${Y}${Date.now()}/`,this._fileName=b,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const q=`${v.k[v.k.LOADING]} => ${v.k[v.k.READY]}`,A=`${v.k[v.k.LOADING]} => ${v.k[v.k.COMPLETE]}`;this._parent._startPerformanceCounter(q),this._parent._startPerformanceCounter(A),this._parent._setState(v.k.LOADING),this._extensionsOnLoading();const B=new Array;if(!this.parent.loadOnlyMaterials)if(C)B.push(this.loadSceneAsync("/nodes",{nodes:C,index:-1}));else if(void 0!=this._gltf.BC||this._gltf.scenes&&this._gltf.scenes[0]){const Y=W.Get("/scene",this._gltf.scenes,this._gltf.BC||0);B.push(this.loadSceneAsync(`/scenes/${Y.index}`,Y))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let Y=0;Y<this._gltf.materials.length;++Y){const b=this._gltf.materials[Y],C="/materials/"+Y,R=Q.e.TriangleFillMode;B.push(this._loadMaterialAsync(C,b,null,R,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&B.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&B.push(this._compileShadowGeneratorsAsync());const g=Promise.all(B).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.ug(!0);for(const Y of this._babylonScene.materials){const b=Y;void 0!==b.maxSimultaneousLights&&(b.maxSimultaneousLights=Math.max(b.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(v.k.READY),this._skipStartAnimationStep||this._startAnimations(),R()}));return await g.then((Y=>(this._parent._endPerformanceCounter(q),E.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(A),this._parent._setState(v.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(Y=>{this._parent.onErrorObservable.notifyObservers(Y),this._parent.onErrorObservable.clear(),this.dispose()}))})),Y)))})).catch((Y=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(Y),this._parent.onErrorObservable.clear(),this.dispose()),Y}))}_loadData(Y){if(this._gltf=Y.json,this._setupData(),Y.bin){const b=this._gltf.buffers;if(b&&b[0]&&!b[0].uri){const C=b[0];(C.byteLength<Y.bin.byteLength-3||C.byteLength>Y.bin.byteLength)&&t.e.Warn(`Binary buffer length (${C.byteLength}) from JSON does not match chunk length (${Y.bin.byteLength})`),this._bin=Y.bin}else t.e.Warn("Unexpected BIN chunk")}}_setupData(){if(W.Assign(this._gltf.accessors),W.Assign(this._gltf.animations),W.Assign(this._gltf.buffers),W.Assign(this._gltf.bufferViews),W.Assign(this._gltf.cameras),W.Assign(this._gltf.images),W.Assign(this._gltf.materials),W.Assign(this._gltf.meshes),W.Assign(this._gltf.nodes),W.Assign(this._gltf.samplers),W.Assign(this._gltf.scenes),W.Assign(this._gltf.skins),W.Assign(this._gltf.textures),this._gltf.nodes){const Y={};for(const C of this._gltf.nodes)if(C.children)for(const b of C.children)Y[b]=C.index;const b=this._createRootNode();for(const C of this._gltf.nodes){const R=Y[C.index];C.parent=void 0===R?b:this._gltf.nodes[R]}}}async _loadExtensionsAsync(){const Y=[];if(o.forEach(((b,C)=>{var R;!1===(null===(R=this.parent.extensionOptions[C])||void 0===R?void 0:R.enabled)?b.isGLTFExtension&&this.isExtensionUsed(C)&&t.e.Warn(`Extension ${C} is used but has been explicitly disabled.`):b.isGLTFExtension&&!this.isExtensionUsed(C)||Y.push((async()=>{const Y=await b.factory(this);return Y.name!==C&&t.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${Y.name} !== ${C}`),this._parent.onExtensionLoadedObservable.notifyObservers(Y),Y})())})),this._extensions.push(...await Promise.all(Y)),this._extensions.sort(((Y,b)=>(Y.order||Number.MAX_VALUE)-(b.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const C of this._gltf.extensionsRequired){if(!this._extensions.some((Y=>Y.name===C&&Y.enabled))){var b;if(!1===(null===(b=this.parent.extensionOptions[C])||void 0===b?void 0:b.enabled))throw new Error(`Required extension ${C} is disabled`);throw new Error(`Required extension ${C} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new l.d("__root__",this._babylonScene);this._rootBabylonMesh=Y,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.ug(!1);const b={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case v.g.AUTO:this._babylonScene.useRightHandedSystem||(b.rotation=[0,1,0,0],b.scale=[1,1,-1],D._LoadTransform(b,this._rootBabylonMesh));break;case v.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(Y),b}loadSceneAsync(Y,b){const C=this._extensionsLoadSceneAsync(Y,b);if(C)return C;const R=new Array;if(this.logOpen(`${Y} ${b.name||""}`),b.nodes)for(const q of b.nodes){const b=W.Get(`${Y}/nodes/${q}`,this._gltf.nodes,q);R.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(Y=>{Y.parent=this._rootBabylonMesh})))}for(const q of this._postSceneLoadActions)q();return R.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(R).then((()=>{}))}_forEachPrimitive(Y,b){if(Y._primitiveBabylonMeshes)for(const C of Y._primitiveBabylonMeshes)b(C)}_getGeometries(){const Y=[],b=this._gltf.nodes;if(b)for(const C of b)this._forEachPrimitive(C,(b=>{const C=b.Pb;C&&-1===Y.indexOf(C)&&Y.push(C)}));return Y}_getMeshes(){const Y=[];this._rootBabylonMesh instanceof c.b&&Y.push(this._rootBabylonMesh);const b=this._gltf.nodes;if(b)for(const C of b)this._forEachPrimitive(C,(b=>{Y.push(b)}));return Y}_getTransformNodes(){const Y=[],b=this._gltf.nodes;if(b)for(const C of b)C._babylonTransformNode&&"Vb"===C._babylonTransformNode.getClassName()&&Y.push(C._babylonTransformNode),C._babylonTransformNodeForSkin&&Y.push(C._babylonTransformNodeForSkin);return Y}_getSkeletons(){const Y=[],b=this._gltf.skins;if(b)for(const C of b)C._data&&Y.push(C._data.babylonSkeleton);return Y}_getAnimationGroups(){const Y=[],b=this._gltf.animations;if(b)for(const C of b)C._babylonAnimationGroup&&Y.push(C._babylonAnimationGroup);return Y}_startAnimations(){switch(this._parent.animationStartMode){case v.f.NONE:break;case v.f.FIRST:{const Y=this._getAnimationGroups();0!==Y.length&&Y[0].start(!0);break}case v.f.ALL:{const Y=this._getAnimationGroups();for(const b of Y)b.start(!0);break}default:return void t.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const R=this._extensionsLoadNodeAsync(Y,b,C);if(R)return R;if(b._babylonTransformNode)throw new Error(`${Y}: Invalid recursive node hierarchy`);const q=new Array;this.logOpen(`${Y} ${b.name||""}`);const A=R=>{if(D.AddPointerMetadata(R,Y),D._LoadTransform(b,R),void 0!=b.camera){const C=W.Get(`${Y}/camera`,this._gltf.cameras,b.camera);q.push(this.loadCameraAsync(`/cameras/${C.index}`,C,(Y=>{Y.parent=R,this._babylonScene.useRightHandedSystem||(R.ob.x=-1)})))}if(b.children)for(const C of b.children){const b=W.Get(`${Y}/children/${C}`,this._gltf.nodes,C);q.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(Y=>{Y.parent=R})))}C(R)},E=void 0!=b.mesh,B=this._parent.loadSkins&&void 0!=b.skin;if(!E||B){const Y=b.name||`node${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new mY.e(Y,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==b.mesh?b._babylonTransformNode=C:b._babylonTransformNodeForSkin=C,A(C)}if(E)if(B){const C=W.Get(`${Y}/mesh`,this._gltf.meshes,b.mesh);q.push(this._loadMeshAsync(`/meshes/${C.index}`,b,C,(C=>{const R=b._babylonTransformNodeForSkin;C.metadata=(0,H.b)(R.metadata,C.metadata||{});const A=W.Get(`${Y}/skin`,this._gltf.skins,b.skin);q.push(this._loadSkinAsync(`/skins/${A.index}`,b,A,(Y=>{this._forEachPrimitive(b,(b=>{b.skeleton=Y})),this._postSceneLoadActions.push((()=>{if(void 0!=A.skeleton){const Y=W.Get(`/skins/${A.index}/skeleton`,this._gltf.nodes,A.skeleton).parent;b.index===Y.index?C.parent=R.parent:C.parent=Y._babylonTransformNode}else C.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:R,skinnedNode:C})}))})))})))}else{const C=W.Get(`${Y}/mesh`,this._gltf.meshes,b.mesh);q.push(this._loadMeshAsync(`/meshes/${C.index}`,b,C,A))}return this.logClose(),Promise.all(q).then((()=>(this._forEachPrimitive(b,(Y=>{const b=Y;!b.isAnInstance&&b.Pb&&b.Pb.useBoundingInfoFromGeometry?Y.JY():Y.refreshBoundingInfo(!0,!0)})),b._babylonTransformNode)))}_loadMeshAsync(Y,b,C,R){const q=C.primitives;if(!q||!q.length)throw new Error(`${Y}: Primitives are missing`);void 0==q[0].index&&W.Assign(q);const A=new Array;this.logOpen(`${Y} ${C.name||""}`);const E=b.name||`node${b.index}`;if(1===q.length){const R=C.primitives[0];A.push(this._loadMeshPrimitiveAsync(`${Y}/primitives/${R.index}`,E,b,C,R,(Y=>{b._babylonTransformNode=Y,b._primitiveBabylonMeshes=[Y]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,b._babylonTransformNode=new mY.e(E,this._babylonScene),b._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._primitiveBabylonMeshes=[];for(const R of q)A.push(this._loadMeshPrimitiveAsync(`${Y}/primitives/${R.index}`,`${E}_primitive${R.index}`,b,C,R,(Y=>{Y.parent=b._babylonTransformNode,b._primitiveBabylonMeshes.push(Y)})))}return R(b._babylonTransformNode),this.logClose(),Promise.all(A).then((()=>b._babylonTransformNode))}_loadMeshPrimitiveAsync(Y,b,C,R,q,A){const E=this._extensionsLoadMeshPrimitiveAsync(Y,b,C,R,q,A);if(E)return E;this.logOpen(`${Y}`);const B=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==C.skin&&!R.primitives[0].targets;let g,r;if(B&&q._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,g=q._instanceData.babylonSourceMesh.createInstance(b),g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r=q._instanceData.promise;else{const A=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new l.d(b,this._babylonScene);E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.sideOrientation=this._babylonScene.useRightHandedSystem?Q.e.CounterClockWiseSideOrientation:Q.e.ClockWiseSideOrientation,this._createMorphTargets(Y,C,R,q,E),A.push(this._loadVertexDataAsync(Y,q,E).then((async b=>await this._loadMorphTargetsAsync(Y,q,E,b).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,b.vY(E),b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const O=D._GetDrawMode(Y,q.mode);if(void 0==q.material){let Y=this._defaultBabylonMaterialData[O];Y||(Y=this._createDefaultMaterial("__GLTFLoader._default",O),this._parent.onMaterialLoadedObservable.notifyObservers(Y),this._defaultBabylonMaterialData[O]=Y),E.material=Y}else if(!this.parent.skipMaterials){const b=W.Get(`${Y}/material`,this._gltf.materials,q.material);A.push(this._loadMaterialAsync(`/materials/${b.index}`,b,E,O,(Y=>{E.material=Y})))}r=Promise.all(A),B&&(q._instanceData={babylonSourceMesh:E,promise:r}),g=E}return D.AddPointerMetadata(g,Y),this._parent.onMeshLoadedObservable.notifyObservers(g),A(g),this.logClose(),r.then((()=>g))}_loadVertexDataAsync(Y,b,C){const R=this._extensionsLoadVertexDataAsync(Y,b,C);if(R)return R;const q=b.attributes;if(!q)throw new Error(`${Y}: Attributes are missing`);const A=new Array,E=new u.d(C.name,this._babylonScene);if(void 0==b.indices)C.isUnIndexed=!0;else{const C=W.Get(`${Y}/indices`,this._gltf.accessors,b.indices);A.push(this._loadIndicesAccessorAsync(`/accessors/${C.index}`,C).then((Y=>{E.setIndices(Y)})))}const B=(b,R,B)=>{if(void 0==q[b])return;C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(R)&&C._delayInfo.push(R);const g=W.Get(`${Y}/attributes/${b}`,this._gltf.accessors,q[b]);A.push(this._loadVertexAccessorAsync(`/accessors/${g.index}`,g,R).then((Y=>{if(Y.getKind()===L.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!C.skeleton){const Y=s(g);Y&&(E._boundingInfo=Y,E.useBoundingInfoFromGeometry=!0)}E.setVerticesBuffer(Y,g.count)}))),R==L.e.MatricesIndicesExtraKind&&(C.numBoneInfluencers=8),B&&B(g)};return B("POSITION",L.e.PositionKind),B("NORMAL",L.e.NormalKind),B("TANGENT",L.e.TangentKind),B("TEXCOORD_0",L.e.UVKind),B("TEXCOORD_1",L.e.UV2Kind),B("TEXCOORD_2",L.e.UV3Kind),B("TEXCOORD_3",L.e.UV4Kind),B("TEXCOORD_4",L.e.UV5Kind),B("TEXCOORD_5",L.e.UV6Kind),B("JOINTS_0",L.e.MatricesIndicesKind),B("WEIGHTS_0",L.e.MatricesWeightsKind),B("JOINTS_1",L.e.MatricesIndicesExtraKind),B("WEIGHTS_1",L.e.MatricesWeightsExtraKind),B("COLOR_0",L.e.ColorKind,(Y=>{"VEC4"===Y.type&&(C.hasVertexAlpha=!0)})),Promise.all(A).then((()=>E))}_createMorphTargets(Y,b,C,R,q){if(!R.targets||!this._parent.loadMorphTargets)return;if(void 0==b._numMorphTargets)b._numMorphTargets=R.targets.length;else if(R.targets.length!==b._numMorphTargets)throw new Error(`${Y}: Primitives do not have the same number of targets`);const A=C.extras?C.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,q.morphTargetManager=new P(this._babylonScene),q.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.morphTargetManager.areUpdatesFrozen=!0;for(let E=0;E<R.targets.length;E++){const Y=b.weights?b.weights[E]:C.weights?C.weights[E]:0,R=A?A[E]:`morphTarget${E}`;q.morphTargetManager.addTarget(new X.c(R,Y,q.uY()))}}_loadMorphTargetsAsync(Y,b,C,R){if(!b.targets||!this._parent.loadMorphTargets)return Promise.resolve();const q=new Array,A=C.morphTargetManager;for(let E=0;E<A.numTargets;E++){const C=A.getTarget(E);q.push(this._loadMorphTargetVertexDataAsync(`${Y}/targets/${E}`,R,b.targets[E],C))}return Promise.all(q).then((()=>{A.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(Y,b,C,R){const q=new Array,A=(R,A,E)=>{if(void 0==C[R])return;const B=b.getVertexBuffer(A);if(!B)return;const g=W.Get(`${Y}/${R}`,this._gltf.accessors,C[R]);q.push(this._loadFloatAccessorAsync(`/accessors/${g.index}`,g).then((Y=>{E(B,Y)})))};return A("POSITION",L.e.PositionKind,((Y,b)=>{const C=new Float32Array(b.length);Y.forEach(b.length,((Y,R)=>{C[R]=b[R]+Y})),R.setPositions(C)})),A("NORMAL",L.e.NormalKind,((Y,b)=>{const C=new Float32Array(b.length);Y.forEach(C.length,((Y,R)=>{C[R]=b[R]+Y})),R.setNormals(C)})),A("TANGENT",L.e.TangentKind,((Y,b)=>{const C=new Float32Array(b.length/3*4);let q=0;Y.forEach(b.length/3*4,((Y,R)=>{(R+1)%4!==0&&(C[q]=b[q]+Y,q++)})),R.setTangents(C)})),A("TEXCOORD_0",L.e.UVKind,((Y,b)=>{const C=new Float32Array(b.length);Y.forEach(b.length,((Y,R)=>{C[R]=b[R]+Y})),R.setUVs(C)})),A("TEXCOORD_1",L.e.UV2Kind,((Y,b)=>{const C=new Float32Array(b.length);Y.forEach(b.length,((Y,R)=>{C[R]=b[R]+Y})),R.setUV2s(C)})),A("COLOR_0",L.e.ColorKind,((b,C)=>{let q=null;const A=b.getSize();if(3===A){q=new Float32Array(C.length/3*4),b.forEach(C.length,((Y,b)=>{const R=Math.floor(b/3),A=b%3;q[4*R+A]=C[3*R+A]+Y}));for(let Y=0;Y<C.length/3;++Y)q[4*Y+3]=1}else{if(4!==A)throw new Error(`${Y}: Invalid number of components (${A}) for COLOR_0 attribute`);q=new Float32Array(C.length),b.forEach(C.length,((Y,b)=>{q[b]=C[b]+Y}))}R.setColors(q)})),await Promise.all(q).then((()=>{}))}static _LoadTransform(Y,b){if(void 0!=Y.skin)return;let C=q.AC.Zero(),R=q.Quaternion.Identity(),A=q.AC.One();if(Y.matrix){q.Matrix.OC(Y.matrix).decompose(A,R,C)}else Y.translation&&(C=q.AC.OC(Y.translation)),Y.rotation&&(R=q.Quaternion.OC(Y.rotation)),Y.scale&&(A=q.AC.OC(Y.scale));b.position=C,b.rotationQuaternion=R,b.ob=A}_loadSkinAsync(Y,b,C,R){if(!this._parent.loadSkins)return Promise.resolve();const q=this._extensionsLoadSkinAsync(Y,b,C);if(q)return q;if(C._data)return R(C._data.babylonSkeleton),C._data.promise;const A=`skeleton${C.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new w(C.name||A,A,this._babylonScene);E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(Y,C,E);const B=this._loadSkinInverseBindMatricesDataAsync(Y,C).then((Y=>{this._updateBoneMatrices(E,Y)}));return C._data={babylonSkeleton:E,promise:B},R(E),B}_loadBones(Y,b,C){if(void 0==b.skeleton||this._parent.alwaysComputeSkeletonRootNode){const C=this._findSkeletonRootNode(`${Y}/joints`,b.joints);if(C)if(void 0===b.skeleton)b.skeleton=C.index;else{const R=(Y,b)=>{for(;b.parent;b=b.parent)if(b.parent===Y)return!0;return!1},q=W.Get(`${Y}/skeleton`,this._gltf.nodes,b.skeleton);q===C||R(q,C)||(t.e.Warn(`${Y}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),b.skeleton=C.index)}else t.e.Warn(`${Y}: Failed to find common root`)}const R={};for(const q of b.joints){const A=W.Get(`${Y}/joints/${q}`,this._gltf.nodes,q);this._loadBone(A,b,C,R)}}_findSkeletonRootNode(Y,b){if(0===b.length)return null;const C={};for(const q of b){const b=[];let R=W.Get(`${Y}/${q}`,this._gltf.nodes,q);for(;-1!==R.index;)b.unshift(R),R=R.parent;C[q]=b}let R=null;for(let q=0;;++q){let Y=C[b[0]];if(q>=Y.length)return R;const A=Y[q];for(let E=1;E<b.length;++E)if(Y=C[b[E]],q>=Y.length||A!==Y[q])return R;R=A}}_loadBone(Y,b,C,R){Y._isJoint=!0;let q=R[Y.index];if(q)return q;let A=null;Y.index!==b.skeleton&&(Y.parent&&-1!==Y.parent.index?A=this._loadBone(Y.parent,b,C,R):void 0!==b.skeleton&&t.e.Warn(`/skins/${b.index}/skeleton: Skeleton node is not a common root`));const E=b.joints.indexOf(Y.index);return q=new r.d(Y.name||`joint${Y.index}`,C,A,this._getNodeMatrix(Y),null,null,E),R[Y.index]=q,this._postSceneLoadActions.push((()=>{q.linkTransformNode(Y._babylonTransformNode)})),q}_loadSkinInverseBindMatricesDataAsync(Y,b){if(void 0==b.inverseBindMatrices)return Promise.resolve(null);const C=W.Get(`${Y}/inverseBindMatrices`,this._gltf.accessors,b.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${C.index}`,C)}_updateBoneMatrices(Y,b){for(const C of Y.bones){const Y=q.Matrix.Identity(),R=C._index;b&&-1!==R&&(q.Matrix.FromArrayToRef(b,16*R,Y),Y.invertToRef(Y));const A=C.getParent();A&&Y.multiplyToRef(A.getAbsoluteInverseBindMatrix(),Y),C.jb(Y,!1,!1),C._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(Y){return Y.matrix?q.Matrix.OC(Y.matrix):q.Matrix.Compose(Y.scale?q.AC.OC(Y.scale):q.AC.One(),Y.rotation?q.Quaternion.OC(Y.rotation):q.Quaternion.Identity(),Y.translation?q.AC.OC(Y.translation):q.AC.Zero())}loadCameraAsync(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const R=this._extensionsLoadCameraAsync(Y,b,C);if(R)return R;const A=new Array;this.logOpen(`${Y} ${b.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new g.d(b.name||`camera${b.index}`,q.AC.Zero(),this._babylonScene,!1);switch(E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonCamera=E,E.setTarget(new q.AC(0,0,-1)),b.type){case"perspective":{const C=b.perspective;if(!C)throw new Error(`${Y}: Camera perspective properties are missing`);E.fov=C.yfov,E.Xb=C.znear,E.maxZ=C.zfar||0;break}case"orthographic":if(!b.orthographic)throw new Error(`${Y}: Camera orthographic properties are missing`);E.mode=B.c.ORTHOGRAPHIC_CAMERA,E.orthoLeft=-b.orthographic.xmag,E.orthoRight=b.orthographic.xmag,E.orthoBottom=-b.orthographic.ymag,E.orthoTop=b.orthographic.ymag,E.Xb=b.orthographic.znear,E.maxZ=b.orthographic.zfar;break;default:throw new Error(`${Y}: Invalid camera type (${b.type})`)}return D.AddPointerMetadata(E,Y),this._parent.onCameraLoadedObservable.notifyObservers(E),C(E),this.logClose(),Promise.all(A).then((()=>E))}_loadAnimationsAsync(){const Y=this._gltf.animations;if(!Y)return Promise.resolve();const b=new Array;for(let C=0;C<Y.length;C++){const R=Y[C];b.push(this.loadAnimationAsync(`/animations/${R.index}`,R).then((Y=>{0===Y.targetedAnimations.length&&Y.dispose()})))}return Promise.all(b).then((()=>{}))}loadAnimationAsync(Y,b){const R=this._extensionsLoadAnimationAsync(Y,b);return R||C.e(78).then(C.bind(C,16046)).then((C=>{let{AnimationGroup:R}=C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new R(b.name||`animation${b.index}`,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonAnimationGroup=q;const A=new Array;W.Assign(b.channels),W.Assign(b.samplers);for(const E of b.channels)A.push(this._loadAnimationChannelAsync(`${Y}/channels/${E.index}`,Y,b,E,((Y,b)=>{Y.animations=Y.animations||[],Y.animations.push(b),q.addTargetedAnimation(b,Y)})));return Promise.all(A).then((()=>(q.normalize(0),q)))}))}async _loadAnimationChannelAsync(Y,b,R,q,A){const E=this._extensionsLoadAnimationChannelAsync(Y,b,R,q,A);if(E)return await E;if(void 0==q.target.node)return await Promise.resolve();const B=W.Get(`${Y}/target/node`,this._gltf.nodes,q.target.node),g=q.target.path,r="weights"===g;if(r&&!B._numMorphTargets||!r&&!B._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!r&&!B._isJoint)return await Promise.resolve();let O;switch(await Promise.resolve().then(C.bind(C,14368)),g){case"translation":var F;O=null===(F=(0,e.e)("/nodes/{}/translation"))||void 0===F?void 0:F.interpolation;break;case"rotation":var y;O=null===(y=(0,e.e)("/nodes/{}/rotation"))||void 0===y?void 0:y.interpolation;break;case"scale":var S;O=null===(S=(0,e.e)("/nodes/{}/scale"))||void 0===S?void 0:S.interpolation;break;case"weights":var n;O=null===(n=(0,e.e)("/nodes/{}/weights"))||void 0===n?void 0:n.interpolation;break;default:throw new Error(`${Y}/target/path: Invalid value (${q.target.path})`)}if(!O)throw new Error(`${Y}/target/path: Could not find interpolation properties for target path (${q.target.path})`);const t={object:B,info:O};return await this._loadAnimationChannelFromTargetInfoAsync(Y,b,R,q,t,A)}_loadAnimationChannelFromTargetInfoAsync(Y,b,C,R,q,A){const E=this.parent.targetFps,B=1/E,g=W.Get(`${Y}/sampler`,C.samplers,R.sampler);return this._loadAnimationSamplerAsync(`${b}/samplers/${R.sampler}`,g).then((Y=>{let b=0;const g=q.object,r=q.info;for(const q of r){const r=q.getStride(g),O=Y.input,F=Y.output,y=new Array(O.length);let S=0;switch(Y.interpolation){case"STEP":for(let Y=0;Y<O.length;Y++){const b=q.getValue(g,F,S,1);S+=r,y[Y]={frame:O[Y]*E,value:b,interpolation:1}}break;case"CUBICSPLINE":for(let Y=0;Y<O.length;Y++){const b=q.getValue(g,F,S,B);S+=r;const C=q.getValue(g,F,S,1);S+=r;const R=q.getValue(g,F,S,B);S+=r,y[Y]={frame:O[Y]*E,inTangent:b,value:C,outTangent:R}}break;case"LINEAR":for(let Y=0;Y<O.length;Y++){const b=q.getValue(g,F,S,1);S+=r,y[Y]={frame:O[Y]*E,value:b}}}if(S>0){const Y=`${C.name||`animation${C.index}`}_channel${R.index}_${b}`,B=q.buildAnimations(g,Y,E,y);for(const C of B)b++,A(C.babylonAnimatable,C.babylonAnimation)}}}))}_loadAnimationSamplerAsync(Y,b){if(b._data)return b._data;const C=b.interpolation||"LINEAR";switch(C){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${Y}/interpolation: Invalid value (${b.interpolation})`)}const R=W.Get(`${Y}/input`,this._gltf.accessors,b.input),q=W.Get(`${Y}/output`,this._gltf.accessors,b.output);return b._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${R.index}`,R),this._loadFloatAccessorAsync(`/accessors/${q.index}`,q)]).then((Y=>{let[b,R]=Y;return{input:b,interpolation:C,output:R}})),b._data}loadBufferAsync(Y,b,C,R){const q=this._extensionsLoadBufferAsync(Y,b,C,R);if(q)return q;if(!b._data)if(b.uri)b._data=this.loadUriAsync(`${Y}/uri`,b,b.uri);else{if(!this._bin)throw new Error(`${Y}: Uri is missing or the binary glTF is missing its binary chunk`);b._data=this._bin.readAsync(0,b.byteLength)}return b._data.then((b=>{try{return new Uint8Array(b.buffer,b.byteOffset+C,R)}catch(q){throw new Error(`${Y}: ${q.message}`)}}))}loadBufferViewAsync(Y,b){const C=this._extensionsLoadBufferViewAsync(Y,b);if(C)return C;if(b._data)return b._data;const R=W.Get(`${Y}/buffer`,this._gltf.buffers,b.buffer);return b._data=this.loadBufferAsync(`/buffers/${R.index}`,R,b.byteOffset||0,b.byteLength),b._data}_loadAccessorAsync(Y,b,C){if(b._data)return b._data;const R=D._GetNumComponents(Y,b.type),q=R*L.e.GetTypeByteLength(b.componentType),A=R*b.count;if(void 0==b.bufferView)b._data=Promise.resolve(new C(A));else{const E=W.Get(`${Y}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${E.index}`,E).then((B=>{if(5126!==b.componentType||b.normalized||E.byteStride&&E.byteStride!==q){const Y=new C(A);return L.e.ForEach(B,b.byteOffset||0,E.byteStride||q,R,b.componentType,Y.length,b.normalized||!1,((b,C)=>{Y[C]=b})),Y}return D._GetTypedArray(Y,b.componentType,B,b.byteOffset,A)}))}if(b.sparse){const A=b.sparse;b._data=b._data.then((E=>{const B=E,g=W.Get(`${Y}/sparse/indices/bufferView`,this._gltf.bufferViews,A.indices.bufferView),r=W.Get(`${Y}/sparse/values/bufferView`,this._gltf.bufferViews,A.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${g.index}`,g),this.loadBufferViewAsync(`/bufferViews/${r.index}`,r)]).then((E=>{let[g,r]=E;const O=D._GetTypedArray(`${Y}/sparse/indices`,A.indices.componentType,g,A.indices.byteOffset,A.count),F=R*A.count;let y;if(5126!==b.componentType||b.normalized){const E=D._GetTypedArray(`${Y}/sparse/values`,b.componentType,r,A.values.byteOffset,F);y=new C(F),L.e.ForEach(E,0,q,R,b.componentType,y.length,b.normalized||!1,((Y,b)=>{y[b]=Y}))}else y=D._GetTypedArray(`${Y}/sparse/values`,b.componentType,r,A.values.byteOffset,F);let S=0;for(let Y=0;Y<O.length;Y++){let b=O[Y]*R;for(let Y=0;Y<R;Y++)B[b++]=y[S++]}return B}))}))}return b._data}_loadFloatAccessorAsync(Y,b){return this._loadAccessorAsync(Y,b,Float32Array)}_loadIndicesAccessorAsync(Y,b){if("SCALAR"!==b.type)throw new Error(`${Y}/type: Invalid value ${b.type}`);if(5121!==b.componentType&&5123!==b.componentType&&5125!==b.componentType)throw new Error(`${Y}/componentType: Invalid value ${b.componentType}`);if(b._data)return b._data;if(b.sparse){const C=D._GetTypedArrayConstructor(`${Y}/componentType`,b.componentType);b._data=this._loadAccessorAsync(Y,b,C)}else{const C=W.Get(`${Y}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((C=>D._GetTypedArray(Y,b.componentType,C,b.byteOffset,b.count)))}return b._data}_loadVertexBufferViewAsync(Y){if(Y._babylonBuffer)return Y._babylonBuffer;const b=this._babylonScene.getEngine();return Y._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((Y=>new L.d(b,Y,!1))),Y._babylonBuffer}_loadVertexAccessorAsync(Y,b,C){var R;if(null!==(R=b._babylonVertexBuffer)&&void 0!==R&&R[C])return b._babylonVertexBuffer[C];b._babylonVertexBuffer||(b._babylonVertexBuffer={});const q=this._babylonScene.getEngine();if(b.sparse||void 0==b.bufferView)b._babylonVertexBuffer[C]=this._loadFloatAccessorAsync(Y,b).then((Y=>new L.e(q,Y,C,!1)));else{const R=W.Get(`${Y}/bufferView`,this._gltf.bufferViews,b.bufferView);b._babylonVertexBuffer[C]=this._loadVertexBufferViewAsync(R).then((A=>{const E=D._GetNumComponents(Y,b.type);return new L.e(q,A,C,!1,void 0,R.byteStride,void 0,b.byteOffset,E,b.componentType,b.normalized,!0,void 0,!0)}))}return b._babylonVertexBuffer[C]}_loadMaterialMetallicRoughnessPropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const R=new Array;return b&&(b.baseColorFactor?(C.albedoColor=A.rC.OC(b.baseColorFactor),C.alpha=b.baseColorFactor[3]):C.albedoColor=A.rC.White(),C.metallic=void 0==b.metallicFactor?1:b.metallicFactor,C.roughness=void 0==b.roughnessFactor?1:b.roughnessFactor,b.baseColorTexture&&R.push(this.loadTextureInfoAsync(`${Y}/baseColorTexture`,b.baseColorTexture,(Y=>{Y.name=`${C.name} (Base Color)`,C.albedoTexture=Y}))),b.metallicRoughnessTexture&&(b.metallicRoughnessTexture.nonColorData=!0,R.push(this.loadTextureInfoAsync(`${Y}/metallicRoughnessTexture`,b.metallicRoughnessTexture,(Y=>{Y.name=`${C.name} (Metallic Roughness)`,C.metallicTexture=Y}))),C.useMetallnessFromMetallicTextureBlue=!0,C.useRoughnessFromMetallicTextureGreen=!0,C.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(R).then((()=>{}))}_loadMaterialAsync(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const A=this._extensionsLoadMaterialAsync(Y,b,C,R,q);if(A)return A;b._data=b._data||{};let E=b._data[R];if(!E){this.logOpen(`${Y} ${b.name||""}`);const C=this.createMaterial(Y,b,R);E={babylonMaterial:C,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(Y,b,C)},b._data[R]=E,D.AddPointerMetadata(C,Y),this._parent.onMaterialLoadedObservable.notifyObservers(C),this.logClose()}return C&&(E.babylonMeshes.push(C),C.Sb.addOnce((()=>{const Y=E.babylonMeshes.indexOf(C);-1!==Y&&E.babylonMeshes.splice(Y,1)}))),q(E.babylonMaterial),E.promise.then((()=>E.babylonMaterial))}_createDefaultMaterial(Y,b){this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new N.b(Y,this._babylonScene);return C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.fillMode=b,C.enableSpecularAntiAliasing=!0,C.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,C.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,C.transparencyMode=N.b.PBRMATERIAL_OPAQUE,C.metallic=1,C.roughness=1,C}createMaterial(Y,b,C){const R=this._extensionsCreateMaterial(Y,b,C);if(R)return R;const q=b.name||`material${b.index}`;return this._createDefaultMaterial(q,C)}loadMaterialPropertiesAsync(Y,b,C){const R=this._extensionsLoadMaterialPropertiesAsync(Y,b,C);if(R)return R;const q=new Array;return q.push(this.loadMaterialBasePropertiesAsync(Y,b,C)),b.pbrMetallicRoughness&&q.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${Y}/pbrMetallicRoughness`,b.pbrMetallicRoughness,C)),this.loadMaterialAlphaProperties(Y,b,C),Promise.all(q).then((()=>{}))}loadMaterialBasePropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const R=new Array;return C.emissiveColor=b.emissiveFactor?A.rC.OC(b.emissiveFactor):new A.rC(0,0,0),b.doubleSided&&(C.Jb=!1,C.twoSidedLighting=!0),b.normalTexture&&(b.normalTexture.nonColorData=!0,R.push(this.loadTextureInfoAsync(`${Y}/normalTexture`,b.normalTexture,(Y=>{Y.name=`${C.name} (Normal)`,C.bumpTexture=Y}))),C.invertNormalMapX=!this._babylonScene.useRightHandedSystem,C.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=b.normalTexture.scale&&C.bumpTexture&&(C.bumpTexture.level=b.normalTexture.scale),C.forceIrradianceInFragment=!0),b.occlusionTexture&&(b.occlusionTexture.nonColorData=!0,R.push(this.loadTextureInfoAsync(`${Y}/occlusionTexture`,b.occlusionTexture,(Y=>{Y.name=`${C.name} (Occlusion)`,C.ambientTexture=Y}))),C.useAmbientInGrayScale=!0,void 0!=b.occlusionTexture.strength&&(C.ambientTextureStrength=b.occlusionTexture.strength)),b.emissiveTexture&&R.push(this.loadTextureInfoAsync(`${Y}/emissiveTexture`,b.emissiveTexture,(Y=>{Y.name=`${C.name} (Emissive)`,C.emissiveTexture=Y}))),Promise.all(R).then((()=>{}))}loadMaterialAlphaProperties(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);switch(b.alphaMode||"OPAQUE"){case"OPAQUE":C.transparencyMode=N.b.PBRMATERIAL_OPAQUE,C.alpha=1;break;case"MASK":C.transparencyMode=N.b.PBRMATERIAL_ALPHATEST,C.alphaCutOff=void 0==b.alphaCutoff?.5:b.alphaCutoff,C.albedoTexture&&(C.albedoTexture.lb=!0);break;case"BLEND":C.transparencyMode=N.b.PBRMATERIAL_ALPHABLEND,C.albedoTexture&&(C.albedoTexture.lb=!0,C.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${Y}/alphaMode: Invalid value (${b.alphaMode})`)}}loadTextureInfoAsync(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const R=this._extensionsLoadTextureInfoAsync(Y,b,C);if(R)return R;if(this.logOpen(`${Y}`),b.texCoord>=6)throw new Error(`${Y}/texCoord: Invalid value (${b.texCoord})`);const q=W.Get(`${Y}/index`,this._gltf.textures,b.index);q._textureInfo=b;const A=this._loadTextureAsync(`/textures/${b.index}`,q,(R=>{R.coordinatesIndex=b.texCoord||0,D.AddPointerMetadata(R,Y),this._parent.onTextureLoadedObservable.notifyObservers(R),C(R)}));return this.logClose(),A}_loadTextureAsync(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const R=this._extensionsLoadTextureAsync(Y,b,C);if(R)return R;this.logOpen(`${Y} ${b.name||""}`);const q=void 0==b.sampler?D.DefaultSampler:W.Get(`${Y}/sampler`,this._gltf.samplers,b.sampler),A=W.Get(`${Y}/source`,this._gltf.images,b.source),E=this._createTextureAsync(Y,q,A,C,void 0,!b._textureInfo.nonColorData);return this.logClose(),E}_createTextureAsync(Y,b,C){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},A=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0;const B=this._loadSampler(`/samplers/${b.index}`,b),g=new Array,r=new R;this._babylonScene._blockEntityCollection=!!this._assetContainer;const O={noMipmap:B.noMipMaps,invertY:!1,samplingMode:B.samplingMode,M:()=>{this._disposed||r.resolve()},onError:(b,C)=>{this._disposed||r.reject(new Error(`${Y}: ${C&&C.message?C.message:b||"Failed to load texture"}`))},mimeType:C.mimeType??(0,z.l)(C.uri??""),loaderOptions:A,useSRGBBuffer:!!E&&this._parent.useSRGBBuffers},F=new p.b(null,this._babylonScene,O);return F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.push(r.promise),g.push(this.loadImageAsync(`/images/${C.index}`,C).then((Y=>{const b=C.uri||`${this._fileName}#image${C.index}`,R=`data:${this._uniqueRootUrl}${b}`;F.updateURL(R,Y);const q=F.getInternalTexture();q&&(q.label=C.name)}))),F.wrapU=B.wrapU,F.wrapV=B.wrapV,q(F),this._parent.useGltfTextureNames&&(F.name=C.name||C.uri||`image${C.index}`),Promise.all(g).then((()=>F))}_loadSampler(Y,b){return b._data||(b._data={noMipMaps:9728===b.minFilter||9729===b.minFilter,samplingMode:D._GetTextureSamplingMode(Y,b),wrapU:D._GetTextureWrapMode(`${Y}/wrapS`,b.wrapS),wrapV:D._GetTextureWrapMode(`${Y}/wrapT`,b.wrapT)}),b._data}loadImageAsync(Y,b){if(!b._data){if(this.logOpen(`${Y} ${b.name||""}`),b.uri)b._data=this.loadUriAsync(`${Y}/uri`,b,b.uri);else{const C=W.Get(`${Y}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)}this.logClose()}return b._data}loadUriAsync(Y,b,C){const R=this._extensionsLoadUriAsync(Y,b,C);if(R)return R;if(!D._ValidateUri(C))throw new Error(`${Y}: '${C}' is invalid`);if((0,z.p)(C)){const b=new Uint8Array((0,z.e)(C));return this.log(`${Y}: Decoded ${C.substring(0,64)}... (${b.length} bytes)`),Promise.resolve(b)}return this.log(`${Y}: Loading ${C}`),this._parent.preprocessUrlAsync(this._rootUrl+C).then((b=>new Promise(((R,q)=>{this._parent._loadFile(this._babylonScene,b,(b=>{this._disposed||(this.log(`${Y}: Loaded ${C} (${b.byteLength} bytes)`),R(new Uint8Array(b)))}),!0,(b=>{q(new z.s(`${Y}: Failed to load '${C}'${b?": "+b.status+" "+b.statusText:""}`,b))}))}))))}static AddPointerMetadata(Y,b){Y.metadata=Y.metadata||{};const C=Y._internalMetadata=Y._internalMetadata||{},R=C.Qb=C.Qb||{};(R.pointers=R.pointers||[]).push(b)}static _GetTextureWrapMode(Y,b){switch(b=void 0==b?10497:b){case 33071:return p.b.CLAMP_ADDRESSMODE;case 33648:return p.b.MIRROR_ADDRESSMODE;case 10497:return p.b.WRAP_ADDRESSMODE;default:return t.e.Warn(`${Y}: Invalid value (${b})`),p.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(Y,b){const C=void 0==b.magFilter?9729:b.magFilter,R=void 0==b.minFilter?9987:b.minFilter;if(9729===C)switch(R){case 9728:return p.b.LINEAR_NEAREST;case 9729:return p.b.LINEAR_LINEAR;case 9984:return p.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return p.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return p.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return p.b.LINEAR_LINEAR_MIPLINEAR;default:return t.e.Warn(`${Y}/minFilter: Invalid value (${R})`),p.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==C&&t.e.Warn(`${Y}/magFilter: Invalid value (${C})`),R){case 9728:return p.b.NEAREST_NEAREST;case 9729:return p.b.NEAREST_LINEAR;case 9984:return p.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return p.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return p.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return p.b.NEAREST_LINEAR_MIPLINEAR;default:return t.e.Warn(`${Y}/minFilter: Invalid value (${R})`),p.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(Y,b){try{return(0,i.p)(b)}catch(C){throw new Error(`${Y}: ${C.message}`)}}static _GetTypedArray(Y,b,C,R,q){const A=C.buffer;R=C.byteOffset+(R||0);const E=D._GetTypedArrayConstructor(`${Y}/componentType`,b),B=L.e.GetTypeByteLength(b);return R%B!==0?(t.e.Warn(`${Y}: Copying buffer as byte offset (${R}) is not a multiple of component type byte length (${B})`),new E(A.slice(R,R+q*B),0)):new E(A,R,q)}static _GetNumComponents(Y,b){switch(b){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${Y}: Invalid type (${b})`)}static _ValidateUri(Y){return E.Tools.IsBase64(Y)||-1===Y.indexOf("..")}static _GetDrawMode(Y,b){switch(void 0==b&&(b=4),b){case 0:return Q.e.PointListDrawMode;case 1:return Q.e.LineListDrawMode;case 2:return Q.e.LineLoopDrawMode;case 3:return Q.e.LineStripDrawMode;case 4:return Q.e.TriangleFillMode;case 5:return Q.e.TriangleStripDrawMode;case 6:return Q.e.TriangleFanDrawMode}throw new Error(`${Y}: Invalid mesh primitive mode (${b})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const Y=new Array;if(this._gltf.materials)for(const b of this._gltf.materials)if(b._data)for(const C in b._data){const R=b._data[C];for(const b of R.babylonMeshes){b.Tb(!0);const C=R.babylonMaterial;Y.push(C.forceCompilationAsync(b)),Y.push(C.forceCompilationAsync(b,{useInstances:!0})),this._parent.useClipPlane&&(Y.push(C.forceCompilationAsync(b,{clipPlane:!0})),Y.push(C.forceCompilationAsync(b,{clipPlane:!0,useInstances:!0})))}}return Promise.all(Y).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const Y=new Array,b=this._babylonScene.lights;for(const C of b){const b=C.getShadowGenerator();b&&Y.push(b.forceCompilationAsync())}return Promise.all(Y).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(Y){for(const b of this._extensions)b.enabled&&Y(b)}_applyExtensions(Y,b,C){for(const R of this._extensions)if(R.enabled){const q=`${R.name}.${b}`,A=Y;A._activeLoaderExtensionFunctions=A._activeLoaderExtensionFunctions||{};const E=A._activeLoaderExtensionFunctions;if(!E[q]){E[q]=!0;try{const Y=C(R);if(Y)return Y}finally{delete E[q]}}}return null}_extensionsOnLoading(){this._forEachExtensions((Y=>Y.onLoading&&Y.onLoading()))}_extensionsOnReady(){this._forEachExtensions((Y=>Y.onReady&&Y.onReady()))}_extensionsLoadSceneAsync(Y,b){return this._applyExtensions(b,"loadScene",(C=>C.loadSceneAsync&&C.loadSceneAsync(Y,b)))}_extensionsLoadNodeAsync(Y,b,C){return this._applyExtensions(b,"loadNode",(R=>R.loadNodeAsync&&R.loadNodeAsync(Y,b,C)))}_extensionsLoadCameraAsync(Y,b,C){return this._applyExtensions(b,"loadCamera",(R=>R.loadCameraAsync&&R.loadCameraAsync(Y,b,C)))}_extensionsLoadVertexDataAsync(Y,b,C){return this._applyExtensions(b,"loadVertexData",(R=>R._loadVertexDataAsync&&R._loadVertexDataAsync(Y,b,C)))}_extensionsLoadMeshPrimitiveAsync(Y,b,C,R,q,A){return this._applyExtensions(q,"loadMeshPrimitive",(E=>E._loadMeshPrimitiveAsync&&E._loadMeshPrimitiveAsync(Y,b,C,R,q,A)))}_extensionsLoadMaterialAsync(Y,b,C,R,q){return this._applyExtensions(b,"loadMaterial",(A=>A._loadMaterialAsync&&A._loadMaterialAsync(Y,b,C,R,q)))}_extensionsCreateMaterial(Y,b,C){return this._applyExtensions(b,"createMaterial",(R=>R.createMaterial&&R.createMaterial(Y,b,C)))}_extensionsLoadMaterialPropertiesAsync(Y,b,C){return this._applyExtensions(b,"loadMaterialProperties",(R=>R.loadMaterialPropertiesAsync&&R.loadMaterialPropertiesAsync(Y,b,C)))}_extensionsLoadTextureInfoAsync(Y,b,C){return this._applyExtensions(b,"loadTextureInfo",(R=>R.loadTextureInfoAsync&&R.loadTextureInfoAsync(Y,b,C)))}_extensionsLoadTextureAsync(Y,b,C){return this._applyExtensions(b,"loadTexture",(R=>R._loadTextureAsync&&R._loadTextureAsync(Y,b,C)))}_extensionsLoadAnimationAsync(Y,b){return this._applyExtensions(b,"loadAnimation",(C=>C.loadAnimationAsync&&C.loadAnimationAsync(Y,b)))}_extensionsLoadAnimationChannelAsync(Y,b,C,R,q){return this._applyExtensions(C,"loadAnimationChannel",(A=>A._loadAnimationChannelAsync&&A._loadAnimationChannelAsync(Y,b,C,R,q)))}_extensionsLoadSkinAsync(Y,b,C){return this._applyExtensions(C,"loadSkin",(R=>R._loadSkinAsync&&R._loadSkinAsync(Y,b,C)))}_extensionsLoadUriAsync(Y,b,C){return this._applyExtensions(b,"loadUri",(R=>R._loadUriAsync&&R._loadUriAsync(Y,b,C)))}_extensionsLoadBufferViewAsync(Y,b){return this._applyExtensions(b,"loadBufferView",(C=>C.loadBufferViewAsync&&C.loadBufferViewAsync(Y,b)))}_extensionsLoadBufferAsync(Y,b,C,R){return this._applyExtensions(b,"loadBuffer",(q=>q.loadBufferAsync&&q.loadBufferAsync(Y,b,C,R)))}static LoadExtensionAsync(Y,b,C,R){if(!b.extensions)return null;const q=b.extensions[C];return q?R(`${Y}/extensions/${C}`,q):null}static LoadExtraAsync(Y,b,C,R){if(!b.extras)return null;const q=b.extras[C];return q?R(`${Y}/extras/${C}`,q):null}isExtensionUsed(Y){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(Y)}logOpen(Y){this._parent._logOpen(Y)}logClose(){this._parent._logClose()}log(Y){this._parent._log(Y)}startPerformanceCounter(Y){this._parent._startPerformanceCounter(Y)}endPerformanceCounter(Y){this._parent._endPerformanceCounter(Y)}}D.DefaultSampler={index:-1},v.d._CreateGLTF2Loader=Y=>new D(Y);var d=C(14368),V=C(13015),k=C(12870),x=C(14377),a=C(14386);class M extends a.b{constructor(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",Y),this._texture=Y.getEngine().createRawCubeTexture(b,C,R,q,A,E,B,g)}update(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,Y,b,C,R,q)}updateRGBDAsync(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,x.k)(this._texture,Y,b,C,R).then((()=>{}))}clone(){return k.e.Clone((()=>{const Y=this.uY(),b=this._texture,C=new M(Y,b._bufferViewArray,b.width,b.format,b.type,b.generateMipMaps,b.invertY,b.samplingMode,b._compression);return 13===b.source&&C.updateRGBDAsync(b._bufferViewArrayArray,b._sphericalPolynomial,b._lodGenerationScale,b._lodGenerationOffset),C}),this)}}const K="EXT_lights_image_based";class f{constructor(Y){this.name=K,this._loader=Y,this.enabled=this._loader.isExtensionUsed(K)}dispose(){this._loader=null,delete this._lights}onLoading(){const Y=this._loader.Qb.extensions;if(Y&&Y[this.name]){const b=Y[this.name];this._lights=b.lights}}loadSceneAsync(Y,b){return D.LoadExtensionAsync(Y,b,this.name,(async(C,R)=>{this._loader._allMaterialsDirtyRequired=!0;const q=new Array;q.push(this._loader.loadSceneAsync(Y,b)),this._loader.logOpen(`${C}`);const A=W.Get(`${C}/light`,this._lights,R.rb);return q.push(this._loadLightAsync(`/extensions/${this.name}/lights/${R.rb}`,A).then((Y=>{this._loader.babylonScene.environmentTexture=Y}))),this._loader.logClose(),await Promise.all(q).then((()=>{}))}))}_loadLightAsync(Y,b){if(!b._loaded){const C=new Array;this._loader.logOpen(`${Y}`);const R=new Array(b.specularImages.length);for(let q=0;q<b.specularImages.length;q++){const A=b.specularImages[q];R[q]=new Array(A.length);for(let b=0;b<A.length;b++){const E=`${Y}/specularImages/${q}/${b}`;this._loader.logOpen(`${E}`);const B=A[b],g=W.Get(E,this._loader.Qb.images,B);C.push(this._loader.loadImageAsync(`/images/${B}`,g).then((Y=>{R[q][b]=Y}))),this._loader.logClose()}}this._loader.logClose(),b._loaded=Promise.all(C).then((async()=>{const C=new M(this._loader.babylonScene,null,b.specularImageSize);if(C.name=b.name||"environment",b._babylonTexture=C,void 0!=b.ib&&(C.level=b.ib),b.rotation){let Y=q.Quaternion.OC(b.rotation);this._loader.babylonScene.useRightHandedSystem||(Y=q.Quaternion.Inverse(Y)),q.Matrix.FromQuaternionToRef(Y,C.getReflectionTextureMatrix())}if(!b.irradianceCoefficients)throw new Error(`${Y}: Irradiance coefficients are missing`);const A=V.c.OC(b.irradianceCoefficients);A.scaleInPlace(b.ib),A.convertIrradianceToLambertianRadiance();const E=V.g.FromHarmonics(A),B=(R.length-1)/Math.log2(b.specularImageSize);return await C.updateRGBDAsync(R,E,B)}))}return b._loaded.then((()=>b._babylonTexture))}}h(K),G(K,!0,(Y=>new f(Y)));C(13386);const Z="EXT_mesh_gpu_instancing";class YY{constructor(Y){this.name=Z,this._loader=Y,this.enabled=this._loader.isExtensionUsed(Z)}dispose(){this._loader=null}loadNodeAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(Y,R)=>{this._loader._disableInstancedMesh++;const A=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,C);if(this._loader._disableInstancedMesh--,!b._primitiveBabylonMeshes)return await A;const E=new Array;let B=0;const g=b=>{if(void 0==R.attributes[b])return void E.push(Promise.resolve(null));const C=W.Get(`${Y}/attributes/${b}`,this._loader.Qb.accessors,R.attributes[b]);if(E.push(this._loader._loadFloatAccessorAsync(`/accessors/${C.bufferView}`,C)),0===B)B=C.count;else if(B!==C.count)throw new Error(`${Y}/attributes: Instance buffer accessors do not have the same count.`)};return g("TRANSLATION"),g("ROTATION"),g("SCALE"),await A.then((async Y=>{const[C,R,A]=await Promise.all(E),g=new Float32Array(16*B);q.TmpVectors.AC[0].Ub(0,0,0),q.TmpVectors.Quaternion[0].Ub(0,0,0,1),q.TmpVectors.AC[1].Ub(1,1,1);for(let b=0;b<B;++b)C&&q.AC.FromArrayToRef(C,3*b,q.TmpVectors.AC[0]),R&&q.Quaternion.FromArrayToRef(R,4*b,q.TmpVectors.Quaternion[0]),A&&q.AC.FromArrayToRef(A,3*b,q.TmpVectors.AC[1]),q.Matrix.ComposeToRef(q.TmpVectors.AC[1],q.TmpVectors.Quaternion[0],q.TmpVectors.AC[0],q.TmpVectors.Matrix[0]),q.TmpVectors.Matrix[0].copyToArray(g,16*b);for(const q of b._primitiveBabylonMeshes)q.By("matrix",g,16,!0);return Y}))}))}}h(Z),G(Z,!0,(Y=>new YY(Y)));let bY=0,CY=null;class RY{static get Default(){return RY._Default||(RY._Default=new RY),RY._Default}constructor(){const Y=RY.Configuration.decoder;this._decoderModulePromise=E.Tools.LoadBabylonScriptAsync(Y.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(Y,b,C,R,q){await this._decoderModulePromise,0===bY&&(MeshoptDecoder.useWorkers(1),bY=1);const A=await MeshoptDecoder.decodeGltfBufferAsync(b,C,Y,R,q);return null!==CY&&clearTimeout(CY),CY=setTimeout((()=>{MeshoptDecoder.useWorkers(0),bY=0,CY=null}),1e3),A}}RY.Configuration={decoder:{url:`${E.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},RY._Default=null;const qY="EXT_meshopt_compression";class AY{constructor(Y){this.name=qY,this.enabled=Y.isExtensionUsed(qY),this._loader=Y}dispose(){this._loader=null}loadBufferViewAsync(Y,b){return D.LoadExtensionAsync(Y,b,this.name,(async(C,R)=>{const q=b;if(q._meshOptData)return await q._meshOptData;const A=W.Get(`${Y}/buffer`,this._loader.Qb.buffers,R.buffer);return q._meshOptData=this._loader.loadBufferAsync(`/buffers/${A.index}`,A,R.byteOffset||0,R.byteLength).then((async Y=>await RY.Default.decodeGltfBufferAsync(Y,R.count,R.byteStride,R.mode,R.filter))),await q._meshOptData}))}}h(qY),G(qY,!0,(Y=>new AY(Y)));const EY="EXT_texture_webp";class BY{constructor(Y){this.name=EY,this._loader=Y,this.enabled=Y.isExtensionUsed(EY)}dispose(){this._loader=null}_loadTextureAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=void 0==b.sampler?D.DefaultSampler:W.Get(`${Y}/sampler`,this._loader.Qb.samplers,b.sampler),E=W.Get(`${R}/source`,this._loader.Qb.images,q.source);return await this._loader._createTextureAsync(Y,A,E,(Y=>{C(Y)}),void 0,!b._textureInfo.nonColorData)}))}}h(EY),G(EY,!0,(Y=>new BY(Y)));const gY="EXT_texture_avif";class rY{constructor(Y){this.name=gY,this._loader=Y,this.enabled=Y.isExtensionUsed(gY)}dispose(){this._loader=null}_loadTextureAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=void 0==b.sampler?D.DefaultSampler:W.Get(`${Y}/sampler`,this._loader.Qb.samplers,b.sampler),E=W.Get(`${R}/source`,this._loader.Qb.images,q.source);return await this._loader._createTextureAsync(Y,A,E,(Y=>{C(Y)}),void 0,!b._textureInfo.nonColorData)}))}}h(gY),G(gY,!0,(Y=>new rY(Y)));var OY=C(14362),FY=C(13366);const yY="EXT_lights_ies";class SY{constructor(Y){this.name=yY,this._loader=Y,this.enabled=this._loader.isExtensionUsed(yY)}dispose(){this._loader=null,delete this._lights}onLoading(){const Y=this._loader.Qb.extensions;if(Y&&Y[this.name]){const b=Y[this.name];this._lights=b.lights,W.Assign(this._lights)}}loadNodeAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,E)=>{let B,g;this._loader._allMaterialsDirtyRequired=!0;const r=await this._loader.loadNodeAsync(Y,b,(Y=>{g=W.Get(R,this._lights,E.rb);const b=g.name||Y.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,B=new OY.c(b,q.AC.Zero(),q.AC.Backward(),0,1,this._loader.babylonScene),B.angle=Math.PI/2,B.innerAngle=0,B._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,g._babylonLight=B,B.falloffType=FY.e.FALLOFF_GLTF,B.Wb=E.color?A.rC.OC(E.color):A.rC.White(),B.ib=E.multiplier||1,B.range=Number.MAX_VALUE,B.parent=Y,this._loader._babylonLights.push(B),D.AddPointerMetadata(B,R),C(Y)}));let O;if(g.uri)O=await this._loader.loadUriAsync(Y,g,g.uri);else{const b=W.Get(`${Y}/bufferView`,this._loader.Qb.bufferViews,g.bufferView);O=await this._loader.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}return B.iesProfileTexture=new p.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,O,!0,void 0,void 0,void 0,void 0,".ies"),r}))}}h(yY),G(yY,!0,(Y=>new SY(Y)));var nY=C(14398);const tY="KHR_draco_mesh_compression";class IY{constructor(Y){this.name=tY,this.useNormalizedFlagFromAccessor=!0,this._loader=Y,this.enabled=nY.e.DefaultAvailable&&this._loader.isExtensionUsed(tY)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{if(void 0!=b.mode&&4!==b.mode&&5!==b.mode)throw new Error(`${Y}: Unsupported mode ${b.mode}`);const A={},E={},B=(Y,R)=>{const B=q.attributes[Y];if(void 0!=B&&(C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(R)&&C._delayInfo.push(R),A[R]=B,this.useNormalizedFlagFromAccessor)){const C=W.TryGet(this._loader.Qb.accessors,b.attributes[Y]);C&&(E[R]=C.normalized||!1)}};B("POSITION",L.e.PositionKind),B("NORMAL",L.e.NormalKind),B("TANGENT",L.e.TangentKind),B("TEXCOORD_0",L.e.UVKind),B("TEXCOORD_1",L.e.UV2Kind),B("TEXCOORD_2",L.e.UV3Kind),B("TEXCOORD_3",L.e.UV4Kind),B("TEXCOORD_4",L.e.UV5Kind),B("TEXCOORD_5",L.e.UV6Kind),B("JOINTS_0",L.e.MatricesIndicesKind),B("WEIGHTS_0",L.e.MatricesWeightsKind),B("COLOR_0",L.e.ColorKind);const g=W.Get(R,this._loader.Qb.bufferViews,q.bufferView);return g._dracoBabylonGeometry||(g._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((async R=>{const q=this.dracoDecoder||nY.e.Default,B=W.TryGet(this._loader.Qb.accessors,b.attributes.POSITION),g=this._loader.parent.alwaysComputeBoundingBox||C.skeleton||!B?null:s(B);return await q._decodeMeshToGeometryForGltfAsync(C.name,this._loader.babylonScene,R,A,E,g).catch((b=>{throw new Error(`${Y}: ${b.message}`)}))}))),await g._dracoBabylonGeometry}))}}h(tY),G(tY,!0,(Y=>new IY(Y)));var wY=C(14404),QY=C(12818),NY=C(12821),pY=C(13242),mb=C(13421),LY=C(12790);pY.d.AddNodeConstructor("Light_Type_0",((Y,b)=>()=>new uY(Y,q.AC.Zero(),b)));class uY extends mb.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(Y){this._shadowAngle=Y,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(Y){const b=this.needCube();if(this._direction=Y,this.needCube()!==b&&this._shadowGenerators){const Y=this._shadowGenerators.values();for(let b=Y.next();!0!==b.done;b=Y.next()){b.value.recreateShadowMap()}}}constructor(Y,b,C){super(Y,C),this._shadowAngle=Math.PI/2,this.position=b}getClassName(){return"PointLight"}getTypeID(){return FY.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(Y){if(this.direction)return super.getShadowDirection(Y);switch(Y){case 0:return new q.AC(1,0,0);case 1:return new q.AC(-1,0,0);case 2:return new q.AC(0,-1,0);case 3:return new q.AC(0,1,0);case 4:return new q.AC(0,0,1);case 5:return new q.AC(0,0,-1)}return q.AC.Zero()}_setDefaultShadowProjectionMatrix(Y,b,C){const R=this.uY().activeCamera;if(!R)return;const A=void 0!==this.shadowMinZ?this.shadowMinZ:R.Xb,E=void 0!==this.shadowMaxZ?this.shadowMaxZ:R.maxZ,B=this.uY().getEngine().o;q.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,B?E:A,B?A:E,Y,!0,this._scene.getEngine().isNDCHalfZRange,void 0,B)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Y,b){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,b):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,b),this}transferToNodeMaterialEffect(Y,b){return this.computeTransformedInformation()?Y.setFloat3(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):Y.setFloat3(b,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(Y,b){Y["POINTLIGHT"+b]=!0}}(0,QY.c)([(0,NY.K)()],uY.prototype,"shadowAngle",null),(0,LY.g)("BABYLON.PointLight",uY);const cY="KHR_lights_punctual";class lY{constructor(Y){this.name=cY,this._loader=Y,this.enabled=this._loader.isExtensionUsed(cY)}dispose(){this._loader=null,delete this._lights}onLoading(){const Y=this._loader.Qb.extensions;if(Y&&Y[this.name]){const b=Y[this.name];this._lights=b.lights,W.Assign(this._lights)}}loadNodeAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,E)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(Y,b,(Y=>{let b;const B=W.Get(R,this._lights,E.rb),g=B.name||Y.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,B.type){case"directional":{const Y=new wY.c(g,q.AC.Backward(),this._loader.babylonScene);Y.position.Gb(0),b=Y;break}case"point":b=new uY(g,q.AC.Zero(),this._loader.babylonScene);break;case"spot":{const Y=new OY.c(g,q.AC.Zero(),q.AC.Backward(),0,1,this._loader.babylonScene);Y.angle=2*(B.spot&&B.spot.outerConeAngle||Math.PI/4),Y.innerAngle=2*(B.spot&&B.spot.innerConeAngle||0),b=Y;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${R}: Invalid light type (${B.type})`)}b._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,B._babylonLight=b,b.falloffType=FY.e.FALLOFF_GLTF,b.Wb=B.color?A.rC.OC(B.color):A.rC.White(),b.ib=void 0==B.ib?1:B.ib,b.range=void 0==B.range?Number.MAX_VALUE:B.range,b.parent=Y,this._loader._babylonLights.push(b),D.AddPointerMetadata(b,R),C(Y)})))))}}h(cY),G(cY,!0,(Y=>new lY(Y)));const XY="KHR_materials_pbrSpecularGlossiness";class jY{constructor(Y){this.name=XY,this.order=200,this._loader=Y,this.enabled=this._loader.isExtensionUsed(XY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;return A.push(this._loader.loadMaterialBasePropertiesAsync(Y,b,C)),A.push(this._loadSpecularGlossinessPropertiesAsync(R,q,C)),this._loader.loadMaterialAlphaProperties(Y,b,C),await Promise.all(A).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const R=new Array;return C.metallic=null,C.roughness=null,b.diffuseFactor?(C.albedoColor=A.rC.OC(b.diffuseFactor),C.alpha=b.diffuseFactor[3]):C.albedoColor=A.rC.White(),C.reflectivityColor=b.specularFactor?A.rC.OC(b.specularFactor):A.rC.White(),C.microSurface=void 0==b.glossinessFactor?1:b.glossinessFactor,b.diffuseTexture&&R.push(this._loader.loadTextureInfoAsync(`${Y}/diffuseTexture`,b.diffuseTexture,(Y=>{Y.name=`${C.name} (Diffuse)`,C.albedoTexture=Y}))),b.specularGlossinessTexture&&(R.push(this._loader.loadTextureInfoAsync(`${Y}/specularGlossinessTexture`,b.specularGlossinessTexture,(Y=>{Y.name=`${C.name} (Specular Glossiness)`,C.reflectivityTexture=Y,C.reflectivityTexture.lb=!0}))),C.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(R).then((()=>{}))}}h(XY),G(XY,!0,(Y=>new jY(Y)));const TY="KHR_materials_unlit";class PY{constructor(Y){this.name=TY,this.order=210,this._loader=Y,this.enabled=this._loader.isExtensionUsed(TY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async()=>await this._loadUnlitPropertiesAsync(Y,b,C)))}_loadUnlitPropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const R=new Array;C.unlit=!0;const q=b.pbrMetallicRoughness;return q&&(q.baseColorFactor?(C.albedoColor=A.rC.OC(q.baseColorFactor),C.alpha=q.baseColorFactor[3]):C.albedoColor=A.rC.White(),q.baseColorTexture&&R.push(this._loader.loadTextureInfoAsync(`${Y}/baseColorTexture`,q.baseColorTexture,(Y=>{Y.name=`${C.name} (Base Color)`,C.albedoTexture=Y})))),b.doubleSided&&(C.Jb=!1,C.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(Y,b,C),Promise.all(R).then((()=>{}))}}h(TY),G(TY,!0,(Y=>new PY(Y)));const vY="KHR_materials_clearcoat";class zY{constructor(Y){this.name=vY,this.order=190,this._loader=Y,this.enabled=this._loader.isExtensionUsed(vY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadClearCoatPropertiesAsync(R,q,C)),await Promise.all(A)}))}_loadClearCoatPropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const R=new Array;return C.clearCoat.isEnabled=!0,C.clearCoat.useRoughnessFromMainTexture=!1,C.clearCoat.remapF0OnInterfaceChange=!1,void 0!=b.clearcoatFactor?C.clearCoat.ib=b.clearcoatFactor:C.clearCoat.ib=0,b.clearcoatTexture&&R.push(this._loader.loadTextureInfoAsync(`${Y}/clearcoatTexture`,b.clearcoatTexture,(Y=>{Y.name=`${C.name} (ClearCoat)`,C.clearCoat.texture=Y}))),void 0!=b.clearcoatRoughnessFactor?C.clearCoat.roughness=b.clearcoatRoughnessFactor:C.clearCoat.roughness=0,b.clearcoatRoughnessTexture&&(b.clearcoatRoughnessTexture.nonColorData=!0,R.push(this._loader.loadTextureInfoAsync(`${Y}/clearcoatRoughnessTexture`,b.clearcoatRoughnessTexture,(Y=>{Y.name=`${C.name} (ClearCoat Roughness)`,C.clearCoat.textureRoughness=Y})))),b.clearcoatNormalTexture&&(b.clearcoatNormalTexture.nonColorData=!0,R.push(this._loader.loadTextureInfoAsync(`${Y}/clearcoatNormalTexture`,b.clearcoatNormalTexture,(Y=>{Y.name=`${C.name} (ClearCoat Normal)`,C.clearCoat.bumpTexture=Y}))),C.invertNormalMapX=!C.uY().useRightHandedSystem,C.invertNormalMapY=C.uY().useRightHandedSystem,void 0!=b.clearcoatNormalTexture.scale&&(C.clearCoat.bumpTexture.level=b.clearcoatNormalTexture.scale)),Promise.all(R).then((()=>{}))}}h(vY),G(vY,!0,(Y=>new zY(Y)));const JY="KHR_materials_iridescence";class UY{constructor(Y){this.name=JY,this.order=195,this._loader=Y,this.enabled=this._loader.isExtensionUsed(JY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadIridescencePropertiesAsync(R,q,C)),await Promise.all(A).then((()=>{}))}))}_loadIridescencePropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const R=new Array;return C.iridescence.isEnabled=!0,C.iridescence.ib=b.iridescenceFactor??0,C.iridescence.indexOfRefraction=b.iridescenceIor??b.iridescenceIOR??1.3,C.iridescence.minimumThickness=b.iridescenceThicknessMinimum??100,C.iridescence.maximumThickness=b.iridescenceThicknessMaximum??400,b.iridescenceTexture&&R.push(this._loader.loadTextureInfoAsync(`${Y}/iridescenceTexture`,b.iridescenceTexture,(Y=>{Y.name=`${C.name} (Iridescence)`,C.iridescence.texture=Y}))),b.iridescenceThicknessTexture&&R.push(this._loader.loadTextureInfoAsync(`${Y}/iridescenceThicknessTexture`,b.iridescenceThicknessTexture,(Y=>{Y.name=`${C.name} (Iridescence Thickness)`,C.iridescence.thicknessTexture=Y}))),Promise.all(R).then((()=>{}))}}h(JY),G(JY,!0,(Y=>new UY(Y)));const oY="KHR_materials_anisotropy";class GY{constructor(Y){this.name=oY,this.order=195,this._loader=Y,this.enabled=this._loader.isExtensionUsed(oY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadIridescencePropertiesAsync(R,q,C)),await Promise.all(A)}))}async _loadIridescencePropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const R=new Array;C.anisotropy.isEnabled=!0,C.anisotropy.ib=b.anisotropyStrength??0,C.anisotropy.angle=b.anisotropyRotation??0,b.anisotropyTexture&&(b.anisotropyTexture.nonColorData=!0,R.push(this._loader.loadTextureInfoAsync(`${Y}/anisotropyTexture`,b.anisotropyTexture,(Y=>{Y.name=`${C.name} (Anisotropy Intensity)`,C.anisotropy.texture=Y})))),await Promise.all(R)}}h(oY),G(oY,!0,(Y=>new GY(Y)));const hY="KHR_materials_emissive_strength";class eY{constructor(Y){this.name=hY,this.order=170,this._loader=Y,this.enabled=this._loader.isExtensionUsed(hY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>await this._loader.loadMaterialPropertiesAsync(Y,b,C).then((()=>{this._loadEmissiveProperties(R,q,C)}))))}_loadEmissiveProperties(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);void 0!==b.emissiveStrength&&(C.emissiveIntensity=b.emissiveStrength)}}h(hY),G(hY,!0,(Y=>new eY(Y)));const HY="KHR_materials_sheen";class iY{constructor(Y){this.name=HY,this.order=190,this._loader=Y,this.enabled=this._loader.isExtensionUsed(HY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadSheenPropertiesAsync(R,q,C)),await Promise.all(A).then((()=>{}))}))}_loadSheenPropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const R=new Array;return C.sheen.isEnabled=!0,C.sheen.ib=1,void 0!=b.sheenColorFactor?C.sheen.color=A.rC.OC(b.sheenColorFactor):C.sheen.color=A.rC.Black(),b.sheenColorTexture&&R.push(this._loader.loadTextureInfoAsync(`${Y}/sheenColorTexture`,b.sheenColorTexture,(Y=>{Y.name=`${C.name} (Sheen Color)`,C.sheen.texture=Y}))),void 0!==b.sheenRoughnessFactor?C.sheen.roughness=b.sheenRoughnessFactor:C.sheen.roughness=0,b.sheenRoughnessTexture&&(b.sheenRoughnessTexture.nonColorData=!0,R.push(this._loader.loadTextureInfoAsync(`${Y}/sheenRoughnessTexture`,b.sheenRoughnessTexture,(Y=>{Y.name=`${C.name} (Sheen Roughness)`,C.sheen.textureRoughness=Y})))),C.sheen.albedoScaling=!0,C.sheen.useRoughnessFromMainTexture=!1,Promise.all(R).then((()=>{}))}}h(HY),G(HY,!0,(Y=>new iY(Y)));var WY=C(13310);const sY="KHR_materials_specular";class DY{constructor(Y){this.name=sY,this.order=190,this._loader=Y,this.enabled=this._loader.isExtensionUsed(sY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;if(A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadSpecularPropertiesAsync(R,q,C)),q.extensions&&q.extensions.EXT_materials_specular_edge_color&&C instanceof N.b){q.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(C.brdf.dielectricSpecularModel=WY.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,C.brdf.conductorSpecularModel=WY.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(A).then((()=>{}))}))}_loadSpecularPropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const R=new Array;return void 0!==b.specularFactor&&(C.metallicF0Factor=b.specularFactor),void 0!==b.specularColorFactor&&(C.metallicReflectanceColor=A.rC.OC(b.specularColorFactor)),b.specularTexture&&(b.specularTexture.nonColorData=!0,R.push(this._loader.loadTextureInfoAsync(`${Y}/specularTexture`,b.specularTexture,(Y=>{Y.name=`${C.name} (Specular)`,C.metallicReflectanceTexture=Y,C.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),b.specularColorTexture&&R.push(this._loader.loadTextureInfoAsync(`${Y}/specularColorTexture`,b.specularColorTexture,(Y=>{Y.name=`${C.name} (Specular Color)`,C.reflectanceTexture=Y}))),Promise.all(R).then((()=>{}))}}h(sY),G(sY,!0,(Y=>new DY(Y)));const dY="KHR_materials_ior";class VY{constructor(Y){this.name=dY,this.order=180,this._loader=Y,this.enabled=this._loader.isExtensionUsed(dY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadIorPropertiesAsync(R,q,C)),await Promise.all(A).then((()=>{}))}))}_loadIorPropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);return void 0!==b.ior?C.indexOfRefraction=b.ior:C.indexOfRefraction=VY._DEFAULT_IOR,Promise.resolve()}}VY._DEFAULT_IOR=1.5,h(dY),G(dY,!0,(Y=>new VY(Y)));const kY="KHR_materials_variants";class xY{constructor(Y){this.name=kY,this._loader=Y,this.enabled=this._loader.isExtensionUsed(kY)}dispose(){this._loader=null}static GetAvailableVariants(Y){const b=this._GetExtensionMetadata(Y);return b?Object.keys(b.variants):[]}getAvailableVariants(Y){return xY.GetAvailableVariants(Y)}static SelectVariant(Y,b){const C=this._GetExtensionMetadata(Y);if(!C)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${kY} extension`);const R=Y=>{const b=C.variants[Y];if(b)for(const C of b)C.mesh.material=C.material};if(b instanceof Array)for(const q of b)R(q);else R(b);C.lastSelected=b}selectVariant(Y,b){xY.SelectVariant(Y,b)}static Reset(Y){const b=this._GetExtensionMetadata(Y);if(!b)throw new Error(`Cannot reset on a glTF mesh that does not have the ${kY} extension`);for(const C of b.original)C.mesh.material=C.material;b.lastSelected=null}reset(Y){xY.Reset(Y)}static GetLastSelectedVariant(Y){const b=this._GetExtensionMetadata(Y);if(!b)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${kY} extension`);return b.lastSelected}getLastSelectedVariant(Y){return xY.GetLastSelectedVariant(Y)}static _GetExtensionMetadata(Y){var b,C;return(null===Y||void 0===Y||null===(b=Y._internalMetadata)||void 0===b||null===(C=b.Qb)||void 0===C?void 0:C[kY])||null}onLoading(){const Y=this._loader.Qb.extensions;if(Y&&Y[this.name]){const b=Y[this.name];this._variants=b.variants}}onReady(){const Y=this._loader.rootBabylonMesh;if(Y){var b;const C=this._loader.parent.extensionOptions[kY];null!==C&&void 0!==C&&C.defaultVariant&&xY.SelectVariant(Y,C.defaultVariant),null===C||void 0===C||null===(b=C.onLoaded)||void 0===b||b.call(C,{get variants(){return xY.GetAvailableVariants(Y)},get selectedVariant(){const b=xY.GetLastSelectedVariant(Y);return b?Array.isArray(b)?b[0]:b:xY.GetAvailableVariants(Y)[0]},set selectedVariant(b){xY.SelectVariant(Y,b)}})}}_loadMeshPrimitiveAsync(Y,b,C,R,q,A){return D.LoadExtensionAsync(Y,q,this.name,(async(E,B)=>{const g=new Array;return g.push(this._loader._loadMeshPrimitiveAsync(Y,b,C,R,q,(b=>{if(A(b),b instanceof l.d){const C=D._GetDrawMode(Y,q.mode),R=this._loader.rootBabylonMesh,A=R?R._internalMetadata=R._internalMetadata||{}:{},r=A.Qb=A.Qb||{},O=r[kY]=r[kY]||{lastSelected:null,original:[],variants:{}};O.original.push({mesh:b,material:b.material});for(let Y=0;Y<B.mappings.length;++Y){const q=B.mappings[Y],A=W.Get(`${E}/mappings/${Y}/material`,this._loader.Qb.materials,q.material);g.push(this._loader._loadMaterialAsync(`#/materials/${q.material}`,A,b,C,(Y=>{for(let C=0;C<q.variants.length;++C){const A=q.variants[C],E=W.Get(`/extensions/${kY}/variants/${A}`,this._variants,A);O.variants[E.name]=O.variants[E.name]||[],O.variants[E.name].push({mesh:b,material:Y}),b.onClonedObservable.add((Y=>{const C=Y;let q=null,A=C;do{if(A=A.parent,!A)return;q=xY._GetExtensionMetadata(A)}while(null===q);if(R&&q===xY._GetExtensionMetadata(R)){A._internalMetadata={};for(const Y in R._internalMetadata)A._internalMetadata[Y]=R._internalMetadata[Y];A._internalMetadata.Qb=[];for(const Y in R._internalMetadata.Qb)A._internalMetadata.Qb[Y]=R._internalMetadata.Qb[Y];A._internalMetadata.Qb[kY]={lastSelected:null,original:[],variants:{}};for(const Y of q.original)A._internalMetadata.Qb[kY].original.push({mesh:Y.mesh,material:Y.material});for(const Y in q.variants)if(Object.prototype.hasOwnProperty.call(q.variants,Y)){A._internalMetadata.Qb[kY].variants[Y]=[];for(const b of q.variants[Y])A._internalMetadata.Qb[kY].variants[Y].push({mesh:b.mesh,material:b.material})}q=A._internalMetadata.Qb[kY]}for(const R of q.original)R.mesh===b&&(R.mesh=C);for(const R of q.variants[E.name])R.mesh===b&&(R.mesh=C)}))}})))}}}))),await Promise.all(g).then((Y=>{let[b]=Y;return b}))}))}}h(kY),G(kY,!0,(Y=>new xY(Y)));var aY=C(12897);class MY{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:WY.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(Y,b){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...MY._GetDefaultOptions(),...Y},this._scene=b,this._scene._transmissionHelper=this,this.onErrorObservable=new O.d,this._scene.Sb.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(Y){if(!Object.keys(Y).filter((b=>this._options[b]!==Y[b])).length)return;const b={...this._options,...Y},C=this._options;this._options=b,b.renderSize===C.renderSize&&b.renderTargetTextureType===C.renderTargetTextureType&&b.generateMipmaps===C.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=b.samples,this._opaqueRenderTarget.lodGenerationScale=b.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=b.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(Y){return!!Y&&!!(Y instanceof N.b&&Y.subSurface.isRefractionEnabled)}_addMesh(Y){this._materialObservers[Y.uniqueId]=Y.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),E.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(Y.material)?(Y.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(Y)&&this._transparentMeshesCache.push(Y)):-1===this._opaqueMeshesCache.indexOf(Y)&&this._opaqueMeshesCache.push(Y)}))}_removeMesh(Y){Y.onMaterialChangedObservable.remove(this._materialObservers[Y.uniqueId]),delete this._materialObservers[Y.uniqueId];let b=this._transparentMeshesCache.indexOf(Y);-1!==b&&this._transparentMeshesCache.splice(b,1),b=this._opaqueMeshesCache.indexOf(Y),-1!==b&&this._opaqueMeshesCache.splice(b,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(Y){const b=this._transparentMeshesCache.indexOf(Y),C=this._opaqueMeshesCache.indexOf(Y);this._shouldRenderAsTransmission(Y.material)?(Y.material instanceof N.b&&(Y.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==C?(this._opaqueMeshesCache.splice(C,1),this._transparentMeshesCache.push(Y)):-1===b&&this._transparentMeshesCache.push(Y)):-1!==b?(this._transparentMeshesCache.splice(b,1),this._opaqueMeshesCache.push(Y)):-1===C&&this._opaqueMeshesCache.push(Y)}_isRenderTargetValid(){var Y;return null!==(null===(Y=this._opaqueRenderTarget)||void 0===Y?void 0:Y.getInternalTexture())}_setupRenderTargets(){var Y;let b;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new aY.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(Y=this._options.clearColor)||void 0===Y?void 0:Y.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((Y=>{b=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?Y.clearColor.q(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(Y.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=b}));for(const C of this._transparentMeshesCache)this._shouldRenderAsTransmission(C.material)&&(C.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const KY="KHR_materials_transmission";class fY{constructor(Y){this.name=KY,this.order=175,this._loader=Y,this.enabled=this._loader.isExtensionUsed(KY),this.enabled&&(Y.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadTransparentPropertiesAsync(R,b,C,q)),await Promise.all(A).then((()=>{}))}))}_loadTransparentPropertiesAsync(Y,b,C,R){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const q=C;if(q.subSurface.isRefractionEnabled=!0,q.subSurface.volumeIndexOfRefraction=1,q.subSurface.useAlbedoToTintRefraction=!0,void 0===R.transmissionFactor)return q.subSurface.refractionIntensity=0,q.subSurface.isRefractionEnabled=!1,Promise.resolve();{var A;q.subSurface.refractionIntensity=R.transmissionFactor;const Y=q.uY();if(q.subSurface.refractionIntensity&&!Y._transmissionHelper)new MY({},q.uY());else if(q.subSurface.refractionIntensity&&(null===(A=Y._transmissionHelper)||void 0===A||!A._isRenderTargetValid())){var E;null===(E=Y._transmissionHelper)||void 0===E||E._setupRenderTargets()}}return q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=0,R.transmissionTexture?(R.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Y}/transmissionTexture`,R.transmissionTexture,void 0).then((Y=>{Y.name=`${C.name} (Transmission)`,q.subSurface.refractionIntensityTexture=Y,q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}h(KY),G(KY,!0,(Y=>new fY(Y)));const ZY="KHR_materials_diffuse_transmission";class Yb{constructor(Y){this.name=ZY,this.order=174,this._loader=Y,this.enabled=this._loader.isExtensionUsed(ZY),this.enabled&&(Y.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadTranslucentPropertiesAsync(R,b,C,q)),await Promise.all(A).then((()=>{}))}))}_loadTranslucentPropertiesAsync(Y,b,C,R){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const q=C;if(q.subSurface.isTranslucencyEnabled=!0,q.subSurface.volumeIndexOfRefraction=1,q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=0,q.subSurface.useAlbedoToTintTranslucency=!1,void 0===R.diffuseTransmissionFactor)return q.subSurface.translucencyIntensity=0,q.subSurface.isTranslucencyEnabled=!1,Promise.resolve();q.subSurface.translucencyIntensity=R.diffuseTransmissionFactor;const E=new Array;return q.subSurface.useGltfStyleTextures=!0,R.diffuseTransmissionTexture&&(R.diffuseTransmissionTexture.nonColorData=!0,E.push(this._loader.loadTextureInfoAsync(`${Y}/diffuseTransmissionTexture`,R.diffuseTransmissionTexture).then((Y=>{Y.name=`${C.name} (Diffuse Transmission)`,q.subSurface.translucencyIntensityTexture=Y})))),void 0!==R.diffuseTransmissionColorFactor?q.subSurface.translucencyColor=A.rC.OC(R.diffuseTransmissionColorFactor):q.subSurface.translucencyColor=A.rC.White(),R.diffuseTransmissionColorTexture&&E.push(this._loader.loadTextureInfoAsync(`${Y}/diffuseTransmissionColorTexture`,R.diffuseTransmissionColorTexture).then((Y=>{Y.name=`${C.name} (Diffuse Transmission Color)`,q.subSurface.translucencyColorTexture=Y}))),Promise.all(E).then((()=>{}))}}h(ZY),G(ZY,!0,(Y=>new Yb(Y)));const bb="KHR_materials_volume";class Cb{constructor(Y){this.name=bb,this.order=173,this._loader=Y,this.enabled=this._loader.isExtensionUsed(bb),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadVolumePropertiesAsync(R,b,C,q)),await Promise.all(A).then((()=>{}))}))}_loadVolumePropertiesAsync(Y,b,C,R){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);if(!C.subSurface.isRefractionEnabled&&!C.subSurface.isTranslucencyEnabled||!R.thicknessFactor)return Promise.resolve();C.subSurface.volumeIndexOfRefraction=C.indexOfRefraction;const q=void 0!==R.attenuationDistance?R.attenuationDistance:Number.MAX_VALUE;return C.subSurface.tintColorAtDistance=q,void 0!==R.attenuationColor&&3==R.attenuationColor.length&&C.subSurface.tintColor.Ub(R.attenuationColor[0],R.attenuationColor[1],R.attenuationColor[2]),C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=R.thicknessFactor,C.subSurface.useThicknessAsDepth=!0,R.thicknessTexture?(R.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Y}/thicknessTexture`,R.thicknessTexture).then((Y=>{Y.name=`${C.name} (Thickness)`,C.subSurface.thicknessTexture=Y,C.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}h(bb),G(bb,!0,(Y=>new Cb(Y)));const Rb="KHR_materials_dispersion";class qb{constructor(Y){this.name=Rb,this.order=174,this._loader=Y,this.enabled=this._loader.isExtensionUsed(Rb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadDispersionPropertiesAsync(R,b,C,q)),await Promise.all(A).then((()=>{}))}))}_loadDispersionPropertiesAsync(Y,b,C,R){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);return C.subSurface.isRefractionEnabled&&R.dispersion?(C.subSurface.isDispersionEnabled=!0,C.subSurface.dispersion=R.dispersion,Promise.resolve()):Promise.resolve()}}h(Rb),G(Rb,!0,(Y=>new qb(Y)));const Ab="EXT_materials_diffuse_roughness";class Eb{constructor(Y){this.name=Ab,this.order=190,this._loader=Y,this.enabled=this._loader.isExtensionUsed(Ab)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(Y,b,C)),A.push(this._loadDiffuseRoughnessPropertiesAsync(R,q,C)),await Promise.all(A).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(Y,b,C){if(!(C instanceof N.b))throw new Error(`${Y}: Material type not supported`);const R=new Array;return C.brdf.baseDiffuseModel=WY.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=b.diffuseRoughnessFactor?C.baseDiffuseRoughness=b.diffuseRoughnessFactor:C.baseDiffuseRoughness=0,b.diffuseRoughnessTexture&&R.push(this._loader.loadTextureInfoAsync(`${Y}/diffuseRoughnessTexture`,b.diffuseRoughnessTexture,(Y=>{Y.name=`${C.name} (Diffuse Roughness)`,C.baseDiffuseRoughnessTexture=Y}))),Promise.all(R).then((()=>{}))}}h(Ab),G(Ab,!0,(Y=>new Eb(Y)));const Bb="KHR_mesh_quantization";class gb{constructor(Y){this.name=Bb,this.enabled=Y.isExtensionUsed(Bb)}dispose(){}}h(Bb),G(Bb,!0,(Y=>new gb(Y)));const rb="KHR_texture_basisu";class Ob{constructor(Y){this.name=rb,this._loader=Y,this.enabled=Y.isExtensionUsed(rb)}dispose(){this._loader=null}_loadTextureAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>{const A=void 0==b.sampler?D.DefaultSampler:W.Get(`${Y}/sampler`,this._loader.Qb.samplers,b.sampler),E=W.Get(`${R}/source`,this._loader.Qb.images,q.source);return await this._loader._createTextureAsync(Y,A,E,(Y=>{C(Y)}),b._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!b._textureInfo.nonColorData)}))}}h(rb),G(rb,!0,(Y=>new Ob(Y)));const Fb="KHR_texture_transform";class yb{constructor(Y){this.name=Fb,this._loader=Y,this.enabled=this._loader.isExtensionUsed(Fb)}dispose(){this._loader=null}loadTextureInfoAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(R,q)=>await this._loader.loadTextureInfoAsync(Y,b,(Y=>{if(!(Y instanceof p.b))throw new Error(`${R}: Texture type not supported`);q.offset&&(Y.uOffset=q.offset[0],Y.vOffset=q.offset[1]),Y.uRotationCenter=0,Y.vRotationCenter=0,q.rotation&&(Y.wAng=-q.rotation),q.scale&&(Y.uScale=q.scale[0],Y.vScale=q.scale[1]),void 0!=q.texCoord&&(Y.coordinatesIndex=q.texCoord),C(Y)}))))}}h(Fb),G(Fb,!0,(Y=>new yb(Y)));const Sb="KHR_xmp_json_ld";class nb{constructor(Y){this.name=Sb,this.order=100,this._loader=Y,this.enabled=this._loader.isExtensionUsed(Sb)}dispose(){this._loader=null}onLoading(){var Y,b,C;if(null===this._loader.rootBabylonMesh)return;const R=null===(Y=this._loader.Qb.extensions)||void 0===Y?void 0:Y.KHR_xmp_json_ld,q=null===(b=this._loader.Qb.asset)||void 0===b||null===(C=b.extensions)||void 0===C?void 0:C.KHR_xmp_json_ld;if(R&&q){const Y=+q.packet;R.packets&&Y<R.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=R.packets[Y])}}}function tb(Y,b,C,R){return A.rC.OC(b,C).scale(R)}function Ib(Y,b,C,R){return b[C]*R}function wb(Y,b,C,R){return-b[C]*R}function Qb(Y,b,C,R){return b[C+1]*R}function Nb(Y,b,C,R){return b[C]*R*2}function pb(Y){return{scale:[new Lb(y.e.ANIMATIONTYPE_FLOAT,`${Y}.uScale`,Ib,(()=>2)),new Lb(y.e.ANIMATIONTYPE_FLOAT,`${Y}.vScale`,Qb,(()=>2))],offset:[new Lb(y.e.ANIMATIONTYPE_FLOAT,`${Y}.uOffset`,Ib,(()=>2)),new Lb(y.e.ANIMATIONTYPE_FLOAT,`${Y}.vOffset`,Qb,(()=>2))],rotation:[new Lb(y.e.ANIMATIONTYPE_FLOAT,`${Y}.wAng`,wb,(()=>1))]}}h(Sb),G(Sb,!0,(Y=>new nb(Y)));class mC extends d.AnimationPropertyInfo{buildAnimations(Y,b,C,R){return[{babylonAnimatable:Y._babylonCamera,babylonAnimation:this._buildAnimation(b,C,R)}]}}class Lb extends d.AnimationPropertyInfo{buildAnimations(Y,b,C,R){const q=[];for(const A in Y._data)q.push({babylonAnimatable:Y._data[A].babylonMaterial,babylonAnimation:this._buildAnimation(b,C,R)});return q}}class ub extends d.AnimationPropertyInfo{buildAnimations(Y,b,C,R){return[{babylonAnimatable:Y._babylonLight,babylonAnimation:this._buildAnimation(b,C,R)}]}}(0,e.l)("/cameras/{}/orthographic/xmag",[new mC(y.e.ANIMATIONTYPE_FLOAT,"orthoLeft",wb,(()=>1)),new mC(y.e.ANIMATIONTYPE_FLOAT,"orthoRight",Qb,(()=>1))]),(0,e.l)("/cameras/{}/orthographic/ymag",[new mC(y.e.ANIMATIONTYPE_FLOAT,"orthoBottom",wb,(()=>1)),new mC(y.e.ANIMATIONTYPE_FLOAT,"orthoTop",Qb,(()=>1))]),(0,e.l)("/cameras/{}/orthographic/zfar",[new mC(y.e.ANIMATIONTYPE_FLOAT,"maxZ",Ib,(()=>1))]),(0,e.l)("/cameras/{}/orthographic/znear",[new mC(y.e.ANIMATIONTYPE_FLOAT,"Xb",Ib,(()=>1))]),(0,e.l)("/cameras/{}/perspective/yfov",[new mC(y.e.ANIMATIONTYPE_FLOAT,"fov",Ib,(()=>1))]),(0,e.l)("/cameras/{}/perspective/zfar",[new mC(y.e.ANIMATIONTYPE_FLOAT,"maxZ",Ib,(()=>1))]),(0,e.l)("/cameras/{}/perspective/znear",[new mC(y.e.ANIMATIONTYPE_FLOAT,"Xb",Ib,(()=>1))]),(0,e.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Lb(y.e.ANIMATIONTYPE_COLOR3,"albedoColor",tb,(()=>4)),new Lb(y.e.ANIMATIONTYPE_FLOAT,"alpha",(function(Y,b,C,R){return b[C+3]*R}),(()=>4))]),(0,e.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"metallic",Ib,(()=>1))]),(0,e.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"roughness",Ib,(()=>1))]);const cb=pb("albedoTexture");(0,e.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",cb.scale),(0,e.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",cb.offset),(0,e.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",cb.rotation);const lb=pb("metallicTexture");(0,e.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",lb.scale),(0,e.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",lb.offset),(0,e.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",lb.rotation),(0,e.l)("/materials/{}/emissiveFactor",[new Lb(y.e.ANIMATIONTYPE_COLOR3,"emissiveColor",tb,(()=>3))]);const Xb=pb("bumpTexture");(0,e.l)("/materials/{}/normalTexture/scale",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Ib,(()=>1))]),(0,e.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Xb.scale),(0,e.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Xb.offset),(0,e.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Xb.rotation),(0,e.l)("/materials/{}/occlusionTexture/strength",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Ib,(()=>1))]);const jb=pb("ambientTexture");(0,e.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",jb.scale),(0,e.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",jb.offset),(0,e.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",jb.rotation);const Tb=pb("emissiveTexture");(0,e.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Tb.scale),(0,e.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Tb.offset),(0,e.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Tb.rotation),(0,e.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Ib,(()=>1))]);const Pb=pb("anisotropy.texture");(0,e.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Pb.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Pb.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Pb.rotation),(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Ib,(()=>1))]);const vb=pb("clearCoat.texture");(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",vb.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",vb.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",vb.rotation);const zb=pb("clearCoat.bumpTexture");(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",zb.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",zb.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",zb.rotation);const Jb=pb("clearCoat.textureRoughness");(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Jb.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Jb.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Jb.rotation),(0,e.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Ib,(()=>1))]);const Ub=pb("iridescence.texture");(0,e.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Ub.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Ub.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Ub.rotation);const ob=pb("iridescence.thicknessTexture");(0,e.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",ob.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",ob.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",ob.rotation),(0,e.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Lb(y.e.ANIMATIONTYPE_COLOR3,"sheen.color",tb,(()=>3))]),(0,e.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",Ib,(()=>1))]);const Gb=pb("sheen.texture");(0,e.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Gb.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Gb.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Gb.rotation);const hb=pb("sheen.textureRoughness");(0,e.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",hb.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",hb.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",hb.rotation),(0,e.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Lb(y.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",tb,(()=>3))]);const eb=pb("metallicReflectanceTexture");(0,e.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",eb.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",eb.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",eb.rotation);const Hb=pb("reflectanceTexture");(0,e.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Hb.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Hb.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Hb.rotation),(0,e.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Ib,(()=>1))]);const ib=pb("subSurface.refractionIntensityTexture");(0,e.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",ib.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",ib.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",ib.rotation),(0,e.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Lb(y.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",tb,(()=>3))]),(0,e.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Ib,(()=>1))]),(0,e.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Ib,(()=>1))]);const Wb=pb("subSurface.thicknessTexture");(0,e.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Wb.scale),(0,e.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Wb.offset),(0,e.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Wb.rotation),(0,e.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Lb(y.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Ib,(()=>1))]);const sb=pb("subSurface.translucencyIntensityTexture");(0,e.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",sb.scale),(0,e.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",sb.offset),(0,e.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",sb.rotation),(0,e.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Lb(y.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",tb,(()=>3))]);const Db=pb("subSurface.translucencyColorTexture");(0,e.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Db.scale),(0,e.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Db.offset),(0,e.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Db.rotation),(0,e.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new ub(y.e.ANIMATIONTYPE_COLOR3,"diffuse",tb,(()=>3))]),(0,e.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new ub(y.e.ANIMATIONTYPE_FLOAT,"intensity",Ib,(()=>1))]),(0,e.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new ub(y.e.ANIMATIONTYPE_FLOAT,"range",Ib,(()=>1))]),(0,e.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new ub(y.e.ANIMATIONTYPE_FLOAT,"innerAngle",Nb,(()=>1))]),(0,e.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new ub(y.e.ANIMATIONTYPE_FLOAT,"angle",Nb,(()=>1))]),(0,e.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new ub(y.e.ANIMATIONTYPE_COLOR3,"diffuse",tb,(()=>3))]),(0,e.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new ub(y.e.ANIMATIONTYPE_FLOAT,"intensity",Ib,(()=>1))]);const db="KHR_animation_pointer";class Vb{constructor(Y){this.name=db,this._loader=Y,this._pathToObjectConverter=(0,e.h)(this._loader.Qb)}get enabled(){return this._loader.isExtensionUsed(db)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(Y,b,C,R,q){var A;const E=null===(A=R.target.extensions)||void 0===A?void 0:A.KHR_animation_pointer;if(!E||!this._pathToObjectConverter)return null;"pointer"!==R.target.path&&t.e.Warn(`${Y}/target/path: Value (${R.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=R.target.node&&t.e.Warn(`${Y}/target/node: Value (${R.target.node}) must not be present when using the ${this.name} extension`);const B=`${Y}/extensions/${this.name}`,g=E.pointer;if(!g)throw new Error(`${B}: Pointer is missing`);try{const A=this._pathToObjectConverter.convert(g);if(!A.info.interpolation)throw new Error(`${B}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(Y,b,C,R,{object:A.object,info:A.info.interpolation},q)}catch(r){return t.e.Warn(`${B}/pointer: Invalid pointer (${g}) skipped`),null}}}h(db),G(db,!0,(Y=>new Vb(Y)));class kb{constructor(Y,b,C){this.frame=Y,this.action=b,this.onlyOnce=C,this.isDone=!1}_clone(){return new kb(this.frame,this.action,this.onlyOnce)}}var xb=C(12687),ab=C(12733),Mb=C(12726);class Kb{get loop(){return this._loop}set loop(Y){Y!==this._loop&&(this._loop=Y,this.updateOptions({loop:Y}))}get currentTime(){var Y;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(Y=ab.b.audioEngine)&&void 0!==Y&&Y.audioContext&&(this.isPlaying||this.isPaused)){const Y=this.isPaused?0:ab.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+Y}return 0}get spatialSound(){return this._spatialSound}set spatialSound(Y){if(Y==this._spatialSound)return;const b=this.isPlaying;this.pause(),Y?(this._spatialSound=Y,this._updateSpatialParameters()):this._disableSpatialSound(),b&&this.play()}constructor(Y,b,C){var R;let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new O.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=q.AC.Zero(),this._localDirection=new q.AC(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=Y,C=C||n.d.LastCreatedScene)if(this._scene=C,Kb._SceneComponentInitialization(C),this._readyToPlayCallback=A,this._customAttenuationFunction=(Y,b,C,R,q)=>b<C?Y*(1-b/C):0,B&&(this.autoplay=B.autoplay||!1,this._loop=B.loop||!1,void 0!==B.volume&&(this._volume=B.volume),this._spatialSound=B.spatialSound??!1,this.maxDistance=B.maxDistance??100,this.useCustomAttenuation=B.useCustomAttenuation??!1,this.rolloffFactor=B.rolloffFactor||1,this.refDistance=B.refDistance||1,this.distanceModel=B.distanceModel||"linear",this._playbackRate=B.playbackRate||1,this._streaming=B.streaming??!1,this._length=B.length,this._offset=B.offset),null!==(R=ab.b.audioEngine)&&void 0!==R&&R.canUseWebAudio&&ab.b.audioEngine.audioContext){this._soundGain=ab.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let Y=!0;if(b)try{"string"===typeof b?(this._urlType="String",this._url=b):b instanceof ArrayBuffer?this._urlType="ArrayBuffer":b instanceof HTMLMediaElement?this._urlType="MediaElement":b instanceof MediaStream?this._urlType="MediaStream":b instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(b)&&(this._urlType="Array");let C=[],R=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ab.b.audioEngine.audioContext.createMediaElementSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ab.b.audioEngine.audioContext.createMediaStreamSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":b.byteLength>0&&(R=!0,this._soundLoaded(b));break;case"AudioBuffer":this._audioBufferLoaded(b);break;case"String":C.push(b);case"Array":0===C.length&&(C=b);for(let Y=0;Y<C.length;Y++){const b=C[Y];if(R=B&&B.skipCodecCheck||-1!==b.indexOf(".mp3",b.length-4)&&ab.b.audioEngine.isMP3supported||-1!==b.indexOf(".ogg",b.length-4)&&ab.b.audioEngine.isOGGsupported||-1!==b.indexOf(".wav",b.length-4)||-1!==b.indexOf(".m4a",b.length-4)||-1!==b.indexOf(".mp4",b.length-4)||-1!==b.indexOf("blob:"),R){this._streaming?(this._htmlAudioElement=new Audio(b),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,E.Tools.SetCorsBehavior(b,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(b,(Y=>{this._soundLoaded(Y)}),void 0,!0,!0,(Y=>{Y&&t.e.Error("XHR "+Y.status+" error on: "+b+"."),t.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:Y=!1}Y?R||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):t.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(g){t.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),ab.b.audioEngine&&!ab.b.audioEngine.WarnedWebAudioUnsupported&&(t.e.Error("Web Audio is not supported by your browser."),ab.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var Y;null!==(Y=ab.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(Y){var b;null!==(b=ab.b.audioEngine)&&void 0!==b&&b.audioContext&&(this._audioBuffer=Y,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(Y){var b;null!==(b=ab.b.audioEngine)&&void 0!==b&&b.audioContext&&ab.b.audioEngine.audioContext.decodeAudioData(Y,(Y=>{this._audioBufferLoaded(Y)}),(Y=>{t.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+Y)}))}setAudioBuffer(Y){var b;null!==(b=ab.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this._audioBuffer=Y,this._isReadyToPlay=!0)}updateOptions(Y){Y&&(this.loop=Y.loop??this.loop,this.maxDistance=Y.maxDistance??this.maxDistance,this.useCustomAttenuation=Y.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=Y.rolloffFactor??this.rolloffFactor,this.refDistance=Y.refDistance??this.refDistance,this.distanceModel=Y.distanceModel??this.distanceModel,this._playbackRate=Y.playbackRate??this._playbackRate,this._length=Y.length??void 0,this.spatialSound=Y.spatialSound??this._spatialSound,this._setOffset(Y.offset??void 0),this.setVolume(Y.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var Y;null!==(Y=ab.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&ab.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??ab.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var Y;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(Y=this._soundPanner)||void 0===Y||Y.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var Y;null!==(Y=ab.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(Y){var b;null!==(b=ab.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(Y),this._isOutputConnected=!0)}setDirectionalCone(Y,b,C){b<Y?t.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=Y,this._coneOuterAngle=b,this._coneOuterGain=C,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Y){if(Y!=this._coneInnerAngle){var b;if(this._coneOuterAngle<Y)return void t.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Y,null!==(b=ab.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Y){if(Y!=this._coneOuterAngle){var b;if(Y<this._coneInnerAngle)return void t.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Y,null!==(b=ab.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(Y){var b;Y.equals(this._position)||(this._position.q(Y),null!==(b=ab.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(Y){var b;this._localDirection=Y,null!==(b=ab.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const Y=this._connectedTransformNode.getWorldMatrix(),b=q.AC.TransformNormal(this._localDirection,Y);b.normalize(),this._soundPanner.orientationX.value=b.x,this._soundPanner.orientationY.value=b.y,this._soundPanner.orientationZ.value=b.z}updateDistanceFromListener(){var Y;if(null!==(Y=ab.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const Y=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.EC(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,Y,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(Y){this._customAttenuationFunction=Y}play(Y,b,C){var R;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(R=ab.b.audioEngine)&&void 0!==R&&R.audioContext)try{var q,A;this._clearTimeoutsAndObservers();let R=Y?(null===(q=ab.b.audioEngine)||void 0===q?void 0:q.audioContext.currentTime)+Y:null===(A=ab.b.audioEngine)||void 0===A?void 0:A.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=ab.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const Y=()=>{var C;if(null!==(C=ab.b.audioEngine)&&void 0!==C&&C.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=b??0;const C=this._htmlAudioElement.play();void 0!==C&&C.catch((()=>{var b,C;(null===(b=ab.b.audioEngine)||void 0===b||b.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(C=ab.b.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{Y()})))}))}else{var R;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(R=ab.b.audioEngine)||void 0===R?void 0:R.onAudioUnlockedObservable.addOnce((()=>{Y()}))}};Y()}}else{var E;const q=()=>{var q;if(null!==(q=ab.b.audioEngine)&&void 0!==q&&q.audioContext){var A;if(C=C||this._length,void 0!==b&&this._setOffset(b),this._soundSource){const Y=this._soundSource;Y.onended=()=>{Y.disconnect()}}if(this._soundSource=null===(A=ab.b.audioEngine)||void 0===A?void 0:A.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var E;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==b&&(this._soundSource.loopStart=b),void 0!==C&&(this._soundSource.loopEnd=(0|b)+C),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},R=Y?(null===(E=ab.b.audioEngine)||void 0===E?void 0:E.audioContext.currentTime)+Y:ab.b.audioEngine.audioContext.currentTime;const q=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(R,q,this.loop?void 0:C)}}};"suspended"===(null===(E=ab.b.audioEngine)||void 0===E?void 0:E.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var Y;"suspended"===(null===(Y=ab.b.audioEngine)||void 0===Y?void 0:Y.audioContext.state)?(ab.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=ab.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{q()})))):q()}),500):q()}this._startTime=R,this.isPlaying=!0,this.isPaused=!1}catch(B){t.e.Error("Error while trying to play audio: "+this.name+", "+B.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(Y){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var C;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(C=this._streamingSource)||void 0===C||C.disconnect();this.isPlaying=!1}else if(null!==(b=ab.b.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource){const b=Y?ab.b.audioEngine.audioContext.currentTime+Y:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(b)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var Y;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(Y=ab.b.audioEngine)&&void 0!==Y&&Y.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=ab.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(Y,b){var C;null!==(C=ab.b.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._soundGain&&(b&&ab.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(ab.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,ab.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(Y,ab.b.audioEngine.audioContext.currentTime+b)):this._soundGain.gain.value=Y),this._volume=Y}setPlaybackRate(Y){this._playbackRate=Y,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(Y){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=Y,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=Y=>this._onRegisterAfterWorldMatrixUpdate(Y),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(Y){var b;if(Y.getBoundingInfo){const b=Y.getBoundingInfo();this.setPosition(b.boundingSphere.centerWorld)}else this.setPosition(Y.absolutePosition);null!==(b=ab.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const Y=()=>{(0,Mb.g)((()=>this._isReadyToPlay),(()=>{C._audioBuffer=this.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,this._offset,this._length)}),void 0,300)},b={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},C=new Kb(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,b);return this.useCustomAttenuation&&C.setAttenuationFunction(this._customAttenuationFunction),C.setPosition(this._position),C.setPlaybackRate(this._playbackRate),Y(),C}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const Y={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(Y.connectedMeshId=this._connectedTransformNode.id),Y.position=this._position.cb(),Y.refDistance=this.refDistance,Y.distanceModel=this.distanceModel,Y.isDirectional=this._isDirectional,Y.localDirectionToMesh=this._localDirection.cb(),Y.coneInnerAngle=this._coneInnerAngle,Y.coneOuterAngle=this._coneOuterAngle,Y.coneOuterGain=this._coneOuterGain),Y}static Parse(Y,b,C,R){const A=Y.name;let E;E=Y.url?C+Y.url:C+A;const B={autoplay:Y.autoplay,loop:Y.loop,volume:Y.volume,spatialSound:Y.spatialSound,maxDistance:Y.maxDistance,rolloffFactor:Y.rolloffFactor,refDistance:Y.refDistance,distanceModel:Y.distanceModel,playbackRate:Y.playbackRate};let g;if(R){const Y=()=>{(0,Mb.g)((()=>R._isReadyToPlay),(()=>{g._audioBuffer=R.getAudioBuffer(),g._isReadyToPlay=!0,g.autoplay&&g.play(0,g._offset,g._length)}),void 0,300)};g=new Kb(A,new ArrayBuffer(0),b,null,B),Y()}else g=new Kb(A,E,b,(()=>{b.removePendingData(g)}),B),b.addPendingData(g);if(Y.position){const b=q.AC.OC(Y.position);g.setPosition(b)}if(Y.isDirectional&&(g.setDirectionalCone(Y.coneInnerAngle||360,Y.coneOuterAngle||360,Y.coneOuterGain||0),Y.localDirectionToMesh)){const b=q.AC.OC(Y.localDirectionToMesh);g.setLocalDirectionToMesh(b)}if(Y.connectedMeshId){const C=b.getMeshById(Y.connectedMeshId);C&&g.attachToMesh(C)}return Y.metadata&&(g.metadata=Y.metadata),g}_setOffset(Y){this._offset!==Y&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=Y)}_clearTimeoutsAndObservers(){var Y;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(Y=ab.b.audioEngine)||void 0===Y||Y.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Kb._SceneComponentInitialization=Y=>{throw(0,xb.d)("AudioSceneComponent")},(0,LY.g)("BABYLON.Sound",Kb);class fb{constructor(Y,b,C){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],b.length!==C.length)throw new Error("Sounds length does not equal weights length");this.loop=Y,this._weights=C;let R=0;for(const A of C)R+=A;const q=R>0?1/R:0;for(let A=0;A<this._weights.length;A++)this._weights[A]*=q;this._sounds=b;for(const A of this._sounds)A.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Y){if(Y!==this._coneInnerAngle){if(this._coneOuterAngle<Y)return void t.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Y;for(const b of this._sounds)b.directionalConeInnerAngle=Y}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Y){if(Y!==this._coneOuterAngle){if(Y<this._coneInnerAngle)return void t.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Y;for(const b of this._sounds)b.directionalConeOuterAngle=Y}}get volume(){return this._volume}set volume(Y){if(Y!==this._volume)for(const b of this._sounds)b.setVolume(Y)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(Y){if(!this.isPaused){this.stop();const Y=Math.random();let b=0;for(let C=0;C<this._weights.length;C++)if(b+=this._weights[C],Y<=b){this._currentIndex=C;break}}const b=this._sounds[this._currentIndex??0];b.isReady()?b.play(0,this.isPaused?void 0:Y):b.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Zb{constructor(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(Y=Y||n.d.LastCreatedScene)&&(this._scene=Y,this.soundCollection=[],this._options=b,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var Y;null!==(Y=ab.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&ab.b.audioEngine.audioContext&&(this._outputAudioNode=ab.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(ab.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(ab.b.audioEngine&&ab.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(Y){var b;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(b=ab.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&Y.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==Y.soundTrackId&&(-1===Y.soundTrackId?this._scene.mainSoundTrack.removeSound(Y):this._scene.soundTracks&&this._scene.soundTracks[Y.soundTrackId].removeSound(Y)),this.soundCollection.push(Y),Y.soundTrackId=this.id}removeSound(Y){const b=this.soundCollection.indexOf(Y);-1!==b&&this.soundCollection.splice(b,1)}setVolume(Y){var b;null!==(b=ab.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=Y)}switchPanningModelToHRTF(){var Y;if(null!==(Y=ab.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var Y;if(null!==(Y=ab.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToEqualPower()}connectToAnalyser(Y){var b;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=Y,null!==(b=ab.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,ab.b.audioEngine.masterGain))}}var YC=C(13096),bC=C(13077),CC=C(12660);ab.b.AudioEngineFactory=(Y,b,C)=>new RC(Y,b,C);class RC{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new O.d,this.onAudioLockedObservable=new O.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,CC.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const R=document.createElement("audio");this._hostElement=Y,this._audioContext=b,this._audioDestination=C;try{R&&R.canPlayType&&(R.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||R.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(q){}try{R&&R.canPlayType&&R.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(q){}}lock(){this._triggerSuspendedState()}unlock(){var Y,b;if("running"===(null===(Y=this._audioContext)||void 0===Y?void 0:Y.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(b=this._audioContext)||void 0===b||b.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{t.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var Y;null===(Y=this._audioContext)||void 0===Y||Y.addEventListener("statechange",(()=>{var Y;this.unlocked&&"running"!==(null===(Y=this._audioContext)||void 0===Y?void 0:Y.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var Y;return null!==(Y=this._audioContext)&&void 0!==Y&&Y.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(Y){this.canUseWebAudio=!1,t.e.Error("Web Audio: "+Y.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(Y){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const Y=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",b=document.createElement("style");b.appendChild(document.createTextNode(Y)),document.getElementsByTagName("head")[0].appendChild(b),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var Y;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(Y=this._audioContext)||void 0===Y||Y.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(Y){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=Y)}connectToAnalyser(Y){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=Y,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var qC=C(12681);(0,C(14080).e)(YC.c.NAME_AUDIO,((Y,b,C,R)=>{let q,A=[];if(C.PS=C.PS||[],void 0!==Y.PS&&null!==Y.PS)for(let B=0,g=Y.PS.length;B<g;B++){var E;const g=Y.PS[B];null!==(E=ab.b.audioEngine)&&void 0!==E&&E.canUseWebAudio?(g.url||(g.url=g.name),A[g.url]?C.PS.push(Kb.Parse(g,b,R,A[g.url])):(q=Kb.Parse(g,b,R),A[g.url]=q,C.PS.push(q))):C.PS.push(new Kb(g.name,null,b))}A=[]})),Object.defineProperty(bC.b.prototype,"mainSoundTrack",{get:function(){let Y=this._getComponent(YC.c.NAME_AUDIO);return Y||(Y=new AC(this),this.Ob(Y)),this._mainSoundTrack||(this._mainSoundTrack=new Zb(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),bC.b.prototype.getSoundByName=function(Y){let b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)if(this.mainSoundTrack.soundCollection[b].name===Y)return this.mainSoundTrack.soundCollection[b];if(this.soundTracks)for(let C=0;C<this.soundTracks.length;C++)for(b=0;b<this.soundTracks[C].soundCollection.length;b++)if(this.soundTracks[C].soundCollection[b].name===Y)return this.soundTracks[C].soundCollection[b];return null},Object.defineProperty(bC.b.prototype,"audioEnabled",{get:function(){let Y=this._getComponent(YC.c.NAME_AUDIO);return Y||(Y=new AC(this),this.Ob(Y)),Y.audioEnabled},set:function(Y){let b=this._getComponent(YC.c.NAME_AUDIO);b||(b=new AC(this),this.Ob(b)),Y?b.enableAudio():b.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(bC.b.prototype,"headphone",{get:function(){let Y=this._getComponent(YC.c.NAME_AUDIO);return Y||(Y=new AC(this),this.Ob(Y)),Y.headphone},set:function(Y){let b=this._getComponent(YC.c.NAME_AUDIO);b||(b=new AC(this),this.Ob(b)),Y?b.switchAudioModeForHeadphones():b.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(bC.b.prototype,"audioListenerPositionProvider",{get:function(){let Y=this._getComponent(YC.c.NAME_AUDIO);return Y||(Y=new AC(this),this.Ob(Y)),Y.audioListenerPositionProvider},set:function(Y){let b=this._getComponent(YC.c.NAME_AUDIO);if(b||(b=new AC(this),this.Ob(b)),Y&&"function"!==typeof Y)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");b.audioListenerPositionProvider=Y},enumerable:!0,configurable:!0}),Object.defineProperty(bC.b.prototype,"audioListenerRotationProvider",{get:function(){let Y=this._getComponent(YC.c.NAME_AUDIO);return Y||(Y=new AC(this),this.Ob(Y)),Y.audioListenerRotationProvider},set:function(Y){let b=this._getComponent(YC.c.NAME_AUDIO);if(b||(b=new AC(this),this.Ob(b)),Y&&"function"!==typeof Y)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");b.audioListenerRotationProvider=Y},enumerable:!0,configurable:!0}),Object.defineProperty(bC.b.prototype,"audioPositioningRefreshRate",{get:function(){let Y=this._getComponent(YC.c.NAME_AUDIO);return Y||(Y=new AC(this),this.Ob(Y)),Y.audioPositioningRefreshRate},set:function(Y){let b=this._getComponent(YC.c.NAME_AUDIO);b||(b=new AC(this),this.Ob(b)),b.audioPositioningRefreshRate=Y},enumerable:!0,configurable:!0});class AC{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(Y){this.name=YC.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new q.AC,this._cachedCameraPosition=new q.AC,this._lastCheck=0,this._invertMatrixTemp=new q.Matrix,this._cameraDirectionTemp=new q.AC,(Y=Y||n.d.LastCreatedScene)&&(this.BC=Y,Y.soundTracks=[],Y.PS=[])}register(){this.BC._afterRenderStage.registerStep(YC.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(Y){if(Y.PS=[],this.BC.soundTracks)for(let b=0;b<this.BC.soundTracks.length;b++){const C=this.BC.soundTracks[b];for(let b=0;b<C.soundCollection.length;b++)Y.PS.push(C.soundCollection[b].serialize())}}addFromContainer(Y){if(Y.PS)for(const b of Y.PS)b.play(),b.autoplay=!0,this.BC.mainSoundTrack.addSound(b)}removeFromContainer(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Y.PS)for(const C of Y.PS)C.stop(),C.autoplay=!1,this.BC.mainSoundTrack.removeSound(C),b&&C.dispose()}dispose(){const Y=this.BC;if(Y._mainSoundTrack&&Y.mainSoundTrack.dispose(),Y.soundTracks)for(let b=0;b<Y.soundTracks.length;b++)Y.soundTracks[b].dispose()}disableAudio(){const Y=this.BC;let b;for(this._audioEnabled=!1,ab.b.audioEngine&&ab.b.audioEngine.audioContext&&ab.b.audioEngine.audioContext.suspend(),b=0;b<Y.mainSoundTrack.soundCollection.length;b++)Y.mainSoundTrack.soundCollection[b].pause();if(Y.soundTracks)for(b=0;b<Y.soundTracks.length;b++)for(let C=0;C<Y.soundTracks[b].soundCollection.length;C++)Y.soundTracks[b].soundCollection[C].pause()}enableAudio(){const Y=this.BC;let b;for(this._audioEnabled=!0,ab.b.audioEngine&&ab.b.audioEngine.audioContext&&ab.b.audioEngine.audioContext.resume(),b=0;b<Y.mainSoundTrack.soundCollection.length;b++)Y.mainSoundTrack.soundCollection[b].isPaused&&Y.mainSoundTrack.soundCollection[b].play();if(Y.soundTracks)for(b=0;b<Y.soundTracks.length;b++)for(let C=0;C<Y.soundTracks[b].soundCollection.length;C++)Y.soundTracks[b].soundCollection[C].isPaused&&Y.soundTracks[b].soundCollection[C].play()}switchAudioModeForHeadphones(){const Y=this.BC;if(this._headphone=!0,Y.mainSoundTrack.switchPanningModelToHRTF(),Y.soundTracks)for(let b=0;b<Y.soundTracks.length;b++)Y.soundTracks[b].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const Y=this.BC;if(this._headphone=!1,Y.mainSoundTrack.switchPanningModelToEqualPower(),Y.soundTracks)for(let b=0;b<Y.soundTracks.length;b++)Y.soundTracks[b].switchPanningModelToEqualPower()}_afterRender(){const Y=qC.d.Now;if(this._lastCheck&&Y-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=Y;const b=this.BC;if(!this._audioEnabled||!b._mainSoundTrack||!b.soundTracks||0===b._mainSoundTrack.soundCollection.length&&1===b.soundTracks.length)return;const C=ab.b.audioEngine;if(C&&C.audioContext){let Y,R=b.activeCamera;if(b.activeCameras&&b.activeCameras.length>0&&(R=b.activeCameras[0]),this.audioListenerPositionProvider){const Y=this.audioListenerPositionProvider();C.audioContext.listener.setPosition(Y.x||0,Y.y||0,Y.z||0)}else R?this._cachedCameraPosition.equals(R.globalPosition)||(this._cachedCameraPosition.q(R.globalPosition),C.audioContext.listener.setPosition(R.globalPosition.x,R.globalPosition.y,R.globalPosition.z)):C.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const Y=this.audioListenerRotationProvider();C.audioContext.listener.setOrientation(Y.x||0,Y.y||0,Y.z||0,0,1,0)}else R?(R.rigCameras&&R.rigCameras.length>0&&(R=R.rigCameras[0]),R.getViewMatrix().invertToRef(this._invertMatrixTemp),q.AC.TransformNormalToRef(AC._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.q(this._cameraDirectionTemp),C.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):C.audioContext.listener.setOrientation(0,0,0,0,1,0);for(Y=0;Y<b.mainSoundTrack.soundCollection.length;Y++){const C=b.mainSoundTrack.soundCollection[Y];C.useCustomAttenuation&&C.updateDistanceFromListener()}if(b.soundTracks)for(Y=0;Y<b.soundTracks.length;Y++)for(let C=0;C<b.soundTracks[Y].soundCollection.length;C++){const R=b.soundTracks[Y].soundCollection[C];R.useCustomAttenuation&&R.updateDistanceFromListener()}}}}AC._CameraDirection=new q.AC(0,0,-1),Kb._SceneComponentInitialization=Y=>{let b=Y._getComponent(YC.c.NAME_AUDIO);b||(b=new AC(Y),Y.Ob(b))};const EC="MSFT_audio_emitter";class BC{constructor(Y){this.name=EC,this._loader=Y,this.enabled=this._loader.isExtensionUsed(EC)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const Y=this._loader.Qb.extensions;if(Y&&Y[this.name]){const b=Y[this.name];this._clips=b.clips,this._emitters=b.emitters,W.Assign(this._clips),W.Assign(this._emitters)}}loadSceneAsync(Y,b){return D.LoadExtensionAsync(Y,b,this.name,(async(C,R)=>{const q=new Array;q.push(this._loader.loadSceneAsync(Y,b));for(const Y of R.emitters){const b=W.Get(`${C}/emitters`,this._emitters,Y);if(void 0!=b.refDistance||void 0!=b.maxDistance||void 0!=b.rolloffFactor||void 0!=b.distanceModel||void 0!=b.innerAngle||void 0!=b.outerAngle)throw new Error(`${C}: Direction or Distance properties are not allowed on emitters attached to a scene`);q.push(this._loadEmitterAsync(`${C}/emitters/${b.index}`,b))}await Promise.all(q)}))}loadNodeAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(Y,R)=>{const A=new Array,B=await this._loader.loadNodeAsync(Y,b,(b=>{for(const C of R.emitters){const R=W.Get(`${Y}/emitters`,this._emitters,C);A.push(this._loadEmitterAsync(`${Y}/emitters/${R.index}`,R).then((()=>{for(const Y of R._babylonSounds)Y.attachToMesh(b),void 0==R.innerAngle&&void 0==R.outerAngle||(Y.setLocalDirectionToMesh(q.AC.Forward()),Y.setDirectionalCone(2*E.Tools.ToDegrees(void 0==R.innerAngle?Math.PI:R.innerAngle),2*E.Tools.ToDegrees(void 0==R.outerAngle?Math.PI:R.outerAngle),0))})))}C(b)}));return await Promise.all(A),B}))}loadAnimationAsync(Y,b){return D.LoadExtensionAsync(Y,b,this.name,(async(C,R)=>{const q=await this._loader.loadAnimationAsync(Y,b),A=new Array;W.Assign(R.events);for(const E of R.events)A.push(this._loadAnimationEventAsync(`${C}/events/${E.index}`,Y,b,E,q));return await Promise.all(A),q}))}_loadClipAsync(Y,b){if(b._objectURL)return b._objectURL;let C;if(b.uri)C=this._loader.loadUriAsync(Y,b,b.uri);else{const R=W.Get(`${Y}/bufferView`,this._loader.Qb.bufferViews,b.bufferView);C=this._loader.loadBufferViewAsync(`/bufferViews/${R.index}`,R)}return b._objectURL=C.then((Y=>URL.createObjectURL(new Blob([Y],{type:b.mimeType})))),b._objectURL}_loadEmitterAsync(Y,b){if(b._babylonSounds=b._babylonSounds||[],!b._babylonData){const Y=new Array,C=b.name||`emitter${b.index}`,R={loop:!1,autoplay:!1,volume:void 0==b.volume?1:b.volume};for(let A=0;A<b.clips.length;A++){const q=`/extensions/${this.name}/clips`,E=W.Get(q,this._clips,b.clips[A].clip);Y.push(this._loadClipAsync(`${q}/${b.clips[A].clip}`,E).then((Y=>{const q=b._babylonSounds[A]=new Kb(C,Y,this._loader.babylonScene,null,R);q.refDistance=b.refDistance||1,q.maxDistance=b.maxDistance||256,q.rolloffFactor=b.rolloffFactor||1,q.distanceModel=b.distanceModel||"exponential"})))}const q=Promise.all(Y).then((()=>{const Y=b.clips.map((Y=>Y.weight||1)),C=new fb(b.loop||!1,b._babylonSounds,Y);b.innerAngle&&(C.directionalConeInnerAngle=2*E.Tools.ToDegrees(b.innerAngle)),b.outerAngle&&(C.directionalConeOuterAngle=2*E.Tools.ToDegrees(b.outerAngle)),b.volume&&(C.volume=b.volume),b._babylonData.sound=C}));b._babylonData={loaded:q}}return b._babylonData.loaded}_getEventAction(Y,b,C,R,q){switch(C){case"play":return Y=>{const C=(q||0)+(Y-R);b.play(C)};case"stop":return()=>{b.stop()};case"pause":return()=>{b.pause()};default:throw new Error(`${Y}: Unsupported action ${C}`)}}_loadAnimationEventAsync(Y,b,C,R,q){if(0==q.targetedAnimations.length)return Promise.resolve();const A=q.targetedAnimations[0],E=R.Rb,B=W.Get(`/extensions/${this.name}/emitters`,this._emitters,E);return this._loadEmitterAsync(Y,B).then((()=>{const b=B._babylonData.sound;if(b){const C=new kb(R.time,this._getEventAction(Y,b,R.action,R.time,R.startOffset));A.animation.addEvent(C),q.onAnimationGroupEndObservable.add((()=>{b.stop()})),q.onAnimationGroupPauseObservable.add((()=>{b.pause()}))}}))}}h(EC),G(EC,!0,(Y=>new BC(Y)));const gC="MSFT_lod";class rC{constructor(Y){var b;this.name=gC,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new O.d,this.onMaterialLODsLoadedObservable=new O.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=Y,this.maxLODsToLoad=(null===(b=this._loader.parent.extensionOptions[gC])||void 0===b?void 0:b.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(gC)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let Y=0;Y<this._nodePromiseLODs.length;Y++){const b=Promise.all(this._nodePromiseLODs[Y]).then((()=>{0!==Y&&(this._loader.endPerformanceCounter(`Node LOD ${Y}`),this._loader.log(`Loaded node LOD ${Y}`)),this.onNodeLODsLoadedObservable.notifyObservers(Y),Y!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${Y+1}`),this._loadBufferLOD(this._nodeBufferLODs,Y+1),this._nodeSignalLODs[Y]&&this._nodeSignalLODs[Y].resolve())}));this._loader._completePromises.push(b)}for(let Y=0;Y<this._materialPromiseLODs.length;Y++){const b=Promise.all(this._materialPromiseLODs[Y]).then((()=>{0!==Y&&(this._loader.endPerformanceCounter(`Material LOD ${Y}`),this._loader.log(`Loaded material LOD ${Y}`)),this.onMaterialLODsLoadedObservable.notifyObservers(Y),Y!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${Y+1}`),this._loadBufferLOD(this._materialBufferLODs,Y+1),this._materialSignalLODs[Y]&&this._materialSignalLODs[Y].resolve())}));this._loader._completePromises.push(b)}}loadSceneAsync(Y,b){const C=this._loader.loadSceneAsync(Y,b);return this._loadBufferLOD(this._bufferLODs,0),C}loadNodeAsync(Y,b,C){return D.LoadExtensionAsync(Y,b,this.name,(async(Y,q)=>{let A;const E=this._getLODs(Y,b,this._loader.Qb.nodes,q.ids);this._loader.logOpen(`${Y}`);for(let b=0;b<E.length;b++){const Y=E[b];0!==b&&(this._nodeIndexLOD=b,this._nodeSignalLODs[b]=this._nodeSignalLODs[b]||new R);const q=Y=>{C(Y),Y.ug(!1)},B=this._loader.loadNodeAsync(`/nodes/${Y.index}`,Y,q).then((Y=>{if(0!==b){const Y=E[b-1];Y._babylonTransformNode&&(this._disposeTransformNode(Y._babylonTransformNode),delete Y._babylonTransformNode)}return Y.ug(!0),Y}));this._nodePromiseLODs[b]=this._nodePromiseLODs[b]||[],0===b?A=B:(this._nodeIndexLOD=null,this._nodePromiseLODs[b].push(B))}return this._loader.logClose(),await A}))}_loadMaterialAsync(Y,b,C,R,q){return this._nodeIndexLOD?null:D.LoadExtensionAsync(Y,b,this.name,(async(Y,A)=>{let E;const B=this._getLODs(Y,b,this._loader.Qb.materials,A.ids);this._loader.logOpen(`${Y}`);for(let b=0;b<B.length;b++){const Y=B[b];0!==b&&(this._materialIndexLOD=b);const A=this._loader._loadMaterialAsync(`/materials/${Y.index}`,Y,C,R,(Y=>{0===b&&q(Y)})).then((Y=>{if(0!==b){q(Y);const C=B[b-1]._data;C[R]&&(this._disposeMaterials([C[R].babylonMaterial]),delete C[R])}return Y}));this._materialPromiseLODs[b]=this._materialPromiseLODs[b]||[],0===b?E=A:(this._materialIndexLOD=null,this._materialPromiseLODs[b].push(A))}return this._loader.logClose(),await E}))}_loadUriAsync(Y,b,C){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const q=this._nodeIndexLOD-1;return this._nodeSignalLODs[q]=this._nodeSignalLODs[q]||new R,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(Y,b,C)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const q=this._materialIndexLOD-1;return this._materialSignalLODs[q]=this._materialSignalLODs[q]||new R,this._materialSignalLODs[q].promise.then((async()=>await this._loader.loadUriAsync(Y,b,C)))}return null}loadBufferAsync(Y,b,C,q){if(this._loader.parent.useRangeRequests&&!b.uri){if(!this._loader.bin)throw new Error(`${Y}: Uri is missing or the binary glTF is missing its binary chunk`);const b=async(Y,b)=>{const A=C,E=A+q-1;let B=Y[b];return B?(B.start=Math.min(B.start,A),B.end=Math.max(B.end,E)):(B={start:A,end:E,loaded:new R},Y[b]=B),await B.loaded.promise.then((Y=>new Uint8Array(Y.buffer,Y.byteOffset+C-B.start,q)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?b(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?b(this._materialBufferLODs,this._materialIndexLOD):b(this._bufferLODs,0)}return null}_loadBufferLOD(Y,b){const C=Y[b];C&&(this._loader.log(`Loading buffer range [${C.start}-${C.end}]`),this._loader.bin.readAsync(C.start,C.end-C.start+1).then((Y=>{C.loaded.resolve(Y)}),(Y=>{C.loaded.reject(Y)})))}_getLODs(Y,b,C,R){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const q=[];for(let A=R.length-1;A>=0;A--)if(q.push(W.Get(`${Y}/ids/${R[A]}`,C,R[A])),q.length===this.maxLODsToLoad)return q;return q.push(b),q}_disposeTransformNode(Y){const b=[],C=Y.material;C&&b.push(C);for(const q of Y.getChildMeshes())q.material&&b.push(q.material);Y.dispose();const R=b.filter((Y=>this._loader.babylonScene.meshes.every((b=>b.material!=Y))));this._disposeMaterials(R)}_disposeMaterials(Y){const b={};for(const C of Y){for(const Y of C.getActiveTextures())b[Y.uniqueId]=Y;C.dispose()}for(const C in b)for(const Y of this._loader.babylonScene.materials)Y.hasTexture(b[C])&&delete b[C];for(const C in b)b[C].dispose()}}h(gC),G(gC,!0,(Y=>new rC(Y)));const OC="MSFT_minecraftMesh";class FC{constructor(Y){this.name=OC,this._loader=Y,this.enabled=this._loader.isExtensionUsed(OC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtraAsync(Y,b,this.name,(async(R,q)=>{if(q){if(!(C instanceof N.b))throw new Error(`${R}: Material type not supported`);const q=this._loader.loadMaterialPropertiesAsync(Y,b,C);return C.needAlphaBlending()&&(C.forceDepthWrite=!0,C.separateCullingPass=!0),C.Jb=C.forceDepthWrite,C.twoSidedLighting=!0,await q}}))}}h(OC),G(OC,!0,(Y=>new FC(Y)));const yC="MSFT_sRGBFactors";class SC{constructor(Y){this.name=yC,this._loader=Y,this.enabled=this._loader.isExtensionUsed(yC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,b,C){return D.LoadExtraAsync(Y,b,this.name,(async(R,q)=>{if(q){if(!(C instanceof N.b))throw new Error(`${R}: Material type not supported`);const q=this._loader.loadMaterialPropertiesAsync(Y,b,C),A=C.uY().getEngine().useExactSrgbConversions;return C.albedoTexture||C.albedoColor.toLinearSpaceToRef(C.albedoColor,A),C.reflectivityTexture||C.reflectivityColor.toLinearSpaceToRef(C.reflectivityColor,A),await q}}))}}h(yC),G(yC,!0,(Y=>new SC(Y)));var nC=C(14409);const tC={};var IC=C(14457),wC=C(14433),QC=C(14412),NC=C(14424);function pC(Y,b){for(const C of Y)for(const Y of C.dataOutputs)if(Y.uniqueId===b)return Y;throw new Error("Could not find data out connection with unique id "+b)}function mR(Y,b){for(const C of Y)if(C instanceof wC.d)for(const Y of C.signalInputs)if(Y.uniqueId===b)return Y;throw new Error("Could not find signal in connection with unique id "+b)}async function LC(Y,b){const R=await Promise.all(Y.allBlocks.map((async Y=>{const b=function(Y){switch(Y){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([C.e(78),C.e(79)]).then(C.bind(C,16051))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await C.e(80).then(C.bind(C,16055))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await C.e(81).then(C.bind(C,16060))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await C.e(82).then(C.bind(C,16063))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await C.e(83).then(C.bind(C,16065))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await C.e(84).then(C.bind(C,16074))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await C.e(85).then(C.bind(C,16081))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await C.e(86).then(C.bind(C,16087))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await C.e(87).then(C.bind(C,16090))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await C.e(90).then(C.bind(C,16126))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await C.e(90).then(C.bind(C,16126))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await C.e(90).then(C.bind(C,16126))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await C.e(90).then(C.bind(C,16126))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await C.e(95).then(C.bind(C,16134))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await C.e(96).then(C.bind(C,16139))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await C.e(97).then(C.bind(C,16141))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await C.e(98).then(C.bind(C,16150))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await C.e(99).then(C.bind(C,16157))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await C.e(100).then(C.bind(C,16161))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await C.e(101).then(C.bind(C,16165))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await C.e(102).then(C.bind(C,16173))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await C.e(103).then(C.bind(C,16179))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await C.e(104).then(C.bind(C,16188))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await C.e(105).then(C.bind(C,16197))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await C.e(106).then(C.bind(C,16205))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await C.e(107).then(C.bind(C,16213))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await C.e(108).then(C.bind(C,16222))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await C.e(109).then(C.bind(C,16227))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await C.e(110).then(C.bind(C,16231))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await C.e(111).then(C.bind(C,16238))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await C.e(112).then(C.bind(C,16242))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await C.e(113).then(C.bind(C,16251))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await C.e(92).then(C.bind(C,16254))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await C.e(114).then(C.bind(C,16259))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await C.e(115).then(C.bind(C,16266))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await C.e(116).then(C.bind(C,16270))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await C.e(93).then(C.bind(C,16272))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await C.e(88).then(C.bind(C,16099))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await C.e(94).then(C.bind(C,16281))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await C.e(94).then(C.bind(C,16281))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await C.e(94).then(C.bind(C,16281))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,16281))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await C.e(94).then(C.bind(C,16281))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await C.e(94).then(C.bind(C,16281))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await C.e(94).then(C.bind(C,16281))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,16281))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await C.e(89).then(C.bind(C,16118))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await C.e(90).then(C.bind(C,16126))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await C.e(90).then(C.bind(C,16126))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await C.e(91).then(C.bind(C,16286))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await C.e(91).then(C.bind(C,16286))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await C.e(91).then(C.bind(C,16286))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await C.e(91).then(C.bind(C,16286))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await C.e(91).then(C.bind(C,16286))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await C.e(91).then(C.bind(C,16286))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await C.e(117).then(C.bind(C,16291))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await C.e(118).then(C.bind(C,16297))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await C.e(119).then(C.bind(C,16299))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await C.e(120).then(C.bind(C,16308))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await C.e(121).then(C.bind(C,16312))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await C.e(122).then(C.bind(C,16315))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await C.e(123).then(C.bind(C,16318))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await C.e(124).then(C.bind(C,16322))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await C.e(125).then(C.bind(C,16325))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await C.e(126).then(C.bind(C,16334))).FlowGraphDataSwitchBlock;default:if(tC[Y])return tC[Y];throw new Error(`Unknown block name ${Y}`)}}(Y.className);return await b()})));return function(Y,b,C){const R=b.coordinator.createGraph(),q=[],A=b.valueParseFunction??QC.c;for(let E=0;E<Y.allBlocks.length;E++){const B=cC(Y.allBlocks[E],{BC:b.coordinator.config.BC,pathConverter:b.pathConverter,assetsContainer:b.coordinator.config.BC,valueParseFunction:A},C[E]);q.push(B),B instanceof IC.c&&R.addEventBlock(B)}for(const E of q){for(const Y of E.dataInputs)for(const b of Y.connectedPointIds){const C=pC(q,b);Y.connectTo(C)}if(E instanceof wC.d)for(const Y of E.signalOutputs)for(const b of Y.connectedPointIds){const C=mR(q,b);Y.connectTo(C)}}for(const E of Y.executionContexts)uC(E,{graph:R,valueParseFunction:A},Y.rightHanded);return R}(Y,b,R)}function uC(Y,b,C){const R=b.graph.createContext();Y.enableLogging&&(R.enableLogging=!0),R.treatDataAsRightHanded=C||!1;const q=b.valueParseFunction??QC.c;R.uniqueId=Y.uniqueId;const A=R.uY();if(Y._assetsContext){var E,B,g,r,O,F,y,S,n,t;const b=Y._assetsContext,C={meshes:null===(E=b.meshes)||void 0===E?void 0:E.map((Y=>A.getMeshById(Y))),lights:null===(B=b.lights)||void 0===B?void 0:B.map((Y=>A.getLightByName(Y))),cameras:null===(g=b.cameras)||void 0===g?void 0:g.map((Y=>A.getCameraByName(Y))),materials:null===(r=b.materials)||void 0===r?void 0:r.map((Y=>A.getMaterialById(Y))),textures:null===(O=b.textures)||void 0===O?void 0:O.map((Y=>A.getTextureByName(Y))),animations:null===(F=b.animations)||void 0===F?void 0:F.map((Y=>A.animations.find((b=>b.name===Y)))),skeletons:null===(y=b.skeletons)||void 0===y?void 0:y.map((Y=>A.getSkeletonByName(Y))),xy:null===(S=b.xy)||void 0===S?void 0:S.map((Y=>A.getParticleSystemById(Y))),animationGroups:null===(n=b.animationGroups)||void 0===n?void 0:n.map((Y=>A.getAnimationGroupByName(Y))),transformNodes:null===(t=b.transformNodes)||void 0===t?void 0:t.map((Y=>A.getTransformNodeById(Y))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],PS:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};R.assetsContext=C}for(const I in Y._userVariables){const b=q(I,Y._userVariables,R.assetsContext,A);R.userVariables[I]=b}for(const I in Y._connectionValues){const b=q(I,Y._connectionValues,R.assetsContext,A);R._setConnectionValueByKey(I,b)}return R}function cC(Y,b,C){const R={},q=b.valueParseFunction??QC.c;if(Y.config)for(const E in Y.config)R[E]=q(E,Y.config,b.assetsContainer||b.BC,b.BC);if((0,QC.h)(Y.className)){if(!b.pathConverter)throw new Error("Path converter is required for this block");R.pathConverter=b.pathConverter}const A=new C(R);A.uniqueId=Y.uniqueId;for(let E=0;E<Y.dataInputs.length;E++){const b=A.getDataInput(Y.dataInputs[E].name);if(!b)throw new Error("Could not find data input with name "+Y.dataInputs[E].name+" in block "+Y.className);b.deserialize(Y.dataInputs[E])}for(let E=0;E<Y.dataOutputs.length;E++){const b=A.getDataOutput(Y.dataOutputs[E].name);if(!b)throw new Error("Could not find data output with name "+Y.dataOutputs[E].name+" in block "+Y.className);b.deserialize(Y.dataOutputs[E])}return A.metadata=Y.metadata,A.deserialize&&A.deserialize(Y),A}function lC(Y){const[b,C]=Y.split(":");return XC({op:b,extension:C})}function XC(Y){var b;let C=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const R=Y.extension?null===(b=TC[Y.extension])||void 0===b?void 0:b[Y.op]:PC[Y.op];if(!R&&(t.e.Warn(`No mapping found for operation ${Y.op} and extension ${Y.extension||"KHR_interactivity"}`),C)){const b={},C={flows:{}};if(Y.inputValueSockets){b.values={};for(const C in Y.inputValueSockets)b.values[C]={name:C}}return Y.outputValueSockets&&(C.values={},Object.keys(Y.outputValueSockets).forEach((Y=>{C.values[Y]={name:Y}}))),{EF:[],inputs:b,outputs:C}}return R}function jC(Y,b,C){TC[b]||(TC[b]={}),TC[b][Y]=C}const TC={BABYLON:{"flow/log":{EF:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},PC={"event/onStart":{EF:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{EF:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{EF:["FlowGraphSendCustomEventBlock"],extraProcessor(Y,b,C,R,q){if("event/send"!==b.op||!Y.configuration||1!==Object.keys(Y.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const A=Y.configuration.event.value[0];if("number"!==typeof A)throw new Error("Event id should be a number");const E=R.arrays.events[A],B=q[0];return B.config||(B.config={}),B.config.eventId=E.eventId,B.config.eventData=E.eventData,q}},"event/receive":{EF:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(Y,b){var C;if(!Y.configuration)return t.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const R=Y.configuration.event;if(!R)return t.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const q=R.value[0];if("number"!==typeof q)return t.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(C=b.events)||void 0===C?void 0:C[q])?{valid:!0}:(t.e.Error(`Event with id ${q} not found`),{valid:!1,error:`Event with id ${q} not found`})},extraProcessor(Y,b,C,R,q){if("event/receive"!==b.op||!Y.configuration||1!==Object.keys(Y.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const A=Y.configuration.event.value[0];if("number"!==typeof A)throw new Error("Event id should be a number");const E=R.arrays.events[A],B=q[0];return B.config||(B.config={}),B.config.eventId=E.eventId,B.config.eventData=E.eventData,q}},"math/e":vC("FlowGraphEBlock"),"math/pi":vC("FlowGraphPIBlock"),"math/inf":vC("FlowGraphInfBlock"),"math/nan":vC("FlowGraphNaNBlock"),"math/abs":vC("FlowGraphAbsBlock"),"math/sign":vC("FlowGraphSignBlock"),"math/trunc":vC("FlowGraphTruncBlock"),"math/floor":vC("FlowGraphFloorBlock"),"math/ceil":vC("FlowGraphCeilBlock"),"math/round":{EF:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,b,C,R,q){var A;return(A=q[0]).config||(A.config={}),q[0].config.roundHalfAwayFromZero=!0,q}},"math/fract":vC("FlowGraphFractBlock"),"math/neg":vC("FlowGraphNegationBlock"),"math/add":vC("FlowGraphAddBlock",["a","b"],!0),"math/sub":vC("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{EF:["FlowGraphMultiplyBlock"],extraProcessor(Y,b,C,R,q){var A;(A=q[0]).config||(A.config={}),q[0].config.useMatrixPerComponent=!0,q[0].config.preventIntegerFloatArithmetic=!0;let E=-1;return Object.keys(Y.values||{}).find((b=>{var C;return void 0!==(null===(C=Y.values)||void 0===C?void 0:C[b].type)&&(E=Y.values[b].type,!0)})),-1!==E&&(q[0].config.type=R.arrays.types[E].flowGraphType),q},validation:Y=>Y.values?zC(Y):{valid:!0}},"math/div":vC("FlowGraphDivideBlock",["a","b"],!0),"math/rem":vC("FlowGraphModuloBlock",["a","b"]),"math/min":vC("FlowGraphMinBlock",["a","b"]),"math/max":vC("FlowGraphMaxBlock",["a","b"]),"math/clamp":vC("FlowGraphClampBlock",["a","b","c"]),"math/saturate":vC("FlowGraphSaturateBlock"),"math/mix":vC("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":vC("FlowGraphEqualityBlock",["a","b"]),"math/lt":vC("FlowGraphLessThanBlock",["a","b"]),"math/le":vC("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":vC("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":vC("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":vC("FlowGraphIsNaNBlock"),"math/isinf":vC("FlowGraphIsInfBlock"),"math/select":{EF:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{EF:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":vC("FlowGraphSinBlock"),"math/cos":vC("FlowGraphCosBlock"),"math/tan":vC("FlowGraphTanBlock"),"math/asin":vC("FlowGraphASinBlock"),"math/acos":vC("FlowGraphACosBlock"),"math/atan":vC("FlowGraphATanBlock"),"math/atan2":vC("FlowGraphATan2Block",["a","b"]),"math/sinh":vC("FlowGraphSinhBlock"),"math/cosh":vC("FlowGraphCoshBlock"),"math/tanh":vC("FlowGraphTanhBlock"),"math/asinh":vC("FlowGraphASinhBlock"),"math/acosh":vC("FlowGraphACoshBlock"),"math/atanh":vC("FlowGraphATanhBlock"),"math/exp":vC("FlowGraphExponentialBlock"),"math/log":vC("FlowGraphLogBlock"),"math/log2":vC("FlowGraphLog2Block"),"math/log10":vC("FlowGraphLog10Block"),"math/sqrt":vC("FlowGraphSquareRootBlock"),"math/cbrt":vC("FlowGraphCubeRootBlock"),"math/pow":vC("FlowGraphPowerBlock",["a","b"]),"math/length":vC("FlowGraphLengthBlock"),"math/normalize":vC("FlowGraphNormalizeBlock"),"math/dot":vC("FlowGraphDotBlock",["a","b"]),"math/cross":vC("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":vC("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":vC("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{EF:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{EF:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{EF:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{EF:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{EF:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{EF:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{EF:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":vC("FlowGraphTransposeBlock"),"math/determinant":vC("FlowGraphDeterminantBlock"),"math/inverse":vC("FlowGraphInvertMatrixBlock"),"math/matmul":vC("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{EF:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ob",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,b,C,R,q,A){const E=q[0].dataInputs.find((Y=>"rotationQuaternion"===Y.name));if(!E)throw new Error("Rotation quaternion input not found");return A._connectionValues[E.uniqueId]&&(A._connectionValues[E.uniqueId].type="Quaternion"),q}},"math/matDecompose":{EF:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ob"}}}},"math/quatConjugate":vC("FlowGraphConjugateBlock",["a"]),"math/quatMul":{EF:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,b,C,R,q){var A;return(A=q[0]).config||(A.config={}),q[0].config.type="Quaternion",q}},"math/quatAngleBetween":vC("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{EF:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":vC("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":vC("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{EF:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,b,C,R,q){var A;return(A=q[0]).config||(A.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract2x2":{EF:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{EF:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,b,C,R,q){var A;return(A=q[0]).config||(A.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract3x3":{EF:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{EF:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,b,C,R,q){var A;return(A=q[0]).config||(A.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract4x4":{EF:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{EF:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,b,C,R,q,A){var E,B;(B=q[0]).config||(B.config={});const g=q[0].dataInputs[0];return q[0].config.valueType=(null===(E=A._connectionValues[g.uniqueId])||void 0===E?void 0:E.type)??"FlowGraphInteger",q}},"math/and":{EF:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,b,C,R,q,A){var E,B,g;(g=q[0]).config||(g.config={});const r=q[0].dataInputs[0],O=q[0].dataInputs[1];return q[0].config.valueType=(null===(E=A._connectionValues[r.uniqueId])||void 0===E?void 0:E.type)??(null===(B=A._connectionValues[O.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",q}},"math/or":{EF:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,b,C,R,q,A){var E,B,g;(g=q[0]).config||(g.config={});const r=q[0].dataInputs[0],O=q[0].dataInputs[1];return q[0].config.valueType=(null===(E=A._connectionValues[r.uniqueId])||void 0===E?void 0:E.type)??(null===(B=A._connectionValues[O.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",q}},"math/xor":{EF:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,b,C,R,q,A){var E,B,g;(g=q[0]).config||(g.config={});const r=q[0].dataInputs[0],O=q[0].dataInputs[1];return q[0].config.valueType=(null===(E=A._connectionValues[r.uniqueId])||void 0===E?void 0:E.type)??(null===(B=A._connectionValues[O.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",q}},"math/asr":vC("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":vC("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":vC("FlowGraphLeadingZerosBlock"),"math/ctz":vC("FlowGraphTrailingZerosBlock"),"math/popcnt":vC("FlowGraphOneBitsCounterBlock"),"math/rad":vC("FlowGraphDegToRadBlock"),"math/deg":vC("FlowGraphRadToDegBlock"),"type/boolToInt":vC("FlowGraphBooleanToInt"),"type/boolToFloat":vC("FlowGraphBooleanToFloat"),"type/intToBool":vC("FlowGraphIntToBoolean"),"type/intToFloat":vC("FlowGraphIntToFloat"),"type/floatToInt":vC("FlowGraphFloatToInt"),"type/floatToBool":vC("FlowGraphFloatToBoolean"),"flow/sequence":{EF:["FlowGraphSequenceBlock"],extraProcessor(Y,b,C,R,q){const A=q[0];return A.config||(A.config={}),A.config.outputSignalCount=Object.keys(Y.flows||[]).length,A.signalOutputs.forEach(((Y,b)=>{Y.name="out_"+b})),q}},"flow/branch":{EF:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{EF:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(Y){if(Y.configuration&&Y.configuration.cases){const b=Y.configuration.cases.value;if(!b.every((Y=>"number"===typeof Y&&/^-?\d+$/.test(Y.toString()))))return t.e.Warn("Switch cases should be integers. Using empty array instead."),Y.configuration.cases.value=[],{valid:!0};const C=new Set(b);Y.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(Y,b,C,R,q){if("flow/switch"!==b.op||!Y.flows||0===Object.keys(Y.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return q[0].signalOutputs.forEach((Y=>{"default"!==Y.name&&(Y.name="out_"+Y.name)})),q}},"flow/while":{EF:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{EF:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(Y,b,C,R,q){const A=q[0];return A.config||(A.config={}),A.config.incrementIndexWhenLoopDone=!0,q}},"flow/doN":{EF:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{EF:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(Y,b,C,R,q){if("flow/multiGate"!==b.op||!Y.flows||0===Object.keys(Y.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const A=q[0];return A.config||(A.config={}),A.config.outputSignalCount=Object.keys(Y.flows).length,A.signalOutputs.forEach(((Y,b)=>{Y.name="out_"+b})),q}},"flow/waitAll":{EF:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(Y){var b,C;return"number"!==typeof(null===(b=Y.configuration)||void 0===b||null===(C=b.inputFlows)||void 0===C?void 0:C.value[0])&&(Y.configuration=Y.configuration||{inputFlows:{value:[0]}},Y.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{EF:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{EF:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{EF:["FlowGraphCancelDelayBlock"]},"variable/get":{EF:["FlowGraphGetVariableBlock"],validation(Y){var b,C;return null!==(b=Y.configuration)&&void 0!==b&&null!==(C=b.variable)&&void 0!==C&&C.value?{valid:!0}:(t.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Y,b)=>[b.getVariableName(Y[0])]}}},"variable/set":{EF:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Y,b)=>[b.getVariableName(Y[0])]}}},"variable/setMultiple":{EF:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(Y,b)=>[Y[0].map((Y=>b.getVariableName(Y)))]}},extraProcessor:(Y,b,C,R,q)=>(q[0].dataInputs.forEach((Y=>{Y.name=R.getVariableName(+Y.name)})),q)},"variable/interpolate":{EF:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(Y,b)=>[b.getVariableName(Y[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:Y=>!0===Y[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",FR:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",FR:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",FR:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",FR:"FlowGraphPlayAnimationBlock"},out:{name:"out",FR:"FlowGraphPlayAnimationBlock"},done:{name:"done",FR:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(Y,b,C,R,q){var A,E,B;const g=q[0],r=null===(A=Y.configuration)||void 0===A?void 0:A.variable.value[0];if("number"!==typeof r)throw t.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const O=R.arrays.staticVariables[r];"undefined"===typeof g.config.animationType.value&&(R.arrays.staticVariables,g.config.animationType.value=(0,NC.F)(O.type));const F=q[4];return F.config||(F.config={}),(E=F.config).variable||(E.variable={}),F.config.variable.value=R.getVariableName(r),(B=q[3]).config||(B.config={}),q}},"pointer/get":{EF:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",FR:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",FR:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Y,b,C,R,q)=>(q.forEach((Y=>{"FlowGraphJsonPointerParserBlock"===Y.className&&(Y.config||(Y.config={}),Y.config.outputValue=!0)})),q)},"pointer/set":{EF:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",FR:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",FR:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Y,b,C,R,q)=>(q.forEach((Y=>{"FlowGraphJsonPointerParserBlock"===Y.className&&(Y.config||(Y.config={}),Y.config.outputValue=!0)})),q)},"pointer/interpolate":{EF:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",FR:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",FR:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",FR:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",FR:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",FR:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",FR:"FlowGraphPlayAnimationBlock"},out:{name:"out",FR:"FlowGraphPlayAnimationBlock"},done:{name:"done",FR:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Y,b,C,R,q)=>(q.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className?(b.config||(b.config={}),b.config.outputValue=!0):"FlowGraphInterpolationBlock"===b.className&&(b.config||(b.config={}),Object.keys(Y.values||[]).forEach((C=>{var q;const A=null===(q=Y.values)||void 0===q?void 0:q[C];if("value"===C&&A){const Y=A.type;void 0!==Y&&(b.config.animationType=R.arrays.types[Y].flowGraphType)}})))})),q)},"animation/start":{EF:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",FR:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(Y,b)=>[Y[0]*b._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(Y,b)=>[Y[0]*b._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Y,b,C,R,q,A,E){const B=q[q.length-1];return B.config||(B.config={}),B.config.glTF=E,q}},"animation/stop":{EF:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",FR:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Y,b,C,R,q,A,E){const B=q[q.length-1];return B.config||(B.config={}),B.config.glTF=E,q}},"animation/stopAt":{EF:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",FR:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(Y,b)=>[Y[0]*b._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Y,b,C,R,q,A,E){const B=q[q.length-1];return B.config||(B.config={}),B.config.glTF=E,q}},"math/switch":{EF:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(Y){if(Y.configuration&&Y.configuration.cases){const b=Y.configuration.cases.value;if(!b.every((Y=>"number"===typeof Y&&/^-?\d+$/.test(Y.toString()))))return t.e.Warn("Switch cases should be integers. Using empty array instead."),Y.configuration.cases.value=[],{valid:!0};const C=new Set(b);Y.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(Y,b,C,R,q){const A=q[0];return A.dataInputs.forEach((Y=>{"default"!==Y.name&&"case"!==Y.name&&(Y.name="in_"+Y.name)})),A.config||(A.config={}),A.config.treatCasesAsIntegers=!0,q}},"debug/log":{EF:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function vC(Y){let b=arguments.length>2?arguments[2]:void 0;return{EF:[Y],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((Y,b)=>(Y[b]={name:b},Y)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,C,R,q,A){var E;if(b){(E=A[0]).config||(E.config={}),A[0].config.preventIntegerFloatArithmetic=!0;let b=-1;Object.keys(Y.values||{}).find((C=>{var R;return void 0!==(null===(R=Y.values)||void 0===R?void 0:R[C].type)&&(b=Y.values[C].type,!0)})),-1!==b&&(A[0].config.type=q.arrays.types[b].flowGraphType)}return A},validation:Y=>b?zC(Y):{valid:!0}}}function zC(Y){if(Y.values){const b=Object.keys(Y.values).map((b=>Y.values[b].type)).filter((Y=>void 0!==Y));if(!b.every((Y=>Y===b[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}PC["math/compose"]=PC["math/matCompose"],PC["math/decompose"]=PC["math/matDecompose"];var JC=C(12799);const UC={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"AC",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class oC{constructor(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=Y,this._gltf=b,this._animationTargetFps=C,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const Y of this._interactivityGraph.types)this._types.push(UC[Y.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const Y of this._interactivityGraph.declarations){const b=XC(Y);if(!b)throw t.e.Error(["No mapping found for declaration",Y]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:b,fullOperationName:Y.extension?Y.op+":"+Y.extension:Y.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const Y of this._interactivityGraph.variables){const b=this._parseVariable(Y);this._staticVariables.push(b)}}_parseVariable(Y,b){const C=this._types[Y.type];if(!C)throw t.e.Error(["No type found for variable",Y]),new Error("Error parsing variables");if(Y.value&&Y.value.length!==C.length)throw t.e.Error(["Invalid value length for variable",Y,C]),new Error("Error parsing variables");const R=Y.value||[];if(!R.length)switch(C.flowGraphType){case"boolean":R.push(!1);break;case"FlowGraphInteger":R.push(0);break;case"number":R.push(NaN);break;case"Vector2":R.push(NaN,NaN);break;case"AC":R.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":R.fill(NaN,0,4);break;case"Matrix":R.fill(NaN,0,16);break;case"Matrix3D":R.fill(NaN,0,9)}return"number"===C.elementType&&"string"===typeof R[0]&&(R[0]=parseFloat(R[0])),{type:C.flowGraphType,value:b?b(R,this):R}}_parseEvents(){if(this._interactivityGraph.events)for(const Y of this._interactivityGraph.events){const b={eventId:Y.id||"internalEvent_"+this._internalEventsCounter++};Y.values&&(b.eventData=Object.keys(Y.values).map((b=>{var C;const R=null===(C=Y.values)||void 0===C?void 0:C[b];if(!R)throw t.e.Error(["No value found for event key",b]),new Error("Error parsing events");const q=this._types[R.type];if(!q)throw t.e.Error(["No type found for event value",R]),new Error("Error parsing events");const A="undefined"!==typeof R.value?this._parseVariable(R):void 0;return{id:b,type:q.flowGraphType,eventData:!0,value:A}}))),this._events.push(b)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const b of this._interactivityGraph.nodes){if("number"!==typeof b.declaration)throw t.e.Error(["No declaration found for node",b]),new Error("Error parsing nodes");const C=this._mappings[b.declaration];if(!C)throw t.e.Error(["No mapping found for node",b]),new Error("Error parsing nodes");if(C.flowGraphMapping.validation){const R=C.flowGraphMapping.validation(b,this._interactivityGraph,this._gltf);var Y;if(!R.valid)throw new Error(`Error validating interactivity node ${null===(Y=this._interactivityGraph.declarations)||void 0===Y?void 0:Y[b.declaration].op} - ${R.error}`)}const R=[];for(const Y of C.flowGraphMapping.EF){const q=this._getEmptyBlock(Y,C.fullOperationName);this._parseNodeConfiguration(b,q,C.flowGraphMapping,Y),R.push(q)}this._nodes.push({EF:R,fullOperationName:C.fullOperationName})}}_getEmptyBlock(Y,b){return{uniqueId:(0,JC.e)(),className:Y,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:b,metadata:{}}}_parseNodeConfiguration(Y,b,C,R){const q=b.config;if(Y.configuration){const b=Object.keys(Y.configuration);for(const B of b){var A,E;const b=null===(A=Y.configuration)||void 0===A?void 0:A[B];if(!b)throw t.e.Error(["No value found for node configuration",B]),new Error("Error parsing node configuration");const g=null===(E=C.configuration)||void 0===E?void 0:E[B];if(g&&g.FR?g.FR===R:0===C.EF.indexOf(R)){const Y=(null===g||void 0===g?void 0:g.name)||B;b&&"undefined"!==typeof b.value||"undefined"===typeof(null===g||void 0===g?void 0:g.defaultValue)?b.value.length>=0?q[Y]={value:1===b.value.length?b.value[0]:b.value}:t.e.Warn(["Invalid value for node configuration",b]):q[Y]={value:g.defaultValue},g&&g.dataTransformer&&(q[Y].value=g.dataTransformer([q[Y].value],this)[0])}}}}_parseNodeConnections(Y){for(let L=0;L<this._nodes.length;L++){var b;const u=null===(b=this._interactivityGraph.nodes)||void 0===b?void 0:b[L];if(!u)throw t.e.Error(["No node found for interactivity node",this._nodes[L]]),new Error("Error parsing node connections");const c=this._nodes[L],l=this._mappings[u.declaration];if(!l)throw t.e.Error(["No mapping found for node",u]),new Error("Error parsing node connections");const X=u.flows||{},j=Object.keys(X).sort();for(const Y of j){var C,R,q,A;const b=X[Y],r=null===(C=l.flowGraphMapping.outputs)||void 0===C||null===(R=C.flows)||void 0===R?void 0:R[Y],O=(null===r||void 0===r?void 0:r.name)||Y,F=this._createNewSocketConnection(O,!0);(r&&r.FR&&c.EF.find((Y=>Y.className===r.FR))||c.EF[0]).signalOutputs.push(F);const y=b.node,S=this._nodes[y];if(!S)throw t.e.Error(["No node found for input node id",y]),new Error("Error parsing node connections");const n=lC(S.fullOperationName);if(!n)throw t.e.Error(["No mapping found for input node",S]),new Error("Error parsing node connections");let I=null===(q=n.inputs)||void 0===q||null===(A=q.flows)||void 0===A?void 0:A[b.socket||"in"],w=!1;if(!I)for(const Y in null===(E=n.inputs)||void 0===E?void 0:E.flows){var E,B,g;if(Y.startsWith("[")&&Y.endsWith("]"))w=!0,I=null===(B=n.inputs)||void 0===B||null===(g=B.flows)||void 0===g?void 0:g[Y]}const Q=I?w?I.name.replace("$1",b.socket||""):I.name:b.socket||"in",N=I&&I.FR&&S.EF.find((Y=>Y.className===I.FR))||S.EF[0];let p=N.signalInputs.find((Y=>Y.name===Q));p||(p=this._createNewSocketConnection(Q),N.signalInputs.push(p)),p.connectedPointIds.push(F.uniqueId),F.connectedPointIds.push(p.uniqueId)}const T=u.values||{},P=Object.keys(T);for(const b of P){var r,O;const C=T[b];let R=null===(r=l.flowGraphMapping.inputs)||void 0===r||null===(O=r.values)||void 0===O?void 0:O[b],q=!1;if(!R)for(const Y in null===(F=l.flowGraphMapping.inputs)||void 0===F?void 0:F.values){var F,y,S;if(Y.startsWith("[")&&Y.endsWith("]"))q=!0,R=null===(y=l.flowGraphMapping.inputs)||void 0===y||null===(S=y.values)||void 0===S?void 0:S[Y]}const A=R?q?R.name.replace("$1",b):R.name:b,E=this._createNewSocketConnection(A);if((R&&R.FR&&c.EF.find((Y=>Y.className===R.FR))||c.EF[0]).dataInputs.push(E),void 0!==C.value){const b=this._parseVariable(C,R&&R.dataTransformer);Y._connectionValues[E.uniqueId]=b}else{if("undefined"===typeof C.node)throw t.e.Error(["Invalid value for value connection",C]),new Error("Error parsing node connections");{var n,I,w;const Y=C.node,b=C.socket||"value",R=this._nodes[Y];if(!R)throw t.e.Error(["No node found for output socket reference",C]),new Error("Error parsing node connections");const q=lC(R.fullOperationName);if(!q)throw t.e.Error(["No mapping found for output socket reference",C]),new Error("Error parsing node connections");let A=null===(n=q.outputs)||void 0===n||null===(I=n.values)||void 0===I?void 0:I[b],B=!1;if(!A)for(const C in null===(Q=q.outputs)||void 0===Q?void 0:Q.values){var Q,N,p;if(C.startsWith("[")&&C.endsWith("]"))B=!0,A=null===(N=q.outputs)||void 0===N||null===(p=N.values)||void 0===p?void 0:p[C]}const g=A?B?A.name.replace("$1",b):null===(w=A)||void 0===w?void 0:w.name:b,r=A&&A.FR&&R.EF.find((Y=>Y.className===A.FR))||R.EF[0];let O=r.dataOutputs.find((Y=>Y.name===g));O||(O=this._createNewSocketConnection(g,!0),r.dataOutputs.push(O)),E.connectedPointIds.push(O.uniqueId),O.connectedPointIds.push(E.uniqueId)}}}if(l.flowGraphMapping.interBlockConnectors)for(const Y of l.flowGraphMapping.interBlockConnectors){const b=Y.input,C=Y.output,R=Y.isVariable;this._connectFlowGraphNodes(b,C,c.EF[Y.inputBlockIndex],c.EF[Y.outputBlockIndex],R)}if(l.flowGraphMapping.extraProcessor){var mY;const b=null===(mY=this._interactivityGraph.declarations)||void 0===mY?void 0:mY[u.declaration];if(!b)throw t.e.Error(["No declaration found for extra processor",u]),new Error("Error parsing node connections");c.EF=l.flowGraphMapping.extraProcessor(u,b,l.flowGraphMapping,this,c.EF,Y,this._gltf)}}}_createNewSocketConnection(Y,b){return{uniqueId:(0,JC.e)(),name:Y,_connectionType:b?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(Y,b,C,R,q){const A=q?C.dataInputs:C.signalInputs,E=q?R.dataOutputs:R.signalOutputs,B=A.find((b=>b.name===Y))||this._createNewSocketConnection(Y),g=E.find((Y=>Y.name===b))||this._createNewSocketConnection(b,!0);A.find((b=>b.name===Y))||A.push(B),E.find((Y=>Y.name===b))||E.push(g),B.connectedPointIds.push(g.uniqueId),g.connectedPointIds.push(B.uniqueId)}getVariableName(Y){return"staticVariable_"+Y}serializeToFlowGraph(){const Y={uniqueId:(0,JC.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(Y);for(let b=0;b<this._staticVariables.length;b++){const C=this._staticVariables[b];Y._userVariables[this.getVariableName(b)]=C}return{rightHanded:!0,allBlocks:this._nodes.reduce(((Y,b)=>Y.concat(b.EF)),[]),executionContexts:[Y]}}}const GC="KHR_interactivity";class hC{constructor(Y){this._loader=Y,this.name=GC,this.enabled=this._loader.isExtensionUsed(GC),this._pathConverter=(0,e.h)(this._loader.Qb),Y._skipStartAnimationStep=!0;const b=Y.babylonScene;b&&function(Y){(0,e.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!Y.activeCamera)return new q.Quaternion(NaN,NaN,NaN,NaN);const b=q.Quaternion.FromRotationMatrix(Y.activeCamera.getWorldMatrix()).normalize();return Y.useRightHandedSystem||(b.w*=-1,b.x*=-1),b},type:"Quaternion",getTarget:()=>Y.activeCamera}),(0,e.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!Y.activeCamera)return new q.AC(NaN,NaN,NaN);const b=Y.activeCamera.getWorldMatrix().getTranslation();return Y.useRightHandedSystem||(b.x*=-1),b},type:"AC",getTarget:()=>Y.activeCamera}),(0,e.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:Y=>{var b;return(null===(b=Y._babylonAnimationGroup)||void 0===b?void 0:b.isPlaying)??!1},type:"boolean",getTarget:Y=>Y._babylonAnimationGroup}),(0,e.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:Y=>{var b;return((null===(b=Y._babylonAnimationGroup)||void 0===b?void 0:b.from)??0)/60},type:"number",getTarget:Y=>Y._babylonAnimationGroup}),(0,e.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:Y=>{var b;return((null===(b=Y._babylonAnimationGroup)||void 0===b?void 0:b.to)??0)/60},type:"number",getTarget:Y=>Y._babylonAnimationGroup}),(0,e.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:Y=>{var b;return((null===(b=Y._babylonAnimationGroup)||void 0===b?void 0:b.getCurrentFrame())??0)/60},type:"number",getTarget:Y=>Y._babylonAnimationGroup}),(0,e.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:Y=>{var b;return((null===(b=Y._babylonAnimationGroup)||void 0===b?void 0:b.getCurrentFrame())??0)/60},type:"number",getTarget:Y=>Y._babylonAnimationGroup})}(b)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var Y;if(!this._loader.babylonScene||!this._pathConverter)return;const b=this._loader.babylonScene,C=null===(Y=this._loader.Qb.extensions)||void 0===Y?void 0:Y.KHR_interactivity;if(!C)return;const R=new nC.b({BC:b});R.dispatchEventsSynchronously=!1;const q=C.graphs.map((Y=>new oC(Y,this._loader.Qb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(q.map((async Y=>await LC(Y,{coordinator:R,pathConverter:this._pathConverter})))),R.start()}}var eC;eC=async()=>(await Promise.resolve().then(C.bind(C,14468))).FlowGraphGLTFDataProvider,tC[`${GC}/${"FlowGraphGLTFDataProvider"}`]=eC,h(GC),G(GC,!0,(Y=>new hC(Y)));const HC="KHR_node_visibility";(0,e.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:Y=>{const b=Y._babylonTransformNode;return!b||void 0===b.isVisible||b.isVisible},set:(Y,b)=>{var C,R;null===(C=b._primitiveBabylonMeshes)||void 0===C||C.forEach((Y=>{Y.inheritVisibility=!0})),b._babylonTransformNode&&(b._babylonTransformNode.isVisible=Y),null===(R=b._primitiveBabylonMeshes)||void 0===R||R.forEach((b=>{b.isVisible=Y}))},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class iC{constructor(Y){this.name=HC,this._loader=Y,this.enabled=Y.isExtensionUsed(HC)}async onReady(){var Y;null===(Y=this._loader.Qb.nodes)||void 0===Y||Y.forEach((Y=>{var b,C,R,q;(null===(b=Y._primitiveBabylonMeshes)||void 0===b||b.forEach((Y=>{Y.inheritVisibility=!0})),null!==(C=Y.extensions)&&void 0!==C&&C.KHR_node_visibility)&&(!1===(null===(R=Y.extensions)||void 0===R?void 0:R.KHR_node_visibility.visible)&&(Y._babylonTransformNode&&(Y._babylonTransformNode.isVisible=!1),null===(q=Y._primitiveBabylonMeshes)||void 0===q||q.forEach((Y=>{Y.isVisible=!1}))))}))}dispose(){this._loader=null}}h(HC),G(HC,!0,(Y=>new iC(Y)));const WC="KHR_node_selectability";jC("event/onSelect",WC,{EF:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FR:"FlowGraphGetVariableBlock",dataTransformer:Y=>["pickedMesh_"+Y[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",FR:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Y,b,C,R,q,A,E){var B,g,r,O,F,y;const S=q[q.length-1];S.config=S.config||{},S.config.glTF=E;const n=null===(B=Y.configuration)||void 0===B||null===(g=B.nodeIndex)||void 0===g?void 0:g.value[0];if(void 0===n||"number"!==typeof n)throw new Error("nodeIndex not found in configuration");const t="pickedMesh_"+n;return q[1].config.variable=t,A._userVariables[t]={className:"Mesh",id:null===E||void 0===E||null===(r=E.nodes)||void 0===r||null===(O=r[n]._babylonTransformNode)||void 0===O?void 0:O.id,uniqueId:null===E||void 0===E||null===(F=E.nodes)||void 0===F||null===(y=F[n]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},q}}),(0,e.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:Y=>{const b=Y._babylonTransformNode;return!b||void 0===b.Xr||b.Xr},set:(Y,b)=>{var C;null===(C=b._primitiveBabylonMeshes)||void 0===C||C.forEach((b=>{b.Xr=Y}))},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"Xr"],type:"boolean"});class sC{constructor(Y){this.name=WC,this._loader=Y,this.enabled=Y.isExtensionUsed(WC)}async onReady(){var Y;null===(Y=this._loader.Qb.nodes)||void 0===Y||Y.forEach((Y=>{var b,C,R;null!==(b=Y.extensions)&&void 0!==b&&b.KHR_node_selectability&&!1===(null===(C=Y.extensions)||void 0===C?void 0:C.KHR_node_selectability.selectable)&&(null===(R=Y._babylonTransformNode)||void 0===R||R.getChildMeshes().forEach((Y=>{Y.Xr=!1})))}))}dispose(){this._loader=null}}h(WC),G(WC,!0,(Y=>new sC(Y)));const DC="KHR_node_hoverability",dC="targetMeshPointerOver_";jC("event/onHoverIn",DC,{EF:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FR:"FlowGraphGetVariableBlock",dataTransformer:Y=>[dC+Y[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",FR:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Y,b,C,R,q,A,E){var B,g,r,O,F,y;const S=q[q.length-1];S.config=S.config||{},S.config.glTF=E;const n=null===(B=Y.configuration)||void 0===B||null===(g=B.nodeIndex)||void 0===g?void 0:g.value[0];if(void 0===n||"number"!==typeof n)throw new Error("nodeIndex not found in configuration");const t=dC+n;return q[1].config.variable=t,A._userVariables[t]={className:"Mesh",id:null===E||void 0===E||null===(r=E.nodes)||void 0===r||null===(O=r[n]._babylonTransformNode)||void 0===O?void 0:O.id,uniqueId:null===E||void 0===E||null===(F=E.nodes)||void 0===F||null===(y=F[n]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},q}});const VC="targetMeshPointerOut_";jC("event/onHoverOut",DC,{EF:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FR:"FlowGraphGetVariableBlock",dataTransformer:Y=>[VC+Y[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",FR:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Y,b,C,R,q,A,E){var B,g,r,O,F,y;const S=q[q.length-1];S.config=S.config||{},S.config.glTF=E;const n=null===(B=Y.configuration)||void 0===B||null===(g=B.nodeIndex)||void 0===g?void 0:g.value[0];if(void 0===n||"number"!==typeof n)throw new Error("nodeIndex not found in configuration");const t=VC+n;return q[1].config.variable=t,A._userVariables[t]={className:"Mesh",id:null===E||void 0===E||null===(r=E.nodes)||void 0===r||null===(O=r[n]._babylonTransformNode)||void 0===O?void 0:O.id,uniqueId:null===E||void 0===E||null===(F=E.nodes)||void 0===F||null===(y=F[n]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},q}}),(0,e.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:Y=>{const b=Y._babylonTransformNode;return!b||void 0===b.pointerOverDisableMeshTesting||b.pointerOverDisableMeshTesting},set:(Y,b)=>{var C;null===(C=b._primitiveBabylonMeshes)||void 0===C||C.forEach((b=>{b.pointerOverDisableMeshTesting=!Y}))},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class kC{constructor(Y){this.name=DC,this._loader=Y,this.enabled=Y.isExtensionUsed(DC)}async onReady(){var Y;null===(Y=this._loader.Qb.nodes)||void 0===Y||Y.forEach((Y=>{var b,C,R;null!==(b=Y.extensions)&&void 0!==b&&b.KHR_node_hoverability&&!1===(null===(C=Y.extensions)||void 0===C?void 0:C.KHR_node_hoverability.hoverable)&&(null===(R=Y._babylonTransformNode)||void 0===R||R.getChildMeshes().forEach((Y=>{Y.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}h(DC),G(DC,!0,(Y=>new kC(Y)));const xC="ExtrasAsMetadata";class aC{_assignExtras(Y,b){if(b.extras&&Object.keys(b.extras).length>0){const C=Y.metadata=Y.metadata||{};(C.Qb=C.Qb||{}).extras=b.extras}}constructor(Y){this.name=xC,this.enabled=!0,this._loader=Y}dispose(){this._loader=null}loadNodeAsync(Y,b,C){return this._loader.loadNodeAsync(Y,b,(Y=>{this._assignExtras(Y,b),C(Y)}))}loadCameraAsync(Y,b,C){return this._loader.loadCameraAsync(Y,b,(Y=>{this._assignExtras(Y,b),C(Y)}))}createMaterial(Y,b,C){const R=this._loader.createMaterial(Y,b,C);return this._assignExtras(R,b),R}}h(xC),G(xC,!1,(Y=>new aC(Y)));C(14468)},14347:(Y,b,C)=>{"use strict";C.d(b,{d:()=>z,f:()=>l,g:()=>c,k:()=>X});var R=C(12652),q=C(12645),A=C(13980),E=C(13273),B=C(13239),g=C(13249),r=C(12669),O=C(12702),F=C(13270),y=C(13366),S=C(13279),n=C(12872);class t{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.xy=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.PS=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(Y){this._environmentTexture=Y}getNodes(){let Y=[];Y=Y.concat(this.meshes),Y=Y.concat(this.lights),Y=Y.concat(this.cameras),Y=Y.concat(this.transformNodes);for(const b of this.skeletons)Y=Y.concat(b.bones);return Y}}class I extends t{}class w{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const Y=this.rootNodes;for(const R of Y)R.dispose();Y.length=0;const b=this.skeletons;for(const R of b)R.dispose();b.length=0;const C=this.animationGroups;for(const R of C)R.dispose();C.length=0}}class Q extends t{constructor(Y){super(),this._wasAddedToScene=!1,(Y=Y||O.d.LastCreatedScene)&&(this.BC=Y,this.proceduralTextures=[],Y.Sb.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=Y.getEngine().onContextRestoredObservable.add((()=>{for(const Y of this.geometries)Y._rebuild();for(const Y of this.meshes)Y._rebuild();for(const Y of this.xy)Y.rebuild();for(const Y of this.textures)Y._rebuild()})))}_topologicalSort(Y){const b=new Map;for(const E of Y)b.set(E.uniqueId,E);const C={dependsOn:new Map,dependedBy:new Map};for(const E of Y){const Y=E.uniqueId;C.dependsOn.set(Y,new Set),C.dependedBy.set(Y,new Set)}for(const E of Y){const Y=E.uniqueId,R=C.dependsOn.get(Y);if(E instanceof F.b){const q=E.sourceMesh;b.has(q.uniqueId)&&(R.add(q.uniqueId),C.dependedBy.get(q.uniqueId).add(Y))}const q=C.dependedBy.get(Y);for(const A of E.getDescendants()){const R=A.uniqueId;if(b.has(R)){q.add(R);C.dependsOn.get(R).add(Y)}}}const R=[],q=[];for(const E of Y){const Y=E.uniqueId;0===C.dependsOn.get(Y).size&&(q.push(E),b.delete(Y))}const A=q;for(;A.length>0;){const Y=A.shift();R.push(Y);const q=C.dependedBy.get(Y.uniqueId);for(const R of Array.from(q.values())){const q=C.dependsOn.get(R);q.delete(Y.uniqueId),0===q.size&&b.get(R)&&(A.push(b.get(R)),b.delete(R))}}return b.size>0&&(r.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),b.forEach((Y=>{r.e.Error(Y.name)}))),R}_addNodeAndDescendantsToList(Y,b,C,R){if(C&&(!R||R(C))&&!b.has(C.uniqueId)){Y.push(C),b.add(C.uniqueId);for(const q of C.getDescendants(!0))this._addNodeAndDescendantsToList(Y,b,q,R)}}_isNodeInContainer(Y){return Y instanceof g.b&&-1!==this.meshes.indexOf(Y)||(Y instanceof B.e&&-1!==this.transformNodes.indexOf(Y)||(Y instanceof y.e&&-1!==this.lights.indexOf(Y)||Y instanceof S.c&&-1!==this.cameras.indexOf(Y)))}_isValidHierarchy(){for(const Y of this.meshes)if(Y.parent&&!this._isNodeInContainer(Y.parent))return r.e.Warn(`Node ${Y.name} has a parent that is not in the container.`),!1;for(const Y of this.transformNodes)if(Y.parent&&!this._isNodeInContainer(Y.parent))return r.e.Warn(`Node ${Y.name} has a parent that is not in the container.`),!1;for(const Y of this.lights)if(Y.parent&&!this._isNodeInContainer(Y.parent))return r.e.Warn(`Node ${Y.name} has a parent that is not in the container.`),!1;for(const Y of this.cameras)if(Y.parent&&!this._isNodeInContainer(Y.parent))return r.e.Warn(`Node ${Y.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const R={},A={},B=new w,g=[],r=[],O={doNotInstantiate:!0,...C},F=[],y=new Set;for(const q of this.transformNodes)null===q.parent&&this._addNodeAndDescendantsToList(F,y,q,O.predicate);for(const q of this.meshes)null===q.parent&&this._addNodeAndDescendantsToList(F,y,q,O.predicate);const S=this._topologicalSort(F),n=(C,q)=>{if(((b,C)=>{if(R[b.uniqueId]=C.uniqueId,A[C.uniqueId]=C,Y&&(C.name=Y(b.name)),C instanceof E.d){const Y=C;if(Y.morphTargetManager){const C=b.morphTargetManager;Y.morphTargetManager=C.clone();for(let b=0;b<C.numTargets;b++){const q=C.getTarget(b),E=Y.morphTargetManager.getTarget(b);R[q.uniqueId]=E.uniqueId,A[E.uniqueId]=E}}}})(C,q),C.parent){const Y=R[C.parent.uniqueId],b=A[Y];q.parent=b||C.parent}if(q.position&&C.position&&q.position.q(C.position),q.rotationQuaternion&&C.rotationQuaternion&&q.rotationQuaternion.q(C.rotationQuaternion),q.rotation&&C.rotation&&q.rotation.q(C.rotation),q.ob&&C.ob&&q.ob.q(C.ob),q.material){const E=q;if(E.material)if(b){const b=C.material;if(-1===r.indexOf(b)){let C=b.clone(Y?Y(b.name):"Clone of "+b.name);if(r.push(b),R[b.uniqueId]=C.uniqueId,A[C.uniqueId]=C,"MultiMaterial"===b.getClassName()){const q=b;for(const b of q.eb)b&&(C=b.clone(Y?Y(b.name):"Clone of "+b.name),r.push(b),R[b.uniqueId]=C.uniqueId,A[C.uniqueId]=C);q.eb=q.eb.map((Y=>Y&&A[R[Y.uniqueId]]))}}"InstancedMesh"!==E.getClassName()&&(E.material=A[R[b.uniqueId]])}else"MultiMaterial"===E.material.getClassName()?-1===this.BC.multiMaterials.indexOf(E.material)&&this.BC.addMultiMaterial(E.material):-1===this.BC.materials.indexOf(E.material)&&this.BC.addMaterial(E.material)}null===q.parent&&B.rootNodes.push(q)};for(const q of S)if("InstancedMesh"===q.getClassName()){const Y=q,b=Y.sourceMesh,C=R[b.uniqueId];n(Y,("number"===typeof C?A[C]:b).createInstance(Y.name))}else{let Y=!0;"Vb"===q.getClassName()||"Node"===q.getClassName()||q.skeleton||!q.getTotalVertices||0===q.getTotalVertices()?Y=!1:O.doNotInstantiate&&(Y="function"===typeof O.doNotInstantiate?!O.doNotInstantiate(q):!O.doNotInstantiate);const b=Y?q.createInstance(`instance of ${q.name}`):q.clone(`Clone of ${q.name}`,null,!0);if(!b)throw new Error(`Could not clone or instantiate node on Asset Container ${q.name}`);n(q,b)}for(const q of this.skeletons){if(O.predicate&&!O.predicate(q))continue;const b=q.clone(Y?Y(q.name):"Clone of "+q.name);for(const Y of this.meshes)if(Y.skeleton===q&&!Y.isAnInstance){const C=A[R[Y.uniqueId]];if(!C||C.isAnInstance)continue;if(C.skeleton=b,-1!==g.indexOf(b))continue;g.push(b);for(const Y of b.bones)Y._linkedTransformNode&&(Y._linkedTransformNode=A[R[Y._linkedTransformNode.uniqueId]])}B.skeletons.push(b)}for(const q of this.animationGroups){if(O.predicate&&!O.predicate(q))continue;const b=q.clone(Y?Y(q.name):"Clone of "+q.name,(Y=>A[R[Y.uniqueId]]||Y));B.animationGroups.push(b)}return B}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.BC.environmentTexture=this.environmentTexture);for(const Y of this.BC._serializableComponents)Y.addFromContainer(this);this.BC.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=[];for(const C of this.cameras)Y&&!Y(C)||(this.BC.addCamera(C),b.push(C));for(const C of this.lights)Y&&!Y(C)||(this.BC.addLight(C),b.push(C));for(const C of this.meshes)Y&&!Y(C)||(this.BC.xO(C),b.push(C));for(const C of this.skeletons)Y&&!Y(C)||this.BC.addSkeleton(C);for(const C of this.animations)Y&&!Y(C)||this.BC.addAnimation(C);for(const C of this.animationGroups)Y&&!Y(C)||this.BC.addAnimationGroup(C);for(const C of this.multiMaterials)Y&&!Y(C)||this.BC.addMultiMaterial(C);for(const C of this.materials)Y&&!Y(C)||this.BC.addMaterial(C);for(const C of this.morphTargetManagers)Y&&!Y(C)||this.BC.addMorphTargetManager(C);for(const C of this.geometries)Y&&!Y(C)||this.BC.addGeometry(C);for(const C of this.transformNodes)Y&&!Y(C)||(this.BC.addTransformNode(C),b.push(C));for(const C of this.actionManagers)Y&&!Y(C)||this.BC.addActionManager(C);for(const C of this.textures)Y&&!Y(C)||this.BC.addTexture(C);for(const C of this.reflectionProbes)Y&&!Y(C)||this.BC.addReflectionProbe(C);for(const C of b)C.parent&&-1===this.BC.getNodes().indexOf(C.parent)&&(C.setParent?C.setParent(null):C.parent=null)}removeAllFromScene(){this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.BC.environmentTexture&&(this.BC.environmentTexture=null);for(const Y of this.BC._serializableComponents)Y.removeFromContainer(this)}removeFromScene(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const b of this.cameras)Y&&!Y(b)||this.BC.removeCamera(b);for(const b of this.lights)Y&&!Y(b)||this.BC.removeLight(b);for(const b of this.meshes)Y&&!Y(b)||this.BC.kO(b,!0);for(const b of this.skeletons)Y&&!Y(b)||this.BC.removeSkeleton(b);for(const b of this.animations)Y&&!Y(b)||this.BC.removeAnimation(b);for(const b of this.animationGroups)Y&&!Y(b)||this.BC.removeAnimationGroup(b);for(const b of this.multiMaterials)Y&&!Y(b)||this.BC.removeMultiMaterial(b);for(const b of this.materials)Y&&!Y(b)||this.BC.removeMaterial(b);for(const b of this.morphTargetManagers)Y&&!Y(b)||this.BC.removeMorphTargetManager(b);for(const b of this.geometries)Y&&!Y(b)||this.BC.removeGeometry(b);for(const b of this.transformNodes)Y&&!Y(b)||this.BC.removeTransformNode(b);for(const b of this.actionManagers)Y&&!Y(b)||this.BC.removeActionManager(b);for(const b of this.textures)Y&&!Y(b)||this.BC.removeTexture(b);for(const b of this.reflectionProbes)Y&&!Y(b)||this.BC.removeReflectionProbe(b)}dispose(){const Y=this.cameras.slice(0);for(const S of Y)S.dispose();this.cameras.length=0;const b=this.lights.slice(0);for(const S of b)S.dispose();this.lights.length=0;const C=this.meshes.slice(0);for(const S of C)S.dispose();this.meshes.length=0;const R=this.skeletons.slice(0);for(const S of R)S.dispose();this.skeletons.length=0;const q=this.animationGroups.slice(0);for(const S of q)S.dispose();this.animationGroups.length=0;const A=this.multiMaterials.slice(0);for(const S of A)S.dispose();this.multiMaterials.length=0;const E=this.materials.slice(0);for(const S of E)S.dispose();this.materials.length=0;const B=this.geometries.slice(0);for(const S of B)S.dispose();this.geometries.length=0;const g=this.transformNodes.slice(0);for(const S of g)S.dispose();this.transformNodes.length=0;const r=this.actionManagers.slice(0);for(const S of r)S.dispose();this.actionManagers.length=0;const O=this.textures.slice(0);for(const S of O)S.dispose();this.textures.length=0;const F=this.reflectionProbes.slice(0);for(const S of F)S.dispose();this.reflectionProbes.length=0;const y=this.morphTargetManagers.slice(0);for(const S of y)S.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const S of this.BC._serializableComponents)S.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.BC.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(Y,b,C){if(Y&&b)for(const R of Y){let Y=!0;if(C)for(const b of C)if(R===b){Y=!1;break}Y&&(b.push(R),R._parentContainer=this)}}moveAllFromScene(Y){this._wasAddedToScene=!1,void 0===Y&&(Y=new I);for(const b in this)Object.prototype.hasOwnProperty.call(this,b)&&(this[b]=this[b]||("_environmentTexture"===b?null:[]),this._moveAssets(this.BC[b],this[b],Y[b]));this.environmentTexture=this.BC.environmentTexture,this.removeAllFromScene()}createRootMesh(){const Y=new E.d("assetContainerRootMesh",this.BC);for(const b of this.meshes)b.parent||Y.addChild(b);return this.meshes.unshift(Y),Y}mergeAnimationsTo(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.d.LastCreatedScene,b=arguments.length>1?arguments[1]:void 0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Y)return r.e.Error("No scene available to merge animations to"),[];const R=C||(b=>{let C=null;const R=b.animations.length?b.animations[0].targetProperty:"",q=b.name.split(".").join("").split("_primitive")[0];switch(R){case"position":case"rotationQuaternion":C=Y.getTransformNodeByName(b.name)||Y.getTransformNodeByName(q);break;case"influence":C=Y.getMorphTargetByName(b.name)||Y.getMorphTargetByName(q);break;default:C=Y.getNodeByName(b.name)||Y.getNodeByName(q)}return C}),q=this.getNodes();for(const B of q){const Y=R(B);if(null!==Y){for(const b of B.animations){const C=Y.animations.filter((Y=>Y.targetProperty===b.targetProperty));for(const b of C){const C=Y.animations.indexOf(b,0);C>-1&&Y.animations.splice(C,1)}}Y.animations=Y.animations.concat(B.animations)}}const A=[],E=this.animationGroups.slice();for(const B of E){A.push(B.clone(B.name,R));for(const Y of B.animatables)Y.stop()}for(const B of b){const b=R(B.target);b&&(Y.beginAnimation(b,B.fromFrame,B.toFrame,B.loopAnimation,B.speedRatio,B.onAnimationEnd?B.onAnimationEnd:void 0,void 0,!0,void 0,B.onAnimationLoop?B.onAnimationLoop:void 0),Y.stopAnimation(B.target))}return A}populateRootNodes(){this.rootNodes.length=0;for(const Y of this.meshes)Y.parent||-1!==this.rootNodes.indexOf(Y)||this.rootNodes.push(Y);for(const Y of this.transformNodes)Y.parent||-1!==this.rootNodes.indexOf(Y)||this.rootNodes.push(Y);for(const Y of this.lights)Y.parent||-1!==this.rootNodes.indexOf(Y)||this.rootNodes.push(Y);for(const Y of this.cameras)Y.parent||-1!==this.rootNodes.indexOf(Y)||this.rootNodes.push(Y)}addAllAssetsToContainer(Y){if(!Y)return;const b=[],C=new Set;for(b.push(Y);b.length>0;){const Y=b.pop();if(Y instanceof E.d?(Y.Pb&&-1===this.geometries.indexOf(Y.Pb)&&this.geometries.push(Y.Pb),this.meshes.push(Y)):Y instanceof F.b?this.meshes.push(Y):Y instanceof B.e?this.transformNodes.push(Y):Y instanceof y.e?this.lights.push(Y):Y instanceof S.c&&this.cameras.push(Y),Y instanceof g.b){if(Y.material&&-1===this.materials.indexOf(Y.material)){this.materials.push(Y.material);for(const b of Y.material.getActiveTextures())-1===this.textures.indexOf(b)&&this.textures.push(b)}Y.skeleton&&-1===this.skeletons.indexOf(Y.skeleton)&&this.skeletons.push(Y.skeleton),Y.morphTargetManager&&-1===this.morphTargetManagers.indexOf(Y.morphTargetManager)&&this.morphTargetManagers.push(Y.morphTargetManager)}for(const R of Y.getChildren())C.has(R)||b.push(R);C.add(Y)}this.populateRootNodes()}_getByTags(Y,b,C){if(void 0===b)return Y;const R=[];for(const q in Y){const A=Y[q];n.d&&n.d.MatchesQuery(A,b)&&(!C||C(A))&&R.push(A)}return R}getMeshesByTags(Y,b){return this._getByTags(this.meshes,Y,b)}getCamerasByTags(Y,b){return this._getByTags(this.cameras,Y,b)}getLightsByTags(Y,b){return this._getByTags(this.lights,Y,b)}getMaterialsByTags(Y,b){return this._getByTags(this.materials,Y,b).concat(this._getByTags(this.multiMaterials,Y,b))}getTransformNodesByTags(Y,b){return this._getByTags(this.transformNodes,Y,b)}}var N=C(12720);class p{constructor(Y){this.byteOffset=0,this.buffer=Y}async loadAsync(Y){const b=await this.buffer.readAsync(this.byteOffset,Y);this._dataView=new DataView(b.buffer,b.byteOffset,b.byteLength),this._dataByteOffset=0}readUint32(){const Y=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,Y}readUint8Array(Y){const b=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,Y);return this._dataByteOffset+=Y,this.byteOffset+=Y,b}readString(Y){return(0,N.h)(this.readUint8Array(Y))}skipBytes(Y){this._dataByteOffset+=Y,this.byteOffset+=Y}}var mY=C(14354);const L="Z2xURg",u={name:"Qb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:Y=>-1!==Y.indexOf("asset")&&-1!==Y.indexOf("version")||Y.startsWith("data:base64,"+L)||Y.startsWith("data:;base64,"+L)||Y.startsWith("data:application/octet-stream;base64,"+L)||Y.startsWith("data:model/gltf-binary;base64,"+L)};var c,l,X,j=C(12709),T=C(12715);function P(Y,b,C){try{return Promise.resolve(new Uint8Array(Y,b,C))}catch(R){return Promise.reject(R)}}!function(Y){Y[Y.AUTO=0]="AUTO",Y[Y.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(c||(c={})),function(Y){Y[Y.NONE=0]="NONE",Y[Y.FIRST=1]="FIRST",Y[Y.ALL=2]="ALL"}(l||(l={})),function(Y){Y[Y.LOADING=0]="LOADING",Y[Y.READY=1]="READY",Y[Y.COMPLETE=2]="COMPLETE"}(X||(X={}));class v{constructor(){this.coordinateSystemMode=c.AUTO,this.animationStartMode=l.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=Y=>Promise.resolve(Y),this.extensionOptions={}}q(Y){Y&&(this.onParsed=Y.onParsed,this.coordinateSystemMode=Y.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=Y.animationStartMode??this.animationStartMode,this.loadNodeAnimations=Y.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=Y.loadSkins??this.loadSkins,this.loadMorphTargets=Y.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=Y.compileMaterials??this.compileMaterials,this.useClipPlane=Y.useClipPlane??this.useClipPlane,this.compileShadowGenerators=Y.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=Y.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=Y.useRangeRequests??this.useRangeRequests,this.createInstances=Y.createInstances??this.createInstances,this.alwaysComputeBoundingBox=Y.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=Y.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=Y.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=Y.skipMaterials??this.skipMaterials,this.useSRGBBuffers=Y.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=Y.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=Y.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=Y.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=Y.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=Y.customRootNode,this.onMeshLoaded=Y.onMeshLoaded,this.onSkinLoaded=Y.onSkinLoaded,this.onTextureLoaded=Y.onTextureLoaded,this.onMaterialLoaded=Y.onMaterialLoaded,this.onCameraLoaded=Y.onCameraLoaded,this.extensionOptions=Y.extensionOptions??this.extensionOptions)}}class z extends v{constructor(Y){super(),this.onParsedObservable=new R.d,this.onMeshLoadedObservable=new R.d,this.onSkinLoadedObservable=new R.d,this.onTextureLoadedObservable=new R.d,this.onMaterialLoadedObservable=new R.d,this.onCameraLoadedObservable=new R.d,this.onCompleteObservable=new R.d,this.onErrorObservable=new R.d,this.Sb=new R.d,this.onExtensionLoadedObservable=new R.d,this.validate=!1,this.onValidatedObservable=new R.d,this._loader=null,this._state=null,this._requests=new Array,this.name=u.name,this.extensions=u.extensions,this.onLoaderStateChangedObservable=new R.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.q(Y)}set onParsed(Y){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),Y&&(this._onParsedObserver=this.onParsedObservable.add(Y))}set onMeshLoaded(Y){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),Y&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(Y))}set onSkinLoaded(Y){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),Y&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((b=>Y(b.node,b.skinnedNode))))}set onTextureLoaded(Y){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),Y&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(Y))}set onMaterialLoaded(Y){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),Y&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(Y))}set onCameraLoaded(Y){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),Y&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(Y))}set onComplete(Y){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(Y)}set onError(Y){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(Y)}set onDispose(Y){this._onDisposeObserver&&this.Sb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Sb.add(Y)}set onExtensionLoaded(Y){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(Y)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(Y){this._loggingEnabled!==Y&&(this._loggingEnabled=Y,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(Y){this._capturePerformanceCounters!==Y&&(this._capturePerformanceCounters=Y,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(Y){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(Y)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const Y of this._requests)Y.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=Y=>Promise.resolve(Y),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Sb.notifyObservers(void 0),this.Sb.clear()}loadFile(Y,b,C,A,E,B,g,O){if(ArrayBuffer.isView(b))return this._loadBinary(Y,b,C,A,g,O),null;this._progressCallback=E;const F=b.name||q.Tools.GetFilename(b);if(B){if(this.useRangeRequests){this.validate&&r.e.Warn("glTF validation is not supported when range requests are enabled");const C={abort:()=>{},onCompleteObservable:new R.d},q={readAsync:(C,R)=>new Promise(((q,A)=>{this._loadFile(Y,b,(Y=>{q(new Uint8Array(Y))}),!0,(Y=>{A(Y)}),(Y=>{Y.setRequestHeader("Range",`bytes=${C}-${C+R-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new p(q)).then((Y=>{C.onCompleteObservable.notifyObservers(C),A(Y)}),g?Y=>g(void 0,Y):void 0),C}return this._loadFile(Y,b,(b=>{this._validate(Y,new Uint8Array(b,0,b.byteLength),C,F),this._unpackBinaryAsync(new p({readAsync:(Y,C)=>P(b,Y,C),byteLength:b.byteLength})).then((Y=>{A(Y)}),g?Y=>g(void 0,Y):void 0)}),!0,g)}return this._loadFile(Y,b,(b=>{try{this._validate(Y,b,C,F),A({json:this._parseJson(b)})}catch{g&&g()}}),!1,g)}_loadBinary(Y,b,C,R,q,A){this._validate(Y,new Uint8Array(b.buffer,b.byteOffset,b.byteLength),C,A),this._unpackBinaryAsync(new p({readAsync:(Y,C)=>function(Y,b,C){try{if(b<0||b>=Y.byteLength)throw new RangeError("Offset is out of range.");if(b+C>Y.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(Y.buffer,Y.byteOffset+b,C))}catch(R){return Promise.reject(R)}}(b,Y,C),byteLength:b.byteLength})).then((Y=>{R(Y)}),q?Y=>q(void 0,Y):void 0)}importMeshAsync(Y,b,C,R,q,A){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(C),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(C),this._loader.importMeshAsync(Y,b,null,C,R,q,A))))}loadAsync(Y,b,C,R,q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(b),this._loader.loadAsync(Y,b,C,R,q))))}loadAssetContainerAsync(Y,b,C,R,q){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(b);const A=new Q(Y),E=[];this.onMaterialLoadedObservable.add((Y=>{E.push(Y)}));const B=[];this.onTextureLoadedObservable.add((Y=>{B.push(Y)}));const g=[];this.onCameraLoadedObservable.add((Y=>{g.push(Y)}));const r=[];return this.onMeshLoadedObservable.add((Y=>{Y.morphTargetManager&&r.push(Y.morphTargetManager)})),this._loader.importMeshAsync(null,Y,A,b,C,R,q).then((Y=>(Array.prototype.push.apply(A.geometries,Y.geometries),Array.prototype.push.apply(A.meshes,Y.meshes),Array.prototype.push.apply(A.xy,Y.xy),Array.prototype.push.apply(A.skeletons,Y.skeletons),Array.prototype.push.apply(A.animationGroups,Y.animationGroups),Array.prototype.push.apply(A.materials,E),Array.prototype.push.apply(A.textures,B),Array.prototype.push.apply(A.lights,Y.lights),Array.prototype.push.apply(A.transformNodes,Y.transformNodes),Array.prototype.push.apply(A.cameras,g),Array.prototype.push.apply(A.morphTargetManagers,r),A)))}))}canDirectLoad(Y){return u.canDirectLoad(Y)}directLoad(Y,b){if(b.startsWith("base64,"+L)||b.startsWith(";base64,"+L)||b.startsWith("application/octet-stream;base64,"+L)||b.startsWith("model/gltf-binary;base64,"+L)){const C=(0,j.e)(b);return this._validate(Y,new Uint8Array(C,0,C.byteLength)),this._unpackBinaryAsync(new p({readAsync:(Y,b)=>P(C,Y,b),byteLength:C.byteLength}))}return this._validate(Y,b),Promise.resolve({json:this._parseJson(b)})}createPlugin(Y){return new z(Y[u.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((Y,b)=>{this.onCompleteObservable.addOnce((()=>{Y()})),this.onErrorObservable.addOnce((Y=>{b(Y)}))}))}_setState(Y){this._state!==Y&&(this._state=Y,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(X[this._state]))}_loadFile(Y,b,C,R,q,A){const E=Y._loadFile(b,C,(Y=>{this._onProgress(Y,E)}),!0,R,q,A);return E.onCompleteObservable.add((()=>{E._lengthComputable=!0,E._total=E._loaded})),this._requests.push(E),E}_onProgress(Y,b){if(!this._progressCallback)return;b._lengthComputable=Y.lengthComputable,b._loaded=Y.loaded,b._total=Y.total;let C=!0,R=0,q=0;for(const A of this._requests){if(void 0===A._lengthComputable||void 0===A._loaded||void 0===A._total)return;C=C&&A._lengthComputable,R+=A._loaded,q+=A._total}this._progressCallback({lengthComputable:C,loaded:R,total:C?q:0})}_validate(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),mY.b.ValidateAsync(b,C,R,(b=>this.preprocessUrlAsync(C+b).then((b=>Y._loadFileAsync(b,void 0,!0,!0).then((Y=>new Uint8Array(Y,0,Y.byteLength))))))).then((Y=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(Y),this.onValidatedObservable.clear()}),(Y=>{this._endPerformanceCounter("Validate JSON"),q.Tools.Warn(`Failed to validate: ${Y.message}`),this.onValidatedObservable.clear()})))}_getLoader(Y){const b=Y.json.asset||{};this._log(`Asset version: ${b.version}`),b.minVersion&&this._log(`Asset minimum version: ${b.minVersion}`),b.generator&&this._log(`Asset generator: ${b.generator}`);const C=z._parseVersion(b.version);if(!C)throw new Error("Invalid version: "+b.version);if(void 0!==b.minVersion){const Y=z._parseVersion(b.minVersion);if(!Y)throw new Error("Invalid minimum version: "+b.minVersion);if(z._compareVersion(Y,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+b.minVersion)}const R={1:z._CreateGLTF1Loader,2:z._CreateGLTF2Loader}[C.major];if(!R)throw new Error("Unsupported version: "+b.version);return R(this)}_parseJson(Y){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${Y.length}`);const b=JSON.parse(Y);return this._endPerformanceCounter("Parse JSON"),b}_unpackBinaryAsync(Y){return this._startPerformanceCounter("Unpack Binary"),Y.loadAsync(20).then((()=>{const b=Y.readUint32();if(1179937895!==b)throw new T.i("Unexpected magic: "+b,T.e.GLTFLoaderUnexpectedMagicError);const C=Y.readUint32();this.loggingEnabled&&this._log(`Binary version: ${C}`);const R=Y.readUint32();let q;switch(this.useRangeRequests||R===Y.buffer.byteLength||r.e.Warn(`Length in header does not match actual data length: ${R} != ${Y.buffer.byteLength}`),C){case 1:q=this._unpackBinaryV1Async(Y,R);break;case 2:q=this._unpackBinaryV2Async(Y,R);break;default:throw new Error("Unsupported version: "+C)}return this._endPerformanceCounter("Unpack Binary"),q}))}_unpackBinaryV1Async(Y,b){const C=Y.readUint32(),R=Y.readUint32();if(0!==R)throw new Error(`Unexpected content format: ${R}`);const q=b-Y.byteOffset,A={json:this._parseJson(Y.readString(C)),bin:null};if(0!==q){const b=Y.byteOffset;A.bin={readAsync:(C,R)=>Y.buffer.readAsync(b+C,R),byteLength:q}}return Promise.resolve(A)}_unpackBinaryV2Async(Y,b){const C=1313821514,R=5130562,q=Y.readUint32();if(Y.readUint32()!==C)throw new Error("First chunk format is not JSON");return Y.byteOffset+q===b?Y.loadAsync(q).then((()=>({json:this._parseJson(Y.readString(q)),bin:null}))):Y.loadAsync(q+8).then((()=>{const A={json:this._parseJson(Y.readString(q)),bin:null},E=()=>{const q=Y.readUint32();switch(Y.readUint32()){case C:throw new Error("Unexpected JSON chunk");case R:{const b=Y.byteOffset;A.bin={readAsync:(C,R)=>Y.buffer.readAsync(b+C,R),byteLength:q},Y.skipBytes(q);break}default:Y.skipBytes(q)}return Y.byteOffset!==b?Y.loadAsync(8).then(E):Promise.resolve(A)};return E()}))}static _parseVersion(Y){if("1.0"===Y||"1.0.1"===Y)return{major:1,minor:0};const b=(Y+"").match(/^(\d+)\.(\d+)/);return b?{major:parseInt(b[1]),minor:parseInt(b[2])}:null}static _compareVersion(Y,b){return Y.major>b.major?1:Y.major<b.major?-1:Y.minor>b.minor?1:Y.minor<b.minor?-1:0}_logOpen(Y){this._log(Y),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(Y){const b=z._logSpaces.substring(0,2*this._logIndentLevel);r.e.Log(`${b}${Y}`)}_logDisabled(Y){}_startPerformanceCounterEnabled(Y){q.Tools.StartPerformanceCounter(Y)}_startPerformanceCounterDisabled(Y){}_endPerformanceCounterEnabled(Y){q.Tools.EndPerformanceCounter(Y)}_endPerformanceCounterDisabled(Y){}}z.IncrementalLoading=!0,z.HomogeneousCoordinates=!1,z._logSpaces="                                ",(0,A.e)(new z)},14354:(Y,b,C)=>{"use strict";C.d(b,{b:()=>E});var R=C(12645);function q(Y,b,C,R){const q={externalResourceFunction:R};return C&&(q.uri="file:"===b?C:b+C),ArrayBuffer.isView(Y)?GLTFValidator.validateBytes(Y,q):GLTFValidator.validateString(Y,q)}function A(){const Y=[];onmessage=b=>{const C=b.data;switch(C.id){case"init":importScripts(C.url);break;case"validate":q(C.data,C.rootUrl,C.fileName,(b=>new Promise(((C,R)=>{const q=Y.length;Y.push({resolve:C,reject:R}),postMessage({id:"getExternalResource",index:q,uri:b})})))).then((Y=>{postMessage({id:"validate.resolve",value:Y})}),(Y=>{postMessage({id:"validate.reject",reason:Y})}));break;case"getExternalResource.resolve":Y[C.index].resolve(C.value);break;case"getExternalResource.reject":Y[C.index].reject(C.reason)}}}class E{static ValidateAsync(Y,b,C,E){return"function"===typeof Worker?new Promise(((B,g)=>{const r=`${q}(${A})()`,O=URL.createObjectURL(new Blob([r],{type:"application/javascript"})),F=new Worker(O),y=Y=>{F.removeEventListener("error",y),F.removeEventListener("message",S),g(Y)},S=Y=>{const b=Y.data;switch(b.id){case"getExternalResource":E(b.uri).then((Y=>{F.postMessage({id:"getExternalResource.resolve",index:b.index,value:Y},[Y.buffer])}),(Y=>{F.postMessage({id:"getExternalResource.reject",index:b.index,reason:Y})}));break;case"validate.resolve":F.removeEventListener("error",y),F.removeEventListener("message",S),B(b.value),F.terminate();break;case"validate.reject":F.removeEventListener("error",y),F.removeEventListener("message",S),g(b.reason),F.terminate()}};if(F.addEventListener("error",y),F.addEventListener("message",S),F.postMessage({id:"init",url:R.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(Y)){const R=Y.slice();F.postMessage({id:"validate",data:R,rootUrl:b,fileName:C},[R.buffer])}else F.postMessage({id:"validate",data:Y,rootUrl:b,fileName:C})})):(this._LoadScriptPromise||(this._LoadScriptPromise=R.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>q(Y,b,C,E))))}}E.Configuration={url:`${R.Tools._DefaultCdnUrl}/gltf_validator.js`}},15078:(Y,b,C)=>{"use strict";C.d(b,{c:()=>u});var R=C(12818),q=C(12821),A=C(12870),E=C(12831),B=C(13207),g=C(13137),r=C(12903),O=C(13077),F=C(12790),y=C(12747);C(14106),C(14016),C(14032),C(14022),C(14035),C(14039),C(14042);const S="imageProcessingCompatibility",n="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";y.b.IncludesShadersStore[S]||(y.b.IncludesShadersStore[S]=n);const t="skyPixelShader",I="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";y.b.ShadersStore[t]||(y.b.ShadersStore[t]=I);C(14116),C(14050),C(14055),C(14065),C(14058);const w="skyVertexShader",Q="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";y.b.ShadersStore[w]||(y.b.ShadersStore[w]=Q);var N=C(13128),p=C(13187),mY=C(13181);class L extends B.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class u extends g.c{constructor(Y,b){super(Y,b),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new E.AC(0,100,0),this.useSunPosition=!1,this.cameraOffset=E.AC.Zero(),this.up=E.AC.Up(),this.dithering=!1,this._cameraPosition=E.AC.Zero(),this._skyOrientation=new E.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(Y,b){const C=b._drawWrapper;if(this.isFrozen&&C.effect&&C._wasPreviouslyReady)return!0;b.materialDefines||(b.materialDefines=new L);const R=b.materialDefines,q=this.uY();if(this._isReadyForSubMesh(b))return!0;if((0,mY.O)(Y,q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,R),(0,mY.I)(Y,R,!0,!1),R.IMAGEPROCESSINGPOSTPROCESS!==q.imageProcessingConfiguration.applyByPostProcess&&R.markAsMiscDirty(),R.DITHER!==this.dithering&&R.markAsMiscDirty(),R.isDirty){R.markAsProcessed(),q.resetCachedMaterial();const Y=new N.b;R.FOG&&Y.addFallback(1,"FOG"),R.IMAGEPROCESSINGPOSTPROCESS=q.imageProcessingConfiguration.applyByPostProcess,R.DITHER=this.dithering;const C=[r.e.PositionKind];R.VERTEXCOLOR&&C.push(r.e.ColorKind);const A="sky",E=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,p.c)(E);const B=R.toString();b.setEffect(q.getEngine().createEffect(A,C,E,[],B,Y,this.onCompiled,this.onError),R,this._materialContext)}return!(!b.effect||!b.effect.isReady())&&(R._renderId=q.getRenderId(),C._wasPreviouslyReady=!0,!0)}bindForSubMesh(Y,b,C){const R=this.uY(),q=C.materialDefines;if(!q)return;const A=C.effect;if(!A)return;this._activeEffect=A,this.bindOnlyWorldMatrix(Y),this._activeEffect.setMatrix("viewProjection",R.getTransformMatrix()),this._mustRebind(R,A,C)&&((0,p.g)(A,this,R),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,mY.n)(q,A,R)),R.fogEnabled&&b.applyFog&&R.fogMode!==O.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",R.getViewMatrix()),(0,mY.h)(R,b,this._activeEffect);const B=R.activeCamera;if(B){const Y=B.getWorldMatrix();this._cameraPosition.x=Y.m[12],this._cameraPosition.y=Y.m[13],this._cameraPosition.z=Y.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const Y=Math.PI*(this.inclination-.5),b=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(b)*Math.cos(Y),this.sunPosition.y=this.distance*Math.sin(-Y),this.sunPosition.z=this.distance*Math.sin(b)*Math.cos(Y),E.Quaternion.FromUnitVectorsToRef(E.AC.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(b,this._activeEffect,C)}getAnimatables(){return[]}dispose(Y){super.dispose(Y)}clone(Y){return A.e.Clone((()=>new u(Y,this.uY())),this)}serialize(){const Y=super.serialize();return Y.customType="BABYLON.SkyMaterial",Y}getClassName(){return"SkyMaterial"}static Parse(Y,b,C){return A.e.Parse((()=>new u(Y.name,b)),Y,b,C)}}(0,R.c)([(0,q.K)()],u.prototype,"luminance",void 0),(0,R.c)([(0,q.K)()],u.prototype,"turbidity",void 0),(0,R.c)([(0,q.K)()],u.prototype,"rayleigh",void 0),(0,R.c)([(0,q.K)()],u.prototype,"mieCoefficient",void 0),(0,R.c)([(0,q.K)()],u.prototype,"mieDirectionalG",void 0),(0,R.c)([(0,q.K)()],u.prototype,"distance",void 0),(0,R.c)([(0,q.K)()],u.prototype,"inclination",void 0),(0,R.c)([(0,q.K)()],u.prototype,"azimuth",void 0),(0,R.c)([(0,q.H)()],u.prototype,"sunPosition",void 0),(0,R.c)([(0,q.K)()],u.prototype,"useSunPosition",void 0),(0,R.c)([(0,q.H)()],u.prototype,"cameraOffset",void 0),(0,R.c)([(0,q.H)()],u.prototype,"up",void 0),(0,R.c)([(0,q.K)()],u.prototype,"dithering",void 0),(0,F.g)("BABYLON.SkyMaterial",u)},13513:(Y,b,C)=>{"use strict";function R(Y,b){b.headers=Y.headers||{},b.statusMessage=Y.statusText,b.statusCode=Y.status,b.data=Y.response}function q(Y,b,C){return new Promise((function(q,A){C=C||{};var E,B,g,r=new XMLHttpRequest,O=C.body,F=C.headers||{};for(E in C.timeout&&(r.timeout=C.timeout),r.ontimeout=r.onerror=function(Y){Y.timeout="timeout"==Y.type,A(Y)},r.open(Y,b.href||b),r.onload=function(){for(g=r.getAllResponseHeaders().trim().split(/[\r\n]+/),R(r,r);B=g.shift();)B=B.split(": "),r.headers[B.shift().toLowerCase()]=B.join(": ");if((B=r.headers["content-type"])&&~B.indexOf("application/json"))try{r.data=JSON.parse(r.data,C.reviver)}catch(Y){return R(r,Y),A(Y)}(r.status>=400?A:q)(r)},typeof FormData<"u"&&O instanceof FormData||O&&"object"==typeof O&&(F["content-type"]="application/json",O=JSON.stringify(O)),r.withCredentials=!!C.withCredentials,F)r.setRequestHeader(E,F[E]);r.send(O)}))}C.r(b),C.d(b,{del:()=>g,get:()=>A,patch:()=>B,post:()=>E,put:()=>r,send:()=>q});var A=q.bind(q,"GET"),E=q.bind(q,"POST"),B=q.bind(q,"PATCH"),g=q.bind(q,"DELETE"),r=q.bind(q,"PUT")},15212:(Y,b,C)=>{"use strict";C.d(b,{d:()=>F});const R=.5*(Math.sqrt(3)-1),q=(3-Math.sqrt(3))/6,A=1/3,E=1/6,B=(Math.sqrt(5)-1)/4,g=(5-Math.sqrt(5))/20,r=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),O=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const F=class{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const b="function"==typeof Y?Y:function(Y){let b=0,C=0,R=0,q=1;const A=function(){let Y=4022871197;return function(b){b=b.toString();for(let C=0;C<b.length;C++){Y+=b.charCodeAt(C);let R=.02519603282416938*Y;Y=R>>>0,R-=Y,R*=Y,Y=R>>>0,R-=Y,Y+=4294967296*R}return 2.3283064365386963e-10*(Y>>>0)}}();b=A(" "),C=A(" "),R=A(" "),b-=A(Y),b<0&&(b+=1);C-=A(Y),C<0&&(C+=1);R-=A(Y),R<0&&(R+=1);return function(){const Y=2091639*b+2.3283064365386963e-10*q;return b=C,C=R,R=Y-(q=0|Y)}}(Y);this.p=function(Y){const b=new Uint8Array(256);for(let C=0;C<256;C++)b[C]=C;for(let C=0;C<255;C++){const R=C+~~(Y()*(256-C)),q=b[C];b[C]=b[R],b[R]=q}return b}(b),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let C=0;C<512;C++)this.perm[C]=this.p[255&C],this.permMod12[C]=this.perm[C]%12}noise2D(Y,b){const C=this.permMod12,A=this.perm;let E=0,B=0,g=0;const O=(Y+b)*R,F=Math.floor(Y+O),y=Math.floor(b+O),S=(F+y)*q,n=Y-(F-S),t=b-(y-S);let I,w;n>t?(I=1,w=0):(I=0,w=1);const Q=n-I+q,N=t-w+q,p=n-1+2*q,mY=t-1+2*q,L=255&F,u=255&y;let c=.5-n*n-t*t;if(c>=0){const Y=3*C[L+A[u]];c*=c,E=c*c*(r[Y]*n+r[Y+1]*t)}let l=.5-Q*Q-N*N;if(l>=0){const Y=3*C[L+I+A[u+w]];l*=l,B=l*l*(r[Y]*Q+r[Y+1]*N)}let X=.5-p*p-mY*mY;if(X>=0){const Y=3*C[L+1+A[u+1]];X*=X,g=X*X*(r[Y]*p+r[Y+1]*mY)}return 70*(E+B+g)}noise3D(Y,b,C){const R=this.permMod12,q=this.perm;let B,g,O,F;const y=(Y+b+C)*A,S=Math.floor(Y+y),n=Math.floor(b+y),t=Math.floor(C+y),I=(S+n+t)*E,w=Y-(S-I),Q=b-(n-I),N=C-(t-I);let p,mY,L,u,c,l;w>=Q?Q>=N?(p=1,mY=0,L=0,u=1,c=1,l=0):w>=N?(p=1,mY=0,L=0,u=1,c=0,l=1):(p=0,mY=0,L=1,u=1,c=0,l=1):Q<N?(p=0,mY=0,L=1,u=0,c=1,l=1):w<N?(p=0,mY=1,L=0,u=0,c=1,l=1):(p=0,mY=1,L=0,u=1,c=1,l=0);const X=w-p+E,j=Q-mY+E,T=N-L+E,P=w-u+2*E,v=Q-c+2*E,z=N-l+2*E,J=w-1+.5,U=Q-1+.5,o=N-1+.5,G=255&S,h=255&n,e=255&t;let H=.6-w*w-Q*Q-N*N;if(H<0)B=0;else{const Y=3*R[G+q[h+q[e]]];H*=H,B=H*H*(r[Y]*w+r[Y+1]*Q+r[Y+2]*N)}let i=.6-X*X-j*j-T*T;if(i<0)g=0;else{const Y=3*R[G+p+q[h+mY+q[e+L]]];i*=i,g=i*i*(r[Y]*X+r[Y+1]*j+r[Y+2]*T)}let W=.6-P*P-v*v-z*z;if(W<0)O=0;else{const Y=3*R[G+u+q[h+c+q[e+l]]];W*=W,O=W*W*(r[Y]*P+r[Y+1]*v+r[Y+2]*z)}let s=.6-J*J-U*U-o*o;if(s<0)F=0;else{const Y=3*R[G+1+q[h+1+q[e+1]]];s*=s,F=s*s*(r[Y]*J+r[Y+1]*U+r[Y+2]*o)}return 32*(B+g+O+F)}noise4D(Y,b,C,R){const q=this.perm;let A,E,r,F,y;const S=(Y+b+C+R)*B,n=Math.floor(Y+S),t=Math.floor(b+S),I=Math.floor(C+S),w=Math.floor(R+S),Q=(n+t+I+w)*g,N=Y-(n-Q),p=b-(t-Q),mY=C-(I-Q),L=R-(w-Q);let u=0,c=0,l=0,X=0;N>p?u++:c++,N>mY?u++:l++,N>L?u++:X++,p>mY?c++:l++,p>L?c++:X++,mY>L?l++:X++;const j=u>=3?1:0,T=c>=3?1:0,P=l>=3?1:0,v=X>=3?1:0,z=u>=2?1:0,J=c>=2?1:0,U=l>=2?1:0,o=X>=2?1:0,G=u>=1?1:0,h=c>=1?1:0,e=l>=1?1:0,H=X>=1?1:0,i=N-j+g,W=p-T+g,s=mY-P+g,D=L-v+g,d=N-z+2*g,V=p-J+2*g,k=mY-U+2*g,x=L-o+2*g,a=N-G+3*g,M=p-h+3*g,K=mY-e+3*g,f=L-H+3*g,Z=N-1+4*g,YY=p-1+4*g,bY=mY-1+4*g,CY=L-1+4*g,RY=255&n,qY=255&t,AY=255&I,EY=255&w;let BY=.6-N*N-p*p-mY*mY-L*L;if(BY<0)A=0;else{const Y=q[RY+q[qY+q[AY+q[EY]]]]%32*4;BY*=BY,A=BY*BY*(O[Y]*N+O[Y+1]*p+O[Y+2]*mY+O[Y+3]*L)}let gY=.6-i*i-W*W-s*s-D*D;if(gY<0)E=0;else{const Y=q[RY+j+q[qY+T+q[AY+P+q[EY+v]]]]%32*4;gY*=gY,E=gY*gY*(O[Y]*i+O[Y+1]*W+O[Y+2]*s+O[Y+3]*D)}let rY=.6-d*d-V*V-k*k-x*x;if(rY<0)r=0;else{const Y=q[RY+z+q[qY+J+q[AY+U+q[EY+o]]]]%32*4;rY*=rY,r=rY*rY*(O[Y]*d+O[Y+1]*V+O[Y+2]*k+O[Y+3]*x)}let OY=.6-a*a-M*M-K*K-f*f;if(OY<0)F=0;else{const Y=q[RY+G+q[qY+h+q[AY+e+q[EY+H]]]]%32*4;OY*=OY,F=OY*OY*(O[Y]*a+O[Y+1]*M+O[Y+2]*K+O[Y+3]*f)}let FY=.6-Z*Z-YY*YY-bY*bY-CY*CY;if(FY<0)y=0;else{const Y=q[RY+1+q[qY+1+q[AY+1+q[EY+1]]]]%32*4;FY*=FY,y=FY*FY*(O[Y]*Z+O[Y+1]*YY+O[Y+2]*bY+O[Y+3]*CY)}return 27*(A+E+r+F+y)}}}}]);