/*! For license information please see mr6xlj.32.8c7ddfa3.chunk.js.LICENSE.txt */
(self.fyqbdzs5tyo=self.fyqbdzs5tyo||[]).push([[32],{13220:(V,I,A)=>{"use strict";var B=A(13228),F=A(13234),E=A(13241);A.g.__TYPEDARRAY_POOL||(A.g.__TYPEDARRAY_POOL={UINT8:F([32,0]),UINT16:F([32,0]),UINT32:F([32,0]),INT8:F([32,0]),INT16:F([32,0]),INT32:F([32,0]),FLOAT:F([32,0]),DOUBLE:F([32,0]),DATA:F([32,0]),UINT8C:F([32,0]),BUFFER:F([32,0])});var Y="undefined"!==typeof Uint8ClampedArray,H=A.g.__TYPEDARRAY_POOL;H.UINT8C||(H.UINT8C=F([32,0])),H.BUFFER||(H.BUFFER=F([32,0]));var c=H.DATA,b=H.BUFFER;function X(V){if(V){var I=V.length||V.byteLength,A=B.log2(I);c[A].push(V)}}function P(V){V=B.nextPow2(V);var I=B.log2(V),A=c[I];return A.length>0?A.pop():new ArrayBuffer(V)}function J(V){return new Uint8Array(P(V),0,V)}function G(V){return new Uint16Array(P(2*V),0,V)}function w(V){return new Uint32Array(P(4*V),0,V)}function t(V){return new Int8Array(P(V),0,V)}function u(V){return new Int16Array(P(2*V),0,V)}function W(V){return new Int32Array(P(4*V),0,V)}function g(V){return new Float32Array(P(4*V),0,V)}function o(V){return new Float64Array(P(8*V),0,V)}function L(V){return Y?new Uint8ClampedArray(P(V),0,V):J(V)}function z(V){return new DataView(P(V),0,V)}I.free=function(V){if(E(V))b[B.log2(V.length)].push(V);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(V)&&(V=V.buffer),!V)return;var I=V.length||V.byteLength,A=0|B.log2(I);c[A].push(V)}},I.freeUint8=I.freeUint16=I.freeUint32=I.freeInt8=I.freeInt16=I.freeInt32=I.freeFloat32=I.freeFloat=I.freeFloat64=I.freeDouble=I.freeUint8Clamped=I.freeDataView=function(V){X(V.buffer)},I.freeArrayBuffer=X,I.freeBuffer=function(V){b[B.log2(V.length)].push(V)},I.malloc=function(V,I){if(void 0===I||"arraybuffer"===I)return P(V);switch(I){case"uint8":return J(V);case"uint16":return G(V);case"uint32":return w(V);case"int8":return t(V);case"int16":return u(V);case"int32":return W(V);case"float":case"float32":return g(V);case"double":case"float64":return o(V);case"uint8_clamped":return L(V);case"buffer":throw"Buffer not supported";case"data":case"dataview":return z(V);default:return null}return null},I.mallocArrayBuffer=P,I.mallocUint8=J,I.mallocUint16=G,I.mallocUint32=w,I.mallocInt8=t,I.mallocInt16=u,I.mallocInt32=W,I.mallocFloat32=I.mallocFloat=g,I.mallocFloat64=I.mallocDouble=o,I.mallocUint8Clamped=L,I.mallocDataView=z,I.clearCache=function(){for(var V=0;V<32;++V)H.UINT8[V].length=0,H.UINT16[V].length=0,H.UINT32[V].length=0,H.INT8[V].length=0,H.INT16[V].length=0,H.INT32[V].length=0,H.FLOAT[V].length=0,H.DOUBLE[V].length=0,H.UINT8C[V].length=0,c[V].length=0,b[V].length=0}},13308:(V,I,A)=>{V.exports=F;var B=A(12075);function F(V,I){if(!(this instanceof F))return new F(V,I);var A=B.create();B.add(A,V,I),this.base=B.min(B.create(),V,A),this.JP=B.clone(I),this.max=B.max(B.create(),V,A),this.mag=B.length(this.JP)}var E=F.prototype;E.width=function(){return this.JP[0]},E.height=function(){return this.JP[1]},E.depth=function(){return this.JP[2]},E.x0=function(){return this.base[0]},E.y0=function(){return this.base[1]},E.z0=function(){return this.base[2]},E.x1=function(){return this.max[0]},E.y1=function(){return this.max[1]},E.z1=function(){return this.max[2]},E.translate=function(V){return B.add(this.max,this.max,V),B.add(this.base,this.base,V),this},E.setPosition=function(V){return B.add(this.max,V,this.JP),B.k(this.base,V),this},E.expand=function(V){var I=B.create(),A=B.create();return B.max(I,V.max,this.max),B.min(A,V.base,this.base),B.uI(I,I,A),new F(A,I)},E.intersects=function(V){return!(V.base[0]>this.max[0])&&(!(V.base[1]>this.max[1])&&(!(V.base[2]>this.max[2])&&(!(V.max[0]<this.base[0])&&(!(V.max[1]<this.base[1])&&!(V.max[2]<this.base[2])))))},E.touches=function(V){var I=this.union(V);return null!==I&&(0==I.width()||0==I.height()||0==I.depth())},E.union=function(V){if(!this.intersects(V))return null;var I=Math.max(V.base[0],this.base[0]),A=Math.max(V.base[1],this.base[1]),B=Math.max(V.base[2],this.base[2]);return new F([I,A,B],[Math.min(V.max[0],this.max[0])-I,Math.min(V.max[1],this.max[1])-A,Math.min(V.max[2],this.max[2])-B])}},13228:(V,I)=>{"use strict";function A(V){var I=32;return(V&=-V)&&I--,65535&V&&(I-=16),16711935&V&&(I-=8),252645135&V&&(I-=4),858993459&V&&(I-=2),1431655765&V&&(I-=1),I}I.INT_BITS=32,I.INT_MAX=2147483647,I.INT_MIN=-1<<31,I.sign=function(V){return(V>0)-(V<0)},I.abs=function(V){var I=V>>31;return(V^I)-I},I.min=function(V,I){return I^(V^I)&-(V<I)},I.max=function(V,I){return V^(V^I)&-(V<I)},I.isPow2=function(V){return!(V&V-1)&&!!V},I.log2=function(V){var I,A;return I=(V>65535)<<4,I|=A=((V>>>=I)>255)<<3,I|=A=((V>>>=A)>15)<<2,(I|=A=((V>>>=A)>3)<<1)|(V>>>=A)>>1},I.log10=function(V){return V>=1e9?9:V>=1e8?8:V>=1e7?7:V>=1e6?6:V>=1e5?5:V>=1e4?4:V>=1e3?3:V>=100?2:V>=10?1:0},I.popCount=function(V){return 16843009*((V=(858993459&(V-=V>>>1&1431655765))+(V>>>2&858993459))+(V>>>4)&252645135)>>>24},I.countTrailingZeros=A,I.nextPow2=function(V){return V+=0===V,--V,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)+1},I.prevPow2=function(V){return V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)-(V>>>1)},I.parity=function(V){return V^=V>>>16,V^=V>>>8,V^=V>>>4,27030>>>(V&=15)&1};var B=new Array(256);!function(V){for(var I=0;I<256;++I){var A=I,B=I,F=7;for(A>>>=1;A;A>>>=1)B<<=1,B|=1&A,--F;V[I]=B<<F&255}}(B),I.reverse=function(V){return B[255&V]<<24|B[V>>>8&255]<<16|B[V>>>16&255]<<8|B[V>>>24&255]},I.interleave2=function(V,I){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))<<1},I.deinterleave2=function(V,I){return(V=65535&((V=16711935&((V=252645135&((V=858993459&((V=V>>>I&1431655765)|V>>>1))|V>>>2))|V>>>4))|V>>>16))<<16>>16},I.interleave3=function(V,I,A){return V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2),(V|=(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<1)|(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<2},I.deinterleave3=function(V,I){return(V=1023&((V=4278190335&((V=251719695&((V=3272356035&((V=V>>>I&1227133513)|V>>>2))|V>>>4))|V>>>8))|V>>>16))<<22>>22},I.nextCombination=function(V){var I=V|V-1;return I+1|(~I&-~I)-1>>>A(V)+1}},13213:(V,I,A)=>{"use strict";V.exports=function(V,I,A){switch(arguments.length){case 1:return B=[],b(F=V,F,X,!0),B;case 2:return"function"===typeof I?b(V,V,I,!0):function(V,I){return B=[],b(V,I,X,!1),B}(V,I);case 3:return b(V,I,A,!1);default:throw new Error("box-intersect: Invalid arguments")}var F};var B,F=A(13220),E=A(13249),Y=A(13257);function H(V,I){for(var A=0;A<V;++A)if(!(I[A]<=I[A+V]))return!0;return!1}function c(V,I,A,B){for(var F=0,E=0,Y=0,c=V.length;Y<c;++Y){var b=V[Y];if(!H(I,b)){for(var X=0;X<2*I;++X)A[F++]=b[X];B[E++]=Y}}return E}function b(V,I,A,B){var H=V.length,b=I.length;if(!(H<=0||b<=0)){var X=V[0].length>>>1;if(!(X<=0)){var P,J=F.mallocDouble(2*X*H),G=F.mallocInt32(H);if((H=c(V,X,J,G))>0){if(1===X&&B)E.init(H),P=E.sweepComplete(X,A,0,H,J,G,0,H,J,G);else{var w=F.mallocDouble(2*X*b),t=F.mallocInt32(b);(b=c(I,X,w,t))>0&&(E.init(H+b),P=1===X?E.sweepBipartite(X,A,0,H,J,G,0,b,w,t):Y(X,A,B,H,J,G,b,w,t),F.free(w),F.free(t))}F.free(J),F.free(G)}return P}}}function X(V,I){B.push([V,I])}},13261:(V,I)=>{"use strict";var A="d",B="ax",F="fp",E="es",Y="rs",H="re",c="rb",b="bs",X="be",P="bb",J=[A,B,"vv",Y,H,c,"ri",b,X,P,"bi"];function G(V){var I="bruteForce"+(V?"Full":"Partial"),B=[],Y=J.slice();V||Y.splice(3,0,F);var H=["function "+I+"("+Y.join()+"){"];function c(I,F){var Y=function(V,I,B){var F="bruteForce"+(V?"Red":"Blue")+(I?"Flip":"")+(B?"Full":""),Y=["function ",F,"(",J.join(),"){","var ",E,"=2*",A,";"],H="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",c="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(B?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return V?Y.push(H,"Q",":",c):Y.push(c,"Q",":",H),B?Y.push("if(y1<x0||x1<y0)continue;"):I?Y.push("if(y0<=x0||x1<y0)continue;"):Y.push("if(y0<x0||x1<y0)continue;"),Y.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),I?Y.push("yi,xi"):Y.push("xi,yi"),Y.push(");if(rv!==void 0)return rv;}}}"),{name:F,code:Y.join("")}}(I,F,V);B.push(Y.code),H.push("return "+Y.name+"("+J.join()+");")}H.push("if(re-rs>be-bs){"),V?(c(!0,!1),H.push("}else{"),c(!1,!1)):(H.push("if(fp){"),c(!0,!0),H.push("}else{"),c(!0,!1),H.push("}}else{if(fp){"),c(!1,!0),H.push("}else{"),c(!1,!1),H.push("}")),H.push("}}return "+I);var b=B.join("")+H.join("");return new Function(b)()}I.partial=G(!1),I.full=G(!0)},13257:(V,I,A)=>{"use strict";V.exports=function(V,I,A,E,X,h,r,M,x){!function(V,I){var A=8*F.log2(I+1)*(V+1)|0,E=F.nextPow2(L*A);m.length<E&&(B.free(m),m=B.mallocInt32(E));var Y=F.nextPow2(z*A);s.length<Y&&(B.free(s),s=B.mallocDouble(Y))}(V,E+r);var f,R=0,q=2*V;e(R++,0,0,E,0,r,A?16:0,-1/0,1/0),A||e(R++,0,0,r,0,E,1,-1/0,1/0);for(;R>0;){var N=(R-=1)*L,l=m[N],i=m[N+1],y=m[N+2],v=m[N+3],C=m[N+4],K=m[N+5],p=R*z,j=s[p],T=s[p+1],d=1&K,D=!!(16&K),O=X,Z=h,a=M,k=x;if(d&&(O=M,Z=x,a=X,k=h),!(2&K&&i>=(y=u(V,l,i,y,O,Z,T)))&&!(4&K&&(i=W(V,l,i,y,O,Z,j))>=y)){var U=y-i,n=C-v;if(D){if(V*U*(U+n)<G){if(void 0!==(f=c.scanComplete(V,l,I,i,y,O,Z,v,C,a,k)))return f;continue}}else{if(V*Math.min(U,n)<P){if(void 0!==(f=Y(V,l,I,d,i,y,O,Z,v,C,a,k)))return f;continue}if(V*U*n<J){if(void 0!==(f=c.scanBipartite(V,l,I,d,i,y,O,Z,v,C,a,k)))return f;continue}}var VV=w(V,l,i,y,O,Z,j,T);if(i<VV)if(V*(VV-i)<P){if(void 0!==(f=H(V,l+1,I,i,VV,O,Z,v,C,a,k)))return f}else if(l===V-2){if(void 0!==(f=d?c.sweepBipartite(V,I,v,C,a,k,i,VV,O,Z):c.sweepBipartite(V,I,i,VV,O,Z,v,C,a,k)))return f}else e(R++,l+1,i,VV,v,C,d,-1/0,1/0),e(R++,l+1,v,C,i,VV,1^d,-1/0,1/0);if(VV<y){var IV=b(V,l,v,C,a,k),AV=a[q*IV+l],BV=t(V,l,IV,C,a,k,AV);if(BV<C&&e(R++,l,VV,y,BV,C,(4|d)+(D?16:0),AV,T),v<IV&&e(R++,l,VV,y,v,IV,(2|d)+(D?16:0),j,AV),IV+1===BV){if(void 0!==(f=D?Q(V,l,I,VV,y,O,Z,IV,a,k[IV]):S(V,l,I,d,VV,y,O,Z,IV,a,k[IV])))return f}else if(IV<BV){var FV;if(D){if(VV<(FV=g(V,l,VV,y,O,Z,AV))){var EV=t(V,l,VV,FV,O,Z,AV);if(l===V-2){if(VV<EV&&void 0!==(f=c.sweepComplete(V,I,VV,EV,O,Z,IV,BV,a,k)))return f;if(EV<FV&&void 0!==(f=c.sweepBipartite(V,I,EV,FV,O,Z,IV,BV,a,k)))return f}else VV<EV&&e(R++,l+1,VV,EV,IV,BV,16,-1/0,1/0),EV<FV&&(e(R++,l+1,EV,FV,IV,BV,0,-1/0,1/0),e(R++,l+1,IV,BV,EV,FV,1,-1/0,1/0))}}else VV<(FV=d?o(V,l,VV,y,O,Z,AV):g(V,l,VV,y,O,Z,AV))&&(l===V-2?f=d?c.sweepBipartite(V,I,IV,BV,a,k,VV,FV,O,Z):c.sweepBipartite(V,I,VV,FV,O,Z,IV,BV,a,k):(e(R++,l+1,VV,FV,IV,BV,d,-1/0,1/0),e(R++,l+1,IV,BV,VV,FV,1^d,-1/0,1/0)))}}}}};var B=A(13220),F=A(13228),E=A(13261),Y=E.partial,H=E.full,c=A(13249),b=A(13263),X=A(13266),P=128,J=1<<22,G=1<<22,w=X("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),t=X("lo===p0",["p0"]),u=X("lo<p0",["p0"]),W=X("hi<=p0",["p0"]),g=X("lo<=p0&&p0<=hi",["p0"]),o=X("lo<p0&&p0<=hi",["p0"]),L=6,z=2,m=B.mallocInt32(1024),s=B.mallocDouble(1024);function e(V,I,A,B,F,E,Y,H,c){var b=L*V;m[b]=I,m[b+1]=A,m[b+2]=B,m[b+3]=F,m[b+4]=E,m[b+5]=Y;var X=z*V;s[X]=H,s[X+1]=c}function S(V,I,A,B,F,E,Y,H,c,b,X){var P=2*V,J=c*P,G=b[J+I];V:for(var w=F,t=F*P;w<E;++w,t+=P){var u=Y[t+I],W=Y[t+I+V];if(!(G<u||W<G)&&(!B||G!==u)){for(var g,o=H[w],L=I+1;L<V;++L){u=Y[t+L],W=Y[t+L+V];var z=b[J+L],m=b[J+L+V];if(W<z||m<u)continue V}if(void 0!==(g=B?A(X,o):A(o,X)))return g}}}function Q(V,I,A,B,F,E,Y,H,c,b){var X=2*V,P=H*X,J=c[P+I];V:for(var G=B,w=B*X;G<F;++G,w+=X){var t=Y[G];if(t!==b){var u=E[w+I],W=E[w+I+V];if(!(J<u||W<J)){for(var g=I+1;g<V;++g){u=E[w+g],W=E[w+g+V];var o=c[P+g],L=c[P+g+V];if(W<o||L<u)continue V}var z=A(t,b);if(void 0!==z)return z}}}}},13263:(V,I,A)=>{"use strict";V.exports=function(V,I,A,Y,H,c){if(Y<=A+1)return A;var b=A,X=Y,P=Y+A>>>1,J=2*V,G=P,w=H[J*P+I];for(;b<X;){if(X-b<F){E(V,I,b,X,H,c),w=H[J*P+I];break}var t=X-b,u=Math.random()*t+b|0,W=H[J*u+I],g=Math.random()*t+b|0,o=H[J*g+I],L=Math.random()*t+b|0,z=H[J*L+I];W<=o?z>=o?(G=g,w=o):W>=z?(G=u,w=W):(G=L,w=z):o>=z?(G=g,w=o):z>=W?(G=u,w=W):(G=L,w=z);for(var m=J*(X-1),s=J*G,e=0;e<J;++e,++m,++s){var S=H[m];H[m]=H[s],H[s]=S}var Q=c[X-1];c[X-1]=c[G],c[G]=Q;for(m=J*(X-1),s=J*(G=B(V,I,b,X-1,H,c,w)),e=0;e<J;++e,++m,++s){S=H[m];H[m]=H[s],H[s]=S}Q=c[X-1];if(c[X-1]=c[G],c[G]=Q,P<G){for(X=G-1;b<X&&H[J*(X-1)+I]===w;)X-=1;X+=1}else{if(!(G<P))break;for(b=G+1;b<X&&H[J*b+I]===w;)b+=1}}return B(V,I,A,P,H,c,H[J*P+I])};var B=A(13266)("lo<p0",["p0"]),F=8;function E(V,I,A,B,F,E){for(var Y=2*V,H=Y*(A+1)+I,c=A+1;c<B;++c,H+=Y)for(var b=F[H],X=c,P=Y*(c-1);X>A&&F[P+I]>b;--X,P-=Y){for(var J=P,G=P+Y,w=0;w<Y;++w,++J,++G){var t=F[J];F[J]=F[G],F[G]=t}var u=E[X];E[X]=E[X-1],E[X-1]=u}}},13266:V=>{"use strict";V.exports=function(V,A){var B="abcdef".split("").concat(A),F=[];V.indexOf("lo")>=0&&F.push("lo=e[k+n]");V.indexOf("hi")>=0&&F.push("hi=e[k+o]");return B.push(I.replace("_",F.join()).replace("$",V)),Function.apply(void 0,B)};var I="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13254:V=>{"use strict";V.exports=function(V,B){B<=4*I?A(0,B-1,V):b(0,B-1,V)};var I=32;function A(V,I,A){for(var B=2*(V+1),F=V+1;F<=I;++F){for(var E=A[B++],Y=A[B++],H=F,c=B-2;H-- >V;){var b=A[c-2],X=A[c-1];if(b<E)break;if(b===E&&X<Y)break;A[c]=b,A[c+1]=X,c-=2}A[c]=E,A[c+1]=Y}}function B(V,I,A){I*=2;var B=A[V*=2],F=A[V+1];A[V]=A[I],A[V+1]=A[I+1],A[I]=B,A[I+1]=F}function F(V,I,A){I*=2,A[V*=2]=A[I],A[V+1]=A[I+1]}function E(V,I,A,B){I*=2,A*=2;var F=B[V*=2],E=B[V+1];B[V]=B[I],B[V+1]=B[I+1],B[I]=B[A],B[I+1]=B[A+1],B[A]=F,B[A+1]=E}function Y(V,I,A,B,F){I*=2,F[V*=2]=F[I],F[I]=A,F[V+1]=F[I+1],F[I+1]=B}function H(V,I,A){I*=2;var B=A[V*=2],F=A[I];return!(B<F)&&(B!==F||A[V+1]>A[I+1])}function c(V,I,A,B){var F=B[V*=2];return F<I||F===I&&B[V+1]<A}function b(V,X,P){var J=(X-V+1)/6|0,G=V+J,w=X-J,t=V+X>>1,u=t-J,W=t+J,g=G,o=u,L=t,z=W,m=w,s=V+1,e=X-1,S=0;H(g,o,P)&&(S=g,g=o,o=S),H(z,m,P)&&(S=z,z=m,m=S),H(g,L,P)&&(S=g,g=L,L=S),H(o,L,P)&&(S=o,o=L,L=S),H(g,z,P)&&(S=g,g=z,z=S),H(L,z,P)&&(S=L,L=z,z=S),H(o,m,P)&&(S=o,o=m,m=S),H(o,L,P)&&(S=o,o=L,L=S),H(z,m,P)&&(S=z,z=m,m=S);for(var Q=P[2*o],h=P[2*o+1],r=P[2*z],M=P[2*z+1],x=2*g,f=2*L,R=2*m,q=2*G,N=2*t,l=2*w,i=0;i<2;++i){var y=P[x+i],v=P[f+i],C=P[R+i];P[q+i]=y,P[N+i]=v,P[l+i]=C}F(u,V,P),F(W,X,P);for(var K=s;K<=e;++K)if(c(K,Q,h,P))K!==s&&B(K,s,P),++s;else if(!c(K,r,M,P))for(;;){if(c(e,r,M,P)){c(e,Q,h,P)?(E(K,s,e,P),++s,--e):(B(K,e,P),--e);break}if(--e<K)break}Y(V,s-1,Q,h,P),Y(X,e+1,r,M,P),s-2-V<=I?A(V,s-2,P):b(V,s-2,P),X-(e+2)<=I?A(e+2,X,P):b(e+2,X,P),e-s<=I?A(s,e,P):b(s,e,P)}},13249:(V,I,A)=>{"use strict";V.exports={init:function(V){var I=F.nextPow2(V);c.length<I&&(B.free(c),c=B.mallocInt32(I));b.length<I&&(B.free(b),b=B.mallocInt32(I));X.length<I&&(B.free(X),X=B.mallocInt32(I));P.length<I&&(B.free(P),P=B.mallocInt32(I));J.length<I&&(B.free(J),J=B.mallocInt32(I));G.length<I&&(B.free(G),G=B.mallocInt32(I));var A=8*I;w.length<A&&(B.free(w),w=B.mallocDouble(A))},sweepBipartite:function(V,I,A,B,F,H,J,G,W,g){for(var o=0,L=2*V,z=V-1,m=L-1,s=A;s<B;++s){var e=H[s],S=L*s;w[o++]=F[S+z],w[o++]=-(e+1),w[o++]=F[S+m],w[o++]=e}for(s=J;s<G;++s){e=g[s]+Y;var Q=L*s;w[o++]=W[Q+z],w[o++]=-e,w[o++]=W[Q+m],w[o++]=e}var h=o>>>1;E(w,h);var r=0,M=0;for(s=0;s<h;++s){var x=0|w[2*s+1];if(x>=Y)t(X,P,M--,x=x-Y|0);else if(x>=0)t(c,b,r--,x);else if(x<=-Y){x=-x-Y|0;for(var f=0;f<r;++f){if(void 0!==(R=I(c[f],x)))return R}u(X,P,M++,x)}else{x=-x-1|0;for(f=0;f<M;++f){var R;if(void 0!==(R=I(x,X[f])))return R}u(c,b,r++,x)}}},sweepComplete:function(V,I,A,B,F,Y,H,W,g,o){for(var L=0,z=2*V,m=V-1,s=z-1,e=A;e<B;++e){var S=Y[e]+1<<1,Q=z*e;w[L++]=F[Q+m],w[L++]=-S,w[L++]=F[Q+s],w[L++]=S}for(e=H;e<W;++e){S=o[e]+1<<1;var h=z*e;w[L++]=g[h+m],w[L++]=1|-S,w[L++]=g[h+s],w[L++]=1|S}var r=L>>>1;E(w,r);var M=0,x=0,f=0;for(e=0;e<r;++e){var R=0|w[2*e+1],q=1&R;if(e<r-1&&R>>1===w[2*e+3]>>1&&(q=2,e+=1),R<0){for(var N=-(R>>1)-1,l=0;l<f;++l){if(void 0!==(i=I(J[l],N)))return i}if(0!==q)for(l=0;l<M;++l){if(void 0!==(i=I(c[l],N)))return i}if(1!==q)for(l=0;l<x;++l){var i;if(void 0!==(i=I(X[l],N)))return i}0===q?u(c,b,M++,N):1===q?u(X,P,x++,N):2===q&&u(J,G,f++,N)}else{N=(R>>1)-1;0===q?t(c,b,M--,N):1===q?t(X,P,x--,N):2===q&&t(J,G,f--,N)}}},scanBipartite:function(V,I,A,B,F,H,X,P,J,G,W,g){var o=0,L=2*V,z=I,m=I+V,s=1,e=1;B?e=Y:s=Y;for(var S=F;S<H;++S){var Q=S+s,h=L*S;w[o++]=X[h+z],w[o++]=-Q,w[o++]=X[h+m],w[o++]=Q}for(S=J;S<G;++S){Q=S+e;var r=L*S;w[o++]=W[r+z],w[o++]=-Q}var M=o>>>1;E(w,M);var x=0;for(S=0;S<M;++S){var f=0|w[2*S+1];if(f<0){var R=!1;if((Q=-f)>=Y?(R=!B,Q-=Y):(R=!!B,Q-=1),R)u(c,b,x++,Q);else{var q=g[Q],N=L*Q,l=W[N+I+1],i=W[N+I+1+V];V:for(var y=0;y<x;++y){var v=c[y],C=L*v;if(!(i<X[C+I+1]||X[C+I+1+V]<l)){for(var K=I+2;K<V;++K)if(W[N+K+V]<X[C+K]||X[C+K+V]<W[N+K])continue V;var p,j=P[v];if(void 0!==(p=B?A(q,j):A(j,q)))return p}}}}else t(c,b,x--,f-s)}},scanComplete:function(V,I,A,B,F,H,b,X,P,J,G){for(var t=0,u=2*V,W=I,g=I+V,o=B;o<F;++o){var L=o+Y,z=u*o;w[t++]=H[z+W],w[t++]=-L,w[t++]=H[z+g],w[t++]=L}for(o=X;o<P;++o){L=o+1;var m=u*o;w[t++]=J[m+W],w[t++]=-L}var s=t>>>1;E(w,s);var e=0;for(o=0;o<s;++o){var S=0|w[2*o+1];if(S<0){if((L=-S)>=Y)c[e++]=L-Y;else{var Q=G[L-=1],h=u*L,r=J[h+I+1],M=J[h+I+1+V];V:for(var x=0;x<e;++x){var f=c[x],R=b[f];if(R===Q)break;var q=u*f;if(!(M<H[q+I+1]||H[q+I+1+V]<r)){for(var N=I+2;N<V;++N)if(J[h+N+V]<H[q+N]||H[q+N+V]<J[h+N])continue V;var l=A(R,Q);if(void 0!==l)return l}}}}else{for(L=S-Y,x=e-1;x>=0;--x)if(c[x]===L){for(N=x+1;N<e;++N)c[N-1]=c[N];break}--e}}}};var B=A(13220),F=A(13228),E=A(13254),Y=1<<28,H=1024,c=B.mallocInt32(H),b=B.mallocInt32(H),X=B.mallocInt32(H),P=B.mallocInt32(H),J=B.mallocInt32(H),G=B.mallocInt32(H),w=B.mallocDouble(8192);function t(V,I,A,B){var F=I[B],E=V[A-1];V[F]=E,I[E]=F}function u(V,I,A,B){V[A]=B,I[B]=A}},13234:V=>{"use strict";function I(V,A,B){var F=0|V[B];if(F<=0)return[];var E,Y=new Array(F);if(B===V.length-1)for(E=0;E<F;++E)Y[E]=A;else for(E=0;E<F;++E)Y[E]=I(V,A,B+1);return Y}V.exports=function(V,A){switch("undefined"===typeof A&&(A=0),typeof V){case"number":if(V>0)return function(V,I){var A,B;for(A=new Array(V),B=0;B<V;++B)A[B]=I;return A}(0|V,A);break;case"object":if("number"===typeof V.length)return I(V,A,0)}return[]}},13188:(V,I,A)=>{V.exports=function(){var V=this;this.components={},this.comps=this.components;var I=this.components,A=1,F={},E=[],Y=[],H={timeout:!1,removals:[],multiComps:[]};function c(V,A){var B=I[A],E=F[A],Y=E.hash[V];Y&&(E.remove(V),B.pY&&(B.multi?(Y.forEach((I=>{I&&B.pY(V,I)})),Y.length=0):B.pY(V,Y)),H.removals.push(E),b())}function b(){H.timeout||(H.timeout=!0,setTimeout(X,1))}function X(){H.timeout=!1,P()}function P(){H.multiComps.length&&function(V){for(var I=0;I<V.length;I++){var{entID:A,data:B}=V[I],F=B.hash[A];if(F){for(var E=0;E<F.length;E++)F[E]||(F.splice(E,1),E--);0===F.length&&(B.remove(A),H.removals.push(B))}}V.length=0}(H.multiComps),H.removals.length&&function(V){for(var I=0;I<V.length;I++){V[I].flush()}V.length=0}(H.removals)}this.QJ=F,this._systems=E,this._renderSystems=Y,this.tP=function(I){var B=A++;return Array.isArray(I)&&I.forEach((I=>V.Db(B,I))),B},this.deleteEntity=function(I){return Object.keys(F).forEach((V=>{F[V].hash[I]&&c(I,V)})),V},this.xP=function(V){if(!V)throw new Error("Missing component definition");var A=V.name;if(!A)throw new Error("Component definition must have a name property.");if("string"!==typeof A)throw new Error("Component name must be a string.");if(""===A)throw new Error("Component name must be a non-empty string.");if(F[A])throw new Error(`Component ${A} already exists.`);var H={};return H.name=A,H.multi=!!V.multi,H.order=isNaN(V.order)?99:V.order,H.stateConstructor=V.stateConstructor||null,H.state=V.state||{},H.sH=V.sH||null,H.pY=V.pY||null,H.system=V.system||null,H.MH=V.MH||null,I[A]=H,F[A]=new B,F[A]._pendingMultiCleanup=!1,F[A]._multiCleanupIDs=H.multi?[]:null,H.system&&(E.push(A),E.sort(((V,A)=>I[V].order-I[A].order))),H.MH&&(Y.push(A),Y.sort(((V,A)=>I[V].order-I[A].order))),A},this.overwriteComponent=function(V,A){var B=I[V];if(!B)throw new Error(`Unknown component: ${V}`);if(!A)throw new Error("Missing component definition");if(B.name!==A.name)throw new Error("Overwriting component must use the same name property.");var H={};H.name=V,H.multi=!!A.multi,H.order=isNaN(A.order)?99:A.order,H.state=A.state||{},H.sH=A.sH||null,H.pY=A.pY||null,H.system=A.system||null,H.MH=A.MH||null,I[V]=H,F[V]._pendingMultiCleanup=!1,F[V]._multiCleanupIDs=H.multi?[]:null;var c=E.indexOf(V);H.system&&c<0&&E.push(V),!H.system&&c>=0&&E.splice(c,1),E.sort(((V,A)=>I[V].order-I[A].order));var b=Y.indexOf(V);H.MH&&b<0&&Y.push(V),!H.MH&&b>=0&&Y.splice(b,1),Y.sort(((V,A)=>I[V].order-I[A].order));var X=H.state;return this.kX(V).forEach((V=>{for(var I in X)I in V||(V[I]=X[I]);H.sH&&H.sH(V.hH,V)})),V},this.deleteComponent=function(A){var B=F[A];if(!B)throw new Error(`Unknown component: ${A}`);B.flush(),B.list.forEach((V=>{V&&c(V.hH||V[0].hH,A)}));var H=E.indexOf(A),b=Y.indexOf(A);return H>-1&&E.splice(H,1),b>-1&&Y.splice(b,1),F[A].dispose(),delete F[A],delete I[A],V},this.Db=function(V,A,B){var E,Y=I[A],H=F[A];if(!H)throw new Error(`Unknown component: ${A}.`);if(H.hash[V]&&!Y.multi)throw new Error(`Entity ${V} already has component: ${A}.`);if(Y.stateConstructor){if(!(E=new Y.stateConstructor).hasOwnProperty("hH"))throw new Error(`Component ${Y.name} stateConstructor type does not have property __id`)}else E=Object.assign({},{hH:V},Y.state,B);if(E.hH=V,Y.multi){var c=H.hash[V];c||(c=[],H.add(V,c)),c.push(E)}else H.add(V,E);return Y.sH&&Y.sH(V,E),this},this.bX=function(V,I){var A=F[I];if(!A)throw new Error(`Unknown component: ${I}.`);return!!A.hash[V]},this.BX=function(I,A){if(!F[A])throw new Error(`Unknown component: ${A}.`);return c(I,A),V},this.getState=function(V,I){var A=F[I];if(!A)throw new Error(`Unknown component: ${I}.`);return A.hash[V]},this.kX=function(V){var I=F[V];if(!I)throw new Error(`Unknown component: ${V}.`);return P(),I.list},this.tw=function(V){if(!F[V])throw new Error(`Unknown component: ${V}.`);var I=F[V].hash;return V=>I[V]},this.gw=function(V){if(!F[V])throw new Error(`Unknown component: ${V}.`);var I=F[V].hash;return V=>!!I[V]},this.KY=function(A){P();for(var B=0;B<E.length;B++){var Y=E[B],H=I[Y],c=F[Y];H.system(A,c.list),P()}return V},this.render=function(A){P();for(var B=0;B<Y.length;B++){var E=Y[B],H=I[E],c=F[E];H.MH(A,c.list),P()}return V},this.removeMultiComponent=function(A,B,E){var Y=I[B],c=F[B];if(!c)throw new Error(`Unknown component: ${B}.`);if(!Y.multi)throw new Error("removeMultiComponent called on non-multi component");return function(V,I,A,B){var F=A.hash[V];if(F){var E=F[B];E&&(F[B]=null,I.pY&&I.pY(V,E),H.multiComps.push({entID:V,data:A}),b())}}(A,Y,c,E),V}};var B=A(13192)},13192:V=>{function I(V,I){var A=V._map[I];if(delete V.hash[I],delete V._map[I],A===V.list.length-1)V.list.pop();else{var B=V.list.pop();if(V.list[A]=B,null===B||null===B[0]){var F=V.list.length;for(var E in V._map)if(V._map[E]===F)return void(V._map[E]=A)}else{var Y=B.hH||B[0].hH;V._map[Y]=A}}}V.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(V,I){if("number"===typeof this._map[V]){var A=this._map[V];this.hash[V]=I,this.list[A]=I}else this._map[V]=this.list.length,this.hash[V]=I,this.list.push(I)}remove(V){var I=this._map[V];this.hash[V]=null,this.list[I]=null,this._pendingRemovals.push(V)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var V=0;V<this._pendingRemovals.length;V++){var A=this._pendingRemovals[V];null===this.hash[A]&&I(this,A)}this._pendingRemovals.length=0}}},13145:V=>{"use strict";var I,A="object"===typeof Reflect?Reflect:null,B=function(V,I,A){return Function.prototype.apply.call(V,I,A)};I=A&&"function"===typeof A.ownKeys?A.ownKeys:Object.getOwnPropertySymbols?function(V){return Object.getOwnPropertyNames(V).concat(Object.getOwnPropertySymbols(V))}:function(V){return Object.getOwnPropertyNames(V)};var F=Number.isNaN||function(V){return V!==V};function E(){E.init.call(this)}V.exports=E,V.exports.once=function(V,I){return new Promise((function(A,B){function F(A){V.removeListener(I,E),B(A)}function E(){"function"===typeof V.removeListener&&V.removeListener("error",F),A([].slice.call(arguments))}t(V,I,E,{once:!0}),"error"!==I&&function(V,I,A){"function"===typeof V.on&&t(V,"error",I,A)}(V,F,{once:!0})}))},E.EventEmitter=E,E.prototype._events=void 0,E.prototype._eventsCount=0,E.prototype._maxListeners=void 0;var Y=10;function H(V){if("function"!==typeof V)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof V)}function c(V){return void 0===V._maxListeners?E.defaultMaxListeners:V._maxListeners}function b(V,I,A,B){var F,E,Y,b;if(H(A),void 0===(E=V._events)?(E=V._events=Object.create(null),V._eventsCount=0):(void 0!==E.newListener&&(V.emit("newListener",I,A.listener?A.listener:A),E=V._events),Y=E[I]),void 0===Y)Y=E[I]=A,++V._eventsCount;else if("function"===typeof Y?Y=E[I]=B?[A,Y]:[Y,A]:B?Y.unshift(A):Y.push(A),(F=c(V))>0&&Y.length>F&&!Y.warned){Y.warned=!0;var X=new Error("Possible EventEmitter memory leak detected. "+Y.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");X.name="MaxListenersExceededWarning",X.BI=V,X.type=I,X.count=Y.length,b=X,console&&console.warn&&console.warn(b)}return V}function X(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function P(V,I,A){var B={fired:!1,wrapFn:void 0,target:V,type:I,listener:A},F=X.bind(B);return F.listener=A,B.wrapFn=F,F}function J(V,I,A){var B=V._events;if(void 0===B)return[];var F=B[I];return void 0===F?[]:"function"===typeof F?A?[F.listener||F]:[F]:A?function(V){for(var I=new Array(V.length),A=0;A<I.length;++A)I[A]=V[A].listener||V[A];return I}(F):w(F,F.length)}function G(V){var I=this._events;if(void 0!==I){var A=I[V];if("function"===typeof A)return 1;if(void 0!==A)return A.length}return 0}function w(V,I){for(var A=new Array(I),B=0;B<I;++B)A[B]=V[B];return A}function t(V,I,A,B){if("function"===typeof V.on)B.once?V.once(I,A):V.on(I,A);else{if("function"!==typeof V.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof V);V.addEventListener(I,(function F(E){B.once&&V.removeEventListener(I,F),A(E)}))}}Object.defineProperty(E,"defaultMaxListeners",{enumerable:!0,get:function(){return Y},set:function(V){if("number"!==typeof V||V<0||F(V))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+V+".");Y=V}}),E.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},E.prototype.setMaxListeners=function(V){if("number"!==typeof V||V<0||F(V))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+V+".");return this._maxListeners=V,this},E.prototype.getMaxListeners=function(){return c(this)},E.prototype.emit=function(V){for(var I=[],A=1;A<arguments.length;A++)I.push(arguments[A]);var F="error"===V,E=this._events;if(void 0!==E)F=F&&void 0===E.error;else if(!F)return!1;if(F){var Y;if(I.length>0&&(Y=I[0]),Y instanceof Error)throw Y;var H=new Error("Unhandled error."+(Y?" ("+Y.message+")":""));throw H.context=Y,H}var c=E[V];if(void 0===c)return!1;if("function"===typeof c)B(c,this,I);else{var b=c.length,X=w(c,b);for(A=0;A<b;++A)B(X[A],this,I)}return!0},E.prototype.addListener=function(V,I){return b(this,V,I,!1)},E.prototype.on=E.prototype.addListener,E.prototype.prependListener=function(V,I){return b(this,V,I,!0)},E.prototype.once=function(V,I){return H(I),this.on(V,P(this,V,I)),this},E.prototype.prependOnceListener=function(V,I){return H(I),this.prependListener(V,P(this,V,I)),this},E.prototype.removeListener=function(V,I){var A,B,F,E,Y;if(H(I),void 0===(B=this._events))return this;if(void 0===(A=B[V]))return this;if(A===I||A.listener===I)0===--this._eventsCount?this._events=Object.create(null):(delete B[V],B.removeListener&&this.emit("removeListener",V,A.listener||I));else if("function"!==typeof A){for(F=-1,E=A.length-1;E>=0;E--)if(A[E]===I||A[E].listener===I){Y=A[E].listener,F=E;break}if(F<0)return this;0===F?A.shift():function(V,I){for(;I+1<V.length;I++)V[I]=V[I+1];V.pop()}(A,F),1===A.length&&(B[V]=A[0]),void 0!==B.removeListener&&this.emit("removeListener",V,Y||I)}return this},E.prototype.off=E.prototype.removeListener,E.prototype.FI=function(V){var I,A,B;if(void 0===(A=this._events))return this;if(void 0===A.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==A[V]&&(0===--this._eventsCount?this._events=Object.create(null):delete A[V]),this;if(0===arguments.length){var F,E=Object.keys(A);for(B=0;B<E.length;++B)"removeListener"!==(F=E[B])&&this.FI(F);return this.FI("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(I=A[V]))this.removeListener(V,I);else if(void 0!==I)for(B=I.length-1;B>=0;B--)this.removeListener(V,I[B]);return this},E.prototype.listeners=function(V){return J(this,V,!0)},E.prototype.rawListeners=function(V){return J(this,V,!1)},E.listenerCount=function(V,I){return"function"===typeof V.listenerCount?V.listenerCount(I):G.call(V,I)},E.prototype.listenerCount=G,E.prototype.eventNames=function(){return this._eventsCount>0?I(this._events):[]}},13428:V=>{"use strict";V.exports=function(V,I,A,B,F,E){var Y=+I[0],H=+I[1],c=+I[2],b=+A[0],X=+A[1],P=+A[2],J=Math.sqrt(b*b+X*X+P*P);if(0===J)throw new Error("Can't raycast along a zero vector");return function(V,I,A,B,F,E,Y,H,c,b){for(var X=0,P=Math.floor,J=0|P(I),G=0|P(A),w=0|P(B),t=F>0?1:-1,u=E>0?1:-1,W=Y>0?1:-1,g=Math.abs(1/F),o=Math.abs(1/E),L=Math.abs(1/Y),z=g<1/0?g*(t>0?J+1-I:I-J):1/0,m=o<1/0?o*(u>0?G+1-A:A-G):1/0,s=L<1/0?L*(W>0?w+1-B:B-w):1/0,e=-1;X<=H;){var S=V(J,G,w);if(S)return c&&(c[0]=I+X*F,c[1]=A+X*E,c[2]=B+X*Y),b&&(b[0]=b[1]=b[2]=0,0===e&&(b[0]=-t),1===e&&(b[1]=-u),2===e&&(b[2]=-W)),S;z<m?z<s?(J+=t,X=z,z+=g,e=0):(w+=W,X=s,s+=L,e=2):m<s?(G+=u,X=m,m+=o,e=1):(w+=W,X=s,s+=L,e=2)}return c&&(c[0]=I+X*F,c[1]=A+X*E,c[2]=B+X*Y),b&&(b[0]=b[1]=b[2]=0),0}(V,Y,H,c,b/=J,X/=J,P/=J,B="undefined"===typeof B?64:+B,F,E)}},13463:(V,I,A)=>{"use strict";A.d(I,{c:()=>E});var B=A(13145);function F(){this.tG=!1,this.stopPropagation=!1,this.uG=!1,this.disabled=!1}class E{constructor(V,I){this.version="0.7.0";var A=Object.assign({},new F,I||{});this.element=V||document,this.tG=!!A.tG,this.stopPropagation=!!A.stopPropagation,this.uG=!!A.uG,this.disabled=!!A.disabled,this.filterEvents=(V,I)=>!0,this.down=new B.EventEmitter,this.up=new B.EventEmitter,this.state={},this.jX={dx:0,dy:0,Yw:0,pX:0,Hw:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?H(this):document.addEventListener("DOMContentLoaded",(V=>{H(this)}),{once:!0})}bind(V){for(var I=arguments.length,A=new Array(I>1?I-1:0),B=1;B<I;B++)A[B-1]=arguments[B];A.forEach((I=>{var A=this._keyBindmap[I]||[];A.includes(V)||(A.push(V),this._keyBindmap[I]=A)})),this.state[V]=!!this.state[V],this.pressCount[V]=this.pressCount[V]||0,this.releaseCount[V]=this.releaseCount[V]||0}unbind(V){for(var I in this._keyBindmap){var A=this._keyBindmap[I],B=A.indexOf(V);B>-1&&A.splice(B,1)}}getBindings(){var V={};for(var I in this._keyBindmap){this._keyBindmap[I].forEach((A=>{V[A]=V[A]||[],V[A].push(I)}))}return V}KY(){Y(this.jX),Y(this.pressCount),Y(this.releaseCount)}}function Y(V){for(var I in V)V[I]=0}function H(V){window.addEventListener("keydown",w.bind(null,V,!0),!1),window.addEventListener("keyup",w.bind(null,V,!1),!1);var I={passive:!0};V.element.addEventListener("touchstart",P.bind(void 0,V),{passive:!1}),V.element.addEventListener("touchend",G.bind(void 0,V),I),V.element.addEventListener("mousedown",t.bind(null,V,!0),I),window.document.addEventListener("mouseup",t.bind(null,V,!1),I),V.element.addEventListener("touchmove",u.bind(null,V),I),V.element.addEventListener("mousemove",u.bind(null,V),I),window.PointerEvent,V.element.addEventListener("wheel",W.bind(null,V),I),V.element.addEventListener("contextmenu",g.bind(null,V),!1),window.addEventListener("blur",o.bind(null,V),!1)}var c=0,b=0,X=null;function P(V,I){I.preventDefault(),J(I)}function J(V){let I=!1;for(let A=0;A<V.touches.length;++A)if(V.touches[A].identifier===X){I=!0;break}if(!I){const I=V.changedTouches[0];c=I.clientX,b=I.clientY,X=I.identifier}}function G(V,I){for(var A=I.changedTouches,B=0;B<A.length;++B)A[B].identifier===X&&(X=null)}function w(V,I,A){L(A.code,I,V,A)}function t(V,I,A){if("pointerId"in A)if(I){if(null!==V._touches.currID)return;V._touches.currID=A.pointerId}else{if(V._touches.currID!==A.pointerId)return;V._touches.currID=null}return L("Mouse"+("button"in A?A.button+1:1),I,V,A),!1}function u(V,I){var A=I.movementX||I.mozMovementX||0,B=I.movementY||I.mozMovementY||0;if(I.touches&&0===(A|B)){var F=function(V){J(V);for(let I=0;I<V.changedTouches.length;++I)if(V.changedTouches[I].identifier==X){const A=V.changedTouches[I],B=[A.clientX-c,A.clientY-b];return c=A.clientX,b=A.clientY,B}return console.error(`Did not find touch id ${X}`),[0,0]}(I);A=F[0],B=F[1]}V.jX.dx+=A,V.jX.dy+=B}function W(V,I){var A=1;switch(I.deltaMode){case 0:A=1;break;case 1:A=12;break;case 2:A=V.element.clientHeight||window.innerHeight}V.jX.Yw+=(I.deltaX||0)*A,V.jX.pX+=(I.deltaY||0)*A,V.jX.Hw+=(I.deltaZ||0)*A}function g(V,I){if(!V.uG)return I.preventDefault(),!1}function o(V){for(var I in V._keyStates)V._keyStates[I]&&(/^Mouse\d/.test(I)||L(I,!1,V,{code:I,note:"79rfxii2p96",preventDefault:()=>{},stopPropagation:()=>{}}))}function L(V,I,A,B){var F=A._keyBindmap[V];F&&(z(A._keyStates[V],I)&&(A._keyStates[V]=I,F.forEach((V=>{(!A.filterEvents||A.filterEvents(B,V))&&function(V,I,A,B){var F=I?A.pressCount:A.releaseCount;F[V]=(F[V]||0)+1;var E=A._bindPressCount[V]||0;(E+=I?1:-1)<0&&(E=0);A._bindPressCount[V]=E;var Y=A.state[V];if(z(Y,E)){A.state[V]=E>0;var H=I?A.down:A.up;A.disabled||H.emit(V,B)}}(V,I,A,B)}))),"button"in B||(A.tG&&!B.defaultPrevented&&B.preventDefault(),A.stopPropagation&&B.stopPropagation()))}function z(V,I){return V?!I:I}},12152:V=>{V.exports=function(V,I,A){return V[0]=I[0]+A[0],V[1]=I[1]+A[1],V[2]=I[2]+A[2],V}},12094:(V,I,A)=>{V.exports=function(V,I){var A=B(V[0],V[1],V[2]),Y=B(I[0],I[1],I[2]);F(A,A),F(Y,Y);var H=E(A,Y);return H>1?0:Math.acos(H)};var B=A(12103),F=A(12106),E=A(12114)},12211:V=>{V.exports=function(V,I){return V[0]=Math.ceil(I[0]),V[1]=Math.ceil(I[1]),V[2]=Math.ceil(I[2]),V}},12091:V=>{V.exports=function(V){var I=new Float32Array(3);return I[0]=V[0],I[1]=V[1],I[2]=V[2],I}},12122:V=>{V.exports=function(V,I){return V[0]=I[0],V[1]=I[1],V[2]=I[2],V}},12088:V=>{V.exports=function(){var V=new Float32Array(3);return V[0]=0,V[1]=0,V[2]=0,V}},12294:V=>{V.exports=function(V,I,A){var B=I[0],F=I[1],E=I[2],Y=A[0],H=A[1],c=A[2];return V[0]=F*c-E*H,V[1]=E*Y-B*c,V[2]=B*H-F*Y,V}},12242:(V,I,A)=>{V.exports=A(12238)},12238:V=>{V.exports=function(V,I){var A=I[0]-V[0],B=I[1]-V[1],F=I[2]-V[2];return Math.sqrt(A*A+B*B+F*F)}},12187:(V,I,A)=>{V.exports=A(12180)},12180:V=>{V.exports=function(V,I,A){return V[0]=I[0]/A[0],V[1]=I[1]/A[1],V[2]=I[2]/A[2],V}},12114:V=>{V.exports=function(V,I){return V[0]*I[0]+V[1]*I[1]+V[2]*I[2]}},12079:V=>{V.exports=1e-6},12137:(V,I,A)=>{V.exports=function(V,I){var A=V[0],F=V[1],E=V[2],Y=I[0],H=I[1],c=I[2];return Math.abs(A-Y)<=B*Math.max(1,Math.abs(A),Math.abs(Y))&&Math.abs(F-H)<=B*Math.max(1,Math.abs(F),Math.abs(H))&&Math.abs(E-c)<=B*Math.max(1,Math.abs(E),Math.abs(c))};var B=A(12079)},12143:V=>{V.exports=function(V,I){return V[0]===I[0]&&V[1]===I[1]&&V[2]===I[2]}},12202:V=>{V.exports=function(V,I){return V[0]=Math.floor(I[0]),V[1]=Math.floor(I[1]),V[2]=Math.floor(I[2]),V}},12345:(V,I,A)=>{V.exports=function(V,I,A,F,E,Y){var H,c;I||(I=3);A||(A=0);c=F?Math.min(F*I+A,V.length):V.length;for(H=A;H<c;H+=I)B[0]=V[H],B[1]=V[H+1],B[2]=V[H+2],E(B,B,Y),V[H]=B[0],V[H+1]=B[1],V[H+2]=B[2];return V};var B=A(12088)()},12103:V=>{V.exports=function(V,I,A){var B=new Float32Array(3);return B[0]=V,B[1]=I,B[2]=A,B}},12075:(V,I,A)=>{V.exports={EPSILON:A(12079),create:A(12088),clone:A(12091),angle:A(12094),fY:A(12103),k:A(12122),set:A(12129),equals:A(12137),exactEquals:A(12143),add:A(12152),uI:A(12155),sub:A(12162),multiply:A(12170),mul:A(12175),divide:A(12180),div:A(12187),min:A(12192),max:A(12196),floor:A(12202),ceil:A(12211),round:A(12216),scale:A(12225),RY:A(12233),distance:A(12238),i:A(12242),squaredDistance:A(12250),sqrDist:A(12258),length:A(12263),len:A(12266),squaredLength:A(12274),qY:A(12277),negate:A(12281),inverse:A(12289),normalize:A(12106),dot:A(12114),cross:A(12294),rY:A(12297),random:A(12304),transformMat4:A(12308),transformMat3:A(12317),transformQuat:A(12323),NY:A(12328),lY:A(12336),iY:A(12341),forEach:A(12345)}},12289:V=>{V.exports=function(V,I){return V[0]=1/I[0],V[1]=1/I[1],V[2]=1/I[2],V}},12266:(V,I,A)=>{V.exports=A(12263)},12263:V=>{V.exports=function(V){var I=V[0],A=V[1],B=V[2];return Math.sqrt(I*I+A*A+B*B)}},12297:V=>{V.exports=function(V,I,A,B){var F=I[0],E=I[1],Y=I[2];return V[0]=F+B*(A[0]-F),V[1]=E+B*(A[1]-E),V[2]=Y+B*(A[2]-Y),V}},12196:V=>{V.exports=function(V,I,A){return V[0]=Math.max(I[0],A[0]),V[1]=Math.max(I[1],A[1]),V[2]=Math.max(I[2],A[2]),V}},12192:V=>{V.exports=function(V,I,A){return V[0]=Math.min(I[0],A[0]),V[1]=Math.min(I[1],A[1]),V[2]=Math.min(I[2],A[2]),V}},12175:(V,I,A)=>{V.exports=A(12170)},12170:V=>{V.exports=function(V,I,A){return V[0]=I[0]*A[0],V[1]=I[1]*A[1],V[2]=I[2]*A[2],V}},12281:V=>{V.exports=function(V,I){return V[0]=-I[0],V[1]=-I[1],V[2]=-I[2],V}},12106:V=>{V.exports=function(V,I){var A=I[0],B=I[1],F=I[2],E=A*A+B*B+F*F;E>0&&(E=1/Math.sqrt(E),V[0]=I[0]*E,V[1]=I[1]*E,V[2]=I[2]*E);return V}},12304:V=>{V.exports=function(V,I){I=I||1;var A=2*Math.random()*Math.PI,B=2*Math.random()-1,F=Math.sqrt(1-B*B)*I;return V[0]=Math.cos(A)*F,V[1]=Math.sin(A)*F,V[2]=B*I,V}},12328:V=>{V.exports=function(V,I,A,B){var F=A[1],E=A[2],Y=I[1]-F,H=I[2]-E,c=Math.sin(B),b=Math.cos(B);return V[0]=I[0],V[1]=F+Y*b-H*c,V[2]=E+Y*c+H*b,V}},12336:V=>{V.exports=function(V,I,A,B){var F=A[0],E=A[2],Y=I[0]-F,H=I[2]-E,c=Math.sin(B),b=Math.cos(B);return V[0]=F+H*c+Y*b,V[1]=I[1],V[2]=E+H*b-Y*c,V}},12341:V=>{V.exports=function(V,I,A,B){var F=A[0],E=A[1],Y=I[0]-F,H=I[1]-E,c=Math.sin(B),b=Math.cos(B);return V[0]=F+Y*b-H*c,V[1]=E+Y*c+H*b,V[2]=I[2],V}},12216:V=>{V.exports=function(V,I){return V[0]=Math.round(I[0]),V[1]=Math.round(I[1]),V[2]=Math.round(I[2]),V}},12225:V=>{V.exports=function(V,I,A){return V[0]=I[0]*A,V[1]=I[1]*A,V[2]=I[2]*A,V}},12233:V=>{V.exports=function(V,I,A,B){return V[0]=I[0]+A[0]*B,V[1]=I[1]+A[1]*B,V[2]=I[2]+A[2]*B,V}},12129:V=>{V.exports=function(V,I,A,B){return V[0]=I,V[1]=A,V[2]=B,V}},12258:(V,I,A)=>{V.exports=A(12250)},12277:(V,I,A)=>{V.exports=A(12274)},12250:V=>{V.exports=function(V,I){var A=I[0]-V[0],B=I[1]-V[1],F=I[2]-V[2];return A*A+B*B+F*F}},12274:V=>{V.exports=function(V){var I=V[0],A=V[1],B=V[2];return I*I+A*A+B*B}},12162:(V,I,A)=>{V.exports=A(12155)},12155:V=>{V.exports=function(V,I,A){return V[0]=I[0]-A[0],V[1]=I[1]-A[1],V[2]=I[2]-A[2],V}},12317:V=>{V.exports=function(V,I,A){var B=I[0],F=I[1],E=I[2];return V[0]=B*A[0]+F*A[3]+E*A[6],V[1]=B*A[1]+F*A[4]+E*A[7],V[2]=B*A[2]+F*A[5]+E*A[8],V}},12308:V=>{V.exports=function(V,I,A){var B=I[0],F=I[1],E=I[2],Y=A[3]*B+A[7]*F+A[11]*E+A[15];return Y=Y||1,V[0]=(A[0]*B+A[4]*F+A[8]*E+A[12])/Y,V[1]=(A[1]*B+A[5]*F+A[9]*E+A[13])/Y,V[2]=(A[2]*B+A[6]*F+A[10]*E+A[14])/Y,V}},12323:V=>{V.exports=function(V,I,A){var B=I[0],F=I[1],E=I[2],Y=A[0],H=A[1],c=A[2],b=A[3],X=b*B+H*E-c*F,P=b*F+c*B-Y*E,J=b*E+Y*F-H*B,G=-Y*B-H*F-c*E;return V[0]=X*b+G*-Y+P*-c-J*-H,V[1]=P*b+G*-H+J*-Y-X*-c,V[2]=J*b+G*-c+X*-H-P*-Y,V}},13168:V=>{"use strict";V.exports=function(V){for(var I=new Array(V),A=0;A<V;++A)I[A]=A;return I}},13241:V=>{V.exports=function(V){return null!=V&&null!=V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}},13432:(V,I,A)=>{"use strict";A.d(I,{c:()=>B});class B{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.UP=!1,this.nP=!1,this.aP=30,this.kP=0,this.HJ=!1,this.fullscreen=!1,this.IJ=function(V){},this.AJ=function(){},this.EJ=function(){},this.jY=function(){},this.BJ=function(V){},this.onFullscreenChanged=function(V){},b((()=>{!function(V,I){V._nowObject=performance||Date,V._lastTick=0,V._renderAccum=0,V._rt=0,V._frameCB=H.bind(null,V),requestAnimationFrame(V._frameCB),I>0&&(V._intervalCB=Y.bind(null,V),V._interval=setInterval(V._intervalCB,Math.max(I,1e3/V.aP/2)))}(this,I),function(V,I){if(!I)return;var A=!1,B=!1;document.addEventListener("pointerlockchange",(B=>{A=document.pointerLockElement===I,V.BJ(A)})),document.addEventListener("fullscreenchange",(A=>{B=document.fullscreenElement===I,V.onFullscreenChanged(B)})),Object.defineProperty(V,"HJ",{get:()=>A,set:V=>{V&&!A?c(I):A&&!V&&function(V){V.exitPointerLock&&V.exitPointerLock()}(document)}}),Object.defineProperty(V,"fullscreen",{get:()=>B,set:V=>{V&&!B?I.requestFullscreen():B&&!V&&document.exitFullscreen()}}),I.addEventListener("click",(F=>{V.UP&&!A&&c(I),V.nP&&!B&&I.requestFullscreen()}));var F=()=>V.jY();if(window.ResizeObserver){new ResizeObserver(F).observe(I)}else window.addEventListener("resize",F)}(this,V),this.EJ()}))}}var F=3,E=20;function Y(V){for(var I=1e3/V.aP,A=V._nowObject.now()+E,B=0;V._nowObject.now()>=V._lastTick+I&&V._nowObject.now()<A&&++B<=F;)V.IJ(I),V._lastTick+=I;var Y=5*(I+5),H=V._nowObject.now();if(H-V._lastTick>Y)for(;H>=V._lastTick+I;)V._lastTick+=I}function H(V){requestAnimationFrame(V._frameCB),Y(V);var I=V._nowObject.now(),A=I-V._rt;if(V._rt=I,V.kP>0){V._renderAccum+=A;var B=1e3/V.kP;if(V._renderAccum<B)return;V._renderAccum=Math.min(V._renderAccum-B,B)}var F=1e3/V.aP,E=(I-V._lastTick)/F;V.AJ(A,E,F)}function c(V){V.requestPointerLock&&V.requestPointerLock()}var b=V=>{if("loading"===document.readyState){var I=()=>{document.removeEventListener("readystatechange",I),V()};document.addEventListener("readystatechange",I)}else setTimeout(V,1)}},13162:(V,I,A)=>{var B=A(13168),F=A(13176),E="undefined"!==typeof Float64Array;function Y(V,I){return V[0]-I[0]}function H(){var V,I=this.stride,A=new Array(I.length);for(V=0;V<A.length;++V)A[V]=[Math.abs(I[V]),V];A.sort(Y);var B=new Array(A.length);for(V=0;V<B.length;++V)B[V]=A[V][1];return B}function c(V,I){var A=["View",I,"d",V].join("");I<0&&(A="View_Nil"+V);var F="generic"===V;if(-1===I){var E="function "+A+"(a){this.data=a;};var proto="+A+".prototype;proto.dtype='"+V+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+A+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+A+"(a){return new "+A+"(a);}";return new Function(E)()}if(0===I){E="function "+A+"(a,d) {this.data = a;this.offset = d};var proto="+A+".prototype;proto.dtype='"+V+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+A+"_copy() {return new "+A+"(this.data,this.offset)};proto.pick=function "+A+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+A+"_get(){return "+(F?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+A+"_set(v){return "+(F?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+A+"(a,b,c,d){return new "+A+"(a,d)}";return new Function("TrivialArray",E)(b[V][0])}E=["'use strict'"];var Y=B(I),c=Y.map((function(V){return"i"+V})),X="this.offset+"+Y.map((function(V){return"this.stride["+V+"]*i"+V})).join("+"),P=Y.map((function(V){return"b"+V})).join(","),J=Y.map((function(V){return"c"+V})).join(",");E.push("function "+A+"(a,"+P+","+J+",d){this.data=a","this.shape=["+P+"]","this.stride=["+J+"]","this.offset=d|0}","var proto="+A+".prototype","proto.dtype='"+V+"'","proto.dimension="+I),E.push("Object.defineProperty(proto,'size',{get:function "+A+"_size(){return "+Y.map((function(V){return"this.shape["+V+"]"})).join("*"),"}})"),1===I?E.push("proto.order=[0]"):(E.push("Object.defineProperty(proto,'order',{get:"),I<4?(E.push("function "+A+"_order(){"),2===I?E.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===I&&E.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):E.push("ORDER})")),E.push("proto.set=function "+A+"_set("+c.join(",")+",v){"),F?E.push("return this.data.set("+X+",v)}"):E.push("return this.data["+X+"]=v}"),E.push("proto.get=function "+A+"_get("+c.join(",")+"){"),F?E.push("return this.data.get("+X+")}"):E.push("return this.data["+X+"]}"),E.push("proto.index=function "+A+"_index(",c.join(),"){return "+X+"}"),E.push("proto.hi=function "+A+"_hi("+c.join(",")+"){return new "+A+"(this.data,"+Y.map((function(V){return["(typeof i",V,"!=='number'||i",V,"<0)?this.shape[",V,"]:i",V,"|0"].join("")})).join(",")+","+Y.map((function(V){return"this.stride["+V+"]"})).join(",")+",this.offset)}");var G=Y.map((function(V){return"a"+V+"=this.shape["+V+"]"})),w=Y.map((function(V){return"c"+V+"=this.stride["+V+"]"}));E.push("proto.lo=function "+A+"_lo("+c.join(",")+"){var b=this.offset,d=0,"+G.join(",")+","+w.join(","));for(var t=0;t<I;++t)E.push("if(typeof i"+t+"==='number'&&i"+t+">=0){d=i"+t+"|0;b+=c"+t+"*d;a"+t+"-=d}");E.push("return new "+A+"(this.data,"+Y.map((function(V){return"a"+V})).join(",")+","+Y.map((function(V){return"c"+V})).join(",")+",b)}"),E.push("proto.step=function "+A+"_step("+c.join(",")+"){var "+Y.map((function(V){return"a"+V+"=this.shape["+V+"]"})).join(",")+","+Y.map((function(V){return"b"+V+"=this.stride["+V+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(t=0;t<I;++t)E.push("if(typeof i"+t+"==='number'){d=i"+t+"|0;if(d<0){c+=b"+t+"*(a"+t+"-1);a"+t+"=ceil(-a"+t+"/d)}else{a"+t+"=ceil(a"+t+"/d)}b"+t+"*=d}");E.push("return new "+A+"(this.data,"+Y.map((function(V){return"a"+V})).join(",")+","+Y.map((function(V){return"b"+V})).join(",")+",c)}");var u=new Array(I),W=new Array(I);for(t=0;t<I;++t)u[t]="a[i"+t+"]",W[t]="b[i"+t+"]";E.push("proto.transpose=function "+A+"_transpose("+c+"){"+c.map((function(V,I){return V+"=("+V+"===undefined?"+I+":"+V+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+A+"(this.data,"+u.join(",")+","+W.join(",")+",this.offset)}"),E.push("proto.pick=function "+A+"_pick("+c+"){var a=[],b=[],c=this.offset");for(t=0;t<I;++t)E.push("if(typeof i"+t+"==='number'&&i"+t+">=0){c=(c+this.stride["+t+"]*i"+t+")|0}else{a.push(this.shape["+t+"]);b.push(this.stride["+t+"])}");return E.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),E.push("return function construct_"+A+"(data,shape,stride,offset){return new "+A+"(data,"+Y.map((function(V){return"shape["+V+"]"})).join(",")+","+Y.map((function(V){return"stride["+V+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",E.join("\n"))(b[V],H)}var b={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};V.exports=function(V,I,A,B){if(void 0===V)return(0,b.array[0])([]);"number"===typeof V&&(V=[V]),void 0===I&&(I=[V.length]);var Y=I.length;if(void 0===A){A=new Array(Y);for(var H=Y-1,X=1;H>=0;--H)A[H]=X,X*=I[H]}if(void 0===B){B=0;for(H=0;H<Y;++H)A[H]<0&&(B-=(I[H]-1)*A[H])}for(var P=function(V){if(F(V))return"buffer";if(E)switch(Object.prototype.toString.call(V)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(V)?"array":"generic"}(V),J=b[P];J.length<=Y+1;)J.push(c(P,J.length-1));return(0,J[Y+1])(V,I,A,B)}},13176:V=>{function I(V){return!!V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}V.exports=function(V){return null!=V&&(I(V)||function(V){return"function"===typeof V.readFloatLE&&"function"===typeof V.slice&&I(V.slice(0,0))}(V)||!!V._isBuffer)}},13311:V=>{"use strict";var I=[],A=[],B=[],F=[],E=[],Y=[],H=[],c=[],b=[],X=[],P=[],J=[];V.exports=function(V,G,w,t,u,W){for(var g=H,o=b,L=X,z=J,m=0;m<3;m++)g[m]=+w[m],L[m]=+G.max[m],o[m]=+G.base[m];W||(W=1e-10);var s=function(V,H,b,X,J,G){var w=I,t=A,u=B,W=F,g=E,o=Y,L=c,z=Math.floor,m=0,s=0,e=0,S=0,Q=0;if(h(),0===e)return 0;for(S=x();s<=e;){if(r(S)&&M())return m;S=x()}for(m+=e,Q=0;Q<3;Q++)X[Q]+=b[Q],J[Q]+=b[Q];return m;function h(){if(s=0,0!==(e=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])))for(var V=0;V<3;V++){var I=b[V]>=0;W[V]=I?1:-1;var A=I?J[V]:X[V];w[V]=I?X[V]:J[V],t[V]=f(A,W[V]),u[V]=R(w[V],W[V]),L[V]=b[V]/e,g[V]=Math.abs(1/L[V]);var B=I?t[V]+1-A:A-t[V];o[V]=g[V]<1/0?g[V]*B:1/0}}function r(I){for(var A=W[0],B=0===I?t[0]:u[0],F=t[0]+A,E=W[1],Y=1===I?t[1]:u[1],H=t[1]+E,c=W[2],b=2===I?t[2]:u[2],X=t[2]+c,P=B;P!=F;P+=A)for(var J=Y;J!=H;J+=E)for(var G=b;G!=X;G+=c)if(V(P,J,G))return!0;return!1}function M(){m+=s;var V=W[S],I=s/e,A=P;for(Q=0;Q<3;Q++){var B=b[Q]*I;X[Q]+=B,J[Q]+=B,A[Q]=b[Q]-B}if(V>0?J[S]=Math.round(J[S]):X[S]=Math.round(X[S]),H(m,S,V,A))return!0;for(Q=0;Q<3;Q++)b[Q]=A[Q];return h(),0===e}function x(){var V=o[0]<o[1]?o[0]<o[2]?0:2:o[1]<o[2]?1:2,I=o[V]-s;for(s=o[V],t[V]+=W[V],o[V]+=g[V],Q=0;Q<3;Q++)w[Q]+=I*L[Q],u[Q]=R(w[Q],W[Q]);return V}function f(V,I){return z(V-I*G)}function R(V,I){return z(V+I*G)}}(V,t,g,o,L,W);if(!u){for(m=0;m<3;m++)z[m]=w[m]>0?L[m]-G.max[m]:o[m]-G.base[m];G.translate(z)}return s}},13470:(V,I,A)=>{"use strict";A.d(I,{b:()=>P});var B=A(13308),F=A(12075);class E{constructor(V,I,A,E,Y,H,c){this.aX=new B(V.base,V.JP),this.cB=I,this.friction=A,this.restitution=E,this.zY=Y,this.Qw=H,this.mY=!!c,this.PP=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.tt=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.eX=F.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=F.create(),this._impulses=F.create(),this._sleepFrameCount=10}loadFromCopy(V){F.k(this.aX.base,V.aX.base),F.k(this.aX.JP,V.aX.JP),F.k(this.aX.max,V.aX.max),this.aX.mag=V.aX.mag,this.cB=V.cB,this.friction=V.friction,this.restitution=V.restitution,this.zY=V.zY,this.Qw=V.Qw,this.mY=V.mY,this.PP=V.PP,this.fluidDrag=V.fluidDrag,this.tt=V.tt,this.preventFallOffEdge=V.preventFallOffEdge,this.rolledBackLastTick=V.rolledBackLastTick,F.k(this.eX,V.eX),F.k(this.resting,V.resting),this.inFluid=V.inFluid,this._ratioInFluid=V._ratioInFluid,F.k(this._forces,V._forces),F.k(this._impulses,V._impulses),this._sleepFrameCount=V._sleepFrameCount}setPosition(V){Y(V),F.uI(V,V,this.aX.base),this.aX.translate(V),this.hX()}TY(){return F.clone(this.aX.base)}applyForce(V){Y(V),F.add(this._forces,this._forces,V),this.hX()}applyImpulse(V){Y(V),F.add(this._impulses,this._impulses,V),this.hX()}hX(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Y=V=>{};var H=A(13308),c=A(12075),b=A(13311);function X(){this.PP=.1,this.fluidDrag=.4,this.hY=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function P(V,I,A){V=Object.assign(new X,V),this.gravity=V.gravity||[0,-10,0],this.PP=V.PP||.1,this.hY=V.hY||2,this.fluidDrag=V.fluidDrag||.4,this.minBounceImpulse=V.minBounceImpulse,this.bodies=[],this.aG=V.aG,this.testSolid=I,this.testFluid=A}P.prototype.Nw=function(V,I,A,B,F,Y){V=V||new H([0,0,0],[1,1,1]),"undefined"==typeof I&&(I=1),"undefined"==typeof A&&(A=1),"undefined"==typeof B&&(B=0),"undefined"==typeof F&&(F=1);var c=new E(V,I,A,B,F,Y);return this.bodies.push(c),c},P.prototype.lw=function(V){var I=this.bodies.indexOf(V);I<0||(this.bodies.splice(I,1),V.aX=V.Qw=null)};var J=c.create(),G=c.create(),w=c.create(),t=c.create(),u=c.create(),W=c.create(),g=c.create(),o=new H([0,0,0],[1,1,1]),L=new E(o,1,1,0,1,(()=>{}),!1);function z(V,I,A){return I=A,I*=1-(1-V.ratioInFluid)**2}P.prototype.KY=function(V){V/=1e3;var I=y(0,c.squaredLength(this.gravity));this.bodies.forEach((A=>function(V,I,A,B){c.k(u,I.resting),V.aG&&L.loadFromCopy(I);if(I.cB<=0)return c.set(I.eX,0,0,0),c.set(I._forces,0,0,0),void c.set(I._impulses,0,0,0);var F=B||0===I.zY;if(function(V,I,A,B){if(I._sleepFrameCount>0)return!1;if(B)return!0;var F=!1,E=.5*A*A*I.zY;return c.scale(i,V.gravity,E),b(V.testSolid,I.aX,i,(function(){return F=!0,!0}),!0),F}(V,I,A,F))return;I._sleepFrameCount--,function(V,I){var A=I.aX,B=Math.floor(A.base[0]),F=Math.floor(A.base[2]),E=Math.floor(A.base[1]),Y=Math.floor(A.max[1]);if(!V.testFluid(B,E,F))return I.inFluid=!1,void(I.ratioInFluid=0);var H=1,b=E+1;for(;b<=Y&&V.testFluid(B,b,F);)H++,b++;var X=(E+H-A.base[1])/A.JP[1];X>1&&(X=1);var P=A.JP[0]*A.JP[1]*A.JP[2]*X,J=s;c.scale(J,V.gravity,-V.hY*P*I.zY),I.applyForce(J),I.inFluid=!0,I.ratioInFluid=X}(V,I),C(I._forces),C(I._impulses),C(I.eX),C(I.resting),c.scale(J,I._forces,1/I.cB),c.RY(J,J,V.gravity,I.zY),c.scale(G,I._impulses,1/I.cB),c.RY(G,G,J,A),c.add(I.eX,I.eX,G),I.friction&&(e(V,0,I,G,A),e(V,1,I,G,A),e(V,2,I,G,A));var E=I.fluidDrag>=0?I.fluidDrag:V.fluidDrag,Y=I.PP>=0?I.PP:V.PP,H=Y,X=Y;I.inFluid&&(H=z(I,H,I.fluidDragHoriz>=0?I.fluidDragHoriz:E),X=z(I,X,I.fluidDragVert>=0?I.fluidDragVert:E));H=Math.max(1-H*A/I.cB,0),X=Math.max(1-X*A/I.cB,0),c.set(m,H,X,H),c.multiply(I.eX,I.eX,m),c.scale(w,I.eX,A),c.set(I._forces,0,0,0),c.set(I._impulses,0,0,0),I.mY&&v(h,I.aX);c.k(W,w),c.set(g,0,0,0),I.preventFallOffEdge&&function(V,I,A,B){if(!I.resting[1]||A[1]>0)return;var F=q;v(F,I.aX);for(var E=0;E<3;E+=2){c.set(R,0,0,0),R[E]=A[E];var Y=!0;(Y=(Y=(Y=(Y=Y&&!l(V,F.base[0]+R[0]+1e-5,F.base[1],F.base[2]+R[2]+1e-5))&&!l(V,F.max[0]+R[0]-1e-5,F.base[1],F.base[2]+R[2]+1e-5))&&!l(V,F.base[0]+R[0]+1e-5,F.base[1],F.max[2]+R[2]-1e-5))&&!l(V,F.max[0]+R[0]-1e-5,F.base[1],F.max[2]+R[2]-1e-5))?(B[E]=A[E]>0?1:-1,A[E]=0):0===E&&(c.set(N,A[0],0,0),Q(V,F,N,B,I.slideOnCollision))}}(V,I,w,g);Q(V,I.aX,w,I.resting,I.slideOnCollision),I.mY&&function(V,I,A,B){if(I.resting[1]>=0&&!I.inFluid)return;var F=0!==I.resting[0],E=0!==I.resting[2];if(!F&&!E)return;var Y=Math.abs(B[0]/B[2]),H=4;if(!F&&Y>H)return;if(!E&&Y<1/H)return;c.add(M,A.base,B);var X=V.testSolid;b(X,A,B,(function(V,I,A,B){if(1!==I)return!0;B[I]=0}));var P=A.base[1],J=I.inFluid?1.951:1.001,G=Math.floor(P+J)-P;c.set(x,0,G,0);var w=!1;if(b(X,A,x,(function(V,I,A,B){return w=!0,!0})),w)return;c.uI(f,M,A.base),f[1]=0,Q(V,A,f,r,!0);var t=y(A.base[0],M[0]),u=y(A.base[2],M[2]);if(F&&!t&&(!u||!E))return;if(E&&(!t||!F)&&!u)return;var W=!0;if(W=W&&!l(V,A.base[0]+1e-5,A.base[1],A.base[2]+1e-5),W=W&&!l(V,A.max[0]-1e-5,A.base[1],A.base[2]+1e-5),W=W&&!l(V,A.base[0]+1e-5,A.base[1],A.max[2]-1e-5),W=W&&!l(V,A.max[0]-1e-5,A.base[1],A.max[2]-1e-5),W)return;v(I.aX,A),I.resting[0]=r[0],I.resting[2]=r[2],I.tt&&I.tt()}(V,I,h,W);for(var P=0;P<3;++P)I.resting[P]=I.resting[P]||g[P],t[P]=0,I.resting[P]&&(u[P]||(t[P]=-I.eX[P]),I.eX[P]=0);var o=c.length(t);o>.001&&(c.scale(t,t,I.cB),I.Qw&&I.Qw(t),I.restitution>0&&o>V.minBounceImpulse&&(c.scale(t,t,I.restitution),I.applyImpulse(t)));var S=c.squaredLength(I.eX);S>1e-5&&I.hX();V.aG&&V.aG(I)?(I.loadFromCopy(L),I.rolledBackLastTick=!0):I.rolledBackLastTick=!1}(this,A,V,I)))};var m=c.create([0,0,0]);var s=c.create();function e(V,I,A,B,F){var E=A.resting[I],Y=B[I];if(!A.alwaysApplyHorizFriction||1!==I){if(0===E)return;if(E*Y<=0)return}c.k(S,A.eX),S[I]=0;var H=c.length(S);if(!y(H,0)){var b=Math.abs(A.friction*V.gravity[I]*F),X=H>b?(H-b)/H:0;A.eX[(I+1)%3]*=X,A.eX[(I+2)%3]*=X}}var S=c.create();function Q(V,I,A,B,F){return c.set(B,0,0,0),b(V.testSolid,I,A,(function(V,I,A,E){B[I]=A,E[I]=0,F||(E[0]=0,E[1]=0,E[2]=0)}))}var h=new H([],[]),r=c.create(),M=c.create(),x=c.create(),f=c.create();var R=c.create(),q=new H([],[]),N=c.create();function l(V,I,A,B){return V.testSolid(Math.floor(I),Math.floor(A-1),Math.floor(B))}var i=c.create();function y(V,I){return Math.abs(V-I)<1e-5}function v(V,I){for(var A=0;A<3;A++)V.base[A]=I.base[A],V.max[A]=I.max[A],V.JP[A]=I.JP[A]}var C=function(V){}},11938:function(V,I){!function(V){"use strict";var I=function(V,A){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,I){V.__proto__=I}||function(V,I){for(var A in I)Object.prototype.hasOwnProperty.call(I,A)&&(V[A]=I[A])},I(V,A)};function A(V,A){if("function"!==typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function B(){this.constructor=V}I(V,A),V.prototype=null===A?Object.create(A):(B.prototype=A.prototype,new B)}function B(V,I,A,B){var F,E=arguments.length,Y=E<3?I:null===B?B=Object.getOwnPropertyDescriptor(I,A):B;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Y=Reflect.decorate(V,I,A,B);else for(var H=V.length-1;H>=0;H--)(F=V[H])&&(Y=(E<3?F(Y):E>3?F(I,A,Y):F(I,A))||Y);return E>3&&Y&&Object.defineProperty(I,A,Y),Y}function F(V,I,A){if(A||2===arguments.length)for(var B,F=0,E=I.length;F<E;F++)!B&&F in I||(B||(B=Array.prototype.slice.call(I,0,F)),B[F]=I[F]);return V.concat(B||Array.prototype.slice.call(I))}var E,Y=255,H=213;V.OPERATION=void 0,(E=V.OPERATION||(V.OPERATION={}))[E.ADD=128]="ADD",E[E.REPLACE=0]="REPLACE",E[E.DELETE=64]="DELETE",E[E.DELETE_AND_ADD=192]="DELETE_AND_ADD",E[E.TOUCH=1]="TOUCH",E[E.CLEAR=10]="CLEAR";var c=function(){function I(V,I,A){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=V,this.setParent(I,A)}return I.prototype.setParent=function(V,I,A){var B=this;if(this.indexes||(this.indexes=this.ref instanceof fV?this.ref._definition.indexes:{}),this.parent=V,this.parentIndex=A,I)if(this.root=I,this.ref instanceof fV){var F=this.ref._definition;for(var E in F.schema){var Y=this.ref[E];if(Y&&Y.$changes){var H=F.indexes[E];Y.$changes.setParent(this.ref,I,H)}}}else"object"===typeof this.ref&&this.ref.forEach((function(V,I){if(V instanceof fV){var A=V.$changes,F=B.ref.$changes.indexes[I];A.setParent(B.ref,B.root,F)}}))},I.prototype.operation=function(V){this.changes.set(--this.currentCustomOperation,V)},I.prototype.change=function(I,A){void 0===A&&(A=V.OPERATION.ADD);var B="number"===typeof I?I:this.indexes[I];this.assertValidIndex(B,I);var F=this.changes.get(B);F&&F.op!==V.OPERATION.DELETE&&F.op!==V.OPERATION.TOUCH||this.changes.set(B,{op:F&&F.op===V.OPERATION.DELETE?V.OPERATION.DELETE_AND_ADD:A,index:B}),this.allChanges.add(B),this.changed=!0,this.touchParents()},I.prototype.touch=function(I){var A="number"===typeof I?I:this.indexes[I];this.assertValidIndex(A,I),this.changes.has(A)||this.changes.set(A,{op:V.OPERATION.TOUCH,index:A}),this.allChanges.add(A),this.touchParents()},I.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},I.prototype.getType=function(V){if(this.ref._definition)return(I=this.ref._definition).schema[I.fieldsByIndex[V]];var I,A=(I=this.parent._definition).schema[I.fieldsByIndex[this.parentIndex]];return Object.values(A)[0]},I.prototype.getChildrenFilter=function(){var V=this.parent._definition.childFilters;return V&&V[this.parentIndex]},I.prototype.getValue=function(V){return this.ref.getByIndex(V)},I.prototype.delete=function(I){var A="number"===typeof I?I:this.indexes[I];if(void 0!==A){var B=this.getValue(A);this.changes.set(A,{op:V.OPERATION.DELETE,index:A}),this.allChanges.delete(A),delete this.caches[A],B&&B.$changes&&(B.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(I," (").concat(A,")"))},I.prototype.discard=function(I,A){var B=this;void 0===I&&(I=!1),void 0===A&&(A=!1),this.ref instanceof fV||this.changes.forEach((function(I){if(I.op===V.OPERATION.DELETE){var A=B.ref.getIndex(I.index);delete B.indexes[A]}})),this.changes.clear(),this.changed=I,A&&this.allChanges.clear(),this.currentCustomOperation=0},I.prototype.discardAll=function(){var V=this;this.changes.forEach((function(I){var A=V.getValue(I.index);A&&A.$changes&&A.$changes.discardAll()})),this.discard()},I.prototype.cache=function(V,I){this.caches[V]=I},I.prototype.clone=function(){return new I(this.ref,this.parent,this.root)},I.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},I.prototype.assertValidIndex=function(V,I){if(void 0===V)throw new Error('ChangeTree: missing index for field "'.concat(I,'"'))},I}();function b(V,I,A,B){return V[I]||(V[I]=[]),V[I].push(A),null===B||void 0===B||B.forEach((function(V,I){return A(V,I)})),function(){return P(V[I],V[I].indexOf(A))}}function X(I){var A=this,B="string"!==typeof this.$changes.getType();this.$items.forEach((function(F,E){I.push({refId:A.$changes.refId,op:V.OPERATION.DELETE,field:E,value:void 0,previousValue:F}),B&&A.$changes.root.removeRef(F.$changes.refId)}))}function P(V,I){if(-1===I||I>=V.length)return!1;for(var A=V.length-1,B=I;B<A;B++)V[B]=V[B+1];return V.length=A,!0}var J=function(V,I){var A=V.toString(),B=I.toString();return A<B?-1:A>B?1:0};function G(V){return V.$proxy=!0,V=new Proxy(V,{get:function(V,I){return"symbol"===typeof I||isNaN(I)?V[I]:V.at(I)},set:function(V,I,A){if("symbol"===typeof I||isNaN(I))V[I]=A;else{var B=Array.from(V.$items.keys()),F=parseInt(B[I]||I);void 0===A||null===A?V.deleteAt(F):V.setAt(F,A)}return!0},deleteProperty:function(V,I){return"number"===typeof I?V.deleteAt(I):delete V[I],!0}})}var w=function(){function I(){for(var V=[],I=0;I<arguments.length;I++)V[I]=arguments[I];this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,V)}return I.prototype.sH=function(I,A){return void 0===A&&(A=!0),b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,I,A?this.$items:void 0)},I.prototype.pY=function(I){return b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,I)},I.is=function(V){return Array.isArray(V)||void 0!==V.array},Object.defineProperty(I.prototype,"length",{get:function(){return this.$items.size},set:function(V){0===V?this.clear():this.splice(V,this.length-V)},enumerable:!1,configurable:!0}),I.prototype.push=function(){for(var V,I=this,A=[],B=0;B<arguments.length;B++)A[B]=arguments[B];return A.forEach((function(A){V=I.$refId++,I.setAt(V,A)})),V},I.prototype.pop=function(){var V=Array.from(this.$indexes.values()).pop();if(void 0!==V){this.$changes.delete(V),this.$indexes.delete(V);var I=this.$items.get(V);return this.$items.delete(V),I}},I.prototype.at=function(V){var I=Array.from(this.$items.keys())[V];return this.$items.get(I)},I.prototype.setAt=function(I,A){var B,F;if(void 0!==A&&null!==A){if(this.$items.get(I)!==A){void 0!==A.$changes&&A.$changes.setParent(this,this.$changes.root,I);var E=null!==(F=null===(B=this.$changes.indexes[I])||void 0===B?void 0:B.op)&&void 0!==F?F:V.OPERATION.ADD;this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,A),this.$changes.change(I,E)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},I.prototype.deleteAt=function(V){var I=Array.from(this.$items.keys())[V];return void 0!==I&&this.$deleteAt(I)},I.prototype.$deleteAt=function(V){return this.$changes.delete(V),this.$indexes.delete(V),this.$items.delete(V)},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&X.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.concat=function(){for(var V,A=[],B=0;B<arguments.length;B++)A[B]=arguments[B];return new(I.bind.apply(I,F([void 0],(V=Array.from(this.$items.values())).concat.apply(V,A),!1)))},I.prototype.join=function(V){return Array.from(this.$items.values()).join(V)},I.prototype.reverse=function(){var V=this,I=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(A,B){V.setAt(I[B],A)})),this},I.prototype.shift=function(){var V=Array.from(this.$items.keys()).shift();if(void 0!==V){var I=this.$items.get(V);return this.$deleteAt(V),I}},I.prototype.slice=function(V,A){var B=new I;return B.push.apply(B,Array.from(this.$items.values()).slice(V,A)),B},I.prototype.sort=function(V){var I=this;void 0===V&&(V=J);var A=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(V).forEach((function(V,B){I.setAt(A[B],V)})),this},I.prototype.splice=function(V,I){void 0===I&&(I=this.length-V);for(var A=Array.from(this.$items.keys()),B=[],F=V;F<V+I;F++)B.push(this.$items.get(A[F])),this.$deleteAt(A[F]);return B},I.prototype.unshift=function(){for(var V=this,I=[],A=0;A<arguments.length;A++)I[A]=arguments[A];var B=this.length,F=I.length,E=Array.from(this.$items.values());return I.forEach((function(I,A){V.setAt(A,I)})),E.forEach((function(I,A){V.setAt(F+A,I)})),B+F},I.prototype.indexOf=function(V,I){return Array.from(this.$items.values()).indexOf(V,I)},I.prototype.lastIndexOf=function(V,I){return void 0===I&&(I=this.length-1),Array.from(this.$items.values()).lastIndexOf(V,I)},I.prototype.every=function(V,I){return Array.from(this.$items.values()).every(V,I)},I.prototype.some=function(V,I){return Array.from(this.$items.values()).some(V,I)},I.prototype.forEach=function(V,I){Array.from(this.$items.values()).forEach(V,I)},I.prototype.map=function(V,I){return Array.from(this.$items.values()).map(V,I)},I.prototype.filter=function(V,I){return Array.from(this.$items.values()).filter(V,I)},I.prototype.reduce=function(V,I){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},I.prototype.reduceRight=function(V,I){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},I.prototype.find=function(V,I){return Array.from(this.$items.values()).find(V,I)},I.prototype.findIndex=function(V,I){return Array.from(this.$items.values()).findIndex(V,I)},I.prototype.fill=function(V,I,A){throw new Error("ArraySchema#fill() not implemented")},I.prototype.copyWithin=function(V,I,A){throw new Error("ArraySchema#copyWithin() not implemented")},I.prototype.toString=function(){return this.$items.toString()},I.prototype.toLocaleString=function(){return this.$items.toLocaleString()},I.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(I,Symbol.species,{get:function(){return I},enumerable:!1,configurable:!0}),I.prototype.entries=function(){return this.$items.entries()},I.prototype.keys=function(){return this.$items.keys()},I.prototype.values=function(){return this.$items.values()},I.prototype.includes=function(V,I){return Array.from(this.$items.values()).includes(V,I)},I.prototype.flatMap=function(V,I){throw new Error("ArraySchema#flatMap() is not supported.")},I.prototype.flat=function(V){throw new Error("ArraySchema#flat() is not supported.")},I.prototype.findLast=function(){var V=Array.from(this.$items.values());return V.findLast.apply(V,arguments)},I.prototype.findLastIndex=function(){var V=Array.from(this.$items.values());return V.findLastIndex.apply(V,arguments)},I.prototype.setIndex=function(V,I){this.$indexes.set(V,I)},I.prototype.getIndex=function(V){return this.$indexes.get(V)},I.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},I.prototype.deleteByIndex=function(V){var I=this.$indexes.get(V);this.$items.delete(I),this.$indexes.delete(V)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){return this.toArray().map((function(V){return"function"===typeof V.toJSON?V.toJSON():V}))},I.prototype.clone=function(V){return V?new(I.bind.apply(I,F([void 0],Array.from(this.$items.values()),!1))):new(I.bind.apply(I,F([void 0],this.map((function(V){return V.$changes?V.clone():V})),!1)))},I}();function t(V){return V.$proxy=!0,V=new Proxy(V,{get:function(V,I){return"symbol"!==typeof I&&"undefined"===typeof V[I]?V.get(I):V[I]},set:function(V,I,A){return"symbol"!==typeof I&&-1===I.indexOf("$")&&"sH"!==I&&"pY"!==I&&"onChange"!==I?V.set(I,A):V[I]=A,!0},deleteProperty:function(V,I){return V.delete(I),!0}})}var u=function(){function I(V){var A=this;if(this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V)if(V instanceof Map||V instanceof I)V.forEach((function(V,I){return A.set(I,V)}));else for(var B in V)this.set(B,V[B])}return I.prototype.sH=function(I,A){return void 0===A&&(A=!0),b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,I,A?this.$items:void 0)},I.prototype.pY=function(I){return b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,I)},I.is=function(V){return void 0!==V.map},I.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(I.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(I,Symbol.species,{get:function(){return I},enumerable:!1,configurable:!0}),I.prototype.set=function(I,A){if(void 0===A||null===A)throw new Error("MapSchema#set('".concat(I,"', ").concat(A,"): trying to set ").concat(A," value on '").concat(I,"'."));I=I.toString();var B="undefined"!==typeof this.$changes.indexes[I],F=B?this.$changes.indexes[I]:this.$refId++,E=B?V.OPERATION.REPLACE:V.OPERATION.ADD,Y=void 0!==A.$changes;if(Y&&A.$changes.setParent(this,this.$changes.root,F),B){if(!Y&&this.$items.get(I)===A)return;Y&&this.$items.get(I)!==A&&(E=V.OPERATION.ADD)}else this.$changes.indexes[I]=F,this.$indexes.set(F,I);return this.$items.set(I,A),this.$changes.change(I,E),this},I.prototype.get=function(V){return this.$items.get(V)},I.prototype.delete=function(V){return this.$changes.delete(V),this.$items.delete(V)},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&X.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(V){return this.$items.has(V)},I.prototype.forEach=function(V){this.$items.forEach(V)},I.prototype.entries=function(){return this.$items.entries()},I.prototype.keys=function(){return this.$items.keys()},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(V,I){this.$indexes.set(V,I)},I.prototype.getIndex=function(V){return this.$indexes.get(V)},I.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},I.prototype.deleteByIndex=function(V){var I=this.$indexes.get(V);this.$items.delete(I),this.$indexes.delete(V)},I.prototype.toJSON=function(){var V={};return this.forEach((function(I,A){V[A]="function"===typeof I.toJSON?I.toJSON():I})),V},I.prototype.clone=function(V){var A;return V?A=Object.assign(new I,this):(A=new I,this.forEach((function(V,I){V.$changes?A.set(I,V.clone()):A.set(I,V)}))),A},I}(),W={};function g(V,I){W[V]=I}function o(V){return W[V]}var L=function(){function V(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return V.create=function(I){var A=new V;return A.schema=Object.assign({},I&&I.schema||{}),A.indexes=Object.assign({},I&&I.indexes||{}),A.fieldsByIndex=Object.assign({},I&&I.fieldsByIndex||{}),A.descriptors=Object.assign({},I&&I.descriptors||{}),A.deprecated=Object.assign({},I&&I.deprecated||{}),A},V.prototype.addField=function(V,I){var A=this.getNextFieldIndex();this.fieldsByIndex[A]=V,this.indexes[V]=A,this.schema[V]=Array.isArray(I)?{array:I[0]}:I},V.prototype.hasField=function(V){return void 0!==this.indexes[V]},V.prototype.addFilter=function(V,I){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[V]]=I,this.indexesWithFilters.push(this.indexes[V]),!0},V.prototype.addChildrenFilter=function(V,I){var A=this.indexes[V],B=this.schema[V];if(o(Object.keys(B)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[A]=I,!0;console.warn("@filterChildren: field '".concat(V,"' can't have children. Ignoring filter."))},V.prototype.getChildrenFilter=function(V){return this.childFilters&&this.childFilters[this.indexes[V]]},V.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},V}();function z(V){return V._context&&V._context.useFilters}var m=function(){function V(){this.types={},this.schemas=new Map,this.useFilters=!1}return V.prototype.has=function(V){return this.schemas.has(V)},V.prototype.get=function(V){return this.types[V]},V.prototype.add=function(V,I){void 0===I&&(I=this.schemas.size),V._definition=L.create(V._definition),V._typeid=I,this.types[I]=V,this.schemas.set(V,I)},V.create=function(I){return void 0===I&&(I={}),function(A){return I.context||(I.context=new V),e(A,I)}},V}(),s=new m;function e(V,I){return void 0===I&&(I={}),function(A,B){var E=I.context||s,Y=A.constructor;if(Y._context=E,!V)throw new Error("".concat(Y.name,': @type() reference provided for "').concat(B,"\" is undefined. Make sure you don't have any circular dependencies."));E.has(Y)||E.add(Y);var H=Y._definition;if(H.addField(B,V),H.descriptors[B]){if(H.deprecated[B])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(B,"' definition on '").concat(Y.name,"'.\nCheck @type() annotation"))}catch(W){var c=W.stack.split("\n")[4].trim();throw new Error("".concat(W.message," ").concat(c))}}var b=w.is(V),X=!b&&u.is(V);if("string"!==typeof V&&!fV.is(V)){var P=Object.values(V)[0];"string"===typeof P||E.has(P)||E.add(P)}if(I.manual)H.descriptors[B]={enumerable:!0,configurable:!0,writable:!0};else{var J="_".concat(B);H.descriptors[J]={enumerable:!1,configurable:!1,writable:!0},H.descriptors[B]={get:function(){return this[J]},set:function(V){V!==this[J]&&(void 0!==V&&null!==V?(!b||V instanceof w||(V=new(w.bind.apply(w,F([void 0],V,!1)))),!X||V instanceof u||(V=new u(V)),void 0===V.$proxy&&(X?V=t(V):b&&(V=G(V))),this.$changes.change(B),V.$changes&&V.$changes.setParent(this,this.$changes.root,this._definition.indexes[B])):this[J]&&this.$changes.delete(B),this[J]=V)},enumerable:!0,configurable:!0}}}}function S(V){return function(I,A){var B=I.constructor;B._definition.addFilter(A,V)&&(B._context.useFilters=!0)}}function Q(V){return function(I,A){var B=I.constructor;B._definition.addChildrenFilter(A,V)&&(B._context.useFilters=!0)}}function h(V){return void 0===V&&(V=!0),function(I,A){var B=I.constructor._definition;B.deprecated[A]=!0,V&&(B.descriptors[A]={get:function(){throw new Error("".concat(A," is deprecated."))},set:function(V){},enumerable:!1,configurable:!0})}}function r(V,I,A){for(var B in void 0===A&&(A={}),A.context||(A.context=V._context||A.context||s),I)e(I[B],A)(V.prototype,B);return V}function M(V){for(var I=0,A=0,B=0,F=V.length;B<F;B++)(I=V.charCodeAt(B))<128?A+=1:I<2048?A+=2:I<55296||I>=57344?A+=3:(B++,A+=4);return A}function x(V,I,A){for(var B=0,F=0,E=A.length;F<E;F++)(B=A.charCodeAt(F))<128?V[I++]=B:B<2048?(V[I++]=192|B>>6,V[I++]=128|63&B):B<55296||B>=57344?(V[I++]=224|B>>12,V[I++]=128|B>>6&63,V[I++]=128|63&B):(F++,B=65536+((1023&B)<<10|1023&A.charCodeAt(F)),V[I++]=240|B>>18,V[I++]=128|B>>12&63,V[I++]=128|B>>6&63,V[I++]=128|63&B)}function f(V,I){V.push(255&I)}function R(V,I){V.push(255&I)}function q(V,I){V.push(255&I),V.push(I>>8&255)}function N(V,I){V.push(255&I),V.push(I>>8&255)}function l(V,I){V.push(255&I),V.push(I>>8&255),V.push(I>>16&255),V.push(I>>24&255)}function i(V,I){var A=I>>24,B=I>>16,F=I>>8,E=I;V.push(255&E),V.push(255&F),V.push(255&B),V.push(255&A)}function y(V,I){var A=Math.floor(I/Math.pow(2,32));i(V,I>>>0),i(V,A)}function v(V,I){var A=I/Math.pow(2,32)|0;i(V,I>>>0),i(V,A)}function C(V,I){d(V,I)}function K(V,I){D(V,I)}var p=new Int32Array(2),j=new Float32Array(p.buffer),T=new Float64Array(p.buffer);function d(V,I){j[0]=I,l(V,p[0])}function D(V,I){T[0]=I,l(V,p[0]),l(V,p[1])}function O(V,I){return R(V,I?1:0)}function Z(V,I){I||(I="");var A=M(I),B=0;if(A<32)V.push(160|A),B=1;else if(A<256)V.push(217),R(V,A),B=2;else if(A<65536)V.push(218),N(V,A),B=3;else{if(!(A<4294967296))throw new Error("String too long");V.push(219),i(V,A),B=5}return x(V,V.length,I),B+A}function a(V,I){return isNaN(I)?a(V,0):isFinite(I)?I!==(0|I)?(V.push(203),D(V,I),9):I>=0?I<128?(R(V,I),1):I<256?(V.push(204),R(V,I),2):I<65536?(V.push(205),N(V,I),3):I<4294967296?(V.push(206),i(V,I),5):(V.push(207),v(V,I),9):I>=-32?(V.push(224|I+32),1):I>=-128?(V.push(208),f(V,I),2):I>=-32768?(V.push(209),q(V,I),3):I>=-2147483648?(V.push(210),l(V,I),5):(V.push(211),y(V,I),9):a(V,I>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var k=Object.freeze({__proto__:null,utf8Write:x,int8:f,uint8:R,int16:q,uint16:N,int32:l,uint32:i,int64:y,uint64:v,float32:C,float64:K,writeFloat32:d,writeFloat64:D,boolean:O,string:Z,number:a});function U(V,I,A){for(var B="",F=0,E=I,Y=I+A;E<Y;E++){var H=V[E];0!==(128&H)?192!==(224&H)?224!==(240&H)?240!==(248&H)?console.error("Invalid byte "+H.toString(16)):(F=(7&H)<<18|(63&V[++E])<<12|(63&V[++E])<<6|63&V[++E])>=65536?(F-=65536,B+=String.fromCharCode(55296+(F>>>10),56320+(1023&F))):B+=String.fromCharCode(F):B+=String.fromCharCode((15&H)<<12|(63&V[++E])<<6|63&V[++E]):B+=String.fromCharCode((31&H)<<6|63&V[++E]):B+=String.fromCharCode(H)}return B}function n(V,I){return VV(V,I)<<24>>24}function VV(V,I){return V[I.offset++]}function IV(V,I){return AV(V,I)<<16>>16}function AV(V,I){return V[I.offset++]|V[I.offset++]<<8}function BV(V,I){return V[I.offset++]|V[I.offset++]<<8|V[I.offset++]<<16|V[I.offset++]<<24}function FV(V,I){return BV(V,I)>>>0}function EV(V,I){return JV(V,I)}function YV(V,I){return GV(V,I)}function HV(V,I){var A=FV(V,I);return BV(V,I)*Math.pow(2,32)+A}function cV(V,I){var A=FV(V,I);return FV(V,I)*Math.pow(2,32)+A}var bV=new Int32Array(2),XV=new Float32Array(bV.buffer),PV=new Float64Array(bV.buffer);function JV(V,I){return bV[0]=BV(V,I),XV[0]}function GV(V,I){return bV[0]=BV(V,I),bV[1]=BV(V,I),PV[0]}function wV(V,I){return VV(V,I)>0}function tV(V,I){var A,B=V[I.offset++];B<192?A=31&B:217===B?A=VV(V,I):218===B?A=AV(V,I):219===B&&(A=FV(V,I));var F=U(V,I.offset,A);return I.offset+=A,F}function uV(V,I){var A=V[I.offset];return A<192&&A>160||217===A||218===A||219===A}function WV(V,I){var A=V[I.offset++];return A<128?A:202===A?JV(V,I):203===A?GV(V,I):204===A?VV(V,I):205===A?AV(V,I):206===A?FV(V,I):207===A?cV(V,I):208===A?n(V,I):209===A?IV(V,I):210===A?BV(V,I):211===A?HV(V,I):A>223?-1*(255-A+1):void 0}function gV(V,I){var A=V[I.offset];return A<128||A>=202&&A<=211}function oV(V,I){return V[I.offset]<160}function LV(V,I){return V[I.offset-1]===Y&&(V[I.offset]<128||V[I.offset]>=202&&V[I.offset]<=211)}var zV=Object.freeze({__proto__:null,int8:n,uint8:VV,int16:IV,uint16:AV,int32:BV,uint32:FV,float32:EV,float64:YV,int64:HV,uint64:cV,readFloat32:JV,readFloat64:GV,boolean:wV,string:tV,stringCheck:uV,number:WV,numberCheck:gV,arrayCheck:oV,switchStructureCheck:LV}),mV=function(){function I(V){var I=this;this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V&&V.forEach((function(V){return I.add(V)}))}return I.prototype.sH=function(I,A){return void 0===A&&(A=!0),b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,I,A?this.$items:void 0)},I.prototype.pY=function(I){return b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,I)},I.is=function(V){return void 0!==V.collection},I.prototype.add=function(V){var I=this.$refId++;return void 0!==V.$changes&&V.$changes.setParent(this,this.$changes.root,I),this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,V),this.$changes.change(I),I},I.prototype.at=function(V){var I=Array.from(this.$items.keys())[V];return this.$items.get(I)},I.prototype.entries=function(){return this.$items.entries()},I.prototype.delete=function(V){for(var I,A,B=this.$items.entries();(A=B.next())&&!A.done;)if(V===A.value[1]){I=A.value[0];break}return void 0!==I&&(this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I))},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&X.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(V){return Array.from(this.$items.values()).some((function(I){return I===V}))},I.prototype.forEach=function(V){var I=this;this.$items.forEach((function(A,B,F){return V(A,B,I)}))},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(V,I){this.$indexes.set(V,I)},I.prototype.getIndex=function(V){return this.$indexes.get(V)},I.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},I.prototype.deleteByIndex=function(V){var I=this.$indexes.get(V);this.$items.delete(I),this.$indexes.delete(V)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){var V=[];return this.forEach((function(I,A){V.push("function"===typeof I.toJSON?I.toJSON():I)})),V},I.prototype.clone=function(V){var A;return V?A=Object.assign(new I,this):(A=new I,this.forEach((function(V){V.$changes?A.add(V.clone()):A.add(V)}))),A},I}(),sV=function(){function I(V){var I=this;this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V&&V.forEach((function(V){return I.add(V)}))}return I.prototype.sH=function(I,A){return void 0===A&&(A=!0),b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,I,A?this.$items:void 0)},I.prototype.pY=function(I){return b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,I)},I.is=function(V){return void 0!==V.set},I.prototype.add=function(I){var A,B;if(this.has(I))return!1;var F=this.$refId++;void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,F);var E=null!==(B=null===(A=this.$changes.indexes[F])||void 0===A?void 0:A.op)&&void 0!==B?B:V.OPERATION.ADD;return this.$changes.indexes[F]=F,this.$indexes.set(F,F),this.$items.set(F,I),this.$changes.change(F,E),F},I.prototype.entries=function(){return this.$items.entries()},I.prototype.delete=function(V){for(var I,A,B=this.$items.entries();(A=B.next())&&!A.done;)if(V===A.value[1]){I=A.value[0];break}return void 0!==I&&(this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I))},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&X.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(V){for(var I,A=this.$items.values(),B=!1;(I=A.next())&&!I.done;)if(V===I.value){B=!0;break}return B},I.prototype.forEach=function(V){var I=this;this.$items.forEach((function(A,B,F){return V(A,B,I)}))},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(V,I){this.$indexes.set(V,I)},I.prototype.getIndex=function(V){return this.$indexes.get(V)},I.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},I.prototype.deleteByIndex=function(V){var I=this.$indexes.get(V);this.$items.delete(I),this.$indexes.delete(V)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){var V=[];return this.forEach((function(I,A){V.push("function"===typeof I.toJSON?I.toJSON():I)})),V},I.prototype.clone=function(V){var A;return V?A=Object.assign(new I,this):(A=new I,this.forEach((function(V){V.$changes?A.add(V.clone()):A.add(V)}))),A},I}(),eV=function(){function V(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return V.prototype.addRefId=function(V){this.refIds.has(V)||(this.refIds.add(V),this.containerIndexes.set(V,new Set))},V.get=function(I){return void 0===I.$filterState&&(I.$filterState=new V),I.$filterState},V}(),SV=function(){function V(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return V.prototype.getNextUniqueId=function(){return this.nextUniqueId++},V.prototype.addRef=function(V,I,A){void 0===A&&(A=!0),this.refs.set(V,I),A&&(this.refCounts[V]=(this.refCounts[V]||0)+1)},V.prototype.removeRef=function(V){this.refCounts[V]=this.refCounts[V]-1,this.deletedRefs.add(V)},V.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},V.prototype.garbageCollectDeletedRefs=function(){var V=this;this.deletedRefs.forEach((function(I){if(!(V.refCounts[I]>0)){var A=V.refs.get(I);if(A instanceof fV)for(var B in A._definition.schema)"string"!==typeof A._definition.schema[B]&&A[B]&&A[B].$changes&&V.removeRef(A[B].$changes.refId);else{var F=A.$changes.parent._definition,E=F.schema[F.fieldsByIndex[A.$changes.parentIndex]];"function"===typeof Object.values(E)[0]&&Array.from(A.values()).forEach((function(I){return V.removeRef(I.$changes.refId)}))}V.refs.delete(I),delete V.refCounts[I]}})),this.deletedRefs.clear()},V}(),QV=function(V){function I(){return null!==V&&V.apply(this,arguments)||this}return A(I,V),I}(Error);function hV(V,I,A,B){var F,E=!1;switch(I){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":F="number",isNaN(V)&&console.log('trying to encode "NaN" in '.concat(A.constructor.name,"#").concat(B));break;case"string":F="string",E=!0;break;case"boolean":return}if(typeof V!==F&&(!E||E&&null!==V)){var Y="'".concat(JSON.stringify(V),"'").concat(V&&V.constructor&&" (".concat(V.constructor.name,")")||"");throw new QV("a '".concat(F,"' was expected, but ").concat(Y," was provided in ").concat(A.constructor.name,"#").concat(B))}}function rV(V,I,A,B){if(!(V instanceof I))throw new QV("a '".concat(I.name,"' was expected, but '").concat(V.constructor.name,"' was provided in ").concat(A.constructor.name,"#").concat(B))}function MV(V,I,A,B,F){hV(A,V,B,F);var E=k[V];if(!E)throw new QV("a '".concat(V,"' was expected, but ").concat(A," was provided in ").concat(B.constructor.name,"#").concat(F));E(I,A)}function xV(V,I,A){return zV[V](I,A)}var fV=function(){function I(){for(var V=[],I=0;I<arguments.length;I++)V[I]=arguments[I];Object.defineProperties(this,{$changes:{value:new c(this,void 0,new SV),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var A=this._definition.descriptors;A&&Object.defineProperties(this,A),V[0]&&this.assign(V[0])}return I.onError=function(V){console.error(V)},I.is=function(V){return V._definition&&void 0!==V._definition.schema},I.prototype.onChange=function(I){return b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,I)},I.prototype.pY=function(I){return b(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,I)},I.prototype.assign=function(V){return Object.assign(this,V),this},Object.defineProperty(I.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),I.prototype.setDirty=function(V,I){this.$changes.change(V,I)},I.prototype.listen=function(V,I,A){var B=this;return void 0===A&&(A=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[V]||(this.$callbacks[V]=[]),this.$callbacks[V].push(I),A&&void 0!==this[V]&&I(this[V],void 0),function(){return P(B.$callbacks[V],B.$callbacks[V].indexOf(I))}},I.prototype.decode=function(A,B,F){var E;void 0===B&&(B={offset:0}),void 0===F&&(F=this);var H=[],c=this.$changes.root,b=A.length,X=0;for(c.refs.set(X,this);B.offset<b;){var P=A[B.offset++];if(P!=Y){var J=F.$changes,G=void 0!==F._definition,t=G?P>>6<<6:P;if(t!==V.OPERATION.CLEAR){var W=G?P%(t||255):WV(A,B),g=G?F._definition.fieldsByIndex[W]:"",L=J.getType(W),z=void 0,m=void 0,s=void 0;if(G?m=F["_".concat(g)]:(m=F.getByIndex(W),(t&V.OPERATION.ADD)===V.OPERATION.ADD?(s=F instanceof u?tV(A,B):W,F.setIndex(W,s)):s=F.getIndex(W)),(t&V.OPERATION.DELETE)===V.OPERATION.DELETE&&(t!==V.OPERATION.DELETE_AND_ADD&&F.deleteByIndex(W),m&&m.$changes&&c.removeRef(m.$changes.refId),z=null),void 0!==g){if(t===V.OPERATION.DELETE);else if(I.is(L)){var e=WV(A,B);if(z=c.refs.get(e),t!==V.OPERATION.REPLACE){var S=this.getSchemaType(A,B,L);z||((z=this.createTypeInstance(S)).$changes.refId=e,m&&(z.$callbacks=m.$callbacks,m.$changes.refId&&e!==m.$changes.refId&&c.removeRef(m.$changes.refId))),c.addRef(e,z,z!==m)}}else if("string"===typeof L)z=xV(L,A,B);else{var Q=o(Object.keys(L)[0]),h=WV(A,B),r=c.refs.has(h)?m||c.refs.get(h):new Q.constructor;if((z=r.clone(!0)).$changes.refId=h,m&&(z.$callbacks=m.$callbacks,m.$changes.refId&&h!==m.$changes.refId)){c.removeRef(m.$changes.refId);for(var M=m.entries(),x=void 0;(x=M.next())&&!x.done;){var f=(E=x.value)[0],R=E[1];H.push({refId:h,op:V.OPERATION.DELETE,field:f,value:void 0,previousValue:R})}}c.addRef(h,z,r!==m)}if(null!==z&&void 0!==z)if(z.$changes&&z.$changes.setParent(J.ref,J.root,W),F instanceof I)F[g]=z;else if(F instanceof u)f=s,F.$items.set(f,z),F.$changes.allChanges.add(W);else if(F instanceof w)F.setAt(W,z);else if(F instanceof mV){var q=F.add(z);F.setIndex(W,q)}else F instanceof sV&&!1!==(q=F.add(z))&&F.setIndex(W,q);m!==z&&H.push({refId:X,op:t,field:g,dynamicIndex:s,value:z,previousValue:m})}else{console.warn("@colyseus/schema: definition mismatch");for(var N={offset:B.offset};B.offset<b&&(!LV(A,B)||(N.offset=B.offset+1,!c.refs.has(WV(A,N))));)B.offset++}}else F.clear(H)}else{X=WV(A,B);var l=c.refs.get(X);if(!l)throw new Error('"refId" not found: '.concat(X));F=l}}return this._triggerChanges(H),c.garbageCollectDeletedRefs(),H},I.prototype.encode=function(A,B,F){void 0===A&&(A=!1),void 0===B&&(B=[]),void 0===F&&(F=!1);for(var E=this.$changes,H=new WeakSet,c=[E],b=1,X=0;X<b;X++){var P=c[X],J=P.ref,G=J instanceof I;P.ensureRefId(),H.add(P),P!==E&&(P.changed||A)&&(R(B,Y),a(B,P.refId));for(var w=A?Array.from(P.allChanges):Array.from(P.changes.values()),t=0,W=w.length;t<W;t++){var g=A?{op:V.OPERATION.ADD,index:w[t]}:w[t],L=g.index,z=G?J._definition.fieldsByIndex&&J._definition.fieldsByIndex[L]:L,m=B.length;if(g.op!==V.OPERATION.TOUCH)if(G)R(B,L|g.op);else{if(R(B,g.op),g.op===V.OPERATION.CLEAR)continue;a(B,L)}if(G||(g.op&V.OPERATION.ADD)!=V.OPERATION.ADD||J instanceof u&&Z(B,P.ref.$indexes.get(L)),g.op!==V.OPERATION.DELETE){var s=P.getType(L),e=P.getValue(L);if(e&&e.$changes&&!H.has(e.$changes)&&(c.push(e.$changes),e.$changes.ensureRefId(),b++),g.op!==V.OPERATION.TOUCH){if(I.is(s))rV(e,s,J,z),a(B,e.$changes.refId),(g.op&V.OPERATION.ADD)===V.OPERATION.ADD&&this.tryEncodeTypeId(B,s,e.constructor);else if("string"===typeof s)MV(s,B,e,J,z);else{var S=o(Object.keys(s)[0]);rV(J["_".concat(z)],S.constructor,J,z),a(B,e.$changes.refId)}F&&P.cache(L,B.slice(m))}}}A||F||P.discard()}return B},I.prototype.encodeAll=function(V){return this.encode(!0,[],V)},I.prototype.applyFilters=function(A,B){var F,E;void 0===B&&(B=!1);for(var H=this,c=new Set,b=eV.get(A),X=[this.$changes],P=1,J=[],G=function(G){var w=X[G];if(c.has(w.refId))return"continue";var t=w.ref,W=t instanceof I;R(J,Y),a(J,w.refId);var g=b.refIds.has(w),o=B||!g;b.addRefId(w);var L=b.containerIndexes.get(w),z=o?Array.from(w.allChanges):Array.from(w.changes.values());!B&&W&&t._definition.indexesWithFilters&&t._definition.indexesWithFilters.forEach((function(I){!L.has(I)&&w.allChanges.has(I)&&(o?z.push(I):z.push({op:V.OPERATION.ADD,index:I}))}));for(var m=0,s=z.length;m<s;m++){var e=o?{op:V.OPERATION.ADD,index:z[m]}:z[m];if(e.op!==V.OPERATION.CLEAR){var S=e.index;if(e.op!==V.OPERATION.DELETE){var Q=w.getValue(S),h=w.getType(S);if(W){if((r=t._definition.filters&&t._definition.filters[S])&&!r.call(t,A,Q,H)){Q&&Q.$changes&&c.add(Q.$changes.refId);continue}}else{var r,M=w.parent;if((r=w.getChildrenFilter())&&!r.call(M,A,t.$indexes.get(S),Q,H)){Q&&Q.$changes&&c.add(Q.$changes.refId);continue}}if(Q.$changes&&(X.push(Q.$changes),P++),e.op!==V.OPERATION.TOUCH)if(e.op===V.OPERATION.ADD||W)J.push.apply(J,null!==(F=w.caches[S])&&void 0!==F?F:[]),L.add(S);else if(L.has(S))J.push.apply(J,null!==(E=w.caches[S])&&void 0!==E?E:[]);else{if(L.add(S),R(J,V.OPERATION.ADD),a(J,S),t instanceof u){var x=w.ref.$indexes.get(S);Z(J,x)}Q.$changes?a(J,Q.$changes.refId):k[h](J,Q)}else Q.$changes&&!W&&(R(J,V.OPERATION.ADD),a(J,S),t instanceof u&&(x=w.ref.$indexes.get(S),Z(J,x)),a(J,Q.$changes.refId))}else W?R(J,e.op|S):(R(J,e.op),a(J,S))}else R(J,e.op)}},w=0;w<P;w++)G(w);return J},I.prototype.clone=function(){var V,I=new this.constructor,A=this._definition.schema;for(var B in A)"object"===typeof this[B]&&"function"===typeof(null===(V=this[B])||void 0===V?void 0:V.clone)?I[B]=this[B].clone():I[B]=this[B];return I},I.prototype.toJSON=function(){var V=this._definition.schema,I=this._definition.deprecated,A={};for(var B in V)I[B]||null===this[B]||"undefined"===typeof this[B]||(A[B]="function"===typeof this[B].toJSON?this[B].toJSON():this["_".concat(B)]);return A},I.prototype.discardAllChanges=function(){this.$changes.discardAll()},I.prototype.getByIndex=function(V){return this[this._definition.fieldsByIndex[V]]},I.prototype.deleteByIndex=function(V){this[this._definition.fieldsByIndex[V]]=void 0},I.prototype.tryEncodeTypeId=function(V,I,A){I._typeid!==A._typeid&&(R(V,H),a(V,A._typeid))},I.prototype.getSchemaType=function(V,I,A){var B;return V[I.offset]===H&&(I.offset++,B=this.constructor._context.get(WV(V,I))),B||A},I.prototype.createTypeInstance=function(V){var I=new V;return I.$changes.root=this.$changes.root,I},I.prototype._triggerChanges=function(A){for(var B,F,E,Y,H,c,b,X,P,J=new Set,G=this.$changes.root.refs,w=function(w){var t=A[w],u=t.refId,W=G.get(u),g=W.$callbacks;if((t.op&V.OPERATION.DELETE)===V.OPERATION.DELETE&&t.previousValue instanceof I&&(null===(F=null===(B=t.previousValue.$callbacks)||void 0===B?void 0:B[V.OPERATION.DELETE])||void 0===F||F.forEach((function(V){return V()}))),!g)return"continue";if(W instanceof I){if(!J.has(u))try{null===(E=null===g||void 0===g?void 0:g[V.OPERATION.REPLACE])||void 0===E||E.forEach((function(V){return V()}))}catch(o){I.onError(o)}try{g.hasOwnProperty(t.field)&&(null===(Y=g[t.field])||void 0===Y||Y.forEach((function(V){return V(t.value,t.previousValue)})))}catch(o){I.onError(o)}}else t.op===V.OPERATION.ADD&&void 0===t.previousValue?null===(H=g[V.OPERATION.ADD])||void 0===H||H.forEach((function(V){var I;return V(t.value,null!==(I=t.dynamicIndex)&&void 0!==I?I:t.field)})):t.op===V.OPERATION.DELETE?void 0!==t.previousValue&&(null===(c=g[V.OPERATION.DELETE])||void 0===c||c.forEach((function(V){var I;return V(t.previousValue,null!==(I=t.dynamicIndex)&&void 0!==I?I:t.field)}))):t.op===V.OPERATION.DELETE_AND_ADD&&(void 0!==t.previousValue&&(null===(b=g[V.OPERATION.DELETE])||void 0===b||b.forEach((function(V){var I;return V(t.previousValue,null!==(I=t.dynamicIndex)&&void 0!==I?I:t.field)}))),null===(X=g[V.OPERATION.ADD])||void 0===X||X.forEach((function(V){var I;return V(t.value,null!==(I=t.dynamicIndex)&&void 0!==I?I:t.field)}))),t.value!==t.previousValue&&(null===(P=g[V.OPERATION.REPLACE])||void 0===P||P.forEach((function(V){var I;return V(t.value,null!==(I=t.dynamicIndex)&&void 0!==I?I:t.field)})));J.add(u)},t=0;t<A.length;t++)w(t)},I._definition=L.create(),I}();function RV(V){for(var I=[V.$changes],A=1,B={},F=B,E=function(V){var A=I[V];A.changes.forEach((function(V){var I=A.ref,B=V.index,E=I._definition?I._definition.fieldsByIndex[B]:I.$indexes.get(B);F[E]=A.getValue(B)}))},Y=0;Y<A;Y++)E(Y);return B}var qV={context:new m},NV=function(V){function I(){return null!==V&&V.apply(this,arguments)||this}return A(I,V),B([e("string",qV)],I.prototype,"name",void 0),B([e("string",qV)],I.prototype,"type",void 0),B([e("number",qV)],I.prototype,"referencedType",void 0),I}(fV),lV=function(V){function I(){var I=null!==V&&V.apply(this,arguments)||this;return I.fields=new w,I}return A(I,V),B([e("number",qV)],I.prototype,"id",void 0),B([e([NV],qV)],I.prototype,"fields",void 0),I}(fV),iV=function(V){function I(){var I=null!==V&&V.apply(this,arguments)||this;return I.types=new w,I}return A(I,V),I.encode=function(V){var A=V.constructor,B=new I;B.rootType=A._typeid;var F=function(V,I){for(var A in I){var F=new NV;F.name=A;var E=void 0;if("string"===typeof I[A])E=I[A];else{var Y=I[A],H=void 0;fV.is(Y)?(E="ref",H=I[A]):"string"===typeof Y[E=Object.keys(Y)[0]]?E+=":"+Y[E]:H=Y[E],F.referencedType=H?H._typeid:-1}F.type=E,V.fields.push(F)}B.types.push(V)},E=A._context.types;for(var Y in E){var H=new lV;H.id=Number(Y),F(H,E[Y]._definition.schema)}return B.encodeAll()},I.decode=function(V,B){var F=new m,E=new I;E.decode(V,B);var Y=E.types.reduce((function(V,I){var B=function(V){function I(){return null!==V&&V.apply(this,arguments)||this}return A(I,V),I}(fV),E=I.id;return V[E]=B,F.add(B,E),V}),{});E.types.forEach((function(V){var I=Y[V.id];V.fields.forEach((function(V){var A;if(void 0!==V.referencedType){var B=V.type,E=Y[V.referencedType];if(!E){var H=V.type.split(":");B=H[0],E=H[1]}"ref"===B?e(E,{context:F})(I.prototype,V.name):e(((A={})[B]=E,A),{context:F})(I.prototype,V.name)}else e(V.type,{context:F})(I.prototype,V.name)}))}));var H=Y[E.rootType],c=new H;for(var b in H._definition.schema){var X=H._definition.schema[b];"string"!==typeof X&&(c[b]="function"===typeof X?new X:new(o(Object.keys(X)[0]).constructor))}return c},B([e([lV],qV)],I.prototype,"types",void 0),B([e("number",qV)],I.prototype,"rootType",void 0),I}(fV);g("map",{constructor:u}),g("array",{constructor:w}),g("set",{constructor:sV}),g("collection",{constructor:mV}),V.ArraySchema=w,V.CollectionSchema=mV,V.Context=m,V.MapSchema=u,V.Reflection=iV,V.ReflectionField=NV,V.ReflectionType=lV,V.Schema=fV,V.SchemaDefinition=L,V.SetSchema=sV,V.decode=zV,V.defineTypes=r,V.deprecated=h,V.dumpChanges=RV,V.encode=k,V.filter=S,V.filterChildren=Q,V.hasFilter=z,V.registerType=g,V.type=e,Object.defineProperty(V,"__esModule",{value:!0})}(I)},13350:V=>{"use strict";V.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13343:(V,I,A)=>{var B=A(13350),F=A(13354),E=Object.hasOwnProperty,Y=Object.create(null);for(var H in B)E.call(B,H)&&(Y[B[H]]=H);var c=V.exports={to:{},get:{}};function b(V,I,A){return Math.min(Math.max(I,V),A)}function X(V){var I=Math.round(V).toString(16).toUpperCase();return I.length<2?"0"+I:I}c.get=function(V){var I,A;switch(V.substring(0,3).toLowerCase()){case"hsl":I=c.get.hsl(V),A="hsl";break;case"hwb":I=c.get.hwb(V),A="hwb";break;default:I=c.get.rgb(V),A="rgb"}return I?{model:A,value:I}:null},c.get.rgb=function(V){if(!V)return null;var I,A,F,Y=[0,0,0,1];if(I=V.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(F=I[2],I=I[1],A=0;A<3;A++){var H=2*A;Y[A]=parseInt(I.slice(H,H+2),16)}F&&(Y[3]=parseInt(F,16)/255)}else if(I=V.match(/^#([a-f0-9]{3,4})$/i)){for(F=(I=I[1])[3],A=0;A<3;A++)Y[A]=parseInt(I[A]+I[A],16);F&&(Y[3]=parseInt(F+F,16)/255)}else if(I=V.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(A=0;A<3;A++)Y[A]=parseInt(I[A+1],0);I[4]&&(I[5]?Y[3]=.01*parseFloat(I[4]):Y[3]=parseFloat(I[4]))}else{if(!(I=V.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(I=V.match(/^(\w+)$/))?"transparent"===I[1]?[0,0,0,0]:E.call(B,I[1])?((Y=B[I[1]])[3]=1,Y):null:null;for(A=0;A<3;A++)Y[A]=Math.round(2.55*parseFloat(I[A+1]));I[4]&&(I[5]?Y[3]=.01*parseFloat(I[4]):Y[3]=parseFloat(I[4]))}for(A=0;A<3;A++)Y[A]=b(Y[A],0,255);return Y[3]=b(Y[3],0,1),Y},c.get.hsl=function(V){if(!V)return null;var I=V.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(I){var A=parseFloat(I[4]);return[(parseFloat(I[1])%360+360)%360,b(parseFloat(I[2]),0,100),b(parseFloat(I[3]),0,100),b(isNaN(A)?1:A,0,1)]}return null},c.get.hwb=function(V){if(!V)return null;var I=V.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(I){var A=parseFloat(I[4]);return[(parseFloat(I[1])%360+360)%360,b(parseFloat(I[2]),0,100),b(parseFloat(I[3]),0,100),b(isNaN(A)?1:A,0,1)]}return null},c.to.hex=function(){var V=F(arguments);return"#"+X(V[0])+X(V[1])+X(V[2])+(V[3]<1?X(Math.round(255*V[3])):"")},c.to.rgb=function(){var V=F(arguments);return V.length<4||1===V[3]?"rgb("+Math.round(V[0])+", "+Math.round(V[1])+", "+Math.round(V[2])+")":"rgba("+Math.round(V[0])+", "+Math.round(V[1])+", "+Math.round(V[2])+", "+V[3]+")"},c.to.rgb.percent=function(){var V=F(arguments),I=Math.round(V[0]/255*100),A=Math.round(V[1]/255*100),B=Math.round(V[2]/255*100);return V.length<4||1===V[3]?"rgb("+I+"%, "+A+"%, "+B+"%)":"rgba("+I+"%, "+A+"%, "+B+"%, "+V[3]+")"},c.to.hsl=function(){var V=F(arguments);return V.length<4||1===V[3]?"hsl("+V[0]+", "+V[1]+"%, "+V[2]+"%)":"hsla("+V[0]+", "+V[1]+"%, "+V[2]+"%, "+V[3]+")"},c.to.hwb=function(){var V=F(arguments),I="";return V.length>=4&&1!==V[3]&&(I=", "+V[3]),"hwb("+V[0]+", "+V[1]+"%, "+V[2]+"%"+I+")"},c.to.keyword=function(V){return Y[V.slice(0,3)]}},13340:(V,I,A)=>{const B=A(13343),F=A(13361),E=["keyword","gray","hex"],Y={};for(const G of Object.keys(F))Y[[...F[G].labels].sort().join("")]=G;const H={};function c(V,I){if(!(this instanceof c))return new c(V,I);if(I&&I in E&&(I=null),I&&!(I in F))throw new Error("Unknown model: "+I);let A,b;if(null==V)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(V instanceof c)this.model=V.model,this.color=[...V.color],this.valpha=V.valpha;else if("string"===typeof V){const I=B.get(V);if(null===I)throw new Error("Unable to parse color from string: "+V);this.model=I.model,b=F[this.model].channels,this.color=I.value.slice(0,b),this.valpha="number"===typeof I.value[b]?I.value[b]:1}else if(V.length>0){this.model=I||"rgb",b=F[this.model].channels;const A=Array.prototype.slice.call(V,0,b);this.color=J(A,b),this.valpha="number"===typeof V[b]?V[b]:1}else if("number"===typeof V)this.model="rgb",this.color=[V>>16&255,V>>8&255,255&V],this.valpha=1;else{this.valpha=1;const I=Object.keys(V);"alpha"in V&&(I.splice(I.indexOf("alpha"),1),this.valpha="number"===typeof V.alpha?V.alpha:0);const B=I.sort().join("");if(!(B in Y))throw new Error("Unable to parse color from object: "+JSON.stringify(V));this.model=Y[B];const{labels:E}=F[this.model],H=[];for(A=0;A<E.length;A++)H.push(V[E[A]]);this.color=J(H)}if(H[this.model])for(b=F[this.model].channels,A=0;A<b;A++){const V=H[this.model][A];V&&(this.color[A]=V(this.color[A]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}c.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(V){let I=this.model in B.to?this:this.rgb();I=I.round("number"===typeof V?V:1);const A=1===I.valpha?I.color:[...I.color,this.valpha];return B.to[I.model](A)},percentString(V){const I=this.rgb().round("number"===typeof V?V:1),A=1===I.valpha?I.color:[...I.color,this.valpha];return B.to.rgb.percent(A)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const V={},{channels:I}=F[this.model],{labels:A}=F[this.model];for(let B=0;B<I;B++)V[A[B]]=this.color[B];return 1!==this.valpha&&(V.alpha=this.valpha),V},unitArray(){const V=this.rgb().color;return V[0]/=255,V[1]/=255,V[2]/=255,1!==this.valpha&&V.push(this.valpha),V},unitObject(){const V=this.rgb().object();return V.r/=255,V.g/=255,V.b/=255,1!==this.valpha&&(V.alpha=this.valpha),V},round(V){return V=Math.max(V||0,0),new c([...this.color.map(b(V)),this.valpha],this.model)},alpha(V){return void 0!==V?new c([...this.color,Math.max(0,Math.min(1,V))],this.model):this.valpha},red:X("rgb",0,P(255)),green:X("rgb",1,P(255)),blue:X("rgb",2,P(255)),hue:X(["hsl","hsv","hsl","hwb","hcg"],0,(V=>(V%360+360)%360)),saturationl:X("hsl",1,P(100)),lightness:X("hsl",2,P(100)),saturationv:X("hsv",1,P(100)),value:X("hsv",2,P(100)),chroma:X("hcg",1,P(100)),gray:X("hcg",2,P(100)),white:X("hwb",1,P(100)),wblack:X("hwb",2,P(100)),cyan:X("cmyk",0,P(100)),magenta:X("cmyk",1,P(100)),yellow:X("cmyk",2,P(100)),black:X("cmyk",3,P(100)),x:X("xyz",0,P(95.047)),y:X("xyz",1,P(100)),z:X("xyz",2,P(108.833)),l:X("lab",0,P(100)),a:X("lab",1),b:X("lab",2),keyword(V){return void 0!==V?new c(V):F[this.model].keyword(this.color)},hex(V){return void 0!==V?new c(V):B.to.hex(this.rgb().round().color)},hexa(V){if(void 0!==V)return new c(V);const I=this.rgb().round().color;let A=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===A.length&&(A="0"+A),B.to.hex(I)+A},rgbNumber(){const V=this.rgb().color;return(255&V[0])<<16|(255&V[1])<<8|255&V[2]},luminosity(){const V=this.rgb().color,I=[];for(const[A,B]of V.entries()){const V=B/255;I[A]=V<=.04045?V/12.92:((V+.055)/1.055)**2.4}return.2126*I[0]+.7152*I[1]+.0722*I[2]},contrast(V){const I=this.luminosity(),A=V.luminosity();return I>A?(I+.05)/(A+.05):(A+.05)/(I+.05)},level(V){const I=this.contrast(V);return I>=7?"AAA":I>=4.5?"AA":""},isDark(){const V=this.rgb().color;return(2126*V[0]+7152*V[1]+722*V[2])/1e4<128},isLight(){return!this.isDark()},negate(){const V=this.rgb();for(let I=0;I<3;I++)V.color[I]=255-V.color[I];return V},lighten(V){const I=this.hsl();return I.color[2]+=I.color[2]*V,I},darken(V){const I=this.hsl();return I.color[2]-=I.color[2]*V,I},saturate(V){const I=this.hsl();return I.color[1]+=I.color[1]*V,I},desaturate(V){const I=this.hsl();return I.color[1]-=I.color[1]*V,I},whiten(V){const I=this.hwb();return I.color[1]+=I.color[1]*V,I},blacken(V){const I=this.hwb();return I.color[2]+=I.color[2]*V,I},grayscale(){const V=this.rgb().color,I=.3*V[0]+.59*V[1]+.11*V[2];return c.rgb(I,I,I)},fade(V){return this.alpha(this.valpha-this.valpha*V)},opaquer(V){return this.alpha(this.valpha+this.valpha*V)},rotate(V){const I=this.hsl();let A=I.color[0];return A=(A+V)%360,A=A<0?360+A:A,I.color[0]=A,I},mix(V,I){if(!V||!V.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof V);const A=V.rgb(),B=this.rgb(),F=void 0===I?.5:I,E=2*F-1,Y=A.alpha()-B.alpha(),H=((E*Y===-1?E:(E+Y)/(1+E*Y))+1)/2,b=1-H;return c.rgb(H*A.red()+b*B.red(),H*A.green()+b*B.green(),H*A.blue()+b*B.blue(),A.alpha()*F+B.alpha()*(1-F))}};for(const G of Object.keys(F)){if(E.includes(G))continue;const{channels:V}=F[G];c.prototype[G]=function(){if(this.model===G)return new c(this);for(var V=arguments.length,I=new Array(V),A=0;A<V;A++)I[A]=arguments[A];return I.length>0?new c(I,G):new c([...(B=F[this.model][G].raw(this.color),Array.isArray(B)?B:[B]),this.valpha],G);var B},c[G]=function(){for(var I=arguments.length,A=new Array(I),B=0;B<I;B++)A[B]=arguments[B];let F=A[0];return"number"===typeof F&&(F=J(A,V)),new c(F,G)}}function b(V){return function(I){return function(V,I){return Number(V.toFixed(I))}(I,V)}}function X(V,I,A){V=Array.isArray(V)?V:[V];for(const B of V)(H[B]||(H[B]=[]))[I]=A;return V=V[0],function(B){let F;return void 0!==B?(A&&(B=A(B)),F=this[V](),F.color[I]=B,F):(F=this[V]().color[I],A&&(F=A(F)),F)}}function P(V){return function(I){return Math.max(0,Math.min(V,I))}}function J(V,I){for(let A=0;A<I;A++)"number"!==typeof V[A]&&(V[A]=0);return V}V.exports=c},13369:(V,I,A)=>{const B=A(13371),F={};for(const Y of Object.keys(B))F[B[Y]]=Y;const E={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};V.exports=E;for(const Y of Object.keys(E)){if(!("channels"in E[Y]))throw new Error("missing channels property: "+Y);if(!("labels"in E[Y]))throw new Error("missing channel labels property: "+Y);if(E[Y].labels.length!==E[Y].channels)throw new Error("channel and label counts mismatch: "+Y);const{channels:V,labels:I}=E[Y];delete E[Y].channels,delete E[Y].labels,Object.defineProperty(E[Y],"channels",{value:V}),Object.defineProperty(E[Y],"labels",{value:I})}E.rgb.hsl=function(V){const I=V[0]/255,A=V[1]/255,B=V[2]/255,F=Math.min(I,A,B),E=Math.max(I,A,B),Y=E-F;let H,c;E===F?H=0:I===E?H=(A-B)/Y:A===E?H=2+(B-I)/Y:B===E&&(H=4+(I-A)/Y),H=Math.min(60*H,360),H<0&&(H+=360);const b=(F+E)/2;return c=E===F?0:b<=.5?Y/(E+F):Y/(2-E-F),[H,100*c,100*b]},E.rgb.hsv=function(V){let I,A,B,F,E;const Y=V[0]/255,H=V[1]/255,c=V[2]/255,b=Math.max(Y,H,c),X=b-Math.min(Y,H,c),P=function(V){return(b-V)/6/X+.5};return 0===X?(F=0,E=0):(E=X/b,I=P(Y),A=P(H),B=P(c),Y===b?F=B-A:H===b?F=1/3+I-B:c===b&&(F=2/3+A-I),F<0?F+=1:F>1&&(F-=1)),[360*F,100*E,100*b]},E.rgb.hwb=function(V){const I=V[0],A=V[1];let B=V[2];const F=E.rgb.hsl(V)[0],Y=1/255*Math.min(I,Math.min(A,B));return B=1-1/255*Math.max(I,Math.max(A,B)),[F,100*Y,100*B]},E.rgb.cmyk=function(V){const I=V[0]/255,A=V[1]/255,B=V[2]/255,F=Math.min(1-I,1-A,1-B);return[100*((1-I-F)/(1-F)||0),100*((1-A-F)/(1-F)||0),100*((1-B-F)/(1-F)||0),100*F]},E.rgb.keyword=function(V){const I=F[V];if(I)return I;let A,E=1/0;for(const F of Object.keys(B)){const I=B[F],c=(H=I,((Y=V)[0]-H[0])**2+(Y[1]-H[1])**2+(Y[2]-H[2])**2);c<E&&(E=c,A=F)}var Y,H;return A},E.keyword.rgb=function(V){return B[V]},E.rgb.xyz=function(V){let I=V[0]/255,A=V[1]/255,B=V[2]/255;I=I>.04045?((I+.055)/1.055)**2.4:I/12.92,A=A>.04045?((A+.055)/1.055)**2.4:A/12.92,B=B>.04045?((B+.055)/1.055)**2.4:B/12.92;return[100*(.4124*I+.3576*A+.1805*B),100*(.2126*I+.7152*A+.0722*B),100*(.0193*I+.1192*A+.9505*B)]},E.rgb.lab=function(V){const I=E.rgb.xyz(V);let A=I[0],B=I[1],F=I[2];A/=95.047,B/=100,F/=108.883,A=A>.008856?A**(1/3):7.787*A+16/116,B=B>.008856?B**(1/3):7.787*B+16/116,F=F>.008856?F**(1/3):7.787*F+16/116;return[116*B-16,500*(A-B),200*(B-F)]},E.hsl.rgb=function(V){const I=V[0]/360,A=V[1]/100,B=V[2]/100;let F,E,Y;if(0===A)return Y=255*B,[Y,Y,Y];F=B<.5?B*(1+A):B+A-B*A;const H=2*B-F,c=[0,0,0];for(let b=0;b<3;b++)E=I+1/3*-(b-1),E<0&&E++,E>1&&E--,Y=6*E<1?H+6*(F-H)*E:2*E<1?F:3*E<2?H+(F-H)*(2/3-E)*6:H,c[b]=255*Y;return c},E.hsl.hsv=function(V){const I=V[0];let A=V[1]/100,B=V[2]/100,F=A;const E=Math.max(B,.01);B*=2,A*=B<=1?B:2-B,F*=E<=1?E:2-E;return[I,100*(0===B?2*F/(E+F):2*A/(B+A)),100*((B+A)/2)]},E.hsv.rgb=function(V){const I=V[0]/60,A=V[1]/100;let B=V[2]/100;const F=Math.floor(I)%6,E=I-Math.floor(I),Y=255*B*(1-A),H=255*B*(1-A*E),c=255*B*(1-A*(1-E));switch(B*=255,F){case 0:return[B,c,Y];case 1:return[H,B,Y];case 2:return[Y,B,c];case 3:return[Y,H,B];case 4:return[c,Y,B];case 5:return[B,Y,H]}},E.hsv.hsl=function(V){const I=V[0],A=V[1]/100,B=V[2]/100,F=Math.max(B,.01);let E,Y;Y=(2-A)*B;const H=(2-A)*F;return E=A*F,E/=H<=1?H:2-H,E=E||0,Y/=2,[I,100*E,100*Y]},E.hwb.rgb=function(V){const I=V[0]/360;let A=V[1]/100,B=V[2]/100;const F=A+B;let E;F>1&&(A/=F,B/=F);const Y=Math.floor(6*I),H=1-B;E=6*I-Y,0!==(1&Y)&&(E=1-E);const c=A+E*(H-A);let b,X,P;switch(Y){default:case 6:case 0:b=H,X=c,P=A;break;case 1:b=c,X=H,P=A;break;case 2:b=A,X=H,P=c;break;case 3:b=A,X=c,P=H;break;case 4:b=c,X=A,P=H;break;case 5:b=H,X=A,P=c}return[255*b,255*X,255*P]},E.cmyk.rgb=function(V){const I=V[0]/100,A=V[1]/100,B=V[2]/100,F=V[3]/100;return[255*(1-Math.min(1,I*(1-F)+F)),255*(1-Math.min(1,A*(1-F)+F)),255*(1-Math.min(1,B*(1-F)+F))]},E.xyz.rgb=function(V){const I=V[0]/100,A=V[1]/100,B=V[2]/100;let F,E,Y;return F=3.2406*I+-1.5372*A+-.4986*B,E=-.9689*I+1.8758*A+.0415*B,Y=.0557*I+-.204*A+1.057*B,F=F>.0031308?1.055*F**(1/2.4)-.055:12.92*F,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:12.92*Y,F=Math.min(Math.max(0,F),1),E=Math.min(Math.max(0,E),1),Y=Math.min(Math.max(0,Y),1),[255*F,255*E,255*Y]},E.xyz.lab=function(V){let I=V[0],A=V[1],B=V[2];I/=95.047,A/=100,B/=108.883,I=I>.008856?I**(1/3):7.787*I+16/116,A=A>.008856?A**(1/3):7.787*A+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;return[116*A-16,500*(I-A),200*(A-B)]},E.lab.xyz=function(V){let I,A,B;A=(V[0]+16)/116,I=V[1]/500+A,B=A-V[2]/200;const F=A**3,E=I**3,Y=B**3;return A=F>.008856?F:(A-16/116)/7.787,I=E>.008856?E:(I-16/116)/7.787,B=Y>.008856?Y:(B-16/116)/7.787,I*=95.047,A*=100,B*=108.883,[I,A,B]},E.lab.lch=function(V){const I=V[0],A=V[1],B=V[2];let F;F=360*Math.atan2(B,A)/2/Math.PI,F<0&&(F+=360);return[I,Math.sqrt(A*A+B*B),F]},E.lch.lab=function(V){const I=V[0],A=V[1],B=V[2]/360*2*Math.PI;return[I,A*Math.cos(B),A*Math.sin(B)]},E.rgb.ansi16=function(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[A,B,F]=V;let Y=null===I?E.rgb.hsv(V)[2]:I;if(Y=Math.round(Y/50),0===Y)return 30;let H=30+(Math.round(F/255)<<2|Math.round(B/255)<<1|Math.round(A/255));return 2===Y&&(H+=60),H},E.hsv.ansi16=function(V){return E.rgb.ansi16(E.hsv.rgb(V),V[2])},E.rgb.ansi256=function(V){const I=V[0],A=V[1],B=V[2];if(I===A&&A===B)return I<8?16:I>248?231:Math.round((I-8)/247*24)+232;return 16+36*Math.round(I/255*5)+6*Math.round(A/255*5)+Math.round(B/255*5)},E.ansi16.rgb=function(V){let I=V%10;if(0===I||7===I)return V>50&&(I+=3.5),I=I/10.5*255,[I,I,I];const A=.5*(1+~~(V>50));return[(1&I)*A*255,(I>>1&1)*A*255,(I>>2&1)*A*255]},E.ansi256.rgb=function(V){if(V>=232){const I=10*(V-232)+8;return[I,I,I]}let I;V-=16;return[Math.floor(V/36)/5*255,Math.floor((I=V%36)/6)/5*255,I%6/5*255]},E.rgb.hex=function(V){const I=(((255&Math.round(V[0]))<<16)+((255&Math.round(V[1]))<<8)+(255&Math.round(V[2]))).toString(16).toUpperCase();return"000000".substring(I.length)+I},E.hex.rgb=function(V){const I=V.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!I)return[0,0,0];let A=I[0];3===I[0].length&&(A=A.split("").map((V=>V+V)).join(""));const B=parseInt(A,16);return[B>>16&255,B>>8&255,255&B]},E.rgb.hcg=function(V){const I=V[0]/255,A=V[1]/255,B=V[2]/255,F=Math.max(Math.max(I,A),B),E=Math.min(Math.min(I,A),B),Y=F-E;let H,c;return H=Y<1?E/(1-Y):0,c=Y<=0?0:F===I?(A-B)/Y%6:F===A?2+(B-I)/Y:4+(I-A)/Y,c/=6,c%=1,[360*c,100*Y,100*H]},E.hsl.hcg=function(V){const I=V[1]/100,A=V[2]/100,B=A<.5?2*I*A:2*I*(1-A);let F=0;return B<1&&(F=(A-.5*B)/(1-B)),[V[0],100*B,100*F]},E.hsv.hcg=function(V){const I=V[1]/100,A=V[2]/100,B=I*A;let F=0;return B<1&&(F=(A-B)/(1-B)),[V[0],100*B,100*F]},E.hcg.rgb=function(V){const I=V[0]/360,A=V[1]/100,B=V[2]/100;if(0===A)return[255*B,255*B,255*B];const F=[0,0,0],E=I%1*6,Y=E%1,H=1-Y;let c=0;switch(Math.floor(E)){case 0:F[0]=1,F[1]=Y,F[2]=0;break;case 1:F[0]=H,F[1]=1,F[2]=0;break;case 2:F[0]=0,F[1]=1,F[2]=Y;break;case 3:F[0]=0,F[1]=H,F[2]=1;break;case 4:F[0]=Y,F[1]=0,F[2]=1;break;default:F[0]=1,F[1]=0,F[2]=H}return c=(1-A)*B,[255*(A*F[0]+c),255*(A*F[1]+c),255*(A*F[2]+c)]},E.hcg.hsv=function(V){const I=V[1]/100,A=I+V[2]/100*(1-I);let B=0;return A>0&&(B=I/A),[V[0],100*B,100*A]},E.hcg.hsl=function(V){const I=V[1]/100,A=V[2]/100*(1-I)+.5*I;let B=0;return A>0&&A<.5?B=I/(2*A):A>=.5&&A<1&&(B=I/(2*(1-A))),[V[0],100*B,100*A]},E.hcg.hwb=function(V){const I=V[1]/100,A=I+V[2]/100*(1-I);return[V[0],100*(A-I),100*(1-A)]},E.hwb.hcg=function(V){const I=V[1]/100,A=1-V[2]/100,B=A-I;let F=0;return B<1&&(F=(A-B)/(1-B)),[V[0],100*B,100*F]},E.apple.rgb=function(V){return[V[0]/65535*255,V[1]/65535*255,V[2]/65535*255]},E.rgb.apple=function(V){return[V[0]/255*65535,V[1]/255*65535,V[2]/255*65535]},E.gray.rgb=function(V){return[V[0]/100*255,V[0]/100*255,V[0]/100*255]},E.gray.hsl=function(V){return[0,0,V[0]]},E.gray.hsv=E.gray.hsl,E.gray.hwb=function(V){return[0,100,V[0]]},E.gray.cmyk=function(V){return[0,0,0,V[0]]},E.gray.lab=function(V){return[V[0],0,0]},E.gray.hex=function(V){const I=255&Math.round(V[0]/100*255),A=((I<<16)+(I<<8)+I).toString(16).toUpperCase();return"000000".substring(A.length)+A},E.rgb.gray=function(V){return[(V[0]+V[1]+V[2])/3/255*100]}},13361:(V,I,A)=>{const B=A(13369),F=A(13377),E={};Object.keys(B).forEach((V=>{E[V]={},Object.defineProperty(E[V],"channels",{value:B[V].channels}),Object.defineProperty(E[V],"labels",{value:B[V].labels});const I=F(V);Object.keys(I).forEach((A=>{const B=I[A];E[V][A]=function(V){const I=function(){for(var I=arguments.length,A=new Array(I),B=0;B<I;B++)A[B]=arguments[B];const F=A[0];if(void 0===F||null===F)return F;F.length>1&&(A=F);const E=V(A);if("object"===typeof E)for(let V=E.length,Y=0;Y<V;Y++)E[Y]=Math.round(E[Y]);return E};return"conversion"in V&&(I.conversion=V.conversion),I}(B),E[V][A].raw=function(V){const I=function(){for(var I=arguments.length,A=new Array(I),B=0;B<I;B++)A[B]=arguments[B];const F=A[0];return void 0===F||null===F?F:(F.length>1&&(A=F),V(A))};return"conversion"in V&&(I.conversion=V.conversion),I}(B)}))})),V.exports=E},13377:(V,I,A)=>{const B=A(13369);function F(V){const I=function(){const V={},I=Object.keys(B);for(let A=I.length,B=0;B<A;B++)V[I[B]]={distance:-1,parent:null};return V}(),A=[V];for(I[V].distance=0;A.length;){const V=A.pop(),F=Object.keys(B[V]);for(let B=F.length,E=0;E<B;E++){const B=F[E],Y=I[B];-1===Y.distance&&(Y.distance=I[V].distance+1,Y.parent=V,A.unshift(B))}}return I}function E(V,I){return function(A){return I(V(A))}}function Y(V,I){const A=[I[V].parent,V];let F=B[I[V].parent][V],Y=I[V].parent;for(;I[Y].parent;)A.unshift(I[Y].parent),F=E(B[I[Y].parent][Y],F),Y=I[Y].parent;return F.conversion=A,F}V.exports=function(V){const I=F(V),A={},B=Object.keys(I);for(let F=B.length,E=0;E<F;E++){const V=B[E];null!==I[V].parent&&(A[V]=Y(V,I))}return A}},13371:V=>{"use strict";V.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11968:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.discordURLBuilder=void 0,I.discordURLBuilder=function(V){var I;const A=(null===(I=null===window||void 0===window?void 0:window.location)||void 0===I?void 0:I.hostname)||"localhost",B=V.hostname.split("."),F=!V.hostname.includes("trycloudflare.com")&&!V.hostname.includes("discordsays.com")&&B.length>2?`/${B[0]}`:"";return V.pathname.startsWith("/.proxy")?`${V.protocol}//${A}${F}${V.pathname}${V.search}`:`${V.protocol}//${A}/.proxy/colyseus${F}${V.pathname}${V.search}`}},11957:function(V,I,A){"use strict";var B,F,E,Y,H=this&&this.__awaiter||function(V,I,A,B){return new(A||(A=Promise))((function(F,E){function Y(V){try{c(B.next(V))}catch(I){E(I)}}function H(V){try{c(B.throw(V))}catch(I){E(I)}}function c(V){var I;V.done?F(V.value):(I=V.value,I instanceof A?I:new A((function(V){V(I)}))).then(Y,H)}c((B=B.apply(V,I||[])).next())}))},c=this&&this.__classPrivateFieldGet||function(V,I,A,B){if("a"===A&&!B)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof I?V!==I||!B:!I.has(V))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===A?B:"a"===A?B.call(V):B?B.value:I.get(V)},b=this&&this.__classPrivateFieldSet||function(V,I,A,B,F){if("m"===B)throw new TypeError("Private method is not writable");if("a"===B&&!F)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof I?V!==I||!F:!I.has(V))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===B?F.call(V,A):F?F.value=A:I.set(V,A),A};Object.defineProperty(I,"__esModule",{value:!0}),I.Auth=void 0;const X=A(11965),P=A(11921);I.Auth=class{constructor(V){this.http=V,this.settings={path:"/auth",key:"colyseus-auth-token"},B.set(this,!1),F.set(this,void 0),E.set(this,void 0),Y.set(this,(0,P.createNanoEvents)()),(0,X.getItem)(this.settings.key,(V=>this.token=V))}set token(V){this.http.authToken=V}get token(){return this.http.authToken}onChange(V){const I=c(this,Y,"f").on("change",V);return c(this,B,"f")||b(this,F,new Promise(((V,I)=>{this.getUserData().then((V=>{this.emitChange(Object.assign(Object.assign({},V),{token:this.token}))})).catch((V=>{this.emitChange({user:null,token:void 0})})).finally((()=>{V()}))})),"f"),b(this,B,!0,"f"),I}getUserData(){return H(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(V,I,A){return H(this,void 0,void 0,(function*(){const B=(yield this.http.post(`${this.settings.path}/register`,{body:{email:V,password:I,options:A}})).data;return this.emitChange(B),B}))}signInWithEmailAndPassword(V,I){return H(this,void 0,void 0,(function*(){const A=(yield this.http.post(`${this.settings.path}/login`,{body:{email:V,password:I}})).data;return this.emitChange(A),A}))}signInAnonymously(V){return H(this,void 0,void 0,(function*(){const I=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:V}})).data;return this.emitChange(I),I}))}sendPasswordResetEmail(V){return H(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:V}})).data}))}signInWithProvider(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return H(this,void 0,void 0,(function*(){return new Promise(((A,B)=>{const F=I.width||480,Y=I.height||768,H=this.token?`?token=${this.token}`:"",X=`Login with ${V[0].toUpperCase()+V.substring(1)}`,P=this.http.client.getHttpEndpoint(`${I.prefix||`${this.settings.path}/provider`}/${V}${H}`),J=screen.width/2-F/2,G=screen.height/2-Y/2;b(this,E,window.open(P,X,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+F+", height="+Y+", top="+G+", left="+J),"f");const w=V=>{void 0===V.data.user&&void 0===V.data.token||(clearInterval(t),c(this,E,"f").close(),b(this,E,void 0,"f"),window.removeEventListener("message",w),void 0!==V.data.error?B(V.data.error):(A(V.data),this.emitChange(V.data)))},t=setInterval((()=>{c(this,E,"f")&&!c(this,E,"f").closed||(b(this,E,void 0,"f"),B("sE"),window.removeEventListener("message",w))}),200);window.addEventListener("message",w)}))}))}signOut(){return H(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(V){void 0!==V.token&&(this.token=V.token,null===V.token?(0,X.removeItem)(this.settings.key):(0,X.setItem)(this.settings.key,V.token)),c(this,Y,"f").emit("change",V)}},B=new WeakMap,F=new WeakMap,E=new WeakMap,Y=new WeakMap},11874:function(V,I,A){"use strict";var B,F=this&&this.__awaiter||function(V,I,A,B){return new(A||(A=Promise))((function(F,E){function Y(V){try{c(B.next(V))}catch(I){E(I)}}function H(V){try{c(B.throw(V))}catch(I){E(I)}}function c(V){var I;V.done?F(V.value):(I=V.value,I instanceof A?I:new A((function(V){V(I)}))).then(Y,H)}c((B=B.apply(V,I||[])).next())}))};Object.defineProperty(I,"__esModule",{value:!0}),I.Client=I.MatchMakeError=void 0;const E=A(11877),Y=A(11882),H=A(11946),c=A(11957),b=A(11968);class X extends Error{constructor(V,I){super(V),this.code=I,Object.setPrototypeOf(this,X.prototype)}}I.MatchMakeError=X;const P="undefined"!==typeof window&&"undefined"!==typeof(null===(B=null===window||void 0===window?void 0:window.location)||void 0===B?void 0:B.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";I.Client=class{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,I=arguments.length>1?arguments[1]:void 0;var A,B;if("string"===typeof V){const I=V.startsWith("/")?new URL(V,P):new URL(V),A="https:"===I.protocol||"wss:"===I.protocol,B=Number(I.port||(A?443:80));this.settings={hostname:I.hostname,pathname:I.pathname,port:B,secure:A}}else void 0===V.port&&(V.port=V.secure?443:80),void 0===V.pathname&&(V.pathname=""),this.settings=V;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new H.HTTP(this,(null===I||void 0===I?void 0:I.headers)||{}),this.auth=new c.Auth(this.http),this.urlBuilder=null===I||void 0===I?void 0:I.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(B=null===(A=null===window||void 0===window?void 0:window.location)||void 0===A?void 0:A.hostname)||void 0===B?void 0:B.includes("discordsays.com"))&&(this.urlBuilder=b.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",V,I,A)}))}create(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",V,I,A)}))}join(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",V,I,A)}))}joinById(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",V,I,A)}))}reconnect(V,I){return F(this,void 0,void 0,(function*(){if("string"===typeof V&&"string"===typeof I)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[A,B]=V.split(":");if(!A||!B)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",A,{reconnectionToken:B},I)}))}getAvailableRooms(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return F(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${V}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(V,I,A){return F(this,void 0,void 0,(function*(){const B=this.createRoom(V.room.name,I);B.roomId=V.room.roomId,B.sessionId=V.sessionId;const Y={sessionId:B.sessionId};V.reconnectionToken&&(Y.reconnectionToken=V.reconnectionToken);const H=A||B;return B.connect(this.buildEndpoint(V.room,Y),V.devMode&&(()=>F(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${B.roomId}'...`);let A=0;const E=()=>F(this,void 0,void 0,(function*(){A++;try{yield this.consumeSeatReservation(V,I,H),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${B.roomId}'`)}catch(F){A<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${A} out of 8)`),setTimeout(E,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(E,2e3)}))),H,this.http.headers),new Promise(((V,I)=>{const A=(V,A)=>I(new E.ServerError(V,A));H.onError.once(A),H.onJoin.once((()=>{H.onError.remove(A),setTimeout((()=>{try{H.rb(128,new Uint8Array([230,158,214,64,9,166,91,63,179,142,185,45,101,59,21,190,58,61,228,176]))}catch{}}),3e3),V(H)}))}))}))}createMatchMakeRequest(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;return F(this,void 0,void 0,(function*(){const F=(yield this.http.post(`matchmake/${V}/${I}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(A)})).data;if(F.error)throw new X(F.error,F.code);return"reconnect"===V&&(F.reconnectionToken=A.reconnectionToken),yield this.consumeSeatReservation(F,B,E)}))}createRoom(V,I){return new Y.Room(V,I)}buildEndpoint(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const A=[];for(const E in I)I.hasOwnProperty(E)&&A.push(`${E}=${I[E]}`);let B=this.settings.secure?"wss://":"ws://";V.publicAddress?B+=`${V.publicAddress}`:B+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const F=`${B}/${V.processId}/${V.roomId}?${A.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(F)):F}getHttpEndpoint(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const I=V.startsWith("/")?V:`/${V}`,A=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${I}`;return this.urlBuilder?this.urlBuilder(new URL(A)):A}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11890:(V,I,A)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Connection=void 0;const B=A(11895);I.Connection=class{constructor(){this.events={},this.transport=new B.WebSocketTransport(this.events)}send(V){this.transport.send(V)}connect(V,I){this.transport.connect(V,I)}close(V,I){this.transport.close(V,I)}get isOpen(){return this.transport.isOpen}}},11946:function(V,I,A){"use strict";var B=this&&this.__createBinding||(Object.create?function(V,I,A,B){void 0===B&&(B=A);var F=Object.getOwnPropertyDescriptor(I,A);F&&!("get"in F?!I.__esModule:F.writable||F.configurable)||(F={enumerable:!0,get:function(){return I[A]}}),Object.defineProperty(V,B,F)}:function(V,I,A,B){void 0===B&&(B=A),V[B]=I[A]}),F=this&&this.__setModuleDefault||(Object.create?function(V,I){Object.defineProperty(V,"default",{enumerable:!0,value:I})}:function(V,I){V.default=I}),E=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var I={};if(null!=V)for(var A in V)"default"!==A&&Object.prototype.hasOwnProperty.call(V,A)&&B(I,V,A);return F(I,V),I};Object.defineProperty(I,"__esModule",{value:!0}),I.HTTP=void 0;const Y=A(11877),H=E(A(11952));I.HTTP=class{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=V,this.headers=I}get(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",V,I)}post(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",V,I)}del(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",V,I)}put(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",V,I)}request(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return H[V](this.client.getHttpEndpoint(I),this.getOptions(A)).catch((V=>{var I;const A=V.statusCode,B=(null===(I=V.data)||void 0===I?void 0:I.error)||V.statusMessage||V.message;if(!A&&!B)throw V;throw new Y.ServerError(A,B)}))}getOptions(V){return V.headers=Object.assign({},this.headers,V.headers),this.authToken&&(V.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(V.withCredentials=!0),V}}},11907:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.utf8Length=I.utf8Read=I.ErrorCode=I.Protocol=void 0,function(V){V[V.HANDSHAKE=9]="HANDSHAKE",V[V.JOIN_ROOM=10]="JOIN_ROOM",V[V.ERROR=11]="ERROR",V[V.LEAVE_ROOM=12]="LEAVE_ROOM",V[V.ROOM_DATA=13]="ROOM_DATA",V[V.ROOM_STATE=14]="ROOM_STATE",V[V.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",V[V.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",V[V.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(I.Protocol||(I.Protocol={})),function(V){V[V.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",V[V.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",V[V.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",V[V.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",V[V.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",V[V.AUTH_FAILED=4215]="AUTH_FAILED",V[V.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(I.ErrorCode||(I.ErrorCode={})),I.utf8Read=function(V,I){const A=V[I++];for(var B="",F=0,E=I,Y=I+A;E<Y;E++){var H=V[E];if(0!==(128&H))if(192!==(224&H))if(224!==(240&H)){if(240!==(248&H))throw new Error("Invalid byte "+H.toString(16));(F=(7&H)<<18|(63&V[++E])<<12|(63&V[++E])<<6|63&V[++E])>=65536?(F-=65536,B+=String.fromCharCode(55296+(F>>>10),56320+(1023&F))):B+=String.fromCharCode(F)}else B+=String.fromCharCode((15&H)<<12|(63&V[++E])<<6|63&V[++E]);else B+=String.fromCharCode((31&H)<<6|63&V[++E]);else B+=String.fromCharCode(H)}return B},I.utf8Length=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",I=0,A=0;for(let B=0,F=V.length;B<F;B++)I=V.charCodeAt(B),I<128?A+=1:I<2048?A+=2:I<55296||I>=57344?A+=3:(B++,A+=4);return A+1}},11882:function(V,I,A){"use strict";var B=this&&this.__createBinding||(Object.create?function(V,I,A,B){void 0===B&&(B=A);var F=Object.getOwnPropertyDescriptor(I,A);F&&!("get"in F?!I.__esModule:F.writable||F.configurable)||(F={enumerable:!0,get:function(){return I[A]}}),Object.defineProperty(V,B,F)}:function(V,I,A,B){void 0===B&&(B=A),V[B]=I[A]}),F=this&&this.__setModuleDefault||(Object.create?function(V,I){Object.defineProperty(V,"default",{enumerable:!0,value:I})}:function(V,I){V.default=I}),E=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var I={};if(null!=V)for(var A in V)"default"!==A&&Object.prototype.hasOwnProperty.call(V,A)&&B(I,V,A);return F(I,V),I};Object.defineProperty(I,"__esModule",{value:!0}),I.Room=void 0;const Y=E(A(11887)),H=A(11890),c=A(11907),b=A(11916),X=A(11921),P=A(11929),J=A(11938),G=A(11877);class w{constructor(V,I){this.onStateChange=(0,P.createSignal)(),this.onError=(0,P.createSignal)(),this.onLeave=(0,P.createSignal)(),this.onJoin=(0,P.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,X.createNanoEvents)(),this.roomId=null,this.name=V,I&&(this.serializer=new((0,b.getSerializer)("schema")),this.rootSchema=I,this.serializer.state=new I),this.onError(((V,I)=>{var A;return null===(A=console.warn)||void 0===A?void 0:A.call(console,`colyseus.js - onError => (${V}) ${I}`)})),this.onLeave((()=>this.FI()))}get id(){return this.roomId}connect(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,B=arguments.length>3?arguments[3]:void 0;const F=new H.Connection;A.connection=F,F.events.onmessage=w.prototype.onMessageCallback.bind(A),F.events.onclose=function(V){var B;if(!A.hasJoined)return null===(B=console.warn)||void 0===B||B.call(console,`Room connection was closed unexpectedly (${V.code}): ${V.reason}`),void A.onError.invoke(V.code,V.reason);V.code===G.CloseCode.DEVMODE_RESTART&&I?I():(A.onLeave.invoke(V.code,V.reason),A.destroy())},F.events.onerror=function(V){var I;null===(I=console.warn)||void 0===I||I.call(console,`Room, onError (${V.code}): ${V.reason}`),A.onError.invoke(V.code,V.reason)},F.connect(V,B)}vY(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((I=>{this.onLeave((V=>I(V))),this.connection?V?this.connection.send([c.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(G.CloseCode.CONSENTED)}))}qI(V,I){return this.onMessageHandlers.on(this.getMessageHandlerKey(V),I)}send(V,I){const A=[c.Protocol.ROOM_DATA];let B;if("string"===typeof V?J.encode.string(A,V):J.encode.number(A,V),void 0!==I){const V=Y.encode(I);B=new Uint8Array(A.length+V.byteLength),B.set(new Uint8Array(A),0),B.set(new Uint8Array(V),A.length)}else B=new Uint8Array(A);this.connection.send(B.buffer)}rb(V,I){const A=[c.Protocol.ROOM_DATA_BYTES];let B;"string"===typeof V?J.encode.string(A,V):J.encode.number(A,V),B=new Uint8Array(A.length+(I.byteLength||I.length)),B.set(new Uint8Array(A),0),B.set(new Uint8Array(I),A.length),this.connection.send(B.buffer)}get state(){return this.serializer.getState()}FI(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(V){const I=Array.from(new Uint8Array(V.data)),A=I[0];if(A===c.Protocol.JOIN_ROOM){let V=1;const A=(0,c.utf8Read)(I,V);if(V+=(0,c.utf8Length)(A),this.serializerId=(0,c.utf8Read)(I,V),V+=(0,c.utf8Length)(this.serializerId),!this.serializer){const V=(0,b.getSerializer)(this.serializerId);this.serializer=new V}I.length>V&&this.serializer.handshake&&this.serializer.handshake(I,{offset:V}),this.reconnectionToken=`${this.roomId}:${A}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([c.Protocol.JOIN_ROOM])}else if(A===c.Protocol.ERROR){const V={offset:1},A=J.decode.number(I,V),B=J.decode.string(I,V);this.onError.invoke(A,B)}else if(A===c.Protocol.LEAVE_ROOM)this.vY();else if(A===c.Protocol.ROOM_DATA_SCHEMA){const V={offset:1},A=this.serializer.getState().constructor._context.get(J.decode.number(I,V)),B=new A;B.decode(I,V),this.dispatchMessage(A,B)}else if(A===c.Protocol.ROOM_STATE)I.shift(),this.setState(I);else if(A===c.Protocol.ROOM_STATE_PATCH)I.shift(),this.patch(I);else if(A===c.Protocol.ROOM_DATA){const A={offset:1},B=J.decode.stringCheck(I,A)?J.decode.string(I,A):J.decode.number(I,A),F=I.length>A.offset?Y.decode(V.data,A.offset):void 0;this.dispatchMessage(B,F)}else if(A===c.Protocol.ROOM_DATA_BYTES){const V={offset:1},A=J.decode.stringCheck(I,V)?J.decode.string(I,V):J.decode.number(I,V);this.dispatchMessage(A,new Uint8Array(I.slice(V.offset)))}}setState(V){this.serializer.setState(V),this.onStateChange.invoke(this.serializer.getState())}patch(V){this.serializer.patch(V),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(V,I){var A;const B=this.getMessageHandlerKey(V);this.onMessageHandlers.events[B]?this.onMessageHandlers.emit(B,I):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",V,I):null===(A=console.warn)||void 0===A||A.call(console,`colyseus.js: onMessage() not registered for type '${V}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(V){switch(typeof V){case"function":return`$${V._typeid}`;case"string":return V;case"number":return`i${V}`;default:throw new Error("invalid message type.")}}}I.Room=w},11965:(V,I)=>{"use strict";let A;function B(){if(!A)try{A="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(V){}return A||(A={cache:{},setItem:function(V,I){this.cache[V]=I},getItem:function(V){this.cache[V]},removeItem:function(V){delete this.cache[V]}}),A}Object.defineProperty(I,"__esModule",{value:!0}),I.getItem=I.removeItem=I.setItem=void 0,I.setItem=function(V,I){B().setItem(V,I)},I.removeItem=function(V){B().removeItem(V)},I.getItem=function(V,I){const A=B().getItem(V);"undefined"!==typeof Promise&&A instanceof Promise?A.then((V=>I(V))):I(A)}},11921:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.createNanoEvents=void 0;I.createNanoEvents=()=>({emit(V){let I=this.events[V]||[];for(var A=arguments.length,B=new Array(A>1?A-1:0),F=1;F<A;F++)B[F-1]=arguments[F];for(let E=0,Y=I.length;E<Y;E++)I[E](...B)},events:{},on(V,I){var A;return(null===(A=this.events[V])||void 0===A?void 0:A.push(I))||(this.events[V]=[I]),()=>{var A;this.events[V]=null===(A=this.events[V])||void 0===A?void 0:A.filter((V=>I!==V))}}})},11929:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.createSignal=I.EventEmitter=void 0;class A{constructor(){this.handlers=[]}register(V){return this.handlers.push(V),this}invoke(){for(var V=arguments.length,I=new Array(V),A=0;A<V;A++)I[A]=arguments[A];this.handlers.forEach((V=>V.apply(this,I)))}invokeAsync(){for(var V=arguments.length,I=new Array(V),A=0;A<V;A++)I[A]=arguments[A];return Promise.all(this.handlers.map((V=>V.apply(this,I))))}remove(V){const I=this.handlers.indexOf(V);this.handlers[I]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}I.EventEmitter=A,I.createSignal=function(){const V=new A;function I(I){return V.register(I,null===this)}return I.once=I=>{const A=function(){for(var B=arguments.length,F=new Array(B),E=0;E<B;E++)F[E]=arguments[E];I.apply(this,F),V.remove(A)};V.register(A)},I.remove=I=>V.remove(I),I.invoke=function(){return V.invoke(...arguments)},I.invokeAsync=function(){return V.invokeAsync(...arguments)},I.clear=()=>V.clear(),I}},11877:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.ServerError=I.CloseCode=void 0,function(V){V[V.CONSENTED=4e3]="CONSENTED",V[V.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(I.CloseCode||(I.CloseCode={}));class A extends Error{constructor(V,I){super(I),this.name="ServerError",this.code=V}}I.ServerError=A},11868:(V,I,A)=>{"use strict";I.d=void 0,A(11871);var B=A(11874);Object.defineProperty(I,"d",{enumerable:!0,get:function(){return B.Client}});var F=A(11907);var E=A(11882);var Y=A(11957);const H=A(11977);const c=A(11986),b=A(11916);(0,b.registerSerializer)("schema",H.SchemaSerializer),(0,b.registerSerializer)("none",c.NoneSerializer)},11871:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=V=>null!==V&&"object"===typeof V&&V.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11887:(V,I)=>{"use strict";function A(V,I){if(this._offset=I,V instanceof ArrayBuffer)this._buffer=V,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(V))throw new Error("Invalid argument");this._buffer=V.buffer,this._view=new DataView(this._buffer,V.byteOffset,V.byteLength)}}Object.defineProperty(I,"__esModule",{value:!0}),I.decode=I.encode=void 0,A.prototype._array=function(V){for(var I=new Array(V),A=0;A<V;A++)I[A]=this._parse();return I},A.prototype._map=function(V){for(var I={},A=0;A<V;A++)I[this._parse()]=this._parse();return I},A.prototype._str=function(V){var I=function(V,I,A){for(var B="",F=0,E=I,Y=I+A;E<Y;E++){var H=V.getUint8(E);if(0!==(128&H))if(192!==(224&H))if(224!==(240&H)){if(240!==(248&H))throw new Error("Invalid byte "+H.toString(16));(F=(7&H)<<18|(63&V.getUint8(++E))<<12|(63&V.getUint8(++E))<<6|63&V.getUint8(++E))>=65536?(F-=65536,B+=String.fromCharCode(55296+(F>>>10),56320+(1023&F))):B+=String.fromCharCode(F)}else B+=String.fromCharCode((15&H)<<12|(63&V.getUint8(++E))<<6|63&V.getUint8(++E));else B+=String.fromCharCode((31&H)<<6|63&V.getUint8(++E));else B+=String.fromCharCode(H)}return B}(this._view,this._offset,V);return this._offset+=V,I},A.prototype._bin=function(V){var I=this._buffer.slice(this._offset,this._offset+V);return this._offset+=V,I},A.prototype._parse=function(){var V,I=this._view.getUint8(this._offset++),A=0,B=0,F=0,E=0;if(I<192)return I<128?I:I<144?this._map(15&I):I<160?this._array(15&I):this._str(31&I);if(I>223)return-1*(255-I+1);switch(I){case 192:return null;case 194:return!1;case 195:return!0;case 196:return A=this._view.getUint8(this._offset),this._offset+=1,this._bin(A);case 197:return A=this._view.getUint16(this._offset),this._offset+=2,this._bin(A);case 198:return A=this._view.getUint32(this._offset),this._offset+=4,this._bin(A);case 199:if(A=this._view.getUint8(this._offset),B=this._view.getInt8(this._offset+1),this._offset+=2,-1===B){var Y=this._view.getUint32(this._offset);return F=this._view.getInt32(this._offset+4),E=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*F+E)+Y/1e6)}return[B,this._bin(A)];case 200:return A=this._view.getUint16(this._offset),B=this._view.getInt8(this._offset+2),this._offset+=3,[B,this._bin(A)];case 201:return A=this._view.getUint32(this._offset),B=this._view.getInt8(this._offset+4),this._offset+=5,[B,this._bin(A)];case 202:return V=this._view.getFloat32(this._offset),this._offset+=4,V;case 203:return V=this._view.getFloat64(this._offset),this._offset+=8,V;case 204:return V=this._view.getUint8(this._offset),this._offset+=1,V;case 205:return V=this._view.getUint16(this._offset),this._offset+=2,V;case 206:return V=this._view.getUint32(this._offset),this._offset+=4,V;case 207:return F=this._view.getUint32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,F+E;case 208:return V=this._view.getInt8(this._offset),this._offset+=1,V;case 209:return V=this._view.getInt16(this._offset),this._offset+=2,V;case 210:return V=this._view.getInt32(this._offset),this._offset+=4,V;case 211:return F=this._view.getInt32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,F+E;case 212:return B=this._view.getInt8(this._offset),this._offset+=1,0===B?void(this._offset+=1):[B,this._bin(1)];case 213:return B=this._view.getInt8(this._offset),this._offset+=1,[B,this._bin(2)];case 214:return B=this._view.getInt8(this._offset),this._offset+=1,-1===B?(V=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*V)):[B,this._bin(4)];case 215:return B=this._view.getInt8(this._offset),this._offset+=1,0===B?(F=this._view.getInt32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,new Date(F+E)):-1===B?(F=this._view.getUint32(this._offset),E=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&F)+E)+(F>>>2)/1e6)):[B,this._bin(8)];case 216:return B=this._view.getInt8(this._offset),this._offset+=1,[B,this._bin(16)];case 217:return A=this._view.getUint8(this._offset),this._offset+=1,this._str(A);case 218:return A=this._view.getUint16(this._offset),this._offset+=2,this._str(A);case 219:return A=this._view.getUint32(this._offset),this._offset+=4,this._str(A);case 220:return A=this._view.getUint16(this._offset),this._offset+=2,this._array(A);case 221:return A=this._view.getUint32(this._offset),this._offset+=4,this._array(A);case 222:return A=this._view.getUint16(this._offset),this._offset+=2,this._map(A);case 223:return A=this._view.getUint32(this._offset),this._offset+=4,this._map(A)}throw new Error("Could not parse")},I.decode=function(V){var I=new A(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),B=I._parse();if(I._offset!==V.byteLength)throw new Error(V.byteLength-I._offset+" trailing bytes");return B};function B(V,I,A){for(var B=0,F=0,E=A.length;F<E;F++)(B=A.charCodeAt(F))<128?V.setUint8(I++,B):B<2048?(V.setUint8(I++,192|B>>6),V.setUint8(I++,128|63&B)):B<55296||B>=57344?(V.setUint8(I++,224|B>>12),V.setUint8(I++,128|B>>6&63),V.setUint8(I++,128|63&B)):(F++,B=65536+((1023&B)<<10|1023&A.charCodeAt(F)),V.setUint8(I++,240|B>>18),V.setUint8(I++,128|B>>12&63),V.setUint8(I++,128|B>>6&63),V.setUint8(I++,128|63&B))}function F(V,I,A){var B=typeof A,E=0,Y=0,H=0,c=0,b=0,X=0;if("string"===B){if(b=function(V){for(var I=0,A=0,B=0,F=V.length;B<F;B++)(I=V.charCodeAt(B))<128?A+=1:I<2048?A+=2:I<55296||I>=57344?A+=3:(B++,A+=4);return A}(A),b<32)V.push(160|b),X=1;else if(b<256)V.push(217,b),X=2;else if(b<65536)V.push(218,b>>8,b),X=3;else{if(!(b<4294967296))throw new Error("String too long");V.push(219,b>>24,b>>16,b>>8,b),X=5}return I.push({_str:A,_length:b,_offset:V.length}),X+b}if("number"===B)return Math.floor(A)===A&&isFinite(A)?A>=0?A<128?(V.push(A),1):A<256?(V.push(204,A),2):A<65536?(V.push(205,A>>8,A),3):A<4294967296?(V.push(206,A>>24,A>>16,A>>8,A),5):(H=A/Math.pow(2,32)|0,c=A>>>0,V.push(207,H>>24,H>>16,H>>8,H,c>>24,c>>16,c>>8,c),9):A>=-32?(V.push(A),1):A>=-128?(V.push(208,A),2):A>=-32768?(V.push(209,A>>8,A),3):A>=-2147483648?(V.push(210,A>>24,A>>16,A>>8,A),5):(H=Math.floor(A/Math.pow(2,32)),c=A>>>0,V.push(211,H>>24,H>>16,H>>8,H,c>>24,c>>16,c>>8,c),9):(V.push(203),I.push({_float:A,_length:8,_offset:V.length}),9);if("object"===B){if(null===A)return V.push(192),1;if(Array.isArray(A)){if((b=A.length)<16)V.push(144|b),X=1;else if(b<65536)V.push(220,b>>8,b),X=3;else{if(!(b<4294967296))throw new Error("Array too large");V.push(221,b>>24,b>>16,b>>8,b),X=5}for(E=0;E<b;E++)X+=F(V,I,A[E]);return X}if(A instanceof Date){var P=A.getTime(),J=Math.floor(P/1e3),G=1e6*(P-1e3*J);return J>=0&&G>=0&&J<=17179869183?0===G&&J<=4294967295?(V.push(214,255,J>>24,J>>16,J>>8,J),6):(H=J/4294967296,c=4294967295&J,V.push(215,255,G>>22,G>>14,G>>6,H,c>>24,c>>16,c>>8,c),10):(H=Math.floor(J/4294967296),c=J>>>0,V.push(199,12,255,G>>24,G>>16,G>>8,G,H>>24,H>>16,H>>8,H,c>>24,c>>16,c>>8,c),15)}if(A instanceof ArrayBuffer){if((b=A.byteLength)<256)V.push(196,b),X=2;else if(b<65536)V.push(197,b>>8,b),X=3;else{if(!(b<4294967296))throw new Error("Buffer too large");V.push(198,b>>24,b>>16,b>>8,b),X=5}return I.push({_bin:A,_length:b,_offset:V.length}),X+b}if("function"===typeof A.toJSON)return F(V,I,A.toJSON());var w=[],t="",u=Object.keys(A);for(E=0,Y=u.length;E<Y;E++)void 0!==A[t=u[E]]&&"function"!==typeof A[t]&&w.push(t);if((b=w.length)<16)V.push(128|b),X=1;else if(b<65536)V.push(222,b>>8,b),X=3;else{if(!(b<4294967296))throw new Error("Object too large");V.push(223,b>>24,b>>16,b>>8,b),X=5}for(E=0;E<b;E++)X+=F(V,I,t=w[E]),X+=F(V,I,A[t]);return X}if("boolean"===B)return V.push(A?195:194),1;if("undefined"===B)return V.push(192),1;if("function"===typeof A.toJSON)return F(V,I,A.toJSON());throw new Error("Could not encode")}I.encode=function(V){var I=[],A=[],E=F(I,A,V),Y=new ArrayBuffer(E),H=new DataView(Y),c=0,b=0,X=-1;A.length>0&&(X=A[0]._offset);for(var P,J=0,G=0,w=0,t=I.length;w<t;w++)if(H.setUint8(b+w,I[w]),w+1===X){if(J=(P=A[c])._length,G=b+X,P._bin)for(var u=new Uint8Array(P._bin),W=0;W<J;W++)H.setUint8(G+W,u[W]);else P._str?B(H,G,P._str):void 0!==P._float&&H.setFloat64(G,P._float);b+=J,A[++c]&&(X=A[c]._offset)}return Y}},11986:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.NoneSerializer=void 0;I.NoneSerializer=class{setState(V){}getState(){return null}patch(V){}teardown(){}handshake(V){}}},11977:(V,I,A)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.SchemaSerializer=void 0;const B=A(11938);I.SchemaSerializer=class{setState(V){return this.state.decode(V)}getState(){return this.state}patch(V){return this.state.decode(V)}teardown(){var V,I;null===(I=null===(V=this.state)||void 0===V?void 0:V.$changes)||void 0===I||I.root.clearRefs()}handshake(V,I){if(this.state){(new B.Reflection).decode(V,I)}else this.state=B.Reflection.decode(V,I)}}},11916:(V,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.getSerializer=I.registerSerializer=void 0;const A={};I.registerSerializer=function(V,I){A[V]=I},I.getSerializer=function(V){const I=A[V];if(!I)throw new Error("missing serializer: "+V);return I}},11895:function(V,I,A){"use strict";var B=this&&this.__importDefault||function(V){return V&&V.__esModule?V:{default:V}};Object.defineProperty(I,"__esModule",{value:!0}),I.WebSocketTransport=void 0;const F=B(A(11899)),E=globalThis.WebSocket||F.default;I.WebSocketTransport=class{constructor(V){this.events=V}send(V){V instanceof ArrayBuffer?this.ws.send(V):Array.isArray(V)&&this.ws.send(new Uint8Array(V).buffer)}connect(V,I){try{this.ws=new E(V,{headers:I,protocols:this.protocols})}catch(A){this.ws=new E(V,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(V,I){this.ws.close(V,I)}get isOpen(){return this.ws.readyState===E.OPEN}}},11899:V=>{"use strict";V.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12389:V=>{"use strict";V.exports=function(V){for(var I=new Array(V),A=0;A<V;++A)I[A]=A;return I}},12396:V=>{function I(V){return!!V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}V.exports=function(V){return null!=V&&(I(V)||function(V){return"function"===typeof V.readFloatLE&&"function"===typeof V.slice&&I(V.slice(0,0))}(V)||!!V._isBuffer)}},12380:(V,I,A)=>{var B=A(12389),F=A(12396),E="undefined"!==typeof Float64Array;function Y(V,I){return V[0]-I[0]}function H(){var V,I=this.stride,A=new Array(I.length);for(V=0;V<A.length;++V)A[V]=[Math.abs(I[V]),V];A.sort(Y);var B=new Array(A.length);for(V=0;V<B.length;++V)B[V]=A[V][1];return B}function c(V,I){var A=["View",I,"d",V].join("");I<0&&(A="View_Nil"+V);var F="generic"===V;if(-1===I){var E="function "+A+"(a){this.data=a;};var proto="+A+".prototype;proto.dtype='"+V+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+A+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+A+"(a){return new "+A+"(a);}";return new Function(E)()}if(0===I){E="function "+A+"(a,d) {this.data = a;this.offset = d};var proto="+A+".prototype;proto.dtype='"+V+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+A+"_copy() {return new "+A+"(this.data,this.offset)};proto.pick=function "+A+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+A+"_get(){return "+(F?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+A+"_set(v){return "+(F?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+A+"(a,b,c,d){return new "+A+"(a,d)}";return new Function("TrivialArray",E)(b[V][0])}E=["'use strict'"];var Y=B(I),c=Y.map((function(V){return"i"+V})),X="this.offset+"+Y.map((function(V){return"this.stride["+V+"]*i"+V})).join("+"),P=Y.map((function(V){return"b"+V})).join(","),J=Y.map((function(V){return"c"+V})).join(",");E.push("function "+A+"(a,"+P+","+J+",d){this.data=a","this.shape=["+P+"]","this.stride=["+J+"]","this.offset=d|0}","var proto="+A+".prototype","proto.dtype='"+V+"'","proto.dimension="+I),E.push("Object.defineProperty(proto,'size',{get:function "+A+"_size(){return "+Y.map((function(V){return"this.shape["+V+"]"})).join("*"),"}})"),1===I?E.push("proto.order=[0]"):(E.push("Object.defineProperty(proto,'order',{get:"),I<4?(E.push("function "+A+"_order(){"),2===I?E.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===I&&E.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):E.push("ORDER})")),E.push("proto.set=function "+A+"_set("+c.join(",")+",v){"),F?E.push("return this.data.set("+X+",v)}"):E.push("return this.data["+X+"]=v}"),E.push("proto.get=function "+A+"_get("+c.join(",")+"){"),F?E.push("return this.data.get("+X+")}"):E.push("return this.data["+X+"]}"),E.push("proto.index=function "+A+"_index(",c.join(),"){return "+X+"}"),E.push("proto.hi=function "+A+"_hi("+c.join(",")+"){return new "+A+"(this.data,"+Y.map((function(V){return["(typeof i",V,"!=='number'||i",V,"<0)?this.shape[",V,"]:i",V,"|0"].join("")})).join(",")+","+Y.map((function(V){return"this.stride["+V+"]"})).join(",")+",this.offset)}");var G=Y.map((function(V){return"a"+V+"=this.shape["+V+"]"})),w=Y.map((function(V){return"c"+V+"=this.stride["+V+"]"}));E.push("proto.lo=function "+A+"_lo("+c.join(",")+"){var b=this.offset,d=0,"+G.join(",")+","+w.join(","));for(var t=0;t<I;++t)E.push("if(typeof i"+t+"==='number'&&i"+t+">=0){d=i"+t+"|0;b+=c"+t+"*d;a"+t+"-=d}");E.push("return new "+A+"(this.data,"+Y.map((function(V){return"a"+V})).join(",")+","+Y.map((function(V){return"c"+V})).join(",")+",b)}"),E.push("proto.step=function "+A+"_step("+c.join(",")+"){var "+Y.map((function(V){return"a"+V+"=this.shape["+V+"]"})).join(",")+","+Y.map((function(V){return"b"+V+"=this.stride["+V+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(t=0;t<I;++t)E.push("if(typeof i"+t+"==='number'){d=i"+t+"|0;if(d<0){c+=b"+t+"*(a"+t+"-1);a"+t+"=ceil(-a"+t+"/d)}else{a"+t+"=ceil(a"+t+"/d)}b"+t+"*=d}");E.push("return new "+A+"(this.data,"+Y.map((function(V){return"a"+V})).join(",")+","+Y.map((function(V){return"b"+V})).join(",")+",c)}");var u=new Array(I),W=new Array(I);for(t=0;t<I;++t)u[t]="a[i"+t+"]",W[t]="b[i"+t+"]";E.push("proto.transpose=function "+A+"_transpose("+c+"){"+c.map((function(V,I){return V+"=("+V+"===undefined?"+I+":"+V+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+A+"(this.data,"+u.join(",")+","+W.join(",")+",this.offset)}"),E.push("proto.pick=function "+A+"_pick("+c+"){var a=[],b=[],c=this.offset");for(t=0;t<I;++t)E.push("if(typeof i"+t+"==='number'&&i"+t+">=0){c=(c+this.stride["+t+"]*i"+t+")|0}else{a.push(this.shape["+t+"]);b.push(this.stride["+t+"])}");return E.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),E.push("return function construct_"+A+"(data,shape,stride,offset){return new "+A+"(data,"+Y.map((function(V){return"shape["+V+"]"})).join(",")+","+Y.map((function(V){return"stride["+V+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",E.join("\n"))(b[V],H)}var b={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};V.exports=function(V,I,A,B){if(void 0===V)return(0,b.array[0])([]);"number"===typeof V&&(V=[V]),void 0===I&&(I=[V.length]);var Y=I.length;if(void 0===A){A=new Array(Y);for(var H=Y-1,X=1;H>=0;--H)A[H]=X,X*=I[H]}if(void 0===B){B=0;for(H=0;H<Y;++H)A[H]<0&&(B-=(I[H]-1)*A[H])}for(var P=function(V){if(F(V))return"buffer";if(E)switch(Object.prototype.toString.call(V)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(V)?"array":"generic"}(V),J=b[P];J.length<=Y+1;)J.push(c(P,J.length-1));return(0,J[Y+1])(V,I,A,B)}},13322:V=>{var I;self,I=()=>(()=>{"use strict";var V={d:(I,A)=>{for(var B in A)V.o(A,B)&&!V.o(I,B)&&Object.defineProperty(I,B,{enumerable:!0,get:A[B]})},o:(V,I)=>Object.prototype.hasOwnProperty.call(V,I)},I={};V.d(I,{default:()=>R});var A,B=function(V,I){var A=I.x-V.x,B=I.y-V.y;return Math.sqrt(A*A+B*B)},F=function(V){return V*(Math.PI/180)},E=new Map,Y=function(V){E.has(V)&&clearTimeout(E.get(V)),E.set(V,setTimeout(V,100))},H=function(V,I,A){for(var B,F=I.split(/[ ,]+/g),E=0;E<F.length;E+=1)B=F[E],V.addEventListener?V.addEventListener(B,A,!1):V.attachEvent&&V.attachEvent(B,A)},c=function(V,I,A){for(var B,F=I.split(/[ ,]+/g),E=0;E<F.length;E+=1)B=F[E],V.removeEventListener?V.removeEventListener(B,A):V.detachEvent&&V.detachEvent(B,A)},b=function(V){return V.preventDefault(),V.type.match(/^touch/)?V.changedTouches:V},X=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},P=function(V,I){I.top||I.right||I.bottom||I.left?(V.style.top=I.top,V.style.right=I.right,V.style.bottom=I.bottom,V.style.left=I.left):(V.style.left=I.x+"px",V.style.top=I.y+"px")},J=function(V,I,A){var B=G(V);for(var F in B)if(B.hasOwnProperty(F))if("string"==typeof I)B[F]=I+" "+A;else{for(var E="",Y=0,H=I.length;Y<H;Y+=1)E+=I[Y]+" "+A+", ";B[F]=E.slice(0,-2)}return B},G=function(V){var I={};return I[V]="",["webkit","Moz","o"].forEach((function(A){I[A+V.charAt(0).toUpperCase()+V.slice(1)]=""})),I},w=function(V,I){for(var A in I)I.hasOwnProperty(A)&&(V[A]=I[A]);return V},t=function(V,I){if(V.length)for(var A=0,B=V.length;A<B;A+=1)I(V[A]);else I(V)},u="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,W=window.matchMedia("(any-hover: none)").matches,g=!!("ontouchstart"in window),o=!!window.PointerEvent,L=!!window.MSPointerEvent,z={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},m={start:"mousedown",move:"mousemove",end:"mouseup"},s={};function e(){}u&&!W?A=z:o?A={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:L?A={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:g?(A=z,s=m):A=m,e.prototype.on=function(V,I){var A,B=this,F=V.split(/[ ,]+/g);B._handlers_=B._handlers_||{};for(var E=0;E<F.length;E+=1)A=F[E],B._handlers_[A]=B._handlers_[A]||[],B._handlers_[A].push(I);return B},e.prototype.off=function(V,I){var A=this;return A._handlers_=A._handlers_||{},void 0===V?A._handlers_={}:void 0===I?A._handlers_[V]=null:A._handlers_[V]&&A._handlers_[V].indexOf(I)>=0&&A._handlers_[V].splice(A._handlers_[V].indexOf(I),1),A},e.prototype.trigger=function(V,I){var A,B=this,F=V.split(/[ ,]+/g);B._handlers_=B._handlers_||{};for(var E=0;E<F.length;E+=1)A=F[E],B._handlers_[A]&&B._handlers_[A].length&&B._handlers_[A].forEach((function(V){V.call(B,{type:A,target:B},I)}))},e.prototype.config=function(V){var I=this;I.options=I.defaults||{},V&&(I.options=function(V,I){var A={};for(var B in V)V.hasOwnProperty(B)&&I.hasOwnProperty(B)?A[B]=I[B]:V.hasOwnProperty(B)&&(A[B]=V[B]);return A}(I.options,V))},e.prototype.bindEvt=function(V,I){var B=this;return B._domHandlers_=B._domHandlers_||{},B._domHandlers_[I]=function(){"function"==typeof B["on"+I]?B["on"+I].apply(B,arguments):console.warn('[WARNING] : Missing "on'+I+'" handler.')},H(V,A[I],B._domHandlers_[I]),s[I]&&H(V,s[I],B._domHandlers_[I]),B},e.prototype.unbindEvt=function(V,I){var B=this;return B._domHandlers_=B._domHandlers_||{},c(V,A[I],B._domHandlers_[I]),s[I]&&c(V,s[I],B._domHandlers_[I]),delete B._domHandlers_[I],this};const S=e;function Q(V,I){return this.identifier=I.identifier,this.position=I.position,this.frontPosition=I.frontPosition,this.collection=V,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(I),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=Q.id,Q.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Q.prototype=new S,Q.constructor=Q,Q.id=0,Q.prototype.buildEl=function(V){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},Q.prototype.stylize=function(){if(this.options.dataOnly)return this;var V=this.options.fadeTime+"ms",I=function(){var V=G("borderRadius");for(var I in V)V.hasOwnProperty(I)&&(V[I]="50%");return V}(),A=J("transition","opacity",V),B={};return B.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},B.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},B.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},w(B.el,A),"circle"===this.options.shape&&w(B.back,I),w(B.front,I),this.applyStyles(B),this},Q.prototype.applyStyles=function(V){for(var I in this.ui)if(this.ui.hasOwnProperty(I))for(var A in V[I])this.ui[I].style[A]=V[I][A];return this},Q.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},Q.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},Q.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},Q.prototype.show=function(V){var I=this;return I.options.dataOnly||(clearTimeout(I.removeTimeout),clearTimeout(I.showTimeout),clearTimeout(I.restTimeout),I.addToDom(),I.restCallback(),setTimeout((function(){I.ui.el.style.opacity=1}),0),I.showTimeout=setTimeout((function(){I.trigger("shown",I.instance),"function"==typeof V&&V.call(this)}),I.options.fadeTime)),I},Q.prototype.hide=function(V){var I=this;if(I.options.dataOnly)return I;if(I.ui.el.style.opacity=I.options.restOpacity,clearTimeout(I.removeTimeout),clearTimeout(I.showTimeout),clearTimeout(I.restTimeout),I.removeTimeout=setTimeout((function(){var A="dynamic"===I.options.mode?"none":"block";I.ui.el.style.display=A,"function"==typeof V&&V.call(I),I.trigger("hidden",I.instance)}),I.options.fadeTime),I.options.restJoystick){var A=I.options.restJoystick,B={};B.x=!0===A||!1!==A.x?0:I.instance.frontPosition.x,B.y=!0===A||!1!==A.y?0:I.instance.frontPosition.y,I.setPosition(V,B)}return I},Q.prototype.setPosition=function(V,I){var A=this;A.frontPosition={x:I.x,y:I.y};var B=A.options.fadeTime+"ms",F={};F.front=J("transition",["transform"],B);var E={front:{}};E.front={transform:"translate("+A.frontPosition.x+"px,"+A.frontPosition.y+"px)"},A.applyStyles(F),A.applyStyles(E),A.restTimeout=setTimeout((function(){"function"==typeof V&&V.call(A),A.restCallback()}),A.options.fadeTime)},Q.prototype.restCallback=function(){var V=this,I={};I.front=J("transition","none",""),V.applyStyles(I),V.trigger("rested",V.instance)},Q.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},Q.prototype.computeDirection=function(V){var I,A,B,F=V.angle.radian,E=Math.PI/4,Y=Math.PI/2;if(F>E&&F<3*E&&!V.lockX?I="up":F>-E&&F<=E&&!V.lockY?I="left":F>3*-E&&F<=-E&&!V.lockX?I="down":V.lockY||(I="right"),V.lockY||(A=F>-Y&&F<Y?"left":"right"),V.lockX||(B=F>0?"up":"down"),V.force>this.options.threshold){var H,c={};for(H in this.direction)this.direction.hasOwnProperty(H)&&(c[H]=this.direction[H]);var b={};for(H in this.direction={x:A,y:B,angle:I},V.direction=this.direction,c)c[H]===this.direction[H]&&(b[H]=!0);if(b.x&&b.y&&b.angle)return V;b.x&&b.y||this.trigger("plain",V),b.x||this.trigger("plain:"+A,V),b.y||this.trigger("plain:"+B,V),b.angle||this.trigger("dir dir:"+I,V)}else this.resetDirection();return V};const h=Q;function r(V,I){var A=this;A.nipples=[],A.idles=[],A.actives=[],A.ids=[],A.pressureIntervals={},A.manager=V,A.id=r.id,r.id+=1,A.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},A.config(I),"static"!==A.options.mode&&"semi"!==A.options.mode||(A.options.multitouch=!1),A.options.multitouch||(A.options.maxNumberOfNipples=1);var B=getComputedStyle(A.options.zone.parentElement);return B&&"flex"===B.display&&(A.parentIsFlex=!0),A.updateBox(),A.prepareNipples(),A.WG(),A.begin(),A.nipples}r.prototype=new S,r.constructor=r,r.id=0,r.prototype.prepareNipples=function(){var V=this,I=V.nipples;I.on=V.on.bind(V),I.off=V.off.bind(V),I.options=V.options,I.destroy=V.destroy.bind(V),I.ids=V.ids,I.id=V.id,I.processOnMove=V.processOnMove.bind(V),I.processOnEnd=V.processOnEnd.bind(V),I.get=function(V){if(void 0===V)return I[0];for(var A=0,B=I.length;A<B;A+=1)if(I[A].identifier===V)return I[A];return!1}},r.prototype.WG=function(){var V=this;V.bindEvt(V.options.zone,"start"),V.options.zone.style.touchAction="none",V.options.zone.style.msTouchAction="none"},r.prototype.begin=function(){var V=this,I=V.options;if("static"===I.mode){var A=V.createNipple(I.position,V.manager.getIdentifier());A.add(),V.idles.push(A)}},r.prototype.createNipple=function(V,I){var A=this,B=A.manager.scroll,F={},E=A.options,Y=A.parentIsFlex?B.x:B.x+A.box.left,H=A.parentIsFlex?B.y:B.y+A.box.top;if(V.x&&V.y)F={x:V.x-Y,y:V.y-H};else if(V.top||V.right||V.bottom||V.left){var c=document.createElement("DIV");c.style.display="hidden",c.style.top=V.top,c.style.right=V.right,c.style.bottom=V.bottom,c.style.left=V.left,c.style.position="absolute",E.zone.appendChild(c);var b=c.getBoundingClientRect();E.zone.removeChild(c),F=V,V={x:b.left+B.x,y:b.top+B.y}}var X=new h(A,{color:E.color,size:E.size,threshold:E.threshold,fadeTime:E.fadeTime,dataOnly:E.dataOnly,restJoystick:E.restJoystick,restOpacity:E.restOpacity,mode:E.mode,identifier:I,position:V,zone:E.zone,frontPosition:{x:0,y:0},shape:E.shape});return E.dataOnly||(P(X.ui.el,F),P(X.ui.front,X.frontPosition)),A.nipples.push(X),A.trigger("added "+X.identifier+":added",X),A.manager.trigger("added "+X.identifier+":added",X),A.bindNipple(X),X},r.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},r.prototype.bindNipple=function(V){var I,A=this,B=function(V,B){I=V.type+" "+B.id+":"+V.type,A.trigger(I,B)};V.on("destroyed",A.onDestroyed.bind(A)),V.on("shown hidden rested dir plain",B),V.on("dir:up dir:right dir:down dir:left",B),V.on("plain:up plain:right plain:down plain:left",B)},r.prototype.pressureFn=function(V,I,A){var B=this,F=0;clearInterval(B.pressureIntervals[A]),B.pressureIntervals[A]=setInterval(function(){var A=V.force||V.pressure||V.webkitForce||0;A!==F&&(I.trigger("pressure",A),B.trigger("pressure "+I.identifier+":pressure",A),F=A)}.bind(B),100)},r.prototype.onstart=function(V){var I=this,A=I.options,B=V;return V=b(V),I.updateBox(),t(V,(function(F){I.actives.length<A.maxNumberOfNipples?I.processOnStart(F):B.type.match(/^touch/)&&(Object.keys(I.manager.ids).forEach((function(A){if(Object.values(B.touches).findIndex((function(V){return V.identifier===A}))<0){var F=[V[0]];F.identifier=A,I.processOnEnd(F)}})),I.actives.length<A.maxNumberOfNipples&&I.processOnStart(F))})),I.manager.bindDocument(),!1},r.prototype.processOnStart=function(V){var I,A=this,F=A.options,E=A.manager.getIdentifier(V),Y=V.force||V.pressure||V.webkitForce||0,H={x:V.pageX,y:V.pageY},c=A.getOrCreate(E,H);c.identifier!==E&&A.manager.removeIdentifier(c.identifier),c.identifier=E;var b=function(I){I.trigger("start",I),A.trigger("start "+I.id+":start",I),I.show(),Y>0&&A.pressureFn(V,I,I.identifier),A.processOnMove(V)};if((I=A.idles.indexOf(c))>=0&&A.idles.splice(I,1),A.actives.push(c),A.ids.push(c.identifier),"semi"!==F.mode)b(c);else{if(!(B(H,c.position)<=F.catchDistance))return c.destroy(),void A.processOnStart(V);b(c)}return c},r.prototype.getOrCreate=function(V,I){var A,B=this,F=B.options;return/(semi|static)/.test(F.mode)?(A=B.idles[0])?(B.idles.splice(0,1),A):"semi"===F.mode?B.createNipple(I,V):(console.warn("Coudln't find the needed nipple."),!1):A=B.createNipple(I,V)},r.prototype.processOnMove=function(V){var I=this,A=I.options,E=I.manager.getIdentifier(V),Y=I.nipples.get(E),H=I.manager.scroll;if(function(V){return isNaN(V.buttons)?0!==V.pressure:0!==V.buttons}(V)){if(!Y)return console.error("Found zombie joystick with ID "+E),void I.manager.removeIdentifier(E);if(A.dynamicPage){var c=Y.el.getBoundingClientRect();Y.position={x:H.x+c.left,y:H.y+c.top}}Y.identifier=E;var b=Y.options.size/2,X={x:V.pageX,y:V.pageY};A.lockX&&(X.y=Y.position.y),A.lockY&&(X.x=Y.position.x);var P,J,G,w,t,u,W,g,o,L,z=B(X,Y.position),m=(P=X,G=(J=Y.position).x-P.x,w=J.y-P.y,function(V){return V*(180/Math.PI)}(Math.atan2(w,G))),s=F(m),e=z/b,S={distance:z,position:X};if("circle"===Y.options.shape?(t=Math.min(z,b),W=Y.position,g=t,L={x:0,y:0},o=F(o=m),L.x=W.x-g*Math.cos(o),L.y=W.y-g*Math.sin(o),u=L):(u=function(V,I,A){return{x:Math.min(Math.max(V.x,I.x-A),I.x+A),y:Math.min(Math.max(V.y,I.y-A),I.y+A)}}(X,Y.position,b),t=B(u,Y.position)),A.follow){if(z>b){var Q=X.x-u.x,h=X.y-u.y;Y.position.x+=Q,Y.position.y+=h,Y.el.style.top=Y.position.y-(I.box.top+H.y)+"px",Y.el.style.left=Y.position.x-(I.box.left+H.x)+"px",z=B(X,Y.position)}}else X=u,z=t;var r=X.x-Y.position.x,M=X.y-Y.position.y;Y.frontPosition={x:r,y:M},A.dataOnly||(Y.ui.front.style.transform="translate("+r+"px,"+M+"px)");var x={identifier:Y.identifier,position:X,force:e,pressure:V.force||V.pressure||V.webkitForce||0,distance:z,angle:{radian:s,degree:m},vector:{x:r/b,y:-M/b},raw:S,instance:Y,lockX:A.lockX,lockY:A.lockY};(x=Y.computeDirection(x)).angle={radian:F(180-m),degree:180-m},Y.trigger("move",x),I.trigger("move "+Y.id+":move",x)}else this.processOnEnd(V)},r.prototype.processOnEnd=function(V){var I=this,A=I.options,B=I.manager.getIdentifier(V),F=I.nipples.get(B),E=I.manager.removeIdentifier(F.identifier);F&&(A.dataOnly||F.hide((function(){"dynamic"===A.mode&&(F.trigger("removed",F),I.trigger("removed "+F.id+":removed",F),I.manager.trigger("removed "+F.id+":removed",F),F.destroy())})),clearInterval(I.pressureIntervals[F.identifier]),F.resetDirection(),F.trigger("end",F),I.trigger("end "+F.id+":end",F),I.ids.indexOf(F.identifier)>=0&&I.ids.splice(I.ids.indexOf(F.identifier),1),I.actives.indexOf(F)>=0&&I.actives.splice(I.actives.indexOf(F),1),/(semi|static)/.test(A.mode)?I.idles.push(F):I.nipples.indexOf(F)>=0&&I.nipples.splice(I.nipples.indexOf(F),1),I.manager.unbindDocument(),/(semi|static)/.test(A.mode)&&(I.manager.ids[E.id]=E.identifier))},r.prototype.onDestroyed=function(V,I){var A=this;A.nipples.indexOf(I)>=0&&A.nipples.splice(A.nipples.indexOf(I),1),A.actives.indexOf(I)>=0&&A.actives.splice(A.actives.indexOf(I),1),A.idles.indexOf(I)>=0&&A.idles.splice(A.idles.indexOf(I),1),A.ids.indexOf(I.identifier)>=0&&A.ids.splice(A.ids.indexOf(I.identifier),1),A.manager.removeIdentifier(I.identifier),A.manager.unbindDocument()},r.prototype.destroy=function(){var V=this;for(var I in V.unbindEvt(V.options.zone,"start"),V.nipples.forEach((function(V){V.destroy()})),V.pressureIntervals)V.pressureIntervals.hasOwnProperty(I)&&clearInterval(V.pressureIntervals[I]);V.trigger("destroyed",V.nipples),V.manager.unbindDocument(),V.off()};const M=r;function x(V){var I=this;I.ids={},I.index=0,I.collections=[],I.scroll=X(),I.config(V),I.prepareCollections();var A=function(){var V;I.collections.forEach((function(A){A.forEach((function(A){V=A.el.getBoundingClientRect(),A.position={x:I.scroll.x+V.left,y:I.scroll.y+V.top}}))}))};H(window,"resize",(function(){Y(A)}));var B=function(){I.scroll=X()};return H(window,"scroll",(function(){Y(B)})),I.collections}x.prototype=new S,x.constructor=x,x.prototype.prepareCollections=function(){var V=this;V.collections.create=V.create.bind(V),V.collections.on=V.on.bind(V),V.collections.off=V.off.bind(V),V.collections.destroy=V.destroy.bind(V),V.collections.get=function(I){var A;return V.collections.every((function(V){return!(A=V.get(I))})),A}},x.prototype.create=function(V){return this.createCollection(V)},x.prototype.createCollection=function(V){var I=this,A=new M(I,V);return I.bindCollection(A),I.collections.push(A),A},x.prototype.bindCollection=function(V){var I,A=this,B=function(V,B){I=V.type+" "+B.id+":"+V.type,A.trigger(I,B)};V.on("destroyed",A.onDestroyed.bind(A)),V.on("shown hidden rested dir plain",B),V.on("dir:up dir:right dir:down dir:left",B),V.on("plain:up plain:right plain:down plain:left",B)},x.prototype.bindDocument=function(){var V=this;V.binded||(V.bindEvt(document,"move").bindEvt(document,"end"),V.binded=!0)},x.prototype.unbindDocument=function(V){var I=this;Object.keys(I.ids).length&&!0!==V||(I.unbindEvt(document,"move").unbindEvt(document,"end"),I.binded=!1)},x.prototype.getIdentifier=function(V){var I;return V?void 0===(I=void 0===V.identifier?V.pointerId:V.identifier)&&(I=this.latest||0):I=this.index,void 0===this.ids[I]&&(this.ids[I]=this.index,this.index+=1),this.latest=I,this.ids[I]},x.prototype.removeIdentifier=function(V){var I={};for(var A in this.ids)if(this.ids[A]===V){I.id=A,I.identifier=this.ids[A],delete this.ids[A];break}return I},x.prototype.onmove=function(V){return this.onAny("move",V),!1},x.prototype.onend=function(V){return this.onAny("end",V),!1},x.prototype.oncancel=function(V){return this.onAny("end",V),!1},x.prototype.onAny=function(V,I){var A,B=this,F="processOn"+V.charAt(0).toUpperCase()+V.slice(1);I=b(I);var E=function(V,I,A){A.ids.indexOf(I)>=0&&(A[F](V),V._found_=!0)};return t(I,(function(V){A=B.getIdentifier(V),t(B.collections,E.bind(null,V,A)),V._found_||B.removeIdentifier(A)})),!1},x.prototype.destroy=function(){var V=this;V.unbindDocument(!0),V.ids={},V.index=0,V.collections.forEach((function(V){V.destroy()})),V.off()},x.prototype.onDestroyed=function(V,I){var A=this;if(A.collections.indexOf(I)<0)return!1;A.collections.splice(A.collections.indexOf(I),1)};var f=new x;const R={create:function(V){return f.create(V)},factory:f};return I.default})(),V.exports=I()},12416:(V,I,A)=>{"use strict";const{Deflate:B,deflate:F,deflateRaw:E,gzip:Y}=A(12420),{Inflate:H,inflate:c,inflateRaw:b,ungzip:X}=A(12460),P=A(12445);V.exports.Deflate=B,V.exports.deflate=F,V.exports.deflateRaw=E,V.exports.gzip=Y,V.exports.Inflate=H,V.exports.inflate=c,V.exports.inflateRaw=b,V.exports.ungzip=X,V.exports.constants=P},12420:(V,I,A)=>{"use strict";const B=A(12428),F=A(12448),E=A(12451),Y=A(12441),H=A(12456),c=Object.prototype.toString,{Z_NO_FLUSH:b,Z_SYNC_FLUSH:X,Z_FULL_FLUSH:P,Z_FINISH:J,Z_OK:G,Z_STREAM_END:w,Z_DEFAULT_COMPRESSION:t,Z_DEFAULT_STRATEGY:u,Z_DEFLATED:W}=A(12445);function g(V){this.options=F.assign({level:t,method:W,yV:16384,windowBits:15,memLevel:8,strategy:u},V||{});let I=this.options;I.raw&&I.windowBits>0?I.windowBits=-I.windowBits:I.gzip&&I.windowBits>0&&I.windowBits<16&&(I.windowBits+=16),this.err=0,this.bI="",this.ended=!1,this.chunks=[],this.strm=new H,this.strm.avail_out=0;let A=B.deflateInit2(this.strm,I.level,I.method,I.windowBits,I.memLevel,I.strategy);if(A!==G)throw new Error(Y[A]);if(I.header&&B.deflateSetHeader(this.strm,I.header),I.dictionary){let V;if(V="string"===typeof I.dictionary?E.string2buf(I.dictionary):"[object ArrayBuffer]"===c.call(I.dictionary)?new Uint8Array(I.dictionary):I.dictionary,A=B.deflateSetDictionary(this.strm,V),A!==G)throw new Error(Y[A]);this._dict_set=!0}}function o(V,I){const A=new g(I);if(A.push(V,!0),A.err)throw A.bI||Y[A.err];return A.result}g.prototype.push=function(V,I){const A=this.strm,F=this.options.yV;let Y,H;if(this.ended)return!1;for(H=I===~~I?I:!0===I?J:b,"string"===typeof V?A.input=E.string2buf(V):"[object ArrayBuffer]"===c.call(V)?A.input=new Uint8Array(V):A.input=V,A.next_in=0,A.avail_in=A.input.length;;)if(0===A.avail_out&&(A.output=new Uint8Array(F),A.next_out=0,A.avail_out=F),(H===X||H===P)&&A.avail_out<=6)this.onData(A.output.subarray(0,A.next_out)),A.avail_out=0;else{if(Y=B.deflate(A,H),Y===w)return A.next_out>0&&this.onData(A.output.subarray(0,A.next_out)),Y=B.deflateEnd(this.strm),this.onEnd(Y),this.ended=!0,Y===G;if(0!==A.avail_out){if(H>0&&A.next_out>0)this.onData(A.output.subarray(0,A.next_out)),A.avail_out=0;else if(0===A.avail_in)break}else this.onData(A.output)}return!0},g.prototype.onData=function(V){this.chunks.push(V)},g.prototype.onEnd=function(V){V===G&&(this.result=F.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.bI=this.strm.bI},V.exports.Deflate=g,V.exports.deflate=o,V.exports.deflateRaw=function(V,I){return(I=I||{}).raw=!0,o(V,I)},V.exports.gzip=function(V,I){return(I=I||{}).gzip=!0,o(V,I)},V.exports.constants=A(12445)},12460:(V,I,A)=>{"use strict";const B=A(12465),F=A(12448),E=A(12451),Y=A(12441),H=A(12456),c=A(12473),b=Object.prototype.toString,{Z_NO_FLUSH:X,Z_FINISH:P,Z_OK:J,Z_STREAM_END:G,Z_NEED_DICT:w,Z_STREAM_ERROR:t,Z_DATA_ERROR:u,Z_MEM_ERROR:W}=A(12445);function g(V){this.options=F.assign({yV:65536,windowBits:15,to:""},V||{});const I=this.options;I.raw&&I.windowBits>=0&&I.windowBits<16&&(I.windowBits=-I.windowBits,0===I.windowBits&&(I.windowBits=-15)),!(I.windowBits>=0&&I.windowBits<16)||V&&V.windowBits||(I.windowBits+=32),I.windowBits>15&&I.windowBits<48&&0===(15&I.windowBits)&&(I.windowBits|=15),this.err=0,this.bI="",this.ended=!1,this.chunks=[],this.strm=new H,this.strm.avail_out=0;let A=B.inflateInit2(this.strm,I.windowBits);if(A!==J)throw new Error(Y[A]);if(this.header=new c,B.inflateGetHeader(this.strm,this.header),I.dictionary&&("string"===typeof I.dictionary?I.dictionary=E.string2buf(I.dictionary):"[object ArrayBuffer]"===b.call(I.dictionary)&&(I.dictionary=new Uint8Array(I.dictionary)),I.raw&&(A=B.inflateSetDictionary(this.strm,I.dictionary),A!==J)))throw new Error(Y[A])}function o(V,I){const A=new g(I);if(A.push(V),A.err)throw A.bI||Y[A.err];return A.result}g.prototype.push=function(V,I){const A=this.strm,F=this.options.yV,Y=this.options.dictionary;let H,c,g;if(this.ended)return!1;for(c=I===~~I?I:!0===I?P:X,"[object ArrayBuffer]"===b.call(V)?A.input=new Uint8Array(V):A.input=V,A.next_in=0,A.avail_in=A.input.length;;){for(0===A.avail_out&&(A.output=new Uint8Array(F),A.next_out=0,A.avail_out=F),H=B.inflate(A,c),H===w&&Y&&(H=B.inflateSetDictionary(A,Y),H===J?H=B.inflate(A,c):H===u&&(H=w));A.avail_in>0&&H===G&&A.state.wrap>0&&0!==V[A.next_in];)B.inflateReset(A),H=B.inflate(A,c);switch(H){case t:case u:case w:case W:return this.onEnd(H),this.ended=!0,!1}if(g=A.avail_out,A.next_out&&(0===A.avail_out||H===G))if("string"===this.options.to){let V=E.utf8border(A.output,A.next_out),I=A.next_out-V,B=E.buf2string(A.output,V);A.next_out=I,A.avail_out=F-I,I&&A.output.set(A.output.subarray(V,V+I),0),this.onData(B)}else this.onData(A.output.length===A.next_out?A.output:A.output.subarray(0,A.next_out));if(H!==J||0!==g){if(H===G)return H=B.inflateEnd(this.strm),this.onEnd(H),this.ended=!0,!0;if(0===A.avail_in)break}}return!0},g.prototype.onData=function(V){this.chunks.push(V)},g.prototype.onEnd=function(V){V===J&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=F.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.bI=this.strm.bI},V.exports.Inflate=g,V.exports.inflate=o,V.exports.inflateRaw=function(V,I){return(I=I||{}).raw=!0,o(V,I)},V.exports.ungzip=o,V.exports.constants=A(12445)},12448:V=>{"use strict";const I=(V,I)=>Object.prototype.hasOwnProperty.call(V,I);V.exports.assign=function(V){const A=Array.prototype.slice.call(arguments,1);for(;A.length;){const B=A.shift();if(B){if("object"!==typeof B)throw new TypeError(B+"must be non-object");for(const A in B)I(B,A)&&(V[A]=B[A])}}return V},V.exports.flattenChunks=V=>{let I=0;for(let B=0,F=V.length;B<F;B++)I+=V[B].length;const A=new Uint8Array(I);for(let B=0,F=0,E=V.length;B<E;B++){let I=V[B];A.set(I,F),F+=I.length}return A}},12451:V=>{"use strict";let I=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(B){I=!1}const A=new Uint8Array(256);for(let F=0;F<256;F++)A[F]=F>=252?6:F>=248?5:F>=240?4:F>=224?3:F>=192?2:1;A[254]=A[254]=1,V.exports.string2buf=V=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(V);let I,A,B,F,E,Y=V.length,H=0;for(F=0;F<Y;F++)A=V.charCodeAt(F),55296===(64512&A)&&F+1<Y&&(B=V.charCodeAt(F+1),56320===(64512&B)&&(A=65536+(A-55296<<10)+(B-56320),F++)),H+=A<128?1:A<2048?2:A<65536?3:4;for(I=new Uint8Array(H),E=0,F=0;E<H;F++)A=V.charCodeAt(F),55296===(64512&A)&&F+1<Y&&(B=V.charCodeAt(F+1),56320===(64512&B)&&(A=65536+(A-55296<<10)+(B-56320),F++)),A<128?I[E++]=A:A<2048?(I[E++]=192|A>>>6,I[E++]=128|63&A):A<65536?(I[E++]=224|A>>>12,I[E++]=128|A>>>6&63,I[E++]=128|63&A):(I[E++]=240|A>>>18,I[E++]=128|A>>>12&63,I[E++]=128|A>>>6&63,I[E++]=128|63&A);return I};V.exports.buf2string=(V,B)=>{const F=B||V.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(V.subarray(0,B));let E,Y;const H=new Array(2*F);for(Y=0,E=0;E<F;){let I=V[E++];if(I<128){H[Y++]=I;continue}let B=A[I];if(B>4)H[Y++]=65533,E+=B-1;else{for(I&=2===B?31:3===B?15:7;B>1&&E<F;)I=I<<6|63&V[E++],B--;B>1?H[Y++]=65533:I<65536?H[Y++]=I:(I-=65536,H[Y++]=55296|I>>10&1023,H[Y++]=56320|1023&I)}}return((V,A)=>{if(A<65534&&V.subarray&&I)return String.fromCharCode.apply(null,V.length===A?V:V.subarray(0,A));let B="";for(let I=0;I<A;I++)B+=String.fromCharCode(V[I]);return B})(H,Y)},V.exports.utf8border=(V,I)=>{(I=I||V.length)>V.length&&(I=V.length);let B=I-1;for(;B>=0&&128===(192&V[B]);)B--;return B<0||0===B?I:B+A[V[B]]>I?B:I}},12432:V=>{"use strict";V.exports=(V,I,A,B)=>{let F=65535&V,E=V>>>16&65535,Y=0;for(;0!==A;){Y=A>2e3?2e3:A,A-=Y;do{F=F+I[B++]|0,E=E+F|0}while(--Y);F%=65521,E%=65521}return F|E<<16}},12445:V=>{"use strict";V.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12439:V=>{"use strict";const I=new Uint32Array((()=>{let V,I=[];for(var A=0;A<256;A++){V=A;for(var B=0;B<8;B++)V=1&V?3988292384^V>>>1:V>>>1;I[A]=V}return I})());V.exports=(V,A,B,F)=>{const E=I,Y=F+B;V^=-1;for(let I=F;I<Y;I++)V=V>>>8^E[255&(V^A[I])];return~V}},12428:(V,I,A)=>{"use strict";const{_tr_init:B,_tr_stored_block:F,_tr_flush_block:E,_tr_tally:Y,_tr_align:H}=A(12430),c=A(12432),b=A(12439),X=A(12441),{Z_NO_FLUSH:P,Z_PARTIAL_FLUSH:J,Z_FULL_FLUSH:G,Z_FINISH:w,Z_BLOCK:t,Z_OK:u,Z_STREAM_END:W,Z_STREAM_ERROR:g,Z_DATA_ERROR:o,Z_BUF_ERROR:L,Z_DEFAULT_COMPRESSION:z,Z_FILTERED:m,Z_HUFFMAN_ONLY:s,Z_RLE:e,Z_FIXED:S,Z_DEFAULT_STRATEGY:Q,Z_UNKNOWN:h,Z_DEFLATED:r}=A(12445),M=258,x=262,f=103,R=113,q=666,N=(V,I)=>(V.bI=X[I],I),l=V=>(V<<1)-(V>4?9:0),i=V=>{let I=V.length;for(;--I>=0;)V[I]=0};let y=(V,I,A)=>(I<<V.hash_shift^A)&V.hash_mask;const v=V=>{const I=V.state;let A=I.pending;A>V.avail_out&&(A=V.avail_out),0!==A&&(V.output.set(I.pending_buf.subarray(I.pending_out,I.pending_out+A),V.next_out),V.next_out+=A,I.pending_out+=A,V.total_out+=A,V.avail_out-=A,I.pending-=A,0===I.pending&&(I.pending_out=0))},C=(V,I)=>{E(V,V.block_start>=0?V.block_start:-1,V.strstart-V.block_start,I),V.block_start=V.strstart,v(V.strm)},K=(V,I)=>{V.pending_buf[V.pending++]=I},p=(V,I)=>{V.pending_buf[V.pending++]=I>>>8&255,V.pending_buf[V.pending++]=255&I},j=(V,I,A,B)=>{let F=V.avail_in;return F>B&&(F=B),0===F?0:(V.avail_in-=F,I.set(V.input.subarray(V.next_in,V.next_in+F),A),1===V.state.wrap?V.adler=c(V.adler,I,F,A):2===V.state.wrap&&(V.adler=b(V.adler,I,F,A)),V.next_in+=F,V.total_in+=F,F)},T=(V,I)=>{let A,B,F=V.max_chain_length,E=V.strstart,Y=V.prev_length,H=V.nice_match;const c=V.strstart>V.w_size-x?V.strstart-(V.w_size-x):0,b=V.window,X=V.w_mask,P=V.prev,J=V.strstart+M;let G=b[E+Y-1],w=b[E+Y];V.prev_length>=V.good_match&&(F>>=2),H>V.lookahead&&(H=V.lookahead);do{if(A=I,b[A+Y]===w&&b[A+Y-1]===G&&b[A]===b[E]&&b[++A]===b[E+1]){E+=2,A++;do{}while(b[++E]===b[++A]&&b[++E]===b[++A]&&b[++E]===b[++A]&&b[++E]===b[++A]&&b[++E]===b[++A]&&b[++E]===b[++A]&&b[++E]===b[++A]&&b[++E]===b[++A]&&E<J);if(B=M-(J-E),E=J-M,B>Y){if(V.match_start=I,Y=B,B>=H)break;G=b[E+Y-1],w=b[E+Y]}}}while((I=P[I&X])>c&&0!==--F);return Y<=V.lookahead?Y:V.lookahead},d=V=>{const I=V.w_size;let A,B,F,E,Y;do{if(E=V.window_size-V.lookahead-V.strstart,V.strstart>=I+(I-x)){V.window.set(V.window.subarray(I,I+I),0),V.match_start-=I,V.strstart-=I,V.block_start-=I,B=V.hash_size,A=B;do{F=V.head[--A],V.head[A]=F>=I?F-I:0}while(--B);B=I,A=B;do{F=V.prev[--A],V.prev[A]=F>=I?F-I:0}while(--B);E+=I}if(0===V.strm.avail_in)break;if(B=j(V.strm,V.window,V.strstart+V.lookahead,E),V.lookahead+=B,V.lookahead+V.insert>=3)for(Y=V.strstart-V.insert,V.ins_h=V.window[Y],V.ins_h=y(V,V.ins_h,V.window[Y+1]);V.insert&&(V.ins_h=y(V,V.ins_h,V.window[Y+3-1]),V.prev[Y&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=Y,Y++,V.insert--,!(V.lookahead+V.insert<3)););}while(V.lookahead<x&&0!==V.strm.avail_in)},D=(V,I)=>{let A,B;for(;;){if(V.lookahead<x){if(d(V),V.lookahead<x&&I===P)return 1;if(0===V.lookahead)break}if(A=0,V.lookahead>=3&&(V.ins_h=y(V,V.ins_h,V.window[V.strstart+3-1]),A=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),0!==A&&V.strstart-A<=V.w_size-x&&(V.match_length=T(V,A)),V.match_length>=3)if(B=Y(V,V.strstart-V.match_start,V.match_length-3),V.lookahead-=V.match_length,V.match_length<=V.max_lazy_match&&V.lookahead>=3){V.match_length--;do{V.strstart++,V.ins_h=y(V,V.ins_h,V.window[V.strstart+3-1]),A=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart}while(0!==--V.match_length);V.strstart++}else V.strstart+=V.match_length,V.match_length=0,V.ins_h=V.window[V.strstart],V.ins_h=y(V,V.ins_h,V.window[V.strstart+1]);else B=Y(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++;if(B&&(C(V,!1),0===V.strm.avail_out))return 1}return V.insert=V.strstart<2?V.strstart:2,I===w?(C(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(C(V,!1),0===V.strm.avail_out)?1:2},O=(V,I)=>{let A,B,F;for(;;){if(V.lookahead<x){if(d(V),V.lookahead<x&&I===P)return 1;if(0===V.lookahead)break}if(A=0,V.lookahead>=3&&(V.ins_h=y(V,V.ins_h,V.window[V.strstart+3-1]),A=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),V.prev_length=V.match_length,V.prev_match=V.match_start,V.match_length=2,0!==A&&V.prev_length<V.max_lazy_match&&V.strstart-A<=V.w_size-x&&(V.match_length=T(V,A),V.match_length<=5&&(V.strategy===m||3===V.match_length&&V.strstart-V.match_start>4096)&&(V.match_length=2)),V.prev_length>=3&&V.match_length<=V.prev_length){F=V.strstart+V.lookahead-3,B=Y(V,V.strstart-1-V.prev_match,V.prev_length-3),V.lookahead-=V.prev_length-1,V.prev_length-=2;do{++V.strstart<=F&&(V.ins_h=y(V,V.ins_h,V.window[V.strstart+3-1]),A=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart)}while(0!==--V.prev_length);if(V.match_available=0,V.match_length=2,V.strstart++,B&&(C(V,!1),0===V.strm.avail_out))return 1}else if(V.match_available){if(B=Y(V,0,V.window[V.strstart-1]),B&&C(V,!1),V.strstart++,V.lookahead--,0===V.strm.avail_out)return 1}else V.match_available=1,V.strstart++,V.lookahead--}return V.match_available&&(B=Y(V,0,V.window[V.strstart-1]),V.match_available=0),V.insert=V.strstart<2?V.strstart:2,I===w?(C(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(C(V,!1),0===V.strm.avail_out)?1:2};function Z(V,I,A,B,F){this.good_length=V,this.max_lazy=I,this.nice_length=A,this.max_chain=B,this.func=F}const a=[new Z(0,0,0,0,((V,I)=>{let A=65535;for(A>V.pending_buf_size-5&&(A=V.pending_buf_size-5);;){if(V.lookahead<=1){if(d(V),0===V.lookahead&&I===P)return 1;if(0===V.lookahead)break}V.strstart+=V.lookahead,V.lookahead=0;const B=V.block_start+A;if((0===V.strstart||V.strstart>=B)&&(V.lookahead=V.strstart-B,V.strstart=B,C(V,!1),0===V.strm.avail_out))return 1;if(V.strstart-V.block_start>=V.w_size-x&&(C(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,I===w?(C(V,!0),0===V.strm.avail_out?3:4):(V.strstart>V.block_start&&(C(V,!1),V.strm.avail_out),1)})),new Z(4,4,8,4,D),new Z(4,5,16,8,D),new Z(4,6,32,32,D),new Z(4,4,16,16,O),new Z(8,16,32,32,O),new Z(8,16,128,128,O),new Z(8,32,128,256,O),new Z(32,128,258,1024,O),new Z(32,258,258,4096,O)];function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=r,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),i(this.dyn_ltree),i(this.dyn_dtree),i(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),i(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),i(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const U=V=>{if(!V||!V.state)return N(V,g);V.total_in=V.total_out=0,V.data_type=h;const I=V.state;return I.pending=0,I.pending_out=0,I.wrap<0&&(I.wrap=-I.wrap),I.status=I.wrap?42:R,V.adler=2===I.wrap?0:1,I.last_flush=P,B(I),u},n=V=>{const I=U(V);var A;return I===u&&((A=V.state).window_size=2*A.w_size,i(A.head),A.max_lazy_match=a[A.level].max_lazy,A.good_match=a[A.level].good_length,A.nice_match=a[A.level].nice_length,A.max_chain_length=a[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=2,A.match_available=0,A.ins_h=0),I},VV=(V,I,A,B,F,E)=>{if(!V)return g;let Y=1;if(I===z&&(I=6),B<0?(Y=0,B=-B):B>15&&(Y=2,B-=16),F<1||F>9||A!==r||B<8||B>15||I<0||I>9||E<0||E>S)return N(V,g);8===B&&(B=9);const H=new k;return V.state=H,H.strm=V,H.wrap=Y,H.gzhead=null,H.w_bits=B,H.w_size=1<<H.w_bits,H.w_mask=H.w_size-1,H.hash_bits=F+7,H.hash_size=1<<H.hash_bits,H.hash_mask=H.hash_size-1,H.hash_shift=~~((H.hash_bits+3-1)/3),H.window=new Uint8Array(2*H.w_size),H.head=new Uint16Array(H.hash_size),H.prev=new Uint16Array(H.w_size),H.lit_bufsize=1<<F+6,H.pending_buf_size=4*H.lit_bufsize,H.pending_buf=new Uint8Array(H.pending_buf_size),H.d_buf=1*H.lit_bufsize,H.l_buf=3*H.lit_bufsize,H.level=I,H.strategy=E,H.method=A,n(V)};V.exports.deflateInit=(V,I)=>VV(V,I,r,15,8,Q),V.exports.deflateInit2=VV,V.exports.deflateReset=n,V.exports.deflateResetKeep=U,V.exports.deflateSetHeader=(V,I)=>V&&V.state?2!==V.state.wrap?g:(V.state.gzhead=I,u):g,V.exports.deflate=(V,I)=>{let A,B;if(!V||!V.state||I>t||I<0)return V?N(V,g):g;const E=V.state;if(!V.output||!V.input&&0!==V.avail_in||E.status===q&&I!==w)return N(V,0===V.avail_out?L:g);E.strm=V;const c=E.last_flush;if(E.last_flush=I,42===E.status)if(2===E.wrap)V.adler=0,K(E,31),K(E,139),K(E,8),E.gzhead?(K(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),K(E,255&E.gzhead.time),K(E,E.gzhead.time>>8&255),K(E,E.gzhead.time>>16&255),K(E,E.gzhead.time>>24&255),K(E,9===E.level?2:E.strategy>=s||E.level<2?4:0),K(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(K(E,255&E.gzhead.extra.length),K(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(V.adler=b(V.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(K(E,0),K(E,0),K(E,0),K(E,0),K(E,0),K(E,9===E.level?2:E.strategy>=s||E.level<2?4:0),K(E,3),E.status=R);else{let I=r+(E.w_bits-8<<4)<<8,A=-1;A=E.strategy>=s||E.level<2?0:E.level<6?1:6===E.level?2:3,I|=A<<6,0!==E.strstart&&(I|=32),I+=31-I%31,E.status=R,p(E,I),0!==E.strstart&&(p(E,V.adler>>>16),p(E,65535&V.adler)),V.adler=1}if(69===E.status)if(E.gzhead.extra){for(A=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>A&&(V.adler=b(V.adler,E.pending_buf,E.pending-A,A)),v(V),A=E.pending,E.pending!==E.pending_buf_size));)K(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>A&&(V.adler=b(V.adler,E.pending_buf,E.pending-A,A)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(73===E.status)if(E.gzhead.name){A=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>A&&(V.adler=b(V.adler,E.pending_buf,E.pending-A,A)),v(V),A=E.pending,E.pending===E.pending_buf_size)){B=1;break}B=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,K(E,B)}while(0!==B);E.gzhead.hcrc&&E.pending>A&&(V.adler=b(V.adler,E.pending_buf,E.pending-A,A)),0===B&&(E.gzindex=0,E.status=91)}else E.status=91;if(91===E.status)if(E.gzhead.comment){A=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>A&&(V.adler=b(V.adler,E.pending_buf,E.pending-A,A)),v(V),A=E.pending,E.pending===E.pending_buf_size)){B=1;break}B=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,K(E,B)}while(0!==B);E.gzhead.hcrc&&E.pending>A&&(V.adler=b(V.adler,E.pending_buf,E.pending-A,A)),0===B&&(E.status=f)}else E.status=f;if(E.status===f&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&v(V),E.pending+2<=E.pending_buf_size&&(K(E,255&V.adler),K(E,V.adler>>8&255),V.adler=0,E.status=R)):E.status=R),0!==E.pending){if(v(V),0===V.avail_out)return E.last_flush=-1,u}else if(0===V.avail_in&&l(I)<=l(c)&&I!==w)return N(V,L);if(E.status===q&&0!==V.avail_in)return N(V,L);if(0!==V.avail_in||0!==E.lookahead||I!==P&&E.status!==q){let A=E.strategy===s?((V,I)=>{let A;for(;;){if(0===V.lookahead&&(d(V),0===V.lookahead)){if(I===P)return 1;break}if(V.match_length=0,A=Y(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,A&&(C(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,I===w?(C(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(C(V,!1),0===V.strm.avail_out)?1:2})(E,I):E.strategy===e?((V,I)=>{let A,B,F,E;const H=V.window;for(;;){if(V.lookahead<=M){if(d(V),V.lookahead<=M&&I===P)return 1;if(0===V.lookahead)break}if(V.match_length=0,V.lookahead>=3&&V.strstart>0&&(F=V.strstart-1,B=H[F],B===H[++F]&&B===H[++F]&&B===H[++F])){E=V.strstart+M;do{}while(B===H[++F]&&B===H[++F]&&B===H[++F]&&B===H[++F]&&B===H[++F]&&B===H[++F]&&B===H[++F]&&B===H[++F]&&F<E);V.match_length=M-(E-F),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=3?(A=Y(V,1,V.match_length-3),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(A=Y(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),A&&(C(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,I===w?(C(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(C(V,!1),0===V.strm.avail_out)?1:2})(E,I):a[E.level].func(E,I);if(3!==A&&4!==A||(E.status=q),1===A||3===A)return 0===V.avail_out&&(E.last_flush=-1),u;if(2===A&&(I===J?H(E):I!==t&&(F(E,0,0,!1),I===G&&(i(E.head),0===E.lookahead&&(E.strstart=0,E.block_start=0,E.insert=0))),v(V),0===V.avail_out))return E.last_flush=-1,u}return I!==w?u:E.wrap<=0?W:(2===E.wrap?(K(E,255&V.adler),K(E,V.adler>>8&255),K(E,V.adler>>16&255),K(E,V.adler>>24&255),K(E,255&V.total_in),K(E,V.total_in>>8&255),K(E,V.total_in>>16&255),K(E,V.total_in>>24&255)):(p(E,V.adler>>>16),p(E,65535&V.adler)),v(V),E.wrap>0&&(E.wrap=-E.wrap),0!==E.pending?u:W)},V.exports.deflateEnd=V=>{if(!V||!V.state)return g;const I=V.state.status;return 42!==I&&69!==I&&73!==I&&91!==I&&I!==f&&I!==R&&I!==q?N(V,g):(V.state=null,I===R?N(V,o):u)},V.exports.deflateSetDictionary=(V,I)=>{let A=I.length;if(!V||!V.state)return g;const B=V.state,F=B.wrap;if(2===F||1===F&&42!==B.status||B.lookahead)return g;if(1===F&&(V.adler=c(V.adler,I,A,0)),B.wrap=0,A>=B.w_size){0===F&&(i(B.head),B.strstart=0,B.block_start=0,B.insert=0);let V=new Uint8Array(B.w_size);V.set(I.subarray(A-B.w_size,A),0),I=V,A=B.w_size}const E=V.avail_in,Y=V.next_in,H=V.input;for(V.avail_in=A,V.next_in=0,V.input=I,d(B);B.lookahead>=3;){let V=B.strstart,I=B.lookahead-2;do{B.ins_h=y(B,B.ins_h,B.window[V+3-1]),B.prev[V&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=V,V++}while(--I);B.strstart=V,B.lookahead=2,d(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=2,B.match_available=0,V.next_in=Y,V.input=H,V.avail_in=E,B.wrap=F,u},V.exports.deflateInfo="pako deflate (from Nodeca project)"},12473:V=>{"use strict";V.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12467:V=>{"use strict";V.exports=function(V,I){let A,B,F,E,Y,H,c,b,X,P,J,G,w,t,u,W,g,o,L,z,m,s,e,S;const Q=V.state;A=V.next_in,e=V.input,B=A+(V.avail_in-5),F=V.next_out,S=V.output,E=F-(I-V.avail_out),Y=F+(V.avail_out-257),H=Q.dmax,c=Q.wsize,b=Q.whave,X=Q.wnext,P=Q.window,J=Q.hold,G=Q.bits,w=Q.lencode,t=Q.distcode,u=(1<<Q.lenbits)-1,W=(1<<Q.distbits)-1;V:do{G<15&&(J+=e[A++]<<G,G+=8,J+=e[A++]<<G,G+=8),g=w[J&u];I:for(;;){if(o=g>>>24,J>>>=o,G-=o,o=g>>>16&255,0===o)S[F++]=65535&g;else{if(!(16&o)){if(0===(64&o)){g=w[(65535&g)+(J&(1<<o)-1)];continue I}if(32&o){Q.mode=12;break V}V.bI="invalid literal/length code",Q.mode=30;break V}L=65535&g,o&=15,o&&(G<o&&(J+=e[A++]<<G,G+=8),L+=J&(1<<o)-1,J>>>=o,G-=o),G<15&&(J+=e[A++]<<G,G+=8,J+=e[A++]<<G,G+=8),g=t[J&W];A:for(;;){if(o=g>>>24,J>>>=o,G-=o,o=g>>>16&255,!(16&o)){if(0===(64&o)){g=t[(65535&g)+(J&(1<<o)-1)];continue A}V.bI="invalid distance code",Q.mode=30;break V}if(z=65535&g,o&=15,G<o&&(J+=e[A++]<<G,G+=8,G<o&&(J+=e[A++]<<G,G+=8)),z+=J&(1<<o)-1,z>H){V.bI="invalid distance too far back",Q.mode=30;break V}if(J>>>=o,G-=o,o=F-E,z>o){if(o=z-o,o>b&&Q.sane){V.bI="invalid distance too far back",Q.mode=30;break V}if(m=0,s=P,0===X){if(m+=c-o,o<L){L-=o;do{S[F++]=P[m++]}while(--o);m=F-z,s=S}}else if(X<o){if(m+=c+X-o,o-=X,o<L){L-=o;do{S[F++]=P[m++]}while(--o);if(m=0,X<L){o=X,L-=o;do{S[F++]=P[m++]}while(--o);m=F-z,s=S}}}else if(m+=X-o,o<L){L-=o;do{S[F++]=P[m++]}while(--o);m=F-z,s=S}for(;L>2;)S[F++]=s[m++],S[F++]=s[m++],S[F++]=s[m++],L-=3;L&&(S[F++]=s[m++],L>1&&(S[F++]=s[m++]))}else{m=F-z;do{S[F++]=S[m++],S[F++]=S[m++],S[F++]=S[m++],L-=3}while(L>2);L&&(S[F++]=S[m++],L>1&&(S[F++]=S[m++]))}break}}break}}while(A<B&&F<Y);L=G>>3,A-=L,G-=L<<3,J&=(1<<G)-1,V.next_in=A,V.next_out=F,V.avail_in=A<B?B-A+5:5-(A-B),V.avail_out=F<Y?Y-F+257:257-(F-Y),Q.hold=J,Q.bits=G}},12465:(V,I,A)=>{"use strict";const B=A(12432),F=A(12439),E=A(12467),Y=A(12471),{Z_FINISH:H,Z_BLOCK:c,Z_TREES:b,Z_OK:X,Z_STREAM_END:P,Z_NEED_DICT:J,Z_STREAM_ERROR:G,Z_DATA_ERROR:w,Z_MEM_ERROR:t,Z_BUF_ERROR:u,Z_DEFLATED:W}=A(12445),g=12,o=30,L=V=>(V>>>24&255)+(V>>>8&65280)+((65280&V)<<8)+((255&V)<<24);function z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const m=V=>{if(!V||!V.state)return G;const I=V.state;return V.total_in=V.total_out=I.total=0,V.bI="",I.wrap&&(V.adler=1&I.wrap),I.mode=1,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new Int32Array(852),I.distcode=I.distdyn=new Int32Array(592),I.sane=1,I.back=-1,X},s=V=>{if(!V||!V.state)return G;const I=V.state;return I.wsize=0,I.whave=0,I.wnext=0,m(V)},e=(V,I)=>{let A;if(!V||!V.state)return G;const B=V.state;return I<0?(A=0,I=-I):(A=1+(I>>4),I<48&&(I&=15)),I&&(I<8||I>15)?G:(null!==B.window&&B.wbits!==I&&(B.window=null),B.wrap=A,B.wbits=I,s(V))},S=(V,I)=>{if(!V)return G;const A=new z;V.state=A,A.window=null;const B=e(V,I);return B!==X&&(V.state=null),B};let Q,h,r=!0;const M=V=>{if(r){Q=new Int32Array(512),h=new Int32Array(32);let I=0;for(;I<144;)V.lens[I++]=8;for(;I<256;)V.lens[I++]=9;for(;I<280;)V.lens[I++]=7;for(;I<288;)V.lens[I++]=8;for(Y(1,V.lens,0,288,Q,0,V.work,{bits:9}),I=0;I<32;)V.lens[I++]=5;Y(2,V.lens,0,32,h,0,V.work,{bits:5}),r=!1}V.lencode=Q,V.lenbits=9,V.distcode=h,V.distbits=5},x=(V,I,A,B)=>{let F;const E=V.state;return null===E.window&&(E.wsize=1<<E.wbits,E.wnext=0,E.whave=0,E.window=new Uint8Array(E.wsize)),B>=E.wsize?(E.window.set(I.subarray(A-E.wsize,A),0),E.wnext=0,E.whave=E.wsize):(F=E.wsize-E.wnext,F>B&&(F=B),E.window.set(I.subarray(A-B,A-B+F),E.wnext),(B-=F)?(E.window.set(I.subarray(A-B,A),0),E.wnext=B,E.whave=E.wsize):(E.wnext+=F,E.wnext===E.wsize&&(E.wnext=0),E.whave<E.wsize&&(E.whave+=F))),0};V.exports.inflateReset=s,V.exports.inflateReset2=e,V.exports.inflateResetKeep=m,V.exports.inflateInit=V=>S(V,15),V.exports.inflateInit2=S,V.exports.inflate=(V,I)=>{let A,z,m,s,e,S,Q,h,r,f,R,q,N,l,i,y,v,C,K,p,j,T,d=0;const D=new Uint8Array(4);let O,Z;const a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!V||!V.state||!V.output||!V.input&&0!==V.avail_in)return G;A=V.state,A.mode===g&&(A.mode=13),e=V.next_out,m=V.output,Q=V.avail_out,s=V.next_in,z=V.input,S=V.avail_in,h=A.hold,r=A.bits,f=S,R=Q,T=X;V:for(;;)switch(A.mode){case 1:if(0===A.wrap){A.mode=13;break}for(;r<16;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}if(2&A.wrap&&35615===h){A.check=0,D[0]=255&h,D[1]=h>>>8&255,A.check=F(A.check,D,2,0),h=0,r=0,A.mode=2;break}if(A.flags=0,A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&h)<<8)+(h>>8))%31){V.bI="incorrect header check",A.mode=o;break}if((15&h)!==W){V.bI="unknown compression method",A.mode=o;break}if(h>>>=4,r-=4,j=8+(15&h),0===A.wbits)A.wbits=j;else if(j>A.wbits){V.bI="invalid window size",A.mode=o;break}A.dmax=1<<A.wbits,V.adler=A.check=1,A.mode=512&h?10:g,h=0,r=0;break;case 2:for(;r<16;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}if(A.flags=h,(255&A.flags)!==W){V.bI="unknown compression method",A.mode=o;break}if(57344&A.flags){V.bI="unknown header flags set",A.mode=o;break}A.head&&(A.head.text=h>>8&1),512&A.flags&&(D[0]=255&h,D[1]=h>>>8&255,A.check=F(A.check,D,2,0)),h=0,r=0,A.mode=3;case 3:for(;r<32;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}A.head&&(A.head.time=h),512&A.flags&&(D[0]=255&h,D[1]=h>>>8&255,D[2]=h>>>16&255,D[3]=h>>>24&255,A.check=F(A.check,D,4,0)),h=0,r=0,A.mode=4;case 4:for(;r<16;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}A.head&&(A.head.xflags=255&h,A.head.os=h>>8),512&A.flags&&(D[0]=255&h,D[1]=h>>>8&255,A.check=F(A.check,D,2,0)),h=0,r=0,A.mode=5;case 5:if(1024&A.flags){for(;r<16;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}A.length=h,A.head&&(A.head.extra_len=h),512&A.flags&&(D[0]=255&h,D[1]=h>>>8&255,A.check=F(A.check,D,2,0)),h=0,r=0}else A.head&&(A.head.extra=null);A.mode=6;case 6:if(1024&A.flags&&(q=A.length,q>S&&(q=S),q&&(A.head&&(j=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Uint8Array(A.head.extra_len)),A.head.extra.set(z.subarray(s,s+q),j)),512&A.flags&&(A.check=F(A.check,z,q,s)),S-=q,s+=q,A.length-=q),A.length))break V;A.length=0,A.mode=7;case 7:if(2048&A.flags){if(0===S)break V;q=0;do{j=z[s+q++],A.head&&j&&A.length<65536&&(A.head.name+=String.fromCharCode(j))}while(j&&q<S);if(512&A.flags&&(A.check=F(A.check,z,q,s)),S-=q,s+=q,j)break V}else A.head&&(A.head.name=null);A.length=0,A.mode=8;case 8:if(4096&A.flags){if(0===S)break V;q=0;do{j=z[s+q++],A.head&&j&&A.length<65536&&(A.head.comment+=String.fromCharCode(j))}while(j&&q<S);if(512&A.flags&&(A.check=F(A.check,z,q,s)),S-=q,s+=q,j)break V}else A.head&&(A.head.comment=null);A.mode=9;case 9:if(512&A.flags){for(;r<16;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}if(h!==(65535&A.check)){V.bI="header crc mismatch",A.mode=o;break}h=0,r=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),V.adler=A.check=0,A.mode=g;break;case 10:for(;r<32;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}V.adler=A.check=L(h),h=0,r=0,A.mode=11;case 11:if(0===A.havedict)return V.next_out=e,V.avail_out=Q,V.next_in=s,V.avail_in=S,A.hold=h,A.bits=r,J;V.adler=A.check=1,A.mode=g;case g:if(I===c||I===b)break V;case 13:if(A.last){h>>>=7&r,r-=7&r,A.mode=27;break}for(;r<3;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}switch(A.last=1&h,h>>>=1,r-=1,3&h){case 0:A.mode=14;break;case 1:if(M(A),A.mode=20,I===b){h>>>=2,r-=2;break V}break;case 2:A.mode=17;break;case 3:V.bI="invalid block type",A.mode=o}h>>>=2,r-=2;break;case 14:for(h>>>=7&r,r-=7&r;r<32;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}if((65535&h)!==(h>>>16^65535)){V.bI="invalid stored block lengths",A.mode=o;break}if(A.length=65535&h,h=0,r=0,A.mode=15,I===b)break V;case 15:A.mode=16;case 16:if(q=A.length,q){if(q>S&&(q=S),q>Q&&(q=Q),0===q)break V;m.set(z.subarray(s,s+q),e),S-=q,s+=q,Q-=q,e+=q,A.length-=q;break}A.mode=g;break;case 17:for(;r<14;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}if(A.nlen=257+(31&h),h>>>=5,r-=5,A.ndist=1+(31&h),h>>>=5,r-=5,A.ncode=4+(15&h),h>>>=4,r-=4,A.nlen>286||A.ndist>30){V.bI="too many length or distance symbols",A.mode=o;break}A.have=0,A.mode=18;case 18:for(;A.have<A.ncode;){for(;r<3;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}A.lens[a[A.have++]]=7&h,h>>>=3,r-=3}for(;A.have<19;)A.lens[a[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,O={bits:A.lenbits},T=Y(0,A.lens,0,19,A.lencode,0,A.work,O),A.lenbits=O.bits,T){V.bI="invalid code lengths set",A.mode=o;break}A.have=0,A.mode=19;case 19:for(;A.have<A.nlen+A.ndist;){for(;d=A.lencode[h&(1<<A.lenbits)-1],i=d>>>24,y=d>>>16&255,v=65535&d,!(i<=r);){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}if(v<16)h>>>=i,r-=i,A.lens[A.have++]=v;else{if(16===v){for(Z=i+2;r<Z;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}if(h>>>=i,r-=i,0===A.have){V.bI="invalid bit length repeat",A.mode=o;break}j=A.lens[A.have-1],q=3+(3&h),h>>>=2,r-=2}else if(17===v){for(Z=i+3;r<Z;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}h>>>=i,r-=i,j=0,q=3+(7&h),h>>>=3,r-=3}else{for(Z=i+7;r<Z;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}h>>>=i,r-=i,j=0,q=11+(127&h),h>>>=7,r-=7}if(A.have+q>A.nlen+A.ndist){V.bI="invalid bit length repeat",A.mode=o;break}for(;q--;)A.lens[A.have++]=j}}if(A.mode===o)break;if(0===A.lens[256]){V.bI="invalid code -- missing end-of-block",A.mode=o;break}if(A.lenbits=9,O={bits:A.lenbits},T=Y(1,A.lens,0,A.nlen,A.lencode,0,A.work,O),A.lenbits=O.bits,T){V.bI="invalid literal/lengths set",A.mode=o;break}if(A.distbits=6,A.distcode=A.distdyn,O={bits:A.distbits},T=Y(2,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,O),A.distbits=O.bits,T){V.bI="invalid distances set",A.mode=o;break}if(A.mode=20,I===b)break V;case 20:A.mode=21;case 21:if(S>=6&&Q>=258){V.next_out=e,V.avail_out=Q,V.next_in=s,V.avail_in=S,A.hold=h,A.bits=r,E(V,R),e=V.next_out,m=V.output,Q=V.avail_out,s=V.next_in,z=V.input,S=V.avail_in,h=A.hold,r=A.bits,A.mode===g&&(A.back=-1);break}for(A.back=0;d=A.lencode[h&(1<<A.lenbits)-1],i=d>>>24,y=d>>>16&255,v=65535&d,!(i<=r);){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}if(y&&0===(240&y)){for(C=i,K=y,p=v;d=A.lencode[p+((h&(1<<C+K)-1)>>C)],i=d>>>24,y=d>>>16&255,v=65535&d,!(C+i<=r);){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}h>>>=C,r-=C,A.back+=C}if(h>>>=i,r-=i,A.back+=i,A.length=v,0===y){A.mode=26;break}if(32&y){A.back=-1,A.mode=g;break}if(64&y){V.bI="invalid literal/length code",A.mode=o;break}A.extra=15&y,A.mode=22;case 22:if(A.extra){for(Z=A.extra;r<Z;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}A.length+=h&(1<<A.extra)-1,h>>>=A.extra,r-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=23;case 23:for(;d=A.distcode[h&(1<<A.distbits)-1],i=d>>>24,y=d>>>16&255,v=65535&d,!(i<=r);){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}if(0===(240&y)){for(C=i,K=y,p=v;d=A.distcode[p+((h&(1<<C+K)-1)>>C)],i=d>>>24,y=d>>>16&255,v=65535&d,!(C+i<=r);){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}h>>>=C,r-=C,A.back+=C}if(h>>>=i,r-=i,A.back+=i,64&y){V.bI="invalid distance code",A.mode=o;break}A.offset=v,A.extra=15&y,A.mode=24;case 24:if(A.extra){for(Z=A.extra;r<Z;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}A.offset+=h&(1<<A.extra)-1,h>>>=A.extra,r-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){V.bI="invalid distance too far back",A.mode=o;break}A.mode=25;case 25:if(0===Q)break V;if(q=R-Q,A.offset>q){if(q=A.offset-q,q>A.whave&&A.sane){V.bI="invalid distance too far back",A.mode=o;break}q>A.wnext?(q-=A.wnext,N=A.wsize-q):N=A.wnext-q,q>A.length&&(q=A.length),l=A.window}else l=m,N=e-A.offset,q=A.length;q>Q&&(q=Q),Q-=q,A.length-=q;do{m[e++]=l[N++]}while(--q);0===A.length&&(A.mode=21);break;case 26:if(0===Q)break V;m[e++]=A.length,Q--,A.mode=21;break;case 27:if(A.wrap){for(;r<32;){if(0===S)break V;S--,h|=z[s++]<<r,r+=8}if(R-=Q,V.total_out+=R,A.total+=R,R&&(V.adler=A.check=A.flags?F(A.check,m,R,e-R):B(A.check,m,R,e-R)),R=Q,(A.flags?h:L(h))!==A.check){V.bI="incorrect data check",A.mode=o;break}h=0,r=0}A.mode=28;case 28:if(A.wrap&&A.flags){for(;r<32;){if(0===S)break V;S--,h+=z[s++]<<r,r+=8}if(h!==(4294967295&A.total)){V.bI="incorrect length check",A.mode=o;break}h=0,r=0}A.mode=29;case 29:T=P;break V;case o:T=w;break V;case 31:return t;default:return G}return V.next_out=e,V.avail_out=Q,V.next_in=s,V.avail_in=S,A.hold=h,A.bits=r,(A.wsize||R!==V.avail_out&&A.mode<o&&(A.mode<27||I!==H))&&x(V,V.output,V.next_out,R-V.avail_out)?(A.mode=31,t):(f-=V.avail_in,R-=V.avail_out,V.total_in+=f,V.total_out+=R,A.total+=R,A.wrap&&R&&(V.adler=A.check=A.flags?F(A.check,m,R,V.next_out-R):B(A.check,m,R,V.next_out-R)),V.data_type=A.bits+(A.last?64:0)+(A.mode===g?128:0)+(20===A.mode||15===A.mode?256:0),(0===f&&0===R||I===H)&&T===X&&(T=u),T)},V.exports.inflateEnd=V=>{if(!V||!V.state)return G;let I=V.state;return I.window&&(I.window=null),V.state=null,X},V.exports.inflateGetHeader=(V,I)=>{if(!V||!V.state)return G;const A=V.state;return 0===(2&A.wrap)?G:(A.head=I,I.done=!1,X)},V.exports.inflateSetDictionary=(V,I)=>{const A=I.length;let F,E,Y;return V&&V.state?(F=V.state,0!==F.wrap&&11!==F.mode?G:11===F.mode&&(E=1,E=B(E,I,A,0),E!==F.check)?w:(Y=x(V,I,A,A),Y?(F.mode=31,t):(F.havedict=1,X))):G},V.exports.inflateInfo="pako inflate (from Nodeca project)"},12471:V=>{"use strict";const I=15,A=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),B=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),F=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),E=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);V.exports=(V,Y,H,c,b,X,P,J)=>{const G=J.bits;let w,t,u,W,g,o,L=0,z=0,m=0,s=0,e=0,S=0,Q=0,h=0,r=0,M=0,x=null,f=0;const R=new Uint16Array(16),q=new Uint16Array(16);let N,l,i,y=null,v=0;for(L=0;L<=I;L++)R[L]=0;for(z=0;z<c;z++)R[Y[H+z]]++;for(e=G,s=I;s>=1&&0===R[s];s--);if(e>s&&(e=s),0===s)return b[X++]=20971520,b[X++]=20971520,J.bits=1,0;for(m=1;m<s&&0===R[m];m++);for(e<m&&(e=m),h=1,L=1;L<=I;L++)if(h<<=1,h-=R[L],h<0)return-1;if(h>0&&(0===V||1!==s))return-1;for(q[1]=0,L=1;L<I;L++)q[L+1]=q[L]+R[L];for(z=0;z<c;z++)0!==Y[H+z]&&(P[q[Y[H+z]]++]=z);if(0===V?(x=y=P,o=19):1===V?(x=A,f-=257,y=B,v-=257,o=256):(x=F,y=E,o=-1),M=0,z=0,L=m,g=X,S=e,Q=0,u=-1,r=1<<e,W=r-1,1===V&&r>852||2===V&&r>592)return 1;for(;;){N=L-Q,P[z]<o?(l=0,i=P[z]):P[z]>o?(l=y[v+P[z]],i=x[f+P[z]]):(l=96,i=0),w=1<<L-Q,t=1<<S,m=t;do{t-=w,b[g+(M>>Q)+t]=N<<24|l<<16|i}while(0!==t);for(w=1<<L-1;M&w;)w>>=1;if(0!==w?(M&=w-1,M+=w):M=0,z++,0===--R[L]){if(L===s)break;L=Y[H+P[z]]}if(L>e&&(M&W)!==u){for(0===Q&&(Q=e),g+=m,S=L-Q,h=1<<S;S+Q<s&&(h-=R[S+Q],!(h<=0));)S++,h<<=1;if(r+=1<<S,1===V&&r>852||2===V&&r>592)return 1;u=M&W,b[u]=e<<24|S<<16|g-X}}return 0!==M&&(b[g+M]=L-Q<<24|64<<16),J.bits=e,0}},12441:V=>{"use strict";V.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12430:V=>{"use strict";function I(V){let I=V.length;for(;--I>=0;)V[I]=0}const A=256,B=286,F=30,E=15,Y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),H=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),c=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),b=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),X=new Array(576);I(X);const P=new Array(60);I(P);const J=new Array(512);I(J);const G=new Array(256);I(G);const w=new Array(29);I(w);const t=new Array(F);function u(V,I,A,B,F){this.static_tree=V,this.extra_bits=I,this.extra_base=A,this.elems=B,this.max_length=F,this.has_stree=V&&V.length}let W,g,o;function L(V,I){this.dyn_tree=V,this.max_code=0,this.stat_desc=I}I(t);const z=V=>V<256?J[V]:J[256+(V>>>7)],m=(V,I)=>{V.pending_buf[V.pending++]=255&I,V.pending_buf[V.pending++]=I>>>8&255},s=(V,I,A)=>{V.bi_valid>16-A?(V.bi_buf|=I<<V.bi_valid&65535,m(V,V.bi_buf),V.bi_buf=I>>16-V.bi_valid,V.bi_valid+=A-16):(V.bi_buf|=I<<V.bi_valid&65535,V.bi_valid+=A)},e=(V,I,A)=>{s(V,A[2*I],A[2*I+1])},S=(V,I)=>{let A=0;do{A|=1&V,V>>>=1,A<<=1}while(--I>0);return A>>>1},Q=(V,I,A)=>{const B=new Array(16);let F,Y,H=0;for(F=1;F<=E;F++)B[F]=H=H+A[F-1]<<1;for(Y=0;Y<=I;Y++){let I=V[2*Y+1];0!==I&&(V[2*Y]=S(B[I]++,I))}},h=V=>{let I;for(I=0;I<B;I++)V.dyn_ltree[2*I]=0;for(I=0;I<F;I++)V.dyn_dtree[2*I]=0;for(I=0;I<19;I++)V.bl_tree[2*I]=0;V.dyn_ltree[512]=1,V.opt_len=V.static_len=0,V.last_lit=V.matches=0},r=V=>{V.bi_valid>8?m(V,V.bi_buf):V.bi_valid>0&&(V.pending_buf[V.pending++]=V.bi_buf),V.bi_buf=0,V.bi_valid=0},M=(V,I,A,B)=>{const F=2*I,E=2*A;return V[F]<V[E]||V[F]===V[E]&&B[I]<=B[A]},x=(V,I,A)=>{const B=V.heap[A];let F=A<<1;for(;F<=V.heap_len&&(F<V.heap_len&&M(I,V.heap[F+1],V.heap[F],V.depth)&&F++,!M(I,B,V.heap[F],V.depth));)V.heap[A]=V.heap[F],A=F,F<<=1;V.heap[A]=B},f=(V,I,B)=>{let F,E,c,b,X=0;if(0!==V.last_lit)do{F=V.pending_buf[V.d_buf+2*X]<<8|V.pending_buf[V.d_buf+2*X+1],E=V.pending_buf[V.l_buf+X],X++,0===F?e(V,E,I):(c=G[E],e(V,c+A+1,I),b=Y[c],0!==b&&(E-=w[c],s(V,E,b)),F--,c=z(F),e(V,c,B),b=H[c],0!==b&&(F-=t[c],s(V,F,b)))}while(X<V.last_lit);e(V,256,I)},R=(V,I)=>{const A=I.dyn_tree,B=I.stat_desc.static_tree,F=I.stat_desc.has_stree,Y=I.stat_desc.elems;let H,c,b,X=-1;for(V.heap_len=0,V.heap_max=573,H=0;H<Y;H++)0!==A[2*H]?(V.heap[++V.heap_len]=X=H,V.depth[H]=0):A[2*H+1]=0;for(;V.heap_len<2;)b=V.heap[++V.heap_len]=X<2?++X:0,A[2*b]=1,V.depth[b]=0,V.opt_len--,F&&(V.static_len-=B[2*b+1]);for(I.max_code=X,H=V.heap_len>>1;H>=1;H--)x(V,A,H);b=Y;do{H=V.heap[1],V.heap[1]=V.heap[V.heap_len--],x(V,A,1),c=V.heap[1],V.heap[--V.heap_max]=H,V.heap[--V.heap_max]=c,A[2*b]=A[2*H]+A[2*c],V.depth[b]=(V.depth[H]>=V.depth[c]?V.depth[H]:V.depth[c])+1,A[2*H+1]=A[2*c+1]=b,V.heap[1]=b++,x(V,A,1)}while(V.heap_len>=2);V.heap[--V.heap_max]=V.heap[1],((V,I)=>{const A=I.dyn_tree,B=I.max_code,F=I.stat_desc.static_tree,Y=I.stat_desc.has_stree,H=I.stat_desc.extra_bits,c=I.stat_desc.extra_base,b=I.stat_desc.max_length;let X,P,J,G,w,t,u=0;for(G=0;G<=E;G++)V.bl_count[G]=0;for(A[2*V.heap[V.heap_max]+1]=0,X=V.heap_max+1;X<573;X++)P=V.heap[X],G=A[2*A[2*P+1]+1]+1,G>b&&(G=b,u++),A[2*P+1]=G,P>B||(V.bl_count[G]++,w=0,P>=c&&(w=H[P-c]),t=A[2*P],V.opt_len+=t*(G+w),Y&&(V.static_len+=t*(F[2*P+1]+w)));if(0!==u){do{for(G=b-1;0===V.bl_count[G];)G--;V.bl_count[G]--,V.bl_count[G+1]+=2,V.bl_count[b]--,u-=2}while(u>0);for(G=b;0!==G;G--)for(P=V.bl_count[G];0!==P;)J=V.heap[--X],J>B||(A[2*J+1]!==G&&(V.opt_len+=(G-A[2*J+1])*A[2*J],A[2*J+1]=G),P--)}})(V,I),Q(A,X,V.bl_count)},q=(V,I,A)=>{let B,F,E=-1,Y=I[1],H=0,c=7,b=4;for(0===Y&&(c=138,b=3),I[2*(A+1)+1]=65535,B=0;B<=A;B++)F=Y,Y=I[2*(B+1)+1],++H<c&&F===Y||(H<b?V.bl_tree[2*F]+=H:0!==F?(F!==E&&V.bl_tree[2*F]++,V.bl_tree[32]++):H<=10?V.bl_tree[34]++:V.bl_tree[36]++,H=0,E=F,0===Y?(c=138,b=3):F===Y?(c=6,b=3):(c=7,b=4))},N=(V,I,A)=>{let B,F,E=-1,Y=I[1],H=0,c=7,b=4;for(0===Y&&(c=138,b=3),B=0;B<=A;B++)if(F=Y,Y=I[2*(B+1)+1],!(++H<c&&F===Y)){if(H<b)do{e(V,F,V.bl_tree)}while(0!==--H);else 0!==F?(F!==E&&(e(V,F,V.bl_tree),H--),e(V,16,V.bl_tree),s(V,H-3,2)):H<=10?(e(V,17,V.bl_tree),s(V,H-3,3)):(e(V,18,V.bl_tree),s(V,H-11,7));H=0,E=F,0===Y?(c=138,b=3):F===Y?(c=6,b=3):(c=7,b=4)}};let l=!1;const i=(V,I,A,B)=>{s(V,0+(B?1:0),3),((V,I,A,B)=>{r(V),B&&(m(V,A),m(V,~A)),V.pending_buf.set(V.window.subarray(I,I+A),V.pending),V.pending+=A})(V,I,A,!0)};V.exports._tr_init=V=>{l||((()=>{let V,I,A,b,L;const z=new Array(16);for(A=0,b=0;b<28;b++)for(w[b]=A,V=0;V<1<<Y[b];V++)G[A++]=b;for(G[A-1]=b,L=0,b=0;b<16;b++)for(t[b]=L,V=0;V<1<<H[b];V++)J[L++]=b;for(L>>=7;b<F;b++)for(t[b]=L<<7,V=0;V<1<<H[b]-7;V++)J[256+L++]=b;for(I=0;I<=E;I++)z[I]=0;for(V=0;V<=143;)X[2*V+1]=8,V++,z[8]++;for(;V<=255;)X[2*V+1]=9,V++,z[9]++;for(;V<=279;)X[2*V+1]=7,V++,z[7]++;for(;V<=287;)X[2*V+1]=8,V++,z[8]++;for(Q(X,287,z),V=0;V<F;V++)P[2*V+1]=5,P[2*V]=S(V,5);W=new u(X,Y,257,B,E),g=new u(P,H,0,F,E),o=new u(new Array(0),c,0,19,7)})(),l=!0),V.l_desc=new L(V.dyn_ltree,W),V.d_desc=new L(V.dyn_dtree,g),V.bl_desc=new L(V.bl_tree,o),V.bi_buf=0,V.bi_valid=0,h(V)},V.exports._tr_stored_block=i,V.exports._tr_flush_block=(V,I,B,F)=>{let E,Y,H=0;V.level>0?(2===V.strm.data_type&&(V.strm.data_type=(V=>{let I,B=4093624447;for(I=0;I<=31;I++,B>>>=1)if(1&B&&0!==V.dyn_ltree[2*I])return 0;if(0!==V.dyn_ltree[18]||0!==V.dyn_ltree[20]||0!==V.dyn_ltree[26])return 1;for(I=32;I<A;I++)if(0!==V.dyn_ltree[2*I])return 1;return 0})(V)),R(V,V.l_desc),R(V,V.d_desc),H=(V=>{let I;for(q(V,V.dyn_ltree,V.l_desc.max_code),q(V,V.dyn_dtree,V.d_desc.max_code),R(V,V.bl_desc),I=18;I>=3&&0===V.bl_tree[2*b[I]+1];I--);return V.opt_len+=3*(I+1)+5+5+4,I})(V),E=V.opt_len+3+7>>>3,Y=V.static_len+3+7>>>3,Y<=E&&(E=Y)):E=Y=B+5,B+4<=E&&-1!==I?i(V,I,B,F):4===V.strategy||Y===E?(s(V,2+(F?1:0),3),f(V,X,P)):(s(V,4+(F?1:0),3),((V,I,A,B)=>{let F;for(s(V,I-257,5),s(V,A-1,5),s(V,B-4,4),F=0;F<B;F++)s(V,V.bl_tree[2*b[F]+1],3);N(V,V.dyn_ltree,I-1),N(V,V.dyn_dtree,A-1)})(V,V.l_desc.max_code+1,V.d_desc.max_code+1,H+1),f(V,V.dyn_ltree,V.dyn_dtree)),h(V),F&&r(V)},V.exports._tr_tally=(V,I,B)=>(V.pending_buf[V.d_buf+2*V.last_lit]=I>>>8&255,V.pending_buf[V.d_buf+2*V.last_lit+1]=255&I,V.pending_buf[V.l_buf+V.last_lit]=255&B,V.last_lit++,0===I?V.dyn_ltree[2*B]++:(V.matches++,I--,V.dyn_ltree[2*(G[B]+A+1)]++,V.dyn_dtree[2*z(I)]++),V.last_lit===V.lit_bufsize-1),V.exports._tr_align=V=>{s(V,2,3),e(V,256,X),(V=>{16===V.bi_valid?(m(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):V.bi_valid>=8&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)})(V)}},12456:V=>{"use strict";V.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.bI="",this.state=null,this.data_type=2,this.adler=0}},12064:V=>{function I(V,I,A){for(var B=V.length,F=-1/0,E=1/0,Y=0;Y<B;Y++){var H=(A[0][Y]-V[Y])/I[Y],c=(A[1][Y]-V[Y])/I[Y];if(H>c){var b=H;H=c,c=b}if(c<F||H>E)return 1/0;H>F&&(F=H),c<E&&(E=c)}return F>E?1/0:F}V.exports=function(V,A,B,F){var E=I(A,B,F);if(E===1/0)V=null;else{V=V||[];for(var Y=0;Y<A.length;Y++)V[Y]=A[Y]+B[Y]*E}return V},V.exports.distance=I},13399:(V,I,A)=>{"use strict";A.d(I,{b:()=>Y});var B=A(36);const F=B.useLayoutEffect;const E=function(V){var I=(0,B.useRef)(V);return F((function(){I.current=V})),I};var Y=function(V){var I=E(V);(0,B.YI)((function(){var V=function(V){var A;if(null!=I.current&&(A=I.current(V)),V.defaultPrevented&&(V.returnValue=""),"string"===typeof A)return V.returnValue=A,A};return window.addEventListener("beforeunload",V),function(){window.removeEventListener("beforeunload",V)}}),[])}},13354:(V,I,A)=>{"use strict";var B=A(13357),F=Array.prototype.concat,E=Array.prototype.slice,Y=V.exports=function(V){for(var I=[],A=0,Y=V.length;A<Y;A++){var H=V[A];B(H)?I=F.call(I,E.call(H)):I.push(H)}return I};Y.wrap=function(V){return function(){return V(Y(arguments))}}},13357:V=>{V.exports=function(V){return!(!V||"string"===typeof V)&&(V instanceof Array||Array.isArray(V)||V.length>=0&&(V.splice instanceof Function||Object.getOwnPropertyDescriptor(V,V.length-1)&&"String"!==V.constructor.name))}},12364:(V,I,A)=>{var B=A(12371);function F(V){for(var I,A,F=0,E=V.length,Y=0;Y<V.length;){for(I=V[Y],A=0;Y<E&&V[Y]===I;)++Y,++A;F+=B.log2(A)/7|0,F+=B.log2(I>>>0)/7|0,F+=2}return F}I.size=F,I.encode=function(V,I){I||(I=new Uint8Array(F(V)));for(var A,B,E=0,Y=I.length,H=0;H<V.length;){for(A=V[H],B=0;H<V.length&&V[H]===A;)++H,++B;for(;E<Y&&B>=128;)I[E++]=128+(127&B),B>>>=7;if(E>=Y)throw new Error("RLE buffer overflow");for(I[E++]=B,A>>>=0;E<Y&&A>=128;)I[E++]=128+(127&A),A>>>=7;if(E>=Y)throw new Error("RLE buffer overflow");I[E++]=A}return I},I.decode=function(V,I){for(var A,B,F,E,Y=I.length,H=V.length,c=0,b=0;b<H;){for(A=0,B=0;b<H&&V[b]>=128;)A+=(127&V[b++])<<B,B+=7;if(A+=V[b++]<<B,b>=H)throw new Error("RLE buffer underrun");if(c+A>Y)throw new Error("Chunk buffer overflow");for(F=0,B=0;b<H&&V[b]>=128;)F+=(127&V[b++])<<B,B+=7;if(b>=H)throw new Error("RLE buffer underrun");for(F+=V[b++]<<B,E=0;E<A;++E)I[c++]=F}return I}},12371:(V,I)=>{"use strict";function A(V){var I=32;return(V&=-V)&&I--,65535&V&&(I-=16),16711935&V&&(I-=8),252645135&V&&(I-=4),858993459&V&&(I-=2),1431655765&V&&(I-=1),I}I.INT_BITS=32,I.INT_MAX=2147483647,I.INT_MIN=-1<<31,I.sign=function(V){return(V>0)-(V<0)},I.abs=function(V){var I=V>>31;return(V^I)-I},I.min=function(V,I){return I^(V^I)&-(V<I)},I.max=function(V,I){return V^(V^I)&-(V<I)},I.isPow2=function(V){return!(V&V-1)&&!!V},I.log2=function(V){var I,A;return I=(V>65535)<<4,I|=A=((V>>>=I)>255)<<3,I|=A=((V>>>=A)>15)<<2,(I|=A=((V>>>=A)>3)<<1)|(V>>>=A)>>1},I.log10=function(V){return V>=1e9?9:V>=1e8?8:V>=1e7?7:V>=1e6?6:V>=1e5?5:V>=1e4?4:V>=1e3?3:V>=100?2:V>=10?1:0},I.popCount=function(V){return 16843009*((V=(858993459&(V-=V>>>1&1431655765))+(V>>>2&858993459))+(V>>>4)&252645135)>>>24},I.countTrailingZeros=A,I.nextPow2=function(V){return V+=0===V,--V,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)+1},I.prevPow2=function(V){return V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)-(V>>>1)},I.parity=function(V){return V^=V>>>16,V^=V>>>8,V^=V>>>4,27030>>>(V&=15)&1};var B=new Array(256);!function(V){for(var I=0;I<256;++I){var A=I,B=I,F=7;for(A>>>=1;A;A>>>=1)B<<=1,B|=1&A,--F;V[I]=B<<F&255}}(B),I.reverse=function(V){return B[255&V]<<24|B[V>>>8&255]<<16|B[V>>>16&255]<<8|B[V>>>24&255]},I.interleave2=function(V,I){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))<<1},I.deinterleave2=function(V,I){return(V=65535&((V=16711935&((V=252645135&((V=858993459&((V=V>>>I&1431655765)|V>>>1))|V>>>2))|V>>>4))|V>>>16))<<16>>16},I.interleave3=function(V,I,A){return V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2),(V|=(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<1)|(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<2},I.deinterleave3=function(V,I){return(V=1023&((V=4278190335&((V=251719695&((V=3272356035&((V=V>>>I&1227133513)|V>>>2))|V>>>4))|V>>>8))|V>>>16))<<22>>22},I.nextCombination=function(V){var I=V|V-1;return I+1|(~I&-~I)-1>>>A(V)+1}},12408:V=>{"use strict";V.exports=function(V,I,A,B){var F=self||window;try{try{var E;try{E=new F.Blob([V])}catch(b){(E=new(F.BlobBuilder||F.WebKitBlobBuilder||F.MozBlobBuilder||F.MSBlobBuilder)).append(V),E=E.getBlob()}var Y=F.URL||F.webkitURL,H=Y.createObjectURL(E),c=new F[I](H,A);return Y.revokeObjectURL(H),c}catch(b){return new F[I]("data:application/javascript,".concat(encodeURIComponent(V)),A)}}catch(b){if(!B)throw Error("Inline worker is not supported");return new F[I](B,A)}}},12054:(V,I,A)=>{"use strict";function B(V,I,A,B,F){var E={};return Object.keys(B).forEach((function(V){E[V]=B[V]})),E.enumerable=!!E.enumerable,E.configurable=!!E.configurable,("value"in E||E.initializer)&&(E.writable=!0),E=A.slice().reverse().reduce((function(A,B){return B(V,I,A)||A}),E),F&&void 0!==E.initializer&&(E.value=E.initializer?E.initializer.call(F):void 0,E.initializer=void 0),void 0===E.initializer&&(Object.defineProperty(V,I,E),E=null),E}A.d(I,{e:()=>B})},12047:(V,I,A)=>{"use strict";function B(V,I,A,B){A&&Object.defineProperty(V,I,{enumerable:A.enumerable,configurable:A.configurable,writable:A.writable,value:A.initializer?A.initializer.call(B):void 0})}A.d(I,{d:()=>B})},13389:(V,I,A)=>{"use strict";A.d(I,{d:()=>Y,f:()=>P,i:()=>H,j:()=>E,k:()=>c,n:()=>F,p:()=>b,t:()=>X});var B=A(11440);class F{constructor(){this._easingMode=F.EASINGMODE_EASEIN}setEasingMode(V){const I=Math.min(Math.max(V,0),2);this._easingMode=I}getEasingMode(){return this._easingMode}easeInCore(V){throw new Error("You must implement this method")}ease(V){switch(this._easingMode){case F.EASINGMODE_EASEIN:return this.easeInCore(V);case F.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-V)}return V>=.5?.5*(1-this.easeInCore(2*(1-V)))+.5:.5*this.easeInCore(2*V)}}F.EASINGMODE_EASEIN=0,F.EASINGMODE_EASEOUT=1,F.EASINGMODE_EASEINOUT=2;class E extends F{easeInCore(V){return V=Math.max(0,Math.min(1,V)),1-Math.sqrt(1-V*V)}}class Y extends F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=V}easeInCore(V){const I=Math.max(0,this.amplitude);return Math.pow(V,3)-V*I*Math.sin(3.141592653589793*V)}}class H extends F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=V,this.bounciness=I}easeInCore(V){const I=Math.max(0,this.bounces);let A=this.bounciness;A<=1&&(A=1.001);const B=Math.pow(A,I),F=1-A,E=(1-B)/F+.5*B,Y=V*E,H=Math.log(-Y*(1-A)+1)/Math.log(A),c=Math.floor(H),b=c+1,X=(1-Math.pow(A,c))/(F*E),P=.5*(X+(1-Math.pow(A,b))/(F*E)),J=V-P,G=P-X;return-Math.pow(1/A,I-c)/(G*G)*(J-G)*(J+G)}}class c extends F{easeInCore(V){return V*V*V}}class b extends F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=V,this.springiness=I}easeInCore(V){let I;const A=Math.max(0,this.oscillations),B=Math.max(0,this.springiness);return I=0==B?V:(Math.exp(B*V)-1)/(Math.exp(B)-1),I*Math.sin((6.283185307179586*A+1.5707963267948966)*V)}}class X extends F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=V}easeInCore(V){return this.exponent<=0?V:(Math.exp(this.exponent*V)-1)/(Math.exp(this.exponent)-1)}}class P extends F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=V,this.y1=I,this.x2=A,this.y2=B}easeInCore(V){return B.c.Interpolate(V,this.x1,this.y1,this.x2,this.y2)}}},12882:(V,I,A)=>{"use strict";A.d(I,{c:()=>Y});var B=A(11231),F=A(11240),E=A(11666);class Y extends E.b{get _matrix(){return this._compose(),this.qG}set _matrix(V){(V.updateFlag!==this.qG.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.qG.B(V),this._markAsDirtyAndDecompose())}constructor(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(V,I.sV(),!1),this.name=V,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=I,this.qG=(null===F||void 0===F?void 0:F.clone())??B.Matrix.Identity(),this._restMatrix=E??this.qG.clone(),this._bindMatrix=Y??this.qG.clone(),this._index=H,this._absoluteMatrix=new B.Matrix,this._absoluteBindMatrix=new B.Matrix,this._absoluteInverseBindMatrix=new B.Matrix,this._finalMatrix=new B.Matrix,I.bones.push(this),this.setParent(A,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(V){this.setParent(V)}setParent(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==V){if(this.parent){const V=this.parent.children.indexOf(this);-1!==V&&this.parent.children.splice(V,1)}this._parentNode=V,this.parent&&this.parent.children.push(this),I&&this._updateAbsoluteBindMatrices(),this.FP()}}getLocalMatrix(){return this._compose(),this.qG}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(V){this._restMatrix.B(V)}setRestPose(V){this.setRestMatrix(V)}getBindPose(){return this.getBindMatrix()}setBindMatrix(V){this.EH(V)}setBindPose(V){this.setBindMatrix(V)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const V=B.TmpVectors.tI[0],I=B.TmpVectors.Quaternion[0],A=B.TmpVectors.tI[1];this.getRestMatrix().decompose(V,I,A),this._linkedTransformNode.position.B(A),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??B.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.B(I),this._linkedTransformNode.PH.B(V)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(V){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=V,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.lH}set position(V){this._decompose(),this.lH.B(V),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(V){this.setRotation(V)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(V){this.setRotationQuaternion(V)}get PH(){return this.getScale()}set PH(V){this.setScale(V)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=B.tI.Zero(),this._localRotation=B.Quaternion.Zero(),this.lH=B.tI.Zero()),this.qG.decompose(this._localScaling,this._localRotation,this.lH))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,B.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.lH,this.qG)):this._needToCompose=!1)}EH(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.B(V),I&&this._updateAbsoluteBindMatrices(),A?this._matrix=V:this.FP()}_updateAbsoluteBindMatrices(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V||(V=this._bindMatrix),this.parent?V.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.B(V),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),I)for(let A=0;A<this.children.length;A++)this.children[A]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}FP(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.FP(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.FP(),this._needToDecompose=!0}_updatePosition(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0,F=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=this.getLocalMatrix();if(0==I)F?(E.addAtIndex(12,V.x),E.addAtIndex(13,V.y),E.addAtIndex(14,V.z)):E.setTranslationFromFloats(V.x,V.y,V.z);else{let I=null;A&&(I=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const H=Y._TmpMats[0],c=Y._TmpVecs[0];this.parent?A&&I?(H.B(this.parent.getAbsoluteMatrix()),H.multiplyToRef(I,H)):H.B(this.parent.getAbsoluteMatrix()):B.Matrix.IdentityToRef(H),F&&H.setTranslationFromFloats(0,0,0),H.invert(),B.tI.TransformCoordinatesToRef(V,H,c),F?(E.addAtIndex(12,c.x),E.addAtIndex(13,c.y),E.addAtIndex(14,c.z)):E.setTranslationFromFloats(c.x,c.y,c.z)}this._markAsDirtyAndDecompose()}translate(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this._updatePosition(V,I,A,!0)}setPosition(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this._updatePosition(V,I,A,!1)}setAbsolutePosition(V,I){this.setPosition(V,1,I)}scale(V,I,A){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=this.getLocalMatrix(),H=Y._TmpMats[0];B.Matrix.ScalingToRef(V,I,A,H),H.multiplyToRef(E,E),H.invert();for(const B of this.children){const F=B.getLocalMatrix();F.multiplyToRef(H,F),F.multiplyAtIndex(12,V),F.multiplyAtIndex(13,I),F.multiplyAtIndex(14,A),B._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),F)for(const B of this.children)B.scale(V,I,A,F)}setScale(V){this._decompose(),this._localScaling.B(V),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(V){this._decompose(),V.B(this._localScaling)}setYawPitchRoll(V,I,A){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4?arguments[4]:void 0;if(0===F){const H=Y._TmpQuat;return B.Quaternion.RotationYawPitchRollToRef(V,I,A,H),void this.setRotationQuaternion(H,F,E)}const H=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(H,E))return;const c=Y._TmpMats[1];B.Matrix.RotationYawPitchRollToRef(V,I,A,c),H.multiplyToRef(c,c),this._rotateWithMatrix(c,F,E)}rotate(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,F=arguments.length>3?arguments[3]:void 0;const E=Y._TmpMats[0];E.setTranslationFromFloats(0,0,0),B.Matrix.RotationAxisToRef(V,I,E),this._rotateWithMatrix(E,A,F)}setAxisAngle(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,F=arguments.length>3?arguments[3]:void 0;if(0===A){const E=Y._TmpQuat;return B.Quaternion.RotationAxisToRef(V,I,E),void this.setRotationQuaternion(E,A,F)}const E=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,F))return;const H=Y._TmpMats[1];B.Matrix.RotationAxisToRef(V,I,H),E.multiplyToRef(H,H),this._rotateWithMatrix(H,A,F)}setRotation(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(V.y,V.x,V.z,I,A)}setRotationQuaternion(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;if(0===I)return this._decompose(),this._localRotation.B(V),void this._markAsDirtyAndCompose();const F=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,A))return;const E=Y._TmpMats[1];B.Matrix.FromQuaternionToRef(V,E),F.multiplyToRef(E,E),this._rotateWithMatrix(E,I,A)}setRotationMatrix(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;if(0===I){const F=Y._TmpQuat;return B.Quaternion.FromRotationMatrixToRef(V,F),void this.setRotationQuaternion(F,I,A)}const F=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,A))return;const E=Y._TmpMats[1];E.B(V),F.multiplyToRef(V,E),this._rotateWithMatrix(E,I,A)}_rotateWithMatrix(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;const B=this.getLocalMatrix(),F=B.m[12],E=B.m[13],H=B.m[14],c=this.getParent(),b=Y._TmpMats[3],X=Y._TmpMats[4];c&&1==I?(A?(b.B(A.getWorldMatrix()),c.getAbsoluteMatrix().multiplyToRef(b,b)):b.B(c.getAbsoluteMatrix()),X.B(b),X.invert(),B.multiplyToRef(b,B),B.multiplyToRef(V,B),B.multiplyToRef(X,B)):1==I&&A?(b.B(A.getWorldMatrix()),X.B(b),X.invert(),B.multiplyToRef(b,B),B.multiplyToRef(V,B),B.multiplyToRef(X,B)):B.multiplyToRef(V,B),B.setTranslationFromFloats(F,E,H),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(V,I){const A=Y._TmpMats[2];return V.B(this.getAbsoluteMatrix()),I?(V.multiplyToRef(I.getWorldMatrix(),V),B.Matrix.ScalingToRef(I.PH.x,I.PH.y,I.PH.z,A)):B.Matrix.IdentityToRef(A),V.invert(),!isNaN(V.m[0])&&(A.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyToRef(A,V),!0)}TY(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=B.tI.Zero();return this.getPositionToRef(V,I,A),A}getPositionToRef(){let V=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const V=this.getLocalMatrix();I.x=V.m[12],I.y=V.m[13],I.z=V.m[14]}else{let A=null;V&&(A=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let B=Y._TmpMats[0];V&&A?(B.B(this.getAbsoluteMatrix()),B.multiplyToRef(A,B)):B=this.getAbsoluteMatrix(),I.x=B.m[12],I.y=B.m[13],I.z=B.m[14]}}getAbsolutePosition(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const I=B.tI.Zero();return this.getPositionToRef(1,V,I),I}getAbsolutePositionToRef(V,I){this.getPositionToRef(1,V,I)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.qG.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.B(this.qG);const V=this._skeleton.getPoseMatrix();V&&this._absoluteMatrix.multiplyToRef(V,this._absoluteMatrix)}const V=this.children,I=V.length;for(let A=0;A<I;A++)V[A].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Rc(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=B.tI.Zero();return this.getDirectionToRef(V,I,A),A}getDirectionToRef(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,F=null;I&&(F=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=Y._TmpMats[0];E.B(this.getAbsoluteMatrix()),I&&F&&E.multiplyToRef(F,E),B.tI.TransformNormalToRef(V,E,A),A.normalize()}getRotation(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=B.tI.Zero();return this.getRotationToRef(V,I,A),A}getRotationToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;const B=Y._TmpQuat;this.getRotationQuaternionToRef(V,I,B),B.toEulerAnglesToRef(A)}getRotationQuaternion(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=B.Quaternion.Identity();return this.getRotationQuaternionToRef(V,I,A),A}getRotationQuaternionToRef(){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),I.B(this._localRotation);else{const A=Y._TmpMats[0],B=this.getAbsoluteMatrix();V?B.multiplyToRef(V.getWorldMatrix(),A):A.B(B),A.multiplyAtIndex(0,this._scalingDeterminant),A.multiplyAtIndex(1,this._scalingDeterminant),A.multiplyAtIndex(2,this._scalingDeterminant),A.decompose(void 0,I,void 0)}}getRotationMatrix(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1?arguments[1]:void 0;const A=B.Matrix.Identity();return this.getRotationMatrixToRef(V,I,A),A}getRotationMatrixToRef(){let V=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(I);else{const A=Y._TmpMats[0],B=this.getAbsoluteMatrix();V?B.multiplyToRef(V.getWorldMatrix(),A):A.B(B),A.multiplyAtIndex(0,this._scalingDeterminant),A.multiplyAtIndex(1,this._scalingDeterminant),A.multiplyAtIndex(2,this._scalingDeterminant),A.getRotationMatrixToRef(I)}}getAbsolutePositionFromLocal(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=B.tI.Zero();return this.getAbsolutePositionFromLocalToRef(V,I,A),A}getAbsolutePositionFromLocalToRef(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,F=null;I&&(F=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=Y._TmpMats[0];E.B(this.getAbsoluteMatrix()),I&&F&&E.multiplyToRef(F,E),B.tI.TransformCoordinatesToRef(V,E,A)}getLocalPositionFromAbsolute(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=B.tI.Zero();return this.getLocalPositionFromAbsoluteToRef(V,I,A),A}getLocalPositionFromAbsoluteToRef(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,F=null;I&&(F=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=Y._TmpMats[0];E.B(this.getAbsoluteMatrix()),I&&F&&E.multiplyToRef(F,E),E.invert(),B.tI.TransformCoordinatesToRef(V,E,A)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const V=this._skeleton.bones.indexOf(this);if(-1!==V&&this._skeleton.bones.splice(V,1),this._parentNode&&this._parentNode.children){const V=this._parentNode.children,I=V.indexOf(this);-1!==I&&V.splice(I,1)}super.dispose()}}Y._TmpVecs=(0,F.b)(2,B.tI.Zero),Y._TmpQuat=B.Quaternion.Identity(),Y._TmpMats=(0,F.b)(5,B.Matrix.Identity)},13384:(V,I,A)=>{"use strict";A.d(I,{e:()=>R});var B=A(11213),F=A(11222),E=A(11057),Y=A(11231),H=A(11249),c=A(11666),b=A(11701),X=A(11507),P=A(11075),J=A(11237);class G{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(V){this._zoomStopsAnimation=V}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(V){this._idleRotationSpeed=V}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(V){this._idleRotationWaitTime=V}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(V){this._idleRotationSpinupTime=V}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(V){this._attachedCamera=V;const I=this._attachedCamera.sV();this._onPrePointerObservableObserver=I.onPrePointerObservable.add((V=>{V.type!==X.d.POINTERDOWN?V.type===X.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const V=P.e.Now;let I=0;null!=this._lastFrameTime&&(I=V-this._lastFrameTime),this._lastFrameTime=V,this._applyUserInteraction();const A=V-this._lastInteractionTime-this._idleRotationWaitTime,B=Math.max(Math.min(A/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*B,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(I/1e3))}))}detach(){if(!this._attachedCamera)return;const V=this._attachedCamera.sV();this._onPrePointerObservableObserver&&V.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(V){this._lastInteractionTime=V??P.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<J.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let V=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(V=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?V:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=P.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var w=A(13389),t=A(11790);class u{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(V){if(this._autoTransitionRange===V)return;this._autoTransitionRange=V;const I=this._attachedCamera;I&&(V?this._onMeshTargetChangedObserver=I.onMeshTargetChangedObservable.add((V=>{if(V&&(V.YH(!0),V.getBoundingInfo)){const I=V.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*I,this.upperRadiusTransitionRange=.05*I}})):this._onMeshTargetChangedObserver&&I.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(V){this._attachedCamera=V,this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(V){return!!this._attachedCamera&&(this._attachedCamera.radius===V&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(V){if(!this._attachedCamera)return;this._radiusBounceTransition||(u.EasingFunction.setEasingMode(u.EasingMode),this._radiusBounceTransition=t.d.CreateAnimation("radius",t.d.ANIMATIONTYPE_FLOAT,60,u.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const I=t.d.TransitionTo("radius",this._attachedCamera.radius+V,this._attachedCamera,this._attachedCamera.sV(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));I&&this._animatables.push(I)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}u.EasingFunction=new w.d(.3),u.EasingMode=w.n.EASINGMODE_EASEOUT;class W{constructor(){this.onTargetFramingAnimationEndObservable=new E.c,this._mode=W.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(V){this._mode=V}get mode(){return this._mode}set radiusScale(V){this._radiusScale=V}get radiusScale(){return this._radiusScale}set positionScale(V){this._positionScale=V}get positionScale(){return this._positionScale}set defaultElevation(V){this._defaultElevation=V}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(V){this._elevationReturnTime=V}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(V){this._elevationReturnWaitTime=V}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(V){this._zoomStopsAnimation=V}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(V){this._framingTime=V}get framingTime(){return this._framingTime}init(){}attach(V){this._attachedCamera=V;const I=this._attachedCamera.sV();W.EasingFunction.setEasingMode(W.EasingMode),this._onPrePointerObservableObserver=I.onPrePointerObservable.add((V=>{V.type!==X.d.POINTERDOWN?V.type===X.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=V.onMeshTargetChangedObservable.add((V=>{V&&V.getBoundingInfo&&this.zoomOnMesh(V,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const V=this._attachedCamera.sV();this._onPrePointerObservableObserver&&V.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.YH(!0);const B=V.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(B.minimumWorld,B.maximumWorld,I,A)}zoomOnMeshHierarchy(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.YH(!0);const B=V.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(B.min,B.max,I,A)}zoomOnMeshesHierarchy(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new Y.tI(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=new Y.tI(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let E=0;E<V.length;E++){const I=V[E].getHierarchyBoundingVectors(!0);Y.tI.CheckExtends(I.min,B,F),Y.tI.CheckExtends(I.max,B,F)}this.zoomOnBoundingInfo(B,F,I,A)}zoomOnBoundingInfo(V,I){let A,B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const E=V.y,H=E+(I.y-E)*this._positionScale,c=I.uI(V).scale(.5);if(!isFinite(H))return!1;if(B)A=new Y.tI(0,H,0);else{const I=V.add(c);A=new Y.tI(I.x,H,I.z)}this._vectorTransition||(this._vectorTransition=t.d.CreateAnimation("target",t.d.ANIMATIONTYPE_VECTOR3,60,W.EasingFunction)),this._betaIsAnimating=!0;let b=t.d.TransitionTo("target",A,this._attachedCamera,this._attachedCamera.sV(),60,this._vectorTransition,this._framingTime);b&&this._animatables.push(b);let X=0;if(this._mode===W.FitFrustumSidesMode){const A=this._calculateLowerRadiusFromModelBoundingSphere(V,I);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=c.length()+this._attachedCamera.FH),X=A}else this._mode===W.IgnoreBoundsSizeMode&&(X=this._calculateLowerRadiusFromModelBoundingSphere(V,I),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.FH));if(this.autoCorrectCameraLimitsAndSensibility){const A=I.uI(V).length();this._attachedCamera.panningSensibility=5e3/A,this._attachedCamera.wheelPrecision=100/X}return this._radiusTransition||(this._radiusTransition=t.d.CreateAnimation("radius",t.d.ANIMATIONTYPE_FLOAT,60,W.EasingFunction)),b=t.d.TransitionTo("radius",X,this._attachedCamera,this._attachedCamera.sV(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),F&&F(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),b&&this._animatables.push(b),!0}_calculateLowerRadiusFromModelBoundingSphere(V,I){const A=this._attachedCamera;if(!A)return 0;let B=A._calculateLowerRadiusFromModelBoundingSphere(V,I,this._radiusScale);return A.lowerRadiusLimit&&this._mode===W.IgnoreBoundsSizeMode&&(B=B<A.lowerRadiusLimit?A.lowerRadiusLimit:B),A.upperRadiusLimit&&(B=B>A.upperRadiusLimit?A.upperRadiusLimit:B),B}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const V=P.e.Now-this._lastInteractionTime,I=.5*Math.PI-this._defaultElevation,A=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>A&&V>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=t.d.CreateAnimation("beta",t.d.ANIMATIONTYPE_FLOAT,60,W.EasingFunction));const V=t.d.TransitionTo("beta",I,this._attachedCamera,this._attachedCamera.sV(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));V&&this._animatables.push(V)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=P.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}W.EasingFunction=new w.t,W.EasingMode=w.n.EASINGMODE_EASEINOUT,W.IgnoreBoundsSizeMode=0,W.FitFrustumSidesMode=1;var g=A(11707),o=A(11746),L=A(12877),z=A(11052);class m{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(V){V=z.Tools.BackCompatCameraNoPreventDefault(arguments);const I=this.camera.getEngine(),A=I.getInputElement();let B=0,F=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=E=>{var Y,H;const c=E.event,b="touch"===c.pointerType;if(E.type!==X.d.POINTERMOVE&&-1===this.buttons.indexOf(c.button))return;const P=c.target;if(this._altKey=c.altKey,this._ctrlKey=c.ctrlKey,this._metaKey=c.metaKey,this._shiftKey=c.shiftKey,this._buttonsPressed=c.buttons,I.isPointerLock){const V=c.movementX,I=c.movementY;this.onTouch(null,V,I),this._pointA=null,this._pointB=null}else{if(E.type!==X.d.POINTERDOWN&&E.type!==X.d.POINTERDOUBLETAP&&b&&(null===(Y=this._pointA)||void 0===Y?void 0:Y.pointerId)!==c.pointerId&&(null===(H=this._pointB)||void 0===H?void 0:H.pointerId)!==c.pointerId)return;if(E.type!==X.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!b)if(E.type===X.d.POINTERDOUBLETAP)this.onDoubleTap(c.pointerType);else if(E.type!==X.d.POINTERUP||this._currentMousePointerIdDown!==c.pointerId&&!b){if(E.type===X.d.POINTERMOVE)if(V||c.preventDefault(),this._pointA&&null===this._pointB){const V=c.clientX-this._pointA.x,I=c.clientY-this._pointA.y;this._pointA.x=c.clientX,this._pointA.y=c.clientY,this.onTouch(this._pointA,V,I)}else if(this._pointA&&this._pointB){const V=this._pointA.pointerId===c.pointerId?this._pointA:this._pointB;V.x=c.clientX,V.y=c.clientY;const I=this._pointA.x-this._pointB.x,A=this._pointA.y-this._pointB.y,Y=I*I+A*A,H={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:c.pointerId,type:E.type};this.onMultiTouch(this._pointA,this._pointB,B,Y,F,H),F=H,B=Y}}else{try{null===P||void 0===P||P.releasePointerCapture(c.pointerId)}catch(J){}b||(this._pointB=null),I._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==c.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==c.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==B||F)&&(this.onMultiTouch(this._pointA,this._pointB,B,0,F,null),B=0,F=null),this._currentMousePointerIdDown=-1,this.onButtonUp(c),V||c.preventDefault()}else{try{null===P||void 0===P||P.setPointerCapture(c.pointerId)}catch(J){}if(null===this._pointA)this._pointA={x:c.clientX,y:c.clientY,pointerId:c.pointerId,type:c.pointerType};else{if(null!==this._pointB)return;this._pointB={x:c.clientX,y:c.clientY,pointerId:c.pointerId,type:c.pointerType}}-1!==this._currentMousePointerIdDown||b||(this._currentMousePointerIdDown=c.pointerId),this.onButtonDown(c),V||(c.preventDefault(),A&&A.focus())}}},this._observer=this.camera.sV()._inputManager._addCameraPointerObserver(this._pointerInput,X.d.POINTERDOWN|X.d.POINTERUP|X.d.POINTERMOVE|X.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,B=0,F=null,this.onLostFocus()},this._contextMenuBind=V=>this.onContextMenu(V),A&&A.addEventListener("contextmenu",this._contextMenuBind,!1);const E=this.camera.sV().getEngine().getHostWindow();E&&z.Tools.RegisterTopRootEvents(E,[{name:"blur",handler:this._onLostFocus}])}TJ(){if(this._onLostFocus){const V=this.camera.sV().getEngine().getHostWindow();V&&z.Tools.UnregisterTopRootEvents(V,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.sV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const V=this.camera.sV().getEngine().getInputElement();V&&V.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(V){}onTouch(V,I,A){}onMultiTouch(V,I,A,B,F,E){}onContextMenu(V){V.preventDefault()}onButtonDown(V){}onButtonUp(V){}onLostFocus(){}}(0,B.b)([(0,F.A)()],m.prototype,"buttons",void 0);class s extends m{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(V,I){if(0!==this.panningSensibility&&V&&I){const A=I.x-V.x,B=I.y-V.y;this.camera.inertialPanningX+=-A/this.panningSensibility,this.camera.inertialPanningY+=B/this.panningSensibility}}_computePinchZoom(V,I){const A=this.camera.radius||s.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=A*Math.sqrt(V)/Math.sqrt(I):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(I-V)*A*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(I-V)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(V,I,A){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-I/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility):(this.camera.inertialAlphaOffset-=I/this.angularSensibilityX,this.camera.inertialBetaOffset-=A/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(V,I,A,B,F,E){0===A&&null===F||0===B&&null===E||(this.multiTouchPanAndZoom?(this._computePinchZoom(A,B),this._computeMultiTouchPanning(F,E)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(B)-Math.sqrt(A))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(A,B),this._isPinching=!0):this._computeMultiTouchPanning(F,E)):this.multiTouchPanning?this._computeMultiTouchPanning(F,E):this.pinchZoom&&this._computePinchZoom(A,B))}onButtonDown(V){this._isPanClick=V.button===this.camera._panningMouseButton}onButtonUp(V){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}s.MinimumRadiusForPinch=.001,(0,B.b)([(0,F.A)()],s.prototype,"buttons",void 0),(0,B.b)([(0,F.A)()],s.prototype,"angularSensibilityX",void 0),(0,B.b)([(0,F.A)()],s.prototype,"angularSensibilityY",void 0),(0,B.b)([(0,F.A)()],s.prototype,"pinchPrecision",void 0),(0,B.b)([(0,F.A)()],s.prototype,"pinchDeltaPercentage",void 0),(0,B.b)([(0,F.A)()],s.prototype,"useNaturalPinchZoom",void 0),(0,B.b)([(0,F.A)()],s.prototype,"pinchZoom",void 0),(0,B.b)([(0,F.A)()],s.prototype,"panningSensibility",void 0),(0,B.b)([(0,F.A)()],s.prototype,"multiTouchPanning",void 0),(0,B.b)([(0,F.A)()],s.prototype,"multiTouchPanAndZoom",void 0),L.e.ArcRotateCameraPointersInput=s;var e=A(11513);class S{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(V){V=z.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.sV(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((I=>{const A=I.event;if(!A.metaKey)if(I.type===e.e.KEYDOWN){if(this._ctrlPressed=A.ctrlKey,this._altPressed=A.altKey,-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysReset.indexOf(A.keyCode)){-1===this._keys.indexOf(A.keyCode)&&this._keys.push(A.keyCode),A.preventDefault&&(V||A.preventDefault())}}else if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysReset.indexOf(A.keyCode)){const I=this._keys.indexOf(A.keyCode);I>=0&&this._keys.splice(I,1),A.preventDefault&&(V||A.preventDefault())}})))}TJ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const V=this.camera;for(let I=0;I<this._keys.length;I++){const A=this._keys[I];-1!==this.keysLeft.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningX-=1/this.panningSensibility:V.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?V.inertialRadiusOffset+=1/this.zoomingSensibility:V.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningX+=1/this.panningSensibility:V.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?V.inertialRadiusOffset-=1/this.zoomingSensibility:V.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(A)&&V.useInputToRestoreState&&V.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,B.b)([(0,F.A)()],S.prototype,"keysUp",void 0),(0,B.b)([(0,F.A)()],S.prototype,"keysDown",void 0),(0,B.b)([(0,F.A)()],S.prototype,"keysLeft",void 0),(0,B.b)([(0,F.A)()],S.prototype,"keysRight",void 0),(0,B.b)([(0,F.A)()],S.prototype,"keysReset",void 0),(0,B.b)([(0,F.A)()],S.prototype,"panningSensibility",void 0),(0,B.b)([(0,F.A)()],S.prototype,"zoomingSensibility",void 0),(0,B.b)([(0,F.A)()],S.prototype,"useAltToZoom",void 0),(0,B.b)([(0,F.A)()],S.prototype,"angularSpeed",void 0),L.e.ArcRotateCameraKeyboardMoveInput=S;var Q=A(11278),h=A(11519);class r{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Y.tI(0,0,0),this._globalOffset=new Y.tI(0,0,0),this._inertialPanning=Y.tI.Zero()}_computeDeltaFromMouseWheelLegacyEvent(V,I){let A=0;const B=.01*V*this.wheelDeltaPercentage*I;return A=V>0?B/(1+this.wheelDeltaPercentage):B*(1+this.wheelDeltaPercentage),A}attachControl(V){V=z.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=I=>{if(I.type!==X.d.POINTERWHEEL)return;const A=I.event;let B=0;const F=A.deltaMode===h.c.DOM_DELTA_LINE?40:1,E=-A.deltaY*F;if(this.customComputeDeltaFromMouseWheel)B=this.customComputeDeltaFromMouseWheel(E,this,A);else if(this.wheelDeltaPercentage){if(B=this._computeDeltaFromMouseWheelLegacyEvent(E,this.camera.radius),B>0){let V=this.camera.radius,I=this.camera.inertialRadiusOffset+B;for(let A=0;A<20&&!(V<=I)&&!(Math.abs(I*this.camera.inertia)<.001);A++)V-=I,I*=this.camera.inertia;V=(0,H.Clamp)(V,0,Number.MAX_VALUE),B=this._computeDeltaFromMouseWheelLegacyEvent(E,V)}}else B=E/(40*this.wheelPrecision);B&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(B)):this.camera.inertialRadiusOffset+=B),A.preventDefault&&(V||A.preventDefault())},this._observer=this.camera.sV()._inputManager._addCameraPointerObserver(this._wheel,X.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.JH(0)}TJ(){this._observer&&(this.camera.sV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const V=this.camera;0+V.inertialAlphaOffset+V.inertialBetaOffset+V.inertialRadiusOffset&&(this._updateHitPlane(),V.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(V.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const V=this.camera,I=V.target.uI(V.position);this._hitPlane=Q.d.FromPositionAndNormal(V.target,I)}_getPosition(){const V=this.camera,I=V.sV(),A=I.createPickingRay(I.pointerX,I.pointerY,Y.Matrix.Identity(),V,!1);0===V.targetScreenOffset.x&&0===V.targetScreenOffset.y||(this._viewOffset.set(V.targetScreenOffset.x,V.targetScreenOffset.y,0),V.getViewMatrix().invertToRef(V._cameraTransformMatrix),this._globalOffset=Y.tI.TransformNormal(this._viewOffset,V._cameraTransformMatrix),A.origin.addInPlace(this._globalOffset));let B=0;return this._hitPlane&&(B=A.intersectsPlane(this._hitPlane)??0),A.origin.addInPlace(A.direction.scaleInPlace(B))}_zoomToMouse(V){const I=this.camera,A=1-I.inertia;if(I.lowerRadiusLimit){const B=I.lowerRadiusLimit??0;I.radius-(I.inertialRadiusOffset+V)/A<B&&(V=(I.radius-B)*A-I.inertialRadiusOffset)}if(I.upperRadiusLimit){const B=I.upperRadiusLimit??0;I.radius-(I.inertialRadiusOffset+V)/A>B&&(V=(I.radius-B)*A-I.inertialRadiusOffset)}const B=V/A/I.radius,F=this._getPosition(),E=Y.TmpVectors.tI[6];F.subtractToRef(I.target,E),E.scaleInPlace(B),E.scaleInPlace(A),this._inertialPanning.addInPlace(E),I.inertialRadiusOffset+=V}_zeroIfClose(V){Math.abs(V.x)<J.d&&(V.x=0),Math.abs(V.y)<J.d&&(V.y=0),Math.abs(V.z)<J.d&&(V.z=0)}}(0,B.b)([(0,F.A)()],r.prototype,"wheelPrecision",void 0),(0,B.b)([(0,F.A)()],r.prototype,"zoomToMouseLocation",void 0),(0,B.b)([(0,F.A)()],r.prototype,"wheelDeltaPercentage",void 0),L.e.ArcRotateCameraMouseWheelInput=r;class M extends L.i{constructor(V){super(V)}addMouseWheel(){return this.add(new r),this}addPointers(){return this.add(new s),this}addKeyboard(){return this.add(new S),this}}var x=A(11189);function f(V,I){return isNaN(V)?I:V}c.b.AddNodeConstructor("ArcRotateCamera",((V,I)=>()=>new R(V,0,0,1,Y.tI.Zero(),I)));class R extends o.d{get target(){return this._target}set target(V){this.setTarget(V)}get targetHost(){return this._targetHost}set targetHost(V){V&&this.setTarget(V)}getTarget(){return this.target}get position(){return this._position}set position(V){this.setPosition(V)}set upVector(V){this._upToYMatrix||(this._yToUpMatrix=new Y.Matrix,this._upToYMatrix=new Y.Matrix,this._upVector=Y.tI.Zero()),V.normalize(),this._upVector.B(V),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Y.Matrix.RotationAlignToRef(Y.tI.UpReadOnly,this._upVector,this._yToUpMatrix),Y.Matrix.RotationAlignToRef(this._upVector,Y.tI.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const V=this.inputs.attached.pointers;return V?V.angularSensibilityX:0}set angularSensibilityX(V){const I=this.inputs.attached.pointers;I&&(I.angularSensibilityX=V)}get angularSensibilityY(){const V=this.inputs.attached.pointers;return V?V.angularSensibilityY:0}set angularSensibilityY(V){const I=this.inputs.attached.pointers;I&&(I.angularSensibilityY=V)}get pinchPrecision(){const V=this.inputs.attached.pointers;return V?V.pinchPrecision:0}set pinchPrecision(V){const I=this.inputs.attached.pointers;I&&(I.pinchPrecision=V)}get pinchDeltaPercentage(){const V=this.inputs.attached.pointers;return V?V.pinchDeltaPercentage:0}set pinchDeltaPercentage(V){const I=this.inputs.attached.pointers;I&&(I.pinchDeltaPercentage=V)}get useNaturalPinchZoom(){const V=this.inputs.attached.pointers;return!!V&&V.useNaturalPinchZoom}set useNaturalPinchZoom(V){const I=this.inputs.attached.pointers;I&&(I.useNaturalPinchZoom=V)}get panningSensibility(){const V=this.inputs.attached.pointers;return V?V.panningSensibility:0}set panningSensibility(V){const I=this.inputs.attached.pointers;I&&(I.panningSensibility=V)}get keysUp(){const V=this.inputs.attached.keyboard;return V?V.keysUp:[]}set keysUp(V){const I=this.inputs.attached.keyboard;I&&(I.keysUp=V)}get keysDown(){const V=this.inputs.attached.keyboard;return V?V.keysDown:[]}set keysDown(V){const I=this.inputs.attached.keyboard;I&&(I.keysDown=V)}get keysLeft(){const V=this.inputs.attached.keyboard;return V?V.keysLeft:[]}set keysLeft(V){const I=this.inputs.attached.keyboard;I&&(I.keysLeft=V)}get keysRight(){const V=this.inputs.attached.keyboard;return V?V.keysRight:[]}set keysRight(V){const I=this.inputs.attached.keyboard;I&&(I.keysRight=V)}get wheelPrecision(){const V=this.inputs.attached.mousewheel;return V?V.wheelPrecision:0}set wheelPrecision(V){const I=this.inputs.attached.mousewheel;I&&(I.wheelPrecision=V)}get zoomToMouseLocation(){const V=this.inputs.attached.mousewheel;return!!V&&V.zoomToMouseLocation}set zoomToMouseLocation(V){const I=this.inputs.attached.mousewheel;I&&(I.zoomToMouseLocation=V)}get wheelDeltaPercentage(){const V=this.inputs.attached.mousewheel;return V?V.wheelDeltaPercentage:0}set wheelDeltaPercentage(V){const I=this.inputs.attached.mousewheel;I&&(I.wheelDeltaPercentage=V)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(V){V!==this.useBouncingBehavior&&(V?(this._bouncingBehavior=new u,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(V){V!==this.useFramingBehavior&&(V?(this._framingBehavior=new W,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(V){V!==this.useAutoRotationBehavior&&(V?(this._autoRotationBehavior=new G,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(V,I,A,B,F,H){var c;let b=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(V,Y.tI.Zero(),H,b),c=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Y.tI.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Y.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new Y.Matrix,this.panningAxis=new Y.tI(1,1,0),this._transformedDirection=new Y.tI,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new E.c,this.checkCollisions=!1,this.collisionRadius=new Y.tI(.5,.5,.5),this._previousPosition=Y.tI.Zero(),this._collisionVelocity=Y.tI.Zero(),this._newPosition=Y.tI.Zero(),this._computationVector=Y.tI.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new Y.tI(NaN,NaN,NaN),this._goalTargetScreenOffset=new Y.Vector2(NaN,NaN),this._onCollisionPositionChange=function(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A?(c.setPosition(I),c.Qw&&c.Qw(A)):c._previousPosition.B(c._position);const B=Math.cos(c.alpha),F=Math.sin(c.alpha),E=Math.cos(c.beta);let Y=Math.sin(c.beta);0===Y&&(Y=1e-4);const H=c._getTargetPosition();c._computationVector.XH(c.radius*B*Y,c.radius*E,c.radius*F*Y),H.addToRef(c._computationVector,c._newPosition),c._position.B(c._newPosition);let b=c.upVector;c.allowUpsideDown&&c.beta<0&&(b=b.clone(),b=b.negate()),c._computeViewMatrix(c._position,H,b),c._viewMatrix.addAtIndex(12,c.targetScreenOffset.x),c._viewMatrix.addAtIndex(13,c.targetScreenOffset.y),c._collisionTriggered=!1},this._target=Y.tI.Zero(),F&&this.setTarget(F),this.alpha=I,this.beta=A,this.radius=B,this.getViewMatrix(),this.inputs=new M(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Y.tI(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Y.Vector2.Zero()}_updateCache(V){V||super._updateCache(),this._cache._target.B(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.B(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const V=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?V.addToRef(this._targetBoundingCenter,this._target):this._target.B(V)}const V=this._getLockedTargetPosition();return V||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>J.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,E=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=E?this._currentInterpolationFactor=E:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=f(V,this._goalAlpha),this._goalBeta=f(I,this._goalBeta),this._goalRadius=f(A,this._goalRadius),this._goalTarget.set(f(B.x,this._goalTarget.x),f(B.y,this._goalTarget.y),f(B.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(f(F.x,this._goalTargetScreenOffset.x),f(F.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,H.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,H.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,H.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,H.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(V,I){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const F=arguments;I=z.Tools.BackCompatCameraNoPreventDefault(F),this._useCtrlForPanning=A,this._panningMouseButton=B,"boolean"===typeof F[0]&&(F.length>1&&(this._useCtrlForPanning=F[1]),F.length>2&&(this._panningMouseButton=F[2])),this.inputs.attachElement(I),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}TJ(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let V=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){V=!0;const I=this.invertRotation?-1:1,A=this._calculateHandednessMultiplier();let B=this.inertialAlphaOffset*A;this.beta<0&&(B*=-1),this.alpha+=B*I,this.beta+=this.inertialBetaOffset*I,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<J.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<J.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*J.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){V=!0;const I=new Y.tI(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),I.multiplyInPlace(this.panningAxis),Y.tI.TransformNormalToRef(I,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const V=this.upVector,I=Y.tI.CrossToRef(this._transformedDirection,V,this._transformedDirection);Y.tI.CrossToRef(V,I,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Y.tI.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.B(this._transformedDirection)}else{if(this.parent){const V=Y.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(V),V.transposeToRef(V),Y.tI.TransformCoordinatesToRef(this._transformedDirection,V,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*J.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*J.d&&(this.inertialPanningY=0)}if(V)this.stopInterpolation();else if(this._isInterpolating){let V=!1;const I=this._scene.getEngine().getDeltaTime()/1e3,A=1-Math.pow(2,-I/this._currentInterpolationFactor),B=f(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const I=Y.TmpVectors.tI[0].set(f(this._goalTarget.x,this._target.x),f(this._goalTarget.y,this._target.y),f(this._goalTarget.z,this._target.z));Y.tI.LerpToRef(this.target,I,A,this._target),10*Y.tI.Distance(this.target,I)/B<J.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.B(I),this.setTarget(this.target,!1,!0,!0)):V=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const I=Y.Quaternion.RotationAlphaBetaGammaToRef(f(this._goalAlpha,this.alpha),f(this._goalBeta,this.beta),0,Y.TmpVectors.Quaternion[0]),B=Y.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Y.TmpVectors.Quaternion[1]),F=Y.Quaternion.SlerpToRef(B,I,A,Y.TmpVectors.Quaternion[2]);F.normalize();const E=F.toAlphaBetaGammaToRef(Y.TmpVectors.tI[0]);if(this.alpha=E.x,this.beta=E.y,F.isApprox(I,J.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const V=I.toAlphaBetaGammaToRef(Y.TmpVectors.tI[0]);this.alpha=V.x,this.beta=V.y}else V=!0}if(isNaN(this._goalRadius)||(this.radius+=(B-this.radius)*A,Math.abs(B/this.radius-1)<J.d?(this._goalRadius=NaN,this.radius=B):V=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const I=Y.TmpVectors.Vector2[0].set(f(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),f(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));Y.Vector2.LerpToRef(this.targetScreenOffset,I,A,this.targetScreenOffset),Y.Vector2.Distance(this.targetScreenOffset,I)<J.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.B(I)):V=!0}this._isInterpolating=V}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.tI.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const V=this.alpha;var I,A;this.alpha=function(V){let I=Math.PI/2;return 0===V.x&&0===V.z||(I=Math.acos(V.x/Math.sqrt(Math.pow(V.x,2)+Math.pow(V.z,2)))),V.z<0&&(I=2*Math.PI-I),I}(this._computationVector),this.beta=(I=this._computationVector.y,A=this.radius,Math.acos(I/A));const B=Math.round((V-this.alpha)/(2*Math.PI));this.alpha+=2*B*Math.PI,this._checkLimits()}setPosition(V){this._position.equals(V)||(this._position.B(V),this.rebuildAnglesAndRadius())}setTarget(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(B=this.overrideCloneAlphaBetaRadius??B,V.YH)I&&V.getBoundingInfo?this._targetBoundingCenter=V.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,V.YH(),this._targetHost=V,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const I=V,B=this._getTargetPosition();if(B&&!A&&B.equals(I))return;this._targetHost=null,this._target=I,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}B||this.rebuildAnglesAndRadius()}_getViewMatrix(){const V=Math.cos(this.alpha),I=Math.sin(this.alpha),A=Math.cos(this.beta);let B=Math.sin(this.beta);0===B&&(B=1e-4),0===this.radius&&(this.radius=1e-4);const F=this._getTargetPosition();if(this._computationVector.XH(this.radius*V*B,this.radius*A,this.radius*I*B),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.tI.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),F.addToRef(this._computationVector,this._newPosition),this.sV().collisionsEnabled&&this.checkCollisions){const V=this.sV().collisionCoordinator;this._collider||(this._collider=V.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,V.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.B(this._newPosition);let V=this.upVector;this.allowUpsideDown&&B<0&&(V=V.negate()),this._computeViewMatrix(this._position,F,V),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.B(F),this._viewMatrix}zoomOn(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V=V||this.sV().meshes;const A=b.c.MinMax(V);let B=this._calculateLowerRadiusFromModelBoundingSphere(A.min,A.max);if(B=Math.max(Math.min(B,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=B*this.zoomOnFactor,this.mode===g.c.ORTHOGRAPHIC_CAMERA){const V=this.sV().getEngine().getAspectRatio(this),I=B*this.zoomOnFactor/2;this.orthoLeft=-I*V,this.orthoRight=I*V,this.orthoBottom=-I,this.orthoTop=I}this.focusOn({min:A.min,max:A.max,distance:B},I)}focusOn(V){let I,A,B=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===V.min){const B=V||this.sV().meshes;I=b.c.MinMax(B),A=Y.tI.Distance(I.min,I.max)}else{I=V,A=V.distance}this._target=b.c.Center(I),B||(this.maxZ=2*A)}createRigCamera(V,I){let A=0;switch(this.cameraRigMode){case g.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case g.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case g.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case g.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case g.c.RIG_MODE_VR:A=this._cameraRigParams.stereoHalfAngle*(0===I?1:-1);break;case g.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:A=this._cameraRigParams.stereoHalfAngle*(0===I?-1:1)}const B=new R(V,this.alpha+A,this.beta,this.radius,this._target,this.sV());return B._cameraRigParams={},B.isRigCamera=!0,B.rigParent=this,B.upVector=this.upVector,B.mode=this.mode,B.orthoLeft=this.orthoLeft,B.orthoRight=this.orthoRight,B.orthoBottom=this.orthoBottom,B.orthoTop=this.orthoTop,B}_updateRigCameras(){const V=this._rigCameras[0],I=this._rigCameras[1];switch(V.beta=I.beta=this.beta,this.cameraRigMode){case g.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case g.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case g.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case g.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case g.c.RIG_MODE_VR:V.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,I.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case g.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:V.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,I.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const B=Y.tI.Distance(V,I),F=this.sV().getEngine().getAspectRatio(this),E=Math.tan(this.fov/2),H=E*F,c=.5*B*A,b=c*Math.sqrt(1+1/(H*H)),X=c*Math.sqrt(1+1/(E*E));return Math.max(b,X)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,B.b)([(0,F.A)()],R.prototype,"alpha",void 0),(0,B.b)([(0,F.A)()],R.prototype,"beta",void 0),(0,B.b)([(0,F.A)()],R.prototype,"radius",void 0),(0,B.b)([(0,F.A)()],R.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,B.b)([(0,F.w)("target")],R.prototype,"_target",void 0),(0,B.b)([(0,F.s)("targetHost")],R.prototype,"_targetHost",void 0),(0,B.b)([(0,F.A)()],R.prototype,"inertialAlphaOffset",void 0),(0,B.b)([(0,F.A)()],R.prototype,"inertialBetaOffset",void 0),(0,B.b)([(0,F.A)()],R.prototype,"inertialRadiusOffset",void 0),(0,B.b)([(0,F.A)()],R.prototype,"lowerAlphaLimit",void 0),(0,B.b)([(0,F.A)()],R.prototype,"upperAlphaLimit",void 0),(0,B.b)([(0,F.A)()],R.prototype,"lowerBetaLimit",void 0),(0,B.b)([(0,F.A)()],R.prototype,"upperBetaLimit",void 0),(0,B.b)([(0,F.A)()],R.prototype,"lowerRadiusLimit",void 0),(0,B.b)([(0,F.A)()],R.prototype,"upperRadiusLimit",void 0),(0,B.b)([(0,F.A)()],R.prototype,"lowerTargetYLimit",void 0),(0,B.b)([(0,F.A)()],R.prototype,"inertialPanningX",void 0),(0,B.b)([(0,F.A)()],R.prototype,"inertialPanningY",void 0),(0,B.b)([(0,F.A)()],R.prototype,"pinchToPanMaxDistance",void 0),(0,B.b)([(0,F.A)()],R.prototype,"panningDistanceLimit",void 0),(0,B.b)([(0,F.w)()],R.prototype,"panningOriginTarget",void 0),(0,B.b)([(0,F.A)()],R.prototype,"panningInertia",void 0),(0,B.b)([(0,F.A)()],R.prototype,"zoomToMouseLocation",null),(0,B.b)([(0,F.A)()],R.prototype,"zoomOnFactor",void 0),(0,B.b)([(0,F.v)()],R.prototype,"targetScreenOffset",void 0),(0,B.b)([(0,F.A)()],R.prototype,"allowUpsideDown",void 0),(0,B.b)([(0,F.A)()],R.prototype,"useInputToRestoreState",void 0),(0,B.b)([(0,F.A)()],R.prototype,"restoreStateInterpolationFactor",void 0),(0,x.e)("BABYLON.ArcRotateCamera",R)},12877:(V,I,A)=>{"use strict";A.d(I,{e:()=>Y,i:()=>H});var B=A(11064),F=A(11265),E=A(11707),Y={};class H{constructor(V){this.attachedToElement=!1,this.attached={},this.camera=V,this.checkInputs=()=>{}}add(V){const I=V.getSimpleName();this.attached[I]?B.b.Warn("camera input of type "+I+" already exists on camera"):(this.attached[I]=V,V.camera=this.camera,V.checkInputs&&(this.checkInputs=this._addCheckInputs(V.checkInputs.bind(V))),this.attachedToElement&&V.attachControl(this.noPreventDefault))}remove(V){for(const I in this.attached){const A=this.attached[I];if(A===V)return A.TJ(),A.camera=null,delete this.attached[I],void this.rebuildInputCheck()}}removeByType(V){for(const I in this.attached){const A=this.attached[I];A.getClassName()===V&&(A.TJ(),A.camera=null,delete this.attached[I],this.rebuildInputCheck())}}_addCheckInputs(V){const I=this.checkInputs;return()=>{I(),V()}}attachInput(V){this.attachedToElement&&V.attachControl(this.noPreventDefault)}attachElement(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){V=!E.c.ForceAttachControlToAlwaysPreventDefault&&V,this.attachedToElement=!0,this.noPreventDefault=V;for(const I in this.attached)this.attached[I].attachControl(V)}}detachElement(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const I in this.attached)this.attached[I].TJ(),V&&(this.attached[I].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const V in this.attached){const I=this.attached[V];I.checkInputs&&(this.checkInputs=this._addCheckInputs(I.checkInputs.bind(I)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(V){const I={};for(const A in this.attached){const V=this.attached[A],B=F.b.Serialize(V);I[V.getClassName()]=B}V.inputsmgr=I}parse(V){const I=V.inputsmgr;if(I){this.clear();for(const V in I){const A=Y[V];if(A){const B=I[V],E=F.b.Parse((()=>new A),B,null);this.add(E)}}}else for(const A in this.attached){const I=Y[this.attached[A].getClassName()];if(I){const B=F.b.Parse((()=>new I),V,null);this.remove(this.attached[A]),this.add(B)}}}}},12868:(V,I,A)=>{"use strict";A.d(I,{e:()=>m});var B=A(11213),F=A(11222),E=A(11231),Y=A(11746),H=A(12877),c=A(11513),b=A(11052);class X{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(V){V=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.sV(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((I=>{const A=I.event;if(!A.metaKey)if(I.type===c.e.KEYDOWN){if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysUpward.indexOf(A.keyCode)||-1!==this.keysDownward.indexOf(A.keyCode)||-1!==this.keysRotateLeft.indexOf(A.keyCode)||-1!==this.keysRotateRight.indexOf(A.keyCode)||-1!==this.keysRotateUp.indexOf(A.keyCode)||-1!==this.keysRotateDown.indexOf(A.keyCode)){-1===this._keys.indexOf(A.keyCode)&&this._keys.push(A.keyCode),V||A.preventDefault()}}else if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysUpward.indexOf(A.keyCode)||-1!==this.keysDownward.indexOf(A.keyCode)||-1!==this.keysRotateLeft.indexOf(A.keyCode)||-1!==this.keysRotateRight.indexOf(A.keyCode)||-1!==this.keysRotateUp.indexOf(A.keyCode)||-1!==this.keysRotateDown.indexOf(A.keyCode)){const I=this._keys.indexOf(A.keyCode);I>=0&&this._keys.splice(I,1),V||A.preventDefault()}})))}TJ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const V=this.camera;for(let I=0;I<this._keys.length;I++){const A=this._keys[I],B=V._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(A)?V._localDirection.XH(-B,0,0):-1!==this.keysUp.indexOf(A)?V._localDirection.XH(0,0,B):-1!==this.keysRight.indexOf(A)?V._localDirection.XH(B,0,0):-1!==this.keysDown.indexOf(A)?V._localDirection.XH(0,0,-B):-1!==this.keysUpward.indexOf(A)?V._localDirection.XH(0,B,0):-1!==this.keysDownward.indexOf(A)?V._localDirection.XH(0,-B,0):-1!==this.keysRotateLeft.indexOf(A)?(V._localDirection.XH(0,0,0),V.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(A)?(V._localDirection.XH(0,0,0),V.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(A)?(V._localDirection.XH(0,0,0),V.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(A)&&(V._localDirection.XH(0,0,0),V.cameraRotation.x+=this._getLocalRotation()),V.sV().useRightHandedSystem&&(V._localDirection.z*=-1),V.getViewMatrix().invertToRef(V._cameraTransformMatrix),E.tI.TransformNormalToRef(V._localDirection,V._cameraTransformMatrix,V._transformedDirection),V.cameraDirection.addInPlace(V._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const V=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*V}}(0,B.b)([(0,F.A)()],X.prototype,"keysUp",void 0),(0,B.b)([(0,F.A)()],X.prototype,"keysUpward",void 0),(0,B.b)([(0,F.A)()],X.prototype,"keysDown",void 0),(0,B.b)([(0,F.A)()],X.prototype,"keysDownward",void 0),(0,B.b)([(0,F.A)()],X.prototype,"keysLeft",void 0),(0,B.b)([(0,F.A)()],X.prototype,"keysRight",void 0),(0,B.b)([(0,F.A)()],X.prototype,"rotationSpeed",void 0),(0,B.b)([(0,F.A)()],X.prototype,"keysRotateLeft",void 0),(0,B.b)([(0,F.A)()],X.prototype,"keysRotateRight",void 0),(0,B.b)([(0,F.A)()],X.prototype,"keysRotateUp",void 0),(0,B.b)([(0,F.A)()],X.prototype,"keysRotateDown",void 0),H.e.FreeCameraKeyboardMoveInput=X;var P=A(11057),J=A(11507);class G{constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=V,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new P.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(V){V=b.Tools.BackCompatCameraNoPreventDefault(arguments);const I=this.camera.getEngine(),A=I.getInputElement();this._pointerInput||(this._pointerInput=B=>{const F=B.event,E="touch"===F.pointerType;if(!this.touchEnabled&&E)return;if(B.type!==J.d.POINTERMOVE&&-1===this.buttons.indexOf(F.button))return;const Y=F.target;if(B.type===J.d.POINTERDOWN){if(E&&-1!==this._activePointerId||!E&&-1!==this._currentActiveButton)return;this._activePointerId=F.pointerId;try{null===Y||void 0===Y||Y.setPointerCapture(F.pointerId)}catch(H){}-1===this._currentActiveButton&&(this._currentActiveButton=F.button),this._previousPosition={x:F.clientX,y:F.clientY},V||(F.preventDefault(),A&&A.focus()),I.isPointerLock&&this._onMouseMove&&this._onMouseMove(B.event)}else if(B.type===J.d.POINTERUP){if(E&&this._activePointerId!==F.pointerId||!E&&this._currentActiveButton!==F.button)return;try{null===Y||void 0===Y||Y.releasePointerCapture(F.pointerId)}catch(H){}this._currentActiveButton=-1,this._previousPosition=null,V||F.preventDefault(),this._activePointerId=-1}else if(B.type===J.d.POINTERMOVE&&(this._activePointerId===F.pointerId||!E))if(I.isPointerLock&&this._onMouseMove)this._onMouseMove(B.event);else if(this._previousPosition){const I=this.camera._calculateHandednessMultiplier(),A=(F.clientX-this._previousPosition.x)*I,B=F.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=A/this.angularSensibility,this.camera.cameraRotation.x+=B/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:A,offsetY:B}),this._previousPosition={x:F.clientX,y:F.clientY},V||F.preventDefault()}}),this._onMouseMove=A=>{if(!I.isPointerLock)return;const B=this.camera._calculateHandednessMultiplier(),F=A.movementX*B;this.camera.cameraRotation.y+=F/this.angularSensibility;const E=A.movementY;this.camera.cameraRotation.x+=E/this.angularSensibility,this._previousPosition=null,V||A.preventDefault()},this._observer=this.camera.sV()._inputManager._addCameraPointerObserver(this._pointerInput,J.d.POINTERDOWN|J.d.POINTERUP|J.d.POINTERMOVE),A&&(this._contextMenuBind=V=>this.onContextMenu(V),A.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(V){V.preventDefault()}TJ(){if(this._observer){if(this.camera.sV()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const V=this.camera.getEngine().getInputElement();V&&V.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,B.b)([(0,F.A)()],G.prototype,"buttons",void 0),(0,B.b)([(0,F.A)()],G.prototype,"angularSensibility",void 0),H.e.FreeCameraMouseInput=G;var w,t=A(11519);class u{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new P.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(V){V=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=I=>{if(I.type!==J.d.POINTERWHEEL)return;const A=I.event,B=A.deltaMode===t.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*B*A.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*B*A.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*B*A.deltaZ/this._normalize,A.preventDefault&&(V||A.preventDefault())},this._observer=this.camera.sV()._inputManager._addCameraPointerObserver(this._wheel,J.d.POINTERWHEEL)}TJ(){this._observer&&(this.camera.sV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,B.b)([(0,F.A)()],u.prototype,"wheelPrecisionX",void 0),(0,B.b)([(0,F.A)()],u.prototype,"wheelPrecisionY",void 0),(0,B.b)([(0,F.A)()],u.prototype,"wheelPrecisionZ",void 0),function(V){V[V.MoveRelative=0]="MoveRelative",V[V.RotateRelative=1]="RotateRelative",V[V.MoveScene=2]="MoveScene"}(w||(w={}));class W extends u{constructor(){super(...arguments),this._moveRelative=E.tI.Zero(),this._rotateRelative=E.tI.Zero(),this._moveScene=E.tI.Zero(),this._wheelXAction=w.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=w.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(V){null===V&&this._wheelXAction!==w.MoveRelative||(this._wheelXAction=w.MoveRelative,this._wheelXActionCoordinate=V)}get wheelXMoveRelative(){return this._wheelXAction!==w.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(V){null===V&&this._wheelYAction!==w.MoveRelative||(this._wheelYAction=w.MoveRelative,this._wheelYActionCoordinate=V)}get wheelYMoveRelative(){return this._wheelYAction!==w.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(V){null===V&&this._wheelZAction!==w.MoveRelative||(this._wheelZAction=w.MoveRelative,this._wheelZActionCoordinate=V)}get wheelZMoveRelative(){return this._wheelZAction!==w.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(V){null===V&&this._wheelXAction!==w.RotateRelative||(this._wheelXAction=w.RotateRelative,this._wheelXActionCoordinate=V)}get wheelXRotateRelative(){return this._wheelXAction!==w.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(V){null===V&&this._wheelYAction!==w.RotateRelative||(this._wheelYAction=w.RotateRelative,this._wheelYActionCoordinate=V)}get wheelYRotateRelative(){return this._wheelYAction!==w.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(V){null===V&&this._wheelZAction!==w.RotateRelative||(this._wheelZAction=w.RotateRelative,this._wheelZActionCoordinate=V)}get wheelZRotateRelative(){return this._wheelZAction!==w.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(V){null===V&&this._wheelXAction!==w.MoveScene||(this._wheelXAction=w.MoveScene,this._wheelXActionCoordinate=V)}get wheelXMoveScene(){return this._wheelXAction!==w.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(V){null===V&&this._wheelYAction!==w.MoveScene||(this._wheelYAction=w.MoveScene,this._wheelYActionCoordinate=V)}get wheelYMoveScene(){return this._wheelYAction!==w.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(V){null===V&&this._wheelZAction!==w.MoveScene||(this._wheelZAction=w.MoveScene,this._wheelZActionCoordinate=V)}get wheelZMoveScene(){return this._wheelZAction!==w.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.JH(0),this._rotateRelative.JH(0),this._moveScene.JH(0),this._updateCamera(),this.camera.sV().useRightHandedSystem&&(this._moveRelative.z*=-1);const V=E.Matrix.Zero();this.camera.getViewMatrix().invertToRef(V);const I=E.tI.Zero();E.tI.TransformNormalToRef(this._moveRelative,V,I),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(I),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(V,I,A){if(0===V)return;if(null===I||null===A)return;let B=null;switch(I){case w.MoveRelative:B=this._moveRelative;break;case w.RotateRelative:B=this._rotateRelative;break;case w.MoveScene:B=this._moveScene}switch(A){case 0:B.set(V,0,0);break;case 1:B.set(0,V,0);break;case 2:B.set(0,0,V)}}}(0,B.b)([(0,F.A)()],W.prototype,"wheelXMoveRelative",null),(0,B.b)([(0,F.A)()],W.prototype,"wheelYMoveRelative",null),(0,B.b)([(0,F.A)()],W.prototype,"wheelZMoveRelative",null),(0,B.b)([(0,F.A)()],W.prototype,"wheelXRotateRelative",null),(0,B.b)([(0,F.A)()],W.prototype,"wheelYRotateRelative",null),(0,B.b)([(0,F.A)()],W.prototype,"wheelZRotateRelative",null),(0,B.b)([(0,F.A)()],W.prototype,"wheelXMoveScene",null),(0,B.b)([(0,F.A)()],W.prototype,"wheelYMoveScene",null),(0,B.b)([(0,F.A)()],W.prototype,"wheelZMoveScene",null),H.e.FreeCameraMouseWheelInput=W;class g{constructor(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=V,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=b.Tools.IsSafari()}attachControl(V){V=b.Tools.BackCompatCameraNoPreventDefault(arguments);let I=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=A=>{const B=A.event,F="mouse"===B.pointerType||this._isSafari&&"undefined"===typeof B.pointerType;if(this.allowMouse||!F)if(A.type===J.d.POINTERDOWN){if(V||B.preventDefault(),this._pointerPressed.push(B.pointerId),1!==this._pointerPressed.length)return;I={x:B.clientX,y:B.clientY}}else if(A.type===J.d.POINTERUP){V||B.preventDefault();const A=this._pointerPressed.indexOf(B.pointerId);if(-1===A)return;if(this._pointerPressed.splice(A,1),0!=A)return;I=null,this._offsetX=null,this._offsetY=null}else if(A.type===J.d.POINTERMOVE){if(V||B.preventDefault(),!I)return;if(0!=this._pointerPressed.indexOf(B.pointerId))return;this._offsetX=B.clientX-I.x,this._offsetY=-(B.clientY-I.y)}}),this._observer=this.camera.sV()._inputManager._addCameraPointerObserver(this._pointerInput,J.d.POINTERDOWN|J.d.POINTERUP|J.d.POINTERMOVE),this._onLostFocus){const V=this.camera.getEngine().getInputElement();V&&V.addEventListener("blur",this._onLostFocus)}}TJ(){if(this._pointerInput){if(this._observer&&(this.camera.sV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const V=this.camera.getEngine().getInputElement();V&&V.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const V=this.camera,I=V._calculateHandednessMultiplier();V.cameraRotation.y=I*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)V.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const I=V._computeLocalCameraSpeed(),A=new E.tI(0,0,0!==this.touchMoveSensibility?I*this._offsetY/this.touchMoveSensibility:0);E.Matrix.RotationYawPitchRollToRef(V.rotation.y,V.rotation.x,0,V._cameraRotationMatrix),V.cameraDirection.addInPlace(E.tI.TransformCoordinates(A,V._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,B.b)([(0,F.A)()],g.prototype,"touchAngularSensibility",void 0),(0,B.b)([(0,F.A)()],g.prototype,"touchMoveSensibility",void 0),H.e.FreeCameraTouchInput=g;class o extends H.i{constructor(V){super(V),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new X),this}addMouse(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new G(V),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new W,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new g),this}clear(){super.clear(),this._mouseInput=null}}var L=A(11189),z=A(11137);class m extends Y.d{get angularSensibility(){const V=this.inputs.attached.mouse;return V?V.angularSensibility:0}set angularSensibility(V){const I=this.inputs.attached.mouse;I&&(I.angularSensibility=V)}get keysUp(){const V=this.inputs.attached.keyboard;return V?V.keysUp:[]}set keysUp(V){const I=this.inputs.attached.keyboard;I&&(I.keysUp=V)}get keysUpward(){const V=this.inputs.attached.keyboard;return V?V.keysUpward:[]}set keysUpward(V){const I=this.inputs.attached.keyboard;I&&(I.keysUpward=V)}get keysDown(){const V=this.inputs.attached.keyboard;return V?V.keysDown:[]}set keysDown(V){const I=this.inputs.attached.keyboard;I&&(I.keysDown=V)}get keysDownward(){const V=this.inputs.attached.keyboard;return V?V.keysDownward:[]}set keysDownward(V){const I=this.inputs.attached.keyboard;I&&(I.keysDownward=V)}get keysLeft(){const V=this.inputs.attached.keyboard;return V?V.keysLeft:[]}set keysLeft(V){const I=this.inputs.attached.keyboard;I&&(I.keysLeft=V)}get keysRight(){const V=this.inputs.attached.keyboard;return V?V.keysRight:[]}set keysRight(V){const I=this.inputs.attached.keyboard;I&&(I.keysRight=V)}get keysRotateLeft(){const V=this.inputs.attached.keyboard;return V?V.keysRotateLeft:[]}set keysRotateLeft(V){const I=this.inputs.attached.keyboard;I&&(I.keysRotateLeft=V)}get keysRotateRight(){const V=this.inputs.attached.keyboard;return V?V.keysRotateRight:[]}set keysRotateRight(V){const I=this.inputs.attached.keyboard;I&&(I.keysRotateRight=V)}get keysRotateUp(){const V=this.inputs.attached.keyboard;return V?V.keysRotateUp:[]}set keysRotateUp(V){const I=this.inputs.attached.keyboard;I&&(I.keysRotateUp=V)}get keysRotateDown(){const V=this.inputs.attached.keyboard;return V?V.keysRotateDown:[]}set keysRotateDown(V){const I=this.inputs.attached.keyboard;I&&(I.keysRotateDown=V)}constructor(V,I,A){var B;super(V,I,A,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),B=this,this.ellipsoid=new E.tI(.5,1,.5),this.ellipsoidOffset=new E.tI(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=E.tI.Zero(),this._diffPosition=E.tI.Zero(),this._newPosition=E.tI.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B._newPosition.B(I),B._newPosition.subtractToRef(B._oldPosition,B._diffPosition),B._diffPosition.length()>z.e.CollisionsEpsilon&&(B.position.addToRef(B._diffPosition,B._deferredPositionUpdate),B._deferOnly?B._deferredUpdated=!0:B.position.B(B._deferredPositionUpdate),B.Qw&&A&&B.Qw(A))},this.inputs=new o(this),this.inputs.addKeyboard().addMouse()}attachControl(V,I){I=b.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(I)}TJ(){this.inputs.detachElement(),this.cameraDirection=new E.tI(0,0,0),this.cameraRotation=new E.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(V){this._collisionMask=isNaN(V)?-1:V}_collideWithWorld(V){let I;I=this.parent?E.tI.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,I.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const A=this.sV().collisionCoordinator;this._collider||(this._collider=A.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let B=V;this.applyGravity&&(B=V.add(this.sV().gravity)),A.getNewPosition(this._oldPosition,B,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=E.tI.Zero(),this._transformedDirection=E.tI.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(V){this._needMoveForGravity=V}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.sV().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Fc"}}(0,B.b)([(0,F.w)()],m.prototype,"ellipsoid",void 0),(0,B.b)([(0,F.w)()],m.prototype,"ellipsoidOffset",void 0),(0,B.b)([(0,F.A)()],m.prototype,"checkCollisions",void 0),(0,B.b)([(0,F.A)()],m.prototype,"applyGravity",void 0),(0,L.e)("BABYLON.FreeCamera",m)},13439:(V,I,A)=>{"use strict";A.d(I,{d:()=>E});var B=A(11323),F=A(13442);class E{constructor(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=A,this.XJ=[],this._maxBlockCapacity=I||64,this._selectionContent=new B.b(1024),this._creationFunc=V}update(V,I,A){F.d._CreateBlocks(V,I,A,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}WP(V){for(let I=0;I<this.MP.length;I++){this.MP[I].addEntry(V)}}uP(V){for(let I=0;I<this.MP.length;I++){this.MP[I].removeEntry(V)}}select(V,I){this._selectionContent.reset();for(let A=0;A<this.MP.length;A++){this.MP[A].select(V,this._selectionContent,I)}return I?this._selectionContent.concat(this.XJ):this._selectionContent.concatWithNoDuplicate(this.XJ),this._selectionContent}intersects(V,I,A){this._selectionContent.reset();for(let B=0;B<this.MP.length;B++){this.MP[B].intersects(V,I,this._selectionContent,A)}return A?this._selectionContent.concat(this.XJ):this._selectionContent.concatWithNoDuplicate(this.XJ),this._selectionContent}intersectsRay(V){this._selectionContent.reset();for(let I=0;I<this.MP.length;I++){this.MP[I].intersectsRay(V,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.XJ),this._selectionContent}}E.CreationFuncForMeshes=(V,I)=>{const A=V.getBoundingInfo();!V.isBlocked&&A.boundingBox.intersectsMinMax(I.tJ,I.uJ)&&I.entries.push(V)},E.CreationFuncForSubMeshes=(V,I)=>{V.getBoundingInfo().boundingBox.intersectsMinMax(I.tJ,I.uJ)&&I.entries.push(V)}},13442:(V,I,A)=>{"use strict";A.d(I,{d:()=>E});var B=A(11231),F=A(11580);class E{constructor(V,I,A,B,F,E){this.entries=[],this.WJ=new Array,this._capacity=A,this._depth=B,this._maxDepth=F,this._creationFunc=E,this._minPoint=V,this._maxPoint=I,this.WJ.push(V.clone()),this.WJ.push(I.clone()),this.WJ.push(V.clone()),this.WJ[2].x=I.x,this.WJ.push(V.clone()),this.WJ[3].y=I.y,this.WJ.push(V.clone()),this.WJ[4].z=I.z,this.WJ.push(I.clone()),this.WJ[5].z=V.z,this.WJ.push(I.clone()),this.WJ[6].x=V.x,this.WJ.push(I.clone()),this.WJ[7].y=V.y}get tA(){return this._capacity}get tJ(){return this._minPoint}get uJ(){return this._maxPoint}addEntry(V){if(this.MP)for(let I=0;I<this.MP.length;I++){this.MP[I].addEntry(V)}else this._creationFunc(V,this),this.entries.length>this.tA&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(V){if(this.MP){for(let I=0;I<this.MP.length;I++){this.MP[I].removeEntry(V)}return}const I=this.entries.indexOf(V);I>-1&&this.entries.splice(I,1)}addEntries(V){for(let I=0;I<V.length;I++){const A=V[I];this.addEntry(A)}}select(V,I,A){if(F.e.IsInFrustum(this.WJ,V)){if(this.MP){for(let B=0;B<this.MP.length;B++){this.MP[B].select(V,I,A)}return}A?I.concat(this.entries):I.concatWithNoDuplicate(this.entries)}}intersects(V,I,A,B){if(F.e.IntersectsSphere(this._minPoint,this._maxPoint,V,I)){if(this.MP){for(let F=0;F<this.MP.length;F++){this.MP[F].intersects(V,I,A,B)}return}B?A.concat(this.entries):A.concatWithNoDuplicate(this.entries)}}intersectsRay(V,I){if(V.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.MP){for(let A=0;A<this.MP.length;A++){this.MP[A].intersectsRay(V,I)}return}I.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){E._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(V,I,A,F,Y,H,c,b){c.MP=new Array;const X=new B.tI((I.x-V.x)/2,(I.y-V.y)/2,(I.z-V.z)/2);for(let B=0;B<2;B++)for(let I=0;I<2;I++)for(let P=0;P<2;P++){const J=V.add(X.multiplyByFloats(B,I,P)),G=V.add(X.multiplyByFloats(B+1,I+1,P+1)),w=new E(J,G,F,Y+1,H,b);w.addEntries(A),c.MP.push(w)}}}},13447:(V,I,A)=>{"use strict";A.d(I,{c:()=>X});var B=A(11473),F=A(11231),E=A(11669),Y=A(12631),H=A(11499),c=A(13439),b=A(11097);B.b.prototype.createOrUpdateSelectionOctree=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,A=this._getComponent(H.d.NAME_OCTREE);A||(A=new X(this),this.DY(A)),this.cJ||(this.cJ=new c.d(c.d.CreationFuncForMeshes,V,I));const B=this.getWorldExtends();return this.cJ.update(B.min,B.max,this.meshes),this.cJ},Object.defineProperty(B.b.prototype,"selectionOctree",{get:function(){return this.cJ},enumerable:!0,configurable:!0}),E.c.prototype.createOrUpdateSubmeshesOctree=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const A=this.sV();let B=A._getComponent(H.d.NAME_OCTREE);B||(B=new X(A),A.DY(B)),this._submeshesOctree||(this._submeshesOctree=new c.d(c.d.CreationFuncForSubMeshes,V,I)),this.YH(!0);const F=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(F.minimumWorld,F.maximumWorld,this.IH),this._submeshesOctree};class X{constructor(V){this.name=H.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Y.e(F.tI.Zero(),new F.tI(1,1,1)),(V=V||b.e.LastCreatedScene)&&(this.WI=V,this.WI.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.WI.getActiveSubMeshCandidates=V=>this.getActiveSubMeshCandidates(V),this.WI.getCollidingSubMeshCandidates=(V,I)=>this.getCollidingSubMeshCandidates(V,I),this.WI.getIntersectingSubMeshCandidates=(V,I)=>this.getIntersectingSubMeshCandidates(V,I))}register(){this.WI.onMeshRemovedObservable.add((V=>{const I=this.WI.selectionOctree;if(void 0!==I&&null!==I){const A=I.XJ.indexOf(V);-1!==A&&I.XJ.splice(A,1)}})),this.WI.onMeshImportedObservable.add((V=>{const I=this.WI.selectionOctree;void 0!==I&&null!==I&&I.WP(V)}))}getActiveMeshCandidates(){var V;return(null===(V=this.WI.cJ)||void 0===V?void 0:V.select(this.WI.frustumPlanes))||this.WI._getDefaultMeshCandidates()}getActiveSubMeshCandidates(V){if(V._submeshesOctree&&V.useOctreeForRenderingSelection){return V._submeshesOctree.select(this.WI.frustumPlanes)}return this.WI._getDefaultSubMeshCandidates(V)}getIntersectingSubMeshCandidates(V,I){if(V._submeshesOctree&&V.useOctreeForPicking){Y.e.TransformToRef(I,V.getWorldMatrix(),this._tempRay);return V._submeshesOctree.intersectsRay(this._tempRay)}return this.WI._getDefaultSubMeshCandidates(V)}getCollidingSubMeshCandidates(V,I){if(V._submeshesOctree&&V.useOctreeForCollisions){const A=I._velocityWorldLength+Math.max(I._radius.x,I._radius.y,I._radius.z);return V._submeshesOctree.intersects(I._basePointWorld,A)}return this.WI._getDefaultSubMeshCandidates(V)}rebuild(){}dispose(){}}},12631:(V,I,A)=>{"use strict";A.d(I,{e:()=>G});var B=A(11473),F=A(11707),E=A(11237),Y=A(11231),H=A(11240),c=A(11568),b=A(11491),X=A(11097),P=A(11523);const J={internalPickerForMesh:void 0};class G{constructor(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E.d;this.origin=V,this.direction=I,this.length=A,this.epsilon=B}clone(){return new G(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const B=G._TmpVector3[0].XH(V.x-A,V.y-A,V.z-A),F=G._TmpVector3[1].XH(I.x+A,I.y+A,I.z+A);let E,Y,H,c,b=0,X=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<B.x||this.origin.x>F.x)return!1}else if(E=1/this.direction.x,Y=(B.x-this.origin.x)*E,H=(F.x-this.origin.x)*E,H===-1/0&&(H=1/0),Y>H&&(c=Y,Y=H,H=c),b=Math.max(Y,b),X=Math.min(H,X),b>X)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<B.y||this.origin.y>F.y)return!1}else if(E=1/this.direction.y,Y=(B.y-this.origin.y)*E,H=(F.y-this.origin.y)*E,H===-1/0&&(H=1/0),Y>H&&(c=Y,Y=H,H=c),b=Math.max(Y,b),X=Math.min(H,X),b>X)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<B.z||this.origin.z>F.z)return!1}else if(E=1/this.direction.z,Y=(B.z-this.origin.z)*E,H=(F.z-this.origin.z)*E,H===-1/0&&(H=1/0),Y>H&&(c=Y,Y=H,H=c),b=Math.max(Y,b),X=Math.min(H,X),b>X)return!1;return!0}intersectsBox(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(V.minimum,V.maximum,I)}intersectsSphere(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=V.center.x-this.origin.x,B=V.center.y-this.origin.y,F=V.center.z-this.origin.z,E=A*A+B*B+F*F,Y=V.radius+I,H=Y*Y;if(E<=H)return!0;const c=A*this.direction.x+B*this.direction.y+F*this.direction.z;if(c<0)return!1;return E-c*c<=H}intersectsTriangle(V,I,A){const B=G._TmpVector3[0],F=G._TmpVector3[1],E=G._TmpVector3[2],H=G._TmpVector3[3],b=G._TmpVector3[4];I.subtractToRef(V,B),A.subtractToRef(V,F),Y.tI.CrossToRef(this.direction,F,E);const X=Y.tI.Dot(B,E);if(0===X)return null;const P=1/X;this.origin.subtractToRef(V,H);const J=Y.tI.Dot(H,E)*P;if(J<-this.epsilon||J>1+this.epsilon)return null;Y.tI.CrossToRef(H,B,b);const w=Y.tI.Dot(this.direction,b)*P;if(w<-this.epsilon||J+w>1+this.epsilon)return null;const t=Y.tI.Dot(F,b)*P;return t>this.length?null:new c.e(1-J-w,J,t)}intersectsPlane(V){let I;const A=Y.tI.Dot(V.normal,this.direction);if(Math.abs(A)<9.99999997475243e-7)return null;{const B=Y.tI.Dot(V.normal,this.origin);return I=(-V.d-B)/A,I<0?I<-9.99999997475243e-7?null:0:I}}intersectsAxis(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(V){case"y":{const V=(this.origin.y-I)/this.direction.y;return V>0?null:new Y.tI(this.origin.x+this.direction.x*-V,I,this.origin.z+this.direction.z*-V)}case"x":{const V=(this.origin.x-I)/this.direction.x;return V>0?null:new Y.tI(I,this.origin.y+this.direction.y*-V,this.origin.z+this.direction.z*-V)}case"z":{const V=(this.origin.z-I)/this.direction.z;return V>0?null:new Y.tI(this.origin.x+this.direction.x*-V,this.origin.y+this.direction.y*-V,I)}default:return null}}intersectsMesh(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const H=Y.TmpVectors.Matrix[0];return V.getWorldMatrix().invertToRef(H),this._tmpRay?G.TransformToRef(this,H,this._tmpRay):this._tmpRay=G.Transform(this,H),V.intersects(this._tmpRay,I,A,B,F,E)}intersectsMeshes(V,I,A){A?A.length=0:A=[];for(let B=0;B<V.length;B++){const F=this.intersectsMesh(V[B],I);F.hit&&A.push(F)}return A.sort(this._comparePickingInfo),A}_comparePickingInfo(V,I){return V.distance<I.distance?-1:V.distance>I.distance?1:0}intersectionSegment(V,I,A){const B=this.origin,F=Y.TmpVectors.tI[0],E=Y.TmpVectors.tI[1],H=Y.TmpVectors.tI[2],c=Y.TmpVectors.tI[3];I.subtractToRef(V,F),this.direction.scaleToRef(G._Rayl,H),B.addToRef(H,E),V.subtractToRef(B,c);const b=Y.tI.Dot(F,F),X=Y.tI.Dot(F,H),P=Y.tI.Dot(H,H),J=Y.tI.Dot(F,c),w=Y.tI.Dot(H,c),t=b*P-X*X;let u,W,g=t,o=t;t<G._Smallnum?(u=0,g=1,W=w,o=P):(u=X*w-P*J,W=b*w-X*J,u<0?(u=0,W=w,o=P):u>g&&(u=g,W=w+X,o=P)),W<0?(W=0,-J<0?u=0:-J>b?u=g:(u=-J,g=b)):W>o&&(W=o,-J+X<0?u=0:-J+X>b?u=g:(u=-J+X,g=b));const L=Math.abs(u)<G._Smallnum?0:u/g,z=Math.abs(W)<G._Smallnum?0:W/o,m=Y.TmpVectors.tI[4];H.scaleToRef(z,m);const s=Y.TmpVectors.tI[5];F.scaleToRef(L,s),s.addInPlace(c);const e=Y.TmpVectors.tI[6];s.subtractToRef(m,e);return z>0&&z<=this.length&&e.lengthSquared()<A*A?s.length():-1}update(V,I,A,B,F,E,H){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){G._RayDistant||(G._RayDistant=G.Zero()),G._RayDistant.unprojectRayToRef(V,I,A,B,Y.Matrix.IdentityReadOnly,E,H);const c=Y.TmpVectors.Matrix[0];F.invertToRef(c),G.TransformToRef(G._RayDistant,c,this)}else this.unprojectRayToRef(V,I,A,B,F,E,H);return this}static Zero(){return new G(Y.tI.Zero(),Y.tI.Zero())}static CreateNew(V,I,A,B,F,E,Y){return G.Zero().update(V,I,A,B,F,E,Y)}static CreateNewFromTo(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.Matrix.IdentityReadOnly;const B=new G(new Y.tI(0,0,0),new Y.tI(0,0,0));return G.CreateFromToToRef(V,I,B,A)}static CreateFromToToRef(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.Matrix.IdentityReadOnly;A.origin.B(V);const F=I.subtractToRef(V,A.direction),E=Math.sqrt(F.x*F.x+F.y*F.y+F.z*F.z);return A.length=E,A.direction.normalize(),G.TransformToRef(A,B,A)}static Transform(V,I){const A=new G(new Y.tI(0,0,0),new Y.tI(0,0,0));return G.TransformToRef(V,I,A),A}static TransformToRef(V,I,A){Y.tI.TransformCoordinatesToRef(V.origin,I,A.origin),Y.tI.TransformNormalToRef(V.direction,I,A.direction),A.length=V.length,A.epsilon=V.epsilon;const B=A.direction,F=B.length();if(0!==F&&1!==F){const V=1/F;B.x*=V,B.y*=V,B.z*=V,A.length*=F}return A}unprojectRayToRef(V,I,A,B,F,E,H){const c=Y.TmpVectors.Matrix[0];F.multiplyToRef(E,c),c.multiplyToRef(H,c),c.invert();const b=X.e.LastCreatedEngine,P=Y.TmpVectors.tI[0];P.x=V/A*2-1,P.y=-(I/B*2-1),P.z=null!==b&&void 0!==b&&b.useReverseDepthBuffer?1:null!==b&&void 0!==b&&b.isNDCHalfZRange?0:-1;const J=Y.TmpVectors.tI[1].XH(P.x,P.y,1-1e-8),G=Y.TmpVectors.tI[2],w=Y.TmpVectors.tI[3];Y.tI._UnprojectFromInvertedMatrixToRef(P,c,G),Y.tI._UnprojectFromInvertedMatrixToRef(J,c,w),this.origin.B(G),w.subtractToRef(G,this.direction),this.direction.normalize()}}function w(V,I,A,B,F){let E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=G.Zero();return t(V,I,A,B,Y,F,E),Y}function t(V,I,A,B,F,E){let H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const b=V.getEngine();if(!E&&!(E=V.activeCamera))return V;const X=E.viewport,P=b.getRenderHeight(),{x:J,y:G,width:w,height:t}=X.toGlobal(b.getRenderWidth(),P),u=1/b.getHardwareScalingLevel();return I=I*u-J,A=A*u-(P-G-t),F.update(I,A,w,t,B||Y.Matrix.IdentityReadOnly,H?Y.Matrix.IdentityReadOnly:E.getViewMatrix(),E.getProjectionMatrix(),c),V}function u(V,I,A,B,F){if(!b.d)return V;const E=V.getEngine();if(!F&&!(F=V.activeCamera))throw new Error("Active camera not set");const H=F.viewport,c=E.getRenderHeight(),{x:X,y:P,width:J,height:G}=H.toGlobal(E.getRenderWidth(),c),w=Y.Matrix.Identity(),t=1/E.getHardwareScalingLevel();return I=I*t-X,A=A*t-(c-P-G),B.update(I,A,J,G,w,w,F.getProjectionMatrix()),V}function W(V,I,A,B,F,E,Y,H){const c=I(B,A.enableDistantPicking),b=A.intersects(c,F,Y,E,B,H);return b&&b.hit?!F&&null!=V&&b.distance>=V.distance?null:b:null}function g(V,I,A,B,F,E){let H=null;const c=!!(V.activeCameras&&V.activeCameras.length>1&&V.cameraToUseForPointers!==V.activeCamera),X=V.cameraToUseForPointers||V.activeCamera,P=J.internalPickerForMesh||W;for(let b=0;b<V.meshes.length;b++){const J=V.meshes[b];if(A){if(!A(J,-1))continue}else if(!J.isEnabled()||!J.isVisible||!J.IX)continue;const G=c&&J.isWorldMatrixCameraDependent(),w=J.YH(G,X);if(J.hasThinInstances&&J.thinInstanceEnablePicking){const V=P(H,I,J,w,!0,!0,E);if(V){if(F)return V;const c=Y.TmpVectors.Matrix[1],b=J.thinInstanceGetWorldMatrices();for(let V=0;V<b.length;V++){if(A&&!A(J,V))continue;b[V].multiplyToRef(w,c);const Y=P(H,I,J,c,B,F,E,!0);if(Y&&(H=Y,H.thinInstanceIndex=V,B))return H}}}else{const V=P(H,I,J,w,B,F,E);if(V&&(H=V,B))return H}}return H||new b.d}function o(V,I,A,B){if(!b.d)return null;const F=[],E=!!(V.activeCameras&&V.activeCameras.length>1&&V.cameraToUseForPointers!==V.activeCamera),H=V.cameraToUseForPointers||V.activeCamera,c=J.internalPickerForMesh||W;for(let b=0;b<V.meshes.length;b++){const X=V.meshes[b];if(A){if(!A(X,-1))continue}else if(!X.isEnabled()||!X.isVisible||!X.IX)continue;const P=E&&X.isWorldMatrixCameraDependent(),J=X.YH(P,H);if(X.hasThinInstances&&X.thinInstanceEnablePicking){if(c(null,I,X,J,!0,!0,B)){const V=Y.TmpVectors.Matrix[1],E=X.thinInstanceGetWorldMatrices();for(let Y=0;Y<E.length;Y++){if(A&&!A(X,Y))continue;E[Y].multiplyToRef(J,V);const H=c(null,I,X,V,!1,!1,B,!0);H&&(H.thinInstanceIndex=Y,F.push(H))}}}else{const V=c(null,I,X,J,!1,!1,B);V&&F.push(V)}}return F}function L(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,B=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0;B||(B=V.getWorldMatrix()),I.length=A,F?I.origin.B(F):I.origin.B(V.position);const E=Y.TmpVectors.tI[2];E.set(0,0,V._scene.useRightHandedSystem?-1:1);const H=Y.TmpVectors.tI[3];return Y.tI.TransformNormalToRef(E,B,H),Y.tI.NormalizeToRef(H,I.direction),I}var z,m;G._TmpVector3=(0,H.b)(6,Y.tI.Zero),G._RayDistant=G.Zero(),G._Smallnum=1e-8,G._Rayl=1e9,z=B.b,(m=F.c)&&(m.prototype.getForwardRay=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,I=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;return L(this,new G(Y.tI.Zero(),Y.tI.Zero(),V),V,I,A)},m.prototype.getForwardRayToRef=function(V){return L(this,V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),z&&(P.b._IsPickingAvailable=!0,z.prototype.createPickingRay=function(V,I,A,B){return w(this,V,I,A,B,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),B.b.prototype.createPickingRayToRef=function(V,I,A,B,F){return t(this,V,I,A,B,F,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},B.b.prototype.createPickingRayInCameraSpace=function(V,I,A){return function(V,I,A,B){const F=G.Zero();return u(V,I,A,F,B),F}(this,V,I,A)},B.b.prototype.createPickingRayInCameraSpaceToRef=function(V,I,A,B){return u(this,V,I,A,B)},B.b.prototype.pickWithBoundingInfo=function(V,I,A,B,F){return function(V,I,A,B,F,E){if(!b.d)return null;const H=g(V,(B=>(V._tempPickingRay||(V._tempPickingRay=G.Zero()),t(V,I,A,B,V._tempPickingRay,E||null),V._tempPickingRay)),B,F,!0);return H&&(H.ray=w(V,I,A,Y.Matrix.Identity(),E||null)),H}(this,V,I,A,B,F)},B.b.prototype.JA=function(V,I,A,B,F,E){return function(V,I,A,B,F,E,H){const c=g(V,((B,F)=>(V._tempPickingRay||(V._tempPickingRay=G.Zero()),t(V,I,A,B,V._tempPickingRay,E||null,!1,F),V._tempPickingRay)),B,F,!1,H);return c&&(c.ray=w(V,I,A,Y.Matrix.Identity(),E||null)),c}(this,V,I,A,B,F,E)},B.b.prototype.pickWithRay=function(V,I,A,B){return function(V,I,A,B,F){const E=g(V,(A=>(V._pickWithRayInverseMatrix||(V._pickWithRayInverseMatrix=Y.Matrix.Identity()),A.invertToRef(V._pickWithRayInverseMatrix),V._cachedRayForTransform||(V._cachedRayForTransform=G.Zero()),G.TransformToRef(I,V._pickWithRayInverseMatrix,V._cachedRayForTransform),V._cachedRayForTransform)),A,B,!1,F);return E&&(E.ray=I),E}(this,V,I,A,B)},B.b.prototype.multiPick=function(V,I,A,B,F){return function(V,I,A,B,F,E){return o(V,(B=>w(V,I,A,B,F||null)),B,E)}(this,V,I,A,B,F)},B.b.prototype.multiPickWithRay=function(V,I,A){return function(V,I,A,B){return o(V,(A=>(V._pickWithRayInverseMatrix||(V._pickWithRayInverseMatrix=Y.Matrix.Identity()),A.invertToRef(V._pickWithRayInverseMatrix),V._cachedRayForTransform||(V._cachedRayForTransform=G.Zero()),G.TransformToRef(I,V._pickWithRayInverseMatrix,V._cachedRayForTransform),V._cachedRayForTransform)),A,B)}(this,V,I,A)}},12932:(V,I,A)=>{"use strict";var B=A(11167),F=A(11064),E=A(11105),Y=A(11194),H=A(11137),c=A(11178);H.e.prototype._partialLoadFile=function(V,I,A,B){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(V,(V=>{A[I]=V,A._internalCount++,6===A._internalCount&&B(A)}),void 0,void 0,!0,((V,I)=>{F&&V&&F(V.status+" "+V.statusText,I)}))},H.e.prototype._cascadeLoadFiles=function(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const F=[];F._internalCount=0;for(let E=0;E<6;E++)this._partialLoadFile(A[E],E,F,I,B)},H.e.prototype._cascadeLoadImgs=function(V,I,A,B){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5?arguments[5]:void 0;const Y=[];Y._internalCount=0;for(let H=0;H<6;H++)this._partialLoadImg(B[H],H,Y,V,I,A,F,E)},H.e.prototype._partialLoadImg=function(V,I,A,B,F,H){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7?arguments[7]:void 0;const X=(0,Y.c)();(0,E.r)(V,(V=>{A[I]=V,A._internalCount++,B&&B.removePendingData(X),6===A._internalCount&&H&&H(F,A)}),((V,I)=>{B&&B.removePendingData(X),c&&c(V,I)}),B?B.offlineProvider:null,b),B&&B.addPendingData(X)},H.e.prototype.createCubeTextureBase=function(V,I,A,E){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]&&arguments[8],J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,G=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,t=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,u=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,W=arguments.length>14&&void 0!==arguments[14]&&arguments[14],g=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const o=w||new B.d(this,7);o.isCube=!0,o.url=V,o.generateMipMaps=!E,o._lodGenerationScale=J,o._lodGenerationOffset=G,o._useSRGBBuffer=!!W&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!E),o!==w&&(o.label=V.substring(0,60)),this._doNotHandleContextLost||(o._extension=X,o._files=A,o._buffer=g);const L=V;this._transformTextureUrl&&!w&&(V=this._transformTextureUrl(V));const z=X??function(V){const I=V.split("?")[0],A=I.lastIndexOf(".");return A>-1?I.substring(A).toLowerCase():""}(V),m=(0,c.b)(z),s=(V,I)=>{o.dispose(),H?H(V,I):V&&F.b.Warn(V)},e=(B,H)=>{V===L?B&&s(B.status+" "+B.statusText,H):(F.b.Warn(`Failed to load ${V}, falling back to the ${L}`),this.createCubeTextureBase(L,I,A,!!E,Y,s,b,X,P,J,G,o,t,u,W,g))};if(m)m.then((B=>{const F=V=>{t&&t(o,V),B.loadCubeData(V,o,P,Y,((V,I)=>{s(V,I)}))};g?F(g):A&&6===A.length?B.supportCascades?this._cascadeLoadFiles(I,(V=>F(V.map((V=>new Uint8Array(V))))),A,s):s("Textures type does not support cascades."):this._loadFile(V,(V=>F(new Uint8Array(V))),void 0,void 0,!0,e)}));else{if(!A||0===A.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(I,o,((V,I)=>{u&&u(V,I)}),A,s)}return this._internalTexturesCache.push(o),o}},13455:(V,I,A)=>{"use strict";A(11064);var B=A(11359);A(11167),A(11305),A(11164),A(11405),A(11369);B.c},12948:(V,I,A)=>{"use strict";A.d(I,{e:()=>F});var B=A(11189);class F{constructor(V){this.value=this._toInt(V)}_toInt(V){return 0|V}add(V){return new F(this.value+V.value)}uI(V){return new F(this.value-V.value)}multiply(V){return new F(Math.imul(this.value,V.value))}divide(V){return new F(this.value/V.value)}getClassName(){return F.ClassName}equals(V){return this.value===V.value}static FromValue(V){return new F(V)}toString(){return this.value.toString()}}F.ClassName="FlowGraphInteger",(0,B.e)("FlowGraphInteger",F)},12963:(V,I,A)=>{"use strict";A.d(I,{d:()=>F,e:()=>E});var B=A(11231);class F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.kY=V}get m(){return this.kY}transformVector(V){return this.transformVectorToRef(V,new B.Vector2)}transformVectorToRef(V,I){return I.x=V.x*this.kY[0]+V.y*this.kY[1],I.y=V.x*this.kY[2]+V.y*this.kY[3],I}AH(){return this.toArray()}toArray(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let I=0;I<4;I++)V[I]=this.kY[I];return V}GA(V){for(let I=0;I<4;I++)this.kY[I]=V[I];return this}multiplyToRef(V,I){const A=V.kY,B=this.kY,F=I.kY;return F[0]=A[0]*B[0]+A[1]*B[2],F[1]=A[0]*B[1]+A[1]*B[3],F[2]=A[2]*B[0]+A[3]*B[2],F[3]=A[2]*B[1]+A[3]*B[3],I}multiply(V){return this.multiplyToRef(V,new F)}divideToRef(V,I){const A=this.kY,B=V.kY,F=I.kY;return F[0]=A[0]/B[0],F[1]=A[1]/B[1],F[2]=A[2]/B[2],F[3]=A[3]/B[3],I}divide(V){return this.divideToRef(V,new F)}addToRef(V,I){const A=this.kY,B=V.m,F=I.m;return F[0]=A[0]+B[0],F[1]=A[1]+B[1],F[2]=A[2]+B[2],F[3]=A[3]+B[3],I}add(V){return this.addToRef(V,new F)}subtractToRef(V,I){const A=this.kY,B=V.m,F=I.m;return F[0]=A[0]-B[0],F[1]=A[1]-B[1],F[2]=A[2]-B[2],F[3]=A[3]-B[3],I}uI(V){return this.subtractToRef(V,new F)}transpose(){const V=this.kY;return new F([V[0],V[2],V[1],V[3]])}determinant(){const V=this.kY;return V[0]*V[3]-V[1]*V[2]}inverse(){const V=this.determinant();if(0===V)throw new Error("Matrix is not invertible");const I=this.kY,A=1/V;return new F([I[3]*A,-I[1]*A,-I[2]*A,I[0]*A])}equals(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=this.kY,B=V.m;return 0===I?A[0]===B[0]&&A[1]===B[1]&&A[2]===B[2]&&A[3]===B[3]:Math.abs(A[0]-B[0])<I&&Math.abs(A[1]-B[1])<I&&Math.abs(A[2]-B[2])<I&&Math.abs(A[3]-B[3])<I}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.kY.join(", ")})`}}class E{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.kY=V}get m(){return this.kY}transformVector(V){return this.transformVectorToRef(V,new B.tI)}transformVectorToRef(V,I){const A=this.kY;return I.x=V.x*A[0]+V.y*A[1]+V.z*A[2],I.y=V.x*A[3]+V.y*A[4]+V.z*A[5],I.z=V.x*A[6]+V.y*A[7]+V.z*A[8],I}multiplyToRef(V,I){const A=V.kY,B=this.kY,F=I.m;return F[0]=A[0]*B[0]+A[1]*B[3]+A[2]*B[6],F[1]=A[0]*B[1]+A[1]*B[4]+A[2]*B[7],F[2]=A[0]*B[2]+A[1]*B[5]+A[2]*B[8],F[3]=A[3]*B[0]+A[4]*B[3]+A[5]*B[6],F[4]=A[3]*B[1]+A[4]*B[4]+A[5]*B[7],F[5]=A[3]*B[2]+A[4]*B[5]+A[5]*B[8],F[6]=A[6]*B[0]+A[7]*B[3]+A[8]*B[6],F[7]=A[6]*B[1]+A[7]*B[4]+A[8]*B[7],F[8]=A[6]*B[2]+A[7]*B[5]+A[8]*B[8],I}multiply(V){return this.multiplyToRef(V,new E)}divideToRef(V,I){const A=this.kY,B=V.m,F=I.m;return F[0]=A[0]/B[0],F[1]=A[1]/B[1],F[2]=A[2]/B[2],F[3]=A[3]/B[3],F[4]=A[4]/B[4],F[5]=A[5]/B[5],F[6]=A[6]/B[6],F[7]=A[7]/B[7],F[8]=A[8]/B[8],I}divide(V){return this.divideToRef(V,new E)}addToRef(V,I){const A=this.kY,B=V.m,F=I.m;return F[0]=A[0]+B[0],F[1]=A[1]+B[1],F[2]=A[2]+B[2],F[3]=A[3]+B[3],F[4]=A[4]+B[4],F[5]=A[5]+B[5],F[6]=A[6]+B[6],F[7]=A[7]+B[7],F[8]=A[8]+B[8],I}add(V){return this.addToRef(V,new E)}subtractToRef(V,I){const A=this.kY,B=V.m,F=I.m;return F[0]=A[0]-B[0],F[1]=A[1]-B[1],F[2]=A[2]-B[2],F[3]=A[3]-B[3],F[4]=A[4]-B[4],F[5]=A[5]-B[5],F[6]=A[6]-B[6],F[7]=A[7]-B[7],F[8]=A[8]-B[8],I}uI(V){return this.subtractToRef(V,new E)}toArray(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let I=0;I<9;I++)V[I]=this.kY[I];return V}AH(){return this.toArray()}GA(V){for(let I=0;I<9;I++)this.kY[I]=V[I];return this}transpose(){const V=this.kY;return new E([V[0],V[3],V[6],V[1],V[4],V[7],V[2],V[5],V[8]])}determinant(){const V=this.kY;return V[0]*(V[4]*V[8]-V[5]*V[7])-V[1]*(V[3]*V[8]-V[5]*V[6])+V[2]*(V[3]*V[7]-V[4]*V[6])}inverse(){const V=this.determinant();if(0===V)throw new Error("Matrix is not invertible");const I=this.kY,A=1/V;return new E([(I[4]*I[8]-I[5]*I[7])*A,(I[2]*I[7]-I[1]*I[8])*A,(I[1]*I[5]-I[2]*I[4])*A,(I[5]*I[6]-I[3]*I[8])*A,(I[0]*I[8]-I[2]*I[6])*A,(I[2]*I[3]-I[0]*I[5])*A,(I[3]*I[7]-I[4]*I[6])*A,(I[1]*I[6]-I[0]*I[7])*A,(I[0]*I[4]-I[1]*I[3])*A])}equals(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=this.kY,B=V.m;return 0===I?A[0]===B[0]&&A[1]===B[1]&&A[2]===B[2]&&A[3]===B[3]&&A[4]===B[4]&&A[5]===B[5]&&A[6]===B[6]&&A[7]===B[7]&&A[8]===B[8]:Math.abs(A[0]-B[0])<I&&Math.abs(A[1]-B[1])<I&&Math.abs(A[2]-B[2])<I&&Math.abs(A[3]-B[3])<I&&Math.abs(A[4]-B[4])<I&&Math.abs(A[5]-B[5])<I&&Math.abs(A[6]-B[6])<I&&Math.abs(A[7]-B[7])<I&&Math.abs(A[8]-B[8])<I}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.kY.join(", ")})`}}},12972:(V,I,A)=>{"use strict";var B;function F(V,I,A,B){switch(I){case"Animation":return B?V.animations.find((V=>V.uniqueId===A))??null:V.animations[A]??null;case"AnimationGroup":return B?V.animationGroups.find((V=>V.uniqueId===A))??null:V.animationGroups[A]??null;case"Mesh":return B?V.meshes.find((V=>V.uniqueId===A))??null:V.meshes[A]??null;case"Material":return B?V.materials.find((V=>V.uniqueId===A))??null:V.materials[A]??null;case"SP":return B?V.cameras.find((V=>V.uniqueId===A))??null:V.cameras[A]??null;case"Light":return B?V.lights.find((V=>V.uniqueId===A))??null:V.lights[A]??null;default:return null}}A.d(I,{e:()=>F}),function(V){V.Animation="Animation",V.AnimationGroup="AnimationGroup",V.Mesh="Mesh",V.Material="Material",V.SP="SP",V.Light="Light"}(B||(B={}))},13003:(V,I,A)=>{"use strict";A.d(I,{c:()=>F});var B=A(13011);class F extends B.d{constructor(V,I){if(super(V),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),I)for(const A of I)this._eventsSignalOutputs[A]=this._registerSignalOutput(A+"Event")}_executeOnTick(V){}_startPendingTasks(V){V._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(V),this._resetAfterCanceled(V)),this._preparePendingTasks(V),V._addPendingBlock(this),this.out._activateSignal(V),V._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(V){V._deleteExecutionVariable(this,"_initialized"),V._removePendingBlock(this)}}},12979:(V,I,A)=>{"use strict";A.d(I,{d:()=>b});var B=A(11194),F=A(11189),E=A(12984),Y=A(11057),H=A(12946);class c extends E.d{constructor(V,I,A,B){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:B.defaultValue,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(V,I,A),this.richType=B,this._defaultValue=F,this._optional=E,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new Y.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(V){this._isDisabled!==V&&(this._isDisabled=V,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(V,I){I._getConnectionValue(this)!==V&&(I._setConnectionValue(this,V),this.onValueChangedObservable.notifyObservers(V))}resetToDefaultValue(V){V._setConnectionValue(this,this._defaultValue)}connectTo(V){this._isDisabled||super.connectTo(V)}_getValueOrDefault(V){const I=V._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(I):I}getValue(V){if(1===this.connectionType){V._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(V);const I=this._getValueOrDefault(V);return this._lastValue=I,this.richType.typeTransformer?this.richType.typeTransformer(I):I}const I=this.isConnected()?this._connectedPoint[0].getValue(V):this._getValueOrDefault(V);return this._lastValue=I,this.richType.typeTransformer?this.richType.typeTransformer(I):I}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.richType={},this.richType.serialize(V.richType),V.optional=this._optional,(0,H.e)("defaultValue",this._defaultValue,V)}}(0,F.e)("FlowGraphDataConnection",c);class b{constructor(V){var I;this.config=V,this.uniqueId=(0,B.c)(),this.name=(null===(I=this.config)||void 0===I?void 0:I.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(V){}registerDataInput(V,I,A){const B=new c(V,0,this,I,A);return this.dataInputs.push(B),B}registerDataOutput(V,I,A){const B=new c(V,1,this,I,A);return this.dataOutputs.push(B),B}getDataInput(V){return this.dataInputs.find((I=>I.name===V))}getDataOutput(V){return this.dataOutputs.find((I=>I.name===V))}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.e;if(V.uniqueId=this.uniqueId,V.config={},this.config){const A=this.config,B=Object.keys(A);for(const F of B)I(F,A[F],V.config)}V.dataInputs=[],V.dataOutputs=[],V.className=this.getClassName();for(const A of this.dataInputs){const I={};A.serialize(I),V.dataInputs.push(I)}for(const A of this.dataOutputs){const I={};A.serialize(I),V.dataOutputs.push(I)}}deserialize(V){}_log(V,I,A){var B;null===(B=V.logger)||void 0===B||B.addLogItem({action:I,wA:A,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12984:(V,I,A)=>{"use strict";A.d(I,{d:()=>E});var B,F=A(11194);!function(V){V[V.Input=0]="Input",V[V.Output=1]="Output"}(B||(B={}));class E{constructor(V,I,A){this._ownerBlock=A,this._connectedPoint=[],this.uniqueId=(0,F.c)(),this.connectedPointIds=[],this.name=V,this._connectionType=I}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(V){if(this._connectionType===V._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||V._isSingularConnection()&&V._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(V),V._connectedPoint.push(this)}disconnectFrom(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=this._connectedPoint.indexOf(V),B=V._connectedPoint.indexOf(this);-1!==A&&-1!==B&&(I&&this._connectedPoint.splice(A,1),V._connectedPoint.splice(B,1))}disconnectFromAll(){for(const V of this._connectedPoint)this.disconnectFrom(V,!1);this._connectedPoint.length=0}dispose(){for(const V of this._connectedPoint)this.disconnectFrom(V)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V.uniqueId=this.uniqueId,V.name=this.name,V._connectionType=this._connectionType,V.connectedPointIds=[],V.className=this.getClassName();for(const I of this._connectedPoint)V.connectedPointIds.push(I.uniqueId)}getClassName(){return"FGConnection"}deserialize(V){this.uniqueId=V.uniqueId,this.name=V.name,this._connectionType=V._connectionType,this.connectedPointIds=V.connectedPointIds}}},12942:(V,I,A)=>{"use strict";A.d(I,{b:()=>o});var B,F=A(11057),E=A(11213),Y=A(11222),H=A(11194),c=A(12946),b=A(12972),X=A(11064);!function(V){V.ExecuteBlock="ExecuteBlock",V.ExecuteEvent="ExecuteEvent",V.TriggerConnection="TriggerConnection",V.ContextVariableSet="ContextVariableSet",V.GlobalVariableSet="GlobalVariableSet",V.GlobalVariableDelete="GlobalVariableDelete",V.GlobalVariableGet="GlobalVariableGet",V.AddConnection="AddConnection",V.GetConnectionValue="GetConnectionValue",V.SetConnectionValue="SetConnectionValue",V.ActivateSignal="ActivateSignal",V.ContextVariableGet="ContextVariableGet"}(B||(B={}));class P{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(V){if(V.time||(V.time=Date.now()),this.log.push(V),this.logToConsole){var I;const A=null===(I=V.wA)||void 0===I?void 0:I.value;"object"===typeof A&&A.getClassName?X.b.Log(`[FGLog] ${V.className}:${V.uniqueId.split("-")[0]} ${V.action} - ${JSON.stringify(A.getClassName())}: ${A.toString()}`):X.b.Log(`[FGLog] ${V.className}:${V.uniqueId.split("-")[0]} ${V.action} - ${JSON.stringify(V.wA)}`)}}getItemsOfType(V){return this.log.filter((I=>I.action===V))}}class J{get enableLogging(){return this._enableLogging}set enableLogging(V){this._enableLogging!==V&&(this._enableLogging=V,this._enableLogging?(this.logger=new P,this.logger.logToConsole=!0):this.logger=null)}constructor(V){this.uniqueId=(0,H.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new F.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=V,this.assetsContext=V.assetsContext??V.WI}hasVariable(V){return V in this._userVariables}setVariable(V,I){var A;this._userVariables[V]=I,null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",wA:{name:V,value:I}})}getAsset(V,I){return(0,b.e)(this.assetsContext,V,I)}getVariable(V){var I;return null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",wA:{name:V,value:this._userVariables[V]}}),this._userVariables[V]}get userVariables(){return this._userVariables}sV(){return this._configuration.WI}_getUniqueIdPrefixedName(V,I){return`${V.uniqueId}_${I}`}_getGlobalContextVariable(V,I){var A;return null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",wA:{name:V,defaultValue:I,possibleValue:this._globalContextVariables[V]}}),this._hasGlobalContextVariable(V)?this._globalContextVariables[V]:I}_setGlobalContextVariable(V,I){var A;null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",wA:{name:V,value:I}}),this._globalContextVariables[V]=I}_deleteGlobalContextVariable(V){var I;null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",wA:{name:V}}),delete this._globalContextVariables[V]}_hasGlobalContextVariable(V){return V in this._globalContextVariables}_setExecutionVariable(V,I,A){this._executionVariables[this._getUniqueIdPrefixedName(V,I)]=A}_getExecutionVariable(V,I,A){return this._hasExecutionVariable(V,I)?this._executionVariables[this._getUniqueIdPrefixedName(V,I)]:A}_deleteExecutionVariable(V,I){delete this._executionVariables[this._getUniqueIdPrefixedName(V,I)]}_hasExecutionVariable(V,I){return this._getUniqueIdPrefixedName(V,I)in this._executionVariables}_hasConnectionValue(V){return V.uniqueId in this._connectionValues}_setConnectionValue(V,I){var A;this._connectionValues[V.uniqueId]=I,null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",wA:{connectionPointId:V.uniqueId,value:I}})}_setConnectionValueByKey(V,I){this._connectionValues[V]=I}_getConnectionValue(V){var I;return null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",wA:{connectionPointId:V.uniqueId,value:this._connectionValues[V.uniqueId]}}),this._connectionValues[V.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(V){this._pendingBlocks.includes(V)||(this._pendingBlocks.push(V),this._pendingBlocks.sort(((V,I)=>V.priority-I.priority)))}_removePendingBlock(V){const I=this._pendingBlocks.indexOf(V);-1!==I&&this._pendingBlocks.splice(I,1)}_clearPendingBlocks(){for(const V of this._pendingBlocks)V._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(V){var I;this.onNodeExecutedObservable.notifyObservers(V),null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:V.getClassName(),uniqueId:V.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(V){this._setGlobalContextVariable("timeSinceStart",V.timeSinceStart),this._setGlobalContextVariable("deltaTime",V.deltaTime);for(const A of this._pendingBlocks){var I;null===(I=A._executeOnTick)||void 0===I||I.call(A,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.e;V.uniqueId=this.uniqueId,V._userVariables={};for(const B in this._userVariables)I(B,this._userVariables[B],V._userVariables);V._connectionValues={};for(const B in this._connectionValues)I(B,this._connectionValues[B],V._connectionValues);var A;this.assetsContext!==this.sV()&&(V._assetsContext={meshes:this.assetsContext.meshes.map((V=>V.id)),materials:this.assetsContext.materials.map((V=>V.id)),textures:this.assetsContext.textures.map((V=>V.name)),animations:this.assetsContext.animations.map((V=>V.name)),lights:this.assetsContext.lights.map((V=>V.id)),cameras:this.assetsContext.cameras.map((V=>V.id)),dG:null===(A=this.assetsContext.dG)||void 0===A?void 0:A.map((V=>V.name)),skeletons:this.assetsContext.skeletons.map((V=>V.id)),XG:this.assetsContext.XG.map((V=>V.name)),geometries:this.assetsContext.geometries.map((V=>V.id)),multiMaterials:this.assetsContext.multiMaterials.map((V=>V.id)),transformNodes:this.assetsContext.transformNodes.map((V=>V.id))})}getClassName(){return"FlowGraphContext"}}(0,E.b)([(0,Y.A)()],J.prototype,"uniqueId",void 0);var G=A(12975),w=A(11507);class t{constructor(V){this.onEventTriggeredObservable=new F.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=V,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.aY.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const V=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",wA:{timeSinceStart:this._startingTime,deltaTime:V}}),this._startingTime+=V})),this._meshPickedObserver=this._scene.onPointerObservable.add((V=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",wA:V})}),w.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((V=>{const I=V.pointerId,A=V.mesh,B=this._pointerUnderMeshState[I];!B&&A?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",wA:{pointerId:I,mesh:A}}):B&&!A?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",wA:{pointerId:I,mesh:B}}):B&&A&&B!==A&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",wA:{pointerId:I,mesh:B,over:A}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",wA:{pointerId:I,mesh:A,out:B}})),this._pointerUnderMeshState[I]=A}),w.d.POINTERMOVE)}dispose(){var V,I,A,B,F;null===(V=this._sceneDisposeObserver)||void 0===V||V.remove(),null===(I=this._sceneReadyObserver)||void 0===I||I.remove(),null===(A=this._sceneOnBeforeRenderObserver)||void 0===A||A.remove(),null===(B=this._meshPickedObserver)||void 0===B||B.remove(),null===(F=this._meshUnderPointerObserver)||void 0===F||F.remove(),this.onEventTriggeredObservable.clear()}}var u,W=A(12989);!function(V){V[V.Stopped=0]="Stopped",V[V.Started=1]="Started"}(u||(u={}));class g{get state(){return this._state}set state(V){this._state=V,this.onStateChangedObservable.notifyObservers(V)}constructor(V){this.onStateChangedObservable=new F.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=V.WI,this._sceneEventCoordinator=new t(this._scene),this._coordinator=V.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((V=>{for(const I of this._executionContexts){const A=this._getContextualOrder(V.type,I);for(const B of A)if(!B._executeEvent(I,V.wA))break}switch(V.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const I of this._executionContexts)I._notifyOnTick(V.wA);break;case"SceneDispose":this.dispose()}}))}createContext(){const V=new J({WI:this._scene,coordinator:this._coordinator});return this._executionContexts.push(V),V}getContext(V){return this._executionContexts[V]}addEventBlock(V){if("PointerOver"!==V.type&&"PointerOut"!==V.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==V.type&&this._eventBlocks[V.type].push(V),1===this.state)for(const I of this._executionContexts)V._startPendingTasks(I);else this.onStateChangedObservable.addOnce((I=>{if(1===I)for(const A of this._executionContexts)V._startPendingTasks(A)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((V=>{1===V&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const V of this._executionContexts)for(const I in this._eventBlocks){const A=this._getContextualOrder(I,V);for(const I of A)I._startPendingTasks(V)}}_getContextualOrder(V,I){const A=this._eventBlocks[V].sort(((V,I)=>I.initPriority-V.initPriority));if("MeshPick"===V){const V=[];for(const B of A){const F=B.asset.getValue(I);let E=0;for(;E<A.length;E++){const V=A[E].asset.getValue(I);if(F&&V&&(0,W.p)(F,V))break}V.splice(E,0,B)}return V}return A}dispose(){var V;if(0!==this.state){this.state=0;for(const V of this._executionContexts)V._clearPendingBlocks();this._executionContexts.length=0;for(const V in this._eventBlocks)this._eventBlocks[V].length=0;null===(V=this._eventObserver)||void 0===V||V.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(V){const I=[],A=new Set;for(const B in this._eventBlocks)for(const V of this._eventBlocks[B])I.push(V),A.add(V.uniqueId);for(;I.length>0;){const B=I.pop();V(B);for(const V of B.dataInputs)for(const B of V._connectedPoint)A.has(B._ownerBlock.uniqueId)||(I.push(B._ownerBlock),A.add(B._ownerBlock.uniqueId));if(B instanceof G.b)for(const V of B.signalOutputs)for(const B of V._connectedPoint)A.has(B._ownerBlock.uniqueId)||(I.push(B._ownerBlock),A.add(B._ownerBlock.uniqueId))}}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1?arguments[1]:void 0;V.allBlocks=[],this.visitAllBlocks((I=>{const A={};I.serialize(A),V.allBlocks.push(A)})),V.executionContexts=[];for(const A of this._executionContexts){const B={};A.serialize(B,I),V.executionContexts.push(B)}}}class o{constructor(V){this.config=V,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.WI.aY.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.WI.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const V=this._executeOnNextFrame.slice(0);if(V.length)for(const I of V){this.notifyCustomEvent(I.id,I.data,!1);const V=this._executeOnNextFrame.findIndex((V=>V.uniqueId===I.uniqueId));-1!==V&&this._executeOnNextFrame.splice(V,1)}}));(o.SceneCoordinators.get(this.config.WI)??[]).push(this)}createGraph(){const V=new g({WI:this.config.WI,coordinator:this});return this._flowGraphs.push(V),V}removeGraph(V){const I=this._flowGraphs.indexOf(V);-1!==I&&(V.dispose(),this._flowGraphs.splice(I,1))}start(){for(const V of this._flowGraphs)V.start()}dispose(){var V,I;for(const F of this._flowGraphs)F.dispose();this._flowGraphs.length=0,null===(V=this._disposeObserver)||void 0===V||V.remove(),null===(I=this._onBeforeRenderObserver)||void 0===I||I.remove();const A=o.SceneCoordinators.get(this.config.WI)??[],B=A.indexOf(this);-1!==B&&A.splice(B,1)}serialize(V,I){V._flowGraphs=[];for(const A of this._flowGraphs){const B={};A.serialize(B,I),V._flowGraphs.push(B)}V.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(V){let I=this._customEventsMap.get(V);return I||(I=new F.c,this._customEventsMap.set(V,I)),I}notifyCustomEvent(V,I){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:V,data:I,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(V)){const I=this._eventExecutionCounter.get(V);if(this._eventExecutionCounter.set(V,I+1),I>=o.MaxEventTypeExecutionPerFrame)return void(I===o.MaxEventTypeExecutionPerFrame&&X.b.Warn(`FlowGraphCoordinator: Too many executions of event "${V}".`))}else this._eventExecutionCounter.set(V,1);const A=this._customEventsMap.get(V);A&&A.notifyObservers(I)}}o.MaxEventsPerType=30,o.MaxEventTypeExecutionPerFrame=30,o.SceneCoordinators=new Map},12997:(V,I,A)=>{"use strict";A.d(I,{c:()=>F});var B=A(13003);class F extends B.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(V){V._notifyExecuteNode(this),this.done._activateSignal(V)}}},12975:(V,I,A)=>{"use strict";A.d(I,{b:()=>H});var B=A(12979),F=A(12984),E=A(11189);class Y extends F.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(V){super.connectTo(V),this._connectedPoint.sort(((V,I)=>I.priority-V.priority))}_activateSignal(V){var I;if(null===(I=V.logger)||void 0===I||I.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,wA:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)V._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(V,this),V._increaseExecutionId();else for(const A of this._connectedPoint)A._activateSignal(V)}}(0,E.e)("FlowGraphSignalConnection",Y);class H extends B.d{constructor(V){super(V),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(V){const I=new Y(V,0,this);return this.signalInputs.push(I),I}_registerSignalOutput(V){const I=new Y(V,1,this);return this.signalOutputs.push(I),I}_unregisterSignalInput(V){const I=this.signalInputs.findIndex((I=>I.name===V));-1!==I&&(this.signalInputs[I].dispose(),this.signalInputs.splice(I,1))}_unregisterSignalOutput(V){const I=this.signalOutputs.findIndex((I=>I.name===V));-1!==I&&(this.signalOutputs[I].dispose(),this.signalOutputs.splice(I,1))}_reportError(V,I){this.error.wA="string"===typeof I?new Error(I):I,this.error._activateSignal(V)}getSignalInput(V){return this.signalInputs.find((I=>I.name===V))}getSignalOutput(V){return this.signalOutputs.find((I=>I.name===V))}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.signalInputs=[],V.signalOutputs=[];for(const I of this.signalInputs){const A={};I.serialize(A),V.signalInputs.push(A)}for(const I of this.signalOutputs){const A={};I.serialize(A),V.signalOutputs.push(A)}}deserialize(V){for(let I=0;I<V.signalInputs.length;I++){const A=this.getSignalInput(V.signalInputs[I].name);if(!A)throw new Error("Could not find signal input with name "+V.signalInputs[I].name+" in block "+V.className);A.deserialize(V.signalInputs[I])}for(let I=0;I<V.signalOutputs.length;I++){const A=this.getSignalOutput(V.signalOutputs[I].name);if(!A)throw new Error("Could not find signal output with name "+V.signalOutputs[I].name+" in block "+V.className);A.deserialize(V.signalOutputs[I])}}getClassName(){return"FlowGraphExecutionBlock"}}},13011:(V,I,A)=>{"use strict";A.d(I,{d:()=>F});var B=A(12975);class F extends B.b{constructor(V){super(V),this.out=this._registerSignalOutput("out")}}},12954:(V,I,A)=>{"use strict";A.d(I,{D:()=>G,H:()=>w,K:()=>t,N:()=>S,O:()=>Q,P:()=>e,S:()=>s,e:()=>b,g:()=>J,i:()=>m,m:()=>u,q:()=>W,u:()=>g,v:()=>P,x:()=>z,z:()=>X});var B,F=A(11231),E=A(11276),Y=A(12948),H=A(12963);!function(V){V.Any="any",V.String="string",V.Number="number",V.Boolean="boolean",V.Object="object",V.Integer="FlowGraphInteger",V.Vector2="Vector2",V.tI="tI",V.Vector4="Vector4",V.Quaternion="Quaternion",V.Matrix="Matrix",V.Matrix2D="Matrix2D",V.Matrix3D="Matrix3D",V.oI="oI",V.GH="GH"}(B||(B={}));class c{constructor(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=V,this.defaultValue=I,this.animationType=A}serialize(V){V.typeName=this.typeName,V.defaultValue=this.defaultValue}}const b=new c("any",void 0),X=new c("string",""),P=new c("number",0,0),J=new c("boolean",!1),G=new c("Vector2",F.Vector2.Zero(),5),w=new c("tI",F.tI.Zero(),1),t=new c("Vector4",F.Vector4.Zero()),u=new c("Matrix",F.Matrix.Identity(),3),W=new c("Matrix2D",new H.d),g=new c("Matrix3D",new H.e),o=new c("oI",E.oI.Black(),4),L=new c("GH",new E.GH(0,0,0,0),7),z=new c("Quaternion",F.Quaternion.Identity(),2);z.typeTransformer=V=>{if(V.getClassName){if("Vector4"===V.getClassName())return F.Quaternion.LI(V.AH());if("tI"===V.getClassName())return F.Quaternion.FromEulerVector(V);if("Matrix"===V.getClassName())return F.Quaternion.FromRotationMatrix(V)}return V};const m=new c("FlowGraphInteger",new Y.e(0),0);function s(V){const I=V;switch(typeof V){case"string":return X;case"number":return P;case"boolean":return J;case"object":if(I.getClassName)switch(I.getClassName()){case"Vector2":return G;case"tI":return w;case"Vector4":return t;case"Matrix":return u;case"oI":return o;case"GH":return L;case"Quaternion":return z;case"FlowGraphInteger":return m;case"Matrix2D":return W;case"Matrix3D":return g}return b;default:return b}}function e(V){switch(V){case"string":return X;case"number":return P;case"boolean":return J;case"Vector2":return G;case"tI":return w;case"Vector4":return t;case"Matrix":return u;case"oI":return o;case"GH":return L;case"Quaternion":return z;case"FlowGraphInteger":return m;case"Matrix2D":return W;case"Matrix3D":return g;default:return b}}function S(V){switch(V){case"number":default:return 0;case"Vector2":return 5;case"tI":return 1;case"Matrix":return 3;case"oI":return 4;case"GH":return 7;case"Quaternion":return 2}}function Q(V){switch(V){case 0:return P;case 5:return G;case 1:return w;case 3:return u;case 4:return o;case 7:return L;case 2:return z;default:return b}}},12946:(V,I,A)=>{"use strict";A.d(I,{b:()=>X,e:()=>b,g:()=>P});var B=A(11276),F=A(11231),E=A(12948),Y=A(12954),H=A(12963);function c(V){return"Vector2"===V||"tI"===V||"Vector4"===V||"Quaternion"===V||"oI"===V||"GH"===V}function b(V,I,A){var B;const F=(null===I||void 0===I||null===(B=I.getClassName)||void 0===B?void 0:B.call(I))??"";if(c(F)||function(V){return"Matrix"===V||"Matrix2D"===V||"Matrix3D"===V}(F))A[V]={value:I.AH(),className:F};else if("FlowGraphInteger"===F)A[V]={value:I.value,className:F};else if(F&&(I.id||I.name))A[V]={id:I.id,name:I.name,className:F};else{if("object"===typeof I)throw new Error(`Could not serialize value ${I}`);A[V]=I}}function X(V,I,A,b){const P=I[V];let J;const G=(null===P||void 0===P?void 0:P.type)??(null===P||void 0===P?void 0:P.className);if(function(V){return"Mesh"===V||"AbstractMesh"===V||"GroundMesh"===V||"InstanceMesh"===V||"LinesMesh"===V||"GoldbergMesh"===V||"GreasedLineMesh"===V||"TrailMesh"===V}(G)){let V=b.meshes.filter((V=>P.id?V.id===P.id:V.name===P.name));0===V.length&&(V=b.transformNodes.filter((V=>P.id?V.id===P.id:V.name===P.name))),J=P.uniqueId?V.find((V=>V.uniqueId===P.uniqueId)):V[0]}else if(c(G))J=function(V,I){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===V)return F.Vector2.LI(I);if("tI"===V)return A&&(I[2]*=-1),F.tI.LI(I);if("Vector4"===V)return F.Vector4.LI(I);if("Quaternion"===V)return A&&(I[2]*=-1,I[3]*=-1),F.Quaternion.LI(I);if("oI"===V)return new B.oI(I[0],I[1],I[2]);if("GH"===V)return new B.GH(I[0],I[1],I[2],I[3]);throw new Error(`Unknown vector class name ${V}`)}(G,P.value);else if(function(V){return"AnimationGroup"===V}(G)){const V=b.animationGroups.filter((V=>V.name===P.name));J=1===V.length?V[0]:V.find((V=>V.uniqueId===P.uniqueId))}else J="Matrix"===G?F.Matrix.LI(P.value):"Matrix2D"===G?new H.d(P.value):"Matrix3D"===G?new H.e(P.value):"FlowGraphInteger"===G?E.e.FromValue(P.value):"number"===G||"string"===G||"boolean"===G?P.value[0]:P&&void 0!==P.value?P.value:Array.isArray(P)?P.reduce(((V,I)=>I.eventData?(V[I.id]={type:(0,Y.P)(I.type)},"undefined"!==typeof I.value&&(V[I.id].value=X("value",I,A,b)),V):V),{}):P;return J}function P(V){return"FlowGraphJsonPointerParserBlock"===V}},12989:(V,I,A)=>{"use strict";function B(V,I){return!(!V.parent||V.parent!==I&&!B(V.parent,I))}function F(V){if(V.getClassName)return V.getClassName()}function E(V,I){return V===I&&("Vector2"===V||"tI"===V||"Vector4"===V||"Quaternion"===V)}function Y(V,I){return V===I&&("Matrix"===V||"Matrix2D"===V||"Matrix3D"===V)}function H(V,I){return"FlowGraphInteger"===V&&"FlowGraphInteger"===I}function c(V,I){const A="number"===typeof V||"number"===typeof(null===V||void 0===V?void 0:V.value);return A&&!I?!isNaN(b(V)):A}function b(V){return"number"===typeof V?V:V.value}A.d(I,{e:()=>H,h:()=>Y,j:()=>E,n:()=>F,p:()=>B,s:()=>b,u:()=>c})},12405:(V,I,A)=>{"use strict";A.r(I),A.d(I,{SceneInstrumentation:()=>E});var B=A(11052),F=A(11447);class E{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(V){V!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=V,V?(this._onBeforeActiveMeshesEvaluationObserver=this.WI.onBeforeActiveMeshesEvaluationObservable.add((()=>{B.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.WI.onAfterActiveMeshesEvaluationObservable.add((()=>{B.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.WI.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.WI.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(V){V!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=V,V?(this._onBeforeRenderTargetsRenderObserver=this.WI.onBeforeRenderTargetsRenderObservable.add((()=>{B.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.WI.onAfterRenderTargetsRenderObservable.add((()=>{B.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.WI.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.WI.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(V){V!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=V,V?(this._onBeforeParticlesRenderingObserver=this.WI.onBeforeParticlesRenderingObservable.add((()=>{B.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.WI.onAfterParticlesRenderingObservable.add((()=>{B.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.WI.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.WI.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(V){V!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=V,this.WI.spriteManagers&&(V?(this._onBeforeSpritesRenderingObserver=this.WI.onBeforeSpritesRenderingObservable.add((()=>{B.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.WI.onAfterSpritesRenderingObservable.add((()=>{B.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.WI.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.WI.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(V){V!==this._capturePhysicsTime&&this.WI.onBeforePhysicsObservable&&(this._capturePhysicsTime=V,V?(this._onBeforePhysicsObserver=this.WI.onBeforePhysicsObservable.add((()=>{B.Tools.StartPerformanceCounter("Ec"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.WI.onAfterPhysicsObservable.add((()=>{B.Tools.EndPerformanceCounter("Ec"),this._physicsTime.endMonitoring()}))):(this.WI.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.WI.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(V){V!==this._captureAnimationsTime&&(this._captureAnimationsTime=V,V?this._onAfterAnimationsObserver=this.WI.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.WI.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(V){this._captureFrameTime=V}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(V){this._captureInterFrameTime=V}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(V){V!==this._captureRenderTime&&(this._captureRenderTime=V,V?(this._onBeforeDrawPhaseObserver=this.WI.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),B.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.WI.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),B.Tools.EndPerformanceCounter("Main render")}))):(this.WI.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.WI.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(V){V!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=V,V?(this._onBeforeCameraRenderObserver=this.WI.onBeforeCameraRenderObservable.add((V=>{this._cameraRenderTime.beginMonitoring(),B.Tools.StartPerformanceCounter(`Rendering camera ${V.name}`)})),this._onAfterCameraRenderObserver=this.WI.onAfterCameraRenderObservable.add((V=>{this._cameraRenderTime.endMonitoring(!1),B.Tools.EndPerformanceCounter(`Rendering camera ${V.name}`)}))):(this.WI.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.WI.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.WI.getEngine()._drawCalls}constructor(V){this.WI=V,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new F.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new F.d,this._captureFrameTime=!1,this._frameTime=new F.d,this._captureRenderTime=!1,this._renderTime=new F.d,this._captureInterFrameTime=!1,this._interFrameTime=new F.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new F.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new F.d,this._capturePhysicsTime=!1,this._physicsTime=new F.d,this._captureAnimationsTime=!1,this._animationsTime=new F.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new F.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=V.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(B.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.WI.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=V.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(B.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ZY(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ZY(),this._captureParticlesRenderTime&&this._particlesRenderTime.ZY(),this._captureSpritesRenderTime&&this._spritesRenderTime.ZY(),this._captureRenderTime&&this._renderTime.ZY(),this._captureCameraRenderTime&&this._cameraRenderTime.ZY()}))}dispose(){this._disposed||(this.WI.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.WI.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.WI.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.WI.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.WI.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.WI.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.WI.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.WI.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.WI.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.WI.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.WI.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.WI.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.WI.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.WI.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.WI.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.WI.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.WI.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.WI=null,this._disposed=!0)}}},12940:(V,I,A)=>{"use strict";A.d(I,{e:()=>X});var B=A(11213),F=A(11222),E=A(11231),Y=A(11666),H=A(11803),c=A(11856),b=A(11189);Y.b.AddNodeConstructor("Light_Type_1",((V,I)=>()=>new X(V,E.tI.Zero(),I)));class X extends c.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(V){this._shadowFrustumSize=V,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(V){this._shadowOrthoScale=V,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(V){this._orthoLeft=V}get orthoRight(){return this._orthoRight}set orthoRight(V){this._orthoRight=V}get orthoTop(){return this._orthoTop}set orthoTop(V){this._orthoTop=V}get orthoBottom(){return this._orthoBottom}set orthoBottom(V){this._orthoBottom=V}constructor(V,I,A){super(V,A),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=I.scale(-1),this.direction=I}getClassName(){return"Yc"}getTypeID(){return H.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(V,I,A){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(V):this._setDefaultAutoExtendShadowProjectionMatrix(V,I,A)}_setDefaultFixedFrustumShadowProjectionMatrix(V){const I=this.sV().activeCamera;I&&E.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:I.FH,void 0!==this.shadowMaxZ?this.shadowMaxZ:I.maxZ,V,this.sV().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(V,I,A){const B=this.sV().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const V=E.tI.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let B=Number.MAX_VALUE,F=-Number.MAX_VALUE;for(let Y=0;Y<A.length;Y++){const H=A[Y];if(!H)continue;const c=H.getBoundingInfo().boundingBox;for(let A=0;A<c.vectorsWorld.length;A++)E.tI.TransformCoordinatesToRef(c.vectorsWorld[A],I,V),V.x<this._orthoLeft&&(this._orthoLeft=V.x),V.y<this._orthoBottom&&(this._orthoBottom=V.y),V.x>this._orthoRight&&(this._orthoRight=V.x),V.y>this._orthoTop&&(this._orthoTop=V.y),this.autoCalcShadowZBounds&&(V.z<B&&(B=V.z),V.z>F&&(F=V.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=B,this._shadowMaxZ=F)}const F=this._orthoRight-this._orthoLeft,Y=this._orthoTop-this._orthoBottom,H=void 0!==this.shadowMinZ?this.shadowMinZ:(null===B||void 0===B?void 0:B.FH)||0,c=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===B||void 0===B?void 0:B.maxZ)||1e4,b=this.sV().getEngine().useReverseDepthBuffer;E.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-F*this.shadowOrthoScale,this._orthoRight+F*this.shadowOrthoScale,this._orthoBottom-Y*this.shadowOrthoScale,this._orthoTop+Y*this.shadowOrthoScale,b?c:H,b?H:c,V,this.sV().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(V,I){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,I),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,I),this)}transferToNodeMaterialEffect(V,I){return this.computeTransformedInformation()?(V.setFloat3(I,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(V.setFloat3(I,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(V){const I=this._scene.getEngine();return!I.useReverseDepthBuffer&&I.isNDCHalfZRange?0:1}getDepthMaxZ(V){const I=this._scene.getEngine();return I.useReverseDepthBuffer&&I.isNDCHalfZRange?0:1}prepareLightSpecificDefines(V,I){V["DIRLIGHT"+I]=!0}}(0,B.b)([(0,F.A)()],X.prototype,"shadowFrustumSize",null),(0,B.b)([(0,F.A)()],X.prototype,"shadowOrthoScale",null),(0,B.b)([(0,F.A)()],X.prototype,"autoUpdateExtends",void 0),(0,B.b)([(0,F.A)()],X.prototype,"autoCalcShadowZBounds",void 0),(0,B.b)([(0,F.A)("orthoLeft")],X.prototype,"_orthoLeft",void 0),(0,B.b)([(0,F.A)("orthoRight")],X.prototype,"_orthoRight",void 0),(0,B.b)([(0,F.A)("orthoTop")],X.prototype,"_orthoTop",void 0),(0,B.b)([(0,F.A)("orthoBottom")],X.prototype,"_orthoBottom",void 0),(0,b.e)("BABYLON.DirectionalLight",X)},13391:(V,I,A)=>{"use strict";A.d(I,{d:()=>X});var B=A(11213),F=A(11222),E=A(11231),Y=A(11276),H=A(11666),c=A(11803),b=A(11189);H.b.AddNodeConstructor("Light_Type_3",((V,I)=>()=>new X(V,E.tI.Zero(),I)));class X extends c.c{constructor(V,I,A){super(V,A),this.groundColor=new Y.oI(0,0,0),this.direction=I||E.tI.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Hc"}setDirectionToTarget(V){return this.direction=E.tI.Normalize(V.uI(E.tI.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(V,I){const A=E.tI.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",A.x,A.y,A.z,0,I),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.uH),I),this}transferToNodeMaterialEffect(V,I){const A=E.tI.Normalize(this.direction);return V.setFloat3(I,A.x,A.y,A.z),this}YH(){return this._worldMatrix||(this._worldMatrix=E.Matrix.Identity()),this._worldMatrix}getTypeID(){return c.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(V,I){V["HEMILIGHT"+I]=!0}}(0,B.b)([(0,F.j)()],X.prototype,"groundColor",void 0),(0,B.b)([(0,F.w)()],X.prototype,"direction",void 0),(0,b.e)("BABYLON.HemisphericLight",X)},12910:(V,I,A)=>{"use strict";A.d(I,{d:()=>P});var B=A(11213),F=A(11222),E=A(11231),Y=A(11666),H=A(11803),c=A(11856),b=A(11207),X=A(11189);Y.b.AddNodeConstructor("Light_Type_2",((V,I)=>()=>new P(V,E.tI.Zero(),E.tI.Zero(),0,0,I)));class P extends c.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(V){this._iesProfileTexture!==V&&(this._iesProfileTexture=V,this._iesProfileTexture&&P._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(V){this._angle=V,this._cosHalfAngle=Math.cos(.5*V),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(V){this._innerAngle=V,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(V){this._shadowAngleScale=V,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(V){this._projectionTextureLightNear=V,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(V){this._projectionTextureLightFar=V,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(V){this._projectionTextureUpDirection=V,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(V){this._projectionTexture!==V&&(this._projectionTexture=V,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(P._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):P._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(V){return void 0!==V.onGeneratedObservable}static _IsTexture(V){return void 0!==V.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(V){this._projectionTextureProjectionLightMatrix=V,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(V,I,A,B,F,Y){super(V,Y),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=E.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=E.tI.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=E.tI.Zero(),this._projectionTextureViewLightMatrix=E.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=E.Matrix.Zero(),this._projectionTextureScalingMatrix=E.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=I,this.direction=A,this.angle=B,this.exponent=F}getClassName(){return"SpotLight"}getTypeID(){return H.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(V){super._setDirection(V),this._projectionTextureViewLightDirty=!0}_setPosition(V){super._setPosition(V),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(V,I,A){const B=this.sV().activeCamera;if(!B)return;this._shadowAngleScale=this._shadowAngleScale||1;const F=this._shadowAngleScale*this._angle,Y=void 0!==this.shadowMinZ?this.shadowMinZ:B.FH,H=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,c=this.sV().getEngine().useReverseDepthBuffer;E.Matrix.PerspectiveFovLHToRef(F,1,c?H:Y,c?Y:H,V,!0,this._scene.getEngine().isNDCHalfZRange,void 0,c)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),E.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const V=this.projectionTextureLightFar,I=this.projectionTextureLightNear,A=V/(V-I),B=-A*I,F=1/Math.tan(this._angle/2);E.Matrix.FromValuesToRef(F/1,0,0,0,0,F,0,0,0,0,A,1,0,0,B,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof b.e){const V=this._projectionTexture.uScale/2,I=this._projectionTexture.vScale/2;E.Matrix.FromValuesToRef(V,0,0,0,0,I,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(V,I){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),V.setMatrix("textureProjectionMatrix"+I,this._projectionTextureMatrix),V.setTexture("projectionLightTexture"+I,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&V.setTexture("iesLightTexture"+I,this._iesProfileTexture),this}transferToEffect(V,I){let A;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,I),A=E.tI.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,I),A=E.tI.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",A.x,A.y,A.z,this._cosHalfAngle,I),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,I),this}transferToNodeMaterialEffect(V,I){let A;return A=this.computeTransformedInformation()?E.tI.Normalize(this.transformedDirection):E.tI.Normalize(this.direction),this.sV().useRightHandedSystem?V.setFloat3(I,-A.x,-A.y,-A.z):V.setFloat3(I,A.x,A.y,A.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(V){const I=this._scene.getEngine(),A=void 0!==this.shadowMinZ?this.shadowMinZ:(null===V||void 0===V?void 0:V.FH)??0;return I.useReverseDepthBuffer&&I.isNDCHalfZRange?A:this._scene.getEngine().isNDCHalfZRange?0:A}getDepthMaxZ(V){const I=this._scene.getEngine(),A=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===V||void 0===V?void 0:V.maxZ)??1e4;return I.useReverseDepthBuffer&&I.isNDCHalfZRange?0:A}prepareLightSpecificDefines(V,I){V["SPOTLIGHT"+I]=!0,V["PROJECTEDLIGHTTEXTURE"+I]=!(!this.projectionTexture||!this.projectionTexture.isReady()),V["IESLIGHTTEXTURE"+I]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,B.b)([(0,F.A)()],P.prototype,"angle",null),(0,B.b)([(0,F.A)()],P.prototype,"innerAngle",null),(0,B.b)([(0,F.A)()],P.prototype,"shadowAngleScale",null),(0,B.b)([(0,F.A)()],P.prototype,"exponent",void 0),(0,B.b)([(0,F.A)()],P.prototype,"projectionTextureLightNear",null),(0,B.b)([(0,F.A)()],P.prototype,"projectionTextureLightFar",null),(0,B.b)([(0,F.A)()],P.prototype,"projectionTextureUpDirection",null),(0,B.b)([(0,F.u)("projectedLightTexture")],P.prototype,"_projectionTexture",void 0),(0,X.e)("BABYLON.SpotLight",P)},12623:(V,I,A)=>{"use strict";A.d(I,{b:()=>Y,c:()=>E,f:()=>H});const B={},F={};function E(V,I){B[V]=I}function Y(V,I){F[V]=I}function H(V){return F[V]?F[V]:null}},12539:(V,I,A)=>{"use strict";A.d(I,{b:()=>s,c:()=>N});var B,F=A(11052),E=A(11057),Y=A(11473),H=A(11097),c=A(11064),b=A(11718),X=A(11105),P=A(11107),J=A(11194),G=A(11137),w=A(11091);!function(V){V[V.Clean=0]="Clean",V[V.Stop=1]="Stop",V[V.Sync=2]="Sync",V[V.NoSync=3]="NoSync"}(B||(B={}));const t=new E.c,u={};let W=!1;function g(){return u[".babylon"]}function o(V,I){const A=u[V];return A||(c.b.Warn("Unable to find a plugin to load "+V+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),I?g():void 0)}function L(V,I,A){let B="Unable to load from "+(V.rawData?"binary data":V.url);return I?B+=`: ${I}`:A&&(B+=`: ${A}`),B}async function z(V,I,A,B,F,E,Y,H,c){var b;const P="data:"===(J=V.url).substring(0,5)?J.substring(5):null;var J;if(V.rawData&&!Y)throw"When using ArrayBufferView to load data the file extension must be provided.";const W=P||Y?"":function(V){const I=V.indexOf("?");-1!==I&&(V=V.substring(0,I));const A=V.lastIndexOf(".");return V.substring(A,V.length).toLowerCase()}(V.url);let L=Y?o(Y,!0):P?function(V){for(const I in u){const A=u[I].plugin;if(A.canDirectLoad&&A.canDirectLoad(V))return u[I]}return g()}(V.url):o(W,!1);if(!L&&W){if(V.url&&!V.url.startsWith("blob:")){const I=await async function(V,I){const A=I.method||"GET";return await new Promise(((B,F)=>{const E=new w.b;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const V={};if(I.responseHeaders)for(const A of I.responseHeaders)V[A]=E.getResponseHeader(A)||"";B({response:E.response,headerValues:V})}else F(`Unable to fetch data from ${V}. Error code: ${E.status}`)})),E.open(A,V),E.send()}))}(V.url,{method:"HEAD",responseHeaders:["Content-Type"]}),A=I.headerValues?I.headerValues["Content-Type"]:"";A&&(L=function(V){for(const I in u){const A=u[I];if(A.mimeType===V)return A}}(A))}L||(L=g())}if(!L)throw new Error(`No plugin or fallback for ${Y??V.url}`);if(!1===(null===c||void 0===c||null===(b=c[L.plugin.name])||void 0===b?void 0:b.enabled))throw new Error(`The '${L.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(V.rawData&&!L.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(V=>{if(L.plugin.createPlugin){const I=L.plugin.createPlugin(c??{});return I instanceof Promise?(I.then(V).catch((V=>{F("Error instantiating plugin.",V)})),null):(V(I),I)}return V(L.plugin),L.plugin})((c=>{var b;if(!c)throw`The loader plugin corresponding to the '${Y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(t.notifyObservers(c),P&&(c.canDirectLoad&&c.canDirectLoad(V.url)||!(0,X.k)(V.url))){if(c.directLoad){const V=c.directLoad(I,P);V instanceof Promise?V.then((V=>{A(c,V)})).catch((V=>{F("Error in directLoad of _loadData: "+V,V)})):A(c,V)}else A(c,P);return}const J=L.isBinary,w=(V,B)=>{I.H?F("Scene has been disposed"):A(c,V,B)};let u=null,W=!1;null===(b=c.aY)||void 0===b||b.add((()=>{W=!0,u&&(u.abort(),u=null),E()}));const g=()=>{if(W)return;const A=(V,I)=>{F(null===V||void 0===V?void 0:V.statusText,I)};if(!c.loadFile&&V.rawData)throw"Plugin does not support loading ArrayBufferView.";u=c.loadFile?c.loadFile(I,V.rawData||V.file||V.url,V.rootUrl,w,B,J,A,H):I._loadFile(V.file||V.url,w,B,!0,J,A)},o=I.getEngine();let z=o.enableOfflineSupport;if(z){let A=!1;for(const B of I.disableOfflineSupportExceptionRules)if(B.test(V.url)){A=!0;break}z=!A}z&&G.e.OfflineProviderFactory?I.offlineProvider=G.e.OfflineProviderFactory(V.url,g,o.disableManifestCheck):g()}))}function m(V,I){let A,B,E=null,Y=null;if(I)if(I.name)A=`file:${I.name}`,B=I.name,E=I;else if(ArrayBuffer.isView(I))A="",B=(0,J.c)(),Y=I;else if(I.startsWith("data:"))A=I,B="";else if(V){const E=I;if("/"===E.substring(0,1))return F.Tools.Error("Wrong sceneFilename parameter"),null;A=V+E,B=E}else A=I,B=F.Tools.GetFilename(I),V=F.Tools.GetFolderPath(I);else A=V,B=F.Tools.GetFilename(V),V=F.Tools.GetFolderPath(V);return{url:A,rootUrl:V,name:B,file:E,rawData:Y}}function s(V){if("string"===typeof V.extensions){const I=V.extensions;u[I.toLowerCase()]={plugin:V,isBinary:!1}}else{const I=V.extensions,A=Object.keys(I);for(const B of A)u[B.toLowerCase()]={plugin:V,isBinary:I[B].isBinary,mimeType:I[B].mimeType}}}async function e(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.e.LastCreatedScene,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!B)return c.b.Error("No scene available to import mesh to"),null;const G=m(I,A);if(!G)return null;const w={};B.addPendingData(w);const t=()=>{B.removePendingData(w)},u=(V,I)=>{const A=L(G,V,I);Y?Y(B,A,new P.j(A,P.i.SceneLoaderError,I)):c.b.Error(A),t()},W=E?V=>{try{E(V)}catch(I){u("Error in onProgress callback: "+I,I)}}:void 0,g=(V,I,A,E,Y,H,c,b)=>{if(B.importedMeshesFiles.push(G.url),F)try{F(V,I,A,E,Y,H,c,b)}catch(X){u("Error in onSuccess callback: "+X,X)}B.removePendingData(w)};return await z(G,B,((I,A,F)=>{if(I.rewriteRootURL&&(G.rootUrl=I.rewriteRootURL(G.rootUrl,F)),I.importMesh){const F=[],E=[],Y=[];if(!I.importMesh(V,B,A,G.rootUrl,F,E,Y,u))return;B.loadingPluginName=I.name,g(F,E,Y,[],[],[],[],[])}else{I.importMeshAsync(V,B,A,G.rootUrl,W,G.name).then((V=>{B.loadingPluginName=I.name,g(V.meshes,V.XG,V.skeletons,V.animationGroups,V.transformNodes,V.geometries,V.lights,V.spriteManagers)})).catch((V=>{u(V.message,V)}))}}),W,u,t,b,X,J)}async function S(V,I,A,B,F,E,Y,H){return await new Promise(((c,b)=>{try{e(V,I,A,B,((V,I,A,B,F,E,Y,H)=>{c({meshes:V,XG:I,skeletons:A,animationGroups:B,transformNodes:F,geometries:E,lights:Y,spriteManagers:H})}),F,((V,I,A)=>{b(A||new Error(I))}),E,Y,H).catch(b)}catch(P){b(P)}}))}async function Q(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.e.LastCreatedEngine,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};A?await r(V,I,new Y.b(A),B,E,c,b,X,P):F.Tools.Error("No engine available")}async function h(V,I,A,B,F,E,Y){return await new Promise(((H,c)=>{Q(V,I,A,(V=>{H(V)}),B,((V,I,A)=>{c(A||new Error(I))}),F,E,Y)}))}async function r(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.e.LastCreatedScene,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!A)return c.b.Error("No scene available to append to"),null;const G=m(V,I);if(!G)return null;const w={};A.addPendingData(w);const t=()=>{A.removePendingData(w)};b.b.ShowLoadingScreen&&!W&&(W=!0,A.getEngine().displayLoadingUI(),A.executeWhenReady((()=>{A.getEngine().hideLoadingUI(),W=!1})));const u=(V,I)=>{const B=L(G,V,I);E?E(A,B,new P.j(B,P.i.SceneLoaderError,I)):c.b.Error(B),t()},g=F?V=>{try{F(V)}catch(I){u("Error in onProgress callback",I)}}:void 0,o=()=>{if(B)try{B(A)}catch(V){u("Error in onSuccess callback",V)}A.removePendingData(w)};return await z(G,A,((V,I)=>{if(V.load){if(!V.load(A,I,G.rootUrl,u))return;A.loadingPluginName=V.name,o()}else{V.loadAsync(A,I,G.rootUrl,g,G.name).then((()=>{A.loadingPluginName=V.name,o()})).catch((V=>{u(V.message,V)}))}}),g,u,t,Y,X,J)}async function M(V,I,A,B,F,E,Y){return await new Promise(((H,c)=>{try{r(V,I,A,(V=>{H(V)}),B,((V,I,A)=>{c(A||new Error(I))}),F,E,Y).catch(c)}catch(P){c(P)}}))}async function x(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.e.LastCreatedScene,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!A)return c.b.Error("No scene available to load asset container to"),null;const J=m(V,I);if(!J)return null;const G={};A.addPendingData(G);const w=()=>{A.removePendingData(G)},t=(V,I)=>{const B=L(J,V,I);E?E(A,B,new P.j(B,P.i.SceneLoaderError,I)):c.b.Error(B),w()},u=F?V=>{try{F(V)}catch(I){t("Error in onProgress callback",I)}}:void 0,W=V=>{if(B)try{B(V)}catch(I){t("Error in onSuccess callback",I)}A.removePendingData(G)};return await z(J,A,((V,I)=>{if(V.loadAssetContainer){const B=V.loadAssetContainer(A,I,J.rootUrl,t);if(!B)return;B.populateRootNodes(),A.loadingPluginName=V.name,W(B)}else if(V.loadAssetContainerAsync){V.loadAssetContainerAsync(A,I,J.rootUrl,u,J.name).then((I=>{I.populateRootNodes(),A.loadingPluginName=V.name,W(I)})).catch((V=>{t(V.message,V)}))}else t("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),u,t,w,Y,b,X)}async function f(V,I,A,B,F,E,Y){return await new Promise(((H,c)=>{try{x(V,I,A,(V=>{H(V)}),B,((V,I,A)=>{c(A||new Error(I))}),F,E,Y).catch(c)}catch(P){c(P)}}))}async function R(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.e.LastCreatedScene,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,J=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",G=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!A)return void c.b.Error("No scene available to load animations to");if(B){for(const B of A.animatables)B.reset();A.stopAllAnimations();const V=A.animationGroups.slice();for(const A of V)A.dispose();const I=A.getNodes();for(const A of I)A.animations&&(A.animations=[])}else switch(F){case 0:const V=A.animationGroups.slice();for(const I of V)I.dispose();break;case 1:for(const I of A.animationGroups)I.stop();break;case 2:for(const I of A.animationGroups)I.reset(),I.restart();break;case 3:break;default:return void c.b.Error("Unknown animation group loading mode value '"+F+"'")}const w=A.animatables.length;await x(V,I,A,(V=>{V.mergeAnimationsTo(A,A.animatables.slice(w),E),V.dispose(),A.onAnimationFileImportedObservable.notifyObservers(A),Y&&Y(A)}),b,X,P,J,G)}async function q(V,I,A,B,F,E,Y,H,c,b){return await new Promise(((X,J)=>{try{R(V,I,A,B,F,E,(V=>{X(V)}),Y,((V,I,A)=>{J(A||new Error(I))}),H,c,b).catch(J)}catch(P){J(P)}}))}class N{static get ForceFullSceneLoadingForIncremental(){return b.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(V){b.b.ForceFullSceneLoadingForIncremental=V}static get ShowLoadingScreen(){return b.b.ShowLoadingScreen}static set ShowLoadingScreen(V){b.b.ShowLoadingScreen=V}static get loggingLevel(){return b.b.loggingLevel}static set loggingLevel(V){b.b.loggingLevel=V}static get CleanBoneMatrixWeights(){return b.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(V){b.b.CleanBoneMatrixWeights=V}static GetDefaultPlugin(){return g()}static GetPluginForExtension(V){var I;return null===(I=o(V,!0))||void 0===I?void 0:I.plugin}static IsPluginForExtensionAvailable(V){return function(V){return!!u[V]}(V)}static RegisterPlugin(V){s(V)}static ImportMesh(V,I,A,B,F,E,Y,c,b){e(V,I,A,B,F,E,Y,c,b).catch((V=>null===Y||void 0===Y?void 0:Y(H.e.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async ImportMeshAsync(V,I,A,B,F,E,Y){return await S(V,I,A,B,F,E,Y)}static Load(V,I,A,B,F,E,Y,c){Q(V,I,A,B,F,E,Y,c).catch((V=>null===E||void 0===E?void 0:E(H.e.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async LoadAsync(V,I,A,B,F,E){return await h(V,I,A,B,F,E)}static Append(V,I,A,B,F,E,Y,c){r(V,I,A,B,F,E,Y,c).catch((V=>null===E||void 0===E?void 0:E(A??H.e.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async AppendAsync(V,I,A,B,F,E){return await M(V,I,A,B,F,E)}static LoadAssetContainer(V,I,A,B,F,E,Y,c){x(V,I,A,B,F,E,Y,c).catch((V=>null===E||void 0===E?void 0:E(A??H.e.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async LoadAssetContainerAsync(V,I,A,B,F,E){return await f(V,I,A,B,F,E)}static ImportAnimations(V,I,A,B,F,E,Y,c,b,X,P){R(V,I,A,B,F,E,Y,c,b,X,P).catch((V=>null===b||void 0===b?void 0:b(A??H.e.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async ImportAnimationsAsync(V,I,A,B,F,E,Y,H,c,b,X){return await q(V,I,A,B,F,E,H,b,X)}}N.NO_LOGGING=0,N.MINIMAL_LOGGING=1,N.SUMMARY_LOGGING=2,N.DETAILED_LOGGING=3,N.OnPluginActivatedObservable=t},12930:(V,I,A)=>{"use strict";A.d(I,{b:()=>J});var B=A(11213),F=A(11222),E=A(11052),Y=A(11231),H=A(11251),c=A(11207),b=A(11189),X=A(11057),P=A(11265);A(12932);class J extends H.b{set boundingBoxSize(V){if(this._boundingBoxSize&&this._boundingBoxSize.equals(V))return;this._boundingBoxSize=V;const I=this.sV();I&&I.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(V){this._rotationY=V,this.setReflectionTextureMatrix(Y.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(V,I,A){let B="";for(const F of V)B+=F;return new J(B,I,null,A,V)}static CreateFromPrefilteredData(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const F=I.useDelayedTextureLoading;I.useDelayedTextureLoading=!1;const E=new J(V,I,null,!1,null,null,null,void 0,!0,A,B);return I.useDelayedTextureLoading=F,E}constructor(V,I){var A;let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,J=arguments.length>8&&void 0!==arguments[8]&&arguments[8],G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,w=arguments.length>10&&void 0!==arguments[10]&&arguments[10],t=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,W=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0;super(I),this.onLoadObservable=new X.c,this.boundingBoxPosition=Y.tI.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Y.Matrix,this._buffer=null,this.name=V,this.url=V,this._noMipmap=F,this.BH=!1,this.isCube=!0,this._textureMatrix=Y.Matrix.Identity(),this.coordinatesMode=c.e.CUBIC_MODE;let o=null,L=null;null===B||Array.isArray(B)?(this._noMipmap=F,this._format=P,this._createPolynomials=w,o=B,this._loaderOptions=W,this._useSRGBBuffer=g,this._lodScale=t,this._lodOffset=u):(o=B.extensions??null,this._noMipmap=B.noMipmap??!1,E=B.files??null,L=B.buffer??null,this._format=B.format??5,J=B.prefiltered??!1,G=B.forcedExtension??null,this._createPolynomials=B.createPolynomials??!1,this._lodScale=B.lodScale??.8,this._lodOffset=B.lodOffset??0,this._loaderOptions=B.loaderOptions,this._useSRGBBuffer=B.useSRGBBuffer,H=B.O??null,b=B.onError??null),(V||E)&&this.updateURL(V,G,H,J,b,o,null===(A=this.sV())||void 0===A?void 0:A.useDelayedTextureLoading,E,L)}getClassName(){return"CubeTexture"}updateURL(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=V),this.url=V,I&&(this._forcedExtension=I);const b=V.lastIndexOf("."),X=I||(b>-1?V.substring(b).toLowerCase():""),P=0===X.indexOf(".dds"),J=0===X.indexOf(".env"),G=0===X.indexOf(".basis");if(J?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=B,B&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),H)this._files=H;else if(G||J||P||E||(E=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,E){for(let I=0;I<E.length;I++)this._files.push(V+E[I]);this._extensions=E}this._buffer=c,Y?(this.delayLoadState=4,this._delayedOnLoad=A,this._delayedOnError=F):this._loadTexture(A,F)}delayLoad(V){4===this.delayLoadState&&(V&&(this._forcedExtension=V),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(V){var I,A;if(V.updateFlag===this._textureMatrix.updateFlag)return;V.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(A=this.sV())||void 0===A||A.markAllMaterialsAsDirty(1,(V=>-1!==V.getActiveTextures().indexOf(this))));if(this._textureMatrix=V,null===(I=this.sV())||void 0===I||!I.useRightHandedSystem)return;const B=Y.TmpVectors.tI[0],F=Y.TmpVectors.Quaternion[0],E=Y.TmpVectors.tI[1];this._textureMatrix.decompose(B,F,E),F.z*=-1,F.w*=-1,Y.Matrix.ComposeToRef(B,F,E,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var V;return null!==(V=this.sV())&&void 0!==V&&V.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=this.sV(),B=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const F=()=>{var I;(this.onLoadObservable.notifyObservers(this),B)&&(B.dispose(),null===(I=this.sV())||void 0===I||I.markAllMaterialsAsDirty(1));V&&V()},Y=(V,A)=>{this._loadingError=!0,this._errorObject={message:V,exception:A},I&&I(V,A),c.e.OnTextureLoadErrorObservable.notifyObservers(this)};var H;this._texture?this._texture.isReady?E.Tools.SetImmediate((()=>F())):this._texture.onLoadedObservable.add((()=>F())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,A,this._lodScale,this._lodOffset,V,Y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,A,this._files,this._noMipmap,V,Y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(H=this._texture)||void 0===H||H.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(V,I,A){const B=P.b.Parse((()=>{let B=!1;return V.prefiltered&&(B=V.prefiltered),new J(A+(V.url??V.name),I,V.extensions,!1,V.files||null,null,null,void 0,B,V.forcedExtension)}),V,I);if(V.boundingBoxPosition&&(B.boundingBoxPosition=Y.tI.LI(V.boundingBoxPosition)),V.boundingBoxSize&&(B.boundingBoxSize=Y.tI.LI(V.boundingBoxSize)),V.animations)for(let F=0;F<V.animations.length;F++){const I=V.animations[F],A=(0,b.b)("BABYLON.Animation");A&&B.animations.push(A.Parse(I))}return B}clone(){let V=0;const I=P.b.Clone((()=>{const I=new J(this.url,this.sV()||this._getEngine(),this._extensions,this._noMipmap,this._files);return V=I.uniqueId,I}),this);return I.uniqueId=V,I}}(0,B.b)([(0,F.A)()],J.prototype,"url",void 0),(0,B.b)([(0,F.w)()],J.prototype,"boundingBoxPosition",void 0),(0,B.b)([(0,F.w)()],J.prototype,"boundingBoxSize",null),(0,B.b)([(0,F.A)("rotationY")],J.prototype,"rotationY",null),(0,B.b)([(0,F.A)("files")],J.prototype,"_files",void 0),(0,B.b)([(0,F.A)("forcedExtension")],J.prototype,"_forcedExtension",void 0),(0,B.b)([(0,F.A)("extensions")],J.prototype,"_extensions",void 0),(0,B.b)([(0,F.p)("textureMatrix")],J.prototype,"_textureMatrix",void 0),(0,B.b)([(0,F.p)("textureMatrixRefraction")],J.prototype,"_textureMatrixRefraction",void 0),c.e._CubeTextureParser=J.Parse,(0,b.e)("BABYLON.CubeTexture",J)},13402:(V,I,A)=>{"use strict";A.d(I,{b:()=>c});var B=A(11064),F=A(11207),E=A(11196),Y=A(11363),H=A(11167);Y.ThinEngine.prototype.createDynamicTexture=function(V,I,A,B){const F=new H.d(this,4);return F.baseWidth=V,F.baseHeight=I,A&&(V=this.needPOTTextures?(0,E.e)(V,this._caps.maxTextureSize):V,I=this.needPOTTextures?(0,E.e)(I,this._caps.maxTextureSize):I),F.width=V,F.height=I,F.isReady=!1,F.generateMipMaps=A,F.samplingMode=B,this.updateTextureSamplingMode(B,F),this._internalTexturesCache.push(F),F},Y.ThinEngine.prototype.updateDynamicTexture=function(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!V)return;const Y=this._gl,H=Y.TEXTURE_2D,c=this._bindTextureDirectly(H,V,!0,E);this._unpackFlipY(void 0===A?V.invertY:A),B&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const b=this._getWebGLTextureType(V.type),X=this._getInternalFormat(F||V.format),P=this._getRGBABufferInternalSizedFormat(V.type,X);Y.texImage2D(H,0,P,X,b,I),V.generateMipMaps&&Y.generateMipmap(H),c||this._bindTextureDirectly(H,null),B&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),F&&(V.format=F),V._dynamicTextureSource=I,V._premulAlpha=B,V.invertY=A||!1,V.isReady=!0};class c extends F.e{constructor(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,H=arguments.length>6?arguments[6]:void 0;const c=!A||A._isScene;super(null,c?A:null===A||void 0===A?void 0:A.WI,c?!B:A,H,E,void 0,void 0,void 0,void 0,Y),this.name=V,this.wrapU=F.e.CLAMP_ADDRESSMODE,this.wrapV=F.e.CLAMP_ADDRESSMODE,this._generateMipMaps=B;const b=this._getEngine();if(!b)return;if(I.getContext)this._canvas=I,this._ownCanvas=!1,this._texture=b.createDynamicTexture(this._canvas.width,this._canvas.height,B,E);else{this._canvas=b.createCanvas(1,1),this._ownCanvas=!0;const V=I;V.width||0===V.width?this._texture=b.createDynamicTexture(V.width,V.height,B,E):this._texture=b.createDynamicTexture(I,I,B,E)}const X=this.getSize();this._canvas.width!==X.width&&(this._canvas.width=X.width),this._canvas.height!==X.height&&(this._canvas.height=X.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(V){this._canvas.width=V.width,this._canvas.height=V.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(V.width,V.height,this._generateMipMaps,this.samplingMode)}scale(V){const I=this.getSize();I.width*=V,I.height*=V,this._recreate(I)}scaleTo(V,I){const A=this.getSize();A.width=V,A.height=I,this._recreate(A)}getContext(){return this._context}clear(V){const I=this.getSize();V&&(this._context.fillStyle=V),this._context.clearRect(0,0,I.width,I.height)}update(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===V||V,I,this._format||void 0,void 0,A)}drawText(V,I,A,B,F,E,Y){let H=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const c=this.getSize();if(E&&(this._context.fillStyle=E,this._context.fillRect(0,0,c.width,c.height)),this._context.font=B,null===I||void 0===I){const A=this._context.measureText(V);I=(c.width-A.width)/2}if(null===A||void 0===A){const V=parseInt(B.replace(/\D/g,""));A=c.height/2+V/3.65}this._context.fillStyle=F||"",this._context.fillText(V,I,A),H&&this.update(Y)}dispose(){var V,I;(super.dispose(),this._ownCanvas)&&(null===(V=this._canvas)||void 0===V||null===(I=V.remove)||void 0===I||I.call(V));this._canvas=null,this._context=null}clone(){const V=this.sV();if(!V)return this;const I=this.getSize(),A=new c(this.name,I,V,this._generateMipMaps);return A.BH=this.BH,A.level=this.level,A.wrapU=this.wrapU,A.wrapV=this.wrapV,A}serialize(){const V=this.sV();V&&!V.isReady()&&B.b.Warn("The scene must be ready before serializing the dynamic texture");const I=super.serialize();return c._IsCanvasElement(this._canvas)&&(I.base64String=this._canvas.toDataURL()),I.invertY=this._invertY,I.samplingMode=this.samplingMode,I}static _IsCanvasElement(V){return void 0!==V.toDataURL}_rebuild(){this.update()}}},12832:(V,I,A)=>{"use strict";A.d(I,{d:()=>F});var B=A(11207);class F extends B.e{get depth(){return this._depth}constructor(V,I,A,F,E,Y){let H=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:B.e.TRILINEAR_SAMPLINGMODE,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,P=arguments.length>10?arguments[10]:void 0;super(null,Y,!H,c),this.format=E,this._texture=Y.getEngine().createRawTexture2DArray(V,I,A,F,E,H,c,b,null,X,P),this._depth=F,this.is2DArray=!0}update(V){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,V,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(V,I,A,B,E){return new F(V,I,A,B,5,E,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12637:(V,I,A)=>{"use strict";A.d(I,{b:()=>H,c:()=>c,f:()=>E,h:()=>Y});var B=A(11249),F=A(11231);function E(V,I){return`{X: ${V.x.toFixed(I)} Y: ${V.y.toFixed(I)}}`}function Y(V,I){return`{X: ${V._x.toFixed(I)} Y: ${V._y.toFixed(I)} Z: ${V._z.toFixed(I)}}`}function H(V,I){return 2*Math.acos((0,B.Clamp)(F.Quaternion.Dot(V,I)))}function c(V,I){const A=new F.Quaternion;return function(V,I,A){const E=F.tI.Cross(V,I),Y=Math.acos((0,B.Clamp)(F.tI.Dot(V,I),-1,1));F.Quaternion.RotationAxisToRef(E,Y,A)}(V,I,A),A}},12500:(V,I,A)=>{"use strict";A.d(I,{c:()=>b});var B=A(11231),F=A(11276),E=A(11701),Y=A(11676),H=A(11280);A(12504);function c(V){let I=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const A=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],E=[];let c=[];const b=V.width||V.size||1,X=V.height||V.size||1,P=V.depth||V.size||1,J=V.wrap||!1;let G=void 0===V.topBaseAt?1:V.topBaseAt,w=void 0===V.bottomBaseAt?0:V.bottomBaseAt;G=(G+4)%4,w=(w+4)%4;let t=[2,0,3,1][G],u=[2,0,1,3][w],W=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(J){I=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],W=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let V=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],A=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const B=[17,18,19,16],F=[22,23,20,21];for(;t>0;)V.unshift(V.pop()),B.unshift(B.pop()),t--;for(;u>0;)A.unshift(A.pop()),F.unshift(F.pop()),u--;V=V.flat(),A=A.flat(),W=W.concat(V).concat(A),I.push(B[0],B[2],B[3],B[0],B[1],B[2]),I.push(F[0],F[2],F[3],F[0],F[1],F[2])}const g=[b/2,X/2,P/2];c=W.reduce(((V,I,A)=>V.concat(I*g[A%3])),[]);const o=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,L=V.faceUV||new Array(6),z=V.faceColors,m=[];for(let Y=0;Y<6;Y++)void 0===L[Y]&&(L[Y]=new B.Vector4(0,0,1,1)),z&&void 0===z[Y]&&(z[Y]=new F.GH(1,1,1,1));for(let B=0;B<6;B++)if(E.push(L[B].z,H.b?1-L[B].w:L[B].w),E.push(L[B].x,H.b?1-L[B].w:L[B].w),E.push(L[B].x,H.b?1-L[B].y:L[B].y),E.push(L[B].z,H.b?1-L[B].y:L[B].y),z)for(let V=0;V<4;V++)m.push(z[B].r,z[B].g,z[B].b,z[B].a);Y.e._ComputeSides(o,c,I,A,E,V.frontUVs,V.backUVs);const s=new Y.e;if(s.indices=I,s.SV=c,s.QV=A,s.rV=E,z){const V=o===Y.e.DOUBLESIDE?m.concat(m):m;s.hV=V}return s}function b(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new E.c(V,A);I.sideOrientation=E.c._GetDefaultSideOrientation(I.sideOrientation),B._originalBuilderSideOrientation=I.sideOrientation;return c(I).xV(B,I.updatable),B}Y.e.CreateBox=c,E.c.CreateBox=function(V,I){return b(V,{size:I,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12627:(V,I,A)=>{"use strict";A.d(I,{d:()=>H});var B=A(11701),F=A(11676),E=A(11280);function Y(V){const I=[],A=[],B=[],Y=[],H=V.radius||.5,c=V.tessellation||64,b=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,X=0===V.sideOrientation?0:V.sideOrientation||F.e.DEFAULTSIDE;I.push(0,0,0),Y.push(.5,.5);const P=2*Math.PI*b,J=1===b?P/c:P/(c-1);let G=0;for(let F=0;F<c;F++){const V=Math.cos(G),A=Math.sin(G),B=(V+1)/2,F=(1-A)/2;I.push(H*V,H*A,0),Y.push(B,E.b?1-F:F),G+=J}1===b&&(I.push(I[3],I[4],I[5]),Y.push(Y[2],E.b?1-Y[3]:Y[3]));const w=I.length/3;for(let F=1;F<w-1;F++)A.push(F+1,0,F);F.e.ComputeNormals(I,A,B),F.e._ComputeSides(X,I,A,B,Y,V.frontUVs,V.backUVs);const t=new F.e;return t.indices=A,t.SV=I,t.QV=B,t.rV=Y,t}function H(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new B.c(V,A);I.sideOrientation=B.c._GetDefaultSideOrientation(I.sideOrientation),F._originalBuilderSideOrientation=I.sideOrientation;return Y(I).xV(F,I.updatable),F}F.e.CreateDisc=Y,B.c.CreateDisc=function(V,I,A){return H(V,{radius:I,tessellation:A,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12504:(V,I,A)=>{"use strict";A.d(I,{e:()=>u,c:()=>g,i:()=>W});var B=A(11231),F=A(11276),E=A(11701),Y=A(11676),H=A(11300);E.c._GroundMeshParser=(V,I)=>c.Parse(V,I);class c extends E.c{constructor(V,I){super(V,I),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=V,this._subdivisionsY=V,this.subdivide(V);const A=this;A.createOrUpdateSubmeshesOctree&&A.createOrUpdateSubmeshesOctree(I)}getHeightAtCoordinates(V,I){const A=this.getWorldMatrix(),F=B.TmpVectors.Matrix[5];A.invertToRef(F);const E=B.TmpVectors.tI[8];if(B.tI.TransformCoordinatesFromFloatsToRef(V,0,I,F,E),V=E.x,I=E.z,V<this._minX||V>=this._maxX||I<=this._minZ||I>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(V,I),H=-(Y.x*V+Y.z*I+Y.w)/Y.y;return B.tI.TransformCoordinatesFromFloatsToRef(0,H,0,A,E),E.y}getNormalAtCoordinates(V,I){const A=new B.tI(0,1,0);return this.getNormalAtCoordinatesToRef(V,I,A),A}getNormalAtCoordinatesToRef(V,I,A){const F=this.getWorldMatrix(),E=B.TmpVectors.Matrix[5];F.invertToRef(E);const Y=B.TmpVectors.tI[8];if(B.tI.TransformCoordinatesFromFloatsToRef(V,0,I,E,Y),V=Y.x,I=Y.z,V<this._minX||V>this._maxX||I<this._minZ||I>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const H=this._getFacetAt(V,I);return B.tI.TransformNormalFromFloatsToRef(H.x,H.y,H.z,F,A),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(V,I){const A=Math.floor((V+this._maxX)*this._subdivisionsX/this._width),B=Math.floor(-(I+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),F=this._heightQuads[B*this._subdivisionsX+A];let E;return E=I<F.slope.x*V+F.slope.y?F.facet1:F.facet2,E}_initHeightQuads(){const V=this._subdivisionsX,I=this._subdivisionsY;this._heightQuads=[];for(let A=0;A<I;A++)for(let I=0;I<V;I++){const F={slope:B.Vector2.Zero(),facet1:new B.Vector4(0,0,0,0),facet2:new B.Vector4(0,0,0,0)};this._heightQuads[A*V+I]=F}return this}_computeHeightQuads(){const V=this.getVerticesData(H.g.PositionKind);if(!V)return this;const I=B.TmpVectors.tI[3],A=B.TmpVectors.tI[2],F=B.TmpVectors.tI[1],E=B.TmpVectors.tI[0],Y=B.TmpVectors.tI[4],c=B.TmpVectors.tI[5],b=B.TmpVectors.tI[6],X=B.TmpVectors.tI[7],P=B.TmpVectors.tI[8];let J=0,G=0,w=0,t=0,u=0,W=0,g=0;const o=this._subdivisionsX,L=this._subdivisionsY;for(let H=0;H<L;H++)for(let L=0;L<o;L++){J=3*L,G=H*(o+1)*3,w=(H+1)*(o+1)*3,I.x=V[G+J],I.y=V[G+J+1],I.z=V[G+J+2],A.x=V[G+J+3],A.y=V[G+J+4],A.z=V[G+J+5],F.x=V[w+J],F.y=V[w+J+1],F.z=V[w+J+2],E.x=V[w+J+3],E.y=V[w+J+4],E.z=V[w+J+5],t=(E.z-I.z)/(E.x-I.x),u=I.z-t*I.x,A.subtractToRef(I,Y),F.subtractToRef(I,c),E.subtractToRef(I,b),B.tI.CrossToRef(b,c,X),B.tI.CrossToRef(Y,b,P),X.normalize(),P.normalize(),W=-(X.x*I.x+X.y*I.y+X.z*I.z),g=-(P.x*A.x+P.y*A.y+P.z*A.z);const z=this._heightQuads[H*o+L];z.slope.XH(t,u),z.facet1.XH(X.x,X.y,X.z,W),z.facet2.XH(P.x,P.y,P.z,g)}return this}serialize(V){super.serialize(V),V.subdivisionsX=this._subdivisionsX,V.subdivisionsY=this._subdivisionsY,V.minX=this._minX,V.maxX=this._maxX,V.FH=this._minZ,V.maxZ=this._maxZ,V.width=this._width,V.height=this._height}static Parse(V,I){const A=new c(V.name,I);return A._subdivisionsX=V.subdivisionsX||1,A._subdivisionsY=V.subdivisionsY||1,A._minX=V.minX,A._maxX=V.maxX,A._minZ=V.FH,A._maxZ=V.maxZ,A._width=V.width,A._height=V.height,A}}var b=A(11052),X=A(11097),P=A(11237),J=A(11280);function G(V){const I=[],A=[],F=[],E=[];let H,c;const b=V.width||V.size||1,X=V.height||V.size||1,P=0|(V.subdivisionsX||V.subdivisions||1),G=0|(V.subdivisionsY||V.subdivisions||1);for(H=0;H<=G;H++)for(c=0;c<=P;c++){const V=new B.tI(c*b/P-b/2,0,(G-H)*X/G-X/2),I=new B.tI(0,1,0);A.push(V.x,V.y,V.z),F.push(I.x,I.y,I.z),E.push(c/P,J.b?H/G:1-H/G)}for(H=0;H<G;H++)for(c=0;c<P;c++)I.push(c+1+(H+1)*(P+1)),I.push(c+1+H*(P+1)),I.push(c+H*(P+1)),I.push(c+(H+1)*(P+1)),I.push(c+1+(H+1)*(P+1)),I.push(c+H*(P+1));const w=new Y.e;return w.indices=I,w.SV=A,w.QV=F,w.rV=E,w}function w(V){const I=void 0!==V.xmin&&null!==V.xmin?V.xmin:-1,A=void 0!==V.zmin&&null!==V.zmin?V.zmin:-1,F=void 0!==V.xmax&&null!==V.xmax?V.xmax:1,E=void 0!==V.zmax&&null!==V.zmax?V.zmax:1,H=V.subdivisions||{w:1,h:1},c=V.precision||{w:1,h:1},b=[],X=[],P=[],J=[];let G,w,t,u;H.h=H.h<1?1:H.h,H.w=H.w<1?1:H.w,c.w=c.w<1?1:c.w,c.h=c.h<1?1:c.h;const W=(F-I)/H.w,g=(E-A)/H.h;function o(V,I,A,F){const E=X.length/3,Y=c.w+1;for(G=0;G<c.h;G++)for(w=0;w<c.w;w++){const V=[E+w+G*Y,E+(w+1)+G*Y,E+(w+1)+(G+1)*Y,E+w+(G+1)*Y];b.push(V[1]),b.push(V[2]),b.push(V[3]),b.push(V[0]),b.push(V[1]),b.push(V[3])}const H=B.tI.Zero(),t=new B.tI(0,1,0);for(G=0;G<=c.h;G++)for(H.z=G*(F-I)/c.h+I,w=0;w<=c.w;w++)H.x=w*(A-V)/c.w+V,H.y=0,X.push(H.x,H.y,H.z),P.push(t.x,t.y,t.z),J.push(w/c.w,G/c.h)}for(t=0;t<H.h;t++)for(u=0;u<H.w;u++)o(I+u*W,A+t*g,I+(u+1)*W,A+(t+1)*g);const L=new Y.e;return L.indices=b,L.SV=X,L.QV=P,L.rV=J,L}function t(V){const I=[],A=[],E=[],H=[];let c,b;const X=V.colorFilter||new F.oI(.3,.59,.11),J=V.alphaFilter||0;let G=!1;if(V.minHeight>V.maxHeight){G=!0;const I=V.maxHeight;V.maxHeight=V.minHeight,V.minHeight=I}for(c=0;c<=V.subdivisions;c++)for(b=0;b<=V.subdivisions;b++){const I=new B.tI(b*V.width/V.subdivisions-V.width/2,0,(V.subdivisions-c)*V.height/V.subdivisions-V.height/2),F=4*(((I.x+V.width/2)/V.width*(V.bufferWidth-1)|0)+((1-(I.z+V.height/2)/V.height)*(V.bufferHeight-1)|0)*V.bufferWidth);let Y=V.buffer[F]/255,w=V.buffer[F+1]/255,t=V.buffer[F+2]/255;const u=V.buffer[F+3]/255;G&&(Y=1-Y,w=1-w,t=1-t);const W=Y*X.r+w*X.g+t*X.b;I.y=u>=J?V.minHeight+(V.maxHeight-V.minHeight)*W:V.minHeight-P.d,V.heightBuffer&&(V.heightBuffer[c*(V.subdivisions+1)+b]=I.y),A.push(I.x,I.y,I.z),E.push(0,0,0),H.push(b/V.subdivisions,1-c/V.subdivisions)}for(c=0;c<V.subdivisions;c++)for(b=0;b<V.subdivisions;b++){const B=b+1+(c+1)*(V.subdivisions+1),F=b+1+c*(V.subdivisions+1),E=b+c*(V.subdivisions+1),Y=b+(c+1)*(V.subdivisions+1),H=A[3*B+1]>=V.minHeight,X=A[3*F+1]>=V.minHeight,P=A[3*E+1]>=V.minHeight;H&&X&&P&&(I.push(B),I.push(F),I.push(E));A[3*Y+1]>=V.minHeight&&H&&P&&(I.push(Y),I.push(B),I.push(E))}Y.e.ComputeNormals(A,I,E);const w=new Y.e;return w.indices=I,w.SV=A,w.QV=E,w.rV=H,w}function u(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const A=new c(V,arguments.length>2?arguments[2]:void 0);A._setReady(!1),A._subdivisionsX=I.subdivisionsX||I.subdivisions||1,A._subdivisionsY=I.subdivisionsY||I.subdivisions||1,A._width=I.width||1,A._height=I.height||1,A._maxX=A._width/2,A._maxZ=A._height/2,A._minX=-A._maxX,A._minZ=-A._maxZ;return G(I).xV(A,I.updatable),A._setReady(!0),A}function W(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new E.c(V,A);return w(I).xV(B,I.updatable),B}function g(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=A.width||10,Y=A.height||10,H=A.subdivisions||1,P=A.minHeight||0,J=A.maxHeight||1,G=A.colorFilter||new F.oI(.3,.59,.11),w=A.alphaFilter||0,u=A.updatable,W=A.onReady;B=B||X.e.LastCreatedScene;const g=new c(V,B);let o;g._subdivisionsX=H,g._subdivisionsY=H,g._width=E,g._height=Y,g._maxX=g._width/2,g._maxZ=g._height/2,g._minX=-g._maxX,g._minZ=-g._maxZ,g._setReady(!1),A.passHeightBufferInCallback&&(o=new Float32Array((H+1)*(H+1)));const L=(V,I,A)=>{t({width:E,height:Y,subdivisions:H,minHeight:P,maxHeight:J,colorFilter:G,buffer:V,bufferWidth:I,bufferHeight:A,alphaFilter:w,heightBuffer:o}).xV(g,u),W&&W(g,o),g._setReady(!0)};if("string"===typeof I){const V=V=>{var I;const A=V.width,F=V.height;if(B.H)return;const E=null===(I=B)||void 0===I?void 0:I.getEngine().resizeImageBitmap(V,A,F);L(E,A,F)};b.Tools.LoadImage(I,V,A.onError?A.onError:()=>{},B.offlineProvider)}else L(I.data,I.width,I.height);return g}Y.e.CreateGround=G,Y.e.CreateTiledGround=w,Y.e.CreateGroundFromHeightMap=t,E.c.CreateGround=(V,I,A,B,F,E)=>u(V,{width:I,height:A,subdivisions:B,updatable:E},F),E.c.CreateTiledGround=(V,I,A,B,F,E,Y,H,c)=>W(V,{xmin:I,zmin:A,xmax:B,zmax:F,subdivisions:E,precision:Y,updatable:c},H),E.c.CreateGroundFromHeightMap=(V,I,A,B,F,E,Y,H,c,b,X)=>g(V,I,{width:A,height:B,subdivisions:F,minHeight:E,maxHeight:Y,updatable:c,onReady:b,alphaFilter:X},H)},13123:(V,I,A)=>{"use strict";A.d(I,{d:()=>G,f:()=>P,i:()=>J});var B=A(11231),F=A(11701),E=A(11676),Y=A(11810),H=A(11300),c=A(11064);function b(V){const I=[],A=[],B=V.lines,F=V.hV,Y=[];let H=0;for(let E=0;E<B.length;E++){const V=B[E];for(let B=0;B<V.length;B++){const{x:c,y:b,z:X}=V[B];if(A.push(c,b,X),F){const V=F[E],{r:I,g:A,b:H,a:c}=V[B];Y.push(I,A,H,c)}B>0&&(I.push(H-1),I.push(H)),H++}}const c=new E.e;return c.indices=I,c.SV=A,F&&(c.hV=Y),c}function X(V){const I=V.dashSize||3,A=V.gapSize||1,F=V.dashNb||200,Y=V.points,H=[],c=[],b=B.tI.Zero();let X=0,P=0,J=0,G=0,w=0,t=0,u=0;for(u=0;u<Y.length-1;u++)Y[u+1].subtractToRef(Y[u],b),X+=b.length();for(J=X/F,G=I*J/(I+A),u=0;u<Y.length-1;u++){Y[u+1].subtractToRef(Y[u],b),P=Math.floor(b.length()/J),b.normalize();for(let V=0;V<P;V++)w=J*V,H.push(Y[u].x+w*b.x,Y[u].y+w*b.y,Y[u].z+w*b.z),H.push(Y[u].x+(w+G)*b.x,Y[u].y+(w+G)*b.y,Y[u].z+(w+G)*b.z),c.push(t,t+1),t+=2}const W=new E.e;return W.SV=H,W.indices=c,W}function P(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=I.instance,F=I.lines,E=I.hV;if(B){const V=B.getVerticesData(H.g.PositionKind);let I,A;E&&(I=B.getVerticesData(H.g.ColorKind));let Y=0,c=0;for(let B=0;B<F.length;B++){const H=F[B];for(let F=0;F<H.length;F++)V[Y]=H[F].x,V[Y+1]=H[F].y,V[Y+2]=H[F].z,E&&I&&(A=E[B],I[c]=A[F].r,I[c+1]=A[F].g,I[c+2]=A[F].b,I[c+3]=A[F].a,c+=4),Y+=3}return B.updateVerticesData(H.g.PositionKind,V,!1,!1),E&&I&&B.updateVerticesData(H.g.ColorKind,I,!1,!1),B.refreshBoundingInfo(),B}const c=!!E,X=new Y.d(V,A,null,void 0,void 0,c,I.useVertexAlpha,I.material);return b(I).xV(X,I.updatable),X}function J(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=I.hV?[I.hV]:null;return P(V,{lines:[I.points],updatable:I.updatable,instance:I.instance,hV:B,useVertexAlpha:I.useVertexAlpha,material:I.material},A)}function G(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=I.points,H=I.instance,b=I.gapSize||1,P=I.dashSize||3;if(H){const V=V=>{const I=B.tI.Zero(),A=V.length/6;let F=0,Y=0,c=0,b=0,X=0,P=0,J=0,G=0;for(J=0;J<E.length-1;J++)E[J+1].subtractToRef(E[J],I),F+=I.length();c=F/A;const w=H._creationDataStorage.dashSize;for(b=w*c/(w+H._creationDataStorage.gapSize),J=0;J<E.length-1;J++)for(E[J+1].subtractToRef(E[J],I),Y=Math.floor(I.length()/c),I.normalize(),G=0;G<Y&&P<V.length;)X=c*G,V[P]=E[J].x+X*I.x,V[P+1]=E[J].y+X*I.y,V[P+2]=E[J].z+X*I.z,V[P+3]=E[J].x+(X+b)*I.x,V[P+4]=E[J].y+(X+b)*I.y,V[P+5]=E[J].z+(X+b)*I.z,P+=6,G++;for(;P<V.length;)V[P]=E[J].x,V[P+1]=E[J].y,V[P+2]=E[J].z,P+=3};return(I.dashNb||I.dashSize||I.gapSize||I.useVertexAlpha||I.material)&&c.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),H.updateMeshPositions(V,!1),H}const J=new Y.d(V,A,null,void 0,void 0,void 0,I.useVertexAlpha,I.material);return X(I).xV(J,I.updatable),J._creationDataStorage=new F.d,J._creationDataStorage.dashSize=P,J._creationDataStorage.gapSize=b,J}E.e.CreateLineSystem=b,E.e.CreateDashedLines=X,F.c.RX=function(V,I){return J(V,{points:I,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},F.c.CreateDashedLines=function(V,I,A,B,F){return G(V,{points:I,dashSize:A,gapSize:B,dashNb:F,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12541:(V,I,A)=>{"use strict";A.d(I,{d:()=>H,g:()=>c});var B=A(11701),F=A(11676),E=A(11280);function Y(V){const I=[],A=[],B=[],Y=[],H=void 0!==V.width?V.width:void 0!==V.size?V.size:1,c=void 0!==V.height?V.height:void 0!==V.size?V.size:1,b=0===V.sideOrientation?0:V.sideOrientation||F.e.DEFAULTSIDE,X=H/2,P=c/2;A.push(-X,-P,0),B.push(0,0,-1),Y.push(0,E.b?1:0),A.push(X,-P,0),B.push(0,0,-1),Y.push(1,E.b?1:0),A.push(X,P,0),B.push(0,0,-1),Y.push(1,E.b?0:1),A.push(-X,P,0),B.push(0,0,-1),Y.push(0,E.b?0:1),I.push(0),I.push(1),I.push(2),I.push(0),I.push(2),I.push(3),F.e._ComputeSides(b,A,I,B,Y,V.frontUVs,V.backUVs);const J=new F.e;return J.indices=I,J.SV=A,J.QV=B,J.rV=Y,J}function H(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new B.c(V,A);I.sideOrientation=B.c._GetDefaultSideOrientation(I.sideOrientation),F._originalBuilderSideOrientation=I.sideOrientation;return Y(I).xV(F,I.updatable),I.sourcePlane&&(F.translate(I.sourcePlane.normal,-I.sourcePlane.d),F.setDirection(I.sourcePlane.normal.scale(-1))),F}const c={NX:H};F.e.NX=Y,B.c.NX=(V,I,A,B,F)=>H(V,{size:I,width:I,height:I,sideOrientation:F,updatable:B},A)},12617:(V,I,A)=>{"use strict";A.d(I,{d:()=>c});var B=A(11231),F=A(11701),E=A(11676),Y=A(11280);function H(V){const I=0|(V.segments||32),A=V.diameterX||V.diameter||1,F=V.diameterY||V.diameter||1,H=V.diameterZ||V.diameter||1,c=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,b=V.slice&&V.slice<=0?1:V.slice||1,X=0===V.sideOrientation?0:V.sideOrientation||E.e.DEFAULTSIDE,P=!!V.dedupTopBottomIndices,J=new B.tI(A/2,F/2,H/2),G=2+I,w=2*G,t=[],u=[],W=[],g=[];for(let E=0;E<=G;E++){const V=E/G,I=V*Math.PI*b;for(let A=0;A<=w;A++){const F=A/w,E=F*Math.PI*2*c,H=B.Matrix.RotationZ(-I),b=B.Matrix.RotationY(E),X=B.tI.TransformCoordinates(B.tI.Up(),H),P=B.tI.TransformCoordinates(X,b),G=P.multiply(J),t=P.divide(J).normalize();u.push(G.x,G.y,G.z),W.push(t.x,t.y,t.z),g.push(F,Y.b?1-V:V)}if(E>0){const V=u.length/3;for(let I=V-2*(w+1);I+w+2<V;I++)P?(E>1&&(t.push(I),t.push(I+1),t.push(I+w+1)),(E<G||b<1)&&(t.push(I+w+1),t.push(I+1),t.push(I+w+2))):(t.push(I),t.push(I+1),t.push(I+w+1),t.push(I+w+1),t.push(I+1),t.push(I+w+2))}}E.e._ComputeSides(X,u,t,W,g,V.frontUVs,V.backUVs);const o=new E.e;return o.indices=t,o.SV=u,o.QV=W,o.rV=g,o}function c(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new F.c(V,A);I.sideOrientation=F.c._GetDefaultSideOrientation(I.sideOrientation),B._originalBuilderSideOrientation=I.sideOrientation;return H(I).xV(B,I.updatable),B}E.e.CreateSphere=H,F.c.CreateSphere=(V,I,A,B,F,E)=>c(V,{segments:I,diameterX:A,diameterY:A,diameterZ:A,sideOrientation:E,updatable:F},B)},13414:(V,I,A)=>{"use strict";A.d(I,{c:()=>H});var B=A(11830),F=A(12935),E=A(11848),Y=A(11676);class H{static get Configuration(){return{get decoder(){return F.d.DefaultConfiguration},set decoder(V){F.d.DefaultConfiguration=V}}}static set Configuration(V){F.d.DefaultConfiguration=V.decoder}static get DecoderAvailable(){return(0,B.j)(F.d.DefaultConfiguration)}static get Default(){return H._Default??(H._Default=new H),H._Default}static ResetDefault(V){H._Default&&(V||H._Default.dispose(),H._Default=null)}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H.DefaultNumWorkers;const I="number"===typeof V?{...F.d.DefaultConfiguration,numWorkers:V}:{...F.d.DefaultConfiguration,...V};this._decoder=new F.d(I)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(V,I,A){return this._decoder.decodeMeshToMeshDataAsync(V,I,A)}async decodeMeshToGeometryAsync(V,I,A,B){return await this._decoder.decodeMeshToGeometryAsync(V,I,A,B)}async _decodeMeshToGeometryForGltfAsync(V,I,A,B,F,E){return await this._decoder._decodeMeshToGeometryForGltfAsync(V,I,A,B,F,E)}async decodeMeshAsync(V,I){const A=await this._decoder.decodeMeshToMeshDataAsync(V,I),B=new Y.e;A.indices&&(B.indices=A.indices);for(const F of A.attributes){const V=E.c.GetFloatData(F.data,F.size,E.c.GetDataType(F.data),F.byteOffset,F.byteStride,F.normalized,A.totalVertices);B.set(V,F.kind)}return B}}H.DefaultNumWorkers=(0,B.f)(),H._Default=null},12935:(V,I,A)=>{"use strict";A.d(I,{d:()=>b});var B=A(11830),F=A(11052),E=A(11713),Y=A(11848),H=A(11064),c=A(11839);class b extends B.d{static get DefaultAvailable(){return(0,B.j)(b.DefaultConfiguration)}static get Default(){return b._Default??(b._Default=new b),b._Default}static ResetDefault(V){b._Default&&(V||b._Default.dispose(),b._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(V,I){return{module:await(I||DracoDecoderModule)({wasmBinary:V})}}_getWorkerContent(){return`${c.b}(${c.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.DefaultConfiguration)}decodeMeshToMeshDataAsync(V,I,A){const B=V instanceof ArrayBuffer?new Int8Array(V):new Int8Array(V.buffer,V.byteOffset,V.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async V=>await new Promise(((F,E)=>{V.push(((V,Y)=>{let c=null;const b=[],X=I=>{V.removeEventListener("error",X),V.removeEventListener("message",P),E(I),Y()},P=I=>{const B=I.data;switch(B.id){case"indices":c=B.data;break;case"attribute":b.push({kind:B.kind,data:B.data,size:B.size,byteOffset:B.byteOffset,byteStride:B.byteStride,normalized:(E=B.kind,J=B.normalized,A&&void 0!==A[E]?(J!==A[E]&&H.b.Warn(`Normalized flag from Draco data (${J}) does not match normalized flag from glTF accessor (${A[E]}). Using flag from glTF accessor.`),A[E]):J)});break;case"decodeMeshDone":V.removeEventListener("error",X),V.removeEventListener("message",P),F({indices:c,attributes:b,totalVertices:B.totalVertices}),Y()}var E,J};V.addEventListener("error",X),V.addEventListener("message",P);const J=B.slice();V.postMessage({id:"decodeMesh",dataView:J,attributes:I},[J.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((V=>{let A=null;const F=[],E=(0,c.b)(V.module,B,I,(V=>{A=V}),((V,I,A,B,E,Y)=>{F.push({kind:V,data:I,size:A,byteOffset:B,byteStride:E,normalized:Y})}));return{indices:A,attributes:F,totalVertices:E}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(V,I,A,B){const F=await this.decodeMeshToMeshDataAsync(A,B),H=new E.d(V,I);F.indices&&H.setIndices(F.indices);for(const E of F.attributes)H.setVerticesBuffer(new Y.c(I.getEngine(),E.data,E.kind,!1,void 0,E.byteStride,void 0,E.byteOffset,E.size,void 0,E.normalized,!0),F.totalVertices);return H}async _decodeMeshToGeometryForGltfAsync(V,I,A,B,F,H){const c=await this.decodeMeshToMeshDataAsync(A,B,F),b=new E.d(V,I);H&&(b._boundingInfo=H,b.useBoundingInfoFromGeometry=!0),c.indices&&b.setIndices(c.indices);for(const E of c.attributes)b.setVerticesBuffer(new Y.c(I.getEngine(),E.data,E.kind,!1,void 0,E.byteStride,void 0,E.byteOffset,E.size,void 0,E.normalized,!0),c.totalVertices);return b}}b.DefaultConfiguration={wasmUrl:`${F.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${F.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${F.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},b._Default=null},13120:(V,I,A)=>{"use strict";A.d(I,{d:()=>HV});var B=A(11231),F=A(11701),E=A(11300),Y=A(11676),H=A(11280);function c(V){let I=V.pathArray;const A=V.closeArray||!1,B=V.closePath||!1,F=V.invertUV||!1,c=Math.floor(I[0].length/2);let b=V.offset||c;b=b>c?c:Math.floor(b);const X=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,P=V.rV,J=V.hV,G=[],w=[],t=[],u=[],W=[],g=[],o=[],L=[];let z;const m=[],s=[];let e,S,Q;if(I.length<2){const V=[],A=[];for(S=0;S<I[0].length-b;S++)V.push(I[0][S]),A.push(I[0][S+b]);I=[V,A]}let h=0;const r=B?1:0,M=A?1:0;let x,f,R,q,N,l;for(z=I[0].length,e=0;e<I.length+M;e++){for(o[e]=0,W[e]=[0],x=e===I.length?I[0]:I[e],f=x.length,z=z<f?z:f,Q=0;Q<f;)G.push(x[Q].x,x[Q].y,x[Q].z),Q>0&&(R=x[Q].uI(x[Q-1]).length(),q=R+o[e],W[e].push(q),o[e]=q),Q++;B&&(Q--,G.push(x[0].x,x[0].y,x[0].z),R=x[Q].uI(x[0]).length(),q=R+o[e],W[e].push(q),o[e]=q),m[e]=f+r,s[e]=h,h+=f+r}let i,y,v=null,C=null;for(S=0;S<z+r;S++)for(L[S]=0,g[S]=[0],e=0;e<I.length-1+M;e++)N=I[e],l=e===I.length-1?I[0]:I[e+1],S===z?(v=N[0],C=l[0]):(v=N[S],C=l[S]),R=C.uI(v).length(),q=R+L[S],g[S].push(q),L[S]=q;if(P)for(e=0;e<P.length;e++)u.push(P[e].x,H.b?1-P[e].y:P[e].y);else for(e=0;e<I.length+M;e++)for(S=0;S<z+r;S++)i=0!=o[e]?W[e][S]/o[e]:0,y=0!=L[S]?g[S][e]/L[S]:0,F?u.push(y,i):u.push(i,H.b?1-y:y);e=0;let K=0,p=m[e]-1,j=m[e+1]-1,T=p<j?p:j,d=s[1]-s[0];const D=m.length-1;for(;K<=T&&e<D;)w.push(K,K+d,K+1),w.push(K+d+1,K+1,K+d),K+=1,K===T&&(e++,d=s[e+1]-s[e],p=m[e]-1,j=m[e+1]-1,K=s[e],T=p<j?p+K:j+K);if(Y.e.ComputeNormals(G,w,t),B){let V=0,A=0;for(e=0;e<I.length;e++){V=3*s[e],A=e+1<I.length?3*(s[e+1]-1):t.length-3,t[V]=.5*(t[V]+t[A]),t[V+1]=.5*(t[V+1]+t[A+1]),t[V+2]=.5*(t[V+2]+t[A+2]);const B=Math.sqrt(t[V]*t[V]+t[V+1]*t[V+1]+t[V+2]*t[V+2]);t[V]/=B,t[V+1]/=B,t[V+2]/=B,t[A]=t[V],t[A+1]=t[V+1],t[A+2]=t[V+2]}}if(A){let V=3*s[0],A=3*s[I.length];for(S=0;S<z+r;S++){t[V]=.5*(t[V]+t[A]),t[V+1]=.5*(t[V+1]+t[A+1]),t[V+2]=.5*(t[V+2]+t[A+2]);const I=Math.sqrt(t[V]*t[V]+t[V+1]*t[V+1]+t[V+2]*t[V+2]);t[V]/=I,t[V+1]/=I,t[V+2]/=I,t[A]=t[V],t[A+1]=t[V+1],t[A+2]=t[V+2],V+=3,A+=3}}Y.e._ComputeSides(X,G,w,t,u,V.frontUVs,V.backUVs);let O=null;if(J){O=new Float32Array(4*J.length);for(let V=0;V<J.length;V++)O[4*V]=J[V].r,O[4*V+1]=J[V].g,O[4*V+2]=J[V].b,O[4*V+3]=J[V].a}const Z=new Y.e,a=new Float32Array(G),k=new Float32Array(t),U=new Float32Array(u);return Z.indices=w,Z.SV=a,Z.QV=k,Z.rV=U,O&&Z.set(O,E.g.ColorKind),B&&(Z._idx=s),Z}function b(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=I.pathArray,X=I.closeArray,P=I.closePath,J=F.c._GetDefaultSideOrientation(I.sideOrientation),G=I.instance,w=I.updatable;if(G){const V=B.TmpVectors.tI[0].JH(Number.MAX_VALUE),A=B.TmpVectors.tI[1].JH(-Number.MAX_VALUE),c=I=>{let B=b[0].length;const E=G;let Y=0;const H=E._originalBuilderSideOrientation===F.c.DOUBLESIDE?2:1;for(let F=1;F<=H;++F)for(let H=0;H<b.length;++H){const F=b[H],c=F.length;B=B<c?B:c;for(let E=0;E<B;++E){const B=F[E];I[Y]=B.x,I[Y+1]=B.y,I[Y+2]=B.z,V.minimizeInPlaceFromFloats(B.x,B.y,B.z),A.maximizeInPlaceFromFloats(B.x,B.y,B.z),Y+=3}if(E._creationDataStorage&&E._creationDataStorage.closePath){const V=F[0];I[Y]=V.x,I[Y+1]=V.y,I[Y+2]=V.z,Y+=3}}},X=G.getVerticesData(E.g.PositionKind);if(c(X),G.hasBoundingInfo?G.getBoundingInfo().reConstruct(V,A,G._worldMatrix):G.buildBoundingInfo(V,A,G._worldMatrix),G.updateVerticesData(E.g.PositionKind,X,!1,!1),I.hV){const V=G.getVerticesData(E.g.ColorKind);for(let A=0,B=0;A<I.hV.length;A++,B+=4){const F=I.hV[A];V[B]=F.r,V[B+1]=F.g,V[B+2]=F.b,V[B+3]=F.a}G.updateVerticesData(E.g.ColorKind,V,!1,!1)}if(I.rV){const V=G.getVerticesData(E.g.UVKind);for(let A=0;A<I.rV.length;A++)V[2*A]=I.rV[A].x,V[2*A+1]=H.b?1-I.rV[A].y:I.rV[A].y;G.updateVerticesData(E.g.UVKind,V,!1,!1)}if(!G.areNormalsFrozen||G.isFacetDataEnabled){const V=G.cH(),I=G.getVerticesData(E.g.NormalKind),A=G.isFacetDataEnabled?G.getFacetDataParameters():null;if(Y.e.ComputeNormals(X,V,I,A),G._creationDataStorage&&G._creationDataStorage.closePath){let V=0,A=0;for(let B=0;B<b.length;B++)V=3*G._creationDataStorage.idx[B],A=B+1<b.length?3*(G._creationDataStorage.idx[B+1]-1):I.length-3,I[V]=.5*(I[V]+I[A]),I[V+1]=.5*(I[V+1]+I[A+1]),I[V+2]=.5*(I[V+2]+I[A+2]),I[A]=I[V],I[A+1]=I[V+1],I[A+2]=I[V+2]}G.areNormalsFrozen||G.updateVerticesData(E.g.NormalKind,I,!1,!1)}return G}{const B=new F.c(V,A);B._originalBuilderSideOrientation=J,B._creationDataStorage=new F.d;const E=c(I);return P&&(B._creationDataStorage.idx=E._idx),B._creationDataStorage.closePath=P,B._creationDataStorage.closeArray=X,E.xV(B,w),B}}Y.e.CreateRibbon=c,F.c.CreateRibbon=function(V,I){return b(V,{pathArray:I,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var X=A(12627),P=A(12500),J=A(11276);function G(V){const I=V.pattern||F.c.NO_FLIP,A=V.tileWidth||V.tileSize||1,B=V.tileHeight||V.tileSize||1,E=V.alignHorizontal||0,H=V.alignVertical||0,c=V.width||V.size||1,b=Math.floor(c/A);let X=c-b*A;const P=V.height||V.size||1,J=Math.floor(P/B);let G=P-J*B;const w=A*b/2,t=B*J/2;let u=0,W=0,g=0,o=0,L=0,z=0;if(X>0||G>0){switch(g=-w,o=-t,L=w,z=t,E){case F.c.CENTER:X/=2,g-=X,L+=X;break;case F.c.LEFT:L+=X,u=-X/2;break;case F.c.RIGHT:g-=X,u=X/2}switch(H){case F.c.CENTER:G/=2,o-=G,z+=G;break;case F.c.BOTTOM:z+=G,W=-G/2;break;case F.c.TOP:o-=G,W=G/2}}const m=[],s=[],e=[];e[0]=[0,0,1,0,1,1,0,1],e[1]=[0,0,1,0,1,1,0,1],I!==F.c.ROTATE_TILE&&I!==F.c.ROTATE_ROW||(e[1]=[1,1,0,1,0,0,1,0]),I!==F.c.FLIP_TILE&&I!==F.c.FLIP_ROW||(e[1]=[1,0,0,0,0,1,1,1]),I!==F.c.FLIP_N_ROTATE_TILE&&I!==F.c.FLIP_N_ROTATE_ROW||(e[1]=[0,1,1,1,1,0,0,0]);let S=[];const Q=[],h=[];let r=0;for(let Y=0;Y<J;Y++)for(let V=0;V<b;V++)m.push(V*A-w+u,Y*B-t+W,0),m.push((V+1)*A-w+u,Y*B-t+W,0),m.push((V+1)*A-w+u,(Y+1)*B-t+W,0),m.push(V*A-w+u,(Y+1)*B-t+W,0),h.push(r,r+1,r+3,r+1,r+2,r+3),S=I===F.c.FLIP_TILE||I===F.c.ROTATE_TILE||I===F.c.FLIP_N_ROTATE_TILE?S.concat(e[(V%2+Y%2)%2]):I===F.c.FLIP_ROW||I===F.c.ROTATE_ROW||I===F.c.FLIP_N_ROTATE_ROW?S.concat(e[Y%2]):S.concat(e[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),r+=4;if(X>0||G>0){const V=G>0&&(H===F.c.CENTER||H===F.c.TOP),Y=G>0&&(H===F.c.CENTER||H===F.c.BOTTOM),c=X>0&&(E===F.c.CENTER||E===F.c.RIGHT),P=X>0&&(E===F.c.CENTER||E===F.c.LEFT);let e,M,x,f,R=[];if(V&&c&&(m.push(g+u,o+W,0),m.push(-w+u,o+W,0),m.push(-w+u,o+G+W,0),m.push(g+u,o+G+W,0),h.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,e=1-X/A,M=1-G/B,x=1,f=1,R=[e,M,x,M,x,f,e,f],I===F.c.ROTATE_ROW&&(R=[1-e,1-M,1-x,1-M,1-x,1-f,1-e,1-f]),I===F.c.FLIP_ROW&&(R=[1-e,M,1-x,M,1-x,f,1-e,f]),I===F.c.FLIP_N_ROTATE_ROW&&(R=[e,1-M,x,1-M,x,1-f,e,1-f]),S=S.concat(R),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&P&&(m.push(w+u,o+W,0),m.push(L+u,o+W,0),m.push(L+u,o+G+W,0),m.push(w+u,o+G+W,0),h.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,e=0,M=1-G/B,x=X/A,f=1,R=[e,M,x,M,x,f,e,f],(I===F.c.ROTATE_ROW||I===F.c.ROTATE_TILE&&b%2===0)&&(R=[1-e,1-M,1-x,1-M,1-x,1-f,1-e,1-f]),(I===F.c.FLIP_ROW||I===F.c.FLIP_TILE&&b%2===0)&&(R=[1-e,M,1-x,M,1-x,f,1-e,f]),(I===F.c.FLIP_N_ROTATE_ROW||I===F.c.FLIP_N_ROTATE_TILE&&b%2===0)&&(R=[e,1-M,x,1-M,x,1-f,e,1-f]),S=S.concat(R),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&c&&(m.push(g+u,t+W,0),m.push(-w+u,t+W,0),m.push(-w+u,z+W,0),m.push(g+u,z+W,0),h.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,e=1-X/A,M=0,x=1,f=G/B,R=[e,M,x,M,x,f,e,f],(I===F.c.ROTATE_ROW&&J%2===1||I===F.c.ROTATE_TILE&&J%1===0)&&(R=[1-e,1-M,1-x,1-M,1-x,1-f,1-e,1-f]),(I===F.c.FLIP_ROW&&J%2===1||I===F.c.FLIP_TILE&&J%2===0)&&(R=[1-e,M,1-x,M,1-x,f,1-e,f]),(I===F.c.FLIP_N_ROTATE_ROW&&J%2===1||I===F.c.FLIP_N_ROTATE_TILE&&J%2===0)&&(R=[e,1-M,x,1-M,x,1-f,e,1-f]),S=S.concat(R),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&P&&(m.push(w+u,t+W,0),m.push(L+u,t+W,0),m.push(L+u,z+W,0),m.push(w+u,z+W,0),h.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,e=0,M=0,x=X/A,f=G/B,R=[e,M,x,M,x,f,e,f],(I===F.c.ROTATE_ROW&&J%2===1||I===F.c.ROTATE_TILE&&(J+b)%2===1)&&(R=[1-e,1-M,1-x,1-M,1-x,1-f,1-e,1-f]),(I===F.c.FLIP_ROW&&J%2===1||I===F.c.FLIP_TILE&&(J+b)%2===1)&&(R=[1-e,M,1-x,M,1-x,f,1-e,f]),(I===F.c.FLIP_N_ROTATE_ROW&&J%2===1||I===F.c.FLIP_N_ROTATE_TILE&&(J+b)%2===1)&&(R=[e,1-M,x,1-M,x,1-f,e,1-f]),S=S.concat(R),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V){const V=[];e=0,M=1-G/B,x=1,f=1,V[0]=[e,M,x,M,x,f,e,f],V[1]=[e,M,x,M,x,f,e,f],I!==F.c.ROTATE_TILE&&I!==F.c.ROTATE_ROW||(V[1]=[1-e,1-M,1-x,1-M,1-x,1-f,1-e,1-f]),I!==F.c.FLIP_TILE&&I!==F.c.FLIP_ROW||(V[1]=[1-e,M,1-x,M,1-x,f,1-e,f]),I!==F.c.FLIP_N_ROTATE_TILE&&I!==F.c.FLIP_N_ROTATE_ROW||(V[1]=[e,1-M,x,1-M,x,1-f,e,1-f]);for(let B=0;B<b;B++)m.push(B*A-w+u,o+W,0),m.push((B+1)*A-w+u,o+W,0),m.push((B+1)*A-w+u,o+G+W,0),m.push(B*A-w+u,o+G+W,0),h.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,S=I===F.c.FLIP_TILE||I===F.c.ROTATE_TILE||I===F.c.FLIP_N_ROTATE_TILE?S.concat(V[(B+1)%2]):I===F.c.FLIP_ROW||I===F.c.ROTATE_ROW||I===F.c.FLIP_N_ROTATE_ROW?S.concat(V[1]):S.concat(V[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const V=[];e=0,M=0,x=1,f=G/B,V[0]=[e,M,x,M,x,f,e,f],V[1]=[e,M,x,M,x,f,e,f],I!==F.c.ROTATE_TILE&&I!==F.c.ROTATE_ROW||(V[1]=[1-e,1-M,1-x,1-M,1-x,1-f,1-e,1-f]),I!==F.c.FLIP_TILE&&I!==F.c.FLIP_ROW||(V[1]=[1-e,M,1-x,M,1-x,f,1-e,f]),I!==F.c.FLIP_N_ROTATE_TILE&&I!==F.c.FLIP_N_ROTATE_ROW||(V[1]=[e,1-M,x,1-M,x,1-f,e,1-f]);for(let B=0;B<b;B++)m.push(B*A-w+u,z-G+W,0),m.push((B+1)*A-w+u,z-G+W,0),m.push((B+1)*A-w+u,z+W,0),m.push(B*A-w+u,z+W,0),h.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,S=I===F.c.FLIP_TILE||I===F.c.ROTATE_TILE||I===F.c.FLIP_N_ROTATE_TILE?S.concat(V[(B+J)%2]):I===F.c.FLIP_ROW||I===F.c.ROTATE_ROW||I===F.c.FLIP_N_ROTATE_ROW?S.concat(V[J%2]):S.concat(V[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(c){const V=[];e=1-X/A,M=0,x=1,f=1,V[0]=[e,M,x,M,x,f,e,f],V[1]=[e,M,x,M,x,f,e,f],I!==F.c.ROTATE_TILE&&I!==F.c.ROTATE_ROW||(V[1]=[1-e,1-M,1-x,1-M,1-x,1-f,1-e,1-f]),I!==F.c.FLIP_TILE&&I!==F.c.FLIP_ROW||(V[1]=[1-e,M,1-x,M,1-x,f,1-e,f]),I!==F.c.FLIP_N_ROTATE_TILE&&I!==F.c.FLIP_N_ROTATE_ROW||(V[1]=[e,1-M,x,1-M,x,1-f,e,1-f]);for(let A=0;A<J;A++)m.push(g+u,A*B-t+W,0),m.push(g+X+u,A*B-t+W,0),m.push(g+X+u,(A+1)*B-t+W,0),m.push(g+u,(A+1)*B-t+W,0),h.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,S=I===F.c.FLIP_TILE||I===F.c.ROTATE_TILE||I===F.c.FLIP_N_ROTATE_TILE?S.concat(V[(A+1)%2]):I===F.c.FLIP_ROW||I===F.c.ROTATE_ROW||I===F.c.FLIP_N_ROTATE_ROW?S.concat(V[A%2]):S.concat(V[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(P){const V=[];e=0,M=0,x=X/B,f=1,V[0]=[e,M,x,M,x,f,e,f],V[1]=[e,M,x,M,x,f,e,f],I!==F.c.ROTATE_TILE&&I!==F.c.ROTATE_ROW||(V[1]=[1-e,1-M,1-x,1-M,1-x,1-f,1-e,1-f]),I!==F.c.FLIP_TILE&&I!==F.c.FLIP_ROW||(V[1]=[1-e,M,1-x,M,1-x,f,1-e,f]),I!==F.c.FLIP_N_ROTATE_TILE&&I!==F.c.FLIP_N_ROTATE_ROW||(V[1]=[e,1-M,x,1-M,x,1-f,e,1-f]);for(let A=0;A<J;A++)m.push(L-X+u,A*B-t+W,0),m.push(L+u,A*B-t+W,0),m.push(L+u,(A+1)*B-t+W,0),m.push(L-X+u,(A+1)*B-t+W,0),h.push(r,r+1,r+3,r+1,r+2,r+3),r+=4,S=I===F.c.FLIP_TILE||I===F.c.ROTATE_TILE||I===F.c.FLIP_N_ROTATE_TILE?S.concat(V[(A+b)%2]):I===F.c.FLIP_ROW||I===F.c.ROTATE_ROW||I===F.c.FLIP_N_ROTATE_ROW?S.concat(V[A%2]):S.concat(V[0]),Q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const M=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE;Y.e._ComputeSides(M,m,h,s,S,V.frontUVs,V.backUVs);const x=new Y.e;x.indices=h,x.SV=m,x.QV=s,x.rV=S;const f=M===Y.e.DOUBLESIDE?Q.concat(Q):Q;return x.hV=f,x}function w(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new F.c(V,A);I.sideOrientation=F.c._GetDefaultSideOrientation(I.sideOrientation),B._originalBuilderSideOrientation=I.sideOrientation;return G(I).xV(B,I.updatable),B}function t(V){const I=V.faceUV||new Array(6),A=V.faceColors,E=V.pattern||F.c.NO_FLIP,c=V.width||V.size||1,b=V.height||V.size||1,X=V.depth||V.size||1,P=V.tileWidth||V.tileSize||1,w=V.tileHeight||V.tileSize||1,t=V.alignHorizontal||0,u=V.alignVertical||0,W=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE;for(let F=0;F<6;F++)void 0===I[F]&&(I[F]=new B.Vector4(0,0,1,1)),A&&void 0===A[F]&&(A[F]=new J.GH(1,1,1,1));const g=c/2,o=b/2,L=X/2,z=[];for(let B=0;B<2;B++)z[B]=G({pattern:E,tileWidth:P,tileHeight:w,width:c,height:b,alignVertical:u,alignHorizontal:t,sideOrientation:W});for(let B=2;B<4;B++)z[B]=G({pattern:E,tileWidth:P,tileHeight:w,width:X,height:b,alignVertical:u,alignHorizontal:t,sideOrientation:W});let m=u;u===F.c.BOTTOM?m=F.c.TOP:u===F.c.TOP&&(m=F.c.BOTTOM);for(let B=4;B<6;B++)z[B]=G({pattern:E,tileWidth:P,tileHeight:w,width:c,height:X,alignVertical:m,alignHorizontal:t,sideOrientation:W});let s=[],e=[],S=[],Q=[];const h=[],r=[],M=[],x=[];let f=0,R=0;for(let F=0;F<6;F++){const V=z[F].SV.length;r[F]=[],M[F]=[];for(let I=0;I<V/3;I++)r[F].push(new B.tI(z[F].SV[3*I],z[F].SV[3*I+1],z[F].SV[3*I+2])),M[F].push(new B.tI(z[F].QV[3*I],z[F].QV[3*I+1],z[F].QV[3*I+2]));f=z[F].rV.length,x[F]=[];for(let A=0;A<f;A+=2)x[F][A]=I[F].x+(I[F].z-I[F].x)*z[F].rV[A],x[F][A+1]=I[F].y+(I[F].w-I[F].y)*z[F].rV[A+1],H.b&&(x[F][A+1]=1-x[F][A+1]);if(S=S.concat(x[F]),Q=Q.concat(z[F].indices.map((V=>V+R))),R+=r[F].length,A)for(let I=0;I<4;I++)h.push(A[F].r,A[F].g,A[F].b,A[F].a)}const q=new B.tI(0,0,L),N=B.Matrix.RotationY(Math.PI);s=r[0].map((V=>B.tI.TransformNormal(V,N).add(q))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]),e=M[0].map((V=>B.tI.TransformNormal(V,N))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]),s=s.concat(r[1].map((V=>V.uI(q))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),e=e.concat(M[1].map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]));const l=new B.tI(g,0,0),i=B.Matrix.RotationY(-Math.PI/2);s=s.concat(r[2].map((V=>B.tI.TransformNormal(V,i).add(l))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),e=e.concat(M[2].map((V=>B.tI.TransformNormal(V,i))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]));const y=B.Matrix.RotationY(Math.PI/2);s=s.concat(r[3].map((V=>B.tI.TransformNormal(V,y).uI(l))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),e=e.concat(M[3].map((V=>B.tI.TransformNormal(V,y))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]));const v=new B.tI(0,o,0),C=B.Matrix.RotationX(Math.PI/2);s=s.concat(r[4].map((V=>B.tI.TransformNormal(V,C).add(v))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),e=e.concat(M[4].map((V=>B.tI.TransformNormal(V,C))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[]));const K=B.Matrix.RotationX(-Math.PI/2);s=s.concat(r[5].map((V=>B.tI.TransformNormal(V,K).uI(v))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),e=e.concat(M[5].map((V=>B.tI.TransformNormal(V,K))).map((V=>[V.x,V.y,V.z])).reduce(((V,I)=>V.concat(I)),[])),Y.e._ComputeSides(W,s,Q,e,S);const p=new Y.e;if(p.indices=Q,p.SV=s,p.QV=e,p.rV=S,A){const V=W===Y.e.DOUBLESIDE?h.concat(h):h;p.hV=V}return p}function u(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new F.c(V,A);I.sideOrientation=F.c._GetDefaultSideOrientation(I.sideOrientation),B._originalBuilderSideOrientation=I.sideOrientation;return t(I).xV(B,I.updatable),B}Y.e.CreateTiledPlane=G;Y.e.CreateTiledBox=t;var W=A(12617),g=A(11473),o=A(11428);function L(V){const I=V.height||2;let A=0===V.diameterTop?0:V.diameterTop||V.diameter||1,E=0===V.diameterBottom?0:V.diameterBottom||V.diameter||1;A=A||1e-5,E=E||1e-5;const c=0|(V.tessellation||24),b=0|(V.subdivisions||1),X=!!V.hasRings,P=!!V.enclose,G=0===V.cap?0:V.cap||F.c.CAP_ALL,w=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,t=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,u=V.faceUV||new Array(3),W=V.faceColors,g=2+(1+(1!==w&&P?2:0))*(X?b:1);let L;for(L=0;L<g;L++)W&&void 0===W[L]&&(W[L]=new J.GH(1,1,1,1));for(L=0;L<g;L++)u&&void 0===u[L]&&(u[L]=new B.Vector4(0,0,1,1));const z=[],m=[],s=[],e=[],S=[],Q=2*Math.PI*w/c;let h,r,M;const x=(E-A)/2/I,f=B.tI.Zero(),R=B.tI.Zero(),q=B.tI.Zero(),N=B.tI.Zero(),l=B.tI.Zero(),i=o.c.Y;let y,v,C,K=1,p=1,j=0,T=0;for(y=0;y<=b;y++)for(r=y/b,M=(r*(A-E)+E)/2,K=X&&0!==y&&y!==b?2:1,C=0;C<K;C++){for(X&&(p+=C),P&&(p+=2*C),v=0;v<=c;v++)h=v*Q,f.x=Math.cos(-h)*M,f.y=-I/2+r*I,f.z=Math.sin(-h)*M,0===A&&y===b?(R.x=s[s.length-3*(c+1)],R.y=s[s.length-3*(c+1)+1],R.z=s[s.length-3*(c+1)+2]):(R.x=f.x,R.z=f.z,R.y=Math.sqrt(R.x*R.x+R.z*R.z)*x,R.normalize()),0===v&&(q.B(f),N.B(R)),m.push(f.x,f.y,f.z),s.push(R.x,R.y,R.z),T=X?j!==p?u[p].y:u[p].w:u[p].y+(u[p].w-u[p].y)*r,e.push(u[p].x+(u[p].z-u[p].x)*v/c,H.b?1-T:T),W&&S.push(W[p].r,W[p].g,W[p].b,W[p].a);1!==w&&P&&(m.push(f.x,f.y,f.z),m.push(0,f.y,0),m.push(0,f.y,0),m.push(q.x,q.y,q.z),B.tI.CrossToRef(i,R,l),l.normalize(),s.push(l.x,l.y,l.z,l.x,l.y,l.z),B.tI.CrossToRef(N,i,l),l.normalize(),s.push(l.x,l.y,l.z,l.x,l.y,l.z),T=X?j!==p?u[p+1].y:u[p+1].w:u[p+1].y+(u[p+1].w-u[p+1].y)*r,e.push(u[p+1].x,H.b?1-T:T),e.push(u[p+1].z,H.b?1-T:T),T=X?j!==p?u[p+2].y:u[p+2].w:u[p+2].y+(u[p+2].w-u[p+2].y)*r,e.push(u[p+2].x,H.b?1-T:T),e.push(u[p+2].z,H.b?1-T:T),W&&(S.push(W[p+1].r,W[p+1].g,W[p+1].b,W[p+1].a),S.push(W[p+1].r,W[p+1].g,W[p+1].b,W[p+1].a),S.push(W[p+2].r,W[p+2].g,W[p+2].b,W[p+2].a),S.push(W[p+2].r,W[p+2].g,W[p+2].b,W[p+2].a))),j!==p&&(j=p)}const d=1!==w&&P?c+4:c;for(y=0,p=0;p<b;p++){let V=0,I=0,A=0,B=0;for(v=0;v<c;v++)V=y*(d+1)+v,I=(y+1)*(d+1)+v,A=y*(d+1)+(v+1),B=(y+1)*(d+1)+(v+1),z.push(V,I,A),z.push(B,A,I);1!==w&&P&&(z.push(V+2,I+2,A+2),z.push(B+2,A+2,I+2),z.push(V+4,I+4,A+4),z.push(B+4,A+4,I+4)),y=X?y+2:y+1}const D=V=>{const F=V?A/2:E/2;if(0===F)return;let Y,b,X;const P=V?u[g-1]:u[0];let J=null;W&&(J=V?W[g-1]:W[0]);const G=m.length/3,t=V?I/2:-I/2,o=new B.tI(0,t,0);m.push(o.x,o.y,o.z),s.push(0,V?1:-1,0);const L=P.y+.5*(P.w-P.y);e.push(P.x+.5*(P.z-P.x),H.b?1-L:L),J&&S.push(J.r,J.g,J.b,J.a);const Q=new B.Vector2(.5,.5);for(X=0;X<=c;X++){Y=2*Math.PI*X*w/c;const I=Math.cos(-Y),A=Math.sin(-Y);b=new B.tI(I*F,t,A*F);const E=new B.Vector2(I*Q.x+.5,A*Q.y+.5);m.push(b.x,b.y,b.z),s.push(0,V?1:-1,0);const G=P.y+(P.w-P.y)*E.y;e.push(P.x+(P.z-P.x)*E.x,H.b?1-G:G),J&&S.push(J.r,J.g,J.b,J.a)}for(X=0;X<c;X++)V?(z.push(G),z.push(G+(X+2)),z.push(G+(X+1))):(z.push(G),z.push(G+(X+1)),z.push(G+(X+2)))};G!==F.c.CAP_START&&G!==F.c.CAP_ALL||D(!1),G!==F.c.CAP_END&&G!==F.c.CAP_ALL||D(!0),Y.e._ComputeSides(t,m,z,s,e,V.frontUVs,V.backUVs);const O=new Y.e;return O.indices=z,O.SV=m,O.QV=s,O.rV=e,W&&(O.hV=S),O}function z(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const B=new F.c(V,A);I.sideOrientation=F.c._GetDefaultSideOrientation(I.sideOrientation),B._originalBuilderSideOrientation=I.sideOrientation;return L(I).xV(B,I.updatable),B}function m(V){const I=[],A=[],F=[],E=[],c=V.diameter||1,b=V.thickness||.5,X=0|(V.tessellation||16),P=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,J=X+1;for(let Y=0;Y<=X;Y++){const V=Y/X,P=Y*Math.PI*2/X-Math.PI/2,G=B.Matrix.Translation(c/2,0,0).multiply(B.Matrix.RotationY(P));for(let c=0;c<=X;c++){const P=1-c/X,w=c*Math.PI*2/X+Math.PI,t=Math.cos(w),u=Math.sin(w);let W=new B.tI(t,u,0),g=W.scale(b/2);const o=new B.Vector2(V,P);g=B.tI.TransformCoordinates(g,G),W=B.tI.TransformNormal(W,G),A.push(g.x,g.y,g.z),F.push(W.x,W.y,W.z),E.push(o.x,H.b?1-o.y:o.y);const L=(Y+1)%J,z=(c+1)%J;I.push(Y*J+c),I.push(Y*J+z),I.push(L*J+c),I.push(Y*J+z),I.push(L*J+z),I.push(L*J+c)}}Y.e._ComputeSides(P,A,I,F,E,V.frontUVs,V.backUVs);const G=new Y.e;return G.indices=I,G.SV=A,G.QV=F,G.rV=E,G}function s(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const B=new F.c(V,A);I.sideOrientation=F.c._GetDefaultSideOrientation(I.sideOrientation),B._originalBuilderSideOrientation=I.sideOrientation;return m(I).xV(B,I.updatable),B}Y.e.CreateCylinder=L,F.c.CreateCylinder=(V,I,A,B,E,Y,H,c,b)=>{void 0!==H&&H instanceof g.b||(void 0!==H&&(b=c||F.c.DEFAULTSIDE,c=H),H=Y,Y=1);return z(V,{height:I,diameterTop:A,diameterBottom:B,tessellation:E,subdivisions:Y,sideOrientation:b,updatable:c},H)};function e(V){const I=[],A=[],F=[],E=[],c=V.radius||2,b=V.tube||.5,X=V.radialSegments||32,P=V.tubularSegments||32,J=V.p||2,G=V.q||3,w=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,t=V=>{const I=Math.cos(V),A=Math.sin(V),F=G/J*V,E=Math.cos(F),Y=c*(2+E)*.5*I,H=c*(2+E)*A*.5,b=c*Math.sin(F)*.5;return new B.tI(Y,H,b)};let u,W;for(u=0;u<=X;u++){const V=u%X/X*2*J*Math.PI,I=t(V),F=t(V+.01),Y=F.uI(I);let c=F.add(I);const G=B.tI.Cross(Y,c);for(c=B.tI.Cross(G,Y),G.normalize(),c.normalize(),W=0;W<P;W++){const V=W%P/P*2*Math.PI,B=-b*Math.cos(V),F=b*Math.sin(V);A.push(I.x+B*c.x+F*G.x),A.push(I.y+B*c.y+F*G.y),A.push(I.z+B*c.z+F*G.z),E.push(u/X),E.push(H.b?1-W/P:W/P)}}for(u=0;u<X;u++)for(W=0;W<P;W++){const V=(W+1)%P,A=u*P+W,B=(u+1)*P+W,F=(u+1)*P+V,E=u*P+V;I.push(E),I.push(B),I.push(A),I.push(E),I.push(F),I.push(B)}Y.e.ComputeNormals(A,I,F),Y.e._ComputeSides(w,A,I,F,E,V.frontUVs,V.backUVs);const g=new Y.e;return g.indices=I,g.SV=A,g.QV=F,g.rV=E,g}function S(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const B=new F.c(V,A);I.sideOrientation=F.c._GetDefaultSideOrientation(I.sideOrientation),B._originalBuilderSideOrientation=I.sideOrientation;return e(I).xV(B,I.updatable),B}Y.e.CreateTorus=m,F.c.CreateTorus=(V,I,A,B,F,E,Y)=>s(V,{diameter:I,thickness:A,tessellation:B,sideOrientation:Y,updatable:E},F);Y.e.CreateTorusKnot=e,F.c.CreateTorusKnot=(V,I,A,B,F,E,Y,H,c,b)=>S(V,{radius:I,tube:A,radialSegments:B,tubularSegments:F,p:E,q:Y,sideOrientation:b,updatable:c},H);var Q=A(13123),h=A(11818),r=A(11440);function M(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=I.path,E=I.shape,Y=I.scale||1,H=I.rotation||0,c=0===I.cap?0:I.cap||F.c.NO_CAP,b=I.updatable,X=F.c._GetDefaultSideOrientation(I.sideOrientation),P=I.instance||null,J=I.invertUV||!1,G=I.closeShape||!1,w=I.closePath||!1,t=I.capFunction||null;return f(V,E,B,Y,H,null,null,w,G,c,!1,A,!!b,X,P,J,I.frontUVs||null,I.backUVs||null,I.firstNormal||null,!!I.adjustFrame,t)}function x(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=I.path,E=I.shape,Y=I.scaleFunction||(()=>1),H=I.rotationFunction||(()=>0),c=I.closePath||I.ribbonCloseArray||!1,b=I.closeShape||I.ribbonClosePath||!1,X=0===I.cap?0:I.cap||F.c.NO_CAP,P=I.updatable,J=I.firstNormal||null,G=I.adjustFrame||!1,w=F.c._GetDefaultSideOrientation(I.sideOrientation),t=I.instance,u=I.invertUV||!1,W=I.capFunction||null;return f(V,E,B,null,null,Y,H,c,b,X,!0,A,!!P,w,t||null,u,I.frontUVs||null,I.backUVs||null,J,G,W||null)}function f(V,I,A,E,Y,H,c,X,P,J,G,w,t,u,W,g,o,L,z,m,s){const e=(V,I,A,E,Y,H,c,b,X,P,J)=>{const G=A.getTangents(),w=A.getNormals(),t=A.getBinormals(),u=A.getDistances();if(J)for(let F=0;F<G.length;F++)if(0==G[F].x&&0==G[F].y&&0==G[F].z&&G[F].B(G[F-1]),0==w[F].x&&0==w[F].y&&0==w[F].z&&w[F].B(w[F-1]),0==t[F].x&&0==t[F].y&&0==t[F].z&&t[F].B(t[F-1]),F>0){let V=G[F-1];B.tI.Dot(V,G[F])<0&&G[F].scaleInPlace(-1),V=w[F-1],B.tI.Dot(V,w[F])<0&&w[F].scaleInPlace(-1),V=t[F-1],B.tI.Dot(V,t[F])<0&&t[F].scaleInPlace(-1)}let W=0;const g=P&&b?b:()=>null!==H?H:0,o=P&&c?c:()=>null!==Y?Y:1;let L=X===F.c.NO_CAP||X===F.c.CAP_END?0:2;const z=B.TmpVectors.Matrix[0];for(let F=0;F<I.length;F++){const A=[],Y=g(F,u[F]),H=o(F,u[F]);B.Matrix.RotationAxisToRef(G[F],W,z);for(let E=0;E<V.length;E++){const Y=G[F].scale(V[E].z).add(w[F].scale(V[E].x)).add(t[F].scale(V[E].y)),c=B.tI.Zero();B.tI.TransformCoordinatesToRef(Y,z,c),c.scaleInPlace(H).addInPlace(I[F]),A[E]=c}E[L]=A,W+=Y,L++}const m=s||(V=>{const I=Array(),A=B.tI.Zero();let F;for(F=0;F<V.length;F++)A.addInPlace(V[F]);for(A.scaleInPlace(1/V.length),F=0;F<V.length;F++)I.push(A);return I});switch(X){case F.c.NO_CAP:break;case F.c.CAP_START:E[0]=m(E[2]),E[1]=E[2];break;case F.c.CAP_END:E[L]=E[L-1],E[L+1]=m(E[L-1]);break;case F.c.CAP_ALL:E[0]=m(E[2]),E[1]=E[2],E[L]=E[L-1],E[L+1]=m(E[L-1])}return E};let S,Q;if(W){const V=W._creationDataStorage;return S=z?V.path3D.update(A,z):V.path3D.update(A),Q=e(I,A,V.path3D,V.pathArray,E,Y,H,c,V.cap,G,m),W=b("",{pathArray:Q,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:W},w||void 0)}S=z?new r.m(A,z):new r.m(A);Q=e(I,A,S,new Array,E,Y,H,c,J=J<0||J>3?0:J,G,m);const h=b(V,{pathArray:Q,closeArray:X,closePath:P,updatable:t,sideOrientation:u,invertUV:g,frontUVs:o||void 0,backUVs:L||void 0},w);return h._creationDataStorage.pathArray=Q,h._creationDataStorage.path3D=S,h._creationDataStorage.cap=J,h}function R(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=I.arc?I.arc<=0||I.arc>1?1:I.arc:1,Y=void 0===I.closed||I.closed,H=I.shape,c=I.radius||1,X=I.tessellation||64,P=I.clip||0,J=I.updatable,G=F.c._GetDefaultSideOrientation(I.sideOrientation),w=I.cap||F.c.NO_CAP,t=2*Math.PI,u=[],W=I.invertUV||!1;let g=0,o=0;const L=t/X*E;let z,m;for(g=0;g<=X-P;g++){for(m=[],w!=F.c.CAP_START&&w!=F.c.CAP_ALL||(m.push(new B.tI(0,H[0].y,0)),m.push(new B.tI(Math.cos(g*L)*H[0].x*c,H[0].y,Math.sin(g*L)*H[0].x*c))),o=0;o<H.length;o++)z=new B.tI(Math.cos(g*L)*H[o].x*c,H[o].y,Math.sin(g*L)*H[o].x*c),m.push(z);w!=F.c.CAP_END&&w!=F.c.CAP_ALL||(m.push(new B.tI(Math.cos(g*L)*H[H.length-1].x*c,H[H.length-1].y,Math.sin(g*L)*H[H.length-1].x*c)),m.push(new B.tI(0,H[H.length-1].y,0))),u.push(m)}return b(V,{pathArray:u,closeArray:Y,sideOrientation:G,updatable:J,invertUV:W,frontUVs:I.frontUVs,backUVs:I.backUVs},A)}F.c.ExtrudeShape=function(V,I,A,B,E,Y){let H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7?arguments[7]:void 0,b=arguments.length>8?arguments[8]:void 0,X=arguments.length>9?arguments[9]:void 0;return M(V,{shape:I,path:A,scale:B,rotation:E,cap:0===Y?0:Y||F.c.NO_CAP,sideOrientation:b,instance:X,updatable:c},H)},F.c.ExtrudeShapeCustom=(V,I,A,B,E,Y,H,c,b,X,P,J)=>x(V,{shape:I,path:A,scaleFunction:B,rotationFunction:E,ribbonCloseArray:Y,ribbonClosePath:H,cap:0===c?0:c||F.c.NO_CAP,sideOrientation:P,instance:J,updatable:X},b);F.c.CreateLathe=(V,I,A,B,F,E,Y)=>R(V,{shape:I,radius:A,tessellation:B,sideOrientation:Y,updatable:E},F);var q=A(12541),N=A(12504);function l(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=I.path;let Y=I.instance,H=1;void 0!==I.radius?H=I.radius:Y&&(H=Y._creationDataStorage.radius);const c=I.tessellation||64,X=I.radiusFunction||null;let P=I.cap||F.c.NO_CAP;const J=I.invertUV||!1,G=I.updatable,w=F.c._GetDefaultSideOrientation(I.sideOrientation);I.arc=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1;const t=(V,I,A,E,Y,H,c,b)=>{const X=I.getTangents(),P=I.getNormals(),J=I.getDistances(),G=2*Math.PI/Y*b,w=H||(()=>E);let t,u,W,g;const o=B.TmpVectors.Matrix[0];let L=c===F.c.NO_CAP||c===F.c.CAP_END?0:2;for(let F=0;F<V.length;F++){u=w(F,J[F]),t=Array(),W=P[F];for(let I=0;I<Y;I++)B.Matrix.RotationAxisToRef(X[F],G*I,o),g=t[I]?t[I]:B.tI.Zero(),B.tI.TransformCoordinatesToRef(W,o,g),g.scaleInPlace(u).addInPlace(V[F]),t[I]=g;A[L]=t,L++}const z=(I,A)=>{const B=Array();for(let F=0;F<I;F++)B.push(V[A]);return B};switch(c){case F.c.NO_CAP:break;case F.c.CAP_START:A[0]=z(Y,0),A[1]=A[2].slice(0);break;case F.c.CAP_END:A[L]=A[L-1].slice(0),A[L+1]=z(Y,V.length-1);break;case F.c.CAP_ALL:A[0]=z(Y,0),A[1]=A[2].slice(0),A[L]=A[L-1].slice(0),A[L+1]=z(Y,V.length-1)}return A};let u,W;if(Y){const V=Y._creationDataStorage,A=I.arc||V.arc;return u=V.path3D.update(E),W=t(E,u,V.pathArray,H,V.tessellation,X,V.cap,A),Y=b("",{pathArray:W,instance:Y}),V.path3D=u,V.pathArray=W,V.arc=A,V.radius=H,Y}u=new r.m(E);P=P<0||P>3?0:P,W=t(E,u,new Array,H,c,X,P,I.arc);const g=b(V,{pathArray:W,closePath:!0,closeArray:!1,updatable:G,sideOrientation:w,invertUV:J,frontUVs:I.frontUVs,backUVs:I.backUVs},A);return g._creationDataStorage.pathArray=W,g._creationDataStorage.path3D=u,g._creationDataStorage.tessellation=c,g._creationDataStorage.cap=P,g._creationDataStorage.arc=I.arc,g._creationDataStorage.radius=H,g}function i(V){const I=[];I[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},I[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},I[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},I[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},I[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},I[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},I[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},I[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},I[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},I[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},I[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},I[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},I[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},I[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},I[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const A=V.type&&(V.type<0||V.type>=I.length)?0:V.type||0,F=V.size,E=V.sizeX||F||1,c=V.sizeY||F||1,b=V.sizeZ||F||1,X=V.custom||I[A],P=X.face.length,G=V.faceUV||new Array(P),w=V.faceColors,t=void 0===V.flat||V.flat,u=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,W=[],g=[],o=[],L=[],z=[];let m=0,s=0;const e=[];let S,Q,h,r,M,x,f=0,R=0;if(t)for(R=0;R<P;R++)w&&void 0===w[R]&&(w[R]=new J.GH(1,1,1,1)),G&&void 0===G[R]&&(G[R]=new B.Vector4(0,0,1,1));if(t)for(R=0;R<P;R++){const V=X.face[R].length;for(h=2*Math.PI/V,r=.5*Math.tan(h/2),M=.5,f=0;f<V;f++)W.push(X.vertex[X.face[R][f]][0]*E,X.vertex[X.face[R][f]][1]*c,X.vertex[X.face[R][f]][2]*b),e.push(m),m++,S=G[R].x+(G[R].z-G[R].x)*(.5+r),Q=G[R].y+(G[R].w-G[R].y)*(M-.5),L.push(S,H.b?1-Q:Q),x=r*Math.cos(h)-M*Math.sin(h),M=r*Math.sin(h)+M*Math.cos(h),r=x,w&&z.push(w[R].r,w[R].g,w[R].b,w[R].a);for(f=0;f<V-2;f++)g.push(e[0+s],e[f+2+s],e[f+1+s]);s+=V}else{for(f=0;f<X.vertex.length;f++)W.push(X.vertex[f][0]*E,X.vertex[f][1]*c,X.vertex[f][2]*b),L.push(0,H.b?1:0);for(R=0;R<P;R++)for(f=0;f<X.face[R].length-2;f++)g.push(X.face[R][0],X.face[R][f+2],X.face[R][f+1])}Y.e.ComputeNormals(W,g,o),Y.e._ComputeSides(u,W,g,o,L,V.frontUVs,V.backUVs);const q=new Y.e;return q.SV=W,q.indices=g,q.QV=o,q.rV=L,w&&t&&(q.hV=z),q}function y(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new F.c(V,A);I.sideOrientation=F.c._GetDefaultSideOrientation(I.sideOrientation),B._originalBuilderSideOrientation=I.sideOrientation;return i(I).xV(B,I.updatable),B}F.c.CreateTube=(V,I,A,B,F,E,Y,H,c,b)=>l(V,{path:I,radius:A,tessellation:B,radiusFunction:F,arc:1,cap:E,updatable:H,sideOrientation:c,instance:b},Y);function v(V){const I=V.sideOrientation||Y.e.DEFAULTSIDE,A=V.radius||1,F=void 0===V.flat||V.flat,E=0|(V.subdivisions||4),c=V.radiusX||A,b=V.radiusY||A,X=V.radiusZ||A,P=(1+Math.sqrt(5))/2,J=[-1,P,-0,1,P,0,-1,-P,0,1,-P,0,0,-1,-P,0,1,-P,0,-1,P,0,1,P,P,0,1,P,0,-1,-P,0,1,-P,0,-1],G=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],w=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],t=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],u=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],W=[],g=[],o=[],L=[];let z=0;const m=new Array(3),s=new Array(3);let e;for(e=0;e<3;e++)m[e]=B.tI.Zero(),s[e]=B.Vector2.Zero();for(let Y=0;Y<20;Y++){for(e=0;e<3;e++){const V=G[3*Y+e];m[e].XH(J[3*w[V]],J[3*w[V]+1],J[3*w[V]+2]),m[e].normalize(),s[e].XH(.134765625*t[2*V]+.05859375+-.0390625*u[Y],.2333984375*t[2*V+1]+.025390625+.01953125*u[Y])}const V=(V,I,A,Y)=>{const P=B.tI.Lerp(m[0],m[2],I/E),J=B.tI.Lerp(m[1],m[2],I/E),G=E===I?m[2]:B.tI.Lerp(P,J,V/(E-I));let w;if(G.normalize(),F){const V=B.tI.Lerp(m[0],m[2],Y/E),I=B.tI.Lerp(m[1],m[2],Y/E);w=B.tI.Lerp(V,I,A/(E-Y))}else w=new B.tI(G.x,G.y,G.z);w.x/=c,w.y/=b,w.z/=X,w.normalize();const t=B.Vector2.Lerp(s[0],s[2],I/E),u=B.Vector2.Lerp(s[1],s[2],I/E),e=E===I?s[2]:B.Vector2.Lerp(t,u,V/(E-I));g.push(G.x*c,G.y*b,G.z*X),o.push(w.x,w.y,w.z),L.push(e.x,H.b?1-e.y:e.y),W.push(z),z++};for(let I=0;I<E;I++)for(let A=0;A+I<E;A++)V(A,I,A+1/3,I+1/3),V(A+1,I,A+1/3,I+1/3),V(A,I+1,A+1/3,I+1/3),A+I+1<E&&(V(A+1,I,A+2/3,I+2/3),V(A+1,I+1,A+2/3,I+2/3),V(A,I+1,A+2/3,I+2/3))}Y.e._ComputeSides(I,g,W,o,L,V.frontUVs,V.backUVs);const S=new Y.e;return S.indices=W,S.SV=g,S.QV=o,S.rV=L,S}function C(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new F.c(V,A);I.sideOrientation=F.c._GetDefaultSideOrientation(I.sideOrientation),B._originalBuilderSideOrientation=I.sideOrientation;return v(I).xV(B,I.updatable),B}Y.e.CreatePolyhedron=i,F.c.CreatePolyhedron=(V,I,A)=>y(V,I,A);Y.e.CreateIcoSphere=v,F.c.CreateIcoSphere=(V,I,A)=>C(V,I,A);var K=A(11249);const p=new B.tI(1,0,0),j=new B.tI(-1,0,0),T=new B.tI(0,1,0),d=new B.tI(0,-1,0),D=new B.tI(0,0,1),O=new B.tI(0,0,-1);class Z{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.tI.Zero(),I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.tI.Up(),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.Vector2.Zero(),F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=V,this.normal=I,this.uv=A,this.vertexIdx=F,this.vertexIdxForBones=E,this.localPositionOverride=Y,this.localNormalOverride=H,this.matrixIndicesOverride=c,this.matrixWeightsOverride=b}clone(){var V,I,A,B;return new Z(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(V=this.localPositionOverride)||void 0===V?void 0:V.slice(),null===(I=this.localNormalOverride)||void 0===I?void 0:I.slice(),null===(A=this.matrixIndicesOverride)||void 0===A?void 0:A.slice(),null===(B=this.matrixWeightsOverride)||void 0===B?void 0:B.slice())}}function a(V,I,A){var c,b,X,P,J;const G=!!I.skeleton,w=!(null===(c=I.morphTargetManager)||void 0===c||!c.numTargets),t=A.localMode||G,u=I.cH(),W=G||w?I.SH(!0,!0):I.getVerticesData(E.g.PositionKind),g=G||w?I.getNormalsData(!0,!0):I.getVerticesData(E.g.NormalKind),o=t?G?I.getVerticesData(E.g.PositionKind):W:null,L=t?G?I.getVerticesData(E.g.NormalKind):g:null,z=I.getVerticesData(E.g.UVKind),m=G?I.getVerticesData(E.g.MatricesIndicesKind):null,s=G?I.getVerticesData(E.g.MatricesWeightsKind):null,e=G?I.getVerticesData(E.g.MatricesIndicesExtraKind):null,S=G?I.getVerticesData(E.g.MatricesWeightsExtraKind):null,Q=A.position||B.tI.Zero();let h=A.normal||B.tI.Up();const r=A.size||B.tI.One(),M=A.angle||0;if(!h){const V=new B.tI(0,0,1),A=I.sV().activeCamera,F=B.tI.TransformCoordinates(V,A.getWorldMatrix());h=A.globalPosition.uI(F)}const x=-Math.atan2(h.z,h.x)-Math.PI/2,f=Math.sqrt(h.x*h.x+h.z*h.z),R=Math.atan2(h.y,f),q=new Y.e;q.indices=[],q.SV=[],q.QV=[],q.rV=[],q.matricesIndices=G?[]:null,q.matricesWeights=G?[]:null,q.matricesIndicesExtra=e?[]:null,q.matricesWeightsExtra=S?[]:null;let N=0;const l=(V,I)=>{const F=new Z;if(!u||!W||!g)return F;const E=u[V];if(F.vertexIdx=3*E,F.vertexIdxForBones=4*E,F.position=new B.tI(W[3*E],W[3*E+1],W[3*E+2]),B.tI.TransformCoordinatesToRef(F.position,I,F.position),F.normal=new B.tI(g[3*E],g[3*E+1],g[3*E+2]),B.tI.TransformNormalToRef(F.normal,I,F.normal),A.captureUVS&&z){const V=z[2*E+1];F.uv=new B.Vector2(z[2*E],H.b?1-V:V)}return F},i=[0,0,0,0],y=(V,I)=>{if(0===V.length)return V;const A=.5*Math.abs(B.tI.Dot(r,I)),F=(V,I,A,B)=>{for(let F=0;F<B;++F)if(V[A+F]===I)return A+F;return-1},E=(V,E)=>{const Y=B.tI.GetClipFactor(V.position,E.position,I,A);let H=i,c=i;if(m&&s){const I=V.matrixIndicesOverride?0:V.vertexIdxForBones,A=V.matrixIndicesOverride??m,B=V.matrixWeightsOverride??s,b=E.matrixIndicesOverride?0:E.vertexIdxForBones,X=E.matrixIndicesOverride??m,P=E.matrixWeightsOverride??s;H=[0,0,0,0],c=[0,0,0,0];let J=0;for(let V=0;V<4;++V)if(B[I+V]>0){const E=F(X,A[I+V],b,4);H[J]=A[I+V],c[J]=(0,K.Lerp)(B[I+V],E>=0?P[E]:0,Y),J++}for(let V=0;V<4&&J<4;++V){const B=X[b+V];-1===F(A,B,I,4)&&(H[J]=B,c[J]=(0,K.Lerp)(0,P[b+V],Y),J++)}const G=c[0]+c[1]+c[2]+c[3];c[0]/=G,c[1]/=G,c[2]/=G,c[3]/=G}const b=V.localPositionOverride?V.localPositionOverride[0]:(null===o||void 0===o?void 0:o[V.vertexIdx])??0,X=V.localPositionOverride?V.localPositionOverride[1]:(null===o||void 0===o?void 0:o[V.vertexIdx+1])??0,P=V.localPositionOverride?V.localPositionOverride[2]:(null===o||void 0===o?void 0:o[V.vertexIdx+2])??0,J=E.localPositionOverride?E.localPositionOverride[0]:(null===o||void 0===o?void 0:o[E.vertexIdx])??0,G=E.localPositionOverride?E.localPositionOverride[1]:(null===o||void 0===o?void 0:o[E.vertexIdx+1])??0,w=E.localPositionOverride?E.localPositionOverride[2]:(null===o||void 0===o?void 0:o[E.vertexIdx+2])??0,t=V.localNormalOverride?V.localNormalOverride[0]:(null===L||void 0===L?void 0:L[V.vertexIdx])??0,u=V.localNormalOverride?V.localNormalOverride[1]:(null===L||void 0===L?void 0:L[V.vertexIdx+1])??0,W=V.localNormalOverride?V.localNormalOverride[2]:(null===L||void 0===L?void 0:L[V.vertexIdx+2])??0,g=t+((E.localNormalOverride?E.localNormalOverride[0]:(null===L||void 0===L?void 0:L[E.vertexIdx])??0)-t)*Y,z=u+((E.localNormalOverride?E.localNormalOverride[1]:(null===L||void 0===L?void 0:L[E.vertexIdx+1])??0)-u)*Y,e=W+((E.localNormalOverride?E.localNormalOverride[2]:(null===L||void 0===L?void 0:L[E.vertexIdx+2])??0)-W)*Y,S=Math.sqrt(g*g+z*z+e*e);return new Z(B.tI.Lerp(V.position,E.position,Y),B.tI.Lerp(V.normal,E.normal,Y).normalize(),B.Vector2.Lerp(V.uv,E.uv,Y),-1,-1,o?[b+(J-b)*Y,X+(G-X)*Y,P+(w-P)*Y]:null,L?[g/S,z/S,e/S]:null,H,c)};let Y=null;V.length>3&&(Y=[]);for(let H=0;H<V.length;H+=3){let F=0,c=null,b=null,X=null,P=null;const J=B.tI.Dot(V[H].position,I)-A>0,G=B.tI.Dot(V[H+1].position,I)-A>0,w=B.tI.Dot(V[H+2].position,I)-A>0;switch(F=(J?1:0)+(G?1:0)+(w?1:0),F){case 0:V.length>3?(Y.push(V[H]),Y.push(V[H+1]),Y.push(V[H+2])):Y=V;break;case 1:if(Y=Y??new Array,J&&(c=V[H+1],b=V[H+2],X=E(V[H],c),P=E(V[H],b)),G){c=V[H],b=V[H+2],X=E(V[H+1],c),P=E(V[H+1],b),Y.push(X),Y.push(b.clone()),Y.push(c.clone()),Y.push(b.clone()),Y.push(X.clone()),Y.push(P);break}w&&(c=V[H],b=V[H+1],X=E(V[H+2],c),P=E(V[H+2],b)),c&&b&&X&&P&&(Y.push(c.clone()),Y.push(b.clone()),Y.push(X),Y.push(P),Y.push(X.clone()),Y.push(b.clone()));break;case 2:Y=Y??new Array,J||(c=V[H].clone(),b=E(c,V[H+1]),X=E(c,V[H+2]),Y.push(c),Y.push(b),Y.push(X)),G||(c=V[H+1].clone(),b=E(c,V[H+2]),X=E(c,V[H]),Y.push(c),Y.push(b),Y.push(X)),w||(c=V[H+2].clone(),b=E(c,V[H]),X=E(c,V[H+1]),Y.push(c),Y.push(b),Y.push(X))}}return Y},v=I instanceof F.c?I:null,C=null===v||void 0===v?void 0:v._thinInstanceDataStorage.matrixData,a=(null===v||void 0===v?void 0:v.tH)||1,k=B.TmpVectors.Matrix[0];k.B(B.Matrix.IdentityReadOnly);for(let F=0;F<a;++F){if(null!==v&&void 0!==v&&v.hasThinInstances&&C){const V=16*F;k.setRowFromFloats(0,C[V+0],C[V+1],C[V+2],C[V+3]),k.setRowFromFloats(1,C[V+4],C[V+5],C[V+6],C[V+7]),k.setRowFromFloats(2,C[V+8],C[V+9],C[V+10],C[V+11]),k.setRowFromFloats(3,C[V+12],C[V+13],C[V+14],C[V+15])}const V=B.Matrix.RotationYawPitchRoll(x,R,M).multiply(B.Matrix.Translation(Q.x,Q.y,Q.z)),E=B.Matrix.Invert(V),Y=I.getWorldMatrix(),c=k.multiply(Y).multiply(E),b=new Array(3);for(let I=0;I<u.length;I+=3){let V=b;if(V[0]=l(I,c),V[1]=l(I+1,c),V[2]=l(I+2,c),!(A.cullBackFaces&&-V[0].normal.z<=0&&-V[1].normal.z<=0&&-V[2].normal.z<=0)&&(V=y(V,p),V&&(V=y(V,j),V&&(V=y(V,T),V&&(V=y(V,d),V&&(V=y(V,D),V&&(V=y(V,O),V)))))))for(let I=0;I<V.length;I++){const B=V[I];if(q.indices.push(N),t?(B.localPositionOverride?(q.SV[3*N]=B.localPositionOverride[0],q.SV[3*N+1]=B.localPositionOverride[1],q.SV[3*N+2]=B.localPositionOverride[2]):o&&(q.SV[3*N]=o[B.vertexIdx],q.SV[3*N+1]=o[B.vertexIdx+1],q.SV[3*N+2]=o[B.vertexIdx+2]),B.localNormalOverride?(q.QV[3*N]=B.localNormalOverride[0],q.QV[3*N+1]=B.localNormalOverride[1],q.QV[3*N+2]=B.localNormalOverride[2]):L&&(q.QV[3*N]=L[B.vertexIdx],q.QV[3*N+1]=L[B.vertexIdx+1],q.QV[3*N+2]=L[B.vertexIdx+2])):(B.position.toArray(q.SV,3*N),B.normal.toArray(q.QV,3*N)),q.matricesIndices&&q.matricesWeights&&(B.matrixIndicesOverride?(q.matricesIndices[4*N]=B.matrixIndicesOverride[0],q.matricesIndices[4*N+1]=B.matrixIndicesOverride[1],q.matricesIndices[4*N+2]=B.matrixIndicesOverride[2],q.matricesIndices[4*N+3]=B.matrixIndicesOverride[3]):(m&&(q.matricesIndices[4*N]=m[B.vertexIdxForBones],q.matricesIndices[4*N+1]=m[B.vertexIdxForBones+1],q.matricesIndices[4*N+2]=m[B.vertexIdxForBones+2],q.matricesIndices[4*N+3]=m[B.vertexIdxForBones+3]),e&&q.matricesIndicesExtra&&(q.matricesIndicesExtra[4*N]=e[B.vertexIdxForBones],q.matricesIndicesExtra[4*N+1]=e[B.vertexIdxForBones+1],q.matricesIndicesExtra[4*N+2]=e[B.vertexIdxForBones+2],q.matricesIndicesExtra[4*N+3]=e[B.vertexIdxForBones+3])),B.matrixWeightsOverride?(q.matricesWeights[4*N]=B.matrixWeightsOverride[0],q.matricesWeights[4*N+1]=B.matrixWeightsOverride[1],q.matricesWeights[4*N+2]=B.matrixWeightsOverride[2],q.matricesWeights[4*N+3]=B.matrixWeightsOverride[3]):(s&&(q.matricesWeights[4*N]=s[B.vertexIdxForBones],q.matricesWeights[4*N+1]=s[B.vertexIdxForBones+1],q.matricesWeights[4*N+2]=s[B.vertexIdxForBones+2],q.matricesWeights[4*N+3]=s[B.vertexIdxForBones+3]),S&&q.matricesWeightsExtra&&(q.matricesWeightsExtra[4*N]=S[B.vertexIdxForBones],q.matricesWeightsExtra[4*N+1]=S[B.vertexIdxForBones+1],q.matricesWeightsExtra[4*N+2]=S[B.vertexIdxForBones+2],q.matricesWeightsExtra[4*N+3]=S[B.vertexIdxForBones+3]))),A.captureUVS)B.uv.toArray(q.rV,2*N);else{q.rV.push(.5+B.position.x/r.x);const V=.5+B.position.y/r.y;q.rV.push(H.b?1-V:V)}N++}}}0===q.indices.length&&(q.indices=null),0===q.SV.length&&(q.SV=null),0===q.QV.length&&(q.QV=null),0===q.rV.length&&(q.rV=null),0===(null===(b=q.matricesIndices)||void 0===b?void 0:b.length)&&(q.matricesIndices=null),0===(null===(X=q.matricesWeights)||void 0===X?void 0:X.length)&&(q.matricesWeights=null),0===(null===(P=q.matricesIndicesExtra)||void 0===P?void 0:P.length)&&(q.matricesIndicesExtra=null),0===(null===(J=q.matricesWeightsExtra)||void 0===J?void 0:J.length)&&(q.matricesWeightsExtra=null);const U=new F.c(V,I.sV());return q.xV(U),t?(U.skeleton=I.skeleton,U.parent=I):(U.position=Q.clone(),U.rotation=new B.tI(R,x,M)),U.YH(!0),U.refreshBoundingInfo(!0,!0),U}function k(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const I=0|Math.max(V.subdivisions?V.subdivisions:2,1),A=0|Math.max(V.tessellation?V.tessellation:16,3),F=Math.max(V.height?V.height:1,0),E=Math.max(V.radius?V.radius:.25,0),c=0|Math.max(V.capSubdivisions?V.capSubdivisions:6,1),b=A,X=I,P=Math.max(V.radiusTop?V.radiusTop:E,0),J=Math.max(V.radiusBottom?V.radiusBottom:E,0),G=F-(P+J),w=2*Math.PI,t=Math.max(V.topCapSubdivisions?V.topCapSubdivisions:c,1),u=Math.max(V.bottomCapSubdivisions?V.bottomCapSubdivisions:c,1),W=Math.acos((J-P)/F);let g=[];const o=[],L=[],z=[];let m=0;const s=[],e=.5*G,S=.5*Math.PI;let Q,h;const r=B.tI.Zero(),M=B.tI.Zero(),x=Math.cos(W),f=Math.sin(W),R=new B.Vector2(P*f,e+P*x).uI(new B.Vector2(J*f,J*x-e)).length(),q=P*W+R+J*(S-W);let N=0;for(h=0;h<=t;h++){const V=[],I=S-W*(h/t);N+=P*W/t;const A=Math.cos(I),B=Math.sin(I),F=A*P;for(Q=0;Q<=b;Q++){const I=Q/b,E=I*w+0,Y=Math.sin(E),c=Math.cos(E);M.x=F*Y,M.y=e+B*P,M.z=F*c,o.push(M.x,M.y,M.z),r.set(A*Y,B,A*c),L.push(r.x,r.y,r.z),z.push(I,H.b?N/q:1-N/q),V.push(m),m++}s.push(V)}const l=F-P-J+x*P-x*J,i=f*(J-P)/l;for(h=1;h<=X;h++){const V=[];N+=R/X;const I=f*(h*(J-P)/X+P);for(Q=0;Q<=b;Q++){const A=Q/b,B=A*w+0,F=Math.sin(B),E=Math.cos(B);M.x=I*F,M.y=e+x*P-h*l/X,M.z=I*E,o.push(M.x,M.y,M.z),r.set(F,i,E).normalize(),L.push(r.x,r.y,r.z),z.push(A,H.b?N/q:1-N/q),V.push(m),m++}s.push(V)}for(h=1;h<=u;h++){const V=[],I=S-W-(Math.PI-W)*(h/u);N+=J*W/u;const A=Math.cos(I),B=Math.sin(I),F=A*J;for(Q=0;Q<=b;Q++){const I=Q/b,E=I*w+0,Y=Math.sin(E),c=Math.cos(E);M.x=F*Y,M.y=B*J-e,M.z=F*c,o.push(M.x,M.y,M.z),r.set(A*Y,B,A*c),L.push(r.x,r.y,r.z),z.push(I,H.b?N/q:1-N/q),V.push(m),m++}s.push(V)}for(Q=0;Q<b;Q++)for(h=0;h<t+X+u;h++){const V=s[h][Q],I=s[h+1][Q],A=s[h+1][Q+1],B=s[h][Q+1];g.push(V),g.push(I),g.push(B),g.push(I),g.push(A),g.push(B)}if(g=g.reverse(),V.orientation&&!V.orientation.equals(B.tI.Up())){const I=new B.Matrix;V.orientation.clone().scale(.5*Math.PI).cross(B.tI.Up()).toQuaternion().toRotationMatrix(I);const A=B.tI.Zero();for(let V=0;V<o.length;V+=3)A.set(o[V],o[V+1],o[V+2]),B.tI.TransformCoordinatesToRef(A.clone(),I,A),o[V]=A.x,o[V+1]=A.y,o[V+2]=A.z}const y=new Y.e;return y.SV=o,y.QV=L,y.rV=z,y.indices=g,y}function U(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:B.tI.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new F.c(V,A);return k(I).xV(E,I.updatable),E}F.c.CreateDecal=(V,I,A,B,F,E)=>a(V,I,{position:A,normal:B,size:F,angle:E});F.c.CreateCapsule=(V,I,A)=>U(V,I,A),Y.e.CreateCapsule=k;var n=A(11064),VV=A(11237);class IV{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=V,this.y=I,V!==Math.floor(V)&&(V=Math.floor(V),n.b.Warn("x is not an integer, floor(x) used")),I!==Math.floor(I)&&(I=Math.floor(I),n.b.Warn("y is not an integer, floor(y) used"))}clone(){return new IV(this.x,this.y)}rotate60About(V){const I=this.x;return this.x=V.x+V.y-this.y,this.y=I+this.y-V.x,this}rotateNeg60About(V){const I=this.x;return this.x=I+this.y-V.y,this.y=V.x+V.y-I,this}rotate120(V,I){V!==Math.floor(V)&&(V=Math.floor(V),n.b.Warn("m not an integer only floor(m) used")),I!==Math.floor(I)&&(I=Math.floor(I),n.b.Warn("n not an integer only floor(n) used"));const A=this.x;return this.x=V-A-this.y,this.y=I+A,this}rotateNeg120(V,I){V!==Math.floor(V)&&(V=Math.floor(V),n.b.Warn("m is not an integer, floor(m) used")),I!==Math.floor(I)&&(I=Math.floor(I),n.b.Warn("n is not an integer,   floor(n) used"));const A=this.x;return this.x=this.y-I,this.y=V+I-A-this.y,this}toCartesianOrigin(V,I){const A=B.tI.Zero();return A.x=V.x+2*this.x*I+this.y*I,A.y=V.y+Math.sqrt(3)*this.y*I,A}static Zero(){return new IV(0,0)}}class AV{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new BV("icosahedron","Regular",[[0,VV.e,-1],[-VV.e,1,0],[-1,0,-VV.e],[1,0,-VV.e],[VV.e,1,0],[0,VV.e,1],[-1,0,VV.e],[-VV.e,-1,0],[0,-VV.e,-1],[VV.e,-1,0],[1,0,VV.e],[0,-VV.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let V=12;const I={},A=this.m,B=this.n;let F,E,Y,H,c,b=A,X=1,P=0;0!==B&&(b=(0,K.HighestCommonFactor)(A,B)),X=A/b,P=B/b;const J=IV.Zero(),G=new IV(A,B),w=new IV(-B,A+B),t=IV.Zero(),u=IV.Zero(),W=IV.Zero();let g,o,L,z,m=[];const s=[],e=this.vertByDist,S=(A,B,F,E)=>{g=A+"|"+F,o=B+"|"+E,g in I||o in I?g in I&&!(o in I)?I[o]=I[g]:o in I&&!(g in I)&&(I[g]=I[o]):(I[g]=V,I[o]=V,V++),e[F][0]>2?s[I[g]]=[-e[F][0],e[F][1],I[g]]:s[I[g]]=[m[e[F][0]],e[F][1],I[g]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let Q=0;Q<20;Q++){if(m=this.IDATA.face[Q],Y=m[2],H=m[1],c=m[0],L=J.x+"|"+J.y,g=Q+"|"+L,g in I||(I[g]=Y,s[Y]=[m[e[L][0]],e[L][1]]),L=G.x+"|"+G.y,g=Q+"|"+L,g in I||(I[g]=H,s[H]=[m[e[L][0]],e[L][1]]),L=w.x+"|"+w.y,g=Q+"|"+L,g in I||(I[g]=c,s[c]=[m[e[L][0]],e[L][1]]),F=this.IDATA.edgematch[Q][0],E=this.IDATA.edgematch[Q][1],"B"===E)for(let V=1;V<b;V++)u.x=A-V*(X+P),u.y=B+V*X,W.x=-V*P,W.y=V*(X+P),L=u.x+"|"+u.y,z=W.x+"|"+W.y,S(Q,F,L,z);if("O"===E)for(let V=1;V<b;V++)W.x=-V*P,W.y=V*(X+P),t.x=V*X,t.y=V*P,L=W.x+"|"+W.y,z=t.x+"|"+t.y,S(Q,F,L,z);if(F=this.IDATA.edgematch[Q][2],E=this.IDATA.edgematch[Q][3],E&&"A"===E)for(let V=1;V<b;V++)t.x=V*X,t.y=V*P,u.x=A-(b-V)*(X+P),u.y=B+(b-V)*X,L=t.x+"|"+t.y,z=u.x+"|"+u.y,S(Q,F,L,z);for(let A=0;A<this.vertices.length;A++)L=this.vertices[A].x+"|"+this.vertices[A].y,g=Q+"|"+L,g in I||(I[g]=V++,e[L][0]>2?s[I[g]]=[-e[L][0],e[L][1],I[g]]:s[I[g]]=[m[e[L][0]],e[L][1],I[g]])}this.closestTo=s,this.vecToidx=I}calcCoeffs(){const V=this.m,I=this.n,A=Math.sqrt(3)/3,B=V*V+I*I+V*I;this.coau=(V+I)/B,this.cobu=-I/B,this.coav=-A*(V-I)/B,this.cobv=A*(2*V+I)/B}createInnerFacets(){const V=this.m,I=this.n;for(let A=0;A<I+V+1;A++)for(let V=this.min[A];V<this.max[A]+1;V++)V<this.max[A]&&V<this.max[A+1]+1&&this.innerFacets.push(["|"+V+"|"+A,"|"+V+"|"+(A+1),"|"+(V+1)+"|"+A]),A>0&&V<this.max[A-1]&&V+1<this.max[A]+1&&this.innerFacets.push(["|"+V+"|"+A,"|"+(V+1)+"|"+A,"|"+(V+1)+"|"+(A-1)])}edgeVecsABOB(){const V=this.m,I=this.n,A=new IV(-I,V+I);for(let B=1;B<V+I;B++){const V=new IV(this.min[B],B),I=new IV(this.min[B-1],B-1),F=new IV(this.min[B+1],B+1),E=V.clone(),Y=I.clone(),H=F.clone();E.rotate60About(A),Y.rotate60About(A),H.rotate60About(A);const c=new IV(this.max[E.y],E.y),b=new IV(this.max[E.y-1],E.y-1),X=new IV(this.max[E.y-1]-1,E.y-1);E.x===c.x&&E.y===c.y||(E.x!==b.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,b,X]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,X,c])):E.y===H.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([V,I,b]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([V,b,F])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([V,I,b]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,b,c])))}}mapABOBtoOBOA(){const V=new IV(0,0);for(let I=0;I<this.isoVecsABOB.length;I++){const A=[];for(let B=0;B<3;B++)V.x=this.isoVecsABOB[I][B].x,V.y=this.isoVecsABOB[I][B].y,0===this.vertexTypes[I][B]&&V.rotateNeg120(this.m,this.n),A.push(V.clone());this.isoVecsOBOA.push(A)}}mapABOBtoBAOA(){const V=new IV(0,0);for(let I=0;I<this.isoVecsABOB.length;I++){const A=[];for(let B=0;B<3;B++)V.x=this.isoVecsABOB[I][B].x,V.y=this.isoVecsABOB[I][B].y,1===this.vertexTypes[I][B]&&V.rotate120(this.m,this.n),A.push(V.clone());this.isoVecsBAOA.push(A)}}MapToFace(V,I){const A=this.IDATA.face[V],F=A[2],E=A[1],Y=A[0],H=B.tI.LI(this.IDATA.vertex[F]),c=B.tI.LI(this.IDATA.vertex[E]),b=B.tI.LI(this.IDATA.vertex[Y]),X=c.uI(H),P=b.uI(H),J=X.scale(this.coau).add(P.scale(this.cobu)),G=X.scale(this.coav).add(P.scale(this.cobv)),w=[];let t,u=B.TmpVectors.tI[0];for(let B=0;B<this.cartesian.length;B++)u=J.scale(this.cartesian[B].x).add(G.scale(this.cartesian[B].y)).add(H),w[B]=[u.x,u.y,u.z],t=V+"|"+this.vertices[B].x+"|"+this.vertices[B].y,I.vertex[this.vecToidx[t]]=[u.x,u.y,u.z]}build(V,I){const A=[],B=IV.Zero(),F=new IV(V,I),E=new IV(-I,V+I);A.push(B,F,E);for(let L=I;L<V+1;L++)for(let I=0;I<V+1-L;I++)A.push(new IV(I,L));if(I>0){const B=(0,K.HighestCommonFactor)(V,I),F=V/B,E=I/B;for(let H=1;H<B;H++)A.push(new IV(H*F,H*E)),A.push(new IV(-H*E,H*(F+E))),A.push(new IV(V-H*(F+E),I+H*F));const Y=V/I;for(let H=1;H<I;H++)for(let B=0;B<H*Y;B++)A.push(new IV(B,H)),A.push(new IV(B,H).rotate120(V,I)),A.push(new IV(B,H).rotateNeg120(V,I))}A.sort(((V,I)=>V.x-I.x)),A.sort(((V,I)=>V.y-I.y));const Y=new Array(V+I+1),H=new Array(V+I+1);for(let L=0;L<Y.length;L++)Y[L]=1/0,H[L]=-1/0;let c=0,b=0;const X=A.length;for(let L=0;L<X;L++)b=A[L].x,c=A[L].y,Y[c]=Math.min(b,Y[c]),H[c]=Math.max(b,H[c]);const P=(A,B)=>{const F=A.clone();return"A"===B&&F.rotateNeg120(V,I),"B"===B&&F.rotate120(V,I),F.x<0?F.y:F.x+F.y},J=[],G=[],w=[],t=[],u={},W=[];let g=-1,o=-1;for(let L=0;L<X;L++)J[L]=A[L].toCartesianOrigin(new IV(0,0),.5),G[L]=P(A[L],"O"),w[L]=P(A[L],"A"),t[L]=P(A[L],"B"),G[L]===w[L]&&w[L]===t[L]?(g=3,o=G[L]):G[L]===w[L]?(g=4,o=G[L]):w[L]===t[L]?(g=5,o=w[L]):t[L]===G[L]&&(g=6,o=G[L]),G[L]<w[L]&&G[L]<t[L]&&(g=2,o=G[L]),w[L]<G[L]&&w[L]<t[L]&&(g=1,o=w[L]),t[L]<w[L]&&t[L]<G[L]&&(g=0,o=t[L]),W.push([g,o,A[L].x,A[L].y]);W.sort(((V,I)=>V[2]-I[2])),W.sort(((V,I)=>V[3]-I[3])),W.sort(((V,I)=>V[1]-I[1])),W.sort(((V,I)=>V[0]-I[0]));for(let L=0;L<W.length;L++)u[W[L][2]+"|"+W[L][3]]=[W[L][0],W[L][1],L];return this.m=V,this.n=I,this.vertices=A,this.vertByDist=u,this.cartesian=J,this.min=Y,this.max=H,this}}class BV{constructor(V,I,A,B){this.name=V,this.category=I,this.vertex=A,this.face=B}}class FV extends BV{innerToData(V,I){for(let A=0;A<I.innerFacets.length;A++)this.face.push(I.innerFacets[A].map((A=>I.vecToidx[V+A])))}mapABOBtoDATA(V,I){const A=I.IDATA.edgematch[V][0];for(let B=0;B<I.isoVecsABOB.length;B++){const F=[];for(let E=0;E<3;E++)0===I.vertexTypes[B][E]?F.push(V+"|"+I.isoVecsABOB[B][E].x+"|"+I.isoVecsABOB[B][E].y):F.push(A+"|"+I.isoVecsABOB[B][E].x+"|"+I.isoVecsABOB[B][E].y);this.face.push([I.vecToidx[F[0]],I.vecToidx[F[1]],I.vecToidx[F[2]]])}}mapOBOAtoDATA(V,I){const A=I.IDATA.edgematch[V][0];for(let B=0;B<I.isoVecsOBOA.length;B++){const F=[];for(let E=0;E<3;E++)1===I.vertexTypes[B][E]?F.push(V+"|"+I.isoVecsOBOA[B][E].x+"|"+I.isoVecsOBOA[B][E].y):F.push(A+"|"+I.isoVecsOBOA[B][E].x+"|"+I.isoVecsOBOA[B][E].y);this.face.push([I.vecToidx[F[0]],I.vecToidx[F[1]],I.vecToidx[F[2]]])}}mapBAOAtoDATA(V,I){const A=I.IDATA.edgematch[V][2];for(let B=0;B<I.isoVecsBAOA.length;B++){const F=[];for(let E=0;E<3;E++)1===I.vertexTypes[B][E]?F.push(V+"|"+I.isoVecsBAOA[B][E].x+"|"+I.isoVecsBAOA[B][E].y):F.push(A+"|"+I.isoVecsBAOA[B][E].x+"|"+I.isoVecsBAOA[B][E].y);this.face.push([I.vecToidx[F[0]],I.vecToidx[F[1]],I.vecToidx[F[2]]])}}orderData(V){const I=[];for(let E=0;E<13;E++)I[E]=[];const A=V.closestTo;for(let E=0;E<A.length;E++)A[E][0]>-1?A[E][1]>0&&I[A[E][0]].push([E,A[E][1]]):I[12].push([E,A[E][0]]);const B=[];for(let E=0;E<12;E++)B[E]=E;let F=12;for(let E=0;E<12;E++){I[E].sort(((V,I)=>V[1]-I[1]));for(let V=0;V<I[E].length;V++)B[I[E][V][0]]=F++}for(let E=0;E<I[12].length;E++)B[I[12][E][0]]=F++;for(let E=0;E<this.vertex.length;E++)this.vertex[E].push(B[E]);this.vertex.sort(((V,I)=>V[3]-I[3]));for(let E=0;E<this.vertex.length;E++)this.vertex[E].pop();for(let E=0;E<this.face.length;E++)for(let V=0;V<this.face[E].length;V++)this.face[E][V]=B[this.face[E][V]];this.sharedNodes=I[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(V,I){const A=[],B=[];let F=I.pop();B.push(F);let E=this.face[F].indexOf(V);E=(E+2)%3;let Y=this.face[F][E];A.push(Y);let H=0;for(;I.length>0;)F=I[H],this.face[F].indexOf(Y)>-1?(E=(this.face[F].indexOf(Y)+1)%3,Y=this.face[F][E],A.push(Y),B.push(F),I.splice(H,1),H=0):H++;return this.adjacentFaces.push(A),B}toGoldbergPolyhedronData(){const V=new BV("GeoDual","Goldberg",[],[]);V.name="GD dual";const I=this.vertex.length,A=new Array(I);for(let c=0;c<I;c++)A[c]=[];for(let c=0;c<this.face.length;c++)for(let V=0;V<3;V++)A[this.face[c][V]].push(c);let B=0,F=0,E=0,Y=[],H=[];this.adjacentFaces=[];for(let c=0;c<A.length;c++){V.face[c]=this.setOrder(c,A[c].concat([]));for(const I of A[c]){B=0,F=0,E=0,Y=this.face[I];for(let V=0;V<3;V++)H=this.vertex[Y[V]],B+=H[0],F+=H[1],E+=H[2];V.vertex[I]=[B/3,F/3,E/3]}}return V}static BuildGeodesicData(V){const I=new FV("Geodesic-m-n","Geodesic",[[0,VV.e,-1],[-VV.e,1,0],[-1,0,-VV.e],[1,0,-VV.e],[VV.e,1,0],[0,VV.e,1],[-1,0,VV.e],[-VV.e,-1,0],[0,-VV.e,-1],[VV.e,-1,0],[1,0,VV.e],[0,-VV.e,1]],[]);V.setIndices(),V.calcCoeffs(),V.createInnerFacets(),V.edgeVecsABOB(),V.mapABOBtoOBOA(),V.mapABOBtoBAOA();for(let A=0;A<V.IDATA.face.length;A++)V.MapToFace(A,I),I.innerToData(A,V),"B"===V.IDATA.edgematch[A][1]&&I.mapABOBtoDATA(A,V),"O"===V.IDATA.edgematch[A][1]&&I.mapOBOAtoDATA(A,V),"A"===V.IDATA.edgematch[A][3]&&I.mapBAOAtoDATA(A,V);I.orderData(V);return I.vertex=I.vertex.map((function(V){const I=V[0],A=V[1],B=V[2],F=Math.sqrt(I*I+A*A+B*B);return V[0]*=1/F,V[1]*=1/F,V[2]*=1/F,V})),I}}F.c._GoldbergMeshParser=(V,I)=>EV.Parse(V,I);class EV extends F.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(V,I){return void 0===I?(V>this.goldbergData.nbUnsharedFaces-1&&(n.b.Warn("Maximum number of unshared faces used"),V=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+V):(V>11&&(n.b.Warn("Last pole used"),V=11),I>this.goldbergData.nbFacesAtPole-1&&(n.b.Warn("Maximum number of faces at a pole used"),I=this.goldbergData.nbFacesAtPole-1),12+V*this.goldbergData.nbFacesAtPole+I)}_changeGoldbergFaceColors(V){for(let A=0;A<V.length;A++){const I=V[A][0],B=V[A][1],F=V[A][2];for(let V=I;V<B+1;V++)this.goldbergData.faceColors[V]=F}const I=[];for(let A=0;A<12;A++)for(let V=0;V<5;V++)I.push(this.goldbergData.faceColors[A].r,this.goldbergData.faceColors[A].g,this.goldbergData.faceColors[A].b,this.goldbergData.faceColors[A].a);for(let A=12;A<this.goldbergData.faceColors.length;A++)for(let V=0;V<6;V++)I.push(this.goldbergData.faceColors[A].r,this.goldbergData.faceColors[A].g,this.goldbergData.faceColors[A].b,this.goldbergData.faceColors[A].a);return I}setGoldbergFaceColors(V){const I=this._changeGoldbergFaceColors(V);this.NV(E.g.ColorKind,I)}updateGoldbergFaceColors(V){const I=this._changeGoldbergFaceColors(V);this.updateVerticesData(E.g.ColorKind,I)}_changeGoldbergFaceUVs(V){const I=this.getVerticesData(E.g.UVKind);for(let A=0;A<V.length;A++){const B=V[A][0],F=V[A][1],E=V[A][2],Y=V[A][3],H=V[A][4],c=[],b=[];let X,P;for(let V=0;V<5;V++)X=E.x+Y*Math.cos(H+V*Math.PI/2.5),P=E.y+Y*Math.sin(H+V*Math.PI/2.5),X<0&&(X=0),X>1&&(X=1),c.push(X,P);for(let V=0;V<6;V++)X=E.x+Y*Math.cos(H+V*Math.PI/3),P=E.y+Y*Math.sin(H+V*Math.PI/3),X<0&&(X=0),X>1&&(X=1),b.push(X,P);for(let V=B;V<Math.min(12,F+1);V++)for(let A=0;A<5;A++)I[10*V+2*A]=c[2*A],I[10*V+2*A+1]=c[2*A+1];for(let V=Math.max(12,B);V<F+1;V++)for(let A=0;A<6;A++)I[12*V-24+2*A]=b[2*A],I[12*V-23+2*A]=b[2*A+1]}return I}setGoldbergFaceUVs(V){const I=this._changeGoldbergFaceUVs(V);this.NV(E.g.UVKind,I)}updateGoldbergFaceUVs(V){const I=this._changeGoldbergFaceUVs(V);this.updateVerticesData(E.g.UVKind,I)}placeOnGoldbergFaceAt(V,I,A){const F=B.tI.RotationFromAxis(this.goldbergData.faceXaxis[I],this.goldbergData.faceYaxis[I],this.goldbergData.faceZaxis[I]);V.rotation=F,V.position=this.goldbergData.faceCenters[I].add(this.goldbergData.faceXaxis[I].scale(A.x)).add(this.goldbergData.faceYaxis[I].scale(A.y)).add(this.goldbergData.faceZaxis[I].scale(A.z))}serialize(V){super.serialize(V),V.type="GoldbergMesh";const I={};if(I.adjacentFaces=this.goldbergData.adjacentFaces,I.nbSharedFaces=this.goldbergData.nbSharedFaces,I.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,I.nbFaces=this.goldbergData.nbFaces,I.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){I.faceColors=[];for(const V of this.goldbergData.faceColors)I.faceColors.push(V.AH())}if(this.goldbergData.faceCenters){I.faceCenters=[];for(const V of this.goldbergData.faceCenters)I.faceCenters.push(V.AH())}if(this.goldbergData.faceZaxis){I.faceZaxis=[];for(const V of this.goldbergData.faceZaxis)I.faceZaxis.push(V.AH())}if(this.goldbergData.faceYaxis){I.faceYaxis=[];for(const V of this.goldbergData.faceYaxis)I.faceYaxis.push(V.AH())}if(this.goldbergData.faceXaxis){I.faceXaxis=[];for(const V of this.goldbergData.faceXaxis)I.faceXaxis.push(V.AH())}V.goldbergData=I}static Parse(V,I){const A=V.goldbergData;A.faceColors=A.faceColors.map((V=>J.GH.LI(V))),A.faceCenters=A.faceCenters.map((V=>B.tI.LI(V))),A.faceZaxis=A.faceZaxis.map((V=>B.tI.LI(V))),A.faceXaxis=A.faceXaxis.map((V=>B.tI.LI(V))),A.faceYaxis=A.faceYaxis.map((V=>B.tI.LI(V)));const F=new EV(V.name,I);return F.goldbergData=A,F}}var YV=A(11816);const HV={CreateBox:P.c,CreateTiledBox:u,CreateSphere:W.d,CreateDisc:X.d,CreateIcoSphere:C,CreateRibbon:b,CreateCylinder:z,CreateTorus:s,CreateTorusKnot:S,CreateLineSystem:Q.f,RX:Q.i,CreateDashedLines:Q.d,ExtrudeShape:M,ExtrudeShapeCustom:x,CreateLathe:R,CreateTiledPlane:w,NX:q.d,CreateGround:N.e,CreateTiledGround:N.i,CreateGroundFromHeightMap:N.c,CreatePolygon:h.e,ExtrudePolygon:h.h,CreateTube:l,CreatePolyhedron:y,CreateGeodesic:function(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=I.m||1;B!==Math.floor(B)&&(B=Math.floor(B),n.b.Warn("m not an integer only floor(m) used"));let F=I.n||0;if(F!==Math.floor(F)&&(F=Math.floor(F),n.b.Warn("n not an integer only floor(n) used")),F>B){const V=F;F=B,B=V,n.b.Warn("n > m therefore m and n swapped")}const E=new AV;return E.build(B,F),y(V,{custom:FV.BuildGeodesicData(E),size:I.size,sizeX:I.sizeX,sizeY:I.sizeY,sizeZ:I.sizeZ,faceUV:I.faceUV,faceColors:I.faceColors,flat:I.flat,updatable:I.updatable,sideOrientation:I.sideOrientation,frontUVs:I.frontUVs,backUVs:I.backUVs},A)},CreateGoldberg:function(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=I.size,c=I.sizeX||E||1,b=I.sizeY||E||1,X=I.sizeZ||E||1;let P=I.m||1;P!==Math.floor(P)&&(P=Math.floor(P),n.b.Warn("m not an integer only floor(m) used"));let G=I.n||0;if(G!==Math.floor(G)&&(G=Math.floor(G),n.b.Warn("n not an integer only floor(n) used")),G>P){const V=G;G=P,P=V,n.b.Warn("n > m therefore m and n swapped")}const w=new AV;w.build(P,G);const t=FV.BuildGeodesicData(w),u=t.toGoldbergPolyhedronData(),W=new EV(V,A);I.sideOrientation=F.c._GetDefaultSideOrientation(I.sideOrientation),W._originalBuilderSideOrientation=I.sideOrientation;(function(V,I){const A=V.size,F=V.sizeX||A||1,E=V.sizeY||A||1,c=V.sizeZ||A||1,b=0===V.sideOrientation?0:V.sideOrientation||Y.e.DEFAULTSIDE,X=[],P=[],J=[],G=[];let w=1/0,t=-1/0,u=1/0,W=-1/0;for(let B=0;B<I.vertex.length;B++)w=Math.min(w,I.vertex[B][0]*F),t=Math.max(t,I.vertex[B][0]*F),u=Math.min(u,I.vertex[B][1]*E),W=Math.max(W,I.vertex[B][1]*E);let g=0;for(let Y=0;Y<I.face.length;Y++){const V=I.face[Y],A=B.tI.LI(I.vertex[V[0]]),b=B.tI.LI(I.vertex[V[2]]),o=B.tI.LI(I.vertex[V[1]]),L=b.uI(A),z=o.uI(A),m=B.tI.Cross(z,L).normalize();for(let B=0;B<V.length;B++){J.push(m.x,m.y,m.z);const A=I.vertex[V[B]];X.push(A[0]*F,A[1]*E,A[2]*c);const Y=(A[1]*E-u)/(W-u);G.push((A[0]*F-w)/(t-w),H.b?1-Y:Y)}for(let I=0;I<V.length-2;I++)P.push(g,g+I+2,g+I+1);g+=V.length}Y.e._ComputeSides(b,X,P,J,G);const o=new Y.e;return o.SV=X,o.indices=P,o.QV=J,o.rV=G,o})(I,u).xV(W,I.updatable),W.goldbergData.nbSharedFaces=t.sharedNodes,W.goldbergData.nbUnsharedFaces=t.poleNodes,W.goldbergData.adjacentFaces=t.adjacentFaces,W.goldbergData.nbFaces=W.goldbergData.nbSharedFaces+W.goldbergData.nbUnsharedFaces,W.goldbergData.nbFacesAtPole=(W.goldbergData.nbUnsharedFaces-12)/12;for(let F=0;F<t.vertex.length;F++)W.goldbergData.faceCenters.push(B.tI.LI(t.vertex[F])),W.goldbergData.faceCenters[F].x*=c,W.goldbergData.faceCenters[F].y*=b,W.goldbergData.faceCenters[F].z*=X,W.goldbergData.faceColors.push(new J.GH(1,1,1,1));for(let F=0;F<u.face.length;F++){const V=u.face[F],I=B.tI.LI(u.vertex[V[0]]),A=B.tI.LI(u.vertex[V[2]]),E=B.tI.LI(u.vertex[V[1]]),Y=A.uI(I),H=E.uI(I),c=B.tI.Cross(H,Y).normalize(),b=B.tI.Cross(H,c).normalize();W.goldbergData.faceXaxis.push(H.normalize()),W.goldbergData.faceYaxis.push(c),W.goldbergData.faceZaxis.push(b)}return W},CreateDecal:a,CreateCapsule:U,CreateText:YV.f}},12557:(V,I,A)=>{"use strict";A.d(I,{c:()=>HI});var B=A(11231),F=A(11628);class E extends F.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Y=A(11276),H=(A(11396),A(11189));class c{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(V){this._targetStopDuration!==V&&(this._targetStopDuration=V)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(V){this._noiseTexture!==V&&(this._noiseTexture=V,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(V){this._animationSheetEnabled!==V&&(this._animationSheetEnabled=V)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(V){this._isAnimationSheetEnabled!=V&&(this._isAnimationSheetEnabled=V,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(V){this._useLogarithmicDepth=V&&this.sV().getEngine().getCaps().fragmentDepthSupported}sV(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(V){switch(V){case c.BLENDMODE_MULTIPLYADD:return;case c.BLENDMODE_ADD:V=1;break;case c.BLENDMODE_ONEONE:V=6;break;case c.BLENDMODE_STANDARD:V=2;break;case c.BLENDMODE_MULTIPLY:V=4;break;case c.BLENDMODE_SUBTRACT:V=3}this._engine.setAlphaMode(V)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:B.tI.Zero()}set direction1(V){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=V)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:B.tI.Zero()}set direction2(V){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=V)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:B.tI.Zero()}set minEmitBox(V){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=V)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:B.tI.Zero()}set maxEmitBox(V){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=V)}get billboardMode(){return this._billboardMode}set billboardMode(V){this._billboardMode!==V&&(this._billboardMode=V,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(V){this._isBillboardBased!==V&&(this._isBillboardBased=V,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V)}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(!V&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=V)}_reset(){}_removeGradientAndTexture(V,I,A){if(!I)return this;let B=0;for(const F of I){if(F.gradient===V){I.splice(B,1);break}B++}return A&&A.dispose(),this}constructor(V){this.animations=[],this.renderingGroupId=0,this.BI=B.tI.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new B.tI(10,10,10),this.onAnimationEnd=null,this.blendMode=c.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new B.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.MX=new B.tI(0,0,0),this._useLogarithmicDepth=!1,this.gravity=B.tI.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Y.GH(1,1,1,1),this.color2=new Y.GH(1,1,1,1),this.colorDead=new Y.GH(0,0,0,1),this.textureMask=new Y.GH(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new E,this.id=V,this.name=V}createPointEmitter(V,I){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new B.tI(0,1,0),arguments.length>2&&void 0!==arguments[2]||new B.tI(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new B.tI(0,1,0),arguments.length>4&&void 0!==arguments[4]||new B.tI(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new B.tI(0,1,0),arguments.length>3&&void 0!==arguments[3]||new B.tI(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(V,I,A,B){throw new Error("Method not implemented.")}}c.BLENDMODE_ONEONE=0,c.BLENDMODE_STANDARD=1,c.BLENDMODE_ADD=2,c.BLENDMODE_MULTIPLY=3,c.BLENDMODE_MULTIPLYADD=4,c.BLENDMODE_SUBTRACT=-1,(0,H.e)("BABYLON.BaseParticleSystem",c);var b=A(11249),X=A(11070);class P{constructor(){this.direction1=new B.tI(0,1,0),this.direction2=new B.tI(0,1,0),this.minEmitBox=new B.tI(-.5,-.5,-.5),this.maxEmitBox=new B.tI(.5,.5,.5)}startDirectionFunction(V,I,A,F){const E=(0,b.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,b.RandomRange)(this.direction1.y,this.direction2.y),H=(0,b.RandomRange)(this.direction1.z,this.direction2.z);if(F)return I.x=E,I.y=Y,void(I.z=H);B.tI.TransformNormalFromFloatsToRef(E,Y,H,V,I)}startPositionFunction(V,I,A,F){const E=(0,b.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),Y=(0,b.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),H=(0,b.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(F)return I.x=E,I.y=Y,void(I.z=H);B.tI.TransformCoordinatesFromFloatsToRef(E,Y,H,V,I)}clone(){const V=new P;return X.b.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2),V.setVector3("minEmitBox",this.minEmitBox),V.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3),V.addUniform("minEmitBox",3),V.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.direction1=this.direction1.AH(),V.direction2=this.direction2.AH(),V.minEmitBox=this.minEmitBox.AH(),V.maxEmitBox=this.maxEmitBox.AH(),V}parse(V){B.tI.FromArrayToRef(V.direction1,0,this.direction1),B.tI.FromArrayToRef(V.direction2,0,this.direction2),B.tI.FromArrayToRef(V.minEmitBox,0,this.minEmitBox),B.tI.FromArrayToRef(V.maxEmitBox,0,this.maxEmitBox)}}class J{get radius(){return this._radius}set radius(V){this._radius=V,this._buildHeight()}get angle(){return this._angle}set angle(V){this._angle=V,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=A,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=I,this.radius=V}startDirectionFunction(V,I,A,F){F?B.TmpVectors.tI[0].B(A.lH).normalize():A.position.subtractToRef(V.getTranslation(),B.TmpVectors.tI[0]).normalize();const E=(0,b.RandomRange)(0,this.directionRandomizer),Y=(0,b.RandomRange)(0,this.directionRandomizer),H=(0,b.RandomRange)(0,this.directionRandomizer);I.x=B.TmpVectors.tI[0].x+E,I.y=B.TmpVectors.tI[0].y+Y,I.z=B.TmpVectors.tI[0].z+H,I.normalize()}startPositionFunction(V,I,A,F){const E=(0,b.RandomRange)(0,2*Math.PI);let Y;this.emitFromSpawnPointOnly?Y=1e-4:(Y=(0,b.RandomRange)(0,this.heightRange),Y=1-Y*Y);let H=this._radius-(0,b.RandomRange)(0,this._radius*this.radiusRange);H*=Y;const c=H*Math.sin(E),X=H*Math.cos(E),P=Y*this._height;if(F)return I.x=c,I.y=P,void(I.z=X);B.tI.TransformCoordinatesFromFloatsToRef(c,P,X,V,I)}clone(){const V=new J(this._radius,this._angle,this.directionRandomizer);return X.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat2("radius",this._radius,this.radiusRange),V.setFloat("coneAngle",this._angle),V.setFloat2("height",this._height,this.heightRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",2),V.addUniform("coneAngle",1),V.addUniform("height",2),V.addUniform("directionRandomizer",1)}getEffectDefines(){let V="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(V+="\n#define CONEEMITTERSPAWNPOINT"),V}getClassName(){return"ConeParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this._radius,V.angle=this._angle,V.directionRandomizer=this.directionRandomizer,V.radiusRange=this.radiusRange,V.heightRange=this.heightRange,V.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,V}parse(V){this.radius=V.radius,this.angle=V.angle,this.directionRandomizer=V.directionRandomizer,this.radiusRange=void 0!==V.radiusRange?V.radiusRange:1,this.heightRange=void 0!==V.radiusRange?V.heightRange:1,this.emitFromSpawnPointOnly=void 0!==V.emitFromSpawnPointOnly&&V.emitFromSpawnPointOnly}}class G extends J{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.tI(0,1,0),F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.tI(0,1,0);super(V,I),this.direction1=A,this.direction2=F}startDirectionFunction(V,I){const A=(0,b.RandomRange)(this.direction1.x,this.direction2.x),F=(0,b.RandomRange)(this.direction1.y,this.direction2.y),E=(0,b.RandomRange)(this.direction1.z,this.direction2.z);B.tI.TransformNormalFromFloatsToRef(A,F,E,V,I)}clone(){const V=new G(this.radius,this.angle,this.direction1,this.direction2);return X.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.AH(),V.direction2=this.direction2.AH(),V}parse(V){super.parse(V),this.direction1.B(V.direction1),this.direction2.B(V.direction2)}}class w{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=V,this.height=I,this.radiusRange=A,this.directionRandomizer=F,this._tempVector=B.tI.Zero()}startDirectionFunction(V,I,A,F,E){A.position.subtractToRef(V.getTranslation(),this._tempVector),this._tempVector.normalize(),B.tI.TransformNormalToRef(this._tempVector,E,this._tempVector);const Y=(0,b.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let H=Math.atan2(this._tempVector.x,this._tempVector.z);H+=(0,b.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Y,this._tempVector.x=Math.sin(H),this._tempVector.z=Math.cos(H),this._tempVector.normalize(),F?I.B(this._tempVector):B.tI.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,V,I)}startPositionFunction(V,I,A,F){const E=(0,b.RandomRange)(-this.height/2,this.height/2),Y=(0,b.RandomRange)(0,2*Math.PI),H=(0,b.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),c=Math.sqrt(H)*this.radius,X=c*Math.cos(Y),P=c*Math.sin(Y);F?I.XH(X,E,P):B.tI.TransformCoordinatesFromFloatsToRef(X,E,P,V,I)}clone(){const V=new w(this.radius,this.directionRandomizer);return X.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("height",this.height),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("height",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.height=this.height,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.height=V.height,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class t extends w{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.tI(0,1,0),E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.tI(0,1,0);super(V,I,A),this.direction1=F,this.direction2=E}startDirectionFunction(V,I,A,F){const E=(0,b.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,b.RandomRange)(this.direction1.y,this.direction2.y),H=(0,b.RandomRange)(this.direction1.z,this.direction2.z);F?I.XH(E,Y,H):B.tI.TransformNormalFromFloatsToRef(E,Y,H,V,I)}clone(){const V=new t(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return X.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("height",this.height),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("height",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.AH(),V.direction2=this.direction2.AH(),V}parse(V){super.parse(V),B.tI.FromArrayToRef(V.direction1,0,this.direction1),B.tI.FromArrayToRef(V.direction2,0,this.direction2)}}class u{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=V,this.radiusRange=I,this.directionRandomizer=A}startDirectionFunction(V,I,A,F){const E=A.position.uI(V.getTranslation()).normalize(),Y=(0,b.RandomRange)(0,this.directionRandomizer),H=(0,b.RandomRange)(0,this.directionRandomizer),c=(0,b.RandomRange)(0,this.directionRandomizer);E.x+=Y,E.y+=H,E.z+=c,E.normalize(),F?I.B(E):B.tI.TransformNormalFromFloatsToRef(E.x,E.y,E.z,V,I)}startPositionFunction(V,I,A,F){const E=this.radius-(0,b.RandomRange)(0,this.radius*this.radiusRange),Y=(0,b.RandomRange)(0,1),H=(0,b.RandomRange)(0,2*Math.PI),c=Math.acos(2*Y-1),X=E*Math.cos(H)*Math.sin(c),P=E*Math.cos(c),J=E*Math.sin(H)*Math.sin(c);F?I.XH(X,Math.abs(P),J):B.tI.TransformCoordinatesFromFloatsToRef(X,Math.abs(P),J,V,I)}clone(){const V=new u(this.radius,this.directionRandomizer);return X.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class W{constructor(){this.direction1=new B.tI(0,1,0),this.direction2=new B.tI(0,1,0)}startDirectionFunction(V,I,A,F){const E=(0,b.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,b.RandomRange)(this.direction1.y,this.direction2.y),H=(0,b.RandomRange)(this.direction1.z,this.direction2.z);F?I.XH(E,Y,H):B.tI.TransformNormalFromFloatsToRef(E,Y,H,V,I)}startPositionFunction(V,I,A,F){F?I.XH(0,0,0):B.tI.TransformCoordinatesFromFloatsToRef(0,0,0,V,I)}clone(){const V=new W;return X.b.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.direction1=this.direction1.AH(),V.direction2=this.direction2.AH(),V}parse(V){B.tI.FromArrayToRef(V.direction1,0,this.direction1),B.tI.FromArrayToRef(V.direction2,0,this.direction2)}}class g{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=V,this.radiusRange=I,this.directionRandomizer=A}startDirectionFunction(V,I,A,F){const E=A.position.uI(V.getTranslation()).normalize(),Y=(0,b.RandomRange)(0,this.directionRandomizer),H=(0,b.RandomRange)(0,this.directionRandomizer),c=(0,b.RandomRange)(0,this.directionRandomizer);E.x+=Y,E.y+=H,E.z+=c,E.normalize(),F?I.B(E):B.tI.TransformNormalFromFloatsToRef(E.x,E.y,E.z,V,I)}startPositionFunction(V,I,A,F){const E=this.radius-(0,b.RandomRange)(0,this.radius*this.radiusRange),Y=(0,b.RandomRange)(0,1),H=(0,b.RandomRange)(0,2*Math.PI),c=Math.acos(2*Y-1),X=E*Math.cos(H)*Math.sin(c),P=E*Math.cos(c),J=E*Math.sin(H)*Math.sin(c);F?I.XH(X,P,J):B.tI.TransformCoordinatesFromFloatsToRef(X,P,J,V,I)}clone(){const V=new g(this.radius,this.directionRandomizer);return X.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class o extends g{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.tI(0,1,0),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.tI(0,1,0);super(V),this.direction1=I,this.direction2=A}startDirectionFunction(V,I){const A=(0,b.RandomRange)(this.direction1.x,this.direction2.x),F=(0,b.RandomRange)(this.direction1.y,this.direction2.y),E=(0,b.RandomRange)(this.direction1.z,this.direction2.z);B.tI.TransformNormalFromFloatsToRef(A,F,E,V,I)}clone(){const V=new o(this.radius,this.direction1,this.direction2);return X.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.AH(),V.direction2=this.direction2.AH(),V}parse(V){super.parse(V),this.direction1.B(V.direction1),this.direction2.B(V.direction2)}}class L{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(V,I,A,F){const E=B.TmpVectors.tI[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,A,E);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,A,E);const V=B.TmpVectors.tI[1];E.subtractToRef(A.position,V),V.scaleToRef(1/A.lifeTime,E)}else E.set(0,0,0);F?I.B(E):B.tI.TransformNormalToRef(E,V,I)}startPositionFunction(V,I,A,F){const E=B.TmpVectors.tI[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,A,E):E.set(0,0,0),F?I.B(E):B.tI.TransformCoordinatesToRef(E,V,I)}clone(){const V=new L;return X.b.DeepCopy(this,V),V}applyToShader(V){}buildUniformLayout(V){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.particlePositionGenerator=this.particlePositionGenerator,V.particleDestinationGenerator=this.particleDestinationGenerator,V}parse(V){V.particlePositionGenerator&&(this.particlePositionGenerator=V.particlePositionGenerator),V.particleDestinationGenerator&&(this.particleDestinationGenerator=V.particleDestinationGenerator)}}var z=A(11300);class m{get mesh(){return this._mesh}set mesh(V){this._mesh!==V&&(this._mesh=V,V?(this._indices=V.cH(),this._positions=V.getVerticesData(z.g.PositionKind),this._normals=V.getVerticesData(z.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=B.tI.Zero(),this._mesh=null,this.direction1=new B.tI(0,1,0),this.direction2=new B.tI(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=V}startDirectionFunction(V,I,A,F){if(this.useMeshNormalsForDirection&&this._normals)return void B.tI.TransformNormalToRef(this._storedNormal,V,I);const E=(0,b.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,b.RandomRange)(this.direction1.y,this.direction2.y),H=(0,b.RandomRange)(this.direction1.z,this.direction2.z);F?I.XH(E,Y,H):B.tI.TransformNormalFromFloatsToRef(E,Y,H,V,I)}startPositionFunction(V,I,A,F){if(!this._indices||!this._positions)return;const E=3*(Math.random()*(this._indices.length/3)|0),Y=Math.random(),H=Math.random()*(1-Y),c=1-Y-H,b=this._indices[E],X=this._indices[E+1],P=this._indices[E+2],J=B.TmpVectors.tI[0],G=B.TmpVectors.tI[1],w=B.TmpVectors.tI[2],t=B.TmpVectors.tI[3];B.tI.FromArrayToRef(this._positions,3*b,J),B.tI.FromArrayToRef(this._positions,3*X,G),B.tI.FromArrayToRef(this._positions,3*P,w),t.x=Y*J.x+H*G.x+c*w.x,t.y=Y*J.y+H*G.y+c*w.y,t.z=Y*J.z+H*G.z+c*w.z,F?I.XH(t.x,t.y,t.z):B.tI.TransformCoordinatesFromFloatsToRef(t.x,t.y,t.z,V,I),this.useMeshNormalsForDirection&&this._normals&&(B.tI.FromArrayToRef(this._normals,3*b,J),B.tI.FromArrayToRef(this._normals,3*X,G),B.tI.FromArrayToRef(this._normals,3*P,w),this._storedNormal.x=Y*J.x+H*G.x+c*w.x,this._storedNormal.y=Y*J.y+H*G.y+c*w.y,this._storedNormal.z=Y*J.z+H*G.z+c*w.z)}clone(){const V=new m(this.mesh);return X.b.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var V;const I={};return I.type=this.getClassName(),I.direction1=this.direction1.AH(),I.direction2=this.direction2.AH(),I.meshId=null===(V=this.mesh)||void 0===V?void 0:V.id,I.useMeshNormalsForDirection=this.useMeshNormalsForDirection,I}parse(V,I){B.tI.FromArrayToRef(V.direction1,0,this.direction1),B.tI.FromArrayToRef(V.direction2,0,this.direction2),V.meshId&&I&&(this.mesh=I.getLastMeshById(V.meshId)),this.useMeshNormalsForDirection=V.useMeshNormalsForDirection}}class s{_isUbo(V){return void 0!==V.addUniform}constructor(V){this._isUbo(V)?(this.setMatrix3x3=V.updateMatrix3x3.bind(V),this.setMatrix2x2=V.updateMatrix2x2.bind(V),this.setFloat=V.updateFloat.bind(V),this.setFloat2=V.updateFloat2.bind(V),this.setFloat3=V.updateFloat3.bind(V),this.setFloat4=V.updateFloat4.bind(V),this.setFloatArray=V.updateFloatArray.bind(V),this.setArray=V.updateArray.bind(V),this.setIntArray=V.updateIntArray.bind(V),this.setMatrix=V.EH.bind(V),this.setMatrices=V.updateMatrices.bind(V),this.setVector3=V.updateVector3.bind(V),this.setVector4=V.updateVector4.bind(V),this.setColor3=V.updateColor3.bind(V),this.setColor4=V.updateColor4.bind(V),this.setDirectColor4=V.updateDirectColor4.bind(V),this.setInt=V.updateInt.bind(V),this.setInt2=V.updateInt2.bind(V),this.setInt3=V.updateInt3.bind(V),this.setInt4=V.updateInt4.bind(V)):(this.setMatrix3x3=V.setMatrix3x3.bind(V),this.setMatrix2x2=V.setMatrix2x2.bind(V),this.setFloat=V.setFloat.bind(V),this.setFloat2=V.setFloat2.bind(V),this.setFloat3=V.setFloat3.bind(V),this.setFloat4=V.setFloat4.bind(V),this.setFloatArray=V.setFloatArray.bind(V),this.setArray=V.setArray.bind(V),this.setIntArray=V.setIntArray.bind(V),this.setMatrix=V.setMatrix.bind(V),this.setMatrices=V.setMatrices.bind(V),this.setVector3=V.setVector3.bind(V),this.setVector4=V.setVector4.bind(V),this.setColor3=V.setColor3.bind(V),this.setColor4=V.setColor4.bind(V),this.setDirectColor4=V.setDirectColor4.bind(V),this.setInt=V.setInt.bind(V),this.setInt2=V.setInt2.bind(V),this.setInt3=V.setInt3.bind(V),this.setInt4=V.setInt4.bind(V))}}var e=A(11152);const S="gpuUpdateParticlesPixelShader",Q="#version 300 es\nvoid main() {discard;}\n";e.e.ShadersStore[S]||(e.e.ShadersStore[S]=Q);const h="gpuUpdateParticlesVertexShader",r="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";e.e.ShadersStore[h]||(e.e.ShadersStore[h]=r);(0,H.e)("BABYLON.WebGL2ParticleSystem",class{constructor(V,I){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=V,this._engine=I,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var V;return(null===(V=this._updateEffect)||void 0===V?void 0:V.isReady())??!1}createUpdateBuffer(V){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof L&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=V,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new s(this._updateEffect)}createVertexBuffers(V,I){this._updateVAO.push(this._createUpdateVAO(V)),this._renderVAO.push(this._engine.recordVertexArrayObject(I,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=I}createParticleBuffer(V){return V}bindDrawBuffers(V,I,A){A?this._engine.bindBuffers(this._renderVertexBuffers,A,I):this._engine.bindVertexArrayObject(this._renderVAO[V],null)}preUpdateParticleBuffer(){const V=this._engine;if(this._engine.enableEffect(this._updateEffect),!V.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(V,I,A){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[V],null);const B=this._engine;B.bindTransformFeedbackBuffer(I.getBuffer()),B.setRasterizerState(!1),B.beginTransformFeedback(!0),B.drawArraysType(3,0,A),B.endTransformFeedback(),B.setRasterizerState(!0),B.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let V=0;V<this._updateVAO.length;V++)this._engine.releaseVertexArrayObject(this._updateVAO[V]);this._updateVAO.length=0;for(let V=0;V<this._renderVAO.length;V++)this._engine.releaseVertexArrayObject(this._renderVAO[V]);this._renderVAO.length=0}_createUpdateVAO(V){const I={};I.position=V.createVertexBuffer("position",0,3);let A=3;I.age=V.createVertexBuffer("age",A,1),A+=1,I.size=V.createVertexBuffer("size",A,3),A+=3,I.life=V.createVertexBuffer("life",A,1),A+=1,I.seed=V.createVertexBuffer("seed",A,4),A+=4,I.direction=V.createVertexBuffer("direction",A,3),A+=3,this._parent.particleEmitterType instanceof L&&(I.initialPosition=V.createVertexBuffer("initialPosition",A,3),A+=3),this._parent._colorGradientsTexture||(I.color=V.createVertexBuffer("color",A,4),A+=4),this._parent._isBillboardBased||(I.initialDirection=V.createVertexBuffer("initialDirection",A,3),A+=3),this._parent.noiseTexture&&(I.noiseCoordinates1=V.createVertexBuffer("noiseCoordinates1",A,3),A+=3,I.noiseCoordinates2=V.createVertexBuffer("noiseCoordinates2",A,3),A+=3),this._parent._angularSpeedGradientsTexture?(I.angle=V.createVertexBuffer("angle",A,1),A+=1):(I.angle=V.createVertexBuffer("angle",A,2),A+=2),this._parent._isAnimationSheetEnabled&&(I.cellIndex=V.createVertexBuffer("cellIndex",A,1),A+=1,this._parent.spriteRandomStartCell&&(I.cellStartOffset=V.createVertexBuffer("cellStartOffset",A,1),A+=1));const B=this._engine.recordVertexArrayObject(I,null,this._updateEffect);return this._engine.bindArrayBuffer(null),B}});class M{constructor(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,B=arguments.length>3?arguments[3]:void 0;this._engine=V,this._label=B,this._engine._storageBuffers.push(this),this._create(I,A)}_create(V,I){this._bufferSize=V,this._creationFlags=I,this._buffer=this._engine.createStorageBuffer(V,I,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(V,I,A){this._buffer&&this._engine.updateStorageBuffer(this._buffer,V,I,A)}async read(V,I,A,B){return await this._engine.readFromStorageBuffer(this._buffer,V,I,A,B)}dispose(){const V=this._engine._storageBuffers,I=V.indexOf(this);-1!==I&&(V[I]=V[V.length-1],V.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var x=A(11213),f=A(11222),R=A(11265),q=A(11207),N=A(11531),l=A(11064),i=A(11169),y=A(11447);class v{constructor(){this._gpuTimeInFrameId=-1,this.counter=new y.d}_addDuration(V,I){V<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==V?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(I,!1),this._gpuTimeInFrameId=V):this.counter.addCount(I,!1))}}var C=A(11135);class K{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=V,this._engine=I,this.uniqueId=N.d.UniqueId,I.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new v),this._engine.getCaps().supportComputeShaders?B.bindingsMapping?(this._context=I.createComputeContext(),this._shaderPath=A,this._options={bindingsMapping:{},defines:[],...B}):l.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):l.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(V,I){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const B=this._bindings[V];this._bindings[V]={type:A?0:4,object:I,indexInGroupEntries:null===B||void 0===B?void 0:B.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!B||B.object!==I||B.type!==this._bindings[V].type)}setStorageTexture(V,I){const A=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==I),this._bindings[V]={type:1,object:I,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setExternalTexture(V,I){const A=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==I),this._bindings[V]={type:6,object:I,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setVideoTexture(V,I){return!!I.externalTexture&&(this.setExternalTexture(V,I.externalTexture),!0)}setUniformBuffer(V,I){const A=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==I),this._bindings[V]={type:K._BufferIsDataBuffer(I)?7:2,object:I,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setStorageBuffer(V,I){const A=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==I),this._bindings[V]={type:K._BufferIsDataBuffer(I)?7:3,object:I,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setTextureSampler(V,I){const A=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!A||!I.compareSampler(A.object)),this._bindings[V]={type:5,object:I,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}isReady(){let V=this._effect;for(const F in this._bindings){const V=this._bindings[F],I=V.type,A=V.object;switch(I){case 0:case 4:case 1:if(!A.isReady())return!1;break;case 6:if(!A.isReady())return!1;break}}const I=[],A=this._shaderPath;if(this._options.defines)for(let F=0;F<this._options.defines.length;F++)I.push(this._options.defines[F]);const B=I.join("\n");return this._cachedDefines!==B&&(this._cachedDefines=B,V=this._engine.createComputeEffect(A,{defines:B,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=V),!!V.isReady()}dispatch(V,I,A){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,V,I,A,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const A=K._BufferIsDataBuffer(V)?V:V.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,A,I,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const I in this._bindings){const A=this._bindings[I];if(!this._options.bindingsMapping[I])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+I+"'");switch(A.type){case 0:{const B=this._samplers[I],F=A.object;var V;if(!B||!F._texture||!B.compareSampler(F._texture))this._samplers[I]=(new i.b).setParameters(F.wrapU,F.wrapV,F.wrapR,F.anisotropicFilteringLevel,F._texture.samplingMode,null===(V=F._texture)||void 0===V?void 0:V._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const V=A.object;V.getBuffer()!==A.buffer&&(A.buffer=V.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((F=>{(0,C.e)((()=>this.dispatch(V,I,A)),F,void 0,B)}))}serialize(){const V=R.b.Serialize(this);V.options=this._options,V.shaderPath=this._shaderPath,V.WG={},V.textures={};for(const I in this._bindings){const A=this._bindings[I],B=A.object;switch(A.type){case 0:case 4:case 1:{const F=B.serialize();F&&(V.textures[I]=F,V.WG[I]={type:A.type});break}}}return V}static Parse(V,I,A){const B=R.b.Parse((()=>new K(V.name,I.getEngine(),V.shaderPath,V.options)),V,I,A);for(const F in V.textures){const E=V.WG[F],Y=q.e.Parse(V.textures[F],I,A);0===E.type?B.setTexture(F,Y):4===E.type?B.setTexture(F,Y,!1):B.setStorageTexture(F,Y)}return B}static _BufferIsDataBuffer(V){return void 0!==V.underlyingResource}}(0,x.b)([(0,f.A)()],K.prototype,"name",void 0),(0,x.b)([(0,f.A)()],K.prototype,"fastMode",void 0),(0,H.e)("BABYLON.ComputeShader",K);var p=A(11489);const j="gpuUpdateParticlesComputeShader",T="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";e.e.ShadersStoreWGSL[j]||(e.e.ShadersStoreWGSL[j]=T);(0,H.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(V,I){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=V,this._engine=I}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var V;return(null===(V=this._updateComputeShader)||void 0===V?void 0:V.isReady())??!1}createUpdateBuffer(V){var I;const A={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(A.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(A.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(A.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(A.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(A.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(A.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(A.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new K("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:A,defines:V.split("\n")}),null===(I=this._simParamsComputeShader)||void 0===I||I.dispose(),this._simParamsComputeShader=new p.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new s(this._simParamsComputeShader)}createVertexBuffers(V,I){this._renderVertexBuffers.push(I)}createParticleBuffer(V){const I=new M(this._engine,4*V.length,11,"ComputeShaderParticleSystemBuffer");return I.update(V),this._bufferComputeShader.push(I),I.getBuffer()}bindDrawBuffers(V,I,A){this._engine.bindBuffers(this._renderVertexBuffers[V],A,I)}preUpdateParticleBuffer(){}updateParticleBuffer(V,I,A){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[V]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^V]),this._updateComputeShader.dispatch(Math.ceil(A/64))}releaseBuffers(){var V;for(let I=0;I<this._bufferComputeShader.length;++I)this._bufferComputeShader[I].dispose();this._bufferComputeShader.length=0,null===(V=this._simParamsComputeShader)||void 0===V||V.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class d{constructor(V,I,A){this.gradient=V,this.color1=I,this.color2=A}getColorToRef(V){this.color2?Y.GH.LerpToRef(this.color1,this.color2,Math.random(),V):V.B(this.color1)}}class D{constructor(V,I){this.gradient=V,this.color=I}}class O{constructor(V,I,A){this.gradient=V,this.factor1=I,this.factor2=A}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class Z{static GetCurrentGradient(V,I,A){if(I[0].gradient>V)return void A(I[0],I[0],1);for(let F=0;F<I.length-1;F++){const B=I[F],E=I[F+1];if(V>=B.gradient&&V<=E.gradient){return void A(B,E,(V-B.gradient)/(E.gradient-B.gradient))}}const B=I.length-1;A(I[B],I[B],1)}}var a=A(11057),k=A(11730),U=A(11097);class n{constructor(V){this.particleSystem=V,this.position=B.tI.Zero(),this.direction=B.tI.Zero(),this.color=new Y.GH(0,0,0,0),this.colorStep=new Y.GH(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new B.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Y.GH(0,0,0,0),this._currentColor2=new Y.GH(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=n._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let V=this.age,I=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===I?(I=1,V=this._randomCellOffset):V+=this._randomCellOffset);const A=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let B;B=this._initialSpriteCellLoop?(0,b.Clamp)(V*I%this.lifeTime/this.lifeTime):(0,b.Clamp)(V*I/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+B*A|0}_inheritParticleInfoToSubEmitter(V){if(V.particleSystem.BI.position){const I=V.particleSystem.BI;if(I.position.B(this.position),V.inheritDirection){const V=B.TmpVectors.tI[0];this.direction.normalizeToRef(V),I.setDirection(V,0,Math.PI/2)}}else{V.particleSystem.BI.B(this.position)}this.direction.scaleToRef(V.inheritedVelocityAmount/2,B.TmpVectors.tI[0]),V.particleSystem._inheritedVelocityOffset.B(B.TmpVectors.tI[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const V of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(V)}_reset(){this.age=0,this.id=n._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(V){V.position.B(this.position),this._initialDirection?V._initialDirection?V._initialDirection.B(this._initialDirection):V._initialDirection=this._initialDirection.clone():V._initialDirection=null,V.direction.B(this.direction),this.lH&&(V.lH?V.lH.B(this.lH):V.lH=this.lH.clone()),V.color.B(this.color),V.colorStep.B(this.colorStep),V.lifeTime=this.lifeTime,V.age=this.age,V._randomCellOffset=this._randomCellOffset,V.size=this.size,V.scale.B(this.scale),V.angle=this.angle,V.angularSpeed=this.angularSpeed,V.particleSystem=this.particleSystem,V.cellIndex=this.cellIndex,V.id=this.id,V._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(V._currentColorGradient=this._currentColorGradient,V._currentColor1.B(this._currentColor1),V._currentColor2.B(this._currentColor2)),this._currentSizeGradient&&(V._currentSizeGradient=this._currentSizeGradient,V._currentSize1=this._currentSize1,V._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(V._currentAngularSpeedGradient=this._currentAngularSpeedGradient,V._currentAngularSpeed1=this._currentAngularSpeed1,V._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(V._currentVelocityGradient=this._currentVelocityGradient,V._currentVelocity1=this._currentVelocity1,V._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(V._currentLimitVelocityGradient=this._currentLimitVelocityGradient,V._currentLimitVelocity1=this._currentLimitVelocity1,V._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(V._currentDragGradient=this._currentDragGradient,V._currentDrag1=this._currentDrag1,V._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(V._initialStartSpriteCellId=this._initialStartSpriteCellId,V._initialEndSpriteCellId=this._initialEndSpriteCellId,V._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(V.remapData&&this.remapData?V.remapData.B(this.remapData):V.remapData=new B.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(V._randomNoiseCoordinates1?(V._randomNoiseCoordinates1.B(this._randomNoiseCoordinates1),V._randomNoiseCoordinates2.B(this._randomNoiseCoordinates2)):(V._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),V._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}n._Count=0;var VV=A(11347),IV=(A(11389),A(11605)),AV=A(11597),BV=A(11485);function FV(V,I){const A=(0,b.RandomRange)(0,1);Y.GH.LerpToRef(I.color1,I.color2,A,V.color),I.colorDead.subtractToRef(V.color,I._colorDiff),I._colorDiff.scaleToRef(1/V.lifeTime,V.colorStep)}function EV(V,I){V._currentColorGradient=I._colorGradients[0],V._currentColorGradient.getColorToRef(V.color),V._currentColor1.B(V.color),I._colorGradients.length>1?I._colorGradients[1].getColorToRef(V._currentColor2):V._currentColor2.B(V.color)}function YV(V,I){const A=I._colorGradients;Z.GetCurrentGradient(I._ratio,A,((I,A,B)=>{I!==V._currentColorGradient&&(V._currentColor1.B(V._currentColor2),A.getColorToRef(V._currentColor2),V._currentColorGradient=I),Y.GH.LerpToRef(V._currentColor1,V._currentColor2,B,V.color)}))}function HV(V,I){V.colorStep.scaleToRef(I._scaledUpdateSpeed,I._scaledColorStep),V.color.addInPlace(I._scaledColorStep),V.color.a<0&&(V.color.a=0)}function cV(V,I){Z.GetCurrentGradient(I._ratio,I._angularSpeedGradients,((I,A,B)=>{I!==V._currentAngularSpeedGradient&&(V._currentAngularSpeed1=V._currentAngularSpeed2,V._currentAngularSpeed2=A.getFactor(),V._currentAngularSpeedGradient=I),V.angularSpeed=(0,b.Lerp)(V._currentAngularSpeed1,V._currentAngularSpeed2,B)}))}function bV(V,I){V.angle+=V.angularSpeed*I._scaledUpdateSpeed}function XV(V,I){I.particleEmitterType.startDirectionFunction(I._emitterWorldMatrix,V.direction,V,I.isLocal,I._emitterInverseWorldMatrix)}function PV(V,I){I.startDirectionFunction(I._emitterWorldMatrix,V.direction,V,I.isLocal)}function JV(V,I){V._currentVelocityGradient=I._velocityGradients[0],V._currentVelocity1=V._currentVelocityGradient.getFactor(),I._velocityGradients.length>1?V._currentVelocity2=I._velocityGradients[1].getFactor():V._currentVelocity2=V._currentVelocity1}function GV(V,I){V._currentLimitVelocityGradient=I._limitVelocityGradients[0],V._currentLimitVelocity1=V._currentLimitVelocityGradient.getFactor(),I._limitVelocityGradients.length>1?V._currentLimitVelocity2=I._limitVelocityGradients[1].getFactor():V._currentLimitVelocity2=V._currentLimitVelocity1}function wV(V,I){Z.GetCurrentGradient(I._ratio,I._velocityGradients,((A,B,F)=>{A!==V._currentVelocityGradient&&(V._currentVelocity1=V._currentVelocity2,V._currentVelocity2=B.getFactor(),V._currentVelocityGradient=A),I._directionScale*=(0,b.Lerp)(V._currentVelocity1,V._currentVelocity2,F)}))}function tV(V,I){Z.GetCurrentGradient(I._ratio,I._limitVelocityGradients,((A,B,F)=>{A!==V._currentLimitVelocityGradient&&(V._currentLimitVelocity1=V._currentLimitVelocity2,V._currentLimitVelocity2=B.getFactor(),V._currentLimitVelocityGradient=A);const E=(0,b.Lerp)(V._currentLimitVelocity1,V._currentLimitVelocity2,F);V.direction.length()>E&&V.direction.scaleInPlace(I.limitVelocityDamping)}))}function uV(V,I){V.direction.scaleToRef(I._directionScale,I._scaledDirection)}function WV(V,I){I.particleEmitterType.startPositionFunction(I._emitterWorldMatrix,V.position,V,I.isLocal)}function gV(V,I){I.startPositionFunction(I._emitterWorldMatrix,V.position,V,I.isLocal)}function oV(V,I){V.lH?V.lH.B(V.position):V.lH=V.position.clone(),B.tI.TransformCoordinatesToRef(V.lH,I._emitterWorldMatrix,V.position)}function LV(V,I){I.isLocal&&V.lH?(V.lH.addInPlace(I._scaledDirection),B.tI.TransformCoordinatesToRef(V.lH,I._emitterWorldMatrix,V.position)):V.position.addInPlace(I._scaledDirection)}function zV(V,I){V._currentDragGradient=I._dragGradients[0],V._currentDrag1=V._currentDragGradient.getFactor(),I._dragGradients.length>1?V._currentDrag2=I._dragGradients[1].getFactor():V._currentDrag2=V._currentDrag1}function mV(V,I){Z.GetCurrentGradient(I._ratio,I._dragGradients,((A,B,F)=>{A!==V._currentDragGradient&&(V._currentDrag1=V._currentDrag2,V._currentDrag2=B.getFactor(),V._currentDragGradient=A);const E=(0,b.Lerp)(V._currentDrag1,V._currentDrag2,F);I._scaledDirection.scaleInPlace(1-E)}))}function sV(V,I){V._randomNoiseCoordinates1?(V._randomNoiseCoordinates1.XH(Math.random(),Math.random(),Math.random()),V._randomNoiseCoordinates2.XH(Math.random(),Math.random(),Math.random())):(V._randomNoiseCoordinates1=new B.tI(Math.random(),Math.random(),Math.random()),V._randomNoiseCoordinates2=new B.tI(Math.random(),Math.random(),Math.random()))}function eV(V,I){const A=I._noiseTextureData,F=I._noiseTextureSize;if(A&&F&&V._randomNoiseCoordinates1){const E=I._fetchR(V._randomNoiseCoordinates1.x,V._randomNoiseCoordinates1.y,F.width,F.height,A),Y=I._fetchR(V._randomNoiseCoordinates1.z,V._randomNoiseCoordinates2.x,F.width,F.height,A),H=I._fetchR(V._randomNoiseCoordinates2.y,V._randomNoiseCoordinates2.z,F.width,F.height,A),c=B.TmpVectors.tI[0],b=B.TmpVectors.tI[1];c.XH((2*E-1)*I.noiseStrength.x,(2*Y-1)*I.noiseStrength.y,(2*H-1)*I.noiseStrength.z),c.scaleToRef(I._tempScaledUpdateSpeed,b),V.direction.addInPlace(b)}}function SV(V,I){I.gravity.scaleToRef(I._tempScaledUpdateSpeed,I._scaledGravity),V.direction.addInPlace(I._scaledGravity)}function QV(V,I){V.size=(0,b.RandomRange)(I.minSize,I.maxSize),V.scale.XH((0,b.RandomRange)(I.minScaleX,I.maxScaleX),(0,b.RandomRange)(I.minScaleY,I.maxScaleY))}function hV(V,I){V._currentSizeGradient=I._sizeGradients[0],V._currentSize1=V._currentSizeGradient.getFactor(),V.size=V._currentSize1,I._sizeGradients.length>1?V._currentSize2=I._sizeGradients[1].getFactor():V._currentSize2=V._currentSize1,V.scale.XH((0,b.RandomRange)(I.minScaleX,I.maxScaleX),(0,b.RandomRange)(I.minScaleY,I.maxScaleY))}function rV(V,I){const A=I._actualFrame/I.targetStopDuration;Z.GetCurrentGradient(A,I._startSizeGradients,((A,B,F)=>{A!==I._currentStartSizeGradient&&(I._currentStartSize1=I._currentStartSize2,I._currentStartSize2=B.getFactor(),I._currentStartSizeGradient=A);const E=(0,b.Lerp)(I._currentStartSize1,I._currentStartSize2,F);V.scale.scaleInPlace(E)}))}function MV(V,I){Z.GetCurrentGradient(I._ratio,I._sizeGradients,((I,A,B)=>{I!==V._currentSizeGradient&&(V._currentSize1=V._currentSize2,V._currentSize2=A.getFactor(),V._currentSizeGradient=I),V.size=(0,b.Lerp)(V._currentSize1,V._currentSize2,B)}))}function xV(V,I){V.remapData=new B.Vector4(0,1,0,1)}function fV(V,I){I._colorRemapGradients&&I._colorRemapGradients.length>0&&Z.GetCurrentGradient(I._ratio,I._colorRemapGradients,((I,A,B)=>{const F=(0,b.Lerp)(I.factor1,A.factor1,B),E=(0,b.Lerp)(I.factor2,A.factor2,B);V.remapData.x=F,V.remapData.y=E-F})),I._alphaRemapGradients&&I._alphaRemapGradients.length>0&&Z.GetCurrentGradient(I._ratio,I._alphaRemapGradients,((I,A,B)=>{const F=(0,b.Lerp)(I.factor1,A.factor1,B),E=(0,b.Lerp)(I.factor2,A.factor2,B);V.remapData.z=F,V.remapData.w=E-F}))}function RV(V,I){const A=(0,b.Clamp)(I._actualFrame/I.targetStopDuration);Z.GetCurrentGradient(A,I._lifeTimeGradients,((I,B)=>{const F=I,E=B,Y=F.getFactor(),H=E.getFactor(),c=(A-F.gradient)/(E.gradient-F.gradient);V.lifeTime=(0,b.Lerp)(Y,H,c)})),I._emitPower=(0,b.RandomRange)(I.minEmitPower,I.maxEmitPower)}function qV(V,I){V.lifeTime=(0,b.RandomRange)(I.minLifeTime,I.maxLifeTime),I._emitPower=(0,b.RandomRange)(I.minEmitPower,I.maxEmitPower)}function NV(V,I){0===I._emitPower?(V._initialDirection?V._initialDirection.B(V.direction):V._initialDirection=V.direction.clone(),V.direction.set(0,0,0)):(V._initialDirection=null,V.direction.scaleInPlace(I._emitPower)),V.direction.addInPlace(I._inheritedVelocityOffset)}function lV(V,I){V.angularSpeed=(0,b.RandomRange)(I.minAngularSpeed,I.maxAngularSpeed),V.angle=(0,b.RandomRange)(I.minInitialRotation,I.maxInitialRotation)}function iV(V,I){V._currentAngularSpeedGradient=I._angularSpeedGradients[0],V.angularSpeed=V._currentAngularSpeedGradient.getFactor(),V._currentAngularSpeed1=V.angularSpeed,I._angularSpeedGradients.length>1?V._currentAngularSpeed2=I._angularSpeedGradients[1].getFactor():V._currentAngularSpeed2=V._currentAngularSpeed1,V.angle=(0,b.RandomRange)(I.minInitialRotation,I.maxInitialRotation)}function yV(V,I){V._initialStartSpriteCellId=I.startSpriteCellID,V._initialEndSpriteCellId=I.endSpriteCellID,V._initialSpriteCellLoop=I.spriteCellLoop}function vV(V,I){V.previousItem=I.previousItem,V.nextItem=I,I.previousItem&&(I.previousItem.nextItem=V),I.previousItem=V}function CV(V,I){V.previousItem=I,V.nextItem=I.nextItem,I.nextItem&&(I.nextItem.previousItem=V),I.nextItem=V}function KV(V,I){let A=I;for(;A.nextItem;)A=A.nextItem;V.previousItem=A,V.nextItem=A.nextItem,A.nextItem=V}function pV(V){V.previousItem&&(V.previousItem.nextItem=V.nextItem),V.nextItem&&(V.nextItem.previousItem=V.previousItem)}class jV extends c{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(V){this._startDirectionFunction!==V&&(this._startDirectionFunction=V,this._directionProcessing.process=V?PV:XV)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(V){this._startPositionFunction!==V&&(this._startPositionFunction=V,this._positionCreation.process=V?gV:WV)}set onDispose(V){this._onDisposeObserver&&this.aY.remove(this._onDisposeObserver),this._onDisposeObserver=this.aY.add(V)}get H(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(V){this._useRampGradients!==V&&(this._useRampGradients=V,this._resetEffect(),V?(this._rampCreation={process:xV,previousItem:null,nextItem:null},CV(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:fV,previousItem:null,nextItem:null},CV(this._remapGradientProcessing,this._gravityProcessing)):(pV(this._rampCreation),pV(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(V){this._isLocal!==V&&(this._isLocal=V,V?(this._isLocalCreation={process:oV,previousItem:null,nextItem:null},CV(this._isLocalCreation,this._positionCreation)):pV(this._isLocalCreation))}get particles(){return this.JG}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(V){this._animationSheetEnabled!==V&&(this._animationSheetEnabled=V,V?(this._sheetCreation={process:yV,previousItem:null,nextItem:null},CV(this._sheetCreation,this._colorCreation)):pV(this._sheetCreation),this._reset())}getActiveCount(){return this.JG.length}getClassName(){return"Vc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var V;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._customWrappers[I])||void 0===V?void 0:V.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[V]??this._customWrappers[0]}setCustomEffect(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[I]=new VV.e(this._engine),this._customWrappers[I].effect=V,this._customWrappers[I].drawContext&&(this._customWrappers[I].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(V){if(this.noiseTexture!==V){if(this._noiseTexture=V,!V)return pV(this._noiseCreation),void pV(this._noiseProcessing);this._noiseCreation={process:sV,previousItem:null,nextItem:null},CV(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:eV,previousItem:null,nextItem:null},CV(this._noiseProcessing,this._positionProcessing)}}constructor(V,I,A){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(V),this._emitterInverseWorldMatrix=B.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new B.tI,this.aY=new a.c,this.onStoppedObservable=new a.c,this.onStartedObservable=new a.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.JG=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Y.GH(0,0,0,0),this._colorDiff=new Y.GH(0,0,0,0),this._scaledDirection=B.tI.Zero(),this._scaledGravity=B.tI.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=V=>{},this.recycleParticle=V=>{const I=this.JG.pop();I!==V&&I.copyTo(V),this._stockParticles.push(I)},this._createParticle=()=>{let V;return 0!==this._stockParticles.length?(V=this._stockParticles.pop(),V._reset()):V=new n(this),this._prepareParticle(V),V},this.paused=!1,this._shadersLoaded=!1,this._capacity=I,this._epsilon=H,A&&"Scene"!==A.getClassName()?(this._engine=A,this.defaultProjectionMatrix=B.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=A||U.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.XG.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:qV,previousItem:null,nextItem:null},this._positionCreation={process:WV,previousItem:null,nextItem:null},CV(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:XV,previousItem:null,nextItem:null},CV(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:NV,previousItem:null,nextItem:null},CV(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:QV,previousItem:null,nextItem:null},CV(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:lV,previousItem:null,nextItem:null},CV(this._angleCreation,this._sizeCreation),this._colorCreation={process:FV,previousItem:null,nextItem:null},CV(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,c||(this._colorProcessing={process:HV,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:bV,previousItem:null,nextItem:null},CV(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:uV,previousItem:null,nextItem:null},CV(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:LV,previousItem:null,nextItem:null},CV(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:SV,previousItem:null,nextItem:null},CV(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=E,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new VV.e(this._engine)},this._customWrappers[0].effect=F,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new P,this.updateFunction=V=>{var I;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(I=this.noiseTexture.getContent())||void 0===I||I.then((V=>{this._noiseTextureData=V})));const A=V===this.JG;for(let B=0;B<V.length;B++){const I=V[B];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const F=I.age;if(I.age+=this._tempScaledUpdateSpeed,I.age>I.lifeTime){const V=I.age-F,A=I.lifeTime-F;this._tempScaledUpdateSpeed=A*this._tempScaledUpdateSpeed/V,I.age=I.lifeTime}this._ratio=I.age/I.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let E=this._updateQueueStart;for(;E;)E.process(I,this),E=E.nextItem;if(this._isAnimationSheetEnabled&&!c&&I.updateCellIndex(),I._inheritParticleInfoToSubEmitters(),I.age>=I.lifeTime){if(this._emitFromParticle(I),I._attachedSubEmitters){for(const V of I._attachedSubEmitters)V.particleSystem.disposeOnStop=!0,V.particleSystem.stop();I._attachedSubEmitters=null}this.recycleParticle(I),A&&B--}else;}}}serialize(V){throw new Error("Method not implemented.")}clone(V,I){throw new Error("Method not implemented.")}_addFactorGradient(V,I,A,B){const F=new O(I,A,B);V.push(F),V.sort(((V,I)=>V.gradient<I.gradient?-1:V.gradient>I.gradient?1:0))}_removeFactorGradient(V,I){if(!V)return;let A=0;for(const B of V){if(B.gradient===I){V.splice(A,1);break}A++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=RV:this._lifeTimeCreation.process=qV}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:rV,previousItem:null,nextItem:null},CV(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(pV(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(V){this.targetStopDuration!==V&&(this._targetStopDuration=V,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(V,I,A){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,V,I,A),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(V){return this._removeFactorGradient(this._lifeTimeGradients,V),this._syncLifeTimeCreation(),this}addSizeGradient(V,I,A){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=hV,this._sizeGradientProcessing={process:MV,previousItem:null,nextItem:null},vV(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,V,I,A),this}removeSizeGradient(V){var I;return this._removeFactorGradient(this._sizeGradients,V),0===(null===(I=this._sizeGradients)||void 0===I?void 0:I.length)&&(pV(this._sizeGradientProcessing),this._sizeCreation.process=QV),this}addColorRemapGradient(V,I,A){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,V,I,A),this}removeColorRemapGradient(V){return this._removeFactorGradient(this._colorRemapGradients,V),this}addAlphaRemapGradient(V,I,A){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,V,I,A),this}removeAlphaRemapGradient(V){return this._removeFactorGradient(this._alphaRemapGradients,V),this}addAngularSpeedGradient(V,I,A){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=iV,this._angularSpeedGradientProcessing={process:cV,previousItem:null,nextItem:null},vV(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,V,I,A),this}removeAngularSpeedGradient(V){var I;return this._removeFactorGradient(this._angularSpeedGradients,V),0===(null===(I=this._angularSpeedGradients)||void 0===I?void 0:I.length)&&(this._angleCreation.process=lV,pV(this._angularSpeedGradientProcessing)),this}addVelocityGradient(V,I,A){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:JV,previousItem:null,nextItem:null},CV(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:wV,previousItem:null,nextItem:null},vV(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,V,I,A),this}removeVelocityGradient(V){var I;return this._removeFactorGradient(this._velocityGradients,V),0===(null===(I=this._velocityGradients)||void 0===I?void 0:I.length)&&(pV(this._velocityCreation),pV(this._velocityGradientProcessing)),this}addLimitVelocityGradient(V,I,A){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:GV,previousItem:null,nextItem:null},CV(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:tV,previousItem:null,nextItem:null},CV(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,V,I,A),this}removeLimitVelocityGradient(V){var I;return this._removeFactorGradient(this._limitVelocityGradients,V),0===(null===(I=this._limitVelocityGradients)||void 0===I?void 0:I.length)&&(pV(this._limitVelocityCreation),pV(this._limitVelocityGradientProcessing)),this}addDragGradient(V,I,A){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:zV,previousItem:null,nextItem:null},vV(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:mV,previousItem:null,nextItem:null},vV(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,V,I,A),this}removeDragGradient(V){var I;return this._removeFactorGradient(this._dragGradients,V),0===(null===(I=this._dragGradients)||void 0===I?void 0:I.length)&&(pV(this._dragCreation),pV(this._dragGradientProcessing)),this}addEmitRateGradient(V,I,A){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,V,I,A),this}removeEmitRateGradient(V){return this._removeFactorGradient(this._emitRateGradients,V),this}addStartSizeGradient(V,I,A){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,V,I,A),this._syncStartSizeCreation(),this}removeStartSizeGradient(V){return this._removeFactorGradient(this._startSizeGradients,V),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const V=new Uint8Array(4*this._rawTextureWidth),I=Y.TmpColors.oI[0];for(let A=0;A<this._rawTextureWidth;A++){const B=A/this._rawTextureWidth;Z.GetCurrentGradient(B,this._rampGradients,((B,F,E)=>{Y.oI.LerpToRef(B.color,F.color,E,I),V[4*A]=255*I.r,V[4*A+1]=255*I.g,V[4*A+2]=255*I.b,V[4*A+3]=255}))}this._rampGradientsTexture=k.b.CreateRGBATexture(V,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((V,I)=>V.gradient<I.gradient?-1:V.gradient>I.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(V,I){this._rampGradients||(this._rampGradients=[]);const A=new D(V,I);return this._rampGradients.push(A),this._syncRampGradientTexture(),this}removeRampGradient(V){return this._removeGradientAndTexture(V,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(V,I,A){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=EV,this._colorProcessing.process=YV);const B=new d(V,I,A);return this._colorGradients.push(B),this._colorGradients.sort(((V,I)=>V.gradient<I.gradient?-1:V.gradient>I.gradient?1:0)),this}removeColorGradient(V){if(!this._colorGradients)return this;let I=0;for(const A of this._colorGradients){if(A.gradient===V){this._colorGradients.splice(I,1);break}I++}return 0===this._colorGradients.length&&(this._colorCreation.process=FV,this._colorProcessing.process=HV),this}resetDrawCache(){if(this._drawWrappers){for(const V of this._drawWrappers)if(V)for(const I of V)null===I||void 0===I||I.dispose();this._drawWrappers=[]}}_fetchR(V,I,A,B,F){return F[4*(((V=.5*Math.abs(V)+.5)*A%A|0)+((I=.5*Math.abs(I)+.5)*B%B|0)*A)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const V=this._engine,I=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*I),this._vertexBuffer=new z.d(V,this._vertexData,!0,I);let A=0;const B=this._vertexBuffer.createVertexBuffer(z.g.PositionKind,A,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[z.g.PositionKind]=B,A+=3;const F=this._vertexBuffer.createVertexBuffer(z.g.ColorKind,A,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[z.g.ColorKind]=F,A+=4;const E=this._vertexBuffer.createVertexBuffer("angle",A,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=E,A+=1;const Y=this._vertexBuffer.createVertexBuffer("size",A,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Y,A+=2,this._isAnimationSheetEnabled){const V=this._vertexBuffer.createVertexBuffer("cellIndex",A,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=V,A+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const V=this._vertexBuffer.createVertexBuffer("direction",A,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=V,A+=3}if(this._useRampGradients){const V=this._vertexBuffer.createVertexBuffer("remapData",A,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=V,A+=4}let H;if(this._useInstancing){const I=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new z.d(V,I,!1,2),H=this._spriteBuffer.createVertexBuffer("offset",0,2)}else H=this._vertexBuffer.createVertexBuffer("offset",A,2,this._vertexBufferSize,this._useInstancing),A+=2;this._vertexBuffers.offset=H,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const V=[],I=[];let A=0;for(let B=0;B<this._capacity;B++)V.push(A),V.push(A+1),V.push(A+2),V.push(A),V.push(A+2),V.push(A+3),I.push(A,A+1,A+1,A+2,A+2,A+3,A+3,A,A,A+3),A+=4;this._indexBuffer=this._engine.createIndexBuffer(V),this._linesIndexBuffer=this._engine.createIndexBuffer(I)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(V)setTimeout((()=>{this.start(0)}),V);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var I;-1!==(null===(I=this.BI)||void 0===I?void 0:I.getClassName().indexOf("Mesh"))&&this.BI.YH(!0);const V=this.noiseTexture;if(V&&V.onGeneratedObservable)V.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let I=0;I<this.preWarmCycles;I++)this.animate(!0),V.render()}))}));else for(let I=0;I<this.preWarmCycles;I++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(V))}_postStop(V){}reset(){this._stockParticles.length=0,this.JG.length=0}_appendParticleVertex(V,I,A,F){let E=V*this._vertexBufferSize;if(this._vertexData[E++]=I.position.x+this.MX.x,this._vertexData[E++]=I.position.y+this.MX.y,this._vertexData[E++]=I.position.z+this.MX.z,this._vertexData[E++]=I.color.r,this._vertexData[E++]=I.color.g,this._vertexData[E++]=I.color.b,this._vertexData[E++]=I.color.a,this._vertexData[E++]=I.angle,this._vertexData[E++]=I.scale.x*I.size,this._vertexData[E++]=I.scale.y*I.size,this._isAnimationSheetEnabled&&(this._vertexData[E++]=I.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[E++]=I.direction.x,this._vertexData[E++]=I.direction.y,this._vertexData[E++]=I.direction.z);else if(I._initialDirection){let V=I._initialDirection;this.isLocal&&(B.tI.TransformNormalToRef(V,this._emitterWorldMatrix,B.TmpVectors.tI[0]),V=B.TmpVectors.tI[0]),0===V.x&&0===V.z&&(V.x=.001),this._vertexData[E++]=V.x,this._vertexData[E++]=V.y,this._vertexData[E++]=V.z}else{let V=I.direction;this.isLocal&&(B.tI.TransformNormalToRef(V,this._emitterWorldMatrix,B.TmpVectors.tI[0]),V=B.TmpVectors.tI[0]),0===V.x&&0===V.z&&(V.x=.001),this._vertexData[E++]=V.x,this._vertexData[E++]=V.y,this._vertexData[E++]=V.z}this._useRampGradients&&I.remapData&&(this._vertexData[E++]=I.remapData.x,this._vertexData[E++]=I.remapData.y,this._vertexData[E++]=I.remapData.z,this._vertexData[E++]=I.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===A?A=this._epsilon:1===A&&(A=1-this._epsilon),0===F?F=this._epsilon:1===F&&(F=1-this._epsilon)),this._vertexData[E++]=A,this._vertexData[E++]=F)}_prepareParticle(V){}_createNewOnes(V){let I;for(let A=0;A<V&&this.JG.length!==this._capacity;A++){I=this._createParticle(),this.JG.push(I);let V=this._createQueueStart;for(;V;)V.process(I,this),V=V.nextItem;I._inheritParticleInfoToSubEmitters()}}_update(V){if(this._alive=this.JG.length>0,this.BI.position){const V=this.BI;this._emitterWorldMatrix=V.getWorldMatrix()}else{const V=this.BI;this._emitterWorldMatrix=B.Matrix.Translation(V.x,V.y,V.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.JG),this._createNewOnes(V)}static _GetAttributeNamesOrOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=[z.g.PositionKind,z.g.ColorKind,"angle","offset","size"];return V&&B.push("cellIndex"),I||B.push("direction"),A&&B.push("remapData"),B}static _GetEffectCreationOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,IV.d)(B),V&&B.push("particlesInfos"),I&&B.push("logarithmicDepthConstant"),A&&(B.push("vFogInfos"),B.push("vFogColor")),B}fillDefines(V,I){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,IV.p)(this,this._scene,V),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&V.push("#define FOG")),this._isAnimationSheetEnabled&&V.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&V.push("#define LOGARITHMICDEPTH"),I===c.BLENDMODE_MULTIPLY&&V.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&V.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(V.push("#define BILLBOARD"),this.billboardMode){case 2:V.push("#define BILLBOARDY");break;case 8:case 9:V.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&V.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:V.push("#define BILLBOARDMODE_ALL")}A&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),V.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(V,I,A){I.push(...jV._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),V.push(...jV._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),A.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,BV.i)(V,this._imageProcessingConfigurationDefines),(0,BV.e)(A,this._imageProcessingConfigurationDefines))}_getWrapper(V){const I=this._getCustomDrawWrapper(V);if(null!==I&&void 0!==I&&I.effect)return I;const A=[];this.fillDefines(A,V);const B=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let F=this._drawWrappers[B];F||(F=this._drawWrappers[B]=[]);let E=F[V];E||(E=new VV.e(this._engine),E.drawContext&&(E.drawContext.useInstancing=this._useInstancing),F[V]=E);const Y=A.join("\n");if(E.defines!==Y){const V=[],I=[],A=[];this.fillUniformsAttributesAndSamplerNames(I,V,A),E.setEffect(this._engine.createEffect("particles",V,I,A,Y,void 0,void 0,void 0,void 0,this._shaderLanguage),Y)}return E}animate(){var V;let I,A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!A&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(A?this.preWarmStepOffset:(null===(V=this._scene)||void 0===V?void 0:V.getAnimationRatio())||1),this.manualEmitCount>-1)I=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let V=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const I=this._actualFrame/this.targetStopDuration;Z.GetCurrentGradient(I,this._emitRateGradients,((I,A,B)=>{I!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=A.getFactor(),this._currentEmitRateGradient=I),V=(0,b.Lerp)(this._currentEmitRate1,this._currentEmitRate2,B)}))}I=V*this._scaledUpdateSpeed|0,this._newPartsExcess+=V*this._scaledUpdateSpeed-I}if(this._newPartsExcess>1&&(I+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?I=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(I),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!A){let V=0;for(let I=0;I<this.JG.length;I++){const A=this.JG[I];this._appendParticleVertices(V,A),V+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.JG.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(V,I){this._appendParticleVertex(V++,I,0,0),this._useInstancing||(this._appendParticleVertex(V++,I,1,0),this._appendParticleVertex(V++,I,1,1),this._appendParticleVertex(V++,I,0,1))}rebuild(){var V;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(V=this._spriteBuffer)||void 0===V||V._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!jV.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(A.bind(A,12723)),Promise.resolve().then(A.bind(A,12667))])):await Promise.all([Promise.resolve().then(A.bind(A,12653)),Promise.resolve().then(A.bind(A,12645))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.BI||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==c.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(c.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(c.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(V){const I=this._getWrapper(V),A=I.effect,F=this._engine;F.enableEffect(I);const E=this.defaultViewMatrix??this._scene.getViewMatrix();if(A.setTexture("diffuseSampler",this.particleTexture),A.setMatrix("view",E),A.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const V=this.particleTexture.getBaseSize();A.setFloat3("particlesInfos",this.spriteCellWidth/V.width,this.spriteCellHeight/V.height,this.spriteCellWidth/V.width)}if(A.setVector2("translationPivot",this.translationPivot),A.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const V=this._scene.activeCamera;A.setVector3("eyePosition",V.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),A.setTexture("rampSampler",this._rampGradientsTexture));const Y=A.defines;var H,c,b,X,P,J;(this._scene&&((0,IV.h)(A,this,this._scene),this.applyFog&&(0,AV.d)(this._scene,void 0,A)),Y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(E.invertToRef(B.TmpVectors.Matrix[0]),A.setMatrix("invView",B.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?F.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,A):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,A)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?F.bindBuffers(this._vertexBuffers,null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?this._linesIndexBuffer:this._indexBuffer,A):F.bindBuffers(this._vertexBuffers,null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._linesIndexBufferUseInstancing:null,A);(this.useLogarithmicDepth&&this._scene&&(0,AV.l)(Y,A,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(A),this._setEngineBasedOnBlendMode(V),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(A),this._useInstancing)?null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?F.drawElementsType(6,0,10,this.JG.length):F.drawArraysType(7,0,4,this.JG.length):null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?F.drawElementsType(1,0,10*this.JG.length):F.drawElementsType(0,0,6*this.JG.length);return this.JG.length}render(){if(!this.isReady()||!this.JG.length)return 0;const V=this._engine;V.setState&&(V.setState(!1),this.forceDepthWrite&&V.setDepthWrite(!0));let I=0;return I=this.blendMode===c.BLENDMODE_MULTIPLYADD?this._render(c.BLENDMODE_MULTIPLY)+this._render(c.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),I}_onDispose(){}dispose(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),V&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),V&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(I,A),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const V=this._scene.XG.indexOf(this);V>-1&&this._scene.XG.splice(V,1),this._scene._activeParticleSystems.dispose()}this.aY.notifyObservers(this),this.aY.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}jV.ForceGLSL=!1;var TV,dV=A(11084);!function(V){V[V.ATTACHED=0]="ATTACHED",V[V.END=1]="END"}(TV||(TV={}));class DV{constructor(V){if(this.particleSystem=V,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!V.BI||!V.BI.dispose){const I=(0,H.b)("BABYLON.AbstractMesh");V.BI=new I("SubemitterSystemEmitter",V.sV()),V._disposeEmitterOnDispose=!0}}clone(){let V=this.particleSystem.BI;if(V){if(V instanceof B.tI)V=V.clone();else if(-1!==V.getClassName().indexOf("Mesh")){V=new((0,H.b)("BABYLON.Mesh"))("",V.sV()),V.isVisible=!1}}else V=new B.tI;const I=new DV(this.particleSystem.clone(this.particleSystem.name,V));return I.particleSystem.name+="Clone",I.type=this.type,I.inheritDirection=this.inheritDirection,I.inheritedVelocityAmount=this.inheritedVelocityAmount,I.particleSystem._disposeEmitterOnDispose=!0,I.particleSystem.disposeOnStop=!0,I}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};return I.type=this.type,I.inheritDirection=this.inheritDirection,I.inheritedVelocityAmount=this.inheritedVelocityAmount,I.particleSystem=this.particleSystem.serialize(V),I}static _ParseParticleSystem(V,I,A){throw(0,dV.e)("ParseParticle")}static Parse(V,I,A){const B=V.particleSystem,F=new DV(DV._ParseParticleSystem(B,I,A,!0));return F.type=V.type,F.inheritDirection=V.inheritDirection,F.inheritedVelocityAmount=V.inheritedVelocityAmount,F.particleSystem._isSubEmitter=!0,F}dispose(){this.particleSystem.dispose()}}var OV=A(11137);function ZV(V,I){const A=new W;return A.direction1=V,A.direction2=I,A}function aV(){return new u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function kV(){return new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function UV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.tI(0,1,0),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.tI(0,1,0);return new o(V,I,A)}function nV(){return new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function VI(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.tI(0,1,0),E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.tI(0,1,0);return new t(V,I,A,F,E)}function II(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new J(V,I)}function AI(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.tI(0,1,0),F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.tI(0,1,0);return new G(V,I,A,F)}const BI=B.tI.Zero(),FI=B.tI.Zero(),EI=B.tI.Zero();class YI{constructor(){this.strength=0,this.position=B.tI.Zero()}_processParticle(V,I){this.position.subtractToRef(V.position,BI);const A=BI.lengthSquared()+1;BI.normalize().scaleToRef(this.strength/A,FI),FI.scaleToRef(I._tempScaledUpdateSpeed,EI),V.direction.addInPlace(EI)}serialize(){return{position:this.position.AH(),strength:this.strength}}}class HI extends jV{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=V=>{if(!this._subEmitters||0===this._subEmitters.length)return;const I=Math.floor(Math.random()*this._subEmitters.length);for(const A of this._subEmitters[I])if(1===A.type){const I=A.clone();V._inheritParticleInfoToSubEmitter(I),I.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(I.particleSystem),I.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(V,I){const A=ZV(V,I);return this.particleEmitterType=A,A}get flowMap(){return this._flowMap}set flowMap(V){this._flowMap!==V&&(this._flowMap=V,this._flowMapUpdate&&(pV(this._flowMapUpdate),this._flowMapUpdate=null),V&&(this._flowMapUpdate={process:V=>{var I;const A=null===(I=this.sV())||void 0===I?void 0:I.getTransformMatrix();this._flowMap._processParticle(V,this.flowMapStrength*this._tempScaledUpdateSpeed,A)},previousItem:null,nextItem:null},CV(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(V){this._attractors.push(V),1===this._attractors.length&&(this._attractorUpdate={process:V=>{for(const I of this._attractors)I._processParticle(V,this)},previousItem:null,nextItem:null},CV(this._attractorUpdate,this._directionProcessing))}removeAttractor(V){const I=this._attractors.indexOf(V);-1!==I&&this._attractors.splice(I,1),0===this._attractors.length&&pV(this._attractorUpdate)}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(V)}createHemisphericEmitter(){const V=aV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createSphereEmitter(){const V=kV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createDirectedSphereEmitter(){const V=UV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.tI(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.tI(0,1,0));return this.particleEmitterType=V,V}createCylinderEmitter(){const V=nV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=V,V}createDirectedCylinderEmitter(){const V=VI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.tI(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.tI(0,1,0));return this.particleEmitterType=V,V}createConeEmitter(){const V=II(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=V,V}createDirectedConeEmitter(){const V=AI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.tI(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.tI(0,1,0));return this.particleEmitterType=V,V}createBoxEmitter(V,I,A,B){const F=new P;return this.particleEmitterType=F,this.direction1=V,this.direction2=I,this.minEmitBox=A,this.maxEmitBox=B,F}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const V of this.subEmitters)V instanceof HI?this._subEmitters.push([new DV(V)]):V instanceof DV?this._subEmitters.push([V]):V instanceof Array&&this._subEmitters.push(V)}_stopSubEmitters(){if(this.activeSubSystems){for(const V of this.activeSubSystems)V.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const V=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==V&&this._rootParticleSystem.activeSubSystems.splice(V,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(V){V&&this._stopSubEmitters()}_prepareParticle(V){if(this._subEmitters&&this._subEmitters.length>0){const I=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];V._attachedSubEmitters=[];for(const A of I)if(0===A.type){const I=A.clone();V._attachedSubEmitters.push(I),I.particleSystem.start()}}}_onDispose(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),V&&this.particles)for(const A of this.particles)if(A._attachedSubEmitters)for(let V=A._attachedSubEmitters.length-1;V>=0;V-=1)A._attachedSubEmitters[V].dispose();if(I&&this.activeSubSystems)for(let A=this.activeSubSystems.length-1;A>=0;A-=1)this.activeSubSystems[A].dispose();if(this._subEmitters&&this._subEmitters.length){for(let V=0;V<this._subEmitters.length;V++)for(const I of this._subEmitters[V])I.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.BI&&this.BI.dispose&&this.BI.dispose(!0)}static _Parse(V,I,A,F){let E;E=A instanceof OV.e?null:A;const c=(0,H.b)("BABYLON.Texture");if(c&&E&&(V.texture?I.particleTexture=c.Parse(V.texture,E,F):V.textureName&&(I.particleTexture=new c(F+V.textureName,E,!1,void 0===V.invertY||V.invertY),I.particleTexture.name=V.textureName)),V.emitterId||0===V.emitterId||void 0!==V.BI?V.emitterId&&E?I.BI=E.getLastMeshById(V.emitterId):I.BI=B.tI.LI(V.BI):I.BI=B.tI.Zero(),I.isLocal=!!V.isLocal,void 0!==V.renderingGroupId&&(I.renderingGroupId=V.renderingGroupId),void 0!==V.isBillboardBased&&(I.isBillboardBased=V.isBillboardBased),void 0!==V.billboardMode&&(I.billboardMode=V.billboardMode),void 0!==V.useLogarithmicDepth&&(I.useLogarithmicDepth=V.useLogarithmicDepth),V.animations){for(let A=0;A<V.animations.length;A++){const B=V.animations[A],F=(0,H.b)("BABYLON.Animation");F&&I.animations.push(F.Parse(B))}I.beginAnimationOnStart=V.beginAnimationOnStart,I.beginAnimationFrom=V.beginAnimationFrom,I.beginAnimationTo=V.beginAnimationTo,I.beginAnimationLoop=V.beginAnimationLoop}if(V.autoAnimate&&E&&E.beginAnimation(I,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),I.startDelay=0|V.startDelay,I.minAngularSpeed=V.minAngularSpeed,I.maxAngularSpeed=V.maxAngularSpeed,I.minSize=V.minSize,I.maxSize=V.maxSize,V.minScaleX&&(I.minScaleX=V.minScaleX,I.maxScaleX=V.maxScaleX,I.minScaleY=V.minScaleY,I.maxScaleY=V.maxScaleY),void 0!==V.preWarmCycles&&(I.preWarmCycles=V.preWarmCycles,I.preWarmStepOffset=V.preWarmStepOffset),void 0!==V.minInitialRotation&&(I.minInitialRotation=V.minInitialRotation,I.maxInitialRotation=V.maxInitialRotation),I.minLifeTime=V.minLifeTime,I.maxLifeTime=V.maxLifeTime,I.minEmitPower=V.minEmitPower,I.maxEmitPower=V.maxEmitPower,I.emitRate=V.emitRate,I.gravity=B.tI.LI(V.gravity),V.noiseStrength&&(I.noiseStrength=B.tI.LI(V.noiseStrength)),I.color1=Y.GH.LI(V.color1),I.color2=Y.GH.LI(V.color2),I.colorDead=Y.GH.LI(V.colorDead),I.updateSpeed=V.updateSpeed,I.targetStopDuration=V.targetStopDuration,I.blendMode=V.blendMode,V.colorGradients)for(const B of V.colorGradients)I.addColorGradient(B.gradient,Y.GH.LI(B.color1),B.color2?Y.GH.LI(B.color2):void 0);if(V.rampGradients){for(const A of V.rampGradients)I.addRampGradient(A.gradient,Y.oI.LI(A.color));I.useRampGradients=V.useRampGradients}if(V.colorRemapGradients)for(const B of V.colorRemapGradients)I.addColorRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(V.alphaRemapGradients)for(const B of V.alphaRemapGradients)I.addAlphaRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(V.sizeGradients)for(const B of V.sizeGradients)I.addSizeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(V.angularSpeedGradients)for(const B of V.angularSpeedGradients)I.addAngularSpeedGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(V.velocityGradients)for(const B of V.velocityGradients)I.addVelocityGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(V.dragGradients)for(const B of V.dragGradients)I.addDragGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(V.emitRateGradients)for(const B of V.emitRateGradients)I.addEmitRateGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(V.startSizeGradients)for(const B of V.startSizeGradients)I.addStartSizeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(V.lifeTimeGradients)for(const B of V.lifeTimeGradients)I.addLifeTimeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(V.limitVelocityGradients){for(const A of V.limitVelocityGradients)I.addLimitVelocityGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);I.limitVelocityDamping=V.limitVelocityDamping}if(V.noiseTexture&&E){const A=(0,H.b)("BABYLON.ProceduralTexture");I.noiseTexture=A.Parse(V.noiseTexture,E,F)}let b;if(V.particleEmitterType){switch(V.particleEmitterType.type){case"SphereParticleEmitter":b=new g;break;case"SphereDirectedParticleEmitter":b=new o;break;case"ConeEmitter":case"ConeParticleEmitter":b=new J;break;case"ConeDirectedParticleEmitter":b=new G;break;case"CylinderParticleEmitter":b=new w;break;case"CylinderDirectedParticleEmitter":b=new t;break;case"HemisphericParticleEmitter":b=new u;break;case"PointParticleEmitter":b=new W;break;case"MeshParticleEmitter":b=new m;break;case"CustomParticleEmitter":b=new L;break;default:b=new P}b.parse(V.particleEmitterType,E)}else b=new P,b.parse(V,E);I.particleEmitterType=b,I.startSpriteCellID=V.startSpriteCellID,I.endSpriteCellID=V.endSpriteCellID,I.spriteCellLoop=V.spriteCellLoop??!0,I.spriteCellWidth=V.spriteCellWidth,I.spriteCellHeight=V.spriteCellHeight,I.spriteCellChangeSpeed=V.spriteCellChangeSpeed,I.spriteRandomStartCell=V.spriteRandomStartCell,I.disposeOnStop=V.disposeOnStop??!1,I.manualEmitCount=V.manualEmitCount??-1}static Parse(V,I,A){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0;const H=V.name;let c,b,X=null,P=null;if(I instanceof OV.e?c=I:(b=I,c=b.getEngine()),V.customShader&&c.createEffectForParticles){P=V.customShader;const I=P.shaderOptions.defines.length>0?P.shaderOptions.defines.join("\n"):"";X=c.createEffectForParticles(P.shaderPath.fragmentElement,P.shaderOptions.uniforms,P.shaderOptions.samplers,I)}const J=new HI(H,E||V.tA,I,X,V.isAnimationSheetEnabled);if(J.customShader=P,J._rootUrl=A,V.id&&(J.id=V.id),V.subEmitters){J.subEmitters=[];for(const B of V.subEmitters){const V=[];for(const F of B)V.push(DV.Parse(F,I,A));J.subEmitters.push(V)}}if(V.attractors)for(const Y of V.attractors){const V=new YI;V.position=B.tI.LI(Y.position),V.strength=Y.strength,J.addAttractor(V)}return HI._Parse(V,J,I,A),V.textureMask&&(J.textureMask=Y.GH.LI(V.textureMask)),V.MX&&(J.MX=B.tI.LI(V.MX)),V.preventAutoStart&&(J.preventAutoStart=V.preventAutoStart),F||J.preventAutoStart||J.start(),J}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};if(HI._Serialize(I,this,V),I.textureMask=this.textureMask.AH(),I.customShader=this.customShader,I.preventAutoStart=this.preventAutoStart,I.MX=this.MX.AH(),this.subEmitters){I.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const A of this._subEmitters){const B=[];for(const I of A)B.push(I.serialize(V));I.subEmitters.push(B)}}if(this._attractors&&this._attractors.length){I.attractors=[];for(const V of this._attractors)I.attractors.push(V.serialize())}return I}static _Serialize(V,I,A){if(V.name=I.name,V.id=I.id,V.tA=I.getCapacity(),V.disposeOnStop=I.disposeOnStop,V.manualEmitCount=I.manualEmitCount,I.BI.position){const A=I.BI;V.emitterId=A.id}else{const A=I.BI;V.BI=A.AH()}I.particleEmitterType&&(V.particleEmitterType=I.particleEmitterType.serialize()),I.particleTexture&&(A?V.texture=I.particleTexture.serialize():(V.textureName=I.particleTexture.name,V.invertY=!!I.particleTexture._invertY)),V.isLocal=I.isLocal,R.b.AppendSerializedAnimations(I,V),V.beginAnimationOnStart=I.beginAnimationOnStart,V.beginAnimationFrom=I.beginAnimationFrom,V.beginAnimationTo=I.beginAnimationTo,V.beginAnimationLoop=I.beginAnimationLoop,V.startDelay=I.startDelay,V.renderingGroupId=I.renderingGroupId,V.isBillboardBased=I.isBillboardBased,V.billboardMode=I.billboardMode,V.minAngularSpeed=I.minAngularSpeed,V.maxAngularSpeed=I.maxAngularSpeed,V.minSize=I.minSize,V.maxSize=I.maxSize,V.minScaleX=I.minScaleX,V.maxScaleX=I.maxScaleX,V.minScaleY=I.minScaleY,V.maxScaleY=I.maxScaleY,V.minEmitPower=I.minEmitPower,V.maxEmitPower=I.maxEmitPower,V.minLifeTime=I.minLifeTime,V.maxLifeTime=I.maxLifeTime,V.emitRate=I.emitRate,V.gravity=I.gravity.AH(),V.noiseStrength=I.noiseStrength.AH(),V.color1=I.color1.AH(),V.color2=I.color2.AH(),V.colorDead=I.colorDead.AH(),V.updateSpeed=I.updateSpeed,V.targetStopDuration=I.targetStopDuration,V.blendMode=I.blendMode,V.preWarmCycles=I.preWarmCycles,V.preWarmStepOffset=I.preWarmStepOffset,V.minInitialRotation=I.minInitialRotation,V.maxInitialRotation=I.maxInitialRotation,V.startSpriteCellID=I.startSpriteCellID,V.spriteCellLoop=I.spriteCellLoop,V.endSpriteCellID=I.endSpriteCellID,V.spriteCellChangeSpeed=I.spriteCellChangeSpeed,V.spriteCellWidth=I.spriteCellWidth,V.spriteCellHeight=I.spriteCellHeight,V.spriteRandomStartCell=I.spriteRandomStartCell,V.isAnimationSheetEnabled=I.isAnimationSheetEnabled,V.useLogarithmicDepth=I.useLogarithmicDepth;const B=I.getColorGradients();if(B){V.colorGradients=[];for(const I of B){const A={gradient:I.gradient,color1:I.color1.AH()};I.color2?A.color2=I.color2.AH():A.color2=I.color1.AH(),V.colorGradients.push(A)}}const F=I.getRampGradients();if(F){V.rampGradients=[];for(const I of F){const A={gradient:I.gradient,color:I.color.AH()};V.rampGradients.push(A)}V.useRampGradients=I.useRampGradients}const E=I.getColorRemapGradients();if(E){V.colorRemapGradients=[];for(const I of E){const A={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?A.factor2=I.factor2:A.factor2=I.factor1,V.colorRemapGradients.push(A)}}const Y=I.getAlphaRemapGradients();if(Y){V.alphaRemapGradients=[];for(const I of Y){const A={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?A.factor2=I.factor2:A.factor2=I.factor1,V.alphaRemapGradients.push(A)}}const H=I.getSizeGradients();if(H){V.sizeGradients=[];for(const I of H){const A={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?A.factor2=I.factor2:A.factor2=I.factor1,V.sizeGradients.push(A)}}const c=I.getAngularSpeedGradients();if(c){V.angularSpeedGradients=[];for(const I of c){const A={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?A.factor2=I.factor2:A.factor2=I.factor1,V.angularSpeedGradients.push(A)}}const b=I.getVelocityGradients();if(b){V.velocityGradients=[];for(const I of b){const A={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?A.factor2=I.factor2:A.factor2=I.factor1,V.velocityGradients.push(A)}}const X=I.getDragGradients();if(X){V.dragGradients=[];for(const I of X){const A={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?A.factor2=I.factor2:A.factor2=I.factor1,V.dragGradients.push(A)}}const P=I.getEmitRateGradients();if(P){V.emitRateGradients=[];for(const I of P){const A={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?A.factor2=I.factor2:A.factor2=I.factor1,V.emitRateGradients.push(A)}}const J=I.getStartSizeGradients();if(J){V.startSizeGradients=[];for(const I of J){const A={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?A.factor2=I.factor2:A.factor2=I.factor1,V.startSizeGradients.push(A)}}const G=I.getLifeTimeGradients();if(G){V.lifeTimeGradients=[];for(const I of G){const A={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?A.factor2=I.factor2:A.factor2=I.factor1,V.lifeTimeGradients.push(A)}}const w=I.getLimitVelocityGradients();if(w){V.limitVelocityGradients=[];for(const I of w){const A={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?A.factor2=I.factor2:A.factor2=I.factor1,V.limitVelocityGradients.push(A)}V.limitVelocityDamping=I.limitVelocityDamping}I.noiseTexture&&(V.noiseTexture=I.noiseTexture.serialize())}clone(V,I){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B={...this._customWrappers};let F=null;const E=this._engine;if(E.createEffectForParticles&&null!=this.customShader){F=this.customShader;const V=F.shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"",I=E.createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,V);B[0]?B[0].effect=I:this.setCustomEffect(I,0)}const Y=this.serialize(A),H=HI.Parse(Y,this._scene||this._engine,this._rootUrl);return H.name=V,H.customShader=F,H._customWrappers=B,void 0===I&&(I=this.BI),this.noiseTexture&&(H.noiseTexture=this.noiseTexture.clone()),H.BI=I,this.preventAutoStart||H.start(),H}}HI.BILLBOARDMODE_Y=2,HI.BILLBOARDMODE_ALL=7,HI.BILLBOARDMODE_STRETCHED=8,HI.BILLBOARDMODE_STRETCHED_LOCAL=9,DV._ParseParticleSystem=HI.Parse;var cI=A(11478),bI=A(11473),XI=A(11359);XI.c.prototype.createTransformFeedback=function(){const V=this._gl.createTransformFeedback();if(!V)throw new Error("Unable to create Transform Feedback");return V},XI.c.prototype.deleteTransformFeedback=function(V){this._gl.deleteTransformFeedback(V)},XI.c.prototype.bindTransformFeedback=function(V){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,V)},XI.c.prototype.beginTransformFeedback=function(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(V?this._gl.POINTS:this._gl.TRIANGLES)},XI.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},XI.c.prototype.setTranformFeedbackVaryings=function(V,I){this._gl.transformFeedbackVaryings(V,I,this._gl.INTERLEAVED_ATTRIBS)},XI.c.prototype.bindTransformFeedbackBuffer=function(V){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,V?V.underlyingResource:null)},XI.c.prototype.readTransformFeedbackBuffer=function(V){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,V)};const PI="clipPlaneFragmentDeclaration2",JI="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";e.e.IncludesShadersStore[PI]||(e.e.IncludesShadersStore[PI]=JI);A(12559),A(12566),A(12571),A(12575),A(12580),A(12586),A(12588),A(12591);const GI="gpuRenderParticlesPixelShader",wI="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";e.e.ShadersStore[GI]||(e.e.ShadersStore[GI]=wI);const tI="clipPlaneVertexDeclaration2",uI="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";e.e.IncludesShadersStore[tI]||(e.e.IncludesShadersStore[tI]=uI);A(12598),A(12606),A(12612),A(12615);const WI="gpuRenderParticlesVertexShader",gI="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";e.e.ShadersStore[WI]||(e.e.ShadersStore[WI]=gI);class oI extends c{static get IsSupported(){if(!U.e.LastCreatedEngine)return!1;const V=U.e.LastCreatedEngine.getCaps();return V.supportTransformFeedbacks||V.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(V){this._maxActiveParticleCount=Math.min(V,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(V){this.maxActiveParticleCount=V}createPointEmitter(V,I){const A=ZV(V,I);return this.particleEmitterType=A,A}createHemisphericEmitter(){const V=aV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createSphereEmitter(){const V=kV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createDirectedSphereEmitter(){const V=UV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.tI(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.tI(0,1,0));return this.particleEmitterType=V,V}createCylinderEmitter(){const V=nV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=V,V}createDirectedCylinderEmitter(){const V=VI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.tI(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.tI(0,1,0));return this.particleEmitterType=V,V}createConeEmitter(){const V=II(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=V,V}createDirectedConeEmitter(){const V=AI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.tI(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.tI(0,1,0));return this.particleEmitterType=V,V}createBoxEmitter(V,I,A,B){const F=new P;return this.particleEmitterType=F,this.direction1=V,this.direction2=I,this.minEmitBox=A,this.maxEmitBox=B,F}get flowMap(){return this._flowMap}set flowMap(V){this._flowMap!==V&&(this._flowMap=V)}isReady(){if(!this.BI||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==HI.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(HI.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(HI.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";V?setTimeout((()=>{this.start(0)}),V):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var V;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._customWrappers[I])||void 0===V?void 0:V.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[V]??this._customWrappers[0]}setCustomEffect(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[I]=new VV.e(this._engine),this._customWrappers[I].effect=V}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(V,I,A){return super._removeGradientAndTexture(V,I,A),this._releaseBuffers(),this}addColorGradient(V,I){this._colorGradients||(this._colorGradients=[]);const A=new d(V,I);return this._colorGradients.push(A),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(V&&this._colorGradients.sort(((V,I)=>V.gradient<I.gradient?-1:V.gradient>I.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(V){return this._removeGradientAndTexture(V,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const I in this._drawWrappers){var V;null===(V=this._drawWrappers[I].drawContext)||void 0===V||V.reset()}}_addFactorGradient(V,I,A){const B=new O(I,A);V.push(B),this._releaseBuffers()}addSizeGradient(V,I){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,V,I),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(V){return this._removeGradientAndTexture(V,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(V,I){if(!V)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&V.sort(((V,I)=>V.gradient<I.gradient?-1:V.gradient>I.gradient?1:0));const A=this;A[I]&&(A[I].dispose(),A[I]=null)}addAngularSpeedGradient(V,I){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,V,I),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(V){return this._removeGradientAndTexture(V,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(V,I){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,V,I),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(V){return this._removeGradientAndTexture(V,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(V,I){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,V,I),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(V){return this._removeGradientAndTexture(V,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(V,I){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,V,I),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(V){return this._removeGradientAndTexture(V,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(V){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(V,I,A){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(V),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.aY=new a.c,this.onStoppedObservable=new a.c,this.onStartedObservable=new a.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,A&&"Scene"!==A.getClassName()?(this._engine=A,this.defaultProjectionMatrix=B.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=A||U.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.XG.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,H.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,H.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,H.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,H.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new VV.e(this._engine)},this._customWrappers[0].effect=F,this._drawWrappers={0:new VV.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(I=I??{}).randomTextureSize||delete I.randomTextureSize;const Y={tA:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...I},c=I;isFinite(c)&&(Y.tA=c),this._capacity=Y.tA,this._maxActiveParticleCount=Y.tA,this._currentActiveCount=0,this._isAnimationSheetEnabled=E,this.particleEmitterType=new P;const b=Math.min(this._engine.getCaps().maxTextureSize,Y.randomTextureSize);let X=[];for(let B=0;B<b;++B)X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),X.push(Math.random());this._randomTexture=new k.b(new Float32Array(X),b,1,5,A,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,X=[];for(let B=0;B<b;++B)X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),X.push(Math.random());this._randomTexture2=new k.b(new Float32Array(X),b,1,5,A,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=b}_reset(){this._releaseBuffers()}_createVertexBuffers(V,I,A){const B={};B.position=I.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let F=3;B.age=I.createVertexBuffer("age",F,1,this._attributesStrideSize,!0),F+=1,B.size=I.createVertexBuffer("size",F,3,this._attributesStrideSize,!0),F+=3,B.life=I.createVertexBuffer("life",F,1,this._attributesStrideSize,!0),F+=1,F+=4,this.billboardMode===HI.BILLBOARDMODE_STRETCHED&&(B.direction=I.createVertexBuffer("direction",F,3,this._attributesStrideSize,!0)),F+=3,this._platform.alignDataInBuffer&&(F+=1),this.particleEmitterType instanceof L&&(F+=3,this._platform.alignDataInBuffer&&(F+=1)),this._colorGradientsTexture||(B.color=I.createVertexBuffer("color",F,4,this._attributesStrideSize,!0),F+=4),this._isBillboardBased||(B.initialDirection=I.createVertexBuffer("initialDirection",F,3,this._attributesStrideSize,!0),F+=3,this._platform.alignDataInBuffer&&(F+=1)),this.noiseTexture&&(B.noiseCoordinates1=I.createVertexBuffer("noiseCoordinates1",F,3,this._attributesStrideSize,!0),F+=3,this._platform.alignDataInBuffer&&(F+=1),B.noiseCoordinates2=I.createVertexBuffer("noiseCoordinates2",F,3,this._attributesStrideSize,!0),F+=3,this._platform.alignDataInBuffer&&(F+=1)),B.angle=I.createVertexBuffer("angle",F,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?F++:F+=2,this._isAnimationSheetEnabled&&(B.cellIndex=I.createVertexBuffer("cellIndex",F,1,this._attributesStrideSize,!0),F+=1,this.spriteRandomStartCell&&(B.cellStartOffset=I.createVertexBuffer("cellStartOffset",F,1,this._attributesStrideSize,!0),F+=1)),B.offset=A.createVertexBuffer("offset",0,2),B.uv=A.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(B),this._platform.createVertexBuffers(V,B),this.resetDrawCache()}_initialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!V)return;const I=this._engine,A=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof L&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const F=this.particleEmitterType instanceof L,E=B.TmpVectors.tI[0];let Y=0;for(let B=0;B<this._capacity;B++)if(A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),F?(this.particleEmitterType.particleDestinationGenerator(B,null,E),A.push(E.x),A.push(E.y),A.push(E.z)):(A.push(0),A.push(0),A.push(0)),this._platform.alignDataInBuffer&&A.push(0),Y+=16,F&&(this.particleEmitterType.particlePositionGenerator(B,null,E),A.push(E.x),A.push(E.y),A.push(E.z),this._platform.alignDataInBuffer&&A.push(0),Y+=4),this._colorGradientsTexture||(A.push(0),A.push(0),A.push(0),A.push(0),Y+=4),this.isBillboardBased||(A.push(0),A.push(0),A.push(0),this._platform.alignDataInBuffer&&A.push(0),Y+=4),this.noiseTexture&&(A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),this._platform.alignDataInBuffer&&A.push(0),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),this._platform.alignDataInBuffer&&A.push(0),Y+=8),A.push(0),Y+=1,this._angularSpeedGradientsTexture||(A.push(0),Y+=1),this._isAnimationSheetEnabled&&(A.push(0),Y+=1,this.spriteRandomStartCell&&(A.push(0),Y+=1)),this._platform.alignDataInBuffer){let V=3-(Y+3&3);for(Y+=V;V-- >0;)A.push(0)}const H=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),c=this._platform.createParticleBuffer(A),b=this._platform.createParticleBuffer(A);this._buffer0=new z.d(I,c,!1,this._attributesStrideSize),this._buffer1=new z.d(I,b,!1,this._attributesStrideSize),this._spriteBuffer=new z.d(I,H,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let V=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(V+="\n#define BILLBOARD"),this._colorGradientsTexture&&(V+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(V+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(V+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(V+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(V+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(V+="\n#define DRAGGRADIENTS"),this._flowMap&&(V+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(V+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(V+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(V+="\n#define NOISE"),this.isLocal&&(V+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===V||(this._cachedUpdateDefines=V,this._updateBuffer=this._platform.createUpdateBuffer(V)),this._platform.isUpdateBufferReady()}_getWrapper(V){const I=this._getCustomDrawWrapper(V);if(null!==I&&void 0!==I&&I.effect)return I;const A=[];this.fillDefines(A,V);let B=this._drawWrappers[V];B||(B=new VV.e(this._engine),B.drawContext&&(B.drawContext.useInstancing=!0),this._drawWrappers[V]=B);const F=A.join("\n");if(B.defines!==F){const V=[],I=[],A=[];this.fillUniformsAttributesAndSamplerNames(I,V,A),B.setEffect(this._engine.createEffect("gpuRenderParticles",V,I,A,F),F)}return B}static _GetAttributeNamesOrOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const F=[z.g.PositionKind,"age","life","size","angle"];return V||F.push(z.g.ColorKind),I&&F.push("cellIndex"),A||F.push("initialDirection"),B&&F.push("direction"),F.push("offset",z.g.UVKind),F}static _GetEffectCreationOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=["emitterWM","MX","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,IV.d)(B),V&&B.push("sheetInfos"),I&&B.push("logarithmicDepthConstant"),A&&(B.push("vFogInfos"),B.push("vFogColor")),B}fillDefines(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,IV.p)(this,this._scene,V),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==bI.b.FOGMODE_NONE&&V.push("#define FOG")),I===HI.BLENDMODE_MULTIPLY&&V.push("#define BLENDMULTIPLYMODE"),this.isLocal&&V.push("#define LOCAL"),this.useLogarithmicDepth&&V.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(V.push("#define BILLBOARD"),this.billboardMode){case HI.BILLBOARDMODE_Y:V.push("#define BILLBOARDY");break;case HI.BILLBOARDMODE_STRETCHED:V.push("#define BILLBOARDSTRETCHED");break;case HI.BILLBOARDMODE_ALL:V.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&V.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&V.push("#define ANIMATESHEET"),A&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),V.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(V,I,A){I.push(...oI._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===HI.BILLBOARDMODE_STRETCHED)),V.push(...oI._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),A.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(cI.e.PrepareUniforms(V,this._imageProcessingConfigurationDefines),cI.e.PrepareSamplers(A,this._imageProcessingConfigurationDefines))}animate(){var V;let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(I?this.preWarmStepOffset:(null===(V=this._scene)||void 0===V?void 0:V.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(V,I){const A=this[I];if(!V||!V.length||A)return;const B=new Float32Array(this._rawTextureWidth);for(let F=0;F<this._rawTextureWidth;F++){const I=F/this._rawTextureWidth;Z.GetCurrentGradient(I,V,((V,I,A)=>{B[F]=(0,b.Lerp)(V.factor1,I.factor1,A)}))}this[I]=k.b.CreateRTexture(B,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[I].name=I.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const V=new Uint8Array(4*this._rawTextureWidth),I=Y.TmpColors.GH[0];for(let A=0;A<this._rawTextureWidth;A++){const B=A/this._rawTextureWidth;Z.GetCurrentGradient(B,this._colorGradients,((B,F,E)=>{Y.GH.LerpToRef(B.color1,F.color1,E,I),V[4*A]=255*I.r,V[4*A+1]=255*I.g,V[4*A+2]=255*I.b,V[4*A+3]=255*I.a}))}this._colorGradientsTexture=k.b.CreateRGBATexture(V,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(V,I){var A,F,E,Y;const H=this._getWrapper(V),c=H.effect;this._engine.enableEffect(H);const b=(null===(A=this._scene)||void 0===A?void 0:A.getViewMatrix())||B.Matrix.IdentityReadOnly;if(c.setMatrix("view",b),c.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),c.setTexture("diffuseSampler",this.particleTexture),c.setVector2("translationPivot",this.translationPivot),c.setVector3("MX",this.MX),this.isLocal&&c.setMatrix("emitterWM",I),this._colorGradientsTexture?c.setTexture("colorGradientSampler",this._colorGradientsTexture):c.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const V=this.particleTexture.getBaseSize();c.setFloat3("sheetInfos",this.spriteCellWidth/V.width,this.spriteCellHeight/V.height,V.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const V=this._scene.activeCamera;c.setVector3("eyePosition",V.globalPosition)}const X=c.defines;if(this._scene&&((0,IV.h)(c,this,this._scene),this.applyFog&&(0,AV.d)(this._scene,void 0,c)),X.indexOf("#define BILLBOARDMODE_ALL")>=0){const V=b.clone();V.invert(),c.setMatrix("invView",V)}return this.useLogarithmicDepth&&this._scene&&(0,AV.l)(X,c,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(c),this._setEngineBasedOnBlendMode(V),this._platform.bindDrawBuffers(this._targetIndex,c,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(c),null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(V){if(!this.BI||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!V)if(this.BI.position){V=this.BI.getWorldMatrix()}else{const I=this.BI;V=B.TmpVectors.Matrix[0],B.Matrix.TranslationToRef(I.x,I.y,I.z,V)}const I=this._engine,A=I.getDepthWrite();if(I.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const V=this.sV();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",V.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",V),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const F=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=F,I.setDepthWrite(A)}render(){let V,I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!I&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let V=0;V<this.preWarmCycles;V++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const V=0|this._accumulatedCount;this._accumulatedCount-=V,this._currentActiveCount+=V}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.BI.position){V=this.BI.getWorldMatrix()}else{const I=this.BI;V=B.TmpVectors.Matrix[0],B.Matrix.TranslationToRef(I.x,I.y,I.z,V)}const F=this._engine;this.updateInAnimate||this._update(V);let E=0;return I||A||(F.setState(!1),this.forceDepthWrite&&F.setDepthWrite(!0),E=this.blendMode===HI.BLENDMODE_MULTIPLYADD?this._render(HI.BLENDMODE_MULTIPLY,V)+this._render(HI.BLENDMODE_ADD,V):this._render(this.blendMode,V),this._engine.setAlphaMode(0)),E}rebuild(){const V=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(V,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,V()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const I in this._drawWrappers){this._drawWrappers[I].dispose()}if(this._drawWrappers={},this._scene){const V=this._scene.XG.indexOf(this);V>-1&&this._scene.XG.splice(V,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let I=0;I<this._renderVertexBuffers.length;++I){const V=this._renderVertexBuffers[I];for(const I in V)V[I].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),V&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),V&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.aY.notifyObservers(this),this.aY.clear()}clone(V,I){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B={...this._customWrappers};let F=null;const E=this._engine;if(E.createEffectForParticles&&null!=this.customShader){F=this.customShader;const V=F.shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"";B[0]=E.createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,V,void 0,void 0,void 0,this)}const Y=this.serialize(A),H=oI.Parse(Y,this._scene||this._engine,this._rootUrl);return H.name=V,H.customShader=F,H._customWrappers=B,void 0===I&&(I=this.BI),this.noiseTexture&&(H.noiseTexture=this.noiseTexture.clone()),H.BI=I,H}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};return HI._Serialize(I,this,V),I.activeParticleCount=this.activeParticleCount,I.randomTextureSize=this._randomTextureSize,I.customShader=this.customShader,I}static Parse(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0;const E=V.name;let Y,H;I instanceof OV.e?Y=I:(H=I,Y=H.getEngine());const c=new oI(E,{tA:F||V.tA,randomTextureSize:V.randomTextureSize},I,null,V.isAnimationSheetEnabled);if(c._rootUrl=A,V.customShader&&Y.createEffectForParticles){const I=V.customShader,A=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"",B=Y.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,A,void 0,void 0,void 0,c);c.setCustomEffect(B,0),c.customShader=I}return V.id&&(c.id=V.id),V.activeParticleCount&&(c.activeParticleCount=V.activeParticleCount),HI._Parse(V,c,I,A),V.preventAutoStart&&(c.preventAutoStart=V.preventAutoStart),B||c.preventAutoStart||c.start(),c}}var LI=A(11052),zI=A(12617),mI=A(11614);class sI{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(V){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const I of this.systems)I.BI=V;this._emitterNode=V}setEmitterAsSphere(V,I,A){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:V,renderingGroupId:I};const B=(0,zI.d)("emitterSphere",{diameter:V.diameter,segments:V.segments},A);B.renderingGroupId=I;const F=new mI.gI("emitterSphereMaterial",A);F.emissiveColor=V.color,B.material=F;for(const E of this.systems)E.BI=B;this._emitterNode=B}start(V){for(const I of this.systems)V&&(I.BI=V),I.start()}dispose(){for(const V of this.systems)V.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={systems:[]};for(const A of this.systems)I.systems.push(A.serialize(V));return this._emitterNode&&(I.BI=this._emitterCreationOptions),I}static Parse(V,I){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;const F=new sI,E=this.BaseAssetsUrl+"/textures/";I=I||U.e.LastCreatedScene;for(const Y of V.systems)F.systems.push(A?oI.Parse(Y,I,E,!0,B):HI.Parse(Y,I,E,!0,B));if(V.BI){const A=V.BI.options;if("Sphere"===V.BI.kind)F.setEmitterAsSphere({diameter:A.diameter,segments:A.segments,color:Y.oI.LI(A.color)},V.BI.renderingGroupId,I)}return F}}sI.BaseAssetsUrl="https://assets.babylonjs.com/particles";var eI=A(11091);class SI{static CreateDefault(V){let I,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,B=arguments.length>2?arguments[2]:void 0;I=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new oI("default system",{tA:A},B):new HI("default system",A,B),I.BI=V;const F=LI.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return I.particleTexture=new q.e(F,I.sV()),I.createConeEmitter(.1,Math.PI/4),I.color1=new Y.GH(1,1,1,1),I.color2=new Y.GH(1,1,1,1),I.colorDead=new Y.GH(1,1,1,0),I.minSize=.1,I.maxSize=.1,I.minEmitPower=2,I.maxEmitPower=2,I.updateSpeed=1/60,I.emitRate=30,I}static CreateAsync(V,I){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;I||(I=U.e.LastCreatedScene);const F={};return I.addPendingData(F),new Promise(((E,Y)=>{if(A&&!oI.IsSupported)return I.removePendingData(F),Y("Particle system with GPU is not supported.");LI.Tools.LoadFile(`${SI.BaseAssetsUrl}/systems/${V}.json`,(V=>{I.removePendingData(F);const Y=JSON.parse(V.toString());return E(sI.Parse(Y,I,A,B))}),void 0,void 0,void 0,(()=>(I.removePendingData(F),Y(`An error occurred with the creation of your particle system. Check if your type '${V}' exists.`))))}))}static ExportSet(V){const I=new sI;for(const A of V)I.systems.push(A);return I}static ParseFromFileAsync(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",E=arguments.length>5?arguments[5]:void 0;return new Promise(((Y,H)=>{const c=new eI.b;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const I=JSON.parse(c.responseText);let H;H=B?oI.Parse(I,A,F,!1,E):HI.Parse(I,A,F,!1,E),V&&(H.name=V),Y(H)}else H("Unable to load the particle system")})),c.open("GET",I),c.send()}))}static ParseFromSnippetAsync(V,I){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",F=arguments.length>4?arguments[4]:void 0;if("_BLANK"===V){const V=this.CreateDefault(null);return V.start(),Promise.resolve(V)}return new Promise(((E,Y)=>{const H=new eI.b;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const Y=JSON.parse(JSON.parse(H.responseText).jsonPayload),c=JSON.parse(Y.particleSystem);let b;b=A?oI.Parse(c,I,B,!1,F):HI.Parse(c,I,B,!1,F),b.snippetId=V,E(b)}else Y("Unable to load the snippet "+V)})),H.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),H.send()}))}}SI.BaseAssetsUrl=sI.BaseAssetsUrl,SI.SnippetUrl="https://snippet.babylonjs.com",SI.CreateFromSnippetAsync=SI.ParseFromSnippetAsync;var QI=A(11701),hI=A(11499),rI=A(12623);(0,rI.c)(hI.d.NAME_PARTICLESYSTEM,((V,I,A,B)=>{const F=(0,rI.f)(hI.d.NAME_PARTICLESYSTEM);if(F&&void 0!==V.XG&&null!==V.XG)for(let E=0,Y=V.XG.length;E<Y;E++){const Y=V.XG[E];A.XG.push(F(Y,I,B))}})),(0,rI.b)(hI.d.NAME_PARTICLESYSTEM,((V,I,A)=>{if(V.activeParticleCount){return oI.Parse(V,I,A)}return HI.Parse(V,I,A)})),OV.e.prototype.createEffectForParticles=function(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",E=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0,H=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,X=arguments.length>9?arguments[9]:void 0,P=[],J=[];const G=[];return c?c.fillUniformsAttributesAndSamplerNames(J,P,G):(P=HI._GetAttributeNamesOrOptions(),J=HI._GetEffectCreationOptions()),-1===F.indexOf(" BILLBOARD")&&(F+="\n#define BILLBOARD\n"),null!==c&&void 0!==c&&c.isAnimationSheetEnabled&&-1===F.indexOf(" ANIMATESHEET")&&(F+="\n#define ANIMATESHEET\n"),-1===B.indexOf("diffuseSampler")&&B.push("diffuseSampler"),this.createEffect({vertex:X??(null===c||void 0===c?void 0:c.vertexShaderName)??"particles",fragmentElement:V},P,J.concat(I),G.concat(B),F,E,Y,H,void 0,b,(async()=>{0===b?await Promise.resolve().then(A.bind(A,12653)):await Promise.resolve().then(A.bind(A,12723))}))},QI.c.prototype.getEmittedParticleSystems=function(){const V=[];for(let I=0;I<this.sV().XG.length;I++){const A=this.sV().XG[I];A.BI===this&&V.push(A)}return V},QI.c.prototype.getHierarchyEmittedParticleSystems=function(){const V=[],I=this.getDescendants();I.push(this);for(let A=0;A<this.sV().XG.length;A++){const B=this.sV().XG[A],F=B.BI;F.position&&-1!==I.indexOf(F)&&V.push(B)}return V};A(11571),A(11587),A(11669);A(11676),A(12627),A(11428),A(11563),A(11722);A(11420);var MI;A(12631),A(11251);!function(V){V[V.Color=2]="Color",V[V.UV=1]="UV",V[V.Random=0]="Random",V[V.Stated=3]="Stated"}(MI||(MI={}));var xI=A(11461);const fI=new B.tI(0,0,0),RI=new B.tI(0,0,0),qI=new B.tI(0,0,0);class NI{constructor(V,I,A){this.width=V,this.height=I,this.data=A}processFlowable(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2?arguments[2]:void 0;if(!A)return;A instanceof B.Matrix?B.tI.TransformCoordinatesToRef(V.position,A,qI):(qI.x=A.x,qI.y=A.y,qI.z=A.z);const F=.5*qI.x+.5,E=1-(.5*qI.y+.5),Y=Math.floor(F*this.width),H=Math.floor(E*this.height);if(Y<0||Y>=this.width||H<0||H>=this.height)return;const c=4*(H*this.width+Y),b=this.data[c]/255*2-1,X=this.data[c+1]/255*2-1,P=this.data[c+2]/255*2-1,J=this.data[c+3]/255;fI.set(b,X,P),fI.scaleToRef(I*J,RI),V.direction.addInPlace(RI)}_processParticle(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2?arguments[2]:void 0;this.processFlowable(V,I,A)}static async FromUrlAsync(V){return await new Promise(((I,A)=>{const B=document.createElement("canvas"),F=B.getContext("2d");let E=null;const Y=new Image;Y.crossOrigin="anonymous",Y.src=V,Y.onerror=I=>{A(new Error(`Failed to load image: ${V} : ${I}`))},Y.onload=()=>{B.width=Y.width,B.height=Y.height,F.drawImage(Y,0,0),E=F.getImageData(0,0,B.width,B.height),I(new NI(B.width,B.height,E.data))}}))}static async ExtractFromTextureAsync(V){return await new Promise(((I,A)=>{if(!V.isReady())return void V.onLoadObservable.addOnce((async()=>{try{const A=await this.ExtractFromTextureAsync(V);I(A)}catch(B){A(B)}}));const B=V.getSize();xI.j.GetTextureDataAsync(V,B.width,B.height).then((V=>{I(new NI(B.width,B.height,new Uint8ClampedArray(V)))})).catch(A)}))}}var lI,iI,yI,vI,CI,KI,pI,jI,TI;!function(V){V[V.Int=1]="Int",V[V.Float=2]="Float",V[V.Vector2=4]="Vector2",V[V.tI=8]="tI",V[V.Matrix=16]="Matrix",V[V.Particle=32]="Particle",V[V.Texture=64]="Texture",V[V.GH=128]="GH",V[V.FloatGradient=256]="FloatGradient",V[V.Vector2Gradient=512]="Vector2Gradient",V[V.Vector3Gradient=1024]="Vector3Gradient",V[V.Color4Gradient=2048]="Color4Gradient",V[V.System=4096]="System",V[V.AutoDetect=8192]="AutoDetect",V[V.BasedOnInput=16384]="BasedOnInput",V[V.Undefined=32768]="Undefined",V[V.All=65535]="All"}(lI||(lI={})),function(V){V[V.Compatible=0]="Compatible",V[V.TypeIncompatible=1]="TypeIncompatible",V[V.HierarchyIssue=2]="HierarchyIssue"}(iI||(iI={})),function(V){V[V.Input=0]="Input",V[V.Output=1]="Output"}(yI||(yI={}));class dI{get direction(){return this._direction}get type(){if(this._type===lI.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===lI.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(V){this._type=V}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((V=>V.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(V,I,A){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=lI.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new a.c,this.onDisconnectionObservable=new a.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=I,this.name=V,this._direction=A}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(V){var I;return this.isConnected?null!==(I=this._connectedPoint)&&void 0!==I&&I._storedFunction?this._connectedPoint._storedFunction(V):this._connectedPoint._storedValue:this.value}canConnectTo(V){return 0===this.checkCompatibilityState(V)}checkCompatibilityState(V){const I=this._ownerBlock,A=V.ownerBlock;if(this.type!==V.type&&V.innerType!==lI.AutoDetect)return V.acceptedConnectionPointTypes&&-1!==V.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(V.excludedConnectionPointTypes&&-1!==V.excludedConnectionPointTypes.indexOf(this.type))return 1;let B=A,F=I;return 0===this.direction&&(B=I,F=A),B.isAnAncestorOf(F)?2:0}connectTo(V){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(V))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${V.ownerBlock.name}".${V.name}`;return this._endpoints.push(V),V._connectedPoint=this,this.onConnectionObservable.notifyObservers(V),V.onConnectionObservable.notifyObservers(this),this}disconnectFrom(V){const I=this._endpoints.indexOf(V);return-1===I||(this._endpoints.splice(I,1),V._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(V),V.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(V){let I=1;for(;I<lI.All;)V&I||this.excludedConnectionPointTypes.push(I),I<<=1}serialize(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const I={};return I.name=this.name,I.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.AH?(I.valueType="BABYLON."+this.value.getClassName(),I.value=this.value.AH()):(I.valueType="number",I.value=this.value)),V&&this.connectedPoint&&(I.inputName=this.name,I.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,I.targetConnectionName=this.connectedPoint.name,I.isExposedOnFrame=!0,I.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(I.isExposedOnFrame=!0,I.exposedPortPosition=this.exposedPortPosition),I}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class DI{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(V){this._name=V}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(V){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new a.c,this.aY=new a.c,this.onInputChangedObservable=new a.c,this.visibleOnFrame=!1,this._name=V,this.uniqueId=N.d.UniqueId}_inputRename(V){return V}_outputRename(V){return V}isAnAncestorOf(V){for(const I of this._outputs)if(I.hasEndpoints)for(const A of I.endpoints){if(A.ownerBlock===V)return!0;if(A.ownerBlock.isAnAncestorOf(V))return!0}return!1}isAnAncestorOfType(V){if(this.getClassName()===V)return!0;for(const I of this._outputs)if(I.hasEndpoints)for(const A of I.endpoints)if(A.ownerBlock.isAnAncestorOfType(V))return!0;return!1}getInputByName(V){const I=this._inputs.filter((I=>I.name===V));return I.length?I[0]:null}_linkConnectionTypes(V,I){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[I]._acceptedConnectionPointType=this._inputs[V]:(this._inputs[V]._linkedConnectionSource=this._inputs[I],this._inputs[V]._isMainLinkSource=!0),this._inputs[I]._linkedConnectionSource=this._inputs[V]}registerInput(V,I){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0;const Y=new dI(V,this,0);return Y.type=I,Y.isOptional=A,Y.defaultValue=B,Y.value=B,Y.valueMin=F,Y.valueMax=E,this._inputs.push(Y),this.onInputChangedObservable.notifyObservers(Y),this}registerOutput(V,I,A){return(A=A??new dI(V,this,1)).type=I,this._outputs.push(A),this}_build(V){}_customBuildStep(V){}build(V){if(this._buildId===V.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((V=>V.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=V.buildId;for(const I of this._inputs){if(!I.connectedPoint){I.isOptional||V.notConnectedNonOptionalInputs.push(I);continue}const A=I.connectedPoint.ownerBlock;A&&A!==this&&!A.isSystem&&A.build(V)}return this._customBuildStep(V),V.verbose&&l.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(V),this.onBuildObservable.notifyObservers(this),!1}serialize(){const V={};V.customType="BABYLON."+this.getClassName(),V.id=this.uniqueId,V.name=this.name,V.visibleOnFrame=this.visibleOnFrame,V.inputs=[],V.outputs=[];for(const I of this.inputs)V.inputs.push(I.serialize());for(const I of this.outputs)V.outputs.push(I.serialize(!1));return V}_deserialize(V){this._name=V.name,this.comments=V.comments,this.visibleOnFrame=!!V.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(V)}_deserializePortDisplayNamesAndExposedOnFrame(V){const I=V.inputs,A=V.outputs;if(I)for(const B of I){const V=this.inputs.find((V=>V.name===B.name));if(!V)return;if(B.displayName&&(V.displayName=B.displayName),B.isExposedOnFrame&&(V.isExposedOnFrame=B.isExposedOnFrame,V.exposedPortPosition=B.exposedPortPosition),void 0!==B.value&&null!==B.value)if("number"===B.valueType)V.value=B.value;else{const I=(0,H.b)(B.valueType);I&&(V.value=I.LI(B.value))}}if(A)for(let B=0;B<A.length;B++){const V=A[B];V.displayName&&(this.outputs[B].displayName=V.displayName),V.isExposedOnFrame&&(this.outputs[B].isExposedOnFrame=V.isExposedOnFrame,this.outputs[B].exposedPortPosition=V.exposedPortPosition)}}clone(){const V=this.serialize(),I=(0,H.b)(V.customType);if(I){const A=new I;return A._deserialize(V),A}return null}dispose(){this.aY.notifyObservers(this),this.aY.clear();for(const V of this.inputs)V.dispose();for(const V of this.outputs)V.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function OI(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",B=arguments.length>3?arguments[3]:void 0;return(F,E)=>{let Y=F._propStore;Y||(Y=[],F._propStore=Y),Y.push({propertyName:E,displayName:V,type:I,groupName:A,options:B??{},className:F.getClassName()})}}(0,x.b)([(0,f.A)("comment")],DI.prototype,"comments",void 0),function(V){V[V.Boolean=0]="Boolean",V[V.Float=1]="Float",V[V.Int=2]="Int",V[V.Vector2=3]="Vector2",V[V.List=4]="List",V[V.GH=5]="GH",V[V.SamplingMode=6]="SamplingMode",V[V.TextureFormat=7]="TextureFormat",V[V.TextureType=8]="TextureType"}(vI||(vI={})),function(V){V[V.None=0]="None",V[V.Position=1]="Position",V[V.Direction=2]="Direction",V[V.Age=3]="Age",V[V.Lifetime=4]="Lifetime",V[V.Color=5]="Color",V[V.ScaledDirection=6]="ScaledDirection",V[V.Scale=7]="Scale",V[V.AgeGradient=8]="AgeGradient",V[V.Angle=9]="Angle",V[V.SpriteCellIndex=16]="SpriteCellIndex",V[V.SpriteCellStart=17]="SpriteCellStart",V[V.SpriteCellEnd=18]="SpriteCellEnd"}(CI||(CI={})),function(V){V[V.None=0]="None",V[V.Time=1]="Time",V[V.Delta=2]="Delta",V[V.Emitter=3]="Emitter"}(KI||(KI={}));class ZI{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let V="";for(const I of this.notConnectedNonOptionalInputs)V+=`input ${I.name} from block ${I.ownerBlock.name}[${I.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(V)throw"Build of Node Particle System Set failed:\n"+V}adapt(V,I){const A=V.getConnectedValue(this)||0;if(V.type===I)return A;switch(I){case lI.Vector2:return new B.Vector2(A,A);case lI.tI:return new B.tI(A,A,A);case lI.GH:return new Y.GH(A,A,A,A)}return null}getContextualValue(V){if(!this.particleContext||!this.systemContext)return null;switch(V){case CI.Position:return this.particleContext.position;case CI.Direction:return this.particleContext.direction;case CI.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case CI.Color:return this.particleContext.color;case CI.Age:return this.particleContext.age;case CI.Lifetime:return this.particleContext.lifeTime;case CI.Angle:return this.particleContext.angle;case CI.Scale:return this.particleContext.scale;case CI.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case CI.SpriteCellEnd:return this.systemContext.endSpriteCellID;case CI.SpriteCellIndex:return this.particleContext.cellIndex;case CI.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.BI.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.BI.absolutePosition:this.systemContext.BI:null}getSystemValue(V){if(!this.particleContext||!this.systemContext)return null;switch(V){case KI.Time:return this.systemContext._actualFrame;case KI.Delta:return this.systemContext._scaledUpdateSpeed;case KI.Emitter:if(this.isEmitterTransformNode){return this.systemContext.BI.absolutePosition}return this.systemContext.BI}return null}}function aI(V,I,A){const B=new ZI;B.WI=I;const F=V.createSystem(B);return F.canStart=()=>!0,F.BI=A.clone(),F.disposeOnStop=!0,F.start(),F}class kI extends DI{constructor(V){super(V),this.blendMode=c.BLENDMODE_ONEONE,this.tA=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",lI.Particle),this.registerInput("texture",lI.Texture),this.registerInput("onStart",lI.System,!0),this.registerInput("onEnd",lI.System,!0),this.registerOutput("system",lI.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(V){V.tA=this.tA,V.buildId=this._buildId++,this.build(V);const I=this.particle.getConnectedValue(V);return I.particleTexture=this.texture.getConnectedValue(V),I.emitRate=this.emitRate,I.blendMode=this.blendMode,I.name=this.name,I._nodeGenerated=!0,I._targetStopDuration=this.targetStopDuration,I.startDelay=this.startDelay,this.system._storedValue=this,I.canStart=()=>!this.doNoStart,I.onStartedObservable.add((A=>{const B=this.onStart.getConnectedValue(V);B&&A.onStartedObservable.addOnce((()=>{V.systemContext=I;const A=aI(B,V.WI,V.emitterPosition);this.aY.addOnce((()=>{A.dispose()}))}));const F=this.onEnd.getConnectedValue(V);F&&A.onStoppedObservable.addOnce((()=>{V.systemContext=I;const A=aI(F,V.WI,V.emitterPosition);this.aY.addOnce((()=>{A.dispose()}))}))})),this.aY.addOnce((()=>{I.dispose()})),I}serialize(){const V=super.serialize();return V.tA=this.tA,V.emitRate=this.emitRate,V.blendMode=this.blendMode,V.doNoStart=this.doNoStart,V.targetStopDuration=this.targetStopDuration,V.startDelay=this.startDelay,V}_deserialize(V){super._deserialize(V),this.tA=V.tA,this.emitRate=V.emitRate,this.doNoStart=!!V.doNoStart,void 0!==V.blendMode&&(this.blendMode=V.blendMode),void 0!==V.targetStopDuration&&(this.targetStopDuration=V.targetStopDuration),void 0!==V.startDelay&&(this.startDelay=V.startDelay)}}(0,x.b)([OI("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:c.BLENDMODE_ONEONE},{label:"Standard",value:c.BLENDMODE_STANDARD},{label:"Add",value:c.BLENDMODE_ADD},{label:"Multiply",value:c.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:c.BLENDMODE_MULTIPLYADD}]})],kI.prototype,"blendMode",void 0),(0,x.b)([OI("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],kI.prototype,"tA",void 0),(0,x.b)([OI("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kI.prototype,"emitRate",void 0),(0,x.b)([OI("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kI.prototype,"targetStopDuration",void 0),(0,x.b)([OI("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kI.prototype,"startDelay",void 0),(0,x.b)([OI("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],kI.prototype,"doNoStart",void 0),(0,H.e)("BABYLON.SystemBlock",kI);class UI extends DI{get type(){if(this._type===lI.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=lI.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=lI.Vector2,this._type;case"tI":return this._type=lI.tI,this._type;case"GH":return this._type=lI.GH,this._type;case"Matrix":return this._type=lI.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===CI.None&&this._systemSource!==KI.None}get systemSource(){return this._systemSource}set systemSource(V){if(this._systemSource=V,V!==KI.None){switch(this._contextualSource=CI.None,this._type=lI.Float,V){case KI.Time:case KI.Delta:this._type=lI.Float;break;case KI.Emitter:this._type=lI.tI}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==CI.None}get contextualValue(){return this._contextualSource}set contextualValue(V){if(this._contextualSource=V,V!==CI.None){switch(this._systemSource=KI.None,V){case CI.Scale:this._type=lI.Vector2;break;case CI.Position:case CI.Direction:case CI.ScaledDirection:this._type=lI.tI;break;case CI.Color:this._type=lI.GH;break;case CI.Age:case CI.Lifetime:case CI.Angle:case CI.AgeGradient:this._type=lI.Float;break;case CI.SpriteCellEnd:case CI.SpriteCellStart:case CI.SpriteCellIndex:this._type=lI.Int}this.output&&(this.output.type=this._type)}}constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lI.AutoDetect;super(V),this._type=lI.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new a.c,this._systemSource=KI.None,this._contextualSource=CI.None,this._type=I,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",I)}get value(){return this._storedValue}set value(V){this.type===lI.Float&&this.min!==this.max&&(V=Math.max(this.min,V),V=Math.min(this.max,V)),this._storedValue=V,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(V){this._valueCallback=V}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case lI.Int:case lI.Float:this.value=0;break;case lI.Vector2:this.value=B.Vector2.Zero();break;case lI.tI:this.value=B.tI.Zero();break;case lI.GH:this.value=new Y.GH(1,1,1,1);break;case lI.Matrix:this.value=B.Matrix.Identity()}}_build(V){super._build(V),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=V=>V.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=V=>V.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const V=super.serialize();return V.type=this.type,V.contextualValue=this.contextualValue,V.systemSource=this.systemSource,V.min=this.min,V.max=this.max,V.groupInInspector=this.groupInInspector,V.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.AH?(V.valueType="BABYLON."+this._storedValue.getClassName(),V.value=this._storedValue.AH()):(V.valueType="number",V.value=this._storedValue)),V}_deserialize(V){if(super._deserialize(V),this._type=V.type,this.contextualValue=V.contextualValue,this.systemSource=V.systemSource||KI.None,this.min=V.min||0,this.max=V.max||0,this.groupInInspector=V.groupInInspector||"",void 0!==V.displayInInspector&&(this.displayInInspector=V.displayInInspector),V.valueType)if("number"===V.valueType)this._storedValue=V.value;else{const I=(0,H.b)(V.valueType);I&&(this._storedValue=I.LI(V.value))}}}(0,H.e)("BABYLON.ParticleInputBlock",UI);class nI extends DI{get url(){return this._url}set url(V){this._url!==V&&(this._cachedData=null,this._url=V,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(V){this._textureDataUrl!==V&&(this._cachedData=null,this._textureDataUrl=V,this._url="",this._sourceTexture=null)}set sourceTexture(V){this._sourceTexture!==V&&(this._cachedData=null,this._sourceTexture=V,this._url="",this._textureDataUrl="")}constructor(V){super(V),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",lI.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const V=this.texture._storedValue;return await new Promise(((I,A)=>{if(!V.isReady())return void V.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),I(this._cachedData)}catch(V){A(V)}}));const B=V.getSize();xI.j.GetTextureDataAsync(V,B.width,B.height).then((A=>{this._cachedData={width:B.width,height:B.height,data:new Uint8ClampedArray(A)},V.dispose(),I(this._cachedData)})).catch(A)}))}_build(V){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new q.e(this._textureDataUrl,V.WI):this.texture._storedValue=new q.e(this._url,V.WI):this.texture._storedValue=null}serialize(){const V=super.serialize();return V.url=this.url,V.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(V.textureDataUrl=this.textureDataUrl),V}_deserialize(V){super._deserialize(V),this.url=V.url,this.serializedCachedData=!!V.serializedCachedData,V.textureDataUrl&&(this.textureDataUrl=V.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,H.e)("BABYLON.ParticleTextureSourceBlock",nI);class VA extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerInput("position",lI.tI),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.position.isConnected)return;const A={process:A=>{V.particleContext=A,V.systemContext=I,A.position.B(this.position.getConnectedValue(V))},previousItem:null,nextItem:null};I._updateQueueStart?KV(A,I._updateQueueStart):I._updateQueueStart=A}}(0,H.e)("BABYLON.UpdatePositionBlock",VA),function(V){V[V.Add=0]="Add",V[V.Subtract=1]="Subtract",V[V.Multiply=2]="Multiply",V[V.Divide=3]="Divide",V[V.Max=4]="Max",V[V.Min=5]="Min"}(pI||(pI={}));class IA extends DI{constructor(V){super(V),this.operation=pI.Add,this.registerInput("left",lI.AutoDetect),this.registerInput("right",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this.output._typeConnectionSource=this.left;const I=[lI.Matrix,lI.Particle,lI.Texture,lI.System,lI.FloatGradient,lI.Color4Gradient,lI.Vector2Gradient,lI.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...I),this.right.excludedConnectionPointTypes.push(...I),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(V){let I;const A=this.left,F=this.right;if(!A.isConnected||!F.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const E=A.type===lI.Float||A.type===lI.Int,H=F.type===lI.Float||F.type===lI.Int,c=E&&H;switch(this.operation){case pI.Add:I=c?V=>A.getConnectedValue(V)+F.getConnectedValue(V):E?V=>V.adapt(A,F.type).add(F.getConnectedValue(V)):V=>A.getConnectedValue(V).add(V.adapt(F,A.type));break;case pI.Subtract:I=c?V=>A.getConnectedValue(V)-F.getConnectedValue(V):E?V=>V.adapt(A,F.type).uI(F.getConnectedValue(V)):V=>A.getConnectedValue(V).uI(V.adapt(F,A.type));break;case pI.Multiply:I=c?V=>A.getConnectedValue(V)*F.getConnectedValue(V):E?V=>V.adapt(A,F.type).multiply(F.getConnectedValue(V)):V=>A.getConnectedValue(V).multiply(V.adapt(F,A.type));break;case pI.Divide:I=c?V=>A.getConnectedValue(V)/F.getConnectedValue(V):E?V=>V.adapt(A,F.type).divide(F.getConnectedValue(V)):V=>A.getConnectedValue(V).divide(V.adapt(F,A.type));break;case pI.Min:if(c)I=V=>Math.min(A.getConnectedValue(V),F.getConnectedValue(V));else{const[V,H]=E?[F,A]:[A,F];switch(V.type){case lI.Vector2:I=I=>B.Vector2.Minimize(V.getConnectedValue(I),I.adapt(H,V.type));break;case lI.tI:I=I=>B.tI.Minimize(V.getConnectedValue(I),I.adapt(H,V.type));break;case lI.GH:I=I=>{const A=V.getConnectedValue(I),{r:B,g:F,b:E,a:c}=I.adapt(H,V.type);return new Y.GH(Math.min(A.r,B),Math.min(A.g,F),Math.min(A.b,E),Math.min(A.a,c))}}}break;case pI.Max:if(!c){const[V,H]=E?[F,A]:[A,F];switch(V.type){case lI.Vector2:I=I=>B.Vector2.Maximize(V.getConnectedValue(I),I.adapt(H,V.type));break;case lI.tI:I=I=>B.tI.Maximize(V.getConnectedValue(I),I.adapt(H,V.type));break;case lI.GH:I=I=>{const A=V.getConnectedValue(I),{r:B,g:F,b:E,a:c}=I.adapt(H,V.type);return new Y.GH(Math.max(A.r,B),Math.min(A.g,F),Math.min(A.b,E),Math.min(A.a,c))}}break}I=V=>Math.max(A.getConnectedValue(V),F.getConnectedValue(V))}this.output._storedFunction=V=>A.type===lI.Int?0|I(V):I(V)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===lI.Int||this.left.type===lI.Float&&this.right.type!==lI.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[V,I]of[[this.left,this.right],[this.right,this.left]])V.acceptedConnectionPointTypes=[lI.Int,lI.Float],I.isConnected&&(V.acceptedConnectionPointTypes.push(I.type),I.type!==lI.Int&&I.type!==lI.Float||V.acceptedConnectionPointTypes.push(lI.Vector2,lI.tI,lI.GH))}dispose(){super.dispose();for(const V of this._connectionObservers)V.remove();this._connectionObservers.length=0}serialize(){const V=super.serialize();return V.operation=this.operation,V}_deserialize(V){super._deserialize(V),this.operation=V.operation}}(0,x.b)([OI("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:pI.Add},{label:"Subtract",value:pI.Subtract},{label:"Multiply",value:pI.Multiply},{label:"Divide",value:pI.Divide},{label:"Max",value:pI.Max},{label:"Min",value:pI.Min}]})],IA.prototype,"operation",void 0),(0,H.e)("BABYLON.ParticleMathBlock",IA);class AA extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerInput("direction1",lI.tI,!0,new B.tI(0,1,0)),this.registerInput("direction2",lI.tI,!0,new B.tI(0,1,0)),this.registerInput("minEmitBox",lI.tI,!0,new B.tI(-.5,-.5,-.5)),this.registerInput("maxEmitBox",lI.tI,!0,new B.tI(.5,.5,.5)),this.registerOutput("output",lI.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(V){const I=this.particle.getConnectedValue(V);I._directionCreation.process=A=>{V.particleContext=A,V.systemContext=I;const F=this.direction1.getConnectedValue(V),E=this.direction2.getConnectedValue(V),Y=(0,b.RandomRange)(F.x,E.x),H=(0,b.RandomRange)(F.y,E.y),c=(0,b.RandomRange)(F.z,E.z);V.isEmitterTransformNode?B.tI.TransformNormalFromFloatsToRef(Y,H,c,V.emitterWorldMatrix,A.direction):A.direction.XH(Y,H,c)},I._positionCreation.process=A=>{V.particleContext=A,V.systemContext=I;const F=this.minEmitBox.getConnectedValue(V),E=this.maxEmitBox.getConnectedValue(V),Y=(0,b.RandomRange)(F.x,E.x),H=(0,b.RandomRange)(F.y,E.y),c=(0,b.RandomRange)(F.z,E.z);V.isEmitterTransformNode?B.tI.TransformCoordinatesFromFloatsToRef(Y,H,c,V.emitterWorldMatrix,A.position):(A.position.XH(Y,H,c),A.position.addInPlace(V.emitterPosition))},this.output._storedValue=I}}(0,H.e)("BABYLON.BoxShapeBlock",AA);class BA extends DI{constructor(V){super(V),this.registerInput("emitPower",lI.Float,!0,1),this.registerInput("lifeTime",lI.Float,!0,1),this.registerInput("color",lI.GH,!0,new Y.GH(1,1,1,1)),this.registerInput("scale",lI.Vector2,!0,new B.Vector2(1,1)),this.registerInput("angle",lI.Float,!0,0),this.registerOutput("particle",lI.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(V){const I=new HI(this.name,V.tA,V.WI,null,!1,void 0,!0);I.particleEmitterType=new W,I._lifeTimeCreation.process=(I,A)=>{V.particleContext=I,I.lifeTime=this.lifeTime.getConnectedValue(V),A._emitPower=this.emitPower.getConnectedValue(V)},I._colorCreation.process=I=>{V.particleContext=I,I.color.B(this.color.getConnectedValue(V))},I._sizeCreation.process=I=>{V.particleContext=I,I.size=1,I.scale.B(this.scale.getConnectedValue(V))},I._angleCreation.process=I=>{V.particleContext=I,I.angle=this.angle.getConnectedValue(V)},this.particle._storedValue=I}}(0,H.e)("BABYLON.CreateParticleBlock",BA);class FA{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const V=[];for(const I of this.attachedBlocks)I.isInput&&V.push(I);return V}constructor(V){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new a.c,this.name=V}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(V)&&this.attachedBlocks.push(V);for(const A of V.inputs){const B=A.connectedPoint;if(B){const A=B.ownerBlock;A!==V&&this._initializeBlock(A,I)}}}async buildAsync(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((A=>{const B=new sI;for(const V of this._systemBlocks)this._initializeBlock(V);for(const F of this.systemBlocks){const A=new ZI;A.buildId=this._buildId++,A.WI=V,A.verbose=I;const E=F.createSystem(A);A.emitErrors(),B.systems.push(E)}this.onBuildObservable.notifyObservers(this),A(B)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const V=new kI("Particle system"),I=new VA("Update position");I.output.connectTo(V.particle);const A=new UI("Position");A.contextualValue=CI.Position;const B=new UI("Scaled direction");B.contextualValue=CI.ScaledDirection;const F=new IA("Add");F.operation=pI.Add,A.output.connectTo(F.left),B.output.connectTo(F.right),F.output.connectTo(I.position);const E=new BA("Create particle"),Y=new AA("Box shape");E.particle.connectTo(Y.particle),Y.output.connectTo(I.particle);const H=new nI("Texture");H.texture.connectTo(V.texture),H.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(V)}removeBlock(V){const I=this.attachedBlocks.indexOf(V);if(I>-1&&this.attachedBlocks.splice(I,1),V.isSystem){const I=this._systemBlocks.indexOf(V);I>-1&&this._systemBlocks.splice(I,1)}}parseSerializedObject(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I||this.clear();const A={};for(const B of V.MP){const V=(0,H.b)(B.customType);if(V){const I=new V;I._deserialize(B),A[B.id]=I,this.attachedBlocks.push(I),I.isSystem&&this._systemBlocks.push(I)}}for(const B of this.attachedBlocks)if(B.isTeleportOut){const V=B,I=V._tempEntryPointUniqueId;if(I){const B=A[I];B&&B.attachToEndpoint(V)}}for(let B=0;B<V.MP.length;B++){const F=V.MP[B],E=A[F.id];E&&(E.inputs.length&&F.inputs.some((V=>V.targetConnectionName))&&!I||this._restoreConnections(E,V,A))}if(V.locations||V.editorData&&V.editorData.locations){const B=V.locations||V.editorData.locations;for(const V of B)A[V.UA]&&(V.UA=A[V.UA].uniqueId);I&&this.editorData&&this.editorData.locations&&B.concat(this.editorData.locations),V.locations?this.editorData={locations:B}:(this.editorData=V.editorData,this.editorData.locations=B);const F=[];for(const V in A)F[V]=A[V].uniqueId;this.editorData.map=F}this.comment=V.comment}_restoreConnections(V,I,A){for(const B of V.outputs)for(const F of I.MP){const E=A[F.id];if(E)for(const Y of F.inputs)if(A[Y.targetBlockId]!==V||Y.targetConnectionName!==B.name);else{const V=E.getInputByName(Y.inputName);if(!V||V.isConnected)continue;B.connectTo(V,!0),this._restoreConnections(E,I,A)}}}serialize(V){const I=V?{}:R.b.Serialize(this);I.editorData=JSON.parse(JSON.stringify(this.editorData));let A=[];V?A=V:I.customType="BABYLON.NodeParticleSystemSet",I.MP=[];for(const B of A)I.MP.push(B.serialize());if(!V)for(const B of this.attachedBlocks)-1===A.indexOf(B)&&I.MP.push(B.serialize());return I}dispose(){for(const V of this.attachedBlocks)V.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(V){const I=new FA(V);return I.setToDefault(),I}static Parse(V){const I=R.b.Parse((()=>new FA(V.name)),V,null);return I.parseSerializedObject(V),I}static ParseFromSnippetAsync(V,I){return"_BLANK"===V?Promise.resolve(FA.CreateDefault("blank")):new Promise(((A,B)=>{const F=new eI.b;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const Y=JSON.parse(JSON.parse(F.responseText).jsonPayload),H=JSON.parse(Y.nodeParticle);I||(I=R.b.Parse((()=>new FA(V)),H,null)),I.parseSerializedObject(H),I.snippetId=V;try{A(I)}catch(E){B(E)}}else B("Unable to load the snippet "+V)})),F.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),F.send()}))}}FA.EditorURL=`${LI.Tools._DefaultCdnUrl}/v${OV.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,FA.SnippetUrl="https://snippet.babylonjs.com",(0,x.b)([(0,f.A)()],FA.prototype,"name",void 0),(0,x.b)([(0,f.A)("comment")],FA.prototype,"comment",void 0),function(V){V[V.None=0]="None",V[V.PerParticle=1]="PerParticle",V[V.PerSystem=2]="PerSystem"}(jI||(jI={}));class EA extends DI{constructor(V){super(V),this._currentLockId=-2,this.lockMode=jI.PerParticle,this.registerInput("min",lI.AutoDetect,!0,0),this.registerInput("max",lI.AutoDetect,!0,1),this.registerOutput("output",lI.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lI.Float|lI.Int|lI.Vector2|lI.tI|lI.GH),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(lI.Float|lI.Int|lI.Vector2|lI.tI|lI.GH),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=lI.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let V=null;switch(this._currentLockId=-2,this.min.type){case lI.AutoDetect:case lI.Int:case lI.Float:V=V=>{const I=this.min.getConnectedValue(V)||0,A=this.max.getConnectedValue(V)||1;return I+Math.random()*(A-I)};break;case lI.Vector2:V=V=>{const I=this.min.getConnectedValue(V)||B.Vector2.Zero(),A=this.max.getConnectedValue(V)||B.Vector2.One();return new B.Vector2(I.x+Math.random()*(A.x-I.x),I.y+Math.random()*(A.y-I.y))};break;case lI.tI:V=V=>{const I=this.min.getConnectedValue(V)||B.tI.Zero(),A=this.max.getConnectedValue(V)||B.tI.One();return new B.tI(I.x+Math.random()*(A.x-I.x),I.y+Math.random()*(A.y-I.y),I.z+Math.random()*(A.z-I.z))};break;case lI.GH:V=V=>{const I=this.min.getConnectedValue(V)||new Y.GH(0,0,0,0),A=this.max.getConnectedValue(V)||new Y.GH(1,1,1,1);return new Y.GH(I.x+Math.random()*(A.x-I.x),I.y+Math.random()*(A.y-I.y),I.z+Math.random()*(A.z-I.z),I.w+Math.random()*(A.w-I.w))}}this.output._storedFunction=I=>{var A;let B=0;switch(this.lockMode){case jI.PerParticle:B=(null===(A=I.particleContext)||void 0===A?void 0:A.id)||-1;break;case jI.PerSystem:B=I.buildId||0}return this._currentLockId!==B&&(this.lockMode!==jI.None&&(this._currentLockId=B),this.output._storedValue=V(I)),this.output._storedValue}}serialize(){const V=super.serialize();return V.lockMode=this.lockMode,V}_deserialize(V){super._deserialize(V),this.lockMode=V.lockMode}}(0,x.b)([OI("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:jI.None},{label:"Per particle",value:jI.PerParticle},{label:"Per system",value:jI.PerSystem}]})],EA.prototype,"lockMode",void 0),(0,H.e)("BABYLON.ParticleRandomBlock",EA);class YA extends DI{constructor(V){super(V),this._currentLockId=-2,this.lockMode=jI.PerParticle,this.registerInput("min",lI.AutoDetect),this.registerInput("max",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const I=[lI.Matrix,lI.Particle,lI.Texture,lI.System,lI.FloatGradient,lI.Color4Gradient,lI.Vector2Gradient,lI.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...I),this.max.excludedConnectionPointTypes.push(...I)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let V=null;switch(this._currentLockId=-2,this.min.type){case lI.Float:case lI.Int:V=V=>{const I=this.min.getConnectedValue(V),A=this.max.getConnectedValue(V);return Math.random()*(A-I)+I};break;case lI.Vector2:V=V=>{const I=this.min.getConnectedValue(V),A=this.max.getConnectedValue(V);return new B.Vector2(Math.random()*(A.x-I.x)+I.x,Math.random()*(A.y-I.y)+I.y)};break;case lI.tI:V=V=>{const I=this.min.getConnectedValue(V),A=this.max.getConnectedValue(V);return new B.tI(Math.random()*(A.x-I.x)+I.x,Math.random()*(A.y-I.y)+I.y,Math.random()*(A.z-I.z)+I.z)};break;case lI.GH:V=V=>{const I=this.min.getConnectedValue(V),A=this.max.getConnectedValue(V);return new Y.GH(Math.random()*(A.r-I.r)+I.r,Math.random()*(A.g-I.g)+I.g,Math.random()*(A.b-I.b)+I.b,Math.random()*(A.a-I.a)+I.a)}}this.output._storedFunction=I=>{var A;let B=0;switch(this.lockMode){case jI.PerParticle:B=(null===(A=I.particleContext)||void 0===A?void 0:A.id)||-1;break;case jI.PerSystem:B=I.buildId||0}return this._currentLockId!==B&&(this.lockMode!==jI.None&&(this._currentLockId=B),this.output._storedValue=V(I)),this.output._storedValue}}serialize(){const V=super.serialize();return V.lockMode=this.lockMode,V}_deserialize(V){super._deserialize(V),void 0!==V.lockMode&&(this.lockMode=V.lockMode)}}(0,x.b)([OI("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:jI.None},{label:"Per particle",value:jI.PerParticle},{label:"Per system",value:jI.PerSystem}]})],YA.prototype,"lockMode",void 0),(0,H.e)("BABYLON.RandomRangeBlock",YA);(0,H.e)("BABYLON.ParticleLerpBlock",class extends DI{constructor(V){super(V),this.registerInput("left",lI.AutoDetect),this.registerInput("right",lI.AutoDetect),this.registerInput("gradient",lI.Float,!0,0,0,1),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lI.Float|lI.Int|lI.Vector2|lI.tI|lI.GH)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const V=(V,I,A)=>(1-V)*I+V*A;this.output._storedFunction=I=>{const A=this.left.getConnectedValue(I),F=this.right.getConnectedValue(I),E=this.gradient.getConnectedValue(I);switch(this.left.type){case lI.Int:case lI.Float:return V(E,A,F);case lI.Vector2:return new B.Vector2(V(E,A.x,F.x),V(E,A.y,F.y));case lI.tI:return new B.tI(V(E,A.x,F.x),V(E,A.y,F.y),V(E,A.z,F.z));case lI.GH:return new Y.GH(V(E,A.r,F.r),V(E,A.g,F.g),V(E,A.b,F.b),V(E,A.a,F.a))}return 0}}});(0,H.e)("BABYLON.UpdateDirectionBlock",class extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerInput("direction",lI.tI),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.direction.isConnected)return;const A={process:A=>{V.particleContext=A,V.systemContext=I,A.direction.B(this.direction.getConnectedValue(V))},previousItem:null,nextItem:null};I._updateQueueStart?KV(A,I._updateQueueStart):I._updateQueueStart=A}});(0,H.e)("BABYLON.UpdateColorBlock",class extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerInput("color",lI.GH),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.color.isConnected)return;const A={process:A=>{V.particleContext=A,V.systemContext=I,A.color.B(this.color.getConnectedValue(V))},previousItem:null,nextItem:null};I._updateQueueStart?KV(A,I._updateQueueStart):I._updateQueueStart=A}});(0,H.e)("BABYLON.UpdateScaleBlock",class extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerInput("scale",lI.Vector2),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.scale.isConnected)return;const A={process:A=>{V.particleContext=A,V.systemContext=I,A.scale.B(this.scale.getConnectedValue(V))},previousItem:null,nextItem:null};I._updateQueueStart?KV(A,I._updateQueueStart):I._updateQueueStart=A}});(0,H.e)("BABYLON.UpdateAngleBlock",class extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerInput("angle",lI.Float),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.angle.isConnected)return;const A={process:A=>{V.particleContext=A,V.systemContext=I,A.angle=this.angle.getConnectedValue(V)},previousItem:null,nextItem:null};I._updateQueueStart?KV(A,I._updateQueueStart):I._updateQueueStart=A}});(0,H.e)("BABYLON.BasicPositionUpdateBlock",class extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(V){const I=this.particle.getConnectedValue(V),A={process:A=>{V.particleContext=A,V.systemContext=I,A.direction.scaleToRef(I._directionScale,I._scaledDirection),A.position.addInPlace(I._scaledDirection)},previousItem:null,nextItem:null};I._updateQueueStart?KV(A,I._updateQueueStart):I._updateQueueStart=A,this.output._storedValue=I}});(0,H.e)("BABYLON.BasicSpriteUpdateBlock",class extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(V){const I=this.particle.getConnectedValue(V),A={process:A=>{V.particleContext=A,V.systemContext=I,A.updateCellIndex()},previousItem:null,nextItem:null};I._updateQueueStart?KV(A,I._updateQueueStart):I._updateQueueStart=A,this.output._storedValue=I}});(0,H.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerInput("cellIndex",lI.Int),this.registerOutput("output",lI.Particle),this.cellIndex.acceptedConnectionPointTypes=[lI.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(V){const I=this.particle.getConnectedValue(V);if(this.output._storedValue=I,!this.cellIndex.isConnected)return;const A={process:A=>{V.particleContext=A,V.systemContext=I,A.cellIndex=Math.floor(this.cellIndex.getConnectedValue(V))},previousItem:null,nextItem:null};I._updateQueueStart?KV(A,I._updateQueueStart):I._updateQueueStart=A}});class HA extends DI{constructor(V){super(V),this.strength=1,this.registerInput("particle",lI.Particle),this.registerInput("flowMap",lI.Texture),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(V){var I;const A=this.particle.getConnectedValue(V),B=V.WI;let F;(null===(I=this.flowMap.connectedPoint)||void 0===I?void 0:I.ownerBlock).extractTextureContentAsync().then((V=>{V&&(F=new NI(V.width,V.height,V.data))}));const E={process:V=>{const I=B.getTransformMatrix();F&&F._processParticle(V,this.strength*A._tempScaledUpdateSpeed,I)},previousItem:null,nextItem:null};A._updateQueueStart?KV(E,A._updateQueueStart):A._updateQueueStart=E,this.output._storedValue=A}serialize(){const V=super.serialize();return V.strength=this.strength,V}_deserialize(V){super._deserialize(V),this.strength=V.strength}}(0,x.b)([OI("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HA.prototype,"strength",void 0),(0,H.e)("BABYLON.UpdateFlowMapBlock",HA);(0,H.e)("BABYLON.SphereShapeBlock",class extends DI{constructor(V){super(V),this.registerInput("input",lI.Particle),this.registerInput("radius",lI.Float,!0,1),this.registerInput("radiusRange",lI.Float,!0,1,0,1),this.registerInput("directionRandomizer",lI.Float,!0,0,0,1),this.registerOutput("output",lI.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(V){const I=this.input.getConnectedValue(V);I._directionCreation.process=A=>{V.particleContext=A,V.systemContext=I;const F=this.directionRandomizer.getConnectedValue(V),E=A.position.uI(V.emitterPosition).normalize(),Y=(0,b.RandomRange)(0,F),H=(0,b.RandomRange)(0,F),c=(0,b.RandomRange)(0,F);E.x+=Y,E.y+=H,E.z+=c,E.normalize(),V.isEmitterTransformNode?B.tI.TransformNormalFromFloatsToRef(Y,H,c,V.emitterWorldMatrix,A.direction):A.direction.XH(Y,H,c)},I._positionCreation.process=A=>{V.particleContext=A,V.systemContext=I;const F=this.radius.getConnectedValue(V),E=this.radiusRange.getConnectedValue(V),Y=F-(0,b.RandomRange)(0,F*E),H=(0,b.RandomRange)(0,1),c=(0,b.RandomRange)(0,2*Math.PI),X=Math.acos(2*H-1),P=Y*Math.cos(c)*Math.sin(X),J=Y*Math.cos(X),G=Y*Math.sin(c)*Math.sin(X);V.isEmitterTransformNode?B.tI.TransformCoordinatesFromFloatsToRef(P,J,G,V.emitterWorldMatrix,A.position):(A.position.XH(P,J,G),A.position.addInPlace(V.emitterPosition))},this.output._storedValue=I}});(0,H.e)("BABYLON.PointShapeBlock",class extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerInput("direction1",lI.tI,!0,new B.tI(0,1,0)),this.registerInput("direction2",lI.tI,!0,new B.tI(0,1,0)),this.registerOutput("output",lI.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(V){const I=this.particle.getConnectedValue(V);I._directionCreation.process=A=>{V.particleContext=A,V.systemContext=I;const F=this.direction1.getConnectedValue(V),E=this.direction2.getConnectedValue(V),Y=(0,b.RandomRange)(F.x,E.x),H=(0,b.RandomRange)(F.y,E.y),c=(0,b.RandomRange)(F.z,E.z);V.isEmitterTransformNode?B.tI.TransformNormalFromFloatsToRef(Y,H,c,V.emitterWorldMatrix,A.direction):A.direction.XH(Y,H,c)},I._positionCreation.process=A=>{V.systemContext=I,V.isEmitterTransformNode?B.tI.TransformCoordinatesFromFloatsToRef(0,0,0,V.emitterWorldMatrix,A.position):A.position.B(V.emitterPosition)},this.output._storedValue=I}});(0,H.e)("BABYLON.CustomShapeBlock",class extends DI{constructor(V){super(V),this.registerInput("particle",lI.Particle),this.registerInput("position",lI.tI,!0,new B.tI(0,0,0)),this.registerInput("direction",lI.tI,!0,new B.tI(0,1,0)),this.registerOutput("output",lI.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(V){const I=this.particle.getConnectedValue(V);I._directionCreation.process=A=>{V.particleContext=A,V.systemContext=I;const F=this.direction.getConnectedValue(V);V.isEmitterTransformNode?B.tI.TransformNormalToRef(F,V.emitterWorldMatrix,A.direction):A.direction.B(F)},I._positionCreation.process=A=>{V.particleContext=A,V.systemContext=I;const F=this.position.getConnectedValue(V);V.isEmitterTransformNode?B.tI.TransformCoordinatesToRef(F,V.emitterWorldMatrix,A.position):(A.position.B(F),A.position.addInPlace(V.emitterPosition))},this.output._storedValue=I}});(0,H.e)("BABYLON.CylinderShapeBlock",class extends DI{constructor(V){super(V),this._tempVector=B.tI.Zero(),this.registerInput("particle",lI.Particle),this.registerInput("radius",lI.Float,!0,1),this.registerInput("height",lI.Float,!0,1,0),this.registerInput("radiusRange",lI.Float,!0,1,0,1),this.registerInput("directionRandomizer",lI.Float,!0,0,0,1),this.registerOutput("output",lI.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(V){const I=this.particle.getConnectedValue(V);I._directionCreation.process=A=>{V.particleContext=A,V.systemContext=I;const F=this.directionRandomizer.getConnectedValue(V);A.position.subtractToRef(V.emitterPosition,this._tempVector),this._tempVector.normalize(),V.isEmitterTransformNode&&B.tI.TransformNormalToRef(this._tempVector,V.emitterInverseWorldMatrix,this._tempVector);const E=(0,b.RandomRange)(-F/2,F/2);let Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=(0,b.RandomRange)(-Math.PI/2,Math.PI/2)*F,this._tempVector.y=E,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),V.isEmitterTransformNode?B.tI.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,V.emitterWorldMatrix,A.direction):A.direction.B(this._tempVector)},I._positionCreation.process=A=>{V.particleContext=A,V.systemContext=I;const F=this.height.getConnectedValue(V),E=this.radiusRange.getConnectedValue(V),Y=this.radius.getConnectedValue(V),H=(0,b.RandomRange)(-F/2,F/2),c=(0,b.RandomRange)(0,2*Math.PI),X=(0,b.RandomRange)((1-E)*(1-E),1),P=Math.sqrt(X)*Y,J=P*Math.cos(c),G=P*Math.sin(c);V.isEmitterTransformNode?B.tI.TransformCoordinatesFromFloatsToRef(J,H,G,V.emitterWorldMatrix,A.position):(A.position.XH(J,H,G),A.position.addInPlace(V.emitterPosition))},this.output._storedValue=I}});class cA extends DI{constructor(V){super(V),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",lI.Particle),this.registerOutput("output",lI.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){super._build(V);const I=this.particle.getConnectedValue(V);I._isAnimationSheetEnabled=!0,I.spriteCellWidth=this.width,I.spriteCellHeight=this.height,I.startSpriteCellID=this.start,I.endSpriteCellID=this.end,I.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=I}serialize(){const V=super.serialize();return V.width=this.width,V.height=this.height,V.start=this.start,V.end=this.end,V.randomStartCell=this.randomStartCell,V}_deserialize(V){super._deserialize(V),this.width=V.width,this.height=V.height,this.start=V.start,this.end=V.end,this.randomStartCell=V.randomStartCell}}(0,x.b)([OI("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cA.prototype,"start",void 0),(0,x.b)([OI("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cA.prototype,"end",void 0),(0,x.b)([OI("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cA.prototype,"width",void 0),(0,x.b)([OI("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cA.prototype,"height",void 0),(0,x.b)([OI("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],cA.prototype,"loop",void 0),(0,x.b)([OI("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],cA.prototype,"randomStartCell",void 0),(0,H.e)("BABYLON.SetupSpriteSheetBlock",cA);class bA extends DI{constructor(V){super(V),this.reference=0,this.registerInput("value",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=V=>{switch(V){case lI.Float:return lI.FloatGradient;case lI.Vector2:return lI.Vector2Gradient;case lI.tI:return lI.Vector3Gradient;case lI.GH:return lI.Color4Gradient}return V},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lI.Float|lI.Vector2|lI.tI|lI.GH)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=V=>null}serialize(){const V=super.serialize();return V.reference=this.reference,V}_deserialize(V){super._deserialize(V),this.reference=V.reference}}(0,x.b)([OI("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],bA.prototype,"reference",void 0),(0,H.e)("BABYLON.ParticleGradientValueBlock",bA);(0,H.e)("BABYLON.ParticleGradientBlock",class extends DI{constructor(V){super(V),this._entryCount=1,this.registerInput("gradient",lI.Float,!0,1,0,1),this.registerInput("value0",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=V=>{switch(V){case lI.FloatGradient:return lI.Float;case lI.Vector2Gradient:return lI.Vector2;case lI.Vector3Gradient:return lI.tI;case lI.Color4Gradient:return lI.GH}return V},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(lI.FloatGradient|lI.Vector2Gradient|lI.Vector3Gradient|lI.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(V){this._inputs[V].onConnectionObservable.add((()=>{this._entryCount>V||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),lI.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const V=[];for(let A=1;A<this._inputs.length;A++){var I;if(this._inputs[A].isConnected)V.push(null===(I=this._inputs[A].connectedPoint)||void 0===I?void 0:I.ownerBlock)}V.sort(((V,I)=>V.reference-I.reference)),this.output._storedFunction=I=>{const A=this.gradient.getConnectedValue(I);if(1===V.length)return V[0].value.getConnectedValue(I);let F=null;for(let E=V.length-1;E>=0;E--){const H=V[E];if(H.reference<=A){const V=H.value.getConnectedValue(I);if(F){const E=F.value.getConnectedValue(I),c=F.reference,X=H.reference,P=Math.max(0,Math.min(1,(A-X)/(c-X)));switch(this.output.type){case lI.Float:return(0,b.Lerp)(V,E,P);case lI.Vector2:return B.Vector2.Lerp(V,E,P);case lI.tI:return B.tI.Lerp(V,E,P);case lI.GH:return Y.GH.Lerp(V,E,P)}}return V}F=H}return 0}}});(0,H.e)("BABYLON.ParticleConverterBlock",class extends DI{constructor(V){super(V),this.registerInput("color ",lI.GH,!0),this.registerInput("xyz ",lI.tI,!0),this.registerInput("xy ",lI.Vector2,!0),this.registerInput("zw ",lI.Vector2,!0),this.registerInput("x ",lI.Float,!0),this.registerInput("y ",lI.Float,!0),this.registerInput("z ",lI.Float,!0),this.registerInput("w ",lI.Float,!0),this.registerOutput("color",lI.GH),this.registerOutput("xyz",lI.tI),this.registerOutput("xy",lI.Vector2),this.registerOutput("zw",lI.Vector2),this.registerOutput("x",lI.Float),this.registerOutput("y",lI.Float),this.registerOutput("z",lI.Float),this.registerOutput("w",lI.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(V){return"color "===V?"colorIn":"xyz "===V?"xyzIn":"xy "===V?"xyIn":"zw "===V?"zwIn":"x "===V?"xIn":"y "===V?"yIn":"z "===V?"zIn":"w "===V?"wIn":V}_outputRename(V){switch(V){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return V}}_build(V){super._build(V);const I=this.xIn,A=this.yIn,F=this.zIn,E=this.wIn,H=this.xyIn,c=this.zwIn,b=this.xyzIn,X=this.colorIn,P=this.colorOut,J=this.xyzOut,G=this.xyOut,w=this.zwOut,t=this.xOut,u=this.yOut,W=this.zOut,g=this.wOut,o=V=>{if(X.isConnected)return X.getConnectedValue(V);let B=0,P=0,J=0,G=0;if(I.isConnected&&(B=I.getConnectedValue(V)),A.isConnected&&(P=A.getConnectedValue(V)),F.isConnected&&(J=F.getConnectedValue(V)),E.isConnected&&(G=E.getConnectedValue(V)),H.isConnected){const I=H.getConnectedValue(V);I&&(B=I.x,P=I.y)}if(c.isConnected){const I=c.getConnectedValue(V);I&&(J=I.x,G=I.y)}if(b.isConnected){const I=b.getConnectedValue(V);I&&(B=I.x,P=I.y,J=I.z)}return new Y.GH(B,P,J,G)};P._storedFunction=V=>o(V),J._storedFunction=V=>{const I=o(V);return new B.tI(I.r,I.g,I.b)},G._storedFunction=V=>{const I=o(V);return new B.Vector2(I.r,I.g)},w._storedFunction=V=>{const I=o(V);return new B.Vector2(I.b,I.a)},t._storedFunction=V=>o(V).r,u._storedFunction=V=>o(V).g,W._storedFunction=V=>o(V).b,g._storedFunction=V=>o(V).a}}),function(V){V[V.Cos=0]="Cos",V[V.Sin=1]="Sin",V[V.Abs=2]="Abs",V[V.Exp=3]="Exp",V[V.Exp2=4]="Exp2",V[V.Round=5]="Round",V[V.Floor=6]="Floor",V[V.Ceiling=7]="Ceiling",V[V.Sqrt=8]="Sqrt",V[V.Log=9]="Log",V[V.Tan=10]="Tan",V[V.ArcTan=11]="ArcTan",V[V.ArcCos=12]="ArcCos",V[V.ArcSin=13]="ArcSin",V[V.Sign=14]="Sign",V[V.Negate=15]="Negate",V[V.OneMinus=16]="OneMinus",V[V.Reciprocal=17]="Reciprocal",V[V.ToDegrees=18]="ToDegrees",V[V.ToRadians=19]="ToRadians",V[V.Fract=20]="Fract"}(TI||(TI={}));class XA extends DI{constructor(V){super(V),this.operation=TI.Cos,this.registerInput("input",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lI.Float|lI.Int|lI.Vector2|lI.tI|lI.GH)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){super._build(V);let I=null;switch(this.operation){case TI.Cos:I=V=>Math.cos(V);break;case TI.Sin:I=V=>Math.sin(V);break;case TI.Abs:I=V=>Math.abs(V);break;case TI.Exp:I=V=>Math.exp(V);break;case TI.Exp2:I=V=>Math.pow(2,V);break;case TI.Round:I=V=>Math.round(V);break;case TI.Floor:I=V=>Math.floor(V);break;case TI.Ceiling:I=V=>Math.ceil(V);break;case TI.Sqrt:I=V=>Math.sqrt(V);break;case TI.Log:I=V=>Math.log(V);break;case TI.Tan:I=V=>Math.tan(V);break;case TI.ArcTan:I=V=>Math.atan(V);break;case TI.ArcCos:I=V=>Math.acos(V);break;case TI.ArcSin:I=V=>Math.asin(V);break;case TI.Sign:I=V=>Math.sign(V);break;case TI.Negate:I=V=>-V;break;case TI.OneMinus:I=V=>1-V;break;case TI.Reciprocal:I=V=>1/V;break;case TI.ToRadians:I=V=>V*Math.PI/180;break;case TI.ToDegrees:I=V=>180*V/Math.PI;break;case TI.Fract:I=V=>V>=0?V-Math.floor(V):V-Math.ceil(V)}if(!I)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case lI.Int:case lI.Float:this.output._storedFunction=V=>{const A=this.input.getConnectedValue(V);return I(A)};break;case lI.Vector2:this.output._storedFunction=V=>{const A=this.input.getConnectedValue(V);return new B.Vector2(I(A.x),I(A.y))};break;case lI.tI:this.output._storedFunction=V=>{const A=this.input.getConnectedValue(V);return new B.tI(I(A.x),I(A.y),I(A.z))};break;case lI.GH:this.output._storedFunction=V=>{const A=this.input.getConnectedValue(V);return new Y.GH(I(A.r),I(A.g),I(A.b),I(A.a))}}return this}serialize(){const V=super.serialize();return V.operation=this.operation,V}_deserialize(V){super._deserialize(V),this.operation=V.operation}}(0,x.b)([OI("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:TI.Cos},{label:"Sin",value:TI.Sin},{label:"Abs",value:TI.Abs},{label:"Exp",value:TI.Exp},{label:"Exp2",value:TI.Exp2},{label:"Round",value:TI.Round},{label:"Floor",value:TI.Floor},{label:"Ceiling",value:TI.Ceiling},{label:"Sqrt",value:TI.Sqrt},{label:"Log",value:TI.Log},{label:"Tan",value:TI.Tan},{label:"ArcTan",value:TI.ArcTan},{label:"ArcCos",value:TI.ArcCos},{label:"ArcSin",value:TI.ArcSin},{label:"Sign",value:TI.Sign},{label:"Negate",value:TI.Negate},{label:"OneMinus",value:TI.OneMinus},{label:"Reciprocal",value:TI.Reciprocal},{label:"ToDegrees",value:TI.ToDegrees},{label:"ToRadians",value:TI.ToRadians},{label:"Fract",value:TI.Fract}]})],XA.prototype,"operation",void 0),(0,H.e)("BABYLON.ParticleTrigonometryBlock",XA);var PA,JA=A(12637);class GA extends DI{constructor(V){super(V),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(lI.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(lI.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(lI.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(lI.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(lI.System),this._inputs[0].excludedConnectionPointTypes.push(lI.Particle),this._inputs[0].excludedConnectionPointTypes.push(lI.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const I=V=>{const I=this.input.getConnectedValue(V);if(this.log.length>=this.stackSize)return I;if(null===I||void 0===I)return this.log.push(["null",""]),I;switch(this.input.type){case lI.Vector2:this.log.push([(0,JA.f)(I,4),I.toString()]);break;case lI.tI:this.log.push([(0,JA.h)(I,4),I.toString()]);break;case lI.GH:this.log.push([`{R: ${I.r.toFixed(4)} G: ${I.g.toFixed(4)} B: ${I.b.toFixed(4)} A: ${I.a.toFixed(4)}}`,I.toString()]);break;default:this.log.push([I.toString(),I.toString()])}return I};this.output.isConnected?this.output._storedFunction=I:this.output._storedValue=I(V)}serialize(){const V=super.serialize();return V.stackSize=this.stackSize,V}_deserialize(V){super._deserialize(V),this.stackSize=V.stackSize}}(0,x.b)([OI("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],GA.prototype,"stackSize",void 0),(0,H.e)("BABYLON.ParticleDebugBlock",GA);(0,H.e)("BABYLON.ParticleElbowBlock",class extends DI{constructor(V){super(V),this.registerInput("input",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){super._build(V);const I=this._outputs[0],A=this._inputs[0];I._storedFunction=V=>A.getConnectedValue(V)}});(0,H.e)("BABYLON.ParticleTeleportInBlock",class extends DI{get endpoints(){return this._endpoints}constructor(V){super(V),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",lI.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(V){if(this.getClassName()===V)return!0;for(const I of this.endpoints)if(I.isAnAncestorOfType(V))return!0;return!1}isAnAncestorOf(V){for(const I of this.endpoints){if(I===V)return!0;if(I.isAnAncestorOf(V))return!0}return!1}attachToEndpoint(V){V.detach(),this._endpoints.push(V),V._entryPoint=this,V._outputs[0]._typeConnectionSource=this._inputs[0],V._tempEntryPointUniqueId=null,V.name="> "+this.name}detachFromEndpoint(V){const I=this._endpoints.indexOf(V);-1!==I&&(this._endpoints.splice(I,1),V._outputs[0]._typeConnectionSource=null,V._entryPoint=null)}_build(){for(const V of this._endpoints)V.output._storedFunction=V=>this.input.getConnectedValue(V)}});(0,H.e)("BABYLON.ParticleTeleportOutBlock",class extends DI{constructor(V){super(V),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",lI.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(V){this.entryPoint&&this.entryPoint.build(V)}clone(){const V=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(V),V}serialize(){var V;const I=super.serialize();return I.entryPoint=(null===(V=this.entryPoint)||void 0===V?void 0:V.uniqueId)??"",I}_deserialize(V){super._deserialize(V),this._tempEntryPointUniqueId=V.entryPoint}}),function(V){V[V.Equal=0]="Equal",V[V.NotEqual=1]="NotEqual",V[V.LessThan=2]="LessThan",V[V.GreaterThan=3]="GreaterThan",V[V.LessOrEqual=4]="LessOrEqual",V[V.GreaterOrEqual=5]="GreaterOrEqual",V[V.Xor=6]="Xor",V[V.Or=7]="Or",V[V.And=8]="And"}(PA||(PA={}));class wA extends DI{constructor(V){super(V),this.test=PA.Equal,this.epsilon=0,this.registerInput("left",lI.Float),this.registerInput("right",lI.Float,!0,0),this.registerInput("ifTrue",lI.AutoDetect,!0,1),this.registerInput("ifFalse",lI.AutoDetect,!0,0),this.registerOutput("output",lI.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=lI.Float,this._inputs[0].acceptedConnectionPointTypes.push(lI.Int),this._inputs[1].acceptedConnectionPointTypes.push(lI.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const V=V=>{const I=this.left.getConnectedValue(V),A=this.right.getConnectedValue(V);let B=!1;switch(this.test){case PA.Equal:B=(0,b.WithinEpsilon)(I,A,this.epsilon);break;case PA.NotEqual:B=!(0,b.WithinEpsilon)(I,A,this.epsilon);break;case PA.LessThan:B=I<A+this.epsilon;break;case PA.GreaterThan:B=I>A-this.epsilon;break;case PA.LessOrEqual:B=I<=A+this.epsilon;break;case PA.GreaterOrEqual:B=I>=A-this.epsilon;break;case PA.Xor:B=!!I&&!A||!I&&!!A;break;case PA.Or:B=!!I||!!A;break;case PA.And:B=!!I&&!!A}return B};this.output._storedFunction=I=>V(I)?this.ifTrue.getConnectedValue(I):this.ifFalse.getConnectedValue(I)}serialize(){const V=super.serialize();return V.test=this.test,V.epsilon=this.epsilon,V}_deserialize(V){super._deserialize(V),this.test=V.test,void 0!==V.epsilon&&(this.epsilon=V.epsilon)}}(0,x.b)([OI("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:PA.Equal},{label:"NotEqual",value:PA.NotEqual},{label:"LessThan",value:PA.LessThan},{label:"GreaterThan",value:PA.GreaterThan},{label:"LessOrEqual",value:PA.LessOrEqual},{label:"GreaterOrEqual",value:PA.GreaterOrEqual},{label:"Xor",value:PA.Xor},{label:"Or",value:PA.Or},{label:"And",value:PA.And}]})],wA.prototype,"test",void 0),(0,x.b)([OI("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wA.prototype,"epsilon",void 0),(0,H.e)("BABYLON.ParticleConditionBlock",wA);class tA extends DI{constructor(V){super(V),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",lI.Particle),this.registerInput("condition",lI.Float,!0,0),this.registerInput("system",lI.System),this.registerOutput("output",lI.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(V){this._triggerCount=0;const I=this.input.getConnectedValue(V),A={process:A=>{if(V.particleContext=A,V.systemContext=I,0!==this.condition.getConnectedValue(V)&&(0===this.limit||this._triggerCount<this.limit)){const B=(new Date).getTime();if(this._previousOne&&B-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=B;const F=this.system.getConnectedValue(V);if(F){const B=aI(F,V.WI,A.position);B.aY.addOnce((()=>{this._triggerCount--})),I.aY.addOnce((()=>{B.dispose()}))}}},previousItem:null,nextItem:null};I._updateQueueStart?KV(A,I._updateQueueStart):I._updateQueueStart=A,this.output._storedValue=I}serialize(){const V=super.serialize();return V.limit=this.limit,V.delay=this.delay,V}_deserialize(V){super._deserialize(V),void 0!==V.limit&&(this.limit=V.limit),void 0!==V.delay&&(this.delay=V.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,x.b)([OI("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tA.prototype,"limit",void 0),(0,x.b)([OI("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tA.prototype,"delay",void 0),(0,H.e)("BABYLON.ParticleTriggerBlock",tA);A(12645),A(12653),A(12667),A(12723)},12710:(V,I,A)=>{"use strict";var B=A(11152);const F="clipPlaneFragment",E="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12676:(V,I,A)=>{"use strict";var B=A(11152);const F="clipPlaneFragmentDeclaration",E="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12741:(V,I,A)=>{"use strict";var B=A(11152);const F="clipPlaneVertex",E="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12730:(V,I,A)=>{"use strict";var B=A(11152);const F="clipPlaneVertexDeclaration",E="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12721:(V,I,A)=>{"use strict";var B=A(11152);const F="fogFragment",E="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12705:(V,I,A)=>{"use strict";var B=A(11152);const F="fogFragmentDeclaration",E="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12743:(V,I,A)=>{"use strict";var B=A(11152);const F="fogVertex",E="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12734:(V,I,A)=>{"use strict";var B=A(11152);const F="fogVertexDeclaration",E="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12699:(V,I,A)=>{"use strict";var B=A(11152);const F="helperFunctions",E="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12684:(V,I,A)=>{"use strict";var B=A(11152);const F="imageProcessingDeclaration",E="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12702:(V,I,A)=>{"use strict";var B=A(11152);const F="imageProcessingFunctions",E="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12693:(V,I,A)=>{"use strict";var B=A(11152);const F="logDepthDeclaration",E="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12712:(V,I,A)=>{"use strict";var B=A(11152);const F="logDepthFragment",E="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12752:(V,I,A)=>{"use strict";var B=A(11152);const F="logDepthVertex",E="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";B.e.IncludesShadersStoreWGSL[F]||(B.e.IncludesShadersStoreWGSL[F]=E)},12667:(V,I,A)=>{"use strict";A.r(I),A.d(I,{particlesPixelShaderWGSL:()=>Y});var B=A(11152);A(12676),A(12684),A(12693),A(12699),A(12702),A(12705),A(12710),A(12712),A(12721);const F="particlesPixelShader",E="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";B.e.ShadersStoreWGSL[F]||(B.e.ShadersStoreWGSL[F]=E);const Y={name:F,shader:E}},12723:(V,I,A)=>{"use strict";A.r(I),A.d(I,{particlesVertexShaderWGSL:()=>Y});var B=A(11152);A(12730),A(12734),A(12693),A(12741),A(12743),A(12752);const F="particlesVertexShader",E="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";B.e.ShadersStoreWGSL[F]||(B.e.ShadersStoreWGSL[F]=E);const Y={name:F,shader:E}},12586:(V,I,A)=>{"use strict";var B=A(11152);const F="clipPlaneFragment",E="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12648:(V,I,A)=>{"use strict";var B=A(11152);const F="clipPlaneFragmentDeclaration",E="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12606:(V,I,A)=>{"use strict";var B=A(11152);const F="clipPlaneVertex",E="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12658:(V,I,A)=>{"use strict";var B=A(11152);const F="clipPlaneVertexDeclaration",E="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12591:(V,I,A)=>{"use strict";var B=A(11152);const F="fogFragment",E="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12580:(V,I,A)=>{"use strict";var B=A(11152);const F="fogFragmentDeclaration",E="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12612:(V,I,A)=>{"use strict";var B=A(11152);const F="fogVertex",E="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12598:(V,I,A)=>{"use strict";var B=A(11152);const F="fogVertexDeclaration",E="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12571:(V,I,A)=>{"use strict";var B=A(11152);const F="helperFunctions",E="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12559:(V,I,A)=>{"use strict";var B=A(11152);const F="imageProcessingDeclaration",E="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12575:(V,I,A)=>{"use strict";var B=A(11152);const F="imageProcessingFunctions",E="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12566:(V,I,A)=>{"use strict";var B=A(11152);const F="logDepthDeclaration",E="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12588:(V,I,A)=>{"use strict";var B=A(11152);const F="logDepthFragment",E="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12615:(V,I,A)=>{"use strict";var B=A(11152);const F="logDepthVertex",E="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";B.e.IncludesShadersStore[F]||(B.e.IncludesShadersStore[F]=E)},12645:(V,I,A)=>{"use strict";A.r(I),A.d(I,{particlesPixelShader:()=>Y});var B=A(11152);A(12648),A(12559),A(12566),A(12571),A(12575),A(12580),A(12586),A(12588),A(12591);const F="particlesPixelShader",E="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";B.e.ShadersStore[F]||(B.e.ShadersStore[F]=E);const Y={name:F,shader:E}},12653:(V,I,A)=>{"use strict";A.r(I),A.d(I,{particlesVertexShader:()=>Y});var B=A(11152);A(12658),A(12598),A(12566),A(12606),A(12612),A(12615);const F="particlesVertexShader",E="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";B.e.ShadersStore[F]||(B.e.ShadersStore[F]=E);const Y={name:F,shader:E}},13019:(V,I,A)=>{"use strict";A.r(I),A.d(I,{FlowGraphGLTFDataProvider:()=>E});var B=A(12979),F=A(12954);class E extends B.d{constructor(V){var I,A;super();const B=V.glTF,E=(null===(I=B.animations)||void 0===I?void 0:I.map((V=>V._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",F.e,E);const Y=(null===(A=B.nodes)||void 0===A?void 0:A.map((V=>V._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",F.e,Y)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12903:(V,I,A)=>{"use strict";A.d(I,{b:()=>u,e:()=>w,i:()=>G,k:()=>t});var B=A(11231),F=A(11738),E=A(11276),Y=A(12910);const H=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class c{constructor(V,I){this._gltf=V,this._infoTree=I}convert(V){let I,A=this._gltf,B=this._infoTree;if(!V.startsWith("/"))throw new Error("Path must start with a /");const F=V.split("/");if(F.shift(),F[F.length-1].includes(".length")){const V=F[F.length-1].split(".");F.pop(),F.push(...V)}let E=!1;for(const c of F){const F="length"===c;if(F&&!B.__array__)throw new Error(`Path ${V} is invalid`);if(B.__ignoreObjectTree__&&(E=!0),B.__array__&&!F)B=B.__array__;else if(B=B[c],!B)throw new Error(`Path ${V} is invalid`);if(!E)if(void 0===A){if(!H.find((I=>I.regex.test(V))))throw new Error(`Path ${V} is invalid`)}else if(!F){var Y;A=null===(Y=A)||void 0===Y?void 0:Y[c]}(B.__target__||F)&&(I=A)}return{object:I,info:B}}}function b(V,I,A,B){const F=X(V,I);return B?F[A][B]:F[A]}function X(V,I,A){var B,E;return null===(B=V._data)||void 0===B||null===(E=B[(null===A||void 0===A?void 0:A.fillMode)??F.d.MATERIAL_TriangleFillMode])||void 0===E?void 0:E.babylonMaterial}function P(V,I){return{offset:{componentsCount:2,type:"Vector2",get:(A,F,E)=>{const Y=b(A,E,V,I);return new B.Vector2(null===Y||void 0===Y?void 0:Y.uOffset,null===Y||void 0===Y?void 0:Y.vOffset)},getTarget:X,set:(A,B,F,E)=>{const Y=b(B,E,V,I);Y.uOffset=A.x,Y.vOffset=A.y},getPropertyName:[()=>`${V}${I?"."+I:""}.uOffset`,()=>`${V}${I?"."+I:""}.vOffset`]},rotation:{type:"number",get:(A,B,F)=>{var E;return null===(E=b(A,F,V,I))||void 0===E?void 0:E.wAng},getTarget:X,set:(A,B,F,E)=>b(B,E,V,I).wAng=A,getPropertyName:[()=>`${V}${I?"."+I:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(A,F,E)=>{const Y=b(A,E,V,I);return new B.Vector2(null===Y||void 0===Y?void 0:Y.uScale,null===Y||void 0===Y?void 0:Y.vScale)},getTarget:X,set:(A,B,F,E)=>{const Y=b(B,E,V,I);Y.uScale=A.x,Y.vScale=A.y},getPropertyName:[()=>`${V}${I?"."+I:""}.uScale`,()=>`${V}${I?"."+I:""}.vScale`]}}}const J={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:V=>{var I,A;return new B.Vector2((null===(I=V._babylonCamera)||void 0===I?void 0:I.orthoLeft)??0,(null===(A=V._babylonCamera)||void 0===A?void 0:A.orthoRight)??0)},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.orthoLeft=V.x,I._babylonCamera.orthoRight=V.y)},getTarget:V=>V,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:V=>{var I,A;return new B.Vector2((null===(I=V._babylonCamera)||void 0===I?void 0:I.orthoBottom)??0,(null===(A=V._babylonCamera)||void 0===A?void 0:A.orthoTop)??0)},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.orthoBottom=V.x,I._babylonCamera.orthoTop=V.y)},getTarget:V=>V,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.maxZ},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.maxZ=V)},getTarget:V=>V,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.FH},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.FH=V)},getTarget:V=>V,getPropertyName:[()=>"FH"]}},perspective:{aspectRatio:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.getEngine().getAspectRatio(V._babylonCamera)},getTarget:V=>V,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.fov},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.fov=V)},getTarget:V=>V,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.maxZ},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.maxZ=V)},getTarget:V=>V,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:V=>{var I;return null===(I=V._babylonCamera)||void 0===I?void 0:I.FH},set:(V,I)=>{I._babylonCamera&&(I._babylonCamera.FH=V)},getTarget:V=>V,getPropertyName:[()=>"FH"]}}}},nodes:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"tI",get:V=>{var I;return null===(I=V._babylonTransformNode)||void 0===I?void 0:I.position},set:(V,I)=>{var A;return null===(A=I._babylonTransformNode)||void 0===A?void 0:A.position.B(V)},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:V=>{var I;return null===(I=V._babylonTransformNode)||void 0===I?void 0:I.rotationQuaternion},set:(V,I)=>{var A,B;return null===(A=I._babylonTransformNode)||void 0===A||null===(B=A.rotationQuaternion)||void 0===B?void 0:B.B(V)},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"tI",get:V=>{var I;return null===(I=V._babylonTransformNode)||void 0===I?void 0:I.PH},set:(V,I)=>{var A;return null===(A=I._babylonTransformNode)||void 0===A?void 0:A.PH.B(V)},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"PH"]},weights:{length:{type:"number",get:V=>V._numMorphTargets,getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(V,I)=>{var A,B;return void 0!==I?null===(A=V._primitiveBabylonMeshes)||void 0===A||null===(B=A[0].morphTargetManager)||void 0===B?void 0:B.getTarget(I).influence:void 0},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(V,I)=>[0],getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:V=>{var I,A,F;return B.Matrix.Compose(null===(I=V._babylonTransformNode)||void 0===I?void 0:I.PH,null===(A=V._babylonTransformNode)||void 0===A?void 0:A.rotationQuaternion,null===(F=V._babylonTransformNode)||void 0===F?void 0:F.position)},getTarget:V=>V._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:V=>{var I,A,F,E;const Y=B.Matrix.Identity();let H=V.parent;for(;H&&H.parent;)H=H.parent;const c=(null===(I=V._babylonTransformNode)||void 0===I?void 0:I.position._isDirty)||(null===(A=V._babylonTransformNode)||void 0===A||null===(F=A.rotationQuaternion)||void 0===F?void 0:F._isDirty)||(null===(E=V._babylonTransformNode)||void 0===E?void 0:E.PH._isDirty);if(H){var b;const I=null===(b=H._babylonTransformNode)||void 0===b?void 0:b.YH(!0).invert();var X,P;if(I)null===(X=V._babylonTransformNode)||void 0===X||null===(P=X.YH(c))||void 0===P||P.multiplyToRef(I,Y)}else V._babylonTransformNode&&Y.B(V._babylonTransformNode.YH(c));return Y},getTarget:V=>V._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:V=>{var I,A;return null===(I=V._babylonTransformNode)||void 0===I||null===(A=I.getChildren((V=>V instanceof Y.d),!0)[0])||void 0===A?void 0:A.uH},getTarget:V=>{var I;return null===(I=V._babylonTransformNode)||void 0===I?void 0:I.getChildren((V=>V instanceof Y.d),!0)[0]},set:(V,I)=>{if(I._babylonTransformNode){const A=I._babylonTransformNode.getChildren((V=>V instanceof Y.d),!0)[0];A&&(A.uH=V)}}},color:{type:"oI",get:V=>{var I,A;return null===(I=V._babylonTransformNode)||void 0===I||null===(A=I.getChildren((V=>V instanceof Y.d),!0)[0])||void 0===A?void 0:A.WH},getTarget:V=>{var I;return null===(I=V._babylonTransformNode)||void 0===I?void 0:I.getChildren((V=>V instanceof Y.d),!0)[0]},set:(V,I)=>{if(I._babylonTransformNode){const A=I._babylonTransformNode.getChildren((V=>V instanceof Y.d),!0)[0];A&&(A.WH=V)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"oI",get:(V,I,A)=>X(V,I,A).emissiveColor,set:(V,I,A,B)=>X(I,A,B).emissiveColor.B(V),getTarget:(V,I,A)=>X(V,I,A),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:P("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(V,I,A)=>{var B;return null===(B=b(V,A,"bumpTexture"))||void 0===B?void 0:B.level},set:(V,I,A,B)=>{const F=b(I,B,"bumpTexture");F&&(F.level=V)},getTarget:(V,I,A)=>X(V,I,A),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:P("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(V,I,A)=>X(V,I,A).ambientTextureStrength,set:(V,I,A,B)=>{const F=X(I,A,B);F&&(F.ambientTextureStrength=V)},getTarget:(V,I,A)=>X(V,I,A),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:P("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"GH",get:(V,I,A)=>{const B=X(V,I,A);return E.GH.FromColor3(B.albedoColor,B.alpha)},set:(V,I,A,B)=>{const F=X(I,A,B);F.albedoColor.set(V.r,V.g,V.b),F.alpha=V.a},getTarget:(V,I,A)=>X(V,I,A),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:P("albedoTexture")}},metallicFactor:{type:"number",get:(V,I,A)=>X(V,I,A).metallic,set:(V,I,A,B)=>{const F=X(I,A,B);F&&(F.metallic=V)},getTarget:(V,I,A)=>X(V,I,A),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(V,I,A)=>X(V,I,A).roughness,set:(V,I,A,B)=>{const F=X(I,A,B);F&&(F.roughness=V)},getTarget:(V,I,A)=>X(V,I,A),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:P("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(V,I,A)=>X(V,I,A).anisotropy.uH,set:(V,I,A,B)=>{X(I,A,B).anisotropy.uH=V},getTarget:(V,I,A)=>X(V,I,A),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(V,I,A)=>X(V,I,A).anisotropy.angle,set:(V,I,A,B)=>{X(I,A,B).anisotropy.angle=V},getTarget:(V,I,A)=>X(V,I,A),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:P("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(V,I,A)=>X(V,I,A).clearCoat.uH,set:(V,I,A,B)=>{X(I,A,B).clearCoat.uH=V},getTarget:(V,I,A)=>X(V,I,A),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(V,I,A)=>X(V,I,A).clearCoat.roughness,set:(V,I,A,B)=>{X(I,A,B).clearCoat.roughness=V},getTarget:(V,I,A)=>X(V,I,A),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:P("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(V,I,A)=>{var B;return null===(B=X(V,I,A).clearCoat.bumpTexture)||void 0===B?void 0:B.level},getTarget:X,set:(V,I,A,B)=>X(I,A,B).clearCoat.bumpTexture.level=V},extensions:{KHR_texture_transform:P("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:P("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(V,I,A)=>X(V,I,A).subSurface.dispersion,getTarget:X,set:(V,I,A,B)=>X(I,A,B).subSurface.dispersion=V}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(V,I,A)=>X(V,I,A).emissiveIntensity,getTarget:X,set:(V,I,A,B)=>X(I,A,B).emissiveIntensity=V}},KHR_materials_ior:{ior:{type:"number",get:(V,I,A)=>X(V,I,A).indexOfRefraction,getTarget:X,set:(V,I,A,B)=>X(I,A,B).indexOfRefraction=V}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(V,I,A)=>X(V,I,A).iridescence.uH,getTarget:X,set:(V,I,A,B)=>X(I,A,B).iridescence.uH=V},iridescenceIor:{type:"number",get:(V,I,A)=>X(V,I,A).iridescence.indexOfRefraction,getTarget:X,set:(V,I,A,B)=>X(I,A,B).iridescence.indexOfRefraction=V},iridescenceTexture:{extensions:{KHR_texture_transform:P("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(V,I,A)=>X(V,I,A).iridescence.maximumThickness,getTarget:X,set:(V,I,A,B)=>X(I,A,B).iridescence.maximumThickness=V},iridescenceThicknessMinimum:{type:"number",get:(V,I,A)=>X(V,I,A).iridescence.minimumThickness,getTarget:X,set:(V,I,A,B)=>X(I,A,B).iridescence.minimumThickness=V},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:P("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"oI",get:(V,I,A)=>X(V,I,A).sheen.color,getTarget:X,set:(V,I,A,B)=>X(I,A,B).sheen.color.B(V)},sheenColorTexture:{extensions:{KHR_texture_transform:P("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(V,I,A)=>X(V,I,A).sheen.uH,getTarget:X,set:(V,I,A,B)=>X(I,A,B).sheen.uH=V},sheenRoughnessTexture:{extensions:{KHR_texture_transform:P("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(V,I,A)=>X(V,I,A).metallicF0Factor,getTarget:X,set:(V,I,A,B)=>X(I,A,B).metallicF0Factor=V,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"oI",get:(V,I,A)=>X(V,I,A).metallicReflectanceColor,getTarget:X,set:(V,I,A,B)=>X(I,A,B).metallicReflectanceColor.B(V),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:P("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:P("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(V,I,A)=>X(V,I,A).subSurface.refractionIntensity,getTarget:X,set:(V,I,A,B)=>X(I,A,B).subSurface.refractionIntensity=V,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:P("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(V,I,A)=>X(V,I,A).subSurface.translucencyIntensity,getTarget:X,set:(V,I,A,B)=>X(I,A,B).subSurface.translucencyIntensity=V},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:P("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"oI",get:(V,I,A)=>X(V,I,A).subSurface.translucencyColor,getTarget:X,set:(V,I,A,B)=>{var F;return V&&(null===(F=X(I,A,B).subSurface.translucencyColor)||void 0===F?void 0:F.B(V))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:P("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"oI",get:(V,I,A)=>X(V,I,A).subSurface.tintColor,getTarget:X,set:(V,I,A,B)=>X(I,A,B).subSurface.tintColor.B(V)},attenuationDistance:{type:"number",get:(V,I,A)=>X(V,I,A).subSurface.tintColorAtDistance,getTarget:X,set:(V,I,A,B)=>X(I,A,B).subSurface.tintColorAtDistance=V},thicknessFactor:{type:"number",get:(V,I,A)=>X(V,I,A).subSurface.maximumThickness,getTarget:X,set:(V,I,A,B)=>X(I,A,B).subSurface.maximumThickness=V},thicknessTexture:{extensions:{KHR_texture_transform:P("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonLight)),getPropertyName:[V=>"length"]},__array__:{__target__:!0,color:{type:"oI",get:V=>{var I;return null===(I=V._babylonLight)||void 0===I?void 0:I.WH},set:(V,I)=>{var A;return null===(A=I._babylonLight)||void 0===A?void 0:A.WH.B(V)},getTarget:V=>V._babylonLight,getPropertyName:[V=>"diffuse"]},uH:{type:"number",get:V=>{var I;return null===(I=V._babylonLight)||void 0===I?void 0:I.uH},set:(V,I)=>I._babylonLight?I._babylonLight.uH=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"intensity"]},range:{type:"number",get:V=>{var I;return null===(I=V._babylonLight)||void 0===I?void 0:I.range},set:(V,I)=>I._babylonLight?I._babylonLight.range=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"range"]},spot:{innerConeAngle:{type:"number",get:V=>{var I;return null===(I=V._babylonLight)||void 0===I?void 0:I.innerAngle},set:(V,I)=>I._babylonLight?I._babylonLight.innerAngle=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"innerConeAngle"]},outerConeAngle:{type:"number",get:V=>{var I;return null===(I=V._babylonLight)||void 0===I?void 0:I.angle},set:(V,I)=>I._babylonLight?I._babylonLight.angle=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonLight)),getPropertyName:[V=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonTexture)),getPropertyName:[V=>"length"]},__array__:{__target__:!0,uH:{type:"number",get:V=>{var I;return null===(I=V._babylonTexture)||void 0===I?void 0:I.level},set:(V,I)=>{I._babylonTexture&&(I._babylonTexture.level=V)},getTarget:V=>V._babylonTexture},rotation:{type:"Quaternion",get:V=>{var I;return V._babylonTexture&&B.Quaternion.FromRotationMatrix(null===(I=V._babylonTexture)||void 0===I?void 0:I.getReflectionTextureMatrix())},set:(V,I)=>{var A;I._babylonTexture&&(null!==(A=I._babylonTexture.sV())&&void 0!==A&&A.useRightHandedSystem||(V=B.Quaternion.Inverse(V)),B.Matrix.FromQuaternionToRef(V,I._babylonTexture.getReflectionTextureMatrix()))},getTarget:V=>V._babylonTexture}}}}},animations:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>{var I;return null===(I=V.primitives[0]._instanceData)||void 0===I?void 0:I.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function G(V){return new c(V,J)}function w(V){const I=V.split("/").map((V=>V.replace(/{}/g,"__array__")));let A=J;for(const B of I)B&&(A=A[B]);if(A&&A.type&&A.get)return A}function t(V,I){const A=V.split("/").map((V=>V.replace(/{}/g,"__array__")));let B=J;for(const F of A)F&&(B=B[F]);B&&B.type&&B.get&&(B.interpolation=I)}function u(V,I){const A=V.split("/").map((V=>V.replace(/{}/g,"__array__")));let B=J;for(const F of A)if(F){if(!B[F]){if("?"===F){B.__ignoreObjectTree__=!0;continue}B[F]={},"__array__"===F&&(B[F].__target__=!0)}B=B[F]}Object.assign(B,I)}},12918:(V,I,A)=>{"use strict";A.r(I),A.d(I,{AnimationPropertyInfo:()=>b,TransformNodeAnimationPropertyInfo:()=>X,WeightAnimationPropertyInfo:()=>P,getQuaternion:()=>H,getVector3:()=>Y,getWeights:()=>c});var B=A(11790),F=A(11231),E=A(12903);function Y(V,I,A,B){return F.tI.LI(I,A).scaleInPlace(B)}function H(V,I,A,B){return F.Quaternion.LI(I,A).scaleInPlace(B)}function c(V,I,A,B){const F=new Array(V._numMorphTargets);for(let E=0;E<F.length;E++)F[E]=I[A++]*B;return F}class b{constructor(V,I,A,B){this.type=V,this.name=I,this.getValue=A,this.getStride=B}_buildAnimation(V,I,A){const F=new B.d(V,this.name,I,this.type);return F.setKeys(A),F}}class X extends b{buildAnimations(V,I,A,B){const F=[];return F.push({babylonAnimatable:V._babylonTransformNode,babylonAnimation:this._buildAnimation(I,A,B)}),F}}class P extends b{buildAnimations(V,I,A,F){const E=[];if(V._numMorphTargets)for(let Y=0;Y<V._numMorphTargets;Y++){const H=new B.d(`${I}_${Y}`,this.name,A,this.type);if(H.setKeys(F.map((V=>({frame:V.frame,inTangent:V.inTangent?V.inTangent[Y]:void 0,value:V.value[Y],outTangent:V.outTangent?V.outTangent[Y]:void 0,interpolation:V.interpolation})))),V._primitiveBabylonMeshes)for(const I of V._primitiveBabylonMeshes)if(I.morphTargetManager){const V=I.morphTargetManager.getTarget(Y),A=H.clone();V.animations.push(A),E.push({babylonAnimatable:V,babylonAnimation:A})}}return E}}(0,E.k)("/nodes/{}/translation",[new X(B.d.ANIMATIONTYPE_VECTOR3,"position",Y,(()=>3))]),(0,E.k)("/nodes/{}/rotation",[new X(B.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",H,(()=>4))]),(0,E.k)("/nodes/{}/scale",[new X(B.d.ANIMATIONTYPE_VECTOR3,"PH",Y,(()=>3))]),(0,E.k)("/nodes/{}/weights",[new P(B.d.ANIMATIONTYPE_FLOAT,"influence",c,(V=>V._numMorphTargets))])},12865:(V,I,A)=>{"use strict";class B{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((V,I)=>{this._resolve=V,this._reject=I}))}}var F=A(11231),E=A(11276),Y=A(11052),H=A(11707),c=A(12868),b=A(12882),X=A(11057),P=A(11730),J=A(11790),G=A(11792),w=A(11097),t=A(11064),u=A(11070);class W{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(V){this._useTextureToStoreBoneMatrices=V,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(V,I,A){this.name=V,this.id=I,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=F.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new X.c,this.bones=[],this._scene=A||w.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const B=this._scene.getEngine().getCaps();this._canUseTextureForBones=B.textureFloat&&B.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((V=>!V.getParent()))}getTransformMatrices(V){if(this.needInitialSkinMatrix){if(!V)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return V._bonesTransformMatrices||this.prepare(!0),V._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(V){return this.needInitialSkinMatrix&&V._transformMatrixTexture?V._transformMatrixTexture:this._transformMatrixTexture}sV(){return this._scene}toString(V){let I=`Name: ${this.name}, nBones: ${this.bones.length}`;if(I+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,V){I+=", Ranges: {";let V=!0;for(const A in this._ranges)V&&(I+=", ",V=!1),I+=A;I+="}"}return I}getBoneIndexByName(V){for(let I=0,A=this.bones.length;I<A;I++)if(this.bones[I].name===V)return I;return-1}createAnimationRange(V,I,A){if(!this._ranges[V]){this._ranges[V]=new G.b(V,I,A);for(let B=0,F=this.bones.length;B<F;B++)this.bones[B].animations[0]&&this.bones[B].animations[0].createRange(V,I,A)}}deleteAnimationRange(V){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let A=0,B=this.bones.length;A<B;A++)this.bones[A].animations[0]&&this.bones[A].animations[0].deleteRange(V,I);this._ranges[V]=null}getAnimationRange(V){return this._ranges[V]||null}getAnimationRanges(){const V=[];let I;for(I in this._ranges)V.push(this._ranges[I]);return V}copyAnimationRange(V,I){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[I]||!V.getAnimationRange(I))return!1;let B=!0;const F=this._getHighestAnimationFrame()+1,E={},Y=V.bones;let H,c;for(c=0,H=Y.length;c<H;c++)E[Y[c].name]=Y[c];this.bones.length!==Y.length&&(t.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Y.length}`),B=!1);const b=A&&this.dimensionsAtRest&&V.dimensionsAtRest?this.dimensionsAtRest.divide(V.dimensionsAtRest):null;for(c=0,H=this.bones.length;c<H;c++){const V=this.bones[c].name,Y=E[V];Y?B=B&&this.bones[c].copyAnimationRange(Y,I,F,A,b):(t.b.Warn("copyAnimationRange: not same rig, missing source bone "+V),B=!1)}const X=V.getAnimationRange(I);return X&&(this._ranges[I]=new G.b(I,X.from+F,X.to+F)),B}returnToRest(){for(const V of this.bones)-1!==V._index&&V.returnToRest()}_getHighestAnimationFrame(){let V=0;for(let I=0,A=this.bones.length;I<A;I++)if(this.bones[I].animations[0]){const A=this.bones[I].animations[0].getHighestFrame();V<A&&(V=A)}return V}beginAnimation(V,I,A,B){const F=this.getAnimationRange(V);return F?this._scene.beginAnimation(this,F.from,F.to,I,A,B):null}static MakeAnimationAdditive(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;const B=V.getAnimationRange(A);if(!B)return null;const F=V._scene.getAllAnimatablesByTarget(V);let E=null;for(let H=0;H<F.length;H++){const V=F[H];if(V.fromFrame===(null===B||void 0===B?void 0:B.from)&&V.toFrame===(null===B||void 0===B?void 0:B.to)){E=V;break}}const Y=V.getAnimatables();for(let H=0;H<Y.length;H++){const V=Y[H].animations;if(V)for(let B=0;B<V.length;B++)J.d.MakeAnimationAdditive(V[B],I,A)}return E&&(E.isAdditive=!0),V}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(V){this._meshesWithPoseMatrix.push(V)}_unregisterMeshWithPoseMatrix(V){const I=this._meshesWithPoseMatrix.indexOf(V);I>-1&&this._meshesWithPoseMatrix.splice(I,1)}_computeTransformMatrices(V,I){this.onBeforeComputeObservable.notifyObservers(this);for(let A=0;A<this.bones.length;A++){const B=this.bones[A];B._childUpdateId++;const F=B.getParent();if(F?B.getLocalMatrix().multiplyToRef(F.getFinalMatrix(),B.getFinalMatrix()):I?B.getLocalMatrix().multiplyToRef(I,B.getFinalMatrix()):B.getFinalMatrix().B(B.getLocalMatrix()),-1!==B._index){const I=null===B._index?A:B._index;B.getAbsoluteInverseBindMatrix().multiplyToArray(B.getFinalMatrix(),V,16*I)}}this._identity.copyToArray(V,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const V=this.sV().getRenderId();if(this._currentRenderId===V)return;this._currentRenderId=V}if(this._numBonesWithLinkedTransformNode>0)for(const V of this.bones)if(V._linkedTransformNode){const I=V._linkedTransformNode;V.position=I.position,I.rotationQuaternion?V.rotationQuaternion=I.rotationQuaternion:V.rotation=I.rotation,V.PH=I.PH}if(this.needInitialSkinMatrix)for(const V of this._meshesWithPoseMatrix){const I=V.getPoseMatrix();let A=this._isDirty;if(V._bonesTransformMatrices&&V._bonesTransformMatrices.length===16*(this.bones.length+1)||(V._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),A=!0),A){if(this._synchronizedWithMesh!==V){this._synchronizedWithMesh=V;for(const V of this.bones)if(!V.getParent()){V.getBindMatrix().multiplyToRef(I,F.TmpVectors.Matrix[1]),V._updateAbsoluteBindMatrices(F.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const I=4*(this.bones.length+1);V._transformMatrixTexture&&V._transformMatrixTexture.getSize().width===I||(V._transformMatrixTexture&&V._transformMatrixTexture.dispose(),V._transformMatrixTexture=P.b.CreateRGBATexture(V._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(V._bonesTransformMatrices,I),this.isUsingTextureForMatrices&&V._transformMatrixTexture&&V._transformMatrixTexture.update(V._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=P.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let V=0;V<this.bones.length;V++)this._animatables.push(this.bones[V])}return this._animatables}clone(V,I){const A=new W(V,I||V,this._scene);A.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let B=0;B<this.bones.length;B++){const V=this.bones[B];let I=null;const F=V.getParent();if(F){const V=this.bones.indexOf(F);I=A.bones[V]}const E=new b.c(V.name,A,I,V.getBindMatrix().clone(),V.getRestMatrix().clone());E._index=V._index,V._linkedTransformNode&&E.linkTransformNode(V._linkedTransformNode),u.b.DeepCopy(V.animations,E.animations)}if(this._ranges){A._ranges={};for(const V in this._ranges){const I=this._ranges[V];I&&(A._ranges[V]=I.clone())}}return this._isDirty=!0,A.prepare(!0),A}enableBlending(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const I of this.bones)for(const A of I.animations)A.enableBlending=!0,A.blendingSpeed=V}dispose(){if(this._meshesWithPoseMatrix.length=0,this.sV().stopAnimation(this),this.sV().removeSkeleton(this),this._parentContainer){const V=this._parentContainer.skeletons.indexOf(this);V>-1&&this._parentContainer.skeletons.splice(V,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const V={};V.name=this.name,V.id=this.id,this.dimensionsAtRest&&(V.dimensionsAtRest=this.dimensionsAtRest.AH()),V.bones=[],V.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let A=0;A<this.bones.length;A++){var I;const B=this.bones[A],F=B.getParent(),E={parentBoneIndex:F?this.bones.indexOf(F):-1,index:B.getIndex(),name:B.name,id:B.id,matrix:B.getBindMatrix().AH(),rest:B.getRestMatrix().AH(),linkedTransformNodeId:null===(I=B.getTransformNode())||void 0===I?void 0:I.id};V.bones.push(E),B.length&&(E.length=B.length),B.metadata&&(E.metadata=B.metadata),B.animations&&B.animations.length>0&&(E.animation=B.animations[0].serialize()),V.ranges=[];for(const I in this._ranges){const A=this._ranges[I];if(!A)continue;const B={};B.name=I,B.from=A.from,B.to=A.to,V.ranges.push(B)}}return V}static Parse(V,I){const A=new W(V.name,V.id,I);let B;for(V.dimensionsAtRest&&(A.dimensionsAtRest=F.tI.LI(V.dimensionsAtRest)),A.needInitialSkinMatrix=V.needInitialSkinMatrix,B=0;B<V.bones.length;B++){const I=V.bones[B],E=V.bones[B].index;let Y=null;I.parentBoneIndex>-1&&(Y=A.bones[I.parentBoneIndex]);const H=I.rest?F.Matrix.LI(I.rest):null,c=new b.c(I.name,A,Y,F.Matrix.LI(I.matrix),H,null,E);void 0!==I.id&&null!==I.id&&(c.id=I.id),I.length&&(c.length=I.length),I.metadata&&(c.metadata=I.metadata),I.animation&&c.animations.push(J.d.Parse(I.animation)),void 0!==I.linkedTransformNodeId&&null!==I.linkedTransformNodeId&&(A._hasWaitingData=!0,c._waitingTransformNodeId=I.linkedTransformNodeId)}if(V.ranges)for(B=0;B<V.ranges.length;B++){const I=V.ranges[B];A.createAnimationRange(I.name,I.from,I.to)}return A}computeAbsoluteMatrices(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||V)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(V)}getPoseMatrix(){let V=null;return this._meshesWithPoseMatrix.length>0&&(V=this._meshesWithPoseMatrix[0].getPoseMatrix()),V}sortBones(){const V=[],I=new Array(this.bones.length);for(let A=0;A<this.bones.length;A++)this._sortBones(A,V,I);this.bones=V}_sortBones(V,I,A){if(A[V])return;A[V]=!0;const B=this.bones[V];if(!B)return;void 0===B._index&&(B._index=V);const F=B.getParent();F&&this._sortBones(this.bones.indexOf(F),I,A),I.push(B)}setCurrentPoseAsRest(){for(const V of this.bones)V.setCurrentPoseAsRest()}}var g=A(11561),o=A(11752),L=A(11207),z=A(11661),m=A(11300),s=A(11713),e=A(11669),S=A(11701),Q=A(11799),h=A(11323),r=A(12832);class M{set areUpdatesFrozen(V){V?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new h.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,V||(V=w.e.LastCreatedScene),this._scene=V,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const V=this._scene.getEngine().getCaps();this._canUseTextureForTargets=V.canUseGLVertexID&&V.textureFloat&&V.maxVertexTextureImageUnits>0&&V.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return M.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?M.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(V){this._numMaxInfluencers!==V&&(this._numMaxInfluencers=V,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(V){this._useTextureToStoreTargets!==V&&(this._useTextureToStoreTargets=V,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var V;return M.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(V=this._scene)&&void 0!==V&&V.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(V){return this._activeTargets.data[V]}getTarget(V){return this._targets[V]}getTargetByName(V){for(const I of this._targets)if(I.name===V)return I;return null}addTarget(V){this._targets.push(V),this._targetInfluenceChangedObservers.push(V.onInfluenceChanged.add((V=>{this.areUpdatesFrozen&&V&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(V)}))),this._targetDataLayoutChangedObservers.push(V._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(V){const I=this._targets.indexOf(V);I>=0&&(this._targets.splice(I,1),V.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(I,1)[0]),V._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(I,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(V)}_bind(V){V.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),V.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),V.setTexture("morphTargets",this._targetStoreTexture),V.setInt("morphTargetCount",this.numInfluencers)}clone(){const V=new M(this._scene);for(const I of this._targets)V.addTarget(I.clone());return V.enablePositionMorphing=this.enablePositionMorphing,V.enableNormalMorphing=this.enableNormalMorphing,V.enableTangentMorphing=this.enableTangentMorphing,V.enableUVMorphing=this.enableUVMorphing,V.enableUV2Morphing=this.enableUV2Morphing,V.enableColorMorphing=this.enableColorMorphing,V}serialize(){const V={};V.id=this.uniqueId,V.targets=[];for(const I of this._targets)V.targets.push(I.serialize());return V}_syncActiveTargets(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const I=!!this._targetStoreTexture,A=this.isUsingTextureForTargets;(this._mustSynchronize||I!==A)&&(this._mustSynchronize=!1,this.synchronize());let B=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let F=-1;for(const E of this._targets)if(F++,0!==E.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=M.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(E),this._morphTargetTextureIndices[B]=F,this._tempInfluences[B++]=E.influence}this._morphTargetTextureIndices.length!==B&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,B)),this._influences&&this._influences.length===B||(this._influences=new Float32Array(B));for(let E=0;E<B;E++)this._influences[E]=this._tempInfluences[E];if(V&&this._scene)for(const E of this._scene.meshes)E.morphTargetManager===this&&(A?E._markSubMeshesAsAttributesDirty():E._syncGeometryWithMorphTargetManager())}synchronize(){var V;if(!this._scene||this.areUpdatesFrozen)return;const I=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(V=this._targetStoreTexture)||void 0===V||V.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>I.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const A of this._targets){this._supportsPositions=this._supportsPositions&&A.hasPositions,this._supportsNormals=this._supportsNormals&&A.hasNormals,this._supportsTangents=this._supportsTangents&&A.hasTangents,this._supportsUVs=this._supportsUVs&&A.hasUVs,this._supportsUV2s=this._supportsUV2s&&A.hasUV2s,this._supportsColors=this._supportsColors&&A.hasColors;const V=A.vertexCount;if(0===this._vertexCount)this._vertexCount=V;else if(this._vertexCount!==V)return void t.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${A.name}": ${V}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const V=I.getCaps().maxTextureSize;this._textureWidth>V&&(this._textureHeight=Math.ceil(this._textureWidth/V),this._textureWidth=V);const A=this._targets.length,B=new Float32Array(A*this._textureWidth*this._textureHeight*4);let F=0;for(let I=0;I<A;I++){const V=this._targets[I],A=V.getPositions(),E=V.getNormals(),Y=V.getUVs(),H=V.getTangents(),c=V.getUV2s(),b=V.getColors();F=I*this._textureWidth*this._textureHeight*4;for(let I=0;I<this._vertexCount;I++)this._supportsPositions&&A&&(B[F]=A[3*I],B[F+1]=A[3*I+1],B[F+2]=A[3*I+2],F+=4),this._supportsNormals&&E&&(B[F]=E[3*I],B[F+1]=E[3*I+1],B[F+2]=E[3*I+2],F+=4),this._supportsUVs&&Y&&(B[F]=Y[2*I],B[F+1]=Y[2*I+1],F+=4),this._supportsTangents&&H&&(B[F]=H[3*I],B[F+1]=H[3*I+1],B[F+2]=H[3*I+2],F+=4),this._supportsUV2s&&c&&(B[F]=c[2*I],B[F+1]=c[2*I+1],F+=4),this._supportsColors&&b&&(B[F]=b[4*I],B[F+1]=b[4*I+1],B[F+2]=b[4*I+2],B[F+3]=b[4*I+3],F+=4)}this._targetStoreTexture=r.d.CreateRGBATexture(B,this._textureWidth,this._textureHeight,A,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const A of this._scene.meshes)A.morphTargetManager===this&&A._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const V=this._parentContainer.morphTargetManagers.indexOf(this);V>-1&&this._parentContainer.morphTargetManagers.splice(V,1),this._parentContainer=null}for(const V of this._targets)this._scene.stopAnimation(V)}}static Parse(V,I){const A=new M(I);for(const B of V.targets)A.addTarget(Q.b.Parse(B,I));return A}}M.EnableTextureStorage=!0,M.MaxActiveMorphTargetsInVertexAttributeMode=8,M.ConstantTargetCountForTextureMode=0;var x=A(12890),f=A(11105),R=A(11571);const q=new Map,N=q;function l(V,I,A){i(V)&&t.b.Warn(`Extension with the name '${V}' already exists`),q.set(V,{isGLTFExtension:I,factory:A})}function i(V){return q.delete(V)}var y=A(12903),v=A(11853),C=A(11311);class K{static Get(V,I,A){if(!I||void 0==A||!I[A])throw new Error(`${V}: Failed to find index (${A})`);return I[A]}static TryGet(V,I){return V&&void 0!=I&&V[I]?V[I]:null}static Assign(V){if(V)for(let I=0;I<V.length;I++)V[I].index=I}}function p(V){if(V.min&&V.max){const I=V.min,A=V.max,B=F.TmpVectors.tI[0].XH(I[0],I[1],I[2]),E=F.TmpVectors.tI[1].XH(A[0],A[1],A[2]);if(V.normalized&&5126!==V.componentType){let I=1;switch(V.componentType){case 5120:I=127;break;case 5121:I=255;break;case 5122:I=32767;break;case 5123:I=65535}const A=1/I;B.scaleInPlace(A),E.scaleInPlace(A)}return new R.d(B,E)}return null}class j{static RegisterExtension(V,I){l(V,!1,I)}static UnregisterExtension(V){return i(V)}get nY(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(V){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=V}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((V=>V.dispose&&V.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(V,I,A,B,F,E){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=I,this._assetContainer=A,this._loadData(B);let E=null;if(V){const I={};if(this._gltf.nodes)for(const V of this._gltf.nodes)V.name&&(I[V.name]=V.index);E=(V instanceof Array?V:[V]).map((V=>{const A=I[V];if(void 0===A)throw new Error(`Failed to find node '${V}'`);return A}))}return await this._loadAsync(F,Y,E,(()=>({meshes:this._getMeshes(),XG:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(V,I,A,B){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=V,this._loadData(I),await this._loadAsync(A,F,null,(()=>{}))}async _loadAsync(V,I,A,B){return await Promise.resolve().then((async()=>{this._rootUrl=V,this._uniqueRootUrl=!V.startsWith("file:")&&I?V:`${V}${Date.now()}/`,this._fileName=I,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const F=`${x.m[x.m.LOADING]} => ${x.m[x.m.READY]}`,E=`${x.m[x.m.LOADING]} => ${x.m[x.m.COMPLETE]}`;this._parent._startPerformanceCounter(F),this._parent._startPerformanceCounter(E),this._parent._setState(x.m.LOADING),this._extensionsOnLoading();const H=new Array;if(!this.parent.loadOnlyMaterials)if(A)H.push(this.loadSceneAsync("/nodes",{nodes:A,index:-1}));else if(void 0!=this._gltf.WI||this._gltf.scenes&&this._gltf.scenes[0]){const V=K.Get("/scene",this._gltf.scenes,this._gltf.WI||0);H.push(this.loadSceneAsync(`/scenes/${V.index}`,V))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let V=0;V<this._gltf.materials.length;++V){const I=this._gltf.materials[V],A="/materials/"+V,B=g.c.TriangleFillMode;H.push(this._loadMaterialAsync(A,I,null,B,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&H.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&H.push(this._compileShadowGeneratorsAsync());const c=Promise.all(H).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.qH(!0);for(const V of this._babylonScene.materials){const I=V;void 0!==I.maxSimultaneousLights&&(I.maxSimultaneousLights=Math.max(I.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(x.m.READY),this._skipStartAnimationStep||this._startAnimations(),B()}));return await c.then((V=>(this._parent._endPerformanceCounter(F),Y.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(E),this._parent._setState(x.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(V=>{this._parent.onErrorObservable.notifyObservers(V),this._parent.onErrorObservable.clear(),this.dispose()}))})),V)))})).catch((V=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(V),this._parent.onErrorObservable.clear(),this.dispose()),V}))}_loadData(V){if(this._gltf=V.json,this._setupData(),V.bin){const I=this._gltf.buffers;if(I&&I[0]&&!I[0].uri){const A=I[0];(A.byteLength<V.bin.byteLength-3||A.byteLength>V.bin.byteLength)&&t.b.Warn(`Binary buffer length (${A.byteLength}) from JSON does not match chunk length (${V.bin.byteLength})`),this._bin=V.bin}else t.b.Warn("Unexpected BIN chunk")}}_setupData(){if(K.Assign(this._gltf.accessors),K.Assign(this._gltf.animations),K.Assign(this._gltf.buffers),K.Assign(this._gltf.bufferViews),K.Assign(this._gltf.cameras),K.Assign(this._gltf.images),K.Assign(this._gltf.materials),K.Assign(this._gltf.meshes),K.Assign(this._gltf.nodes),K.Assign(this._gltf.samplers),K.Assign(this._gltf.scenes),K.Assign(this._gltf.skins),K.Assign(this._gltf.textures),this._gltf.nodes){const V={};for(const A of this._gltf.nodes)if(A.children)for(const I of A.children)V[I]=A.index;const I=this._createRootNode();for(const A of this._gltf.nodes){const B=V[A.index];A.parent=void 0===B?I:this._gltf.nodes[B]}}}async _loadExtensionsAsync(){const V=[];if(N.forEach(((I,A)=>{var B;!1===(null===(B=this.parent.extensionOptions[A])||void 0===B?void 0:B.enabled)?I.isGLTFExtension&&this.isExtensionUsed(A)&&t.b.Warn(`Extension ${A} is used but has been explicitly disabled.`):I.isGLTFExtension&&!this.isExtensionUsed(A)||V.push((async()=>{const V=await I.factory(this);return V.name!==A&&t.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${V.name} !== ${A}`),this._parent.onExtensionLoadedObservable.notifyObservers(V),V})())})),this._extensions.push(...await Promise.all(V)),this._extensions.sort(((V,I)=>(V.order||Number.MAX_VALUE)-(I.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const A of this._gltf.extensionsRequired){if(!this._extensions.some((V=>V.name===A&&V.enabled))){var I;if(!1===(null===(I=this.parent.extensionOptions[A])||void 0===I?void 0:I.enabled))throw new Error(`Required extension ${A} is disabled`);throw new Error(`Required extension ${A} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new S.c("__root__",this._babylonScene);this._rootBabylonMesh=V,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.qH(!1);const I={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case x.k.AUTO:this._babylonScene.useRightHandedSystem||(I.rotation=[0,1,0,0],I.scale=[1,1,-1],j._LoadTransform(I,this._rootBabylonMesh));break;case x.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(V),I}loadSceneAsync(V,I){const A=this._extensionsLoadSceneAsync(V,I);if(A)return A;const B=new Array;if(this.logOpen(`${V} ${I.name||""}`),I.nodes)for(const F of I.nodes){const I=K.Get(`${V}/nodes/${F}`,this._gltf.nodes,F);B.push(this.loadNodeAsync(`/nodes/${I.index}`,I,(V=>{V.parent=this._rootBabylonMesh})))}for(const F of this._postSceneLoadActions)F();return B.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(B).then((()=>{}))}_forEachPrimitive(V,I){if(V._primitiveBabylonMeshes)for(const A of V._primitiveBabylonMeshes)I(A)}_getGeometries(){const V=[],I=this._gltf.nodes;if(I)for(const A of I)this._forEachPrimitive(A,(I=>{const A=I.HH;A&&-1===V.indexOf(A)&&V.push(A)}));return V}_getMeshes(){const V=[];this._rootBabylonMesh instanceof e.c&&V.push(this._rootBabylonMesh);const I=this._gltf.nodes;if(I)for(const A of I)this._forEachPrimitive(A,(I=>{V.push(I)}));return V}_getTransformNodes(){const V=[],I=this._gltf.nodes;if(I)for(const A of I)A._babylonTransformNode&&"Bc"===A._babylonTransformNode.getClassName()&&V.push(A._babylonTransformNode),A._babylonTransformNodeForSkin&&V.push(A._babylonTransformNodeForSkin);return V}_getSkeletons(){const V=[],I=this._gltf.skins;if(I)for(const A of I)A._data&&V.push(A._data.babylonSkeleton);return V}_getAnimationGroups(){const V=[],I=this._gltf.animations;if(I)for(const A of I)A._babylonAnimationGroup&&V.push(A._babylonAnimationGroup);return V}_startAnimations(){switch(this._parent.animationStartMode){case x.g.NONE:break;case x.g.FIRST:{const V=this._getAnimationGroups();0!==V.length&&V[0].start(!0);break}case x.g.ALL:{const V=this._getAnimationGroups();for(const I of V)I.start(!0);break}default:return void t.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadNodeAsync(V,I,A);if(B)return B;if(I._babylonTransformNode)throw new Error(`${V}: Invalid recursive node hierarchy`);const F=new Array;this.logOpen(`${V} ${I.name||""}`);const E=B=>{if(j.AddPointerMetadata(B,V),j._LoadTransform(I,B),void 0!=I.camera){const A=K.Get(`${V}/camera`,this._gltf.cameras,I.camera);F.push(this.loadCameraAsync(`/cameras/${A.index}`,A,(V=>{V.parent=B,this._babylonScene.useRightHandedSystem||(B.PH.x=-1)})))}if(I.children)for(const A of I.children){const I=K.Get(`${V}/children/${A}`,this._gltf.nodes,A);F.push(this.loadNodeAsync(`/nodes/${I.index}`,I,(V=>{V.parent=B})))}A(B)},Y=void 0!=I.mesh,H=this._parent.loadSkins&&void 0!=I.skin;if(!Y||H){const V=I.name||`node${I.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new z.e(V,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==I.mesh?I._babylonTransformNode=A:I._babylonTransformNodeForSkin=A,E(A)}if(Y)if(H){const A=K.Get(`${V}/mesh`,this._gltf.meshes,I.mesh);F.push(this._loadMeshAsync(`/meshes/${A.index}`,I,A,(A=>{const B=I._babylonTransformNodeForSkin;A.metadata=(0,v.d)(B.metadata,A.metadata||{});const E=K.Get(`${V}/skin`,this._gltf.skins,I.skin);F.push(this._loadSkinAsync(`/skins/${E.index}`,I,E,(V=>{this._forEachPrimitive(I,(I=>{I.skeleton=V})),this._postSceneLoadActions.push((()=>{if(void 0!=E.skeleton){const V=K.Get(`/skins/${E.index}/skeleton`,this._gltf.nodes,E.skeleton).parent;I.index===V.index?A.parent=B.parent:A.parent=V._babylonTransformNode}else A.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:B,skinnedNode:A})}))})))})))}else{const A=K.Get(`${V}/mesh`,this._gltf.meshes,I.mesh);F.push(this._loadMeshAsync(`/meshes/${A.index}`,I,A,E))}return this.logClose(),Promise.all(F).then((()=>(this._forEachPrimitive(I,(V=>{const I=V;!I.isAnInstance&&I.HH&&I.HH.useBoundingInfoFromGeometry?V.RV():V.refreshBoundingInfo(!0,!0)})),I._babylonTransformNode)))}_loadMeshAsync(V,I,A,B){const F=A.primitives;if(!F||!F.length)throw new Error(`${V}: Primitives are missing`);void 0==F[0].index&&K.Assign(F);const E=new Array;this.logOpen(`${V} ${A.name||""}`);const Y=I.name||`node${I.index}`;if(1===F.length){const B=A.primitives[0];E.push(this._loadMeshPrimitiveAsync(`${V}/primitives/${B.index}`,Y,I,A,B,(V=>{I._babylonTransformNode=V,I._primitiveBabylonMeshes=[V]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,I._babylonTransformNode=new z.e(Y,this._babylonScene),I._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._primitiveBabylonMeshes=[];for(const B of F)E.push(this._loadMeshPrimitiveAsync(`${V}/primitives/${B.index}`,`${Y}_primitive${B.index}`,I,A,B,(V=>{V.parent=I._babylonTransformNode,I._primitiveBabylonMeshes.push(V)})))}return B(I._babylonTransformNode),this.logClose(),Promise.all(E).then((()=>I._babylonTransformNode))}_loadMeshPrimitiveAsync(V,I,A,B,F,E){const Y=this._extensionsLoadMeshPrimitiveAsync(V,I,A,B,F,E);if(Y)return Y;this.logOpen(`${V}`);const H=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==A.skin&&!B.primitives[0].targets;let c,b;if(H&&F._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,c=F._instanceData.babylonSourceMesh.createInstance(I),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b=F._instanceData.promise;else{const E=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new S.c(I,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.sideOrientation=this._babylonScene.useRightHandedSystem?g.c.CounterClockWiseSideOrientation:g.c.ClockWiseSideOrientation,this._createMorphTargets(V,A,B,F,Y),E.push(this._loadVertexDataAsync(V,F,Y).then((async I=>await this._loadMorphTargetsAsync(V,F,Y,I).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,I.xV(Y),I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const X=j._GetDrawMode(V,F.mode);if(void 0==F.material){let V=this._defaultBabylonMaterialData[X];V||(V=this._createDefaultMaterial("__GLTFLoader._default",X),this._parent.onMaterialLoadedObservable.notifyObservers(V),this._defaultBabylonMaterialData[X]=V),Y.material=V}else if(!this.parent.skipMaterials){const I=K.Get(`${V}/material`,this._gltf.materials,F.material);E.push(this._loadMaterialAsync(`/materials/${I.index}`,I,Y,X,(V=>{Y.material=V})))}b=Promise.all(E),H&&(F._instanceData={babylonSourceMesh:Y,promise:b}),c=Y}return j.AddPointerMetadata(c,V),this._parent.onMeshLoadedObservable.notifyObservers(c),E(c),this.logClose(),b.then((()=>c))}_loadVertexDataAsync(V,I,A){const B=this._extensionsLoadVertexDataAsync(V,I,A);if(B)return B;const F=I.attributes;if(!F)throw new Error(`${V}: Attributes are missing`);const E=new Array,Y=new s.d(A.name,this._babylonScene);if(void 0==I.indices)A.isUnIndexed=!0;else{const A=K.Get(`${V}/indices`,this._gltf.accessors,I.indices);E.push(this._loadIndicesAccessorAsync(`/accessors/${A.index}`,A).then((V=>{Y.setIndices(V)})))}const H=(I,B,H)=>{if(void 0==F[I])return;A._delayInfo=A._delayInfo||[],-1===A._delayInfo.indexOf(B)&&A._delayInfo.push(B);const c=K.Get(`${V}/attributes/${I}`,this._gltf.accessors,F[I]);E.push(this._loadVertexAccessorAsync(`/accessors/${c.index}`,c,B).then((V=>{if(V.getKind()===m.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!A.skeleton){const V=p(c);V&&(Y._boundingInfo=V,Y.useBoundingInfoFromGeometry=!0)}Y.setVerticesBuffer(V,c.count)}))),B==m.g.MatricesIndicesExtraKind&&(A.numBoneInfluencers=8),H&&H(c)};return H("POSITION",m.g.PositionKind),H("NORMAL",m.g.NormalKind),H("TANGENT",m.g.TangentKind),H("TEXCOORD_0",m.g.UVKind),H("TEXCOORD_1",m.g.UV2Kind),H("TEXCOORD_2",m.g.UV3Kind),H("TEXCOORD_3",m.g.UV4Kind),H("TEXCOORD_4",m.g.UV5Kind),H("TEXCOORD_5",m.g.UV6Kind),H("JOINTS_0",m.g.MatricesIndicesKind),H("WEIGHTS_0",m.g.MatricesWeightsKind),H("JOINTS_1",m.g.MatricesIndicesExtraKind),H("WEIGHTS_1",m.g.MatricesWeightsExtraKind),H("COLOR_0",m.g.ColorKind,(V=>{"VEC4"===V.type&&(A.hasVertexAlpha=!0)})),Promise.all(E).then((()=>Y))}_createMorphTargets(V,I,A,B,F){if(!B.targets||!this._parent.loadMorphTargets)return;if(void 0==I._numMorphTargets)I._numMorphTargets=B.targets.length;else if(B.targets.length!==I._numMorphTargets)throw new Error(`${V}: Primitives do not have the same number of targets`);const E=A.extras?A.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,F.morphTargetManager=new M(this._babylonScene),F.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.morphTargetManager.areUpdatesFrozen=!0;for(let Y=0;Y<B.targets.length;Y++){const V=I.weights?I.weights[Y]:A.weights?A.weights[Y]:0,B=E?E[Y]:`morphTarget${Y}`;F.morphTargetManager.addTarget(new Q.b(B,V,F.sV()))}}_loadMorphTargetsAsync(V,I,A,B){if(!I.targets||!this._parent.loadMorphTargets)return Promise.resolve();const F=new Array,E=A.morphTargetManager;for(let Y=0;Y<E.numTargets;Y++){const A=E.getTarget(Y);F.push(this._loadMorphTargetVertexDataAsync(`${V}/targets/${Y}`,B,I.targets[Y],A))}return Promise.all(F).then((()=>{E.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(V,I,A,B){const F=new Array,E=(B,E,Y)=>{if(void 0==A[B])return;const H=I.getVertexBuffer(E);if(!H)return;const c=K.Get(`${V}/${B}`,this._gltf.accessors,A[B]);F.push(this._loadFloatAccessorAsync(`/accessors/${c.index}`,c).then((V=>{Y(H,V)})))};return E("POSITION",m.g.PositionKind,((V,I)=>{const A=new Float32Array(I.length);V.forEach(I.length,((V,B)=>{A[B]=I[B]+V})),B.setPositions(A)})),E("NORMAL",m.g.NormalKind,((V,I)=>{const A=new Float32Array(I.length);V.forEach(A.length,((V,B)=>{A[B]=I[B]+V})),B.setNormals(A)})),E("TANGENT",m.g.TangentKind,((V,I)=>{const A=new Float32Array(I.length/3*4);let F=0;V.forEach(I.length/3*4,((V,B)=>{(B+1)%4!==0&&(A[F]=I[F]+V,F++)})),B.setTangents(A)})),E("TEXCOORD_0",m.g.UVKind,((V,I)=>{const A=new Float32Array(I.length);V.forEach(I.length,((V,B)=>{A[B]=I[B]+V})),B.setUVs(A)})),E("TEXCOORD_1",m.g.UV2Kind,((V,I)=>{const A=new Float32Array(I.length);V.forEach(I.length,((V,B)=>{A[B]=I[B]+V})),B.setUV2s(A)})),E("COLOR_0",m.g.ColorKind,((I,A)=>{let F=null;const E=I.getSize();if(3===E){F=new Float32Array(A.length/3*4),I.forEach(A.length,((V,I)=>{const B=Math.floor(I/3),E=I%3;F[4*B+E]=A[3*B+E]+V}));for(let V=0;V<A.length/3;++V)F[4*V+3]=1}else{if(4!==E)throw new Error(`${V}: Invalid number of components (${E}) for COLOR_0 attribute`);F=new Float32Array(A.length),I.forEach(A.length,((V,I)=>{F[I]=A[I]+V}))}B.setColors(F)})),await Promise.all(F).then((()=>{}))}static _LoadTransform(V,I){if(void 0!=V.skin)return;let A=F.tI.Zero(),B=F.Quaternion.Identity(),E=F.tI.One();if(V.matrix){F.Matrix.LI(V.matrix).decompose(E,B,A)}else V.translation&&(A=F.tI.LI(V.translation)),V.rotation&&(B=F.Quaternion.LI(V.rotation)),V.scale&&(E=F.tI.LI(V.scale));I.position=A,I.rotationQuaternion=B,I.PH=E}_loadSkinAsync(V,I,A,B){if(!this._parent.loadSkins)return Promise.resolve();const F=this._extensionsLoadSkinAsync(V,I,A);if(F)return F;if(A._data)return B(A._data.babylonSkeleton),A._data.promise;const E=`skeleton${A.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new W(A.name||E,E,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(V,A,Y);const H=this._loadSkinInverseBindMatricesDataAsync(V,A).then((V=>{this._updateBoneMatrices(Y,V)}));return A._data={babylonSkeleton:Y,promise:H},B(Y),H}_loadBones(V,I,A){if(void 0==I.skeleton||this._parent.alwaysComputeSkeletonRootNode){const A=this._findSkeletonRootNode(`${V}/joints`,I.joints);if(A)if(void 0===I.skeleton)I.skeleton=A.index;else{const B=(V,I)=>{for(;I.parent;I=I.parent)if(I.parent===V)return!0;return!1},F=K.Get(`${V}/skeleton`,this._gltf.nodes,I.skeleton);F===A||B(F,A)||(t.b.Warn(`${V}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),I.skeleton=A.index)}else t.b.Warn(`${V}: Failed to find common root`)}const B={};for(const F of I.joints){const E=K.Get(`${V}/joints/${F}`,this._gltf.nodes,F);this._loadBone(E,I,A,B)}}_findSkeletonRootNode(V,I){if(0===I.length)return null;const A={};for(const F of I){const I=[];let B=K.Get(`${V}/${F}`,this._gltf.nodes,F);for(;-1!==B.index;)I.unshift(B),B=B.parent;A[F]=I}let B=null;for(let F=0;;++F){let V=A[I[0]];if(F>=V.length)return B;const E=V[F];for(let Y=1;Y<I.length;++Y)if(V=A[I[Y]],F>=V.length||E!==V[F])return B;B=E}}_loadBone(V,I,A,B){V._isJoint=!0;let F=B[V.index];if(F)return F;let E=null;V.index!==I.skeleton&&(V.parent&&-1!==V.parent.index?E=this._loadBone(V.parent,I,A,B):void 0!==I.skeleton&&t.b.Warn(`/skins/${I.index}/skeleton: Skeleton node is not a common root`));const Y=I.joints.indexOf(V.index);return F=new b.c(V.name||`joint${V.index}`,A,E,this._getNodeMatrix(V),null,null,Y),B[V.index]=F,this._postSceneLoadActions.push((()=>{F.linkTransformNode(V._babylonTransformNode)})),F}_loadSkinInverseBindMatricesDataAsync(V,I){if(void 0==I.inverseBindMatrices)return Promise.resolve(null);const A=K.Get(`${V}/inverseBindMatrices`,this._gltf.accessors,I.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${A.index}`,A)}_updateBoneMatrices(V,I){for(const A of V.bones){const V=F.Matrix.Identity(),B=A._index;I&&-1!==B&&(F.Matrix.FromArrayToRef(I,16*B,V),V.invertToRef(V));const E=A.getParent();E&&V.multiplyToRef(E.getAbsoluteInverseBindMatrix(),V),A.EH(V,!1,!1),A._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(V){return V.matrix?F.Matrix.LI(V.matrix):F.Matrix.Compose(V.scale?F.tI.LI(V.scale):F.tI.One(),V.rotation?F.Quaternion.LI(V.rotation):F.Quaternion.Identity(),V.translation?F.tI.LI(V.translation):F.tI.Zero())}loadCameraAsync(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadCameraAsync(V,I,A);if(B)return B;const E=new Array;this.logOpen(`${V} ${I.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new c.e(I.name||`camera${I.index}`,F.tI.Zero(),this._babylonScene,!1);switch(Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._babylonCamera=Y,Y.setTarget(new F.tI(0,0,-1)),I.type){case"perspective":{const A=I.perspective;if(!A)throw new Error(`${V}: Camera perspective properties are missing`);Y.fov=A.yfov,Y.FH=A.znear,Y.maxZ=A.zfar||0;break}case"orthographic":if(!I.orthographic)throw new Error(`${V}: Camera orthographic properties are missing`);Y.mode=H.c.ORTHOGRAPHIC_CAMERA,Y.orthoLeft=-I.orthographic.xmag,Y.orthoRight=I.orthographic.xmag,Y.orthoBottom=-I.orthographic.ymag,Y.orthoTop=I.orthographic.ymag,Y.FH=I.orthographic.znear,Y.maxZ=I.orthographic.zfar;break;default:throw new Error(`${V}: Invalid camera type (${I.type})`)}return j.AddPointerMetadata(Y,V),this._parent.onCameraLoadedObservable.notifyObservers(Y),A(Y),this.logClose(),Promise.all(E).then((()=>Y))}_loadAnimationsAsync(){const V=this._gltf.animations;if(!V)return Promise.resolve();const I=new Array;for(let A=0;A<V.length;A++){const B=V[A];I.push(this.loadAnimationAsync(`/animations/${B.index}`,B).then((V=>{0===V.targetedAnimations.length&&V.dispose()})))}return Promise.all(I).then((()=>{}))}loadAnimationAsync(V,I){const B=this._extensionsLoadAnimationAsync(V,I);return B||A.e(78).then(A.bind(A,14303)).then((A=>{let{AnimationGroup:B}=A;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new B(I.name||`animation${I.index}`,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._babylonAnimationGroup=F;const E=new Array;K.Assign(I.channels),K.Assign(I.samplers);for(const Y of I.channels)E.push(this._loadAnimationChannelAsync(`${V}/channels/${Y.index}`,V,I,Y,((V,I)=>{V.animations=V.animations||[],V.animations.push(I),F.addTargetedAnimation(I,V)})));return Promise.all(E).then((()=>(F.normalize(0),F)))}))}async _loadAnimationChannelAsync(V,I,B,F,E){const Y=this._extensionsLoadAnimationChannelAsync(V,I,B,F,E);if(Y)return await Y;if(void 0==F.target.node)return await Promise.resolve();const H=K.Get(`${V}/target/node`,this._gltf.nodes,F.target.node),c=F.target.path,b="weights"===c;if(b&&!H._numMorphTargets||!b&&!H._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!b&&!H._isJoint)return await Promise.resolve();let X;switch(await Promise.resolve().then(A.bind(A,12918)),c){case"translation":var P;X=null===(P=(0,y.e)("/nodes/{}/translation"))||void 0===P?void 0:P.interpolation;break;case"rotation":var J;X=null===(J=(0,y.e)("/nodes/{}/rotation"))||void 0===J?void 0:J.interpolation;break;case"scale":var G;X=null===(G=(0,y.e)("/nodes/{}/scale"))||void 0===G?void 0:G.interpolation;break;case"weights":var w;X=null===(w=(0,y.e)("/nodes/{}/weights"))||void 0===w?void 0:w.interpolation;break;default:throw new Error(`${V}/target/path: Invalid value (${F.target.path})`)}if(!X)throw new Error(`${V}/target/path: Could not find interpolation properties for target path (${F.target.path})`);const t={object:H,info:X};return await this._loadAnimationChannelFromTargetInfoAsync(V,I,B,F,t,E)}_loadAnimationChannelFromTargetInfoAsync(V,I,A,B,F,E){const Y=this.parent.targetFps,H=1/Y,c=K.Get(`${V}/sampler`,A.samplers,B.sampler);return this._loadAnimationSamplerAsync(`${I}/samplers/${B.sampler}`,c).then((V=>{let I=0;const c=F.object,b=F.info;for(const F of b){const b=F.getStride(c),X=V.input,P=V.output,J=new Array(X.length);let G=0;switch(V.interpolation){case"STEP":for(let V=0;V<X.length;V++){const I=F.getValue(c,P,G,1);G+=b,J[V]={frame:X[V]*Y,value:I,interpolation:1}}break;case"CUBICSPLINE":for(let V=0;V<X.length;V++){const I=F.getValue(c,P,G,H);G+=b;const A=F.getValue(c,P,G,1);G+=b;const B=F.getValue(c,P,G,H);G+=b,J[V]={frame:X[V]*Y,inTangent:I,value:A,outTangent:B}}break;case"LINEAR":for(let V=0;V<X.length;V++){const I=F.getValue(c,P,G,1);G+=b,J[V]={frame:X[V]*Y,value:I}}}if(G>0){const V=`${A.name||`animation${A.index}`}_channel${B.index}_${I}`,H=F.buildAnimations(c,V,Y,J);for(const A of H)I++,E(A.babylonAnimatable,A.babylonAnimation)}}}))}_loadAnimationSamplerAsync(V,I){if(I._data)return I._data;const A=I.interpolation||"LINEAR";switch(A){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${V}/interpolation: Invalid value (${I.interpolation})`)}const B=K.Get(`${V}/input`,this._gltf.accessors,I.input),F=K.Get(`${V}/output`,this._gltf.accessors,I.output);return I._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${B.index}`,B),this._loadFloatAccessorAsync(`/accessors/${F.index}`,F)]).then((V=>{let[I,B]=V;return{input:I,interpolation:A,output:B}})),I._data}loadBufferAsync(V,I,A,B){const F=this._extensionsLoadBufferAsync(V,I,A,B);if(F)return F;if(!I._data)if(I.uri)I._data=this.loadUriAsync(`${V}/uri`,I,I.uri);else{if(!this._bin)throw new Error(`${V}: Uri is missing or the binary glTF is missing its binary chunk`);I._data=this._bin.readAsync(0,I.byteLength)}return I._data.then((I=>{try{return new Uint8Array(I.buffer,I.byteOffset+A,B)}catch(F){throw new Error(`${V}: ${F.message}`)}}))}loadBufferViewAsync(V,I){const A=this._extensionsLoadBufferViewAsync(V,I);if(A)return A;if(I._data)return I._data;const B=K.Get(`${V}/buffer`,this._gltf.buffers,I.buffer);return I._data=this.loadBufferAsync(`/buffers/${B.index}`,B,I.byteOffset||0,I.byteLength),I._data}_loadAccessorAsync(V,I,A){if(I._data)return I._data;const B=j._GetNumComponents(V,I.type),F=B*m.g.GetTypeByteLength(I.componentType),E=B*I.count;if(void 0==I.bufferView)I._data=Promise.resolve(new A(E));else{const Y=K.Get(`${V}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((H=>{if(5126!==I.componentType||I.normalized||Y.byteStride&&Y.byteStride!==F){const V=new A(E);return m.g.ForEach(H,I.byteOffset||0,Y.byteStride||F,B,I.componentType,V.length,I.normalized||!1,((I,A)=>{V[A]=I})),V}return j._GetTypedArray(V,I.componentType,H,I.byteOffset,E)}))}if(I.sparse){const E=I.sparse;I._data=I._data.then((Y=>{const H=Y,c=K.Get(`${V}/sparse/indices/bufferView`,this._gltf.bufferViews,E.indices.bufferView),b=K.Get(`${V}/sparse/values/bufferView`,this._gltf.bufferViews,E.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${c.index}`,c),this.loadBufferViewAsync(`/bufferViews/${b.index}`,b)]).then((Y=>{let[c,b]=Y;const X=j._GetTypedArray(`${V}/sparse/indices`,E.indices.componentType,c,E.indices.byteOffset,E.count),P=B*E.count;let J;if(5126!==I.componentType||I.normalized){const Y=j._GetTypedArray(`${V}/sparse/values`,I.componentType,b,E.values.byteOffset,P);J=new A(P),m.g.ForEach(Y,0,F,B,I.componentType,J.length,I.normalized||!1,((V,I)=>{J[I]=V}))}else J=j._GetTypedArray(`${V}/sparse/values`,I.componentType,b,E.values.byteOffset,P);let G=0;for(let V=0;V<X.length;V++){let I=X[V]*B;for(let V=0;V<B;V++)H[I++]=J[G++]}return H}))}))}return I._data}_loadFloatAccessorAsync(V,I){return this._loadAccessorAsync(V,I,Float32Array)}_loadIndicesAccessorAsync(V,I){if("SCALAR"!==I.type)throw new Error(`${V}/type: Invalid value ${I.type}`);if(5121!==I.componentType&&5123!==I.componentType&&5125!==I.componentType)throw new Error(`${V}/componentType: Invalid value ${I.componentType}`);if(I._data)return I._data;if(I.sparse){const A=j._GetTypedArrayConstructor(`${V}/componentType`,I.componentType);I._data=this._loadAccessorAsync(V,I,A)}else{const A=K.Get(`${V}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A).then((A=>j._GetTypedArray(V,I.componentType,A,I.byteOffset,I.count)))}return I._data}_loadVertexBufferViewAsync(V){if(V._babylonBuffer)return V._babylonBuffer;const I=this._babylonScene.getEngine();return V._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((V=>new m.d(I,V,!1))),V._babylonBuffer}_loadVertexAccessorAsync(V,I,A){var B;if(null!==(B=I._babylonVertexBuffer)&&void 0!==B&&B[A])return I._babylonVertexBuffer[A];I._babylonVertexBuffer||(I._babylonVertexBuffer={});const F=this._babylonScene.getEngine();if(I.sparse||void 0==I.bufferView)I._babylonVertexBuffer[A]=this._loadFloatAccessorAsync(V,I).then((V=>new m.g(F,V,A,!1)));else{const B=K.Get(`${V}/bufferView`,this._gltf.bufferViews,I.bufferView);I._babylonVertexBuffer[A]=this._loadVertexBufferViewAsync(B).then((E=>{const Y=j._GetNumComponents(V,I.type);return new m.g(F,E,A,!1,void 0,B.byteStride,void 0,I.byteOffset,Y,I.componentType,I.normalized,!0,void 0,!0)}))}return I._babylonVertexBuffer[A]}_loadMaterialMetallicRoughnessPropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const B=new Array;return I&&(I.baseColorFactor?(A.albedoColor=E.oI.LI(I.baseColorFactor),A.alpha=I.baseColorFactor[3]):A.albedoColor=E.oI.White(),A.metallic=void 0==I.metallicFactor?1:I.metallicFactor,A.roughness=void 0==I.roughnessFactor?1:I.roughnessFactor,I.baseColorTexture&&B.push(this.loadTextureInfoAsync(`${V}/baseColorTexture`,I.baseColorTexture,(V=>{V.name=`${A.name} (Base Color)`,A.albedoTexture=V}))),I.metallicRoughnessTexture&&(I.metallicRoughnessTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${V}/metallicRoughnessTexture`,I.metallicRoughnessTexture,(V=>{V.name=`${A.name} (Metallic Roughness)`,A.metallicTexture=V}))),A.useMetallnessFromMetallicTextureBlue=!0,A.useRoughnessFromMetallicTextureGreen=!0,A.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(B).then((()=>{}))}_loadMaterialAsync(V,I,A,B){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const E=this._extensionsLoadMaterialAsync(V,I,A,B,F);if(E)return E;I._data=I._data||{};let Y=I._data[B];if(!Y){this.logOpen(`${V} ${I.name||""}`);const A=this.createMaterial(V,I,B);Y={babylonMaterial:A,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(V,I,A)},I._data[B]=Y,j.AddPointerMetadata(A,V),this._parent.onMaterialLoadedObservable.notifyObservers(A),this.logClose()}return A&&(Y.babylonMeshes.push(A),A.aY.addOnce((()=>{const V=Y.babylonMeshes.indexOf(A);-1!==V&&Y.babylonMeshes.splice(V,1)}))),F(Y.babylonMaterial),Y.promise.then((()=>Y.babylonMaterial))}_createDefaultMaterial(V,I){this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new o.b(V,this._babylonScene);return A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.fillMode=I,A.enableSpecularAntiAliasing=!0,A.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,A.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,A.transparencyMode=o.b.PBRMATERIAL_OPAQUE,A.metallic=1,A.roughness=1,A}createMaterial(V,I,A){const B=this._extensionsCreateMaterial(V,I,A);if(B)return B;const F=I.name||`material${I.index}`;return this._createDefaultMaterial(F,A)}loadMaterialPropertiesAsync(V,I,A){const B=this._extensionsLoadMaterialPropertiesAsync(V,I,A);if(B)return B;const F=new Array;return F.push(this.loadMaterialBasePropertiesAsync(V,I,A)),I.pbrMetallicRoughness&&F.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${V}/pbrMetallicRoughness`,I.pbrMetallicRoughness,A)),this.loadMaterialAlphaProperties(V,I,A),Promise.all(F).then((()=>{}))}loadMaterialBasePropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const B=new Array;return A.emissiveColor=I.emissiveFactor?E.oI.LI(I.emissiveFactor):new E.oI(0,0,0),I.doubleSided&&(A.bH=!1,A.twoSidedLighting=!0),I.normalTexture&&(I.normalTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${V}/normalTexture`,I.normalTexture,(V=>{V.name=`${A.name} (Normal)`,A.bumpTexture=V}))),A.invertNormalMapX=!this._babylonScene.useRightHandedSystem,A.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=I.normalTexture.scale&&A.bumpTexture&&(A.bumpTexture.level=I.normalTexture.scale),A.forceIrradianceInFragment=!0),I.occlusionTexture&&(I.occlusionTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${V}/occlusionTexture`,I.occlusionTexture,(V=>{V.name=`${A.name} (Occlusion)`,A.ambientTexture=V}))),A.useAmbientInGrayScale=!0,void 0!=I.occlusionTexture.strength&&(A.ambientTextureStrength=I.occlusionTexture.strength)),I.emissiveTexture&&B.push(this.loadTextureInfoAsync(`${V}/emissiveTexture`,I.emissiveTexture,(V=>{V.name=`${A.name} (Emissive)`,A.emissiveTexture=V}))),Promise.all(B).then((()=>{}))}loadMaterialAlphaProperties(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);switch(I.alphaMode||"OPAQUE"){case"OPAQUE":A.transparencyMode=o.b.PBRMATERIAL_OPAQUE,A.alpha=1;break;case"MASK":A.transparencyMode=o.b.PBRMATERIAL_ALPHATEST,A.alphaCutOff=void 0==I.alphaCutoff?.5:I.alphaCutoff,A.albedoTexture&&(A.albedoTexture.BH=!0);break;case"BLEND":A.transparencyMode=o.b.PBRMATERIAL_ALPHABLEND,A.albedoTexture&&(A.albedoTexture.BH=!0,A.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${V}/alphaMode: Invalid value (${I.alphaMode})`)}}loadTextureInfoAsync(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadTextureInfoAsync(V,I,A);if(B)return B;if(this.logOpen(`${V}`),I.texCoord>=6)throw new Error(`${V}/texCoord: Invalid value (${I.texCoord})`);const F=K.Get(`${V}/index`,this._gltf.textures,I.index);F._textureInfo=I;const E=this._loadTextureAsync(`/textures/${I.index}`,F,(B=>{B.coordinatesIndex=I.texCoord||0,j.AddPointerMetadata(B,V),this._parent.onTextureLoadedObservable.notifyObservers(B),A(B)}));return this.logClose(),E}_loadTextureAsync(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadTextureAsync(V,I,A);if(B)return B;this.logOpen(`${V} ${I.name||""}`);const F=void 0==I.sampler?j.DefaultSampler:K.Get(`${V}/sampler`,this._gltf.samplers,I.sampler),E=K.Get(`${V}/source`,this._gltf.images,I.source),Y=this._createTextureAsync(V,F,E,A,void 0,!I._textureInfo.nonColorData);return this.logClose(),Y}_createTextureAsync(V,I,A){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},E=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0;const H=this._loadSampler(`/samplers/${I.index}`,I),c=new Array,b=new B;this._babylonScene._blockEntityCollection=!!this._assetContainer;const X={noMipmap:H.noMipMaps,invertY:!1,samplingMode:H.samplingMode,O:()=>{this._disposed||b.resolve()},onError:(I,A)=>{this._disposed||b.reject(new Error(`${V}: ${A&&A.message?A.message:I||"Failed to load texture"}`))},mimeType:A.mimeType??(0,f.j)(A.uri??""),loaderOptions:E,useSRGBBuffer:!!Y&&this._parent.useSRGBBuffers},P=new L.e(null,this._babylonScene,X);return P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.push(b.promise),c.push(this.loadImageAsync(`/images/${A.index}`,A).then((V=>{const I=A.uri||`${this._fileName}#image${A.index}`,B=`data:${this._uniqueRootUrl}${I}`;P.updateURL(B,V);const F=P.getInternalTexture();F&&(F.label=A.name)}))),P.wrapU=H.wrapU,P.wrapV=H.wrapV,F(P),this._parent.useGltfTextureNames&&(P.name=A.name||A.uri||`image${A.index}`),Promise.all(c).then((()=>P))}_loadSampler(V,I){return I._data||(I._data={noMipMaps:9728===I.minFilter||9729===I.minFilter,samplingMode:j._GetTextureSamplingMode(V,I),wrapU:j._GetTextureWrapMode(`${V}/wrapS`,I.wrapS),wrapV:j._GetTextureWrapMode(`${V}/wrapT`,I.wrapT)}),I._data}loadImageAsync(V,I){if(!I._data){if(this.logOpen(`${V} ${I.name||""}`),I.uri)I._data=this.loadUriAsync(`${V}/uri`,I,I.uri);else{const A=K.Get(`${V}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}this.logClose()}return I._data}loadUriAsync(V,I,A){const B=this._extensionsLoadUriAsync(V,I,A);if(B)return B;if(!j._ValidateUri(A))throw new Error(`${V}: '${A}' is invalid`);if((0,f.k)(A)){const I=new Uint8Array((0,f.c)(A));return this.log(`${V}: Decoded ${A.substring(0,64)}... (${I.length} bytes)`),Promise.resolve(I)}return this.log(`${V}: Loading ${A}`),this._parent.preprocessUrlAsync(this._rootUrl+A).then((I=>new Promise(((B,F)=>{this._parent._loadFile(this._babylonScene,I,(I=>{this._disposed||(this.log(`${V}: Loaded ${A} (${I.byteLength} bytes)`),B(new Uint8Array(I)))}),!0,(I=>{F(new f.o(`${V}: Failed to load '${A}'${I?": "+I.status+" "+I.statusText:""}`,I))}))}))))}static AddPointerMetadata(V,I){V.metadata=V.metadata||{};const A=V._internalMetadata=V._internalMetadata||{},B=A.nY=A.nY||{};(B.pointers=B.pointers||[]).push(I)}static _GetTextureWrapMode(V,I){switch(I=void 0==I?10497:I){case 33071:return L.e.CLAMP_ADDRESSMODE;case 33648:return L.e.MIRROR_ADDRESSMODE;case 10497:return L.e.WRAP_ADDRESSMODE;default:return t.b.Warn(`${V}: Invalid value (${I})`),L.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(V,I){const A=void 0==I.magFilter?9729:I.magFilter,B=void 0==I.minFilter?9987:I.minFilter;if(9729===A)switch(B){case 9728:return L.e.LINEAR_NEAREST;case 9729:return L.e.LINEAR_LINEAR;case 9984:return L.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return L.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return L.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return L.e.LINEAR_LINEAR_MIPLINEAR;default:return t.b.Warn(`${V}/minFilter: Invalid value (${B})`),L.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==A&&t.b.Warn(`${V}/magFilter: Invalid value (${A})`),B){case 9728:return L.e.NEAREST_NEAREST;case 9729:return L.e.NEAREST_LINEAR;case 9984:return L.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return L.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return L.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return L.e.NEAREST_LINEAR_MIPLINEAR;default:return t.b.Warn(`${V}/minFilter: Invalid value (${B})`),L.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(V,I){try{return(0,C.p)(I)}catch(A){throw new Error(`${V}: ${A.message}`)}}static _GetTypedArray(V,I,A,B,F){const E=A.buffer;B=A.byteOffset+(B||0);const Y=j._GetTypedArrayConstructor(`${V}/componentType`,I),H=m.g.GetTypeByteLength(I);return B%H!==0?(t.b.Warn(`${V}: Copying buffer as byte offset (${B}) is not a multiple of component type byte length (${H})`),new Y(E.slice(B,B+F*H),0)):new Y(E,B,F)}static _GetNumComponents(V,I){switch(I){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${V}: Invalid type (${I})`)}static _ValidateUri(V){return Y.Tools.IsBase64(V)||-1===V.indexOf("..")}static _GetDrawMode(V,I){switch(void 0==I&&(I=4),I){case 0:return g.c.PointListDrawMode;case 1:return g.c.LineListDrawMode;case 2:return g.c.LineLoopDrawMode;case 3:return g.c.LineStripDrawMode;case 4:return g.c.TriangleFillMode;case 5:return g.c.TriangleStripDrawMode;case 6:return g.c.TriangleFanDrawMode}throw new Error(`${V}: Invalid mesh primitive mode (${I})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const V=new Array;if(this._gltf.materials)for(const I of this._gltf.materials)if(I._data)for(const A in I._data){const B=I._data[A];for(const I of B.babylonMeshes){I.YH(!0);const A=B.babylonMaterial;V.push(A.forceCompilationAsync(I)),V.push(A.forceCompilationAsync(I,{useInstances:!0})),this._parent.useClipPlane&&(V.push(A.forceCompilationAsync(I,{clipPlane:!0})),V.push(A.forceCompilationAsync(I,{clipPlane:!0,useInstances:!0})))}}return Promise.all(V).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const V=new Array,I=this._babylonScene.lights;for(const A of I){const I=A.getShadowGenerator();I&&V.push(I.forceCompilationAsync())}return Promise.all(V).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(V){for(const I of this._extensions)I.enabled&&V(I)}_applyExtensions(V,I,A){for(const B of this._extensions)if(B.enabled){const F=`${B.name}.${I}`,E=V;E._activeLoaderExtensionFunctions=E._activeLoaderExtensionFunctions||{};const Y=E._activeLoaderExtensionFunctions;if(!Y[F]){Y[F]=!0;try{const V=A(B);if(V)return V}finally{delete Y[F]}}}return null}_extensionsOnLoading(){this._forEachExtensions((V=>V.onLoading&&V.onLoading()))}_extensionsOnReady(){this._forEachExtensions((V=>V.onReady&&V.onReady()))}_extensionsLoadSceneAsync(V,I){return this._applyExtensions(I,"loadScene",(A=>A.loadSceneAsync&&A.loadSceneAsync(V,I)))}_extensionsLoadNodeAsync(V,I,A){return this._applyExtensions(I,"loadNode",(B=>B.loadNodeAsync&&B.loadNodeAsync(V,I,A)))}_extensionsLoadCameraAsync(V,I,A){return this._applyExtensions(I,"loadCamera",(B=>B.loadCameraAsync&&B.loadCameraAsync(V,I,A)))}_extensionsLoadVertexDataAsync(V,I,A){return this._applyExtensions(I,"loadVertexData",(B=>B._loadVertexDataAsync&&B._loadVertexDataAsync(V,I,A)))}_extensionsLoadMeshPrimitiveAsync(V,I,A,B,F,E){return this._applyExtensions(F,"loadMeshPrimitive",(Y=>Y._loadMeshPrimitiveAsync&&Y._loadMeshPrimitiveAsync(V,I,A,B,F,E)))}_extensionsLoadMaterialAsync(V,I,A,B,F){return this._applyExtensions(I,"loadMaterial",(E=>E._loadMaterialAsync&&E._loadMaterialAsync(V,I,A,B,F)))}_extensionsCreateMaterial(V,I,A){return this._applyExtensions(I,"createMaterial",(B=>B.createMaterial&&B.createMaterial(V,I,A)))}_extensionsLoadMaterialPropertiesAsync(V,I,A){return this._applyExtensions(I,"loadMaterialProperties",(B=>B.loadMaterialPropertiesAsync&&B.loadMaterialPropertiesAsync(V,I,A)))}_extensionsLoadTextureInfoAsync(V,I,A){return this._applyExtensions(I,"loadTextureInfo",(B=>B.loadTextureInfoAsync&&B.loadTextureInfoAsync(V,I,A)))}_extensionsLoadTextureAsync(V,I,A){return this._applyExtensions(I,"loadTexture",(B=>B._loadTextureAsync&&B._loadTextureAsync(V,I,A)))}_extensionsLoadAnimationAsync(V,I){return this._applyExtensions(I,"loadAnimation",(A=>A.loadAnimationAsync&&A.loadAnimationAsync(V,I)))}_extensionsLoadAnimationChannelAsync(V,I,A,B,F){return this._applyExtensions(A,"loadAnimationChannel",(E=>E._loadAnimationChannelAsync&&E._loadAnimationChannelAsync(V,I,A,B,F)))}_extensionsLoadSkinAsync(V,I,A){return this._applyExtensions(A,"loadSkin",(B=>B._loadSkinAsync&&B._loadSkinAsync(V,I,A)))}_extensionsLoadUriAsync(V,I,A){return this._applyExtensions(I,"loadUri",(B=>B._loadUriAsync&&B._loadUriAsync(V,I,A)))}_extensionsLoadBufferViewAsync(V,I){return this._applyExtensions(I,"loadBufferView",(A=>A.loadBufferViewAsync&&A.loadBufferViewAsync(V,I)))}_extensionsLoadBufferAsync(V,I,A,B){return this._applyExtensions(I,"loadBuffer",(F=>F.loadBufferAsync&&F.loadBufferAsync(V,I,A,B)))}static LoadExtensionAsync(V,I,A,B){if(!I.extensions)return null;const F=I.extensions[A];return F?B(`${V}/extensions/${A}`,F):null}static LoadExtraAsync(V,I,A,B){if(!I.extras)return null;const F=I.extras[A];return F?B(`${V}/extras/${A}`,F):null}isExtensionUsed(V){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(V)}logOpen(V){this._parent._logOpen(V)}logClose(){this._parent._logClose()}log(V){this._parent._log(V)}startPerformanceCounter(V){this._parent._startPerformanceCounter(V)}endPerformanceCounter(V){this._parent._endPerformanceCounter(V)}}j.DefaultSampler={index:-1},x.e._CreateGLTF2Loader=V=>new j(V);var T=A(12918),d=A(11416),D=A(11265),O=A(12925),Z=A(12930);class a extends Z.b{constructor(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",V),this._texture=V.getEngine().createRawCubeTexture(I,A,B,F,E,Y,H,c)}update(V,I,A,B){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,V,I,A,B,F)}updateRGBDAsync(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,O.k)(this._texture,V,I,A,B).then((()=>{}))}clone(){return D.b.Clone((()=>{const V=this.sV(),I=this._texture,A=new a(V,I._bufferViewArray,I.width,I.format,I.type,I.generateMipMaps,I.invertY,I.samplingMode,I._compression);return 13===I.source&&A.updateRGBDAsync(I._bufferViewArrayArray,I._sphericalPolynomial,I._lodGenerationScale,I._lodGenerationOffset),A}),this)}}const k="EXT_lights_image_based";class U{constructor(V){this.name=k,this._loader=V,this.enabled=this._loader.isExtensionUsed(k)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.nY.extensions;if(V&&V[this.name]){const I=V[this.name];this._lights=I.lights}}loadSceneAsync(V,I){return j.LoadExtensionAsync(V,I,this.name,(async(A,B)=>{this._loader._allMaterialsDirtyRequired=!0;const F=new Array;F.push(this._loader.loadSceneAsync(V,I)),this._loader.logOpen(`${A}`);const E=K.Get(`${A}/light`,this._lights,B.dY);return F.push(this._loadLightAsync(`/extensions/${this.name}/lights/${B.dY}`,E).then((V=>{this._loader.babylonScene.environmentTexture=V}))),this._loader.logClose(),await Promise.all(F).then((()=>{}))}))}_loadLightAsync(V,I){if(!I._loaded){const A=new Array;this._loader.logOpen(`${V}`);const B=new Array(I.specularImages.length);for(let F=0;F<I.specularImages.length;F++){const E=I.specularImages[F];B[F]=new Array(E.length);for(let I=0;I<E.length;I++){const Y=`${V}/specularImages/${F}/${I}`;this._loader.logOpen(`${Y}`);const H=E[I],c=K.Get(Y,this._loader.nY.images,H);A.push(this._loader.loadImageAsync(`/images/${H}`,c).then((V=>{B[F][I]=V}))),this._loader.logClose()}}this._loader.logClose(),I._loaded=Promise.all(A).then((async()=>{const A=new a(this._loader.babylonScene,null,I.specularImageSize);if(A.name=I.name||"environment",I._babylonTexture=A,void 0!=I.uH&&(A.level=I.uH),I.rotation){let V=F.Quaternion.LI(I.rotation);this._loader.babylonScene.useRightHandedSystem||(V=F.Quaternion.Inverse(V)),F.Matrix.FromQuaternionToRef(V,A.getReflectionTextureMatrix())}if(!I.irradianceCoefficients)throw new Error(`${V}: Irradiance coefficients are missing`);const E=d.e.LI(I.irradianceCoefficients);E.scaleInPlace(I.uH),E.convertIrradianceToLambertianRadiance();const Y=d.h.FromHarmonics(E),H=(B.length-1)/Math.log2(I.specularImageSize);return await A.updateRGBDAsync(B,Y,H)}))}return I._loaded.then((()=>I._babylonTexture))}}i(k),l(k,!0,(V=>new U(V)));A(11823);const n="EXT_mesh_gpu_instancing";class VV{constructor(V){this.name=n,this._loader=V,this.enabled=this._loader.isExtensionUsed(n)}dispose(){this._loader=null}loadNodeAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(V,B)=>{this._loader._disableInstancedMesh++;const E=this._loader.loadNodeAsync(`/nodes/${I.index}`,I,A);if(this._loader._disableInstancedMesh--,!I._primitiveBabylonMeshes)return await E;const Y=new Array;let H=0;const c=I=>{if(void 0==B.attributes[I])return void Y.push(Promise.resolve(null));const A=K.Get(`${V}/attributes/${I}`,this._loader.nY.accessors,B.attributes[I]);if(Y.push(this._loader._loadFloatAccessorAsync(`/accessors/${A.bufferView}`,A)),0===H)H=A.count;else if(H!==A.count)throw new Error(`${V}/attributes: Instance buffer accessors do not have the same count.`)};return c("TRANSLATION"),c("ROTATION"),c("SCALE"),await E.then((async V=>{const[A,B,E]=await Promise.all(Y),c=new Float32Array(16*H);F.TmpVectors.tI[0].XH(0,0,0),F.TmpVectors.Quaternion[0].XH(0,0,0,1),F.TmpVectors.tI[1].XH(1,1,1);for(let I=0;I<H;++I)A&&F.tI.FromArrayToRef(A,3*I,F.TmpVectors.tI[0]),B&&F.Quaternion.FromArrayToRef(B,4*I,F.TmpVectors.Quaternion[0]),E&&F.tI.FromArrayToRef(E,3*I,F.TmpVectors.tI[1]),F.Matrix.ComposeToRef(F.TmpVectors.tI[1],F.TmpVectors.Quaternion[0],F.TmpVectors.tI[0],F.TmpVectors.Matrix[0]),F.TmpVectors.Matrix[0].copyToArray(c,16*I);for(const F of I._primitiveBabylonMeshes)F.xJ("matrix",c,16,!0);return V}))}))}}i(n),l(n,!0,(V=>new VV(V)));let IV=0,AV=null;class BV{static get Default(){return BV._Default||(BV._Default=new BV),BV._Default}constructor(){const V=BV.Configuration.decoder;this._decoderModulePromise=Y.Tools.LoadBabylonScriptAsync(V.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(V,I,A,B,F){await this._decoderModulePromise,0===IV&&(MeshoptDecoder.useWorkers(1),IV=1);const E=await MeshoptDecoder.decodeGltfBufferAsync(I,A,V,B,F);return null!==AV&&clearTimeout(AV),AV=setTimeout((()=>{MeshoptDecoder.useWorkers(0),IV=0,AV=null}),1e3),E}}BV.Configuration={decoder:{url:`${Y.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},BV._Default=null;const FV="EXT_meshopt_compression";class EV{constructor(V){this.name=FV,this.enabled=V.isExtensionUsed(FV),this._loader=V}dispose(){this._loader=null}loadBufferViewAsync(V,I){return j.LoadExtensionAsync(V,I,this.name,(async(A,B)=>{const F=I;if(F._meshOptData)return await F._meshOptData;const E=K.Get(`${V}/buffer`,this._loader.nY.buffers,B.buffer);return F._meshOptData=this._loader.loadBufferAsync(`/buffers/${E.index}`,E,B.byteOffset||0,B.byteLength).then((async V=>await BV.Default.decodeGltfBufferAsync(V,B.count,B.byteStride,B.mode,B.filter))),await F._meshOptData}))}}i(FV),l(FV,!0,(V=>new EV(V)));const YV="EXT_texture_webp";class HV{constructor(V){this.name=YV,this._loader=V,this.enabled=V.isExtensionUsed(YV)}dispose(){this._loader=null}_loadTextureAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=void 0==I.sampler?j.DefaultSampler:K.Get(`${V}/sampler`,this._loader.nY.samplers,I.sampler),Y=K.Get(`${B}/source`,this._loader.nY.images,F.source);return await this._loader._createTextureAsync(V,E,Y,(V=>{A(V)}),void 0,!I._textureInfo.nonColorData)}))}}i(YV),l(YV,!0,(V=>new HV(V)));const cV="EXT_texture_avif";class bV{constructor(V){this.name=cV,this._loader=V,this.enabled=V.isExtensionUsed(cV)}dispose(){this._loader=null}_loadTextureAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=void 0==I.sampler?j.DefaultSampler:K.Get(`${V}/sampler`,this._loader.nY.samplers,I.sampler),Y=K.Get(`${B}/source`,this._loader.nY.images,F.source);return await this._loader._createTextureAsync(V,E,Y,(V=>{A(V)}),void 0,!I._textureInfo.nonColorData)}))}}i(cV),l(cV,!0,(V=>new bV(V)));var XV=A(12910),PV=A(11803);const JV="EXT_lights_ies";class GV{constructor(V){this.name=JV,this._loader=V,this.enabled=this._loader.isExtensionUsed(JV)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.nY.extensions;if(V&&V[this.name]){const I=V[this.name];this._lights=I.lights,K.Assign(this._lights)}}loadNodeAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,Y)=>{let H,c;this._loader._allMaterialsDirtyRequired=!0;const b=await this._loader.loadNodeAsync(V,I,(V=>{c=K.Get(B,this._lights,Y.dY);const I=c.name||V.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,H=new XV.d(I,F.tI.Zero(),F.tI.Backward(),0,1,this._loader.babylonScene),H.angle=Math.PI/2,H.innerAngle=0,H._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,c._babylonLight=H,H.falloffType=PV.c.FALLOFF_GLTF,H.WH=Y.color?E.oI.LI(Y.color):E.oI.White(),H.uH=Y.multiplier||1,H.range=Number.MAX_VALUE,H.parent=V,this._loader._babylonLights.push(H),j.AddPointerMetadata(H,B),A(V)}));let X;if(c.uri)X=await this._loader.loadUriAsync(V,c,c.uri);else{const I=K.Get(`${V}/bufferView`,this._loader.nY.bufferViews,c.bufferView);X=await this._loader.loadBufferViewAsync(`/bufferViews/${I.index}`,I)}return H.iesProfileTexture=new L.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,X,!0,void 0,void 0,void 0,void 0,".ies"),b}))}}i(JV),l(JV,!0,(V=>new GV(V)));var wV=A(12935);const tV="KHR_draco_mesh_compression";class uV{constructor(V){this.name=tV,this.useNormalizedFlagFromAccessor=!0,this._loader=V,this.enabled=wV.d.DefaultAvailable&&this._loader.isExtensionUsed(tV)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{if(void 0!=I.mode&&4!==I.mode&&5!==I.mode)throw new Error(`${V}: Unsupported mode ${I.mode}`);const E={},Y={},H=(V,B)=>{const H=F.attributes[V];if(void 0!=H&&(A._delayInfo=A._delayInfo||[],-1===A._delayInfo.indexOf(B)&&A._delayInfo.push(B),E[B]=H,this.useNormalizedFlagFromAccessor)){const A=K.TryGet(this._loader.nY.accessors,I.attributes[V]);A&&(Y[B]=A.normalized||!1)}};H("POSITION",m.g.PositionKind),H("NORMAL",m.g.NormalKind),H("TANGENT",m.g.TangentKind),H("TEXCOORD_0",m.g.UVKind),H("TEXCOORD_1",m.g.UV2Kind),H("TEXCOORD_2",m.g.UV3Kind),H("TEXCOORD_3",m.g.UV4Kind),H("TEXCOORD_4",m.g.UV5Kind),H("TEXCOORD_5",m.g.UV6Kind),H("JOINTS_0",m.g.MatricesIndicesKind),H("WEIGHTS_0",m.g.MatricesWeightsKind),H("COLOR_0",m.g.ColorKind);const c=K.Get(B,this._loader.nY.bufferViews,F.bufferView);return c._dracoBabylonGeometry||(c._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c).then((async B=>{const F=this.dracoDecoder||wV.d.Default,H=K.TryGet(this._loader.nY.accessors,I.attributes.POSITION),c=this._loader.parent.alwaysComputeBoundingBox||A.skeleton||!H?null:p(H);return await F._decodeMeshToGeometryForGltfAsync(A.name,this._loader.babylonScene,B,E,Y,c).catch((I=>{throw new Error(`${V}: ${I.message}`)}))}))),await c._dracoBabylonGeometry}))}}i(tV),l(tV,!0,(V=>new uV(V)));var WV=A(12940),gV=A(11213),oV=A(11222),LV=A(11666),zV=A(11856),mV=A(11189);LV.b.AddNodeConstructor("Light_Type_0",((V,I)=>()=>new sV(V,F.tI.Zero(),I)));class sV extends zV.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(V){this._shadowAngle=V,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(V){const I=this.needCube();if(this._direction=V,this.needCube()!==I&&this._shadowGenerators){const V=this._shadowGenerators.values();for(let I=V.next();!0!==I.done;I=V.next()){I.value.recreateShadowMap()}}}constructor(V,I,A){super(V,A),this._shadowAngle=Math.PI/2,this.position=I}getClassName(){return"PointLight"}getTypeID(){return PV.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(V){if(this.direction)return super.getShadowDirection(V);switch(V){case 0:return new F.tI(1,0,0);case 1:return new F.tI(-1,0,0);case 2:return new F.tI(0,-1,0);case 3:return new F.tI(0,1,0);case 4:return new F.tI(0,0,1);case 5:return new F.tI(0,0,-1)}return F.tI.Zero()}_setDefaultShadowProjectionMatrix(V,I,A){const B=this.sV().activeCamera;if(!B)return;const E=void 0!==this.shadowMinZ?this.shadowMinZ:B.FH,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,H=this.sV().getEngine().useReverseDepthBuffer;F.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,H?Y:E,H?E:Y,V,!0,this._scene.getEngine().isNDCHalfZRange,void 0,H)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(V,I){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,I):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,I),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,I),this}transferToNodeMaterialEffect(V,I){return this.computeTransformedInformation()?V.setFloat3(I,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):V.setFloat3(I,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(V,I){V["POINTLIGHT"+I]=!0}}(0,gV.b)([(0,oV.A)()],sV.prototype,"shadowAngle",null),(0,mV.e)("BABYLON.PointLight",sV);const eV="KHR_lights_punctual";class SV{constructor(V){this.name=eV,this._loader=V,this.enabled=this._loader.isExtensionUsed(eV)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.nY.extensions;if(V&&V[this.name]){const I=V[this.name];this._lights=I.lights,K.Assign(this._lights)}}loadNodeAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,Y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(V,I,(V=>{let I;const H=K.Get(B,this._lights,Y.dY),c=H.name||V.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,H.type){case"directional":{const V=new WV.e(c,F.tI.Backward(),this._loader.babylonScene);V.position.JH(0),I=V;break}case"point":I=new sV(c,F.tI.Zero(),this._loader.babylonScene);break;case"spot":{const V=new XV.d(c,F.tI.Zero(),F.tI.Backward(),0,1,this._loader.babylonScene);V.angle=2*(H.spot&&H.spot.outerConeAngle||Math.PI/4),V.innerAngle=2*(H.spot&&H.spot.innerConeAngle||0),I=V;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${B}: Invalid light type (${H.type})`)}I._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,H._babylonLight=I,I.falloffType=PV.c.FALLOFF_GLTF,I.WH=H.color?E.oI.LI(H.color):E.oI.White(),I.uH=void 0==H.uH?1:H.uH,I.range=void 0==H.range?Number.MAX_VALUE:H.range,I.parent=V,this._loader._babylonLights.push(I),j.AddPointerMetadata(I,B),A(V)})))))}}i(eV),l(eV,!0,(V=>new SV(V)));const QV="KHR_materials_pbrSpecularGlossiness";class hV{constructor(V){this.name=QV,this.order=200,this._loader=V,this.enabled=this._loader.isExtensionUsed(QV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;return E.push(this._loader.loadMaterialBasePropertiesAsync(V,I,A)),E.push(this._loadSpecularGlossinessPropertiesAsync(B,F,A)),this._loader.loadMaterialAlphaProperties(V,I,A),await Promise.all(E).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const B=new Array;return A.metallic=null,A.roughness=null,I.diffuseFactor?(A.albedoColor=E.oI.LI(I.diffuseFactor),A.alpha=I.diffuseFactor[3]):A.albedoColor=E.oI.White(),A.reflectivityColor=I.specularFactor?E.oI.LI(I.specularFactor):E.oI.White(),A.microSurface=void 0==I.glossinessFactor?1:I.glossinessFactor,I.diffuseTexture&&B.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTexture`,I.diffuseTexture,(V=>{V.name=`${A.name} (Diffuse)`,A.albedoTexture=V}))),I.specularGlossinessTexture&&(B.push(this._loader.loadTextureInfoAsync(`${V}/specularGlossinessTexture`,I.specularGlossinessTexture,(V=>{V.name=`${A.name} (Specular Glossiness)`,A.reflectivityTexture=V,A.reflectivityTexture.BH=!0}))),A.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(B).then((()=>{}))}}i(QV),l(QV,!0,(V=>new hV(V)));const rV="KHR_materials_unlit";class MV{constructor(V){this.name=rV,this.order=210,this._loader=V,this.enabled=this._loader.isExtensionUsed(rV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async()=>await this._loadUnlitPropertiesAsync(V,I,A)))}_loadUnlitPropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const B=new Array;A.unlit=!0;const F=I.pbrMetallicRoughness;return F&&(F.baseColorFactor?(A.albedoColor=E.oI.LI(F.baseColorFactor),A.alpha=F.baseColorFactor[3]):A.albedoColor=E.oI.White(),F.baseColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${V}/baseColorTexture`,F.baseColorTexture,(V=>{V.name=`${A.name} (Base Color)`,A.albedoTexture=V})))),I.doubleSided&&(A.bH=!1,A.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(V,I,A),Promise.all(B).then((()=>{}))}}i(rV),l(rV,!0,(V=>new MV(V)));const xV="KHR_materials_clearcoat";class fV{constructor(V){this.name=xV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(xV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadClearCoatPropertiesAsync(B,F,A)),await Promise.all(E)}))}_loadClearCoatPropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const B=new Array;return A.clearCoat.isEnabled=!0,A.clearCoat.useRoughnessFromMainTexture=!1,A.clearCoat.remapF0OnInterfaceChange=!1,void 0!=I.clearcoatFactor?A.clearCoat.uH=I.clearcoatFactor:A.clearCoat.uH=0,I.clearcoatTexture&&B.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatTexture`,I.clearcoatTexture,(V=>{V.name=`${A.name} (ClearCoat)`,A.clearCoat.texture=V}))),void 0!=I.clearcoatRoughnessFactor?A.clearCoat.roughness=I.clearcoatRoughnessFactor:A.clearCoat.roughness=0,I.clearcoatRoughnessTexture&&(I.clearcoatRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatRoughnessTexture`,I.clearcoatRoughnessTexture,(V=>{V.name=`${A.name} (ClearCoat Roughness)`,A.clearCoat.textureRoughness=V})))),I.clearcoatNormalTexture&&(I.clearcoatNormalTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatNormalTexture`,I.clearcoatNormalTexture,(V=>{V.name=`${A.name} (ClearCoat Normal)`,A.clearCoat.bumpTexture=V}))),A.invertNormalMapX=!A.sV().useRightHandedSystem,A.invertNormalMapY=A.sV().useRightHandedSystem,void 0!=I.clearcoatNormalTexture.scale&&(A.clearCoat.bumpTexture.level=I.clearcoatNormalTexture.scale)),Promise.all(B).then((()=>{}))}}i(xV),l(xV,!0,(V=>new fV(V)));const RV="KHR_materials_iridescence";class qV{constructor(V){this.name=RV,this.order=195,this._loader=V,this.enabled=this._loader.isExtensionUsed(RV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadIridescencePropertiesAsync(B,F,A)),await Promise.all(E).then((()=>{}))}))}_loadIridescencePropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const B=new Array;return A.iridescence.isEnabled=!0,A.iridescence.uH=I.iridescenceFactor??0,A.iridescence.indexOfRefraction=I.iridescenceIor??I.iridescenceIOR??1.3,A.iridescence.minimumThickness=I.iridescenceThicknessMinimum??100,A.iridescence.maximumThickness=I.iridescenceThicknessMaximum??400,I.iridescenceTexture&&B.push(this._loader.loadTextureInfoAsync(`${V}/iridescenceTexture`,I.iridescenceTexture,(V=>{V.name=`${A.name} (Iridescence)`,A.iridescence.texture=V}))),I.iridescenceThicknessTexture&&B.push(this._loader.loadTextureInfoAsync(`${V}/iridescenceThicknessTexture`,I.iridescenceThicknessTexture,(V=>{V.name=`${A.name} (Iridescence Thickness)`,A.iridescence.thicknessTexture=V}))),Promise.all(B).then((()=>{}))}}i(RV),l(RV,!0,(V=>new qV(V)));const NV="KHR_materials_anisotropy";class lV{constructor(V){this.name=NV,this.order=195,this._loader=V,this.enabled=this._loader.isExtensionUsed(NV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadIridescencePropertiesAsync(B,F,A)),await Promise.all(E)}))}async _loadIridescencePropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const B=new Array;A.anisotropy.isEnabled=!0,A.anisotropy.uH=I.anisotropyStrength??0,A.anisotropy.angle=I.anisotropyRotation??0,I.anisotropyTexture&&(I.anisotropyTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${V}/anisotropyTexture`,I.anisotropyTexture,(V=>{V.name=`${A.name} (Anisotropy Intensity)`,A.anisotropy.texture=V})))),await Promise.all(B)}}i(NV),l(NV,!0,(V=>new lV(V)));const iV="KHR_materials_emissive_strength";class yV{constructor(V){this.name=iV,this.order=170,this._loader=V,this.enabled=this._loader.isExtensionUsed(iV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>await this._loader.loadMaterialPropertiesAsync(V,I,A).then((()=>{this._loadEmissiveProperties(B,F,A)}))))}_loadEmissiveProperties(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);void 0!==I.emissiveStrength&&(A.emissiveIntensity=I.emissiveStrength)}}i(iV),l(iV,!0,(V=>new yV(V)));const vV="KHR_materials_sheen";class CV{constructor(V){this.name=vV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(vV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadSheenPropertiesAsync(B,F,A)),await Promise.all(E).then((()=>{}))}))}_loadSheenPropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const B=new Array;return A.sheen.isEnabled=!0,A.sheen.uH=1,void 0!=I.sheenColorFactor?A.sheen.color=E.oI.LI(I.sheenColorFactor):A.sheen.color=E.oI.Black(),I.sheenColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${V}/sheenColorTexture`,I.sheenColorTexture,(V=>{V.name=`${A.name} (Sheen Color)`,A.sheen.texture=V}))),void 0!==I.sheenRoughnessFactor?A.sheen.roughness=I.sheenRoughnessFactor:A.sheen.roughness=0,I.sheenRoughnessTexture&&(I.sheenRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${V}/sheenRoughnessTexture`,I.sheenRoughnessTexture,(V=>{V.name=`${A.name} (Sheen Roughness)`,A.sheen.textureRoughness=V})))),A.sheen.albedoScaling=!0,A.sheen.useRoughnessFromMainTexture=!1,Promise.all(B).then((()=>{}))}}i(vV),l(vV,!0,(V=>new CV(V)));var KV=A(11738);const pV="KHR_materials_specular";class jV{constructor(V){this.name=pV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(pV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;if(E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadSpecularPropertiesAsync(B,F,A)),F.extensions&&F.extensions.EXT_materials_specular_edge_color&&A instanceof o.b){F.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(A.brdf.dielectricSpecularModel=KV.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,A.brdf.conductorSpecularModel=KV.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(E).then((()=>{}))}))}_loadSpecularPropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const B=new Array;return void 0!==I.specularFactor&&(A.metallicF0Factor=I.specularFactor),void 0!==I.specularColorFactor&&(A.metallicReflectanceColor=E.oI.LI(I.specularColorFactor)),I.specularTexture&&(I.specularTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${V}/specularTexture`,I.specularTexture,(V=>{V.name=`${A.name} (Specular)`,A.metallicReflectanceTexture=V,A.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),I.specularColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${V}/specularColorTexture`,I.specularColorTexture,(V=>{V.name=`${A.name} (Specular Color)`,A.reflectanceTexture=V}))),Promise.all(B).then((()=>{}))}}i(pV),l(pV,!0,(V=>new jV(V)));const TV="KHR_materials_ior";class dV{constructor(V){this.name=TV,this.order=180,this._loader=V,this.enabled=this._loader.isExtensionUsed(TV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadIorPropertiesAsync(B,F,A)),await Promise.all(E).then((()=>{}))}))}_loadIorPropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);return void 0!==I.ior?A.indexOfRefraction=I.ior:A.indexOfRefraction=dV._DEFAULT_IOR,Promise.resolve()}}dV._DEFAULT_IOR=1.5,i(TV),l(TV,!0,(V=>new dV(V)));const DV="KHR_materials_variants";class OV{constructor(V){this.name=DV,this._loader=V,this.enabled=this._loader.isExtensionUsed(DV)}dispose(){this._loader=null}static GetAvailableVariants(V){const I=this._GetExtensionMetadata(V);return I?Object.keys(I.variants):[]}getAvailableVariants(V){return OV.GetAvailableVariants(V)}static SelectVariant(V,I){const A=this._GetExtensionMetadata(V);if(!A)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${DV} extension`);const B=V=>{const I=A.variants[V];if(I)for(const A of I)A.mesh.material=A.material};if(I instanceof Array)for(const F of I)B(F);else B(I);A.lastSelected=I}selectVariant(V,I){OV.SelectVariant(V,I)}static Reset(V){const I=this._GetExtensionMetadata(V);if(!I)throw new Error(`Cannot reset on a glTF mesh that does not have the ${DV} extension`);for(const A of I.original)A.mesh.material=A.material;I.lastSelected=null}reset(V){OV.Reset(V)}static GetLastSelectedVariant(V){const I=this._GetExtensionMetadata(V);if(!I)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${DV} extension`);return I.lastSelected}getLastSelectedVariant(V){return OV.GetLastSelectedVariant(V)}static _GetExtensionMetadata(V){var I,A;return(null===V||void 0===V||null===(I=V._internalMetadata)||void 0===I||null===(A=I.nY)||void 0===A?void 0:A[DV])||null}onLoading(){const V=this._loader.nY.extensions;if(V&&V[this.name]){const I=V[this.name];this._variants=I.variants}}onReady(){const V=this._loader.rootBabylonMesh;if(V){var I;const A=this._loader.parent.extensionOptions[DV];null!==A&&void 0!==A&&A.defaultVariant&&OV.SelectVariant(V,A.defaultVariant),null===A||void 0===A||null===(I=A.onLoaded)||void 0===I||I.call(A,{get variants(){return OV.GetAvailableVariants(V)},get selectedVariant(){const I=OV.GetLastSelectedVariant(V);return I?Array.isArray(I)?I[0]:I:OV.GetAvailableVariants(V)[0]},set selectedVariant(I){OV.SelectVariant(V,I)}})}}_loadMeshPrimitiveAsync(V,I,A,B,F,E){return j.LoadExtensionAsync(V,F,this.name,(async(Y,H)=>{const c=new Array;return c.push(this._loader._loadMeshPrimitiveAsync(V,I,A,B,F,(I=>{if(E(I),I instanceof S.c){const A=j._GetDrawMode(V,F.mode),B=this._loader.rootBabylonMesh,E=B?B._internalMetadata=B._internalMetadata||{}:{},b=E.nY=E.nY||{},X=b[DV]=b[DV]||{lastSelected:null,original:[],variants:{}};X.original.push({mesh:I,material:I.material});for(let V=0;V<H.mappings.length;++V){const F=H.mappings[V],E=K.Get(`${Y}/mappings/${V}/material`,this._loader.nY.materials,F.material);c.push(this._loader._loadMaterialAsync(`#/materials/${F.material}`,E,I,A,(V=>{for(let A=0;A<F.variants.length;++A){const E=F.variants[A],Y=K.Get(`/extensions/${DV}/variants/${E}`,this._variants,E);X.variants[Y.name]=X.variants[Y.name]||[],X.variants[Y.name].push({mesh:I,material:V}),I.onClonedObservable.add((V=>{const A=V;let F=null,E=A;do{if(E=E.parent,!E)return;F=OV._GetExtensionMetadata(E)}while(null===F);if(B&&F===OV._GetExtensionMetadata(B)){E._internalMetadata={};for(const V in B._internalMetadata)E._internalMetadata[V]=B._internalMetadata[V];E._internalMetadata.nY=[];for(const V in B._internalMetadata.nY)E._internalMetadata.nY[V]=B._internalMetadata.nY[V];E._internalMetadata.nY[DV]={lastSelected:null,original:[],variants:{}};for(const V of F.original)E._internalMetadata.nY[DV].original.push({mesh:V.mesh,material:V.material});for(const V in F.variants)if(Object.prototype.hasOwnProperty.call(F.variants,V)){E._internalMetadata.nY[DV].variants[V]=[];for(const I of F.variants[V])E._internalMetadata.nY[DV].variants[V].push({mesh:I.mesh,material:I.material})}F=E._internalMetadata.nY[DV]}for(const B of F.original)B.mesh===I&&(B.mesh=A);for(const B of F.variants[Y.name])B.mesh===I&&(B.mesh=A)}))}})))}}}))),await Promise.all(c).then((V=>{let[I]=V;return I}))}))}}i(DV),l(DV,!0,(V=>new OV(V)));var ZV=A(11285);class aV{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:KV.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(V,I){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...aV._GetDefaultOptions(),...V},this._scene=I,this._scene._transmissionHelper=this,this.onErrorObservable=new X.c,this._scene.aY.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(V){if(!Object.keys(V).filter((I=>this._options[I]!==V[I])).length)return;const I={...this._options,...V},A=this._options;this._options=I,I.renderSize===A.renderSize&&I.renderTargetTextureType===A.renderTargetTextureType&&I.generateMipmaps===A.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=I.samples,this._opaqueRenderTarget.lodGenerationScale=I.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=I.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(V){return!!V&&!!(V instanceof o.b&&V.subSurface.isRefractionEnabled)}_addMesh(V){this._materialObservers[V.uniqueId]=V.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Y.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(V.material)?(V.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(V)&&this._transparentMeshesCache.push(V)):-1===this._opaqueMeshesCache.indexOf(V)&&this._opaqueMeshesCache.push(V)}))}_removeMesh(V){V.onMaterialChangedObservable.remove(this._materialObservers[V.uniqueId]),delete this._materialObservers[V.uniqueId];let I=this._transparentMeshesCache.indexOf(V);-1!==I&&this._transparentMeshesCache.splice(I,1),I=this._opaqueMeshesCache.indexOf(V),-1!==I&&this._opaqueMeshesCache.splice(I,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(V){const I=this._transparentMeshesCache.indexOf(V),A=this._opaqueMeshesCache.indexOf(V);this._shouldRenderAsTransmission(V.material)?(V.material instanceof o.b&&(V.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==A?(this._opaqueMeshesCache.splice(A,1),this._transparentMeshesCache.push(V)):-1===I&&this._transparentMeshesCache.push(V)):-1!==I?(this._transparentMeshesCache.splice(I,1),this._opaqueMeshesCache.push(V)):-1===A&&this._opaqueMeshesCache.push(V)}_isRenderTargetValid(){var V;return null!==(null===(V=this._opaqueRenderTarget)||void 0===V?void 0:V.getInternalTexture())}_setupRenderTargets(){var V;let I;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new ZV.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(V=this._options.clearColor)||void 0===V?void 0:V.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((V=>{I=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?V.clearColor.B(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(V.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=I}));for(const A of this._transparentMeshesCache)this._shouldRenderAsTransmission(A.material)&&(A.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const kV="KHR_materials_transmission";class UV{constructor(V){this.name=kV,this.order=175,this._loader=V,this.enabled=this._loader.isExtensionUsed(kV),this.enabled&&(V.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadTransparentPropertiesAsync(B,I,A,F)),await Promise.all(E).then((()=>{}))}))}_loadTransparentPropertiesAsync(V,I,A,B){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const F=A;if(F.subSurface.isRefractionEnabled=!0,F.subSurface.volumeIndexOfRefraction=1,F.subSurface.useAlbedoToTintRefraction=!0,void 0===B.transmissionFactor)return F.subSurface.refractionIntensity=0,F.subSurface.isRefractionEnabled=!1,Promise.resolve();{var E;F.subSurface.refractionIntensity=B.transmissionFactor;const V=F.sV();if(F.subSurface.refractionIntensity&&!V._transmissionHelper)new aV({},F.sV());else if(F.subSurface.refractionIntensity&&(null===(E=V._transmissionHelper)||void 0===E||!E._isRenderTargetValid())){var Y;null===(Y=V._transmissionHelper)||void 0===Y||Y._setupRenderTargets()}}return F.subSurface.minimumThickness=0,F.subSurface.maximumThickness=0,B.transmissionTexture?(B.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${V}/transmissionTexture`,B.transmissionTexture,void 0).then((V=>{V.name=`${A.name} (Transmission)`,F.subSurface.refractionIntensityTexture=V,F.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}i(kV),l(kV,!0,(V=>new UV(V)));const nV="KHR_materials_diffuse_transmission";class VI{constructor(V){this.name=nV,this.order=174,this._loader=V,this.enabled=this._loader.isExtensionUsed(nV),this.enabled&&(V.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadTranslucentPropertiesAsync(B,I,A,F)),await Promise.all(E).then((()=>{}))}))}_loadTranslucentPropertiesAsync(V,I,A,B){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const F=A;if(F.subSurface.isTranslucencyEnabled=!0,F.subSurface.volumeIndexOfRefraction=1,F.subSurface.minimumThickness=0,F.subSurface.maximumThickness=0,F.subSurface.useAlbedoToTintTranslucency=!1,void 0===B.diffuseTransmissionFactor)return F.subSurface.translucencyIntensity=0,F.subSurface.isTranslucencyEnabled=!1,Promise.resolve();F.subSurface.translucencyIntensity=B.diffuseTransmissionFactor;const Y=new Array;return F.subSurface.useGltfStyleTextures=!0,B.diffuseTransmissionTexture&&(B.diffuseTransmissionTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTransmissionTexture`,B.diffuseTransmissionTexture).then((V=>{V.name=`${A.name} (Diffuse Transmission)`,F.subSurface.translucencyIntensityTexture=V})))),void 0!==B.diffuseTransmissionColorFactor?F.subSurface.translucencyColor=E.oI.LI(B.diffuseTransmissionColorFactor):F.subSurface.translucencyColor=E.oI.White(),B.diffuseTransmissionColorTexture&&Y.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTransmissionColorTexture`,B.diffuseTransmissionColorTexture).then((V=>{V.name=`${A.name} (Diffuse Transmission Color)`,F.subSurface.translucencyColorTexture=V}))),Promise.all(Y).then((()=>{}))}}i(nV),l(nV,!0,(V=>new VI(V)));const II="KHR_materials_volume";class AI{constructor(V){this.name=II,this.order=173,this._loader=V,this.enabled=this._loader.isExtensionUsed(II),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadVolumePropertiesAsync(B,I,A,F)),await Promise.all(E).then((()=>{}))}))}_loadVolumePropertiesAsync(V,I,A,B){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);if(!A.subSurface.isRefractionEnabled&&!A.subSurface.isTranslucencyEnabled||!B.thicknessFactor)return Promise.resolve();A.subSurface.volumeIndexOfRefraction=A.indexOfRefraction;const F=void 0!==B.attenuationDistance?B.attenuationDistance:Number.MAX_VALUE;return A.subSurface.tintColorAtDistance=F,void 0!==B.attenuationColor&&3==B.attenuationColor.length&&A.subSurface.tintColor.XH(B.attenuationColor[0],B.attenuationColor[1],B.attenuationColor[2]),A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=B.thicknessFactor,A.subSurface.useThicknessAsDepth=!0,B.thicknessTexture?(B.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${V}/thicknessTexture`,B.thicknessTexture).then((V=>{V.name=`${A.name} (Thickness)`,A.subSurface.thicknessTexture=V,A.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}i(II),l(II,!0,(V=>new AI(V)));const BI="KHR_materials_dispersion";class FI{constructor(V){this.name=BI,this.order=174,this._loader=V,this.enabled=this._loader.isExtensionUsed(BI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadDispersionPropertiesAsync(B,I,A,F)),await Promise.all(E).then((()=>{}))}))}_loadDispersionPropertiesAsync(V,I,A,B){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);return A.subSurface.isRefractionEnabled&&B.dispersion?(A.subSurface.isDispersionEnabled=!0,A.subSurface.dispersion=B.dispersion,Promise.resolve()):Promise.resolve()}}i(BI),l(BI,!0,(V=>new FI(V)));const EI="EXT_materials_diffuse_roughness";class YI{constructor(V){this.name=EI,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(EI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,I,A)),E.push(this._loadDiffuseRoughnessPropertiesAsync(B,F,A)),await Promise.all(E).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(V,I,A){if(!(A instanceof o.b))throw new Error(`${V}: Material type not supported`);const B=new Array;return A.brdf.baseDiffuseModel=KV.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=I.diffuseRoughnessFactor?A.baseDiffuseRoughness=I.diffuseRoughnessFactor:A.baseDiffuseRoughness=0,I.diffuseRoughnessTexture&&B.push(this._loader.loadTextureInfoAsync(`${V}/diffuseRoughnessTexture`,I.diffuseRoughnessTexture,(V=>{V.name=`${A.name} (Diffuse Roughness)`,A.baseDiffuseRoughnessTexture=V}))),Promise.all(B).then((()=>{}))}}i(EI),l(EI,!0,(V=>new YI(V)));const HI="KHR_mesh_quantization";class cI{constructor(V){this.name=HI,this.enabled=V.isExtensionUsed(HI)}dispose(){}}i(HI),l(HI,!0,(V=>new cI(V)));const bI="KHR_texture_basisu";class XI{constructor(V){this.name=bI,this._loader=V,this.enabled=V.isExtensionUsed(bI)}dispose(){this._loader=null}_loadTextureAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>{const E=void 0==I.sampler?j.DefaultSampler:K.Get(`${V}/sampler`,this._loader.nY.samplers,I.sampler),Y=K.Get(`${B}/source`,this._loader.nY.images,F.source);return await this._loader._createTextureAsync(V,E,Y,(V=>{A(V)}),I._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!I._textureInfo.nonColorData)}))}}i(bI),l(bI,!0,(V=>new XI(V)));const PI="KHR_texture_transform";class JI{constructor(V){this.name=PI,this._loader=V,this.enabled=this._loader.isExtensionUsed(PI)}dispose(){this._loader=null}loadTextureInfoAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(B,F)=>await this._loader.loadTextureInfoAsync(V,I,(V=>{if(!(V instanceof L.e))throw new Error(`${B}: Texture type not supported`);F.offset&&(V.uOffset=F.offset[0],V.vOffset=F.offset[1]),V.uRotationCenter=0,V.vRotationCenter=0,F.rotation&&(V.wAng=-F.rotation),F.scale&&(V.uScale=F.scale[0],V.vScale=F.scale[1]),void 0!=F.texCoord&&(V.coordinatesIndex=F.texCoord),A(V)}))))}}i(PI),l(PI,!0,(V=>new JI(V)));const GI="KHR_xmp_json_ld";class wI{constructor(V){this.name=GI,this.order=100,this._loader=V,this.enabled=this._loader.isExtensionUsed(GI)}dispose(){this._loader=null}onLoading(){var V,I,A;if(null===this._loader.rootBabylonMesh)return;const B=null===(V=this._loader.nY.extensions)||void 0===V?void 0:V.KHR_xmp_json_ld,F=null===(I=this._loader.nY.asset)||void 0===I||null===(A=I.extensions)||void 0===A?void 0:A.KHR_xmp_json_ld;if(B&&F){const V=+F.packet;B.packets&&V<B.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=B.packets[V])}}}function tI(V,I,A,B){return E.oI.LI(I,A).scale(B)}function uI(V,I,A,B){return I[A]*B}function WI(V,I,A,B){return-I[A]*B}function gI(V,I,A,B){return I[A+1]*B}function oI(V,I,A,B){return I[A]*B*2}function LI(V){return{scale:[new mI(J.d.ANIMATIONTYPE_FLOAT,`${V}.uScale`,uI,(()=>2)),new mI(J.d.ANIMATIONTYPE_FLOAT,`${V}.vScale`,gI,(()=>2))],offset:[new mI(J.d.ANIMATIONTYPE_FLOAT,`${V}.uOffset`,uI,(()=>2)),new mI(J.d.ANIMATIONTYPE_FLOAT,`${V}.vOffset`,gI,(()=>2))],rotation:[new mI(J.d.ANIMATIONTYPE_FLOAT,`${V}.wAng`,WI,(()=>1))]}}i(GI),l(GI,!0,(V=>new wI(V)));class zI extends T.AnimationPropertyInfo{buildAnimations(V,I,A,B){return[{babylonAnimatable:V._babylonCamera,babylonAnimation:this._buildAnimation(I,A,B)}]}}class mI extends T.AnimationPropertyInfo{buildAnimations(V,I,A,B){const F=[];for(const E in V._data)F.push({babylonAnimatable:V._data[E].babylonMaterial,babylonAnimation:this._buildAnimation(I,A,B)});return F}}class sI extends T.AnimationPropertyInfo{buildAnimations(V,I,A,B){return[{babylonAnimatable:V._babylonLight,babylonAnimation:this._buildAnimation(I,A,B)}]}}(0,y.k)("/cameras/{}/orthographic/xmag",[new zI(J.d.ANIMATIONTYPE_FLOAT,"orthoLeft",WI,(()=>1)),new zI(J.d.ANIMATIONTYPE_FLOAT,"orthoRight",gI,(()=>1))]),(0,y.k)("/cameras/{}/orthographic/ymag",[new zI(J.d.ANIMATIONTYPE_FLOAT,"orthoBottom",WI,(()=>1)),new zI(J.d.ANIMATIONTYPE_FLOAT,"orthoTop",gI,(()=>1))]),(0,y.k)("/cameras/{}/orthographic/zfar",[new zI(J.d.ANIMATIONTYPE_FLOAT,"maxZ",uI,(()=>1))]),(0,y.k)("/cameras/{}/orthographic/znear",[new zI(J.d.ANIMATIONTYPE_FLOAT,"FH",uI,(()=>1))]),(0,y.k)("/cameras/{}/perspective/yfov",[new zI(J.d.ANIMATIONTYPE_FLOAT,"fov",uI,(()=>1))]),(0,y.k)("/cameras/{}/perspective/zfar",[new zI(J.d.ANIMATIONTYPE_FLOAT,"maxZ",uI,(()=>1))]),(0,y.k)("/cameras/{}/perspective/znear",[new zI(J.d.ANIMATIONTYPE_FLOAT,"FH",uI,(()=>1))]),(0,y.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new mI(J.d.ANIMATIONTYPE_COLOR3,"albedoColor",tI,(()=>4)),new mI(J.d.ANIMATIONTYPE_FLOAT,"alpha",(function(V,I,A,B){return I[A+3]*B}),(()=>4))]),(0,y.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"metallic",uI,(()=>1))]),(0,y.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"roughness",uI,(()=>1))]);const eI=LI("albedoTexture");(0,y.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",eI.scale),(0,y.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",eI.offset),(0,y.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",eI.rotation);const SI=LI("metallicTexture");(0,y.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",SI.scale),(0,y.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",SI.offset),(0,y.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",SI.rotation),(0,y.k)("/materials/{}/emissiveFactor",[new mI(J.d.ANIMATIONTYPE_COLOR3,"emissiveColor",tI,(()=>3))]);const QI=LI("bumpTexture");(0,y.k)("/materials/{}/normalTexture/scale",[new mI(J.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",uI,(()=>1))]),(0,y.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",QI.scale),(0,y.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",QI.offset),(0,y.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",QI.rotation),(0,y.k)("/materials/{}/occlusionTexture/strength",[new mI(J.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",uI,(()=>1))]);const hI=LI("ambientTexture");(0,y.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",hI.scale),(0,y.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",hI.offset),(0,y.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",hI.rotation);const rI=LI("emissiveTexture");(0,y.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",rI.scale),(0,y.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",rI.offset),(0,y.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",rI.rotation),(0,y.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new mI(J.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new mI(J.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",uI,(()=>1))]);const MI=LI("anisotropy.texture");(0,y.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",MI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",MI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",MI.rotation),(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",uI,(()=>1))]);const xI=LI("clearCoat.texture");(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",xI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",xI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",xI.rotation);const fI=LI("clearCoat.bumpTexture");(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new mI(J.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",fI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",fI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",fI.rotation);const RI=LI("clearCoat.textureRoughness");(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",RI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",RI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",RI.rotation),(0,y.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new mI(J.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new mI(J.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new mI(J.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new mI(J.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",uI,(()=>1))]);const qI=LI("iridescence.texture");(0,y.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",qI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",qI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",qI.rotation);const NI=LI("iridescence.thicknessTexture");(0,y.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",NI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",NI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",NI.rotation),(0,y.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new mI(J.d.ANIMATIONTYPE_COLOR3,"sheen.color",tI,(()=>3))]),(0,y.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",uI,(()=>1))]);const lI=LI("sheen.texture");(0,y.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",lI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",lI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",lI.rotation);const iI=LI("sheen.textureRoughness");(0,y.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",iI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",iI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",iI.rotation),(0,y.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new mI(J.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",tI,(()=>3))]);const yI=LI("metallicReflectanceTexture");(0,y.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",yI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",yI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",yI.rotation);const vI=LI("reflectanceTexture");(0,y.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",vI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",vI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",vI.rotation),(0,y.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",uI,(()=>1))]);const CI=LI("subSurface.refractionIntensityTexture");(0,y.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",CI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",CI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",CI.rotation),(0,y.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new mI(J.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",tI,(()=>3))]),(0,y.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new mI(J.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",uI,(()=>1))]),(0,y.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",uI,(()=>1))]);const KI=LI("subSurface.thicknessTexture");(0,y.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",KI.scale),(0,y.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",KI.offset),(0,y.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",KI.rotation),(0,y.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new mI(J.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",uI,(()=>1))]);const pI=LI("subSurface.translucencyIntensityTexture");(0,y.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",pI.scale),(0,y.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",pI.offset),(0,y.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",pI.rotation),(0,y.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new mI(J.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",tI,(()=>3))]);const jI=LI("subSurface.translucencyColorTexture");(0,y.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",jI.scale),(0,y.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",jI.offset),(0,y.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",jI.rotation),(0,y.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new sI(J.d.ANIMATIONTYPE_COLOR3,"diffuse",tI,(()=>3))]),(0,y.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new sI(J.d.ANIMATIONTYPE_FLOAT,"intensity",uI,(()=>1))]),(0,y.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new sI(J.d.ANIMATIONTYPE_FLOAT,"range",uI,(()=>1))]),(0,y.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new sI(J.d.ANIMATIONTYPE_FLOAT,"innerAngle",oI,(()=>1))]),(0,y.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new sI(J.d.ANIMATIONTYPE_FLOAT,"angle",oI,(()=>1))]),(0,y.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new sI(J.d.ANIMATIONTYPE_COLOR3,"diffuse",tI,(()=>3))]),(0,y.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new sI(J.d.ANIMATIONTYPE_FLOAT,"intensity",uI,(()=>1))]);const TI="KHR_animation_pointer";class dI{constructor(V){this.name=TI,this._loader=V,this._pathToObjectConverter=(0,y.i)(this._loader.nY)}get enabled(){return this._loader.isExtensionUsed(TI)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(V,I,A,B,F){var E;const Y=null===(E=B.target.extensions)||void 0===E?void 0:E.KHR_animation_pointer;if(!Y||!this._pathToObjectConverter)return null;"pointer"!==B.target.path&&t.b.Warn(`${V}/target/path: Value (${B.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=B.target.node&&t.b.Warn(`${V}/target/node: Value (${B.target.node}) must not be present when using the ${this.name} extension`);const H=`${V}/extensions/${this.name}`,c=Y.pointer;if(!c)throw new Error(`${H}: Pointer is missing`);try{const E=this._pathToObjectConverter.convert(c);if(!E.info.interpolation)throw new Error(`${H}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(V,I,A,B,{object:E.object,info:E.info.interpolation},F)}catch(b){return t.b.Warn(`${H}/pointer: Invalid pointer (${c}) skipped`),null}}}i(TI),l(TI,!0,(V=>new dI(V)));class DI{constructor(V,I,A){this.frame=V,this.action=I,this.onlyOnce=A,this.isDone=!1}_clone(){return new DI(this.frame,this.action,this.onlyOnce)}}var OI=A(11084),ZI=A(11137),aI=A(11135);class kI{get loop(){return this._loop}set loop(V){V!==this._loop&&(this._loop=V,this.updateOptions({loop:V}))}get currentTime(){var V;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(V=ZI.e.audioEngine)&&void 0!==V&&V.audioContext&&(this.isPlaying||this.isPaused)){const V=this.isPaused?0:ZI.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+V}return 0}get spatialSound(){return this._spatialSound}set spatialSound(V){if(V==this._spatialSound)return;const I=this.isPlaying;this.pause(),V?(this._spatialSound=V,this._updateSpatialParameters()):this._disableSpatialSound(),I&&this.play()}constructor(V,I,A){var B;let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new X.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=F.tI.Zero(),this._localDirection=new F.tI(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=V,A=A||w.e.LastCreatedScene)if(this._scene=A,kI._SceneComponentInitialization(A),this._readyToPlayCallback=E,this._customAttenuationFunction=(V,I,A,B,F)=>I<A?V*(1-I/A):0,H&&(this.autoplay=H.autoplay||!1,this._loop=H.loop||!1,void 0!==H.volume&&(this._volume=H.volume),this._spatialSound=H.spatialSound??!1,this.maxDistance=H.maxDistance??100,this.useCustomAttenuation=H.useCustomAttenuation??!1,this.rolloffFactor=H.rolloffFactor||1,this.refDistance=H.refDistance||1,this.distanceModel=H.distanceModel||"linear",this._playbackRate=H.playbackRate||1,this._streaming=H.streaming??!1,this._length=H.length,this._offset=H.offset),null!==(B=ZI.e.audioEngine)&&void 0!==B&&B.canUseWebAudio&&ZI.e.audioEngine.audioContext){this._soundGain=ZI.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let V=!0;if(I)try{"string"===typeof I?(this._urlType="String",this._url=I):I instanceof ArrayBuffer?this._urlType="ArrayBuffer":I instanceof HTMLMediaElement?this._urlType="MediaElement":I instanceof MediaStream?this._urlType="MediaStream":I instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(I)&&(this._urlType="Array");let A=[],B=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ZI.e.audioEngine.audioContext.createMediaElementSource(I),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ZI.e.audioEngine.audioContext.createMediaStreamSource(I),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":I.byteLength>0&&(B=!0,this._soundLoaded(I));break;case"AudioBuffer":this._audioBufferLoaded(I);break;case"String":A.push(I);case"Array":0===A.length&&(A=I);for(let V=0;V<A.length;V++){const I=A[V];if(B=H&&H.skipCodecCheck||-1!==I.indexOf(".mp3",I.length-4)&&ZI.e.audioEngine.isMP3supported||-1!==I.indexOf(".ogg",I.length-4)&&ZI.e.audioEngine.isOGGsupported||-1!==I.indexOf(".wav",I.length-4)||-1!==I.indexOf(".m4a",I.length-4)||-1!==I.indexOf(".mp4",I.length-4)||-1!==I.indexOf("blob:"),B){this._streaming?(this._htmlAudioElement=new Audio(I),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Y.Tools.SetCorsBehavior(I,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(I,(V=>{this._soundLoaded(V)}),void 0,!0,!0,(V=>{V&&t.b.Error("XHR "+V.status+" error on: "+I+"."),t.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:V=!1}V?B||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):t.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(c){t.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),ZI.e.audioEngine&&!ZI.e.audioEngine.WarnedWebAudioUnsupported&&(t.b.Error("Web Audio is not supported by your browser."),ZI.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var V;null!==(V=ZI.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(V){var I;null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.audioContext&&(this._audioBuffer=V,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(V){var I;null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.audioContext&&ZI.e.audioEngine.audioContext.decodeAudioData(V,(V=>{this._audioBufferLoaded(V)}),(V=>{t.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+V)}))}setAudioBuffer(V){var I;null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&(this._audioBuffer=V,this._isReadyToPlay=!0)}updateOptions(V){V&&(this.loop=V.loop??this.loop,this.maxDistance=V.maxDistance??this.maxDistance,this.useCustomAttenuation=V.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=V.rolloffFactor??this.rolloffFactor,this.refDistance=V.refDistance??this.refDistance,this.distanceModel=V.distanceModel??this.distanceModel,this._playbackRate=V.playbackRate??this._playbackRate,this._length=V.length??void 0,this.spatialSound=V.spatialSound??this._spatialSound,this._setOffset(V.offset??void 0),this.setVolume(V.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var V;null!==(V=ZI.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&ZI.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??ZI.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var V;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(V=this._soundPanner)||void 0===V||V.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var V;null!==(V=ZI.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(V){var I;null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(V),this._isOutputConnected=!0)}setDirectionalCone(V,I,A){I<V?t.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=V,this._coneOuterAngle=I,this._coneOuterGain=A,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(V){if(V!=this._coneInnerAngle){var I;if(this._coneOuterAngle<V)return void t.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=V,null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(V){if(V!=this._coneOuterAngle){var I;if(V<this._coneInnerAngle)return void t.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=V,null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(V){var I;V.equals(this._position)||(this._position.B(V),null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(V){var I;this._localDirection=V,null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const V=this._connectedTransformNode.getWorldMatrix(),I=F.tI.TransformNormal(this._localDirection,V);I.normalize(),this._soundPanner.orientationX.value=I.x,this._soundPanner.orientationY.value=I.y,this._soundPanner.orientationZ.value=I.z}updateDistanceFromListener(){var V;if(null!==(V=ZI.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const V=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.uI(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,V,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(V){this._customAttenuationFunction=V}play(V,I,A){var B;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(B=ZI.e.audioEngine)&&void 0!==B&&B.audioContext)try{var F,E;this._clearTimeoutsAndObservers();let B=V?(null===(F=ZI.e.audioEngine)||void 0===F?void 0:F.audioContext.currentTime)+V:null===(E=ZI.e.audioEngine)||void 0===E?void 0:E.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=ZI.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const V=()=>{var A;if(null!==(A=ZI.e.audioEngine)&&void 0!==A&&A.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=I??0;const A=this._htmlAudioElement.play();void 0!==A&&A.catch((()=>{var I,A;(null===(I=ZI.e.audioEngine)||void 0===I||I.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(A=ZI.e.audioEngine)||void 0===A?void 0:A.onAudioUnlockedObservable.addOnce((()=>{V()})))}))}else{var B;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(B=ZI.e.audioEngine)||void 0===B?void 0:B.onAudioUnlockedObservable.addOnce((()=>{V()}))}};V()}}else{var Y;const F=()=>{var F;if(null!==(F=ZI.e.audioEngine)&&void 0!==F&&F.audioContext){var E;if(A=A||this._length,void 0!==I&&this._setOffset(I),this._soundSource){const V=this._soundSource;V.onended=()=>{V.disconnect()}}if(this._soundSource=null===(E=ZI.e.audioEngine)||void 0===E?void 0:E.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==I&&(this._soundSource.loopStart=I),void 0!==A&&(this._soundSource.loopEnd=(0|I)+A),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},B=V?(null===(Y=ZI.e.audioEngine)||void 0===Y?void 0:Y.audioContext.currentTime)+V:ZI.e.audioEngine.audioContext.currentTime;const F=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(B,F,this.loop?void 0:A)}}};"suspended"===(null===(Y=ZI.e.audioEngine)||void 0===Y?void 0:Y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var V;"suspended"===(null===(V=ZI.e.audioEngine)||void 0===V?void 0:V.audioContext.state)?(ZI.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=ZI.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{F()})))):F()}),500):F()}this._startTime=B,this.isPlaying=!0,this.isPaused=!1}catch(H){t.b.Error("Error while trying to play audio: "+this.name+", "+H.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(V){var I;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var A;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(A=this._streamingSource)||void 0===A||A.disconnect();this.isPlaying=!1}else if(null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.audioContext&&this._soundSource){const I=V?ZI.e.audioEngine.audioContext.currentTime+V:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(I)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var V;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var I;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(I=this._streamingSource)||void 0===I||I.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(V=ZI.e.audioEngine)&&void 0!==V&&V.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=ZI.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(V,I){var A;null!==(A=ZI.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._soundGain&&(I&&ZI.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(ZI.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,ZI.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(V,ZI.e.audioEngine.audioContext.currentTime+I)):this._soundGain.gain.value=V),this._volume=V}setPlaybackRate(V){this._playbackRate=V,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(V){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=V,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=V=>this._onRegisterAfterWorldMatrixUpdate(V),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(V){var I;if(V.getBoundingInfo){const I=V.getBoundingInfo();this.setPosition(I.boundingSphere.centerWorld)}else this.setPosition(V.absolutePosition);null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const V=()=>{(0,aI.e)((()=>this._isReadyToPlay),(()=>{A._audioBuffer=this.getAudioBuffer(),A._isReadyToPlay=!0,A.autoplay&&A.play(0,this._offset,this._length)}),void 0,300)},I={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},A=new kI(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,I);return this.useCustomAttenuation&&A.setAttenuationFunction(this._customAttenuationFunction),A.setPosition(this._position),A.setPlaybackRate(this._playbackRate),V(),A}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const V={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(V.connectedMeshId=this._connectedTransformNode.id),V.position=this._position.AH(),V.refDistance=this.refDistance,V.distanceModel=this.distanceModel,V.isDirectional=this._isDirectional,V.localDirectionToMesh=this._localDirection.AH(),V.coneInnerAngle=this._coneInnerAngle,V.coneOuterAngle=this._coneOuterAngle,V.coneOuterGain=this._coneOuterGain),V}static Parse(V,I,A,B){const E=V.name;let Y;Y=V.url?A+V.url:A+E;const H={autoplay:V.autoplay,loop:V.loop,volume:V.volume,spatialSound:V.spatialSound,maxDistance:V.maxDistance,rolloffFactor:V.rolloffFactor,refDistance:V.refDistance,distanceModel:V.distanceModel,playbackRate:V.playbackRate};let c;if(B){const V=()=>{(0,aI.e)((()=>B._isReadyToPlay),(()=>{c._audioBuffer=B.getAudioBuffer(),c._isReadyToPlay=!0,c.autoplay&&c.play(0,c._offset,c._length)}),void 0,300)};c=new kI(E,new ArrayBuffer(0),I,null,H),V()}else c=new kI(E,Y,I,(()=>{I.removePendingData(c)}),H),I.addPendingData(c);if(V.position){const I=F.tI.LI(V.position);c.setPosition(I)}if(V.isDirectional&&(c.setDirectionalCone(V.coneInnerAngle||360,V.coneOuterAngle||360,V.coneOuterGain||0),V.localDirectionToMesh)){const I=F.tI.LI(V.localDirectionToMesh);c.setLocalDirectionToMesh(I)}if(V.connectedMeshId){const A=I.getMeshById(V.connectedMeshId);A&&c.attachToMesh(A)}return V.metadata&&(c.metadata=V.metadata),c}_setOffset(V){this._offset!==V&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=V)}_clearTimeoutsAndObservers(){var V;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(V=ZI.e.audioEngine)||void 0===V||V.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}kI._SceneComponentInitialization=V=>{throw(0,OI.e)("AudioSceneComponent")},(0,mV.e)("BABYLON.Sound",kI);class UI{constructor(V,I,A){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],I.length!==A.length)throw new Error("Sounds length does not equal weights length");this.loop=V,this._weights=A;let B=0;for(const E of A)B+=E;const F=B>0?1/B:0;for(let E=0;E<this._weights.length;E++)this._weights[E]*=F;this._sounds=I;for(const E of this._sounds)E.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(V){if(V!==this._coneInnerAngle){if(this._coneOuterAngle<V)return void t.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=V;for(const I of this._sounds)I.directionalConeInnerAngle=V}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(V){if(V!==this._coneOuterAngle){if(V<this._coneInnerAngle)return void t.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=V;for(const I of this._sounds)I.directionalConeOuterAngle=V}}get volume(){return this._volume}set volume(V){if(V!==this._volume)for(const I of this._sounds)I.setVolume(V)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(V){if(!this.isPaused){this.stop();const V=Math.random();let I=0;for(let A=0;A<this._weights.length;A++)if(I+=this._weights[A],V<=I){this._currentIndex=A;break}}const I=this._sounds[this._currentIndex??0];I.isReady()?I.play(0,this.isPaused?void 0:V):I.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class nI{constructor(V){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(V=V||w.e.LastCreatedScene)&&(this._scene=V,this.soundCollection=[],this._options=I,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var V;null!==(V=ZI.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&ZI.e.audioEngine.audioContext&&(this._outputAudioNode=ZI.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(ZI.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(ZI.e.audioEngine&&ZI.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(V){var I;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&V.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==V.soundTrackId&&(-1===V.soundTrackId?this._scene.mainSoundTrack.removeSound(V):this._scene.soundTracks&&this._scene.soundTracks[V.soundTrackId].removeSound(V)),this.soundCollection.push(V),V.soundTrackId=this.id}removeSound(V){const I=this.soundCollection.indexOf(V);-1!==I&&this.soundCollection.splice(I,1)}setVolume(V){var I;null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=V)}switchPanningModelToHRTF(){var V;if(null!==(V=ZI.e.audioEngine)&&void 0!==V&&V.canUseWebAudio)for(let I=0;I<this.soundCollection.length;I++)this.soundCollection[I].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var V;if(null!==(V=ZI.e.audioEngine)&&void 0!==V&&V.canUseWebAudio)for(let I=0;I<this.soundCollection.length;I++)this.soundCollection[I].switchPanningModelToEqualPower()}connectToAnalyser(V){var I;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=V,null!==(I=ZI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,ZI.e.audioEngine.masterGain))}}var VA=A(11499),IA=A(11473),AA=A(11062);ZI.e.AudioEngineFactory=(V,I,A)=>new BA(V,I,A);class BA{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new X.c,this.onAudioLockedObservable=new X.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,AA.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const B=document.createElement("audio");this._hostElement=V,this._audioContext=I,this._audioDestination=A;try{B&&B.canPlayType&&(B.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||B.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(F){}try{B&&B.canPlayType&&B.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(F){}}lock(){this._triggerSuspendedState()}unlock(){var V,I;if("running"===(null===(V=this._audioContext)||void 0===V?void 0:V.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(I=this._audioContext)||void 0===I||I.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{t.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var V;null===(V=this._audioContext)||void 0===V||V.addEventListener("statechange",(()=>{var V;this.unlocked&&"running"!==(null===(V=this._audioContext)||void 0===V?void 0:V.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var V;return null!==(V=this._audioContext)&&void 0!==V&&V.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(V){this.canUseWebAudio=!1,t.b.Error("Web Audio: "+V.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(V){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const V=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",I=document.createElement("style");I.appendChild(document.createTextNode(V)),document.getElementsByTagName("head")[0].appendChild(I),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var V;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(V=this._audioContext)||void 0===V||V.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(V){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=V)}connectToAnalyser(V){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=V,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var FA=A(11075);(0,A(12623).c)(VA.d.NAME_AUDIO,((V,I,A,B)=>{let F,E=[];if(A.dG=A.dG||[],void 0!==V.dG&&null!==V.dG)for(let H=0,c=V.dG.length;H<c;H++){var Y;const c=V.dG[H];null!==(Y=ZI.e.audioEngine)&&void 0!==Y&&Y.canUseWebAudio?(c.url||(c.url=c.name),E[c.url]?A.dG.push(kI.Parse(c,I,B,E[c.url])):(F=kI.Parse(c,I,B),E[c.url]=F,A.dG.push(F))):A.dG.push(new kI(c.name,null,I))}E=[]})),Object.defineProperty(IA.b.prototype,"mainSoundTrack",{get:function(){let V=this._getComponent(VA.d.NAME_AUDIO);return V||(V=new EA(this),this.DY(V)),this._mainSoundTrack||(this._mainSoundTrack=new nI(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),IA.b.prototype.getSoundByName=function(V){let I;for(I=0;I<this.mainSoundTrack.soundCollection.length;I++)if(this.mainSoundTrack.soundCollection[I].name===V)return this.mainSoundTrack.soundCollection[I];if(this.soundTracks)for(let A=0;A<this.soundTracks.length;A++)for(I=0;I<this.soundTracks[A].soundCollection.length;I++)if(this.soundTracks[A].soundCollection[I].name===V)return this.soundTracks[A].soundCollection[I];return null},Object.defineProperty(IA.b.prototype,"audioEnabled",{get:function(){let V=this._getComponent(VA.d.NAME_AUDIO);return V||(V=new EA(this),this.DY(V)),V.audioEnabled},set:function(V){let I=this._getComponent(VA.d.NAME_AUDIO);I||(I=new EA(this),this.DY(I)),V?I.enableAudio():I.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(IA.b.prototype,"headphone",{get:function(){let V=this._getComponent(VA.d.NAME_AUDIO);return V||(V=new EA(this),this.DY(V)),V.headphone},set:function(V){let I=this._getComponent(VA.d.NAME_AUDIO);I||(I=new EA(this),this.DY(I)),V?I.switchAudioModeForHeadphones():I.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(IA.b.prototype,"audioListenerPositionProvider",{get:function(){let V=this._getComponent(VA.d.NAME_AUDIO);return V||(V=new EA(this),this.DY(V)),V.audioListenerPositionProvider},set:function(V){let I=this._getComponent(VA.d.NAME_AUDIO);if(I||(I=new EA(this),this.DY(I)),V&&"function"!==typeof V)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");I.audioListenerPositionProvider=V},enumerable:!0,configurable:!0}),Object.defineProperty(IA.b.prototype,"audioListenerRotationProvider",{get:function(){let V=this._getComponent(VA.d.NAME_AUDIO);return V||(V=new EA(this),this.DY(V)),V.audioListenerRotationProvider},set:function(V){let I=this._getComponent(VA.d.NAME_AUDIO);if(I||(I=new EA(this),this.DY(I)),V&&"function"!==typeof V)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");I.audioListenerRotationProvider=V},enumerable:!0,configurable:!0}),Object.defineProperty(IA.b.prototype,"audioPositioningRefreshRate",{get:function(){let V=this._getComponent(VA.d.NAME_AUDIO);return V||(V=new EA(this),this.DY(V)),V.audioPositioningRefreshRate},set:function(V){let I=this._getComponent(VA.d.NAME_AUDIO);I||(I=new EA(this),this.DY(I)),I.audioPositioningRefreshRate=V},enumerable:!0,configurable:!0});class EA{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(V){this.name=VA.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new F.tI,this._cachedCameraPosition=new F.tI,this._lastCheck=0,this._invertMatrixTemp=new F.Matrix,this._cameraDirectionTemp=new F.tI,(V=V||w.e.LastCreatedScene)&&(this.WI=V,V.soundTracks=[],V.dG=[])}register(){this.WI._afterRenderStage.registerStep(VA.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(V){if(V.dG=[],this.WI.soundTracks)for(let I=0;I<this.WI.soundTracks.length;I++){const A=this.WI.soundTracks[I];for(let I=0;I<A.soundCollection.length;I++)V.dG.push(A.soundCollection[I].serialize())}}addFromContainer(V){if(V.dG)for(const I of V.dG)I.play(),I.autoplay=!0,this.WI.mainSoundTrack.addSound(I)}removeFromContainer(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(V.dG)for(const A of V.dG)A.stop(),A.autoplay=!1,this.WI.mainSoundTrack.removeSound(A),I&&A.dispose()}dispose(){const V=this.WI;if(V._mainSoundTrack&&V.mainSoundTrack.dispose(),V.soundTracks)for(let I=0;I<V.soundTracks.length;I++)V.soundTracks[I].dispose()}disableAudio(){const V=this.WI;let I;for(this._audioEnabled=!1,ZI.e.audioEngine&&ZI.e.audioEngine.audioContext&&ZI.e.audioEngine.audioContext.suspend(),I=0;I<V.mainSoundTrack.soundCollection.length;I++)V.mainSoundTrack.soundCollection[I].pause();if(V.soundTracks)for(I=0;I<V.soundTracks.length;I++)for(let A=0;A<V.soundTracks[I].soundCollection.length;A++)V.soundTracks[I].soundCollection[A].pause()}enableAudio(){const V=this.WI;let I;for(this._audioEnabled=!0,ZI.e.audioEngine&&ZI.e.audioEngine.audioContext&&ZI.e.audioEngine.audioContext.resume(),I=0;I<V.mainSoundTrack.soundCollection.length;I++)V.mainSoundTrack.soundCollection[I].isPaused&&V.mainSoundTrack.soundCollection[I].play();if(V.soundTracks)for(I=0;I<V.soundTracks.length;I++)for(let A=0;A<V.soundTracks[I].soundCollection.length;A++)V.soundTracks[I].soundCollection[A].isPaused&&V.soundTracks[I].soundCollection[A].play()}switchAudioModeForHeadphones(){const V=this.WI;if(this._headphone=!0,V.mainSoundTrack.switchPanningModelToHRTF(),V.soundTracks)for(let I=0;I<V.soundTracks.length;I++)V.soundTracks[I].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const V=this.WI;if(this._headphone=!1,V.mainSoundTrack.switchPanningModelToEqualPower(),V.soundTracks)for(let I=0;I<V.soundTracks.length;I++)V.soundTracks[I].switchPanningModelToEqualPower()}_afterRender(){const V=FA.e.Now;if(this._lastCheck&&V-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=V;const I=this.WI;if(!this._audioEnabled||!I._mainSoundTrack||!I.soundTracks||0===I._mainSoundTrack.soundCollection.length&&1===I.soundTracks.length)return;const A=ZI.e.audioEngine;if(A&&A.audioContext){let V,B=I.activeCamera;if(I.activeCameras&&I.activeCameras.length>0&&(B=I.activeCameras[0]),this.audioListenerPositionProvider){const V=this.audioListenerPositionProvider();A.audioContext.listener.setPosition(V.x||0,V.y||0,V.z||0)}else B?this._cachedCameraPosition.equals(B.globalPosition)||(this._cachedCameraPosition.B(B.globalPosition),A.audioContext.listener.setPosition(B.globalPosition.x,B.globalPosition.y,B.globalPosition.z)):A.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const V=this.audioListenerRotationProvider();A.audioContext.listener.setOrientation(V.x||0,V.y||0,V.z||0,0,1,0)}else B?(B.rigCameras&&B.rigCameras.length>0&&(B=B.rigCameras[0]),B.getViewMatrix().invertToRef(this._invertMatrixTemp),F.tI.TransformNormalToRef(EA._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.B(this._cameraDirectionTemp),A.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):A.audioContext.listener.setOrientation(0,0,0,0,1,0);for(V=0;V<I.mainSoundTrack.soundCollection.length;V++){const A=I.mainSoundTrack.soundCollection[V];A.useCustomAttenuation&&A.updateDistanceFromListener()}if(I.soundTracks)for(V=0;V<I.soundTracks.length;V++)for(let A=0;A<I.soundTracks[V].soundCollection.length;A++){const B=I.soundTracks[V].soundCollection[A];B.useCustomAttenuation&&B.updateDistanceFromListener()}}}}EA._CameraDirection=new F.tI(0,0,-1),kI._SceneComponentInitialization=V=>{let I=V._getComponent(VA.d.NAME_AUDIO);I||(I=new EA(V),V.DY(I))};const YA="MSFT_audio_emitter";class HA{constructor(V){this.name=YA,this._loader=V,this.enabled=this._loader.isExtensionUsed(YA)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const V=this._loader.nY.extensions;if(V&&V[this.name]){const I=V[this.name];this._clips=I.clips,this._emitters=I.emitters,K.Assign(this._clips),K.Assign(this._emitters)}}loadSceneAsync(V,I){return j.LoadExtensionAsync(V,I,this.name,(async(A,B)=>{const F=new Array;F.push(this._loader.loadSceneAsync(V,I));for(const V of B.emitters){const I=K.Get(`${A}/emitters`,this._emitters,V);if(void 0!=I.refDistance||void 0!=I.maxDistance||void 0!=I.rolloffFactor||void 0!=I.distanceModel||void 0!=I.innerAngle||void 0!=I.outerAngle)throw new Error(`${A}: Direction or Distance properties are not allowed on emitters attached to a scene`);F.push(this._loadEmitterAsync(`${A}/emitters/${I.index}`,I))}await Promise.all(F)}))}loadNodeAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(V,B)=>{const E=new Array,H=await this._loader.loadNodeAsync(V,I,(I=>{for(const A of B.emitters){const B=K.Get(`${V}/emitters`,this._emitters,A);E.push(this._loadEmitterAsync(`${V}/emitters/${B.index}`,B).then((()=>{for(const V of B._babylonSounds)V.attachToMesh(I),void 0==B.innerAngle&&void 0==B.outerAngle||(V.setLocalDirectionToMesh(F.tI.Forward()),V.setDirectionalCone(2*Y.Tools.ToDegrees(void 0==B.innerAngle?Math.PI:B.innerAngle),2*Y.Tools.ToDegrees(void 0==B.outerAngle?Math.PI:B.outerAngle),0))})))}A(I)}));return await Promise.all(E),H}))}loadAnimationAsync(V,I){return j.LoadExtensionAsync(V,I,this.name,(async(A,B)=>{const F=await this._loader.loadAnimationAsync(V,I),E=new Array;K.Assign(B.events);for(const Y of B.events)E.push(this._loadAnimationEventAsync(`${A}/events/${Y.index}`,V,I,Y,F));return await Promise.all(E),F}))}_loadClipAsync(V,I){if(I._objectURL)return I._objectURL;let A;if(I.uri)A=this._loader.loadUriAsync(V,I,I.uri);else{const B=K.Get(`${V}/bufferView`,this._loader.nY.bufferViews,I.bufferView);A=this._loader.loadBufferViewAsync(`/bufferViews/${B.index}`,B)}return I._objectURL=A.then((V=>URL.createObjectURL(new Blob([V],{type:I.mimeType})))),I._objectURL}_loadEmitterAsync(V,I){if(I._babylonSounds=I._babylonSounds||[],!I._babylonData){const V=new Array,A=I.name||`emitter${I.index}`,B={loop:!1,autoplay:!1,volume:void 0==I.volume?1:I.volume};for(let E=0;E<I.clips.length;E++){const F=`/extensions/${this.name}/clips`,Y=K.Get(F,this._clips,I.clips[E].clip);V.push(this._loadClipAsync(`${F}/${I.clips[E].clip}`,Y).then((V=>{const F=I._babylonSounds[E]=new kI(A,V,this._loader.babylonScene,null,B);F.refDistance=I.refDistance||1,F.maxDistance=I.maxDistance||256,F.rolloffFactor=I.rolloffFactor||1,F.distanceModel=I.distanceModel||"exponential"})))}const F=Promise.all(V).then((()=>{const V=I.clips.map((V=>V.weight||1)),A=new UI(I.loop||!1,I._babylonSounds,V);I.innerAngle&&(A.directionalConeInnerAngle=2*Y.Tools.ToDegrees(I.innerAngle)),I.outerAngle&&(A.directionalConeOuterAngle=2*Y.Tools.ToDegrees(I.outerAngle)),I.volume&&(A.volume=I.volume),I._babylonData.sound=A}));I._babylonData={loaded:F}}return I._babylonData.loaded}_getEventAction(V,I,A,B,F){switch(A){case"play":return V=>{const A=(F||0)+(V-B);I.play(A)};case"stop":return()=>{I.stop()};case"pause":return()=>{I.pause()};default:throw new Error(`${V}: Unsupported action ${A}`)}}_loadAnimationEventAsync(V,I,A,B,F){if(0==F.targetedAnimations.length)return Promise.resolve();const E=F.targetedAnimations[0],Y=B.BI,H=K.Get(`/extensions/${this.name}/emitters`,this._emitters,Y);return this._loadEmitterAsync(V,H).then((()=>{const I=H._babylonData.sound;if(I){const A=new DI(B.time,this._getEventAction(V,I,B.action,B.time,B.startOffset));E.animation.addEvent(A),F.onAnimationGroupEndObservable.add((()=>{I.stop()})),F.onAnimationGroupPauseObservable.add((()=>{I.pause()}))}}))}}i(YA),l(YA,!0,(V=>new HA(V)));const cA="MSFT_lod";class bA{constructor(V){var I;this.name=cA,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new X.c,this.onMaterialLODsLoadedObservable=new X.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=V,this.maxLODsToLoad=(null===(I=this._loader.parent.extensionOptions[cA])||void 0===I?void 0:I.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(cA)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let V=0;V<this._nodePromiseLODs.length;V++){const I=Promise.all(this._nodePromiseLODs[V]).then((()=>{0!==V&&(this._loader.endPerformanceCounter(`Node LOD ${V}`),this._loader.log(`Loaded node LOD ${V}`)),this.onNodeLODsLoadedObservable.notifyObservers(V),V!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${V+1}`),this._loadBufferLOD(this._nodeBufferLODs,V+1),this._nodeSignalLODs[V]&&this._nodeSignalLODs[V].resolve())}));this._loader._completePromises.push(I)}for(let V=0;V<this._materialPromiseLODs.length;V++){const I=Promise.all(this._materialPromiseLODs[V]).then((()=>{0!==V&&(this._loader.endPerformanceCounter(`Material LOD ${V}`),this._loader.log(`Loaded material LOD ${V}`)),this.onMaterialLODsLoadedObservable.notifyObservers(V),V!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${V+1}`),this._loadBufferLOD(this._materialBufferLODs,V+1),this._materialSignalLODs[V]&&this._materialSignalLODs[V].resolve())}));this._loader._completePromises.push(I)}}loadSceneAsync(V,I){const A=this._loader.loadSceneAsync(V,I);return this._loadBufferLOD(this._bufferLODs,0),A}loadNodeAsync(V,I,A){return j.LoadExtensionAsync(V,I,this.name,(async(V,F)=>{let E;const Y=this._getLODs(V,I,this._loader.nY.nodes,F.ids);this._loader.logOpen(`${V}`);for(let I=0;I<Y.length;I++){const V=Y[I];0!==I&&(this._nodeIndexLOD=I,this._nodeSignalLODs[I]=this._nodeSignalLODs[I]||new B);const F=V=>{A(V),V.qH(!1)},H=this._loader.loadNodeAsync(`/nodes/${V.index}`,V,F).then((V=>{if(0!==I){const V=Y[I-1];V._babylonTransformNode&&(this._disposeTransformNode(V._babylonTransformNode),delete V._babylonTransformNode)}return V.qH(!0),V}));this._nodePromiseLODs[I]=this._nodePromiseLODs[I]||[],0===I?E=H:(this._nodeIndexLOD=null,this._nodePromiseLODs[I].push(H))}return this._loader.logClose(),await E}))}_loadMaterialAsync(V,I,A,B,F){return this._nodeIndexLOD?null:j.LoadExtensionAsync(V,I,this.name,(async(V,E)=>{let Y;const H=this._getLODs(V,I,this._loader.nY.materials,E.ids);this._loader.logOpen(`${V}`);for(let I=0;I<H.length;I++){const V=H[I];0!==I&&(this._materialIndexLOD=I);const E=this._loader._loadMaterialAsync(`/materials/${V.index}`,V,A,B,(V=>{0===I&&F(V)})).then((V=>{if(0!==I){F(V);const A=H[I-1]._data;A[B]&&(this._disposeMaterials([A[B].babylonMaterial]),delete A[B])}return V}));this._materialPromiseLODs[I]=this._materialPromiseLODs[I]||[],0===I?Y=E:(this._materialIndexLOD=null,this._materialPromiseLODs[I].push(E))}return this._loader.logClose(),await Y}))}_loadUriAsync(V,I,A){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const F=this._nodeIndexLOD-1;return this._nodeSignalLODs[F]=this._nodeSignalLODs[F]||new B,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(V,I,A)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const F=this._materialIndexLOD-1;return this._materialSignalLODs[F]=this._materialSignalLODs[F]||new B,this._materialSignalLODs[F].promise.then((async()=>await this._loader.loadUriAsync(V,I,A)))}return null}loadBufferAsync(V,I,A,F){if(this._loader.parent.useRangeRequests&&!I.uri){if(!this._loader.bin)throw new Error(`${V}: Uri is missing or the binary glTF is missing its binary chunk`);const I=async(V,I)=>{const E=A,Y=E+F-1;let H=V[I];return H?(H.start=Math.min(H.start,E),H.end=Math.max(H.end,Y)):(H={start:E,end:Y,loaded:new B},V[I]=H),await H.loaded.promise.then((V=>new Uint8Array(V.buffer,V.byteOffset+A-H.start,F)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?I(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?I(this._materialBufferLODs,this._materialIndexLOD):I(this._bufferLODs,0)}return null}_loadBufferLOD(V,I){const A=V[I];A&&(this._loader.log(`Loading buffer range [${A.start}-${A.end}]`),this._loader.bin.readAsync(A.start,A.end-A.start+1).then((V=>{A.loaded.resolve(V)}),(V=>{A.loaded.reject(V)})))}_getLODs(V,I,A,B){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const F=[];for(let E=B.length-1;E>=0;E--)if(F.push(K.Get(`${V}/ids/${B[E]}`,A,B[E])),F.length===this.maxLODsToLoad)return F;return F.push(I),F}_disposeTransformNode(V){const I=[],A=V.material;A&&I.push(A);for(const F of V.getChildMeshes())F.material&&I.push(F.material);V.dispose();const B=I.filter((V=>this._loader.babylonScene.meshes.every((I=>I.material!=V))));this._disposeMaterials(B)}_disposeMaterials(V){const I={};for(const A of V){for(const V of A.getActiveTextures())I[V.uniqueId]=V;A.dispose()}for(const A in I)for(const V of this._loader.babylonScene.materials)V.hasTexture(I[A])&&delete I[A];for(const A in I)I[A].dispose()}}i(cA),l(cA,!0,(V=>new bA(V)));const XA="MSFT_minecraftMesh";class PA{constructor(V){this.name=XA,this._loader=V,this.enabled=this._loader.isExtensionUsed(XA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtraAsync(V,I,this.name,(async(B,F)=>{if(F){if(!(A instanceof o.b))throw new Error(`${B}: Material type not supported`);const F=this._loader.loadMaterialPropertiesAsync(V,I,A);return A.needAlphaBlending()&&(A.forceDepthWrite=!0,A.separateCullingPass=!0),A.bH=A.forceDepthWrite,A.twoSidedLighting=!0,await F}}))}}i(XA),l(XA,!0,(V=>new PA(V)));const JA="MSFT_sRGBFactors";class GA{constructor(V){this.name=JA,this._loader=V,this.enabled=this._loader.isExtensionUsed(JA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,I,A){return j.LoadExtraAsync(V,I,this.name,(async(B,F)=>{if(F){if(!(A instanceof o.b))throw new Error(`${B}: Material type not supported`);const F=this._loader.loadMaterialPropertiesAsync(V,I,A),E=A.sV().getEngine().useExactSrgbConversions;return A.albedoTexture||A.albedoColor.toLinearSpaceToRef(A.albedoColor,E),A.reflectivityTexture||A.reflectivityColor.toLinearSpaceToRef(A.reflectivityColor,E),await F}}))}}i(JA),l(JA,!0,(V=>new GA(V)));var wA=A(12942);const tA={};var uA=A(12997),WA=A(12975),gA=A(12946),oA=A(12954);function LA(V,I){for(const A of V)for(const V of A.dataOutputs)if(V.uniqueId===I)return V;throw new Error("Could not find data out connection with unique id "+I)}function zA(V,I){for(const A of V)if(A instanceof WA.b)for(const V of A.signalInputs)if(V.uniqueId===I)return V;throw new Error("Could not find signal in connection with unique id "+I)}async function mA(V,I){const B=await Promise.all(V.allBlocks.map((async V=>{const I=function(V){switch(V){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([A.e(78),A.e(79)]).then(A.bind(A,14305))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await A.e(80).then(A.bind(A,14314))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await A.e(81).then(A.bind(A,14320))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await A.e(82).then(A.bind(A,14327))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await A.e(83).then(A.bind(A,14329))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await A.e(84).then(A.bind(A,14333))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await A.e(85).then(A.bind(A,14336))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await A.e(86).then(A.bind(A,14343))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await A.e(87).then(A.bind(A,14348))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await A.e(90).then(A.bind(A,14382))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await A.e(90).then(A.bind(A,14382))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await A.e(90).then(A.bind(A,14382))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await A.e(90).then(A.bind(A,14382))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await A.e(95).then(A.bind(A,14390))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await A.e(96).then(A.bind(A,14393))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await A.e(97).then(A.bind(A,14395))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await A.e(98).then(A.bind(A,14401))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await A.e(99).then(A.bind(A,14407))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await A.e(100).then(A.bind(A,14414))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await A.e(101).then(A.bind(A,14420))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await A.e(102).then(A.bind(A,14426))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await A.e(103).then(A.bind(A,14433))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await A.e(104).then(A.bind(A,14440))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await A.e(105).then(A.bind(A,14447))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await A.e(106).then(A.bind(A,14456))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await A.e(107).then(A.bind(A,14464))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await A.e(108).then(A.bind(A,14470))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await A.e(109).then(A.bind(A,14477))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await A.e(110).then(A.bind(A,14480))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await A.e(111).then(A.bind(A,14483))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await A.e(112).then(A.bind(A,14491))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await A.e(113).then(A.bind(A,14498))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await A.e(92).then(A.bind(A,14502))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await A.e(114).then(A.bind(A,14509))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await A.e(115).then(A.bind(A,14512))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await A.e(116).then(A.bind(A,14520))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await A.e(93).then(A.bind(A,14525))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await A.e(88).then(A.bind(A,14354))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await A.e(94).then(A.bind(A,14531))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await A.e(94).then(A.bind(A,14531))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await A.e(94).then(A.bind(A,14531))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await A.e(94).then(A.bind(A,14531))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await A.e(94).then(A.bind(A,14531))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await A.e(94).then(A.bind(A,14531))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await A.e(94).then(A.bind(A,14531))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await A.e(94).then(A.bind(A,14531))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await A.e(89).then(A.bind(A,14377))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await A.e(90).then(A.bind(A,14382))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await A.e(90).then(A.bind(A,14382))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await A.e(91).then(A.bind(A,14535))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await A.e(91).then(A.bind(A,14535))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await A.e(91).then(A.bind(A,14535))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await A.e(91).then(A.bind(A,14535))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await A.e(91).then(A.bind(A,14535))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await A.e(91).then(A.bind(A,14535))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await A.e(117).then(A.bind(A,14543))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await A.e(118).then(A.bind(A,14551))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await A.e(119).then(A.bind(A,14553))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await A.e(120).then(A.bind(A,14562))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await A.e(121).then(A.bind(A,14567))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await A.e(122).then(A.bind(A,14571))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await A.e(123).then(A.bind(A,14575))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await A.e(124).then(A.bind(A,14581))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await A.e(125).then(A.bind(A,14586))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await A.e(126).then(A.bind(A,14593))).FlowGraphDataSwitchBlock;default:if(tA[V])return tA[V];throw new Error(`Unknown block name ${V}`)}}(V.className);return await I()})));return function(V,I,A){const B=I.coordinator.createGraph(),F=[],E=I.valueParseFunction??gA.b;for(let Y=0;Y<V.allBlocks.length;Y++){const H=eA(V.allBlocks[Y],{WI:I.coordinator.config.WI,pathConverter:I.pathConverter,assetsContainer:I.coordinator.config.WI,valueParseFunction:E},A[Y]);F.push(H),H instanceof uA.c&&B.addEventBlock(H)}for(const Y of F){for(const V of Y.dataInputs)for(const I of V.connectedPointIds){const A=LA(F,I);V.connectTo(A)}if(Y instanceof WA.b)for(const V of Y.signalOutputs)for(const I of V.connectedPointIds){const A=zA(F,I);V.connectTo(A)}}for(const Y of V.executionContexts)sA(Y,{graph:B,valueParseFunction:E},V.rightHanded);return B}(V,I,B)}function sA(V,I,A){const B=I.graph.createContext();V.enableLogging&&(B.enableLogging=!0),B.treatDataAsRightHanded=A||!1;const F=I.valueParseFunction??gA.b;B.uniqueId=V.uniqueId;const E=B.sV();if(V._assetsContext){var Y,H,c,b,X,P,J,G,w,t;const I=V._assetsContext,A={meshes:null===(Y=I.meshes)||void 0===Y?void 0:Y.map((V=>E.getMeshById(V))),lights:null===(H=I.lights)||void 0===H?void 0:H.map((V=>E.getLightByName(V))),cameras:null===(c=I.cameras)||void 0===c?void 0:c.map((V=>E.getCameraByName(V))),materials:null===(b=I.materials)||void 0===b?void 0:b.map((V=>E.getMaterialById(V))),textures:null===(X=I.textures)||void 0===X?void 0:X.map((V=>E.getTextureByName(V))),animations:null===(P=I.animations)||void 0===P?void 0:P.map((V=>E.animations.find((I=>I.name===V)))),skeletons:null===(J=I.skeletons)||void 0===J?void 0:J.map((V=>E.getSkeletonByName(V))),XG:null===(G=I.XG)||void 0===G?void 0:G.map((V=>E.getParticleSystemById(V))),animationGroups:null===(w=I.animationGroups)||void 0===w?void 0:w.map((V=>E.getAnimationGroupByName(V))),transformNodes:null===(t=I.transformNodes)||void 0===t?void 0:t.map((V=>E.getTransformNodeById(V))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],dG:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};B.assetsContext=A}for(const u in V._userVariables){const I=F(u,V._userVariables,B.assetsContext,E);B.userVariables[u]=I}for(const u in V._connectionValues){const I=F(u,V._connectionValues,B.assetsContext,E);B._setConnectionValueByKey(u,I)}return B}function eA(V,I,A){const B={},F=I.valueParseFunction??gA.b;if(V.config)for(const Y in V.config)B[Y]=F(Y,V.config,I.assetsContainer||I.WI,I.WI);if((0,gA.g)(V.className)){if(!I.pathConverter)throw new Error("Path converter is required for this block");B.pathConverter=I.pathConverter}const E=new A(B);E.uniqueId=V.uniqueId;for(let Y=0;Y<V.dataInputs.length;Y++){const I=E.getDataInput(V.dataInputs[Y].name);if(!I)throw new Error("Could not find data input with name "+V.dataInputs[Y].name+" in block "+V.className);I.deserialize(V.dataInputs[Y])}for(let Y=0;Y<V.dataOutputs.length;Y++){const I=E.getDataOutput(V.dataOutputs[Y].name);if(!I)throw new Error("Could not find data output with name "+V.dataOutputs[Y].name+" in block "+V.className);I.deserialize(V.dataOutputs[Y])}return E.metadata=V.metadata,E.deserialize&&E.deserialize(V),E}function SA(V){const[I,A]=V.split(":");return QA({op:I,extension:A})}function QA(V){var I;let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const B=V.extension?null===(I=rA[V.extension])||void 0===I?void 0:I[V.op]:MA[V.op];if(!B&&(t.b.Warn(`No mapping found for operation ${V.op} and extension ${V.extension||"KHR_interactivity"}`),A)){const I={},A={flows:{}};if(V.inputValueSockets){I.values={};for(const A in V.inputValueSockets)I.values[A]={name:A}}return V.outputValueSockets&&(A.values={},Object.keys(V.outputValueSockets).forEach((V=>{A.values[V]={name:V}}))),{MP:[],inputs:I,outputs:A}}return B}function hA(V,I,A){rA[I]||(rA[I]={}),rA[I][V]=A}const rA={BABYLON:{"flow/log":{MP:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},MA={"event/onStart":{MP:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{MP:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{MP:["FlowGraphSendCustomEventBlock"],extraProcessor(V,I,A,B,F){if("event/send"!==I.op||!V.configuration||1!==Object.keys(V.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const E=V.configuration.event.value[0];if("number"!==typeof E)throw new Error("Event id should be a number");const Y=B.arrays.events[E],H=F[0];return H.config||(H.config={}),H.config.eventId=Y.eventId,H.config.eventData=Y.eventData,F}},"event/receive":{MP:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(V,I){var A;if(!V.configuration)return t.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const B=V.configuration.event;if(!B)return t.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const F=B.value[0];if("number"!==typeof F)return t.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(A=I.events)||void 0===A?void 0:A[F])?{valid:!0}:(t.b.Error(`Event with id ${F} not found`),{valid:!1,error:`Event with id ${F} not found`})},extraProcessor(V,I,A,B,F){if("event/receive"!==I.op||!V.configuration||1!==Object.keys(V.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const E=V.configuration.event.value[0];if("number"!==typeof E)throw new Error("Event id should be a number");const Y=B.arrays.events[E],H=F[0];return H.config||(H.config={}),H.config.eventId=Y.eventId,H.config.eventData=Y.eventData,F}},"math/e":xA("FlowGraphEBlock"),"math/pi":xA("FlowGraphPIBlock"),"math/inf":xA("FlowGraphInfBlock"),"math/nan":xA("FlowGraphNaNBlock"),"math/abs":xA("FlowGraphAbsBlock"),"math/sign":xA("FlowGraphSignBlock"),"math/trunc":xA("FlowGraphTruncBlock"),"math/floor":xA("FlowGraphFloorBlock"),"math/ceil":xA("FlowGraphCeilBlock"),"math/round":{MP:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,A,B,F){var E;return(E=F[0]).config||(E.config={}),F[0].config.roundHalfAwayFromZero=!0,F}},"math/fract":xA("FlowGraphFractBlock"),"math/neg":xA("FlowGraphNegationBlock"),"math/add":xA("FlowGraphAddBlock",["a","b"],!0),"math/sub":xA("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{MP:["FlowGraphMultiplyBlock"],extraProcessor(V,I,A,B,F){var E;(E=F[0]).config||(E.config={}),F[0].config.useMatrixPerComponent=!0,F[0].config.preventIntegerFloatArithmetic=!0;let Y=-1;return Object.keys(V.values||{}).find((I=>{var A;return void 0!==(null===(A=V.values)||void 0===A?void 0:A[I].type)&&(Y=V.values[I].type,!0)})),-1!==Y&&(F[0].config.type=B.arrays.types[Y].flowGraphType),F},validation:V=>V.values?fA(V):{valid:!0}},"math/div":xA("FlowGraphDivideBlock",["a","b"],!0),"math/rem":xA("FlowGraphModuloBlock",["a","b"]),"math/min":xA("FlowGraphMinBlock",["a","b"]),"math/max":xA("FlowGraphMaxBlock",["a","b"]),"math/clamp":xA("FlowGraphClampBlock",["a","b","c"]),"math/saturate":xA("FlowGraphSaturateBlock"),"math/mix":xA("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":xA("FlowGraphEqualityBlock",["a","b"]),"math/lt":xA("FlowGraphLessThanBlock",["a","b"]),"math/le":xA("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":xA("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":xA("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":xA("FlowGraphIsNaNBlock"),"math/isinf":xA("FlowGraphIsInfBlock"),"math/select":{MP:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{MP:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":xA("FlowGraphSinBlock"),"math/cos":xA("FlowGraphCosBlock"),"math/tan":xA("FlowGraphTanBlock"),"math/asin":xA("FlowGraphASinBlock"),"math/acos":xA("FlowGraphACosBlock"),"math/atan":xA("FlowGraphATanBlock"),"math/atan2":xA("FlowGraphATan2Block",["a","b"]),"math/sinh":xA("FlowGraphSinhBlock"),"math/cosh":xA("FlowGraphCoshBlock"),"math/tanh":xA("FlowGraphTanhBlock"),"math/asinh":xA("FlowGraphASinhBlock"),"math/acosh":xA("FlowGraphACoshBlock"),"math/atanh":xA("FlowGraphATanhBlock"),"math/exp":xA("FlowGraphExponentialBlock"),"math/log":xA("FlowGraphLogBlock"),"math/log2":xA("FlowGraphLog2Block"),"math/log10":xA("FlowGraphLog10Block"),"math/sqrt":xA("FlowGraphSquareRootBlock"),"math/cbrt":xA("FlowGraphCubeRootBlock"),"math/pow":xA("FlowGraphPowerBlock",["a","b"]),"math/length":xA("FlowGraphLengthBlock"),"math/normalize":xA("FlowGraphNormalizeBlock"),"math/dot":xA("FlowGraphDotBlock",["a","b"]),"math/cross":xA("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":xA("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":xA("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{MP:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{MP:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{MP:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{MP:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{MP:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{MP:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{MP:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":xA("FlowGraphTransposeBlock"),"math/determinant":xA("FlowGraphDeterminantBlock"),"math/inverse":xA("FlowGraphInvertMatrixBlock"),"math/matmul":xA("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{MP:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"PH",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,A,B,F,E){const Y=F[0].dataInputs.find((V=>"rotationQuaternion"===V.name));if(!Y)throw new Error("Rotation quaternion input not found");return E._connectionValues[Y.uniqueId]&&(E._connectionValues[Y.uniqueId].type="Quaternion"),F}},"math/matDecompose":{MP:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"PH"}}}},"math/quatConjugate":xA("FlowGraphConjugateBlock",["a"]),"math/quatMul":{MP:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,A,B,F){var E;return(E=F[0]).config||(E.config={}),F[0].config.type="Quaternion",F}},"math/quatAngleBetween":xA("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{MP:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":xA("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":xA("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{MP:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,A,B,F){var E;return(E=F[0]).config||(E.config={}),F[0].config.inputIsColumnMajor=!0,F}},"math/extract2x2":{MP:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{MP:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,A,B,F){var E;return(E=F[0]).config||(E.config={}),F[0].config.inputIsColumnMajor=!0,F}},"math/extract3x3":{MP:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{MP:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,A,B,F){var E;return(E=F[0]).config||(E.config={}),F[0].config.inputIsColumnMajor=!0,F}},"math/extract4x4":{MP:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{MP:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,A,B,F,E){var Y,H;(H=F[0]).config||(H.config={});const c=F[0].dataInputs[0];return F[0].config.valueType=(null===(Y=E._connectionValues[c.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",F}},"math/and":{MP:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,A,B,F,E){var Y,H,c;(c=F[0]).config||(c.config={});const b=F[0].dataInputs[0],X=F[0].dataInputs[1];return F[0].config.valueType=(null===(Y=E._connectionValues[b.uniqueId])||void 0===Y?void 0:Y.type)??(null===(H=E._connectionValues[X.uniqueId])||void 0===H?void 0:H.type)??"FlowGraphInteger",F}},"math/or":{MP:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,A,B,F,E){var Y,H,c;(c=F[0]).config||(c.config={});const b=F[0].dataInputs[0],X=F[0].dataInputs[1];return F[0].config.valueType=(null===(Y=E._connectionValues[b.uniqueId])||void 0===Y?void 0:Y.type)??(null===(H=E._connectionValues[X.uniqueId])||void 0===H?void 0:H.type)??"FlowGraphInteger",F}},"math/xor":{MP:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,I,A,B,F,E){var Y,H,c;(c=F[0]).config||(c.config={});const b=F[0].dataInputs[0],X=F[0].dataInputs[1];return F[0].config.valueType=(null===(Y=E._connectionValues[b.uniqueId])||void 0===Y?void 0:Y.type)??(null===(H=E._connectionValues[X.uniqueId])||void 0===H?void 0:H.type)??"FlowGraphInteger",F}},"math/asr":xA("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":xA("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":xA("FlowGraphLeadingZerosBlock"),"math/ctz":xA("FlowGraphTrailingZerosBlock"),"math/popcnt":xA("FlowGraphOneBitsCounterBlock"),"math/rad":xA("FlowGraphDegToRadBlock"),"math/deg":xA("FlowGraphRadToDegBlock"),"type/boolToInt":xA("FlowGraphBooleanToInt"),"type/boolToFloat":xA("FlowGraphBooleanToFloat"),"type/intToBool":xA("FlowGraphIntToBoolean"),"type/intToFloat":xA("FlowGraphIntToFloat"),"type/floatToInt":xA("FlowGraphFloatToInt"),"type/floatToBool":xA("FlowGraphFloatToBoolean"),"flow/sequence":{MP:["FlowGraphSequenceBlock"],extraProcessor(V,I,A,B,F){const E=F[0];return E.config||(E.config={}),E.config.outputSignalCount=Object.keys(V.flows||[]).length,E.signalOutputs.forEach(((V,I)=>{V.name="out_"+I})),F}},"flow/branch":{MP:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{MP:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(V){if(V.configuration&&V.configuration.cases){const I=V.configuration.cases.value;if(!I.every((V=>"number"===typeof V&&/^-?\d+$/.test(V.toString()))))return t.b.Warn("Switch cases should be integers. Using empty array instead."),V.configuration.cases.value=[],{valid:!0};const A=new Set(I);V.configuration.cases.value=Array.from(A)}return{valid:!0}},extraProcessor(V,I,A,B,F){if("flow/switch"!==I.op||!V.flows||0===Object.keys(V.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return F[0].signalOutputs.forEach((V=>{"default"!==V.name&&(V.name="out_"+V.name)})),F}},"flow/while":{MP:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{MP:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(V,I,A,B,F){const E=F[0];return E.config||(E.config={}),E.config.incrementIndexWhenLoopDone=!0,F}},"flow/doN":{MP:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{MP:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(V,I,A,B,F){if("flow/multiGate"!==I.op||!V.flows||0===Object.keys(V.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const E=F[0];return E.config||(E.config={}),E.config.outputSignalCount=Object.keys(V.flows).length,E.signalOutputs.forEach(((V,I)=>{V.name="out_"+I})),F}},"flow/waitAll":{MP:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(V){var I,A;return"number"!==typeof(null===(I=V.configuration)||void 0===I||null===(A=I.inputFlows)||void 0===A?void 0:A.value[0])&&(V.configuration=V.configuration||{inputFlows:{value:[0]}},V.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{MP:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{MP:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{MP:["FlowGraphCancelDelayBlock"]},"variable/get":{MP:["FlowGraphGetVariableBlock"],validation(V){var I,A;return null!==(I=V.configuration)&&void 0!==I&&null!==(A=I.variable)&&void 0!==A&&A.value?{valid:!0}:(t.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(V,I)=>[I.getVariableName(V[0])]}}},"variable/set":{MP:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(V,I)=>[I.getVariableName(V[0])]}}},"variable/setMultiple":{MP:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(V,I)=>[V[0].map((V=>I.getVariableName(V)))]}},extraProcessor:(V,I,A,B,F)=>(F[0].dataInputs.forEach((V=>{V.name=B.getVariableName(+V.name)})),F)},"variable/interpolate":{MP:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(V,I)=>[I.getVariableName(V[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:V=>!0===V[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",oA:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",oA:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",oA:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",oA:"FlowGraphPlayAnimationBlock"},out:{name:"out",oA:"FlowGraphPlayAnimationBlock"},done:{name:"done",oA:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(V,I,A,B,F){var E,Y,H;const c=F[0],b=null===(E=V.configuration)||void 0===E?void 0:E.variable.value[0];if("number"!==typeof b)throw t.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const X=B.arrays.staticVariables[b];"undefined"===typeof c.config.animationType.value&&(B.arrays.staticVariables,c.config.animationType.value=(0,oA.N)(X.type));const P=F[4];return P.config||(P.config={}),(Y=P.config).variable||(Y.variable={}),P.config.variable.value=B.getVariableName(b),(H=F[3]).config||(H.config={}),F}},"pointer/get":{MP:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",oA:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",oA:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(V,I,A,B,F)=>(F.forEach((V=>{"FlowGraphJsonPointerParserBlock"===V.className&&(V.config||(V.config={}),V.config.outputValue=!0)})),F)},"pointer/set":{MP:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",oA:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",oA:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(V,I,A,B,F)=>(F.forEach((V=>{"FlowGraphJsonPointerParserBlock"===V.className&&(V.config||(V.config={}),V.config.outputValue=!0)})),F)},"pointer/interpolate":{MP:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",oA:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",oA:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",oA:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",oA:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",oA:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",oA:"FlowGraphPlayAnimationBlock"},out:{name:"out",oA:"FlowGraphPlayAnimationBlock"},done:{name:"done",oA:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(V,I,A,B,F)=>(F.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className?(I.config||(I.config={}),I.config.outputValue=!0):"FlowGraphInterpolationBlock"===I.className&&(I.config||(I.config={}),Object.keys(V.values||[]).forEach((A=>{var F;const E=null===(F=V.values)||void 0===F?void 0:F[A];if("value"===A&&E){const V=E.type;void 0!==V&&(I.config.animationType=B.arrays.types[V].flowGraphType)}})))})),F)},"animation/start":{MP:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",oA:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(V,I)=>[V[0]*I._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(V,I)=>[V[0]*I._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(V,I,A,B,F,E,Y){const H=F[F.length-1];return H.config||(H.config={}),H.config.glTF=Y,F}},"animation/stop":{MP:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",oA:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(V,I,A,B,F,E,Y){const H=F[F.length-1];return H.config||(H.config={}),H.config.glTF=Y,F}},"animation/stopAt":{MP:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",oA:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(V,I)=>[V[0]*I._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(V,I,A,B,F,E,Y){const H=F[F.length-1];return H.config||(H.config={}),H.config.glTF=Y,F}},"math/switch":{MP:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(V){if(V.configuration&&V.configuration.cases){const I=V.configuration.cases.value;if(!I.every((V=>"number"===typeof V&&/^-?\d+$/.test(V.toString()))))return t.b.Warn("Switch cases should be integers. Using empty array instead."),V.configuration.cases.value=[],{valid:!0};const A=new Set(I);V.configuration.cases.value=Array.from(A)}return{valid:!0}},extraProcessor(V,I,A,B,F){const E=F[0];return E.dataInputs.forEach((V=>{"default"!==V.name&&"case"!==V.name&&(V.name="in_"+V.name)})),E.config||(E.config={}),E.config.treatCasesAsIntegers=!0,F}},"debug/log":{MP:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function xA(V){let I=arguments.length>2?arguments[2]:void 0;return{MP:[V],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((V,I)=>(V[I]={name:I},V)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(V,A,B,F,E){var Y;if(I){(Y=E[0]).config||(Y.config={}),E[0].config.preventIntegerFloatArithmetic=!0;let I=-1;Object.keys(V.values||{}).find((A=>{var B;return void 0!==(null===(B=V.values)||void 0===B?void 0:B[A].type)&&(I=V.values[A].type,!0)})),-1!==I&&(E[0].config.type=F.arrays.types[I].flowGraphType)}return E},validation:V=>I?fA(V):{valid:!0}}}function fA(V){if(V.values){const I=Object.keys(V.values).map((I=>V.values[I].type)).filter((V=>void 0!==V));if(!I.every((V=>V===I[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}MA["math/compose"]=MA["math/matCompose"],MA["math/decompose"]=MA["math/matDecompose"];var RA=A(11194);const qA={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"tI",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class NA{constructor(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=V,this._gltf=I,this._animationTargetFps=A,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const V of this._interactivityGraph.types)this._types.push(qA[V.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const V of this._interactivityGraph.declarations){const I=QA(V);if(!I)throw t.b.Error(["No mapping found for declaration",V]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:I,fullOperationName:V.extension?V.op+":"+V.extension:V.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const V of this._interactivityGraph.variables){const I=this._parseVariable(V);this._staticVariables.push(I)}}_parseVariable(V,I){const A=this._types[V.type];if(!A)throw t.b.Error(["No type found for variable",V]),new Error("Error parsing variables");if(V.value&&V.value.length!==A.length)throw t.b.Error(["Invalid value length for variable",V,A]),new Error("Error parsing variables");const B=V.value||[];if(!B.length)switch(A.flowGraphType){case"boolean":B.push(!1);break;case"FlowGraphInteger":B.push(0);break;case"number":B.push(NaN);break;case"Vector2":B.push(NaN,NaN);break;case"tI":B.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":B.fill(NaN,0,4);break;case"Matrix":B.fill(NaN,0,16);break;case"Matrix3D":B.fill(NaN,0,9)}return"number"===A.elementType&&"string"===typeof B[0]&&(B[0]=parseFloat(B[0])),{type:A.flowGraphType,value:I?I(B,this):B}}_parseEvents(){if(this._interactivityGraph.events)for(const V of this._interactivityGraph.events){const I={eventId:V.id||"internalEvent_"+this._internalEventsCounter++};V.values&&(I.eventData=Object.keys(V.values).map((I=>{var A;const B=null===(A=V.values)||void 0===A?void 0:A[I];if(!B)throw t.b.Error(["No value found for event key",I]),new Error("Error parsing events");const F=this._types[B.type];if(!F)throw t.b.Error(["No type found for event value",B]),new Error("Error parsing events");const E="undefined"!==typeof B.value?this._parseVariable(B):void 0;return{id:I,type:F.flowGraphType,eventData:!0,value:E}}))),this._events.push(I)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const I of this._interactivityGraph.nodes){if("number"!==typeof I.declaration)throw t.b.Error(["No declaration found for node",I]),new Error("Error parsing nodes");const A=this._mappings[I.declaration];if(!A)throw t.b.Error(["No mapping found for node",I]),new Error("Error parsing nodes");if(A.flowGraphMapping.validation){const B=A.flowGraphMapping.validation(I,this._interactivityGraph,this._gltf);var V;if(!B.valid)throw new Error(`Error validating interactivity node ${null===(V=this._interactivityGraph.declarations)||void 0===V?void 0:V[I.declaration].op} - ${B.error}`)}const B=[];for(const V of A.flowGraphMapping.MP){const F=this._getEmptyBlock(V,A.fullOperationName);this._parseNodeConfiguration(I,F,A.flowGraphMapping,V),B.push(F)}this._nodes.push({MP:B,fullOperationName:A.fullOperationName})}}_getEmptyBlock(V,I){return{uniqueId:(0,RA.c)(),className:V,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:I,metadata:{}}}_parseNodeConfiguration(V,I,A,B){const F=I.config;if(V.configuration){const I=Object.keys(V.configuration);for(const H of I){var E,Y;const I=null===(E=V.configuration)||void 0===E?void 0:E[H];if(!I)throw t.b.Error(["No value found for node configuration",H]),new Error("Error parsing node configuration");const c=null===(Y=A.configuration)||void 0===Y?void 0:Y[H];if(c&&c.oA?c.oA===B:0===A.MP.indexOf(B)){const V=(null===c||void 0===c?void 0:c.name)||H;I&&"undefined"!==typeof I.value||"undefined"===typeof(null===c||void 0===c?void 0:c.defaultValue)?I.value.length>=0?F[V]={value:1===I.value.length?I.value[0]:I.value}:t.b.Warn(["Invalid value for node configuration",I]):F[V]={value:c.defaultValue},c&&c.dataTransformer&&(F[V].value=c.dataTransformer([F[V].value],this)[0])}}}}_parseNodeConnections(V){for(let m=0;m<this._nodes.length;m++){var I;const s=null===(I=this._interactivityGraph.nodes)||void 0===I?void 0:I[m];if(!s)throw t.b.Error(["No node found for interactivity node",this._nodes[m]]),new Error("Error parsing node connections");const e=this._nodes[m],S=this._mappings[s.declaration];if(!S)throw t.b.Error(["No mapping found for node",s]),new Error("Error parsing node connections");const Q=s.flows||{},h=Object.keys(Q).sort();for(const V of h){var A,B,F,E;const I=Q[V],b=null===(A=S.flowGraphMapping.outputs)||void 0===A||null===(B=A.flows)||void 0===B?void 0:B[V],X=(null===b||void 0===b?void 0:b.name)||V,P=this._createNewSocketConnection(X,!0);(b&&b.oA&&e.MP.find((V=>V.className===b.oA))||e.MP[0]).signalOutputs.push(P);const J=I.node,G=this._nodes[J];if(!G)throw t.b.Error(["No node found for input node id",J]),new Error("Error parsing node connections");const w=SA(G.fullOperationName);if(!w)throw t.b.Error(["No mapping found for input node",G]),new Error("Error parsing node connections");let u=null===(F=w.inputs)||void 0===F||null===(E=F.flows)||void 0===E?void 0:E[I.socket||"in"],W=!1;if(!u)for(const V in null===(Y=w.inputs)||void 0===Y?void 0:Y.flows){var Y,H,c;if(V.startsWith("[")&&V.endsWith("]"))W=!0,u=null===(H=w.inputs)||void 0===H||null===(c=H.flows)||void 0===c?void 0:c[V]}const g=u?W?u.name.replace("$1",I.socket||""):u.name:I.socket||"in",o=u&&u.oA&&G.MP.find((V=>V.className===u.oA))||G.MP[0];let L=o.signalInputs.find((V=>V.name===g));L||(L=this._createNewSocketConnection(g),o.signalInputs.push(L)),L.connectedPointIds.push(P.uniqueId),P.connectedPointIds.push(L.uniqueId)}const r=s.values||{},M=Object.keys(r);for(const I of M){var b,X;const A=r[I];let B=null===(b=S.flowGraphMapping.inputs)||void 0===b||null===(X=b.values)||void 0===X?void 0:X[I],F=!1;if(!B)for(const V in null===(P=S.flowGraphMapping.inputs)||void 0===P?void 0:P.values){var P,J,G;if(V.startsWith("[")&&V.endsWith("]"))F=!0,B=null===(J=S.flowGraphMapping.inputs)||void 0===J||null===(G=J.values)||void 0===G?void 0:G[V]}const E=B?F?B.name.replace("$1",I):B.name:I,Y=this._createNewSocketConnection(E);if((B&&B.oA&&e.MP.find((V=>V.className===B.oA))||e.MP[0]).dataInputs.push(Y),void 0!==A.value){const I=this._parseVariable(A,B&&B.dataTransformer);V._connectionValues[Y.uniqueId]=I}else{if("undefined"===typeof A.node)throw t.b.Error(["Invalid value for value connection",A]),new Error("Error parsing node connections");{var w,u,W;const V=A.node,I=A.socket||"value",B=this._nodes[V];if(!B)throw t.b.Error(["No node found for output socket reference",A]),new Error("Error parsing node connections");const F=SA(B.fullOperationName);if(!F)throw t.b.Error(["No mapping found for output socket reference",A]),new Error("Error parsing node connections");let E=null===(w=F.outputs)||void 0===w||null===(u=w.values)||void 0===u?void 0:u[I],H=!1;if(!E)for(const A in null===(g=F.outputs)||void 0===g?void 0:g.values){var g,o,L;if(A.startsWith("[")&&A.endsWith("]"))H=!0,E=null===(o=F.outputs)||void 0===o||null===(L=o.values)||void 0===L?void 0:L[A]}const c=E?H?E.name.replace("$1",I):null===(W=E)||void 0===W?void 0:W.name:I,b=E&&E.oA&&B.MP.find((V=>V.className===E.oA))||B.MP[0];let X=b.dataOutputs.find((V=>V.name===c));X||(X=this._createNewSocketConnection(c,!0),b.dataOutputs.push(X)),Y.connectedPointIds.push(X.uniqueId),X.connectedPointIds.push(Y.uniqueId)}}}if(S.flowGraphMapping.interBlockConnectors)for(const V of S.flowGraphMapping.interBlockConnectors){const I=V.input,A=V.output,B=V.isVariable;this._connectFlowGraphNodes(I,A,e.MP[V.inputBlockIndex],e.MP[V.outputBlockIndex],B)}if(S.flowGraphMapping.extraProcessor){var z;const I=null===(z=this._interactivityGraph.declarations)||void 0===z?void 0:z[s.declaration];if(!I)throw t.b.Error(["No declaration found for extra processor",s]),new Error("Error parsing node connections");e.MP=S.flowGraphMapping.extraProcessor(s,I,S.flowGraphMapping,this,e.MP,V,this._gltf)}}}_createNewSocketConnection(V,I){return{uniqueId:(0,RA.c)(),name:V,_connectionType:I?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(V,I,A,B,F){const E=F?A.dataInputs:A.signalInputs,Y=F?B.dataOutputs:B.signalOutputs,H=E.find((I=>I.name===V))||this._createNewSocketConnection(V),c=Y.find((V=>V.name===I))||this._createNewSocketConnection(I,!0);E.find((I=>I.name===V))||E.push(H),Y.find((V=>V.name===I))||Y.push(c),H.connectedPointIds.push(c.uniqueId),c.connectedPointIds.push(H.uniqueId)}getVariableName(V){return"staticVariable_"+V}serializeToFlowGraph(){const V={uniqueId:(0,RA.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(V);for(let I=0;I<this._staticVariables.length;I++){const A=this._staticVariables[I];V._userVariables[this.getVariableName(I)]=A}return{rightHanded:!0,allBlocks:this._nodes.reduce(((V,I)=>V.concat(I.MP)),[]),executionContexts:[V]}}}const lA="KHR_interactivity";class iA{constructor(V){this._loader=V,this.name=lA,this.enabled=this._loader.isExtensionUsed(lA),this._pathConverter=(0,y.i)(this._loader.nY),V._skipStartAnimationStep=!0;const I=V.babylonScene;I&&function(V){(0,y.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!V.activeCamera)return new F.Quaternion(NaN,NaN,NaN,NaN);const I=F.Quaternion.FromRotationMatrix(V.activeCamera.getWorldMatrix()).normalize();return V.useRightHandedSystem||(I.w*=-1,I.x*=-1),I},type:"Quaternion",getTarget:()=>V.activeCamera}),(0,y.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!V.activeCamera)return new F.tI(NaN,NaN,NaN);const I=V.activeCamera.getWorldMatrix().getTranslation();return V.useRightHandedSystem||(I.x*=-1),I},type:"tI",getTarget:()=>V.activeCamera}),(0,y.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:V=>{var I;return(null===(I=V._babylonAnimationGroup)||void 0===I?void 0:I.isPlaying)??!1},type:"boolean",getTarget:V=>V._babylonAnimationGroup}),(0,y.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:V=>{var I;return((null===(I=V._babylonAnimationGroup)||void 0===I?void 0:I.from)??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup}),(0,y.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:V=>{var I;return((null===(I=V._babylonAnimationGroup)||void 0===I?void 0:I.to)??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup}),(0,y.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:V=>{var I;return((null===(I=V._babylonAnimationGroup)||void 0===I?void 0:I.getCurrentFrame())??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup}),(0,y.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:V=>{var I;return((null===(I=V._babylonAnimationGroup)||void 0===I?void 0:I.getCurrentFrame())??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup})}(I)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var V;if(!this._loader.babylonScene||!this._pathConverter)return;const I=this._loader.babylonScene,A=null===(V=this._loader.nY.extensions)||void 0===V?void 0:V.KHR_interactivity;if(!A)return;const B=new wA.b({WI:I});B.dispatchEventsSynchronously=!1;const F=A.graphs.map((V=>new NA(V,this._loader.nY,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(F.map((async V=>await mA(V,{coordinator:B,pathConverter:this._pathConverter})))),B.start()}}var yA;yA=async()=>(await Promise.resolve().then(A.bind(A,13019))).FlowGraphGLTFDataProvider,tA[`${lA}/${"FlowGraphGLTFDataProvider"}`]=yA,i(lA),l(lA,!0,(V=>new iA(V)));const vA="KHR_node_visibility";(0,y.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:V=>{const I=V._babylonTransformNode;return!I||void 0===I.isVisible||I.isVisible},set:(V,I)=>{var A,B;null===(A=I._primitiveBabylonMeshes)||void 0===A||A.forEach((V=>{V.inheritVisibility=!0})),I._babylonTransformNode&&(I._babylonTransformNode.isVisible=V),null===(B=I._primitiveBabylonMeshes)||void 0===B||B.forEach((I=>{I.isVisible=V}))},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class CA{constructor(V){this.name=vA,this._loader=V,this.enabled=V.isExtensionUsed(vA)}async onReady(){var V;null===(V=this._loader.nY.nodes)||void 0===V||V.forEach((V=>{var I,A,B,F;(null===(I=V._primitiveBabylonMeshes)||void 0===I||I.forEach((V=>{V.inheritVisibility=!0})),null!==(A=V.extensions)&&void 0!==A&&A.KHR_node_visibility)&&(!1===(null===(B=V.extensions)||void 0===B?void 0:B.KHR_node_visibility.visible)&&(V._babylonTransformNode&&(V._babylonTransformNode.isVisible=!1),null===(F=V._primitiveBabylonMeshes)||void 0===F||F.forEach((V=>{V.isVisible=!1}))))}))}dispose(){this._loader=null}}i(vA),l(vA,!0,(V=>new CA(V)));const KA="KHR_node_selectability";hA("event/onSelect",KA,{MP:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",oA:"FlowGraphGetVariableBlock",dataTransformer:V=>["pickedMesh_"+V[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",oA:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(V,I,A,B,F,E,Y){var H,c,b,X,P,J;const G=F[F.length-1];G.config=G.config||{},G.config.glTF=Y;const w=null===(H=V.configuration)||void 0===H||null===(c=H.nodeIndex)||void 0===c?void 0:c.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const t="pickedMesh_"+w;return F[1].config.variable=t,E._userVariables[t]={className:"Mesh",id:null===Y||void 0===Y||null===(b=Y.nodes)||void 0===b||null===(X=b[w]._babylonTransformNode)||void 0===X?void 0:X.id,uniqueId:null===Y||void 0===Y||null===(P=Y.nodes)||void 0===P||null===(J=P[w]._babylonTransformNode)||void 0===J?void 0:J.uniqueId},F}}),(0,y.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:V=>{const I=V._babylonTransformNode;return!I||void 0===I.IX||I.IX},set:(V,I)=>{var A;null===(A=I._primitiveBabylonMeshes)||void 0===A||A.forEach((I=>{I.IX=V}))},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"IX"],type:"boolean"});class pA{constructor(V){this.name=KA,this._loader=V,this.enabled=V.isExtensionUsed(KA)}async onReady(){var V;null===(V=this._loader.nY.nodes)||void 0===V||V.forEach((V=>{var I,A,B;null!==(I=V.extensions)&&void 0!==I&&I.KHR_node_selectability&&!1===(null===(A=V.extensions)||void 0===A?void 0:A.KHR_node_selectability.selectable)&&(null===(B=V._babylonTransformNode)||void 0===B||B.getChildMeshes().forEach((V=>{V.IX=!1})))}))}dispose(){this._loader=null}}i(KA),l(KA,!0,(V=>new pA(V)));const jA="KHR_node_hoverability",TA="targetMeshPointerOver_";hA("event/onHoverIn",jA,{MP:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",oA:"FlowGraphGetVariableBlock",dataTransformer:V=>[TA+V[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",oA:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(V,I,A,B,F,E,Y){var H,c,b,X,P,J;const G=F[F.length-1];G.config=G.config||{},G.config.glTF=Y;const w=null===(H=V.configuration)||void 0===H||null===(c=H.nodeIndex)||void 0===c?void 0:c.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const t=TA+w;return F[1].config.variable=t,E._userVariables[t]={className:"Mesh",id:null===Y||void 0===Y||null===(b=Y.nodes)||void 0===b||null===(X=b[w]._babylonTransformNode)||void 0===X?void 0:X.id,uniqueId:null===Y||void 0===Y||null===(P=Y.nodes)||void 0===P||null===(J=P[w]._babylonTransformNode)||void 0===J?void 0:J.uniqueId},F}});const dA="targetMeshPointerOut_";hA("event/onHoverOut",jA,{MP:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",oA:"FlowGraphGetVariableBlock",dataTransformer:V=>[dA+V[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",oA:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(V,I,A,B,F,E,Y){var H,c,b,X,P,J;const G=F[F.length-1];G.config=G.config||{},G.config.glTF=Y;const w=null===(H=V.configuration)||void 0===H||null===(c=H.nodeIndex)||void 0===c?void 0:c.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const t=dA+w;return F[1].config.variable=t,E._userVariables[t]={className:"Mesh",id:null===Y||void 0===Y||null===(b=Y.nodes)||void 0===b||null===(X=b[w]._babylonTransformNode)||void 0===X?void 0:X.id,uniqueId:null===Y||void 0===Y||null===(P=Y.nodes)||void 0===P||null===(J=P[w]._babylonTransformNode)||void 0===J?void 0:J.uniqueId},F}}),(0,y.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:V=>{const I=V._babylonTransformNode;return!I||void 0===I.pointerOverDisableMeshTesting||I.pointerOverDisableMeshTesting},set:(V,I)=>{var A;null===(A=I._primitiveBabylonMeshes)||void 0===A||A.forEach((I=>{I.pointerOverDisableMeshTesting=!V}))},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class DA{constructor(V){this.name=jA,this._loader=V,this.enabled=V.isExtensionUsed(jA)}async onReady(){var V;null===(V=this._loader.nY.nodes)||void 0===V||V.forEach((V=>{var I,A,B;null!==(I=V.extensions)&&void 0!==I&&I.KHR_node_hoverability&&!1===(null===(A=V.extensions)||void 0===A?void 0:A.KHR_node_hoverability.hoverable)&&(null===(B=V._babylonTransformNode)||void 0===B||B.getChildMeshes().forEach((V=>{V.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}i(jA),l(jA,!0,(V=>new DA(V)));const OA="ExtrasAsMetadata";class ZA{_assignExtras(V,I){if(I.extras&&Object.keys(I.extras).length>0){const A=V.metadata=V.metadata||{};(A.nY=A.nY||{}).extras=I.extras}}constructor(V){this.name=OA,this.enabled=!0,this._loader=V}dispose(){this._loader=null}loadNodeAsync(V,I,A){return this._loader.loadNodeAsync(V,I,(V=>{this._assignExtras(V,I),A(V)}))}loadCameraAsync(V,I,A){return this._loader.loadCameraAsync(V,I,(V=>{this._assignExtras(V,I),A(V)}))}createMaterial(V,I,A){const B=this._loader.createMaterial(V,I,A);return this._assignExtras(B,I),B}}i(OA),l(OA,!1,(V=>new ZA(V)));A(13019)},12890:(V,I,A)=>{"use strict";A.d(I,{e:()=>f,g:()=>S,k:()=>e,m:()=>Q});var B=A(11057),F=A(11052),E=A(12539),Y=A(11701),H=A(11661),c=A(11669),b=A(11064),X=A(11097),P=A(11693),J=A(11803),G=A(11707),w=A(11273);class t{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.XG=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.dG=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(V){this._environmentTexture=V}getNodes(){let V=[];V=V.concat(this.meshes),V=V.concat(this.lights),V=V.concat(this.cameras),V=V.concat(this.transformNodes);for(const I of this.skeletons)V=V.concat(I.bones);return V}}class u extends t{}class W{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const V=this.rootNodes;for(const B of V)B.dispose();V.length=0;const I=this.skeletons;for(const B of I)B.dispose();I.length=0;const A=this.animationGroups;for(const B of A)B.dispose();A.length=0}}class g extends t{constructor(V){super(),this._wasAddedToScene=!1,(V=V||X.e.LastCreatedScene)&&(this.WI=V,this.proceduralTextures=[],V.aY.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=V.getEngine().onContextRestoredObservable.add((()=>{for(const V of this.geometries)V._rebuild();for(const V of this.meshes)V._rebuild();for(const V of this.XG)V.rebuild();for(const V of this.textures)V._rebuild()})))}_topologicalSort(V){const I=new Map;for(const Y of V)I.set(Y.uniqueId,Y);const A={dependsOn:new Map,dependedBy:new Map};for(const Y of V){const V=Y.uniqueId;A.dependsOn.set(V,new Set),A.dependedBy.set(V,new Set)}for(const Y of V){const V=Y.uniqueId,B=A.dependsOn.get(V);if(Y instanceof P.b){const F=Y.sourceMesh;I.has(F.uniqueId)&&(B.add(F.uniqueId),A.dependedBy.get(F.uniqueId).add(V))}const F=A.dependedBy.get(V);for(const E of Y.getDescendants()){const B=E.uniqueId;if(I.has(B)){F.add(B);A.dependsOn.get(B).add(V)}}}const B=[],F=[];for(const Y of V){const V=Y.uniqueId;0===A.dependsOn.get(V).size&&(F.push(Y),I.delete(V))}const E=F;for(;E.length>0;){const V=E.shift();B.push(V);const F=A.dependedBy.get(V.uniqueId);for(const B of Array.from(F.values())){const F=A.dependsOn.get(B);F.delete(V.uniqueId),0===F.size&&I.get(B)&&(E.push(I.get(B)),I.delete(B))}}return I.size>0&&(b.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),I.forEach((V=>{b.b.Error(V.name)}))),B}_addNodeAndDescendantsToList(V,I,A,B){if(A&&(!B||B(A))&&!I.has(A.uniqueId)){V.push(A),I.add(A.uniqueId);for(const F of A.getDescendants(!0))this._addNodeAndDescendantsToList(V,I,F,B)}}_isNodeInContainer(V){return V instanceof c.c&&-1!==this.meshes.indexOf(V)||(V instanceof H.e&&-1!==this.transformNodes.indexOf(V)||(V instanceof J.c&&-1!==this.lights.indexOf(V)||V instanceof G.c&&-1!==this.cameras.indexOf(V)))}_isValidHierarchy(){for(const V of this.meshes)if(V.parent&&!this._isNodeInContainer(V.parent))return b.b.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.transformNodes)if(V.parent&&!this._isNodeInContainer(V.parent))return b.b.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.lights)if(V.parent&&!this._isNodeInContainer(V.parent))return b.b.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.cameras)if(V.parent&&!this._isNodeInContainer(V.parent))return b.b.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(V){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||F.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const B={},E={},H=new W,c=[],b=[],X={doNotInstantiate:!0,...A},P=[],J=new Set;for(const F of this.transformNodes)null===F.parent&&this._addNodeAndDescendantsToList(P,J,F,X.predicate);for(const F of this.meshes)null===F.parent&&this._addNodeAndDescendantsToList(P,J,F,X.predicate);const G=this._topologicalSort(P),w=(A,F)=>{if(((I,A)=>{if(B[I.uniqueId]=A.uniqueId,E[A.uniqueId]=A,V&&(A.name=V(I.name)),A instanceof Y.c){const V=A;if(V.morphTargetManager){const A=I.morphTargetManager;V.morphTargetManager=A.clone();for(let I=0;I<A.numTargets;I++){const F=A.getTarget(I),Y=V.morphTargetManager.getTarget(I);B[F.uniqueId]=Y.uniqueId,E[Y.uniqueId]=Y}}}})(A,F),A.parent){const V=B[A.parent.uniqueId],I=E[V];F.parent=I||A.parent}if(F.position&&A.position&&F.position.B(A.position),F.rotationQuaternion&&A.rotationQuaternion&&F.rotationQuaternion.B(A.rotationQuaternion),F.rotation&&A.rotation&&F.rotation.B(A.rotation),F.PH&&A.PH&&F.PH.B(A.PH),F.material){const Y=F;if(Y.material)if(I){const I=A.material;if(-1===b.indexOf(I)){let A=I.clone(V?V(I.name):"Clone of "+I.name);if(b.push(I),B[I.uniqueId]=A.uniqueId,E[A.uniqueId]=A,"MultiMaterial"===I.getClassName()){const F=I;for(const I of F.wH)I&&(A=I.clone(V?V(I.name):"Clone of "+I.name),b.push(I),B[I.uniqueId]=A.uniqueId,E[A.uniqueId]=A);F.wH=F.wH.map((V=>V&&E[B[V.uniqueId]]))}}"InstancedMesh"!==Y.getClassName()&&(Y.material=E[B[I.uniqueId]])}else"MultiMaterial"===Y.material.getClassName()?-1===this.WI.multiMaterials.indexOf(Y.material)&&this.WI.addMultiMaterial(Y.material):-1===this.WI.materials.indexOf(Y.material)&&this.WI.addMaterial(Y.material)}null===F.parent&&H.rootNodes.push(F)};for(const F of G)if("InstancedMesh"===F.getClassName()){const V=F,I=V.sourceMesh,A=B[I.uniqueId];w(V,("number"===typeof A?E[A]:I).createInstance(V.name))}else{let V=!0;"Bc"===F.getClassName()||"Node"===F.getClassName()||F.skeleton||!F.getTotalVertices||0===F.getTotalVertices()?V=!1:X.doNotInstantiate&&(V="function"===typeof X.doNotInstantiate?!X.doNotInstantiate(F):!X.doNotInstantiate);const I=V?F.createInstance(`instance of ${F.name}`):F.clone(`Clone of ${F.name}`,null,!0);if(!I)throw new Error(`Could not clone or instantiate node on Asset Container ${F.name}`);w(F,I)}for(const F of this.skeletons){if(X.predicate&&!X.predicate(F))continue;const I=F.clone(V?V(F.name):"Clone of "+F.name);for(const V of this.meshes)if(V.skeleton===F&&!V.isAnInstance){const A=E[B[V.uniqueId]];if(!A||A.isAnInstance)continue;if(A.skeleton=I,-1!==c.indexOf(I))continue;c.push(I);for(const V of I.bones)V._linkedTransformNode&&(V._linkedTransformNode=E[B[V._linkedTransformNode.uniqueId]])}H.skeletons.push(I)}for(const F of this.animationGroups){if(X.predicate&&!X.predicate(F))continue;const I=F.clone(V?V(F.name):"Clone of "+F.name,(V=>E[B[V.uniqueId]]||V));H.animationGroups.push(I)}return H}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||F.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.WI.environmentTexture=this.environmentTexture);for(const V of this.WI._serializableComponents)V.addFromContainer(this);this.WI.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const I=[];for(const A of this.cameras)V&&!V(A)||(this.WI.addCamera(A),I.push(A));for(const A of this.lights)V&&!V(A)||(this.WI.addLight(A),I.push(A));for(const A of this.meshes)V&&!V(A)||(this.WI.WP(A),I.push(A));for(const A of this.skeletons)V&&!V(A)||this.WI.addSkeleton(A);for(const A of this.animations)V&&!V(A)||this.WI.addAnimation(A);for(const A of this.animationGroups)V&&!V(A)||this.WI.addAnimationGroup(A);for(const A of this.multiMaterials)V&&!V(A)||this.WI.addMultiMaterial(A);for(const A of this.materials)V&&!V(A)||this.WI.addMaterial(A);for(const A of this.morphTargetManagers)V&&!V(A)||this.WI.addMorphTargetManager(A);for(const A of this.geometries)V&&!V(A)||this.WI.addGeometry(A);for(const A of this.transformNodes)V&&!V(A)||(this.WI.addTransformNode(A),I.push(A));for(const A of this.actionManagers)V&&!V(A)||this.WI.addActionManager(A);for(const A of this.textures)V&&!V(A)||this.WI.addTexture(A);for(const A of this.reflectionProbes)V&&!V(A)||this.WI.addReflectionProbe(A);for(const A of I)A.parent&&-1===this.WI.getNodes().indexOf(A.parent)&&(A.setParent?A.setParent(null):A.parent=null)}removeAllFromScene(){this._isValidHierarchy()||F.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.WI.environmentTexture&&(this.WI.environmentTexture=null);for(const V of this.WI._serializableComponents)V.removeFromContainer(this)}removeFromScene(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const I of this.cameras)V&&!V(I)||this.WI.removeCamera(I);for(const I of this.lights)V&&!V(I)||this.WI.removeLight(I);for(const I of this.meshes)V&&!V(I)||this.WI.uP(I,!0);for(const I of this.skeletons)V&&!V(I)||this.WI.removeSkeleton(I);for(const I of this.animations)V&&!V(I)||this.WI.removeAnimation(I);for(const I of this.animationGroups)V&&!V(I)||this.WI.removeAnimationGroup(I);for(const I of this.multiMaterials)V&&!V(I)||this.WI.removeMultiMaterial(I);for(const I of this.materials)V&&!V(I)||this.WI.removeMaterial(I);for(const I of this.morphTargetManagers)V&&!V(I)||this.WI.removeMorphTargetManager(I);for(const I of this.geometries)V&&!V(I)||this.WI.removeGeometry(I);for(const I of this.transformNodes)V&&!V(I)||this.WI.removeTransformNode(I);for(const I of this.actionManagers)V&&!V(I)||this.WI.removeActionManager(I);for(const I of this.textures)V&&!V(I)||this.WI.removeTexture(I);for(const I of this.reflectionProbes)V&&!V(I)||this.WI.removeReflectionProbe(I)}dispose(){const V=this.cameras.slice(0);for(const G of V)G.dispose();this.cameras.length=0;const I=this.lights.slice(0);for(const G of I)G.dispose();this.lights.length=0;const A=this.meshes.slice(0);for(const G of A)G.dispose();this.meshes.length=0;const B=this.skeletons.slice(0);for(const G of B)G.dispose();this.skeletons.length=0;const F=this.animationGroups.slice(0);for(const G of F)G.dispose();this.animationGroups.length=0;const E=this.multiMaterials.slice(0);for(const G of E)G.dispose();this.multiMaterials.length=0;const Y=this.materials.slice(0);for(const G of Y)G.dispose();this.materials.length=0;const H=this.geometries.slice(0);for(const G of H)G.dispose();this.geometries.length=0;const c=this.transformNodes.slice(0);for(const G of c)G.dispose();this.transformNodes.length=0;const b=this.actionManagers.slice(0);for(const G of b)G.dispose();this.actionManagers.length=0;const X=this.textures.slice(0);for(const G of X)G.dispose();this.textures.length=0;const P=this.reflectionProbes.slice(0);for(const G of P)G.dispose();this.reflectionProbes.length=0;const J=this.morphTargetManagers.slice(0);for(const G of J)G.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const G of this.WI._serializableComponents)G.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.WI.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(V,I,A){if(V&&I)for(const B of V){let V=!0;if(A)for(const I of A)if(B===I){V=!1;break}V&&(I.push(B),B._parentContainer=this)}}moveAllFromScene(V){this._wasAddedToScene=!1,void 0===V&&(V=new u);for(const I in this)Object.prototype.hasOwnProperty.call(this,I)&&(this[I]=this[I]||("_environmentTexture"===I?null:[]),this._moveAssets(this.WI[I],this[I],V[I]));this.environmentTexture=this.WI.environmentTexture,this.removeAllFromScene()}createRootMesh(){const V=new Y.c("assetContainerRootMesh",this.WI);for(const I of this.meshes)I.parent||V.addChild(I);return this.meshes.unshift(V),V}mergeAnimationsTo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.e.LastCreatedScene,I=arguments.length>1?arguments[1]:void 0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!V)return b.b.Error("No scene available to merge animations to"),[];const B=A||(I=>{let A=null;const B=I.animations.length?I.animations[0].targetProperty:"",F=I.name.split(".").join("").split("_primitive")[0];switch(B){case"position":case"rotationQuaternion":A=V.getTransformNodeByName(I.name)||V.getTransformNodeByName(F);break;case"influence":A=V.getMorphTargetByName(I.name)||V.getMorphTargetByName(F);break;default:A=V.getNodeByName(I.name)||V.getNodeByName(F)}return A}),F=this.getNodes();for(const H of F){const V=B(H);if(null!==V){for(const I of H.animations){const A=V.animations.filter((V=>V.targetProperty===I.targetProperty));for(const I of A){const A=V.animations.indexOf(I,0);A>-1&&V.animations.splice(A,1)}}V.animations=V.animations.concat(H.animations)}}const E=[],Y=this.animationGroups.slice();for(const H of Y){E.push(H.clone(H.name,B));for(const V of H.animatables)V.stop()}for(const H of I){const I=B(H.target);I&&(V.beginAnimation(I,H.fromFrame,H.toFrame,H.loopAnimation,H.speedRatio,H.onAnimationEnd?H.onAnimationEnd:void 0,void 0,!0,void 0,H.onAnimationLoop?H.onAnimationLoop:void 0),V.stopAnimation(H.target))}return E}populateRootNodes(){this.rootNodes.length=0;for(const V of this.meshes)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V);for(const V of this.transformNodes)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V);for(const V of this.lights)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V);for(const V of this.cameras)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)}addAllAssetsToContainer(V){if(!V)return;const I=[],A=new Set;for(I.push(V);I.length>0;){const V=I.pop();if(V instanceof Y.c?(V.HH&&-1===this.geometries.indexOf(V.HH)&&this.geometries.push(V.HH),this.meshes.push(V)):V instanceof P.b?this.meshes.push(V):V instanceof H.e?this.transformNodes.push(V):V instanceof J.c?this.lights.push(V):V instanceof G.c&&this.cameras.push(V),V instanceof c.c){if(V.material&&-1===this.materials.indexOf(V.material)){this.materials.push(V.material);for(const I of V.material.getActiveTextures())-1===this.textures.indexOf(I)&&this.textures.push(I)}V.skeleton&&-1===this.skeletons.indexOf(V.skeleton)&&this.skeletons.push(V.skeleton),V.morphTargetManager&&-1===this.morphTargetManagers.indexOf(V.morphTargetManager)&&this.morphTargetManagers.push(V.morphTargetManager)}for(const B of V.getChildren())A.has(B)||I.push(B);A.add(V)}this.populateRootNodes()}_getByTags(V,I,A){if(void 0===I)return V;const B=[];for(const F in V){const E=V[F];w.b&&w.b.MatchesQuery(E,I)&&(!A||A(E))&&B.push(E)}return B}getMeshesByTags(V,I){return this._getByTags(this.meshes,V,I)}getCamerasByTags(V,I){return this._getByTags(this.cameras,V,I)}getLightsByTags(V,I){return this._getByTags(this.lights,V,I)}getMaterialsByTags(V,I){return this._getByTags(this.materials,V,I).concat(this._getByTags(this.multiMaterials,V,I))}getTransformNodesByTags(V,I){return this._getByTags(this.transformNodes,V,I)}}var o=A(11115);class L{constructor(V){this.byteOffset=0,this.buffer=V}async loadAsync(V){const I=await this.buffer.readAsync(this.byteOffset,V);this._dataView=new DataView(I.buffer,I.byteOffset,I.byteLength),this._dataByteOffset=0}readUint32(){const V=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,V}readUint8Array(V){const I=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,V);return this._dataByteOffset+=V,this.byteOffset+=V,I}readString(V){return(0,o.j)(this.readUint8Array(V))}skipBytes(V){this._dataByteOffset+=V,this.byteOffset+=V}}var z=A(12895);const m="Z2xURg",s={name:"nY",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:V=>-1!==V.indexOf("asset")&&-1!==V.indexOf("version")||V.startsWith("data:base64,"+m)||V.startsWith("data:;base64,"+m)||V.startsWith("data:application/octet-stream;base64,"+m)||V.startsWith("data:model/gltf-binary;base64,"+m)};var e,S,Q,h=A(11105),r=A(11107);function M(V,I,A){try{return Promise.resolve(new Uint8Array(V,I,A))}catch(B){return Promise.reject(B)}}!function(V){V[V.AUTO=0]="AUTO",V[V.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(e||(e={})),function(V){V[V.NONE=0]="NONE",V[V.FIRST=1]="FIRST",V[V.ALL=2]="ALL"}(S||(S={})),function(V){V[V.LOADING=0]="LOADING",V[V.READY=1]="READY",V[V.COMPLETE=2]="COMPLETE"}(Q||(Q={}));class x{constructor(){this.coordinateSystemMode=e.AUTO,this.animationStartMode=S.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=V=>Promise.resolve(V),this.extensionOptions={}}B(V){V&&(this.onParsed=V.onParsed,this.coordinateSystemMode=V.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=V.animationStartMode??this.animationStartMode,this.loadNodeAnimations=V.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=V.loadSkins??this.loadSkins,this.loadMorphTargets=V.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=V.compileMaterials??this.compileMaterials,this.useClipPlane=V.useClipPlane??this.useClipPlane,this.compileShadowGenerators=V.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=V.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=V.useRangeRequests??this.useRangeRequests,this.createInstances=V.createInstances??this.createInstances,this.alwaysComputeBoundingBox=V.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=V.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=V.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=V.skipMaterials??this.skipMaterials,this.useSRGBBuffers=V.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=V.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=V.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=V.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=V.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=V.customRootNode,this.onMeshLoaded=V.onMeshLoaded,this.onSkinLoaded=V.onSkinLoaded,this.onTextureLoaded=V.onTextureLoaded,this.onMaterialLoaded=V.onMaterialLoaded,this.onCameraLoaded=V.onCameraLoaded,this.extensionOptions=V.extensionOptions??this.extensionOptions)}}class f extends x{constructor(V){super(),this.onParsedObservable=new B.c,this.onMeshLoadedObservable=new B.c,this.onSkinLoadedObservable=new B.c,this.onTextureLoadedObservable=new B.c,this.onMaterialLoadedObservable=new B.c,this.onCameraLoadedObservable=new B.c,this.onCompleteObservable=new B.c,this.onErrorObservable=new B.c,this.aY=new B.c,this.onExtensionLoadedObservable=new B.c,this.validate=!1,this.onValidatedObservable=new B.c,this._loader=null,this._state=null,this._requests=new Array,this.name=s.name,this.extensions=s.extensions,this.onLoaderStateChangedObservable=new B.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.B(V)}set onParsed(V){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),V&&(this._onParsedObserver=this.onParsedObservable.add(V))}set onMeshLoaded(V){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),V&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(V))}set onSkinLoaded(V){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),V&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((I=>V(I.node,I.skinnedNode))))}set onTextureLoaded(V){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),V&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(V))}set onMaterialLoaded(V){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),V&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(V))}set onCameraLoaded(V){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),V&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(V))}set onComplete(V){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(V)}set onError(V){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(V)}set onDispose(V){this._onDisposeObserver&&this.aY.remove(this._onDisposeObserver),this._onDisposeObserver=this.aY.add(V)}set onExtensionLoaded(V){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(V)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(V){this._loggingEnabled!==V&&(this._loggingEnabled=V,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(V){this._capturePerformanceCounters!==V&&(this._capturePerformanceCounters=V,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(V){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(V)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const V of this._requests)V.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=V=>Promise.resolve(V),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.aY.notifyObservers(void 0),this.aY.clear()}loadFile(V,I,A,E,Y,H,c,X){if(ArrayBuffer.isView(I))return this._loadBinary(V,I,A,E,c,X),null;this._progressCallback=Y;const P=I.name||F.Tools.GetFilename(I);if(H){if(this.useRangeRequests){this.validate&&b.b.Warn("glTF validation is not supported when range requests are enabled");const A={abort:()=>{},onCompleteObservable:new B.c},F={readAsync:(A,B)=>new Promise(((F,E)=>{this._loadFile(V,I,(V=>{F(new Uint8Array(V))}),!0,(V=>{E(V)}),(V=>{V.setRequestHeader("Range",`bytes=${A}-${A+B-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new L(F)).then((V=>{A.onCompleteObservable.notifyObservers(A),E(V)}),c?V=>c(void 0,V):void 0),A}return this._loadFile(V,I,(I=>{this._validate(V,new Uint8Array(I,0,I.byteLength),A,P),this._unpackBinaryAsync(new L({readAsync:(V,A)=>M(I,V,A),byteLength:I.byteLength})).then((V=>{E(V)}),c?V=>c(void 0,V):void 0)}),!0,c)}return this._loadFile(V,I,(I=>{try{this._validate(V,I,A,P),E({json:this._parseJson(I)})}catch{c&&c()}}),!1,c)}_loadBinary(V,I,A,B,F,E){this._validate(V,new Uint8Array(I.buffer,I.byteOffset,I.byteLength),A,E),this._unpackBinaryAsync(new L({readAsync:(V,A)=>function(V,I,A){try{if(I<0||I>=V.byteLength)throw new RangeError("Offset is out of range.");if(I+A>V.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(V.buffer,V.byteOffset+I,A))}catch(B){return Promise.reject(B)}}(I,V,A),byteLength:I.byteLength})).then((V=>{B(V)}),F?V=>F(void 0,V):void 0)}importMeshAsync(V,I,A,B,F,E){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(A),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(A),this._loader.importMeshAsync(V,I,null,A,B,F,E))))}loadAsync(V,I,A,B,F){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(I),this.onParsedObservable.clear(),this._log(`Loading ${F||""}`),this._loader=this._getLoader(I),this._loader.loadAsync(V,I,A,B,F))))}loadAssetContainerAsync(V,I,A,B,F){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(I),this.onParsedObservable.clear(),this._log(`Loading ${F||""}`),this._loader=this._getLoader(I);const E=new g(V),Y=[];this.onMaterialLoadedObservable.add((V=>{Y.push(V)}));const H=[];this.onTextureLoadedObservable.add((V=>{H.push(V)}));const c=[];this.onCameraLoadedObservable.add((V=>{c.push(V)}));const b=[];return this.onMeshLoadedObservable.add((V=>{V.morphTargetManager&&b.push(V.morphTargetManager)})),this._loader.importMeshAsync(null,V,E,I,A,B,F).then((V=>(Array.prototype.push.apply(E.geometries,V.geometries),Array.prototype.push.apply(E.meshes,V.meshes),Array.prototype.push.apply(E.XG,V.XG),Array.prototype.push.apply(E.skeletons,V.skeletons),Array.prototype.push.apply(E.animationGroups,V.animationGroups),Array.prototype.push.apply(E.materials,Y),Array.prototype.push.apply(E.textures,H),Array.prototype.push.apply(E.lights,V.lights),Array.prototype.push.apply(E.transformNodes,V.transformNodes),Array.prototype.push.apply(E.cameras,c),Array.prototype.push.apply(E.morphTargetManagers,b),E)))}))}canDirectLoad(V){return s.canDirectLoad(V)}directLoad(V,I){if(I.startsWith("base64,"+m)||I.startsWith(";base64,"+m)||I.startsWith("application/octet-stream;base64,"+m)||I.startsWith("model/gltf-binary;base64,"+m)){const A=(0,h.c)(I);return this._validate(V,new Uint8Array(A,0,A.byteLength)),this._unpackBinaryAsync(new L({readAsync:(V,I)=>M(A,V,I),byteLength:A.byteLength}))}return this._validate(V,I),Promise.resolve({json:this._parseJson(I)})}createPlugin(V){return new f(V[s.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((V,I)=>{this.onCompleteObservable.addOnce((()=>{V()})),this.onErrorObservable.addOnce((V=>{I(V)}))}))}_setState(V){this._state!==V&&(this._state=V,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(Q[this._state]))}_loadFile(V,I,A,B,F,E){const Y=V._loadFile(I,A,(V=>{this._onProgress(V,Y)}),!0,B,F,E);return Y.onCompleteObservable.add((()=>{Y._lengthComputable=!0,Y._total=Y._loaded})),this._requests.push(Y),Y}_onProgress(V,I){if(!this._progressCallback)return;I._lengthComputable=V.lengthComputable,I._loaded=V.loaded,I._total=V.total;let A=!0,B=0,F=0;for(const E of this._requests){if(void 0===E._lengthComputable||void 0===E._loaded||void 0===E._total)return;A=A&&E._lengthComputable,B+=E._loaded,F+=E._total}this._progressCallback({lengthComputable:A,loaded:B,total:A?F:0})}_validate(V,I){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),z.e.ValidateAsync(I,A,B,(I=>this.preprocessUrlAsync(A+I).then((I=>V._loadFileAsync(I,void 0,!0,!0).then((V=>new Uint8Array(V,0,V.byteLength))))))).then((V=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(V),this.onValidatedObservable.clear()}),(V=>{this._endPerformanceCounter("Validate JSON"),F.Tools.Warn(`Failed to validate: ${V.message}`),this.onValidatedObservable.clear()})))}_getLoader(V){const I=V.json.asset||{};this._log(`Asset version: ${I.version}`),I.minVersion&&this._log(`Asset minimum version: ${I.minVersion}`),I.generator&&this._log(`Asset generator: ${I.generator}`);const A=f._parseVersion(I.version);if(!A)throw new Error("Invalid version: "+I.version);if(void 0!==I.minVersion){const V=f._parseVersion(I.minVersion);if(!V)throw new Error("Invalid minimum version: "+I.minVersion);if(f._compareVersion(V,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+I.minVersion)}const B={1:f._CreateGLTF1Loader,2:f._CreateGLTF2Loader}[A.major];if(!B)throw new Error("Unsupported version: "+I.version);return B(this)}_parseJson(V){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${V.length}`);const I=JSON.parse(V);return this._endPerformanceCounter("Parse JSON"),I}_unpackBinaryAsync(V){return this._startPerformanceCounter("Unpack Binary"),V.loadAsync(20).then((()=>{const I=V.readUint32();if(1179937895!==I)throw new r.j("Unexpected magic: "+I,r.i.GLTFLoaderUnexpectedMagicError);const A=V.readUint32();this.loggingEnabled&&this._log(`Binary version: ${A}`);const B=V.readUint32();let F;switch(this.useRangeRequests||B===V.buffer.byteLength||b.b.Warn(`Length in header does not match actual data length: ${B} != ${V.buffer.byteLength}`),A){case 1:F=this._unpackBinaryV1Async(V,B);break;case 2:F=this._unpackBinaryV2Async(V,B);break;default:throw new Error("Unsupported version: "+A)}return this._endPerformanceCounter("Unpack Binary"),F}))}_unpackBinaryV1Async(V,I){const A=V.readUint32(),B=V.readUint32();if(0!==B)throw new Error(`Unexpected content format: ${B}`);const F=I-V.byteOffset,E={json:this._parseJson(V.readString(A)),bin:null};if(0!==F){const I=V.byteOffset;E.bin={readAsync:(A,B)=>V.buffer.readAsync(I+A,B),byteLength:F}}return Promise.resolve(E)}_unpackBinaryV2Async(V,I){const A=1313821514,B=5130562,F=V.readUint32();if(V.readUint32()!==A)throw new Error("First chunk format is not JSON");return V.byteOffset+F===I?V.loadAsync(F).then((()=>({json:this._parseJson(V.readString(F)),bin:null}))):V.loadAsync(F+8).then((()=>{const E={json:this._parseJson(V.readString(F)),bin:null},Y=()=>{const F=V.readUint32();switch(V.readUint32()){case A:throw new Error("Unexpected JSON chunk");case B:{const I=V.byteOffset;E.bin={readAsync:(A,B)=>V.buffer.readAsync(I+A,B),byteLength:F},V.skipBytes(F);break}default:V.skipBytes(F)}return V.byteOffset!==I?V.loadAsync(8).then(Y):Promise.resolve(E)};return Y()}))}static _parseVersion(V){if("1.0"===V||"1.0.1"===V)return{major:1,minor:0};const I=(V+"").match(/^(\d+)\.(\d+)/);return I?{major:parseInt(I[1]),minor:parseInt(I[2])}:null}static _compareVersion(V,I){return V.major>I.major?1:V.major<I.major?-1:V.minor>I.minor?1:V.minor<I.minor?-1:0}_logOpen(V){this._log(V),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(V){const I=f._logSpaces.substring(0,2*this._logIndentLevel);b.b.Log(`${I}${V}`)}_logDisabled(V){}_startPerformanceCounterEnabled(V){F.Tools.StartPerformanceCounter(V)}_startPerformanceCounterDisabled(V){}_endPerformanceCounterEnabled(V){F.Tools.EndPerformanceCounter(V)}_endPerformanceCounterDisabled(V){}}f.IncrementalLoading=!0,f.HomogeneousCoordinates=!1,f._logSpaces="                                ",(0,E.b)(new f)},12895:(V,I,A)=>{"use strict";A.d(I,{e:()=>Y});var B=A(11052);function F(V,I,A,B){const F={externalResourceFunction:B};return A&&(F.uri="file:"===I?A:I+A),ArrayBuffer.isView(V)?GLTFValidator.validateBytes(V,F):GLTFValidator.validateString(V,F)}function E(){const V=[];onmessage=I=>{const A=I.data;switch(A.id){case"init":importScripts(A.url);break;case"validate":F(A.data,A.rootUrl,A.fileName,(I=>new Promise(((A,B)=>{const F=V.length;V.push({resolve:A,reject:B}),postMessage({id:"getExternalResource",index:F,uri:I})})))).then((V=>{postMessage({id:"validate.resolve",value:V})}),(V=>{postMessage({id:"validate.reject",reason:V})}));break;case"getExternalResource.resolve":V[A.index].resolve(A.value);break;case"getExternalResource.reject":V[A.index].reject(A.reason)}}}class Y{static ValidateAsync(V,I,A,Y){return"function"===typeof Worker?new Promise(((H,c)=>{const b=`${F}(${E})()`,X=URL.createObjectURL(new Blob([b],{type:"application/javascript"})),P=new Worker(X),J=V=>{P.removeEventListener("error",J),P.removeEventListener("message",G),c(V)},G=V=>{const I=V.data;switch(I.id){case"getExternalResource":Y(I.uri).then((V=>{P.postMessage({id:"getExternalResource.resolve",index:I.index,value:V},[V.buffer])}),(V=>{P.postMessage({id:"getExternalResource.reject",index:I.index,reason:V})}));break;case"validate.resolve":P.removeEventListener("error",J),P.removeEventListener("message",G),H(I.value),P.terminate();break;case"validate.reject":P.removeEventListener("error",J),P.removeEventListener("message",G),c(I.reason),P.terminate()}};if(P.addEventListener("error",J),P.addEventListener("message",G),P.postMessage({id:"init",url:B.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(V)){const B=V.slice();P.postMessage({id:"validate",data:B,rootUrl:I,fileName:A},[B.buffer])}else P.postMessage({id:"validate",data:V,rootUrl:I,fileName:A})})):(this._LoadScriptPromise||(this._LoadScriptPromise=B.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>F(V,I,A,Y))))}}Y.Configuration={url:`${B.Tools._DefaultCdnUrl}/gltf_validator.js`}},13408:(V,I,A)=>{"use strict";A.d(I,{d:()=>s});var B=A(11213),F=A(11222),E=A(11265),Y=A(11231),H=A(11628),c=A(11553),b=A(11300),X=A(11473),P=A(11189),J=A(11152);A(12648),A(12566),A(12580),A(12571),A(12586),A(12588),A(12591);const G="imageProcessingCompatibility",w="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";J.e.IncludesShadersStore[G]||(J.e.IncludesShadersStore[G]=w);const t="skyPixelShader",u="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";J.e.ShadersStore[t]||(J.e.ShadersStore[t]=u);A(12658),A(12598),A(12606),A(12615),A(12612);const W="skyVertexShader",g="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";J.e.ShadersStore[W]||(J.e.ShadersStore[W]=g);var o=A(11546),L=A(11605),z=A(11597);class m extends H.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class s extends c.e{constructor(V,I){super(V,I),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Y.tI(0,100,0),this.useSunPosition=!1,this.cameraOffset=Y.tI.Zero(),this.up=Y.tI.Up(),this.dithering=!1,this._cameraPosition=Y.tI.Zero(),this._skyOrientation=new Y.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(V,I){const A=I._drawWrapper;if(this.isFrozen&&A.effect&&A._wasPreviouslyReady)return!0;I.materialDefines||(I.materialDefines=new m);const B=I.materialDefines,F=this.sV();if(this._isReadyForSubMesh(I))return!0;if((0,z.Q)(V,F,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,B),(0,z.E)(V,B,!0,!1),B.IMAGEPROCESSINGPOSTPROCESS!==F.imageProcessingConfiguration.applyByPostProcess&&B.markAsMiscDirty(),B.DITHER!==this.dithering&&B.markAsMiscDirty(),B.isDirty){B.markAsProcessed(),F.resetCachedMaterial();const V=new o.c;B.FOG&&V.addFallback(1,"FOG"),B.IMAGEPROCESSINGPOSTPROCESS=F.imageProcessingConfiguration.applyByPostProcess,B.DITHER=this.dithering;const A=[b.g.PositionKind];B.VERTEXCOLOR&&A.push(b.g.ColorKind);const E="sky",Y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,L.d)(Y);const H=B.toString();I.setEffect(F.getEngine().createEffect(E,A,Y,[],H,V,this.onCompiled,this.onError),B,this._materialContext)}return!(!I.effect||!I.effect.isReady())&&(B._renderId=F.getRenderId(),A._wasPreviouslyReady=!0,!0)}bindForSubMesh(V,I,A){const B=this.sV(),F=A.materialDefines;if(!F)return;const E=A.effect;if(!E)return;this._activeEffect=E,this.bindOnlyWorldMatrix(V),this._activeEffect.setMatrix("viewProjection",B.getTransformMatrix()),this._mustRebind(B,E,A)&&((0,L.h)(E,this,B),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,z.l)(F,E,B)),B.fogEnabled&&I.applyFog&&B.fogMode!==X.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",B.getViewMatrix()),(0,z.d)(B,I,this._activeEffect);const H=B.activeCamera;if(H){const V=H.getWorldMatrix();this._cameraPosition.x=V.m[12],this._cameraPosition.y=V.m[13],this._cameraPosition.z=V.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const V=Math.PI*(this.inclination-.5),I=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(I)*Math.cos(V),this.sunPosition.y=this.distance*Math.sin(-V),this.sunPosition.z=this.distance*Math.sin(I)*Math.cos(V),Y.Quaternion.FromUnitVectorsToRef(Y.tI.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(I,this._activeEffect,A)}getAnimatables(){return[]}dispose(V){super.dispose(V)}clone(V){return E.b.Clone((()=>new s(V,this.sV())),this)}serialize(){const V=super.serialize();return V.customType="BABYLON.SkyMaterial",V}getClassName(){return"SkyMaterial"}static Parse(V,I,A){return E.b.Parse((()=>new s(V.name,I)),V,I,A)}}(0,B.b)([(0,F.A)()],s.prototype,"luminance",void 0),(0,B.b)([(0,F.A)()],s.prototype,"turbidity",void 0),(0,B.b)([(0,F.A)()],s.prototype,"rayleigh",void 0),(0,B.b)([(0,F.A)()],s.prototype,"mieCoefficient",void 0),(0,B.b)([(0,F.A)()],s.prototype,"mieDirectionalG",void 0),(0,B.b)([(0,F.A)()],s.prototype,"distance",void 0),(0,B.b)([(0,F.A)()],s.prototype,"inclination",void 0),(0,B.b)([(0,F.A)()],s.prototype,"azimuth",void 0),(0,B.b)([(0,F.w)()],s.prototype,"sunPosition",void 0),(0,B.b)([(0,F.A)()],s.prototype,"useSunPosition",void 0),(0,B.b)([(0,F.w)()],s.prototype,"cameraOffset",void 0),(0,B.b)([(0,F.w)()],s.prototype,"up",void 0),(0,B.b)([(0,F.A)()],s.prototype,"dithering",void 0),(0,P.e)("BABYLON.SkyMaterial",s)},11952:(V,I,A)=>{"use strict";function B(V,I){I.headers=V.headers||{},I.statusMessage=V.statusText,I.statusCode=V.status,I.data=V.response}function F(V,I,A){return new Promise((function(F,E){A=A||{};var Y,H,c,b=new XMLHttpRequest,X=A.body,P=A.headers||{};for(Y in A.timeout&&(b.timeout=A.timeout),b.ontimeout=b.onerror=function(V){V.timeout="timeout"==V.type,E(V)},b.open(V,I.href||I),b.onload=function(){for(c=b.getAllResponseHeaders().trim().split(/[\r\n]+/),B(b,b);H=c.shift();)H=H.split(": "),b.headers[H.shift().toLowerCase()]=H.join(": ");if((H=b.headers["content-type"])&&~H.indexOf("application/json"))try{b.data=JSON.parse(b.data,A.reviver)}catch(V){return B(b,V),E(V)}(b.status>=400?E:F)(b)},typeof FormData<"u"&&X instanceof FormData||X&&"object"==typeof X&&(P["content-type"]="application/json",X=JSON.stringify(X)),b.withCredentials=!!A.withCredentials,P)b.setRequestHeader(Y,P[Y]);b.send(X)}))}A.r(I),A.d(I,{del:()=>c,get:()=>E,patch:()=>H,post:()=>Y,put:()=>b,send:()=>F});var E=F.bind(F,"GET"),Y=F.bind(F,"POST"),H=F.bind(F,"PATCH"),c=F.bind(F,"DELETE"),b=F.bind(F,"PUT")},13516:(V,I,A)=>{"use strict";A.d(I,{b:()=>P});const B=.5*(Math.sqrt(3)-1),F=(3-Math.sqrt(3))/6,E=1/3,Y=1/6,H=(Math.sqrt(5)-1)/4,c=(5-Math.sqrt(5))/20,b=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),X=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const P=class{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const I="function"==typeof V?V:function(V){let I=0,A=0,B=0,F=1;const E=function(){let V=4022871197;return function(I){I=I.toString();for(let A=0;A<I.length;A++){V+=I.charCodeAt(A);let B=.02519603282416938*V;V=B>>>0,B-=V,B*=V,V=B>>>0,B-=V,V+=4294967296*B}return 2.3283064365386963e-10*(V>>>0)}}();I=E(" "),A=E(" "),B=E(" "),I-=E(V),I<0&&(I+=1);A-=E(V),A<0&&(A+=1);B-=E(V),B<0&&(B+=1);return function(){const V=2091639*I+2.3283064365386963e-10*F;return I=A,A=B,B=V-(F=0|V)}}(V);this.p=function(V){const I=new Uint8Array(256);for(let A=0;A<256;A++)I[A]=A;for(let A=0;A<255;A++){const B=A+~~(V()*(256-A)),F=I[A];I[A]=I[B],I[B]=F}return I}(I),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let A=0;A<512;A++)this.perm[A]=this.p[255&A],this.permMod12[A]=this.perm[A]%12}noise2D(V,I){const A=this.permMod12,E=this.perm;let Y=0,H=0,c=0;const X=(V+I)*B,P=Math.floor(V+X),J=Math.floor(I+X),G=(P+J)*F,w=V-(P-G),t=I-(J-G);let u,W;w>t?(u=1,W=0):(u=0,W=1);const g=w-u+F,o=t-W+F,L=w-1+2*F,z=t-1+2*F,m=255&P,s=255&J;let e=.5-w*w-t*t;if(e>=0){const V=3*A[m+E[s]];e*=e,Y=e*e*(b[V]*w+b[V+1]*t)}let S=.5-g*g-o*o;if(S>=0){const V=3*A[m+u+E[s+W]];S*=S,H=S*S*(b[V]*g+b[V+1]*o)}let Q=.5-L*L-z*z;if(Q>=0){const V=3*A[m+1+E[s+1]];Q*=Q,c=Q*Q*(b[V]*L+b[V+1]*z)}return 70*(Y+H+c)}noise3D(V,I,A){const B=this.permMod12,F=this.perm;let H,c,X,P;const J=(V+I+A)*E,G=Math.floor(V+J),w=Math.floor(I+J),t=Math.floor(A+J),u=(G+w+t)*Y,W=V-(G-u),g=I-(w-u),o=A-(t-u);let L,z,m,s,e,S;W>=g?g>=o?(L=1,z=0,m=0,s=1,e=1,S=0):W>=o?(L=1,z=0,m=0,s=1,e=0,S=1):(L=0,z=0,m=1,s=1,e=0,S=1):g<o?(L=0,z=0,m=1,s=0,e=1,S=1):W<o?(L=0,z=1,m=0,s=0,e=1,S=1):(L=0,z=1,m=0,s=1,e=1,S=0);const Q=W-L+Y,h=g-z+Y,r=o-m+Y,M=W-s+2*Y,x=g-e+2*Y,f=o-S+2*Y,R=W-1+.5,q=g-1+.5,N=o-1+.5,l=255&G,i=255&w,y=255&t;let v=.6-W*W-g*g-o*o;if(v<0)H=0;else{const V=3*B[l+F[i+F[y]]];v*=v,H=v*v*(b[V]*W+b[V+1]*g+b[V+2]*o)}let C=.6-Q*Q-h*h-r*r;if(C<0)c=0;else{const V=3*B[l+L+F[i+z+F[y+m]]];C*=C,c=C*C*(b[V]*Q+b[V+1]*h+b[V+2]*r)}let K=.6-M*M-x*x-f*f;if(K<0)X=0;else{const V=3*B[l+s+F[i+e+F[y+S]]];K*=K,X=K*K*(b[V]*M+b[V+1]*x+b[V+2]*f)}let p=.6-R*R-q*q-N*N;if(p<0)P=0;else{const V=3*B[l+1+F[i+1+F[y+1]]];p*=p,P=p*p*(b[V]*R+b[V+1]*q+b[V+2]*N)}return 32*(H+c+X+P)}noise4D(V,I,A,B){const F=this.perm;let E,Y,b,P,J;const G=(V+I+A+B)*H,w=Math.floor(V+G),t=Math.floor(I+G),u=Math.floor(A+G),W=Math.floor(B+G),g=(w+t+u+W)*c,o=V-(w-g),L=I-(t-g),z=A-(u-g),m=B-(W-g);let s=0,e=0,S=0,Q=0;o>L?s++:e++,o>z?s++:S++,o>m?s++:Q++,L>z?e++:S++,L>m?e++:Q++,z>m?S++:Q++;const h=s>=3?1:0,r=e>=3?1:0,M=S>=3?1:0,x=Q>=3?1:0,f=s>=2?1:0,R=e>=2?1:0,q=S>=2?1:0,N=Q>=2?1:0,l=s>=1?1:0,i=e>=1?1:0,y=S>=1?1:0,v=Q>=1?1:0,C=o-h+c,K=L-r+c,p=z-M+c,j=m-x+c,T=o-f+2*c,d=L-R+2*c,D=z-q+2*c,O=m-N+2*c,Z=o-l+3*c,a=L-i+3*c,k=z-y+3*c,U=m-v+3*c,n=o-1+4*c,VV=L-1+4*c,IV=z-1+4*c,AV=m-1+4*c,BV=255&w,FV=255&t,EV=255&u,YV=255&W;let HV=.6-o*o-L*L-z*z-m*m;if(HV<0)E=0;else{const V=F[BV+F[FV+F[EV+F[YV]]]]%32*4;HV*=HV,E=HV*HV*(X[V]*o+X[V+1]*L+X[V+2]*z+X[V+3]*m)}let cV=.6-C*C-K*K-p*p-j*j;if(cV<0)Y=0;else{const V=F[BV+h+F[FV+r+F[EV+M+F[YV+x]]]]%32*4;cV*=cV,Y=cV*cV*(X[V]*C+X[V+1]*K+X[V+2]*p+X[V+3]*j)}let bV=.6-T*T-d*d-D*D-O*O;if(bV<0)b=0;else{const V=F[BV+f+F[FV+R+F[EV+q+F[YV+N]]]]%32*4;bV*=bV,b=bV*bV*(X[V]*T+X[V+1]*d+X[V+2]*D+X[V+3]*O)}let XV=.6-Z*Z-a*a-k*k-U*U;if(XV<0)P=0;else{const V=F[BV+l+F[FV+i+F[EV+y+F[YV+v]]]]%32*4;XV*=XV,P=XV*XV*(X[V]*Z+X[V+1]*a+X[V+2]*k+X[V+3]*U)}let PV=.6-n*n-VV*VV-IV*IV-AV*AV;if(PV<0)J=0;else{const V=F[BV+1+F[FV+1+F[EV+1+F[YV+1]]]]%32*4;PV*=PV,J=PV*PV*(X[V]*n+X[V+1]*VV+X[V+2]*IV+X[V+3]*AV)}return 27*(E+Y+b+P+J)}}}}]);