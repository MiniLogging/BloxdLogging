/*! For license information please see bc943j.32.6d8c0217.chunk.js.LICENSE.txt */
(self.zy41qorie9=self.zy41qorie9||[]).push([[32],{13092:function(Z,l){!function(Z){"use strict";var l=function(Z,C){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Z,l){Z.__proto__=l}||function(Z,l){for(var C in l)Object.prototype.hasOwnProperty.call(l,C)&&(Z[C]=l[C])},l(Z,C)};function C(Z,C){if("function"!==typeof C&&null!==C)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function B(){this.constructor=Z}l(Z,C),Z.prototype=null===C?Object.create(C):(B.prototype=C.prototype,new B)}function B(Z,l,C,B){var x,b=arguments.length,K=b<3?l:null===B?B=Object.getOwnPropertyDescriptor(l,C):B;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)K=Reflect.decorate(Z,l,C,B);else for(var f=Z.length-1;f>=0;f--)(x=Z[f])&&(K=(b<3?x(K):b>3?x(l,C,K):x(l,C))||K);return b>3&&K&&Object.defineProperty(l,C,K),K}function x(Z,l,C){if(C||2===arguments.length)for(var B,x=0,b=l.length;x<b;x++)!B&&x in l||(B||(B=Array.prototype.slice.call(l,0,x)),B[x]=l[x]);return Z.concat(B||Array.prototype.slice.call(l))}var b,K=255,f=213;Z.OPERATION=void 0,(b=Z.OPERATION||(Z.OPERATION={}))[b.ADD=128]="ADD",b[b.REPLACE=0]="REPLACE",b[b.DELETE=64]="DELETE",b[b.DELETE_AND_ADD=192]="DELETE_AND_ADD",b[b.TOUCH=1]="TOUCH",b[b.CLEAR=10]="CLEAR";var W=function(){function l(Z,l,C){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=Z,this.setParent(l,C)}return l.prototype.setParent=function(Z,l,C){var B=this;if(this.indexes||(this.indexes=this.ref instanceof kZ?this.ref._definition.indexes:{}),this.parent=Z,this.parentIndex=C,l)if(this.root=l,this.ref instanceof kZ){var x=this.ref._definition;for(var b in x.schema){var K=this.ref[b];if(K&&K.$changes){var f=x.indexes[b];K.$changes.setParent(this.ref,l,f)}}}else"object"===typeof this.ref&&this.ref.forEach((function(Z,l){if(Z instanceof kZ){var C=Z.$changes,x=B.ref.$changes.indexes[l];C.setParent(B.ref,B.root,x)}}))},l.prototype.operation=function(Z){this.changes.set(--this.currentCustomOperation,Z)},l.prototype.change=function(l,C){void 0===C&&(C=Z.OPERATION.ADD);var B="number"===typeof l?l:this.indexes[l];this.assertValidIndex(B,l);var x=this.changes.get(B);x&&x.op!==Z.OPERATION.DELETE&&x.op!==Z.OPERATION.TOUCH||this.changes.set(B,{op:x&&x.op===Z.OPERATION.DELETE?Z.OPERATION.DELETE_AND_ADD:C,index:B}),this.allChanges.add(B),this.changed=!0,this.touchParents()},l.prototype.touch=function(l){var C="number"===typeof l?l:this.indexes[l];this.assertValidIndex(C,l),this.changes.has(C)||this.changes.set(C,{op:Z.OPERATION.TOUCH,index:C}),this.allChanges.add(C),this.touchParents()},l.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},l.prototype.getType=function(Z){if(this.ref._definition)return(l=this.ref._definition).schema[l.fieldsByIndex[Z]];var l,C=(l=this.parent._definition).schema[l.fieldsByIndex[this.parentIndex]];return Object.values(C)[0]},l.prototype.getChildrenFilter=function(){var Z=this.parent._definition.childFilters;return Z&&Z[this.parentIndex]},l.prototype.getValue=function(Z){return this.ref.getByIndex(Z)},l.prototype.delete=function(l){var C="number"===typeof l?l:this.indexes[l];if(void 0!==C){var B=this.getValue(C);this.changes.set(C,{op:Z.OPERATION.DELETE,index:C}),this.allChanges.delete(C),delete this.caches[C],B&&B.$changes&&(B.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(l," (").concat(C,")"))},l.prototype.discard=function(l,C){var B=this;void 0===l&&(l=!1),void 0===C&&(C=!1),this.ref instanceof kZ||this.changes.forEach((function(l){if(l.op===Z.OPERATION.DELETE){var C=B.ref.getIndex(l.index);delete B.indexes[C]}})),this.changes.clear(),this.changed=l,C&&this.allChanges.clear(),this.currentCustomOperation=0},l.prototype.discardAll=function(){var Z=this;this.changes.forEach((function(l){var C=Z.getValue(l.index);C&&C.$changes&&C.$changes.discardAll()})),this.discard()},l.prototype.cache=function(Z,l){this.caches[Z]=l},l.prototype.clone=function(){return new l(this.ref,this.parent,this.root)},l.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},l.prototype.assertValidIndex=function(Z,l){if(void 0===Z)throw new Error('ChangeTree: missing index for field "'.concat(l,'"'))},l}();function J(Z,l,C,B){return Z[l]||(Z[l]=[]),Z[l].push(C),null===B||void 0===B||B.forEach((function(Z,l){return C(Z,l)})),function(){return E(Z[l],Z[l].indexOf(C))}}function d(l){var C=this,B="string"!==typeof this.$changes.getType();this.$items.forEach((function(x,b){l.push({refId:C.$changes.refId,op:Z.OPERATION.DELETE,field:b,value:void 0,previousValue:x}),B&&C.$changes.root.removeRef(x.$changes.refId)}))}function E(Z,l){if(-1===l||l>=Z.length)return!1;for(var C=Z.length-1,B=l;B<C;B++)Z[B]=Z[B+1];return Z.length=C,!0}var G=function(Z,l){var C=Z.toString(),B=l.toString();return C<B?-1:C>B?1:0};function a(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,l){return"symbol"===typeof l||isNaN(l)?Z[l]:Z.at(l)},set:function(Z,l,C){if("symbol"===typeof l||isNaN(l))Z[l]=C;else{var B=Array.from(Z.$items.keys()),x=parseInt(B[l]||l);void 0===C||null===C?Z.deleteAt(x):Z.setAt(x,C)}return!0},deleteProperty:function(Z,l){return"number"===typeof l?Z.deleteAt(l):delete Z[l],!0}})}var q=function(){function l(){for(var Z=[],l=0;l<arguments.length;l++)Z[l]=arguments[l];this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,Z)}return l.prototype.nW=function(l,C){return void 0===C&&(C=!0),J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,l,C?this.$items:void 0)},l.prototype.XC=function(l){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,l)},l.prototype.onChange=function(l){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,l)},l.is=function(Z){return Array.isArray(Z)||void 0!==Z.array},Object.defineProperty(l.prototype,"length",{get:function(){return this.$items.size},set:function(Z){0===Z?this.clear():this.splice(Z,this.length-Z)},enumerable:!1,configurable:!0}),l.prototype.push=function(){for(var Z,l=this,C=[],B=0;B<arguments.length;B++)C[B]=arguments[B];return C.forEach((function(C){Z=l.$refId++,l.setAt(Z,C)})),Z},l.prototype.pop=function(){var Z=Array.from(this.$indexes.values()).pop();if(void 0!==Z){this.$changes.delete(Z),this.$indexes.delete(Z);var l=this.$items.get(Z);return this.$items.delete(Z),l}},l.prototype.at=function(Z){var l=Array.from(this.$items.keys())[Z];return this.$items.get(l)},l.prototype.setAt=function(l,C){var B,x;if(void 0!==C&&null!==C){if(this.$items.get(l)!==C){void 0!==C.$changes&&C.$changes.setParent(this,this.$changes.root,l);var b=null!==(x=null===(B=this.$changes.indexes[l])||void 0===B?void 0:B.op)&&void 0!==x?x:Z.OPERATION.ADD;this.$changes.indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,C),this.$changes.change(l,b)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},l.prototype.deleteAt=function(Z){var l=Array.from(this.$items.keys())[Z];return void 0!==l&&this.$deleteAt(l)},l.prototype.$deleteAt=function(Z){return this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z)},l.prototype.clear=function(l){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),l&&d.call(this,l),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.concat=function(){for(var Z,C=[],B=0;B<arguments.length;B++)C[B]=arguments[B];return new(l.bind.apply(l,x([void 0],(Z=Array.from(this.$items.values())).concat.apply(Z,C),!1)))},l.prototype.join=function(Z){return Array.from(this.$items.values()).join(Z)},l.prototype.reverse=function(){var Z=this,l=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(C,B){Z.setAt(l[B],C)})),this},l.prototype.shift=function(){var Z=Array.from(this.$items.keys()).shift();if(void 0!==Z){var l=this.$items.get(Z);return this.$deleteAt(Z),l}},l.prototype.slice=function(Z,C){var B=new l;return B.push.apply(B,Array.from(this.$items.values()).slice(Z,C)),B},l.prototype.sort=function(Z){var l=this;void 0===Z&&(Z=G);var C=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(Z).forEach((function(Z,B){l.setAt(C[B],Z)})),this},l.prototype.splice=function(Z,l){void 0===l&&(l=this.length-Z);for(var C=Array.from(this.$items.keys()),B=[],x=Z;x<Z+l;x++)B.push(this.$items.get(C[x])),this.$deleteAt(C[x]);return B},l.prototype.unshift=function(){for(var Z=this,l=[],C=0;C<arguments.length;C++)l[C]=arguments[C];var B=this.length,x=l.length,b=Array.from(this.$items.values());return l.forEach((function(l,C){Z.setAt(C,l)})),b.forEach((function(l,C){Z.setAt(x+C,l)})),B+x},l.prototype.indexOf=function(Z,l){return Array.from(this.$items.values()).indexOf(Z,l)},l.prototype.lastIndexOf=function(Z,l){return void 0===l&&(l=this.length-1),Array.from(this.$items.values()).lastIndexOf(Z,l)},l.prototype.every=function(Z,l){return Array.from(this.$items.values()).every(Z,l)},l.prototype.some=function(Z,l){return Array.from(this.$items.values()).some(Z,l)},l.prototype.forEach=function(Z,l){Array.from(this.$items.values()).forEach(Z,l)},l.prototype.map=function(Z,l){return Array.from(this.$items.values()).map(Z,l)},l.prototype.filter=function(Z,l){return Array.from(this.$items.values()).filter(Z,l)},l.prototype.reduce=function(Z,l){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},l.prototype.reduceRight=function(Z,l){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},l.prototype.find=function(Z,l){return Array.from(this.$items.values()).find(Z,l)},l.prototype.findIndex=function(Z,l){return Array.from(this.$items.values()).findIndex(Z,l)},l.prototype.fill=function(Z,l,C){throw new Error("ArraySchema#fill() not implemented")},l.prototype.copyWithin=function(Z,l,C){throw new Error("ArraySchema#copyWithin() not implemented")},l.prototype.toString=function(){return this.$items.toString()},l.prototype.toLocaleString=function(){return this.$items.toLocaleString()},l.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(l,Symbol.species,{get:function(){return l},enumerable:!1,configurable:!0}),l.prototype.entries=function(){return this.$items.entries()},l.prototype.keys=function(){return this.$items.keys()},l.prototype.values=function(){return this.$items.values()},l.prototype.includes=function(Z,l){return Array.from(this.$items.values()).includes(Z,l)},l.prototype.flatMap=function(Z,l){throw new Error("ArraySchema#flatMap() is not supported.")},l.prototype.flat=function(Z){throw new Error("ArraySchema#flat() is not supported.")},l.prototype.findLast=function(){var Z=Array.from(this.$items.values());return Z.findLast.apply(Z,arguments)},l.prototype.findLastIndex=function(){var Z=Array.from(this.$items.values());return Z.findLastIndex.apply(Z,arguments)},l.prototype.setIndex=function(Z,l){this.$indexes.set(Z,l)},l.prototype.getIndex=function(Z){return this.$indexes.get(Z)},l.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},l.prototype.deleteByIndex=function(Z){var l=this.$indexes.get(Z);this.$items.delete(l),this.$indexes.delete(Z)},l.prototype.toArray=function(){return Array.from(this.$items.values())},l.prototype.toJSON=function(){return this.toArray().map((function(Z){return"function"===typeof Z.toJSON?Z.toJSON():Z}))},l.prototype.clone=function(Z){return Z?new(l.bind.apply(l,x([void 0],Array.from(this.$items.values()),!1))):new(l.bind.apply(l,x([void 0],this.map((function(Z){return Z.$changes?Z.clone():Z})),!1)))},l}();function z(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,l){return"symbol"!==typeof l&&"undefined"===typeof Z[l]?Z.get(l):Z[l]},set:function(Z,l,C){return"symbol"!==typeof l&&-1===l.indexOf("$")&&"nW"!==l&&"XC"!==l&&"onChange"!==l?Z.set(l,C):Z[l]=C,!0},deleteProperty:function(Z,l){return Z.delete(l),!0}})}var Y=function(){function l(Z){var C=this;if(this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z)if(Z instanceof Map||Z instanceof l)Z.forEach((function(Z,l){return C.set(l,Z)}));else for(var B in Z)this.set(B,Z[B])}return l.prototype.nW=function(l,C){return void 0===C&&(C=!0),J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,l,C?this.$items:void 0)},l.prototype.XC=function(l){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,l)},l.prototype.onChange=function(l){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,l)},l.is=function(Z){return void 0!==Z.map},l.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(l.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(l,Symbol.species,{get:function(){return l},enumerable:!1,configurable:!0}),l.prototype.set=function(l,C){if(void 0===C||null===C)throw new Error("MapSchema#set('".concat(l,"', ").concat(C,"): trying to set ").concat(C," value on '").concat(l,"'."));l=l.toString();var B="undefined"!==typeof this.$changes.indexes[l],x=B?this.$changes.indexes[l]:this.$refId++,b=B?Z.OPERATION.REPLACE:Z.OPERATION.ADD,K=void 0!==C.$changes;if(K&&C.$changes.setParent(this,this.$changes.root,x),B){if(!K&&this.$items.get(l)===C)return;K&&this.$items.get(l)!==C&&(b=Z.OPERATION.ADD)}else this.$changes.indexes[l]=x,this.$indexes.set(x,l);return this.$items.set(l,C),this.$changes.change(l,b),this},l.prototype.get=function(Z){return this.$items.get(Z)},l.prototype.delete=function(Z){return this.$changes.delete(Z),this.$items.delete(Z)},l.prototype.clear=function(l){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),l&&d.call(this,l),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.has=function(Z){return this.$items.has(Z)},l.prototype.forEach=function(Z){this.$items.forEach(Z)},l.prototype.entries=function(){return this.$items.entries()},l.prototype.keys=function(){return this.$items.keys()},l.prototype.values=function(){return this.$items.values()},Object.defineProperty(l.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),l.prototype.setIndex=function(Z,l){this.$indexes.set(Z,l)},l.prototype.getIndex=function(Z){return this.$indexes.get(Z)},l.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},l.prototype.deleteByIndex=function(Z){var l=this.$indexes.get(Z);this.$items.delete(l),this.$indexes.delete(Z)},l.prototype.toJSON=function(){var Z={};return this.forEach((function(l,C){Z[C]="function"===typeof l.toJSON?l.toJSON():l})),Z},l.prototype.clone=function(Z){var C;return Z?C=Object.assign(new l,this):(C=new l,this.forEach((function(Z,l){Z.$changes?C.set(l,Z.clone()):C.set(l,Z)}))),C},l}(),P={};function S(Z,l){P[Z]=l}function i(Z){return P[Z]}var s=function(){function Z(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return Z.create=function(l){var C=new Z;return C.schema=Object.assign({},l&&l.schema||{}),C.indexes=Object.assign({},l&&l.indexes||{}),C.fieldsByIndex=Object.assign({},l&&l.fieldsByIndex||{}),C.descriptors=Object.assign({},l&&l.descriptors||{}),C.deprecated=Object.assign({},l&&l.deprecated||{}),C},Z.prototype.addField=function(Z,l){var C=this.getNextFieldIndex();this.fieldsByIndex[C]=Z,this.indexes[Z]=C,this.schema[Z]=Array.isArray(l)?{array:l[0]}:l},Z.prototype.hasField=function(Z){return void 0!==this.indexes[Z]},Z.prototype.addFilter=function(Z,l){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[Z]]=l,this.indexesWithFilters.push(this.indexes[Z]),!0},Z.prototype.addChildrenFilter=function(Z,l){var C=this.indexes[Z],B=this.schema[Z];if(i(Object.keys(B)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[C]=l,!0;console.warn("@filterChildren: field '".concat(Z,"' can't have children. Ignoring filter."))},Z.prototype.getChildrenFilter=function(Z){return this.childFilters&&this.childFilters[this.indexes[Z]]},Z.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},Z}();function F(Z){return Z._context&&Z._context.useFilters}var n=function(){function Z(){this.types={},this.schemas=new Map,this.useFilters=!1}return Z.prototype.has=function(Z){return this.schemas.has(Z)},Z.prototype.get=function(Z){return this.types[Z]},Z.prototype.add=function(Z,l){void 0===l&&(l=this.schemas.size),Z._definition=s.create(Z._definition),Z._typeid=l,this.types[l]=Z,this.schemas.set(Z,l)},Z.create=function(l){return void 0===l&&(l={}),function(C){return l.context||(l.context=new Z),U(C,l)}},Z}(),c=new n;function U(Z,l){return void 0===l&&(l={}),function(C,B){var b=l.context||c,K=C.constructor;if(K._context=b,!Z)throw new Error("".concat(K.name,': @type() reference provided for "').concat(B,"\" is undefined. Make sure you don't have any circular dependencies."));b.has(K)||b.add(K);var f=K._definition;if(f.addField(B,Z),f.descriptors[B]){if(f.deprecated[B])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(B,"' definition on '").concat(K.name,"'.\nCheck @type() annotation"))}catch(P){var W=P.stack.split("\n")[4].trim();throw new Error("".concat(P.message," ").concat(W))}}var J=q.is(Z),d=!J&&Y.is(Z);if("string"!==typeof Z&&!kZ.is(Z)){var E=Object.values(Z)[0];"string"===typeof E||b.has(E)||b.add(E)}if(l.manual)f.descriptors[B]={enumerable:!0,configurable:!0,writable:!0};else{var G="_".concat(B);f.descriptors[G]={enumerable:!1,configurable:!1,writable:!0},f.descriptors[B]={get:function(){return this[G]},set:function(Z){Z!==this[G]&&(void 0!==Z&&null!==Z?(!J||Z instanceof q||(Z=new(q.bind.apply(q,x([void 0],Z,!1)))),!d||Z instanceof Y||(Z=new Y(Z)),void 0===Z.$proxy&&(d?Z=z(Z):J&&(Z=a(Z))),this.$changes.change(B),Z.$changes&&Z.$changes.setParent(this,this.$changes.root,this._definition.indexes[B])):this[G]&&this.$changes.delete(B),this[G]=Z)},enumerable:!0,configurable:!0}}}}function t(Z){return function(l,C){var B=l.constructor;B._definition.addFilter(C,Z)&&(B._context.useFilters=!0)}}function r(Z){return function(l,C){var B=l.constructor;B._definition.addChildrenFilter(C,Z)&&(B._context.useFilters=!0)}}function e(Z){return void 0===Z&&(Z=!0),function(l,C){var B=l.constructor._definition;B.deprecated[C]=!0,Z&&(B.descriptors[C]={get:function(){throw new Error("".concat(C," is deprecated."))},set:function(Z){},enumerable:!1,configurable:!0})}}function o(Z,l,C){for(var B in void 0===C&&(C={}),C.context||(C.context=Z._context||C.context||c),l)U(l[B],C)(Z.prototype,B);return Z}function v(Z){for(var l=0,C=0,B=0,x=Z.length;B<x;B++)(l=Z.charCodeAt(B))<128?C+=1:l<2048?C+=2:l<55296||l>=57344?C+=3:(B++,C+=4);return C}function R(Z,l,C){for(var B=0,x=0,b=C.length;x<b;x++)(B=C.charCodeAt(x))<128?Z[l++]=B:B<2048?(Z[l++]=192|B>>6,Z[l++]=128|63&B):B<55296||B>=57344?(Z[l++]=224|B>>12,Z[l++]=128|B>>6&63,Z[l++]=128|63&B):(x++,B=65536+((1023&B)<<10|1023&C.charCodeAt(x)),Z[l++]=240|B>>18,Z[l++]=128|B>>12&63,Z[l++]=128|B>>6&63,Z[l++]=128|63&B)}function k(Z,l){Z.push(255&l)}function V(Z,l){Z.push(255&l)}function g(Z,l){Z.push(255&l),Z.push(l>>8&255)}function j(Z,l){Z.push(255&l),Z.push(l>>8&255)}function M(Z,l){Z.push(255&l),Z.push(l>>8&255),Z.push(l>>16&255),Z.push(l>>24&255)}function I(Z,l){var C=l>>24,B=l>>16,x=l>>8,b=l;Z.push(255&b),Z.push(255&x),Z.push(255&B),Z.push(255&C)}function w(Z,l){var C=Math.floor(l/Math.pow(2,32));I(Z,l>>>0),I(Z,C)}function O(Z,l){var C=l/Math.pow(2,32)|0;I(Z,l>>>0),I(Z,C)}function D(Z,l){H(Z,l)}function y(Z,l){Q(Z,l)}var X=new Int32Array(2),T=new Float32Array(X.buffer),u=new Float64Array(X.buffer);function H(Z,l){T[0]=l,M(Z,X[0])}function Q(Z,l){u[0]=l,M(Z,X[0]),M(Z,X[1])}function h(Z,l){return V(Z,l?1:0)}function A(Z,l){l||(l="");var C=v(l),B=0;if(C<32)Z.push(160|C),B=1;else if(C<256)Z.push(217),V(Z,C),B=2;else if(C<65536)Z.push(218),j(Z,C),B=3;else{if(!(C<4294967296))throw new Error("String too long");Z.push(219),I(Z,C),B=5}return R(Z,Z.length,l),B+C}function L(Z,l){return isNaN(l)?L(Z,0):isFinite(l)?l!==(0|l)?(Z.push(203),Q(Z,l),9):l>=0?l<128?(V(Z,l),1):l<256?(Z.push(204),V(Z,l),2):l<65536?(Z.push(205),j(Z,l),3):l<4294967296?(Z.push(206),I(Z,l),5):(Z.push(207),O(Z,l),9):l>=-32?(Z.push(224|l+32),1):l>=-128?(Z.push(208),k(Z,l),2):l>=-32768?(Z.push(209),g(Z,l),3):l>=-2147483648?(Z.push(210),M(Z,l),5):(Z.push(211),w(Z,l),9):L(Z,l>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var p=Object.freeze({__proto__:null,utf8Write:R,int8:k,uint8:V,int16:g,uint16:j,int32:M,uint32:I,int64:w,uint64:O,float32:D,float64:y,writeFloat32:H,writeFloat64:Q,boolean:h,string:A,number:L});function N(Z,l,C){for(var B="",x=0,b=l,K=l+C;b<K;b++){var f=Z[b];0!==(128&f)?192!==(224&f)?224!==(240&f)?240!==(248&f)?console.error("Invalid byte "+f.toString(16)):(x=(7&f)<<18|(63&Z[++b])<<12|(63&Z[++b])<<6|63&Z[++b])>=65536?(x-=65536,B+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):B+=String.fromCharCode(x):B+=String.fromCharCode((15&f)<<12|(63&Z[++b])<<6|63&Z[++b]):B+=String.fromCharCode((31&f)<<6|63&Z[++b]):B+=String.fromCharCode(f)}return B}function mZ(Z,l){return ZZ(Z,l)<<24>>24}function ZZ(Z,l){return Z[l.offset++]}function lZ(Z,l){return CZ(Z,l)<<16>>16}function CZ(Z,l){return Z[l.offset++]|Z[l.offset++]<<8}function BZ(Z,l){return Z[l.offset++]|Z[l.offset++]<<8|Z[l.offset++]<<16|Z[l.offset++]<<24}function xZ(Z,l){return BZ(Z,l)>>>0}function bZ(Z,l){return GZ(Z,l)}function KZ(Z,l){return aZ(Z,l)}function fZ(Z,l){var C=xZ(Z,l);return BZ(Z,l)*Math.pow(2,32)+C}function WZ(Z,l){var C=xZ(Z,l);return xZ(Z,l)*Math.pow(2,32)+C}var JZ=new Int32Array(2),dZ=new Float32Array(JZ.buffer),EZ=new Float64Array(JZ.buffer);function GZ(Z,l){return JZ[0]=BZ(Z,l),dZ[0]}function aZ(Z,l){return JZ[0]=BZ(Z,l),JZ[1]=BZ(Z,l),EZ[0]}function qZ(Z,l){return ZZ(Z,l)>0}function zZ(Z,l){var C,B=Z[l.offset++];B<192?C=31&B:217===B?C=ZZ(Z,l):218===B?C=CZ(Z,l):219===B&&(C=xZ(Z,l));var x=N(Z,l.offset,C);return l.offset+=C,x}function YZ(Z,l){var C=Z[l.offset];return C<192&&C>160||217===C||218===C||219===C}function PZ(Z,l){var C=Z[l.offset++];return C<128?C:202===C?GZ(Z,l):203===C?aZ(Z,l):204===C?ZZ(Z,l):205===C?CZ(Z,l):206===C?xZ(Z,l):207===C?WZ(Z,l):208===C?mZ(Z,l):209===C?lZ(Z,l):210===C?BZ(Z,l):211===C?fZ(Z,l):C>223?-1*(255-C+1):void 0}function SZ(Z,l){var C=Z[l.offset];return C<128||C>=202&&C<=211}function iZ(Z,l){return Z[l.offset]<160}function sZ(Z,l){return Z[l.offset-1]===K&&(Z[l.offset]<128||Z[l.offset]>=202&&Z[l.offset]<=211)}var FZ=Object.freeze({__proto__:null,int8:mZ,uint8:ZZ,int16:lZ,uint16:CZ,int32:BZ,uint32:xZ,float32:bZ,float64:KZ,int64:fZ,uint64:WZ,readFloat32:GZ,readFloat64:aZ,boolean:qZ,string:zZ,stringCheck:YZ,number:PZ,numberCheck:SZ,arrayCheck:iZ,switchStructureCheck:sZ}),nZ=function(){function l(Z){var l=this;this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return l.add(Z)}))}return l.prototype.nW=function(l,C){return void 0===C&&(C=!0),J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,l,C?this.$items:void 0)},l.prototype.XC=function(l){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,l)},l.prototype.onChange=function(l){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,l)},l.is=function(Z){return void 0!==Z.collection},l.prototype.add=function(Z){var l=this.$refId++;return void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,l),this.$changes.indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,Z),this.$changes.change(l),l},l.prototype.at=function(Z){var l=Array.from(this.$items.keys())[Z];return this.$items.get(l)},l.prototype.entries=function(){return this.$items.entries()},l.prototype.delete=function(Z){for(var l,C,B=this.$items.entries();(C=B.next())&&!C.done;)if(Z===C.value[1]){l=C.value[0];break}return void 0!==l&&(this.$changes.delete(l),this.$indexes.delete(l),this.$items.delete(l))},l.prototype.clear=function(l){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),l&&d.call(this,l),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.has=function(Z){return Array.from(this.$items.values()).some((function(l){return l===Z}))},l.prototype.forEach=function(Z){var l=this;this.$items.forEach((function(C,B,x){return Z(C,B,l)}))},l.prototype.values=function(){return this.$items.values()},Object.defineProperty(l.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),l.prototype.setIndex=function(Z,l){this.$indexes.set(Z,l)},l.prototype.getIndex=function(Z){return this.$indexes.get(Z)},l.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},l.prototype.deleteByIndex=function(Z){var l=this.$indexes.get(Z);this.$items.delete(l),this.$indexes.delete(Z)},l.prototype.toArray=function(){return Array.from(this.$items.values())},l.prototype.toJSON=function(){var Z=[];return this.forEach((function(l,C){Z.push("function"===typeof l.toJSON?l.toJSON():l)})),Z},l.prototype.clone=function(Z){var C;return Z?C=Object.assign(new l,this):(C=new l,this.forEach((function(Z){Z.$changes?C.add(Z.clone()):C.add(Z)}))),C},l}(),cZ=function(){function l(Z){var l=this;this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return l.add(Z)}))}return l.prototype.nW=function(l,C){return void 0===C&&(C=!0),J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,l,C?this.$items:void 0)},l.prototype.XC=function(l){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,l)},l.prototype.onChange=function(l){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,l)},l.is=function(Z){return void 0!==Z.set},l.prototype.add=function(l){var C,B;if(this.has(l))return!1;var x=this.$refId++;void 0!==l.$changes&&l.$changes.setParent(this,this.$changes.root,x);var b=null!==(B=null===(C=this.$changes.indexes[x])||void 0===C?void 0:C.op)&&void 0!==B?B:Z.OPERATION.ADD;return this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,l),this.$changes.change(x,b),x},l.prototype.entries=function(){return this.$items.entries()},l.prototype.delete=function(Z){for(var l,C,B=this.$items.entries();(C=B.next())&&!C.done;)if(Z===C.value[1]){l=C.value[0];break}return void 0!==l&&(this.$changes.delete(l),this.$indexes.delete(l),this.$items.delete(l))},l.prototype.clear=function(l){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),l&&d.call(this,l),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.has=function(Z){for(var l,C=this.$items.values(),B=!1;(l=C.next())&&!l.done;)if(Z===l.value){B=!0;break}return B},l.prototype.forEach=function(Z){var l=this;this.$items.forEach((function(C,B,x){return Z(C,B,l)}))},l.prototype.values=function(){return this.$items.values()},Object.defineProperty(l.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),l.prototype.setIndex=function(Z,l){this.$indexes.set(Z,l)},l.prototype.getIndex=function(Z){return this.$indexes.get(Z)},l.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},l.prototype.deleteByIndex=function(Z){var l=this.$indexes.get(Z);this.$items.delete(l),this.$indexes.delete(Z)},l.prototype.toArray=function(){return Array.from(this.$items.values())},l.prototype.toJSON=function(){var Z=[];return this.forEach((function(l,C){Z.push("function"===typeof l.toJSON?l.toJSON():l)})),Z},l.prototype.clone=function(Z){var C;return Z?C=Object.assign(new l,this):(C=new l,this.forEach((function(Z){Z.$changes?C.add(Z.clone()):C.add(Z)}))),C},l}(),UZ=function(){function Z(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return Z.prototype.addRefId=function(Z){this.refIds.has(Z)||(this.refIds.add(Z),this.containerIndexes.set(Z,new Set))},Z.get=function(l){return void 0===l.$filterState&&(l.$filterState=new Z),l.$filterState},Z}(),tZ=function(){function Z(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return Z.prototype.getNextUniqueId=function(){return this.nextUniqueId++},Z.prototype.addRef=function(Z,l,C){void 0===C&&(C=!0),this.refs.set(Z,l),C&&(this.refCounts[Z]=(this.refCounts[Z]||0)+1)},Z.prototype.removeRef=function(Z){this.refCounts[Z]=this.refCounts[Z]-1,this.deletedRefs.add(Z)},Z.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},Z.prototype.garbageCollectDeletedRefs=function(){var Z=this;this.deletedRefs.forEach((function(l){if(!(Z.refCounts[l]>0)){var C=Z.refs.get(l);if(C instanceof kZ)for(var B in C._definition.schema)"string"!==typeof C._definition.schema[B]&&C[B]&&C[B].$changes&&Z.removeRef(C[B].$changes.refId);else{var x=C.$changes.parent._definition,b=x.schema[x.fieldsByIndex[C.$changes.parentIndex]];"function"===typeof Object.values(b)[0]&&Array.from(C.values()).forEach((function(l){return Z.removeRef(l.$changes.refId)}))}Z.refs.delete(l),delete Z.refCounts[l]}})),this.deletedRefs.clear()},Z}(),rZ=function(Z){function l(){return null!==Z&&Z.apply(this,arguments)||this}return C(l,Z),l}(Error);function eZ(Z,l,C,B){var x,b=!1;switch(l){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":x="number",isNaN(Z)&&console.log('trying to encode "NaN" in '.concat(C.constructor.name,"#").concat(B));break;case"string":x="string",b=!0;break;case"boolean":return}if(typeof Z!==x&&(!b||b&&null!==Z)){var K="'".concat(JSON.stringify(Z),"'").concat(Z&&Z.constructor&&" (".concat(Z.constructor.name,")")||"");throw new rZ("a '".concat(x,"' was expected, but ").concat(K," was provided in ").concat(C.constructor.name,"#").concat(B))}}function oZ(Z,l,C,B){if(!(Z instanceof l))throw new rZ("a '".concat(l.name,"' was expected, but '").concat(Z.constructor.name,"' was provided in ").concat(C.constructor.name,"#").concat(B))}function vZ(Z,l,C,B,x){eZ(C,Z,B,x);var b=p[Z];if(!b)throw new rZ("a '".concat(Z,"' was expected, but ").concat(C," was provided in ").concat(B.constructor.name,"#").concat(x));b(l,C)}function RZ(Z,l,C){return FZ[Z](l,C)}var kZ=function(){function l(){for(var Z=[],l=0;l<arguments.length;l++)Z[l]=arguments[l];Object.defineProperties(this,{$changes:{value:new W(this,void 0,new tZ),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var C=this._definition.descriptors;C&&Object.defineProperties(this,C),Z[0]&&this.assign(Z[0])}return l.onError=function(Z){console.error(Z)},l.is=function(Z){return Z._definition&&void 0!==Z._definition.schema},l.prototype.onChange=function(l){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,l)},l.prototype.XC=function(l){return J(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,l)},l.prototype.assign=function(Z){return Object.assign(this,Z),this},Object.defineProperty(l.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),l.prototype.setDirty=function(Z,l){this.$changes.change(Z,l)},l.prototype.listen=function(Z,l,C){var B=this;return void 0===C&&(C=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[Z]||(this.$callbacks[Z]=[]),this.$callbacks[Z].push(l),C&&void 0!==this[Z]&&l(this[Z],void 0),function(){return E(B.$callbacks[Z],B.$callbacks[Z].indexOf(l))}},l.prototype.decode=function(C,B,x){var b;void 0===B&&(B={offset:0}),void 0===x&&(x=this);var f=[],W=this.$changes.root,J=C.length,d=0;for(W.refs.set(d,this);B.offset<J;){var E=C[B.offset++];if(E!=K){var G=x.$changes,a=void 0!==x._definition,z=a?E>>6<<6:E;if(z!==Z.OPERATION.CLEAR){var P=a?E%(z||255):PZ(C,B),S=a?x._definition.fieldsByIndex[P]:"",s=G.getType(P),F=void 0,n=void 0,c=void 0;if(a?n=x["_".concat(S)]:(n=x.getByIndex(P),(z&Z.OPERATION.ADD)===Z.OPERATION.ADD?(c=x instanceof Y?zZ(C,B):P,x.setIndex(P,c)):c=x.getIndex(P)),(z&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&(z!==Z.OPERATION.DELETE_AND_ADD&&x.deleteByIndex(P),n&&n.$changes&&W.removeRef(n.$changes.refId),F=null),void 0!==S){if(z===Z.OPERATION.DELETE);else if(l.is(s)){var U=PZ(C,B);if(F=W.refs.get(U),z!==Z.OPERATION.REPLACE){var t=this.getSchemaType(C,B,s);F||((F=this.createTypeInstance(t)).$changes.refId=U,n&&(F.$callbacks=n.$callbacks,n.$changes.refId&&U!==n.$changes.refId&&W.removeRef(n.$changes.refId))),W.addRef(U,F,F!==n)}}else if("string"===typeof s)F=RZ(s,C,B);else{var r=i(Object.keys(s)[0]),e=PZ(C,B),o=W.refs.has(e)?n||W.refs.get(e):new r.constructor;if((F=o.clone(!0)).$changes.refId=e,n&&(F.$callbacks=n.$callbacks,n.$changes.refId&&e!==n.$changes.refId)){W.removeRef(n.$changes.refId);for(var v=n.entries(),R=void 0;(R=v.next())&&!R.done;){var k=(b=R.value)[0],V=b[1];f.push({refId:e,op:Z.OPERATION.DELETE,field:k,value:void 0,previousValue:V})}}W.addRef(e,F,o!==n)}if(null!==F&&void 0!==F)if(F.$changes&&F.$changes.setParent(G.ref,G.root,P),x instanceof l)x[S]=F;else if(x instanceof Y)k=c,x.$items.set(k,F),x.$changes.allChanges.add(P);else if(x instanceof q)x.setAt(P,F);else if(x instanceof nZ){var g=x.add(F);x.setIndex(P,g)}else x instanceof cZ&&!1!==(g=x.add(F))&&x.setIndex(P,g);n!==F&&f.push({refId:d,op:z,field:S,dynamicIndex:c,value:F,previousValue:n})}else{console.warn("@colyseus/schema: definition mismatch");for(var j={offset:B.offset};B.offset<J&&(!sZ(C,B)||(j.offset=B.offset+1,!W.refs.has(PZ(C,j))));)B.offset++}}else x.clear(f)}else{d=PZ(C,B);var M=W.refs.get(d);if(!M)throw new Error('"refId" not found: '.concat(d));x=M}}return this._triggerChanges(f),W.garbageCollectDeletedRefs(),f},l.prototype.encode=function(C,B,x){void 0===C&&(C=!1),void 0===B&&(B=[]),void 0===x&&(x=!1);for(var b=this.$changes,f=new WeakSet,W=[b],J=1,d=0;d<J;d++){var E=W[d],G=E.ref,a=G instanceof l;E.ensureRefId(),f.add(E),E!==b&&(E.changed||C)&&(V(B,K),L(B,E.refId));for(var q=C?Array.from(E.allChanges):Array.from(E.changes.values()),z=0,P=q.length;z<P;z++){var S=C?{op:Z.OPERATION.ADD,index:q[z]}:q[z],s=S.index,F=a?G._definition.fieldsByIndex&&G._definition.fieldsByIndex[s]:s,n=B.length;if(S.op!==Z.OPERATION.TOUCH)if(a)V(B,s|S.op);else{if(V(B,S.op),S.op===Z.OPERATION.CLEAR)continue;L(B,s)}if(a||(S.op&Z.OPERATION.ADD)!=Z.OPERATION.ADD||G instanceof Y&&A(B,E.ref.$indexes.get(s)),S.op!==Z.OPERATION.DELETE){var c=E.getType(s),U=E.getValue(s);if(U&&U.$changes&&!f.has(U.$changes)&&(W.push(U.$changes),U.$changes.ensureRefId(),J++),S.op!==Z.OPERATION.TOUCH){if(l.is(c))oZ(U,c,G,F),L(B,U.$changes.refId),(S.op&Z.OPERATION.ADD)===Z.OPERATION.ADD&&this.tryEncodeTypeId(B,c,U.constructor);else if("string"===typeof c)vZ(c,B,U,G,F);else{var t=i(Object.keys(c)[0]);oZ(G["_".concat(F)],t.constructor,G,F),L(B,U.$changes.refId)}x&&E.cache(s,B.slice(n))}}}C||x||E.discard()}return B},l.prototype.encodeAll=function(Z){return this.encode(!0,[],Z)},l.prototype.applyFilters=function(C,B){var x,b;void 0===B&&(B=!1);for(var f=this,W=new Set,J=UZ.get(C),d=[this.$changes],E=1,G=[],a=function(a){var q=d[a];if(W.has(q.refId))return"continue";var z=q.ref,P=z instanceof l;V(G,K),L(G,q.refId);var S=J.refIds.has(q),i=B||!S;J.addRefId(q);var s=J.containerIndexes.get(q),F=i?Array.from(q.allChanges):Array.from(q.changes.values());!B&&P&&z._definition.indexesWithFilters&&z._definition.indexesWithFilters.forEach((function(l){!s.has(l)&&q.allChanges.has(l)&&(i?F.push(l):F.push({op:Z.OPERATION.ADD,index:l}))}));for(var n=0,c=F.length;n<c;n++){var U=i?{op:Z.OPERATION.ADD,index:F[n]}:F[n];if(U.op!==Z.OPERATION.CLEAR){var t=U.index;if(U.op!==Z.OPERATION.DELETE){var r=q.getValue(t),e=q.getType(t);if(P){if((o=z._definition.filters&&z._definition.filters[t])&&!o.call(z,C,r,f)){r&&r.$changes&&W.add(r.$changes.refId);continue}}else{var o,v=q.parent;if((o=q.getChildrenFilter())&&!o.call(v,C,z.$indexes.get(t),r,f)){r&&r.$changes&&W.add(r.$changes.refId);continue}}if(r.$changes&&(d.push(r.$changes),E++),U.op!==Z.OPERATION.TOUCH)if(U.op===Z.OPERATION.ADD||P)G.push.apply(G,null!==(x=q.caches[t])&&void 0!==x?x:[]),s.add(t);else if(s.has(t))G.push.apply(G,null!==(b=q.caches[t])&&void 0!==b?b:[]);else{if(s.add(t),V(G,Z.OPERATION.ADD),L(G,t),z instanceof Y){var R=q.ref.$indexes.get(t);A(G,R)}r.$changes?L(G,r.$changes.refId):p[e](G,r)}else r.$changes&&!P&&(V(G,Z.OPERATION.ADD),L(G,t),z instanceof Y&&(R=q.ref.$indexes.get(t),A(G,R)),L(G,r.$changes.refId))}else P?V(G,U.op|t):(V(G,U.op),L(G,t))}else V(G,U.op)}},q=0;q<E;q++)a(q);return G},l.prototype.clone=function(){var Z,l=new this.constructor,C=this._definition.schema;for(var B in C)"object"===typeof this[B]&&"function"===typeof(null===(Z=this[B])||void 0===Z?void 0:Z.clone)?l[B]=this[B].clone():l[B]=this[B];return l},l.prototype.toJSON=function(){var Z=this._definition.schema,l=this._definition.deprecated,C={};for(var B in Z)l[B]||null===this[B]||"undefined"===typeof this[B]||(C[B]="function"===typeof this[B].toJSON?this[B].toJSON():this["_".concat(B)]);return C},l.prototype.discardAllChanges=function(){this.$changes.discardAll()},l.prototype.getByIndex=function(Z){return this[this._definition.fieldsByIndex[Z]]},l.prototype.deleteByIndex=function(Z){this[this._definition.fieldsByIndex[Z]]=void 0},l.prototype.tryEncodeTypeId=function(Z,l,C){l._typeid!==C._typeid&&(V(Z,f),L(Z,C._typeid))},l.prototype.getSchemaType=function(Z,l,C){var B;return Z[l.offset]===f&&(l.offset++,B=this.constructor._context.get(PZ(Z,l))),B||C},l.prototype.createTypeInstance=function(Z){var l=new Z;return l.$changes.root=this.$changes.root,l},l.prototype._triggerChanges=function(C){for(var B,x,b,K,f,W,J,d,E,G=new Set,a=this.$changes.root.refs,q=function(q){var z=C[q],Y=z.refId,P=a.get(Y),S=P.$callbacks;if((z.op&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&z.previousValue instanceof l&&(null===(x=null===(B=z.previousValue.$callbacks)||void 0===B?void 0:B[Z.OPERATION.DELETE])||void 0===x||x.forEach((function(Z){return Z()}))),!S)return"continue";if(P instanceof l){if(!G.has(Y))try{null===(b=null===S||void 0===S?void 0:S[Z.OPERATION.REPLACE])||void 0===b||b.forEach((function(Z){return Z()}))}catch(i){l.onError(i)}try{S.hasOwnProperty(z.field)&&(null===(K=S[z.field])||void 0===K||K.forEach((function(Z){return Z(z.value,z.previousValue)})))}catch(i){l.onError(i)}}else z.op===Z.OPERATION.ADD&&void 0===z.previousValue?null===(f=S[Z.OPERATION.ADD])||void 0===f||f.forEach((function(Z){var l;return Z(z.value,null!==(l=z.dynamicIndex)&&void 0!==l?l:z.field)})):z.op===Z.OPERATION.DELETE?void 0!==z.previousValue&&(null===(W=S[Z.OPERATION.DELETE])||void 0===W||W.forEach((function(Z){var l;return Z(z.previousValue,null!==(l=z.dynamicIndex)&&void 0!==l?l:z.field)}))):z.op===Z.OPERATION.DELETE_AND_ADD&&(void 0!==z.previousValue&&(null===(J=S[Z.OPERATION.DELETE])||void 0===J||J.forEach((function(Z){var l;return Z(z.previousValue,null!==(l=z.dynamicIndex)&&void 0!==l?l:z.field)}))),null===(d=S[Z.OPERATION.ADD])||void 0===d||d.forEach((function(Z){var l;return Z(z.value,null!==(l=z.dynamicIndex)&&void 0!==l?l:z.field)}))),z.value!==z.previousValue&&(null===(E=S[Z.OPERATION.REPLACE])||void 0===E||E.forEach((function(Z){var l;return Z(z.value,null!==(l=z.dynamicIndex)&&void 0!==l?l:z.field)})));G.add(Y)},z=0;z<C.length;z++)q(z)},l._definition=s.create(),l}();function VZ(Z){for(var l=[Z.$changes],C=1,B={},x=B,b=function(Z){var C=l[Z];C.changes.forEach((function(Z){var l=C.ref,B=Z.index,b=l._definition?l._definition.fieldsByIndex[B]:l.$indexes.get(B);x[b]=C.getValue(B)}))},K=0;K<C;K++)b(K);return B}var gZ={context:new n},jZ=function(Z){function l(){return null!==Z&&Z.apply(this,arguments)||this}return C(l,Z),B([U("string",gZ)],l.prototype,"name",void 0),B([U("string",gZ)],l.prototype,"type",void 0),B([U("number",gZ)],l.prototype,"referencedType",void 0),l}(kZ),MZ=function(Z){function l(){var l=null!==Z&&Z.apply(this,arguments)||this;return l.fields=new q,l}return C(l,Z),B([U("number",gZ)],l.prototype,"id",void 0),B([U([jZ],gZ)],l.prototype,"fields",void 0),l}(kZ),IZ=function(Z){function l(){var l=null!==Z&&Z.apply(this,arguments)||this;return l.types=new q,l}return C(l,Z),l.encode=function(Z){var C=Z.constructor,B=new l;B.rootType=C._typeid;var x=function(Z,l){for(var C in l){var x=new jZ;x.name=C;var b=void 0;if("string"===typeof l[C])b=l[C];else{var K=l[C],f=void 0;kZ.is(K)?(b="ref",f=l[C]):"string"===typeof K[b=Object.keys(K)[0]]?b+=":"+K[b]:f=K[b],x.referencedType=f?f._typeid:-1}x.type=b,Z.fields.push(x)}B.types.push(Z)},b=C._context.types;for(var K in b){var f=new MZ;f.id=Number(K),x(f,b[K]._definition.schema)}return B.encodeAll()},l.decode=function(Z,B){var x=new n,b=new l;b.decode(Z,B);var K=b.types.reduce((function(Z,l){var B=function(Z){function l(){return null!==Z&&Z.apply(this,arguments)||this}return C(l,Z),l}(kZ),b=l.id;return Z[b]=B,x.add(B,b),Z}),{});b.types.forEach((function(Z){var l=K[Z.id];Z.fields.forEach((function(Z){var C;if(void 0!==Z.referencedType){var B=Z.type,b=K[Z.referencedType];if(!b){var f=Z.type.split(":");B=f[0],b=f[1]}"ref"===B?U(b,{context:x})(l.prototype,Z.name):U(((C={})[B]=b,C),{context:x})(l.prototype,Z.name)}else U(Z.type,{context:x})(l.prototype,Z.name)}))}));var f=K[b.rootType],W=new f;for(var J in f._definition.schema){var d=f._definition.schema[J];"string"!==typeof d&&(W[J]="function"===typeof d?new d:new(i(Object.keys(d)[0]).constructor))}return W},B([U([MZ],gZ)],l.prototype,"types",void 0),B([U("number",gZ)],l.prototype,"rootType",void 0),l}(kZ);S("map",{constructor:Y}),S("array",{constructor:q}),S("set",{constructor:cZ}),S("collection",{constructor:nZ}),Z.ArraySchema=q,Z.CollectionSchema=nZ,Z.Context=n,Z.MapSchema=Y,Z.Reflection=IZ,Z.ReflectionField=jZ,Z.ReflectionType=MZ,Z.Schema=kZ,Z.SchemaDefinition=s,Z.SetSchema=cZ,Z.decode=FZ,Z.defineTypes=o,Z.deprecated=e,Z.dumpChanges=VZ,Z.encode=p,Z.filter=t,Z.filterChildren=r,Z.hasFilter=F,Z.registerType=S,Z.type=U,Object.defineProperty(Z,"__esModule",{value:!0})}(l)},14105:Z=>{Z.exports=function(Z){return null!=Z&&null!=Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}},14085:(Z,l,C)=>{"use strict";var B=C(14094),x=C(14098),b=C(14105);C.g.__TYPEDARRAY_POOL||(C.g.__TYPEDARRAY_POOL={UINT8:x([32,0]),UINT16:x([32,0]),UINT32:x([32,0]),INT8:x([32,0]),INT16:x([32,0]),INT32:x([32,0]),FLOAT:x([32,0]),DOUBLE:x([32,0]),DATA:x([32,0]),UINT8C:x([32,0]),BUFFER:x([32,0])});var K="undefined"!==typeof Uint8ClampedArray,f=C.g.__TYPEDARRAY_POOL;f.UINT8C||(f.UINT8C=x([32,0])),f.BUFFER||(f.BUFFER=x([32,0]));var W=f.DATA,J=f.BUFFER;function d(Z){if(Z){var l=Z.length||Z.byteLength,C=B.log2(l);W[C].push(Z)}}function E(Z){Z=B.nextPow2(Z);var l=B.log2(Z),C=W[l];return C.length>0?C.pop():new ArrayBuffer(Z)}function G(Z){return new Uint8Array(E(Z),0,Z)}function a(Z){return new Uint16Array(E(2*Z),0,Z)}function q(Z){return new Uint32Array(E(4*Z),0,Z)}function z(Z){return new Int8Array(E(Z),0,Z)}function Y(Z){return new Int16Array(E(2*Z),0,Z)}function P(Z){return new Int32Array(E(4*Z),0,Z)}function S(Z){return new Float32Array(E(4*Z),0,Z)}function i(Z){return new Float64Array(E(8*Z),0,Z)}function s(Z){return K?new Uint8ClampedArray(E(Z),0,Z):G(Z)}function F(Z){return new DataView(E(Z),0,Z)}l.free=function(Z){if(b(Z))J[B.log2(Z.length)].push(Z);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(Z)&&(Z=Z.buffer),!Z)return;var l=Z.length||Z.byteLength,C=0|B.log2(l);W[C].push(Z)}},l.freeUint8=l.freeUint16=l.freeUint32=l.freeInt8=l.freeInt16=l.freeInt32=l.freeFloat32=l.freeFloat=l.freeFloat64=l.freeDouble=l.freeUint8Clamped=l.freeDataView=function(Z){d(Z.buffer)},l.freeArrayBuffer=d,l.freeBuffer=function(Z){J[B.log2(Z.length)].push(Z)},l.malloc=function(Z,l){if(void 0===l||"arraybuffer"===l)return E(Z);switch(l){case"uint8":return G(Z);case"uint16":return a(Z);case"uint32":return q(Z);case"int8":return z(Z);case"int16":return Y(Z);case"int32":return P(Z);case"float":case"float32":return S(Z);case"double":case"float64":return i(Z);case"uint8_clamped":return s(Z);case"buffer":throw"Buffer not supported";case"data":case"dataview":return F(Z);default:return null}return null},l.mallocArrayBuffer=E,l.mallocUint8=G,l.mallocUint16=a,l.mallocUint32=q,l.mallocInt8=z,l.mallocInt16=Y,l.mallocInt32=P,l.mallocFloat32=l.mallocFloat=S,l.mallocFloat64=l.mallocDouble=i,l.mallocUint8Clamped=s,l.mallocDataView=F,l.clearCache=function(){for(var Z=0;Z<32;++Z)f.UINT8[Z].length=0,f.UINT16[Z].length=0,f.UINT32[Z].length=0,f.INT8[Z].length=0,f.INT16[Z].length=0,f.INT32[Z].length=0,f.FLOAT[Z].length=0,f.DOUBLE[Z].length=0,f.UINT8C[Z].length=0,W[Z].length=0,J[Z].length=0}},14177:(Z,l,C)=>{Z.exports=x;var B=C(118);function x(Z,l){if(!(this instanceof x))return new x(Z,l);var C=B.create();B.add(C,Z,l),this.base=B.min(B.create(),Z,C),this.fE=B.clone(l),this.max=B.max(B.create(),Z,C),this.mag=B.length(this.fE)}var b=x.prototype;b.width=function(){return this.fE[0]},b.height=function(){return this.fE[1]},b.depth=function(){return this.fE[2]},b.x0=function(){return this.base[0]},b.y0=function(){return this.base[1]},b.z0=function(){return this.base[2]},b.x1=function(){return this.max[0]},b.y1=function(){return this.max[1]},b.z1=function(){return this.max[2]},b.translate=function(Z){return B.add(this.max,this.max,Z),B.add(this.base,this.base,Z),this},b.setPosition=function(Z){return B.add(this.max,Z,this.fE),B.j(this.base,Z),this},b.expand=function(Z){var l=B.create(),C=B.create();return B.max(l,Z.max,this.max),B.min(C,Z.base,this.base),B.zl(l,l,C),new x(C,l)},b.intersects=function(Z){return!(Z.base[0]>this.max[0])&&(!(Z.base[1]>this.max[1])&&(!(Z.base[2]>this.max[2])&&(!(Z.max[0]<this.base[0])&&(!(Z.max[1]<this.base[1])&&!(Z.max[2]<this.base[2])))))},b.touches=function(Z){var l=this.union(Z);return null!==l&&(0==l.width()||0==l.height()||0==l.depth())},b.union=function(Z){if(!this.intersects(Z))return null;var l=Math.max(Z.base[0],this.base[0]),C=Math.max(Z.base[1],this.base[1]),B=Math.max(Z.base[2],this.base[2]);return new x([l,C,B],[Math.min(Z.max[0],this.max[0])-l,Math.min(Z.max[1],this.max[1])-C,Math.min(Z.max[2],this.max[2])-B])}},14094:(Z,l)=>{"use strict";function C(Z){var l=32;return(Z&=-Z)&&l--,65535&Z&&(l-=16),16711935&Z&&(l-=8),252645135&Z&&(l-=4),858993459&Z&&(l-=2),1431655765&Z&&(l-=1),l}l.INT_BITS=32,l.INT_MAX=2147483647,l.INT_MIN=-1<<31,l.sign=function(Z){return(Z>0)-(Z<0)},l.abs=function(Z){var l=Z>>31;return(Z^l)-l},l.min=function(Z,l){return l^(Z^l)&-(Z<l)},l.max=function(Z,l){return Z^(Z^l)&-(Z<l)},l.isPow2=function(Z){return!(Z&Z-1)&&!!Z},l.log2=function(Z){var l,C;return l=(Z>65535)<<4,l|=C=((Z>>>=l)>255)<<3,l|=C=((Z>>>=C)>15)<<2,(l|=C=((Z>>>=C)>3)<<1)|(Z>>>=C)>>1},l.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},l.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},l.countTrailingZeros=C,l.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},l.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},l.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var B=new Array(256);!function(Z){for(var l=0;l<256;++l){var C=l,B=l,x=7;for(C>>>=1;C;C>>>=1)B<<=1,B|=1&C,--x;Z[l]=B<<x&255}}(B),l.reverse=function(Z){return B[255&Z]<<24|B[Z>>>8&255]<<16|B[Z>>>16&255]<<8|B[Z>>>24&255]},l.interleave2=function(Z,l){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l&=65535)|l<<8))|l<<4))|l<<2))|l<<1))<<1},l.deinterleave2=function(Z,l){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>l&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},l.interleave3=function(Z,l,C){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},l.deinterleave3=function(Z,l){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>l&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},l.nextCombination=function(Z){var l=Z|Z-1;return l+1|(~l&-~l)-1>>>C(Z)+1}},14076:(Z,l,C)=>{"use strict";Z.exports=function(Z,l,C){switch(arguments.length){case 1:return B=[],J(x=Z,x,d,!0),B;case 2:return"function"===typeof l?J(Z,Z,l,!0):function(Z,l){return B=[],J(Z,l,d,!1),B}(Z,l);case 3:return J(Z,l,C,!1);default:throw new Error("box-intersect: Invalid arguments")}var x};var B,x=C(14085),b=C(14108),K=C(14115);function f(Z,l){for(var C=0;C<Z;++C)if(!(l[C]<=l[C+Z]))return!0;return!1}function W(Z,l,C,B){for(var x=0,b=0,K=0,W=Z.length;K<W;++K){var J=Z[K];if(!f(l,J)){for(var d=0;d<2*l;++d)C[x++]=J[d];B[b++]=K}}return b}function J(Z,l,C,B){var f=Z.length,J=l.length;if(!(f<=0||J<=0)){var d=Z[0].length>>>1;if(!(d<=0)){var E,G=x.mallocDouble(2*d*f),a=x.mallocInt32(f);if((f=W(Z,d,G,a))>0){if(1===d&&B)b.init(f),E=b.sweepComplete(d,C,0,f,G,a,0,f,G,a);else{var q=x.mallocDouble(2*d*J),z=x.mallocInt32(J);(J=W(l,d,q,z))>0&&(b.init(f+J),E=1===d?b.sweepBipartite(d,C,0,f,G,a,0,J,q,z):K(d,C,B,f,G,a,J,q,z),x.free(q),x.free(z))}x.free(G),x.free(a)}return E}}}function d(Z,l){B.push([Z,l])}},14120:(Z,l)=>{"use strict";var C="d",B="ax",x="fp",b="es",K="rs",f="re",W="rb",J="bs",d="be",E="bb",G=[C,B,"vv",K,f,W,"ri",J,d,E,"bi"];function a(Z){var l="bruteForce"+(Z?"Full":"Partial"),B=[],K=G.slice();Z||K.splice(3,0,x);var f=["function "+l+"("+K.join()+"){"];function W(l,x){var K=function(Z,l,B){var x="bruteForce"+(Z?"Red":"Blue")+(l?"Flip":"")+(B?"Full":""),K=["function ",x,"(",G.join(),"){","var ",b,"=2*",C,";"],f="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",W="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(B?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return Z?K.push(f,"Q",":",W):K.push(W,"Q",":",f),B?K.push("if(y1<x0||x1<y0)continue;"):l?K.push("if(y0<=x0||x1<y0)continue;"):K.push("if(y0<x0||x1<y0)continue;"),K.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),l?K.push("yi,xi"):K.push("xi,yi"),K.push(");if(rv!==void 0)return rv;}}}"),{name:x,code:K.join("")}}(l,x,Z);B.push(K.code),f.push("return "+K.name+"("+G.join()+");")}f.push("if(re-rs>be-bs){"),Z?(W(!0,!1),f.push("}else{"),W(!1,!1)):(f.push("if(fp){"),W(!0,!0),f.push("}else{"),W(!0,!1),f.push("}}else{if(fp){"),W(!1,!0),f.push("}else{"),W(!1,!1),f.push("}")),f.push("}}return "+l);var J=B.join("")+f.join("");return new Function(J)()}l.partial=a(!1),l.full=a(!0)},14115:(Z,l,C)=>{"use strict";Z.exports=function(Z,l,C,b,d,e,o,v,R){!function(Z,l){var C=8*x.log2(l+1)*(Z+1)|0,b=x.nextPow2(s*C);n.length<b&&(B.free(n),n=B.mallocInt32(b));var K=x.nextPow2(F*C);c.length<K&&(B.free(c),c=B.mallocDouble(K))}(Z,b+o);var k,V=0,g=2*Z;U(V++,0,0,b,0,o,C?16:0,-1/0,1/0),C||U(V++,0,0,o,0,b,1,-1/0,1/0);for(;V>0;){var j=(V-=1)*s,M=n[j],I=n[j+1],w=n[j+2],O=n[j+3],D=n[j+4],y=n[j+5],X=V*F,T=c[X],u=c[X+1],H=1&y,Q=!!(16&y),h=d,A=e,L=v,p=R;if(H&&(h=v,A=R,L=d,p=e),!(2&y&&I>=(w=Y(Z,M,I,w,h,A,u)))&&!(4&y&&(I=P(Z,M,I,w,h,A,T))>=w)){var N=w-I,mZ=D-O;if(Q){if(Z*N*(N+mZ)<a){if(void 0!==(k=W.scanComplete(Z,M,l,I,w,h,A,O,D,L,p)))return k;continue}}else{if(Z*Math.min(N,mZ)<E){if(void 0!==(k=K(Z,M,l,H,I,w,h,A,O,D,L,p)))return k;continue}if(Z*N*mZ<G){if(void 0!==(k=W.scanBipartite(Z,M,l,H,I,w,h,A,O,D,L,p)))return k;continue}}var ZZ=q(Z,M,I,w,h,A,T,u);if(I<ZZ)if(Z*(ZZ-I)<E){if(void 0!==(k=f(Z,M+1,l,I,ZZ,h,A,O,D,L,p)))return k}else if(M===Z-2){if(void 0!==(k=H?W.sweepBipartite(Z,l,O,D,L,p,I,ZZ,h,A):W.sweepBipartite(Z,l,I,ZZ,h,A,O,D,L,p)))return k}else U(V++,M+1,I,ZZ,O,D,H,-1/0,1/0),U(V++,M+1,O,D,I,ZZ,1^H,-1/0,1/0);if(ZZ<w){var lZ=J(Z,M,O,D,L,p),CZ=L[g*lZ+M],BZ=z(Z,M,lZ,D,L,p,CZ);if(BZ<D&&U(V++,M,ZZ,w,BZ,D,(4|H)+(Q?16:0),CZ,u),O<lZ&&U(V++,M,ZZ,w,O,lZ,(2|H)+(Q?16:0),T,CZ),lZ+1===BZ){if(void 0!==(k=Q?r(Z,M,l,ZZ,w,h,A,lZ,L,p[lZ]):t(Z,M,l,H,ZZ,w,h,A,lZ,L,p[lZ])))return k}else if(lZ<BZ){var xZ;if(Q){if(ZZ<(xZ=S(Z,M,ZZ,w,h,A,CZ))){var bZ=z(Z,M,ZZ,xZ,h,A,CZ);if(M===Z-2){if(ZZ<bZ&&void 0!==(k=W.sweepComplete(Z,l,ZZ,bZ,h,A,lZ,BZ,L,p)))return k;if(bZ<xZ&&void 0!==(k=W.sweepBipartite(Z,l,bZ,xZ,h,A,lZ,BZ,L,p)))return k}else ZZ<bZ&&U(V++,M+1,ZZ,bZ,lZ,BZ,16,-1/0,1/0),bZ<xZ&&(U(V++,M+1,bZ,xZ,lZ,BZ,0,-1/0,1/0),U(V++,M+1,lZ,BZ,bZ,xZ,1,-1/0,1/0))}}else ZZ<(xZ=H?i(Z,M,ZZ,w,h,A,CZ):S(Z,M,ZZ,w,h,A,CZ))&&(M===Z-2?k=H?W.sweepBipartite(Z,l,lZ,BZ,L,p,ZZ,xZ,h,A):W.sweepBipartite(Z,l,ZZ,xZ,h,A,lZ,BZ,L,p):(U(V++,M+1,ZZ,xZ,lZ,BZ,H,-1/0,1/0),U(V++,M+1,lZ,BZ,ZZ,xZ,1^H,-1/0,1/0)))}}}}};var B=C(14085),x=C(14094),b=C(14120),K=b.partial,f=b.full,W=C(14108),J=C(14125),d=C(14132),E=128,G=1<<22,a=1<<22,q=d("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),z=d("lo===p0",["p0"]),Y=d("lo<p0",["p0"]),P=d("hi<=p0",["p0"]),S=d("lo<=p0&&p0<=hi",["p0"]),i=d("lo<p0&&p0<=hi",["p0"]),s=6,F=2,n=B.mallocInt32(1024),c=B.mallocDouble(1024);function U(Z,l,C,B,x,b,K,f,W){var J=s*Z;n[J]=l,n[J+1]=C,n[J+2]=B,n[J+3]=x,n[J+4]=b,n[J+5]=K;var d=F*Z;c[d]=f,c[d+1]=W}function t(Z,l,C,B,x,b,K,f,W,J,d){var E=2*Z,G=W*E,a=J[G+l];Z:for(var q=x,z=x*E;q<b;++q,z+=E){var Y=K[z+l],P=K[z+l+Z];if(!(a<Y||P<a)&&(!B||a!==Y)){for(var S,i=f[q],s=l+1;s<Z;++s){Y=K[z+s],P=K[z+s+Z];var F=J[G+s],n=J[G+s+Z];if(P<F||n<Y)continue Z}if(void 0!==(S=B?C(d,i):C(i,d)))return S}}}function r(Z,l,C,B,x,b,K,f,W,J){var d=2*Z,E=f*d,G=W[E+l];Z:for(var a=B,q=B*d;a<x;++a,q+=d){var z=K[a];if(z!==J){var Y=b[q+l],P=b[q+l+Z];if(!(G<Y||P<G)){for(var S=l+1;S<Z;++S){Y=b[q+S],P=b[q+S+Z];var i=W[E+S],s=W[E+S+Z];if(P<i||s<Y)continue Z}var F=C(z,J);if(void 0!==F)return F}}}}},14125:(Z,l,C)=>{"use strict";Z.exports=function(Z,l,C,K,f,W){if(K<=C+1)return C;var J=C,d=K,E=K+C>>>1,G=2*Z,a=E,q=f[G*E+l];for(;J<d;){if(d-J<x){b(Z,l,J,d,f,W),q=f[G*E+l];break}var z=d-J,Y=Math.random()*z+J|0,P=f[G*Y+l],S=Math.random()*z+J|0,i=f[G*S+l],s=Math.random()*z+J|0,F=f[G*s+l];P<=i?F>=i?(a=S,q=i):P>=F?(a=Y,q=P):(a=s,q=F):i>=F?(a=S,q=i):F>=P?(a=Y,q=P):(a=s,q=F);for(var n=G*(d-1),c=G*a,U=0;U<G;++U,++n,++c){var t=f[n];f[n]=f[c],f[c]=t}var r=W[d-1];W[d-1]=W[a],W[a]=r;for(n=G*(d-1),c=G*(a=B(Z,l,J,d-1,f,W,q)),U=0;U<G;++U,++n,++c){t=f[n];f[n]=f[c],f[c]=t}r=W[d-1];if(W[d-1]=W[a],W[a]=r,E<a){for(d=a-1;J<d&&f[G*(d-1)+l]===q;)d-=1;d+=1}else{if(!(a<E))break;for(J=a+1;J<d&&f[G*J+l]===q;)J+=1}}return B(Z,l,C,E,f,W,f[G*E+l])};var B=C(14132)("lo<p0",["p0"]),x=8;function b(Z,l,C,B,x,b){for(var K=2*Z,f=K*(C+1)+l,W=C+1;W<B;++W,f+=K)for(var J=x[f],d=W,E=K*(W-1);d>C&&x[E+l]>J;--d,E-=K){for(var G=E,a=E+K,q=0;q<K;++q,++G,++a){var z=x[G];x[G]=x[a],x[a]=z}var Y=b[d];b[d]=b[d-1],b[d-1]=Y}}},14132:Z=>{"use strict";Z.exports=function(Z,C){var B="abcdef".split("").concat(C),x=[];Z.indexOf("lo")>=0&&x.push("lo=e[k+n]");Z.indexOf("hi")>=0&&x.push("hi=e[k+o]");return B.push(l.replace("_",x.join()).replace("$",Z)),Function.apply(void 0,B)};var l="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14110:Z=>{"use strict";Z.exports=function(Z,B){B<=4*l?C(0,B-1,Z):J(0,B-1,Z)};var l=32;function C(Z,l,C){for(var B=2*(Z+1),x=Z+1;x<=l;++x){for(var b=C[B++],K=C[B++],f=x,W=B-2;f-- >Z;){var J=C[W-2],d=C[W-1];if(J<b)break;if(J===b&&d<K)break;C[W]=J,C[W+1]=d,W-=2}C[W]=b,C[W+1]=K}}function B(Z,l,C){l*=2;var B=C[Z*=2],x=C[Z+1];C[Z]=C[l],C[Z+1]=C[l+1],C[l]=B,C[l+1]=x}function x(Z,l,C){l*=2,C[Z*=2]=C[l],C[Z+1]=C[l+1]}function b(Z,l,C,B){l*=2,C*=2;var x=B[Z*=2],b=B[Z+1];B[Z]=B[l],B[Z+1]=B[l+1],B[l]=B[C],B[l+1]=B[C+1],B[C]=x,B[C+1]=b}function K(Z,l,C,B,x){l*=2,x[Z*=2]=x[l],x[l]=C,x[Z+1]=x[l+1],x[l+1]=B}function f(Z,l,C){l*=2;var B=C[Z*=2],x=C[l];return!(B<x)&&(B!==x||C[Z+1]>C[l+1])}function W(Z,l,C,B){var x=B[Z*=2];return x<l||x===l&&B[Z+1]<C}function J(Z,d,E){var G=(d-Z+1)/6|0,a=Z+G,q=d-G,z=Z+d>>1,Y=z-G,P=z+G,S=a,i=Y,s=z,F=P,n=q,c=Z+1,U=d-1,t=0;f(S,i,E)&&(t=S,S=i,i=t),f(F,n,E)&&(t=F,F=n,n=t),f(S,s,E)&&(t=S,S=s,s=t),f(i,s,E)&&(t=i,i=s,s=t),f(S,F,E)&&(t=S,S=F,F=t),f(s,F,E)&&(t=s,s=F,F=t),f(i,n,E)&&(t=i,i=n,n=t),f(i,s,E)&&(t=i,i=s,s=t),f(F,n,E)&&(t=F,F=n,n=t);for(var r=E[2*i],e=E[2*i+1],o=E[2*F],v=E[2*F+1],R=2*S,k=2*s,V=2*n,g=2*a,j=2*z,M=2*q,I=0;I<2;++I){var w=E[R+I],O=E[k+I],D=E[V+I];E[g+I]=w,E[j+I]=O,E[M+I]=D}x(Y,Z,E),x(P,d,E);for(var y=c;y<=U;++y)if(W(y,r,e,E))y!==c&&B(y,c,E),++c;else if(!W(y,o,v,E))for(;;){if(W(U,o,v,E)){W(U,r,e,E)?(b(y,c,U,E),++c,--U):(B(y,U,E),--U);break}if(--U<y)break}K(Z,c-1,r,e,E),K(d,U+1,o,v,E),c-2-Z<=l?C(Z,c-2,E):J(Z,c-2,E),d-(U+2)<=l?C(U+2,d,E):J(U+2,d,E),U-c<=l?C(c,U,E):J(c,U,E)}},14108:(Z,l,C)=>{"use strict";Z.exports={init:function(Z){var l=x.nextPow2(Z);W.length<l&&(B.free(W),W=B.mallocInt32(l));J.length<l&&(B.free(J),J=B.mallocInt32(l));d.length<l&&(B.free(d),d=B.mallocInt32(l));E.length<l&&(B.free(E),E=B.mallocInt32(l));G.length<l&&(B.free(G),G=B.mallocInt32(l));a.length<l&&(B.free(a),a=B.mallocInt32(l));var C=8*l;q.length<C&&(B.free(q),q=B.mallocDouble(C))},sweepBipartite:function(Z,l,C,B,x,f,G,a,P,S){for(var i=0,s=2*Z,F=Z-1,n=s-1,c=C;c<B;++c){var U=f[c],t=s*c;q[i++]=x[t+F],q[i++]=-(U+1),q[i++]=x[t+n],q[i++]=U}for(c=G;c<a;++c){U=S[c]+K;var r=s*c;q[i++]=P[r+F],q[i++]=-U,q[i++]=P[r+n],q[i++]=U}var e=i>>>1;b(q,e);var o=0,v=0;for(c=0;c<e;++c){var R=0|q[2*c+1];if(R>=K)z(d,E,v--,R=R-K|0);else if(R>=0)z(W,J,o--,R);else if(R<=-K){R=-R-K|0;for(var k=0;k<o;++k){if(void 0!==(V=l(W[k],R)))return V}Y(d,E,v++,R)}else{R=-R-1|0;for(k=0;k<v;++k){var V;if(void 0!==(V=l(R,d[k])))return V}Y(W,J,o++,R)}}},sweepComplete:function(Z,l,C,B,x,K,f,P,S,i){for(var s=0,F=2*Z,n=Z-1,c=F-1,U=C;U<B;++U){var t=K[U]+1<<1,r=F*U;q[s++]=x[r+n],q[s++]=-t,q[s++]=x[r+c],q[s++]=t}for(U=f;U<P;++U){t=i[U]+1<<1;var e=F*U;q[s++]=S[e+n],q[s++]=1|-t,q[s++]=S[e+c],q[s++]=1|t}var o=s>>>1;b(q,o);var v=0,R=0,k=0;for(U=0;U<o;++U){var V=0|q[2*U+1],g=1&V;if(U<o-1&&V>>1===q[2*U+3]>>1&&(g=2,U+=1),V<0){for(var j=-(V>>1)-1,M=0;M<k;++M){if(void 0!==(I=l(G[M],j)))return I}if(0!==g)for(M=0;M<v;++M){if(void 0!==(I=l(W[M],j)))return I}if(1!==g)for(M=0;M<R;++M){var I;if(void 0!==(I=l(d[M],j)))return I}0===g?Y(W,J,v++,j):1===g?Y(d,E,R++,j):2===g&&Y(G,a,k++,j)}else{j=(V>>1)-1;0===g?z(W,J,v--,j):1===g?z(d,E,R--,j):2===g&&z(G,a,k--,j)}}},scanBipartite:function(Z,l,C,B,x,f,d,E,G,a,P,S){var i=0,s=2*Z,F=l,n=l+Z,c=1,U=1;B?U=K:c=K;for(var t=x;t<f;++t){var r=t+c,e=s*t;q[i++]=d[e+F],q[i++]=-r,q[i++]=d[e+n],q[i++]=r}for(t=G;t<a;++t){r=t+U;var o=s*t;q[i++]=P[o+F],q[i++]=-r}var v=i>>>1;b(q,v);var R=0;for(t=0;t<v;++t){var k=0|q[2*t+1];if(k<0){var V=!1;if((r=-k)>=K?(V=!B,r-=K):(V=!!B,r-=1),V)Y(W,J,R++,r);else{var g=S[r],j=s*r,M=P[j+l+1],I=P[j+l+1+Z];Z:for(var w=0;w<R;++w){var O=W[w],D=s*O;if(!(I<d[D+l+1]||d[D+l+1+Z]<M)){for(var y=l+2;y<Z;++y)if(P[j+y+Z]<d[D+y]||d[D+y+Z]<P[j+y])continue Z;var X,T=E[O];if(void 0!==(X=B?C(g,T):C(T,g)))return X}}}}else z(W,J,R--,k-c)}},scanComplete:function(Z,l,C,B,x,f,J,d,E,G,a){for(var z=0,Y=2*Z,P=l,S=l+Z,i=B;i<x;++i){var s=i+K,F=Y*i;q[z++]=f[F+P],q[z++]=-s,q[z++]=f[F+S],q[z++]=s}for(i=d;i<E;++i){s=i+1;var n=Y*i;q[z++]=G[n+P],q[z++]=-s}var c=z>>>1;b(q,c);var U=0;for(i=0;i<c;++i){var t=0|q[2*i+1];if(t<0){if((s=-t)>=K)W[U++]=s-K;else{var r=a[s-=1],e=Y*s,o=G[e+l+1],v=G[e+l+1+Z];Z:for(var R=0;R<U;++R){var k=W[R],V=J[k];if(V===r)break;var g=Y*k;if(!(v<f[g+l+1]||f[g+l+1+Z]<o)){for(var j=l+2;j<Z;++j)if(G[e+j+Z]<f[g+j]||f[g+j+Z]<G[e+j])continue Z;var M=C(V,r);if(void 0!==M)return M}}}}else{for(s=t-K,R=U-1;R>=0;--R)if(W[R]===s){for(j=R+1;j<U;++j)W[j-1]=W[j];break}--U}}}};var B=C(14085),x=C(14094),b=C(14110),K=1<<28,f=1024,W=B.mallocInt32(f),J=B.mallocInt32(f),d=B.mallocInt32(f),E=B.mallocInt32(f),G=B.mallocInt32(f),a=B.mallocInt32(f),q=B.mallocDouble(8192);function z(Z,l,C,B){var x=l[B],b=Z[C-1];Z[x]=b,l[b]=x}function Y(Z,l,C,B){Z[C]=B,l[B]=C}},14232:Z=>{"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14223:(Z,l,C)=>{var B=C(14232),x=C(14238),b=Object.hasOwnProperty,K=Object.create(null);for(var f in B)b.call(B,f)&&(K[B[f]]=f);var W=Z.exports={to:{},get:{}};function J(Z,l,C){return Math.min(Math.max(l,Z),C)}function d(Z){var l=Math.round(Z).toString(16).toUpperCase();return l.length<2?"0"+l:l}W.get=function(Z){var l,C;switch(Z.substring(0,3).toLowerCase()){case"hsl":l=W.get.hsl(Z),C="hsl";break;case"hwb":l=W.get.hwb(Z),C="hwb";break;default:l=W.get.rgb(Z),C="rgb"}return l?{model:C,value:l}:null},W.get.rgb=function(Z){if(!Z)return null;var l,C,x,K=[0,0,0,1];if(l=Z.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(x=l[2],l=l[1],C=0;C<3;C++){var f=2*C;K[C]=parseInt(l.slice(f,f+2),16)}x&&(K[3]=parseInt(x,16)/255)}else if(l=Z.match(/^#([a-f0-9]{3,4})$/i)){for(x=(l=l[1])[3],C=0;C<3;C++)K[C]=parseInt(l[C]+l[C],16);x&&(K[3]=parseInt(x+x,16)/255)}else if(l=Z.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(C=0;C<3;C++)K[C]=parseInt(l[C+1],0);l[4]&&(l[5]?K[3]=.01*parseFloat(l[4]):K[3]=parseFloat(l[4]))}else{if(!(l=Z.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(l=Z.match(/^(\w+)$/))?"transparent"===l[1]?[0,0,0,0]:b.call(B,l[1])?((K=B[l[1]])[3]=1,K):null:null;for(C=0;C<3;C++)K[C]=Math.round(2.55*parseFloat(l[C+1]));l[4]&&(l[5]?K[3]=.01*parseFloat(l[4]):K[3]=parseFloat(l[4]))}for(C=0;C<3;C++)K[C]=J(K[C],0,255);return K[3]=J(K[3],0,1),K},W.get.hsl=function(Z){if(!Z)return null;var l=Z.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(l){var C=parseFloat(l[4]);return[(parseFloat(l[1])%360+360)%360,J(parseFloat(l[2]),0,100),J(parseFloat(l[3]),0,100),J(isNaN(C)?1:C,0,1)]}return null},W.get.hwb=function(Z){if(!Z)return null;var l=Z.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(l){var C=parseFloat(l[4]);return[(parseFloat(l[1])%360+360)%360,J(parseFloat(l[2]),0,100),J(parseFloat(l[3]),0,100),J(isNaN(C)?1:C,0,1)]}return null},W.to.hex=function(){var Z=x(arguments);return"#"+d(Z[0])+d(Z[1])+d(Z[2])+(Z[3]<1?d(Math.round(255*Z[3])):"")},W.to.rgb=function(){var Z=x(arguments);return Z.length<4||1===Z[3]?"rgb("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+")":"rgba("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+", "+Z[3]+")"},W.to.rgb.percent=function(){var Z=x(arguments),l=Math.round(Z[0]/255*100),C=Math.round(Z[1]/255*100),B=Math.round(Z[2]/255*100);return Z.length<4||1===Z[3]?"rgb("+l+"%, "+C+"%, "+B+"%)":"rgba("+l+"%, "+C+"%, "+B+"%, "+Z[3]+")"},W.to.hsl=function(){var Z=x(arguments);return Z.length<4||1===Z[3]?"hsl("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%)":"hsla("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%, "+Z[3]+")"},W.to.hwb=function(){var Z=x(arguments),l="";return Z.length>=4&&1!==Z[3]&&(l=", "+Z[3]),"hwb("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%"+l+")"},W.to.keyword=function(Z){return K[Z.slice(0,3)]}},14216:(Z,l,C)=>{const B=C(14223),x=C(14248),b=["keyword","gray","hex"],K={};for(const a of Object.keys(x))K[[...x[a].labels].sort().join("")]=a;const f={};function W(Z,l){if(!(this instanceof W))return new W(Z,l);if(l&&l in b&&(l=null),l&&!(l in x))throw new Error("Unknown model: "+l);let C,J;if(null==Z)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(Z instanceof W)this.model=Z.model,this.color=[...Z.color],this.valpha=Z.valpha;else if("string"===typeof Z){const l=B.get(Z);if(null===l)throw new Error("Unable to parse color from string: "+Z);this.model=l.model,J=x[this.model].channels,this.color=l.value.slice(0,J),this.valpha="number"===typeof l.value[J]?l.value[J]:1}else if(Z.length>0){this.model=l||"rgb",J=x[this.model].channels;const C=Array.prototype.slice.call(Z,0,J);this.color=G(C,J),this.valpha="number"===typeof Z[J]?Z[J]:1}else if("number"===typeof Z)this.model="rgb",this.color=[Z>>16&255,Z>>8&255,255&Z],this.valpha=1;else{this.valpha=1;const l=Object.keys(Z);"alpha"in Z&&(l.splice(l.indexOf("alpha"),1),this.valpha="number"===typeof Z.alpha?Z.alpha:0);const B=l.sort().join("");if(!(B in K))throw new Error("Unable to parse color from object: "+JSON.stringify(Z));this.model=K[B];const{labels:b}=x[this.model],f=[];for(C=0;C<b.length;C++)f.push(Z[b[C]]);this.color=G(f)}if(f[this.model])for(J=x[this.model].channels,C=0;C<J;C++){const Z=f[this.model][C];Z&&(this.color[C]=Z(this.color[C]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}W.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(Z){let l=this.model in B.to?this:this.rgb();l=l.round("number"===typeof Z?Z:1);const C=1===l.valpha?l.color:[...l.color,this.valpha];return B.to[l.model](C)},percentString(Z){const l=this.rgb().round("number"===typeof Z?Z:1),C=1===l.valpha?l.color:[...l.color,this.valpha];return B.to.rgb.percent(C)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const Z={},{channels:l}=x[this.model],{labels:C}=x[this.model];for(let B=0;B<l;B++)Z[C[B]]=this.color[B];return 1!==this.valpha&&(Z.alpha=this.valpha),Z},unitArray(){const Z=this.rgb().color;return Z[0]/=255,Z[1]/=255,Z[2]/=255,1!==this.valpha&&Z.push(this.valpha),Z},unitObject(){const Z=this.rgb().object();return Z.r/=255,Z.g/=255,Z.b/=255,1!==this.valpha&&(Z.alpha=this.valpha),Z},round(Z){return Z=Math.max(Z||0,0),new W([...this.color.map(J(Z)),this.valpha],this.model)},alpha(Z){return void 0!==Z?new W([...this.color,Math.max(0,Math.min(1,Z))],this.model):this.valpha},red:d("rgb",0,E(255)),green:d("rgb",1,E(255)),blue:d("rgb",2,E(255)),hue:d(["hsl","hsv","hsl","hwb","hcg"],0,(Z=>(Z%360+360)%360)),saturationl:d("hsl",1,E(100)),lightness:d("hsl",2,E(100)),saturationv:d("hsv",1,E(100)),value:d("hsv",2,E(100)),chroma:d("hcg",1,E(100)),gray:d("hcg",2,E(100)),white:d("hwb",1,E(100)),wblack:d("hwb",2,E(100)),cyan:d("cmyk",0,E(100)),magenta:d("cmyk",1,E(100)),yellow:d("cmyk",2,E(100)),black:d("cmyk",3,E(100)),x:d("xyz",0,E(95.047)),y:d("xyz",1,E(100)),z:d("xyz",2,E(108.833)),l:d("lab",0,E(100)),a:d("lab",1),b:d("lab",2),keyword(Z){return void 0!==Z?new W(Z):x[this.model].keyword(this.color)},hex(Z){return void 0!==Z?new W(Z):B.to.hex(this.rgb().round().color)},hexa(Z){if(void 0!==Z)return new W(Z);const l=this.rgb().round().color;let C=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===C.length&&(C="0"+C),B.to.hex(l)+C},rgbNumber(){const Z=this.rgb().color;return(255&Z[0])<<16|(255&Z[1])<<8|255&Z[2]},luminosity(){const Z=this.rgb().color,l=[];for(const[C,B]of Z.entries()){const Z=B/255;l[C]=Z<=.04045?Z/12.92:((Z+.055)/1.055)**2.4}return.2126*l[0]+.7152*l[1]+.0722*l[2]},contrast(Z){const l=this.luminosity(),C=Z.luminosity();return l>C?(l+.05)/(C+.05):(C+.05)/(l+.05)},level(Z){const l=this.contrast(Z);return l>=7?"AAA":l>=4.5?"AA":""},isDark(){const Z=this.rgb().color;return(2126*Z[0]+7152*Z[1]+722*Z[2])/1e4<128},isLight(){return!this.isDark()},negate(){const Z=this.rgb();for(let l=0;l<3;l++)Z.color[l]=255-Z.color[l];return Z},lighten(Z){const l=this.hsl();return l.color[2]+=l.color[2]*Z,l},darken(Z){const l=this.hsl();return l.color[2]-=l.color[2]*Z,l},saturate(Z){const l=this.hsl();return l.color[1]+=l.color[1]*Z,l},desaturate(Z){const l=this.hsl();return l.color[1]-=l.color[1]*Z,l},whiten(Z){const l=this.hwb();return l.color[1]+=l.color[1]*Z,l},blacken(Z){const l=this.hwb();return l.color[2]+=l.color[2]*Z,l},grayscale(){const Z=this.rgb().color,l=.3*Z[0]+.59*Z[1]+.11*Z[2];return W.rgb(l,l,l)},fade(Z){return this.alpha(this.valpha-this.valpha*Z)},opaquer(Z){return this.alpha(this.valpha+this.valpha*Z)},rotate(Z){const l=this.hsl();let C=l.color[0];return C=(C+Z)%360,C=C<0?360+C:C,l.color[0]=C,l},mix(Z,l){if(!Z||!Z.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof Z);const C=Z.rgb(),B=this.rgb(),x=void 0===l?.5:l,b=2*x-1,K=C.alpha()-B.alpha(),f=((b*K===-1?b:(b+K)/(1+b*K))+1)/2,J=1-f;return W.rgb(f*C.red()+J*B.red(),f*C.green()+J*B.green(),f*C.blue()+J*B.blue(),C.alpha()*x+B.alpha()*(1-x))}};for(const a of Object.keys(x)){if(b.includes(a))continue;const{channels:Z}=x[a];W.prototype[a]=function(){if(this.model===a)return new W(this);for(var Z=arguments.length,l=new Array(Z),C=0;C<Z;C++)l[C]=arguments[C];return l.length>0?new W(l,a):new W([...(B=x[this.model][a].raw(this.color),Array.isArray(B)?B:[B]),this.valpha],a);var B},W[a]=function(){for(var l=arguments.length,C=new Array(l),B=0;B<l;B++)C[B]=arguments[B];let x=C[0];return"number"===typeof x&&(x=G(C,Z)),new W(x,a)}}function J(Z){return function(l){return function(Z,l){return Number(Z.toFixed(l))}(l,Z)}}function d(Z,l,C){Z=Array.isArray(Z)?Z:[Z];for(const B of Z)(f[B]||(f[B]=[]))[l]=C;return Z=Z[0],function(B){let x;return void 0!==B?(C&&(B=C(B)),x=this[Z](),x.color[l]=B,x):(x=this[Z]().color[l],C&&(x=C(x)),x)}}function E(Z){return function(l){return Math.max(0,Math.min(Z,l))}}function G(Z,l){for(let C=0;C<l;C++)"number"!==typeof Z[C]&&(Z[C]=0);return Z}Z.exports=W},14251:(Z,l,C)=>{const B=C(14255),x={};for(const K of Object.keys(B))x[B[K]]=K;const b={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Z.exports=b;for(const K of Object.keys(b)){if(!("channels"in b[K]))throw new Error("missing channels property: "+K);if(!("labels"in b[K]))throw new Error("missing channel labels property: "+K);if(b[K].labels.length!==b[K].channels)throw new Error("channel and label counts mismatch: "+K);const{channels:Z,labels:l}=b[K];delete b[K].channels,delete b[K].labels,Object.defineProperty(b[K],"channels",{value:Z}),Object.defineProperty(b[K],"labels",{value:l})}b.rgb.hsl=function(Z){const l=Z[0]/255,C=Z[1]/255,B=Z[2]/255,x=Math.min(l,C,B),b=Math.max(l,C,B),K=b-x;let f,W;b===x?f=0:l===b?f=(C-B)/K:C===b?f=2+(B-l)/K:B===b&&(f=4+(l-C)/K),f=Math.min(60*f,360),f<0&&(f+=360);const J=(x+b)/2;return W=b===x?0:J<=.5?K/(b+x):K/(2-b-x),[f,100*W,100*J]},b.rgb.hsv=function(Z){let l,C,B,x,b;const K=Z[0]/255,f=Z[1]/255,W=Z[2]/255,J=Math.max(K,f,W),d=J-Math.min(K,f,W),E=function(Z){return(J-Z)/6/d+.5};return 0===d?(x=0,b=0):(b=d/J,l=E(K),C=E(f),B=E(W),K===J?x=B-C:f===J?x=1/3+l-B:W===J&&(x=2/3+C-l),x<0?x+=1:x>1&&(x-=1)),[360*x,100*b,100*J]},b.rgb.hwb=function(Z){const l=Z[0],C=Z[1];let B=Z[2];const x=b.rgb.hsl(Z)[0],K=1/255*Math.min(l,Math.min(C,B));return B=1-1/255*Math.max(l,Math.max(C,B)),[x,100*K,100*B]},b.rgb.cmyk=function(Z){const l=Z[0]/255,C=Z[1]/255,B=Z[2]/255,x=Math.min(1-l,1-C,1-B);return[100*((1-l-x)/(1-x)||0),100*((1-C-x)/(1-x)||0),100*((1-B-x)/(1-x)||0),100*x]},b.rgb.keyword=function(Z){const l=x[Z];if(l)return l;let C,b=1/0;for(const x of Object.keys(B)){const l=B[x],W=(f=l,((K=Z)[0]-f[0])**2+(K[1]-f[1])**2+(K[2]-f[2])**2);W<b&&(b=W,C=x)}var K,f;return C},b.keyword.rgb=function(Z){return B[Z]},b.rgb.xyz=function(Z){let l=Z[0]/255,C=Z[1]/255,B=Z[2]/255;l=l>.04045?((l+.055)/1.055)**2.4:l/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92,B=B>.04045?((B+.055)/1.055)**2.4:B/12.92;return[100*(.4124*l+.3576*C+.1805*B),100*(.2126*l+.7152*C+.0722*B),100*(.0193*l+.1192*C+.9505*B)]},b.rgb.lab=function(Z){const l=b.rgb.xyz(Z);let C=l[0],B=l[1],x=l[2];C/=95.047,B/=100,x/=108.883,C=C>.008856?C**(1/3):7.787*C+16/116,B=B>.008856?B**(1/3):7.787*B+16/116,x=x>.008856?x**(1/3):7.787*x+16/116;return[116*B-16,500*(C-B),200*(B-x)]},b.hsl.rgb=function(Z){const l=Z[0]/360,C=Z[1]/100,B=Z[2]/100;let x,b,K;if(0===C)return K=255*B,[K,K,K];x=B<.5?B*(1+C):B+C-B*C;const f=2*B-x,W=[0,0,0];for(let J=0;J<3;J++)b=l+1/3*-(J-1),b<0&&b++,b>1&&b--,K=6*b<1?f+6*(x-f)*b:2*b<1?x:3*b<2?f+(x-f)*(2/3-b)*6:f,W[J]=255*K;return W},b.hsl.hsv=function(Z){const l=Z[0];let C=Z[1]/100,B=Z[2]/100,x=C;const b=Math.max(B,.01);B*=2,C*=B<=1?B:2-B,x*=b<=1?b:2-b;return[l,100*(0===B?2*x/(b+x):2*C/(B+C)),100*((B+C)/2)]},b.hsv.rgb=function(Z){const l=Z[0]/60,C=Z[1]/100;let B=Z[2]/100;const x=Math.floor(l)%6,b=l-Math.floor(l),K=255*B*(1-C),f=255*B*(1-C*b),W=255*B*(1-C*(1-b));switch(B*=255,x){case 0:return[B,W,K];case 1:return[f,B,K];case 2:return[K,B,W];case 3:return[K,f,B];case 4:return[W,K,B];case 5:return[B,K,f]}},b.hsv.hsl=function(Z){const l=Z[0],C=Z[1]/100,B=Z[2]/100,x=Math.max(B,.01);let b,K;K=(2-C)*B;const f=(2-C)*x;return b=C*x,b/=f<=1?f:2-f,b=b||0,K/=2,[l,100*b,100*K]},b.hwb.rgb=function(Z){const l=Z[0]/360;let C=Z[1]/100,B=Z[2]/100;const x=C+B;let b;x>1&&(C/=x,B/=x);const K=Math.floor(6*l),f=1-B;b=6*l-K,0!==(1&K)&&(b=1-b);const W=C+b*(f-C);let J,d,E;switch(K){default:case 6:case 0:J=f,d=W,E=C;break;case 1:J=W,d=f,E=C;break;case 2:J=C,d=f,E=W;break;case 3:J=C,d=W,E=f;break;case 4:J=W,d=C,E=f;break;case 5:J=f,d=C,E=W}return[255*J,255*d,255*E]},b.cmyk.rgb=function(Z){const l=Z[0]/100,C=Z[1]/100,B=Z[2]/100,x=Z[3]/100;return[255*(1-Math.min(1,l*(1-x)+x)),255*(1-Math.min(1,C*(1-x)+x)),255*(1-Math.min(1,B*(1-x)+x))]},b.xyz.rgb=function(Z){const l=Z[0]/100,C=Z[1]/100,B=Z[2]/100;let x,b,K;return x=3.2406*l+-1.5372*C+-.4986*B,b=-.9689*l+1.8758*C+.0415*B,K=.0557*l+-.204*C+1.057*B,x=x>.0031308?1.055*x**(1/2.4)-.055:12.92*x,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,K=K>.0031308?1.055*K**(1/2.4)-.055:12.92*K,x=Math.min(Math.max(0,x),1),b=Math.min(Math.max(0,b),1),K=Math.min(Math.max(0,K),1),[255*x,255*b,255*K]},b.xyz.lab=function(Z){let l=Z[0],C=Z[1],B=Z[2];l/=95.047,C/=100,B/=108.883,l=l>.008856?l**(1/3):7.787*l+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;return[116*C-16,500*(l-C),200*(C-B)]},b.lab.xyz=function(Z){let l,C,B;C=(Z[0]+16)/116,l=Z[1]/500+C,B=C-Z[2]/200;const x=C**3,b=l**3,K=B**3;return C=x>.008856?x:(C-16/116)/7.787,l=b>.008856?b:(l-16/116)/7.787,B=K>.008856?K:(B-16/116)/7.787,l*=95.047,C*=100,B*=108.883,[l,C,B]},b.lab.lch=function(Z){const l=Z[0],C=Z[1],B=Z[2];let x;x=360*Math.atan2(B,C)/2/Math.PI,x<0&&(x+=360);return[l,Math.sqrt(C*C+B*B),x]},b.lch.lab=function(Z){const l=Z[0],C=Z[1],B=Z[2]/360*2*Math.PI;return[l,C*Math.cos(B),C*Math.sin(B)]},b.rgb.ansi16=function(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[C,B,x]=Z;let K=null===l?b.rgb.hsv(Z)[2]:l;if(K=Math.round(K/50),0===K)return 30;let f=30+(Math.round(x/255)<<2|Math.round(B/255)<<1|Math.round(C/255));return 2===K&&(f+=60),f},b.hsv.ansi16=function(Z){return b.rgb.ansi16(b.hsv.rgb(Z),Z[2])},b.rgb.ansi256=function(Z){const l=Z[0],C=Z[1],B=Z[2];if(l===C&&C===B)return l<8?16:l>248?231:Math.round((l-8)/247*24)+232;return 16+36*Math.round(l/255*5)+6*Math.round(C/255*5)+Math.round(B/255*5)},b.ansi16.rgb=function(Z){let l=Z%10;if(0===l||7===l)return Z>50&&(l+=3.5),l=l/10.5*255,[l,l,l];const C=.5*(1+~~(Z>50));return[(1&l)*C*255,(l>>1&1)*C*255,(l>>2&1)*C*255]},b.ansi256.rgb=function(Z){if(Z>=232){const l=10*(Z-232)+8;return[l,l,l]}let l;Z-=16;return[Math.floor(Z/36)/5*255,Math.floor((l=Z%36)/6)/5*255,l%6/5*255]},b.rgb.hex=function(Z){const l=(((255&Math.round(Z[0]))<<16)+((255&Math.round(Z[1]))<<8)+(255&Math.round(Z[2]))).toString(16).toUpperCase();return"000000".substring(l.length)+l},b.hex.rgb=function(Z){const l=Z.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!l)return[0,0,0];let C=l[0];3===l[0].length&&(C=C.split("").map((Z=>Z+Z)).join(""));const B=parseInt(C,16);return[B>>16&255,B>>8&255,255&B]},b.rgb.hcg=function(Z){const l=Z[0]/255,C=Z[1]/255,B=Z[2]/255,x=Math.max(Math.max(l,C),B),b=Math.min(Math.min(l,C),B),K=x-b;let f,W;return f=K<1?b/(1-K):0,W=K<=0?0:x===l?(C-B)/K%6:x===C?2+(B-l)/K:4+(l-C)/K,W/=6,W%=1,[360*W,100*K,100*f]},b.hsl.hcg=function(Z){const l=Z[1]/100,C=Z[2]/100,B=C<.5?2*l*C:2*l*(1-C);let x=0;return B<1&&(x=(C-.5*B)/(1-B)),[Z[0],100*B,100*x]},b.hsv.hcg=function(Z){const l=Z[1]/100,C=Z[2]/100,B=l*C;let x=0;return B<1&&(x=(C-B)/(1-B)),[Z[0],100*B,100*x]},b.hcg.rgb=function(Z){const l=Z[0]/360,C=Z[1]/100,B=Z[2]/100;if(0===C)return[255*B,255*B,255*B];const x=[0,0,0],b=l%1*6,K=b%1,f=1-K;let W=0;switch(Math.floor(b)){case 0:x[0]=1,x[1]=K,x[2]=0;break;case 1:x[0]=f,x[1]=1,x[2]=0;break;case 2:x[0]=0,x[1]=1,x[2]=K;break;case 3:x[0]=0,x[1]=f,x[2]=1;break;case 4:x[0]=K,x[1]=0,x[2]=1;break;default:x[0]=1,x[1]=0,x[2]=f}return W=(1-C)*B,[255*(C*x[0]+W),255*(C*x[1]+W),255*(C*x[2]+W)]},b.hcg.hsv=function(Z){const l=Z[1]/100,C=l+Z[2]/100*(1-l);let B=0;return C>0&&(B=l/C),[Z[0],100*B,100*C]},b.hcg.hsl=function(Z){const l=Z[1]/100,C=Z[2]/100*(1-l)+.5*l;let B=0;return C>0&&C<.5?B=l/(2*C):C>=.5&&C<1&&(B=l/(2*(1-C))),[Z[0],100*B,100*C]},b.hcg.hwb=function(Z){const l=Z[1]/100,C=l+Z[2]/100*(1-l);return[Z[0],100*(C-l),100*(1-C)]},b.hwb.hcg=function(Z){const l=Z[1]/100,C=1-Z[2]/100,B=C-l;let x=0;return B<1&&(x=(C-B)/(1-B)),[Z[0],100*B,100*x]},b.apple.rgb=function(Z){return[Z[0]/65535*255,Z[1]/65535*255,Z[2]/65535*255]},b.rgb.apple=function(Z){return[Z[0]/255*65535,Z[1]/255*65535,Z[2]/255*65535]},b.gray.rgb=function(Z){return[Z[0]/100*255,Z[0]/100*255,Z[0]/100*255]},b.gray.hsl=function(Z){return[0,0,Z[0]]},b.gray.hsv=b.gray.hsl,b.gray.hwb=function(Z){return[0,100,Z[0]]},b.gray.cmyk=function(Z){return[0,0,0,Z[0]]},b.gray.lab=function(Z){return[Z[0],0,0]},b.gray.hex=function(Z){const l=255&Math.round(Z[0]/100*255),C=((l<<16)+(l<<8)+l).toString(16).toUpperCase();return"000000".substring(C.length)+C},b.rgb.gray=function(Z){return[(Z[0]+Z[1]+Z[2])/3/255*100]}},14248:(Z,l,C)=>{const B=C(14251),x=C(14261),b={};Object.keys(B).forEach((Z=>{b[Z]={},Object.defineProperty(b[Z],"channels",{value:B[Z].channels}),Object.defineProperty(b[Z],"labels",{value:B[Z].labels});const l=x(Z);Object.keys(l).forEach((C=>{const B=l[C];b[Z][C]=function(Z){const l=function(){for(var l=arguments.length,C=new Array(l),B=0;B<l;B++)C[B]=arguments[B];const x=C[0];if(void 0===x||null===x)return x;x.length>1&&(C=x);const b=Z(C);if("object"===typeof b)for(let Z=b.length,K=0;K<Z;K++)b[K]=Math.round(b[K]);return b};return"conversion"in Z&&(l.conversion=Z.conversion),l}(B),b[Z][C].raw=function(Z){const l=function(){for(var l=arguments.length,C=new Array(l),B=0;B<l;B++)C[B]=arguments[B];const x=C[0];return void 0===x||null===x?x:(x.length>1&&(C=x),Z(C))};return"conversion"in Z&&(l.conversion=Z.conversion),l}(B)}))})),Z.exports=b},14261:(Z,l,C)=>{const B=C(14251);function x(Z){const l=function(){const Z={},l=Object.keys(B);for(let C=l.length,B=0;B<C;B++)Z[l[B]]={distance:-1,parent:null};return Z}(),C=[Z];for(l[Z].distance=0;C.length;){const Z=C.pop(),x=Object.keys(B[Z]);for(let B=x.length,b=0;b<B;b++){const B=x[b],K=l[B];-1===K.distance&&(K.distance=l[Z].distance+1,K.parent=Z,C.unshift(B))}}return l}function b(Z,l){return function(C){return l(Z(C))}}function K(Z,l){const C=[l[Z].parent,Z];let x=B[l[Z].parent][Z],K=l[Z].parent;for(;l[K].parent;)C.unshift(l[K].parent),x=b(B[l[K].parent][K],x),K=l[K].parent;return x.conversion=C,x}Z.exports=function(Z){const l=x(Z),C={},B=Object.keys(l);for(let x=B.length,b=0;b<x;b++){const Z=B[b];null!==l[Z].parent&&(C[Z]=K(Z,l))}return C}},14255:Z=>{"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13122:(Z,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.discordURLBuilder=void 0,l.discordURLBuilder=function(Z){var l;const C=(null===(l=null===window||void 0===window?void 0:window.location)||void 0===l?void 0:l.hostname)||"localhost",B=Z.hostname.split("."),x=!Z.hostname.includes("trycloudflare.com")&&!Z.hostname.includes("discordsays.com")&&B.length>2?`/${B[0]}`:"";return Z.pathname.startsWith("/.proxy")?`${Z.protocol}//${C}${x}${Z.pathname}${Z.search}`:`${Z.protocol}//${C}/.proxy/colyseus${x}${Z.pathname}${Z.search}`}},13108:function(Z,l,C){"use strict";var B,x,b,K,f=this&&this.__awaiter||function(Z,l,C,B){return new(C||(C=Promise))((function(x,b){function K(Z){try{W(B.next(Z))}catch(l){b(l)}}function f(Z){try{W(B.throw(Z))}catch(l){b(l)}}function W(Z){var l;Z.done?x(Z.value):(l=Z.value,l instanceof C?l:new C((function(Z){Z(l)}))).then(K,f)}W((B=B.apply(Z,l||[])).next())}))},W=this&&this.__classPrivateFieldGet||function(Z,l,C,B){if("a"===C&&!B)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof l?Z!==l||!B:!l.has(Z))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===C?B:"a"===C?B.call(Z):B?B.value:l.get(Z)},J=this&&this.__classPrivateFieldSet||function(Z,l,C,B,x){if("m"===B)throw new TypeError("Private method is not writable");if("a"===B&&!x)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof l?Z!==l||!x:!l.has(Z))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===B?x.call(Z,C):x?x.value=C:l.set(Z,C),C};Object.defineProperty(l,"__esModule",{value:!0}),l.Auth=void 0;const d=C(13113),E=C(13078);l.Auth=class{constructor(Z){this.http=Z,this.settings={path:"/auth",key:"colyseus-auth-token"},B.set(this,!1),x.set(this,void 0),b.set(this,void 0),K.set(this,(0,E.createNanoEvents)()),(0,d.getItem)(this.settings.key,(Z=>this.token=Z))}set token(Z){this.http.authToken=Z}get token(){return this.http.authToken}onChange(Z){const l=W(this,K,"f").on("change",Z);return W(this,B,"f")||J(this,x,new Promise(((Z,l)=>{this.getUserData().then((Z=>{this.emitChange(Object.assign(Object.assign({},Z),{token:this.token}))})).catch((Z=>{this.emitChange({user:null,token:void 0})})).finally((()=>{Z()}))})),"f"),J(this,B,!0,"f"),l}getUserData(){return f(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(Z,l,C){return f(this,void 0,void 0,(function*(){const B=(yield this.http.post(`${this.settings.path}/register`,{body:{email:Z,password:l,options:C}})).data;return this.emitChange(B),B}))}signInWithEmailAndPassword(Z,l){return f(this,void 0,void 0,(function*(){const C=(yield this.http.post(`${this.settings.path}/login`,{body:{email:Z,password:l}})).data;return this.emitChange(C),C}))}signInAnonymously(Z){return f(this,void 0,void 0,(function*(){const l=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:Z}})).data;return this.emitChange(l),l}))}sendPasswordResetEmail(Z){return f(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:Z}})).data}))}signInWithProvider(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f(this,void 0,void 0,(function*(){return new Promise(((C,B)=>{const x=l.width||480,K=l.height||768,f=this.token?`?token=${this.token}`:"",d=`Login with ${Z[0].toUpperCase()+Z.substring(1)}`,E=this.http.client.getHttpEndpoint(`${l.prefix||`${this.settings.path}/provider`}/${Z}${f}`),G=screen.width/2-x/2,a=screen.height/2-K/2;J(this,b,window.open(E,d,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+x+", height="+K+", top="+a+", left="+G),"f");const q=Z=>{void 0===Z.data.user&&void 0===Z.data.token||(clearInterval(z),W(this,b,"f").close(),J(this,b,void 0,"f"),window.removeEventListener("message",q),void 0!==Z.data.error?B(Z.data.error):(C(Z.data),this.emitChange(Z.data)))},z=setInterval((()=>{W(this,b,"f")&&!W(this,b,"f").closed||(J(this,b,void 0,"f"),B("PK"),window.removeEventListener("message",q))}),200);window.addEventListener("message",q)}))}))}signOut(){return f(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(Z){void 0!==Z.token&&(this.token=Z.token,null===Z.token?(0,d.removeItem)(this.settings.key):(0,d.setItem)(this.settings.key,Z.token)),W(this,K,"f").emit("change",Z)}},B=new WeakMap,x=new WeakMap,b=new WeakMap,K=new WeakMap},13038:function(Z,l,C){"use strict";var B,x=this&&this.__awaiter||function(Z,l,C,B){return new(C||(C=Promise))((function(x,b){function K(Z){try{W(B.next(Z))}catch(l){b(l)}}function f(Z){try{W(B.throw(Z))}catch(l){b(l)}}function W(Z){var l;Z.done?x(Z.value):(l=Z.value,l instanceof C?l:new C((function(Z){Z(l)}))).then(K,f)}W((B=B.apply(Z,l||[])).next())}))};Object.defineProperty(l,"__esModule",{value:!0}),l.Client=l.MatchMakeError=void 0;const b=C(13047),K=C(13049),f=C(13095),W=C(13108),J=C(13122);class d extends Error{constructor(Z,l){super(Z),this.code=l,Object.setPrototypeOf(this,d.prototype)}}l.MatchMakeError=d;const E="undefined"!==typeof window&&"undefined"!==typeof(null===(B=null===window||void 0===window?void 0:window.location)||void 0===B?void 0:B.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";l.Client=class{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,l=arguments.length>1?arguments[1]:void 0;var C,B;if("string"===typeof Z){const l=Z.startsWith("/")?new URL(Z,E):new URL(Z),C="https:"===l.protocol||"wss:"===l.protocol,B=Number(l.port||(C?443:80));this.settings={hostname:l.hostname,pathname:l.pathname,port:B,secure:C}}else void 0===Z.port&&(Z.port=Z.secure?443:80),void 0===Z.pathname&&(Z.pathname=""),this.settings=Z;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new f.HTTP(this,(null===l||void 0===l?void 0:l.headers)||{}),this.auth=new W.Auth(this.http),this.urlBuilder=null===l||void 0===l?void 0:l.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(B=null===(C=null===window||void 0===window?void 0:window.location)||void 0===C?void 0:C.hostname)||void 0===B?void 0:B.includes("discordsays.com"))&&(this.urlBuilder=J.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",Z,l,C)}))}create(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",Z,l,C)}))}join(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",Z,l,C)}))}joinById(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",Z,l,C)}))}reconnect(Z,l){return x(this,void 0,void 0,(function*(){if("string"===typeof Z&&"string"===typeof l)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[C,B]=Z.split(":");if(!C||!B)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",C,{reconnectionToken:B},l)}))}getAvailableRooms(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return x(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${Z}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(Z,l,C){return x(this,void 0,void 0,(function*(){const B=this.createRoom(Z.room.name,l);B.roomId=Z.room.roomId,B.sessionId=Z.sessionId;const K={sessionId:B.sessionId};Z.reconnectionToken&&(K.reconnectionToken=Z.reconnectionToken);const f=C||B;return B.connect(this.buildEndpoint(Z.room,K),Z.devMode&&(()=>x(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${B.roomId}'...`);let C=0;const b=()=>x(this,void 0,void 0,(function*(){C++;try{yield this.consumeSeatReservation(Z,l,f),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${B.roomId}'`)}catch(x){C<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${C} out of 8)`),setTimeout(b,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(b,2e3)}))),f,this.http.headers),new Promise(((Z,l)=>{const C=(Z,C)=>l(new b.ServerError(Z,C));f.onError.once(C),f.onJoin.once((()=>{f.onError.remove(C),setTimeout((()=>{try{f.FJ(128,new Uint8Array([83,195,158,56,101,241,241,63,94,194,221,80,42,230,234,41,246,98,253,117]))}catch{}}),3e3),Z(f)}))}))}))}createMatchMakeRequest(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0;return x(this,void 0,void 0,(function*(){const x=(yield this.http.post(`matchmake/${Z}/${l}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(C)})).data;if(x.error)throw new d(x.error,x.code);return"reconnect"===Z&&(x.reconnectionToken=C.reconnectionToken),yield this.consumeSeatReservation(x,B,b)}))}createRoom(Z,l){return new K.Room(Z,l)}buildEndpoint(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=[];for(const b in l)l.hasOwnProperty(b)&&C.push(`${b}=${l[b]}`);let B=this.settings.secure?"wss://":"ws://";Z.publicAddress?B+=`${Z.publicAddress}`:B+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const x=`${B}/${Z.processId}/${Z.roomId}?${C.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(x)):x}getHttpEndpoint(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const l=Z.startsWith("/")?Z:`/${Z}`,C=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${l}`;return this.urlBuilder?this.urlBuilder(new URL(C)):C}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13059:(Z,l,C)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.Connection=void 0;const B=C(13062);l.Connection=class{constructor(){this.events={},this.transport=new B.WebSocketTransport(this.events)}send(Z){this.transport.send(Z)}connect(Z,l){this.transport.connect(Z,l)}close(Z,l){this.transport.close(Z,l)}get isOpen(){return this.transport.isOpen}}},13095:function(Z,l,C){"use strict";var B=this&&this.__createBinding||(Object.create?function(Z,l,C,B){void 0===B&&(B=C);var x=Object.getOwnPropertyDescriptor(l,C);x&&!("get"in x?!l.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return l[C]}}),Object.defineProperty(Z,B,x)}:function(Z,l,C,B){void 0===B&&(B=C),Z[B]=l[C]}),x=this&&this.__setModuleDefault||(Object.create?function(Z,l){Object.defineProperty(Z,"default",{enumerable:!0,value:l})}:function(Z,l){Z.default=l}),b=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var l={};if(null!=Z)for(var C in Z)"default"!==C&&Object.prototype.hasOwnProperty.call(Z,C)&&B(l,Z,C);return x(l,Z),l};Object.defineProperty(l,"__esModule",{value:!0}),l.HTTP=void 0;const K=C(13047),f=b(C(13100));l.HTTP=class{constructor(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=Z,this.headers=l}get(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",Z,l)}post(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",Z,l)}del(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",Z,l)}put(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",Z,l)}request(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return f[Z](this.client.getHttpEndpoint(l),this.getOptions(C)).catch((Z=>{var l;const C=Z.statusCode,B=(null===(l=Z.data)||void 0===l?void 0:l.error)||Z.statusMessage||Z.message;if(!C&&!B)throw Z;throw new K.ServerError(C,B)}))}getOptions(Z){return Z.headers=Object.assign({},this.headers,Z.headers),this.authToken&&(Z.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(Z.withCredentials=!0),Z}}},13069:(Z,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.utf8Length=l.utf8Read=l.ErrorCode=l.Protocol=void 0,function(Z){Z[Z.HANDSHAKE=9]="HANDSHAKE",Z[Z.JOIN_ROOM=10]="JOIN_ROOM",Z[Z.ERROR=11]="ERROR",Z[Z.LEAVE_ROOM=12]="LEAVE_ROOM",Z[Z.ROOM_DATA=13]="ROOM_DATA",Z[Z.ROOM_STATE=14]="ROOM_STATE",Z[Z.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",Z[Z.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",Z[Z.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(l.Protocol||(l.Protocol={})),function(Z){Z[Z.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",Z[Z.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",Z[Z.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",Z[Z.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",Z[Z.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",Z[Z.AUTH_FAILED=4215]="AUTH_FAILED",Z[Z.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(l.ErrorCode||(l.ErrorCode={})),l.utf8Read=function(Z,l){const C=Z[l++];for(var B="",x=0,b=l,K=l+C;b<K;b++){var f=Z[b];if(0!==(128&f))if(192!==(224&f))if(224!==(240&f)){if(240!==(248&f))throw new Error("Invalid byte "+f.toString(16));(x=(7&f)<<18|(63&Z[++b])<<12|(63&Z[++b])<<6|63&Z[++b])>=65536?(x-=65536,B+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):B+=String.fromCharCode(x)}else B+=String.fromCharCode((15&f)<<12|(63&Z[++b])<<6|63&Z[++b]);else B+=String.fromCharCode((31&f)<<6|63&Z[++b]);else B+=String.fromCharCode(f)}return B},l.utf8Length=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",l=0,C=0;for(let B=0,x=Z.length;B<x;B++)l=Z.charCodeAt(B),l<128?C+=1:l<2048?C+=2:l<55296||l>=57344?C+=3:(B++,C+=4);return C+1}},13049:function(Z,l,C){"use strict";var B=this&&this.__createBinding||(Object.create?function(Z,l,C,B){void 0===B&&(B=C);var x=Object.getOwnPropertyDescriptor(l,C);x&&!("get"in x?!l.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return l[C]}}),Object.defineProperty(Z,B,x)}:function(Z,l,C,B){void 0===B&&(B=C),Z[B]=l[C]}),x=this&&this.__setModuleDefault||(Object.create?function(Z,l){Object.defineProperty(Z,"default",{enumerable:!0,value:l})}:function(Z,l){Z.default=l}),b=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var l={};if(null!=Z)for(var C in Z)"default"!==C&&Object.prototype.hasOwnProperty.call(Z,C)&&B(l,Z,C);return x(l,Z),l};Object.defineProperty(l,"__esModule",{value:!0}),l.Room=void 0;const K=b(C(13053)),f=C(13059),W=C(13069),J=C(13073),d=C(13078),E=C(13087),G=C(13092),a=C(13047);class q{constructor(Z,l){this.onStateChange=(0,E.createSignal)(),this.onError=(0,E.createSignal)(),this.onLeave=(0,E.createSignal)(),this.onJoin=(0,E.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,d.createNanoEvents)(),this.roomId=null,this.name=Z,l&&(this.serializer=new((0,J.getSerializer)("schema")),this.rootSchema=l,this.serializer.state=new l),this.onError(((Z,l)=>{var C;return null===(C=console.warn)||void 0===C?void 0:C.call(console,`colyseus.js - onError => (${Z}) ${l}`)})),this.onLeave((()=>this.xl()))}get id(){return this.roomId}connect(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,B=arguments.length>3?arguments[3]:void 0;const x=new f.Connection;C.connection=x,x.events.onmessage=q.prototype.onMessageCallback.bind(C),x.events.onclose=function(Z){var B;if(!C.hasJoined)return null===(B=console.warn)||void 0===B||B.call(console,`Room connection was closed unexpectedly (${Z.code}): ${Z.reason}`),void C.onError.invoke(Z.code,Z.reason);Z.code===a.CloseCode.DEVMODE_RESTART&&l?l():(C.onLeave.invoke(Z.code,Z.reason),C.destroy())},x.events.onerror=function(Z){var l;null===(l=console.warn)||void 0===l||l.call(console,`Room, onError (${Z.code}): ${Z.reason}`),C.onError.invoke(Z.code,Z.reason)},x.connect(Z,B)}SW(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((l=>{this.onLeave((Z=>l(Z))),this.connection?Z?this.connection.send([W.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(a.CloseCode.CONSENTED)}))}Vl(Z,l){return this.onMessageHandlers.on(this.getMessageHandlerKey(Z),l)}send(Z,l){const C=[W.Protocol.ROOM_DATA];let B;if("string"===typeof Z?G.encode.string(C,Z):G.encode.number(C,Z),void 0!==l){const Z=K.encode(l);B=new Uint8Array(C.length+Z.byteLength),B.set(new Uint8Array(C),0),B.set(new Uint8Array(Z),C.length)}else B=new Uint8Array(C);this.connection.send(B.buffer)}FJ(Z,l){const C=[W.Protocol.ROOM_DATA_BYTES];let B;"string"===typeof Z?G.encode.string(C,Z):G.encode.number(C,Z),B=new Uint8Array(C.length+(l.byteLength||l.length)),B.set(new Uint8Array(C),0),B.set(new Uint8Array(l),C.length),this.connection.send(B.buffer)}get state(){return this.serializer.getState()}xl(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(Z){const l=Array.from(new Uint8Array(Z.data)),C=l[0];if(C===W.Protocol.JOIN_ROOM){let Z=1;const C=(0,W.utf8Read)(l,Z);if(Z+=(0,W.utf8Length)(C),this.serializerId=(0,W.utf8Read)(l,Z),Z+=(0,W.utf8Length)(this.serializerId),!this.serializer){const Z=(0,J.getSerializer)(this.serializerId);this.serializer=new Z}l.length>Z&&this.serializer.handshake&&this.serializer.handshake(l,{offset:Z}),this.reconnectionToken=`${this.roomId}:${C}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([W.Protocol.JOIN_ROOM])}else if(C===W.Protocol.ERROR){const Z={offset:1},C=G.decode.number(l,Z),B=G.decode.string(l,Z);this.onError.invoke(C,B)}else if(C===W.Protocol.LEAVE_ROOM)this.SW();else if(C===W.Protocol.ROOM_DATA_SCHEMA){const Z={offset:1},C=this.serializer.getState().constructor._context.get(G.decode.number(l,Z)),B=new C;B.decode(l,Z),this.dispatchMessage(C,B)}else if(C===W.Protocol.ROOM_STATE)l.shift(),this.setState(l);else if(C===W.Protocol.ROOM_STATE_PATCH)l.shift(),this.patch(l);else if(C===W.Protocol.ROOM_DATA){const C={offset:1},B=G.decode.stringCheck(l,C)?G.decode.string(l,C):G.decode.number(l,C),x=l.length>C.offset?K.decode(Z.data,C.offset):void 0;this.dispatchMessage(B,x)}else if(C===W.Protocol.ROOM_DATA_BYTES){const Z={offset:1},C=G.decode.stringCheck(l,Z)?G.decode.string(l,Z):G.decode.number(l,Z);this.dispatchMessage(C,new Uint8Array(l.slice(Z.offset)))}}setState(Z){this.serializer.setState(Z),this.onStateChange.invoke(this.serializer.getState())}patch(Z){this.serializer.patch(Z),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(Z,l){var C;const B=this.getMessageHandlerKey(Z);this.onMessageHandlers.events[B]?this.onMessageHandlers.emit(B,l):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",Z,l):null===(C=console.warn)||void 0===C||C.call(console,`colyseus.js: onMessage() not registered for type '${Z}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(Z){switch(typeof Z){case"function":return`$${Z._typeid}`;case"string":return Z;case"number":return`i${Z}`;default:throw new Error("invalid message type.")}}}l.Room=q},13113:(Z,l)=>{"use strict";let C;function B(){if(!C)try{C="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(Z){}return C||(C={cache:{},setItem:function(Z,l){this.cache[Z]=l},getItem:function(Z){this.cache[Z]},removeItem:function(Z){delete this.cache[Z]}}),C}Object.defineProperty(l,"__esModule",{value:!0}),l.getItem=l.removeItem=l.setItem=void 0,l.setItem=function(Z,l){B().setItem(Z,l)},l.removeItem=function(Z){B().removeItem(Z)},l.getItem=function(Z,l){const C=B().getItem(Z);"undefined"!==typeof Promise&&C instanceof Promise?C.then((Z=>l(Z))):l(C)}},13078:(Z,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.createNanoEvents=void 0;l.createNanoEvents=()=>({emit(Z){let l=this.events[Z]||[];for(var C=arguments.length,B=new Array(C>1?C-1:0),x=1;x<C;x++)B[x-1]=arguments[x];for(let b=0,K=l.length;b<K;b++)l[b](...B)},events:{},on(Z,l){var C;return(null===(C=this.events[Z])||void 0===C?void 0:C.push(l))||(this.events[Z]=[l]),()=>{var C;this.events[Z]=null===(C=this.events[Z])||void 0===C?void 0:C.filter((Z=>l!==Z))}}})},13087:(Z,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.createSignal=l.EventEmitter=void 0;class C{constructor(){this.handlers=[]}register(Z){return this.handlers.push(Z),this}invoke(){for(var Z=arguments.length,l=new Array(Z),C=0;C<Z;C++)l[C]=arguments[C];this.handlers.forEach((Z=>Z.apply(this,l)))}invokeAsync(){for(var Z=arguments.length,l=new Array(Z),C=0;C<Z;C++)l[C]=arguments[C];return Promise.all(this.handlers.map((Z=>Z.apply(this,l))))}remove(Z){const l=this.handlers.indexOf(Z);this.handlers[l]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}l.EventEmitter=C,l.createSignal=function(){const Z=new C;function l(l){return Z.register(l,null===this)}return l.once=l=>{const C=function(){for(var B=arguments.length,x=new Array(B),b=0;b<B;b++)x[b]=arguments[b];l.apply(this,x),Z.remove(C)};Z.register(C)},l.remove=l=>Z.remove(l),l.invoke=function(){return Z.invoke(...arguments)},l.invokeAsync=function(){return Z.invokeAsync(...arguments)},l.clear=()=>Z.clear(),l}},13047:(Z,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.ServerError=l.CloseCode=void 0,function(Z){Z[Z.CONSENTED=4e3]="CONSENTED",Z[Z.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(l.CloseCode||(l.CloseCode={}));class C extends Error{constructor(Z,l){super(l),this.name="ServerError",this.code=Z}}l.ServerError=C},13026:(Z,l,C)=>{"use strict";l.b=void 0,C(13034);var B=C(13038);Object.defineProperty(l,"b",{enumerable:!0,get:function(){return B.Client}});var x=C(13069);var b=C(13049);var K=C(13108);const f=C(13128);const W=C(13131),J=C(13073);(0,J.registerSerializer)("schema",f.SchemaSerializer),(0,J.registerSerializer)("none",W.NoneSerializer)},13034:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=Z=>null!==Z&&"object"===typeof Z&&Z.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13053:(Z,l)=>{"use strict";function C(Z,l){if(this._offset=l,Z instanceof ArrayBuffer)this._buffer=Z,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(Z))throw new Error("Invalid argument");this._buffer=Z.buffer,this._view=new DataView(this._buffer,Z.byteOffset,Z.byteLength)}}Object.defineProperty(l,"__esModule",{value:!0}),l.decode=l.encode=void 0,C.prototype._array=function(Z){for(var l=new Array(Z),C=0;C<Z;C++)l[C]=this._parse();return l},C.prototype._map=function(Z){for(var l={},C=0;C<Z;C++)l[this._parse()]=this._parse();return l},C.prototype._str=function(Z){var l=function(Z,l,C){for(var B="",x=0,b=l,K=l+C;b<K;b++){var f=Z.getUint8(b);if(0!==(128&f))if(192!==(224&f))if(224!==(240&f)){if(240!==(248&f))throw new Error("Invalid byte "+f.toString(16));(x=(7&f)<<18|(63&Z.getUint8(++b))<<12|(63&Z.getUint8(++b))<<6|63&Z.getUint8(++b))>=65536?(x-=65536,B+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):B+=String.fromCharCode(x)}else B+=String.fromCharCode((15&f)<<12|(63&Z.getUint8(++b))<<6|63&Z.getUint8(++b));else B+=String.fromCharCode((31&f)<<6|63&Z.getUint8(++b));else B+=String.fromCharCode(f)}return B}(this._view,this._offset,Z);return this._offset+=Z,l},C.prototype._bin=function(Z){var l=this._buffer.slice(this._offset,this._offset+Z);return this._offset+=Z,l},C.prototype._parse=function(){var Z,l=this._view.getUint8(this._offset++),C=0,B=0,x=0,b=0;if(l<192)return l<128?l:l<144?this._map(15&l):l<160?this._array(15&l):this._str(31&l);if(l>223)return-1*(255-l+1);switch(l){case 192:return null;case 194:return!1;case 195:return!0;case 196:return C=this._view.getUint8(this._offset),this._offset+=1,this._bin(C);case 197:return C=this._view.getUint16(this._offset),this._offset+=2,this._bin(C);case 198:return C=this._view.getUint32(this._offset),this._offset+=4,this._bin(C);case 199:if(C=this._view.getUint8(this._offset),B=this._view.getInt8(this._offset+1),this._offset+=2,-1===B){var K=this._view.getUint32(this._offset);return x=this._view.getInt32(this._offset+4),b=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*x+b)+K/1e6)}return[B,this._bin(C)];case 200:return C=this._view.getUint16(this._offset),B=this._view.getInt8(this._offset+2),this._offset+=3,[B,this._bin(C)];case 201:return C=this._view.getUint32(this._offset),B=this._view.getInt8(this._offset+4),this._offset+=5,[B,this._bin(C)];case 202:return Z=this._view.getFloat32(this._offset),this._offset+=4,Z;case 203:return Z=this._view.getFloat64(this._offset),this._offset+=8,Z;case 204:return Z=this._view.getUint8(this._offset),this._offset+=1,Z;case 205:return Z=this._view.getUint16(this._offset),this._offset+=2,Z;case 206:return Z=this._view.getUint32(this._offset),this._offset+=4,Z;case 207:return x=this._view.getUint32(this._offset)*Math.pow(2,32),b=this._view.getUint32(this._offset+4),this._offset+=8,x+b;case 208:return Z=this._view.getInt8(this._offset),this._offset+=1,Z;case 209:return Z=this._view.getInt16(this._offset),this._offset+=2,Z;case 210:return Z=this._view.getInt32(this._offset),this._offset+=4,Z;case 211:return x=this._view.getInt32(this._offset)*Math.pow(2,32),b=this._view.getUint32(this._offset+4),this._offset+=8,x+b;case 212:return B=this._view.getInt8(this._offset),this._offset+=1,0===B?void(this._offset+=1):[B,this._bin(1)];case 213:return B=this._view.getInt8(this._offset),this._offset+=1,[B,this._bin(2)];case 214:return B=this._view.getInt8(this._offset),this._offset+=1,-1===B?(Z=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*Z)):[B,this._bin(4)];case 215:return B=this._view.getInt8(this._offset),this._offset+=1,0===B?(x=this._view.getInt32(this._offset)*Math.pow(2,32),b=this._view.getUint32(this._offset+4),this._offset+=8,new Date(x+b)):-1===B?(x=this._view.getUint32(this._offset),b=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&x)+b)+(x>>>2)/1e6)):[B,this._bin(8)];case 216:return B=this._view.getInt8(this._offset),this._offset+=1,[B,this._bin(16)];case 217:return C=this._view.getUint8(this._offset),this._offset+=1,this._str(C);case 218:return C=this._view.getUint16(this._offset),this._offset+=2,this._str(C);case 219:return C=this._view.getUint32(this._offset),this._offset+=4,this._str(C);case 220:return C=this._view.getUint16(this._offset),this._offset+=2,this._array(C);case 221:return C=this._view.getUint32(this._offset),this._offset+=4,this._array(C);case 222:return C=this._view.getUint16(this._offset),this._offset+=2,this._map(C);case 223:return C=this._view.getUint32(this._offset),this._offset+=4,this._map(C)}throw new Error("Could not parse")},l.decode=function(Z){var l=new C(Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),B=l._parse();if(l._offset!==Z.byteLength)throw new Error(Z.byteLength-l._offset+" trailing bytes");return B};function B(Z,l,C){for(var B=0,x=0,b=C.length;x<b;x++)(B=C.charCodeAt(x))<128?Z.setUint8(l++,B):B<2048?(Z.setUint8(l++,192|B>>6),Z.setUint8(l++,128|63&B)):B<55296||B>=57344?(Z.setUint8(l++,224|B>>12),Z.setUint8(l++,128|B>>6&63),Z.setUint8(l++,128|63&B)):(x++,B=65536+((1023&B)<<10|1023&C.charCodeAt(x)),Z.setUint8(l++,240|B>>18),Z.setUint8(l++,128|B>>12&63),Z.setUint8(l++,128|B>>6&63),Z.setUint8(l++,128|63&B))}function x(Z,l,C){var B=typeof C,b=0,K=0,f=0,W=0,J=0,d=0;if("string"===B){if(J=function(Z){for(var l=0,C=0,B=0,x=Z.length;B<x;B++)(l=Z.charCodeAt(B))<128?C+=1:l<2048?C+=2:l<55296||l>=57344?C+=3:(B++,C+=4);return C}(C),J<32)Z.push(160|J),d=1;else if(J<256)Z.push(217,J),d=2;else if(J<65536)Z.push(218,J>>8,J),d=3;else{if(!(J<4294967296))throw new Error("String too long");Z.push(219,J>>24,J>>16,J>>8,J),d=5}return l.push({_str:C,_length:J,_offset:Z.length}),d+J}if("number"===B)return Math.floor(C)===C&&isFinite(C)?C>=0?C<128?(Z.push(C),1):C<256?(Z.push(204,C),2):C<65536?(Z.push(205,C>>8,C),3):C<4294967296?(Z.push(206,C>>24,C>>16,C>>8,C),5):(f=C/Math.pow(2,32)|0,W=C>>>0,Z.push(207,f>>24,f>>16,f>>8,f,W>>24,W>>16,W>>8,W),9):C>=-32?(Z.push(C),1):C>=-128?(Z.push(208,C),2):C>=-32768?(Z.push(209,C>>8,C),3):C>=-2147483648?(Z.push(210,C>>24,C>>16,C>>8,C),5):(f=Math.floor(C/Math.pow(2,32)),W=C>>>0,Z.push(211,f>>24,f>>16,f>>8,f,W>>24,W>>16,W>>8,W),9):(Z.push(203),l.push({_float:C,_length:8,_offset:Z.length}),9);if("object"===B){if(null===C)return Z.push(192),1;if(Array.isArray(C)){if((J=C.length)<16)Z.push(144|J),d=1;else if(J<65536)Z.push(220,J>>8,J),d=3;else{if(!(J<4294967296))throw new Error("Array too large");Z.push(221,J>>24,J>>16,J>>8,J),d=5}for(b=0;b<J;b++)d+=x(Z,l,C[b]);return d}if(C instanceof Date){var E=C.getTime(),G=Math.floor(E/1e3),a=1e6*(E-1e3*G);return G>=0&&a>=0&&G<=17179869183?0===a&&G<=4294967295?(Z.push(214,255,G>>24,G>>16,G>>8,G),6):(f=G/4294967296,W=4294967295&G,Z.push(215,255,a>>22,a>>14,a>>6,f,W>>24,W>>16,W>>8,W),10):(f=Math.floor(G/4294967296),W=G>>>0,Z.push(199,12,255,a>>24,a>>16,a>>8,a,f>>24,f>>16,f>>8,f,W>>24,W>>16,W>>8,W),15)}if(C instanceof ArrayBuffer){if((J=C.byteLength)<256)Z.push(196,J),d=2;else if(J<65536)Z.push(197,J>>8,J),d=3;else{if(!(J<4294967296))throw new Error("Buffer too large");Z.push(198,J>>24,J>>16,J>>8,J),d=5}return l.push({_bin:C,_length:J,_offset:Z.length}),d+J}if("function"===typeof C.toJSON)return x(Z,l,C.toJSON());var q=[],z="",Y=Object.keys(C);for(b=0,K=Y.length;b<K;b++)void 0!==C[z=Y[b]]&&"function"!==typeof C[z]&&q.push(z);if((J=q.length)<16)Z.push(128|J),d=1;else if(J<65536)Z.push(222,J>>8,J),d=3;else{if(!(J<4294967296))throw new Error("Object too large");Z.push(223,J>>24,J>>16,J>>8,J),d=5}for(b=0;b<J;b++)d+=x(Z,l,z=q[b]),d+=x(Z,l,C[z]);return d}if("boolean"===B)return Z.push(C?195:194),1;if("undefined"===B)return Z.push(192),1;if("function"===typeof C.toJSON)return x(Z,l,C.toJSON());throw new Error("Could not encode")}l.encode=function(Z){var l=[],C=[],b=x(l,C,Z),K=new ArrayBuffer(b),f=new DataView(K),W=0,J=0,d=-1;C.length>0&&(d=C[0]._offset);for(var E,G=0,a=0,q=0,z=l.length;q<z;q++)if(f.setUint8(J+q,l[q]),q+1===d){if(G=(E=C[W])._length,a=J+d,E._bin)for(var Y=new Uint8Array(E._bin),P=0;P<G;P++)f.setUint8(a+P,Y[P]);else E._str?B(f,a,E._str):void 0!==E._float&&f.setFloat64(a,E._float);J+=G,C[++W]&&(d=C[W]._offset)}return K}},13131:(Z,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.NoneSerializer=void 0;l.NoneSerializer=class{setState(Z){}getState(){return null}patch(Z){}teardown(){}handshake(Z){}}},13128:(Z,l,C)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.SchemaSerializer=void 0;const B=C(13092);l.SchemaSerializer=class{setState(Z){return this.state.decode(Z)}getState(){return this.state}patch(Z){return this.state.decode(Z)}teardown(){var Z,l;null===(l=null===(Z=this.state)||void 0===Z?void 0:Z.$changes)||void 0===l||l.root.clearRefs()}handshake(Z,l){if(this.state){(new B.Reflection).decode(Z,l)}else this.state=B.Reflection.decode(Z,l)}}},13073:(Z,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.getSerializer=l.registerSerializer=void 0;const C={};l.registerSerializer=function(Z,l){C[Z]=l},l.getSerializer=function(Z){const l=C[Z];if(!l)throw new Error("missing serializer: "+Z);return l}},13062:function(Z,l,C){"use strict";var B=this&&this.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(l,"__esModule",{value:!0}),l.WebSocketTransport=void 0;const x=B(C(13067)),b=globalThis.WebSocket||x.default;l.WebSocketTransport=class{constructor(Z){this.events=Z}send(Z){Z instanceof ArrayBuffer?this.ws.send(Z):Array.isArray(Z)&&this.ws.send(new Uint8Array(Z).buffer)}connect(Z,l){try{this.ws=new b(Z,{headers:l,protocols:this.protocols})}catch(C){this.ws=new b(Z,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(Z,l){this.ws.close(Z,l)}get isOpen(){return this.ws.readyState===b.OPEN}}},13067:Z=>{"use strict";Z.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14098:Z=>{"use strict";function l(Z,C,B){var x=0|Z[B];if(x<=0)return[];var b,K=new Array(x);if(B===Z.length-1)for(b=0;b<x;++b)K[b]=C;else for(b=0;b<x;++b)K[b]=l(Z,C,B+1);return K}Z.exports=function(Z,C){switch("undefined"===typeof C&&(C=0),typeof Z){case"number":if(Z>0)return function(Z,l){var C,B;for(C=new Array(Z),B=0;B<Z;++B)C[B]=l;return C}(0|Z,C);break;case"object":if("number"===typeof Z.length)return l(Z,C,0)}return[]}},14047:(Z,l,C)=>{Z.exports=function(){var Z=this;this.components={},this.comps=this.components;var l=this.components,C=1,x={},b=[],K=[],f={timeout:!1,removals:[],multiComps:[]};function W(Z,C){var B=l[C],b=x[C],K=b.hash[Z];K&&(b.remove(Z),B.XC&&(B.multi?(K.forEach((l=>{l&&B.XC(Z,l)})),K.length=0):B.XC(Z,K)),f.removals.push(b),J())}function J(){f.timeout||(f.timeout=!0,setTimeout(d,1))}function d(){f.timeout=!1,E()}function E(){f.multiComps.length&&function(Z){for(var l=0;l<Z.length;l++){var{entID:C,data:B}=Z[l],x=B.hash[C];if(x){for(var b=0;b<x.length;b++)x[b]||(x.splice(b,1),b--);0===x.length&&(B.remove(C),f.removals.push(B))}}Z.length=0}(f.multiComps),f.removals.length&&function(Z){for(var l=0;l<Z.length;l++){Z[l].flush()}Z.length=0}(f.removals)}this.FG=x,this._systems=b,this._renderSystems=K,this.dE=function(l){var B=C++;return Array.isArray(l)&&l.forEach((l=>Z.UJ(B,l))),B},this.deleteEntity=function(l){return Object.keys(x).forEach((Z=>{x[Z].hash[l]&&W(l,Z)})),Z},this.tE=function(Z){if(!Z)throw new Error("Missing component definition");var C=Z.name;if(!C)throw new Error("Component definition must have a name property.");if("string"!==typeof C)throw new Error("Component name must be a string.");if(""===C)throw new Error("Component name must be a non-empty string.");if(x[C])throw new Error(`Component ${C} already exists.`);var f={};return f.name=C,f.multi=!!Z.multi,f.order=isNaN(Z.order)?99:Z.order,f.stateConstructor=Z.stateConstructor||null,f.state=Z.state||{},f.nW=Z.nW||null,f.XC=Z.XC||null,f.system=Z.system||null,f.oW=Z.oW||null,l[C]=f,x[C]=new B,x[C]._pendingMultiCleanup=!1,x[C]._multiCleanupIDs=f.multi?[]:null,f.system&&(b.push(C),b.sort(((Z,C)=>l[Z].order-l[C].order))),f.oW&&(K.push(C),K.sort(((Z,C)=>l[Z].order-l[C].order))),C},this.overwriteComponent=function(Z,C){var B=l[Z];if(!B)throw new Error(`Unknown component: ${Z}`);if(!C)throw new Error("Missing component definition");if(B.name!==C.name)throw new Error("Overwriting component must use the same name property.");var f={};f.name=Z,f.multi=!!C.multi,f.order=isNaN(C.order)?99:C.order,f.state=C.state||{},f.nW=C.nW||null,f.XC=C.XC||null,f.system=C.system||null,f.oW=C.oW||null,l[Z]=f,x[Z]._pendingMultiCleanup=!1,x[Z]._multiCleanupIDs=f.multi?[]:null;var W=b.indexOf(Z);f.system&&W<0&&b.push(Z),!f.system&&W>=0&&b.splice(W,1),b.sort(((Z,C)=>l[Z].order-l[C].order));var J=K.indexOf(Z);f.oW&&J<0&&K.push(Z),!f.oW&&J>=0&&K.splice(J,1),K.sort(((Z,C)=>l[Z].order-l[C].order));var d=f.state;return this.Xd(Z).forEach((Z=>{for(var l in d)l in Z||(Z[l]=d[l]);f.nW&&f.nW(Z.rW,Z)})),Z},this.deleteComponent=function(C){var B=x[C];if(!B)throw new Error(`Unknown component: ${C}`);B.flush(),B.list.forEach((Z=>{Z&&W(Z.rW||Z[0].rW,C)}));var f=b.indexOf(C),J=K.indexOf(C);return f>-1&&b.splice(f,1),J>-1&&K.splice(J,1),x[C].dispose(),delete x[C],delete l[C],Z},this.UJ=function(Z,C,B){var b,K=l[C],f=x[C];if(!f)throw new Error(`Unknown component: ${C}.`);if(f.hash[Z]&&!K.multi)throw new Error(`Entity ${Z} already has component: ${C}.`);if(K.stateConstructor){if(!(b=new K.stateConstructor).hasOwnProperty("rW"))throw new Error(`Component ${K.name} stateConstructor type does not have property __id`)}else b=Object.assign({},{rW:Z},K.state,B);if(b.rW=Z,K.multi){var W=f.hash[Z];W||(W=[],f.add(Z,W)),W.push(b)}else f.add(Z,b);return K.nW&&K.nW(Z,b),this},this.jJ=function(Z,l){var C=x[l];if(!C)throw new Error(`Unknown component: ${l}.`);return!!C.hash[Z]},this.oJ=function(l,C){if(!x[C])throw new Error(`Unknown component: ${C}.`);return W(l,C),Z},this.getState=function(Z,l){var C=x[l];if(!C)throw new Error(`Unknown component: ${l}.`);return C.hash[Z]},this.Xd=function(Z){var l=x[Z];if(!l)throw new Error(`Unknown component: ${Z}.`);return E(),l.list},this.Eq=function(Z){if(!x[Z])throw new Error(`Unknown component: ${Z}.`);var l=x[Z].hash;return Z=>l[Z]},this.qq=function(Z){if(!x[Z])throw new Error(`Unknown component: ${Z}.`);var l=x[Z].hash;return Z=>!!l[Z]},this.sW=function(C){E();for(var B=0;B<b.length;B++){var K=b[B],f=l[K],W=x[K];f.system(C,W.list),E()}return Z},this.render=function(C){E();for(var B=0;B<K.length;B++){var b=K[B],f=l[b],W=x[b];f.oW(C,W.list),E()}return Z},this.removeMultiComponent=function(C,B,b){var K=l[B],W=x[B];if(!W)throw new Error(`Unknown component: ${B}.`);if(!K.multi)throw new Error("removeMultiComponent called on non-multi component");return function(Z,l,C,B){var x=C.hash[Z];if(x){var b=x[B];b&&(x[B]=null,l.XC&&l.XC(Z,b),f.multiComps.push({entID:Z,data:C}),J())}}(C,K,W,b),Z}};var B=C(14052)},14052:Z=>{function l(Z,l){var C=Z._map[l];if(delete Z.hash[l],delete Z._map[l],C===Z.list.length-1)Z.list.pop();else{var B=Z.list.pop();if(Z.list[C]=B,null===B||null===B[0]){var x=Z.list.length;for(var b in Z._map)if(Z._map[b]===x)return void(Z._map[b]=C)}else{var K=B.rW||B[0].rW;Z._map[K]=C}}}Z.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(Z,l){if("number"===typeof this._map[Z]){var C=this._map[Z];this.hash[Z]=l,this.list[C]=l}else this._map[Z]=this.list.length,this.hash[Z]=l,this.list.push(l)}remove(Z){var l=this._map[Z];this.hash[Z]=null,this.list[l]=null,this._pendingRemovals.push(Z)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var Z=0;Z<this._pendingRemovals.length;Z++){var C=this._pendingRemovals[Z];null===this.hash[C]&&l(this,C)}this._pendingRemovals.length=0}}},14312:Z=>{"use strict";Z.exports=function(Z,l,C,B,x,b){var K=+l[0],f=+l[1],W=+l[2],J=+C[0],d=+C[1],E=+C[2],G=Math.sqrt(J*J+d*d+E*E);if(0===G)throw new Error("Can't raycast along a zero vector");return function(Z,l,C,B,x,b,K,f,W,J){for(var d=0,E=Math.floor,G=0|E(l),a=0|E(C),q=0|E(B),z=x>0?1:-1,Y=b>0?1:-1,P=K>0?1:-1,S=Math.abs(1/x),i=Math.abs(1/b),s=Math.abs(1/K),F=S<1/0?S*(z>0?G+1-l:l-G):1/0,n=i<1/0?i*(Y>0?a+1-C:C-a):1/0,c=s<1/0?s*(P>0?q+1-B:B-q):1/0,U=-1;d<=f;){var t=Z(G,a,q);if(t)return W&&(W[0]=l+d*x,W[1]=C+d*b,W[2]=B+d*K),J&&(J[0]=J[1]=J[2]=0,0===U&&(J[0]=-z),1===U&&(J[1]=-Y),2===U&&(J[2]=-P)),t;F<n?F<c?(G+=z,d=F,F+=S,U=0):(q+=P,d=c,c+=s,U=2):n<c?(a+=Y,d=n,n+=i,U=1):(q+=P,d=c,c+=s,U=2)}return W&&(W[0]=l+d*x,W[1]=C+d*b,W[2]=B+d*K),J&&(J[0]=J[1]=J[2]=0),0}(Z,K,f,W,J/=G,d/=G,E/=G,B="undefined"===typeof B?64:+B,x,b)}},14346:(Z,l,C)=>{"use strict";C.d(l,{b:()=>b});var B=C(813);function x(){this.Ea=!1,this.stopPropagation=!1,this.Ga=!1,this.disabled=!1}class b{constructor(Z,l){this.version="0.7.0";var C=Object.assign({},new x,l||{});this.element=Z||document,this.Ea=!!C.Ea,this.stopPropagation=!!C.stopPropagation,this.Ga=!!C.Ga,this.disabled=!!C.disabled,this.filterEvents=(Z,l)=>!0,this.down=new B.EventEmitter,this.up=new B.EventEmitter,this.state={},this.gd={dx:0,dy:0,Cq:0,Vd:0,Bq:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?f(this):document.addEventListener("DOMContentLoaded",(Z=>{f(this)}),{once:!0})}bind(Z){for(var l=arguments.length,C=new Array(l>1?l-1:0),B=1;B<l;B++)C[B-1]=arguments[B];C.forEach((l=>{var C=this._keyBindmap[l]||[];C.includes(Z)||(C.push(Z),this._keyBindmap[l]=C)})),this.state[Z]=!!this.state[Z],this.pressCount[Z]=this.pressCount[Z]||0,this.releaseCount[Z]=this.releaseCount[Z]||0}unbind(Z){for(var l in this._keyBindmap){var C=this._keyBindmap[l],B=C.indexOf(Z);B>-1&&C.splice(B,1)}}getBindings(){var Z={};for(var l in this._keyBindmap){this._keyBindmap[l].forEach((C=>{Z[C]=Z[C]||[],Z[C].push(l)}))}return Z}sW(){K(this.gd),K(this.pressCount),K(this.releaseCount)}}function K(Z){for(var l in Z)Z[l]=0}function f(Z){window.addEventListener("keydown",q.bind(null,Z,!0),!1),window.addEventListener("keyup",q.bind(null,Z,!1),!1);var l={passive:!0};Z.element.addEventListener("touchstart",E.bind(void 0,Z),{passive:!1}),Z.element.addEventListener("touchend",a.bind(void 0,Z),l),Z.element.addEventListener("mousedown",z.bind(null,Z,!0),l),window.document.addEventListener("mouseup",z.bind(null,Z,!1),l),Z.element.addEventListener("touchmove",Y.bind(null,Z),l),Z.element.addEventListener("mousemove",Y.bind(null,Z),l),window.PointerEvent,Z.element.addEventListener("wheel",P.bind(null,Z),l),Z.element.addEventListener("contextmenu",S.bind(null,Z),!1),window.addEventListener("blur",i.bind(null,Z),!1)}var W=0,J=0,d=null;function E(Z,l){l.preventDefault(),G(l)}function G(Z){let l=!1;for(let C=0;C<Z.touches.length;++C)if(Z.touches[C].identifier===d){l=!0;break}if(!l){const l=Z.changedTouches[0];W=l.clientX,J=l.clientY,d=l.identifier}}function a(Z,l){for(var C=l.changedTouches,B=0;B<C.length;++B)C[B].identifier===d&&(d=null)}function q(Z,l,C){s(C.code,l,Z,C)}function z(Z,l,C){if("pointerId"in C)if(l){if(null!==Z._touches.currID)return;Z._touches.currID=C.pointerId}else{if(Z._touches.currID!==C.pointerId)return;Z._touches.currID=null}return s("Mouse"+("button"in C?C.button+1:1),l,Z,C),!1}function Y(Z,l){var C=l.movementX||l.mozMovementX||0,B=l.movementY||l.mozMovementY||0;if(l.touches&&0===(C|B)){var x=function(Z){G(Z);for(let l=0;l<Z.changedTouches.length;++l)if(Z.changedTouches[l].identifier==d){const C=Z.changedTouches[l],B=[C.clientX-W,C.clientY-J];return W=C.clientX,J=C.clientY,B}return console.error(`Did not find touch id ${d}`),[0,0]}(l);C=x[0],B=x[1]}Z.gd.dx+=C,Z.gd.dy+=B}function P(Z,l){var C=1;switch(l.deltaMode){case 0:C=1;break;case 1:C=12;break;case 2:C=Z.element.clientHeight||window.innerHeight}Z.gd.Cq+=(l.deltaX||0)*C,Z.gd.Vd+=(l.deltaY||0)*C,Z.gd.Bq+=(l.deltaZ||0)*C}function S(Z,l){if(!Z.Ga)return l.preventDefault(),!1}function i(Z){for(var l in Z._keyStates)Z._keyStates[l]&&(/^Mouse\d/.test(l)||s(l,!1,Z,{code:l,note:"yuuf9y9au9",preventDefault:()=>{},stopPropagation:()=>{}}))}function s(Z,l,C,B){var x=C._keyBindmap[Z];x&&(F(C._keyStates[Z],l)&&(C._keyStates[Z]=l,x.forEach((Z=>{(!C.filterEvents||C.filterEvents(B,Z))&&function(Z,l,C,B){var x=l?C.pressCount:C.releaseCount;x[Z]=(x[Z]||0)+1;var b=C._bindPressCount[Z]||0;(b+=l?1:-1)<0&&(b=0);C._bindPressCount[Z]=b;var K=C.state[Z];if(F(K,b)){C.state[Z]=b>0;var f=l?C.down:C.up;C.disabled||f.emit(Z,B)}}(Z,l,C,B)}))),"button"in B||(C.Ea&&!B.defaultPrevented&&B.preventDefault(),C.stopPropagation&&B.stopPropagation()))}function F(Z,l){return Z?!l:l}},13233:Z=>{"use strict";Z.exports=function(Z){for(var l=new Array(Z),C=0;C<Z;++C)l[C]=C;return l}},13239:Z=>{function l(Z){return!!Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}Z.exports=function(Z){return null!=Z&&(l(Z)||function(Z){return"function"===typeof Z.readFloatLE&&"function"===typeof Z.slice&&l(Z.slice(0,0))}(Z)||!!Z._isBuffer)}},14317:(Z,l,C)=>{"use strict";C.d(l,{b:()=>B});class B{constructor(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.QE=!1,this.hE=!1,this.uE=30,this.HE=0,this.CG=!1,this.fullscreen=!1,this.LE=function(Z){},this.pE=function(){},this.ZG=function(){},this.nx=function(){},this.NE=function(Z){},this.onFullscreenChanged=function(Z){},J((()=>{!function(Z,l){Z._nowObject=performance||Date,Z._lastTick=0,Z._renderAccum=0,Z._rt=0,Z._frameCB=f.bind(null,Z),requestAnimationFrame(Z._frameCB),l>0&&(Z._intervalCB=K.bind(null,Z),Z._interval=setInterval(Z._intervalCB,Math.max(l,1e3/Z.uE/2)))}(this,l),function(Z,l){if(!l)return;var C=!1,B=!1;document.addEventListener("pointerlockchange",(B=>{C=document.pointerLockElement===l,Z.NE(C)})),document.addEventListener("fullscreenchange",(C=>{B=document.fullscreenElement===l,Z.onFullscreenChanged(B)})),Object.defineProperty(Z,"CG",{get:()=>C,set:Z=>{Z&&!C?W(l):C&&!Z&&function(Z){Z.exitPointerLock&&Z.exitPointerLock()}(document)}}),Object.defineProperty(Z,"fullscreen",{get:()=>B,set:Z=>{Z&&!B?l.requestFullscreen():B&&!Z&&document.exitFullscreen()}}),l.addEventListener("click",(x=>{Z.QE&&!C&&W(l),Z.hE&&!B&&l.requestFullscreen()}));var x=()=>Z.nx();if(window.ResizeObserver){new ResizeObserver(x).observe(l)}else window.addEventListener("resize",x)}(this,Z),this.ZG()}))}}var x=3,b=20;function K(Z){for(var l=1e3/Z.uE,C=Z._nowObject.now()+b,B=0;Z._nowObject.now()>=Z._lastTick+l&&Z._nowObject.now()<C&&++B<=x;)Z.LE(l),Z._lastTick+=l;var K=5*(l+5),f=Z._nowObject.now();if(f-Z._lastTick>K)for(;f>=Z._lastTick+l;)Z._lastTick+=l}function f(Z){requestAnimationFrame(Z._frameCB),K(Z);var l=Z._nowObject.now(),C=l-Z._rt;if(Z._rt=l,Z.HE>0){Z._renderAccum+=C;var B=1e3/Z.HE;if(Z._renderAccum<B)return;Z._renderAccum=Math.min(Z._renderAccum-B,B)}var x=1e3/Z.uE,b=(l-Z._lastTick)/x;Z.pE(C,b,x)}function W(Z){Z.requestPointerLock&&Z.requestPointerLock()}var J=Z=>{if("loading"===document.readyState){var l=()=>{document.removeEventListener("readystatechange",l),Z()};document.addEventListener("readystatechange",l)}else setTimeout(Z,1)}},13229:(Z,l,C)=>{var B=C(13233),x=C(13239),b="undefined"!==typeof Float64Array;function K(Z,l){return Z[0]-l[0]}function f(){var Z,l=this.stride,C=new Array(l.length);for(Z=0;Z<C.length;++Z)C[Z]=[Math.abs(l[Z]),Z];C.sort(K);var B=new Array(C.length);for(Z=0;Z<B.length;++Z)B[Z]=C[Z][1];return B}function W(Z,l){var C=["View",l,"d",Z].join("");l<0&&(C="View_Nil"+Z);var x="generic"===Z;if(-1===l){var b="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+Z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(b)()}if(0===l){b="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+Z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(x?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(x?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",b)(J[Z][0])}b=["'use strict'"];var K=B(l),W=K.map((function(Z){return"i"+Z})),d="this.offset+"+K.map((function(Z){return"this.stride["+Z+"]*i"+Z})).join("+"),E=K.map((function(Z){return"b"+Z})).join(","),G=K.map((function(Z){return"c"+Z})).join(",");b.push("function "+C+"(a,"+E+","+G+",d){this.data=a","this.shape=["+E+"]","this.stride=["+G+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+Z+"'","proto.dimension="+l),b.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+K.map((function(Z){return"this.shape["+Z+"]"})).join("*"),"}})"),1===l?b.push("proto.order=[0]"):(b.push("Object.defineProperty(proto,'order',{get:"),l<4?(b.push("function "+C+"_order(){"),2===l?b.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===l&&b.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):b.push("ORDER})")),b.push("proto.set=function "+C+"_set("+W.join(",")+",v){"),x?b.push("return this.data.set("+d+",v)}"):b.push("return this.data["+d+"]=v}"),b.push("proto.get=function "+C+"_get("+W.join(",")+"){"),x?b.push("return this.data.get("+d+")}"):b.push("return this.data["+d+"]}"),b.push("proto.index=function "+C+"_index(",W.join(),"){return "+d+"}"),b.push("proto.hi=function "+C+"_hi("+W.join(",")+"){return new "+C+"(this.data,"+K.map((function(Z){return["(typeof i",Z,"!=='number'||i",Z,"<0)?this.shape[",Z,"]:i",Z,"|0"].join("")})).join(",")+","+K.map((function(Z){return"this.stride["+Z+"]"})).join(",")+",this.offset)}");var a=K.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})),q=K.map((function(Z){return"c"+Z+"=this.stride["+Z+"]"}));b.push("proto.lo=function "+C+"_lo("+W.join(",")+"){var b=this.offset,d=0,"+a.join(",")+","+q.join(","));for(var z=0;z<l;++z)b.push("if(typeof i"+z+"==='number'&&i"+z+">=0){d=i"+z+"|0;b+=c"+z+"*d;a"+z+"-=d}");b.push("return new "+C+"(this.data,"+K.map((function(Z){return"a"+Z})).join(",")+","+K.map((function(Z){return"c"+Z})).join(",")+",b)}"),b.push("proto.step=function "+C+"_step("+W.join(",")+"){var "+K.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})).join(",")+","+K.map((function(Z){return"b"+Z+"=this.stride["+Z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(z=0;z<l;++z)b.push("if(typeof i"+z+"==='number'){d=i"+z+"|0;if(d<0){c+=b"+z+"*(a"+z+"-1);a"+z+"=ceil(-a"+z+"/d)}else{a"+z+"=ceil(a"+z+"/d)}b"+z+"*=d}");b.push("return new "+C+"(this.data,"+K.map((function(Z){return"a"+Z})).join(",")+","+K.map((function(Z){return"b"+Z})).join(",")+",c)}");var Y=new Array(l),P=new Array(l);for(z=0;z<l;++z)Y[z]="a[i"+z+"]",P[z]="b[i"+z+"]";b.push("proto.transpose=function "+C+"_transpose("+W+"){"+W.map((function(Z,l){return Z+"=("+Z+"===undefined?"+l+":"+Z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+Y.join(",")+","+P.join(",")+",this.offset)}"),b.push("proto.pick=function "+C+"_pick("+W+"){var a=[],b=[],c=this.offset");for(z=0;z<l;++z)b.push("if(typeof i"+z+"==='number'&&i"+z+">=0){c=(c+this.stride["+z+"]*i"+z+")|0}else{a.push(this.shape["+z+"]);b.push(this.stride["+z+"])}");return b.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),b.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+K.map((function(Z){return"shape["+Z+"]"})).join(",")+","+K.map((function(Z){return"stride["+Z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",b.join("\n"))(J[Z],f)}var J={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Z.exports=function(Z,l,C,B){if(void 0===Z)return(0,J.array[0])([]);"number"===typeof Z&&(Z=[Z]),void 0===l&&(l=[Z.length]);var K=l.length;if(void 0===C){C=new Array(K);for(var f=K-1,d=1;f>=0;--f)C[f]=d,d*=l[f]}if(void 0===B){B=0;for(f=0;f<K;++f)C[f]<0&&(B-=(l[f]-1)*C[f])}for(var E=function(Z){if(x(Z))return"buffer";if(b)switch(Object.prototype.toString.call(Z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Z)?"array":"generic"}(Z),G=J[E];G.length<=K+1;)G.push(W(E,G.length-1));return(0,G[K+1])(Z,l,C,B)}},14194:Z=>{var l;self,l=()=>(()=>{"use strict";var Z={d:(l,C)=>{for(var B in C)Z.o(C,B)&&!Z.o(l,B)&&Object.defineProperty(l,B,{enumerable:!0,get:C[B]})},o:(Z,l)=>Object.prototype.hasOwnProperty.call(Z,l)},l={};Z.d(l,{default:()=>V});var C,B=function(Z,l){var C=l.x-Z.x,B=l.y-Z.y;return Math.sqrt(C*C+B*B)},x=function(Z){return Z*(Math.PI/180)},b=new Map,K=function(Z){b.has(Z)&&clearTimeout(b.get(Z)),b.set(Z,setTimeout(Z,100))},f=function(Z,l,C){for(var B,x=l.split(/[ ,]+/g),b=0;b<x.length;b+=1)B=x[b],Z.addEventListener?Z.addEventListener(B,C,!1):Z.attachEvent&&Z.attachEvent(B,C)},W=function(Z,l,C){for(var B,x=l.split(/[ ,]+/g),b=0;b<x.length;b+=1)B=x[b],Z.removeEventListener?Z.removeEventListener(B,C):Z.detachEvent&&Z.detachEvent(B,C)},J=function(Z){return Z.preventDefault(),Z.type.match(/^touch/)?Z.changedTouches:Z},d=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},E=function(Z,l){l.top||l.right||l.bottom||l.left?(Z.style.top=l.top,Z.style.right=l.right,Z.style.bottom=l.bottom,Z.style.left=l.left):(Z.style.left=l.x+"px",Z.style.top=l.y+"px")},G=function(Z,l,C){var B=a(Z);for(var x in B)if(B.hasOwnProperty(x))if("string"==typeof l)B[x]=l+" "+C;else{for(var b="",K=0,f=l.length;K<f;K+=1)b+=l[K]+" "+C+", ";B[x]=b.slice(0,-2)}return B},a=function(Z){var l={};return l[Z]="",["webkit","Moz","o"].forEach((function(C){l[C+Z.charAt(0).toUpperCase()+Z.slice(1)]=""})),l},q=function(Z,l){for(var C in l)l.hasOwnProperty(C)&&(Z[C]=l[C]);return Z},z=function(Z,l){if(Z.length)for(var C=0,B=Z.length;C<B;C+=1)l(Z[C]);else l(Z)},Y="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,P=window.matchMedia("(any-hover: none)").matches,S=!!("ontouchstart"in window),i=!!window.PointerEvent,s=!!window.MSPointerEvent,F={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},n={start:"mousedown",move:"mousemove",end:"mouseup"},c={};function U(){}Y&&!P?C=F:i?C={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:s?C={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:S?(C=F,c=n):C=n,U.prototype.on=function(Z,l){var C,B=this,x=Z.split(/[ ,]+/g);B._handlers_=B._handlers_||{};for(var b=0;b<x.length;b+=1)C=x[b],B._handlers_[C]=B._handlers_[C]||[],B._handlers_[C].push(l);return B},U.prototype.off=function(Z,l){var C=this;return C._handlers_=C._handlers_||{},void 0===Z?C._handlers_={}:void 0===l?C._handlers_[Z]=null:C._handlers_[Z]&&C._handlers_[Z].indexOf(l)>=0&&C._handlers_[Z].splice(C._handlers_[Z].indexOf(l),1),C},U.prototype.trigger=function(Z,l){var C,B=this,x=Z.split(/[ ,]+/g);B._handlers_=B._handlers_||{};for(var b=0;b<x.length;b+=1)C=x[b],B._handlers_[C]&&B._handlers_[C].length&&B._handlers_[C].forEach((function(Z){Z.call(B,{type:C,target:B},l)}))},U.prototype.config=function(Z){var l=this;l.options=l.defaults||{},Z&&(l.options=function(Z,l){var C={};for(var B in Z)Z.hasOwnProperty(B)&&l.hasOwnProperty(B)?C[B]=l[B]:Z.hasOwnProperty(B)&&(C[B]=Z[B]);return C}(l.options,Z))},U.prototype.bindEvt=function(Z,l){var B=this;return B._domHandlers_=B._domHandlers_||{},B._domHandlers_[l]=function(){"function"==typeof B["on"+l]?B["on"+l].apply(B,arguments):console.warn('[WARNING] : Missing "on'+l+'" handler.')},f(Z,C[l],B._domHandlers_[l]),c[l]&&f(Z,c[l],B._domHandlers_[l]),B},U.prototype.unbindEvt=function(Z,l){var B=this;return B._domHandlers_=B._domHandlers_||{},W(Z,C[l],B._domHandlers_[l]),c[l]&&W(Z,c[l],B._domHandlers_[l]),delete B._domHandlers_[l],this};const t=U;function r(Z,l){return this.identifier=l.identifier,this.position=l.position,this.frontPosition=l.frontPosition,this.collection=Z,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(l),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=r.id,r.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}r.prototype=new t,r.constructor=r,r.id=0,r.prototype.buildEl=function(Z){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},r.prototype.stylize=function(){if(this.options.dataOnly)return this;var Z=this.options.fadeTime+"ms",l=function(){var Z=a("borderRadius");for(var l in Z)Z.hasOwnProperty(l)&&(Z[l]="50%");return Z}(),C=G("transition","opacity",Z),B={};return B.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},B.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},B.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},q(B.el,C),"circle"===this.options.shape&&q(B.back,l),q(B.front,l),this.applyStyles(B),this},r.prototype.applyStyles=function(Z){for(var l in this.ui)if(this.ui.hasOwnProperty(l))for(var C in Z[l])this.ui[l].style[C]=Z[l][C];return this},r.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},r.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},r.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},r.prototype.show=function(Z){var l=this;return l.options.dataOnly||(clearTimeout(l.removeTimeout),clearTimeout(l.showTimeout),clearTimeout(l.restTimeout),l.addToDom(),l.restCallback(),setTimeout((function(){l.ui.el.style.opacity=1}),0),l.showTimeout=setTimeout((function(){l.trigger("shown",l.instance),"function"==typeof Z&&Z.call(this)}),l.options.fadeTime)),l},r.prototype.hide=function(Z){var l=this;if(l.options.dataOnly)return l;if(l.ui.el.style.opacity=l.options.restOpacity,clearTimeout(l.removeTimeout),clearTimeout(l.showTimeout),clearTimeout(l.restTimeout),l.removeTimeout=setTimeout((function(){var C="dynamic"===l.options.mode?"none":"block";l.ui.el.style.display=C,"function"==typeof Z&&Z.call(l),l.trigger("hidden",l.instance)}),l.options.fadeTime),l.options.restJoystick){var C=l.options.restJoystick,B={};B.x=!0===C||!1!==C.x?0:l.instance.frontPosition.x,B.y=!0===C||!1!==C.y?0:l.instance.frontPosition.y,l.setPosition(Z,B)}return l},r.prototype.setPosition=function(Z,l){var C=this;C.frontPosition={x:l.x,y:l.y};var B=C.options.fadeTime+"ms",x={};x.front=G("transition",["transform"],B);var b={front:{}};b.front={transform:"translate("+C.frontPosition.x+"px,"+C.frontPosition.y+"px)"},C.applyStyles(x),C.applyStyles(b),C.restTimeout=setTimeout((function(){"function"==typeof Z&&Z.call(C),C.restCallback()}),C.options.fadeTime)},r.prototype.restCallback=function(){var Z=this,l={};l.front=G("transition","none",""),Z.applyStyles(l),Z.trigger("rested",Z.instance)},r.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},r.prototype.computeDirection=function(Z){var l,C,B,x=Z.angle.radian,b=Math.PI/4,K=Math.PI/2;if(x>b&&x<3*b&&!Z.lockX?l="up":x>-b&&x<=b&&!Z.lockY?l="left":x>3*-b&&x<=-b&&!Z.lockX?l="down":Z.lockY||(l="right"),Z.lockY||(C=x>-K&&x<K?"left":"right"),Z.lockX||(B=x>0?"up":"down"),Z.force>this.options.threshold){var f,W={};for(f in this.direction)this.direction.hasOwnProperty(f)&&(W[f]=this.direction[f]);var J={};for(f in this.direction={x:C,y:B,angle:l},Z.direction=this.direction,W)W[f]===this.direction[f]&&(J[f]=!0);if(J.x&&J.y&&J.angle)return Z;J.x&&J.y||this.trigger("plain",Z),J.x||this.trigger("plain:"+C,Z),J.y||this.trigger("plain:"+B,Z),J.angle||this.trigger("dir dir:"+l,Z)}else this.resetDirection();return Z};const e=r;function o(Z,l){var C=this;C.nipples=[],C.idles=[],C.actives=[],C.ids=[],C.pressureIntervals={},C.manager=Z,C.id=o.id,o.id+=1,C.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},C.config(l),"static"!==C.options.mode&&"semi"!==C.options.mode||(C.options.multitouch=!1),C.options.multitouch||(C.options.maxNumberOfNipples=1);var B=getComputedStyle(C.options.zone.parentElement);return B&&"flex"===B.display&&(C.parentIsFlex=!0),C.updateBox(),C.prepareNipples(),C.aa(),C.begin(),C.nipples}o.prototype=new t,o.constructor=o,o.id=0,o.prototype.prepareNipples=function(){var Z=this,l=Z.nipples;l.on=Z.on.bind(Z),l.off=Z.off.bind(Z),l.options=Z.options,l.destroy=Z.destroy.bind(Z),l.ids=Z.ids,l.id=Z.id,l.processOnMove=Z.processOnMove.bind(Z),l.processOnEnd=Z.processOnEnd.bind(Z),l.get=function(Z){if(void 0===Z)return l[0];for(var C=0,B=l.length;C<B;C+=1)if(l[C].identifier===Z)return l[C];return!1}},o.prototype.aa=function(){var Z=this;Z.bindEvt(Z.options.zone,"start"),Z.options.zone.style.touchAction="none",Z.options.zone.style.msTouchAction="none"},o.prototype.begin=function(){var Z=this,l=Z.options;if("static"===l.mode){var C=Z.createNipple(l.position,Z.manager.getIdentifier());C.add(),Z.idles.push(C)}},o.prototype.createNipple=function(Z,l){var C=this,B=C.manager.scroll,x={},b=C.options,K=C.parentIsFlex?B.x:B.x+C.box.left,f=C.parentIsFlex?B.y:B.y+C.box.top;if(Z.x&&Z.y)x={x:Z.x-K,y:Z.y-f};else if(Z.top||Z.right||Z.bottom||Z.left){var W=document.createElement("DIV");W.style.display="hidden",W.style.top=Z.top,W.style.right=Z.right,W.style.bottom=Z.bottom,W.style.left=Z.left,W.style.position="absolute",b.zone.appendChild(W);var J=W.getBoundingClientRect();b.zone.removeChild(W),x=Z,Z={x:J.left+B.x,y:J.top+B.y}}var d=new e(C,{color:b.color,size:b.size,threshold:b.threshold,fadeTime:b.fadeTime,dataOnly:b.dataOnly,restJoystick:b.restJoystick,restOpacity:b.restOpacity,mode:b.mode,identifier:l,position:Z,zone:b.zone,frontPosition:{x:0,y:0},shape:b.shape});return b.dataOnly||(E(d.ui.el,x),E(d.ui.front,d.frontPosition)),C.nipples.push(d),C.trigger("added "+d.identifier+":added",d),C.manager.trigger("added "+d.identifier+":added",d),C.bindNipple(d),d},o.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},o.prototype.bindNipple=function(Z){var l,C=this,B=function(Z,B){l=Z.type+" "+B.id+":"+Z.type,C.trigger(l,B)};Z.on("destroyed",C.onDestroyed.bind(C)),Z.on("shown hidden rested dir plain",B),Z.on("dir:up dir:right dir:down dir:left",B),Z.on("plain:up plain:right plain:down plain:left",B)},o.prototype.pressureFn=function(Z,l,C){var B=this,x=0;clearInterval(B.pressureIntervals[C]),B.pressureIntervals[C]=setInterval(function(){var C=Z.force||Z.pressure||Z.webkitForce||0;C!==x&&(l.trigger("pressure",C),B.trigger("pressure "+l.identifier+":pressure",C),x=C)}.bind(B),100)},o.prototype.onstart=function(Z){var l=this,C=l.options,B=Z;return Z=J(Z),l.updateBox(),z(Z,(function(x){l.actives.length<C.maxNumberOfNipples?l.processOnStart(x):B.type.match(/^touch/)&&(Object.keys(l.manager.ids).forEach((function(C){if(Object.values(B.touches).findIndex((function(Z){return Z.identifier===C}))<0){var x=[Z[0]];x.identifier=C,l.processOnEnd(x)}})),l.actives.length<C.maxNumberOfNipples&&l.processOnStart(x))})),l.manager.bindDocument(),!1},o.prototype.processOnStart=function(Z){var l,C=this,x=C.options,b=C.manager.getIdentifier(Z),K=Z.force||Z.pressure||Z.webkitForce||0,f={x:Z.pageX,y:Z.pageY},W=C.getOrCreate(b,f);W.identifier!==b&&C.manager.removeIdentifier(W.identifier),W.identifier=b;var J=function(l){l.trigger("start",l),C.trigger("start "+l.id+":start",l),l.show(),K>0&&C.pressureFn(Z,l,l.identifier),C.processOnMove(Z)};if((l=C.idles.indexOf(W))>=0&&C.idles.splice(l,1),C.actives.push(W),C.ids.push(W.identifier),"semi"!==x.mode)J(W);else{if(!(B(f,W.position)<=x.catchDistance))return W.destroy(),void C.processOnStart(Z);J(W)}return W},o.prototype.getOrCreate=function(Z,l){var C,B=this,x=B.options;return/(semi|static)/.test(x.mode)?(C=B.idles[0])?(B.idles.splice(0,1),C):"semi"===x.mode?B.createNipple(l,Z):(console.warn("Coudln't find the needed nipple."),!1):C=B.createNipple(l,Z)},o.prototype.processOnMove=function(Z){var l=this,C=l.options,b=l.manager.getIdentifier(Z),K=l.nipples.get(b),f=l.manager.scroll;if(function(Z){return isNaN(Z.buttons)?0!==Z.pressure:0!==Z.buttons}(Z)){if(!K)return console.error("Found zombie joystick with ID "+b),void l.manager.removeIdentifier(b);if(C.dynamicPage){var W=K.el.getBoundingClientRect();K.position={x:f.x+W.left,y:f.y+W.top}}K.identifier=b;var J=K.options.size/2,d={x:Z.pageX,y:Z.pageY};C.lockX&&(d.y=K.position.y),C.lockY&&(d.x=K.position.x);var E,G,a,q,z,Y,P,S,i,s,F=B(d,K.position),n=(E=d,a=(G=K.position).x-E.x,q=G.y-E.y,function(Z){return Z*(180/Math.PI)}(Math.atan2(q,a))),c=x(n),U=F/J,t={distance:F,position:d};if("circle"===K.options.shape?(z=Math.min(F,J),P=K.position,S=z,s={x:0,y:0},i=x(i=n),s.x=P.x-S*Math.cos(i),s.y=P.y-S*Math.sin(i),Y=s):(Y=function(Z,l,C){return{x:Math.min(Math.max(Z.x,l.x-C),l.x+C),y:Math.min(Math.max(Z.y,l.y-C),l.y+C)}}(d,K.position,J),z=B(Y,K.position)),C.follow){if(F>J){var r=d.x-Y.x,e=d.y-Y.y;K.position.x+=r,K.position.y+=e,K.el.style.top=K.position.y-(l.box.top+f.y)+"px",K.el.style.left=K.position.x-(l.box.left+f.x)+"px",F=B(d,K.position)}}else d=Y,F=z;var o=d.x-K.position.x,v=d.y-K.position.y;K.frontPosition={x:o,y:v},C.dataOnly||(K.ui.front.style.transform="translate("+o+"px,"+v+"px)");var R={identifier:K.identifier,position:d,force:U,pressure:Z.force||Z.pressure||Z.webkitForce||0,distance:F,angle:{radian:c,degree:n},vector:{x:o/J,y:-v/J},raw:t,instance:K,lockX:C.lockX,lockY:C.lockY};(R=K.computeDirection(R)).angle={radian:x(180-n),degree:180-n},K.trigger("move",R),l.trigger("move "+K.id+":move",R)}else this.processOnEnd(Z)},o.prototype.processOnEnd=function(Z){var l=this,C=l.options,B=l.manager.getIdentifier(Z),x=l.nipples.get(B),b=l.manager.removeIdentifier(x.identifier);x&&(C.dataOnly||x.hide((function(){"dynamic"===C.mode&&(x.trigger("removed",x),l.trigger("removed "+x.id+":removed",x),l.manager.trigger("removed "+x.id+":removed",x),x.destroy())})),clearInterval(l.pressureIntervals[x.identifier]),x.resetDirection(),x.trigger("end",x),l.trigger("end "+x.id+":end",x),l.ids.indexOf(x.identifier)>=0&&l.ids.splice(l.ids.indexOf(x.identifier),1),l.actives.indexOf(x)>=0&&l.actives.splice(l.actives.indexOf(x),1),/(semi|static)/.test(C.mode)?l.idles.push(x):l.nipples.indexOf(x)>=0&&l.nipples.splice(l.nipples.indexOf(x),1),l.manager.unbindDocument(),/(semi|static)/.test(C.mode)&&(l.manager.ids[b.id]=b.identifier))},o.prototype.onDestroyed=function(Z,l){var C=this;C.nipples.indexOf(l)>=0&&C.nipples.splice(C.nipples.indexOf(l),1),C.actives.indexOf(l)>=0&&C.actives.splice(C.actives.indexOf(l),1),C.idles.indexOf(l)>=0&&C.idles.splice(C.idles.indexOf(l),1),C.ids.indexOf(l.identifier)>=0&&C.ids.splice(C.ids.indexOf(l.identifier),1),C.manager.removeIdentifier(l.identifier),C.manager.unbindDocument()},o.prototype.destroy=function(){var Z=this;for(var l in Z.unbindEvt(Z.options.zone,"start"),Z.nipples.forEach((function(Z){Z.destroy()})),Z.pressureIntervals)Z.pressureIntervals.hasOwnProperty(l)&&clearInterval(Z.pressureIntervals[l]);Z.trigger("destroyed",Z.nipples),Z.manager.unbindDocument(),Z.off()};const v=o;function R(Z){var l=this;l.ids={},l.index=0,l.collections=[],l.scroll=d(),l.config(Z),l.prepareCollections();var C=function(){var Z;l.collections.forEach((function(C){C.forEach((function(C){Z=C.el.getBoundingClientRect(),C.position={x:l.scroll.x+Z.left,y:l.scroll.y+Z.top}}))}))};f(window,"resize",(function(){K(C)}));var B=function(){l.scroll=d()};return f(window,"scroll",(function(){K(B)})),l.collections}R.prototype=new t,R.constructor=R,R.prototype.prepareCollections=function(){var Z=this;Z.collections.create=Z.create.bind(Z),Z.collections.on=Z.on.bind(Z),Z.collections.off=Z.off.bind(Z),Z.collections.destroy=Z.destroy.bind(Z),Z.collections.get=function(l){var C;return Z.collections.every((function(Z){return!(C=Z.get(l))})),C}},R.prototype.create=function(Z){return this.createCollection(Z)},R.prototype.createCollection=function(Z){var l=this,C=new v(l,Z);return l.bindCollection(C),l.collections.push(C),C},R.prototype.bindCollection=function(Z){var l,C=this,B=function(Z,B){l=Z.type+" "+B.id+":"+Z.type,C.trigger(l,B)};Z.on("destroyed",C.onDestroyed.bind(C)),Z.on("shown hidden rested dir plain",B),Z.on("dir:up dir:right dir:down dir:left",B),Z.on("plain:up plain:right plain:down plain:left",B)},R.prototype.bindDocument=function(){var Z=this;Z.binded||(Z.bindEvt(document,"move").bindEvt(document,"end"),Z.binded=!0)},R.prototype.unbindDocument=function(Z){var l=this;Object.keys(l.ids).length&&!0!==Z||(l.unbindEvt(document,"move").unbindEvt(document,"end"),l.binded=!1)},R.prototype.getIdentifier=function(Z){var l;return Z?void 0===(l=void 0===Z.identifier?Z.pointerId:Z.identifier)&&(l=this.latest||0):l=this.index,void 0===this.ids[l]&&(this.ids[l]=this.index,this.index+=1),this.latest=l,this.ids[l]},R.prototype.removeIdentifier=function(Z){var l={};for(var C in this.ids)if(this.ids[C]===Z){l.id=C,l.identifier=this.ids[C],delete this.ids[C];break}return l},R.prototype.onmove=function(Z){return this.onAny("move",Z),!1},R.prototype.onend=function(Z){return this.onAny("end",Z),!1},R.prototype.oncancel=function(Z){return this.onAny("end",Z),!1},R.prototype.onAny=function(Z,l){var C,B=this,x="processOn"+Z.charAt(0).toUpperCase()+Z.slice(1);l=J(l);var b=function(Z,l,C){C.ids.indexOf(l)>=0&&(C[x](Z),Z._found_=!0)};return z(l,(function(Z){C=B.getIdentifier(Z),z(B.collections,b.bind(null,Z,C)),Z._found_||B.removeIdentifier(C)})),!1},R.prototype.destroy=function(){var Z=this;Z.unbindDocument(!0),Z.ids={},Z.index=0,Z.collections.forEach((function(Z){Z.destroy()})),Z.off()},R.prototype.onDestroyed=function(Z,l){var C=this;if(C.collections.indexOf(l)<0)return!1;C.collections.splice(C.collections.indexOf(l),1)};var k=new R;const V={create:function(Z){return k.create(Z)},factory:k};return l.default})(),Z.exports=l()},13257:(Z,l,C)=>{"use strict";const{Deflate:B,deflate:x,deflateRaw:b,gzip:K}=C(13262),{Inflate:f,inflate:W,inflateRaw:J,ungzip:d}=C(13325),E=C(13297);Z.exports.Deflate=B,Z.exports.deflate=x,Z.exports.deflateRaw=b,Z.exports.gzip=K,Z.exports.Inflate=f,Z.exports.inflate=W,Z.exports.inflateRaw=J,Z.exports.ungzip=d,Z.exports.constants=E},13262:(Z,l,C)=>{"use strict";const B=C(13265),x=C(13303),b=C(13309),K=C(13289),f=C(13316),W=Object.prototype.toString,{Z_NO_FLUSH:J,Z_SYNC_FLUSH:d,Z_FULL_FLUSH:E,Z_FINISH:G,Z_OK:a,Z_STREAM_END:q,Z_DEFAULT_COMPRESSION:z,Z_DEFAULT_STRATEGY:Y,Z_DEFLATED:P}=C(13297);function S(Z){this.options=x.assign({level:z,method:P,wZ:16384,windowBits:15,memLevel:8,strategy:Y},Z||{});let l=this.options;l.raw&&l.windowBits>0?l.windowBits=-l.windowBits:l.gzip&&l.windowBits>0&&l.windowBits<16&&(l.windowBits+=16),this.err=0,this.Jl="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;let C=B.deflateInit2(this.strm,l.level,l.method,l.windowBits,l.memLevel,l.strategy);if(C!==a)throw new Error(K[C]);if(l.header&&B.deflateSetHeader(this.strm,l.header),l.dictionary){let Z;if(Z="string"===typeof l.dictionary?b.string2buf(l.dictionary):"[object ArrayBuffer]"===W.call(l.dictionary)?new Uint8Array(l.dictionary):l.dictionary,C=B.deflateSetDictionary(this.strm,Z),C!==a)throw new Error(K[C]);this._dict_set=!0}}function i(Z,l){const C=new S(l);if(C.push(Z,!0),C.err)throw C.Jl||K[C.err];return C.result}S.prototype.push=function(Z,l){const C=this.strm,x=this.options.wZ;let K,f;if(this.ended)return!1;for(f=l===~~l?l:!0===l?G:J,"string"===typeof Z?C.input=b.string2buf(Z):"[object ArrayBuffer]"===W.call(Z)?C.input=new Uint8Array(Z):C.input=Z,C.next_in=0,C.avail_in=C.input.length;;)if(0===C.avail_out&&(C.output=new Uint8Array(x),C.next_out=0,C.avail_out=x),(f===d||f===E)&&C.avail_out<=6)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else{if(K=B.deflate(C,f),K===q)return C.next_out>0&&this.onData(C.output.subarray(0,C.next_out)),K=B.deflateEnd(this.strm),this.onEnd(K),this.ended=!0,K===a;if(0!==C.avail_out){if(f>0&&C.next_out>0)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else if(0===C.avail_in)break}else this.onData(C.output)}return!0},S.prototype.onData=function(Z){this.chunks.push(Z)},S.prototype.onEnd=function(Z){Z===a&&(this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.Jl=this.strm.Jl},Z.exports.Deflate=S,Z.exports.deflate=i,Z.exports.deflateRaw=function(Z,l){return(l=l||{}).raw=!0,i(Z,l)},Z.exports.gzip=function(Z,l){return(l=l||{}).gzip=!0,i(Z,l)},Z.exports.constants=C(13297)},13325:(Z,l,C)=>{"use strict";const B=C(13328),x=C(13303),b=C(13309),K=C(13289),f=C(13316),W=C(13343),J=Object.prototype.toString,{Z_NO_FLUSH:d,Z_FINISH:E,Z_OK:G,Z_STREAM_END:a,Z_NEED_DICT:q,Z_STREAM_ERROR:z,Z_DATA_ERROR:Y,Z_MEM_ERROR:P}=C(13297);function S(Z){this.options=x.assign({wZ:65536,windowBits:15,to:""},Z||{});const l=this.options;l.raw&&l.windowBits>=0&&l.windowBits<16&&(l.windowBits=-l.windowBits,0===l.windowBits&&(l.windowBits=-15)),!(l.windowBits>=0&&l.windowBits<16)||Z&&Z.windowBits||(l.windowBits+=32),l.windowBits>15&&l.windowBits<48&&0===(15&l.windowBits)&&(l.windowBits|=15),this.err=0,this.Jl="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;let C=B.inflateInit2(this.strm,l.windowBits);if(C!==G)throw new Error(K[C]);if(this.header=new W,B.inflateGetHeader(this.strm,this.header),l.dictionary&&("string"===typeof l.dictionary?l.dictionary=b.string2buf(l.dictionary):"[object ArrayBuffer]"===J.call(l.dictionary)&&(l.dictionary=new Uint8Array(l.dictionary)),l.raw&&(C=B.inflateSetDictionary(this.strm,l.dictionary),C!==G)))throw new Error(K[C])}function i(Z,l){const C=new S(l);if(C.push(Z),C.err)throw C.Jl||K[C.err];return C.result}S.prototype.push=function(Z,l){const C=this.strm,x=this.options.wZ,K=this.options.dictionary;let f,W,S;if(this.ended)return!1;for(W=l===~~l?l:!0===l?E:d,"[object ArrayBuffer]"===J.call(Z)?C.input=new Uint8Array(Z):C.input=Z,C.next_in=0,C.avail_in=C.input.length;;){for(0===C.avail_out&&(C.output=new Uint8Array(x),C.next_out=0,C.avail_out=x),f=B.inflate(C,W),f===q&&K&&(f=B.inflateSetDictionary(C,K),f===G?f=B.inflate(C,W):f===Y&&(f=q));C.avail_in>0&&f===a&&C.state.wrap>0&&0!==Z[C.next_in];)B.inflateReset(C),f=B.inflate(C,W);switch(f){case z:case Y:case q:case P:return this.onEnd(f),this.ended=!0,!1}if(S=C.avail_out,C.next_out&&(0===C.avail_out||f===a))if("string"===this.options.to){let Z=b.utf8border(C.output,C.next_out),l=C.next_out-Z,B=b.buf2string(C.output,Z);C.next_out=l,C.avail_out=x-l,l&&C.output.set(C.output.subarray(Z,Z+l),0),this.onData(B)}else this.onData(C.output.length===C.next_out?C.output:C.output.subarray(0,C.next_out));if(f!==G||0!==S){if(f===a)return f=B.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,!0;if(0===C.avail_in)break}}return!0},S.prototype.onData=function(Z){this.chunks.push(Z)},S.prototype.onEnd=function(Z){Z===G&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.Jl=this.strm.Jl},Z.exports.Inflate=S,Z.exports.inflate=i,Z.exports.inflateRaw=function(Z,l){return(l=l||{}).raw=!0,i(Z,l)},Z.exports.ungzip=i,Z.exports.constants=C(13297)},13303:Z=>{"use strict";const l=(Z,l)=>Object.prototype.hasOwnProperty.call(Z,l);Z.exports.assign=function(Z){const C=Array.prototype.slice.call(arguments,1);for(;C.length;){const B=C.shift();if(B){if("object"!==typeof B)throw new TypeError(B+"must be non-object");for(const C in B)l(B,C)&&(Z[C]=B[C])}}return Z},Z.exports.flattenChunks=Z=>{let l=0;for(let B=0,x=Z.length;B<x;B++)l+=Z[B].length;const C=new Uint8Array(l);for(let B=0,x=0,b=Z.length;B<b;B++){let l=Z[B];C.set(l,x),x+=l.length}return C}},13309:Z=>{"use strict";let l=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(B){l=!1}const C=new Uint8Array(256);for(let x=0;x<256;x++)C[x]=x>=252?6:x>=248?5:x>=240?4:x>=224?3:x>=192?2:1;C[254]=C[254]=1,Z.exports.string2buf=Z=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(Z);let l,C,B,x,b,K=Z.length,f=0;for(x=0;x<K;x++)C=Z.charCodeAt(x),55296===(64512&C)&&x+1<K&&(B=Z.charCodeAt(x+1),56320===(64512&B)&&(C=65536+(C-55296<<10)+(B-56320),x++)),f+=C<128?1:C<2048?2:C<65536?3:4;for(l=new Uint8Array(f),b=0,x=0;b<f;x++)C=Z.charCodeAt(x),55296===(64512&C)&&x+1<K&&(B=Z.charCodeAt(x+1),56320===(64512&B)&&(C=65536+(C-55296<<10)+(B-56320),x++)),C<128?l[b++]=C:C<2048?(l[b++]=192|C>>>6,l[b++]=128|63&C):C<65536?(l[b++]=224|C>>>12,l[b++]=128|C>>>6&63,l[b++]=128|63&C):(l[b++]=240|C>>>18,l[b++]=128|C>>>12&63,l[b++]=128|C>>>6&63,l[b++]=128|63&C);return l};Z.exports.buf2string=(Z,B)=>{const x=B||Z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(Z.subarray(0,B));let b,K;const f=new Array(2*x);for(K=0,b=0;b<x;){let l=Z[b++];if(l<128){f[K++]=l;continue}let B=C[l];if(B>4)f[K++]=65533,b+=B-1;else{for(l&=2===B?31:3===B?15:7;B>1&&b<x;)l=l<<6|63&Z[b++],B--;B>1?f[K++]=65533:l<65536?f[K++]=l:(l-=65536,f[K++]=55296|l>>10&1023,f[K++]=56320|1023&l)}}return((Z,C)=>{if(C<65534&&Z.subarray&&l)return String.fromCharCode.apply(null,Z.length===C?Z:Z.subarray(0,C));let B="";for(let l=0;l<C;l++)B+=String.fromCharCode(Z[l]);return B})(f,K)},Z.exports.utf8border=(Z,l)=>{(l=l||Z.length)>Z.length&&(l=Z.length);let B=l-1;for(;B>=0&&128===(192&Z[B]);)B--;return B<0||0===B?l:B+C[Z[B]]>l?B:l}},13278:Z=>{"use strict";Z.exports=(Z,l,C,B)=>{let x=65535&Z,b=Z>>>16&65535,K=0;for(;0!==C;){K=C>2e3?2e3:C,C-=K;do{x=x+l[B++]|0,b=b+x|0}while(--K);x%=65521,b%=65521}return x|b<<16}},13297:Z=>{"use strict";Z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13284:Z=>{"use strict";const l=new Uint32Array((()=>{let Z,l=[];for(var C=0;C<256;C++){Z=C;for(var B=0;B<8;B++)Z=1&Z?3988292384^Z>>>1:Z>>>1;l[C]=Z}return l})());Z.exports=(Z,C,B,x)=>{const b=l,K=x+B;Z^=-1;for(let l=x;l<K;l++)Z=Z>>>8^b[255&(Z^C[l])];return~Z}},13265:(Z,l,C)=>{"use strict";const{_tr_init:B,_tr_stored_block:x,_tr_flush_block:b,_tr_tally:K,_tr_align:f}=C(13272),W=C(13278),J=C(13284),d=C(13289),{Z_NO_FLUSH:E,Z_PARTIAL_FLUSH:G,Z_FULL_FLUSH:a,Z_FINISH:q,Z_BLOCK:z,Z_OK:Y,Z_STREAM_END:P,Z_STREAM_ERROR:S,Z_DATA_ERROR:i,Z_BUF_ERROR:s,Z_DEFAULT_COMPRESSION:F,Z_FILTERED:n,Z_HUFFMAN_ONLY:c,Z_RLE:U,Z_FIXED:t,Z_DEFAULT_STRATEGY:r,Z_UNKNOWN:e,Z_DEFLATED:o}=C(13297),v=258,R=262,k=103,V=113,g=666,j=(Z,l)=>(Z.Jl=d[l],l),M=Z=>(Z<<1)-(Z>4?9:0),I=Z=>{let l=Z.length;for(;--l>=0;)Z[l]=0};let w=(Z,l,C)=>(l<<Z.hash_shift^C)&Z.hash_mask;const O=Z=>{const l=Z.state;let C=l.pending;C>Z.avail_out&&(C=Z.avail_out),0!==C&&(Z.output.set(l.pending_buf.subarray(l.pending_out,l.pending_out+C),Z.next_out),Z.next_out+=C,l.pending_out+=C,Z.total_out+=C,Z.avail_out-=C,l.pending-=C,0===l.pending&&(l.pending_out=0))},D=(Z,l)=>{b(Z,Z.block_start>=0?Z.block_start:-1,Z.strstart-Z.block_start,l),Z.block_start=Z.strstart,O(Z.strm)},y=(Z,l)=>{Z.pending_buf[Z.pending++]=l},X=(Z,l)=>{Z.pending_buf[Z.pending++]=l>>>8&255,Z.pending_buf[Z.pending++]=255&l},T=(Z,l,C,B)=>{let x=Z.avail_in;return x>B&&(x=B),0===x?0:(Z.avail_in-=x,l.set(Z.input.subarray(Z.next_in,Z.next_in+x),C),1===Z.state.wrap?Z.adler=W(Z.adler,l,x,C):2===Z.state.wrap&&(Z.adler=J(Z.adler,l,x,C)),Z.next_in+=x,Z.total_in+=x,x)},u=(Z,l)=>{let C,B,x=Z.max_chain_length,b=Z.strstart,K=Z.prev_length,f=Z.nice_match;const W=Z.strstart>Z.w_size-R?Z.strstart-(Z.w_size-R):0,J=Z.window,d=Z.w_mask,E=Z.prev,G=Z.strstart+v;let a=J[b+K-1],q=J[b+K];Z.prev_length>=Z.good_match&&(x>>=2),f>Z.lookahead&&(f=Z.lookahead);do{if(C=l,J[C+K]===q&&J[C+K-1]===a&&J[C]===J[b]&&J[++C]===J[b+1]){b+=2,C++;do{}while(J[++b]===J[++C]&&J[++b]===J[++C]&&J[++b]===J[++C]&&J[++b]===J[++C]&&J[++b]===J[++C]&&J[++b]===J[++C]&&J[++b]===J[++C]&&J[++b]===J[++C]&&b<G);if(B=v-(G-b),b=G-v,B>K){if(Z.match_start=l,K=B,B>=f)break;a=J[b+K-1],q=J[b+K]}}}while((l=E[l&d])>W&&0!==--x);return K<=Z.lookahead?K:Z.lookahead},H=Z=>{const l=Z.w_size;let C,B,x,b,K;do{if(b=Z.window_size-Z.lookahead-Z.strstart,Z.strstart>=l+(l-R)){Z.window.set(Z.window.subarray(l,l+l),0),Z.match_start-=l,Z.strstart-=l,Z.block_start-=l,B=Z.hash_size,C=B;do{x=Z.head[--C],Z.head[C]=x>=l?x-l:0}while(--B);B=l,C=B;do{x=Z.prev[--C],Z.prev[C]=x>=l?x-l:0}while(--B);b+=l}if(0===Z.strm.avail_in)break;if(B=T(Z.strm,Z.window,Z.strstart+Z.lookahead,b),Z.lookahead+=B,Z.lookahead+Z.insert>=3)for(K=Z.strstart-Z.insert,Z.ins_h=Z.window[K],Z.ins_h=w(Z,Z.ins_h,Z.window[K+1]);Z.insert&&(Z.ins_h=w(Z,Z.ins_h,Z.window[K+3-1]),Z.prev[K&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=K,K++,Z.insert--,!(Z.lookahead+Z.insert<3)););}while(Z.lookahead<R&&0!==Z.strm.avail_in)},Q=(Z,l)=>{let C,B;for(;;){if(Z.lookahead<R){if(H(Z),Z.lookahead<R&&l===E)return 1;if(0===Z.lookahead)break}if(C=0,Z.lookahead>=3&&(Z.ins_h=w(Z,Z.ins_h,Z.window[Z.strstart+3-1]),C=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),0!==C&&Z.strstart-C<=Z.w_size-R&&(Z.match_length=u(Z,C)),Z.match_length>=3)if(B=K(Z,Z.strstart-Z.match_start,Z.match_length-3),Z.lookahead-=Z.match_length,Z.match_length<=Z.max_lazy_match&&Z.lookahead>=3){Z.match_length--;do{Z.strstart++,Z.ins_h=w(Z,Z.ins_h,Z.window[Z.strstart+3-1]),C=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart}while(0!==--Z.match_length);Z.strstart++}else Z.strstart+=Z.match_length,Z.match_length=0,Z.ins_h=Z.window[Z.strstart],Z.ins_h=w(Z,Z.ins_h,Z.window[Z.strstart+1]);else B=K(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++;if(B&&(D(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=Z.strstart<2?Z.strstart:2,l===q?(D(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(D(Z,!1),0===Z.strm.avail_out)?1:2},h=(Z,l)=>{let C,B,x;for(;;){if(Z.lookahead<R){if(H(Z),Z.lookahead<R&&l===E)return 1;if(0===Z.lookahead)break}if(C=0,Z.lookahead>=3&&(Z.ins_h=w(Z,Z.ins_h,Z.window[Z.strstart+3-1]),C=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),Z.prev_length=Z.match_length,Z.prev_match=Z.match_start,Z.match_length=2,0!==C&&Z.prev_length<Z.max_lazy_match&&Z.strstart-C<=Z.w_size-R&&(Z.match_length=u(Z,C),Z.match_length<=5&&(Z.strategy===n||3===Z.match_length&&Z.strstart-Z.match_start>4096)&&(Z.match_length=2)),Z.prev_length>=3&&Z.match_length<=Z.prev_length){x=Z.strstart+Z.lookahead-3,B=K(Z,Z.strstart-1-Z.prev_match,Z.prev_length-3),Z.lookahead-=Z.prev_length-1,Z.prev_length-=2;do{++Z.strstart<=x&&(Z.ins_h=w(Z,Z.ins_h,Z.window[Z.strstart+3-1]),C=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart)}while(0!==--Z.prev_length);if(Z.match_available=0,Z.match_length=2,Z.strstart++,B&&(D(Z,!1),0===Z.strm.avail_out))return 1}else if(Z.match_available){if(B=K(Z,0,Z.window[Z.strstart-1]),B&&D(Z,!1),Z.strstart++,Z.lookahead--,0===Z.strm.avail_out)return 1}else Z.match_available=1,Z.strstart++,Z.lookahead--}return Z.match_available&&(B=K(Z,0,Z.window[Z.strstart-1]),Z.match_available=0),Z.insert=Z.strstart<2?Z.strstart:2,l===q?(D(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(D(Z,!1),0===Z.strm.avail_out)?1:2};function A(Z,l,C,B,x){this.good_length=Z,this.max_lazy=l,this.nice_length=C,this.max_chain=B,this.func=x}const L=[new A(0,0,0,0,((Z,l)=>{let C=65535;for(C>Z.pending_buf_size-5&&(C=Z.pending_buf_size-5);;){if(Z.lookahead<=1){if(H(Z),0===Z.lookahead&&l===E)return 1;if(0===Z.lookahead)break}Z.strstart+=Z.lookahead,Z.lookahead=0;const B=Z.block_start+C;if((0===Z.strstart||Z.strstart>=B)&&(Z.lookahead=Z.strstart-B,Z.strstart=B,D(Z,!1),0===Z.strm.avail_out))return 1;if(Z.strstart-Z.block_start>=Z.w_size-R&&(D(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,l===q?(D(Z,!0),0===Z.strm.avail_out?3:4):(Z.strstart>Z.block_start&&(D(Z,!1),Z.strm.avail_out),1)})),new A(4,4,8,4,Q),new A(4,5,16,8,Q),new A(4,6,32,32,Q),new A(4,4,16,16,h),new A(8,16,32,32,h),new A(8,16,128,128,h),new A(8,32,128,256,h),new A(32,128,258,1024,h),new A(32,258,258,4096,h)];function p(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=o,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),I(this.dyn_ltree),I(this.dyn_dtree),I(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),I(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),I(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const N=Z=>{if(!Z||!Z.state)return j(Z,S);Z.total_in=Z.total_out=0,Z.data_type=e;const l=Z.state;return l.pending=0,l.pending_out=0,l.wrap<0&&(l.wrap=-l.wrap),l.status=l.wrap?42:V,Z.adler=2===l.wrap?0:1,l.last_flush=E,B(l),Y},mZ=Z=>{const l=N(Z);var C;return l===Y&&((C=Z.state).window_size=2*C.w_size,I(C.head),C.max_lazy_match=L[C.level].max_lazy,C.good_match=L[C.level].good_length,C.nice_match=L[C.level].nice_length,C.max_chain_length=L[C.level].max_chain,C.strstart=0,C.block_start=0,C.lookahead=0,C.insert=0,C.match_length=C.prev_length=2,C.match_available=0,C.ins_h=0),l},ZZ=(Z,l,C,B,x,b)=>{if(!Z)return S;let K=1;if(l===F&&(l=6),B<0?(K=0,B=-B):B>15&&(K=2,B-=16),x<1||x>9||C!==o||B<8||B>15||l<0||l>9||b<0||b>t)return j(Z,S);8===B&&(B=9);const f=new p;return Z.state=f,f.strm=Z,f.wrap=K,f.gzhead=null,f.w_bits=B,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=x+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<x+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.d_buf=1*f.lit_bufsize,f.l_buf=3*f.lit_bufsize,f.level=l,f.strategy=b,f.method=C,mZ(Z)};Z.exports.deflateInit=(Z,l)=>ZZ(Z,l,o,15,8,r),Z.exports.deflateInit2=ZZ,Z.exports.deflateReset=mZ,Z.exports.deflateResetKeep=N,Z.exports.deflateSetHeader=(Z,l)=>Z&&Z.state?2!==Z.state.wrap?S:(Z.state.gzhead=l,Y):S,Z.exports.deflate=(Z,l)=>{let C,B;if(!Z||!Z.state||l>z||l<0)return Z?j(Z,S):S;const b=Z.state;if(!Z.output||!Z.input&&0!==Z.avail_in||b.status===g&&l!==q)return j(Z,0===Z.avail_out?s:S);b.strm=Z;const W=b.last_flush;if(b.last_flush=l,42===b.status)if(2===b.wrap)Z.adler=0,y(b,31),y(b,139),y(b,8),b.gzhead?(y(b,(b.gzhead.text?1:0)+(b.gzhead.hcrc?2:0)+(b.gzhead.extra?4:0)+(b.gzhead.name?8:0)+(b.gzhead.comment?16:0)),y(b,255&b.gzhead.time),y(b,b.gzhead.time>>8&255),y(b,b.gzhead.time>>16&255),y(b,b.gzhead.time>>24&255),y(b,9===b.level?2:b.strategy>=c||b.level<2?4:0),y(b,255&b.gzhead.os),b.gzhead.extra&&b.gzhead.extra.length&&(y(b,255&b.gzhead.extra.length),y(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(Z.adler=J(Z.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=69):(y(b,0),y(b,0),y(b,0),y(b,0),y(b,0),y(b,9===b.level?2:b.strategy>=c||b.level<2?4:0),y(b,3),b.status=V);else{let l=o+(b.w_bits-8<<4)<<8,C=-1;C=b.strategy>=c||b.level<2?0:b.level<6?1:6===b.level?2:3,l|=C<<6,0!==b.strstart&&(l|=32),l+=31-l%31,b.status=V,X(b,l),0!==b.strstart&&(X(b,Z.adler>>>16),X(b,65535&Z.adler)),Z.adler=1}if(69===b.status)if(b.gzhead.extra){for(C=b.pending;b.gzindex<(65535&b.gzhead.extra.length)&&(b.pending!==b.pending_buf_size||(b.gzhead.hcrc&&b.pending>C&&(Z.adler=J(Z.adler,b.pending_buf,b.pending-C,C)),O(Z),C=b.pending,b.pending!==b.pending_buf_size));)y(b,255&b.gzhead.extra[b.gzindex]),b.gzindex++;b.gzhead.hcrc&&b.pending>C&&(Z.adler=J(Z.adler,b.pending_buf,b.pending-C,C)),b.gzindex===b.gzhead.extra.length&&(b.gzindex=0,b.status=73)}else b.status=73;if(73===b.status)if(b.gzhead.name){C=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>C&&(Z.adler=J(Z.adler,b.pending_buf,b.pending-C,C)),O(Z),C=b.pending,b.pending===b.pending_buf_size)){B=1;break}B=b.gzindex<b.gzhead.name.length?255&b.gzhead.name.charCodeAt(b.gzindex++):0,y(b,B)}while(0!==B);b.gzhead.hcrc&&b.pending>C&&(Z.adler=J(Z.adler,b.pending_buf,b.pending-C,C)),0===B&&(b.gzindex=0,b.status=91)}else b.status=91;if(91===b.status)if(b.gzhead.comment){C=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>C&&(Z.adler=J(Z.adler,b.pending_buf,b.pending-C,C)),O(Z),C=b.pending,b.pending===b.pending_buf_size)){B=1;break}B=b.gzindex<b.gzhead.comment.length?255&b.gzhead.comment.charCodeAt(b.gzindex++):0,y(b,B)}while(0!==B);b.gzhead.hcrc&&b.pending>C&&(Z.adler=J(Z.adler,b.pending_buf,b.pending-C,C)),0===B&&(b.status=k)}else b.status=k;if(b.status===k&&(b.gzhead.hcrc?(b.pending+2>b.pending_buf_size&&O(Z),b.pending+2<=b.pending_buf_size&&(y(b,255&Z.adler),y(b,Z.adler>>8&255),Z.adler=0,b.status=V)):b.status=V),0!==b.pending){if(O(Z),0===Z.avail_out)return b.last_flush=-1,Y}else if(0===Z.avail_in&&M(l)<=M(W)&&l!==q)return j(Z,s);if(b.status===g&&0!==Z.avail_in)return j(Z,s);if(0!==Z.avail_in||0!==b.lookahead||l!==E&&b.status!==g){let C=b.strategy===c?((Z,l)=>{let C;for(;;){if(0===Z.lookahead&&(H(Z),0===Z.lookahead)){if(l===E)return 1;break}if(Z.match_length=0,C=K(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,C&&(D(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,l===q?(D(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(D(Z,!1),0===Z.strm.avail_out)?1:2})(b,l):b.strategy===U?((Z,l)=>{let C,B,x,b;const f=Z.window;for(;;){if(Z.lookahead<=v){if(H(Z),Z.lookahead<=v&&l===E)return 1;if(0===Z.lookahead)break}if(Z.match_length=0,Z.lookahead>=3&&Z.strstart>0&&(x=Z.strstart-1,B=f[x],B===f[++x]&&B===f[++x]&&B===f[++x])){b=Z.strstart+v;do{}while(B===f[++x]&&B===f[++x]&&B===f[++x]&&B===f[++x]&&B===f[++x]&&B===f[++x]&&B===f[++x]&&B===f[++x]&&x<b);Z.match_length=v-(b-x),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=3?(C=K(Z,1,Z.match_length-3),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(C=K(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),C&&(D(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,l===q?(D(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(D(Z,!1),0===Z.strm.avail_out)?1:2})(b,l):L[b.level].func(b,l);if(3!==C&&4!==C||(b.status=g),1===C||3===C)return 0===Z.avail_out&&(b.last_flush=-1),Y;if(2===C&&(l===G?f(b):l!==z&&(x(b,0,0,!1),l===a&&(I(b.head),0===b.lookahead&&(b.strstart=0,b.block_start=0,b.insert=0))),O(Z),0===Z.avail_out))return b.last_flush=-1,Y}return l!==q?Y:b.wrap<=0?P:(2===b.wrap?(y(b,255&Z.adler),y(b,Z.adler>>8&255),y(b,Z.adler>>16&255),y(b,Z.adler>>24&255),y(b,255&Z.total_in),y(b,Z.total_in>>8&255),y(b,Z.total_in>>16&255),y(b,Z.total_in>>24&255)):(X(b,Z.adler>>>16),X(b,65535&Z.adler)),O(Z),b.wrap>0&&(b.wrap=-b.wrap),0!==b.pending?Y:P)},Z.exports.deflateEnd=Z=>{if(!Z||!Z.state)return S;const l=Z.state.status;return 42!==l&&69!==l&&73!==l&&91!==l&&l!==k&&l!==V&&l!==g?j(Z,S):(Z.state=null,l===V?j(Z,i):Y)},Z.exports.deflateSetDictionary=(Z,l)=>{let C=l.length;if(!Z||!Z.state)return S;const B=Z.state,x=B.wrap;if(2===x||1===x&&42!==B.status||B.lookahead)return S;if(1===x&&(Z.adler=W(Z.adler,l,C,0)),B.wrap=0,C>=B.w_size){0===x&&(I(B.head),B.strstart=0,B.block_start=0,B.insert=0);let Z=new Uint8Array(B.w_size);Z.set(l.subarray(C-B.w_size,C),0),l=Z,C=B.w_size}const b=Z.avail_in,K=Z.next_in,f=Z.input;for(Z.avail_in=C,Z.next_in=0,Z.input=l,H(B);B.lookahead>=3;){let Z=B.strstart,l=B.lookahead-2;do{B.ins_h=w(B,B.ins_h,B.window[Z+3-1]),B.prev[Z&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=Z,Z++}while(--l);B.strstart=Z,B.lookahead=2,H(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=2,B.match_available=0,Z.next_in=K,Z.input=f,Z.avail_in=b,B.wrap=x,Y},Z.exports.deflateInfo="pako deflate (from Nodeca project)"},13343:Z=>{"use strict";Z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13334:Z=>{"use strict";Z.exports=function(Z,l){let C,B,x,b,K,f,W,J,d,E,G,a,q,z,Y,P,S,i,s,F,n,c,U,t;const r=Z.state;C=Z.next_in,U=Z.input,B=C+(Z.avail_in-5),x=Z.next_out,t=Z.output,b=x-(l-Z.avail_out),K=x+(Z.avail_out-257),f=r.dmax,W=r.wsize,J=r.whave,d=r.wnext,E=r.window,G=r.hold,a=r.bits,q=r.lencode,z=r.distcode,Y=(1<<r.lenbits)-1,P=(1<<r.distbits)-1;Z:do{a<15&&(G+=U[C++]<<a,a+=8,G+=U[C++]<<a,a+=8),S=q[G&Y];l:for(;;){if(i=S>>>24,G>>>=i,a-=i,i=S>>>16&255,0===i)t[x++]=65535&S;else{if(!(16&i)){if(0===(64&i)){S=q[(65535&S)+(G&(1<<i)-1)];continue l}if(32&i){r.mode=12;break Z}Z.Jl="invalid literal/length code",r.mode=30;break Z}s=65535&S,i&=15,i&&(a<i&&(G+=U[C++]<<a,a+=8),s+=G&(1<<i)-1,G>>>=i,a-=i),a<15&&(G+=U[C++]<<a,a+=8,G+=U[C++]<<a,a+=8),S=z[G&P];C:for(;;){if(i=S>>>24,G>>>=i,a-=i,i=S>>>16&255,!(16&i)){if(0===(64&i)){S=z[(65535&S)+(G&(1<<i)-1)];continue C}Z.Jl="invalid distance code",r.mode=30;break Z}if(F=65535&S,i&=15,a<i&&(G+=U[C++]<<a,a+=8,a<i&&(G+=U[C++]<<a,a+=8)),F+=G&(1<<i)-1,F>f){Z.Jl="invalid distance too far back",r.mode=30;break Z}if(G>>>=i,a-=i,i=x-b,F>i){if(i=F-i,i>J&&r.sane){Z.Jl="invalid distance too far back",r.mode=30;break Z}if(n=0,c=E,0===d){if(n+=W-i,i<s){s-=i;do{t[x++]=E[n++]}while(--i);n=x-F,c=t}}else if(d<i){if(n+=W+d-i,i-=d,i<s){s-=i;do{t[x++]=E[n++]}while(--i);if(n=0,d<s){i=d,s-=i;do{t[x++]=E[n++]}while(--i);n=x-F,c=t}}}else if(n+=d-i,i<s){s-=i;do{t[x++]=E[n++]}while(--i);n=x-F,c=t}for(;s>2;)t[x++]=c[n++],t[x++]=c[n++],t[x++]=c[n++],s-=3;s&&(t[x++]=c[n++],s>1&&(t[x++]=c[n++]))}else{n=x-F;do{t[x++]=t[n++],t[x++]=t[n++],t[x++]=t[n++],s-=3}while(s>2);s&&(t[x++]=t[n++],s>1&&(t[x++]=t[n++]))}break}}break}}while(C<B&&x<K);s=a>>3,C-=s,a-=s<<3,G&=(1<<a)-1,Z.next_in=C,Z.next_out=x,Z.avail_in=C<B?B-C+5:5-(C-B),Z.avail_out=x<K?K-x+257:257-(x-K),r.hold=G,r.bits=a}},13328:(Z,l,C)=>{"use strict";const B=C(13278),x=C(13284),b=C(13334),K=C(13338),{Z_FINISH:f,Z_BLOCK:W,Z_TREES:J,Z_OK:d,Z_STREAM_END:E,Z_NEED_DICT:G,Z_STREAM_ERROR:a,Z_DATA_ERROR:q,Z_MEM_ERROR:z,Z_BUF_ERROR:Y,Z_DEFLATED:P}=C(13297),S=12,i=30,s=Z=>(Z>>>24&255)+(Z>>>8&65280)+((65280&Z)<<8)+((255&Z)<<24);function F(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const n=Z=>{if(!Z||!Z.state)return a;const l=Z.state;return Z.total_in=Z.total_out=l.total=0,Z.Jl="",l.wrap&&(Z.adler=1&l.wrap),l.mode=1,l.last=0,l.havedict=0,l.dmax=32768,l.head=null,l.hold=0,l.bits=0,l.lencode=l.lendyn=new Int32Array(852),l.distcode=l.distdyn=new Int32Array(592),l.sane=1,l.back=-1,d},c=Z=>{if(!Z||!Z.state)return a;const l=Z.state;return l.wsize=0,l.whave=0,l.wnext=0,n(Z)},U=(Z,l)=>{let C;if(!Z||!Z.state)return a;const B=Z.state;return l<0?(C=0,l=-l):(C=1+(l>>4),l<48&&(l&=15)),l&&(l<8||l>15)?a:(null!==B.window&&B.wbits!==l&&(B.window=null),B.wrap=C,B.wbits=l,c(Z))},t=(Z,l)=>{if(!Z)return a;const C=new F;Z.state=C,C.window=null;const B=U(Z,l);return B!==d&&(Z.state=null),B};let r,e,o=!0;const v=Z=>{if(o){r=new Int32Array(512),e=new Int32Array(32);let l=0;for(;l<144;)Z.lens[l++]=8;for(;l<256;)Z.lens[l++]=9;for(;l<280;)Z.lens[l++]=7;for(;l<288;)Z.lens[l++]=8;for(K(1,Z.lens,0,288,r,0,Z.work,{bits:9}),l=0;l<32;)Z.lens[l++]=5;K(2,Z.lens,0,32,e,0,Z.work,{bits:5}),o=!1}Z.lencode=r,Z.lenbits=9,Z.distcode=e,Z.distbits=5},R=(Z,l,C,B)=>{let x;const b=Z.state;return null===b.window&&(b.wsize=1<<b.wbits,b.wnext=0,b.whave=0,b.window=new Uint8Array(b.wsize)),B>=b.wsize?(b.window.set(l.subarray(C-b.wsize,C),0),b.wnext=0,b.whave=b.wsize):(x=b.wsize-b.wnext,x>B&&(x=B),b.window.set(l.subarray(C-B,C-B+x),b.wnext),(B-=x)?(b.window.set(l.subarray(C-B,C),0),b.wnext=B,b.whave=b.wsize):(b.wnext+=x,b.wnext===b.wsize&&(b.wnext=0),b.whave<b.wsize&&(b.whave+=x))),0};Z.exports.inflateReset=c,Z.exports.inflateReset2=U,Z.exports.inflateResetKeep=n,Z.exports.inflateInit=Z=>t(Z,15),Z.exports.inflateInit2=t,Z.exports.inflate=(Z,l)=>{let C,F,n,c,U,t,r,e,o,k,V,g,j,M,I,w,O,D,y,X,T,u,H=0;const Q=new Uint8Array(4);let h,A;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!Z||!Z.state||!Z.output||!Z.input&&0!==Z.avail_in)return a;C=Z.state,C.mode===S&&(C.mode=13),U=Z.next_out,n=Z.output,r=Z.avail_out,c=Z.next_in,F=Z.input,t=Z.avail_in,e=C.hold,o=C.bits,k=t,V=r,u=d;Z:for(;;)switch(C.mode){case 1:if(0===C.wrap){C.mode=13;break}for(;o<16;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}if(2&C.wrap&&35615===e){C.check=0,Q[0]=255&e,Q[1]=e>>>8&255,C.check=x(C.check,Q,2,0),e=0,o=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&e)<<8)+(e>>8))%31){Z.Jl="incorrect header check",C.mode=i;break}if((15&e)!==P){Z.Jl="unknown compression method",C.mode=i;break}if(e>>>=4,o-=4,T=8+(15&e),0===C.wbits)C.wbits=T;else if(T>C.wbits){Z.Jl="invalid window size",C.mode=i;break}C.dmax=1<<C.wbits,Z.adler=C.check=1,C.mode=512&e?10:S,e=0,o=0;break;case 2:for(;o<16;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}if(C.flags=e,(255&C.flags)!==P){Z.Jl="unknown compression method",C.mode=i;break}if(57344&C.flags){Z.Jl="unknown header flags set",C.mode=i;break}C.head&&(C.head.text=e>>8&1),512&C.flags&&(Q[0]=255&e,Q[1]=e>>>8&255,C.check=x(C.check,Q,2,0)),e=0,o=0,C.mode=3;case 3:for(;o<32;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}C.head&&(C.head.time=e),512&C.flags&&(Q[0]=255&e,Q[1]=e>>>8&255,Q[2]=e>>>16&255,Q[3]=e>>>24&255,C.check=x(C.check,Q,4,0)),e=0,o=0,C.mode=4;case 4:for(;o<16;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}C.head&&(C.head.xflags=255&e,C.head.os=e>>8),512&C.flags&&(Q[0]=255&e,Q[1]=e>>>8&255,C.check=x(C.check,Q,2,0)),e=0,o=0,C.mode=5;case 5:if(1024&C.flags){for(;o<16;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}C.length=e,C.head&&(C.head.extra_len=e),512&C.flags&&(Q[0]=255&e,Q[1]=e>>>8&255,C.check=x(C.check,Q,2,0)),e=0,o=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(g=C.length,g>t&&(g=t),g&&(C.head&&(T=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Uint8Array(C.head.extra_len)),C.head.extra.set(F.subarray(c,c+g),T)),512&C.flags&&(C.check=x(C.check,F,g,c)),t-=g,c+=g,C.length-=g),C.length))break Z;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(0===t)break Z;g=0;do{T=F[c+g++],C.head&&T&&C.length<65536&&(C.head.name+=String.fromCharCode(T))}while(T&&g<t);if(512&C.flags&&(C.check=x(C.check,F,g,c)),t-=g,c+=g,T)break Z}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(0===t)break Z;g=0;do{T=F[c+g++],C.head&&T&&C.length<65536&&(C.head.comment+=String.fromCharCode(T))}while(T&&g<t);if(512&C.flags&&(C.check=x(C.check,F,g,c)),t-=g,c+=g,T)break Z}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;o<16;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}if(e!==(65535&C.check)){Z.Jl="header crc mismatch",C.mode=i;break}e=0,o=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),Z.adler=C.check=0,C.mode=S;break;case 10:for(;o<32;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}Z.adler=C.check=s(e),e=0,o=0,C.mode=11;case 11:if(0===C.havedict)return Z.next_out=U,Z.avail_out=r,Z.next_in=c,Z.avail_in=t,C.hold=e,C.bits=o,G;Z.adler=C.check=1,C.mode=S;case S:if(l===W||l===J)break Z;case 13:if(C.last){e>>>=7&o,o-=7&o,C.mode=27;break}for(;o<3;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}switch(C.last=1&e,e>>>=1,o-=1,3&e){case 0:C.mode=14;break;case 1:if(v(C),C.mode=20,l===J){e>>>=2,o-=2;break Z}break;case 2:C.mode=17;break;case 3:Z.Jl="invalid block type",C.mode=i}e>>>=2,o-=2;break;case 14:for(e>>>=7&o,o-=7&o;o<32;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}if((65535&e)!==(e>>>16^65535)){Z.Jl="invalid stored block lengths",C.mode=i;break}if(C.length=65535&e,e=0,o=0,C.mode=15,l===J)break Z;case 15:C.mode=16;case 16:if(g=C.length,g){if(g>t&&(g=t),g>r&&(g=r),0===g)break Z;n.set(F.subarray(c,c+g),U),t-=g,c+=g,r-=g,U+=g,C.length-=g;break}C.mode=S;break;case 17:for(;o<14;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}if(C.nlen=257+(31&e),e>>>=5,o-=5,C.ndist=1+(31&e),e>>>=5,o-=5,C.ncode=4+(15&e),e>>>=4,o-=4,C.nlen>286||C.ndist>30){Z.Jl="too many length or distance symbols",C.mode=i;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;o<3;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}C.lens[L[C.have++]]=7&e,e>>>=3,o-=3}for(;C.have<19;)C.lens[L[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,h={bits:C.lenbits},u=K(0,C.lens,0,19,C.lencode,0,C.work,h),C.lenbits=h.bits,u){Z.Jl="invalid code lengths set",C.mode=i;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;H=C.lencode[e&(1<<C.lenbits)-1],I=H>>>24,w=H>>>16&255,O=65535&H,!(I<=o);){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}if(O<16)e>>>=I,o-=I,C.lens[C.have++]=O;else{if(16===O){for(A=I+2;o<A;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}if(e>>>=I,o-=I,0===C.have){Z.Jl="invalid bit length repeat",C.mode=i;break}T=C.lens[C.have-1],g=3+(3&e),e>>>=2,o-=2}else if(17===O){for(A=I+3;o<A;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}e>>>=I,o-=I,T=0,g=3+(7&e),e>>>=3,o-=3}else{for(A=I+7;o<A;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}e>>>=I,o-=I,T=0,g=11+(127&e),e>>>=7,o-=7}if(C.have+g>C.nlen+C.ndist){Z.Jl="invalid bit length repeat",C.mode=i;break}for(;g--;)C.lens[C.have++]=T}}if(C.mode===i)break;if(0===C.lens[256]){Z.Jl="invalid code -- missing end-of-block",C.mode=i;break}if(C.lenbits=9,h={bits:C.lenbits},u=K(1,C.lens,0,C.nlen,C.lencode,0,C.work,h),C.lenbits=h.bits,u){Z.Jl="invalid literal/lengths set",C.mode=i;break}if(C.distbits=6,C.distcode=C.distdyn,h={bits:C.distbits},u=K(2,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,h),C.distbits=h.bits,u){Z.Jl="invalid distances set",C.mode=i;break}if(C.mode=20,l===J)break Z;case 20:C.mode=21;case 21:if(t>=6&&r>=258){Z.next_out=U,Z.avail_out=r,Z.next_in=c,Z.avail_in=t,C.hold=e,C.bits=o,b(Z,V),U=Z.next_out,n=Z.output,r=Z.avail_out,c=Z.next_in,F=Z.input,t=Z.avail_in,e=C.hold,o=C.bits,C.mode===S&&(C.back=-1);break}for(C.back=0;H=C.lencode[e&(1<<C.lenbits)-1],I=H>>>24,w=H>>>16&255,O=65535&H,!(I<=o);){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}if(w&&0===(240&w)){for(D=I,y=w,X=O;H=C.lencode[X+((e&(1<<D+y)-1)>>D)],I=H>>>24,w=H>>>16&255,O=65535&H,!(D+I<=o);){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}e>>>=D,o-=D,C.back+=D}if(e>>>=I,o-=I,C.back+=I,C.length=O,0===w){C.mode=26;break}if(32&w){C.back=-1,C.mode=S;break}if(64&w){Z.Jl="invalid literal/length code",C.mode=i;break}C.extra=15&w,C.mode=22;case 22:if(C.extra){for(A=C.extra;o<A;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}C.length+=e&(1<<C.extra)-1,e>>>=C.extra,o-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;H=C.distcode[e&(1<<C.distbits)-1],I=H>>>24,w=H>>>16&255,O=65535&H,!(I<=o);){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}if(0===(240&w)){for(D=I,y=w,X=O;H=C.distcode[X+((e&(1<<D+y)-1)>>D)],I=H>>>24,w=H>>>16&255,O=65535&H,!(D+I<=o);){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}e>>>=D,o-=D,C.back+=D}if(e>>>=I,o-=I,C.back+=I,64&w){Z.Jl="invalid distance code",C.mode=i;break}C.offset=O,C.extra=15&w,C.mode=24;case 24:if(C.extra){for(A=C.extra;o<A;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}C.offset+=e&(1<<C.extra)-1,e>>>=C.extra,o-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){Z.Jl="invalid distance too far back",C.mode=i;break}C.mode=25;case 25:if(0===r)break Z;if(g=V-r,C.offset>g){if(g=C.offset-g,g>C.whave&&C.sane){Z.Jl="invalid distance too far back",C.mode=i;break}g>C.wnext?(g-=C.wnext,j=C.wsize-g):j=C.wnext-g,g>C.length&&(g=C.length),M=C.window}else M=n,j=U-C.offset,g=C.length;g>r&&(g=r),r-=g,C.length-=g;do{n[U++]=M[j++]}while(--g);0===C.length&&(C.mode=21);break;case 26:if(0===r)break Z;n[U++]=C.length,r--,C.mode=21;break;case 27:if(C.wrap){for(;o<32;){if(0===t)break Z;t--,e|=F[c++]<<o,o+=8}if(V-=r,Z.total_out+=V,C.total+=V,V&&(Z.adler=C.check=C.flags?x(C.check,n,V,U-V):B(C.check,n,V,U-V)),V=r,(C.flags?e:s(e))!==C.check){Z.Jl="incorrect data check",C.mode=i;break}e=0,o=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;o<32;){if(0===t)break Z;t--,e+=F[c++]<<o,o+=8}if(e!==(4294967295&C.total)){Z.Jl="incorrect length check",C.mode=i;break}e=0,o=0}C.mode=29;case 29:u=E;break Z;case i:u=q;break Z;case 31:return z;default:return a}return Z.next_out=U,Z.avail_out=r,Z.next_in=c,Z.avail_in=t,C.hold=e,C.bits=o,(C.wsize||V!==Z.avail_out&&C.mode<i&&(C.mode<27||l!==f))&&R(Z,Z.output,Z.next_out,V-Z.avail_out)?(C.mode=31,z):(k-=Z.avail_in,V-=Z.avail_out,Z.total_in+=k,Z.total_out+=V,C.total+=V,C.wrap&&V&&(Z.adler=C.check=C.flags?x(C.check,n,V,Z.next_out-V):B(C.check,n,V,Z.next_out-V)),Z.data_type=C.bits+(C.last?64:0)+(C.mode===S?128:0)+(20===C.mode||15===C.mode?256:0),(0===k&&0===V||l===f)&&u===d&&(u=Y),u)},Z.exports.inflateEnd=Z=>{if(!Z||!Z.state)return a;let l=Z.state;return l.window&&(l.window=null),Z.state=null,d},Z.exports.inflateGetHeader=(Z,l)=>{if(!Z||!Z.state)return a;const C=Z.state;return 0===(2&C.wrap)?a:(C.head=l,l.done=!1,d)},Z.exports.inflateSetDictionary=(Z,l)=>{const C=l.length;let x,b,K;return Z&&Z.state?(x=Z.state,0!==x.wrap&&11!==x.mode?a:11===x.mode&&(b=1,b=B(b,l,C,0),b!==x.check)?q:(K=R(Z,l,C,C),K?(x.mode=31,z):(x.havedict=1,d))):a},Z.exports.inflateInfo="pako inflate (from Nodeca project)"},13338:Z=>{"use strict";const l=15,C=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),B=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),x=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),b=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);Z.exports=(Z,K,f,W,J,d,E,G)=>{const a=G.bits;let q,z,Y,P,S,i,s=0,F=0,n=0,c=0,U=0,t=0,r=0,e=0,o=0,v=0,R=null,k=0;const V=new Uint16Array(16),g=new Uint16Array(16);let j,M,I,w=null,O=0;for(s=0;s<=l;s++)V[s]=0;for(F=0;F<W;F++)V[K[f+F]]++;for(U=a,c=l;c>=1&&0===V[c];c--);if(U>c&&(U=c),0===c)return J[d++]=20971520,J[d++]=20971520,G.bits=1,0;for(n=1;n<c&&0===V[n];n++);for(U<n&&(U=n),e=1,s=1;s<=l;s++)if(e<<=1,e-=V[s],e<0)return-1;if(e>0&&(0===Z||1!==c))return-1;for(g[1]=0,s=1;s<l;s++)g[s+1]=g[s]+V[s];for(F=0;F<W;F++)0!==K[f+F]&&(E[g[K[f+F]]++]=F);if(0===Z?(R=w=E,i=19):1===Z?(R=C,k-=257,w=B,O-=257,i=256):(R=x,w=b,i=-1),v=0,F=0,s=n,S=d,t=U,r=0,Y=-1,o=1<<U,P=o-1,1===Z&&o>852||2===Z&&o>592)return 1;for(;;){j=s-r,E[F]<i?(M=0,I=E[F]):E[F]>i?(M=w[O+E[F]],I=R[k+E[F]]):(M=96,I=0),q=1<<s-r,z=1<<t,n=z;do{z-=q,J[S+(v>>r)+z]=j<<24|M<<16|I}while(0!==z);for(q=1<<s-1;v&q;)q>>=1;if(0!==q?(v&=q-1,v+=q):v=0,F++,0===--V[s]){if(s===c)break;s=K[f+E[F]]}if(s>U&&(v&P)!==Y){for(0===r&&(r=U),S+=n,t=s-r,e=1<<t;t+r<c&&(e-=V[t+r],!(e<=0));)t++,e<<=1;if(o+=1<<t,1===Z&&o>852||2===Z&&o>592)return 1;Y=v&P,J[Y]=U<<24|t<<16|S-d}}return 0!==v&&(J[S+v]=s-r<<24|64<<16),G.bits=U,0}},13289:Z=>{"use strict";Z.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13272:Z=>{"use strict";function l(Z){let l=Z.length;for(;--l>=0;)Z[l]=0}const C=256,B=286,x=30,b=15,K=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),f=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),W=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),J=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new Array(576);l(d);const E=new Array(60);l(E);const G=new Array(512);l(G);const a=new Array(256);l(a);const q=new Array(29);l(q);const z=new Array(x);function Y(Z,l,C,B,x){this.static_tree=Z,this.extra_bits=l,this.extra_base=C,this.elems=B,this.max_length=x,this.has_stree=Z&&Z.length}let P,S,i;function s(Z,l){this.dyn_tree=Z,this.max_code=0,this.stat_desc=l}l(z);const F=Z=>Z<256?G[Z]:G[256+(Z>>>7)],n=(Z,l)=>{Z.pending_buf[Z.pending++]=255&l,Z.pending_buf[Z.pending++]=l>>>8&255},c=(Z,l,C)=>{Z.bi_valid>16-C?(Z.bi_buf|=l<<Z.bi_valid&65535,n(Z,Z.bi_buf),Z.bi_buf=l>>16-Z.bi_valid,Z.bi_valid+=C-16):(Z.bi_buf|=l<<Z.bi_valid&65535,Z.bi_valid+=C)},U=(Z,l,C)=>{c(Z,C[2*l],C[2*l+1])},t=(Z,l)=>{let C=0;do{C|=1&Z,Z>>>=1,C<<=1}while(--l>0);return C>>>1},r=(Z,l,C)=>{const B=new Array(16);let x,K,f=0;for(x=1;x<=b;x++)B[x]=f=f+C[x-1]<<1;for(K=0;K<=l;K++){let l=Z[2*K+1];0!==l&&(Z[2*K]=t(B[l]++,l))}},e=Z=>{let l;for(l=0;l<B;l++)Z.dyn_ltree[2*l]=0;for(l=0;l<x;l++)Z.dyn_dtree[2*l]=0;for(l=0;l<19;l++)Z.bl_tree[2*l]=0;Z.dyn_ltree[512]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0},o=Z=>{Z.bi_valid>8?n(Z,Z.bi_buf):Z.bi_valid>0&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0},v=(Z,l,C,B)=>{const x=2*l,b=2*C;return Z[x]<Z[b]||Z[x]===Z[b]&&B[l]<=B[C]},R=(Z,l,C)=>{const B=Z.heap[C];let x=C<<1;for(;x<=Z.heap_len&&(x<Z.heap_len&&v(l,Z.heap[x+1],Z.heap[x],Z.depth)&&x++,!v(l,B,Z.heap[x],Z.depth));)Z.heap[C]=Z.heap[x],C=x,x<<=1;Z.heap[C]=B},k=(Z,l,B)=>{let x,b,W,J,d=0;if(0!==Z.last_lit)do{x=Z.pending_buf[Z.d_buf+2*d]<<8|Z.pending_buf[Z.d_buf+2*d+1],b=Z.pending_buf[Z.l_buf+d],d++,0===x?U(Z,b,l):(W=a[b],U(Z,W+C+1,l),J=K[W],0!==J&&(b-=q[W],c(Z,b,J)),x--,W=F(x),U(Z,W,B),J=f[W],0!==J&&(x-=z[W],c(Z,x,J)))}while(d<Z.last_lit);U(Z,256,l)},V=(Z,l)=>{const C=l.dyn_tree,B=l.stat_desc.static_tree,x=l.stat_desc.has_stree,K=l.stat_desc.elems;let f,W,J,d=-1;for(Z.heap_len=0,Z.heap_max=573,f=0;f<K;f++)0!==C[2*f]?(Z.heap[++Z.heap_len]=d=f,Z.depth[f]=0):C[2*f+1]=0;for(;Z.heap_len<2;)J=Z.heap[++Z.heap_len]=d<2?++d:0,C[2*J]=1,Z.depth[J]=0,Z.opt_len--,x&&(Z.static_len-=B[2*J+1]);for(l.max_code=d,f=Z.heap_len>>1;f>=1;f--)R(Z,C,f);J=K;do{f=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],R(Z,C,1),W=Z.heap[1],Z.heap[--Z.heap_max]=f,Z.heap[--Z.heap_max]=W,C[2*J]=C[2*f]+C[2*W],Z.depth[J]=(Z.depth[f]>=Z.depth[W]?Z.depth[f]:Z.depth[W])+1,C[2*f+1]=C[2*W+1]=J,Z.heap[1]=J++,R(Z,C,1)}while(Z.heap_len>=2);Z.heap[--Z.heap_max]=Z.heap[1],((Z,l)=>{const C=l.dyn_tree,B=l.max_code,x=l.stat_desc.static_tree,K=l.stat_desc.has_stree,f=l.stat_desc.extra_bits,W=l.stat_desc.extra_base,J=l.stat_desc.max_length;let d,E,G,a,q,z,Y=0;for(a=0;a<=b;a++)Z.bl_count[a]=0;for(C[2*Z.heap[Z.heap_max]+1]=0,d=Z.heap_max+1;d<573;d++)E=Z.heap[d],a=C[2*C[2*E+1]+1]+1,a>J&&(a=J,Y++),C[2*E+1]=a,E>B||(Z.bl_count[a]++,q=0,E>=W&&(q=f[E-W]),z=C[2*E],Z.opt_len+=z*(a+q),K&&(Z.static_len+=z*(x[2*E+1]+q)));if(0!==Y){do{for(a=J-1;0===Z.bl_count[a];)a--;Z.bl_count[a]--,Z.bl_count[a+1]+=2,Z.bl_count[J]--,Y-=2}while(Y>0);for(a=J;0!==a;a--)for(E=Z.bl_count[a];0!==E;)G=Z.heap[--d],G>B||(C[2*G+1]!==a&&(Z.opt_len+=(a-C[2*G+1])*C[2*G],C[2*G+1]=a),E--)}})(Z,l),r(C,d,Z.bl_count)},g=(Z,l,C)=>{let B,x,b=-1,K=l[1],f=0,W=7,J=4;for(0===K&&(W=138,J=3),l[2*(C+1)+1]=65535,B=0;B<=C;B++)x=K,K=l[2*(B+1)+1],++f<W&&x===K||(f<J?Z.bl_tree[2*x]+=f:0!==x?(x!==b&&Z.bl_tree[2*x]++,Z.bl_tree[32]++):f<=10?Z.bl_tree[34]++:Z.bl_tree[36]++,f=0,b=x,0===K?(W=138,J=3):x===K?(W=6,J=3):(W=7,J=4))},j=(Z,l,C)=>{let B,x,b=-1,K=l[1],f=0,W=7,J=4;for(0===K&&(W=138,J=3),B=0;B<=C;B++)if(x=K,K=l[2*(B+1)+1],!(++f<W&&x===K)){if(f<J)do{U(Z,x,Z.bl_tree)}while(0!==--f);else 0!==x?(x!==b&&(U(Z,x,Z.bl_tree),f--),U(Z,16,Z.bl_tree),c(Z,f-3,2)):f<=10?(U(Z,17,Z.bl_tree),c(Z,f-3,3)):(U(Z,18,Z.bl_tree),c(Z,f-11,7));f=0,b=x,0===K?(W=138,J=3):x===K?(W=6,J=3):(W=7,J=4)}};let M=!1;const I=(Z,l,C,B)=>{c(Z,0+(B?1:0),3),((Z,l,C,B)=>{o(Z),B&&(n(Z,C),n(Z,~C)),Z.pending_buf.set(Z.window.subarray(l,l+C),Z.pending),Z.pending+=C})(Z,l,C,!0)};Z.exports._tr_init=Z=>{M||((()=>{let Z,l,C,J,s;const F=new Array(16);for(C=0,J=0;J<28;J++)for(q[J]=C,Z=0;Z<1<<K[J];Z++)a[C++]=J;for(a[C-1]=J,s=0,J=0;J<16;J++)for(z[J]=s,Z=0;Z<1<<f[J];Z++)G[s++]=J;for(s>>=7;J<x;J++)for(z[J]=s<<7,Z=0;Z<1<<f[J]-7;Z++)G[256+s++]=J;for(l=0;l<=b;l++)F[l]=0;for(Z=0;Z<=143;)d[2*Z+1]=8,Z++,F[8]++;for(;Z<=255;)d[2*Z+1]=9,Z++,F[9]++;for(;Z<=279;)d[2*Z+1]=7,Z++,F[7]++;for(;Z<=287;)d[2*Z+1]=8,Z++,F[8]++;for(r(d,287,F),Z=0;Z<x;Z++)E[2*Z+1]=5,E[2*Z]=t(Z,5);P=new Y(d,K,257,B,b),S=new Y(E,f,0,x,b),i=new Y(new Array(0),W,0,19,7)})(),M=!0),Z.l_desc=new s(Z.dyn_ltree,P),Z.d_desc=new s(Z.dyn_dtree,S),Z.bl_desc=new s(Z.bl_tree,i),Z.bi_buf=0,Z.bi_valid=0,e(Z)},Z.exports._tr_stored_block=I,Z.exports._tr_flush_block=(Z,l,B,x)=>{let b,K,f=0;Z.level>0?(2===Z.strm.data_type&&(Z.strm.data_type=(Z=>{let l,B=4093624447;for(l=0;l<=31;l++,B>>>=1)if(1&B&&0!==Z.dyn_ltree[2*l])return 0;if(0!==Z.dyn_ltree[18]||0!==Z.dyn_ltree[20]||0!==Z.dyn_ltree[26])return 1;for(l=32;l<C;l++)if(0!==Z.dyn_ltree[2*l])return 1;return 0})(Z)),V(Z,Z.l_desc),V(Z,Z.d_desc),f=(Z=>{let l;for(g(Z,Z.dyn_ltree,Z.l_desc.max_code),g(Z,Z.dyn_dtree,Z.d_desc.max_code),V(Z,Z.bl_desc),l=18;l>=3&&0===Z.bl_tree[2*J[l]+1];l--);return Z.opt_len+=3*(l+1)+5+5+4,l})(Z),b=Z.opt_len+3+7>>>3,K=Z.static_len+3+7>>>3,K<=b&&(b=K)):b=K=B+5,B+4<=b&&-1!==l?I(Z,l,B,x):4===Z.strategy||K===b?(c(Z,2+(x?1:0),3),k(Z,d,E)):(c(Z,4+(x?1:0),3),((Z,l,C,B)=>{let x;for(c(Z,l-257,5),c(Z,C-1,5),c(Z,B-4,4),x=0;x<B;x++)c(Z,Z.bl_tree[2*J[x]+1],3);j(Z,Z.dyn_ltree,l-1),j(Z,Z.dyn_dtree,C-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,f+1),k(Z,Z.dyn_ltree,Z.dyn_dtree)),e(Z),x&&o(Z)},Z.exports._tr_tally=(Z,l,B)=>(Z.pending_buf[Z.d_buf+2*Z.last_lit]=l>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&l,Z.pending_buf[Z.l_buf+Z.last_lit]=255&B,Z.last_lit++,0===l?Z.dyn_ltree[2*B]++:(Z.matches++,l--,Z.dyn_ltree[2*(a[B]+C+1)]++,Z.dyn_dtree[2*F(l)]++),Z.last_lit===Z.lit_bufsize-1),Z.exports._tr_align=Z=>{c(Z,2,3),U(Z,256,d),(Z=>{16===Z.bi_valid?(n(Z,Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0):Z.bi_valid>=8&&(Z.pending_buf[Z.pending++]=255&Z.bi_buf,Z.bi_buf>>=8,Z.bi_valid-=8)})(Z)}},13316:Z=>{"use strict";Z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Jl="",this.state=null,this.data_type=2,this.adler=0}},13207:Z=>{function l(Z,l,C){for(var B=Z.length,x=-1/0,b=1/0,K=0;K<B;K++){var f=(C[0][K]-Z[K])/l[K],W=(C[1][K]-Z[K])/l[K];if(f>W){var J=f;f=W,W=J}if(W<x||f>b)return 1/0;f>x&&(x=f),W<b&&(b=W)}return x>b?1/0:x}Z.exports=function(Z,C,B,x){var b=l(C,B,x);if(b===1/0)Z=null;else{Z=Z||[];for(var K=0;K<C.length;K++)Z[K]=C[K]+B[K]*b}return Z},Z.exports.distance=l},14278:(Z,l,C)=>{"use strict";C.d(l,{b:()=>K});var B=C(32);const x=B.useLayoutEffect;const b=function(Z){var l=(0,B.useRef)(Z);return x((function(){l.current=Z})),l};var K=function(Z){var l=b(Z);(0,B.Kl)((function(){var Z=function(Z){var C;if(null!=l.current&&(C=l.current(Z)),Z.defaultPrevented&&(Z.returnValue=""),"string"===typeof C)return Z.returnValue=C,C};return window.addEventListener("beforeunload",Z),function(){window.removeEventListener("beforeunload",Z)}}),[])}},14238:(Z,l,C)=>{"use strict";var B=C(14244),x=Array.prototype.concat,b=Array.prototype.slice,K=Z.exports=function(Z){for(var l=[],C=0,K=Z.length;C<K;C++){var f=Z[C];B(f)?l=x.call(l,b.call(f)):l.push(f)}return l};K.wrap=function(Z){return function(){return Z(K(arguments))}}},14244:Z=>{Z.exports=function(Z){return!(!Z||"string"===typeof Z)&&(Z instanceof Array||Array.isArray(Z)||Z.length>=0&&(Z.splice instanceof Function||Object.getOwnPropertyDescriptor(Z,Z.length-1)&&"String"!==Z.constructor.name))}},14184:Z=>{"use strict";var l=[],C=[],B=[],x=[],b=[],K=[],f=[],W=[],J=[],d=[],E=[],G=[];Z.exports=function(Z,a,q,z,Y,P){for(var S=f,i=J,s=d,F=G,n=0;n<3;n++)S[n]=+q[n],s[n]=+a.max[n],i[n]=+a.base[n];P||(P=1e-10);var c=function(Z,f,J,d,G,a){var q=l,z=C,Y=B,P=x,S=b,i=K,s=W,F=Math.floor,n=0,c=0,U=0,t=0,r=0;if(e(),0===U)return 0;for(t=R();c<=U;){if(o(t)&&v())return n;t=R()}for(n+=U,r=0;r<3;r++)d[r]+=J[r],G[r]+=J[r];return n;function e(){if(c=0,0!==(U=Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2])))for(var Z=0;Z<3;Z++){var l=J[Z]>=0;P[Z]=l?1:-1;var C=l?G[Z]:d[Z];q[Z]=l?d[Z]:G[Z],z[Z]=k(C,P[Z]),Y[Z]=V(q[Z],P[Z]),s[Z]=J[Z]/U,S[Z]=Math.abs(1/s[Z]);var B=l?z[Z]+1-C:C-z[Z];i[Z]=S[Z]<1/0?S[Z]*B:1/0}}function o(l){for(var C=P[0],B=0===l?z[0]:Y[0],x=z[0]+C,b=P[1],K=1===l?z[1]:Y[1],f=z[1]+b,W=P[2],J=2===l?z[2]:Y[2],d=z[2]+W,E=B;E!=x;E+=C)for(var G=K;G!=f;G+=b)for(var a=J;a!=d;a+=W)if(Z(E,G,a))return!0;return!1}function v(){n+=c;var Z=P[t],l=c/U,C=E;for(r=0;r<3;r++){var B=J[r]*l;d[r]+=B,G[r]+=B,C[r]=J[r]-B}if(Z>0?G[t]=Math.round(G[t]):d[t]=Math.round(d[t]),f(n,t,Z,C))return!0;for(r=0;r<3;r++)J[r]=C[r];return e(),0===U}function R(){var Z=i[0]<i[1]?i[0]<i[2]?0:2:i[1]<i[2]?1:2,l=i[Z]-c;for(c=i[Z],z[Z]+=P[Z],i[Z]+=S[Z],r=0;r<3;r++)q[r]+=l*s[r],Y[r]=V(q[r],P[r]);return Z}function k(Z,l){return F(Z-l*a)}function V(Z,l){return F(Z+l*a)}}(Z,z,S,i,s,P);if(!Y){for(n=0;n<3;n++)F[n]=q[n]>0?s[n]-a.max[n]:i[n]-a.base[n];a.translate(F)}return c}},13223:(Z,l,C)=>{var B=C(13225);function x(Z){for(var l,C,x=0,b=Z.length,K=0;K<Z.length;){for(l=Z[K],C=0;K<b&&Z[K]===l;)++K,++C;x+=B.log2(C)/7|0,x+=B.log2(l>>>0)/7|0,x+=2}return x}l.size=x,l.encode=function(Z,l){l||(l=new Uint8Array(x(Z)));for(var C,B,b=0,K=l.length,f=0;f<Z.length;){for(C=Z[f],B=0;f<Z.length&&Z[f]===C;)++f,++B;for(;b<K&&B>=128;)l[b++]=128+(127&B),B>>>=7;if(b>=K)throw new Error("RLE buffer overflow");for(l[b++]=B,C>>>=0;b<K&&C>=128;)l[b++]=128+(127&C),C>>>=7;if(b>=K)throw new Error("RLE buffer overflow");l[b++]=C}return l},l.decode=function(Z,l){for(var C,B,x,b,K=l.length,f=Z.length,W=0,J=0;J<f;){for(C=0,B=0;J<f&&Z[J]>=128;)C+=(127&Z[J++])<<B,B+=7;if(C+=Z[J++]<<B,J>=f)throw new Error("RLE buffer underrun");if(W+C>K)throw new Error("Chunk buffer overflow");for(x=0,B=0;J<f&&Z[J]>=128;)x+=(127&Z[J++])<<B,B+=7;if(J>=f)throw new Error("RLE buffer underrun");for(x+=Z[J++]<<B,b=0;b<C;++b)l[W++]=x}return l}},13225:(Z,l)=>{"use strict";function C(Z){var l=32;return(Z&=-Z)&&l--,65535&Z&&(l-=16),16711935&Z&&(l-=8),252645135&Z&&(l-=4),858993459&Z&&(l-=2),1431655765&Z&&(l-=1),l}l.INT_BITS=32,l.INT_MAX=2147483647,l.INT_MIN=-1<<31,l.sign=function(Z){return(Z>0)-(Z<0)},l.abs=function(Z){var l=Z>>31;return(Z^l)-l},l.min=function(Z,l){return l^(Z^l)&-(Z<l)},l.max=function(Z,l){return Z^(Z^l)&-(Z<l)},l.isPow2=function(Z){return!(Z&Z-1)&&!!Z},l.log2=function(Z){var l,C;return l=(Z>65535)<<4,l|=C=((Z>>>=l)>255)<<3,l|=C=((Z>>>=C)>15)<<2,(l|=C=((Z>>>=C)>3)<<1)|(Z>>>=C)>>1},l.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},l.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},l.countTrailingZeros=C,l.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},l.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},l.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var B=new Array(256);!function(Z){for(var l=0;l<256;++l){var C=l,B=l,x=7;for(C>>>=1;C;C>>>=1)B<<=1,B|=1&C,--x;Z[l]=B<<x&255}}(B),l.reverse=function(Z){return B[255&Z]<<24|B[Z>>>8&255]<<16|B[Z>>>16&255]<<8|B[Z>>>24&255]},l.interleave2=function(Z,l){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l&=65535)|l<<8))|l<<4))|l<<2))|l<<1))<<1},l.deinterleave2=function(Z,l){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>l&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},l.interleave3=function(Z,l,C){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},l.deinterleave3=function(Z,l){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>l&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},l.nextCombination=function(Z){var l=Z|Z-1;return l+1|(~l&-~l)-1>>>C(Z)+1}},14353:(Z,l,C)=>{"use strict";C.d(l,{e:()=>E});var B=C(14177),x=C(118);class b{constructor(Z,l,C,b,K,f,W){this.Dd=new B(Z.base,Z.fE),this.ix=l,this.friction=C,this.restitution=b,this.uf=K,this.nq=f,this.Qf=!!W,this.KE=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Jz=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.pJ=x.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=x.create(),this._impulses=x.create(),this._sleepFrameCount=10}loadFromCopy(Z){x.j(this.Dd.base,Z.Dd.base),x.j(this.Dd.fE,Z.Dd.fE),x.j(this.Dd.max,Z.Dd.max),this.Dd.mag=Z.Dd.mag,this.ix=Z.ix,this.friction=Z.friction,this.restitution=Z.restitution,this.uf=Z.uf,this.nq=Z.nq,this.Qf=Z.Qf,this.KE=Z.KE,this.fluidDrag=Z.fluidDrag,this.Jz=Z.Jz,this.preventFallOffEdge=Z.preventFallOffEdge,this.rolledBackLastTick=Z.rolledBackLastTick,x.j(this.pJ,Z.pJ),x.j(this.resting,Z.resting),this.inFluid=Z.inFluid,this._ratioInFluid=Z._ratioInFluid,x.j(this._forces,Z._forces),x.j(this._impulses,Z._impulses),this._sleepFrameCount=Z._sleepFrameCount}setPosition(Z){K(Z),x.zl(Z,Z,this.Dd.base),this.Dd.translate(Z),this.ld()}mb(){return x.clone(this.Dd.base)}applyForce(Z){K(Z),x.add(this._forces,this._forces,Z),this.ld()}applyImpulse(Z){K(Z),x.add(this._impulses,this._impulses,Z),this.ld()}ld(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var K=Z=>{};var f=C(14177),W=C(118),J=C(14184);function d(){this.KE=.1,this.fluidDrag=.4,this.ZW=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function E(Z,l,C){Z=Object.assign(new d,Z),this.gravity=Z.gravity||[0,-10,0],this.KE=Z.KE||.1,this.ZW=Z.ZW||2,this.fluidDrag=Z.fluidDrag||.4,this.minBounceImpulse=Z.minBounceImpulse,this.bodies=[],this.Ha=Z.Ha,this.testSolid=l,this.testFluid=C}E.prototype.vq=function(Z,l,C,B,x,K){Z=Z||new f([0,0,0],[1,1,1]),"undefined"==typeof l&&(l=1),"undefined"==typeof C&&(C=1),"undefined"==typeof B&&(B=0),"undefined"==typeof x&&(x=1);var W=new b(Z,l,C,B,x,K);return this.bodies.push(W),W},E.prototype.Rq=function(Z){var l=this.bodies.indexOf(Z);l<0||(this.bodies.splice(l,1),Z.Dd=Z.nq=null)};var G=W.create(),a=W.create(),q=W.create(),z=W.create(),Y=W.create(),P=W.create(),S=W.create(),i=new f([0,0,0],[1,1,1]),s=new b(i,1,1,0,1,(()=>{}),!1);function F(Z,l,C){return l=C,l*=1-(1-Z.ratioInFluid)**2}E.prototype.sW=function(Z){Z/=1e3;var l=w(0,W.squaredLength(this.gravity));this.bodies.forEach((C=>function(Z,l,C,B){W.j(Y,l.resting),Z.Ha&&s.loadFromCopy(l);if(l.ix<=0)return W.set(l.pJ,0,0,0),W.set(l._forces,0,0,0),void W.set(l._impulses,0,0,0);var x=B||0===l.uf;if(function(Z,l,C,B){if(l._sleepFrameCount>0)return!1;if(B)return!0;var x=!1,b=.5*C*C*l.uf;return W.scale(I,Z.gravity,b),J(Z.testSolid,l.Dd,I,(function(){return x=!0,!0}),!0),x}(Z,l,C,x))return;l._sleepFrameCount--,function(Z,l){var C=l.Dd,B=Math.floor(C.base[0]),x=Math.floor(C.base[2]),b=Math.floor(C.base[1]),K=Math.floor(C.max[1]);if(!Z.testFluid(B,b,x))return l.inFluid=!1,void(l.ratioInFluid=0);var f=1,J=b+1;for(;J<=K&&Z.testFluid(B,J,x);)f++,J++;var d=(b+f-C.base[1])/C.fE[1];d>1&&(d=1);var E=C.fE[0]*C.fE[1]*C.fE[2]*d,G=c;W.scale(G,Z.gravity,-Z.ZW*E*l.uf),l.applyForce(G),l.inFluid=!0,l.ratioInFluid=d}(Z,l),D(l._forces),D(l._impulses),D(l.pJ),D(l.resting),W.scale(G,l._forces,1/l.ix),W.GW(G,G,Z.gravity,l.uf),W.scale(a,l._impulses,1/l.ix),W.GW(a,a,G,C),W.add(l.pJ,l.pJ,a),l.friction&&(U(Z,0,l,a,C),U(Z,1,l,a,C),U(Z,2,l,a,C));var b=l.fluidDrag>=0?l.fluidDrag:Z.fluidDrag,K=l.KE>=0?l.KE:Z.KE,f=K,d=K;l.inFluid&&(f=F(l,f,l.fluidDragHoriz>=0?l.fluidDragHoriz:b),d=F(l,d,l.fluidDragVert>=0?l.fluidDragVert:b));f=Math.max(1-f*C/l.ix,0),d=Math.max(1-d*C/l.ix,0),W.set(n,f,d,f),W.multiply(l.pJ,l.pJ,n),W.scale(q,l.pJ,C),W.set(l._forces,0,0,0),W.set(l._impulses,0,0,0),l.Qf&&O(e,l.Dd);W.j(P,q),W.set(S,0,0,0),l.preventFallOffEdge&&function(Z,l,C,B){if(!l.resting[1]||C[1]>0)return;var x=g;O(x,l.Dd);for(var b=0;b<3;b+=2){W.set(V,0,0,0),V[b]=C[b];var K=!0;(K=(K=(K=(K=K&&!M(Z,x.base[0]+V[0]+1e-5,x.base[1],x.base[2]+V[2]+1e-5))&&!M(Z,x.max[0]+V[0]-1e-5,x.base[1],x.base[2]+V[2]+1e-5))&&!M(Z,x.base[0]+V[0]+1e-5,x.base[1],x.max[2]+V[2]-1e-5))&&!M(Z,x.max[0]+V[0]-1e-5,x.base[1],x.max[2]+V[2]-1e-5))?(B[b]=C[b]>0?1:-1,C[b]=0):0===b&&(W.set(j,C[0],0,0),r(Z,x,j,B,l.slideOnCollision))}}(Z,l,q,S);r(Z,l.Dd,q,l.resting,l.slideOnCollision),l.Qf&&function(Z,l,C,B){if(l.resting[1]>=0&&!l.inFluid)return;var x=0!==l.resting[0],b=0!==l.resting[2];if(!x&&!b)return;var K=Math.abs(B[0]/B[2]),f=4;if(!x&&K>f)return;if(!b&&K<1/f)return;W.add(v,C.base,B);var d=Z.testSolid;J(d,C,B,(function(Z,l,C,B){if(1!==l)return!0;B[l]=0}));var E=C.base[1],G=l.inFluid?1.951:1.001,a=Math.floor(E+G)-E;W.set(R,0,a,0);var q=!1;if(J(d,C,R,(function(Z,l,C,B){return q=!0,!0})),q)return;W.zl(k,v,C.base),k[1]=0,r(Z,C,k,o,!0);var z=w(C.base[0],v[0]),Y=w(C.base[2],v[2]);if(x&&!z&&(!Y||!b))return;if(b&&(!z||!x)&&!Y)return;var P=!0;if(P=P&&!M(Z,C.base[0]+1e-5,C.base[1],C.base[2]+1e-5),P=P&&!M(Z,C.max[0]-1e-5,C.base[1],C.base[2]+1e-5),P=P&&!M(Z,C.base[0]+1e-5,C.base[1],C.max[2]-1e-5),P=P&&!M(Z,C.max[0]-1e-5,C.base[1],C.max[2]-1e-5),P)return;O(l.Dd,C),l.resting[0]=o[0],l.resting[2]=o[2],l.Jz&&l.Jz()}(Z,l,e,P);for(var E=0;E<3;++E)l.resting[E]=l.resting[E]||S[E],z[E]=0,l.resting[E]&&(Y[E]||(z[E]=-l.pJ[E]),l.pJ[E]=0);var i=W.length(z);i>.001&&(W.scale(z,z,l.ix),l.nq&&l.nq(z),l.restitution>0&&i>Z.minBounceImpulse&&(W.scale(z,z,l.restitution),l.applyImpulse(z)));var t=W.squaredLength(l.pJ);t>1e-5&&l.ld();Z.Ha&&Z.Ha(l)?(l.loadFromCopy(s),l.rolledBackLastTick=!0):l.rolledBackLastTick=!1}(this,C,Z,l)))};var n=W.create([0,0,0]);var c=W.create();function U(Z,l,C,B,x){var b=C.resting[l],K=B[l];if(!C.alwaysApplyHorizFriction||1!==l){if(0===b)return;if(b*K<=0)return}W.j(t,C.pJ),t[l]=0;var f=W.length(t);if(!w(f,0)){var J=Math.abs(C.friction*Z.gravity[l]*x),d=f>J?(f-J)/f:0;C.pJ[(l+1)%3]*=d,C.pJ[(l+2)%3]*=d}}var t=W.create();function r(Z,l,C,B,x){return W.set(B,0,0,0),J(Z.testSolid,l,C,(function(Z,l,C,b){B[l]=C,b[l]=0,x||(b[0]=0,b[1]=0,b[2]=0)}))}var e=new f([],[]),o=W.create(),v=W.create(),R=W.create(),k=W.create();var V=W.create(),g=new f([],[]),j=W.create();function M(Z,l,C,B){return Z.testSolid(Math.floor(l),Math.floor(C-1),Math.floor(B))}var I=W.create();function w(Z,l){return Math.abs(Z-l)<1e-5}function O(Z,l){for(var C=0;C<3;C++)Z.base[C]=l.base[C],Z.max[C]=l.max[C],Z.fE[C]=l.fE[C]}var D=function(Z){}},13249:Z=>{"use strict";Z.exports=function(Z,l,C,B){var x=self||window;try{try{var b;try{b=new x.Blob([Z])}catch(J){(b=new(x.BlobBuilder||x.WebKitBlobBuilder||x.MozBlobBuilder||x.MSBlobBuilder)).append(Z),b=b.getBlob()}var K=x.URL||x.webkitURL,f=K.createObjectURL(b),W=new x[l](f,C);return K.revokeObjectURL(f),W}catch(J){return new x[l]("data:application/javascript,".concat(encodeURIComponent(Z)),C)}}catch(J){if(!B)throw Error("Inline worker is not supported");return new x[l](B,C)}}},13190:(Z,l,C)=>{"use strict";function B(Z,l,C,B,x){var b={};return Object.keys(B).forEach((function(Z){b[Z]=B[Z]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=C.slice().reverse().reduce((function(C,B){return B(Z,l,C)||C}),b),x&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(x):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(Z,l,b),b=null),b}C.d(l,{d:()=>B})},13187:(Z,l,C)=>{"use strict";function B(Z,l,C,B){C&&Object.defineProperty(Z,l,{enumerable:C.enumerable,configurable:C.configurable,writable:C.writable,value:C.initializer?C.initializer.call(B):void 0})}C.d(l,{b:()=>B})},14272:(Z,l,C)=>{"use strict";C.d(l,{b:()=>K,c:()=>E,d:()=>f,e:()=>b,h:()=>W,i:()=>x,j:()=>J,l:()=>d});var B=C(12680);class x{constructor(){this._easingMode=x.EASINGMODE_EASEIN}setEasingMode(Z){const l=Math.min(Math.max(Z,0),2);this._easingMode=l}getEasingMode(){return this._easingMode}easeInCore(Z){throw new Error("You must implement this method")}ease(Z){switch(this._easingMode){case x.EASINGMODE_EASEIN:return this.easeInCore(Z);case x.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-Z)}return Z>=.5?.5*(1-this.easeInCore(2*(1-Z)))+.5:.5*this.easeInCore(2*Z)}}x.EASINGMODE_EASEIN=0,x.EASINGMODE_EASEOUT=1,x.EASINGMODE_EASEINOUT=2;class b extends x{easeInCore(Z){return Z=Math.max(0,Math.min(1,Z)),1-Math.sqrt(1-Z*Z)}}class K extends x{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=Z}easeInCore(Z){const l=Math.max(0,this.amplitude);return Math.pow(Z,3)-Z*l*Math.sin(3.141592653589793*Z)}}class f extends x{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=Z,this.bounciness=l}easeInCore(Z){const l=Math.max(0,this.bounces);let C=this.bounciness;C<=1&&(C=1.001);const B=Math.pow(C,l),x=1-C,b=(1-B)/x+.5*B,K=Z*b,f=Math.log(-K*(1-C)+1)/Math.log(C),W=Math.floor(f),J=W+1,d=(1-Math.pow(C,W))/(x*b),E=.5*(d+(1-Math.pow(C,J))/(x*b)),G=Z-E,a=E-d;return-Math.pow(1/C,l-W)/(a*a)*(G-a)*(G+a)}}class W extends x{easeInCore(Z){return Z*Z*Z}}class J extends x{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=Z,this.springiness=l}easeInCore(Z){let l;const C=Math.max(0,this.oscillations),B=Math.max(0,this.springiness);return l=0==B?Z:(Math.exp(B*Z)-1)/(Math.exp(B)-1),l*Math.sin((6.283185307179586*C+1.5707963267948966)*Z)}}class d extends x{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=Z}easeInCore(Z){return this.exponent<=0?Z:(Math.exp(this.exponent*Z)-1)/(Math.exp(this.exponent)-1)}}class E extends x{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=Z,this.y1=l,this.x2=C,this.y2=B}easeInCore(Z){return B.e.Interpolate(Z,this.x1,this.y1,this.x2,this.y2)}}},13765:(Z,l,C)=>{"use strict";C.d(l,{e:()=>K});var B=C(12442),x=C(12456),b=C(12850);class K extends b.d{get _matrix(){return this._compose(),this.oa}set _matrix(Z){(Z.updateFlag!==this.oa.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.oa.B(Z),this._markAsDirtyAndDecompose())}constructor(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(Z,l.cZ(),!1),this.name=Z,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=l,this.oa=(null===x||void 0===x?void 0:x.clone())??B.Matrix.Identity(),this._restMatrix=b??this.oa.clone(),this._bindMatrix=K??this.oa.clone(),this._index=f,this._absoluteMatrix=new B.Matrix,this._absoluteBindMatrix=new B.Matrix,this._absoluteInverseBindMatrix=new B.Matrix,this._finalMatrix=new B.Matrix,l.bones.push(this),this.setParent(C,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(Z){this.setParent(Z)}setParent(Z){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==Z){if(this.parent){const Z=this.parent.children.indexOf(this);-1!==Z&&this.parent.children.splice(Z,1)}this._parentNode=Z,this.parent&&this.parent.children.push(this),l&&this._updateAbsoluteBindMatrices(),this.mE()}}getLocalMatrix(){return this._compose(),this.oa}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(Z){this._restMatrix.B(Z)}setRestPose(Z){this.setRestMatrix(Z)}getBindPose(){return this.getBindMatrix()}setBindMatrix(Z){this.sb(Z)}setBindPose(Z){this.setBindMatrix(Z)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const Z=B.TmpVectors.ql[0],l=B.TmpVectors.Quaternion[0],C=B.TmpVectors.ql[1];this.getRestMatrix().decompose(Z,l,C),this._linkedTransformNode.position.B(C),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??B.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.B(l),this._linkedTransformNode.eb.B(Z)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(Z){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=Z,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.jW}set position(Z){this._decompose(),this.jW.B(Z),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(Z){this.setRotation(Z)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(Z){this.setRotationQuaternion(Z)}get eb(){return this.getScale()}set eb(Z){this.setScale(Z)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=B.ql.Zero(),this._localRotation=B.Quaternion.Zero(),this.jW=B.ql.Zero()),this.oa.decompose(this._localScaling,this._localRotation,this.jW))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,B.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.jW,this.oa)):this._needToCompose=!1)}sb(Z){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.B(Z),l&&this._updateAbsoluteBindMatrices(),C?this._matrix=Z:this.mE()}_updateAbsoluteBindMatrices(Z){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Z||(Z=this._bindMatrix),this.parent?Z.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.B(Z),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),l)for(let C=0;C<this.children.length;C++)this.children[C]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}mE(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.mE(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.mE(),this._needToDecompose=!0}_updatePosition(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const b=this.getLocalMatrix();if(0==l)x?(b.addAtIndex(12,Z.x),b.addAtIndex(13,Z.y),b.addAtIndex(14,Z.z)):b.setTranslationFromFloats(Z.x,Z.y,Z.z);else{let l=null;C&&(l=C.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const f=K._TmpMats[0],W=K._TmpVecs[0];this.parent?C&&l?(f.B(this.parent.getAbsoluteMatrix()),f.multiplyToRef(l,f)):f.B(this.parent.getAbsoluteMatrix()):B.Matrix.IdentityToRef(f),x&&f.setTranslationFromFloats(0,0,0),f.invert(),B.ql.TransformCoordinatesToRef(Z,f,W),x?(b.addAtIndex(12,W.x),b.addAtIndex(13,W.y),b.addAtIndex(14,W.z)):b.setTranslationFromFloats(W.x,W.y,W.z)}this._markAsDirtyAndDecompose()}translate(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(Z,l,C,!0)}setPosition(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(Z,l,C,!1)}setAbsolutePosition(Z,l){this.setPosition(Z,1,l)}scale(Z,l,C){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const b=this.getLocalMatrix(),f=K._TmpMats[0];B.Matrix.ScalingToRef(Z,l,C,f),f.multiplyToRef(b,b),f.invert();for(const B of this.children){const x=B.getLocalMatrix();x.multiplyToRef(f,x),x.multiplyAtIndex(12,Z),x.multiplyAtIndex(13,l),x.multiplyAtIndex(14,C),B._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),x)for(const B of this.children)B.scale(Z,l,C,x)}setScale(Z){this._decompose(),this._localScaling.B(Z),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(Z){this._decompose(),Z.B(this._localScaling)}setYawPitchRoll(Z,l,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4?arguments[4]:void 0;if(0===x){const f=K._TmpQuat;return B.Quaternion.RotationYawPitchRollToRef(Z,l,C,f),void this.setRotationQuaternion(f,x,b)}const f=K._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(f,b))return;const W=K._TmpMats[1];B.Matrix.RotationYawPitchRollToRef(Z,l,C,W),f.multiplyToRef(W,W),this._rotateWithMatrix(W,x,b)}rotate(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3?arguments[3]:void 0;const b=K._TmpMats[0];b.setTranslationFromFloats(0,0,0),B.Matrix.RotationAxisToRef(Z,l,b),this._rotateWithMatrix(b,C,x)}setAxisAngle(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3?arguments[3]:void 0;if(0===C){const b=K._TmpQuat;return B.Quaternion.RotationAxisToRef(Z,l,b),void this.setRotationQuaternion(b,C,x)}const b=K._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(b,x))return;const f=K._TmpMats[1];B.Matrix.RotationAxisToRef(Z,l,f),b.multiplyToRef(f,f),this._rotateWithMatrix(f,C,x)}setRotation(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(Z.y,Z.x,Z.z,l,C)}setRotationQuaternion(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===l)return this._decompose(),this._localRotation.B(Z),void this._markAsDirtyAndCompose();const x=K._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(x,C))return;const b=K._TmpMats[1];B.Matrix.FromQuaternionToRef(Z,b),x.multiplyToRef(b,b),this._rotateWithMatrix(b,l,C)}setRotationMatrix(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===l){const x=K._TmpQuat;return B.Quaternion.FromRotationMatrixToRef(Z,x),void this.setRotationQuaternion(x,l,C)}const x=K._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(x,C))return;const b=K._TmpMats[1];b.B(Z),x.multiplyToRef(Z,b),this._rotateWithMatrix(b,l,C)}_rotateWithMatrix(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const B=this.getLocalMatrix(),x=B.m[12],b=B.m[13],f=B.m[14],W=this.getParent(),J=K._TmpMats[3],d=K._TmpMats[4];W&&1==l?(C?(J.B(C.getWorldMatrix()),W.getAbsoluteMatrix().multiplyToRef(J,J)):J.B(W.getAbsoluteMatrix()),d.B(J),d.invert(),B.multiplyToRef(J,B),B.multiplyToRef(Z,B),B.multiplyToRef(d,B)):1==l&&C?(J.B(C.getWorldMatrix()),d.B(J),d.invert(),B.multiplyToRef(J,B),B.multiplyToRef(Z,B),B.multiplyToRef(d,B)):B.multiplyToRef(Z,B),B.setTranslationFromFloats(x,b,f),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(Z,l){const C=K._TmpMats[2];return Z.B(this.getAbsoluteMatrix()),l?(Z.multiplyToRef(l.getWorldMatrix(),Z),B.Matrix.ScalingToRef(l.eb.x,l.eb.y,l.eb.z,C)):B.Matrix.IdentityToRef(C),Z.invert(),!isNaN(Z.m[0])&&(C.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyToRef(C,Z),!0)}mb(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=B.ql.Zero();return this.getPositionToRef(Z,l,C),C}getPositionToRef(){let Z=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const Z=this.getLocalMatrix();l.x=Z.m[12],l.y=Z.m[13],l.z=Z.m[14]}else{let C=null;Z&&(C=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let B=K._TmpMats[0];Z&&C?(B.B(this.getAbsoluteMatrix()),B.multiplyToRef(C,B)):B=this.getAbsoluteMatrix(),l.x=B.m[12],l.y=B.m[13],l.z=B.m[14]}}getAbsolutePosition(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const l=B.ql.Zero();return this.getPositionToRef(1,Z,l),l}getAbsolutePositionToRef(Z,l){this.getPositionToRef(1,Z,l)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.oa.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.B(this.oa);const Z=this._skeleton.getPoseMatrix();Z&&this._absoluteMatrix.multiplyToRef(Z,this._absoluteMatrix)}const Z=this.children,l=Z.length;for(let C=0;C<l;C++)Z[C].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}JJ(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=B.ql.Zero();return this.getDirectionToRef(Z,l,C),C}getDirectionToRef(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,x=null;l&&(x=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=K._TmpMats[0];b.B(this.getAbsoluteMatrix()),l&&x&&b.multiplyToRef(x,b),B.ql.TransformNormalToRef(Z,b,C),C.normalize()}getRotation(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=B.ql.Zero();return this.getRotationToRef(Z,l,C),C}getRotationToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;const B=K._TmpQuat;this.getRotationQuaternionToRef(Z,l,B),B.toEulerAnglesToRef(C)}getRotationQuaternion(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=B.Quaternion.Identity();return this.getRotationQuaternionToRef(Z,l,C),C}getRotationQuaternionToRef(){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),l.B(this._localRotation);else{const C=K._TmpMats[0],B=this.getAbsoluteMatrix();Z?B.multiplyToRef(Z.getWorldMatrix(),C):C.B(B),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.decompose(void 0,l,void 0)}}getRotationMatrix(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1?arguments[1]:void 0;const C=B.Matrix.Identity();return this.getRotationMatrixToRef(Z,l,C),C}getRotationMatrixToRef(){let Z=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(l);else{const C=K._TmpMats[0],B=this.getAbsoluteMatrix();Z?B.multiplyToRef(Z.getWorldMatrix(),C):C.B(B),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.getRotationMatrixToRef(l)}}getAbsolutePositionFromLocal(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=B.ql.Zero();return this.getAbsolutePositionFromLocalToRef(Z,l,C),C}getAbsolutePositionFromLocalToRef(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,x=null;l&&(x=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=K._TmpMats[0];b.B(this.getAbsoluteMatrix()),l&&x&&b.multiplyToRef(x,b),B.ql.TransformCoordinatesToRef(Z,b,C)}getLocalPositionFromAbsolute(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=B.ql.Zero();return this.getLocalPositionFromAbsoluteToRef(Z,l,C),C}getLocalPositionFromAbsoluteToRef(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,x=null;l&&(x=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=K._TmpMats[0];b.B(this.getAbsoluteMatrix()),l&&x&&b.multiplyToRef(x,b),b.invert(),B.ql.TransformCoordinatesToRef(Z,b,C)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const Z=this._skeleton.bones.indexOf(this);if(-1!==Z&&this._skeleton.bones.splice(Z,1),this._parentNode&&this._parentNode.children){const Z=this._parentNode.children,l=Z.indexOf(this);-1!==l&&Z.splice(l,1)}super.dispose()}}K._TmpVecs=(0,x.b)(2,B.ql.Zero),K._TmpQuat=B.Quaternion.Identity(),K._TmpMats=(0,x.b)(5,B.Matrix.Identity)},14266:(Z,l,C)=>{"use strict";C.d(l,{e:()=>V});var B=C(12428),x=C(12432),b=C(12251),K=C(12442),f=C(12460),W=C(12850),J=C(12874),d=C(12739),E=C(12275),G=C(12451);class a{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(Z){this._zoomStopsAnimation=Z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(Z){this._idleRotationSpeed=Z}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(Z){this._idleRotationWaitTime=Z}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(Z){this._idleRotationSpinupTime=Z}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(Z){this._attachedCamera=Z;const l=this._attachedCamera.cZ();this._onPrePointerObservableObserver=l.onPrePointerObservable.add((Z=>{Z.type!==d.d.POINTERDOWN?Z.type===d.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const Z=E.d.Now;let l=0;null!=this._lastFrameTime&&(l=Z-this._lastFrameTime),this._lastFrameTime=Z,this._applyUserInteraction();const C=Z-this._lastInteractionTime-this._idleRotationWaitTime,B=Math.max(Math.min(C/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*B,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(l/1e3))}))}detach(){if(!this._attachedCamera)return;const Z=this._attachedCamera.cZ();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(Z){this._lastInteractionTime=Z??E.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<G.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let Z=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(Z=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?Z:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=E.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var q=C(14272),z=C(12942);class Y{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(Z){if(this._autoTransitionRange===Z)return;this._autoTransitionRange=Z;const l=this._attachedCamera;l&&(Z?this._onMeshTargetChangedObserver=l.onMeshTargetChangedObservable.add((Z=>{if(Z&&(Z.Fb(!0),Z.getBoundingInfo)){const l=Z.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*l,this.upperRadiusTransitionRange=.05*l}})):this._onMeshTargetChangedObserver&&l.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(Z){this._attachedCamera=Z,this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(Z){return!!this._attachedCamera&&(this._attachedCamera.radius===Z&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(Z){if(!this._attachedCamera)return;this._radiusBounceTransition||(Y.EasingFunction.setEasingMode(Y.EasingMode),this._radiusBounceTransition=z.b.CreateAnimation("radius",z.b.ANIMATIONTYPE_FLOAT,60,Y.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const l=z.b.TransitionTo("radius",this._attachedCamera.radius+Z,this._attachedCamera,this._attachedCamera.cZ(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));l&&this._animatables.push(l)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}Y.EasingFunction=new q.b(.3),Y.EasingMode=q.i.EASINGMODE_EASEOUT;class P{constructor(){this.onTargetFramingAnimationEndObservable=new b.b,this._mode=P.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(Z){this._mode=Z}get mode(){return this._mode}set radiusScale(Z){this._radiusScale=Z}get radiusScale(){return this._radiusScale}set positionScale(Z){this._positionScale=Z}get positionScale(){return this._positionScale}set defaultElevation(Z){this._defaultElevation=Z}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(Z){this._elevationReturnTime=Z}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(Z){this._elevationReturnWaitTime=Z}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(Z){this._zoomStopsAnimation=Z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(Z){this._framingTime=Z}get framingTime(){return this._framingTime}init(){}attach(Z){this._attachedCamera=Z;const l=this._attachedCamera.cZ();P.EasingFunction.setEasingMode(P.EasingMode),this._onPrePointerObservableObserver=l.onPrePointerObservable.add((Z=>{Z.type!==d.d.POINTERDOWN?Z.type===d.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=Z.onMeshTargetChangedObservable.add((Z=>{Z&&Z.getBoundingInfo&&this.zoomOnMesh(Z,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const Z=this._attachedCamera.cZ();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.Fb(!0);const B=Z.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(B.minimumWorld,B.maximumWorld,l,C)}zoomOnMeshHierarchy(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.Fb(!0);const B=Z.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(B.min,B.max,l,C)}zoomOnMeshesHierarchy(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new K.ql(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new K.ql(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let b=0;b<Z.length;b++){const l=Z[b].getHierarchyBoundingVectors(!0);K.ql.CheckExtends(l.min,B,x),K.ql.CheckExtends(l.max,B,x)}this.zoomOnBoundingInfo(B,x,l,C)}zoomOnBoundingInfo(Z,l){let C,B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const b=Z.y,f=b+(l.y-b)*this._positionScale,W=l.zl(Z).scale(.5);if(!isFinite(f))return!1;if(B)C=new K.ql(0,f,0);else{const l=Z.add(W);C=new K.ql(l.x,f,l.z)}this._vectorTransition||(this._vectorTransition=z.b.CreateAnimation("target",z.b.ANIMATIONTYPE_VECTOR3,60,P.EasingFunction)),this._betaIsAnimating=!0;let J=z.b.TransitionTo("target",C,this._attachedCamera,this._attachedCamera.cZ(),60,this._vectorTransition,this._framingTime);J&&this._animatables.push(J);let d=0;if(this._mode===P.FitFrustumSidesMode){const C=this._calculateLowerRadiusFromModelBoundingSphere(Z,l);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=W.length()+this._attachedCamera.ib),d=C}else this._mode===P.IgnoreBoundsSizeMode&&(d=this._calculateLowerRadiusFromModelBoundingSphere(Z,l),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ib));if(this.autoCorrectCameraLimitsAndSensibility){const C=l.zl(Z).length();this._attachedCamera.panningSensibility=5e3/C,this._attachedCamera.wheelPrecision=100/d}return this._radiusTransition||(this._radiusTransition=z.b.CreateAnimation("radius",z.b.ANIMATIONTYPE_FLOAT,60,P.EasingFunction)),J=z.b.TransitionTo("radius",d,this._attachedCamera,this._attachedCamera.cZ(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),x&&x(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),J&&this._animatables.push(J),!0}_calculateLowerRadiusFromModelBoundingSphere(Z,l){const C=this._attachedCamera;if(!C)return 0;let B=C._calculateLowerRadiusFromModelBoundingSphere(Z,l,this._radiusScale);return C.lowerRadiusLimit&&this._mode===P.IgnoreBoundsSizeMode&&(B=B<C.lowerRadiusLimit?C.lowerRadiusLimit:B),C.upperRadiusLimit&&(B=B>C.upperRadiusLimit?C.upperRadiusLimit:B),B}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const Z=E.d.Now-this._lastInteractionTime,l=.5*Math.PI-this._defaultElevation,C=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>C&&Z>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=z.b.CreateAnimation("beta",z.b.ANIMATIONTYPE_FLOAT,60,P.EasingFunction));const Z=z.b.TransitionTo("beta",l,this._attachedCamera,this._attachedCamera.cZ(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));Z&&this._animatables.push(Z)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=E.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}P.EasingFunction=new q.l,P.EasingMode=q.i.EASINGMODE_EASEINOUT,P.IgnoreBoundsSizeMode=0,P.FitFrustumSidesMode=1;var S=C(12880),i=C(12912),s=C(13760),F=C(12248);class n{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(Z){Z=F.Tools.BackCompatCameraNoPreventDefault(arguments);const l=this.camera.getEngine(),C=l.getInputElement();let B=0,x=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=b=>{var K,f;const W=b.event,J="touch"===W.pointerType;if(b.type!==d.d.POINTERMOVE&&-1===this.buttons.indexOf(W.button))return;const E=W.target;if(this._altKey=W.altKey,this._ctrlKey=W.ctrlKey,this._metaKey=W.metaKey,this._shiftKey=W.shiftKey,this._buttonsPressed=W.buttons,l.isPointerLock){const Z=W.movementX,l=W.movementY;this.onTouch(null,Z,l),this._pointA=null,this._pointB=null}else{if(b.type!==d.d.POINTERDOWN&&b.type!==d.d.POINTERDOUBLETAP&&J&&(null===(K=this._pointA)||void 0===K?void 0:K.pointerId)!==W.pointerId&&(null===(f=this._pointB)||void 0===f?void 0:f.pointerId)!==W.pointerId)return;if(b.type!==d.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!J)if(b.type===d.d.POINTERDOUBLETAP)this.onDoubleTap(W.pointerType);else if(b.type!==d.d.POINTERUP||this._currentMousePointerIdDown!==W.pointerId&&!J){if(b.type===d.d.POINTERMOVE)if(Z||W.preventDefault(),this._pointA&&null===this._pointB){const Z=W.clientX-this._pointA.x,l=W.clientY-this._pointA.y;this._pointA.x=W.clientX,this._pointA.y=W.clientY,this.onTouch(this._pointA,Z,l)}else if(this._pointA&&this._pointB){const Z=this._pointA.pointerId===W.pointerId?this._pointA:this._pointB;Z.x=W.clientX,Z.y=W.clientY;const l=this._pointA.x-this._pointB.x,C=this._pointA.y-this._pointB.y,K=l*l+C*C,f={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:W.pointerId,type:b.type};this.onMultiTouch(this._pointA,this._pointB,B,K,x,f),x=f,B=K}}else{try{null===E||void 0===E||E.releasePointerCapture(W.pointerId)}catch(G){}J||(this._pointB=null),l._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==W.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==W.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==B||x)&&(this.onMultiTouch(this._pointA,this._pointB,B,0,x,null),B=0,x=null),this._currentMousePointerIdDown=-1,this.onButtonUp(W),Z||W.preventDefault()}else{try{null===E||void 0===E||E.setPointerCapture(W.pointerId)}catch(G){}if(null===this._pointA)this._pointA={x:W.clientX,y:W.clientY,pointerId:W.pointerId,type:W.pointerType};else{if(null!==this._pointB)return;this._pointB={x:W.clientX,y:W.clientY,pointerId:W.pointerId,type:W.pointerType}}-1!==this._currentMousePointerIdDown||J||(this._currentMousePointerIdDown=W.pointerId),this.onButtonDown(W),Z||(W.preventDefault(),C&&C.focus())}}},this._observer=this.camera.cZ()._inputManager._addCameraPointerObserver(this._pointerInput,d.d.POINTERDOWN|d.d.POINTERUP|d.d.POINTERMOVE|d.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,B=0,x=null,this.onLostFocus()},this._contextMenuBind=Z=>this.onContextMenu(Z),C&&C.addEventListener("contextmenu",this._contextMenuBind,!1);const b=this.camera.cZ().getEngine().getHostWindow();b&&F.Tools.RegisterTopRootEvents(b,[{name:"blur",handler:this._onLostFocus}])}DG(){if(this._onLostFocus){const Z=this.camera.cZ().getEngine().getHostWindow();Z&&F.Tools.UnregisterTopRootEvents(Z,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.cZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const Z=this.camera.cZ().getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(Z){}onTouch(Z,l,C){}onMultiTouch(Z,l,C,B,x,b){}onContextMenu(Z){Z.preventDefault()}onButtonDown(Z){}onButtonUp(Z){}onLostFocus(){}}(0,B.b)([(0,x.R)()],n.prototype,"buttons",void 0);class c extends n{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(Z,l){if(0!==this.panningSensibility&&Z&&l){const C=l.x-Z.x,B=l.y-Z.y;this.camera.inertialPanningX+=-C/this.panningSensibility,this.camera.inertialPanningY+=B/this.panningSensibility}}_computePinchZoom(Z,l){const C=this.camera.radius||c.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=C*Math.sqrt(Z)/Math.sqrt(l):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(l-Z)*C*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(l-Z)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(Z,l,C){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-l/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility):(this.camera.inertialAlphaOffset-=l/this.angularSensibilityX,this.camera.inertialBetaOffset-=C/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(Z,l,C,B,x,b){0===C&&null===x||0===B&&null===b||(this.multiTouchPanAndZoom?(this._computePinchZoom(C,B),this._computeMultiTouchPanning(x,b)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(B)-Math.sqrt(C))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(C,B),this._isPinching=!0):this._computeMultiTouchPanning(x,b)):this.multiTouchPanning?this._computeMultiTouchPanning(x,b):this.pinchZoom&&this._computePinchZoom(C,B))}onButtonDown(Z){this._isPanClick=Z.button===this.camera._panningMouseButton}onButtonUp(Z){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}c.MinimumRadiusForPinch=.001,(0,B.b)([(0,x.R)()],c.prototype,"buttons",void 0),(0,B.b)([(0,x.R)()],c.prototype,"angularSensibilityX",void 0),(0,B.b)([(0,x.R)()],c.prototype,"angularSensibilityY",void 0),(0,B.b)([(0,x.R)()],c.prototype,"pinchPrecision",void 0),(0,B.b)([(0,x.R)()],c.prototype,"pinchDeltaPercentage",void 0),(0,B.b)([(0,x.R)()],c.prototype,"useNaturalPinchZoom",void 0),(0,B.b)([(0,x.R)()],c.prototype,"pinchZoom",void 0),(0,B.b)([(0,x.R)()],c.prototype,"panningSensibility",void 0),(0,B.b)([(0,x.R)()],c.prototype,"multiTouchPanning",void 0),(0,B.b)([(0,x.R)()],c.prototype,"multiTouchPanAndZoom",void 0),s.b.ArcRotateCameraPointersInput=c;var U=C(12741);class t{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(Z){Z=F.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.cZ(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((l=>{const C=l.event;if(!C.metaKey)if(l.type===U.b.KEYDOWN){if(this._ctrlPressed=C.ctrlKey,this._altPressed=C.altKey,-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),C.preventDefault&&(Z||C.preventDefault())}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){const l=this._keys.indexOf(C.keyCode);l>=0&&this._keys.splice(l,1),C.preventDefault&&(Z||C.preventDefault())}})))}DG(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Z=this.camera;for(let l=0;l<this._keys.length;l++){const C=this._keys[l];-1!==this.keysLeft.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX-=1/this.panningSensibility:Z.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset+=1/this.zoomingSensibility:Z.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX+=1/this.panningSensibility:Z.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset-=1/this.zoomingSensibility:Z.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(C)&&Z.useInputToRestoreState&&Z.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,B.b)([(0,x.R)()],t.prototype,"keysUp",void 0),(0,B.b)([(0,x.R)()],t.prototype,"keysDown",void 0),(0,B.b)([(0,x.R)()],t.prototype,"keysLeft",void 0),(0,B.b)([(0,x.R)()],t.prototype,"keysRight",void 0),(0,B.b)([(0,x.R)()],t.prototype,"keysReset",void 0),(0,B.b)([(0,x.R)()],t.prototype,"panningSensibility",void 0),(0,B.b)([(0,x.R)()],t.prototype,"zoomingSensibility",void 0),(0,B.b)([(0,x.R)()],t.prototype,"useAltToZoom",void 0),(0,B.b)([(0,x.R)()],t.prototype,"angularSpeed",void 0),s.b.ArcRotateCameraKeyboardMoveInput=t;var r=C(12503),e=C(12749);class o{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new K.ql(0,0,0),this._globalOffset=new K.ql(0,0,0),this._inertialPanning=K.ql.Zero()}_computeDeltaFromMouseWheelLegacyEvent(Z,l){let C=0;const B=.01*Z*this.wheelDeltaPercentage*l;return C=Z>0?B/(1+this.wheelDeltaPercentage):B*(1+this.wheelDeltaPercentage),C}attachControl(Z){Z=F.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=l=>{if(l.type!==d.d.POINTERWHEEL)return;const C=l.event;let B=0;const x=C.deltaMode===e.c.DOM_DELTA_LINE?40:1,b=-C.deltaY*x;if(this.customComputeDeltaFromMouseWheel)B=this.customComputeDeltaFromMouseWheel(b,this,C);else if(this.wheelDeltaPercentage){if(B=this._computeDeltaFromMouseWheelLegacyEvent(b,this.camera.radius),B>0){let Z=this.camera.radius,l=this.camera.inertialRadiusOffset+B;for(let C=0;C<20&&!(Z<=l)&&!(Math.abs(l*this.camera.inertia)<.001);C++)Z-=l,l*=this.camera.inertia;Z=(0,f.Clamp)(Z,0,Number.MAX_VALUE),B=this._computeDeltaFromMouseWheelLegacyEvent(b,Z)}}else B=b/(40*this.wheelPrecision);B&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(B)):this.camera.inertialRadiusOffset+=B),C.preventDefault&&(Z||C.preventDefault())},this._observer=this.camera.cZ()._inputManager._addCameraPointerObserver(this._wheel,d.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ob(0)}DG(){this._observer&&(this.camera.cZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const Z=this.camera;0+Z.inertialAlphaOffset+Z.inertialBetaOffset+Z.inertialRadiusOffset&&(this._updateHitPlane(),Z.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(Z.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const Z=this.camera,l=Z.target.zl(Z.position);this._hitPlane=r.e.FromPositionAndNormal(Z.target,l)}_getPosition(){const Z=this.camera,l=Z.cZ(),C=l.createPickingRay(l.pointerX,l.pointerY,K.Matrix.Identity(),Z,!1);0===Z.targetScreenOffset.x&&0===Z.targetScreenOffset.y||(this._viewOffset.set(Z.targetScreenOffset.x,Z.targetScreenOffset.y,0),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),this._globalOffset=K.ql.TransformNormal(this._viewOffset,Z._cameraTransformMatrix),C.origin.addInPlace(this._globalOffset));let B=0;return this._hitPlane&&(B=C.intersectsPlane(this._hitPlane)??0),C.origin.addInPlace(C.direction.scaleInPlace(B))}_zoomToMouse(Z){const l=this.camera,C=1-l.inertia;if(l.lowerRadiusLimit){const B=l.lowerRadiusLimit??0;l.radius-(l.inertialRadiusOffset+Z)/C<B&&(Z=(l.radius-B)*C-l.inertialRadiusOffset)}if(l.upperRadiusLimit){const B=l.upperRadiusLimit??0;l.radius-(l.inertialRadiusOffset+Z)/C>B&&(Z=(l.radius-B)*C-l.inertialRadiusOffset)}const B=Z/C/l.radius,x=this._getPosition(),b=K.TmpVectors.ql[6];x.subtractToRef(l.target,b),b.scaleInPlace(B),b.scaleInPlace(C),this._inertialPanning.addInPlace(b),l.inertialRadiusOffset+=Z}_zeroIfClose(Z){Math.abs(Z.x)<G.e&&(Z.x=0),Math.abs(Z.y)<G.e&&(Z.y=0),Math.abs(Z.z)<G.e&&(Z.z=0)}}(0,B.b)([(0,x.R)()],o.prototype,"wheelPrecision",void 0),(0,B.b)([(0,x.R)()],o.prototype,"zoomToMouseLocation",void 0),(0,B.b)([(0,x.R)()],o.prototype,"wheelDeltaPercentage",void 0),s.b.ArcRotateCameraMouseWheelInput=o;class v extends s.e{constructor(Z){super(Z)}addMouseWheel(){return this.add(new o),this}addPointers(){return this.add(new c),this}addKeyboard(){return this.add(new t),this}}var R=C(12400);function k(Z,l){return isNaN(Z)?l:Z}W.d.AddNodeConstructor("ArcRotateCamera",((Z,l)=>()=>new V(Z,0,0,1,K.ql.Zero(),l)));class V extends i.b{get target(){return this._target}set target(Z){this.setTarget(Z)}get targetHost(){return this._targetHost}set targetHost(Z){Z&&this.setTarget(Z)}getTarget(){return this.target}get position(){return this._position}set position(Z){this.setPosition(Z)}set upVector(Z){this._upToYMatrix||(this._yToUpMatrix=new K.Matrix,this._upToYMatrix=new K.Matrix,this._upVector=K.ql.Zero()),Z.normalize(),this._upVector.B(Z),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){K.Matrix.RotationAlignToRef(K.ql.UpReadOnly,this._upVector,this._yToUpMatrix),K.Matrix.RotationAlignToRef(this._upVector,K.ql.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityX:0}set angularSensibilityX(Z){const l=this.inputs.attached.pointers;l&&(l.angularSensibilityX=Z)}get angularSensibilityY(){const Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityY:0}set angularSensibilityY(Z){const l=this.inputs.attached.pointers;l&&(l.angularSensibilityY=Z)}get pinchPrecision(){const Z=this.inputs.attached.pointers;return Z?Z.pinchPrecision:0}set pinchPrecision(Z){const l=this.inputs.attached.pointers;l&&(l.pinchPrecision=Z)}get pinchDeltaPercentage(){const Z=this.inputs.attached.pointers;return Z?Z.pinchDeltaPercentage:0}set pinchDeltaPercentage(Z){const l=this.inputs.attached.pointers;l&&(l.pinchDeltaPercentage=Z)}get useNaturalPinchZoom(){const Z=this.inputs.attached.pointers;return!!Z&&Z.useNaturalPinchZoom}set useNaturalPinchZoom(Z){const l=this.inputs.attached.pointers;l&&(l.useNaturalPinchZoom=Z)}get panningSensibility(){const Z=this.inputs.attached.pointers;return Z?Z.panningSensibility:0}set panningSensibility(Z){const l=this.inputs.attached.pointers;l&&(l.panningSensibility=Z)}get keysUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]}set keysUp(Z){const l=this.inputs.attached.keyboard;l&&(l.keysUp=Z)}get keysDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]}set keysDown(Z){const l=this.inputs.attached.keyboard;l&&(l.keysDown=Z)}get keysLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]}set keysLeft(Z){const l=this.inputs.attached.keyboard;l&&(l.keysLeft=Z)}get keysRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]}set keysRight(Z){const l=this.inputs.attached.keyboard;l&&(l.keysRight=Z)}get wheelPrecision(){const Z=this.inputs.attached.mousewheel;return Z?Z.wheelPrecision:0}set wheelPrecision(Z){const l=this.inputs.attached.mousewheel;l&&(l.wheelPrecision=Z)}get zoomToMouseLocation(){const Z=this.inputs.attached.mousewheel;return!!Z&&Z.zoomToMouseLocation}set zoomToMouseLocation(Z){const l=this.inputs.attached.mousewheel;l&&(l.zoomToMouseLocation=Z)}get wheelDeltaPercentage(){const Z=this.inputs.attached.mousewheel;return Z?Z.wheelDeltaPercentage:0}set wheelDeltaPercentage(Z){const l=this.inputs.attached.mousewheel;l&&(l.wheelDeltaPercentage=Z)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(Z){Z!==this.useBouncingBehavior&&(Z?(this._bouncingBehavior=new Y,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(Z){Z!==this.useFramingBehavior&&(Z?(this._framingBehavior=new P,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(Z){Z!==this.useAutoRotationBehavior&&(Z?(this._autoRotationBehavior=new a,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(Z,l,C,B,x,f){var W;let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(Z,K.ql.Zero(),f,J),W=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=K.ql.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=K.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new K.Matrix,this.panningAxis=new K.ql(1,1,0),this._transformedDirection=new K.ql,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new b.b,this.checkCollisions=!1,this.collisionRadius=new K.ql(.5,.5,.5),this._previousPosition=K.ql.Zero(),this._collisionVelocity=K.ql.Zero(),this._newPosition=K.ql.Zero(),this._computationVector=K.ql.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new K.ql(NaN,NaN,NaN),this._goalTargetScreenOffset=new K.Vector2(NaN,NaN),this._onCollisionPositionChange=function(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C?(W.setPosition(l),W.nq&&W.nq(C)):W._previousPosition.B(W._position);const B=Math.cos(W.alpha),x=Math.sin(W.alpha),b=Math.cos(W.beta);let K=Math.sin(W.beta);0===K&&(K=1e-4);const f=W._getTargetPosition();W._computationVector.rb(W.radius*B*K,W.radius*b,W.radius*x*K),f.addToRef(W._computationVector,W._newPosition),W._position.B(W._newPosition);let J=W.upVector;W.allowUpsideDown&&W.beta<0&&(J=J.clone(),J=J.negate()),W._computeViewMatrix(W._position,f,J),W._viewMatrix.addAtIndex(12,W.targetScreenOffset.x),W._viewMatrix.addAtIndex(13,W.targetScreenOffset.y),W._collisionTriggered=!1},this._target=K.ql.Zero(),x&&this.setTarget(x),this.alpha=l,this.beta=C,this.radius=B,this.getViewMatrix(),this.inputs=new v(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new K.ql(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=K.Vector2.Zero()}_updateCache(Z){Z||super._updateCache(),this._cache._target.B(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.B(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const Z=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?Z.addToRef(this._targetBoundingCenter,this._target):this._target.B(Z)}const Z=this._getLockedTargetPosition();return Z||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>G.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,b=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=b?this._currentInterpolationFactor=b:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=k(Z,this._goalAlpha),this._goalBeta=k(l,this._goalBeta),this._goalRadius=k(C,this._goalRadius),this._goalTarget.set(k(B.x,this._goalTarget.x),k(B.y,this._goalTarget.y),k(B.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(k(x.x,this._goalTargetScreenOffset.x),k(x.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,f.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,f.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,f.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,f.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(Z,l){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const x=arguments;l=F.Tools.BackCompatCameraNoPreventDefault(x),this._useCtrlForPanning=C,this._panningMouseButton=B,"boolean"===typeof x[0]&&(x.length>1&&(this._useCtrlForPanning=x[1]),x.length>2&&(this._panningMouseButton=x[2])),this.inputs.attachElement(l),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}DG(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let Z=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){Z=!0;const l=this.invertRotation?-1:1,C=this._calculateHandednessMultiplier();let B=this.inertialAlphaOffset*C;this.beta<0&&(B*=-1),this.alpha+=B*l,this.beta+=this.inertialBetaOffset*l,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<G.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<G.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*G.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){Z=!0;const l=new K.ql(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),l.multiplyInPlace(this.panningAxis),K.ql.TransformNormalToRef(l,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const Z=this.upVector,l=K.ql.CrossToRef(this._transformedDirection,Z,this._transformedDirection);K.ql.CrossToRef(Z,l,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);K.ql.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.B(this._transformedDirection)}else{if(this.parent){const Z=K.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(Z),Z.transposeToRef(Z),K.ql.TransformCoordinatesToRef(this._transformedDirection,Z,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*G.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*G.e&&(this.inertialPanningY=0)}if(Z)this.stopInterpolation();else if(this._isInterpolating){let Z=!1;const l=this._scene.getEngine().getDeltaTime()/1e3,C=1-Math.pow(2,-l/this._currentInterpolationFactor),B=k(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const l=K.TmpVectors.ql[0].set(k(this._goalTarget.x,this._target.x),k(this._goalTarget.y,this._target.y),k(this._goalTarget.z,this._target.z));K.ql.LerpToRef(this.target,l,C,this._target),10*K.ql.Distance(this.target,l)/B<G.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.B(l),this.setTarget(this.target,!1,!0,!0)):Z=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const l=K.Quaternion.RotationAlphaBetaGammaToRef(k(this._goalAlpha,this.alpha),k(this._goalBeta,this.beta),0,K.TmpVectors.Quaternion[0]),B=K.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,K.TmpVectors.Quaternion[1]),x=K.Quaternion.SlerpToRef(B,l,C,K.TmpVectors.Quaternion[2]);x.normalize();const b=x.toAlphaBetaGammaToRef(K.TmpVectors.ql[0]);if(this.alpha=b.x,this.beta=b.y,x.isApprox(l,G.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const Z=l.toAlphaBetaGammaToRef(K.TmpVectors.ql[0]);this.alpha=Z.x,this.beta=Z.y}else Z=!0}if(isNaN(this._goalRadius)||(this.radius+=(B-this.radius)*C,Math.abs(B/this.radius-1)<G.e?(this._goalRadius=NaN,this.radius=B):Z=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const l=K.TmpVectors.Vector2[0].set(k(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),k(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));K.Vector2.LerpToRef(this.targetScreenOffset,l,C,this.targetScreenOffset),K.Vector2.Distance(this.targetScreenOffset,l)<G.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.B(l)):Z=!0}this._isInterpolating=Z}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||K.ql.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const Z=this.alpha;var l,C;this.alpha=function(Z){let l=Math.PI/2;return 0===Z.x&&0===Z.z||(l=Math.acos(Z.x/Math.sqrt(Math.pow(Z.x,2)+Math.pow(Z.z,2)))),Z.z<0&&(l=2*Math.PI-l),l}(this._computationVector),this.beta=(l=this._computationVector.y,C=this.radius,Math.acos(l/C));const B=Math.round((Z-this.alpha)/(2*Math.PI));this.alpha+=2*B*Math.PI,this._checkLimits()}setPosition(Z){this._position.equals(Z)||(this._position.B(Z),this.rebuildAnglesAndRadius())}setTarget(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(B=this.overrideCloneAlphaBetaRadius??B,Z.Fb)l&&Z.getBoundingInfo?this._targetBoundingCenter=Z.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,Z.Fb(),this._targetHost=Z,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const l=Z,B=this._getTargetPosition();if(B&&!C&&B.equals(l))return;this._targetHost=null,this._target=l,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}B||this.rebuildAnglesAndRadius()}_getViewMatrix(){const Z=Math.cos(this.alpha),l=Math.sin(this.alpha),C=Math.cos(this.beta);let B=Math.sin(this.beta);0===B&&(B=1e-4),0===this.radius&&(this.radius=1e-4);const x=this._getTargetPosition();if(this._computationVector.rb(this.radius*Z*B,this.radius*C,this.radius*l*B),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||K.ql.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),x.addToRef(this._computationVector,this._newPosition),this.cZ().collisionsEnabled&&this.checkCollisions){const Z=this.cZ().collisionCoordinator;this._collider||(this._collider=Z.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,Z.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.B(this._newPosition);let Z=this.upVector;this.allowUpsideDown&&B<0&&(Z=Z.negate()),this._computeViewMatrix(this._position,x,Z),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.B(x),this._viewMatrix}zoomOn(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z=Z||this.cZ().meshes;const C=J.b.MinMax(Z);let B=this._calculateLowerRadiusFromModelBoundingSphere(C.min,C.max);if(B=Math.max(Math.min(B,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=B*this.zoomOnFactor,this.mode===S.d.ORTHOGRAPHIC_CAMERA){const Z=this.cZ().getEngine().getAspectRatio(this),l=B*this.zoomOnFactor/2;this.orthoLeft=-l*Z,this.orthoRight=l*Z,this.orthoBottom=-l,this.orthoTop=l}this.focusOn({min:C.min,max:C.max,distance:B},l)}focusOn(Z){let l,C,B=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===Z.min){const B=Z||this.cZ().meshes;l=J.b.MinMax(B),C=K.ql.Distance(l.min,l.max)}else{l=Z,C=Z.distance}this._target=J.b.Center(l),B||(this.maxZ=2*C)}createRigCamera(Z,l){let C=0;switch(this.cameraRigMode){case S.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case S.d.RIG_MODE_VR:C=this._cameraRigParams.stereoHalfAngle*(0===l?1:-1);break;case S.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:C=this._cameraRigParams.stereoHalfAngle*(0===l?-1:1)}const B=new V(Z,this.alpha+C,this.beta,this.radius,this._target,this.cZ());return B._cameraRigParams={},B.isRigCamera=!0,B.rigParent=this,B.upVector=this.upVector,B.mode=this.mode,B.orthoLeft=this.orthoLeft,B.orthoRight=this.orthoRight,B.orthoBottom=this.orthoBottom,B.orthoTop=this.orthoTop,B}_updateRigCameras(){const Z=this._rigCameras[0],l=this._rigCameras[1];switch(Z.beta=l.beta=this.beta,this.cameraRigMode){case S.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case S.d.RIG_MODE_VR:Z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,l.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case S.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,l.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const B=K.ql.Distance(Z,l),x=this.cZ().getEngine().getAspectRatio(this),b=Math.tan(this.fov/2),f=b*x,W=.5*B*C,J=W*Math.sqrt(1+1/(f*f)),d=W*Math.sqrt(1+1/(b*b));return Math.max(J,d)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,B.b)([(0,x.R)()],V.prototype,"alpha",void 0),(0,B.b)([(0,x.R)()],V.prototype,"beta",void 0),(0,B.b)([(0,x.R)()],V.prototype,"radius",void 0),(0,B.b)([(0,x.R)()],V.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,B.b)([(0,x.Q)("target")],V.prototype,"_target",void 0),(0,B.b)([(0,x.C)("targetHost")],V.prototype,"_targetHost",void 0),(0,B.b)([(0,x.R)()],V.prototype,"inertialAlphaOffset",void 0),(0,B.b)([(0,x.R)()],V.prototype,"inertialBetaOffset",void 0),(0,B.b)([(0,x.R)()],V.prototype,"inertialRadiusOffset",void 0),(0,B.b)([(0,x.R)()],V.prototype,"lowerAlphaLimit",void 0),(0,B.b)([(0,x.R)()],V.prototype,"upperAlphaLimit",void 0),(0,B.b)([(0,x.R)()],V.prototype,"lowerBetaLimit",void 0),(0,B.b)([(0,x.R)()],V.prototype,"upperBetaLimit",void 0),(0,B.b)([(0,x.R)()],V.prototype,"lowerRadiusLimit",void 0),(0,B.b)([(0,x.R)()],V.prototype,"upperRadiusLimit",void 0),(0,B.b)([(0,x.R)()],V.prototype,"lowerTargetYLimit",void 0),(0,B.b)([(0,x.R)()],V.prototype,"inertialPanningX",void 0),(0,B.b)([(0,x.R)()],V.prototype,"inertialPanningY",void 0),(0,B.b)([(0,x.R)()],V.prototype,"pinchToPanMaxDistance",void 0),(0,B.b)([(0,x.R)()],V.prototype,"panningDistanceLimit",void 0),(0,B.b)([(0,x.Q)()],V.prototype,"panningOriginTarget",void 0),(0,B.b)([(0,x.R)()],V.prototype,"panningInertia",void 0),(0,B.b)([(0,x.R)()],V.prototype,"zoomToMouseLocation",null),(0,B.b)([(0,x.R)()],V.prototype,"zoomOnFactor",void 0),(0,B.b)([(0,x.N)()],V.prototype,"targetScreenOffset",void 0),(0,B.b)([(0,x.R)()],V.prototype,"allowUpsideDown",void 0),(0,B.b)([(0,x.R)()],V.prototype,"useInputToRestoreState",void 0),(0,B.b)([(0,x.R)()],V.prototype,"restoreStateInterpolationFactor",void 0),(0,R.c)("BABYLON.ArcRotateCamera",V)},13760:(Z,l,C)=>{"use strict";C.d(l,{b:()=>K,e:()=>f});var B=C(12263),x=C(12478),b=C(12880),K={};class f{constructor(Z){this.attachedToElement=!1,this.attached={},this.camera=Z,this.checkInputs=()=>{}}add(Z){const l=Z.getSimpleName();this.attached[l]?B.e.Warn("camera input of type "+l+" already exists on camera"):(this.attached[l]=Z,Z.camera=this.camera,Z.checkInputs&&(this.checkInputs=this._addCheckInputs(Z.checkInputs.bind(Z))),this.attachedToElement&&Z.attachControl(this.noPreventDefault))}remove(Z){for(const l in this.attached){const C=this.attached[l];if(C===Z)return C.DG(),C.camera=null,delete this.attached[l],void this.rebuildInputCheck()}}removeByType(Z){for(const l in this.attached){const C=this.attached[l];C.getClassName()===Z&&(C.DG(),C.camera=null,delete this.attached[l],this.rebuildInputCheck())}}_addCheckInputs(Z){const l=this.checkInputs;return()=>{l(),Z()}}attachInput(Z){this.attachedToElement&&Z.attachControl(this.noPreventDefault)}attachElement(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){Z=!b.d.ForceAttachControlToAlwaysPreventDefault&&Z,this.attachedToElement=!0,this.noPreventDefault=Z;for(const l in this.attached)this.attached[l].attachControl(Z)}}detachElement(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const l in this.attached)this.attached[l].DG(),Z&&(this.attached[l].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const Z in this.attached){const l=this.attached[Z];l.checkInputs&&(this.checkInputs=this._addCheckInputs(l.checkInputs.bind(l)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(Z){const l={};for(const C in this.attached){const Z=this.attached[C],B=x.b.Serialize(Z);l[Z.getClassName()]=B}Z.inputsmgr=l}parse(Z){const l=Z.inputsmgr;if(l){this.clear();for(const Z in l){const C=K[Z];if(C){const B=l[Z],b=x.b.Parse((()=>new C),B,null);this.add(b)}}}else for(const C in this.attached){const l=K[this.attached[C].getClassName()];if(l){const B=x.b.Parse((()=>new l),Z,null);this.remove(this.attached[C]),this.add(B)}}}}},13751:(Z,l,C)=>{"use strict";C.d(l,{d:()=>n});var B=C(12428),x=C(12432),b=C(12442),K=C(12912),f=C(13760),W=C(12741),J=C(12248);class d{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(Z){Z=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.cZ(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((l=>{const C=l.event;if(!C.metaKey)if(l.type===W.b.KEYDOWN){if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),Z||C.preventDefault()}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){const l=this._keys.indexOf(C.keyCode);l>=0&&this._keys.splice(l,1),Z||C.preventDefault()}})))}DG(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Z=this.camera;for(let l=0;l<this._keys.length;l++){const C=this._keys[l],B=Z._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(C)?Z._localDirection.rb(-B,0,0):-1!==this.keysUp.indexOf(C)?Z._localDirection.rb(0,0,B):-1!==this.keysRight.indexOf(C)?Z._localDirection.rb(B,0,0):-1!==this.keysDown.indexOf(C)?Z._localDirection.rb(0,0,-B):-1!==this.keysUpward.indexOf(C)?Z._localDirection.rb(0,B,0):-1!==this.keysDownward.indexOf(C)?Z._localDirection.rb(0,-B,0):-1!==this.keysRotateLeft.indexOf(C)?(Z._localDirection.rb(0,0,0),Z.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(C)?(Z._localDirection.rb(0,0,0),Z.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(C)?(Z._localDirection.rb(0,0,0),Z.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(C)&&(Z._localDirection.rb(0,0,0),Z.cameraRotation.x+=this._getLocalRotation()),Z.cZ().useRightHandedSystem&&(Z._localDirection.z*=-1),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),b.ql.TransformNormalToRef(Z._localDirection,Z._cameraTransformMatrix,Z._transformedDirection),Z.cameraDirection.addInPlace(Z._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const Z=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*Z}}(0,B.b)([(0,x.R)()],d.prototype,"keysUp",void 0),(0,B.b)([(0,x.R)()],d.prototype,"keysUpward",void 0),(0,B.b)([(0,x.R)()],d.prototype,"keysDown",void 0),(0,B.b)([(0,x.R)()],d.prototype,"keysDownward",void 0),(0,B.b)([(0,x.R)()],d.prototype,"keysLeft",void 0),(0,B.b)([(0,x.R)()],d.prototype,"keysRight",void 0),(0,B.b)([(0,x.R)()],d.prototype,"rotationSpeed",void 0),(0,B.b)([(0,x.R)()],d.prototype,"keysRotateLeft",void 0),(0,B.b)([(0,x.R)()],d.prototype,"keysRotateRight",void 0),(0,B.b)([(0,x.R)()],d.prototype,"keysRotateUp",void 0),(0,B.b)([(0,x.R)()],d.prototype,"keysRotateDown",void 0),f.b.FreeCameraKeyboardMoveInput=d;var E=C(12251),G=C(12739);class a{constructor(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=Z,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new E.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(Z){Z=J.Tools.BackCompatCameraNoPreventDefault(arguments);const l=this.camera.getEngine(),C=l.getInputElement();this._pointerInput||(this._pointerInput=B=>{const x=B.event,b="touch"===x.pointerType;if(!this.touchEnabled&&b)return;if(B.type!==G.d.POINTERMOVE&&-1===this.buttons.indexOf(x.button))return;const K=x.target;if(B.type===G.d.POINTERDOWN){if(b&&-1!==this._activePointerId||!b&&-1!==this._currentActiveButton)return;this._activePointerId=x.pointerId;try{null===K||void 0===K||K.setPointerCapture(x.pointerId)}catch(f){}-1===this._currentActiveButton&&(this._currentActiveButton=x.button),this._previousPosition={x:x.clientX,y:x.clientY},Z||(x.preventDefault(),C&&C.focus()),l.isPointerLock&&this._onMouseMove&&this._onMouseMove(B.event)}else if(B.type===G.d.POINTERUP){if(b&&this._activePointerId!==x.pointerId||!b&&this._currentActiveButton!==x.button)return;try{null===K||void 0===K||K.releasePointerCapture(x.pointerId)}catch(f){}this._currentActiveButton=-1,this._previousPosition=null,Z||x.preventDefault(),this._activePointerId=-1}else if(B.type===G.d.POINTERMOVE&&(this._activePointerId===x.pointerId||!b))if(l.isPointerLock&&this._onMouseMove)this._onMouseMove(B.event);else if(this._previousPosition){const l=this.camera._calculateHandednessMultiplier(),C=(x.clientX-this._previousPosition.x)*l,B=x.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=C/this.angularSensibility,this.camera.cameraRotation.x+=B/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:C,offsetY:B}),this._previousPosition={x:x.clientX,y:x.clientY},Z||x.preventDefault()}}),this._onMouseMove=C=>{if(!l.isPointerLock)return;const B=this.camera._calculateHandednessMultiplier(),x=C.movementX*B;this.camera.cameraRotation.y+=x/this.angularSensibility;const b=C.movementY;this.camera.cameraRotation.x+=b/this.angularSensibility,this._previousPosition=null,Z||C.preventDefault()},this._observer=this.camera.cZ()._inputManager._addCameraPointerObserver(this._pointerInput,G.d.POINTERDOWN|G.d.POINTERUP|G.d.POINTERMOVE),C&&(this._contextMenuBind=Z=>this.onContextMenu(Z),C.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(Z){Z.preventDefault()}DG(){if(this._observer){if(this.camera.cZ()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,B.b)([(0,x.R)()],a.prototype,"buttons",void 0),(0,B.b)([(0,x.R)()],a.prototype,"angularSensibility",void 0),f.b.FreeCameraMouseInput=a;var q,z=C(12749);class Y{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new E.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(Z){Z=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=l=>{if(l.type!==G.d.POINTERWHEEL)return;const C=l.event,B=C.deltaMode===z.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*B*C.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*B*C.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*B*C.deltaZ/this._normalize,C.preventDefault&&(Z||C.preventDefault())},this._observer=this.camera.cZ()._inputManager._addCameraPointerObserver(this._wheel,G.d.POINTERWHEEL)}DG(){this._observer&&(this.camera.cZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,B.b)([(0,x.R)()],Y.prototype,"wheelPrecisionX",void 0),(0,B.b)([(0,x.R)()],Y.prototype,"wheelPrecisionY",void 0),(0,B.b)([(0,x.R)()],Y.prototype,"wheelPrecisionZ",void 0),function(Z){Z[Z.MoveRelative=0]="MoveRelative",Z[Z.RotateRelative=1]="RotateRelative",Z[Z.MoveScene=2]="MoveScene"}(q||(q={}));class P extends Y{constructor(){super(...arguments),this._moveRelative=b.ql.Zero(),this._rotateRelative=b.ql.Zero(),this._moveScene=b.ql.Zero(),this._wheelXAction=q.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=q.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(Z){null===Z&&this._wheelXAction!==q.MoveRelative||(this._wheelXAction=q.MoveRelative,this._wheelXActionCoordinate=Z)}get wheelXMoveRelative(){return this._wheelXAction!==q.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(Z){null===Z&&this._wheelYAction!==q.MoveRelative||(this._wheelYAction=q.MoveRelative,this._wheelYActionCoordinate=Z)}get wheelYMoveRelative(){return this._wheelYAction!==q.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(Z){null===Z&&this._wheelZAction!==q.MoveRelative||(this._wheelZAction=q.MoveRelative,this._wheelZActionCoordinate=Z)}get wheelZMoveRelative(){return this._wheelZAction!==q.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(Z){null===Z&&this._wheelXAction!==q.RotateRelative||(this._wheelXAction=q.RotateRelative,this._wheelXActionCoordinate=Z)}get wheelXRotateRelative(){return this._wheelXAction!==q.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(Z){null===Z&&this._wheelYAction!==q.RotateRelative||(this._wheelYAction=q.RotateRelative,this._wheelYActionCoordinate=Z)}get wheelYRotateRelative(){return this._wheelYAction!==q.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(Z){null===Z&&this._wheelZAction!==q.RotateRelative||(this._wheelZAction=q.RotateRelative,this._wheelZActionCoordinate=Z)}get wheelZRotateRelative(){return this._wheelZAction!==q.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(Z){null===Z&&this._wheelXAction!==q.MoveScene||(this._wheelXAction=q.MoveScene,this._wheelXActionCoordinate=Z)}get wheelXMoveScene(){return this._wheelXAction!==q.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(Z){null===Z&&this._wheelYAction!==q.MoveScene||(this._wheelYAction=q.MoveScene,this._wheelYActionCoordinate=Z)}get wheelYMoveScene(){return this._wheelYAction!==q.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(Z){null===Z&&this._wheelZAction!==q.MoveScene||(this._wheelZAction=q.MoveScene,this._wheelZActionCoordinate=Z)}get wheelZMoveScene(){return this._wheelZAction!==q.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ob(0),this._rotateRelative.ob(0),this._moveScene.ob(0),this._updateCamera(),this.camera.cZ().useRightHandedSystem&&(this._moveRelative.z*=-1);const Z=b.Matrix.Zero();this.camera.getViewMatrix().invertToRef(Z);const l=b.ql.Zero();b.ql.TransformNormalToRef(this._moveRelative,Z,l),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(l),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(Z,l,C){if(0===Z)return;if(null===l||null===C)return;let B=null;switch(l){case q.MoveRelative:B=this._moveRelative;break;case q.RotateRelative:B=this._rotateRelative;break;case q.MoveScene:B=this._moveScene}switch(C){case 0:B.set(Z,0,0);break;case 1:B.set(0,Z,0);break;case 2:B.set(0,0,Z)}}}(0,B.b)([(0,x.R)()],P.prototype,"wheelXMoveRelative",null),(0,B.b)([(0,x.R)()],P.prototype,"wheelYMoveRelative",null),(0,B.b)([(0,x.R)()],P.prototype,"wheelZMoveRelative",null),(0,B.b)([(0,x.R)()],P.prototype,"wheelXRotateRelative",null),(0,B.b)([(0,x.R)()],P.prototype,"wheelYRotateRelative",null),(0,B.b)([(0,x.R)()],P.prototype,"wheelZRotateRelative",null),(0,B.b)([(0,x.R)()],P.prototype,"wheelXMoveScene",null),(0,B.b)([(0,x.R)()],P.prototype,"wheelYMoveScene",null),(0,B.b)([(0,x.R)()],P.prototype,"wheelZMoveScene",null),f.b.FreeCameraMouseWheelInput=P;class S{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=Z,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=J.Tools.IsSafari()}attachControl(Z){Z=J.Tools.BackCompatCameraNoPreventDefault(arguments);let l=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=C=>{const B=C.event,x="mouse"===B.pointerType||this._isSafari&&"undefined"===typeof B.pointerType;if(this.allowMouse||!x)if(C.type===G.d.POINTERDOWN){if(Z||B.preventDefault(),this._pointerPressed.push(B.pointerId),1!==this._pointerPressed.length)return;l={x:B.clientX,y:B.clientY}}else if(C.type===G.d.POINTERUP){Z||B.preventDefault();const C=this._pointerPressed.indexOf(B.pointerId);if(-1===C)return;if(this._pointerPressed.splice(C,1),0!=C)return;l=null,this._offsetX=null,this._offsetY=null}else if(C.type===G.d.POINTERMOVE){if(Z||B.preventDefault(),!l)return;if(0!=this._pointerPressed.indexOf(B.pointerId))return;this._offsetX=B.clientX-l.x,this._offsetY=-(B.clientY-l.y)}}),this._observer=this.camera.cZ()._inputManager._addCameraPointerObserver(this._pointerInput,G.d.POINTERDOWN|G.d.POINTERUP|G.d.POINTERMOVE),this._onLostFocus){const Z=this.camera.getEngine().getInputElement();Z&&Z.addEventListener("blur",this._onLostFocus)}}DG(){if(this._pointerInput){if(this._observer&&(this.camera.cZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const Z=this.camera,l=Z._calculateHandednessMultiplier();Z.cameraRotation.y=l*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)Z.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const l=Z._computeLocalCameraSpeed(),C=new b.ql(0,0,0!==this.touchMoveSensibility?l*this._offsetY/this.touchMoveSensibility:0);b.Matrix.RotationYawPitchRollToRef(Z.rotation.y,Z.rotation.x,0,Z._cameraRotationMatrix),Z.cameraDirection.addInPlace(b.ql.TransformCoordinates(C,Z._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,B.b)([(0,x.R)()],S.prototype,"touchAngularSensibility",void 0),(0,B.b)([(0,x.R)()],S.prototype,"touchMoveSensibility",void 0),f.b.FreeCameraTouchInput=S;class i extends f.e{constructor(Z){super(Z),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new d),this}addMouse(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new a(Z),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new P,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new S),this}clear(){super.clear(),this._mouseInput=null}}var s=C(12400),F=C(12346);class n extends K.b{get angularSensibility(){const Z=this.inputs.attached.mouse;return Z?Z.angularSensibility:0}set angularSensibility(Z){const l=this.inputs.attached.mouse;l&&(l.angularSensibility=Z)}get keysUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]}set keysUp(Z){const l=this.inputs.attached.keyboard;l&&(l.keysUp=Z)}get keysUpward(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUpward:[]}set keysUpward(Z){const l=this.inputs.attached.keyboard;l&&(l.keysUpward=Z)}get keysDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]}set keysDown(Z){const l=this.inputs.attached.keyboard;l&&(l.keysDown=Z)}get keysDownward(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDownward:[]}set keysDownward(Z){const l=this.inputs.attached.keyboard;l&&(l.keysDownward=Z)}get keysLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]}set keysLeft(Z){const l=this.inputs.attached.keyboard;l&&(l.keysLeft=Z)}get keysRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]}set keysRight(Z){const l=this.inputs.attached.keyboard;l&&(l.keysRight=Z)}get keysRotateLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateLeft:[]}set keysRotateLeft(Z){const l=this.inputs.attached.keyboard;l&&(l.keysRotateLeft=Z)}get keysRotateRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateRight:[]}set keysRotateRight(Z){const l=this.inputs.attached.keyboard;l&&(l.keysRotateRight=Z)}get keysRotateUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateUp:[]}set keysRotateUp(Z){const l=this.inputs.attached.keyboard;l&&(l.keysRotateUp=Z)}get keysRotateDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateDown:[]}set keysRotateDown(Z){const l=this.inputs.attached.keyboard;l&&(l.keysRotateDown=Z)}constructor(Z,l,C){var B;super(Z,l,C,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),B=this,this.ellipsoid=new b.ql(.5,1,.5),this.ellipsoidOffset=new b.ql(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=b.ql.Zero(),this._diffPosition=b.ql.Zero(),this._newPosition=b.ql.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B._newPosition.B(l),B._newPosition.subtractToRef(B._oldPosition,B._diffPosition),B._diffPosition.length()>F.d.CollisionsEpsilon&&(B.position.addToRef(B._diffPosition,B._deferredPositionUpdate),B._deferOnly?B._deferredUpdated=!0:B.position.B(B._deferredPositionUpdate),B.nq&&C&&B.nq(C))},this.inputs=new i(this),this.inputs.addKeyboard().addMouse()}attachControl(Z,l){l=J.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(l)}DG(){this.inputs.detachElement(),this.cameraDirection=new b.ql(0,0,0),this.cameraRotation=new b.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(Z){this._collisionMask=isNaN(Z)?-1:Z}_collideWithWorld(Z){let l;l=this.parent?b.ql.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,l.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const C=this.cZ().collisionCoordinator;this._collider||(this._collider=C.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let B=Z;this.applyGravity&&(B=Z.add(this.cZ().gravity)),C.getNewPosition(this._oldPosition,B,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=b.ql.Zero(),this._transformedDirection=b.ql.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(Z){this._needMoveForGravity=Z}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.cZ().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"yb"}}(0,B.b)([(0,x.Q)()],n.prototype,"ellipsoid",void 0),(0,B.b)([(0,x.Q)()],n.prototype,"ellipsoidOffset",void 0),(0,B.b)([(0,x.R)()],n.prototype,"checkCollisions",void 0),(0,B.b)([(0,x.R)()],n.prototype,"applyGravity",void 0),(0,s.c)("BABYLON.FreeCamera",n)},14324:(Z,l,C)=>{"use strict";C.d(l,{c:()=>b});var B=C(12561),x=C(14329);class b{constructor(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=C,this.bG=[],this._maxBlockCapacity=l||64,this._selectionContent=new B.d(1024),this._creationFunc=Z}update(Z,l,C){x.d._CreateBlocks(Z,l,C,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}GE(Z){for(let l=0;l<this.UE.length;l++){this.UE[l].addEntry(Z)}}EE(Z){for(let l=0;l<this.UE.length;l++){this.UE[l].removeEntry(Z)}}select(Z,l){this._selectionContent.reset();for(let C=0;C<this.UE.length;C++){this.UE[C].select(Z,this._selectionContent,l)}return l?this._selectionContent.concat(this.bG):this._selectionContent.concatWithNoDuplicate(this.bG),this._selectionContent}intersects(Z,l,C){this._selectionContent.reset();for(let B=0;B<this.UE.length;B++){this.UE[B].intersects(Z,l,this._selectionContent,C)}return C?this._selectionContent.concat(this.bG):this._selectionContent.concatWithNoDuplicate(this.bG),this._selectionContent}intersectsRay(Z){this._selectionContent.reset();for(let l=0;l<this.UE.length;l++){this.UE[l].intersectsRay(Z,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.bG),this._selectionContent}}b.CreationFuncForMeshes=(Z,l)=>{const C=Z.getBoundingInfo();!Z.isBlocked&&C.boundingBox.intersectsMinMax(l.dG,l.EG)&&l.entries.push(Z)},b.CreationFuncForSubMeshes=(Z,l)=>{Z.getBoundingInfo().boundingBox.intersectsMinMax(l.dG,l.EG)&&l.entries.push(Z)}},14329:(Z,l,C)=>{"use strict";C.d(l,{d:()=>b});var B=C(12442),x=C(12784);class b{constructor(Z,l,C,B,x,b){this.entries=[],this.GG=new Array,this._capacity=C,this._depth=B,this._maxDepth=x,this._creationFunc=b,this._minPoint=Z,this._maxPoint=l,this.GG.push(Z.clone()),this.GG.push(l.clone()),this.GG.push(Z.clone()),this.GG[2].x=l.x,this.GG.push(Z.clone()),this.GG[3].y=l.y,this.GG.push(Z.clone()),this.GG[4].z=l.z,this.GG.push(l.clone()),this.GG[5].z=Z.z,this.GG.push(l.clone()),this.GG[6].x=Z.x,this.GG.push(l.clone()),this.GG[7].y=Z.y}get Ml(){return this._capacity}get dG(){return this._minPoint}get EG(){return this._maxPoint}addEntry(Z){if(this.UE)for(let l=0;l<this.UE.length;l++){this.UE[l].addEntry(Z)}else this._creationFunc(Z,this),this.entries.length>this.Ml&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(Z){if(this.UE){for(let l=0;l<this.UE.length;l++){this.UE[l].removeEntry(Z)}return}const l=this.entries.indexOf(Z);l>-1&&this.entries.splice(l,1)}addEntries(Z){for(let l=0;l<Z.length;l++){const C=Z[l];this.addEntry(C)}}select(Z,l,C){if(x.c.IsInFrustum(this.GG,Z)){if(this.UE){for(let B=0;B<this.UE.length;B++){this.UE[B].select(Z,l,C)}return}C?l.concat(this.entries):l.concatWithNoDuplicate(this.entries)}}intersects(Z,l,C,B){if(x.c.IntersectsSphere(this._minPoint,this._maxPoint,Z,l)){if(this.UE){for(let x=0;x<this.UE.length;x++){this.UE[x].intersects(Z,l,C,B)}return}B?C.concat(this.entries):C.concatWithNoDuplicate(this.entries)}}intersectsRay(Z,l){if(Z.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.UE){for(let C=0;C<this.UE.length;C++){this.UE[C].intersectsRay(Z,l)}return}l.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){b._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(Z,l,C,x,K,f,W,J){W.UE=new Array;const d=new B.ql((l.x-Z.x)/2,(l.y-Z.y)/2,(l.z-Z.z)/2);for(let B=0;B<2;B++)for(let l=0;l<2;l++)for(let E=0;E<2;E++){const G=Z.add(d.multiplyByFloats(B,l,E)),a=Z.add(d.multiplyByFloats(B+1,l+1,E+1)),q=new b(G,a,x,K+1,f,J);q.addEntries(C),W.UE.push(q)}}}},14334:(Z,l,C)=>{"use strict";C.d(l,{d:()=>d});var B=C(12704),x=C(12442),b=C(12855),K=C(13508),f=C(12735),W=C(14324),J=C(12295);B.e.prototype.createOrUpdateSelectionOctree=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,C=this._getComponent(f.d.NAME_OCTREE);C||(C=new d(this),this.o(C)),this.BG||(this.BG=new W.c(W.c.CreationFuncForMeshes,Z,l));const B=this.getWorldExtends();return this.BG.update(B.min,B.max,this.meshes),this.BG},Object.defineProperty(B.e.prototype,"selectionOctree",{get:function(){return this.BG},enumerable:!0,configurable:!0}),b.e.prototype.createOrUpdateSubmeshesOctree=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const C=this.cZ();let B=C._getComponent(f.d.NAME_OCTREE);B||(B=new d(C),C.o(B)),this._submeshesOctree||(this._submeshesOctree=new W.c(W.c.CreationFuncForSubMeshes,Z,l)),this.Fb(!0);const x=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(x.minimumWorld,x.maximumWorld,this.zb),this._submeshesOctree};class d{constructor(Z){this.name=f.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new K.e(x.ql.Zero(),new x.ql(1,1,1)),(Z=Z||J.b.LastCreatedScene)&&(this.Yl=Z,this.Yl.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Yl.getActiveSubMeshCandidates=Z=>this.getActiveSubMeshCandidates(Z),this.Yl.getCollidingSubMeshCandidates=(Z,l)=>this.getCollidingSubMeshCandidates(Z,l),this.Yl.getIntersectingSubMeshCandidates=(Z,l)=>this.getIntersectingSubMeshCandidates(Z,l))}register(){this.Yl.onMeshRemovedObservable.add((Z=>{const l=this.Yl.selectionOctree;if(void 0!==l&&null!==l){const C=l.bG.indexOf(Z);-1!==C&&l.bG.splice(C,1)}})),this.Yl.onMeshImportedObservable.add((Z=>{const l=this.Yl.selectionOctree;void 0!==l&&null!==l&&l.GE(Z)}))}getActiveMeshCandidates(){var Z;return(null===(Z=this.Yl.BG)||void 0===Z?void 0:Z.select(this.Yl.frustumPlanes))||this.Yl._getDefaultMeshCandidates()}getActiveSubMeshCandidates(Z){if(Z._submeshesOctree&&Z.useOctreeForRenderingSelection){return Z._submeshesOctree.select(this.Yl.frustumPlanes)}return this.Yl._getDefaultSubMeshCandidates(Z)}getIntersectingSubMeshCandidates(Z,l){if(Z._submeshesOctree&&Z.useOctreeForPicking){K.e.TransformToRef(l,Z.getWorldMatrix(),this._tempRay);return Z._submeshesOctree.intersectsRay(this._tempRay)}return this.Yl._getDefaultSubMeshCandidates(Z)}getCollidingSubMeshCandidates(Z,l){if(Z._submeshesOctree&&Z.useOctreeForCollisions){const C=l._velocityWorldLength+Math.max(l._radius.x,l._radius.y,l._radius.z);return Z._submeshesOctree.intersects(l._basePointWorld,C)}return this.Yl._getDefaultSubMeshCandidates(Z)}rebuild(){}dispose(){}}},13508:(Z,l,C)=>{"use strict";C.d(l,{e:()=>a});var B=C(12704),x=C(12880),b=C(12451),K=C(12442),f=C(12456),W=C(12776),J=C(12733),d=C(12295),E=C(12751);const G={internalPickerForMesh:void 0};class a{constructor(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.e;this.origin=Z,this.direction=l,this.length=C,this.epsilon=B}clone(){return new a(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const B=a._TmpVector3[0].rb(Z.x-C,Z.y-C,Z.z-C),x=a._TmpVector3[1].rb(l.x+C,l.y+C,l.z+C);let b,K,f,W,J=0,d=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<B.x||this.origin.x>x.x)return!1}else if(b=1/this.direction.x,K=(B.x-this.origin.x)*b,f=(x.x-this.origin.x)*b,f===-1/0&&(f=1/0),K>f&&(W=K,K=f,f=W),J=Math.max(K,J),d=Math.min(f,d),J>d)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<B.y||this.origin.y>x.y)return!1}else if(b=1/this.direction.y,K=(B.y-this.origin.y)*b,f=(x.y-this.origin.y)*b,f===-1/0&&(f=1/0),K>f&&(W=K,K=f,f=W),J=Math.max(K,J),d=Math.min(f,d),J>d)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<B.z||this.origin.z>x.z)return!1}else if(b=1/this.direction.z,K=(B.z-this.origin.z)*b,f=(x.z-this.origin.z)*b,f===-1/0&&(f=1/0),K>f&&(W=K,K=f,f=W),J=Math.max(K,J),d=Math.min(f,d),J>d)return!1;return!0}intersectsBox(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(Z.minimum,Z.maximum,l)}intersectsSphere(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=Z.center.x-this.origin.x,B=Z.center.y-this.origin.y,x=Z.center.z-this.origin.z,b=C*C+B*B+x*x,K=Z.radius+l,f=K*K;if(b<=f)return!0;const W=C*this.direction.x+B*this.direction.y+x*this.direction.z;if(W<0)return!1;return b-W*W<=f}intersectsTriangle(Z,l,C){const B=a._TmpVector3[0],x=a._TmpVector3[1],b=a._TmpVector3[2],f=a._TmpVector3[3],J=a._TmpVector3[4];l.subtractToRef(Z,B),C.subtractToRef(Z,x),K.ql.CrossToRef(this.direction,x,b);const d=K.ql.Dot(B,b);if(0===d)return null;const E=1/d;this.origin.subtractToRef(Z,f);const G=K.ql.Dot(f,b)*E;if(G<-this.epsilon||G>1+this.epsilon)return null;K.ql.CrossToRef(f,B,J);const q=K.ql.Dot(this.direction,J)*E;if(q<-this.epsilon||G+q>1+this.epsilon)return null;const z=K.ql.Dot(x,J)*E;return z>this.length?null:new W.e(1-G-q,G,z)}intersectsPlane(Z){let l;const C=K.ql.Dot(Z.normal,this.direction);if(Math.abs(C)<9.99999997475243e-7)return null;{const B=K.ql.Dot(Z.normal,this.origin);return l=(-Z.d-B)/C,l<0?l<-9.99999997475243e-7?null:0:l}}intersectsAxis(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(Z){case"y":{const Z=(this.origin.y-l)/this.direction.y;return Z>0?null:new K.ql(this.origin.x+this.direction.x*-Z,l,this.origin.z+this.direction.z*-Z)}case"x":{const Z=(this.origin.x-l)/this.direction.x;return Z>0?null:new K.ql(l,this.origin.y+this.direction.y*-Z,this.origin.z+this.direction.z*-Z)}case"z":{const Z=(this.origin.z-l)/this.direction.z;return Z>0?null:new K.ql(this.origin.x+this.direction.x*-Z,this.origin.y+this.direction.y*-Z,l)}default:return null}}intersectsMesh(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const f=K.TmpVectors.Matrix[0];return Z.getWorldMatrix().invertToRef(f),this._tmpRay?a.TransformToRef(this,f,this._tmpRay):this._tmpRay=a.Transform(this,f),Z.intersects(this._tmpRay,l,C,B,x,b)}intersectsMeshes(Z,l,C){C?C.length=0:C=[];for(let B=0;B<Z.length;B++){const x=this.intersectsMesh(Z[B],l);x.hit&&C.push(x)}return C.sort(this._comparePickingInfo),C}_comparePickingInfo(Z,l){return Z.distance<l.distance?-1:Z.distance>l.distance?1:0}intersectionSegment(Z,l,C){const B=this.origin,x=K.TmpVectors.ql[0],b=K.TmpVectors.ql[1],f=K.TmpVectors.ql[2],W=K.TmpVectors.ql[3];l.subtractToRef(Z,x),this.direction.scaleToRef(a._Rayl,f),B.addToRef(f,b),Z.subtractToRef(B,W);const J=K.ql.Dot(x,x),d=K.ql.Dot(x,f),E=K.ql.Dot(f,f),G=K.ql.Dot(x,W),q=K.ql.Dot(f,W),z=J*E-d*d;let Y,P,S=z,i=z;z<a._Smallnum?(Y=0,S=1,P=q,i=E):(Y=d*q-E*G,P=J*q-d*G,Y<0?(Y=0,P=q,i=E):Y>S&&(Y=S,P=q+d,i=E)),P<0?(P=0,-G<0?Y=0:-G>J?Y=S:(Y=-G,S=J)):P>i&&(P=i,-G+d<0?Y=0:-G+d>J?Y=S:(Y=-G+d,S=J));const s=Math.abs(Y)<a._Smallnum?0:Y/S,F=Math.abs(P)<a._Smallnum?0:P/i,n=K.TmpVectors.ql[4];f.scaleToRef(F,n);const c=K.TmpVectors.ql[5];x.scaleToRef(s,c),c.addInPlace(W);const U=K.TmpVectors.ql[6];c.subtractToRef(n,U);return F>0&&F<=this.length&&U.lengthSquared()<C*C?c.length():-1}update(Z,l,C,B,x,b,f){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){a._RayDistant||(a._RayDistant=a.Zero()),a._RayDistant.unprojectRayToRef(Z,l,C,B,K.Matrix.IdentityReadOnly,b,f);const W=K.TmpVectors.Matrix[0];x.invertToRef(W),a.TransformToRef(a._RayDistant,W,this)}else this.unprojectRayToRef(Z,l,C,B,x,b,f);return this}static Zero(){return new a(K.ql.Zero(),K.ql.Zero())}static CreateNew(Z,l,C,B,x,b,K){return a.Zero().update(Z,l,C,B,x,b,K)}static CreateNewFromTo(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.Matrix.IdentityReadOnly;const B=new a(new K.ql(0,0,0),new K.ql(0,0,0));return a.CreateFromToToRef(Z,l,B,C)}static CreateFromToToRef(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.Matrix.IdentityReadOnly;C.origin.B(Z);const x=l.subtractToRef(Z,C.direction),b=Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z);return C.length=b,C.direction.normalize(),a.TransformToRef(C,B,C)}static Transform(Z,l){const C=new a(new K.ql(0,0,0),new K.ql(0,0,0));return a.TransformToRef(Z,l,C),C}static TransformToRef(Z,l,C){K.ql.TransformCoordinatesToRef(Z.origin,l,C.origin),K.ql.TransformNormalToRef(Z.direction,l,C.direction),C.length=Z.length,C.epsilon=Z.epsilon;const B=C.direction,x=B.length();if(0!==x&&1!==x){const Z=1/x;B.x*=Z,B.y*=Z,B.z*=Z,C.length*=x}return C}unprojectRayToRef(Z,l,C,B,x,b,f){const W=K.TmpVectors.Matrix[0];x.multiplyToRef(b,W),W.multiplyToRef(f,W),W.invert();const J=d.b.LastCreatedEngine,E=K.TmpVectors.ql[0];E.x=Z/C*2-1,E.y=-(l/B*2-1),E.z=null!==J&&void 0!==J&&J.lb?1:null!==J&&void 0!==J&&J.isNDCHalfZRange?0:-1;const G=K.TmpVectors.ql[1].rb(E.x,E.y,1-1e-8),a=K.TmpVectors.ql[2],q=K.TmpVectors.ql[3];K.ql._UnprojectFromInvertedMatrixToRef(E,W,a),K.ql._UnprojectFromInvertedMatrixToRef(G,W,q),this.origin.B(a),q.subtractToRef(a,this.direction),this.direction.normalize()}}function q(Z,l,C,B,x){let b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const K=a.Zero();return z(Z,l,C,B,K,x,b),K}function z(Z,l,C,B,x,b){let f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const J=Z.getEngine();if(!b&&!(b=Z.activeCamera))return Z;const d=b.viewport,E=J.getRenderHeight(),{x:G,y:a,width:q,height:z}=d.toGlobal(J.getRenderWidth(),E),Y=1/J.getHardwareScalingLevel();return l=l*Y-G,C=C*Y-(E-a-z),x.update(l,C,q,z,B||K.Matrix.IdentityReadOnly,f?K.Matrix.IdentityReadOnly:b.getViewMatrix(),b.getProjectionMatrix(),W),Z}function Y(Z,l,C,B,x){if(!J.e)return Z;const b=Z.getEngine();if(!x&&!(x=Z.activeCamera))throw new Error("Active camera not set");const f=x.viewport,W=b.getRenderHeight(),{x:d,y:E,width:G,height:a}=f.toGlobal(b.getRenderWidth(),W),q=K.Matrix.Identity(),z=1/b.getHardwareScalingLevel();return l=l*z-d,C=C*z-(W-E-a),B.update(l,C,G,a,q,q,x.getProjectionMatrix()),Z}function P(Z,l,C,B,x,b,K,f){const W=l(B,C.enableDistantPicking),J=C.intersects(W,x,K,b,B,f);return J&&J.hit?!x&&null!=Z&&J.distance>=Z.distance?null:J:null}function S(Z,l,C,B,x,b){let f=null;const W=!!(Z.activeCameras&&Z.activeCameras.length>1&&Z.cameraToUseForPointers!==Z.activeCamera),d=Z.cameraToUseForPointers||Z.activeCamera,E=G.internalPickerForMesh||P;for(let J=0;J<Z.meshes.length;J++){const G=Z.meshes[J];if(C){if(!C(G,-1))continue}else if(!G.isEnabled()||!G.isVisible||!G.rJ)continue;const a=W&&G.isWorldMatrixCameraDependent(),q=G.Fb(a,d);if(G.hasThinInstances&&G.ad){const Z=E(f,l,G,q,!0,!0,b);if(Z){if(x)return Z;const W=K.TmpVectors.Matrix[1],J=G.thinInstanceGetWorldMatrices();for(let Z=0;Z<J.length;Z++){if(C&&!C(G,Z))continue;J[Z].multiplyToRef(q,W);const K=E(f,l,G,W,B,x,b,!0);if(K&&(f=K,f.thinInstanceIndex=Z,B))return f}}}else{const Z=E(f,l,G,q,B,x,b);if(Z&&(f=Z,B))return f}}return f||new J.e}function i(Z,l,C,B){if(!J.e)return null;const x=[],b=!!(Z.activeCameras&&Z.activeCameras.length>1&&Z.cameraToUseForPointers!==Z.activeCamera),f=Z.cameraToUseForPointers||Z.activeCamera,W=G.internalPickerForMesh||P;for(let J=0;J<Z.meshes.length;J++){const d=Z.meshes[J];if(C){if(!C(d,-1))continue}else if(!d.isEnabled()||!d.isVisible||!d.rJ)continue;const E=b&&d.isWorldMatrixCameraDependent(),G=d.Fb(E,f);if(d.hasThinInstances&&d.ad){if(W(null,l,d,G,!0,!0,B)){const Z=K.TmpVectors.Matrix[1],b=d.thinInstanceGetWorldMatrices();for(let K=0;K<b.length;K++){if(C&&!C(d,K))continue;b[K].multiplyToRef(G,Z);const f=W(null,l,d,Z,!1,!1,B,!0);f&&(f.thinInstanceIndex=K,x.push(f))}}}else{const Z=W(null,l,d,G,!1,!1,B);Z&&x.push(Z)}}return x}function s(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,B=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0;B||(B=Z.getWorldMatrix()),l.length=C,x?l.origin.B(x):l.origin.B(Z.position);const b=K.TmpVectors.ql[2];b.set(0,0,Z._scene.useRightHandedSystem?-1:1);const f=K.TmpVectors.ql[3];return K.ql.TransformNormalToRef(b,B,f),K.ql.NormalizeToRef(f,l.direction),l}var F,n;a._TmpVector3=(0,f.b)(6,K.ql.Zero),a._RayDistant=a.Zero(),a._Smallnum=1e-8,a._Rayl=1e9,F=B.e,(n=x.d)&&(n.prototype.getForwardRay=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,l=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;return s(this,new a(K.ql.Zero(),K.ql.Zero(),Z),Z,l,C)},n.prototype.getForwardRayToRef=function(Z){return s(this,Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),F&&(E.c._IsPickingAvailable=!0,F.prototype.createPickingRay=function(Z,l,C,B){return q(this,Z,l,C,B,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),B.e.prototype.createPickingRayToRef=function(Z,l,C,B,x){return z(this,Z,l,C,B,x,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},B.e.prototype.createPickingRayInCameraSpace=function(Z,l,C){return function(Z,l,C,B){const x=a.Zero();return Y(Z,l,C,x,B),x}(this,Z,l,C)},B.e.prototype.createPickingRayInCameraSpaceToRef=function(Z,l,C,B){return Y(this,Z,l,C,B)},B.e.prototype.pickWithBoundingInfo=function(Z,l,C,B,x){return function(Z,l,C,B,x,b){if(!J.e)return null;const f=S(Z,(B=>(Z._tempPickingRay||(Z._tempPickingRay=a.Zero()),z(Z,l,C,B,Z._tempPickingRay,b||null),Z._tempPickingRay)),B,x,!0);return f&&(f.ray=q(Z,l,C,K.Matrix.Identity(),b||null)),f}(this,Z,l,C,B,x)},B.e.prototype.GC=function(Z,l,C,B,x,b){return function(Z,l,C,B,x,b,f){const W=S(Z,((B,x)=>(Z._tempPickingRay||(Z._tempPickingRay=a.Zero()),z(Z,l,C,B,Z._tempPickingRay,b||null,!1,x),Z._tempPickingRay)),B,x,!1,f);return W&&(W.ray=q(Z,l,C,K.Matrix.Identity(),b||null)),W}(this,Z,l,C,B,x,b)},B.e.prototype.pickWithRay=function(Z,l,C,B){return function(Z,l,C,B,x){const b=S(Z,(C=>(Z._pickWithRayInverseMatrix||(Z._pickWithRayInverseMatrix=K.Matrix.Identity()),C.invertToRef(Z._pickWithRayInverseMatrix),Z._cachedRayForTransform||(Z._cachedRayForTransform=a.Zero()),a.TransformToRef(l,Z._pickWithRayInverseMatrix,Z._cachedRayForTransform),Z._cachedRayForTransform)),C,B,!1,x);return b&&(b.ray=l),b}(this,Z,l,C,B)},B.e.prototype.multiPick=function(Z,l,C,B,x){return function(Z,l,C,B,x,b){return i(Z,(B=>q(Z,l,C,B,x||null)),B,b)}(this,Z,l,C,B,x)},B.e.prototype.multiPickWithRay=function(Z,l,C){return function(Z,l,C,B){return i(Z,(C=>(Z._pickWithRayInverseMatrix||(Z._pickWithRayInverseMatrix=K.Matrix.Identity()),C.invertToRef(Z._pickWithRayInverseMatrix),Z._cachedRayForTransform||(Z._cachedRayForTransform=a.Zero()),a.TransformToRef(l,Z._pickWithRayInverseMatrix,Z._cachedRayForTransform),Z._cachedRayForTransform)),C,B)}(this,Z,l,C)}},13801:(Z,l,C)=>{"use strict";var B=C(12382),x=C(12263),b=C(12298),K=C(12403),f=C(12346),W=C(12389);f.d.prototype._partialLoadFile=function(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(Z,(Z=>{C[l]=Z,C._internalCount++,6===C._internalCount&&B(C)}),void 0,void 0,!0,((Z,l)=>{x&&Z&&x(Z.status+" "+Z.statusText,l)}))},f.d.prototype._cascadeLoadFiles=function(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const x=[];x._internalCount=0;for(let b=0;b<6;b++)this._partialLoadFile(C[b],b,x,l,B)},f.d.prototype._cascadeLoadImgs=function(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5?arguments[5]:void 0;const K=[];K._internalCount=0;for(let f=0;f<6;f++)this._partialLoadImg(B[f],f,K,Z,l,C,x,b)},f.d.prototype._partialLoadImg=function(Z,l,C,B,x,f){let W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0;const d=(0,K.d)();(0,b.p)(Z,(Z=>{C[l]=Z,C._internalCount++,B&&B.removePendingData(d),6===C._internalCount&&f&&f(x,C)}),((Z,l)=>{B&&B.removePendingData(d),W&&W(Z,l)}),B?B.offlineProvider:null,J),B&&B.addPendingData(d)},f.d.prototype.createCubeTextureBase=function(Z,l,C,b){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6?arguments[6]:void 0,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8],G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,a=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,Y=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,P=arguments.length>14&&void 0!==arguments[14]&&arguments[14],S=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const i=q||new B.c(this,7);i.isCube=!0,i.url=Z,i.generateMipMaps=!b,i._lodGenerationScale=G,i._lodGenerationOffset=a,i._useSRGBBuffer=!!P&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!b),i!==q&&(i.label=Z.substring(0,60)),this._doNotHandleContextLost||(i._extension=d,i._files=C,i._buffer=S);const s=Z;this._transformTextureUrl&&!q&&(Z=this._transformTextureUrl(Z));const F=d??function(Z){const l=Z.split("?")[0],C=l.lastIndexOf(".");return C>-1?l.substring(C).toLowerCase():""}(Z),n=(0,W.d)(F),c=(Z,l)=>{i.dispose(),f?f(Z,l):Z&&x.e.Warn(Z)},U=(B,f)=>{Z===s?B&&c(B.status+" "+B.statusText,f):(x.e.Warn(`Failed to load ${Z}, falling back to the ${s}`),this.createCubeTextureBase(s,l,C,!!b,K,c,J,d,E,G,a,i,z,Y,P,S))};if(n)n.then((B=>{const x=Z=>{z&&z(i,Z),B.loadCubeData(Z,i,E,K,((Z,l)=>{c(Z,l)}))};S?x(S):C&&6===C.length?B.supportCascades?this._cascadeLoadFiles(l,(Z=>x(Z.map((Z=>new Uint8Array(Z))))),C,c):c("Textures type does not support cascades."):this._loadFile(Z,(Z=>x(new Uint8Array(Z))),void 0,void 0,!0,U)}));else{if(!C||0===C.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(l,i,((Z,l)=>{Y&&Y(Z,l)}),C,c)}return this._internalTexturesCache.push(i),i}},14341:(Z,l,C)=>{"use strict";C(12263);var B=C(12589);C(12382),C(12538),C(12379),C(12639),C(12599);B.d},13828:(Z,l,C)=>{"use strict";C.d(l,{b:()=>x});var B=C(12400);class x{constructor(Z){this.value=this._toInt(Z)}_toInt(Z){return 0|Z}add(Z){return new x(this.value+Z.value)}zl(Z){return new x(this.value-Z.value)}multiply(Z){return new x(Math.imul(this.value,Z.value))}divide(Z){return new x(this.value/Z.value)}getClassName(){return x.ClassName}equals(Z){return this.value===Z.value}static FromValue(Z){return new x(Z)}toString(){return this.value.toString()}}x.ClassName="FlowGraphInteger",(0,B.c)("FlowGraphInteger",x)},13838:(Z,l,C)=>{"use strict";C.d(l,{b:()=>x,f:()=>b});var B=C(12442);class x{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Kb=Z}get m(){return this.Kb}transformVector(Z){return this.transformVectorToRef(Z,new B.Vector2)}transformVectorToRef(Z,l){return l.x=Z.x*this.Kb[0]+Z.y*this.Kb[1],l.y=Z.x*this.Kb[2]+Z.y*this.Kb[3],l}Yb(){return this.toArray()}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let l=0;l<4;l++)Z[l]=this.Kb[l];return Z}aC(Z){for(let l=0;l<4;l++)this.Kb[l]=Z[l];return this}multiplyToRef(Z,l){const C=Z.Kb,B=this.Kb,x=l.Kb;return x[0]=C[0]*B[0]+C[1]*B[2],x[1]=C[0]*B[1]+C[1]*B[3],x[2]=C[2]*B[0]+C[3]*B[2],x[3]=C[2]*B[1]+C[3]*B[3],l}multiply(Z){return this.multiplyToRef(Z,new x)}divideToRef(Z,l){const C=this.Kb,B=Z.Kb,x=l.Kb;return x[0]=C[0]/B[0],x[1]=C[1]/B[1],x[2]=C[2]/B[2],x[3]=C[3]/B[3],l}divide(Z){return this.divideToRef(Z,new x)}addToRef(Z,l){const C=this.Kb,B=Z.m,x=l.m;return x[0]=C[0]+B[0],x[1]=C[1]+B[1],x[2]=C[2]+B[2],x[3]=C[3]+B[3],l}add(Z){return this.addToRef(Z,new x)}subtractToRef(Z,l){const C=this.Kb,B=Z.m,x=l.m;return x[0]=C[0]-B[0],x[1]=C[1]-B[1],x[2]=C[2]-B[2],x[3]=C[3]-B[3],l}zl(Z){return this.subtractToRef(Z,new x)}transpose(){const Z=this.Kb;return new x([Z[0],Z[2],Z[1],Z[3]])}determinant(){const Z=this.Kb;return Z[0]*Z[3]-Z[1]*Z[2]}inverse(){const Z=this.determinant();if(0===Z)throw new Error("Matrix is not invertible");const l=this.Kb,C=1/Z;return new x([l[3]*C,-l[1]*C,-l[2]*C,l[0]*C])}equals(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.Kb,B=Z.m;return 0===l?C[0]===B[0]&&C[1]===B[1]&&C[2]===B[2]&&C[3]===B[3]:Math.abs(C[0]-B[0])<l&&Math.abs(C[1]-B[1])<l&&Math.abs(C[2]-B[2])<l&&Math.abs(C[3]-B[3])<l}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Kb.join(", ")})`}}class b{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Kb=Z}get m(){return this.Kb}transformVector(Z){return this.transformVectorToRef(Z,new B.ql)}transformVectorToRef(Z,l){const C=this.Kb;return l.x=Z.x*C[0]+Z.y*C[1]+Z.z*C[2],l.y=Z.x*C[3]+Z.y*C[4]+Z.z*C[5],l.z=Z.x*C[6]+Z.y*C[7]+Z.z*C[8],l}multiplyToRef(Z,l){const C=Z.Kb,B=this.Kb,x=l.m;return x[0]=C[0]*B[0]+C[1]*B[3]+C[2]*B[6],x[1]=C[0]*B[1]+C[1]*B[4]+C[2]*B[7],x[2]=C[0]*B[2]+C[1]*B[5]+C[2]*B[8],x[3]=C[3]*B[0]+C[4]*B[3]+C[5]*B[6],x[4]=C[3]*B[1]+C[4]*B[4]+C[5]*B[7],x[5]=C[3]*B[2]+C[4]*B[5]+C[5]*B[8],x[6]=C[6]*B[0]+C[7]*B[3]+C[8]*B[6],x[7]=C[6]*B[1]+C[7]*B[4]+C[8]*B[7],x[8]=C[6]*B[2]+C[7]*B[5]+C[8]*B[8],l}multiply(Z){return this.multiplyToRef(Z,new b)}divideToRef(Z,l){const C=this.Kb,B=Z.m,x=l.m;return x[0]=C[0]/B[0],x[1]=C[1]/B[1],x[2]=C[2]/B[2],x[3]=C[3]/B[3],x[4]=C[4]/B[4],x[5]=C[5]/B[5],x[6]=C[6]/B[6],x[7]=C[7]/B[7],x[8]=C[8]/B[8],l}divide(Z){return this.divideToRef(Z,new b)}addToRef(Z,l){const C=this.Kb,B=Z.m,x=l.m;return x[0]=C[0]+B[0],x[1]=C[1]+B[1],x[2]=C[2]+B[2],x[3]=C[3]+B[3],x[4]=C[4]+B[4],x[5]=C[5]+B[5],x[6]=C[6]+B[6],x[7]=C[7]+B[7],x[8]=C[8]+B[8],l}add(Z){return this.addToRef(Z,new b)}subtractToRef(Z,l){const C=this.Kb,B=Z.m,x=l.m;return x[0]=C[0]-B[0],x[1]=C[1]-B[1],x[2]=C[2]-B[2],x[3]=C[3]-B[3],x[4]=C[4]-B[4],x[5]=C[5]-B[5],x[6]=C[6]-B[6],x[7]=C[7]-B[7],x[8]=C[8]-B[8],l}zl(Z){return this.subtractToRef(Z,new b)}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let l=0;l<9;l++)Z[l]=this.Kb[l];return Z}Yb(){return this.toArray()}aC(Z){for(let l=0;l<9;l++)this.Kb[l]=Z[l];return this}transpose(){const Z=this.Kb;return new b([Z[0],Z[3],Z[6],Z[1],Z[4],Z[7],Z[2],Z[5],Z[8]])}determinant(){const Z=this.Kb;return Z[0]*(Z[4]*Z[8]-Z[5]*Z[7])-Z[1]*(Z[3]*Z[8]-Z[5]*Z[6])+Z[2]*(Z[3]*Z[7]-Z[4]*Z[6])}inverse(){const Z=this.determinant();if(0===Z)throw new Error("Matrix is not invertible");const l=this.Kb,C=1/Z;return new b([(l[4]*l[8]-l[5]*l[7])*C,(l[2]*l[7]-l[1]*l[8])*C,(l[1]*l[5]-l[2]*l[4])*C,(l[5]*l[6]-l[3]*l[8])*C,(l[0]*l[8]-l[2]*l[6])*C,(l[2]*l[3]-l[0]*l[5])*C,(l[3]*l[7]-l[4]*l[6])*C,(l[1]*l[6]-l[0]*l[7])*C,(l[0]*l[4]-l[1]*l[3])*C])}equals(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.Kb,B=Z.m;return 0===l?C[0]===B[0]&&C[1]===B[1]&&C[2]===B[2]&&C[3]===B[3]&&C[4]===B[4]&&C[5]===B[5]&&C[6]===B[6]&&C[7]===B[7]&&C[8]===B[8]:Math.abs(C[0]-B[0])<l&&Math.abs(C[1]-B[1])<l&&Math.abs(C[2]-B[2])<l&&Math.abs(C[3]-B[3])<l&&Math.abs(C[4]-B[4])<l&&Math.abs(C[5]-B[5])<l&&Math.abs(C[6]-B[6])<l&&Math.abs(C[7]-B[7])<l&&Math.abs(C[8]-B[8])<l}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Kb.join(", ")})`}}},13842:(Z,l,C)=>{"use strict";var B;function x(Z,l,C,B){switch(l){case"Animation":return B?Z.animations.find((Z=>Z.uniqueId===C))??null:Z.animations[C]??null;case"AnimationGroup":return B?Z.animationGroups.find((Z=>Z.uniqueId===C))??null:Z.animationGroups[C]??null;case"Mesh":return B?Z.meshes.find((Z=>Z.uniqueId===C))??null:Z.meshes[C]??null;case"Material":return B?Z.materials.find((Z=>Z.uniqueId===C))??null:Z.materials[C]??null;case"sE":return B?Z.cameras.find((Z=>Z.uniqueId===C))??null:Z.cameras[C]??null;case"Light":return B?Z.lights.find((Z=>Z.uniqueId===C))??null:Z.lights[C]??null;default:return null}}C.d(l,{e:()=>x}),function(Z){Z.Animation="Animation",Z.AnimationGroup="AnimationGroup",Z.Mesh="Mesh",Z.Material="Material",Z.sE="sE",Z.Light="Light"}(B||(B={}))},13866:(Z,l,C)=>{"use strict";C.d(l,{e:()=>x});var B=C(13869);class x extends B.c{constructor(Z,l){if(super(Z),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),l)for(const C of l)this._eventsSignalOutputs[C]=this._registerSignalOutput(C+"Event")}_executeOnTick(Z){}_startPendingTasks(Z){Z._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(Z),this._resetAfterCanceled(Z)),this._preparePendingTasks(Z),Z._addPendingBlock(this),this.out._activateSignal(Z),Z._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(Z){Z._deleteExecutionVariable(this,"_initialized"),Z._removePendingBlock(this)}}},13853:(Z,l,C)=>{"use strict";C.d(l,{d:()=>J});var B=C(12403),x=C(12400),b=C(13857),K=C(12251),f=C(13824);class W extends b.b{constructor(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:B.defaultValue,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(Z,l,C),this.richType=B,this._defaultValue=x,this._optional=b,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new K.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(Z){this._isDisabled!==Z&&(this._isDisabled=Z,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(Z,l){l._getConnectionValue(this)!==Z&&(l._setConnectionValue(this,Z),this.onValueChangedObservable.notifyObservers(Z))}resetToDefaultValue(Z){Z._setConnectionValue(this,this._defaultValue)}connectTo(Z){this._isDisabled||super.connectTo(Z)}_getValueOrDefault(Z){const l=Z._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(l):l}getValue(Z){if(1===this.connectionType){Z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(Z);const l=this._getValueOrDefault(Z);return this._lastValue=l,this.richType.typeTransformer?this.richType.typeTransformer(l):l}const l=this.isConnected()?this._connectedPoint[0].getValue(Z):this._getValueOrDefault(Z);return this._lastValue=l,this.richType.typeTransformer?this.richType.typeTransformer(l):l}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Z),Z.richType={},this.richType.serialize(Z.richType),Z.optional=this._optional,(0,f.f)("defaultValue",this._defaultValue,Z)}}(0,x.c)("FlowGraphDataConnection",W);class J{constructor(Z){var l;this.config=Z,this.uniqueId=(0,B.d)(),this.name=(null===(l=this.config)||void 0===l?void 0:l.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(Z){}registerDataInput(Z,l,C){const B=new W(Z,0,this,l,C);return this.dataInputs.push(B),B}registerDataOutput(Z,l,C){const B=new W(Z,1,this,l,C);return this.dataOutputs.push(B),B}getDataInput(Z){return this.dataInputs.find((l=>l.name===Z))}getDataOutput(Z){return this.dataOutputs.find((l=>l.name===Z))}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.f;if(Z.uniqueId=this.uniqueId,Z.config={},this.config){const C=this.config,B=Object.keys(C);for(const x of B)l(x,C[x],Z.config)}Z.dataInputs=[],Z.dataOutputs=[],Z.className=this.getClassName();for(const C of this.dataInputs){const l={};C.serialize(l),Z.dataInputs.push(l)}for(const C of this.dataOutputs){const l={};C.serialize(l),Z.dataOutputs.push(l)}}deserialize(Z){}_log(Z,l,C){var B;null===(B=Z.logger)||void 0===B||B.addLogItem({action:l,qC:C,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13857:(Z,l,C)=>{"use strict";C.d(l,{b:()=>b});var B,x=C(12403);!function(Z){Z[Z.Input=0]="Input",Z[Z.Output=1]="Output"}(B||(B={}));class b{constructor(Z,l,C){this._ownerBlock=C,this._connectedPoint=[],this.uniqueId=(0,x.d)(),this.connectedPointIds=[],this.name=Z,this._connectionType=l}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(Z){if(this._connectionType===Z._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||Z._isSingularConnection()&&Z._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(Z),Z._connectedPoint.push(this)}disconnectFrom(Z){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=this._connectedPoint.indexOf(Z),B=Z._connectedPoint.indexOf(this);-1!==C&&-1!==B&&(l&&this._connectedPoint.splice(C,1),Z._connectedPoint.splice(B,1))}disconnectFromAll(){for(const Z of this._connectedPoint)this.disconnectFrom(Z,!1);this._connectedPoint.length=0}dispose(){for(const Z of this._connectedPoint)this.disconnectFrom(Z)}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Z.uniqueId=this.uniqueId,Z.name=this.name,Z._connectionType=this._connectionType,Z.connectedPointIds=[],Z.className=this.getClassName();for(const l of this._connectedPoint)Z.connectedPointIds.push(l.uniqueId)}getClassName(){return"FGConnection"}deserialize(Z){this.uniqueId=Z.uniqueId,this.name=Z.name,this._connectionType=Z._connectionType,this.connectedPointIds=Z.connectedPointIds}}},13820:(Z,l,C)=>{"use strict";C.d(l,{d:()=>i});var B,x=C(12251),b=C(12428),K=C(12432),f=C(12403),W=C(13824),J=C(13842),d=C(12263);!function(Z){Z.ExecuteBlock="ExecuteBlock",Z.ExecuteEvent="ExecuteEvent",Z.TriggerConnection="TriggerConnection",Z.ContextVariableSet="ContextVariableSet",Z.GlobalVariableSet="GlobalVariableSet",Z.GlobalVariableDelete="GlobalVariableDelete",Z.GlobalVariableGet="GlobalVariableGet",Z.AddConnection="AddConnection",Z.GetConnectionValue="GetConnectionValue",Z.SetConnectionValue="SetConnectionValue",Z.ActivateSignal="ActivateSignal",Z.ContextVariableGet="ContextVariableGet"}(B||(B={}));class E{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(Z){if(Z.time||(Z.time=Date.now()),this.log.push(Z),this.logToConsole){var l;const C=null===(l=Z.qC)||void 0===l?void 0:l.value;"object"===typeof C&&C.getClassName?d.e.Log(`[FGLog] ${Z.className}:${Z.uniqueId.split("-")[0]} ${Z.action} - ${JSON.stringify(C.getClassName())}: ${C.toString()}`):d.e.Log(`[FGLog] ${Z.className}:${Z.uniqueId.split("-")[0]} ${Z.action} - ${JSON.stringify(Z.qC)}`)}}getItemsOfType(Z){return this.log.filter((l=>l.action===Z))}}class G{get enableLogging(){return this._enableLogging}set enableLogging(Z){this._enableLogging!==Z&&(this._enableLogging=Z,this._enableLogging?(this.logger=new E,this.logger.logToConsole=!0):this.logger=null)}constructor(Z){this.uniqueId=(0,f.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new x.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=Z,this.assetsContext=Z.assetsContext??Z.Yl}hasVariable(Z){return Z in this._userVariables}setVariable(Z,l){var C;this._userVariables[Z]=l,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",qC:{name:Z,value:l}})}getAsset(Z,l){return(0,J.e)(this.assetsContext,Z,l)}getVariable(Z){var l;return null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",qC:{name:Z,value:this._userVariables[Z]}}),this._userVariables[Z]}get userVariables(){return this._userVariables}cZ(){return this._configuration.Yl}_getUniqueIdPrefixedName(Z,l){return`${Z.uniqueId}_${l}`}_getGlobalContextVariable(Z,l){var C;return null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",qC:{name:Z,defaultValue:l,possibleValue:this._globalContextVariables[Z]}}),this._hasGlobalContextVariable(Z)?this._globalContextVariables[Z]:l}_setGlobalContextVariable(Z,l){var C;null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",qC:{name:Z,value:l}}),this._globalContextVariables[Z]=l}_deleteGlobalContextVariable(Z){var l;null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",qC:{name:Z}}),delete this._globalContextVariables[Z]}_hasGlobalContextVariable(Z){return Z in this._globalContextVariables}_setExecutionVariable(Z,l,C){this._executionVariables[this._getUniqueIdPrefixedName(Z,l)]=C}_getExecutionVariable(Z,l,C){return this._hasExecutionVariable(Z,l)?this._executionVariables[this._getUniqueIdPrefixedName(Z,l)]:C}_deleteExecutionVariable(Z,l){delete this._executionVariables[this._getUniqueIdPrefixedName(Z,l)]}_hasExecutionVariable(Z,l){return this._getUniqueIdPrefixedName(Z,l)in this._executionVariables}_hasConnectionValue(Z){return Z.uniqueId in this._connectionValues}_setConnectionValue(Z,l){var C;this._connectionValues[Z.uniqueId]=l,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",qC:{connectionPointId:Z.uniqueId,value:l}})}_setConnectionValueByKey(Z,l){this._connectionValues[Z]=l}_getConnectionValue(Z){var l;return null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",qC:{connectionPointId:Z.uniqueId,value:this._connectionValues[Z.uniqueId]}}),this._connectionValues[Z.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(Z){this._pendingBlocks.includes(Z)||(this._pendingBlocks.push(Z),this._pendingBlocks.sort(((Z,l)=>Z.priority-l.priority)))}_removePendingBlock(Z){const l=this._pendingBlocks.indexOf(Z);-1!==l&&this._pendingBlocks.splice(l,1)}_clearPendingBlocks(){for(const Z of this._pendingBlocks)Z._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(Z){var l;this.onNodeExecutedObservable.notifyObservers(Z),null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:Z.getClassName(),uniqueId:Z.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(Z){this._setGlobalContextVariable("timeSinceStart",Z.timeSinceStart),this._setGlobalContextVariable("deltaTime",Z.deltaTime);for(const C of this._pendingBlocks){var l;null===(l=C._executeOnTick)||void 0===l||l.call(C,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.f;Z.uniqueId=this.uniqueId,Z._userVariables={};for(const B in this._userVariables)l(B,this._userVariables[B],Z._userVariables);Z._connectionValues={};for(const B in this._connectionValues)l(B,this._connectionValues[B],Z._connectionValues);var C;this.assetsContext!==this.cZ()&&(Z._assetsContext={meshes:this.assetsContext.meshes.map((Z=>Z.id)),materials:this.assetsContext.materials.map((Z=>Z.id)),textures:this.assetsContext.textures.map((Z=>Z.name)),animations:this.assetsContext.animations.map((Z=>Z.name)),lights:this.assetsContext.lights.map((Z=>Z.id)),cameras:this.assetsContext.cameras.map((Z=>Z.id)),Da:null===(C=this.assetsContext.Da)||void 0===C?void 0:C.map((Z=>Z.name)),skeletons:this.assetsContext.skeletons.map((Z=>Z.id)),Ka:this.assetsContext.Ka.map((Z=>Z.name)),geometries:this.assetsContext.geometries.map((Z=>Z.id)),multiMaterials:this.assetsContext.multiMaterials.map((Z=>Z.id)),transformNodes:this.assetsContext.transformNodes.map((Z=>Z.id))})}getClassName(){return"FlowGraphContext"}}(0,b.b)([(0,K.R)()],G.prototype,"uniqueId",void 0);var a=C(13844),q=C(12739);class z{constructor(Z){this.onEventTriggeredObservable=new x.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=Z,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.xb.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const Z=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",qC:{timeSinceStart:this._startingTime,deltaTime:Z}}),this._startingTime+=Z})),this._meshPickedObserver=this._scene.onPointerObservable.add((Z=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",qC:Z})}),q.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((Z=>{const l=Z.pointerId,C=Z.mesh,B=this._pointerUnderMeshState[l];!B&&C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",qC:{pointerId:l,mesh:C}}):B&&!C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",qC:{pointerId:l,mesh:B}}):B&&C&&B!==C&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",qC:{pointerId:l,mesh:B,over:C}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",qC:{pointerId:l,mesh:C,out:B}})),this._pointerUnderMeshState[l]=C}),q.d.POINTERMOVE)}dispose(){var Z,l,C,B,x;null===(Z=this._sceneDisposeObserver)||void 0===Z||Z.remove(),null===(l=this._sceneReadyObserver)||void 0===l||l.remove(),null===(C=this._sceneOnBeforeRenderObserver)||void 0===C||C.remove(),null===(B=this._meshPickedObserver)||void 0===B||B.remove(),null===(x=this._meshUnderPointerObserver)||void 0===x||x.remove(),this.onEventTriggeredObservable.clear()}}var Y,P=C(13861);!function(Z){Z[Z.Stopped=0]="Stopped",Z[Z.Started=1]="Started"}(Y||(Y={}));class S{get state(){return this._state}set state(Z){this._state=Z,this.onStateChangedObservable.notifyObservers(Z)}constructor(Z){this.onStateChangedObservable=new x.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=Z.Yl,this._sceneEventCoordinator=new z(this._scene),this._coordinator=Z.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((Z=>{for(const l of this._executionContexts){const C=this._getContextualOrder(Z.type,l);for(const B of C)if(!B._executeEvent(l,Z.qC))break}switch(Z.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const l of this._executionContexts)l._notifyOnTick(Z.qC);break;case"SceneDispose":this.dispose()}}))}createContext(){const Z=new G({Yl:this._scene,coordinator:this._coordinator});return this._executionContexts.push(Z),Z}getContext(Z){return this._executionContexts[Z]}addEventBlock(Z){if("PointerOver"!==Z.type&&"PointerOut"!==Z.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==Z.type&&this._eventBlocks[Z.type].push(Z),1===this.state)for(const l of this._executionContexts)Z._startPendingTasks(l);else this.onStateChangedObservable.addOnce((l=>{if(1===l)for(const C of this._executionContexts)Z._startPendingTasks(C)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((Z=>{1===Z&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const Z of this._executionContexts)for(const l in this._eventBlocks){const C=this._getContextualOrder(l,Z);for(const l of C)l._startPendingTasks(Z)}}_getContextualOrder(Z,l){const C=this._eventBlocks[Z].sort(((Z,l)=>l.initPriority-Z.initPriority));if("MeshPick"===Z){const Z=[];for(const B of C){const x=B.asset.getValue(l);let b=0;for(;b<C.length;b++){const Z=C[b].asset.getValue(l);if(x&&Z&&(0,P.j)(x,Z))break}Z.splice(b,0,B)}return Z}return C}dispose(){var Z;if(0!==this.state){this.state=0;for(const Z of this._executionContexts)Z._clearPendingBlocks();this._executionContexts.length=0;for(const Z in this._eventBlocks)this._eventBlocks[Z].length=0;null===(Z=this._eventObserver)||void 0===Z||Z.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(Z){const l=[],C=new Set;for(const B in this._eventBlocks)for(const Z of this._eventBlocks[B])l.push(Z),C.add(Z.uniqueId);for(;l.length>0;){const B=l.pop();Z(B);for(const Z of B.dataInputs)for(const B of Z._connectedPoint)C.has(B._ownerBlock.uniqueId)||(l.push(B._ownerBlock),C.add(B._ownerBlock.uniqueId));if(B instanceof a.e)for(const Z of B.signalOutputs)for(const B of Z._connectedPoint)C.has(B._ownerBlock.uniqueId)||(l.push(B._ownerBlock),C.add(B._ownerBlock.uniqueId))}}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1?arguments[1]:void 0;Z.allBlocks=[],this.visitAllBlocks((l=>{const C={};l.serialize(C),Z.allBlocks.push(C)})),Z.executionContexts=[];for(const C of this._executionContexts){const B={};C.serialize(B,l),Z.executionContexts.push(B)}}}class i{constructor(Z){this.config=Z,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Yl.xb.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Yl.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const Z=this._executeOnNextFrame.slice(0);if(Z.length)for(const l of Z){this.notifyCustomEvent(l.id,l.data,!1);const Z=this._executeOnNextFrame.findIndex((Z=>Z.uniqueId===l.uniqueId));-1!==Z&&this._executeOnNextFrame.splice(Z,1)}}));(i.SceneCoordinators.get(this.config.Yl)??[]).push(this)}createGraph(){const Z=new S({Yl:this.config.Yl,coordinator:this});return this._flowGraphs.push(Z),Z}removeGraph(Z){const l=this._flowGraphs.indexOf(Z);-1!==l&&(Z.dispose(),this._flowGraphs.splice(l,1))}start(){for(const Z of this._flowGraphs)Z.start()}dispose(){var Z,l;for(const x of this._flowGraphs)x.dispose();this._flowGraphs.length=0,null===(Z=this._disposeObserver)||void 0===Z||Z.remove(),null===(l=this._onBeforeRenderObserver)||void 0===l||l.remove();const C=i.SceneCoordinators.get(this.config.Yl)??[],B=C.indexOf(this);-1!==B&&C.splice(B,1)}serialize(Z,l){Z._flowGraphs=[];for(const C of this._flowGraphs){const B={};C.serialize(B,l),Z._flowGraphs.push(B)}Z.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(Z){let l=this._customEventsMap.get(Z);return l||(l=new x.b,this._customEventsMap.set(Z,l)),l}notifyCustomEvent(Z,l){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:Z,data:l,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(Z)){const l=this._eventExecutionCounter.get(Z);if(this._eventExecutionCounter.set(Z,l+1),l>=i.MaxEventTypeExecutionPerFrame)return void(l===i.MaxEventTypeExecutionPerFrame&&d.e.Warn(`FlowGraphCoordinator: Too many executions of event "${Z}".`))}else this._eventExecutionCounter.set(Z,1);const C=this._customEventsMap.get(Z);C&&C.notifyObservers(l)}}i.MaxEventsPerType=30,i.MaxEventTypeExecutionPerFrame=30,i.SceneCoordinators=new Map},13864:(Z,l,C)=>{"use strict";C.d(l,{d:()=>x});var B=C(13866);class x extends B.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(Z){Z._notifyExecuteNode(this),this.done._activateSignal(Z)}}},13844:(Z,l,C)=>{"use strict";C.d(l,{e:()=>f});var B=C(13853),x=C(13857),b=C(12400);class K extends x.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(Z){super.connectTo(Z),this._connectedPoint.sort(((Z,l)=>l.priority-Z.priority))}_activateSignal(Z){var l;if(null===(l=Z.logger)||void 0===l||l.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,qC:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)Z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(Z,this),Z._increaseExecutionId();else for(const C of this._connectedPoint)C._activateSignal(Z)}}(0,b.c)("FlowGraphSignalConnection",K);class f extends B.d{constructor(Z){super(Z),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(Z){const l=new K(Z,0,this);return this.signalInputs.push(l),l}_registerSignalOutput(Z){const l=new K(Z,1,this);return this.signalOutputs.push(l),l}_unregisterSignalInput(Z){const l=this.signalInputs.findIndex((l=>l.name===Z));-1!==l&&(this.signalInputs[l].dispose(),this.signalInputs.splice(l,1))}_unregisterSignalOutput(Z){const l=this.signalOutputs.findIndex((l=>l.name===Z));-1!==l&&(this.signalOutputs[l].dispose(),this.signalOutputs.splice(l,1))}_reportError(Z,l){this.error.qC="string"===typeof l?new Error(l):l,this.error._activateSignal(Z)}getSignalInput(Z){return this.signalInputs.find((l=>l.name===Z))}getSignalOutput(Z){return this.signalOutputs.find((l=>l.name===Z))}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Z),Z.signalInputs=[],Z.signalOutputs=[];for(const l of this.signalInputs){const C={};l.serialize(C),Z.signalInputs.push(C)}for(const l of this.signalOutputs){const C={};l.serialize(C),Z.signalOutputs.push(C)}}deserialize(Z){for(let l=0;l<Z.signalInputs.length;l++){const C=this.getSignalInput(Z.signalInputs[l].name);if(!C)throw new Error("Could not find signal input with name "+Z.signalInputs[l].name+" in block "+Z.className);C.deserialize(Z.signalInputs[l])}for(let l=0;l<Z.signalOutputs.length;l++){const C=this.getSignalOutput(Z.signalOutputs[l].name);if(!C)throw new Error("Could not find signal output with name "+Z.signalOutputs[l].name+" in block "+Z.className);C.deserialize(Z.signalOutputs[l])}}getClassName(){return"FlowGraphExecutionBlock"}}},13869:(Z,l,C)=>{"use strict";C.d(l,{c:()=>x});var B=C(13844);class x extends B.e{constructor(Z){super(Z),this.out=this._registerSignalOutput("out")}}},13830:(Z,l,C)=>{"use strict";C.d(l,{A:()=>z,D:()=>t,G:()=>r,I:()=>U,K:()=>c,c:()=>J,e:()=>G,i:()=>n,k:()=>Y,l:()=>P,n:()=>S,o:()=>E,p:()=>F,t:()=>d,w:()=>a,y:()=>q});var B,x=C(12442),b=C(12494),K=C(13828),f=C(13838);!function(Z){Z.Any="any",Z.String="string",Z.Number="number",Z.Boolean="boolean",Z.Object="object",Z.Integer="FlowGraphInteger",Z.Vector2="Vector2",Z.ql="ql",Z.Vector4="Vector4",Z.Quaternion="Quaternion",Z.Matrix="Matrix",Z.Matrix2D="Matrix2D",Z.Matrix3D="Matrix3D",Z.Sl="Sl",Z.Rb="Rb"}(B||(B={}));class W{constructor(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=Z,this.defaultValue=l,this.animationType=C}serialize(Z){Z.typeName=this.typeName,Z.defaultValue=this.defaultValue}}const J=new W("any",void 0),d=new W("string",""),E=new W("number",0,0),G=new W("boolean",!1),a=new W("Vector2",x.Vector2.Zero(),5),q=new W("ql",x.ql.Zero(),1),z=new W("Vector4",x.Vector4.Zero()),Y=new W("Matrix",x.Matrix.Identity(),3),P=new W("Matrix2D",new f.b),S=new W("Matrix3D",new f.f),i=new W("Sl",b.Sl.Black(),4),s=new W("Rb",new b.Rb(0,0,0,0),7),F=new W("Quaternion",x.Quaternion.Identity(),2);F.typeTransformer=Z=>{if(Z.getClassName){if("Vector4"===Z.getClassName())return x.Quaternion.il(Z.Yb());if("ql"===Z.getClassName())return x.Quaternion.FromEulerVector(Z);if("Matrix"===Z.getClassName())return x.Quaternion.FromRotationMatrix(Z)}return Z};const n=new W("FlowGraphInteger",new K.b(0),0);function c(Z){const l=Z;switch(typeof Z){case"string":return d;case"number":return E;case"boolean":return G;case"object":if(l.getClassName)switch(l.getClassName()){case"Vector2":return a;case"ql":return q;case"Vector4":return z;case"Matrix":return Y;case"Sl":return i;case"Rb":return s;case"Quaternion":return F;case"FlowGraphInteger":return n;case"Matrix2D":return P;case"Matrix3D":return S}return J;default:return J}}function U(Z){switch(Z){case"string":return d;case"number":return E;case"boolean":return G;case"Vector2":return a;case"ql":return q;case"Vector4":return z;case"Matrix":return Y;case"Sl":return i;case"Rb":return s;case"Quaternion":return F;case"FlowGraphInteger":return n;case"Matrix2D":return P;case"Matrix3D":return S;default:return J}}function t(Z){switch(Z){case"number":default:return 0;case"Vector2":return 5;case"ql":return 1;case"Matrix":return 3;case"Sl":return 4;case"Rb":return 7;case"Quaternion":return 2}}function r(Z){switch(Z){case 0:return E;case 5:return a;case 1:return q;case 3:return Y;case 4:return i;case 7:return s;case 2:return F;default:return J}}},13824:(Z,l,C)=>{"use strict";C.d(l,{e:()=>d,f:()=>J,i:()=>E});var B=C(12494),x=C(12442),b=C(13828),K=C(13830),f=C(13838);function W(Z){return"Vector2"===Z||"ql"===Z||"Vector4"===Z||"Quaternion"===Z||"Sl"===Z||"Rb"===Z}function J(Z,l,C){var B;const x=(null===l||void 0===l||null===(B=l.getClassName)||void 0===B?void 0:B.call(l))??"";if(W(x)||function(Z){return"Matrix"===Z||"Matrix2D"===Z||"Matrix3D"===Z}(x))C[Z]={value:l.Yb(),className:x};else if("FlowGraphInteger"===x)C[Z]={value:l.value,className:x};else if(x&&(l.id||l.name))C[Z]={id:l.id,name:l.name,className:x};else{if("object"===typeof l)throw new Error(`Could not serialize value ${l}`);C[Z]=l}}function d(Z,l,C,J){const E=l[Z];let G;const a=(null===E||void 0===E?void 0:E.type)??(null===E||void 0===E?void 0:E.className);if(function(Z){return"Mesh"===Z||"AbstractMesh"===Z||"GroundMesh"===Z||"InstanceMesh"===Z||"LinesMesh"===Z||"GoldbergMesh"===Z||"GreasedLineMesh"===Z||"TrailMesh"===Z}(a)){let Z=J.meshes.filter((Z=>E.id?Z.id===E.id:Z.name===E.name));0===Z.length&&(Z=J.transformNodes.filter((Z=>E.id?Z.id===E.id:Z.name===E.name))),G=E.uniqueId?Z.find((Z=>Z.uniqueId===E.uniqueId)):Z[0]}else if(W(a))G=function(Z,l){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===Z)return x.Vector2.il(l);if("ql"===Z)return C&&(l[2]*=-1),x.ql.il(l);if("Vector4"===Z)return x.Vector4.il(l);if("Quaternion"===Z)return C&&(l[2]*=-1,l[3]*=-1),x.Quaternion.il(l);if("Sl"===Z)return new B.Sl(l[0],l[1],l[2]);if("Rb"===Z)return new B.Rb(l[0],l[1],l[2],l[3]);throw new Error(`Unknown vector class name ${Z}`)}(a,E.value);else if(function(Z){return"AnimationGroup"===Z}(a)){const Z=J.animationGroups.filter((Z=>Z.name===E.name));G=1===Z.length?Z[0]:Z.find((Z=>Z.uniqueId===E.uniqueId))}else G="Matrix"===a?x.Matrix.il(E.value):"Matrix2D"===a?new f.b(E.value):"Matrix3D"===a?new f.f(E.value):"FlowGraphInteger"===a?b.b.FromValue(E.value):"number"===a||"string"===a||"boolean"===a?E.value[0]:E&&void 0!==E.value?E.value:Array.isArray(E)?E.reduce(((Z,l)=>l.eventData?(Z[l.id]={type:(0,K.I)(l.type)},"undefined"!==typeof l.value&&(Z[l.id].value=d("value",l,C,J)),Z):Z),{}):E;return G}function E(Z){return"FlowGraphJsonPointerParserBlock"===Z}},13861:(Z,l,C)=>{"use strict";function B(Z,l){return!(!Z.parent||Z.parent!==l&&!B(Z.parent,l))}function x(Z){if(Z.getClassName)return Z.getClassName()}function b(Z,l){return Z===l&&("Vector2"===Z||"ql"===Z||"Vector4"===Z||"Quaternion"===Z)}function K(Z,l){return Z===l&&("Matrix"===Z||"Matrix2D"===Z||"Matrix3D"===Z)}function f(Z,l){return"FlowGraphInteger"===Z&&"FlowGraphInteger"===l}function W(Z,l){const C="number"===typeof Z||"number"===typeof(null===Z||void 0===Z?void 0:Z.value);return C&&!l?!isNaN(J(Z)):C}function J(Z){return"number"===typeof Z?Z:Z.value}C.d(l,{c:()=>f,e:()=>K,h:()=>b,i:()=>x,j:()=>B,n:()=>J,p:()=>W})},13244:(Z,l,C)=>{"use strict";C.r(l),C.d(l,{SceneInstrumentation:()=>b});var B=C(12248),x=C(12684);class b{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(Z){Z!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=Z,Z?(this._onBeforeActiveMeshesEvaluationObserver=this.Yl.onBeforeActiveMeshesEvaluationObservable.add((()=>{B.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Yl.onAfterActiveMeshesEvaluationObservable.add((()=>{B.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Yl.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Yl.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(Z){Z!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=Z,Z?(this._onBeforeRenderTargetsRenderObserver=this.Yl.onBeforeRenderTargetsRenderObservable.add((()=>{B.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Yl.onAfterRenderTargetsRenderObservable.add((()=>{B.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Yl.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Yl.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(Z){Z!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=Z,Z?(this._onBeforeParticlesRenderingObserver=this.Yl.onBeforeParticlesRenderingObservable.add((()=>{B.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Yl.onAfterParticlesRenderingObservable.add((()=>{B.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Yl.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Yl.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(Z){Z!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=Z,this.Yl.spriteManagers&&(Z?(this._onBeforeSpritesRenderingObserver=this.Yl.onBeforeSpritesRenderingObservable.add((()=>{B.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Yl.onAfterSpritesRenderingObservable.add((()=>{B.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Yl.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Yl.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(Z){Z!==this._capturePhysicsTime&&this.Yl.onBeforePhysicsObservable&&(this._capturePhysicsTime=Z,Z?(this._onBeforePhysicsObserver=this.Yl.onBeforePhysicsObservable.add((()=>{B.Tools.StartPerformanceCounter("Xb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Yl.onAfterPhysicsObservable.add((()=>{B.Tools.EndPerformanceCounter("Xb"),this._physicsTime.endMonitoring()}))):(this.Yl.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Yl.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(Z){Z!==this._captureAnimationsTime&&(this._captureAnimationsTime=Z,Z?this._onAfterAnimationsObserver=this.Yl.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Yl.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(Z){this._captureFrameTime=Z}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(Z){this._captureInterFrameTime=Z}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(Z){Z!==this._captureRenderTime&&(this._captureRenderTime=Z,Z?(this._onBeforeDrawPhaseObserver=this.Yl.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),B.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Yl.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),B.Tools.EndPerformanceCounter("Main render")}))):(this.Yl.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Yl.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(Z){Z!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=Z,Z?(this._onBeforeCameraRenderObserver=this.Yl.onBeforeCameraRenderObservable.add((Z=>{this._cameraRenderTime.beginMonitoring(),B.Tools.StartPerformanceCounter(`Rendering camera ${Z.name}`)})),this._onAfterCameraRenderObserver=this.Yl.onAfterCameraRenderObservable.add((Z=>{this._cameraRenderTime.endMonitoring(!1),B.Tools.EndPerformanceCounter(`Rendering camera ${Z.name}`)}))):(this.Yl.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Yl.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Yl.getEngine()._drawCalls}constructor(Z){this.Yl=Z,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new x.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new x.c,this._captureFrameTime=!1,this._frameTime=new x.c,this._captureRenderTime=!1,this._renderTime=new x.c,this._captureInterFrameTime=!1,this._interFrameTime=new x.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new x.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new x.c,this._capturePhysicsTime=!1,this._physicsTime=new x.c,this._captureAnimationsTime=!1,this._animationsTime=new x.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new x.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=Z.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(B.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Yl.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=Z.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(B.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Bb(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Bb(),this._captureParticlesRenderTime&&this._particlesRenderTime.Bb(),this._captureSpritesRenderTime&&this._spritesRenderTime.Bb(),this._captureRenderTime&&this._renderTime.Bb(),this._captureCameraRenderTime&&this._cameraRenderTime.Bb()}))}dispose(){this._disposed||(this.Yl.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Yl.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Yl.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Yl.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Yl.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Yl.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Yl.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Yl.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Yl.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Yl.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Yl.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Yl.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Yl.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Yl.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Yl.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Yl.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Yl.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Yl=null,this._disposed=!0)}}},13813:(Z,l,C)=>{"use strict";C.d(l,{e:()=>d});var B=C(12428),x=C(12432),b=C(12442),K=C(12850),f=C(12960),W=C(13020),J=C(12400);K.d.AddNodeConstructor("Light_Type_1",((Z,l)=>()=>new d(Z,b.ql.Zero(),l)));class d extends W.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(Z){this._shadowFrustumSize=Z,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(Z){this._shadowOrthoScale=Z,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(Z){this._orthoLeft=Z}get orthoRight(){return this._orthoRight}set orthoRight(Z){this._orthoRight=Z}get orthoTop(){return this._orthoTop}set orthoTop(Z){this._orthoTop=Z}get orthoBottom(){return this._orthoBottom}set orthoBottom(Z){this._orthoBottom=Z}constructor(Z,l,C){super(Z,C),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=l.scale(-1),this.direction=l}getClassName(){return"Tb"}getTypeID(){return f.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(Z,l,C){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(Z):this._setDefaultAutoExtendShadowProjectionMatrix(Z,l,C)}_setDefaultFixedFrustumShadowProjectionMatrix(Z){const l=this.cZ().activeCamera;l&&b.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:l.ib,void 0!==this.shadowMaxZ?this.shadowMaxZ:l.maxZ,Z,this.cZ().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(Z,l,C){const B=this.cZ().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const Z=b.ql.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let B=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let K=0;K<C.length;K++){const f=C[K];if(!f)continue;const W=f.getBoundingInfo().boundingBox;for(let C=0;C<W.vectorsWorld.length;C++)b.ql.TransformCoordinatesToRef(W.vectorsWorld[C],l,Z),Z.x<this._orthoLeft&&(this._orthoLeft=Z.x),Z.y<this._orthoBottom&&(this._orthoBottom=Z.y),Z.x>this._orthoRight&&(this._orthoRight=Z.x),Z.y>this._orthoTop&&(this._orthoTop=Z.y),this.autoCalcShadowZBounds&&(Z.z<B&&(B=Z.z),Z.z>x&&(x=Z.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=B,this._shadowMaxZ=x)}const x=this._orthoRight-this._orthoLeft,K=this._orthoTop-this._orthoBottom,f=void 0!==this.shadowMinZ?this.shadowMinZ:(null===B||void 0===B?void 0:B.ib)||0,W=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===B||void 0===B?void 0:B.maxZ)||1e4,J=this.cZ().getEngine().lb;b.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-x*this.shadowOrthoScale,this._orthoRight+x*this.shadowOrthoScale,this._orthoBottom-K*this.shadowOrthoScale,this._orthoTop+K*this.shadowOrthoScale,J?W:f,J?f:W,Z,this.cZ().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Z,l){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,l),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,l),this)}transferToNodeMaterialEffect(Z,l){return this.computeTransformedInformation()?(Z.setFloat3(l,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(Z.setFloat3(l,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(Z){const l=this._scene.getEngine();return!l.lb&&l.isNDCHalfZRange?0:1}getDepthMaxZ(Z){const l=this._scene.getEngine();return l.lb&&l.isNDCHalfZRange?0:1}prepareLightSpecificDefines(Z,l){Z["DIRLIGHT"+l]=!0}}(0,B.b)([(0,x.R)()],d.prototype,"shadowFrustumSize",null),(0,B.b)([(0,x.R)()],d.prototype,"shadowOrthoScale",null),(0,B.b)([(0,x.R)()],d.prototype,"autoUpdateExtends",void 0),(0,B.b)([(0,x.R)()],d.prototype,"autoCalcShadowZBounds",void 0),(0,B.b)([(0,x.R)("orthoLeft")],d.prototype,"_orthoLeft",void 0),(0,B.b)([(0,x.R)("orthoRight")],d.prototype,"_orthoRight",void 0),(0,B.b)([(0,x.R)("orthoTop")],d.prototype,"_orthoTop",void 0),(0,B.b)([(0,x.R)("orthoBottom")],d.prototype,"_orthoBottom",void 0),(0,J.c)("BABYLON.DirectionalLight",d)},14274:(Z,l,C)=>{"use strict";C.d(l,{c:()=>d});var B=C(12428),x=C(12432),b=C(12442),K=C(12494),f=C(12850),W=C(12960),J=C(12400);f.d.AddNodeConstructor("Light_Type_3",((Z,l)=>()=>new d(Z,b.ql.Zero(),l)));class d extends W.d{constructor(Z,l,C){super(Z,C),this.groundColor=new K.Sl(0,0,0),this.direction=l||b.ql.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ub"}setDirectionToTarget(Z){return this.direction=b.ql.Normalize(Z.zl(b.ql.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(Z,l){const C=b.ql.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",C.x,C.y,C.z,0,l),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.jb),l),this}transferToNodeMaterialEffect(Z,l){const C=b.ql.Normalize(this.direction);return Z.setFloat3(l,C.x,C.y,C.z),this}Fb(){return this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),this._worldMatrix}getTypeID(){return W.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(Z,l){Z["HEMILIGHT"+l]=!0}}(0,B.b)([(0,x.k)()],d.prototype,"groundColor",void 0),(0,B.b)([(0,x.Q)()],d.prototype,"direction",void 0),(0,J.c)("BABYLON.HemisphericLight",d)},13785:(Z,l,C)=>{"use strict";C.d(l,{d:()=>E});var B=C(12428),x=C(12432),b=C(12442),K=C(12850),f=C(12960),W=C(13020),J=C(12423),d=C(12400);K.d.AddNodeConstructor("Light_Type_2",((Z,l)=>()=>new E(Z,b.ql.Zero(),b.ql.Zero(),0,0,l)));class E extends W.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(Z){this._iesProfileTexture!==Z&&(this._iesProfileTexture=Z,this._iesProfileTexture&&E._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(Z){this._angle=Z,this._cosHalfAngle=Math.cos(.5*Z),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(Z){this._innerAngle=Z,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(Z){this._shadowAngleScale=Z,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(Z){this._projectionTextureLightNear=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(Z){this._projectionTextureLightFar=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(Z){this._projectionTextureUpDirection=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(Z){this._projectionTexture!==Z&&(this._projectionTexture=Z,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(E._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):E._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(Z){return void 0!==Z.onGeneratedObservable}static _IsTexture(Z){return void 0!==Z.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(Z){this._projectionTextureProjectionLightMatrix=Z,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(Z,l,C,B,x,K){super(Z,K),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=b.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=b.ql.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=b.ql.Zero(),this._projectionTextureViewLightMatrix=b.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=b.Matrix.Zero(),this._projectionTextureScalingMatrix=b.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=l,this.direction=C,this.angle=B,this.exponent=x}getClassName(){return"SpotLight"}getTypeID(){return f.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(Z){super._setDirection(Z),this._projectionTextureViewLightDirty=!0}_setPosition(Z){super._setPosition(Z),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(Z,l,C){const B=this.cZ().activeCamera;if(!B)return;this._shadowAngleScale=this._shadowAngleScale||1;const x=this._shadowAngleScale*this._angle,K=void 0!==this.shadowMinZ?this.shadowMinZ:B.ib,f=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,W=this.cZ().getEngine().lb;b.Matrix.PerspectiveFovLHToRef(x,1,W?f:K,W?K:f,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,W)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),b.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const Z=this.projectionTextureLightFar,l=this.projectionTextureLightNear,C=Z/(Z-l),B=-C*l,x=1/Math.tan(this._angle/2);b.Matrix.FromValuesToRef(x/1,0,0,0,0,x,0,0,0,0,C,1,0,0,B,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof J.c){const Z=this._projectionTexture.uScale/2,l=this._projectionTexture.vScale/2;b.Matrix.FromValuesToRef(Z,0,0,0,0,l,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(Z,l){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),Z.setMatrix("textureProjectionMatrix"+l,this._projectionTextureMatrix),Z.setTexture("projectionLightTexture"+l,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&Z.setTexture("iesLightTexture"+l,this._iesProfileTexture),this}transferToEffect(Z,l){let C;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,l),C=b.ql.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,l),C=b.ql.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",C.x,C.y,C.z,this._cosHalfAngle,l),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,l),this}transferToNodeMaterialEffect(Z,l){let C;return C=this.computeTransformedInformation()?b.ql.Normalize(this.transformedDirection):b.ql.Normalize(this.direction),this.cZ().useRightHandedSystem?Z.setFloat3(l,-C.x,-C.y,-C.z):Z.setFloat3(l,C.x,C.y,C.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(Z){const l=this._scene.getEngine(),C=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Z||void 0===Z?void 0:Z.ib)??0;return l.lb&&l.isNDCHalfZRange?C:this._scene.getEngine().isNDCHalfZRange?0:C}getDepthMaxZ(Z){const l=this._scene.getEngine(),C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Z||void 0===Z?void 0:Z.maxZ)??1e4;return l.lb&&l.isNDCHalfZRange?0:C}prepareLightSpecificDefines(Z,l){Z["SPOTLIGHT"+l]=!0,Z["PROJECTEDLIGHTTEXTURE"+l]=!(!this.projectionTexture||!this.projectionTexture.isReady()),Z["IESLIGHTTEXTURE"+l]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,B.b)([(0,x.R)()],E.prototype,"angle",null),(0,B.b)([(0,x.R)()],E.prototype,"innerAngle",null),(0,B.b)([(0,x.R)()],E.prototype,"shadowAngleScale",null),(0,B.b)([(0,x.R)()],E.prototype,"exponent",void 0),(0,B.b)([(0,x.R)()],E.prototype,"projectionTextureLightNear",null),(0,B.b)([(0,x.R)()],E.prototype,"projectionTextureLightFar",null),(0,B.b)([(0,x.R)()],E.prototype,"projectionTextureUpDirection",null),(0,B.b)([(0,x.K)("projectedLightTexture")],E.prototype,"_projectionTexture",void 0),(0,d.c)("BABYLON.SpotLight",E)},13499:(Z,l,C)=>{"use strict";C.d(l,{e:()=>K,i:()=>b,m:()=>f});const B={},x={};function b(Z,l){B[Z]=l}function K(Z,l){x[Z]=l}function f(Z){return x[Z]?x[Z]:null}},13410:(Z,l,C)=>{"use strict";C.d(l,{d:()=>c,g:()=>j});var B,x=C(12248),b=C(12251),K=C(12704),f=C(12295),W=C(12263),J=C(12890),d=C(12298),E=C(12307),G=C(12403),a=C(12346),q=C(12288);!function(Z){Z[Z.Clean=0]="Clean",Z[Z.Stop=1]="Stop",Z[Z.Sync=2]="Sync",Z[Z.NoSync=3]="NoSync"}(B||(B={}));const z=new b.b,Y={};let P=!1;function S(){return Y[".babylon"]}function i(Z,l){const C=Y[Z];return C||(W.e.Warn("Unable to find a plugin to load "+Z+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),l?S():void 0)}function s(Z,l,C){let B="Unable to load from "+(Z.rawData?"binary data":Z.url);return l?B+=`: ${l}`:C&&(B+=`: ${C}`),B}async function F(Z,l,C,B,x,b,K,f,W){var J;const E="data:"===(G=Z.url).substring(0,5)?G.substring(5):null;var G;if(Z.rawData&&!K)throw"When using ArrayBufferView to load data the file extension must be provided.";const P=E||K?"":function(Z){const l=Z.indexOf("?");-1!==l&&(Z=Z.substring(0,l));const C=Z.lastIndexOf(".");return Z.substring(C,Z.length).toLowerCase()}(Z.url);let s=K?i(K,!0):E?function(Z){for(const l in Y){const C=Y[l].plugin;if(C.canDirectLoad&&C.canDirectLoad(Z))return Y[l]}return S()}(Z.url):i(P,!1);if(!s&&P){if(Z.url&&!Z.url.startsWith("blob:")){const l=await async function(Z,l){const C=l.method||"GET";return await new Promise(((B,x)=>{const b=new q.c;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const Z={};if(l.responseHeaders)for(const C of l.responseHeaders)Z[C]=b.getResponseHeader(C)||"";B({response:b.response,headerValues:Z})}else x(`Unable to fetch data from ${Z}. Error code: ${b.status}`)})),b.open(C,Z),b.send()}))}(Z.url,{method:"HEAD",responseHeaders:["Content-Type"]}),C=l.headerValues?l.headerValues["Content-Type"]:"";C&&(s=function(Z){for(const l in Y){const C=Y[l];if(C.mimeType===Z)return C}}(C))}s||(s=S())}if(!s)throw new Error(`No plugin or fallback for ${K??Z.url}`);if(!1===(null===W||void 0===W||null===(J=W[s.plugin.name])||void 0===J?void 0:J.enabled))throw new Error(`The '${s.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(Z.rawData&&!s.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(Z=>{if(s.plugin.createPlugin){const l=s.plugin.createPlugin(W??{});return l instanceof Promise?(l.then(Z).catch((Z=>{x("Error instantiating plugin.",Z)})),null):(Z(l),l)}return Z(s.plugin),s.plugin})((W=>{var J;if(!W)throw`The loader plugin corresponding to the '${K}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(z.notifyObservers(W),E&&(W.canDirectLoad&&W.canDirectLoad(Z.url)||!(0,d.h)(Z.url))){if(W.directLoad){const Z=W.directLoad(l,E);Z instanceof Promise?Z.then((Z=>{C(W,Z)})).catch((Z=>{x("Error in directLoad of _loadData: "+Z,Z)})):C(W,Z)}else C(W,E);return}const G=s.isBinary,q=(Z,B)=>{l.J?x("Scene has been disposed"):C(W,Z,B)};let Y=null,P=!1;null===(J=W.xb)||void 0===J||J.add((()=>{P=!0,Y&&(Y.abort(),Y=null),b()}));const S=()=>{if(P)return;const C=(Z,l)=>{x(null===Z||void 0===Z?void 0:Z.statusText,l)};if(!W.loadFile&&Z.rawData)throw"Plugin does not support loading ArrayBufferView.";Y=W.loadFile?W.loadFile(l,Z.rawData||Z.file||Z.url,Z.rootUrl,q,B,G,C,f):l._loadFile(Z.file||Z.url,q,B,!0,G,C)},i=l.getEngine();let F=i.enableOfflineSupport;if(F){let C=!1;for(const B of l.disableOfflineSupportExceptionRules)if(B.test(Z.url)){C=!0;break}F=!C}F&&a.d.OfflineProviderFactory?l.offlineProvider=a.d.OfflineProviderFactory(Z.url,S,i.disableManifestCheck):S()}))}function n(Z,l){let C,B,b=null,K=null;if(l)if(l.name)C=`file:${l.name}`,B=l.name,b=l;else if(ArrayBuffer.isView(l))C="",B=(0,G.d)(),K=l;else if(l.startsWith("data:"))C=l,B="";else if(Z){const b=l;if("/"===b.substring(0,1))return x.Tools.Error("Wrong sceneFilename parameter"),null;C=Z+b,B=b}else C=l,B=x.Tools.GetFilename(l),Z=x.Tools.GetFolderPath(l);else C=Z,B=x.Tools.GetFilename(Z),Z=x.Tools.GetFolderPath(Z);return{url:C,rootUrl:Z,name:B,file:b,rawData:K}}function c(Z){if("string"===typeof Z.extensions){const l=Z.extensions;Y[l.toLowerCase()]={plugin:Z,isBinary:!1}}else{const l=Z.extensions,C=Object.keys(l);for(const B of C)Y[B.toLowerCase()]={plugin:Z,isBinary:l[B].isBinary,mimeType:l[B].mimeType}}}async function U(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.b.LastCreatedScene,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!B)return W.e.Error("No scene available to import mesh to"),null;const a=n(l,C);if(!a)return null;const q={};B.addPendingData(q);const z=()=>{B.removePendingData(q)},Y=(Z,l)=>{const C=s(a,Z,l);K?K(B,C,new E.g(C,E.f.SceneLoaderError,l)):W.e.Error(C),z()},P=b?Z=>{try{b(Z)}catch(l){Y("Error in onProgress callback: "+l,l)}}:void 0,S=(Z,l,C,b,K,f,W,J)=>{if(B.importedMeshesFiles.push(a.url),x)try{x(Z,l,C,b,K,f,W,J)}catch(d){Y("Error in onSuccess callback: "+d,d)}B.removePendingData(q)};return await F(a,B,((l,C,x)=>{if(l.rewriteRootURL&&(a.rootUrl=l.rewriteRootURL(a.rootUrl,x)),l.importMesh){const x=[],b=[],K=[];if(!l.importMesh(Z,B,C,a.rootUrl,x,b,K,Y))return;B.loadingPluginName=l.name,S(x,b,K,[],[],[],[],[])}else{l.importMeshAsync(Z,B,C,a.rootUrl,P,a.name).then((Z=>{B.loadingPluginName=l.name,S(Z.meshes,Z.Ka,Z.skeletons,Z.animationGroups,Z.transformNodes,Z.geometries,Z.lights,Z.spriteManagers)})).catch((Z=>{Y(Z.message,Z)}))}}),P,Y,z,J,d,G)}async function t(Z,l,C,B,x,b,K,f){return await new Promise(((W,J)=>{try{U(Z,l,C,B,((Z,l,C,B,x,b,K,f)=>{W({meshes:Z,Ka:l,skeletons:C,animationGroups:B,transformNodes:x,geometries:b,lights:K,spriteManagers:f})}),x,((Z,l,C)=>{J(C||new Error(l))}),b,K,f).catch(J)}catch(E){J(E)}}))}async function r(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.b.LastCreatedEngine,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};C?await o(Z,l,new K.e(C),B,b,W,J,d,E):x.Tools.Error("No engine available")}async function e(Z,l,C,B,x,b,K){return await new Promise(((f,W)=>{r(Z,l,C,(Z=>{f(Z)}),B,((Z,l,C)=>{W(C||new Error(l))}),x,b,K)}))}async function o(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.b.LastCreatedScene,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return W.e.Error("No scene available to append to"),null;const a=n(Z,l);if(!a)return null;const q={};C.addPendingData(q);const z=()=>{C.removePendingData(q)};J.e.ShowLoadingScreen&&!P&&(P=!0,C.getEngine().displayLoadingUI(),C.executeWhenReady((()=>{C.getEngine().hideLoadingUI(),P=!1})));const Y=(Z,l)=>{const B=s(a,Z,l);b?b(C,B,new E.g(B,E.f.SceneLoaderError,l)):W.e.Error(B),z()},S=x?Z=>{try{x(Z)}catch(l){Y("Error in onProgress callback",l)}}:void 0,i=()=>{if(B)try{B(C)}catch(Z){Y("Error in onSuccess callback",Z)}C.removePendingData(q)};return await F(a,C,((Z,l)=>{if(Z.load){if(!Z.load(C,l,a.rootUrl,Y))return;C.loadingPluginName=Z.name,i()}else{Z.loadAsync(C,l,a.rootUrl,S,a.name).then((()=>{C.loadingPluginName=Z.name,i()})).catch((Z=>{Y(Z.message,Z)}))}}),S,Y,z,K,d,G)}async function v(Z,l,C,B,x,b,K){return await new Promise(((f,W)=>{try{o(Z,l,C,(Z=>{f(Z)}),B,((Z,l,C)=>{W(C||new Error(l))}),x,b,K).catch(W)}catch(E){W(E)}}))}async function R(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.b.LastCreatedScene,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return W.e.Error("No scene available to load asset container to"),null;const G=n(Z,l);if(!G)return null;const a={};C.addPendingData(a);const q=()=>{C.removePendingData(a)},z=(Z,l)=>{const B=s(G,Z,l);b?b(C,B,new E.g(B,E.f.SceneLoaderError,l)):W.e.Error(B),q()},Y=x?Z=>{try{x(Z)}catch(l){z("Error in onProgress callback",l)}}:void 0,P=Z=>{if(B)try{B(Z)}catch(l){z("Error in onSuccess callback",l)}C.removePendingData(a)};return await F(G,C,((Z,l)=>{if(Z.loadAssetContainer){const B=Z.loadAssetContainer(C,l,G.rootUrl,z);if(!B)return;B.populateRootNodes(),C.loadingPluginName=Z.name,P(B)}else if(Z.loadAssetContainerAsync){Z.loadAssetContainerAsync(C,l,G.rootUrl,Y,G.name).then((l=>{l.populateRootNodes(),C.loadingPluginName=Z.name,P(l)})).catch((Z=>{z(Z.message,Z)}))}else z("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),Y,z,q,K,J,d)}async function k(Z,l,C,B,x,b,K){return await new Promise(((f,W)=>{try{R(Z,l,C,(Z=>{f(Z)}),B,((Z,l,C)=>{W(C||new Error(l))}),x,b,K).catch(W)}catch(E){W(E)}}))}async function V(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.b.LastCreatedScene,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,G=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",a=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!C)return void W.e.Error("No scene available to load animations to");if(B){for(const B of C.animatables)B.reset();C.stopAllAnimations();const Z=C.animationGroups.slice();for(const C of Z)C.dispose();const l=C.getNodes();for(const C of l)C.animations&&(C.animations=[])}else switch(x){case 0:const Z=C.animationGroups.slice();for(const l of Z)l.dispose();break;case 1:for(const l of C.animationGroups)l.stop();break;case 2:for(const l of C.animationGroups)l.reset(),l.restart();break;case 3:break;default:return void W.e.Error("Unknown animation group loading mode value '"+x+"'")}const q=C.animatables.length;await R(Z,l,C,(Z=>{Z.mergeAnimationsTo(C,C.animatables.slice(q),b),Z.dispose(),C.onAnimationFileImportedObservable.notifyObservers(C),K&&K(C)}),J,d,E,G,a)}async function g(Z,l,C,B,x,b,K,f,W,J){return await new Promise(((d,G)=>{try{V(Z,l,C,B,x,b,(Z=>{d(Z)}),K,((Z,l,C)=>{G(C||new Error(l))}),f,W,J).catch(G)}catch(E){G(E)}}))}class j{static get ForceFullSceneLoadingForIncremental(){return J.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(Z){J.e.ForceFullSceneLoadingForIncremental=Z}static get ShowLoadingScreen(){return J.e.ShowLoadingScreen}static set ShowLoadingScreen(Z){J.e.ShowLoadingScreen=Z}static get loggingLevel(){return J.e.loggingLevel}static set loggingLevel(Z){J.e.loggingLevel=Z}static get CleanBoneMatrixWeights(){return J.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(Z){J.e.CleanBoneMatrixWeights=Z}static GetDefaultPlugin(){return S()}static GetPluginForExtension(Z){var l;return null===(l=i(Z,!0))||void 0===l?void 0:l.plugin}static IsPluginForExtensionAvailable(Z){return function(Z){return!!Y[Z]}(Z)}static RegisterPlugin(Z){c(Z)}static ImportMesh(Z,l,C,B,x,b,K,W,J){U(Z,l,C,B,x,b,K,W,J).catch((Z=>null===K||void 0===K?void 0:K(f.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async ImportMeshAsync(Z,l,C,B,x,b,K){return await t(Z,l,C,B,x,b,K)}static Load(Z,l,C,B,x,b,K,W){r(Z,l,C,B,x,b,K,W).catch((Z=>null===b||void 0===b?void 0:b(f.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async LoadAsync(Z,l,C,B,x,b){return await e(Z,l,C,B,x,b)}static Append(Z,l,C,B,x,b,K,W){o(Z,l,C,B,x,b,K,W).catch((Z=>null===b||void 0===b?void 0:b(C??f.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async AppendAsync(Z,l,C,B,x,b){return await v(Z,l,C,B,x,b)}static LoadAssetContainer(Z,l,C,B,x,b,K,W){R(Z,l,C,B,x,b,K,W).catch((Z=>null===b||void 0===b?void 0:b(C??f.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async LoadAssetContainerAsync(Z,l,C,B,x,b){return await k(Z,l,C,B,x,b)}static ImportAnimations(Z,l,C,B,x,b,K,W,J,d,E){V(Z,l,C,B,x,b,K,W,J,d,E).catch((Z=>null===J||void 0===J?void 0:J(C??f.b.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async ImportAnimationsAsync(Z,l,C,B,x,b,K,f,W,J,d){return await g(Z,l,C,B,x,b,f,J,d)}}j.NO_LOGGING=0,j.MINIMAL_LOGGING=1,j.SUMMARY_LOGGING=2,j.DETAILED_LOGGING=3,j.OnPluginActivatedObservable=z},13798:(Z,l,C)=>{"use strict";C.d(l,{d:()=>G});var B=C(12428),x=C(12432),b=C(12248),K=C(12442),f=C(12463),W=C(12423),J=C(12400),d=C(12251),E=C(12478);C(13801);class G extends f.d{set boundingBoxSize(Z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(Z))return;this._boundingBoxSize=Z;const l=this.cZ();l&&l.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(Z){this._rotationY=Z,this.setReflectionTextureMatrix(K.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(Z,l,C){let B="";for(const x of Z)B+=x;return new G(B,l,null,C,Z)}static CreateFromPrefilteredData(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const x=l.useDelayedTextureLoading;l.useDelayedTextureLoading=!1;const b=new G(Z,l,null,!1,null,null,null,void 0,!0,C,B);return l.useDelayedTextureLoading=x,b}constructor(Z,l){var C;let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,G=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,Y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,P=arguments.length>13?arguments[13]:void 0,S=arguments.length>14?arguments[14]:void 0;super(l),this.onLoadObservable=new d.b,this.boundingBoxPosition=K.ql.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new K.Matrix,this._buffer=null,this.name=Z,this.url=Z,this._noMipmap=x,this.Pb=!1,this.isCube=!0,this._textureMatrix=K.Matrix.Identity(),this.coordinatesMode=W.c.CUBIC_MODE;let i=null,s=null;null===B||Array.isArray(B)?(this._noMipmap=x,this._format=E,this._createPolynomials=q,i=B,this._loaderOptions=P,this._useSRGBBuffer=S,this._lodScale=z,this._lodOffset=Y):(i=B.extensions??null,this._noMipmap=B.noMipmap??!1,b=B.files??null,s=B.buffer??null,this._format=B.format??5,G=B.prefiltered??!1,a=B.forcedExtension??null,this._createPolynomials=B.createPolynomials??!1,this._lodScale=B.lodScale??.8,this._lodOffset=B.lodOffset??0,this._loaderOptions=B.loaderOptions,this._useSRGBBuffer=B.useSRGBBuffer,f=B.p??null,J=B.onError??null),(Z||b)&&this.updateURL(Z,a,f,G,J,i,null===(C=this.cZ())||void 0===C?void 0:C.useDelayedTextureLoading,b,s)}getClassName(){return"CubeTexture"}updateURL(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=Z),this.url=Z,l&&(this._forcedExtension=l);const J=Z.lastIndexOf("."),d=l||(J>-1?Z.substring(J).toLowerCase():""),E=0===d.indexOf(".dds"),G=0===d.indexOf(".env"),a=0===d.indexOf(".basis");if(G?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=B,B&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),f)this._files=f;else if(a||G||E||b||(b=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,b){for(let l=0;l<b.length;l++)this._files.push(Z+b[l]);this._extensions=b}this._buffer=W,K?(this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=x):this._loadTexture(C,x)}delayLoad(Z){4===this.delayLoadState&&(Z&&(this._forcedExtension=Z),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(Z){var l,C;if(Z.updateFlag===this._textureMatrix.updateFlag)return;Z.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(C=this.cZ())||void 0===C||C.markAllMaterialsAsDirty(1,(Z=>-1!==Z.getActiveTextures().indexOf(this))));if(this._textureMatrix=Z,null===(l=this.cZ())||void 0===l||!l.useRightHandedSystem)return;const B=K.TmpVectors.ql[0],x=K.TmpVectors.Quaternion[0],b=K.TmpVectors.ql[1];this._textureMatrix.decompose(B,x,b),x.z*=-1,x.w*=-1,K.Matrix.ComposeToRef(B,x,b,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var Z;return null!==(Z=this.cZ())&&void 0!==Z&&Z.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this.cZ(),B=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const x=()=>{var l;(this.onLoadObservable.notifyObservers(this),B)&&(B.dispose(),null===(l=this.cZ())||void 0===l||l.markAllMaterialsAsDirty(1));Z&&Z()},K=(Z,C)=>{this._loadingError=!0,this._errorObject={message:Z,exception:C},l&&l(Z,C),W.c.OnTextureLoadErrorObservable.notifyObservers(this)};var f;this._texture?this._texture.isReady?b.Tools.SetImmediate((()=>x())):this._texture.onLoadedObservable.add((()=>x())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,C,this._lodScale,this._lodOffset,Z,K,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,C,this._files,this._noMipmap,Z,K,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(f=this._texture)||void 0===f||f.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(Z,l,C){const B=E.b.Parse((()=>{let B=!1;return Z.prefiltered&&(B=Z.prefiltered),new G(C+(Z.url??Z.name),l,Z.extensions,!1,Z.files||null,null,null,void 0,B,Z.forcedExtension)}),Z,l);if(Z.boundingBoxPosition&&(B.boundingBoxPosition=K.ql.il(Z.boundingBoxPosition)),Z.boundingBoxSize&&(B.boundingBoxSize=K.ql.il(Z.boundingBoxSize)),Z.animations)for(let x=0;x<Z.animations.length;x++){const l=Z.animations[x],C=(0,J.b)("BABYLON.Animation");C&&B.animations.push(C.Parse(l))}return B}clone(){let Z=0;const l=E.b.Clone((()=>{const l=new G(this.url,this.cZ()||this._getEngine(),this._extensions,this._noMipmap,this._files);return Z=l.uniqueId,l}),this);return l.uniqueId=Z,l}}(0,B.b)([(0,x.R)()],G.prototype,"url",void 0),(0,B.b)([(0,x.Q)()],G.prototype,"boundingBoxPosition",void 0),(0,B.b)([(0,x.Q)()],G.prototype,"boundingBoxSize",null),(0,B.b)([(0,x.R)("rotationY")],G.prototype,"rotationY",null),(0,B.b)([(0,x.R)("files")],G.prototype,"_files",void 0),(0,B.b)([(0,x.R)("forcedExtension")],G.prototype,"_forcedExtension",void 0),(0,B.b)([(0,x.R)("extensions")],G.prototype,"_extensions",void 0),(0,B.b)([(0,x.y)("textureMatrix")],G.prototype,"_textureMatrix",void 0),(0,B.b)([(0,x.y)("textureMatrixRefraction")],G.prototype,"_textureMatrixRefraction",void 0),W.c._CubeTextureParser=G.Parse,(0,J.c)("BABYLON.CubeTexture",G)},14284:(Z,l,C)=>{"use strict";C.d(l,{d:()=>W});var B=C(12263),x=C(12423),b=C(12411),K=C(12596),f=C(12382);K.ThinEngine.prototype.createDynamicTexture=function(Z,l,C,B){const x=new f.c(this,4);return x.baseWidth=Z,x.baseHeight=l,C&&(Z=this.needPOTTextures?(0,b.h)(Z,this._caps.maxTextureSize):Z,l=this.needPOTTextures?(0,b.h)(l,this._caps.maxTextureSize):l),x.width=Z,x.height=l,x.isReady=!1,x.generateMipMaps=C,x.samplingMode=B,this.updateTextureSamplingMode(B,x),this._internalTexturesCache.push(x),x},K.ThinEngine.prototype.updateDynamicTexture=function(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Z)return;const K=this._gl,f=K.TEXTURE_2D,W=this._bindTextureDirectly(f,Z,!0,b);this._unpackFlipY(void 0===C?Z.invertY:C),B&&K.pixelStorei(K.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const J=this._getWebGLTextureType(Z.type),d=this._getInternalFormat(x||Z.format),E=this._getRGBABufferInternalSizedFormat(Z.type,d);K.texImage2D(f,0,E,d,J,l),Z.generateMipMaps&&K.generateMipmap(f),W||this._bindTextureDirectly(f,null),B&&K.pixelStorei(K.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),x&&(Z.format=x),Z._dynamicTextureSource=l,Z._premulAlpha=B,Z.invertY=C||!1,Z.isReady=!0};class W extends x.c{constructor(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,f=arguments.length>6?arguments[6]:void 0;const W=!C||C._isScene;super(null,W?C:null===C||void 0===C?void 0:C.Yl,W?!B:C,f,b,void 0,void 0,void 0,void 0,K),this.name=Z,this.wrapU=x.c.CLAMP_ADDRESSMODE,this.wrapV=x.c.CLAMP_ADDRESSMODE,this._generateMipMaps=B;const J=this._getEngine();if(!J)return;if(l.getContext)this._canvas=l,this._ownCanvas=!1,this._texture=J.createDynamicTexture(this._canvas.width,this._canvas.height,B,b);else{this._canvas=J.createCanvas(1,1),this._ownCanvas=!0;const Z=l;Z.width||0===Z.width?this._texture=J.createDynamicTexture(Z.width,Z.height,B,b):this._texture=J.createDynamicTexture(l,l,B,b)}const d=this.getSize();this._canvas.width!==d.width&&(this._canvas.width=d.width),this._canvas.height!==d.height&&(this._canvas.height=d.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(Z){this._canvas.width=Z.width,this._canvas.height=Z.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(Z.width,Z.height,this._generateMipMaps,this.samplingMode)}scale(Z){const l=this.getSize();l.width*=Z,l.height*=Z,this._recreate(l)}scaleTo(Z,l){const C=this.getSize();C.width=Z,C.height=l,this._recreate(C)}getContext(){return this._context}clear(Z){const l=this.getSize();Z&&(this._context.fillStyle=Z),this._context.clearRect(0,0,l.width,l.height)}update(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===Z||Z,l,this._format||void 0,void 0,C)}drawText(Z,l,C,B,x,b,K){let f=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const W=this.getSize();if(b&&(this._context.fillStyle=b,this._context.fillRect(0,0,W.width,W.height)),this._context.font=B,null===l||void 0===l){const C=this._context.measureText(Z);l=(W.width-C.width)/2}if(null===C||void 0===C){const Z=parseInt(B.replace(/\D/g,""));C=W.height/2+Z/3.65}this._context.fillStyle=x||"",this._context.fillText(Z,l,C),f&&this.update(K)}dispose(){var Z,l;(super.dispose(),this._ownCanvas)&&(null===(Z=this._canvas)||void 0===Z||null===(l=Z.remove)||void 0===l||l.call(Z));this._canvas=null,this._context=null}clone(){const Z=this.cZ();if(!Z)return this;const l=this.getSize(),C=new W(this.name,l,Z,this._generateMipMaps);return C.Pb=this.Pb,C.level=this.level,C.wrapU=this.wrapU,C.wrapV=this.wrapV,C}serialize(){const Z=this.cZ();Z&&!Z.isReady()&&B.e.Warn("The scene must be ready before serializing the dynamic texture");const l=super.serialize();return W._IsCanvasElement(this._canvas)&&(l.base64String=this._canvas.toDataURL()),l.invertY=this._invertY,l.samplingMode=this.samplingMode,l}static _IsCanvasElement(Z){return void 0!==Z.toDataURL}_rebuild(){this.update()}}},13708:(Z,l,C)=>{"use strict";C.d(l,{d:()=>x});var B=C(12423);class x extends B.c{get depth(){return this._depth}constructor(Z,l,C,x,b,K){let f=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],W=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:B.c.TRILINEAR_SAMPLINGMODE,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,E=arguments.length>10?arguments[10]:void 0;super(null,K,!f,W),this.format=b,this._texture=K.getEngine().createRawTexture2DArray(Z,l,C,x,b,f,W,J,null,d,E),this._depth=x,this.is2DArray=!0}update(Z){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,Z,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(Z,l,C,B,b){return new x(Z,l,C,B,5,b,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13513:(Z,l,C)=>{"use strict";C.d(l,{e:()=>f,h:()=>W,k:()=>b,n:()=>K});var B=C(12460),x=C(12442);function b(Z,l){return`{X: ${Z.x.toFixed(l)} Y: ${Z.y.toFixed(l)}}`}function K(Z,l){return`{X: ${Z._x.toFixed(l)} Y: ${Z._y.toFixed(l)} Z: ${Z._z.toFixed(l)}}`}function f(Z,l){return 2*Math.acos((0,B.Clamp)(x.Quaternion.Dot(Z,l)))}function W(Z,l){const C=new x.Quaternion;return function(Z,l,C){const b=x.ql.Cross(Z,l),K=Math.acos((0,B.Clamp)(x.ql.Dot(Z,l),-1,1));x.Quaternion.RotationAxisToRef(b,K,C)}(Z,l,C),C}},13362:(Z,l,C)=>{"use strict";C.d(l,{c:()=>J});var B=C(12442),x=C(12494),b=C(12874),K=C(12861),f=C(12511);C(13366);function W(Z){let l=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const C=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],b=[];let W=[];const J=Z.width||Z.size||1,d=Z.height||Z.size||1,E=Z.depth||Z.size||1,G=Z.wrap||!1;let a=void 0===Z.topBaseAt?1:Z.topBaseAt,q=void 0===Z.bottomBaseAt?0:Z.bottomBaseAt;a=(a+4)%4,q=(q+4)%4;let z=[2,0,3,1][a],Y=[2,0,1,3][q],P=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(G){l=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],P=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let Z=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],C=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const B=[17,18,19,16],x=[22,23,20,21];for(;z>0;)Z.unshift(Z.pop()),B.unshift(B.pop()),z--;for(;Y>0;)C.unshift(C.pop()),x.unshift(x.pop()),Y--;Z=Z.flat(),C=C.flat(),P=P.concat(Z).concat(C),l.push(B[0],B[2],B[3],B[0],B[1],B[2]),l.push(x[0],x[2],x[3],x[0],x[1],x[2])}const S=[J/2,d/2,E/2];W=P.reduce(((Z,l,C)=>Z.concat(l*S[C%3])),[]);const i=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,s=Z.faceUV||new Array(6),F=Z.faceColors,n=[];for(let K=0;K<6;K++)void 0===s[K]&&(s[K]=new B.Vector4(0,0,1,1)),F&&void 0===F[K]&&(F[K]=new x.Rb(1,1,1,1));for(let B=0;B<6;B++)if(b.push(s[B].z,f.d?1-s[B].w:s[B].w),b.push(s[B].x,f.d?1-s[B].w:s[B].w),b.push(s[B].x,f.d?1-s[B].y:s[B].y),b.push(s[B].z,f.d?1-s[B].y:s[B].y),F)for(let Z=0;Z<4;Z++)n.push(F[B].r,F[B].g,F[B].b,F[B].a);K.e._ComputeSides(i,W,l,C,b,Z.frontUVs,Z.backUVs);const c=new K.e;if(c.indices=l,c.tZ=W,c.rZ=C,c.oZ=b,F){const Z=i===K.e.DOUBLESIDE?n.concat(n):n;c.eZ=Z}return c}function J(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new b.b(Z,C);l.sideOrientation=b.b._GetDefaultSideOrientation(l.sideOrientation),B._originalBuilderSideOrientation=l.sideOrientation;return W(l).RZ(B,l.updatable),B}K.e.CreateBox=W,b.b.CreateBox=function(Z,l){return J(Z,{size:l,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13506:(Z,l,C)=>{"use strict";C.d(l,{d:()=>f});var B=C(12874),x=C(12861),b=C(12511);function K(Z){const l=[],C=[],B=[],K=[],f=Z.radius||.5,W=Z.tessellation||64,J=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,d=0===Z.sideOrientation?0:Z.sideOrientation||x.e.DEFAULTSIDE;l.push(0,0,0),K.push(.5,.5);const E=2*Math.PI*J,G=1===J?E/W:E/(W-1);let a=0;for(let x=0;x<W;x++){const Z=Math.cos(a),C=Math.sin(a),B=(Z+1)/2,x=(1-C)/2;l.push(f*Z,f*C,0),K.push(B,b.d?1-x:x),a+=G}1===J&&(l.push(l[3],l[4],l[5]),K.push(K[2],b.d?1-K[3]:K[3]));const q=l.length/3;for(let x=1;x<q-1;x++)C.push(x+1,0,x);x.e.ComputeNormals(l,C,B),x.e._ComputeSides(d,l,C,B,K,Z.frontUVs,Z.backUVs);const z=new x.e;return z.indices=C,z.tZ=l,z.rZ=B,z.oZ=K,z}function f(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new B.b(Z,C);l.sideOrientation=B.b._GetDefaultSideOrientation(l.sideOrientation),x._originalBuilderSideOrientation=l.sideOrientation;return K(l).RZ(x,l.updatable),x}x.e.CreateDisc=K,B.b.CreateDisc=function(Z,l,C){return f(Z,{radius:l,tessellation:C,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13366:(Z,l,C)=>{"use strict";C.d(l,{e:()=>Y,c:()=>S,f:()=>P});var B=C(12442),x=C(12494),b=C(12874),K=C(12861),f=C(12530);b.b._GroundMeshParser=(Z,l)=>W.Parse(Z,l);class W extends b.b{constructor(Z,l){super(Z,l),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=Z,this._subdivisionsY=Z,this.subdivide(Z);const C=this;C.createOrUpdateSubmeshesOctree&&C.createOrUpdateSubmeshesOctree(l)}getHeightAtCoordinates(Z,l){const C=this.getWorldMatrix(),x=B.TmpVectors.Matrix[5];C.invertToRef(x);const b=B.TmpVectors.ql[8];if(B.ql.TransformCoordinatesFromFloatsToRef(Z,0,l,x,b),Z=b.x,l=b.z,Z<this._minX||Z>=this._maxX||l<=this._minZ||l>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const K=this._getFacetAt(Z,l),f=-(K.x*Z+K.z*l+K.w)/K.y;return B.ql.TransformCoordinatesFromFloatsToRef(0,f,0,C,b),b.y}getNormalAtCoordinates(Z,l){const C=new B.ql(0,1,0);return this.getNormalAtCoordinatesToRef(Z,l,C),C}getNormalAtCoordinatesToRef(Z,l,C){const x=this.getWorldMatrix(),b=B.TmpVectors.Matrix[5];x.invertToRef(b);const K=B.TmpVectors.ql[8];if(B.ql.TransformCoordinatesFromFloatsToRef(Z,0,l,b,K),Z=K.x,l=K.z,Z<this._minX||Z>this._maxX||l<this._minZ||l>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const f=this._getFacetAt(Z,l);return B.ql.TransformNormalFromFloatsToRef(f.x,f.y,f.z,x,C),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(Z,l){const C=Math.floor((Z+this._maxX)*this._subdivisionsX/this._width),B=Math.floor(-(l+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),x=this._heightQuads[B*this._subdivisionsX+C];let b;return b=l<x.slope.x*Z+x.slope.y?x.facet1:x.facet2,b}_initHeightQuads(){const Z=this._subdivisionsX,l=this._subdivisionsY;this._heightQuads=[];for(let C=0;C<l;C++)for(let l=0;l<Z;l++){const x={slope:B.Vector2.Zero(),facet1:new B.Vector4(0,0,0,0),facet2:new B.Vector4(0,0,0,0)};this._heightQuads[C*Z+l]=x}return this}_computeHeightQuads(){const Z=this.getVerticesData(f.h.PositionKind);if(!Z)return this;const l=B.TmpVectors.ql[3],C=B.TmpVectors.ql[2],x=B.TmpVectors.ql[1],b=B.TmpVectors.ql[0],K=B.TmpVectors.ql[4],W=B.TmpVectors.ql[5],J=B.TmpVectors.ql[6],d=B.TmpVectors.ql[7],E=B.TmpVectors.ql[8];let G=0,a=0,q=0,z=0,Y=0,P=0,S=0;const i=this._subdivisionsX,s=this._subdivisionsY;for(let f=0;f<s;f++)for(let s=0;s<i;s++){G=3*s,a=f*(i+1)*3,q=(f+1)*(i+1)*3,l.x=Z[a+G],l.y=Z[a+G+1],l.z=Z[a+G+2],C.x=Z[a+G+3],C.y=Z[a+G+4],C.z=Z[a+G+5],x.x=Z[q+G],x.y=Z[q+G+1],x.z=Z[q+G+2],b.x=Z[q+G+3],b.y=Z[q+G+4],b.z=Z[q+G+5],z=(b.z-l.z)/(b.x-l.x),Y=l.z-z*l.x,C.subtractToRef(l,K),x.subtractToRef(l,W),b.subtractToRef(l,J),B.ql.CrossToRef(J,W,d),B.ql.CrossToRef(K,J,E),d.normalize(),E.normalize(),P=-(d.x*l.x+d.y*l.y+d.z*l.z),S=-(E.x*C.x+E.y*C.y+E.z*C.z);const F=this._heightQuads[f*i+s];F.slope.rb(z,Y),F.facet1.rb(d.x,d.y,d.z,P),F.facet2.rb(E.x,E.y,E.z,S)}return this}serialize(Z){super.serialize(Z),Z.subdivisionsX=this._subdivisionsX,Z.subdivisionsY=this._subdivisionsY,Z.minX=this._minX,Z.maxX=this._maxX,Z.ib=this._minZ,Z.maxZ=this._maxZ,Z.width=this._width,Z.height=this._height}static Parse(Z,l){const C=new W(Z.name,l);return C._subdivisionsX=Z.subdivisionsX||1,C._subdivisionsY=Z.subdivisionsY||1,C._minX=Z.minX,C._maxX=Z.maxX,C._minZ=Z.ib,C._maxZ=Z.maxZ,C._width=Z.width,C._height=Z.height,C}}var J=C(12248),d=C(12295),E=C(12451),G=C(12511);function a(Z){const l=[],C=[],x=[],b=[];let f,W;const J=Z.width||Z.size||1,d=Z.height||Z.size||1,E=0|(Z.subdivisionsX||Z.subdivisions||1),a=0|(Z.subdivisionsY||Z.subdivisions||1);for(f=0;f<=a;f++)for(W=0;W<=E;W++){const Z=new B.ql(W*J/E-J/2,0,(a-f)*d/a-d/2),l=new B.ql(0,1,0);C.push(Z.x,Z.y,Z.z),x.push(l.x,l.y,l.z),b.push(W/E,G.d?f/a:1-f/a)}for(f=0;f<a;f++)for(W=0;W<E;W++)l.push(W+1+(f+1)*(E+1)),l.push(W+1+f*(E+1)),l.push(W+f*(E+1)),l.push(W+(f+1)*(E+1)),l.push(W+1+(f+1)*(E+1)),l.push(W+f*(E+1));const q=new K.e;return q.indices=l,q.tZ=C,q.rZ=x,q.oZ=b,q}function q(Z){const l=void 0!==Z.xmin&&null!==Z.xmin?Z.xmin:-1,C=void 0!==Z.zmin&&null!==Z.zmin?Z.zmin:-1,x=void 0!==Z.xmax&&null!==Z.xmax?Z.xmax:1,b=void 0!==Z.zmax&&null!==Z.zmax?Z.zmax:1,f=Z.subdivisions||{w:1,h:1},W=Z.precision||{w:1,h:1},J=[],d=[],E=[],G=[];let a,q,z,Y;f.h=f.h<1?1:f.h,f.w=f.w<1?1:f.w,W.w=W.w<1?1:W.w,W.h=W.h<1?1:W.h;const P=(x-l)/f.w,S=(b-C)/f.h;function i(Z,l,C,x){const b=d.length/3,K=W.w+1;for(a=0;a<W.h;a++)for(q=0;q<W.w;q++){const Z=[b+q+a*K,b+(q+1)+a*K,b+(q+1)+(a+1)*K,b+q+(a+1)*K];J.push(Z[1]),J.push(Z[2]),J.push(Z[3]),J.push(Z[0]),J.push(Z[1]),J.push(Z[3])}const f=B.ql.Zero(),z=new B.ql(0,1,0);for(a=0;a<=W.h;a++)for(f.z=a*(x-l)/W.h+l,q=0;q<=W.w;q++)f.x=q*(C-Z)/W.w+Z,f.y=0,d.push(f.x,f.y,f.z),E.push(z.x,z.y,z.z),G.push(q/W.w,a/W.h)}for(z=0;z<f.h;z++)for(Y=0;Y<f.w;Y++)i(l+Y*P,C+z*S,l+(Y+1)*P,C+(z+1)*S);const s=new K.e;return s.indices=J,s.tZ=d,s.rZ=E,s.oZ=G,s}function z(Z){const l=[],C=[],b=[],f=[];let W,J;const d=Z.colorFilter||new x.Sl(.3,.59,.11),G=Z.alphaFilter||0;let a=!1;if(Z.minHeight>Z.maxHeight){a=!0;const l=Z.maxHeight;Z.maxHeight=Z.minHeight,Z.minHeight=l}for(W=0;W<=Z.subdivisions;W++)for(J=0;J<=Z.subdivisions;J++){const l=new B.ql(J*Z.width/Z.subdivisions-Z.width/2,0,(Z.subdivisions-W)*Z.height/Z.subdivisions-Z.height/2),x=4*(((l.x+Z.width/2)/Z.width*(Z.bufferWidth-1)|0)+((1-(l.z+Z.height/2)/Z.height)*(Z.bufferHeight-1)|0)*Z.bufferWidth);let K=Z.buffer[x]/255,q=Z.buffer[x+1]/255,z=Z.buffer[x+2]/255;const Y=Z.buffer[x+3]/255;a&&(K=1-K,q=1-q,z=1-z);const P=K*d.r+q*d.g+z*d.b;l.y=Y>=G?Z.minHeight+(Z.maxHeight-Z.minHeight)*P:Z.minHeight-E.e,Z.heightBuffer&&(Z.heightBuffer[W*(Z.subdivisions+1)+J]=l.y),C.push(l.x,l.y,l.z),b.push(0,0,0),f.push(J/Z.subdivisions,1-W/Z.subdivisions)}for(W=0;W<Z.subdivisions;W++)for(J=0;J<Z.subdivisions;J++){const B=J+1+(W+1)*(Z.subdivisions+1),x=J+1+W*(Z.subdivisions+1),b=J+W*(Z.subdivisions+1),K=J+(W+1)*(Z.subdivisions+1),f=C[3*B+1]>=Z.minHeight,d=C[3*x+1]>=Z.minHeight,E=C[3*b+1]>=Z.minHeight;f&&d&&E&&(l.push(B),l.push(x),l.push(b));C[3*K+1]>=Z.minHeight&&f&&E&&(l.push(K),l.push(B),l.push(b))}K.e.ComputeNormals(C,l,b);const q=new K.e;return q.indices=l,q.tZ=C,q.rZ=b,q.oZ=f,q}function Y(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=new W(Z,arguments.length>2?arguments[2]:void 0);C._setReady(!1),C._subdivisionsX=l.subdivisionsX||l.subdivisions||1,C._subdivisionsY=l.subdivisionsY||l.subdivisions||1,C._width=l.width||1,C._height=l.height||1,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ;return a(l).RZ(C,l.updatable),C._setReady(!0),C}function P(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new b.b(Z,C);return q(l).RZ(B,l.updatable),B}function S(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const b=C.width||10,K=C.height||10,f=C.subdivisions||1,E=C.minHeight||0,G=C.maxHeight||1,a=C.colorFilter||new x.Sl(.3,.59,.11),q=C.alphaFilter||0,Y=C.updatable,P=C.onReady;B=B||d.b.LastCreatedScene;const S=new W(Z,B);let i;S._subdivisionsX=f,S._subdivisionsY=f,S._width=b,S._height=K,S._maxX=S._width/2,S._maxZ=S._height/2,S._minX=-S._maxX,S._minZ=-S._maxZ,S._setReady(!1),C.passHeightBufferInCallback&&(i=new Float32Array((f+1)*(f+1)));const s=(Z,l,C)=>{z({width:b,height:K,subdivisions:f,minHeight:E,maxHeight:G,colorFilter:a,buffer:Z,bufferWidth:l,bufferHeight:C,alphaFilter:q,heightBuffer:i}).RZ(S,Y),P&&P(S,i),S._setReady(!0)};if("string"===typeof l){const Z=Z=>{var l;const C=Z.width,x=Z.height;if(B.J)return;const b=null===(l=B)||void 0===l?void 0:l.getEngine().resizeImageBitmap(Z,C,x);s(b,C,x)};J.Tools.LoadImage(l,Z,C.onError?C.onError:()=>{},B.offlineProvider)}else s(l.data,l.width,l.height);return S}K.e.CreateGround=a,K.e.CreateTiledGround=q,K.e.CreateGroundFromHeightMap=z,b.b.CreateGround=(Z,l,C,B,x,b)=>Y(Z,{width:l,height:C,subdivisions:B,updatable:b},x),b.b.CreateTiledGround=(Z,l,C,B,x,b,K,f,W)=>P(Z,{xmin:l,zmin:C,xmax:B,zmax:x,subdivisions:b,precision:K,updatable:W},f),b.b.CreateGroundFromHeightMap=(Z,l,C,B,x,b,K,f,W,J,d)=>S(Z,l,{width:C,height:B,subdivisions:x,minHeight:b,maxHeight:K,updatable:W,onReady:J,alphaFilter:d},f)},14009:(Z,l,C)=>{"use strict";C.d(l,{b:()=>a,d:()=>E,g:()=>G});var B=C(12442),x=C(12874),b=C(12861),K=C(12968),f=C(12530),W=C(12263);function J(Z){const l=[],C=[],B=Z.lines,x=Z.eZ,K=[];let f=0;for(let b=0;b<B.length;b++){const Z=B[b];for(let B=0;B<Z.length;B++){const{x:W,y:J,z:d}=Z[B];if(C.push(W,J,d),x){const Z=x[b],{r:l,g:C,b:f,a:W}=Z[B];K.push(l,C,f,W)}B>0&&(l.push(f-1),l.push(f)),f++}}const W=new b.e;return W.indices=l,W.tZ=C,x&&(W.eZ=K),W}function d(Z){const l=Z.dashSize||3,C=Z.gapSize||1,x=Z.dashNb||200,K=Z.points,f=[],W=[],J=B.ql.Zero();let d=0,E=0,G=0,a=0,q=0,z=0,Y=0;for(Y=0;Y<K.length-1;Y++)K[Y+1].subtractToRef(K[Y],J),d+=J.length();for(G=d/x,a=l*G/(l+C),Y=0;Y<K.length-1;Y++){K[Y+1].subtractToRef(K[Y],J),E=Math.floor(J.length()/G),J.normalize();for(let Z=0;Z<E;Z++)q=G*Z,f.push(K[Y].x+q*J.x,K[Y].y+q*J.y,K[Y].z+q*J.z),f.push(K[Y].x+(q+a)*J.x,K[Y].y+(q+a)*J.y,K[Y].z+(q+a)*J.z),W.push(z,z+1),z+=2}const P=new b.e;return P.tZ=f,P.indices=W,P}function E(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=l.instance,x=l.lines,b=l.eZ;if(B){const Z=B.getVerticesData(f.h.PositionKind);let l,C;b&&(l=B.getVerticesData(f.h.ColorKind));let K=0,W=0;for(let B=0;B<x.length;B++){const f=x[B];for(let x=0;x<f.length;x++)Z[K]=f[x].x,Z[K+1]=f[x].y,Z[K+2]=f[x].z,b&&l&&(C=b[B],l[W]=C[x].r,l[W+1]=C[x].g,l[W+2]=C[x].b,l[W+3]=C[x].a,W+=4),K+=3}return B.updateVerticesData(f.h.PositionKind,Z,!1,!1),b&&l&&B.updateVerticesData(f.h.ColorKind,l,!1,!1),B.refreshBoundingInfo(),B}const W=!!b,d=new K.d(Z,C,null,void 0,void 0,W,l.useVertexAlpha,l.material);return J(l).RZ(d,l.updatable),d}function G(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=l.eZ?[l.eZ]:null;return E(Z,{lines:[l.points],updatable:l.updatable,instance:l.instance,eZ:B,useVertexAlpha:l.useVertexAlpha,material:l.material},C)}function a(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=l.points,f=l.instance,J=l.gapSize||1,E=l.dashSize||3;if(f){const Z=Z=>{const l=B.ql.Zero(),C=Z.length/6;let x=0,K=0,W=0,J=0,d=0,E=0,G=0,a=0;for(G=0;G<b.length-1;G++)b[G+1].subtractToRef(b[G],l),x+=l.length();W=x/C;const q=f._creationDataStorage.dashSize;for(J=q*W/(q+f._creationDataStorage.gapSize),G=0;G<b.length-1;G++)for(b[G+1].subtractToRef(b[G],l),K=Math.floor(l.length()/W),l.normalize(),a=0;a<K&&E<Z.length;)d=W*a,Z[E]=b[G].x+d*l.x,Z[E+1]=b[G].y+d*l.y,Z[E+2]=b[G].z+d*l.z,Z[E+3]=b[G].x+(d+J)*l.x,Z[E+4]=b[G].y+(d+J)*l.y,Z[E+5]=b[G].z+(d+J)*l.z,E+=6,a++;for(;E<Z.length;)Z[E]=b[G].x,Z[E+1]=b[G].y,Z[E+2]=b[G].z,E+=3};return(l.dashNb||l.dashSize||l.gapSize||l.useVertexAlpha||l.material)&&W.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),f.updateMeshPositions(Z,!1),f}const G=new K.d(Z,C,null,void 0,void 0,void 0,l.useVertexAlpha,l.material);return d(l).RZ(G,l.updatable),G._creationDataStorage=new x.c,G._creationDataStorage.dashSize=E,G._creationDataStorage.gapSize=J,G}b.e.CreateLineSystem=J,b.e.CreateDashedLines=d,x.b.Gd=function(Z,l){return G(Z,{points:l,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},x.b.CreateDashedLines=function(Z,l,C,B,x){return a(Z,{points:l,dashSize:C,gapSize:B,dashNb:x,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13413:(Z,l,C)=>{"use strict";C.d(l,{b:()=>f,d:()=>W});var B=C(12874),x=C(12861),b=C(12511);function K(Z){const l=[],C=[],B=[],K=[],f=void 0!==Z.width?Z.width:void 0!==Z.size?Z.size:1,W=void 0!==Z.height?Z.height:void 0!==Z.size?Z.size:1,J=0===Z.sideOrientation?0:Z.sideOrientation||x.e.DEFAULTSIDE,d=f/2,E=W/2;C.push(-d,-E,0),B.push(0,0,-1),K.push(0,b.d?1:0),C.push(d,-E,0),B.push(0,0,-1),K.push(1,b.d?1:0),C.push(d,E,0),B.push(0,0,-1),K.push(1,b.d?0:1),C.push(-d,E,0),B.push(0,0,-1),K.push(0,b.d?0:1),l.push(0),l.push(1),l.push(2),l.push(0),l.push(2),l.push(3),x.e._ComputeSides(J,C,l,B,K,Z.frontUVs,Z.backUVs);const G=new x.e;return G.indices=l,G.tZ=C,G.rZ=B,G.oZ=K,G}function f(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new B.b(Z,C);l.sideOrientation=B.b._GetDefaultSideOrientation(l.sideOrientation),x._originalBuilderSideOrientation=l.sideOrientation;return K(l).RZ(x,l.updatable),l.sourcePlane&&(x.translate(l.sourcePlane.normal,-l.sourcePlane.d),x.setDirection(l.sourcePlane.normal.scale(-1))),x}const W={Yd:f};x.e.Yd=K,B.b.Yd=(Z,l,C,B,x)=>f(Z,{size:l,width:l,height:l,sideOrientation:x,updatable:B},C)},13492:(Z,l,C)=>{"use strict";C.d(l,{c:()=>W});var B=C(12442),x=C(12874),b=C(12861),K=C(12511);function f(Z){const l=0|(Z.segments||32),C=Z.diameterX||Z.diameter||1,x=Z.diameterY||Z.diameter||1,f=Z.diameterZ||Z.diameter||1,W=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,J=Z.slice&&Z.slice<=0?1:Z.slice||1,d=0===Z.sideOrientation?0:Z.sideOrientation||b.e.DEFAULTSIDE,E=!!Z.dedupTopBottomIndices,G=new B.ql(C/2,x/2,f/2),a=2+l,q=2*a,z=[],Y=[],P=[],S=[];for(let b=0;b<=a;b++){const Z=b/a,l=Z*Math.PI*J;for(let C=0;C<=q;C++){const x=C/q,b=x*Math.PI*2*W,f=B.Matrix.RotationZ(-l),J=B.Matrix.RotationY(b),d=B.ql.TransformCoordinates(B.ql.Up(),f),E=B.ql.TransformCoordinates(d,J),a=E.multiply(G),z=E.divide(G).normalize();Y.push(a.x,a.y,a.z),P.push(z.x,z.y,z.z),S.push(x,K.d?1-Z:Z)}if(b>0){const Z=Y.length/3;for(let l=Z-2*(q+1);l+q+2<Z;l++)E?(b>1&&(z.push(l),z.push(l+1),z.push(l+q+1)),(b<a||J<1)&&(z.push(l+q+1),z.push(l+1),z.push(l+q+2))):(z.push(l),z.push(l+1),z.push(l+q+1),z.push(l+q+1),z.push(l+1),z.push(l+q+2))}}b.e._ComputeSides(d,Y,z,P,S,Z.frontUVs,Z.backUVs);const i=new b.e;return i.indices=z,i.tZ=Y,i.rZ=P,i.oZ=S,i}function W(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new x.b(Z,C);l.sideOrientation=x.b._GetDefaultSideOrientation(l.sideOrientation),B._originalBuilderSideOrientation=l.sideOrientation;return f(l).RZ(B,l.updatable),B}b.e.CreateSphere=f,x.b.CreateSphere=(Z,l,C,B,x,b)=>W(Z,{segments:l,diameterX:C,diameterY:C,diameterZ:C,sideOrientation:b,updatable:x},B)},14295:(Z,l,C)=>{"use strict";C.d(l,{c:()=>f});var B=C(12995),x=C(13810),b=C(13008),K=C(12861);class f{static get Configuration(){return{get decoder(){return x.c.DefaultConfiguration},set decoder(Z){x.c.DefaultConfiguration=Z}}}static set Configuration(Z){x.c.DefaultConfiguration=Z.decoder}static get DecoderAvailable(){return(0,B.f)(x.c.DefaultConfiguration)}static get Default(){return f._Default??(f._Default=new f),f._Default}static ResetDefault(Z){f._Default&&(Z||f._Default.dispose(),f._Default=null)}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.DefaultNumWorkers;const l="number"===typeof Z?{...x.c.DefaultConfiguration,numWorkers:Z}:{...x.c.DefaultConfiguration,...Z};this._decoder=new x.c(l)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(Z,l,C){return this._decoder.decodeMeshToMeshDataAsync(Z,l,C)}async decodeMeshToGeometryAsync(Z,l,C,B){return await this._decoder.decodeMeshToGeometryAsync(Z,l,C,B)}async _decodeMeshToGeometryForGltfAsync(Z,l,C,B,x,b){return await this._decoder._decodeMeshToGeometryForGltfAsync(Z,l,C,B,x,b)}async decodeMeshAsync(Z,l){const C=await this._decoder.decodeMeshToMeshDataAsync(Z,l),B=new K.e;C.indices&&(B.indices=C.indices);for(const x of C.attributes){const Z=b.d.GetFloatData(x.data,x.size,b.d.GetDataType(x.data),x.byteOffset,x.byteStride,x.normalized,C.totalVertices);B.set(Z,x.kind)}return B}}f.DefaultNumWorkers=(0,B.e)(),f._Default=null},13810:(Z,l,C)=>{"use strict";C.d(l,{c:()=>J});var B=C(12995),x=C(12248),b=C(12888),K=C(13008),f=C(12263),W=C(13003);class J extends B.b{static get DefaultAvailable(){return(0,B.f)(J.DefaultConfiguration)}static get Default(){return J._Default??(J._Default=new J),J._Default}static ResetDefault(Z){J._Default&&(Z||J._Default.dispose(),J._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(Z,l){return{module:await(l||DracoDecoderModule)({wasmBinary:Z})}}_getWorkerContent(){return`${W.e}(${W.i})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.DefaultConfiguration)}decodeMeshToMeshDataAsync(Z,l,C){const B=Z instanceof ArrayBuffer?new Int8Array(Z):new Int8Array(Z.buffer,Z.byteOffset,Z.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async Z=>await new Promise(((x,b)=>{Z.push(((Z,K)=>{let W=null;const J=[],d=l=>{Z.removeEventListener("error",d),Z.removeEventListener("message",E),b(l),K()},E=l=>{const B=l.data;switch(B.id){case"indices":W=B.data;break;case"attribute":J.push({kind:B.kind,data:B.data,size:B.size,byteOffset:B.byteOffset,byteStride:B.byteStride,normalized:(b=B.kind,G=B.normalized,C&&void 0!==C[b]?(G!==C[b]&&f.e.Warn(`Normalized flag from Draco data (${G}) does not match normalized flag from glTF accessor (${C[b]}). Using flag from glTF accessor.`),C[b]):G)});break;case"decodeMeshDone":Z.removeEventListener("error",d),Z.removeEventListener("message",E),x({indices:W,attributes:J,totalVertices:B.totalVertices}),K()}var b,G};Z.addEventListener("error",d),Z.addEventListener("message",E);const G=B.slice();Z.postMessage({id:"decodeMesh",dataView:G,attributes:l},[G.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((Z=>{let C=null;const x=[],b=(0,W.e)(Z.module,B,l,(Z=>{C=Z}),((Z,l,C,B,b,K)=>{x.push({kind:Z,data:l,size:C,byteOffset:B,byteStride:b,normalized:K})}));return{indices:C,attributes:x,totalVertices:b}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(Z,l,C,B){const x=await this.decodeMeshToMeshDataAsync(C,B),f=new b.b(Z,l);x.indices&&f.setIndices(x.indices);for(const b of x.attributes)f.setVerticesBuffer(new K.d(l.getEngine(),b.data,b.kind,!1,void 0,b.byteStride,void 0,b.byteOffset,b.size,void 0,b.normalized,!0),x.totalVertices);return f}async _decodeMeshToGeometryForGltfAsync(Z,l,C,B,x,f){const W=await this.decodeMeshToMeshDataAsync(C,B,x),J=new b.b(Z,l);f&&(J._boundingInfo=f,J.useBoundingInfoFromGeometry=!0),W.indices&&J.setIndices(W.indices);for(const b of W.attributes)J.setVerticesBuffer(new K.d(l.getEngine(),b.data,b.kind,!1,void 0,b.byteStride,void 0,b.byteOffset,b.size,void 0,b.normalized,!0),W.totalVertices);return J}}J.DefaultConfiguration={wasmUrl:`${x.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${x.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${x.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},J._Default=null},14e3:(Z,l,C)=>{"use strict";C.d(l,{b:()=>fZ});var B=C(12442),x=C(12874),b=C(12530),K=C(12861),f=C(12511);function W(Z){let l=Z.pathArray;const C=Z.closeArray||!1,B=Z.closePath||!1,x=Z.invertUV||!1,W=Math.floor(l[0].length/2);let J=Z.offset||W;J=J>W?W:Math.floor(J);const d=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,E=Z.oZ,G=Z.eZ,a=[],q=[],z=[],Y=[],P=[],S=[],i=[],s=[];let F;const n=[],c=[];let U,t,r;if(l.length<2){const Z=[],C=[];for(t=0;t<l[0].length-J;t++)Z.push(l[0][t]),C.push(l[0][t+J]);l=[Z,C]}let e=0;const o=B?1:0,v=C?1:0;let R,k,V,g,j,M;for(F=l[0].length,U=0;U<l.length+v;U++){for(i[U]=0,P[U]=[0],R=U===l.length?l[0]:l[U],k=R.length,F=F<k?F:k,r=0;r<k;)a.push(R[r].x,R[r].y,R[r].z),r>0&&(V=R[r].zl(R[r-1]).length(),g=V+i[U],P[U].push(g),i[U]=g),r++;B&&(r--,a.push(R[0].x,R[0].y,R[0].z),V=R[r].zl(R[0]).length(),g=V+i[U],P[U].push(g),i[U]=g),n[U]=k+o,c[U]=e,e+=k+o}let I,w,O=null,D=null;for(t=0;t<F+o;t++)for(s[t]=0,S[t]=[0],U=0;U<l.length-1+v;U++)j=l[U],M=U===l.length-1?l[0]:l[U+1],t===F?(O=j[0],D=M[0]):(O=j[t],D=M[t]),V=D.zl(O).length(),g=V+s[t],S[t].push(g),s[t]=g;if(E)for(U=0;U<E.length;U++)Y.push(E[U].x,f.d?1-E[U].y:E[U].y);else for(U=0;U<l.length+v;U++)for(t=0;t<F+o;t++)I=0!=i[U]?P[U][t]/i[U]:0,w=0!=s[t]?S[t][U]/s[t]:0,x?Y.push(w,I):Y.push(I,f.d?1-w:w);U=0;let y=0,X=n[U]-1,T=n[U+1]-1,u=X<T?X:T,H=c[1]-c[0];const Q=n.length-1;for(;y<=u&&U<Q;)q.push(y,y+H,y+1),q.push(y+H+1,y+1,y+H),y+=1,y===u&&(U++,H=c[U+1]-c[U],X=n[U]-1,T=n[U+1]-1,y=c[U],u=X<T?X+y:T+y);if(K.e.ComputeNormals(a,q,z),B){let Z=0,C=0;for(U=0;U<l.length;U++){Z=3*c[U],C=U+1<l.length?3*(c[U+1]-1):z.length-3,z[Z]=.5*(z[Z]+z[C]),z[Z+1]=.5*(z[Z+1]+z[C+1]),z[Z+2]=.5*(z[Z+2]+z[C+2]);const B=Math.sqrt(z[Z]*z[Z]+z[Z+1]*z[Z+1]+z[Z+2]*z[Z+2]);z[Z]/=B,z[Z+1]/=B,z[Z+2]/=B,z[C]=z[Z],z[C+1]=z[Z+1],z[C+2]=z[Z+2]}}if(C){let Z=3*c[0],C=3*c[l.length];for(t=0;t<F+o;t++){z[Z]=.5*(z[Z]+z[C]),z[Z+1]=.5*(z[Z+1]+z[C+1]),z[Z+2]=.5*(z[Z+2]+z[C+2]);const l=Math.sqrt(z[Z]*z[Z]+z[Z+1]*z[Z+1]+z[Z+2]*z[Z+2]);z[Z]/=l,z[Z+1]/=l,z[Z+2]/=l,z[C]=z[Z],z[C+1]=z[Z+1],z[C+2]=z[Z+2],Z+=3,C+=3}}K.e._ComputeSides(d,a,q,z,Y,Z.frontUVs,Z.backUVs);let h=null;if(G){h=new Float32Array(4*G.length);for(let Z=0;Z<G.length;Z++)h[4*Z]=G[Z].r,h[4*Z+1]=G[Z].g,h[4*Z+2]=G[Z].b,h[4*Z+3]=G[Z].a}const A=new K.e,L=new Float32Array(a),p=new Float32Array(z),N=new Float32Array(Y);return A.indices=q,A.tZ=L,A.rZ=p,A.oZ=N,h&&A.set(h,b.h.ColorKind),B&&(A._idx=c),A}function J(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=l.pathArray,d=l.closeArray,E=l.closePath,G=x.b._GetDefaultSideOrientation(l.sideOrientation),a=l.instance,q=l.updatable;if(a){const Z=B.TmpVectors.ql[0].ob(Number.MAX_VALUE),C=B.TmpVectors.ql[1].ob(-Number.MAX_VALUE),W=l=>{let B=J[0].length;const b=a;let K=0;const f=b._originalBuilderSideOrientation===x.b.DOUBLESIDE?2:1;for(let x=1;x<=f;++x)for(let f=0;f<J.length;++f){const x=J[f],W=x.length;B=B<W?B:W;for(let b=0;b<B;++b){const B=x[b];l[K]=B.x,l[K+1]=B.y,l[K+2]=B.z,Z.minimizeInPlaceFromFloats(B.x,B.y,B.z),C.maximizeInPlaceFromFloats(B.x,B.y,B.z),K+=3}if(b._creationDataStorage&&b._creationDataStorage.closePath){const Z=x[0];l[K]=Z.x,l[K+1]=Z.y,l[K+2]=Z.z,K+=3}}},d=a.getVerticesData(b.h.PositionKind);if(W(d),a.hasBoundingInfo?a.getBoundingInfo().reConstruct(Z,C,a._worldMatrix):a.buildBoundingInfo(Z,C,a._worldMatrix),a.updateVerticesData(b.h.PositionKind,d,!1,!1),l.eZ){const Z=a.getVerticesData(b.h.ColorKind);for(let C=0,B=0;C<l.eZ.length;C++,B+=4){const x=l.eZ[C];Z[B]=x.r,Z[B+1]=x.g,Z[B+2]=x.b,Z[B+3]=x.a}a.updateVerticesData(b.h.ColorKind,Z,!1,!1)}if(l.oZ){const Z=a.getVerticesData(b.h.UVKind);for(let C=0;C<l.oZ.length;C++)Z[2*C]=l.oZ[C].x,Z[2*C+1]=f.d?1-l.oZ[C].y:l.oZ[C].y;a.updateVerticesData(b.h.UVKind,Z,!1,!1)}if(!a.areNormalsFrozen||a.isFacetDataEnabled){const Z=a.cb(),l=a.getVerticesData(b.h.NormalKind),C=a.isFacetDataEnabled?a.getFacetDataParameters():null;if(K.e.ComputeNormals(d,Z,l,C),a._creationDataStorage&&a._creationDataStorage.closePath){let Z=0,C=0;for(let B=0;B<J.length;B++)Z=3*a._creationDataStorage.idx[B],C=B+1<J.length?3*(a._creationDataStorage.idx[B+1]-1):l.length-3,l[Z]=.5*(l[Z]+l[C]),l[Z+1]=.5*(l[Z+1]+l[C+1]),l[Z+2]=.5*(l[Z+2]+l[C+2]),l[C]=l[Z],l[C+1]=l[Z+1],l[C+2]=l[Z+2]}a.areNormalsFrozen||a.updateVerticesData(b.h.NormalKind,l,!1,!1)}return a}{const B=new x.b(Z,C);B._originalBuilderSideOrientation=G,B._creationDataStorage=new x.c;const b=W(l);return E&&(B._creationDataStorage.idx=b._idx),B._creationDataStorage.closePath=E,B._creationDataStorage.closeArray=d,b.RZ(B,q),B}}K.e.CreateRibbon=W,x.b.CreateRibbon=function(Z,l){return J(Z,{pathArray:l,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var d=C(13506),E=C(13362),G=C(12494);function a(Z){const l=Z.pattern||x.b.NO_FLIP,C=Z.tileWidth||Z.tileSize||1,B=Z.tileHeight||Z.tileSize||1,b=Z.alignHorizontal||0,f=Z.alignVertical||0,W=Z.width||Z.size||1,J=Math.floor(W/C);let d=W-J*C;const E=Z.height||Z.size||1,G=Math.floor(E/B);let a=E-G*B;const q=C*J/2,z=B*G/2;let Y=0,P=0,S=0,i=0,s=0,F=0;if(d>0||a>0){switch(S=-q,i=-z,s=q,F=z,b){case x.b.CENTER:d/=2,S-=d,s+=d;break;case x.b.LEFT:s+=d,Y=-d/2;break;case x.b.RIGHT:S-=d,Y=d/2}switch(f){case x.b.CENTER:a/=2,i-=a,F+=a;break;case x.b.BOTTOM:F+=a,P=-a/2;break;case x.b.TOP:i-=a,P=a/2}}const n=[],c=[],U=[];U[0]=[0,0,1,0,1,1,0,1],U[1]=[0,0,1,0,1,1,0,1],l!==x.b.ROTATE_TILE&&l!==x.b.ROTATE_ROW||(U[1]=[1,1,0,1,0,0,1,0]),l!==x.b.FLIP_TILE&&l!==x.b.FLIP_ROW||(U[1]=[1,0,0,0,0,1,1,1]),l!==x.b.FLIP_N_ROTATE_TILE&&l!==x.b.FLIP_N_ROTATE_ROW||(U[1]=[0,1,1,1,1,0,0,0]);let t=[];const r=[],e=[];let o=0;for(let K=0;K<G;K++)for(let Z=0;Z<J;Z++)n.push(Z*C-q+Y,K*B-z+P,0),n.push((Z+1)*C-q+Y,K*B-z+P,0),n.push((Z+1)*C-q+Y,(K+1)*B-z+P,0),n.push(Z*C-q+Y,(K+1)*B-z+P,0),e.push(o,o+1,o+3,o+1,o+2,o+3),t=l===x.b.FLIP_TILE||l===x.b.ROTATE_TILE||l===x.b.FLIP_N_ROTATE_TILE?t.concat(U[(Z%2+K%2)%2]):l===x.b.FLIP_ROW||l===x.b.ROTATE_ROW||l===x.b.FLIP_N_ROTATE_ROW?t.concat(U[K%2]):t.concat(U[0]),r.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),o+=4;if(d>0||a>0){const Z=a>0&&(f===x.b.CENTER||f===x.b.TOP),K=a>0&&(f===x.b.CENTER||f===x.b.BOTTOM),W=d>0&&(b===x.b.CENTER||b===x.b.RIGHT),E=d>0&&(b===x.b.CENTER||b===x.b.LEFT);let U,v,R,k,V=[];if(Z&&W&&(n.push(S+Y,i+P,0),n.push(-q+Y,i+P,0),n.push(-q+Y,i+a+P,0),n.push(S+Y,i+a+P,0),e.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,U=1-d/C,v=1-a/B,R=1,k=1,V=[U,v,R,v,R,k,U,k],l===x.b.ROTATE_ROW&&(V=[1-U,1-v,1-R,1-v,1-R,1-k,1-U,1-k]),l===x.b.FLIP_ROW&&(V=[1-U,v,1-R,v,1-R,k,1-U,k]),l===x.b.FLIP_N_ROTATE_ROW&&(V=[U,1-v,R,1-v,R,1-k,U,1-k]),t=t.concat(V),r.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z&&E&&(n.push(q+Y,i+P,0),n.push(s+Y,i+P,0),n.push(s+Y,i+a+P,0),n.push(q+Y,i+a+P,0),e.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,U=0,v=1-a/B,R=d/C,k=1,V=[U,v,R,v,R,k,U,k],(l===x.b.ROTATE_ROW||l===x.b.ROTATE_TILE&&J%2===0)&&(V=[1-U,1-v,1-R,1-v,1-R,1-k,1-U,1-k]),(l===x.b.FLIP_ROW||l===x.b.FLIP_TILE&&J%2===0)&&(V=[1-U,v,1-R,v,1-R,k,1-U,k]),(l===x.b.FLIP_N_ROTATE_ROW||l===x.b.FLIP_N_ROTATE_TILE&&J%2===0)&&(V=[U,1-v,R,1-v,R,1-k,U,1-k]),t=t.concat(V),r.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K&&W&&(n.push(S+Y,z+P,0),n.push(-q+Y,z+P,0),n.push(-q+Y,F+P,0),n.push(S+Y,F+P,0),e.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,U=1-d/C,v=0,R=1,k=a/B,V=[U,v,R,v,R,k,U,k],(l===x.b.ROTATE_ROW&&G%2===1||l===x.b.ROTATE_TILE&&G%1===0)&&(V=[1-U,1-v,1-R,1-v,1-R,1-k,1-U,1-k]),(l===x.b.FLIP_ROW&&G%2===1||l===x.b.FLIP_TILE&&G%2===0)&&(V=[1-U,v,1-R,v,1-R,k,1-U,k]),(l===x.b.FLIP_N_ROTATE_ROW&&G%2===1||l===x.b.FLIP_N_ROTATE_TILE&&G%2===0)&&(V=[U,1-v,R,1-v,R,1-k,U,1-k]),t=t.concat(V),r.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K&&E&&(n.push(q+Y,z+P,0),n.push(s+Y,z+P,0),n.push(s+Y,F+P,0),n.push(q+Y,F+P,0),e.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,U=0,v=0,R=d/C,k=a/B,V=[U,v,R,v,R,k,U,k],(l===x.b.ROTATE_ROW&&G%2===1||l===x.b.ROTATE_TILE&&(G+J)%2===1)&&(V=[1-U,1-v,1-R,1-v,1-R,1-k,1-U,1-k]),(l===x.b.FLIP_ROW&&G%2===1||l===x.b.FLIP_TILE&&(G+J)%2===1)&&(V=[1-U,v,1-R,v,1-R,k,1-U,k]),(l===x.b.FLIP_N_ROTATE_ROW&&G%2===1||l===x.b.FLIP_N_ROTATE_TILE&&(G+J)%2===1)&&(V=[U,1-v,R,1-v,R,1-k,U,1-k]),t=t.concat(V),r.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z){const Z=[];U=0,v=1-a/B,R=1,k=1,Z[0]=[U,v,R,v,R,k,U,k],Z[1]=[U,v,R,v,R,k,U,k],l!==x.b.ROTATE_TILE&&l!==x.b.ROTATE_ROW||(Z[1]=[1-U,1-v,1-R,1-v,1-R,1-k,1-U,1-k]),l!==x.b.FLIP_TILE&&l!==x.b.FLIP_ROW||(Z[1]=[1-U,v,1-R,v,1-R,k,1-U,k]),l!==x.b.FLIP_N_ROTATE_TILE&&l!==x.b.FLIP_N_ROTATE_ROW||(Z[1]=[U,1-v,R,1-v,R,1-k,U,1-k]);for(let B=0;B<J;B++)n.push(B*C-q+Y,i+P,0),n.push((B+1)*C-q+Y,i+P,0),n.push((B+1)*C-q+Y,i+a+P,0),n.push(B*C-q+Y,i+a+P,0),e.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,t=l===x.b.FLIP_TILE||l===x.b.ROTATE_TILE||l===x.b.FLIP_N_ROTATE_TILE?t.concat(Z[(B+1)%2]):l===x.b.FLIP_ROW||l===x.b.ROTATE_ROW||l===x.b.FLIP_N_ROTATE_ROW?t.concat(Z[1]):t.concat(Z[0]),r.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(K){const Z=[];U=0,v=0,R=1,k=a/B,Z[0]=[U,v,R,v,R,k,U,k],Z[1]=[U,v,R,v,R,k,U,k],l!==x.b.ROTATE_TILE&&l!==x.b.ROTATE_ROW||(Z[1]=[1-U,1-v,1-R,1-v,1-R,1-k,1-U,1-k]),l!==x.b.FLIP_TILE&&l!==x.b.FLIP_ROW||(Z[1]=[1-U,v,1-R,v,1-R,k,1-U,k]),l!==x.b.FLIP_N_ROTATE_TILE&&l!==x.b.FLIP_N_ROTATE_ROW||(Z[1]=[U,1-v,R,1-v,R,1-k,U,1-k]);for(let B=0;B<J;B++)n.push(B*C-q+Y,F-a+P,0),n.push((B+1)*C-q+Y,F-a+P,0),n.push((B+1)*C-q+Y,F+P,0),n.push(B*C-q+Y,F+P,0),e.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,t=l===x.b.FLIP_TILE||l===x.b.ROTATE_TILE||l===x.b.FLIP_N_ROTATE_TILE?t.concat(Z[(B+G)%2]):l===x.b.FLIP_ROW||l===x.b.ROTATE_ROW||l===x.b.FLIP_N_ROTATE_ROW?t.concat(Z[G%2]):t.concat(Z[0]),r.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(W){const Z=[];U=1-d/C,v=0,R=1,k=1,Z[0]=[U,v,R,v,R,k,U,k],Z[1]=[U,v,R,v,R,k,U,k],l!==x.b.ROTATE_TILE&&l!==x.b.ROTATE_ROW||(Z[1]=[1-U,1-v,1-R,1-v,1-R,1-k,1-U,1-k]),l!==x.b.FLIP_TILE&&l!==x.b.FLIP_ROW||(Z[1]=[1-U,v,1-R,v,1-R,k,1-U,k]),l!==x.b.FLIP_N_ROTATE_TILE&&l!==x.b.FLIP_N_ROTATE_ROW||(Z[1]=[U,1-v,R,1-v,R,1-k,U,1-k]);for(let C=0;C<G;C++)n.push(S+Y,C*B-z+P,0),n.push(S+d+Y,C*B-z+P,0),n.push(S+d+Y,(C+1)*B-z+P,0),n.push(S+Y,(C+1)*B-z+P,0),e.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,t=l===x.b.FLIP_TILE||l===x.b.ROTATE_TILE||l===x.b.FLIP_N_ROTATE_TILE?t.concat(Z[(C+1)%2]):l===x.b.FLIP_ROW||l===x.b.ROTATE_ROW||l===x.b.FLIP_N_ROTATE_ROW?t.concat(Z[C%2]):t.concat(Z[0]),r.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(E){const Z=[];U=0,v=0,R=d/B,k=1,Z[0]=[U,v,R,v,R,k,U,k],Z[1]=[U,v,R,v,R,k,U,k],l!==x.b.ROTATE_TILE&&l!==x.b.ROTATE_ROW||(Z[1]=[1-U,1-v,1-R,1-v,1-R,1-k,1-U,1-k]),l!==x.b.FLIP_TILE&&l!==x.b.FLIP_ROW||(Z[1]=[1-U,v,1-R,v,1-R,k,1-U,k]),l!==x.b.FLIP_N_ROTATE_TILE&&l!==x.b.FLIP_N_ROTATE_ROW||(Z[1]=[U,1-v,R,1-v,R,1-k,U,1-k]);for(let C=0;C<G;C++)n.push(s-d+Y,C*B-z+P,0),n.push(s+Y,C*B-z+P,0),n.push(s+Y,(C+1)*B-z+P,0),n.push(s-d+Y,(C+1)*B-z+P,0),e.push(o,o+1,o+3,o+1,o+2,o+3),o+=4,t=l===x.b.FLIP_TILE||l===x.b.ROTATE_TILE||l===x.b.FLIP_N_ROTATE_TILE?t.concat(Z[(C+J)%2]):l===x.b.FLIP_ROW||l===x.b.ROTATE_ROW||l===x.b.FLIP_N_ROTATE_ROW?t.concat(Z[C%2]):t.concat(Z[0]),r.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),c.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const v=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE;K.e._ComputeSides(v,n,e,c,t,Z.frontUVs,Z.backUVs);const R=new K.e;R.indices=e,R.tZ=n,R.rZ=c,R.oZ=t;const k=v===K.e.DOUBLESIDE?r.concat(r):r;return R.eZ=k,R}function q(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new x.b(Z,C);l.sideOrientation=x.b._GetDefaultSideOrientation(l.sideOrientation),B._originalBuilderSideOrientation=l.sideOrientation;return a(l).RZ(B,l.updatable),B}function z(Z){const l=Z.faceUV||new Array(6),C=Z.faceColors,b=Z.pattern||x.b.NO_FLIP,W=Z.width||Z.size||1,J=Z.height||Z.size||1,d=Z.depth||Z.size||1,E=Z.tileWidth||Z.tileSize||1,q=Z.tileHeight||Z.tileSize||1,z=Z.alignHorizontal||0,Y=Z.alignVertical||0,P=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE;for(let x=0;x<6;x++)void 0===l[x]&&(l[x]=new B.Vector4(0,0,1,1)),C&&void 0===C[x]&&(C[x]=new G.Rb(1,1,1,1));const S=W/2,i=J/2,s=d/2,F=[];for(let B=0;B<2;B++)F[B]=a({pattern:b,tileWidth:E,tileHeight:q,width:W,height:J,alignVertical:Y,alignHorizontal:z,sideOrientation:P});for(let B=2;B<4;B++)F[B]=a({pattern:b,tileWidth:E,tileHeight:q,width:d,height:J,alignVertical:Y,alignHorizontal:z,sideOrientation:P});let n=Y;Y===x.b.BOTTOM?n=x.b.TOP:Y===x.b.TOP&&(n=x.b.BOTTOM);for(let B=4;B<6;B++)F[B]=a({pattern:b,tileWidth:E,tileHeight:q,width:W,height:d,alignVertical:n,alignHorizontal:z,sideOrientation:P});let c=[],U=[],t=[],r=[];const e=[],o=[],v=[],R=[];let k=0,V=0;for(let x=0;x<6;x++){const Z=F[x].tZ.length;o[x]=[],v[x]=[];for(let l=0;l<Z/3;l++)o[x].push(new B.ql(F[x].tZ[3*l],F[x].tZ[3*l+1],F[x].tZ[3*l+2])),v[x].push(new B.ql(F[x].rZ[3*l],F[x].rZ[3*l+1],F[x].rZ[3*l+2]));k=F[x].oZ.length,R[x]=[];for(let C=0;C<k;C+=2)R[x][C]=l[x].x+(l[x].z-l[x].x)*F[x].oZ[C],R[x][C+1]=l[x].y+(l[x].w-l[x].y)*F[x].oZ[C+1],f.d&&(R[x][C+1]=1-R[x][C+1]);if(t=t.concat(R[x]),r=r.concat(F[x].indices.map((Z=>Z+V))),V+=o[x].length,C)for(let l=0;l<4;l++)e.push(C[x].r,C[x].g,C[x].b,C[x].a)}const g=new B.ql(0,0,s),j=B.Matrix.RotationY(Math.PI);c=o[0].map((Z=>B.ql.TransformNormal(Z,j).add(g))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[]),U=v[0].map((Z=>B.ql.TransformNormal(Z,j))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[]),c=c.concat(o[1].map((Z=>Z.zl(g))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[])),U=U.concat(v[1].map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[]));const M=new B.ql(S,0,0),I=B.Matrix.RotationY(-Math.PI/2);c=c.concat(o[2].map((Z=>B.ql.TransformNormal(Z,I).add(M))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[])),U=U.concat(v[2].map((Z=>B.ql.TransformNormal(Z,I))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[]));const w=B.Matrix.RotationY(Math.PI/2);c=c.concat(o[3].map((Z=>B.ql.TransformNormal(Z,w).zl(M))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[])),U=U.concat(v[3].map((Z=>B.ql.TransformNormal(Z,w))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[]));const O=new B.ql(0,i,0),D=B.Matrix.RotationX(Math.PI/2);c=c.concat(o[4].map((Z=>B.ql.TransformNormal(Z,D).add(O))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[])),U=U.concat(v[4].map((Z=>B.ql.TransformNormal(Z,D))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[]));const y=B.Matrix.RotationX(-Math.PI/2);c=c.concat(o[5].map((Z=>B.ql.TransformNormal(Z,y).zl(O))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[])),U=U.concat(v[5].map((Z=>B.ql.TransformNormal(Z,y))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,l)=>Z.concat(l)),[])),K.e._ComputeSides(P,c,r,U,t);const X=new K.e;if(X.indices=r,X.tZ=c,X.rZ=U,X.oZ=t,C){const Z=P===K.e.DOUBLESIDE?e.concat(e):e;X.eZ=Z}return X}function Y(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new x.b(Z,C);l.sideOrientation=x.b._GetDefaultSideOrientation(l.sideOrientation),B._originalBuilderSideOrientation=l.sideOrientation;return z(l).RZ(B,l.updatable),B}K.e.CreateTiledPlane=a;K.e.CreateTiledBox=z;var P=C(13492),S=C(12704),i=C(12668);function s(Z){const l=Z.height||2;let C=0===Z.diameterTop?0:Z.diameterTop||Z.diameter||1,b=0===Z.diameterBottom?0:Z.diameterBottom||Z.diameter||1;C=C||1e-5,b=b||1e-5;const W=0|(Z.tessellation||24),J=0|(Z.subdivisions||1),d=!!Z.hasRings,E=!!Z.enclose,a=0===Z.cap?0:Z.cap||x.b.CAP_ALL,q=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,z=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,Y=Z.faceUV||new Array(3),P=Z.faceColors,S=2+(1+(1!==q&&E?2:0))*(d?J:1);let s;for(s=0;s<S;s++)P&&void 0===P[s]&&(P[s]=new G.Rb(1,1,1,1));for(s=0;s<S;s++)Y&&void 0===Y[s]&&(Y[s]=new B.Vector4(0,0,1,1));const F=[],n=[],c=[],U=[],t=[],r=2*Math.PI*q/W;let e,o,v;const R=(b-C)/2/l,k=B.ql.Zero(),V=B.ql.Zero(),g=B.ql.Zero(),j=B.ql.Zero(),M=B.ql.Zero(),I=i.b.Y;let w,O,D,y=1,X=1,T=0,u=0;for(w=0;w<=J;w++)for(o=w/J,v=(o*(C-b)+b)/2,y=d&&0!==w&&w!==J?2:1,D=0;D<y;D++){for(d&&(X+=D),E&&(X+=2*D),O=0;O<=W;O++)e=O*r,k.x=Math.cos(-e)*v,k.y=-l/2+o*l,k.z=Math.sin(-e)*v,0===C&&w===J?(V.x=c[c.length-3*(W+1)],V.y=c[c.length-3*(W+1)+1],V.z=c[c.length-3*(W+1)+2]):(V.x=k.x,V.z=k.z,V.y=Math.sqrt(V.x*V.x+V.z*V.z)*R,V.normalize()),0===O&&(g.B(k),j.B(V)),n.push(k.x,k.y,k.z),c.push(V.x,V.y,V.z),u=d?T!==X?Y[X].y:Y[X].w:Y[X].y+(Y[X].w-Y[X].y)*o,U.push(Y[X].x+(Y[X].z-Y[X].x)*O/W,f.d?1-u:u),P&&t.push(P[X].r,P[X].g,P[X].b,P[X].a);1!==q&&E&&(n.push(k.x,k.y,k.z),n.push(0,k.y,0),n.push(0,k.y,0),n.push(g.x,g.y,g.z),B.ql.CrossToRef(I,V,M),M.normalize(),c.push(M.x,M.y,M.z,M.x,M.y,M.z),B.ql.CrossToRef(j,I,M),M.normalize(),c.push(M.x,M.y,M.z,M.x,M.y,M.z),u=d?T!==X?Y[X+1].y:Y[X+1].w:Y[X+1].y+(Y[X+1].w-Y[X+1].y)*o,U.push(Y[X+1].x,f.d?1-u:u),U.push(Y[X+1].z,f.d?1-u:u),u=d?T!==X?Y[X+2].y:Y[X+2].w:Y[X+2].y+(Y[X+2].w-Y[X+2].y)*o,U.push(Y[X+2].x,f.d?1-u:u),U.push(Y[X+2].z,f.d?1-u:u),P&&(t.push(P[X+1].r,P[X+1].g,P[X+1].b,P[X+1].a),t.push(P[X+1].r,P[X+1].g,P[X+1].b,P[X+1].a),t.push(P[X+2].r,P[X+2].g,P[X+2].b,P[X+2].a),t.push(P[X+2].r,P[X+2].g,P[X+2].b,P[X+2].a))),T!==X&&(T=X)}const H=1!==q&&E?W+4:W;for(w=0,X=0;X<J;X++){let Z=0,l=0,C=0,B=0;for(O=0;O<W;O++)Z=w*(H+1)+O,l=(w+1)*(H+1)+O,C=w*(H+1)+(O+1),B=(w+1)*(H+1)+(O+1),F.push(Z,l,C),F.push(B,C,l);1!==q&&E&&(F.push(Z+2,l+2,C+2),F.push(B+2,C+2,l+2),F.push(Z+4,l+4,C+4),F.push(B+4,C+4,l+4)),w=d?w+2:w+1}const Q=Z=>{const x=Z?C/2:b/2;if(0===x)return;let K,J,d;const E=Z?Y[S-1]:Y[0];let G=null;P&&(G=Z?P[S-1]:P[0]);const a=n.length/3,z=Z?l/2:-l/2,i=new B.ql(0,z,0);n.push(i.x,i.y,i.z),c.push(0,Z?1:-1,0);const s=E.y+.5*(E.w-E.y);U.push(E.x+.5*(E.z-E.x),f.d?1-s:s),G&&t.push(G.r,G.g,G.b,G.a);const r=new B.Vector2(.5,.5);for(d=0;d<=W;d++){K=2*Math.PI*d*q/W;const l=Math.cos(-K),C=Math.sin(-K);J=new B.ql(l*x,z,C*x);const b=new B.Vector2(l*r.x+.5,C*r.y+.5);n.push(J.x,J.y,J.z),c.push(0,Z?1:-1,0);const a=E.y+(E.w-E.y)*b.y;U.push(E.x+(E.z-E.x)*b.x,f.d?1-a:a),G&&t.push(G.r,G.g,G.b,G.a)}for(d=0;d<W;d++)Z?(F.push(a),F.push(a+(d+2)),F.push(a+(d+1))):(F.push(a),F.push(a+(d+1)),F.push(a+(d+2)))};a!==x.b.CAP_START&&a!==x.b.CAP_ALL||Q(!1),a!==x.b.CAP_END&&a!==x.b.CAP_ALL||Q(!0),K.e._ComputeSides(z,n,F,c,U,Z.frontUVs,Z.backUVs);const h=new K.e;return h.indices=F,h.tZ=n,h.rZ=c,h.oZ=U,P&&(h.eZ=t),h}function F(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const B=new x.b(Z,C);l.sideOrientation=x.b._GetDefaultSideOrientation(l.sideOrientation),B._originalBuilderSideOrientation=l.sideOrientation;return s(l).RZ(B,l.updatable),B}function n(Z){const l=[],C=[],x=[],b=[],W=Z.diameter||1,J=Z.thickness||.5,d=0|(Z.tessellation||16),E=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,G=d+1;for(let K=0;K<=d;K++){const Z=K/d,E=K*Math.PI*2/d-Math.PI/2,a=B.Matrix.Translation(W/2,0,0).multiply(B.Matrix.RotationY(E));for(let W=0;W<=d;W++){const E=1-W/d,q=W*Math.PI*2/d+Math.PI,z=Math.cos(q),Y=Math.sin(q);let P=new B.ql(z,Y,0),S=P.scale(J/2);const i=new B.Vector2(Z,E);S=B.ql.TransformCoordinates(S,a),P=B.ql.TransformNormal(P,a),C.push(S.x,S.y,S.z),x.push(P.x,P.y,P.z),b.push(i.x,f.d?1-i.y:i.y);const s=(K+1)%G,F=(W+1)%G;l.push(K*G+W),l.push(K*G+F),l.push(s*G+W),l.push(K*G+F),l.push(s*G+F),l.push(s*G+W)}}K.e._ComputeSides(E,C,l,x,b,Z.frontUVs,Z.backUVs);const a=new K.e;return a.indices=l,a.tZ=C,a.rZ=x,a.oZ=b,a}function c(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const B=new x.b(Z,C);l.sideOrientation=x.b._GetDefaultSideOrientation(l.sideOrientation),B._originalBuilderSideOrientation=l.sideOrientation;return n(l).RZ(B,l.updatable),B}K.e.CreateCylinder=s,x.b.CreateCylinder=(Z,l,C,B,b,K,f,W,J)=>{void 0!==f&&f instanceof S.e||(void 0!==f&&(J=W||x.b.DEFAULTSIDE,W=f),f=K,K=1);return F(Z,{height:l,diameterTop:C,diameterBottom:B,tessellation:b,subdivisions:K,sideOrientation:J,updatable:W},f)};function U(Z){const l=[],C=[],x=[],b=[],W=Z.radius||2,J=Z.tube||.5,d=Z.radialSegments||32,E=Z.tubularSegments||32,G=Z.p||2,a=Z.q||3,q=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,z=Z=>{const l=Math.cos(Z),C=Math.sin(Z),x=a/G*Z,b=Math.cos(x),K=W*(2+b)*.5*l,f=W*(2+b)*C*.5,J=W*Math.sin(x)*.5;return new B.ql(K,f,J)};let Y,P;for(Y=0;Y<=d;Y++){const Z=Y%d/d*2*G*Math.PI,l=z(Z),x=z(Z+.01),K=x.zl(l);let W=x.add(l);const a=B.ql.Cross(K,W);for(W=B.ql.Cross(a,K),a.normalize(),W.normalize(),P=0;P<E;P++){const Z=P%E/E*2*Math.PI,B=-J*Math.cos(Z),x=J*Math.sin(Z);C.push(l.x+B*W.x+x*a.x),C.push(l.y+B*W.y+x*a.y),C.push(l.z+B*W.z+x*a.z),b.push(Y/d),b.push(f.d?1-P/E:P/E)}}for(Y=0;Y<d;Y++)for(P=0;P<E;P++){const Z=(P+1)%E,C=Y*E+P,B=(Y+1)*E+P,x=(Y+1)*E+Z,b=Y*E+Z;l.push(b),l.push(B),l.push(C),l.push(b),l.push(x),l.push(B)}K.e.ComputeNormals(C,l,x),K.e._ComputeSides(q,C,l,x,b,Z.frontUVs,Z.backUVs);const S=new K.e;return S.indices=l,S.tZ=C,S.rZ=x,S.oZ=b,S}function t(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const B=new x.b(Z,C);l.sideOrientation=x.b._GetDefaultSideOrientation(l.sideOrientation),B._originalBuilderSideOrientation=l.sideOrientation;return U(l).RZ(B,l.updatable),B}K.e.CreateTorus=n,x.b.CreateTorus=(Z,l,C,B,x,b,K)=>c(Z,{diameter:l,thickness:C,tessellation:B,sideOrientation:K,updatable:b},x);K.e.CreateTorusKnot=U,x.b.CreateTorusKnot=(Z,l,C,B,x,b,K,f,W,J)=>t(Z,{radius:l,tube:C,radialSegments:B,tubularSegments:x,p:b,q:K,sideOrientation:J,updatable:W},f);var r=C(14009),e=C(12978),o=C(12680);function v(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=l.path,b=l.shape,K=l.scale||1,f=l.rotation||0,W=0===l.cap?0:l.cap||x.b.NO_CAP,J=l.updatable,d=x.b._GetDefaultSideOrientation(l.sideOrientation),E=l.instance||null,G=l.invertUV||!1,a=l.closeShape||!1,q=l.closePath||!1,z=l.capFunction||null;return k(Z,b,B,K,f,null,null,q,a,W,!1,C,!!J,d,E,G,l.frontUVs||null,l.backUVs||null,l.firstNormal||null,!!l.adjustFrame,z)}function R(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=l.path,b=l.shape,K=l.scaleFunction||(()=>1),f=l.rotationFunction||(()=>0),W=l.closePath||l.ribbonCloseArray||!1,J=l.closeShape||l.ribbonClosePath||!1,d=0===l.cap?0:l.cap||x.b.NO_CAP,E=l.updatable,G=l.firstNormal||null,a=l.adjustFrame||!1,q=x.b._GetDefaultSideOrientation(l.sideOrientation),z=l.instance,Y=l.invertUV||!1,P=l.capFunction||null;return k(Z,b,B,null,null,K,f,W,J,d,!0,C,!!E,q,z||null,Y,l.frontUVs||null,l.backUVs||null,G,a,P||null)}function k(Z,l,C,b,K,f,W,d,E,G,a,q,z,Y,P,S,i,s,F,n,c){const U=(Z,l,C,b,K,f,W,J,d,E,G)=>{const a=C.getTangents(),q=C.getNormals(),z=C.getBinormals(),Y=C.getDistances();if(G)for(let x=0;x<a.length;x++)if(0==a[x].x&&0==a[x].y&&0==a[x].z&&a[x].B(a[x-1]),0==q[x].x&&0==q[x].y&&0==q[x].z&&q[x].B(q[x-1]),0==z[x].x&&0==z[x].y&&0==z[x].z&&z[x].B(z[x-1]),x>0){let Z=a[x-1];B.ql.Dot(Z,a[x])<0&&a[x].scaleInPlace(-1),Z=q[x-1],B.ql.Dot(Z,q[x])<0&&q[x].scaleInPlace(-1),Z=z[x-1],B.ql.Dot(Z,z[x])<0&&z[x].scaleInPlace(-1)}let P=0;const S=E&&J?J:()=>null!==f?f:0,i=E&&W?W:()=>null!==K?K:1;let s=d===x.b.NO_CAP||d===x.b.CAP_END?0:2;const F=B.TmpVectors.Matrix[0];for(let x=0;x<l.length;x++){const C=[],K=S(x,Y[x]),f=i(x,Y[x]);B.Matrix.RotationAxisToRef(a[x],P,F);for(let b=0;b<Z.length;b++){const K=a[x].scale(Z[b].z).add(q[x].scale(Z[b].x)).add(z[x].scale(Z[b].y)),W=B.ql.Zero();B.ql.TransformCoordinatesToRef(K,F,W),W.scaleInPlace(f).addInPlace(l[x]),C[b]=W}b[s]=C,P+=K,s++}const n=c||(Z=>{const l=Array(),C=B.ql.Zero();let x;for(x=0;x<Z.length;x++)C.addInPlace(Z[x]);for(C.scaleInPlace(1/Z.length),x=0;x<Z.length;x++)l.push(C);return l});switch(d){case x.b.NO_CAP:break;case x.b.CAP_START:b[0]=n(b[2]),b[1]=b[2];break;case x.b.CAP_END:b[s]=b[s-1],b[s+1]=n(b[s-1]);break;case x.b.CAP_ALL:b[0]=n(b[2]),b[1]=b[2],b[s]=b[s-1],b[s+1]=n(b[s-1])}return b};let t,r;if(P){const Z=P._creationDataStorage;return t=F?Z.path3D.update(C,F):Z.path3D.update(C),r=U(l,C,Z.path3D,Z.pathArray,b,K,f,W,Z.cap,a,n),P=J("",{pathArray:r,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:P},q||void 0)}t=F?new o.l(C,F):new o.l(C);r=U(l,C,t,new Array,b,K,f,W,G=G<0||G>3?0:G,a,n);const e=J(Z,{pathArray:r,closeArray:d,closePath:E,updatable:z,sideOrientation:Y,invertUV:S,frontUVs:i||void 0,backUVs:s||void 0},q);return e._creationDataStorage.pathArray=r,e._creationDataStorage.path3D=t,e._creationDataStorage.cap=G,e}function V(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=l.arc?l.arc<=0||l.arc>1?1:l.arc:1,K=void 0===l.closed||l.closed,f=l.shape,W=l.radius||1,d=l.tessellation||64,E=l.clip||0,G=l.updatable,a=x.b._GetDefaultSideOrientation(l.sideOrientation),q=l.cap||x.b.NO_CAP,z=2*Math.PI,Y=[],P=l.invertUV||!1;let S=0,i=0;const s=z/d*b;let F,n;for(S=0;S<=d-E;S++){for(n=[],q!=x.b.CAP_START&&q!=x.b.CAP_ALL||(n.push(new B.ql(0,f[0].y,0)),n.push(new B.ql(Math.cos(S*s)*f[0].x*W,f[0].y,Math.sin(S*s)*f[0].x*W))),i=0;i<f.length;i++)F=new B.ql(Math.cos(S*s)*f[i].x*W,f[i].y,Math.sin(S*s)*f[i].x*W),n.push(F);q!=x.b.CAP_END&&q!=x.b.CAP_ALL||(n.push(new B.ql(Math.cos(S*s)*f[f.length-1].x*W,f[f.length-1].y,Math.sin(S*s)*f[f.length-1].x*W)),n.push(new B.ql(0,f[f.length-1].y,0))),Y.push(n)}return J(Z,{pathArray:Y,closeArray:K,sideOrientation:a,updatable:G,invertUV:P,frontUVs:l.frontUVs,backUVs:l.backUVs},C)}x.b.ExtrudeShape=function(Z,l,C,B,b,K){let f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7?arguments[7]:void 0,J=arguments.length>8?arguments[8]:void 0,d=arguments.length>9?arguments[9]:void 0;return v(Z,{shape:l,path:C,scale:B,rotation:b,cap:0===K?0:K||x.b.NO_CAP,sideOrientation:J,instance:d,updatable:W},f)},x.b.ExtrudeShapeCustom=(Z,l,C,B,b,K,f,W,J,d,E,G)=>R(Z,{shape:l,path:C,scaleFunction:B,rotationFunction:b,ribbonCloseArray:K,ribbonClosePath:f,cap:0===W?0:W||x.b.NO_CAP,sideOrientation:E,instance:G,updatable:d},J);x.b.CreateLathe=(Z,l,C,B,x,b,K)=>V(Z,{shape:l,radius:C,tessellation:B,sideOrientation:K,updatable:b},x);var g=C(13413),j=C(13366);function M(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=l.path;let K=l.instance,f=1;void 0!==l.radius?f=l.radius:K&&(f=K._creationDataStorage.radius);const W=l.tessellation||64,d=l.radiusFunction||null;let E=l.cap||x.b.NO_CAP;const G=l.invertUV||!1,a=l.updatable,q=x.b._GetDefaultSideOrientation(l.sideOrientation);l.arc=l.arc&&(l.arc<=0||l.arc>1)?1:l.arc||1;const z=(Z,l,C,b,K,f,W,J)=>{const d=l.getTangents(),E=l.getNormals(),G=l.getDistances(),a=2*Math.PI/K*J,q=f||(()=>b);let z,Y,P,S;const i=B.TmpVectors.Matrix[0];let s=W===x.b.NO_CAP||W===x.b.CAP_END?0:2;for(let x=0;x<Z.length;x++){Y=q(x,G[x]),z=Array(),P=E[x];for(let l=0;l<K;l++)B.Matrix.RotationAxisToRef(d[x],a*l,i),S=z[l]?z[l]:B.ql.Zero(),B.ql.TransformCoordinatesToRef(P,i,S),S.scaleInPlace(Y).addInPlace(Z[x]),z[l]=S;C[s]=z,s++}const F=(l,C)=>{const B=Array();for(let x=0;x<l;x++)B.push(Z[C]);return B};switch(W){case x.b.NO_CAP:break;case x.b.CAP_START:C[0]=F(K,0),C[1]=C[2].slice(0);break;case x.b.CAP_END:C[s]=C[s-1].slice(0),C[s+1]=F(K,Z.length-1);break;case x.b.CAP_ALL:C[0]=F(K,0),C[1]=C[2].slice(0),C[s]=C[s-1].slice(0),C[s+1]=F(K,Z.length-1)}return C};let Y,P;if(K){const Z=K._creationDataStorage,C=l.arc||Z.arc;return Y=Z.path3D.update(b),P=z(b,Y,Z.pathArray,f,Z.tessellation,d,Z.cap,C),K=J("",{pathArray:P,instance:K}),Z.path3D=Y,Z.pathArray=P,Z.arc=C,Z.radius=f,K}Y=new o.l(b);E=E<0||E>3?0:E,P=z(b,Y,new Array,f,W,d,E,l.arc);const S=J(Z,{pathArray:P,closePath:!0,closeArray:!1,updatable:a,sideOrientation:q,invertUV:G,frontUVs:l.frontUVs,backUVs:l.backUVs},C);return S._creationDataStorage.pathArray=P,S._creationDataStorage.path3D=Y,S._creationDataStorage.tessellation=W,S._creationDataStorage.cap=E,S._creationDataStorage.arc=l.arc,S._creationDataStorage.radius=f,S}function I(Z){const l=[];l[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},l[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},l[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},l[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},l[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},l[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},l[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},l[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},l[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},l[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},l[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},l[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},l[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},l[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},l[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const C=Z.type&&(Z.type<0||Z.type>=l.length)?0:Z.type||0,x=Z.size,b=Z.sizeX||x||1,W=Z.sizeY||x||1,J=Z.sizeZ||x||1,d=Z.custom||l[C],E=d.face.length,a=Z.faceUV||new Array(E),q=Z.faceColors,z=void 0===Z.flat||Z.flat,Y=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,P=[],S=[],i=[],s=[],F=[];let n=0,c=0;const U=[];let t,r,e,o,v,R,k=0,V=0;if(z)for(V=0;V<E;V++)q&&void 0===q[V]&&(q[V]=new G.Rb(1,1,1,1)),a&&void 0===a[V]&&(a[V]=new B.Vector4(0,0,1,1));if(z)for(V=0;V<E;V++){const Z=d.face[V].length;for(e=2*Math.PI/Z,o=.5*Math.tan(e/2),v=.5,k=0;k<Z;k++)P.push(d.vertex[d.face[V][k]][0]*b,d.vertex[d.face[V][k]][1]*W,d.vertex[d.face[V][k]][2]*J),U.push(n),n++,t=a[V].x+(a[V].z-a[V].x)*(.5+o),r=a[V].y+(a[V].w-a[V].y)*(v-.5),s.push(t,f.d?1-r:r),R=o*Math.cos(e)-v*Math.sin(e),v=o*Math.sin(e)+v*Math.cos(e),o=R,q&&F.push(q[V].r,q[V].g,q[V].b,q[V].a);for(k=0;k<Z-2;k++)S.push(U[0+c],U[k+2+c],U[k+1+c]);c+=Z}else{for(k=0;k<d.vertex.length;k++)P.push(d.vertex[k][0]*b,d.vertex[k][1]*W,d.vertex[k][2]*J),s.push(0,f.d?1:0);for(V=0;V<E;V++)for(k=0;k<d.face[V].length-2;k++)S.push(d.face[V][0],d.face[V][k+2],d.face[V][k+1])}K.e.ComputeNormals(P,S,i),K.e._ComputeSides(Y,P,S,i,s,Z.frontUVs,Z.backUVs);const g=new K.e;return g.tZ=P,g.indices=S,g.rZ=i,g.oZ=s,q&&z&&(g.eZ=F),g}function w(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new x.b(Z,C);l.sideOrientation=x.b._GetDefaultSideOrientation(l.sideOrientation),B._originalBuilderSideOrientation=l.sideOrientation;return I(l).RZ(B,l.updatable),B}x.b.CreateTube=(Z,l,C,B,x,b,K,f,W,J)=>M(Z,{path:l,radius:C,tessellation:B,radiusFunction:x,arc:1,cap:b,updatable:f,sideOrientation:W,instance:J},K);function O(Z){const l=Z.sideOrientation||K.e.DEFAULTSIDE,C=Z.radius||1,x=void 0===Z.flat||Z.flat,b=0|(Z.subdivisions||4),W=Z.radiusX||C,J=Z.radiusY||C,d=Z.radiusZ||C,E=(1+Math.sqrt(5))/2,G=[-1,E,-0,1,E,0,-1,-E,0,1,-E,0,0,-1,-E,0,1,-E,0,-1,E,0,1,E,E,0,1,E,0,-1,-E,0,1,-E,0,-1],a=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],q=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],z=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],Y=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],P=[],S=[],i=[],s=[];let F=0;const n=new Array(3),c=new Array(3);let U;for(U=0;U<3;U++)n[U]=B.ql.Zero(),c[U]=B.Vector2.Zero();for(let K=0;K<20;K++){for(U=0;U<3;U++){const Z=a[3*K+U];n[U].rb(G[3*q[Z]],G[3*q[Z]+1],G[3*q[Z]+2]),n[U].normalize(),c[U].rb(.134765625*z[2*Z]+.05859375+-.0390625*Y[K],.2333984375*z[2*Z+1]+.025390625+.01953125*Y[K])}const Z=(Z,l,C,K)=>{const E=B.ql.Lerp(n[0],n[2],l/b),G=B.ql.Lerp(n[1],n[2],l/b),a=b===l?n[2]:B.ql.Lerp(E,G,Z/(b-l));let q;if(a.normalize(),x){const Z=B.ql.Lerp(n[0],n[2],K/b),l=B.ql.Lerp(n[1],n[2],K/b);q=B.ql.Lerp(Z,l,C/(b-K))}else q=new B.ql(a.x,a.y,a.z);q.x/=W,q.y/=J,q.z/=d,q.normalize();const z=B.Vector2.Lerp(c[0],c[2],l/b),Y=B.Vector2.Lerp(c[1],c[2],l/b),U=b===l?c[2]:B.Vector2.Lerp(z,Y,Z/(b-l));S.push(a.x*W,a.y*J,a.z*d),i.push(q.x,q.y,q.z),s.push(U.x,f.d?1-U.y:U.y),P.push(F),F++};for(let l=0;l<b;l++)for(let C=0;C+l<b;C++)Z(C,l,C+1/3,l+1/3),Z(C+1,l,C+1/3,l+1/3),Z(C,l+1,C+1/3,l+1/3),C+l+1<b&&(Z(C+1,l,C+2/3,l+2/3),Z(C+1,l+1,C+2/3,l+2/3),Z(C,l+1,C+2/3,l+2/3))}K.e._ComputeSides(l,S,P,i,s,Z.frontUVs,Z.backUVs);const t=new K.e;return t.indices=P,t.tZ=S,t.rZ=i,t.oZ=s,t}function D(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new x.b(Z,C);l.sideOrientation=x.b._GetDefaultSideOrientation(l.sideOrientation),B._originalBuilderSideOrientation=l.sideOrientation;return O(l).RZ(B,l.updatable),B}K.e.CreatePolyhedron=I,x.b.CreatePolyhedron=(Z,l,C)=>w(Z,l,C);K.e.CreateIcoSphere=O,x.b.CreateIcoSphere=(Z,l,C)=>D(Z,l,C);var y=C(12460);const X=new B.ql(1,0,0),T=new B.ql(-1,0,0),u=new B.ql(0,1,0),H=new B.ql(0,-1,0),Q=new B.ql(0,0,1),h=new B.ql(0,0,-1);class A{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.ql.Zero(),l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.ql.Up(),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.Vector2.Zero(),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=Z,this.normal=l,this.uv=C,this.vertexIdx=x,this.vertexIdxForBones=b,this.localPositionOverride=K,this.localNormalOverride=f,this.matrixIndicesOverride=W,this.matrixWeightsOverride=J}clone(){var Z,l,C,B;return new A(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(Z=this.localPositionOverride)||void 0===Z?void 0:Z.slice(),null===(l=this.localNormalOverride)||void 0===l?void 0:l.slice(),null===(C=this.matrixIndicesOverride)||void 0===C?void 0:C.slice(),null===(B=this.matrixWeightsOverride)||void 0===B?void 0:B.slice())}}function L(Z,l,C){var W,J,d,E,G;const a=!!l.skeleton,q=!(null===(W=l.morphTargetManager)||void 0===W||!W.numTargets),z=C.localMode||a,Y=l.cb(),P=a||q?l.UW(!0,!0):l.getVerticesData(b.h.PositionKind),S=a||q?l.getNormalsData(!0,!0):l.getVerticesData(b.h.NormalKind),i=z?a?l.getVerticesData(b.h.PositionKind):P:null,s=z?a?l.getVerticesData(b.h.NormalKind):S:null,F=l.getVerticesData(b.h.UVKind),n=a?l.getVerticesData(b.h.MatricesIndicesKind):null,c=a?l.getVerticesData(b.h.MatricesWeightsKind):null,U=a?l.getVerticesData(b.h.MatricesIndicesExtraKind):null,t=a?l.getVerticesData(b.h.MatricesWeightsExtraKind):null,r=C.position||B.ql.Zero();let e=C.normal||B.ql.Up();const o=C.size||B.ql.One(),v=C.angle||0;if(!e){const Z=new B.ql(0,0,1),C=l.cZ().activeCamera,x=B.ql.TransformCoordinates(Z,C.getWorldMatrix());e=C.globalPosition.zl(x)}const R=-Math.atan2(e.z,e.x)-Math.PI/2,k=Math.sqrt(e.x*e.x+e.z*e.z),V=Math.atan2(e.y,k),g=new K.e;g.indices=[],g.tZ=[],g.rZ=[],g.oZ=[],g.matricesIndices=a?[]:null,g.matricesWeights=a?[]:null,g.matricesIndicesExtra=U?[]:null,g.matricesWeightsExtra=t?[]:null;let j=0;const M=(Z,l)=>{const x=new A;if(!Y||!P||!S)return x;const b=Y[Z];if(x.vertexIdx=3*b,x.vertexIdxForBones=4*b,x.position=new B.ql(P[3*b],P[3*b+1],P[3*b+2]),B.ql.TransformCoordinatesToRef(x.position,l,x.position),x.normal=new B.ql(S[3*b],S[3*b+1],S[3*b+2]),B.ql.TransformNormalToRef(x.normal,l,x.normal),C.captureUVS&&F){const Z=F[2*b+1];x.uv=new B.Vector2(F[2*b],f.d?1-Z:Z)}return x},I=[0,0,0,0],w=(Z,l)=>{if(0===Z.length)return Z;const C=.5*Math.abs(B.ql.Dot(o,l)),x=(Z,l,C,B)=>{for(let x=0;x<B;++x)if(Z[C+x]===l)return C+x;return-1},b=(Z,b)=>{const K=B.ql.GetClipFactor(Z.position,b.position,l,C);let f=I,W=I;if(n&&c){const l=Z.matrixIndicesOverride?0:Z.vertexIdxForBones,C=Z.matrixIndicesOverride??n,B=Z.matrixWeightsOverride??c,J=b.matrixIndicesOverride?0:b.vertexIdxForBones,d=b.matrixIndicesOverride??n,E=b.matrixWeightsOverride??c;f=[0,0,0,0],W=[0,0,0,0];let G=0;for(let Z=0;Z<4;++Z)if(B[l+Z]>0){const b=x(d,C[l+Z],J,4);f[G]=C[l+Z],W[G]=(0,y.Lerp)(B[l+Z],b>=0?E[b]:0,K),G++}for(let Z=0;Z<4&&G<4;++Z){const B=d[J+Z];-1===x(C,B,l,4)&&(f[G]=B,W[G]=(0,y.Lerp)(0,E[J+Z],K),G++)}const a=W[0]+W[1]+W[2]+W[3];W[0]/=a,W[1]/=a,W[2]/=a,W[3]/=a}const J=Z.localPositionOverride?Z.localPositionOverride[0]:(null===i||void 0===i?void 0:i[Z.vertexIdx])??0,d=Z.localPositionOverride?Z.localPositionOverride[1]:(null===i||void 0===i?void 0:i[Z.vertexIdx+1])??0,E=Z.localPositionOverride?Z.localPositionOverride[2]:(null===i||void 0===i?void 0:i[Z.vertexIdx+2])??0,G=b.localPositionOverride?b.localPositionOverride[0]:(null===i||void 0===i?void 0:i[b.vertexIdx])??0,a=b.localPositionOverride?b.localPositionOverride[1]:(null===i||void 0===i?void 0:i[b.vertexIdx+1])??0,q=b.localPositionOverride?b.localPositionOverride[2]:(null===i||void 0===i?void 0:i[b.vertexIdx+2])??0,z=Z.localNormalOverride?Z.localNormalOverride[0]:(null===s||void 0===s?void 0:s[Z.vertexIdx])??0,Y=Z.localNormalOverride?Z.localNormalOverride[1]:(null===s||void 0===s?void 0:s[Z.vertexIdx+1])??0,P=Z.localNormalOverride?Z.localNormalOverride[2]:(null===s||void 0===s?void 0:s[Z.vertexIdx+2])??0,S=z+((b.localNormalOverride?b.localNormalOverride[0]:(null===s||void 0===s?void 0:s[b.vertexIdx])??0)-z)*K,F=Y+((b.localNormalOverride?b.localNormalOverride[1]:(null===s||void 0===s?void 0:s[b.vertexIdx+1])??0)-Y)*K,U=P+((b.localNormalOverride?b.localNormalOverride[2]:(null===s||void 0===s?void 0:s[b.vertexIdx+2])??0)-P)*K,t=Math.sqrt(S*S+F*F+U*U);return new A(B.ql.Lerp(Z.position,b.position,K),B.ql.Lerp(Z.normal,b.normal,K).normalize(),B.Vector2.Lerp(Z.uv,b.uv,K),-1,-1,i?[J+(G-J)*K,d+(a-d)*K,E+(q-E)*K]:null,s?[S/t,F/t,U/t]:null,f,W)};let K=null;Z.length>3&&(K=[]);for(let f=0;f<Z.length;f+=3){let x=0,W=null,J=null,d=null,E=null;const G=B.ql.Dot(Z[f].position,l)-C>0,a=B.ql.Dot(Z[f+1].position,l)-C>0,q=B.ql.Dot(Z[f+2].position,l)-C>0;switch(x=(G?1:0)+(a?1:0)+(q?1:0),x){case 0:Z.length>3?(K.push(Z[f]),K.push(Z[f+1]),K.push(Z[f+2])):K=Z;break;case 1:if(K=K??new Array,G&&(W=Z[f+1],J=Z[f+2],d=b(Z[f],W),E=b(Z[f],J)),a){W=Z[f],J=Z[f+2],d=b(Z[f+1],W),E=b(Z[f+1],J),K.push(d),K.push(J.clone()),K.push(W.clone()),K.push(J.clone()),K.push(d.clone()),K.push(E);break}q&&(W=Z[f],J=Z[f+1],d=b(Z[f+2],W),E=b(Z[f+2],J)),W&&J&&d&&E&&(K.push(W.clone()),K.push(J.clone()),K.push(d),K.push(E),K.push(d.clone()),K.push(J.clone()));break;case 2:K=K??new Array,G||(W=Z[f].clone(),J=b(W,Z[f+1]),d=b(W,Z[f+2]),K.push(W),K.push(J),K.push(d)),a||(W=Z[f+1].clone(),J=b(W,Z[f+2]),d=b(W,Z[f]),K.push(W),K.push(J),K.push(d)),q||(W=Z[f+2].clone(),J=b(W,Z[f]),d=b(W,Z[f+1]),K.push(W),K.push(J),K.push(d))}}return K},O=l instanceof x.b?l:null,D=null===O||void 0===O?void 0:O._thinInstanceDataStorage.matrixData,L=(null===O||void 0===O?void 0:O.Vb)||1,p=B.TmpVectors.Matrix[0];p.B(B.Matrix.IdentityReadOnly);for(let x=0;x<L;++x){if(null!==O&&void 0!==O&&O.hasThinInstances&&D){const Z=16*x;p.setRowFromFloats(0,D[Z+0],D[Z+1],D[Z+2],D[Z+3]),p.setRowFromFloats(1,D[Z+4],D[Z+5],D[Z+6],D[Z+7]),p.setRowFromFloats(2,D[Z+8],D[Z+9],D[Z+10],D[Z+11]),p.setRowFromFloats(3,D[Z+12],D[Z+13],D[Z+14],D[Z+15])}const Z=B.Matrix.RotationYawPitchRoll(R,V,v).multiply(B.Matrix.Translation(r.x,r.y,r.z)),b=B.Matrix.Invert(Z),K=l.getWorldMatrix(),W=p.multiply(K).multiply(b),J=new Array(3);for(let l=0;l<Y.length;l+=3){let Z=J;if(Z[0]=M(l,W),Z[1]=M(l+1,W),Z[2]=M(l+2,W),!(C.cullBackFaces&&-Z[0].normal.z<=0&&-Z[1].normal.z<=0&&-Z[2].normal.z<=0)&&(Z=w(Z,X),Z&&(Z=w(Z,T),Z&&(Z=w(Z,u),Z&&(Z=w(Z,H),Z&&(Z=w(Z,Q),Z&&(Z=w(Z,h),Z)))))))for(let l=0;l<Z.length;l++){const B=Z[l];if(g.indices.push(j),z?(B.localPositionOverride?(g.tZ[3*j]=B.localPositionOverride[0],g.tZ[3*j+1]=B.localPositionOverride[1],g.tZ[3*j+2]=B.localPositionOverride[2]):i&&(g.tZ[3*j]=i[B.vertexIdx],g.tZ[3*j+1]=i[B.vertexIdx+1],g.tZ[3*j+2]=i[B.vertexIdx+2]),B.localNormalOverride?(g.rZ[3*j]=B.localNormalOverride[0],g.rZ[3*j+1]=B.localNormalOverride[1],g.rZ[3*j+2]=B.localNormalOverride[2]):s&&(g.rZ[3*j]=s[B.vertexIdx],g.rZ[3*j+1]=s[B.vertexIdx+1],g.rZ[3*j+2]=s[B.vertexIdx+2])):(B.position.toArray(g.tZ,3*j),B.normal.toArray(g.rZ,3*j)),g.matricesIndices&&g.matricesWeights&&(B.matrixIndicesOverride?(g.matricesIndices[4*j]=B.matrixIndicesOverride[0],g.matricesIndices[4*j+1]=B.matrixIndicesOverride[1],g.matricesIndices[4*j+2]=B.matrixIndicesOverride[2],g.matricesIndices[4*j+3]=B.matrixIndicesOverride[3]):(n&&(g.matricesIndices[4*j]=n[B.vertexIdxForBones],g.matricesIndices[4*j+1]=n[B.vertexIdxForBones+1],g.matricesIndices[4*j+2]=n[B.vertexIdxForBones+2],g.matricesIndices[4*j+3]=n[B.vertexIdxForBones+3]),U&&g.matricesIndicesExtra&&(g.matricesIndicesExtra[4*j]=U[B.vertexIdxForBones],g.matricesIndicesExtra[4*j+1]=U[B.vertexIdxForBones+1],g.matricesIndicesExtra[4*j+2]=U[B.vertexIdxForBones+2],g.matricesIndicesExtra[4*j+3]=U[B.vertexIdxForBones+3])),B.matrixWeightsOverride?(g.matricesWeights[4*j]=B.matrixWeightsOverride[0],g.matricesWeights[4*j+1]=B.matrixWeightsOverride[1],g.matricesWeights[4*j+2]=B.matrixWeightsOverride[2],g.matricesWeights[4*j+3]=B.matrixWeightsOverride[3]):(c&&(g.matricesWeights[4*j]=c[B.vertexIdxForBones],g.matricesWeights[4*j+1]=c[B.vertexIdxForBones+1],g.matricesWeights[4*j+2]=c[B.vertexIdxForBones+2],g.matricesWeights[4*j+3]=c[B.vertexIdxForBones+3]),t&&g.matricesWeightsExtra&&(g.matricesWeightsExtra[4*j]=t[B.vertexIdxForBones],g.matricesWeightsExtra[4*j+1]=t[B.vertexIdxForBones+1],g.matricesWeightsExtra[4*j+2]=t[B.vertexIdxForBones+2],g.matricesWeightsExtra[4*j+3]=t[B.vertexIdxForBones+3]))),C.captureUVS)B.uv.toArray(g.oZ,2*j);else{g.oZ.push(.5+B.position.x/o.x);const Z=.5+B.position.y/o.y;g.oZ.push(f.d?1-Z:Z)}j++}}}0===g.indices.length&&(g.indices=null),0===g.tZ.length&&(g.tZ=null),0===g.rZ.length&&(g.rZ=null),0===g.oZ.length&&(g.oZ=null),0===(null===(J=g.matricesIndices)||void 0===J?void 0:J.length)&&(g.matricesIndices=null),0===(null===(d=g.matricesWeights)||void 0===d?void 0:d.length)&&(g.matricesWeights=null),0===(null===(E=g.matricesIndicesExtra)||void 0===E?void 0:E.length)&&(g.matricesIndicesExtra=null),0===(null===(G=g.matricesWeightsExtra)||void 0===G?void 0:G.length)&&(g.matricesWeightsExtra=null);const N=new x.b(Z,l.cZ());return g.RZ(N),z?(N.skeleton=l.skeleton,N.parent=l):(N.position=r.clone(),N.rotation=new B.ql(V,R,v)),N.Fb(!0),N.refreshBoundingInfo(!0,!0),N}function p(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const l=0|Math.max(Z.subdivisions?Z.subdivisions:2,1),C=0|Math.max(Z.tessellation?Z.tessellation:16,3),x=Math.max(Z.height?Z.height:1,0),b=Math.max(Z.radius?Z.radius:.25,0),W=0|Math.max(Z.capSubdivisions?Z.capSubdivisions:6,1),J=C,d=l,E=Math.max(Z.radiusTop?Z.radiusTop:b,0),G=Math.max(Z.radiusBottom?Z.radiusBottom:b,0),a=x-(E+G),q=2*Math.PI,z=Math.max(Z.topCapSubdivisions?Z.topCapSubdivisions:W,1),Y=Math.max(Z.bottomCapSubdivisions?Z.bottomCapSubdivisions:W,1),P=Math.acos((G-E)/x);let S=[];const i=[],s=[],F=[];let n=0;const c=[],U=.5*a,t=.5*Math.PI;let r,e;const o=B.ql.Zero(),v=B.ql.Zero(),R=Math.cos(P),k=Math.sin(P),V=new B.Vector2(E*k,U+E*R).zl(new B.Vector2(G*k,G*R-U)).length(),g=E*P+V+G*(t-P);let j=0;for(e=0;e<=z;e++){const Z=[],l=t-P*(e/z);j+=E*P/z;const C=Math.cos(l),B=Math.sin(l),x=C*E;for(r=0;r<=J;r++){const l=r/J,b=l*q+0,K=Math.sin(b),W=Math.cos(b);v.x=x*K,v.y=U+B*E,v.z=x*W,i.push(v.x,v.y,v.z),o.set(C*K,B,C*W),s.push(o.x,o.y,o.z),F.push(l,f.d?j/g:1-j/g),Z.push(n),n++}c.push(Z)}const M=x-E-G+R*E-R*G,I=k*(G-E)/M;for(e=1;e<=d;e++){const Z=[];j+=V/d;const l=k*(e*(G-E)/d+E);for(r=0;r<=J;r++){const C=r/J,B=C*q+0,x=Math.sin(B),b=Math.cos(B);v.x=l*x,v.y=U+R*E-e*M/d,v.z=l*b,i.push(v.x,v.y,v.z),o.set(x,I,b).normalize(),s.push(o.x,o.y,o.z),F.push(C,f.d?j/g:1-j/g),Z.push(n),n++}c.push(Z)}for(e=1;e<=Y;e++){const Z=[],l=t-P-(Math.PI-P)*(e/Y);j+=G*P/Y;const C=Math.cos(l),B=Math.sin(l),x=C*G;for(r=0;r<=J;r++){const l=r/J,b=l*q+0,K=Math.sin(b),W=Math.cos(b);v.x=x*K,v.y=B*G-U,v.z=x*W,i.push(v.x,v.y,v.z),o.set(C*K,B,C*W),s.push(o.x,o.y,o.z),F.push(l,f.d?j/g:1-j/g),Z.push(n),n++}c.push(Z)}for(r=0;r<J;r++)for(e=0;e<z+d+Y;e++){const Z=c[e][r],l=c[e+1][r],C=c[e+1][r+1],B=c[e][r+1];S.push(Z),S.push(l),S.push(B),S.push(l),S.push(C),S.push(B)}if(S=S.reverse(),Z.orientation&&!Z.orientation.equals(B.ql.Up())){const l=new B.Matrix;Z.orientation.clone().scale(.5*Math.PI).cross(B.ql.Up()).toQuaternion().toRotationMatrix(l);const C=B.ql.Zero();for(let Z=0;Z<i.length;Z+=3)C.set(i[Z],i[Z+1],i[Z+2]),B.ql.TransformCoordinatesToRef(C.clone(),l,C),i[Z]=C.x,i[Z+1]=C.y,i[Z+2]=C.z}const w=new K.e;return w.tZ=i,w.rZ=s,w.oZ=F,w.indices=S,w}function N(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:B.ql.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new x.b(Z,C);return p(l).RZ(b,l.updatable),b}x.b.CreateDecal=(Z,l,C,B,x,b)=>L(Z,l,{position:C,normal:B,size:x,angle:b});x.b.CreateCapsule=(Z,l,C)=>N(Z,l,C),K.e.CreateCapsule=p;var mZ=C(12263),ZZ=C(12451);class lZ{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=Z,this.y=l,Z!==Math.floor(Z)&&(Z=Math.floor(Z),mZ.e.Warn("x is not an integer, floor(x) used")),l!==Math.floor(l)&&(l=Math.floor(l),mZ.e.Warn("y is not an integer, floor(y) used"))}clone(){return new lZ(this.x,this.y)}rotate60About(Z){const l=this.x;return this.x=Z.x+Z.y-this.y,this.y=l+this.y-Z.x,this}rotateNeg60About(Z){const l=this.x;return this.x=l+this.y-Z.y,this.y=Z.x+Z.y-l,this}rotate120(Z,l){Z!==Math.floor(Z)&&(Z=Math.floor(Z),mZ.e.Warn("m not an integer only floor(m) used")),l!==Math.floor(l)&&(l=Math.floor(l),mZ.e.Warn("n not an integer only floor(n) used"));const C=this.x;return this.x=Z-C-this.y,this.y=l+C,this}rotateNeg120(Z,l){Z!==Math.floor(Z)&&(Z=Math.floor(Z),mZ.e.Warn("m is not an integer, floor(m) used")),l!==Math.floor(l)&&(l=Math.floor(l),mZ.e.Warn("n is not an integer,   floor(n) used"));const C=this.x;return this.x=this.y-l,this.y=Z+l-C-this.y,this}toCartesianOrigin(Z,l){const C=B.ql.Zero();return C.x=Z.x+2*this.x*l+this.y*l,C.y=Z.y+Math.sqrt(3)*this.y*l,C}static Zero(){return new lZ(0,0)}}class CZ{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new BZ("icosahedron","Regular",[[0,ZZ.g,-1],[-ZZ.g,1,0],[-1,0,-ZZ.g],[1,0,-ZZ.g],[ZZ.g,1,0],[0,ZZ.g,1],[-1,0,ZZ.g],[-ZZ.g,-1,0],[0,-ZZ.g,-1],[ZZ.g,-1,0],[1,0,ZZ.g],[0,-ZZ.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let Z=12;const l={},C=this.m,B=this.n;let x,b,K,f,W,J=C,d=1,E=0;0!==B&&(J=(0,y.HighestCommonFactor)(C,B)),d=C/J,E=B/J;const G=lZ.Zero(),a=new lZ(C,B),q=new lZ(-B,C+B),z=lZ.Zero(),Y=lZ.Zero(),P=lZ.Zero();let S,i,s,F,n=[];const c=[],U=this.vertByDist,t=(C,B,x,b)=>{S=C+"|"+x,i=B+"|"+b,S in l||i in l?S in l&&!(i in l)?l[i]=l[S]:i in l&&!(S in l)&&(l[S]=l[i]):(l[S]=Z,l[i]=Z,Z++),U[x][0]>2?c[l[S]]=[-U[x][0],U[x][1],l[S]]:c[l[S]]=[n[U[x][0]],U[x][1],l[S]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let r=0;r<20;r++){if(n=this.IDATA.face[r],K=n[2],f=n[1],W=n[0],s=G.x+"|"+G.y,S=r+"|"+s,S in l||(l[S]=K,c[K]=[n[U[s][0]],U[s][1]]),s=a.x+"|"+a.y,S=r+"|"+s,S in l||(l[S]=f,c[f]=[n[U[s][0]],U[s][1]]),s=q.x+"|"+q.y,S=r+"|"+s,S in l||(l[S]=W,c[W]=[n[U[s][0]],U[s][1]]),x=this.IDATA.edgematch[r][0],b=this.IDATA.edgematch[r][1],"B"===b)for(let Z=1;Z<J;Z++)Y.x=C-Z*(d+E),Y.y=B+Z*d,P.x=-Z*E,P.y=Z*(d+E),s=Y.x+"|"+Y.y,F=P.x+"|"+P.y,t(r,x,s,F);if("O"===b)for(let Z=1;Z<J;Z++)P.x=-Z*E,P.y=Z*(d+E),z.x=Z*d,z.y=Z*E,s=P.x+"|"+P.y,F=z.x+"|"+z.y,t(r,x,s,F);if(x=this.IDATA.edgematch[r][2],b=this.IDATA.edgematch[r][3],b&&"A"===b)for(let Z=1;Z<J;Z++)z.x=Z*d,z.y=Z*E,Y.x=C-(J-Z)*(d+E),Y.y=B+(J-Z)*d,s=z.x+"|"+z.y,F=Y.x+"|"+Y.y,t(r,x,s,F);for(let C=0;C<this.vertices.length;C++)s=this.vertices[C].x+"|"+this.vertices[C].y,S=r+"|"+s,S in l||(l[S]=Z++,U[s][0]>2?c[l[S]]=[-U[s][0],U[s][1],l[S]]:c[l[S]]=[n[U[s][0]],U[s][1],l[S]])}this.closestTo=c,this.vecToidx=l}calcCoeffs(){const Z=this.m,l=this.n,C=Math.sqrt(3)/3,B=Z*Z+l*l+Z*l;this.coau=(Z+l)/B,this.cobu=-l/B,this.coav=-C*(Z-l)/B,this.cobv=C*(2*Z+l)/B}createInnerFacets(){const Z=this.m,l=this.n;for(let C=0;C<l+Z+1;C++)for(let Z=this.min[C];Z<this.max[C]+1;Z++)Z<this.max[C]&&Z<this.max[C+1]+1&&this.innerFacets.push(["|"+Z+"|"+C,"|"+Z+"|"+(C+1),"|"+(Z+1)+"|"+C]),C>0&&Z<this.max[C-1]&&Z+1<this.max[C]+1&&this.innerFacets.push(["|"+Z+"|"+C,"|"+(Z+1)+"|"+C,"|"+(Z+1)+"|"+(C-1)])}edgeVecsABOB(){const Z=this.m,l=this.n,C=new lZ(-l,Z+l);for(let B=1;B<Z+l;B++){const Z=new lZ(this.min[B],B),l=new lZ(this.min[B-1],B-1),x=new lZ(this.min[B+1],B+1),b=Z.clone(),K=l.clone(),f=x.clone();b.rotate60About(C),K.rotate60About(C),f.rotate60About(C);const W=new lZ(this.max[b.y],b.y),J=new lZ(this.max[b.y-1],b.y-1),d=new lZ(this.max[b.y-1]-1,b.y-1);b.x===W.x&&b.y===W.y||(b.x!==J.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,J,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,d,W])):b.y===f.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Z,l,J]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([Z,J,x])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Z,l,J]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,J,W])))}}mapABOBtoOBOA(){const Z=new lZ(0,0);for(let l=0;l<this.isoVecsABOB.length;l++){const C=[];for(let B=0;B<3;B++)Z.x=this.isoVecsABOB[l][B].x,Z.y=this.isoVecsABOB[l][B].y,0===this.vertexTypes[l][B]&&Z.rotateNeg120(this.m,this.n),C.push(Z.clone());this.isoVecsOBOA.push(C)}}mapABOBtoBAOA(){const Z=new lZ(0,0);for(let l=0;l<this.isoVecsABOB.length;l++){const C=[];for(let B=0;B<3;B++)Z.x=this.isoVecsABOB[l][B].x,Z.y=this.isoVecsABOB[l][B].y,1===this.vertexTypes[l][B]&&Z.rotate120(this.m,this.n),C.push(Z.clone());this.isoVecsBAOA.push(C)}}MapToFace(Z,l){const C=this.IDATA.face[Z],x=C[2],b=C[1],K=C[0],f=B.ql.il(this.IDATA.vertex[x]),W=B.ql.il(this.IDATA.vertex[b]),J=B.ql.il(this.IDATA.vertex[K]),d=W.zl(f),E=J.zl(f),G=d.scale(this.coau).add(E.scale(this.cobu)),a=d.scale(this.coav).add(E.scale(this.cobv)),q=[];let z,Y=B.TmpVectors.ql[0];for(let B=0;B<this.cartesian.length;B++)Y=G.scale(this.cartesian[B].x).add(a.scale(this.cartesian[B].y)).add(f),q[B]=[Y.x,Y.y,Y.z],z=Z+"|"+this.vertices[B].x+"|"+this.vertices[B].y,l.vertex[this.vecToidx[z]]=[Y.x,Y.y,Y.z]}build(Z,l){const C=[],B=lZ.Zero(),x=new lZ(Z,l),b=new lZ(-l,Z+l);C.push(B,x,b);for(let s=l;s<Z+1;s++)for(let l=0;l<Z+1-s;l++)C.push(new lZ(l,s));if(l>0){const B=(0,y.HighestCommonFactor)(Z,l),x=Z/B,b=l/B;for(let f=1;f<B;f++)C.push(new lZ(f*x,f*b)),C.push(new lZ(-f*b,f*(x+b))),C.push(new lZ(Z-f*(x+b),l+f*x));const K=Z/l;for(let f=1;f<l;f++)for(let B=0;B<f*K;B++)C.push(new lZ(B,f)),C.push(new lZ(B,f).rotate120(Z,l)),C.push(new lZ(B,f).rotateNeg120(Z,l))}C.sort(((Z,l)=>Z.x-l.x)),C.sort(((Z,l)=>Z.y-l.y));const K=new Array(Z+l+1),f=new Array(Z+l+1);for(let s=0;s<K.length;s++)K[s]=1/0,f[s]=-1/0;let W=0,J=0;const d=C.length;for(let s=0;s<d;s++)J=C[s].x,W=C[s].y,K[W]=Math.min(J,K[W]),f[W]=Math.max(J,f[W]);const E=(C,B)=>{const x=C.clone();return"A"===B&&x.rotateNeg120(Z,l),"B"===B&&x.rotate120(Z,l),x.x<0?x.y:x.x+x.y},G=[],a=[],q=[],z=[],Y={},P=[];let S=-1,i=-1;for(let s=0;s<d;s++)G[s]=C[s].toCartesianOrigin(new lZ(0,0),.5),a[s]=E(C[s],"O"),q[s]=E(C[s],"A"),z[s]=E(C[s],"B"),a[s]===q[s]&&q[s]===z[s]?(S=3,i=a[s]):a[s]===q[s]?(S=4,i=a[s]):q[s]===z[s]?(S=5,i=q[s]):z[s]===a[s]&&(S=6,i=a[s]),a[s]<q[s]&&a[s]<z[s]&&(S=2,i=a[s]),q[s]<a[s]&&q[s]<z[s]&&(S=1,i=q[s]),z[s]<q[s]&&z[s]<a[s]&&(S=0,i=z[s]),P.push([S,i,C[s].x,C[s].y]);P.sort(((Z,l)=>Z[2]-l[2])),P.sort(((Z,l)=>Z[3]-l[3])),P.sort(((Z,l)=>Z[1]-l[1])),P.sort(((Z,l)=>Z[0]-l[0]));for(let s=0;s<P.length;s++)Y[P[s][2]+"|"+P[s][3]]=[P[s][0],P[s][1],s];return this.m=Z,this.n=l,this.vertices=C,this.vertByDist=Y,this.cartesian=G,this.min=K,this.max=f,this}}class BZ{constructor(Z,l,C,B){this.name=Z,this.category=l,this.vertex=C,this.face=B}}class xZ extends BZ{innerToData(Z,l){for(let C=0;C<l.innerFacets.length;C++)this.face.push(l.innerFacets[C].map((C=>l.vecToidx[Z+C])))}mapABOBtoDATA(Z,l){const C=l.IDATA.edgematch[Z][0];for(let B=0;B<l.isoVecsABOB.length;B++){const x=[];for(let b=0;b<3;b++)0===l.vertexTypes[B][b]?x.push(Z+"|"+l.isoVecsABOB[B][b].x+"|"+l.isoVecsABOB[B][b].y):x.push(C+"|"+l.isoVecsABOB[B][b].x+"|"+l.isoVecsABOB[B][b].y);this.face.push([l.vecToidx[x[0]],l.vecToidx[x[1]],l.vecToidx[x[2]]])}}mapOBOAtoDATA(Z,l){const C=l.IDATA.edgematch[Z][0];for(let B=0;B<l.isoVecsOBOA.length;B++){const x=[];for(let b=0;b<3;b++)1===l.vertexTypes[B][b]?x.push(Z+"|"+l.isoVecsOBOA[B][b].x+"|"+l.isoVecsOBOA[B][b].y):x.push(C+"|"+l.isoVecsOBOA[B][b].x+"|"+l.isoVecsOBOA[B][b].y);this.face.push([l.vecToidx[x[0]],l.vecToidx[x[1]],l.vecToidx[x[2]]])}}mapBAOAtoDATA(Z,l){const C=l.IDATA.edgematch[Z][2];for(let B=0;B<l.isoVecsBAOA.length;B++){const x=[];for(let b=0;b<3;b++)1===l.vertexTypes[B][b]?x.push(Z+"|"+l.isoVecsBAOA[B][b].x+"|"+l.isoVecsBAOA[B][b].y):x.push(C+"|"+l.isoVecsBAOA[B][b].x+"|"+l.isoVecsBAOA[B][b].y);this.face.push([l.vecToidx[x[0]],l.vecToidx[x[1]],l.vecToidx[x[2]]])}}orderData(Z){const l=[];for(let b=0;b<13;b++)l[b]=[];const C=Z.closestTo;for(let b=0;b<C.length;b++)C[b][0]>-1?C[b][1]>0&&l[C[b][0]].push([b,C[b][1]]):l[12].push([b,C[b][0]]);const B=[];for(let b=0;b<12;b++)B[b]=b;let x=12;for(let b=0;b<12;b++){l[b].sort(((Z,l)=>Z[1]-l[1]));for(let Z=0;Z<l[b].length;Z++)B[l[b][Z][0]]=x++}for(let b=0;b<l[12].length;b++)B[l[12][b][0]]=x++;for(let b=0;b<this.vertex.length;b++)this.vertex[b].push(B[b]);this.vertex.sort(((Z,l)=>Z[3]-l[3]));for(let b=0;b<this.vertex.length;b++)this.vertex[b].pop();for(let b=0;b<this.face.length;b++)for(let Z=0;Z<this.face[b].length;Z++)this.face[b][Z]=B[this.face[b][Z]];this.sharedNodes=l[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(Z,l){const C=[],B=[];let x=l.pop();B.push(x);let b=this.face[x].indexOf(Z);b=(b+2)%3;let K=this.face[x][b];C.push(K);let f=0;for(;l.length>0;)x=l[f],this.face[x].indexOf(K)>-1?(b=(this.face[x].indexOf(K)+1)%3,K=this.face[x][b],C.push(K),B.push(x),l.splice(f,1),f=0):f++;return this.adjacentFaces.push(C),B}toGoldbergPolyhedronData(){const Z=new BZ("GeoDual","Goldberg",[],[]);Z.name="GD dual";const l=this.vertex.length,C=new Array(l);for(let W=0;W<l;W++)C[W]=[];for(let W=0;W<this.face.length;W++)for(let Z=0;Z<3;Z++)C[this.face[W][Z]].push(W);let B=0,x=0,b=0,K=[],f=[];this.adjacentFaces=[];for(let W=0;W<C.length;W++){Z.face[W]=this.setOrder(W,C[W].concat([]));for(const l of C[W]){B=0,x=0,b=0,K=this.face[l];for(let Z=0;Z<3;Z++)f=this.vertex[K[Z]],B+=f[0],x+=f[1],b+=f[2];Z.vertex[l]=[B/3,x/3,b/3]}}return Z}static BuildGeodesicData(Z){const l=new xZ("Geodesic-m-n","Geodesic",[[0,ZZ.g,-1],[-ZZ.g,1,0],[-1,0,-ZZ.g],[1,0,-ZZ.g],[ZZ.g,1,0],[0,ZZ.g,1],[-1,0,ZZ.g],[-ZZ.g,-1,0],[0,-ZZ.g,-1],[ZZ.g,-1,0],[1,0,ZZ.g],[0,-ZZ.g,1]],[]);Z.setIndices(),Z.calcCoeffs(),Z.createInnerFacets(),Z.edgeVecsABOB(),Z.mapABOBtoOBOA(),Z.mapABOBtoBAOA();for(let C=0;C<Z.IDATA.face.length;C++)Z.MapToFace(C,l),l.innerToData(C,Z),"B"===Z.IDATA.edgematch[C][1]&&l.mapABOBtoDATA(C,Z),"O"===Z.IDATA.edgematch[C][1]&&l.mapOBOAtoDATA(C,Z),"A"===Z.IDATA.edgematch[C][3]&&l.mapBAOAtoDATA(C,Z);l.orderData(Z);return l.vertex=l.vertex.map((function(Z){const l=Z[0],C=Z[1],B=Z[2],x=Math.sqrt(l*l+C*C+B*B);return Z[0]*=1/x,Z[1]*=1/x,Z[2]*=1/x,Z})),l}}x.b._GoldbergMeshParser=(Z,l)=>bZ.Parse(Z,l);class bZ extends x.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(Z,l){return void 0===l?(Z>this.goldbergData.nbUnsharedFaces-1&&(mZ.e.Warn("Maximum number of unshared faces used"),Z=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+Z):(Z>11&&(mZ.e.Warn("Last pole used"),Z=11),l>this.goldbergData.nbFacesAtPole-1&&(mZ.e.Warn("Maximum number of faces at a pole used"),l=this.goldbergData.nbFacesAtPole-1),12+Z*this.goldbergData.nbFacesAtPole+l)}_changeGoldbergFaceColors(Z){for(let C=0;C<Z.length;C++){const l=Z[C][0],B=Z[C][1],x=Z[C][2];for(let Z=l;Z<B+1;Z++)this.goldbergData.faceColors[Z]=x}const l=[];for(let C=0;C<12;C++)for(let Z=0;Z<5;Z++)l.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);for(let C=12;C<this.goldbergData.faceColors.length;C++)for(let Z=0;Z<6;Z++)l.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);return l}setGoldbergFaceColors(Z){const l=this._changeGoldbergFaceColors(Z);this.jZ(b.h.ColorKind,l)}updateGoldbergFaceColors(Z){const l=this._changeGoldbergFaceColors(Z);this.updateVerticesData(b.h.ColorKind,l)}_changeGoldbergFaceUVs(Z){const l=this.getVerticesData(b.h.UVKind);for(let C=0;C<Z.length;C++){const B=Z[C][0],x=Z[C][1],b=Z[C][2],K=Z[C][3],f=Z[C][4],W=[],J=[];let d,E;for(let Z=0;Z<5;Z++)d=b.x+K*Math.cos(f+Z*Math.PI/2.5),E=b.y+K*Math.sin(f+Z*Math.PI/2.5),d<0&&(d=0),d>1&&(d=1),W.push(d,E);for(let Z=0;Z<6;Z++)d=b.x+K*Math.cos(f+Z*Math.PI/3),E=b.y+K*Math.sin(f+Z*Math.PI/3),d<0&&(d=0),d>1&&(d=1),J.push(d,E);for(let Z=B;Z<Math.min(12,x+1);Z++)for(let C=0;C<5;C++)l[10*Z+2*C]=W[2*C],l[10*Z+2*C+1]=W[2*C+1];for(let Z=Math.max(12,B);Z<x+1;Z++)for(let C=0;C<6;C++)l[12*Z-24+2*C]=J[2*C],l[12*Z-23+2*C]=J[2*C+1]}return l}setGoldbergFaceUVs(Z){const l=this._changeGoldbergFaceUVs(Z);this.jZ(b.h.UVKind,l)}updateGoldbergFaceUVs(Z){const l=this._changeGoldbergFaceUVs(Z);this.updateVerticesData(b.h.UVKind,l)}placeOnGoldbergFaceAt(Z,l,C){const x=B.ql.RotationFromAxis(this.goldbergData.faceXaxis[l],this.goldbergData.faceYaxis[l],this.goldbergData.faceZaxis[l]);Z.rotation=x,Z.position=this.goldbergData.faceCenters[l].add(this.goldbergData.faceXaxis[l].scale(C.x)).add(this.goldbergData.faceYaxis[l].scale(C.y)).add(this.goldbergData.faceZaxis[l].scale(C.z))}serialize(Z){super.serialize(Z),Z.type="GoldbergMesh";const l={};if(l.adjacentFaces=this.goldbergData.adjacentFaces,l.nbSharedFaces=this.goldbergData.nbSharedFaces,l.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,l.nbFaces=this.goldbergData.nbFaces,l.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){l.faceColors=[];for(const Z of this.goldbergData.faceColors)l.faceColors.push(Z.Yb())}if(this.goldbergData.faceCenters){l.faceCenters=[];for(const Z of this.goldbergData.faceCenters)l.faceCenters.push(Z.Yb())}if(this.goldbergData.faceZaxis){l.faceZaxis=[];for(const Z of this.goldbergData.faceZaxis)l.faceZaxis.push(Z.Yb())}if(this.goldbergData.faceYaxis){l.faceYaxis=[];for(const Z of this.goldbergData.faceYaxis)l.faceYaxis.push(Z.Yb())}if(this.goldbergData.faceXaxis){l.faceXaxis=[];for(const Z of this.goldbergData.faceXaxis)l.faceXaxis.push(Z.Yb())}Z.goldbergData=l}static Parse(Z,l){const C=Z.goldbergData;C.faceColors=C.faceColors.map((Z=>G.Rb.il(Z))),C.faceCenters=C.faceCenters.map((Z=>B.ql.il(Z))),C.faceZaxis=C.faceZaxis.map((Z=>B.ql.il(Z))),C.faceXaxis=C.faceXaxis.map((Z=>B.ql.il(Z))),C.faceYaxis=C.faceYaxis.map((Z=>B.ql.il(Z)));const x=new bZ(Z.name,l);return x.goldbergData=C,x}}var KZ=C(12974);const fZ={CreateBox:E.c,CreateTiledBox:Y,CreateSphere:P.c,CreateDisc:d.d,CreateIcoSphere:D,CreateRibbon:J,CreateCylinder:F,CreateTorus:c,CreateTorusKnot:t,CreateLineSystem:r.d,Gd:r.g,CreateDashedLines:r.b,ExtrudeShape:v,ExtrudeShapeCustom:R,CreateLathe:V,CreateTiledPlane:q,Yd:g.b,CreateGround:j.e,CreateTiledGround:j.f,CreateGroundFromHeightMap:j.c,CreatePolygon:e.c,ExtrudePolygon:e.g,CreateTube:M,CreatePolyhedron:w,CreateGeodesic:function(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=l.m||1;B!==Math.floor(B)&&(B=Math.floor(B),mZ.e.Warn("m not an integer only floor(m) used"));let x=l.n||0;if(x!==Math.floor(x)&&(x=Math.floor(x),mZ.e.Warn("n not an integer only floor(n) used")),x>B){const Z=x;x=B,B=Z,mZ.e.Warn("n > m therefore m and n swapped")}const b=new CZ;return b.build(B,x),w(Z,{custom:xZ.BuildGeodesicData(b),size:l.size,sizeX:l.sizeX,sizeY:l.sizeY,sizeZ:l.sizeZ,faceUV:l.faceUV,faceColors:l.faceColors,flat:l.flat,updatable:l.updatable,sideOrientation:l.sideOrientation,frontUVs:l.frontUVs,backUVs:l.backUVs},C)},CreateGoldberg:function(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=l.size,W=l.sizeX||b||1,J=l.sizeY||b||1,d=l.sizeZ||b||1;let E=l.m||1;E!==Math.floor(E)&&(E=Math.floor(E),mZ.e.Warn("m not an integer only floor(m) used"));let a=l.n||0;if(a!==Math.floor(a)&&(a=Math.floor(a),mZ.e.Warn("n not an integer only floor(n) used")),a>E){const Z=a;a=E,E=Z,mZ.e.Warn("n > m therefore m and n swapped")}const q=new CZ;q.build(E,a);const z=xZ.BuildGeodesicData(q),Y=z.toGoldbergPolyhedronData(),P=new bZ(Z,C);l.sideOrientation=x.b._GetDefaultSideOrientation(l.sideOrientation),P._originalBuilderSideOrientation=l.sideOrientation;(function(Z,l){const C=Z.size,x=Z.sizeX||C||1,b=Z.sizeY||C||1,W=Z.sizeZ||C||1,J=0===Z.sideOrientation?0:Z.sideOrientation||K.e.DEFAULTSIDE,d=[],E=[],G=[],a=[];let q=1/0,z=-1/0,Y=1/0,P=-1/0;for(let B=0;B<l.vertex.length;B++)q=Math.min(q,l.vertex[B][0]*x),z=Math.max(z,l.vertex[B][0]*x),Y=Math.min(Y,l.vertex[B][1]*b),P=Math.max(P,l.vertex[B][1]*b);let S=0;for(let K=0;K<l.face.length;K++){const Z=l.face[K],C=B.ql.il(l.vertex[Z[0]]),J=B.ql.il(l.vertex[Z[2]]),i=B.ql.il(l.vertex[Z[1]]),s=J.zl(C),F=i.zl(C),n=B.ql.Cross(F,s).normalize();for(let B=0;B<Z.length;B++){G.push(n.x,n.y,n.z);const C=l.vertex[Z[B]];d.push(C[0]*x,C[1]*b,C[2]*W);const K=(C[1]*b-Y)/(P-Y);a.push((C[0]*x-q)/(z-q),f.d?1-K:K)}for(let l=0;l<Z.length-2;l++)E.push(S,S+l+2,S+l+1);S+=Z.length}K.e._ComputeSides(J,d,E,G,a);const i=new K.e;return i.tZ=d,i.indices=E,i.rZ=G,i.oZ=a,i})(l,Y).RZ(P,l.updatable),P.goldbergData.nbSharedFaces=z.sharedNodes,P.goldbergData.nbUnsharedFaces=z.poleNodes,P.goldbergData.adjacentFaces=z.adjacentFaces,P.goldbergData.nbFaces=P.goldbergData.nbSharedFaces+P.goldbergData.nbUnsharedFaces,P.goldbergData.nbFacesAtPole=(P.goldbergData.nbUnsharedFaces-12)/12;for(let x=0;x<z.vertex.length;x++)P.goldbergData.faceCenters.push(B.ql.il(z.vertex[x])),P.goldbergData.faceCenters[x].x*=W,P.goldbergData.faceCenters[x].y*=J,P.goldbergData.faceCenters[x].z*=d,P.goldbergData.faceColors.push(new G.Rb(1,1,1,1));for(let x=0;x<Y.face.length;x++){const Z=Y.face[x],l=B.ql.il(Y.vertex[Z[0]]),C=B.ql.il(Y.vertex[Z[2]]),b=B.ql.il(Y.vertex[Z[1]]),K=C.zl(l),f=b.zl(l),W=B.ql.Cross(f,K).normalize(),J=B.ql.Cross(f,W).normalize();P.goldbergData.faceXaxis.push(f.normalize()),P.goldbergData.faceYaxis.push(W),P.goldbergData.faceZaxis.push(J)}return P},CreateDecal:L,CreateCapsule:N,CreateText:KZ.f}},13428:(Z,l,C)=>{"use strict";C.d(l,{e:()=>fl});var B=C(12442),x=C(12820);class b extends x.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var K=C(12494),f=(C(12627),C(12400));class W{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Z){this._targetStopDuration!==Z&&(this._targetStopDuration=Z)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(Z){this._noiseTexture!==Z&&(this._noiseTexture=Z,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Z){this._animationSheetEnabled!==Z&&(this._animationSheetEnabled=Z)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(Z){this._isAnimationSheetEnabled!=Z&&(this._isAnimationSheetEnabled=Z,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(Z){this._useLogarithmicDepth=Z&&this.cZ().getEngine().getCaps().fragmentDepthSupported}cZ(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(Z){switch(Z){case W.BLENDMODE_MULTIPLYADD:return;case W.BLENDMODE_ADD:Z=1;break;case W.BLENDMODE_ONEONE:Z=6;break;case W.BLENDMODE_STANDARD:Z=2;break;case W.BLENDMODE_MULTIPLY:Z=4;break;case W.BLENDMODE_SUBTRACT:Z=3}this._engine.setAlphaMode(Z)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:B.ql.Zero()}set direction1(Z){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=Z)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:B.ql.Zero()}set direction2(Z){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=Z)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:B.ql.Zero()}set minEmitBox(Z){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=Z)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:B.ql.Zero()}set maxEmitBox(Z){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=Z)}get billboardMode(){return this._billboardMode}set billboardMode(Z){this._billboardMode!==Z&&(this._billboardMode=Z,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(Z){this._isBillboardBased!==Z&&(this._isBillboardBased=Z,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(Z){this._attachImageProcessingConfiguration(Z)}_attachImageProcessingConfiguration(Z){Z!==this._imageProcessingConfiguration&&(!Z&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=Z)}_reset(){}_removeGradientAndTexture(Z,l,C){if(!l)return this;let B=0;for(const x of l){if(x.gradient===Z){l.splice(B,1);break}B++}return C&&C.dispose(),this}constructor(Z){this.animations=[],this.renderingGroupId=0,this.Bl=B.ql.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new B.ql(10,10,10),this.onAnimationEnd=null,this.blendMode=W.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new B.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.xd=new B.ql(0,0,0),this._useLogarithmicDepth=!1,this.gravity=B.ql.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new K.Rb(1,1,1,1),this.color2=new K.Rb(1,1,1,1),this.colorDead=new K.Rb(0,0,0,1),this.textureMask=new K.Rb(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new b,this.id=Z,this.name=Z}createPointEmitter(Z,l){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new B.ql(0,1,0),arguments.length>2&&void 0!==arguments[2]||new B.ql(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new B.ql(0,1,0),arguments.length>4&&void 0!==arguments[4]||new B.ql(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new B.ql(0,1,0),arguments.length>3&&void 0!==arguments[3]||new B.ql(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(Z,l,C,B){throw new Error("Method not implemented.")}}W.BLENDMODE_ONEONE=0,W.BLENDMODE_STANDARD=1,W.BLENDMODE_ADD=2,W.BLENDMODE_MULTIPLY=3,W.BLENDMODE_MULTIPLYADD=4,W.BLENDMODE_SUBTRACT=-1,(0,f.c)("BABYLON.BaseParticleSystem",W);var J=C(12460),d=C(12266);class E{constructor(){this.direction1=new B.ql(0,1,0),this.direction2=new B.ql(0,1,0),this.minEmitBox=new B.ql(-.5,-.5,-.5),this.maxEmitBox=new B.ql(.5,.5,.5)}startDirectionFunction(Z,l,C,x){const b=(0,J.RandomRange)(this.direction1.x,this.direction2.x),K=(0,J.RandomRange)(this.direction1.y,this.direction2.y),f=(0,J.RandomRange)(this.direction1.z,this.direction2.z);if(x)return l.x=b,l.y=K,void(l.z=f);B.ql.TransformNormalFromFloatsToRef(b,K,f,Z,l)}startPositionFunction(Z,l,C,x){const b=(0,J.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),K=(0,J.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),f=(0,J.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(x)return l.x=b,l.y=K,void(l.z=f);B.ql.TransformCoordinatesFromFloatsToRef(b,K,f,Z,l)}clone(){const Z=new E;return d.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2),Z.setVector3("minEmitBox",this.minEmitBox),Z.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3),Z.addUniform("minEmitBox",3),Z.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.Yb(),Z.direction2=this.direction2.Yb(),Z.minEmitBox=this.minEmitBox.Yb(),Z.maxEmitBox=this.maxEmitBox.Yb(),Z}parse(Z){B.ql.FromArrayToRef(Z.direction1,0,this.direction1),B.ql.FromArrayToRef(Z.direction2,0,this.direction2),B.ql.FromArrayToRef(Z.minEmitBox,0,this.minEmitBox),B.ql.FromArrayToRef(Z.maxEmitBox,0,this.maxEmitBox)}}class G{get radius(){return this._radius}set radius(Z){this._radius=Z,this._buildHeight()}get angle(){return this._angle}set angle(Z){this._angle=Z,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=C,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=l,this.radius=Z}startDirectionFunction(Z,l,C,x){x?B.TmpVectors.ql[0].B(C.jW).normalize():C.position.subtractToRef(Z.getTranslation(),B.TmpVectors.ql[0]).normalize();const b=(0,J.RandomRange)(0,this.directionRandomizer),K=(0,J.RandomRange)(0,this.directionRandomizer),f=(0,J.RandomRange)(0,this.directionRandomizer);l.x=B.TmpVectors.ql[0].x+b,l.y=B.TmpVectors.ql[0].y+K,l.z=B.TmpVectors.ql[0].z+f,l.normalize()}startPositionFunction(Z,l,C,x){const b=(0,J.RandomRange)(0,2*Math.PI);let K;this.emitFromSpawnPointOnly?K=1e-4:(K=(0,J.RandomRange)(0,this.heightRange),K=1-K*K);let f=this._radius-(0,J.RandomRange)(0,this._radius*this.radiusRange);f*=K;const W=f*Math.sin(b),d=f*Math.cos(b),E=K*this._height;if(x)return l.x=W,l.y=E,void(l.z=d);B.ql.TransformCoordinatesFromFloatsToRef(W,E,d,Z,l)}clone(){const Z=new G(this._radius,this._angle,this.directionRandomizer);return d.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat2("radius",this._radius,this.radiusRange),Z.setFloat("coneAngle",this._angle),Z.setFloat2("height",this._height,this.heightRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",2),Z.addUniform("coneAngle",1),Z.addUniform("height",2),Z.addUniform("directionRandomizer",1)}getEffectDefines(){let Z="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(Z+="\n#define CONEEMITTERSPAWNPOINT"),Z}getClassName(){return"ConeParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this._radius,Z.angle=this._angle,Z.directionRandomizer=this.directionRandomizer,Z.radiusRange=this.radiusRange,Z.heightRange=this.heightRange,Z.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,Z}parse(Z){this.radius=Z.radius,this.angle=Z.angle,this.directionRandomizer=Z.directionRandomizer,this.radiusRange=void 0!==Z.radiusRange?Z.radiusRange:1,this.heightRange=void 0!==Z.radiusRange?Z.heightRange:1,this.emitFromSpawnPointOnly=void 0!==Z.emitFromSpawnPointOnly&&Z.emitFromSpawnPointOnly}}class a extends G{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.ql(0,1,0),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.ql(0,1,0);super(Z,l),this.direction1=C,this.direction2=x}startDirectionFunction(Z,l){const C=(0,J.RandomRange)(this.direction1.x,this.direction2.x),x=(0,J.RandomRange)(this.direction1.y,this.direction2.y),b=(0,J.RandomRange)(this.direction1.z,this.direction2.z);B.ql.TransformNormalFromFloatsToRef(C,x,b,Z,l)}clone(){const Z=new a(this.radius,this.angle,this.direction1,this.direction2);return d.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.Yb(),Z.direction2=this.direction2.Yb(),Z}parse(Z){super.parse(Z),this.direction1.B(Z.direction1),this.direction2.B(Z.direction2)}}class q{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=Z,this.height=l,this.radiusRange=C,this.directionRandomizer=x,this._tempVector=B.ql.Zero()}startDirectionFunction(Z,l,C,x,b){C.position.subtractToRef(Z.getTranslation(),this._tempVector),this._tempVector.normalize(),B.ql.TransformNormalToRef(this._tempVector,b,this._tempVector);const K=(0,J.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let f=Math.atan2(this._tempVector.x,this._tempVector.z);f+=(0,J.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=K,this._tempVector.x=Math.sin(f),this._tempVector.z=Math.cos(f),this._tempVector.normalize(),x?l.B(this._tempVector):B.ql.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z,l)}startPositionFunction(Z,l,C,x){const b=(0,J.RandomRange)(-this.height/2,this.height/2),K=(0,J.RandomRange)(0,2*Math.PI),f=(0,J.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),W=Math.sqrt(f)*this.radius,d=W*Math.cos(K),E=W*Math.sin(K);x?l.rb(d,b,E):B.ql.TransformCoordinatesFromFloatsToRef(d,b,E,Z,l)}clone(){const Z=new q(this.radius,this.directionRandomizer);return d.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.height=this.height,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.height=Z.height,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class z extends q{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.ql(0,1,0),b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.ql(0,1,0);super(Z,l,C),this.direction1=x,this.direction2=b}startDirectionFunction(Z,l,C,x){const b=(0,J.RandomRange)(this.direction1.x,this.direction2.x),K=(0,J.RandomRange)(this.direction1.y,this.direction2.y),f=(0,J.RandomRange)(this.direction1.z,this.direction2.z);x?l.rb(b,K,f):B.ql.TransformNormalFromFloatsToRef(b,K,f,Z,l)}clone(){const Z=new z(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return d.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.Yb(),Z.direction2=this.direction2.Yb(),Z}parse(Z){super.parse(Z),B.ql.FromArrayToRef(Z.direction1,0,this.direction1),B.ql.FromArrayToRef(Z.direction2,0,this.direction2)}}class Y{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Z,this.radiusRange=l,this.directionRandomizer=C}startDirectionFunction(Z,l,C,x){const b=C.position.zl(Z.getTranslation()).normalize(),K=(0,J.RandomRange)(0,this.directionRandomizer),f=(0,J.RandomRange)(0,this.directionRandomizer),W=(0,J.RandomRange)(0,this.directionRandomizer);b.x+=K,b.y+=f,b.z+=W,b.normalize(),x?l.B(b):B.ql.TransformNormalFromFloatsToRef(b.x,b.y,b.z,Z,l)}startPositionFunction(Z,l,C,x){const b=this.radius-(0,J.RandomRange)(0,this.radius*this.radiusRange),K=(0,J.RandomRange)(0,1),f=(0,J.RandomRange)(0,2*Math.PI),W=Math.acos(2*K-1),d=b*Math.cos(f)*Math.sin(W),E=b*Math.cos(W),G=b*Math.sin(f)*Math.sin(W);x?l.rb(d,Math.abs(E),G):B.ql.TransformCoordinatesFromFloatsToRef(d,Math.abs(E),G,Z,l)}clone(){const Z=new Y(this.radius,this.directionRandomizer);return d.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class P{constructor(){this.direction1=new B.ql(0,1,0),this.direction2=new B.ql(0,1,0)}startDirectionFunction(Z,l,C,x){const b=(0,J.RandomRange)(this.direction1.x,this.direction2.x),K=(0,J.RandomRange)(this.direction1.y,this.direction2.y),f=(0,J.RandomRange)(this.direction1.z,this.direction2.z);x?l.rb(b,K,f):B.ql.TransformNormalFromFloatsToRef(b,K,f,Z,l)}startPositionFunction(Z,l,C,x){x?l.rb(0,0,0):B.ql.TransformCoordinatesFromFloatsToRef(0,0,0,Z,l)}clone(){const Z=new P;return d.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.Yb(),Z.direction2=this.direction2.Yb(),Z}parse(Z){B.ql.FromArrayToRef(Z.direction1,0,this.direction1),B.ql.FromArrayToRef(Z.direction2,0,this.direction2)}}class S{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Z,this.radiusRange=l,this.directionRandomizer=C}startDirectionFunction(Z,l,C,x){const b=C.position.zl(Z.getTranslation()).normalize(),K=(0,J.RandomRange)(0,this.directionRandomizer),f=(0,J.RandomRange)(0,this.directionRandomizer),W=(0,J.RandomRange)(0,this.directionRandomizer);b.x+=K,b.y+=f,b.z+=W,b.normalize(),x?l.B(b):B.ql.TransformNormalFromFloatsToRef(b.x,b.y,b.z,Z,l)}startPositionFunction(Z,l,C,x){const b=this.radius-(0,J.RandomRange)(0,this.radius*this.radiusRange),K=(0,J.RandomRange)(0,1),f=(0,J.RandomRange)(0,2*Math.PI),W=Math.acos(2*K-1),d=b*Math.cos(f)*Math.sin(W),E=b*Math.cos(W),G=b*Math.sin(f)*Math.sin(W);x?l.rb(d,E,G):B.ql.TransformCoordinatesFromFloatsToRef(d,E,G,Z,l)}clone(){const Z=new S(this.radius,this.directionRandomizer);return d.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class i extends S{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.ql(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.ql(0,1,0);super(Z),this.direction1=l,this.direction2=C}startDirectionFunction(Z,l){const C=(0,J.RandomRange)(this.direction1.x,this.direction2.x),x=(0,J.RandomRange)(this.direction1.y,this.direction2.y),b=(0,J.RandomRange)(this.direction1.z,this.direction2.z);B.ql.TransformNormalFromFloatsToRef(C,x,b,Z,l)}clone(){const Z=new i(this.radius,this.direction1,this.direction2);return d.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.Yb(),Z.direction2=this.direction2.Yb(),Z}parse(Z){super.parse(Z),this.direction1.B(Z.direction1),this.direction2.B(Z.direction2)}}class s{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(Z,l,C,x){const b=B.TmpVectors.ql[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,C,b);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,C,b);const Z=B.TmpVectors.ql[1];b.subtractToRef(C.position,Z),Z.scaleToRef(1/C.lifeTime,b)}else b.set(0,0,0);x?l.B(b):B.ql.TransformNormalToRef(b,Z,l)}startPositionFunction(Z,l,C,x){const b=B.TmpVectors.ql[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,C,b):b.set(0,0,0),x?l.B(b):B.ql.TransformCoordinatesToRef(b,Z,l)}clone(){const Z=new s;return d.d.DeepCopy(this,Z),Z}applyToShader(Z){}buildUniformLayout(Z){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.particlePositionGenerator=this.particlePositionGenerator,Z.particleDestinationGenerator=this.particleDestinationGenerator,Z}parse(Z){Z.particlePositionGenerator&&(this.particlePositionGenerator=Z.particlePositionGenerator),Z.particleDestinationGenerator&&(this.particleDestinationGenerator=Z.particleDestinationGenerator)}}var F=C(12530);class n{get mesh(){return this._mesh}set mesh(Z){this._mesh!==Z&&(this._mesh=Z,Z?(this._indices=Z.cb(),this._positions=Z.getVerticesData(F.h.PositionKind),this._normals=Z.getVerticesData(F.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=B.ql.Zero(),this._mesh=null,this.direction1=new B.ql(0,1,0),this.direction2=new B.ql(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=Z}startDirectionFunction(Z,l,C,x){if(this.useMeshNormalsForDirection&&this._normals)return void B.ql.TransformNormalToRef(this._storedNormal,Z,l);const b=(0,J.RandomRange)(this.direction1.x,this.direction2.x),K=(0,J.RandomRange)(this.direction1.y,this.direction2.y),f=(0,J.RandomRange)(this.direction1.z,this.direction2.z);x?l.rb(b,K,f):B.ql.TransformNormalFromFloatsToRef(b,K,f,Z,l)}startPositionFunction(Z,l,C,x){if(!this._indices||!this._positions)return;const b=3*(Math.random()*(this._indices.length/3)|0),K=Math.random(),f=Math.random()*(1-K),W=1-K-f,J=this._indices[b],d=this._indices[b+1],E=this._indices[b+2],G=B.TmpVectors.ql[0],a=B.TmpVectors.ql[1],q=B.TmpVectors.ql[2],z=B.TmpVectors.ql[3];B.ql.FromArrayToRef(this._positions,3*J,G),B.ql.FromArrayToRef(this._positions,3*d,a),B.ql.FromArrayToRef(this._positions,3*E,q),z.x=K*G.x+f*a.x+W*q.x,z.y=K*G.y+f*a.y+W*q.y,z.z=K*G.z+f*a.z+W*q.z,x?l.rb(z.x,z.y,z.z):B.ql.TransformCoordinatesFromFloatsToRef(z.x,z.y,z.z,Z,l),this.useMeshNormalsForDirection&&this._normals&&(B.ql.FromArrayToRef(this._normals,3*J,G),B.ql.FromArrayToRef(this._normals,3*d,a),B.ql.FromArrayToRef(this._normals,3*E,q),this._storedNormal.x=K*G.x+f*a.x+W*q.x,this._storedNormal.y=K*G.y+f*a.y+W*q.y,this._storedNormal.z=K*G.z+f*a.z+W*q.z)}clone(){const Z=new n(this.mesh);return d.d.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var Z;const l={};return l.type=this.getClassName(),l.direction1=this.direction1.Yb(),l.direction2=this.direction2.Yb(),l.meshId=null===(Z=this.mesh)||void 0===Z?void 0:Z.id,l.useMeshNormalsForDirection=this.useMeshNormalsForDirection,l}parse(Z,l){B.ql.FromArrayToRef(Z.direction1,0,this.direction1),B.ql.FromArrayToRef(Z.direction2,0,this.direction2),Z.meshId&&l&&(this.mesh=l.getLastMeshById(Z.meshId)),this.useMeshNormalsForDirection=Z.useMeshNormalsForDirection}}class c{_isUbo(Z){return void 0!==Z.addUniform}constructor(Z){this._isUbo(Z)?(this.setMatrix3x3=Z.updateMatrix3x3.bind(Z),this.setMatrix2x2=Z.updateMatrix2x2.bind(Z),this.setFloat=Z.updateFloat.bind(Z),this.setFloat2=Z.updateFloat2.bind(Z),this.setFloat3=Z.updateFloat3.bind(Z),this.setFloat4=Z.updateFloat4.bind(Z),this.setFloatArray=Z.updateFloatArray.bind(Z),this.setArray=Z.updateArray.bind(Z),this.setIntArray=Z.updateIntArray.bind(Z),this.setMatrix=Z.sb.bind(Z),this.setMatrices=Z.updateMatrices.bind(Z),this.setVector3=Z.updateVector3.bind(Z),this.setVector4=Z.updateVector4.bind(Z),this.setColor3=Z.updateColor3.bind(Z),this.setColor4=Z.updateColor4.bind(Z),this.setDirectColor4=Z.updateDirectColor4.bind(Z),this.setInt=Z.updateInt.bind(Z),this.setInt2=Z.updateInt2.bind(Z),this.setInt3=Z.updateInt3.bind(Z),this.setInt4=Z.updateInt4.bind(Z)):(this.setMatrix3x3=Z.setMatrix3x3.bind(Z),this.setMatrix2x2=Z.setMatrix2x2.bind(Z),this.setFloat=Z.setFloat.bind(Z),this.setFloat2=Z.setFloat2.bind(Z),this.setFloat3=Z.setFloat3.bind(Z),this.setFloat4=Z.setFloat4.bind(Z),this.setFloatArray=Z.setFloatArray.bind(Z),this.setArray=Z.setArray.bind(Z),this.setIntArray=Z.setIntArray.bind(Z),this.setMatrix=Z.setMatrix.bind(Z),this.setMatrices=Z.setMatrices.bind(Z),this.setVector3=Z.setVector3.bind(Z),this.setVector4=Z.setVector4.bind(Z),this.setColor3=Z.setColor3.bind(Z),this.setColor4=Z.setColor4.bind(Z),this.setDirectColor4=Z.setDirectColor4.bind(Z),this.setInt=Z.setInt.bind(Z),this.setInt2=Z.setInt2.bind(Z),this.setInt3=Z.setInt3.bind(Z),this.setInt4=Z.setInt4.bind(Z))}}var U=C(12356);const t="gpuUpdateParticlesPixelShader",r="#version 300 es\nvoid main() {discard;}\n";U.b.ShadersStore[t]||(U.b.ShadersStore[t]=r);const e="gpuUpdateParticlesVertexShader",o="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";U.b.ShadersStore[e]||(U.b.ShadersStore[e]=o);(0,f.c)("BABYLON.WebGL2ParticleSystem",class{constructor(Z,l){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=Z,this._engine=l,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var Z;return(null===(Z=this._updateEffect)||void 0===Z?void 0:Z.isReady())??!1}createUpdateBuffer(Z){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof s&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=Z,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new c(this._updateEffect)}createVertexBuffers(Z,l){this._updateVAO.push(this._createUpdateVAO(Z)),this._renderVAO.push(this._engine.recordVertexArrayObject(l,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=l}createParticleBuffer(Z){return Z}bindDrawBuffers(Z,l,C){C?this._engine.bindBuffers(this._renderVertexBuffers,C,l):this._engine.bindVertexArrayObject(this._renderVAO[Z],null)}preUpdateParticleBuffer(){const Z=this._engine;if(this._engine.enableEffect(this._updateEffect),!Z.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(Z,l,C){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[Z],null);const B=this._engine;B.bindTransformFeedbackBuffer(l.getBuffer()),B.setRasterizerState(!1),B.beginTransformFeedback(!0),B.drawArraysType(3,0,C),B.endTransformFeedback(),B.setRasterizerState(!0),B.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let Z=0;Z<this._updateVAO.length;Z++)this._engine.releaseVertexArrayObject(this._updateVAO[Z]);this._updateVAO.length=0;for(let Z=0;Z<this._renderVAO.length;Z++)this._engine.releaseVertexArrayObject(this._renderVAO[Z]);this._renderVAO.length=0}_createUpdateVAO(Z){const l={};l.position=Z.createVertexBuffer("position",0,3);let C=3;l.age=Z.createVertexBuffer("age",C,1),C+=1,l.size=Z.createVertexBuffer("size",C,3),C+=3,l.life=Z.createVertexBuffer("life",C,1),C+=1,l.seed=Z.createVertexBuffer("seed",C,4),C+=4,l.direction=Z.createVertexBuffer("direction",C,3),C+=3,this._parent.particleEmitterType instanceof s&&(l.initialPosition=Z.createVertexBuffer("initialPosition",C,3),C+=3),this._parent._colorGradientsTexture||(l.color=Z.createVertexBuffer("color",C,4),C+=4),this._parent._isBillboardBased||(l.initialDirection=Z.createVertexBuffer("initialDirection",C,3),C+=3),this._parent.noiseTexture&&(l.noiseCoordinates1=Z.createVertexBuffer("noiseCoordinates1",C,3),C+=3,l.noiseCoordinates2=Z.createVertexBuffer("noiseCoordinates2",C,3),C+=3),this._parent._angularSpeedGradientsTexture?(l.angle=Z.createVertexBuffer("angle",C,1),C+=1):(l.angle=Z.createVertexBuffer("angle",C,2),C+=2),this._parent._isAnimationSheetEnabled&&(l.cellIndex=Z.createVertexBuffer("cellIndex",C,1),C+=1,this._parent.spriteRandomStartCell&&(l.cellStartOffset=Z.createVertexBuffer("cellStartOffset",C,1),C+=1));const B=this._engine.recordVertexArrayObject(l,null,this._updateEffect);return this._engine.bindArrayBuffer(null),B}});class v{constructor(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,B=arguments.length>3?arguments[3]:void 0;this._engine=Z,this._label=B,this._engine._storageBuffers.push(this),this._create(l,C)}_create(Z,l){this._bufferSize=Z,this._creationFlags=l,this._buffer=this._engine.createStorageBuffer(Z,l,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(Z,l,C){this._buffer&&this._engine.updateStorageBuffer(this._buffer,Z,l,C)}async read(Z,l,C,B){return await this._engine.readFromStorageBuffer(this._buffer,Z,l,C,B)}dispose(){const Z=this._engine._storageBuffers,l=Z.indexOf(this);-1!==l&&(Z[l]=Z[Z.length-1],Z.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var R=C(12428),k=C(12432),V=C(12478),g=C(12423),j=C(12753),M=C(12263),I=C(12385),w=C(12684);class O{constructor(){this._gpuTimeInFrameId=-1,this.counter=new w.c}_addDuration(Z,l){Z<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==Z?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(l,!1),this._gpuTimeInFrameId=Z):this.counter.addCount(l,!1))}}var D=C(12339);class y{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=Z,this._engine=l,this.uniqueId=j.e.UniqueId,l.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new O),this._engine.getCaps().supportComputeShaders?B.bindingsMapping?(this._context=l.createComputeContext(),this._shaderPath=C,this._options={bindingsMapping:{},defines:[],...B}):M.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):M.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(Z,l){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const B=this._bindings[Z];this._bindings[Z]={type:C?0:4,object:l,indexInGroupEntries:null===B||void 0===B?void 0:B.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!B||B.object!==l||B.type!==this._bindings[Z].type)}setStorageTexture(Z,l){const C=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==l),this._bindings[Z]={type:1,object:l,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setExternalTexture(Z,l){const C=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==l),this._bindings[Z]={type:6,object:l,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setVideoTexture(Z,l){return!!l.externalTexture&&(this.setExternalTexture(Z,l.externalTexture),!0)}setUniformBuffer(Z,l){const C=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==l),this._bindings[Z]={type:y._BufferIsDataBuffer(l)?7:2,object:l,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setStorageBuffer(Z,l){const C=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==l),this._bindings[Z]={type:y._BufferIsDataBuffer(l)?7:3,object:l,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setTextureSampler(Z,l){const C=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!C||!l.compareSampler(C.object)),this._bindings[Z]={type:5,object:l,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}isReady(){let Z=this._effect;for(const x in this._bindings){const Z=this._bindings[x],l=Z.type,C=Z.object;switch(l){case 0:case 4:case 1:if(!C.isReady())return!1;break;case 6:if(!C.isReady())return!1;break}}const l=[],C=this._shaderPath;if(this._options.defines)for(let x=0;x<this._options.defines.length;x++)l.push(this._options.defines[x]);const B=l.join("\n");return this._cachedDefines!==B&&(this._cachedDefines=B,Z=this._engine.createComputeEffect(C,{defines:B,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=Z),!!Z.isReady()}dispatch(Z,l,C){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,Z,l,C,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const C=y._BufferIsDataBuffer(Z)?Z:Z.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,C,l,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const l in this._bindings){const C=this._bindings[l];if(!this._options.bindingsMapping[l])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+l+"'");switch(C.type){case 0:{const B=this._samplers[l],x=C.object;var Z;if(!B||!x._texture||!B.compareSampler(x._texture))this._samplers[l]=(new I.d).setParameters(x.wrapU,x.wrapV,x.wrapR,x.anisotropicFilteringLevel,x._texture.samplingMode,null===(Z=x._texture)||void 0===Z?void 0:Z._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const Z=C.object;Z.getBuffer()!==C.buffer&&(C.buffer=Z.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((x=>{(0,D.d)((()=>this.dispatch(Z,l,C)),x,void 0,B)}))}serialize(){const Z=V.b.Serialize(this);Z.options=this._options,Z.shaderPath=this._shaderPath,Z.aa={},Z.textures={};for(const l in this._bindings){const C=this._bindings[l],B=C.object;switch(C.type){case 0:case 4:case 1:{const x=B.serialize();x&&(Z.textures[l]=x,Z.aa[l]={type:C.type});break}}}return Z}static Parse(Z,l,C){const B=V.b.Parse((()=>new y(Z.name,l.getEngine(),Z.shaderPath,Z.options)),Z,l,C);for(const x in Z.textures){const b=Z.aa[x],K=g.c.Parse(Z.textures[x],l,C);0===b.type?B.setTexture(x,K):4===b.type?B.setTexture(x,K,!1):B.setStorageTexture(x,K)}return B}static _BufferIsDataBuffer(Z){return void 0!==Z.underlyingResource}}(0,R.b)([(0,k.R)()],y.prototype,"name",void 0),(0,R.b)([(0,k.R)()],y.prototype,"fastMode",void 0),(0,f.c)("BABYLON.ComputeShader",y);var X=C(12729);const T="gpuUpdateParticlesComputeShader",u="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";U.b.ShadersStoreWGSL[T]||(U.b.ShadersStoreWGSL[T]=u);(0,f.c)("BABYLON.ComputeShaderParticleSystem",class{constructor(Z,l){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=Z,this._engine=l}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var Z;return(null===(Z=this._updateComputeShader)||void 0===Z?void 0:Z.isReady())??!1}createUpdateBuffer(Z){var l;const C={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(C.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(C.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(C.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(C.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(C.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(C.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(C.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new y("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:C,defines:Z.split("\n")}),null===(l=this._simParamsComputeShader)||void 0===l||l.dispose(),this._simParamsComputeShader=new X.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new c(this._simParamsComputeShader)}createVertexBuffers(Z,l){this._renderVertexBuffers.push(l)}createParticleBuffer(Z){const l=new v(this._engine,4*Z.length,11,"ComputeShaderParticleSystemBuffer");return l.update(Z),this._bufferComputeShader.push(l),l.getBuffer()}bindDrawBuffers(Z,l,C){this._engine.bindBuffers(this._renderVertexBuffers[Z],C,l)}preUpdateParticleBuffer(){}updateParticleBuffer(Z,l,C){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[Z]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^Z]),this._updateComputeShader.dispatch(Math.ceil(C/64))}releaseBuffers(){var Z;for(let l=0;l<this._bufferComputeShader.length;++l)this._bufferComputeShader[l].dispose();this._bufferComputeShader.length=0,null===(Z=this._simParamsComputeShader)||void 0===Z||Z.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class H{constructor(Z,l,C){this.gradient=Z,this.color1=l,this.color2=C}getColorToRef(Z){this.color2?K.Rb.LerpToRef(this.color1,this.color2,Math.random(),Z):Z.B(this.color1)}}class Q{constructor(Z,l){this.gradient=Z,this.color=l}}class h{constructor(Z,l,C){this.gradient=Z,this.factor1=l,this.factor2=C}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class A{static GetCurrentGradient(Z,l,C){if(l[0].gradient>Z)return void C(l[0],l[0],1);for(let x=0;x<l.length-1;x++){const B=l[x],b=l[x+1];if(Z>=B.gradient&&Z<=b.gradient){return void C(B,b,(Z-B.gradient)/(b.gradient-B.gradient))}}const B=l.length-1;C(l[B],l[B],1)}}var L=C(12251),p=C(12897),N=C(12295);class mZ{constructor(Z){this.particleSystem=Z,this.position=B.ql.Zero(),this.direction=B.ql.Zero(),this.color=new K.Rb(0,0,0,0),this.colorStep=new K.Rb(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new B.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new K.Rb(0,0,0,0),this._currentColor2=new K.Rb(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=mZ._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let Z=this.age,l=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===l?(l=1,Z=this._randomCellOffset):Z+=this._randomCellOffset);const C=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let B;B=this._initialSpriteCellLoop?(0,J.Clamp)(Z*l%this.lifeTime/this.lifeTime):(0,J.Clamp)(Z*l/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+B*C|0}_inheritParticleInfoToSubEmitter(Z){if(Z.particleSystem.Bl.position){const l=Z.particleSystem.Bl;if(l.position.B(this.position),Z.inheritDirection){const Z=B.TmpVectors.ql[0];this.direction.normalizeToRef(Z),l.setDirection(Z,0,Math.PI/2)}}else{Z.particleSystem.Bl.B(this.position)}this.direction.scaleToRef(Z.inheritedVelocityAmount/2,B.TmpVectors.ql[0]),Z.particleSystem._inheritedVelocityOffset.B(B.TmpVectors.ql[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const Z of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(Z)}_reset(){this.age=0,this.id=mZ._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(Z){Z.position.B(this.position),this._initialDirection?Z._initialDirection?Z._initialDirection.B(this._initialDirection):Z._initialDirection=this._initialDirection.clone():Z._initialDirection=null,Z.direction.B(this.direction),this.jW&&(Z.jW?Z.jW.B(this.jW):Z.jW=this.jW.clone()),Z.color.B(this.color),Z.colorStep.B(this.colorStep),Z.lifeTime=this.lifeTime,Z.age=this.age,Z._randomCellOffset=this._randomCellOffset,Z.size=this.size,Z.scale.B(this.scale),Z.angle=this.angle,Z.angularSpeed=this.angularSpeed,Z.particleSystem=this.particleSystem,Z.cellIndex=this.cellIndex,Z.id=this.id,Z._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(Z._currentColorGradient=this._currentColorGradient,Z._currentColor1.B(this._currentColor1),Z._currentColor2.B(this._currentColor2)),this._currentSizeGradient&&(Z._currentSizeGradient=this._currentSizeGradient,Z._currentSize1=this._currentSize1,Z._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(Z._currentAngularSpeedGradient=this._currentAngularSpeedGradient,Z._currentAngularSpeed1=this._currentAngularSpeed1,Z._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(Z._currentVelocityGradient=this._currentVelocityGradient,Z._currentVelocity1=this._currentVelocity1,Z._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(Z._currentLimitVelocityGradient=this._currentLimitVelocityGradient,Z._currentLimitVelocity1=this._currentLimitVelocity1,Z._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(Z._currentDragGradient=this._currentDragGradient,Z._currentDrag1=this._currentDrag1,Z._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(Z._initialStartSpriteCellId=this._initialStartSpriteCellId,Z._initialEndSpriteCellId=this._initialEndSpriteCellId,Z._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(Z.remapData&&this.remapData?Z.remapData.B(this.remapData):Z.remapData=new B.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.B(this._randomNoiseCoordinates1),Z._randomNoiseCoordinates2.B(this._randomNoiseCoordinates2)):(Z._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),Z._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}mZ._Count=0;var ZZ=C(12578),lZ=(C(12620),C(12804)),CZ=C(12800),BZ=C(12727);function xZ(Z,l){const C=(0,J.RandomRange)(0,1);K.Rb.LerpToRef(l.color1,l.color2,C,Z.color),l.colorDead.subtractToRef(Z.color,l._colorDiff),l._colorDiff.scaleToRef(1/Z.lifeTime,Z.colorStep)}function bZ(Z,l){Z._currentColorGradient=l._colorGradients[0],Z._currentColorGradient.getColorToRef(Z.color),Z._currentColor1.B(Z.color),l._colorGradients.length>1?l._colorGradients[1].getColorToRef(Z._currentColor2):Z._currentColor2.B(Z.color)}function KZ(Z,l){const C=l._colorGradients;A.GetCurrentGradient(l._ratio,C,((l,C,B)=>{l!==Z._currentColorGradient&&(Z._currentColor1.B(Z._currentColor2),C.getColorToRef(Z._currentColor2),Z._currentColorGradient=l),K.Rb.LerpToRef(Z._currentColor1,Z._currentColor2,B,Z.color)}))}function fZ(Z,l){Z.colorStep.scaleToRef(l._scaledUpdateSpeed,l._scaledColorStep),Z.color.addInPlace(l._scaledColorStep),Z.color.a<0&&(Z.color.a=0)}function WZ(Z,l){A.GetCurrentGradient(l._ratio,l._angularSpeedGradients,((l,C,B)=>{l!==Z._currentAngularSpeedGradient&&(Z._currentAngularSpeed1=Z._currentAngularSpeed2,Z._currentAngularSpeed2=C.getFactor(),Z._currentAngularSpeedGradient=l),Z.angularSpeed=(0,J.Lerp)(Z._currentAngularSpeed1,Z._currentAngularSpeed2,B)}))}function JZ(Z,l){Z.angle+=Z.angularSpeed*l._scaledUpdateSpeed}function dZ(Z,l){l.particleEmitterType.startDirectionFunction(l._emitterWorldMatrix,Z.direction,Z,l.isLocal,l._emitterInverseWorldMatrix)}function EZ(Z,l){l.startDirectionFunction(l._emitterWorldMatrix,Z.direction,Z,l.isLocal)}function GZ(Z,l){Z._currentVelocityGradient=l._velocityGradients[0],Z._currentVelocity1=Z._currentVelocityGradient.getFactor(),l._velocityGradients.length>1?Z._currentVelocity2=l._velocityGradients[1].getFactor():Z._currentVelocity2=Z._currentVelocity1}function aZ(Z,l){Z._currentLimitVelocityGradient=l._limitVelocityGradients[0],Z._currentLimitVelocity1=Z._currentLimitVelocityGradient.getFactor(),l._limitVelocityGradients.length>1?Z._currentLimitVelocity2=l._limitVelocityGradients[1].getFactor():Z._currentLimitVelocity2=Z._currentLimitVelocity1}function qZ(Z,l){A.GetCurrentGradient(l._ratio,l._velocityGradients,((C,B,x)=>{C!==Z._currentVelocityGradient&&(Z._currentVelocity1=Z._currentVelocity2,Z._currentVelocity2=B.getFactor(),Z._currentVelocityGradient=C),l._directionScale*=(0,J.Lerp)(Z._currentVelocity1,Z._currentVelocity2,x)}))}function zZ(Z,l){A.GetCurrentGradient(l._ratio,l._limitVelocityGradients,((C,B,x)=>{C!==Z._currentLimitVelocityGradient&&(Z._currentLimitVelocity1=Z._currentLimitVelocity2,Z._currentLimitVelocity2=B.getFactor(),Z._currentLimitVelocityGradient=C);const b=(0,J.Lerp)(Z._currentLimitVelocity1,Z._currentLimitVelocity2,x);Z.direction.length()>b&&Z.direction.scaleInPlace(l.limitVelocityDamping)}))}function YZ(Z,l){Z.direction.scaleToRef(l._directionScale,l._scaledDirection)}function PZ(Z,l){l.particleEmitterType.startPositionFunction(l._emitterWorldMatrix,Z.position,Z,l.isLocal)}function SZ(Z,l){l.startPositionFunction(l._emitterWorldMatrix,Z.position,Z,l.isLocal)}function iZ(Z,l){Z.jW?Z.jW.B(Z.position):Z.jW=Z.position.clone(),B.ql.TransformCoordinatesToRef(Z.jW,l._emitterWorldMatrix,Z.position)}function sZ(Z,l){l.isLocal&&Z.jW?(Z.jW.addInPlace(l._scaledDirection),B.ql.TransformCoordinatesToRef(Z.jW,l._emitterWorldMatrix,Z.position)):Z.position.addInPlace(l._scaledDirection)}function FZ(Z,l){Z._currentDragGradient=l._dragGradients[0],Z._currentDrag1=Z._currentDragGradient.getFactor(),l._dragGradients.length>1?Z._currentDrag2=l._dragGradients[1].getFactor():Z._currentDrag2=Z._currentDrag1}function nZ(Z,l){A.GetCurrentGradient(l._ratio,l._dragGradients,((C,B,x)=>{C!==Z._currentDragGradient&&(Z._currentDrag1=Z._currentDrag2,Z._currentDrag2=B.getFactor(),Z._currentDragGradient=C);const b=(0,J.Lerp)(Z._currentDrag1,Z._currentDrag2,x);l._scaledDirection.scaleInPlace(1-b)}))}function cZ(Z,l){Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.rb(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2.rb(Math.random(),Math.random(),Math.random())):(Z._randomNoiseCoordinates1=new B.ql(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2=new B.ql(Math.random(),Math.random(),Math.random()))}function UZ(Z,l){const C=l._noiseTextureData,x=l._noiseTextureSize;if(C&&x&&Z._randomNoiseCoordinates1){const b=l._fetchR(Z._randomNoiseCoordinates1.x,Z._randomNoiseCoordinates1.y,x.width,x.height,C),K=l._fetchR(Z._randomNoiseCoordinates1.z,Z._randomNoiseCoordinates2.x,x.width,x.height,C),f=l._fetchR(Z._randomNoiseCoordinates2.y,Z._randomNoiseCoordinates2.z,x.width,x.height,C),W=B.TmpVectors.ql[0],J=B.TmpVectors.ql[1];W.rb((2*b-1)*l.noiseStrength.x,(2*K-1)*l.noiseStrength.y,(2*f-1)*l.noiseStrength.z),W.scaleToRef(l._tempScaledUpdateSpeed,J),Z.direction.addInPlace(J)}}function tZ(Z,l){l.gravity.scaleToRef(l._tempScaledUpdateSpeed,l._scaledGravity),Z.direction.addInPlace(l._scaledGravity)}function rZ(Z,l){Z.size=(0,J.RandomRange)(l.minSize,l.maxSize),Z.scale.rb((0,J.RandomRange)(l.minScaleX,l.maxScaleX),(0,J.RandomRange)(l.minScaleY,l.maxScaleY))}function eZ(Z,l){Z._currentSizeGradient=l._sizeGradients[0],Z._currentSize1=Z._currentSizeGradient.getFactor(),Z.size=Z._currentSize1,l._sizeGradients.length>1?Z._currentSize2=l._sizeGradients[1].getFactor():Z._currentSize2=Z._currentSize1,Z.scale.rb((0,J.RandomRange)(l.minScaleX,l.maxScaleX),(0,J.RandomRange)(l.minScaleY,l.maxScaleY))}function oZ(Z,l){const C=l._actualFrame/l.targetStopDuration;A.GetCurrentGradient(C,l._startSizeGradients,((C,B,x)=>{C!==l._currentStartSizeGradient&&(l._currentStartSize1=l._currentStartSize2,l._currentStartSize2=B.getFactor(),l._currentStartSizeGradient=C);const b=(0,J.Lerp)(l._currentStartSize1,l._currentStartSize2,x);Z.scale.scaleInPlace(b)}))}function vZ(Z,l){A.GetCurrentGradient(l._ratio,l._sizeGradients,((l,C,B)=>{l!==Z._currentSizeGradient&&(Z._currentSize1=Z._currentSize2,Z._currentSize2=C.getFactor(),Z._currentSizeGradient=l),Z.size=(0,J.Lerp)(Z._currentSize1,Z._currentSize2,B)}))}function RZ(Z,l){Z.remapData=new B.Vector4(0,1,0,1)}function kZ(Z,l){l._colorRemapGradients&&l._colorRemapGradients.length>0&&A.GetCurrentGradient(l._ratio,l._colorRemapGradients,((l,C,B)=>{const x=(0,J.Lerp)(l.factor1,C.factor1,B),b=(0,J.Lerp)(l.factor2,C.factor2,B);Z.remapData.x=x,Z.remapData.y=b-x})),l._alphaRemapGradients&&l._alphaRemapGradients.length>0&&A.GetCurrentGradient(l._ratio,l._alphaRemapGradients,((l,C,B)=>{const x=(0,J.Lerp)(l.factor1,C.factor1,B),b=(0,J.Lerp)(l.factor2,C.factor2,B);Z.remapData.z=x,Z.remapData.w=b-x}))}function VZ(Z,l){const C=(0,J.Clamp)(l._actualFrame/l.targetStopDuration);A.GetCurrentGradient(C,l._lifeTimeGradients,((l,B)=>{const x=l,b=B,K=x.getFactor(),f=b.getFactor(),W=(C-x.gradient)/(b.gradient-x.gradient);Z.lifeTime=(0,J.Lerp)(K,f,W)})),l._emitPower=(0,J.RandomRange)(l.minEmitPower,l.maxEmitPower)}function gZ(Z,l){Z.lifeTime=(0,J.RandomRange)(l.minLifeTime,l.maxLifeTime),l._emitPower=(0,J.RandomRange)(l.minEmitPower,l.maxEmitPower)}function jZ(Z,l){0===l._emitPower?(Z._initialDirection?Z._initialDirection.B(Z.direction):Z._initialDirection=Z.direction.clone(),Z.direction.set(0,0,0)):(Z._initialDirection=null,Z.direction.scaleInPlace(l._emitPower)),Z.direction.addInPlace(l._inheritedVelocityOffset)}function MZ(Z,l){Z.angularSpeed=(0,J.RandomRange)(l.minAngularSpeed,l.maxAngularSpeed),Z.angle=(0,J.RandomRange)(l.minInitialRotation,l.maxInitialRotation)}function IZ(Z,l){Z._currentAngularSpeedGradient=l._angularSpeedGradients[0],Z.angularSpeed=Z._currentAngularSpeedGradient.getFactor(),Z._currentAngularSpeed1=Z.angularSpeed,l._angularSpeedGradients.length>1?Z._currentAngularSpeed2=l._angularSpeedGradients[1].getFactor():Z._currentAngularSpeed2=Z._currentAngularSpeed1,Z.angle=(0,J.RandomRange)(l.minInitialRotation,l.maxInitialRotation)}function wZ(Z,l){Z._initialStartSpriteCellId=l.startSpriteCellID,Z._initialEndSpriteCellId=l.endSpriteCellID,Z._initialSpriteCellLoop=l.spriteCellLoop}function OZ(Z,l){Z.previousItem=l.previousItem,Z.nextItem=l,l.previousItem&&(l.previousItem.nextItem=Z),l.previousItem=Z}function DZ(Z,l){Z.previousItem=l,Z.nextItem=l.nextItem,l.nextItem&&(l.nextItem.previousItem=Z),l.nextItem=Z}function yZ(Z,l){let C=l;for(;C.nextItem;)C=C.nextItem;Z.previousItem=C,Z.nextItem=C.nextItem,C.nextItem=Z}function XZ(Z){Z.previousItem&&(Z.previousItem.nextItem=Z.nextItem),Z.nextItem&&(Z.nextItem.previousItem=Z.previousItem)}class TZ extends W{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(Z){this._startDirectionFunction!==Z&&(this._startDirectionFunction=Z,this._directionProcessing.process=Z?EZ:dZ)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(Z){this._startPositionFunction!==Z&&(this._startPositionFunction=Z,this._positionCreation.process=Z?SZ:PZ)}set onDispose(Z){this._onDisposeObserver&&this.xb.remove(this._onDisposeObserver),this._onDisposeObserver=this.xb.add(Z)}get J(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(Z){this._useRampGradients!==Z&&(this._useRampGradients=Z,this._resetEffect(),Z?(this._rampCreation={process:RZ,previousItem:null,nextItem:null},DZ(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:kZ,previousItem:null,nextItem:null},DZ(this._remapGradientProcessing,this._gravityProcessing)):(XZ(this._rampCreation),XZ(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(Z){this._isLocal!==Z&&(this._isLocal=Z,Z?(this._isLocalCreation={process:iZ,previousItem:null,nextItem:null},DZ(this._isLocalCreation,this._positionCreation)):XZ(this._isLocalCreation))}get particles(){return this.Wa}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Z){this._animationSheetEnabled!==Z&&(this._animationSheetEnabled=Z,Z?(this._sheetCreation={process:wZ,previousItem:null,nextItem:null},DZ(this._sheetCreation,this._colorCreation)):XZ(this._sheetCreation),this._reset())}getActiveCount(){return this.Wa.length}getClassName(){return"Ib"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var Z;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._customWrappers[l])||void 0===Z?void 0:Z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Z]??this._customWrappers[0]}setCustomEffect(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[l]=new ZZ.d(this._engine),this._customWrappers[l].effect=Z,this._customWrappers[l].drawContext&&(this._customWrappers[l].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new L.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(Z){if(this.noiseTexture!==Z){if(this._noiseTexture=Z,!Z)return XZ(this._noiseCreation),void XZ(this._noiseProcessing);this._noiseCreation={process:cZ,previousItem:null,nextItem:null},DZ(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:UZ,previousItem:null,nextItem:null},DZ(this._noiseProcessing,this._positionProcessing)}}constructor(Z,l,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,W=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(Z),this._emitterInverseWorldMatrix=B.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new B.ql,this.xb=new L.b,this.onStoppedObservable=new L.b,this.onStartedObservable=new L.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Wa=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new K.Rb(0,0,0,0),this._colorDiff=new K.Rb(0,0,0,0),this._scaledDirection=B.ql.Zero(),this._scaledGravity=B.ql.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=Z=>{},this.recycleParticle=Z=>{const l=this.Wa.pop();l!==Z&&l.copyTo(Z),this._stockParticles.push(l)},this._createParticle=()=>{let Z;return 0!==this._stockParticles.length?(Z=this._stockParticles.pop(),Z._reset()):Z=new mZ(this),this._prepareParticle(Z),Z},this.paused=!1,this._shadersLoaded=!1,this._capacity=l,this._epsilon=f,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=B.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||N.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ka.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:gZ,previousItem:null,nextItem:null},this._positionCreation={process:PZ,previousItem:null,nextItem:null},DZ(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:dZ,previousItem:null,nextItem:null},DZ(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:jZ,previousItem:null,nextItem:null},DZ(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:rZ,previousItem:null,nextItem:null},DZ(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:MZ,previousItem:null,nextItem:null},DZ(this._angleCreation,this._sizeCreation),this._colorCreation={process:xZ,previousItem:null,nextItem:null},DZ(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,W||(this._colorProcessing={process:fZ,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:JZ,previousItem:null,nextItem:null},DZ(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:YZ,previousItem:null,nextItem:null},DZ(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:sZ,previousItem:null,nextItem:null},DZ(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:tZ,previousItem:null,nextItem:null},DZ(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=b,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ZZ.d(this._engine)},this._customWrappers[0].effect=x,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new E,this.updateFunction=Z=>{var l;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(l=this.noiseTexture.getContent())||void 0===l||l.then((Z=>{this._noiseTextureData=Z})));const C=Z===this.Wa;for(let B=0;B<Z.length;B++){const l=Z[B];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const x=l.age;if(l.age+=this._tempScaledUpdateSpeed,l.age>l.lifeTime){const Z=l.age-x,C=l.lifeTime-x;this._tempScaledUpdateSpeed=C*this._tempScaledUpdateSpeed/Z,l.age=l.lifeTime}this._ratio=l.age/l.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let b=this._updateQueueStart;for(;b;)b.process(l,this),b=b.nextItem;if(this._isAnimationSheetEnabled&&!W&&l.updateCellIndex(),l._inheritParticleInfoToSubEmitters(),l.age>=l.lifeTime){if(this._emitFromParticle(l),l._attachedSubEmitters){for(const Z of l._attachedSubEmitters)Z.particleSystem.disposeOnStop=!0,Z.particleSystem.stop();l._attachedSubEmitters=null}this.recycleParticle(l),C&&B--}else;}}}serialize(Z){throw new Error("Method not implemented.")}clone(Z,l){throw new Error("Method not implemented.")}_addFactorGradient(Z,l,C,B){const x=new h(l,C,B);Z.push(x),Z.sort(((Z,l)=>Z.gradient<l.gradient?-1:Z.gradient>l.gradient?1:0))}_removeFactorGradient(Z,l){if(!Z)return;let C=0;for(const B of Z){if(B.gradient===l){Z.splice(C,1);break}C++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=VZ:this._lifeTimeCreation.process=gZ}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:oZ,previousItem:null,nextItem:null},DZ(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(XZ(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Z){this.targetStopDuration!==Z&&(this._targetStopDuration=Z,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(Z,l,C){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,Z,l,C),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(Z){return this._removeFactorGradient(this._lifeTimeGradients,Z),this._syncLifeTimeCreation(),this}addSizeGradient(Z,l,C){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=eZ,this._sizeGradientProcessing={process:vZ,previousItem:null,nextItem:null},OZ(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,Z,l,C),this}removeSizeGradient(Z){var l;return this._removeFactorGradient(this._sizeGradients,Z),0===(null===(l=this._sizeGradients)||void 0===l?void 0:l.length)&&(XZ(this._sizeGradientProcessing),this._sizeCreation.process=rZ),this}addColorRemapGradient(Z,l,C){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,Z,l,C),this}removeColorRemapGradient(Z){return this._removeFactorGradient(this._colorRemapGradients,Z),this}addAlphaRemapGradient(Z,l,C){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,Z,l,C),this}removeAlphaRemapGradient(Z){return this._removeFactorGradient(this._alphaRemapGradients,Z),this}addAngularSpeedGradient(Z,l,C){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=IZ,this._angularSpeedGradientProcessing={process:WZ,previousItem:null,nextItem:null},OZ(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,Z,l,C),this}removeAngularSpeedGradient(Z){var l;return this._removeFactorGradient(this._angularSpeedGradients,Z),0===(null===(l=this._angularSpeedGradients)||void 0===l?void 0:l.length)&&(this._angleCreation.process=MZ,XZ(this._angularSpeedGradientProcessing)),this}addVelocityGradient(Z,l,C){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:GZ,previousItem:null,nextItem:null},DZ(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:qZ,previousItem:null,nextItem:null},OZ(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,Z,l,C),this}removeVelocityGradient(Z){var l;return this._removeFactorGradient(this._velocityGradients,Z),0===(null===(l=this._velocityGradients)||void 0===l?void 0:l.length)&&(XZ(this._velocityCreation),XZ(this._velocityGradientProcessing)),this}addLimitVelocityGradient(Z,l,C){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:aZ,previousItem:null,nextItem:null},DZ(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:zZ,previousItem:null,nextItem:null},DZ(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,Z,l,C),this}removeLimitVelocityGradient(Z){var l;return this._removeFactorGradient(this._limitVelocityGradients,Z),0===(null===(l=this._limitVelocityGradients)||void 0===l?void 0:l.length)&&(XZ(this._limitVelocityCreation),XZ(this._limitVelocityGradientProcessing)),this}addDragGradient(Z,l,C){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:FZ,previousItem:null,nextItem:null},OZ(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:nZ,previousItem:null,nextItem:null},OZ(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,Z,l,C),this}removeDragGradient(Z){var l;return this._removeFactorGradient(this._dragGradients,Z),0===(null===(l=this._dragGradients)||void 0===l?void 0:l.length)&&(XZ(this._dragCreation),XZ(this._dragGradientProcessing)),this}addEmitRateGradient(Z,l,C){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,Z,l,C),this}removeEmitRateGradient(Z){return this._removeFactorGradient(this._emitRateGradients,Z),this}addStartSizeGradient(Z,l,C){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,Z,l,C),this._syncStartSizeCreation(),this}removeStartSizeGradient(Z){return this._removeFactorGradient(this._startSizeGradients,Z),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const Z=new Uint8Array(4*this._rawTextureWidth),l=K.TmpColors.Sl[0];for(let C=0;C<this._rawTextureWidth;C++){const B=C/this._rawTextureWidth;A.GetCurrentGradient(B,this._rampGradients,((B,x,b)=>{K.Sl.LerpToRef(B.color,x.color,b,l),Z[4*C]=255*l.r,Z[4*C+1]=255*l.g,Z[4*C+2]=255*l.b,Z[4*C+3]=255}))}this._rampGradientsTexture=p.e.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((Z,l)=>Z.gradient<l.gradient?-1:Z.gradient>l.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(Z,l){this._rampGradients||(this._rampGradients=[]);const C=new Q(Z,l);return this._rampGradients.push(C),this._syncRampGradientTexture(),this}removeRampGradient(Z){return this._removeGradientAndTexture(Z,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(Z,l,C){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=bZ,this._colorProcessing.process=KZ);const B=new H(Z,l,C);return this._colorGradients.push(B),this._colorGradients.sort(((Z,l)=>Z.gradient<l.gradient?-1:Z.gradient>l.gradient?1:0)),this}removeColorGradient(Z){if(!this._colorGradients)return this;let l=0;for(const C of this._colorGradients){if(C.gradient===Z){this._colorGradients.splice(l,1);break}l++}return 0===this._colorGradients.length&&(this._colorCreation.process=xZ,this._colorProcessing.process=fZ),this}resetDrawCache(){if(this._drawWrappers){for(const Z of this._drawWrappers)if(Z)for(const l of Z)null===l||void 0===l||l.dispose();this._drawWrappers=[]}}_fetchR(Z,l,C,B,x){return x[4*(((Z=.5*Math.abs(Z)+.5)*C%C|0)+((l=.5*Math.abs(l)+.5)*B%B|0)*C)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const Z=this._engine,l=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*l),this._vertexBuffer=new F.d(Z,this._vertexData,!0,l);let C=0;const B=this._vertexBuffer.createVertexBuffer(F.h.PositionKind,C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[F.h.PositionKind]=B,C+=3;const x=this._vertexBuffer.createVertexBuffer(F.h.ColorKind,C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[F.h.ColorKind]=x,C+=4;const b=this._vertexBuffer.createVertexBuffer("angle",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=b,C+=1;const K=this._vertexBuffer.createVertexBuffer("size",C,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=K,C+=2,this._isAnimationSheetEnabled){const Z=this._vertexBuffer.createVertexBuffer("cellIndex",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=Z,C+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const Z=this._vertexBuffer.createVertexBuffer("direction",C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=Z,C+=3}if(this._useRampGradients){const Z=this._vertexBuffer.createVertexBuffer("remapData",C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=Z,C+=4}let f;if(this._useInstancing){const l=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new F.d(Z,l,!1,2),f=this._spriteBuffer.createVertexBuffer("offset",0,2)}else f=this._vertexBuffer.createVertexBuffer("offset",C,2,this._vertexBufferSize,this._useInstancing),C+=2;this._vertexBuffers.offset=f,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const Z=[],l=[];let C=0;for(let B=0;B<this._capacity;B++)Z.push(C),Z.push(C+1),Z.push(C+2),Z.push(C),Z.push(C+2),Z.push(C+3),l.push(C,C+1,C+1,C+2,C+2,C+3,C+3,C,C,C+3),C+=4;this._indexBuffer=this._engine.createIndexBuffer(Z),this._linesIndexBuffer=this._engine.createIndexBuffer(l)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(Z)setTimeout((()=>{this.start(0)}),Z);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var l;-1!==(null===(l=this.Bl)||void 0===l?void 0:l.getClassName().indexOf("Mesh"))&&this.Bl.Fb(!0);const Z=this.noiseTexture;if(Z&&Z.onGeneratedObservable)Z.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let l=0;l<this.preWarmCycles;l++)this.animate(!0),Z.render()}))}));else for(let l=0;l<this.preWarmCycles;l++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(Z))}_postStop(Z){}reset(){this._stockParticles.length=0,this.Wa.length=0}_appendParticleVertex(Z,l,C,x){let b=Z*this._vertexBufferSize;if(this._vertexData[b++]=l.position.x+this.xd.x,this._vertexData[b++]=l.position.y+this.xd.y,this._vertexData[b++]=l.position.z+this.xd.z,this._vertexData[b++]=l.color.r,this._vertexData[b++]=l.color.g,this._vertexData[b++]=l.color.b,this._vertexData[b++]=l.color.a,this._vertexData[b++]=l.angle,this._vertexData[b++]=l.scale.x*l.size,this._vertexData[b++]=l.scale.y*l.size,this._isAnimationSheetEnabled&&(this._vertexData[b++]=l.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[b++]=l.direction.x,this._vertexData[b++]=l.direction.y,this._vertexData[b++]=l.direction.z);else if(l._initialDirection){let Z=l._initialDirection;this.isLocal&&(B.ql.TransformNormalToRef(Z,this._emitterWorldMatrix,B.TmpVectors.ql[0]),Z=B.TmpVectors.ql[0]),0===Z.x&&0===Z.z&&(Z.x=.001),this._vertexData[b++]=Z.x,this._vertexData[b++]=Z.y,this._vertexData[b++]=Z.z}else{let Z=l.direction;this.isLocal&&(B.ql.TransformNormalToRef(Z,this._emitterWorldMatrix,B.TmpVectors.ql[0]),Z=B.TmpVectors.ql[0]),0===Z.x&&0===Z.z&&(Z.x=.001),this._vertexData[b++]=Z.x,this._vertexData[b++]=Z.y,this._vertexData[b++]=Z.z}this._useRampGradients&&l.remapData&&(this._vertexData[b++]=l.remapData.x,this._vertexData[b++]=l.remapData.y,this._vertexData[b++]=l.remapData.z,this._vertexData[b++]=l.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===C?C=this._epsilon:1===C&&(C=1-this._epsilon),0===x?x=this._epsilon:1===x&&(x=1-this._epsilon)),this._vertexData[b++]=C,this._vertexData[b++]=x)}_prepareParticle(Z){}_createNewOnes(Z){let l;for(let C=0;C<Z&&this.Wa.length!==this._capacity;C++){l=this._createParticle(),this.Wa.push(l);let Z=this._createQueueStart;for(;Z;)Z.process(l,this),Z=Z.nextItem;l._inheritParticleInfoToSubEmitters()}}_update(Z){if(this._alive=this.Wa.length>0,this.Bl.position){const Z=this.Bl;this._emitterWorldMatrix=Z.getWorldMatrix()}else{const Z=this.Bl;this._emitterWorldMatrix=B.Matrix.Translation(Z.x,Z.y,Z.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Wa),this._createNewOnes(Z)}static _GetAttributeNamesOrOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=[F.h.PositionKind,F.h.ColorKind,"angle","offset","size"];return Z&&B.push("cellIndex"),l||B.push("direction"),C&&B.push("remapData"),B}static _GetEffectCreationOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,lZ.b)(B),Z&&B.push("particlesInfos"),l&&B.push("logarithmicDepthConstant"),C&&(B.push("vFogInfos"),B.push("vFogColor")),B}fillDefines(Z,l){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,lZ.h)(this,this._scene,Z),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&Z.push("#define FOG")),this._isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&Z.push("#define LOGARITHMICDEPTH"),l===W.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&Z.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case 2:Z.push("#define BILLBOARDY");break;case 8:case 9:Z.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&Z.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:Z.push("#define BILLBOARDMODE_ALL")}C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Z,l,C){l.push(...TZ._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),Z.push(...TZ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,BZ.e)(Z,this._imageProcessingConfigurationDefines),(0,BZ.c)(C,this._imageProcessingConfigurationDefines))}_getWrapper(Z){const l=this._getCustomDrawWrapper(Z);if(null!==l&&void 0!==l&&l.effect)return l;const C=[];this.fillDefines(C,Z);const B=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let x=this._drawWrappers[B];x||(x=this._drawWrappers[B]=[]);let b=x[Z];b||(b=new ZZ.d(this._engine),b.drawContext&&(b.drawContext.useInstancing=this._useInstancing),x[Z]=b);const K=C.join("\n");if(b.defines!==K){const Z=[],l=[],C=[];this.fillUniformsAttributesAndSamplerNames(l,Z,C),b.setEffect(this._engine.createEffect("particles",Z,l,C,K,void 0,void 0,void 0,void 0,this._shaderLanguage),K)}return b}animate(){var Z;let l,C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!C&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(C?this.preWarmStepOffset:(null===(Z=this._scene)||void 0===Z?void 0:Z.getAnimationRatio())||1),this.manualEmitCount>-1)l=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let Z=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const l=this._actualFrame/this.targetStopDuration;A.GetCurrentGradient(l,this._emitRateGradients,((l,C,B)=>{l!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=C.getFactor(),this._currentEmitRateGradient=l),Z=(0,J.Lerp)(this._currentEmitRate1,this._currentEmitRate2,B)}))}l=Z*this._scaledUpdateSpeed|0,this._newPartsExcess+=Z*this._scaledUpdateSpeed-l}if(this._newPartsExcess>1&&(l+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?l=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(l),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!C){let Z=0;for(let l=0;l<this.Wa.length;l++){const C=this.Wa[l];this._appendParticleVertices(Z,C),Z+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Wa.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(Z,l){this._appendParticleVertex(Z++,l,0,0),this._useInstancing||(this._appendParticleVertex(Z++,l,1,0),this._appendParticleVertex(Z++,l,1,1),this._appendParticleVertex(Z++,l,0,1))}rebuild(){var Z;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(Z=this._spriteBuffer)||void 0===Z||Z._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!TZ.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(C.bind(C,13599)),Promise.resolve().then(C.bind(C,13541))])):await Promise.all([Promise.resolve().then(C.bind(C,13533)),Promise.resolve().then(C.bind(C,13520))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Bl||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==W.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(W.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(W.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(Z){const l=this._getWrapper(Z),C=l.effect,x=this._engine;x.enableEffect(l);const b=this.defaultViewMatrix??this._scene.getViewMatrix();if(C.setTexture("diffuseSampler",this.particleTexture),C.setMatrix("view",b),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const Z=this.particleTexture.getBaseSize();C.setFloat3("particlesInfos",this.spriteCellWidth/Z.width,this.spriteCellHeight/Z.height,this.spriteCellWidth/Z.width)}if(C.setVector2("translationPivot",this.translationPivot),C.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const Z=this._scene.activeCamera;C.setVector3("eyePosition",Z.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),C.setTexture("rampSampler",this._rampGradientsTexture));const K=C.defines;var f,W,J,d,E,G;(this._scene&&((0,lZ.d)(C,this,this._scene),this.applyFog&&(0,CZ.f)(this._scene,void 0,C)),K.indexOf("#define BILLBOARDMODE_ALL")>=0&&(b.invertToRef(B.TmpVectors.Matrix[0]),C.setMatrix("invView",B.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?x.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,C):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,C)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?x.bindBuffers(this._vertexBuffers,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBuffer:this._indexBuffer,C):x.bindBuffers(this._vertexBuffers,null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._linesIndexBufferUseInstancing:null,C);(this.useLogarithmicDepth&&this._scene&&(0,CZ.j)(K,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(Z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),this._useInstancing)?null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?x.drawElementsType(6,0,10,this.Wa.length):x.drawArraysType(7,0,4,this.Wa.length):null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?x.drawElementsType(1,0,10*this.Wa.length):x.drawElementsType(0,0,6*this.Wa.length);return this.Wa.length}render(){if(!this.isReady()||!this.Wa.length)return 0;const Z=this._engine;Z.setState&&(Z.setState(!1),this.forceDepthWrite&&Z.setDepthWrite(!0));let l=0;return l=this.blendMode===W.BLENDMODE_MULTIPLYADD?this._render(W.BLENDMODE_MULTIPLY)+this._render(W.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),l}_onDispose(){}dispose(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(l,C),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const Z=this._scene.Ka.indexOf(this);Z>-1&&this._scene.Ka.splice(Z,1),this._scene._activeParticleSystems.dispose()}this.xb.notifyObservers(this),this.xb.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}TZ.ForceGLSL=!1;var uZ,HZ=C(12282);!function(Z){Z[Z.ATTACHED=0]="ATTACHED",Z[Z.END=1]="END"}(uZ||(uZ={}));class QZ{constructor(Z){if(this.particleSystem=Z,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!Z.Bl||!Z.Bl.dispose){const l=(0,f.b)("BABYLON.AbstractMesh");Z.Bl=new l("SubemitterSystemEmitter",Z.cZ()),Z._disposeEmitterOnDispose=!0}}clone(){let Z=this.particleSystem.Bl;if(Z){if(Z instanceof B.ql)Z=Z.clone();else if(-1!==Z.getClassName().indexOf("Mesh")){Z=new((0,f.b)("BABYLON.Mesh"))("",Z.cZ()),Z.isVisible=!1}}else Z=new B.ql;const l=new QZ(this.particleSystem.clone(this.particleSystem.name,Z));return l.particleSystem.name+="Clone",l.type=this.type,l.inheritDirection=this.inheritDirection,l.inheritedVelocityAmount=this.inheritedVelocityAmount,l.particleSystem._disposeEmitterOnDispose=!0,l.particleSystem.disposeOnStop=!0,l}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l={};return l.type=this.type,l.inheritDirection=this.inheritDirection,l.inheritedVelocityAmount=this.inheritedVelocityAmount,l.particleSystem=this.particleSystem.serialize(Z),l}static _ParseParticleSystem(Z,l,C){throw(0,HZ.d)("ParseParticle")}static Parse(Z,l,C){const B=Z.particleSystem,x=new QZ(QZ._ParseParticleSystem(B,l,C,!0));return x.type=Z.type,x.inheritDirection=Z.inheritDirection,x.inheritedVelocityAmount=Z.inheritedVelocityAmount,x.particleSystem._isSubEmitter=!0,x}dispose(){this.particleSystem.dispose()}}var hZ=C(12346);function AZ(Z,l){const C=new P;return C.direction1=Z,C.direction2=l,C}function LZ(){return new Y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function pZ(){return new S(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function NZ(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.ql(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.ql(0,1,0);return new i(Z,l,C)}function ml(){return new q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Zl(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.ql(0,1,0),b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.ql(0,1,0);return new z(Z,l,C,x,b)}function ll(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new G(Z,l)}function Cl(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.ql(0,1,0),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.ql(0,1,0);return new a(Z,l,C,x)}const Bl=B.ql.Zero(),xl=B.ql.Zero(),bl=B.ql.Zero();class Kl{constructor(){this.strength=0,this.position=B.ql.Zero()}_processParticle(Z,l){this.position.subtractToRef(Z.position,Bl);const C=Bl.lengthSquared()+1;Bl.normalize().scaleToRef(this.strength/C,xl),xl.scaleToRef(l._tempScaledUpdateSpeed,bl),Z.direction.addInPlace(bl)}serialize(){return{position:this.position.Yb(),strength:this.strength}}}class fl extends TZ{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=Z=>{if(!this._subEmitters||0===this._subEmitters.length)return;const l=Math.floor(Math.random()*this._subEmitters.length);for(const C of this._subEmitters[l])if(1===C.type){const l=C.clone();Z._inheritParticleInfoToSubEmitter(l),l.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(l.particleSystem),l.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(Z,l){const C=AZ(Z,l);return this.particleEmitterType=C,C}get flowMap(){return this._flowMap}set flowMap(Z){this._flowMap!==Z&&(this._flowMap=Z,this._flowMapUpdate&&(XZ(this._flowMapUpdate),this._flowMapUpdate=null),Z&&(this._flowMapUpdate={process:Z=>{var l;const C=null===(l=this.cZ())||void 0===l?void 0:l.getTransformMatrix();this._flowMap._processParticle(Z,this.flowMapStrength*this._tempScaledUpdateSpeed,C)},previousItem:null,nextItem:null},DZ(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(Z){this._attractors.push(Z),1===this._attractors.length&&(this._attractorUpdate={process:Z=>{for(const l of this._attractors)l._processParticle(Z,this)},previousItem:null,nextItem:null},DZ(this._attractorUpdate,this._directionProcessing))}removeAttractor(Z){const l=this._attractors.indexOf(Z);-1!==l&&this._attractors.splice(l,1),0===this._attractors.length&&XZ(this._attractorUpdate)}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(Z)}createHemisphericEmitter(){const Z=LZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createSphereEmitter(){const Z=pZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createDirectedSphereEmitter(){const Z=NZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.ql(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.ql(0,1,0));return this.particleEmitterType=Z,Z}createCylinderEmitter(){const Z=ml(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Z,Z}createDirectedCylinderEmitter(){const Z=Zl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.ql(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.ql(0,1,0));return this.particleEmitterType=Z,Z}createConeEmitter(){const Z=ll(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Z,Z}createDirectedConeEmitter(){const Z=Cl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.ql(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.ql(0,1,0));return this.particleEmitterType=Z,Z}createBoxEmitter(Z,l,C,B){const x=new E;return this.particleEmitterType=x,this.direction1=Z,this.direction2=l,this.minEmitBox=C,this.maxEmitBox=B,x}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const Z of this.subEmitters)Z instanceof fl?this._subEmitters.push([new QZ(Z)]):Z instanceof QZ?this._subEmitters.push([Z]):Z instanceof Array&&this._subEmitters.push(Z)}_stopSubEmitters(){if(this.activeSubSystems){for(const Z of this.activeSubSystems)Z.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const Z=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==Z&&this._rootParticleSystem.activeSubSystems.splice(Z,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(Z){Z&&this._stopSubEmitters()}_prepareParticle(Z){if(this._subEmitters&&this._subEmitters.length>0){const l=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];Z._attachedSubEmitters=[];for(const C of l)if(0===C.type){const l=C.clone();Z._attachedSubEmitters.push(l),l.particleSystem.start()}}}_onDispose(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),Z&&this.particles)for(const C of this.particles)if(C._attachedSubEmitters)for(let Z=C._attachedSubEmitters.length-1;Z>=0;Z-=1)C._attachedSubEmitters[Z].dispose();if(l&&this.activeSubSystems)for(let C=this.activeSubSystems.length-1;C>=0;C-=1)this.activeSubSystems[C].dispose();if(this._subEmitters&&this._subEmitters.length){for(let Z=0;Z<this._subEmitters.length;Z++)for(const l of this._subEmitters[Z])l.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Bl&&this.Bl.dispose&&this.Bl.dispose(!0)}static _Parse(Z,l,C,x){let b;b=C instanceof hZ.d?null:C;const W=(0,f.b)("BABYLON.Texture");if(W&&b&&(Z.texture?l.particleTexture=W.Parse(Z.texture,b,x):Z.textureName&&(l.particleTexture=new W(x+Z.textureName,b,!1,void 0===Z.invertY||Z.invertY),l.particleTexture.name=Z.textureName)),Z.emitterId||0===Z.emitterId||void 0!==Z.Bl?Z.emitterId&&b?l.Bl=b.getLastMeshById(Z.emitterId):l.Bl=B.ql.il(Z.Bl):l.Bl=B.ql.Zero(),l.isLocal=!!Z.isLocal,void 0!==Z.renderingGroupId&&(l.renderingGroupId=Z.renderingGroupId),void 0!==Z.isBillboardBased&&(l.isBillboardBased=Z.isBillboardBased),void 0!==Z.billboardMode&&(l.billboardMode=Z.billboardMode),void 0!==Z.useLogarithmicDepth&&(l.useLogarithmicDepth=Z.useLogarithmicDepth),Z.animations){for(let C=0;C<Z.animations.length;C++){const B=Z.animations[C],x=(0,f.b)("BABYLON.Animation");x&&l.animations.push(x.Parse(B))}l.beginAnimationOnStart=Z.beginAnimationOnStart,l.beginAnimationFrom=Z.beginAnimationFrom,l.beginAnimationTo=Z.beginAnimationTo,l.beginAnimationLoop=Z.beginAnimationLoop}if(Z.autoAnimate&&b&&b.beginAnimation(l,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),l.startDelay=0|Z.startDelay,l.minAngularSpeed=Z.minAngularSpeed,l.maxAngularSpeed=Z.maxAngularSpeed,l.minSize=Z.minSize,l.maxSize=Z.maxSize,Z.minScaleX&&(l.minScaleX=Z.minScaleX,l.maxScaleX=Z.maxScaleX,l.minScaleY=Z.minScaleY,l.maxScaleY=Z.maxScaleY),void 0!==Z.preWarmCycles&&(l.preWarmCycles=Z.preWarmCycles,l.preWarmStepOffset=Z.preWarmStepOffset),void 0!==Z.minInitialRotation&&(l.minInitialRotation=Z.minInitialRotation,l.maxInitialRotation=Z.maxInitialRotation),l.minLifeTime=Z.minLifeTime,l.maxLifeTime=Z.maxLifeTime,l.minEmitPower=Z.minEmitPower,l.maxEmitPower=Z.maxEmitPower,l.emitRate=Z.emitRate,l.gravity=B.ql.il(Z.gravity),Z.noiseStrength&&(l.noiseStrength=B.ql.il(Z.noiseStrength)),l.color1=K.Rb.il(Z.color1),l.color2=K.Rb.il(Z.color2),l.colorDead=K.Rb.il(Z.colorDead),l.updateSpeed=Z.updateSpeed,l.targetStopDuration=Z.targetStopDuration,l.blendMode=Z.blendMode,Z.colorGradients)for(const B of Z.colorGradients)l.addColorGradient(B.gradient,K.Rb.il(B.color1),B.color2?K.Rb.il(B.color2):void 0);if(Z.rampGradients){for(const C of Z.rampGradients)l.addRampGradient(C.gradient,K.Sl.il(C.color));l.useRampGradients=Z.useRampGradients}if(Z.colorRemapGradients)for(const B of Z.colorRemapGradients)l.addColorRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(Z.alphaRemapGradients)for(const B of Z.alphaRemapGradients)l.addAlphaRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(Z.sizeGradients)for(const B of Z.sizeGradients)l.addSizeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(Z.angularSpeedGradients)for(const B of Z.angularSpeedGradients)l.addAngularSpeedGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(Z.velocityGradients)for(const B of Z.velocityGradients)l.addVelocityGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(Z.dragGradients)for(const B of Z.dragGradients)l.addDragGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(Z.emitRateGradients)for(const B of Z.emitRateGradients)l.addEmitRateGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(Z.startSizeGradients)for(const B of Z.startSizeGradients)l.addStartSizeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(Z.lifeTimeGradients)for(const B of Z.lifeTimeGradients)l.addLifeTimeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(Z.limitVelocityGradients){for(const C of Z.limitVelocityGradients)l.addLimitVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);l.limitVelocityDamping=Z.limitVelocityDamping}if(Z.noiseTexture&&b){const C=(0,f.b)("BABYLON.ProceduralTexture");l.noiseTexture=C.Parse(Z.noiseTexture,b,x)}let J;if(Z.particleEmitterType){switch(Z.particleEmitterType.type){case"SphereParticleEmitter":J=new S;break;case"SphereDirectedParticleEmitter":J=new i;break;case"ConeEmitter":case"ConeParticleEmitter":J=new G;break;case"ConeDirectedParticleEmitter":J=new a;break;case"CylinderParticleEmitter":J=new q;break;case"CylinderDirectedParticleEmitter":J=new z;break;case"HemisphericParticleEmitter":J=new Y;break;case"PointParticleEmitter":J=new P;break;case"MeshParticleEmitter":J=new n;break;case"CustomParticleEmitter":J=new s;break;default:J=new E}J.parse(Z.particleEmitterType,b)}else J=new E,J.parse(Z,b);l.particleEmitterType=J,l.startSpriteCellID=Z.startSpriteCellID,l.endSpriteCellID=Z.endSpriteCellID,l.spriteCellLoop=Z.spriteCellLoop??!0,l.spriteCellWidth=Z.spriteCellWidth,l.spriteCellHeight=Z.spriteCellHeight,l.spriteCellChangeSpeed=Z.spriteCellChangeSpeed,l.spriteRandomStartCell=Z.spriteRandomStartCell,l.disposeOnStop=Z.disposeOnStop??!1,l.manualEmitCount=Z.manualEmitCount??-1}static Parse(Z,l,C){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0;const f=Z.name;let W,J,d=null,E=null;if(l instanceof hZ.d?W=l:(J=l,W=J.getEngine()),Z.customShader&&W.createEffectForParticles){E=Z.customShader;const l=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"";d=W.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,l)}const G=new fl(f,b||Z.Ml,l,d,Z.isAnimationSheetEnabled);if(G.customShader=E,G._rootUrl=C,Z.id&&(G.id=Z.id),Z.subEmitters){G.subEmitters=[];for(const B of Z.subEmitters){const Z=[];for(const x of B)Z.push(QZ.Parse(x,l,C));G.subEmitters.push(Z)}}if(Z.attractors)for(const K of Z.attractors){const Z=new Kl;Z.position=B.ql.il(K.position),Z.strength=K.strength,G.addAttractor(Z)}return fl._Parse(Z,G,l,C),Z.textureMask&&(G.textureMask=K.Rb.il(Z.textureMask)),Z.xd&&(G.xd=B.ql.il(Z.xd)),Z.preventAutoStart&&(G.preventAutoStart=Z.preventAutoStart),x||G.preventAutoStart||G.start(),G}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l={};if(fl._Serialize(l,this,Z),l.textureMask=this.textureMask.Yb(),l.customShader=this.customShader,l.preventAutoStart=this.preventAutoStart,l.xd=this.xd.Yb(),this.subEmitters){l.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const C of this._subEmitters){const B=[];for(const l of C)B.push(l.serialize(Z));l.subEmitters.push(B)}}if(this._attractors&&this._attractors.length){l.attractors=[];for(const Z of this._attractors)l.attractors.push(Z.serialize())}return l}static _Serialize(Z,l,C){if(Z.name=l.name,Z.id=l.id,Z.Ml=l.getCapacity(),Z.disposeOnStop=l.disposeOnStop,Z.manualEmitCount=l.manualEmitCount,l.Bl.position){const C=l.Bl;Z.emitterId=C.id}else{const C=l.Bl;Z.Bl=C.Yb()}l.particleEmitterType&&(Z.particleEmitterType=l.particleEmitterType.serialize()),l.particleTexture&&(C?Z.texture=l.particleTexture.serialize():(Z.textureName=l.particleTexture.name,Z.invertY=!!l.particleTexture._invertY)),Z.isLocal=l.isLocal,V.b.AppendSerializedAnimations(l,Z),Z.beginAnimationOnStart=l.beginAnimationOnStart,Z.beginAnimationFrom=l.beginAnimationFrom,Z.beginAnimationTo=l.beginAnimationTo,Z.beginAnimationLoop=l.beginAnimationLoop,Z.startDelay=l.startDelay,Z.renderingGroupId=l.renderingGroupId,Z.isBillboardBased=l.isBillboardBased,Z.billboardMode=l.billboardMode,Z.minAngularSpeed=l.minAngularSpeed,Z.maxAngularSpeed=l.maxAngularSpeed,Z.minSize=l.minSize,Z.maxSize=l.maxSize,Z.minScaleX=l.minScaleX,Z.maxScaleX=l.maxScaleX,Z.minScaleY=l.minScaleY,Z.maxScaleY=l.maxScaleY,Z.minEmitPower=l.minEmitPower,Z.maxEmitPower=l.maxEmitPower,Z.minLifeTime=l.minLifeTime,Z.maxLifeTime=l.maxLifeTime,Z.emitRate=l.emitRate,Z.gravity=l.gravity.Yb(),Z.noiseStrength=l.noiseStrength.Yb(),Z.color1=l.color1.Yb(),Z.color2=l.color2.Yb(),Z.colorDead=l.colorDead.Yb(),Z.updateSpeed=l.updateSpeed,Z.targetStopDuration=l.targetStopDuration,Z.blendMode=l.blendMode,Z.preWarmCycles=l.preWarmCycles,Z.preWarmStepOffset=l.preWarmStepOffset,Z.minInitialRotation=l.minInitialRotation,Z.maxInitialRotation=l.maxInitialRotation,Z.startSpriteCellID=l.startSpriteCellID,Z.spriteCellLoop=l.spriteCellLoop,Z.endSpriteCellID=l.endSpriteCellID,Z.spriteCellChangeSpeed=l.spriteCellChangeSpeed,Z.spriteCellWidth=l.spriteCellWidth,Z.spriteCellHeight=l.spriteCellHeight,Z.spriteRandomStartCell=l.spriteRandomStartCell,Z.isAnimationSheetEnabled=l.isAnimationSheetEnabled,Z.useLogarithmicDepth=l.useLogarithmicDepth;const B=l.getColorGradients();if(B){Z.colorGradients=[];for(const l of B){const C={gradient:l.gradient,color1:l.color1.Yb()};l.color2?C.color2=l.color2.Yb():C.color2=l.color1.Yb(),Z.colorGradients.push(C)}}const x=l.getRampGradients();if(x){Z.rampGradients=[];for(const l of x){const C={gradient:l.gradient,color:l.color.Yb()};Z.rampGradients.push(C)}Z.useRampGradients=l.useRampGradients}const b=l.getColorRemapGradients();if(b){Z.colorRemapGradients=[];for(const l of b){const C={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?C.factor2=l.factor2:C.factor2=l.factor1,Z.colorRemapGradients.push(C)}}const K=l.getAlphaRemapGradients();if(K){Z.alphaRemapGradients=[];for(const l of K){const C={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?C.factor2=l.factor2:C.factor2=l.factor1,Z.alphaRemapGradients.push(C)}}const f=l.getSizeGradients();if(f){Z.sizeGradients=[];for(const l of f){const C={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?C.factor2=l.factor2:C.factor2=l.factor1,Z.sizeGradients.push(C)}}const W=l.getAngularSpeedGradients();if(W){Z.angularSpeedGradients=[];for(const l of W){const C={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?C.factor2=l.factor2:C.factor2=l.factor1,Z.angularSpeedGradients.push(C)}}const J=l.getVelocityGradients();if(J){Z.velocityGradients=[];for(const l of J){const C={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?C.factor2=l.factor2:C.factor2=l.factor1,Z.velocityGradients.push(C)}}const d=l.getDragGradients();if(d){Z.dragGradients=[];for(const l of d){const C={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?C.factor2=l.factor2:C.factor2=l.factor1,Z.dragGradients.push(C)}}const E=l.getEmitRateGradients();if(E){Z.emitRateGradients=[];for(const l of E){const C={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?C.factor2=l.factor2:C.factor2=l.factor1,Z.emitRateGradients.push(C)}}const G=l.getStartSizeGradients();if(G){Z.startSizeGradients=[];for(const l of G){const C={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?C.factor2=l.factor2:C.factor2=l.factor1,Z.startSizeGradients.push(C)}}const a=l.getLifeTimeGradients();if(a){Z.lifeTimeGradients=[];for(const l of a){const C={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?C.factor2=l.factor2:C.factor2=l.factor1,Z.lifeTimeGradients.push(C)}}const q=l.getLimitVelocityGradients();if(q){Z.limitVelocityGradients=[];for(const l of q){const C={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?C.factor2=l.factor2:C.factor2=l.factor1,Z.limitVelocityGradients.push(C)}Z.limitVelocityDamping=l.limitVelocityDamping}l.noiseTexture&&(Z.noiseTexture=l.noiseTexture.serialize())}clone(Z,l){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B={...this._customWrappers};let x=null;const b=this._engine;if(b.createEffectForParticles&&null!=this.customShader){x=this.customShader;const Z=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"",l=b.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,Z);B[0]?B[0].effect=l:this.setCustomEffect(l,0)}const K=this.serialize(C),f=fl.Parse(K,this._scene||this._engine,this._rootUrl);return f.name=Z,f.customShader=x,f._customWrappers=B,void 0===l&&(l=this.Bl),this.noiseTexture&&(f.noiseTexture=this.noiseTexture.clone()),f.Bl=l,this.preventAutoStart||f.start(),f}}fl.BILLBOARDMODE_Y=2,fl.BILLBOARDMODE_ALL=7,fl.BILLBOARDMODE_STRETCHED=8,fl.BILLBOARDMODE_STRETCHED_LOCAL=9,QZ._ParseParticleSystem=fl.Parse;var Wl=C(12713),Jl=C(12704),dl=C(12589);dl.d.prototype.createTransformFeedback=function(){const Z=this._gl.createTransformFeedback();if(!Z)throw new Error("Unable to create Transform Feedback");return Z},dl.d.prototype.deleteTransformFeedback=function(Z){this._gl.deleteTransformFeedback(Z)},dl.d.prototype.bindTransformFeedback=function(Z){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,Z)},dl.d.prototype.beginTransformFeedback=function(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(Z?this._gl.POINTS:this._gl.TRIANGLES)},dl.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},dl.d.prototype.setTranformFeedbackVaryings=function(Z,l){this._gl.transformFeedbackVaryings(Z,l,this._gl.INTERLEAVED_ATTRIBS)},dl.d.prototype.bindTransformFeedbackBuffer=function(Z){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Z?Z.underlyingResource:null)},dl.d.prototype.readTransformFeedbackBuffer=function(Z){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Z)};const El="clipPlaneFragmentDeclaration2",Gl="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";U.b.IncludesShadersStore[El]||(U.b.IncludesShadersStore[El]=Gl);C(13432),C(13436),C(13441),C(13445),C(13447),C(13455),C(13461),C(13465);const al="gpuRenderParticlesPixelShader",ql="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";U.b.ShadersStore[al]||(U.b.ShadersStore[al]=ql);const zl="clipPlaneVertexDeclaration2",Yl="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";U.b.IncludesShadersStore[zl]||(U.b.IncludesShadersStore[zl]=Yl);C(13468),C(13475),C(13478),C(13486);const Pl="gpuRenderParticlesVertexShader",Sl="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";U.b.ShadersStore[Pl]||(U.b.ShadersStore[Pl]=Sl);class il extends W{static get IsSupported(){if(!N.b.LastCreatedEngine)return!1;const Z=N.b.LastCreatedEngine.getCaps();return Z.supportTransformFeedbacks||Z.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(Z){this._maxActiveParticleCount=Math.min(Z,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(Z){this.maxActiveParticleCount=Z}createPointEmitter(Z,l){const C=AZ(Z,l);return this.particleEmitterType=C,C}createHemisphericEmitter(){const Z=LZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createSphereEmitter(){const Z=pZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createDirectedSphereEmitter(){const Z=NZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.ql(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.ql(0,1,0));return this.particleEmitterType=Z,Z}createCylinderEmitter(){const Z=ml(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Z,Z}createDirectedCylinderEmitter(){const Z=Zl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.ql(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.ql(0,1,0));return this.particleEmitterType=Z,Z}createConeEmitter(){const Z=ll(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Z,Z}createDirectedConeEmitter(){const Z=Cl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.ql(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.ql(0,1,0));return this.particleEmitterType=Z,Z}createBoxEmitter(Z,l,C,B){const x=new E;return this.particleEmitterType=x,this.direction1=Z,this.direction2=l,this.minEmitBox=C,this.maxEmitBox=B,x}get flowMap(){return this._flowMap}set flowMap(Z){this._flowMap!==Z&&(this._flowMap=Z)}isReady(){if(!this.Bl||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==fl.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(fl.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(fl.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";Z?setTimeout((()=>{this.start(0)}),Z):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var Z;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._customWrappers[l])||void 0===Z?void 0:Z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Z]??this._customWrappers[0]}setCustomEffect(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[l]=new ZZ.d(this._engine),this._customWrappers[l].effect=Z}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new L.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(Z,l,C){return super._removeGradientAndTexture(Z,l,C),this._releaseBuffers(),this}addColorGradient(Z,l){this._colorGradients||(this._colorGradients=[]);const C=new H(Z,l);return this._colorGradients.push(C),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(Z&&this._colorGradients.sort(((Z,l)=>Z.gradient<l.gradient?-1:Z.gradient>l.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(Z){return this._removeGradientAndTexture(Z,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const l in this._drawWrappers){var Z;null===(Z=this._drawWrappers[l].drawContext)||void 0===Z||Z.reset()}}_addFactorGradient(Z,l,C){const B=new h(l,C);Z.push(B),this._releaseBuffers()}addSizeGradient(Z,l){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,Z,l),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(Z){return this._removeGradientAndTexture(Z,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(Z,l){if(!Z)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&Z.sort(((Z,l)=>Z.gradient<l.gradient?-1:Z.gradient>l.gradient?1:0));const C=this;C[l]&&(C[l].dispose(),C[l]=null)}addAngularSpeedGradient(Z,l){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,Z,l),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(Z){return this._removeGradientAndTexture(Z,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(Z,l){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,Z,l),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(Z){return this._removeGradientAndTexture(Z,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(Z,l){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,Z,l),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(Z){return this._removeGradientAndTexture(Z,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(Z,l){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,Z,l),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(Z){return this._removeGradientAndTexture(Z,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(Z){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(Z,l,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(Z),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.xb=new L.b,this.onStoppedObservable=new L.b,this.onStartedObservable=new L.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=B.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||N.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ka.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,f.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,f.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,f.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,f.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ZZ.d(this._engine)},this._customWrappers[0].effect=x,this._drawWrappers={0:new ZZ.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(l=l??{}).randomTextureSize||delete l.randomTextureSize;const K={Ml:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...l},W=l;isFinite(W)&&(K.Ml=W),this._capacity=K.Ml,this._maxActiveParticleCount=K.Ml,this._currentActiveCount=0,this._isAnimationSheetEnabled=b,this.particleEmitterType=new E;const J=Math.min(this._engine.getCaps().maxTextureSize,K.randomTextureSize);let d=[];for(let B=0;B<J;++B)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());this._randomTexture=new p.e(new Float32Array(d),J,1,5,C,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,d=[];for(let B=0;B<J;++B)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());this._randomTexture2=new p.e(new Float32Array(d),J,1,5,C,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=J}_reset(){this._releaseBuffers()}_createVertexBuffers(Z,l,C){const B={};B.position=l.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let x=3;B.age=l.createVertexBuffer("age",x,1,this._attributesStrideSize,!0),x+=1,B.size=l.createVertexBuffer("size",x,3,this._attributesStrideSize,!0),x+=3,B.life=l.createVertexBuffer("life",x,1,this._attributesStrideSize,!0),x+=1,x+=4,this.billboardMode===fl.BILLBOARDMODE_STRETCHED&&(B.direction=l.createVertexBuffer("direction",x,3,this._attributesStrideSize,!0)),x+=3,this._platform.alignDataInBuffer&&(x+=1),this.particleEmitterType instanceof s&&(x+=3,this._platform.alignDataInBuffer&&(x+=1)),this._colorGradientsTexture||(B.color=l.createVertexBuffer("color",x,4,this._attributesStrideSize,!0),x+=4),this._isBillboardBased||(B.initialDirection=l.createVertexBuffer("initialDirection",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1)),this.noiseTexture&&(B.noiseCoordinates1=l.createVertexBuffer("noiseCoordinates1",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1),B.noiseCoordinates2=l.createVertexBuffer("noiseCoordinates2",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1)),B.angle=l.createVertexBuffer("angle",x,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?x++:x+=2,this._isAnimationSheetEnabled&&(B.cellIndex=l.createVertexBuffer("cellIndex",x,1,this._attributesStrideSize,!0),x+=1,this.spriteRandomStartCell&&(B.cellStartOffset=l.createVertexBuffer("cellStartOffset",x,1,this._attributesStrideSize,!0),x+=1)),B.offset=C.createVertexBuffer("offset",0,2),B.uv=C.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(B),this._platform.createVertexBuffers(Z,B),this.resetDrawCache()}_initialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!Z)return;const l=this._engine,C=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof s&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const x=this.particleEmitterType instanceof s,b=B.TmpVectors.ql[0];let K=0;for(let B=0;B<this._capacity;B++)if(C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),x?(this.particleEmitterType.particleDestinationGenerator(B,null,b),C.push(b.x),C.push(b.y),C.push(b.z)):(C.push(0),C.push(0),C.push(0)),this._platform.alignDataInBuffer&&C.push(0),K+=16,x&&(this.particleEmitterType.particlePositionGenerator(B,null,b),C.push(b.x),C.push(b.y),C.push(b.z),this._platform.alignDataInBuffer&&C.push(0),K+=4),this._colorGradientsTexture||(C.push(0),C.push(0),C.push(0),C.push(0),K+=4),this.isBillboardBased||(C.push(0),C.push(0),C.push(0),this._platform.alignDataInBuffer&&C.push(0),K+=4),this.noiseTexture&&(C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),K+=8),C.push(0),K+=1,this._angularSpeedGradientsTexture||(C.push(0),K+=1),this._isAnimationSheetEnabled&&(C.push(0),K+=1,this.spriteRandomStartCell&&(C.push(0),K+=1)),this._platform.alignDataInBuffer){let Z=3-(K+3&3);for(K+=Z;Z-- >0;)C.push(0)}const f=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),W=this._platform.createParticleBuffer(C),J=this._platform.createParticleBuffer(C);this._buffer0=new F.d(l,W,!1,this._attributesStrideSize),this._buffer1=new F.d(l,J,!1,this._attributesStrideSize),this._spriteBuffer=new F.d(l,f,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let Z=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(Z+="\n#define BILLBOARD"),this._colorGradientsTexture&&(Z+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(Z+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(Z+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(Z+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(Z+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(Z+="\n#define DRAGGRADIENTS"),this._flowMap&&(Z+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(Z+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(Z+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(Z+="\n#define NOISE"),this.isLocal&&(Z+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===Z||(this._cachedUpdateDefines=Z,this._updateBuffer=this._platform.createUpdateBuffer(Z)),this._platform.isUpdateBufferReady()}_getWrapper(Z){const l=this._getCustomDrawWrapper(Z);if(null!==l&&void 0!==l&&l.effect)return l;const C=[];this.fillDefines(C,Z);let B=this._drawWrappers[Z];B||(B=new ZZ.d(this._engine),B.drawContext&&(B.drawContext.useInstancing=!0),this._drawWrappers[Z]=B);const x=C.join("\n");if(B.defines!==x){const Z=[],l=[],C=[];this.fillUniformsAttributesAndSamplerNames(l,Z,C),B.setEffect(this._engine.createEffect("gpuRenderParticles",Z,l,C,x),x)}return B}static _GetAttributeNamesOrOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const x=[F.h.PositionKind,"age","life","size","angle"];return Z||x.push(F.h.ColorKind),l&&x.push("cellIndex"),C||x.push("initialDirection"),B&&x.push("direction"),x.push("offset",F.h.UVKind),x}static _GetEffectCreationOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=["emitterWM","xd","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,lZ.b)(B),Z&&B.push("sheetInfos"),l&&B.push("logarithmicDepthConstant"),C&&(B.push("vFogInfos"),B.push("vFogColor")),B}fillDefines(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,lZ.h)(this,this._scene,Z),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Jl.e.FOGMODE_NONE&&Z.push("#define FOG")),l===fl.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this.isLocal&&Z.push("#define LOCAL"),this.useLogarithmicDepth&&Z.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case fl.BILLBOARDMODE_Y:Z.push("#define BILLBOARDY");break;case fl.BILLBOARDMODE_STRETCHED:Z.push("#define BILLBOARDSTRETCHED");break;case fl.BILLBOARDMODE_ALL:Z.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&Z.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Z,l,C){l.push(...il._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===fl.BILLBOARDMODE_STRETCHED)),Z.push(...il._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Wl.d.PrepareUniforms(Z,this._imageProcessingConfigurationDefines),Wl.d.PrepareSamplers(C,this._imageProcessingConfigurationDefines))}animate(){var Z;let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(l?this.preWarmStepOffset:(null===(Z=this._scene)||void 0===Z?void 0:Z.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(Z,l){const C=this[l];if(!Z||!Z.length||C)return;const B=new Float32Array(this._rawTextureWidth);for(let x=0;x<this._rawTextureWidth;x++){const l=x/this._rawTextureWidth;A.GetCurrentGradient(l,Z,((Z,l,C)=>{B[x]=(0,J.Lerp)(Z.factor1,l.factor1,C)}))}this[l]=p.e.CreateRTexture(B,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[l].name=l.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const Z=new Uint8Array(4*this._rawTextureWidth),l=K.TmpColors.Rb[0];for(let C=0;C<this._rawTextureWidth;C++){const B=C/this._rawTextureWidth;A.GetCurrentGradient(B,this._colorGradients,((B,x,b)=>{K.Rb.LerpToRef(B.color1,x.color1,b,l),Z[4*C]=255*l.r,Z[4*C+1]=255*l.g,Z[4*C+2]=255*l.b,Z[4*C+3]=255*l.a}))}this._colorGradientsTexture=p.e.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(Z,l){var C,x,b,K;const f=this._getWrapper(Z),W=f.effect;this._engine.enableEffect(f);const J=(null===(C=this._scene)||void 0===C?void 0:C.getViewMatrix())||B.Matrix.IdentityReadOnly;if(W.setMatrix("view",J),W.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),W.setTexture("diffuseSampler",this.particleTexture),W.setVector2("translationPivot",this.translationPivot),W.setVector3("xd",this.xd),this.isLocal&&W.setMatrix("emitterWM",l),this._colorGradientsTexture?W.setTexture("colorGradientSampler",this._colorGradientsTexture):W.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const Z=this.particleTexture.getBaseSize();W.setFloat3("sheetInfos",this.spriteCellWidth/Z.width,this.spriteCellHeight/Z.height,Z.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const Z=this._scene.activeCamera;W.setVector3("eyePosition",Z.globalPosition)}const d=W.defines;if(this._scene&&((0,lZ.d)(W,this,this._scene),this.applyFog&&(0,CZ.f)(this._scene,void 0,W)),d.indexOf("#define BILLBOARDMODE_ALL")>=0){const Z=J.clone();Z.invert(),W.setMatrix("invView",Z)}return this.useLogarithmicDepth&&this._scene&&(0,CZ.j)(d,W,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(W),this._setEngineBasedOnBlendMode(Z),this._platform.bindDrawBuffers(this._targetIndex,W,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(W),null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(K=this._scene)&&void 0!==K&&K.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(Z){if(!this.Bl||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!Z)if(this.Bl.position){Z=this.Bl.getWorldMatrix()}else{const l=this.Bl;Z=B.TmpVectors.Matrix[0],B.Matrix.TranslationToRef(l.x,l.y,l.z,Z)}const l=this._engine,C=l.getDepthWrite();if(l.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const Z=this.cZ();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",Z.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",Z),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const x=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=x,l.setDepthWrite(C)}render(){let Z,l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!l&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const Z=0|this._accumulatedCount;this._accumulatedCount-=Z,this._currentActiveCount+=Z}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Bl.position){Z=this.Bl.getWorldMatrix()}else{const l=this.Bl;Z=B.TmpVectors.Matrix[0],B.Matrix.TranslationToRef(l.x,l.y,l.z,Z)}const x=this._engine;this.updateInAnimate||this._update(Z);let b=0;return l||C||(x.setState(!1),this.forceDepthWrite&&x.setDepthWrite(!0),b=this.blendMode===fl.BLENDMODE_MULTIPLYADD?this._render(fl.BLENDMODE_MULTIPLY,Z)+this._render(fl.BLENDMODE_ADD,Z):this._render(this.blendMode,Z),this._engine.setAlphaMode(0)),b}rebuild(){const Z=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(Z,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,Z()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const l in this._drawWrappers){this._drawWrappers[l].dispose()}if(this._drawWrappers={},this._scene){const Z=this._scene.Ka.indexOf(this);Z>-1&&this._scene.Ka.splice(Z,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let l=0;l<this._renderVertexBuffers.length;++l){const Z=this._renderVertexBuffers[l];for(const l in Z)Z[l].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.xb.notifyObservers(this),this.xb.clear()}clone(Z,l){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B={...this._customWrappers};let x=null;const b=this._engine;if(b.createEffectForParticles&&null!=this.customShader){x=this.customShader;const Z=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"";B[0]=b.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,Z,void 0,void 0,void 0,this)}const K=this.serialize(C),f=il.Parse(K,this._scene||this._engine,this._rootUrl);return f.name=Z,f.customShader=x,f._customWrappers=B,void 0===l&&(l=this.Bl),this.noiseTexture&&(f.noiseTexture=this.noiseTexture.clone()),f.Bl=l,f}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l={};return fl._Serialize(l,this,Z),l.activeParticleCount=this.activeParticleCount,l.randomTextureSize=this._randomTextureSize,l.customShader=this.customShader,l}static Parse(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0;const b=Z.name;let K,f;l instanceof hZ.d?K=l:(f=l,K=f.getEngine());const W=new il(b,{Ml:x||Z.Ml,randomTextureSize:Z.randomTextureSize},l,null,Z.isAnimationSheetEnabled);if(W._rootUrl=C,Z.customShader&&K.createEffectForParticles){const l=Z.customShader,C=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"",B=K.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,C,void 0,void 0,void 0,W);W.setCustomEffect(B,0),W.customShader=l}return Z.id&&(W.id=Z.id),Z.activeParticleCount&&(W.activeParticleCount=Z.activeParticleCount),fl._Parse(Z,W,l,C),Z.preventAutoStart&&(W.preventAutoStart=Z.preventAutoStart),B||W.preventAutoStart||W.start(),W}}var sl=C(12248),Fl=C(13492),nl=C(12811);class cl{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(Z){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const l of this.systems)l.Bl=Z;this._emitterNode=Z}setEmitterAsSphere(Z,l,C){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:Z,renderingGroupId:l};const B=(0,Fl.c)("emitterSphere",{diameter:Z.diameter,segments:Z.segments},C);B.renderingGroupId=l;const x=new nl.Pl("emitterSphereMaterial",C);x.emissiveColor=Z.color,B.material=x;for(const b of this.systems)b.Bl=B;this._emitterNode=B}start(Z){for(const l of this.systems)Z&&(l.Bl=Z),l.start()}dispose(){for(const Z of this.systems)Z.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l={systems:[]};for(const C of this.systems)l.systems.push(C.serialize(Z));return this._emitterNode&&(l.Bl=this._emitterCreationOptions),l}static Parse(Z,l){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;const x=new cl,b=this.BaseAssetsUrl+"/textures/";l=l||N.b.LastCreatedScene;for(const K of Z.systems)x.systems.push(C?il.Parse(K,l,b,!0,B):fl.Parse(K,l,b,!0,B));if(Z.Bl){const C=Z.Bl.options;if("Sphere"===Z.Bl.kind)x.setEmitterAsSphere({diameter:C.diameter,segments:C.segments,color:K.Sl.il(C.color)},Z.Bl.renderingGroupId,l)}return x}}cl.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Ul=C(12288);class tl{static CreateDefault(Z){let l,C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,B=arguments.length>2?arguments[2]:void 0;l=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new il("default system",{Ml:C},B):new fl("default system",C,B),l.Bl=Z;const x=sl.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return l.particleTexture=new g.c(x,l.cZ()),l.createConeEmitter(.1,Math.PI/4),l.color1=new K.Rb(1,1,1,1),l.color2=new K.Rb(1,1,1,1),l.colorDead=new K.Rb(1,1,1,0),l.minSize=.1,l.maxSize=.1,l.minEmitPower=2,l.maxEmitPower=2,l.updateSpeed=1/60,l.emitRate=30,l}static CreateAsync(Z,l){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;l||(l=N.b.LastCreatedScene);const x={};return l.addPendingData(x),new Promise(((b,K)=>{if(C&&!il.IsSupported)return l.removePendingData(x),K("Particle system with GPU is not supported.");sl.Tools.LoadFile(`${tl.BaseAssetsUrl}/systems/${Z}.json`,(Z=>{l.removePendingData(x);const K=JSON.parse(Z.toString());return b(cl.Parse(K,l,C,B))}),void 0,void 0,void 0,(()=>(l.removePendingData(x),K(`An error occurred with the creation of your particle system. Check if your type '${Z}' exists.`))))}))}static ExportSet(Z){const l=new cl;for(const C of Z)l.systems.push(C);return l}static ParseFromFileAsync(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",b=arguments.length>5?arguments[5]:void 0;return new Promise(((K,f)=>{const W=new Ul.c;W.addEventListener("readystatechange",(()=>{if(4==W.readyState)if(200==W.status){const l=JSON.parse(W.responseText);let f;f=B?il.Parse(l,C,x,!1,b):fl.Parse(l,C,x,!1,b),Z&&(f.name=Z),K(f)}else f("Unable to load the particle system")})),W.open("GET",l),W.send()}))}static ParseFromSnippetAsync(Z,l){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",x=arguments.length>4?arguments[4]:void 0;if("_BLANK"===Z){const Z=this.CreateDefault(null);return Z.start(),Promise.resolve(Z)}return new Promise(((b,K)=>{const f=new Ul.c;f.addEventListener("readystatechange",(()=>{if(4==f.readyState)if(200==f.status){const K=JSON.parse(JSON.parse(f.responseText).jsonPayload),W=JSON.parse(K.particleSystem);let J;J=C?il.Parse(W,l,B,!1,x):fl.Parse(W,l,B,!1,x),J.snippetId=Z,b(J)}else K("Unable to load the snippet "+Z)})),f.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),f.send()}))}}tl.BaseAssetsUrl=cl.BaseAssetsUrl,tl.SnippetUrl="https://snippet.babylonjs.com",tl.CreateFromSnippetAsync=tl.ParseFromSnippetAsync;var rl=C(12874),el=C(12735),ol=C(13499);(0,ol.i)(el.d.NAME_PARTICLESYSTEM,((Z,l,C,B)=>{const x=(0,ol.m)(el.d.NAME_PARTICLESYSTEM);if(x&&void 0!==Z.Ka&&null!==Z.Ka)for(let b=0,K=Z.Ka.length;b<K;b++){const K=Z.Ka[b];C.Ka.push(x(K,l,B))}})),(0,ol.e)(el.d.NAME_PARTICLESYSTEM,((Z,l,C)=>{if(Z.activeParticleCount){return il.Parse(Z,l,C)}return fl.Parse(Z,l,C)})),hZ.d.prototype.createEffectForParticles=function(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",b=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0,W=arguments.length>7?arguments[7]:void 0,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=arguments.length>9?arguments[9]:void 0,E=[],G=[];const a=[];return W?W.fillUniformsAttributesAndSamplerNames(G,E,a):(E=fl._GetAttributeNamesOrOptions(),G=fl._GetEffectCreationOptions()),-1===x.indexOf(" BILLBOARD")&&(x+="\n#define BILLBOARD\n"),null!==W&&void 0!==W&&W.isAnimationSheetEnabled&&-1===x.indexOf(" ANIMATESHEET")&&(x+="\n#define ANIMATESHEET\n"),-1===B.indexOf("diffuseSampler")&&B.push("diffuseSampler"),this.createEffect({vertex:d??(null===W||void 0===W?void 0:W.vertexShaderName)??"particles",fragmentElement:Z},E,G.concat(l),a.concat(B),x,b,K,f,void 0,J,(async()=>{0===J?await Promise.resolve().then(C.bind(C,13533)):await Promise.resolve().then(C.bind(C,13599))}))},rl.b.prototype.getEmittedParticleSystems=function(){const Z=[];for(let l=0;l<this.cZ().Ka.length;l++){const C=this.cZ().Ka[l];C.Bl===this&&Z.push(C)}return Z},rl.b.prototype.getHierarchyEmittedParticleSystems=function(){const Z=[],l=this.getDescendants();l.push(this);for(let C=0;C<this.cZ().Ka.length;C++){const B=this.cZ().Ka[C],x=B.Bl;x.position&&-1!==l.indexOf(x)&&Z.push(B)}return Z};C(12781),C(12788),C(12855);C(12861),C(13506),C(12668),C(12771),C(12892);C(12660);var vl;C(13508),C(12463);!function(Z){Z[Z.Color=2]="Color",Z[Z.UV=1]="UV",Z[Z.Random=0]="Random",Z[Z.Stated=3]="Stated"}(vl||(vl={}));var Rl=C(12693);const kl=new B.ql(0,0,0),Vl=new B.ql(0,0,0),gl=new B.ql(0,0,0);class jl{constructor(Z,l,C){this.width=Z,this.height=l,this.data=C}processFlowable(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;if(!C)return;C instanceof B.Matrix?B.ql.TransformCoordinatesToRef(Z.position,C,gl):(gl.x=C.x,gl.y=C.y,gl.z=C.z);const x=.5*gl.x+.5,b=1-(.5*gl.y+.5),K=Math.floor(x*this.width),f=Math.floor(b*this.height);if(K<0||K>=this.width||f<0||f>=this.height)return;const W=4*(f*this.width+K),J=this.data[W]/255*2-1,d=this.data[W+1]/255*2-1,E=this.data[W+2]/255*2-1,G=this.data[W+3]/255;kl.set(J,d,E),kl.scaleToRef(l*G,Vl),Z.direction.addInPlace(Vl)}_processParticle(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;this.processFlowable(Z,l,C)}static async FromUrlAsync(Z){return await new Promise(((l,C)=>{const B=document.createElement("canvas"),x=B.getContext("2d");let b=null;const K=new Image;K.crossOrigin="anonymous",K.src=Z,K.onerror=l=>{C(new Error(`Failed to load image: ${Z} : ${l}`))},K.onload=()=>{B.width=K.width,B.height=K.height,x.drawImage(K,0,0),b=x.getImageData(0,0,B.width,B.height),l(new jl(B.width,B.height,b.data))}}))}static async ExtractFromTextureAsync(Z){return await new Promise(((l,C)=>{if(!Z.isReady())return void Z.onLoadObservable.addOnce((async()=>{try{const C=await this.ExtractFromTextureAsync(Z);l(C)}catch(B){C(B)}}));const B=Z.getSize();Rl.l.GetTextureDataAsync(Z,B.width,B.height).then((Z=>{l(new jl(B.width,B.height,new Uint8ClampedArray(Z)))})).catch(C)}))}}var Ml,Il,wl,Ol,Dl,yl,Xl,Tl,ul;!function(Z){Z[Z.Int=1]="Int",Z[Z.Float=2]="Float",Z[Z.Vector2=4]="Vector2",Z[Z.ql=8]="ql",Z[Z.Matrix=16]="Matrix",Z[Z.Particle=32]="Particle",Z[Z.Texture=64]="Texture",Z[Z.Rb=128]="Rb",Z[Z.FloatGradient=256]="FloatGradient",Z[Z.Vector2Gradient=512]="Vector2Gradient",Z[Z.Vector3Gradient=1024]="Vector3Gradient",Z[Z.Color4Gradient=2048]="Color4Gradient",Z[Z.System=4096]="System",Z[Z.AutoDetect=8192]="AutoDetect",Z[Z.BasedOnInput=16384]="BasedOnInput",Z[Z.Undefined=32768]="Undefined",Z[Z.All=65535]="All"}(Ml||(Ml={})),function(Z){Z[Z.Compatible=0]="Compatible",Z[Z.TypeIncompatible=1]="TypeIncompatible",Z[Z.HierarchyIssue=2]="HierarchyIssue"}(Il||(Il={})),function(Z){Z[Z.Input=0]="Input",Z[Z.Output=1]="Output"}(wl||(wl={}));class Hl{get direction(){return this._direction}get type(){if(this._type===Ml.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Ml.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(Z){this._type=Z}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((Z=>Z.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(Z,l,C){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Ml.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new L.b,this.onDisconnectionObservable=new L.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=l,this.name=Z,this._direction=C}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(Z){var l;return this.isConnected?null!==(l=this._connectedPoint)&&void 0!==l&&l._storedFunction?this._connectedPoint._storedFunction(Z):this._connectedPoint._storedValue:this.value}canConnectTo(Z){return 0===this.checkCompatibilityState(Z)}checkCompatibilityState(Z){const l=this._ownerBlock,C=Z.ownerBlock;if(this.type!==Z.type&&Z.innerType!==Ml.AutoDetect)return Z.acceptedConnectionPointTypes&&-1!==Z.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(Z.excludedConnectionPointTypes&&-1!==Z.excludedConnectionPointTypes.indexOf(this.type))return 1;let B=C,x=l;return 0===this.direction&&(B=l,x=C),B.isAnAncestorOf(x)?2:0}connectTo(Z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(Z))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${Z.ownerBlock.name}".${Z.name}`;return this._endpoints.push(Z),Z._connectedPoint=this,this.onConnectionObservable.notifyObservers(Z),Z.onConnectionObservable.notifyObservers(this),this}disconnectFrom(Z){const l=this._endpoints.indexOf(Z);return-1===l||(this._endpoints.splice(l,1),Z._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(Z),Z.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(Z){let l=1;for(;l<Ml.All;)Z&l||this.excludedConnectionPointTypes.push(l),l<<=1}serialize(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const l={};return l.name=this.name,l.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Yb?(l.valueType="BABYLON."+this.value.getClassName(),l.value=this.value.Yb()):(l.valueType="number",l.value=this.value)),Z&&this.connectedPoint&&(l.inputName=this.name,l.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,l.targetConnectionName=this.connectedPoint.name,l.isExposedOnFrame=!0,l.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(l.isExposedOnFrame=!0,l.exposedPortPosition=this.exposedPortPosition),l}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Ql{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(Z){this._name=Z}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(Z){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new L.b,this.xb=new L.b,this.onInputChangedObservable=new L.b,this.visibleOnFrame=!1,this._name=Z,this.uniqueId=j.e.UniqueId}_inputRename(Z){return Z}_outputRename(Z){return Z}isAnAncestorOf(Z){for(const l of this._outputs)if(l.hasEndpoints)for(const C of l.endpoints){if(C.ownerBlock===Z)return!0;if(C.ownerBlock.isAnAncestorOf(Z))return!0}return!1}isAnAncestorOfType(Z){if(this.getClassName()===Z)return!0;for(const l of this._outputs)if(l.hasEndpoints)for(const C of l.endpoints)if(C.ownerBlock.isAnAncestorOfType(Z))return!0;return!1}getInputByName(Z){const l=this._inputs.filter((l=>l.name===Z));return l.length?l[0]:null}_linkConnectionTypes(Z,l){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[l]._acceptedConnectionPointType=this._inputs[Z]:(this._inputs[Z]._linkedConnectionSource=this._inputs[l],this._inputs[Z]._isMainLinkSource=!0),this._inputs[l]._linkedConnectionSource=this._inputs[Z]}registerInput(Z,l){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0;const K=new Hl(Z,this,0);return K.type=l,K.isOptional=C,K.defaultValue=B,K.value=B,K.valueMin=x,K.valueMax=b,this._inputs.push(K),this.onInputChangedObservable.notifyObservers(K),this}registerOutput(Z,l,C){return(C=C??new Hl(Z,this,1)).type=l,this._outputs.push(C),this}_build(Z){}_customBuildStep(Z){}build(Z){if(this._buildId===Z.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((Z=>Z.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=Z.buildId;for(const l of this._inputs){if(!l.connectedPoint){l.isOptional||Z.notConnectedNonOptionalInputs.push(l);continue}const C=l.connectedPoint.ownerBlock;C&&C!==this&&!C.isSystem&&C.build(Z)}return this._customBuildStep(Z),Z.verbose&&M.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(Z),this.onBuildObservable.notifyObservers(this),!1}serialize(){const Z={};Z.customType="BABYLON."+this.getClassName(),Z.id=this.uniqueId,Z.name=this.name,Z.visibleOnFrame=this.visibleOnFrame,Z.inputs=[],Z.outputs=[];for(const l of this.inputs)Z.inputs.push(l.serialize());for(const l of this.outputs)Z.outputs.push(l.serialize(!1));return Z}_deserialize(Z){this._name=Z.name,this.comments=Z.comments,this.visibleOnFrame=!!Z.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(Z)}_deserializePortDisplayNamesAndExposedOnFrame(Z){const l=Z.inputs,C=Z.outputs;if(l)for(const B of l){const Z=this.inputs.find((Z=>Z.name===B.name));if(!Z)return;if(B.displayName&&(Z.displayName=B.displayName),B.isExposedOnFrame&&(Z.isExposedOnFrame=B.isExposedOnFrame,Z.exposedPortPosition=B.exposedPortPosition),void 0!==B.value&&null!==B.value)if("number"===B.valueType)Z.value=B.value;else{const l=(0,f.b)(B.valueType);l&&(Z.value=l.il(B.value))}}if(C)for(let B=0;B<C.length;B++){const Z=C[B];Z.displayName&&(this.outputs[B].displayName=Z.displayName),Z.isExposedOnFrame&&(this.outputs[B].isExposedOnFrame=Z.isExposedOnFrame,this.outputs[B].exposedPortPosition=Z.exposedPortPosition)}}clone(){const Z=this.serialize(),l=(0,f.b)(Z.customType);if(l){const C=new l;return C._deserialize(Z),C}return null}dispose(){this.xb.notifyObservers(this),this.xb.clear();for(const Z of this.inputs)Z.dispose();for(const Z of this.outputs)Z.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function hl(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",B=arguments.length>3?arguments[3]:void 0;return(x,b)=>{let K=x._propStore;K||(K=[],x._propStore=K),K.push({propertyName:b,displayName:Z,type:l,groupName:C,options:B??{},className:x.getClassName()})}}(0,R.b)([(0,k.R)("comment")],Ql.prototype,"comments",void 0),function(Z){Z[Z.Boolean=0]="Boolean",Z[Z.Float=1]="Float",Z[Z.Int=2]="Int",Z[Z.Vector2=3]="Vector2",Z[Z.List=4]="List",Z[Z.Rb=5]="Rb",Z[Z.SamplingMode=6]="SamplingMode",Z[Z.TextureFormat=7]="TextureFormat",Z[Z.TextureType=8]="TextureType"}(Ol||(Ol={})),function(Z){Z[Z.None=0]="None",Z[Z.Position=1]="Position",Z[Z.Direction=2]="Direction",Z[Z.Age=3]="Age",Z[Z.Lifetime=4]="Lifetime",Z[Z.Color=5]="Color",Z[Z.ScaledDirection=6]="ScaledDirection",Z[Z.Scale=7]="Scale",Z[Z.AgeGradient=8]="AgeGradient",Z[Z.Angle=9]="Angle",Z[Z.SpriteCellIndex=16]="SpriteCellIndex",Z[Z.SpriteCellStart=17]="SpriteCellStart",Z[Z.SpriteCellEnd=18]="SpriteCellEnd"}(Dl||(Dl={})),function(Z){Z[Z.None=0]="None",Z[Z.Time=1]="Time",Z[Z.Delta=2]="Delta",Z[Z.Emitter=3]="Emitter"}(yl||(yl={}));class Al{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let Z="";for(const l of this.notConnectedNonOptionalInputs)Z+=`input ${l.name} from block ${l.ownerBlock.name}[${l.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(Z)throw"Build of Node Particle System Set failed:\n"+Z}adapt(Z,l){const C=Z.getConnectedValue(this)||0;if(Z.type===l)return C;switch(l){case Ml.Vector2:return new B.Vector2(C,C);case Ml.ql:return new B.ql(C,C,C);case Ml.Rb:return new K.Rb(C,C,C,C)}return null}getContextualValue(Z){if(!this.particleContext||!this.systemContext)return null;switch(Z){case Dl.Position:return this.particleContext.position;case Dl.Direction:return this.particleContext.direction;case Dl.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Dl.Color:return this.particleContext.color;case Dl.Age:return this.particleContext.age;case Dl.Lifetime:return this.particleContext.lifeTime;case Dl.Angle:return this.particleContext.angle;case Dl.Scale:return this.particleContext.scale;case Dl.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Dl.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Dl.SpriteCellIndex:return this.particleContext.cellIndex;case Dl.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Bl.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Bl.absolutePosition:this.systemContext.Bl:null}getSystemValue(Z){if(!this.particleContext||!this.systemContext)return null;switch(Z){case yl.Time:return this.systemContext._actualFrame;case yl.Delta:return this.systemContext._scaledUpdateSpeed;case yl.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Bl.absolutePosition}return this.systemContext.Bl}return null}}function Ll(Z,l,C){const B=new Al;B.Yl=l;const x=Z.createSystem(B);return x.canStart=()=>!0,x.Bl=C.clone(),x.disposeOnStop=!0,x.start(),x}class pl extends Ql{constructor(Z){super(Z),this.blendMode=W.BLENDMODE_ONEONE,this.Ml=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Ml.Particle),this.registerInput("texture",Ml.Texture),this.registerInput("onStart",Ml.System,!0),this.registerInput("onEnd",Ml.System,!0),this.registerOutput("system",Ml.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(Z){Z.Ml=this.Ml,Z.buildId=this._buildId++,this.build(Z);const l=this.particle.getConnectedValue(Z);return l.particleTexture=this.texture.getConnectedValue(Z),l.emitRate=this.emitRate,l.blendMode=this.blendMode,l.name=this.name,l._nodeGenerated=!0,l._targetStopDuration=this.targetStopDuration,l.startDelay=this.startDelay,this.system._storedValue=this,l.canStart=()=>!this.doNoStart,l.onStartedObservable.add((C=>{const B=this.onStart.getConnectedValue(Z);B&&C.onStartedObservable.addOnce((()=>{Z.systemContext=l;const C=Ll(B,Z.Yl,Z.emitterPosition);this.xb.addOnce((()=>{C.dispose()}))}));const x=this.onEnd.getConnectedValue(Z);x&&C.onStoppedObservable.addOnce((()=>{Z.systemContext=l;const C=Ll(x,Z.Yl,Z.emitterPosition);this.xb.addOnce((()=>{C.dispose()}))}))})),this.xb.addOnce((()=>{l.dispose()})),l}serialize(){const Z=super.serialize();return Z.Ml=this.Ml,Z.emitRate=this.emitRate,Z.blendMode=this.blendMode,Z.doNoStart=this.doNoStart,Z.targetStopDuration=this.targetStopDuration,Z.startDelay=this.startDelay,Z}_deserialize(Z){super._deserialize(Z),this.Ml=Z.Ml,this.emitRate=Z.emitRate,this.doNoStart=!!Z.doNoStart,void 0!==Z.blendMode&&(this.blendMode=Z.blendMode),void 0!==Z.targetStopDuration&&(this.targetStopDuration=Z.targetStopDuration),void 0!==Z.startDelay&&(this.startDelay=Z.startDelay)}}(0,R.b)([hl("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:W.BLENDMODE_ONEONE},{label:"Standard",value:W.BLENDMODE_STANDARD},{label:"Add",value:W.BLENDMODE_ADD},{label:"Multiply",value:W.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:W.BLENDMODE_MULTIPLYADD}]})],pl.prototype,"blendMode",void 0),(0,R.b)([hl("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],pl.prototype,"Ml",void 0),(0,R.b)([hl("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pl.prototype,"emitRate",void 0),(0,R.b)([hl("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pl.prototype,"targetStopDuration",void 0),(0,R.b)([hl("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pl.prototype,"startDelay",void 0),(0,R.b)([hl("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],pl.prototype,"doNoStart",void 0),(0,f.c)("BABYLON.SystemBlock",pl);class Nl extends Ql{get type(){if(this._type===Ml.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Ml.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Ml.Vector2,this._type;case"ql":return this._type=Ml.ql,this._type;case"Rb":return this._type=Ml.Rb,this._type;case"Matrix":return this._type=Ml.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Dl.None&&this._systemSource!==yl.None}get systemSource(){return this._systemSource}set systemSource(Z){if(this._systemSource=Z,Z!==yl.None){switch(this._contextualSource=Dl.None,this._type=Ml.Float,Z){case yl.Time:case yl.Delta:this._type=Ml.Float;break;case yl.Emitter:this._type=Ml.ql}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Dl.None}get contextualValue(){return this._contextualSource}set contextualValue(Z){if(this._contextualSource=Z,Z!==Dl.None){switch(this._systemSource=yl.None,Z){case Dl.Scale:this._type=Ml.Vector2;break;case Dl.Position:case Dl.Direction:case Dl.ScaledDirection:this._type=Ml.ql;break;case Dl.Color:this._type=Ml.Rb;break;case Dl.Age:case Dl.Lifetime:case Dl.Angle:case Dl.AgeGradient:this._type=Ml.Float;break;case Dl.SpriteCellEnd:case Dl.SpriteCellStart:case Dl.SpriteCellIndex:this._type=Ml.Int}this.output&&(this.output.type=this._type)}}constructor(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ml.AutoDetect;super(Z),this._type=Ml.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new L.b,this._systemSource=yl.None,this._contextualSource=Dl.None,this._type=l,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",l)}get value(){return this._storedValue}set value(Z){this.type===Ml.Float&&this.min!==this.max&&(Z=Math.max(this.min,Z),Z=Math.min(this.max,Z)),this._storedValue=Z,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(Z){this._valueCallback=Z}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Ml.Int:case Ml.Float:this.value=0;break;case Ml.Vector2:this.value=B.Vector2.Zero();break;case Ml.ql:this.value=B.ql.Zero();break;case Ml.Rb:this.value=new K.Rb(1,1,1,1);break;case Ml.Matrix:this.value=B.Matrix.Identity()}}_build(Z){super._build(Z),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=Z=>Z.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=Z=>Z.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const Z=super.serialize();return Z.type=this.type,Z.contextualValue=this.contextualValue,Z.systemSource=this.systemSource,Z.min=this.min,Z.max=this.max,Z.groupInInspector=this.groupInInspector,Z.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Yb?(Z.valueType="BABYLON."+this._storedValue.getClassName(),Z.value=this._storedValue.Yb()):(Z.valueType="number",Z.value=this._storedValue)),Z}_deserialize(Z){if(super._deserialize(Z),this._type=Z.type,this.contextualValue=Z.contextualValue,this.systemSource=Z.systemSource||yl.None,this.min=Z.min||0,this.max=Z.max||0,this.groupInInspector=Z.groupInInspector||"",void 0!==Z.displayInInspector&&(this.displayInInspector=Z.displayInInspector),Z.valueType)if("number"===Z.valueType)this._storedValue=Z.value;else{const l=(0,f.b)(Z.valueType);l&&(this._storedValue=l.il(Z.value))}}}(0,f.c)("BABYLON.ParticleInputBlock",Nl);class mC extends Ql{get url(){return this._url}set url(Z){this._url!==Z&&(this._cachedData=null,this._url=Z,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(Z){this._textureDataUrl!==Z&&(this._cachedData=null,this._textureDataUrl=Z,this._url="",this._sourceTexture=null)}set sourceTexture(Z){this._sourceTexture!==Z&&(this._cachedData=null,this._sourceTexture=Z,this._url="",this._textureDataUrl="")}constructor(Z){super(Z),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Ml.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const Z=this.texture._storedValue;return await new Promise(((l,C)=>{if(!Z.isReady())return void Z.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),l(this._cachedData)}catch(Z){C(Z)}}));const B=Z.getSize();Rl.l.GetTextureDataAsync(Z,B.width,B.height).then((C=>{this._cachedData={width:B.width,height:B.height,data:new Uint8ClampedArray(C)},Z.dispose(),l(this._cachedData)})).catch(C)}))}_build(Z){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new g.c(this._textureDataUrl,Z.Yl):this.texture._storedValue=new g.c(this._url,Z.Yl):this.texture._storedValue=null}serialize(){const Z=super.serialize();return Z.url=this.url,Z.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(Z.textureDataUrl=this.textureDataUrl),Z}_deserialize(Z){super._deserialize(Z),this.url=Z.url,this.serializedCachedData=!!Z.serializedCachedData,Z.textureDataUrl&&(this.textureDataUrl=Z.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,f.c)("BABYLON.ParticleTextureSourceBlock",mC);class ZC extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerInput("position",Ml.ql),this.registerOutput("output",Ml.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(Z){const l=this.particle.getConnectedValue(Z);if(this.output._storedValue=l,!this.position.isConnected)return;const C={process:C=>{Z.particleContext=C,Z.systemContext=l,C.position.B(this.position.getConnectedValue(Z))},previousItem:null,nextItem:null};l._updateQueueStart?yZ(C,l._updateQueueStart):l._updateQueueStart=C}}(0,f.c)("BABYLON.UpdatePositionBlock",ZC),function(Z){Z[Z.Add=0]="Add",Z[Z.Subtract=1]="Subtract",Z[Z.Multiply=2]="Multiply",Z[Z.Divide=3]="Divide",Z[Z.Max=4]="Max",Z[Z.Min=5]="Min"}(Xl||(Xl={}));class lC extends Ql{constructor(Z){super(Z),this.operation=Xl.Add,this.registerInput("left",Ml.AutoDetect),this.registerInput("right",Ml.AutoDetect),this.registerOutput("output",Ml.BasedOnInput),this.output._typeConnectionSource=this.left;const l=[Ml.Matrix,Ml.Particle,Ml.Texture,Ml.System,Ml.FloatGradient,Ml.Color4Gradient,Ml.Vector2Gradient,Ml.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...l),this.right.excludedConnectionPointTypes.push(...l),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(Z){let l;const C=this.left,x=this.right;if(!C.isConnected||!x.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const b=C.type===Ml.Float||C.type===Ml.Int,f=x.type===Ml.Float||x.type===Ml.Int,W=b&&f;switch(this.operation){case Xl.Add:l=W?Z=>C.getConnectedValue(Z)+x.getConnectedValue(Z):b?Z=>Z.adapt(C,x.type).add(x.getConnectedValue(Z)):Z=>C.getConnectedValue(Z).add(Z.adapt(x,C.type));break;case Xl.Subtract:l=W?Z=>C.getConnectedValue(Z)-x.getConnectedValue(Z):b?Z=>Z.adapt(C,x.type).zl(x.getConnectedValue(Z)):Z=>C.getConnectedValue(Z).zl(Z.adapt(x,C.type));break;case Xl.Multiply:l=W?Z=>C.getConnectedValue(Z)*x.getConnectedValue(Z):b?Z=>Z.adapt(C,x.type).multiply(x.getConnectedValue(Z)):Z=>C.getConnectedValue(Z).multiply(Z.adapt(x,C.type));break;case Xl.Divide:l=W?Z=>C.getConnectedValue(Z)/x.getConnectedValue(Z):b?Z=>Z.adapt(C,x.type).divide(x.getConnectedValue(Z)):Z=>C.getConnectedValue(Z).divide(Z.adapt(x,C.type));break;case Xl.Min:if(W)l=Z=>Math.min(C.getConnectedValue(Z),x.getConnectedValue(Z));else{const[Z,f]=b?[x,C]:[C,x];switch(Z.type){case Ml.Vector2:l=l=>B.Vector2.Minimize(Z.getConnectedValue(l),l.adapt(f,Z.type));break;case Ml.ql:l=l=>B.ql.Minimize(Z.getConnectedValue(l),l.adapt(f,Z.type));break;case Ml.Rb:l=l=>{const C=Z.getConnectedValue(l),{r:B,g:x,b:b,a:W}=l.adapt(f,Z.type);return new K.Rb(Math.min(C.r,B),Math.min(C.g,x),Math.min(C.b,b),Math.min(C.a,W))}}}break;case Xl.Max:if(!W){const[Z,f]=b?[x,C]:[C,x];switch(Z.type){case Ml.Vector2:l=l=>B.Vector2.Maximize(Z.getConnectedValue(l),l.adapt(f,Z.type));break;case Ml.ql:l=l=>B.ql.Maximize(Z.getConnectedValue(l),l.adapt(f,Z.type));break;case Ml.Rb:l=l=>{const C=Z.getConnectedValue(l),{r:B,g:x,b:b,a:W}=l.adapt(f,Z.type);return new K.Rb(Math.max(C.r,B),Math.min(C.g,x),Math.min(C.b,b),Math.min(C.a,W))}}break}l=Z=>Math.max(C.getConnectedValue(Z),x.getConnectedValue(Z))}this.output._storedFunction=Z=>C.type===Ml.Int?0|l(Z):l(Z)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Ml.Int||this.left.type===Ml.Float&&this.right.type!==Ml.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[Z,l]of[[this.left,this.right],[this.right,this.left]])Z.acceptedConnectionPointTypes=[Ml.Int,Ml.Float],l.isConnected&&(Z.acceptedConnectionPointTypes.push(l.type),l.type!==Ml.Int&&l.type!==Ml.Float||Z.acceptedConnectionPointTypes.push(Ml.Vector2,Ml.ql,Ml.Rb))}dispose(){super.dispose();for(const Z of this._connectionObservers)Z.remove();this._connectionObservers.length=0}serialize(){const Z=super.serialize();return Z.operation=this.operation,Z}_deserialize(Z){super._deserialize(Z),this.operation=Z.operation}}(0,R.b)([hl("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Xl.Add},{label:"Subtract",value:Xl.Subtract},{label:"Multiply",value:Xl.Multiply},{label:"Divide",value:Xl.Divide},{label:"Max",value:Xl.Max},{label:"Min",value:Xl.Min}]})],lC.prototype,"operation",void 0),(0,f.c)("BABYLON.ParticleMathBlock",lC);class CC extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerInput("direction1",Ml.ql,!0,new B.ql(0,1,0)),this.registerInput("direction2",Ml.ql,!0,new B.ql(0,1,0)),this.registerInput("minEmitBox",Ml.ql,!0,new B.ql(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Ml.ql,!0,new B.ql(.5,.5,.5)),this.registerOutput("output",Ml.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Z){const l=this.particle.getConnectedValue(Z);l._directionCreation.process=C=>{Z.particleContext=C,Z.systemContext=l;const x=this.direction1.getConnectedValue(Z),b=this.direction2.getConnectedValue(Z),K=(0,J.RandomRange)(x.x,b.x),f=(0,J.RandomRange)(x.y,b.y),W=(0,J.RandomRange)(x.z,b.z);Z.isEmitterTransformNode?B.ql.TransformNormalFromFloatsToRef(K,f,W,Z.emitterWorldMatrix,C.direction):C.direction.rb(K,f,W)},l._positionCreation.process=C=>{Z.particleContext=C,Z.systemContext=l;const x=this.minEmitBox.getConnectedValue(Z),b=this.maxEmitBox.getConnectedValue(Z),K=(0,J.RandomRange)(x.x,b.x),f=(0,J.RandomRange)(x.y,b.y),W=(0,J.RandomRange)(x.z,b.z);Z.isEmitterTransformNode?B.ql.TransformCoordinatesFromFloatsToRef(K,f,W,Z.emitterWorldMatrix,C.position):(C.position.rb(K,f,W),C.position.addInPlace(Z.emitterPosition))},this.output._storedValue=l}}(0,f.c)("BABYLON.BoxShapeBlock",CC);class BC extends Ql{constructor(Z){super(Z),this.registerInput("emitPower",Ml.Float,!0,1),this.registerInput("lifeTime",Ml.Float,!0,1),this.registerInput("color",Ml.Rb,!0,new K.Rb(1,1,1,1)),this.registerInput("scale",Ml.Vector2,!0,new B.Vector2(1,1)),this.registerInput("angle",Ml.Float,!0,0),this.registerOutput("particle",Ml.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(Z){const l=new fl(this.name,Z.Ml,Z.Yl,null,!1,void 0,!0);l.particleEmitterType=new P,l._lifeTimeCreation.process=(l,C)=>{Z.particleContext=l,l.lifeTime=this.lifeTime.getConnectedValue(Z),C._emitPower=this.emitPower.getConnectedValue(Z)},l._colorCreation.process=l=>{Z.particleContext=l,l.color.B(this.color.getConnectedValue(Z))},l._sizeCreation.process=l=>{Z.particleContext=l,l.size=1,l.scale.B(this.scale.getConnectedValue(Z))},l._angleCreation.process=l=>{Z.particleContext=l,l.angle=this.angle.getConnectedValue(Z)},this.particle._storedValue=l}}(0,f.c)("BABYLON.CreateParticleBlock",BC);class xC{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const Z=[];for(const l of this.attachedBlocks)l.isInput&&Z.push(l);return Z}constructor(Z){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new L.b,this.name=Z}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(Z){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(Z)&&this.attachedBlocks.push(Z);for(const C of Z.inputs){const B=C.connectedPoint;if(B){const C=B.ownerBlock;C!==Z&&this._initializeBlock(C,l)}}}async buildAsync(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((C=>{const B=new cl;for(const Z of this._systemBlocks)this._initializeBlock(Z);for(const x of this.systemBlocks){const C=new Al;C.buildId=this._buildId++,C.Yl=Z,C.verbose=l;const b=x.createSystem(C);C.emitErrors(),B.systems.push(b)}this.onBuildObservable.notifyObservers(this),C(B)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const Z=new pl("Particle system"),l=new ZC("Update position");l.output.connectTo(Z.particle);const C=new Nl("Position");C.contextualValue=Dl.Position;const B=new Nl("Scaled direction");B.contextualValue=Dl.ScaledDirection;const x=new lC("Add");x.operation=Xl.Add,C.output.connectTo(x.left),B.output.connectTo(x.right),x.output.connectTo(l.position);const b=new BC("Create particle"),K=new CC("Box shape");b.particle.connectTo(K.particle),K.output.connectTo(l.particle);const f=new mC("Texture");f.texture.connectTo(Z.texture),f.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(Z)}removeBlock(Z){const l=this.attachedBlocks.indexOf(Z);if(l>-1&&this.attachedBlocks.splice(l,1),Z.isSystem){const l=this._systemBlocks.indexOf(Z);l>-1&&this._systemBlocks.splice(l,1)}}parseSerializedObject(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l||this.clear();const C={};for(const B of Z.UE){const Z=(0,f.b)(B.customType);if(Z){const l=new Z;l._deserialize(B),C[B.id]=l,this.attachedBlocks.push(l),l.isSystem&&this._systemBlocks.push(l)}}for(const B of this.attachedBlocks)if(B.isTeleportOut){const Z=B,l=Z._tempEntryPointUniqueId;if(l){const B=C[l];B&&B.attachToEndpoint(Z)}}for(let B=0;B<Z.UE.length;B++){const x=Z.UE[B],b=C[x.id];b&&(b.inputs.length&&x.inputs.some((Z=>Z.targetConnectionName))&&!l||this._restoreConnections(b,Z,C))}if(Z.locations||Z.editorData&&Z.editorData.locations){const B=Z.locations||Z.editorData.locations;for(const Z of B)C[Z.mB]&&(Z.mB=C[Z.mB].uniqueId);l&&this.editorData&&this.editorData.locations&&B.concat(this.editorData.locations),Z.locations?this.editorData={locations:B}:(this.editorData=Z.editorData,this.editorData.locations=B);const x=[];for(const Z in C)x[Z]=C[Z].uniqueId;this.editorData.map=x}this.comment=Z.comment}_restoreConnections(Z,l,C){for(const B of Z.outputs)for(const x of l.UE){const b=C[x.id];if(b)for(const K of x.inputs)if(C[K.targetBlockId]!==Z||K.targetConnectionName!==B.name);else{const Z=b.getInputByName(K.inputName);if(!Z||Z.isConnected)continue;B.connectTo(Z,!0),this._restoreConnections(b,l,C)}}}serialize(Z){const l=Z?{}:V.b.Serialize(this);l.editorData=JSON.parse(JSON.stringify(this.editorData));let C=[];Z?C=Z:l.customType="BABYLON.NodeParticleSystemSet",l.UE=[];for(const B of C)l.UE.push(B.serialize());if(!Z)for(const B of this.attachedBlocks)-1===C.indexOf(B)&&l.UE.push(B.serialize());return l}dispose(){for(const Z of this.attachedBlocks)Z.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(Z){const l=new xC(Z);return l.setToDefault(),l}static Parse(Z){const l=V.b.Parse((()=>new xC(Z.name)),Z,null);return l.parseSerializedObject(Z),l}static ParseFromSnippetAsync(Z,l){return"_BLANK"===Z?Promise.resolve(xC.CreateDefault("blank")):new Promise(((C,B)=>{const x=new Ul.c;x.addEventListener("readystatechange",(()=>{if(4==x.readyState)if(200==x.status){const K=JSON.parse(JSON.parse(x.responseText).jsonPayload),f=JSON.parse(K.nodeParticle);l||(l=V.b.Parse((()=>new xC(Z)),f,null)),l.parseSerializedObject(f),l.snippetId=Z;try{C(l)}catch(b){B(b)}}else B("Unable to load the snippet "+Z)})),x.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),x.send()}))}}xC.EditorURL=`${sl.Tools._DefaultCdnUrl}/v${hZ.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,xC.SnippetUrl="https://snippet.babylonjs.com",(0,R.b)([(0,k.R)()],xC.prototype,"name",void 0),(0,R.b)([(0,k.R)("comment")],xC.prototype,"comment",void 0),function(Z){Z[Z.None=0]="None",Z[Z.PerParticle=1]="PerParticle",Z[Z.PerSystem=2]="PerSystem"}(Tl||(Tl={}));class bC extends Ql{constructor(Z){super(Z),this._currentLockId=-2,this.lockMode=Tl.PerParticle,this.registerInput("min",Ml.AutoDetect,!0,0),this.registerInput("max",Ml.AutoDetect,!0,1),this.registerOutput("output",Ml.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ml.Float|Ml.Int|Ml.Vector2|Ml.ql|Ml.Rb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Ml.Float|Ml.Int|Ml.Vector2|Ml.ql|Ml.Rb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Ml.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let Z=null;switch(this._currentLockId=-2,this.min.type){case Ml.AutoDetect:case Ml.Int:case Ml.Float:Z=Z=>{const l=this.min.getConnectedValue(Z)||0,C=this.max.getConnectedValue(Z)||1;return l+Math.random()*(C-l)};break;case Ml.Vector2:Z=Z=>{const l=this.min.getConnectedValue(Z)||B.Vector2.Zero(),C=this.max.getConnectedValue(Z)||B.Vector2.One();return new B.Vector2(l.x+Math.random()*(C.x-l.x),l.y+Math.random()*(C.y-l.y))};break;case Ml.ql:Z=Z=>{const l=this.min.getConnectedValue(Z)||B.ql.Zero(),C=this.max.getConnectedValue(Z)||B.ql.One();return new B.ql(l.x+Math.random()*(C.x-l.x),l.y+Math.random()*(C.y-l.y),l.z+Math.random()*(C.z-l.z))};break;case Ml.Rb:Z=Z=>{const l=this.min.getConnectedValue(Z)||new K.Rb(0,0,0,0),C=this.max.getConnectedValue(Z)||new K.Rb(1,1,1,1);return new K.Rb(l.x+Math.random()*(C.x-l.x),l.y+Math.random()*(C.y-l.y),l.z+Math.random()*(C.z-l.z),l.w+Math.random()*(C.w-l.w))}}this.output._storedFunction=l=>{var C;let B=0;switch(this.lockMode){case Tl.PerParticle:B=(null===(C=l.particleContext)||void 0===C?void 0:C.id)||-1;break;case Tl.PerSystem:B=l.buildId||0}return this._currentLockId!==B&&(this.lockMode!==Tl.None&&(this._currentLockId=B),this.output._storedValue=Z(l)),this.output._storedValue}}serialize(){const Z=super.serialize();return Z.lockMode=this.lockMode,Z}_deserialize(Z){super._deserialize(Z),this.lockMode=Z.lockMode}}(0,R.b)([hl("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Tl.None},{label:"Per particle",value:Tl.PerParticle},{label:"Per system",value:Tl.PerSystem}]})],bC.prototype,"lockMode",void 0),(0,f.c)("BABYLON.ParticleRandomBlock",bC);class KC extends Ql{constructor(Z){super(Z),this._currentLockId=-2,this.lockMode=Tl.PerParticle,this.registerInput("min",Ml.AutoDetect),this.registerInput("max",Ml.AutoDetect),this.registerOutput("output",Ml.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const l=[Ml.Matrix,Ml.Particle,Ml.Texture,Ml.System,Ml.FloatGradient,Ml.Color4Gradient,Ml.Vector2Gradient,Ml.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...l),this.max.excludedConnectionPointTypes.push(...l)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let Z=null;switch(this._currentLockId=-2,this.min.type){case Ml.Float:case Ml.Int:Z=Z=>{const l=this.min.getConnectedValue(Z),C=this.max.getConnectedValue(Z);return Math.random()*(C-l)+l};break;case Ml.Vector2:Z=Z=>{const l=this.min.getConnectedValue(Z),C=this.max.getConnectedValue(Z);return new B.Vector2(Math.random()*(C.x-l.x)+l.x,Math.random()*(C.y-l.y)+l.y)};break;case Ml.ql:Z=Z=>{const l=this.min.getConnectedValue(Z),C=this.max.getConnectedValue(Z);return new B.ql(Math.random()*(C.x-l.x)+l.x,Math.random()*(C.y-l.y)+l.y,Math.random()*(C.z-l.z)+l.z)};break;case Ml.Rb:Z=Z=>{const l=this.min.getConnectedValue(Z),C=this.max.getConnectedValue(Z);return new K.Rb(Math.random()*(C.r-l.r)+l.r,Math.random()*(C.g-l.g)+l.g,Math.random()*(C.b-l.b)+l.b,Math.random()*(C.a-l.a)+l.a)}}this.output._storedFunction=l=>{var C;let B=0;switch(this.lockMode){case Tl.PerParticle:B=(null===(C=l.particleContext)||void 0===C?void 0:C.id)||-1;break;case Tl.PerSystem:B=l.buildId||0}return this._currentLockId!==B&&(this.lockMode!==Tl.None&&(this._currentLockId=B),this.output._storedValue=Z(l)),this.output._storedValue}}serialize(){const Z=super.serialize();return Z.lockMode=this.lockMode,Z}_deserialize(Z){super._deserialize(Z),void 0!==Z.lockMode&&(this.lockMode=Z.lockMode)}}(0,R.b)([hl("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Tl.None},{label:"Per particle",value:Tl.PerParticle},{label:"Per system",value:Tl.PerSystem}]})],KC.prototype,"lockMode",void 0),(0,f.c)("BABYLON.RandomRangeBlock",KC);(0,f.c)("BABYLON.ParticleLerpBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("left",Ml.AutoDetect),this.registerInput("right",Ml.AutoDetect),this.registerInput("gradient",Ml.Float,!0,0,0,1),this.registerOutput("output",Ml.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ml.Float|Ml.Int|Ml.Vector2|Ml.ql|Ml.Rb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Z=(Z,l,C)=>(1-Z)*l+Z*C;this.output._storedFunction=l=>{const C=this.left.getConnectedValue(l),x=this.right.getConnectedValue(l),b=this.gradient.getConnectedValue(l);switch(this.left.type){case Ml.Int:case Ml.Float:return Z(b,C,x);case Ml.Vector2:return new B.Vector2(Z(b,C.x,x.x),Z(b,C.y,x.y));case Ml.ql:return new B.ql(Z(b,C.x,x.x),Z(b,C.y,x.y),Z(b,C.z,x.z));case Ml.Rb:return new K.Rb(Z(b,C.r,x.r),Z(b,C.g,x.g),Z(b,C.b,x.b),Z(b,C.a,x.a))}return 0}}});(0,f.c)("BABYLON.UpdateDirectionBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerInput("direction",Ml.ql),this.registerOutput("output",Ml.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(Z){const l=this.particle.getConnectedValue(Z);if(this.output._storedValue=l,!this.direction.isConnected)return;const C={process:C=>{Z.particleContext=C,Z.systemContext=l,C.direction.B(this.direction.getConnectedValue(Z))},previousItem:null,nextItem:null};l._updateQueueStart?yZ(C,l._updateQueueStart):l._updateQueueStart=C}});(0,f.c)("BABYLON.UpdateColorBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerInput("color",Ml.Rb),this.registerOutput("output",Ml.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(Z){const l=this.particle.getConnectedValue(Z);if(this.output._storedValue=l,!this.color.isConnected)return;const C={process:C=>{Z.particleContext=C,Z.systemContext=l,C.color.B(this.color.getConnectedValue(Z))},previousItem:null,nextItem:null};l._updateQueueStart?yZ(C,l._updateQueueStart):l._updateQueueStart=C}});(0,f.c)("BABYLON.UpdateScaleBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerInput("scale",Ml.Vector2),this.registerOutput("output",Ml.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(Z){const l=this.particle.getConnectedValue(Z);if(this.output._storedValue=l,!this.scale.isConnected)return;const C={process:C=>{Z.particleContext=C,Z.systemContext=l,C.scale.B(this.scale.getConnectedValue(Z))},previousItem:null,nextItem:null};l._updateQueueStart?yZ(C,l._updateQueueStart):l._updateQueueStart=C}});(0,f.c)("BABYLON.UpdateAngleBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerInput("angle",Ml.Float),this.registerOutput("output",Ml.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(Z){const l=this.particle.getConnectedValue(Z);if(this.output._storedValue=l,!this.angle.isConnected)return;const C={process:C=>{Z.particleContext=C,Z.systemContext=l,C.angle=this.angle.getConnectedValue(Z)},previousItem:null,nextItem:null};l._updateQueueStart?yZ(C,l._updateQueueStart):l._updateQueueStart=C}});(0,f.c)("BABYLON.BasicPositionUpdateBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerOutput("output",Ml.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(Z){const l=this.particle.getConnectedValue(Z),C={process:C=>{Z.particleContext=C,Z.systemContext=l,C.direction.scaleToRef(l._directionScale,l._scaledDirection),C.position.addInPlace(l._scaledDirection)},previousItem:null,nextItem:null};l._updateQueueStart?yZ(C,l._updateQueueStart):l._updateQueueStart=C,this.output._storedValue=l}});(0,f.c)("BABYLON.BasicSpriteUpdateBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerOutput("output",Ml.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(Z){const l=this.particle.getConnectedValue(Z),C={process:C=>{Z.particleContext=C,Z.systemContext=l,C.updateCellIndex()},previousItem:null,nextItem:null};l._updateQueueStart?yZ(C,l._updateQueueStart):l._updateQueueStart=C,this.output._storedValue=l}});(0,f.c)("BABYLON.UpdateSpriteCellIndexBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerInput("cellIndex",Ml.Int),this.registerOutput("output",Ml.Particle),this.cellIndex.acceptedConnectionPointTypes=[Ml.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(Z){const l=this.particle.getConnectedValue(Z);if(this.output._storedValue=l,!this.cellIndex.isConnected)return;const C={process:C=>{Z.particleContext=C,Z.systemContext=l,C.cellIndex=Math.floor(this.cellIndex.getConnectedValue(Z))},previousItem:null,nextItem:null};l._updateQueueStart?yZ(C,l._updateQueueStart):l._updateQueueStart=C}});class fC extends Ql{constructor(Z){super(Z),this.strength=1,this.registerInput("particle",Ml.Particle),this.registerInput("flowMap",Ml.Texture),this.registerOutput("output",Ml.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(Z){var l;const C=this.particle.getConnectedValue(Z),B=Z.Yl;let x;(null===(l=this.flowMap.connectedPoint)||void 0===l?void 0:l.ownerBlock).extractTextureContentAsync().then((Z=>{Z&&(x=new jl(Z.width,Z.height,Z.data))}));const b={process:Z=>{const l=B.getTransformMatrix();x&&x._processParticle(Z,this.strength*C._tempScaledUpdateSpeed,l)},previousItem:null,nextItem:null};C._updateQueueStart?yZ(b,C._updateQueueStart):C._updateQueueStart=b,this.output._storedValue=C}serialize(){const Z=super.serialize();return Z.strength=this.strength,Z}_deserialize(Z){super._deserialize(Z),this.strength=Z.strength}}(0,R.b)([hl("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fC.prototype,"strength",void 0),(0,f.c)("BABYLON.UpdateFlowMapBlock",fC);(0,f.c)("BABYLON.SphereShapeBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("input",Ml.Particle),this.registerInput("radius",Ml.Float,!0,1),this.registerInput("radiusRange",Ml.Float,!0,1,0,1),this.registerInput("directionRandomizer",Ml.Float,!0,0,0,1),this.registerOutput("output",Ml.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(Z){const l=this.input.getConnectedValue(Z);l._directionCreation.process=C=>{Z.particleContext=C,Z.systemContext=l;const x=this.directionRandomizer.getConnectedValue(Z),b=C.position.zl(Z.emitterPosition).normalize(),K=(0,J.RandomRange)(0,x),f=(0,J.RandomRange)(0,x),W=(0,J.RandomRange)(0,x);b.x+=K,b.y+=f,b.z+=W,b.normalize(),Z.isEmitterTransformNode?B.ql.TransformNormalFromFloatsToRef(K,f,W,Z.emitterWorldMatrix,C.direction):C.direction.rb(K,f,W)},l._positionCreation.process=C=>{Z.particleContext=C,Z.systemContext=l;const x=this.radius.getConnectedValue(Z),b=this.radiusRange.getConnectedValue(Z),K=x-(0,J.RandomRange)(0,x*b),f=(0,J.RandomRange)(0,1),W=(0,J.RandomRange)(0,2*Math.PI),d=Math.acos(2*f-1),E=K*Math.cos(W)*Math.sin(d),G=K*Math.cos(d),a=K*Math.sin(W)*Math.sin(d);Z.isEmitterTransformNode?B.ql.TransformCoordinatesFromFloatsToRef(E,G,a,Z.emitterWorldMatrix,C.position):(C.position.rb(E,G,a),C.position.addInPlace(Z.emitterPosition))},this.output._storedValue=l}});(0,f.c)("BABYLON.PointShapeBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerInput("direction1",Ml.ql,!0,new B.ql(0,1,0)),this.registerInput("direction2",Ml.ql,!0,new B.ql(0,1,0)),this.registerOutput("output",Ml.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){const l=this.particle.getConnectedValue(Z);l._directionCreation.process=C=>{Z.particleContext=C,Z.systemContext=l;const x=this.direction1.getConnectedValue(Z),b=this.direction2.getConnectedValue(Z),K=(0,J.RandomRange)(x.x,b.x),f=(0,J.RandomRange)(x.y,b.y),W=(0,J.RandomRange)(x.z,b.z);Z.isEmitterTransformNode?B.ql.TransformNormalFromFloatsToRef(K,f,W,Z.emitterWorldMatrix,C.direction):C.direction.rb(K,f,W)},l._positionCreation.process=C=>{Z.systemContext=l,Z.isEmitterTransformNode?B.ql.TransformCoordinatesFromFloatsToRef(0,0,0,Z.emitterWorldMatrix,C.position):C.position.B(Z.emitterPosition)},this.output._storedValue=l}});(0,f.c)("BABYLON.CustomShapeBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("particle",Ml.Particle),this.registerInput("position",Ml.ql,!0,new B.ql(0,0,0)),this.registerInput("direction",Ml.ql,!0,new B.ql(0,1,0)),this.registerOutput("output",Ml.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){const l=this.particle.getConnectedValue(Z);l._directionCreation.process=C=>{Z.particleContext=C,Z.systemContext=l;const x=this.direction.getConnectedValue(Z);Z.isEmitterTransformNode?B.ql.TransformNormalToRef(x,Z.emitterWorldMatrix,C.direction):C.direction.B(x)},l._positionCreation.process=C=>{Z.particleContext=C,Z.systemContext=l;const x=this.position.getConnectedValue(Z);Z.isEmitterTransformNode?B.ql.TransformCoordinatesToRef(x,Z.emitterWorldMatrix,C.position):(C.position.B(x),C.position.addInPlace(Z.emitterPosition))},this.output._storedValue=l}});(0,f.c)("BABYLON.CylinderShapeBlock",class extends Ql{constructor(Z){super(Z),this._tempVector=B.ql.Zero(),this.registerInput("particle",Ml.Particle),this.registerInput("radius",Ml.Float,!0,1),this.registerInput("height",Ml.Float,!0,1,0),this.registerInput("radiusRange",Ml.Float,!0,1,0,1),this.registerInput("directionRandomizer",Ml.Float,!0,0,0,1),this.registerOutput("output",Ml.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Z){const l=this.particle.getConnectedValue(Z);l._directionCreation.process=C=>{Z.particleContext=C,Z.systemContext=l;const x=this.directionRandomizer.getConnectedValue(Z);C.position.subtractToRef(Z.emitterPosition,this._tempVector),this._tempVector.normalize(),Z.isEmitterTransformNode&&B.ql.TransformNormalToRef(this._tempVector,Z.emitterInverseWorldMatrix,this._tempVector);const b=(0,J.RandomRange)(-x/2,x/2);let K=Math.atan2(this._tempVector.x,this._tempVector.z);K+=(0,J.RandomRange)(-Math.PI/2,Math.PI/2)*x,this._tempVector.y=b,this._tempVector.x=Math.sin(K),this._tempVector.z=Math.cos(K),this._tempVector.normalize(),Z.isEmitterTransformNode?B.ql.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z.emitterWorldMatrix,C.direction):C.direction.B(this._tempVector)},l._positionCreation.process=C=>{Z.particleContext=C,Z.systemContext=l;const x=this.height.getConnectedValue(Z),b=this.radiusRange.getConnectedValue(Z),K=this.radius.getConnectedValue(Z),f=(0,J.RandomRange)(-x/2,x/2),W=(0,J.RandomRange)(0,2*Math.PI),d=(0,J.RandomRange)((1-b)*(1-b),1),E=Math.sqrt(d)*K,G=E*Math.cos(W),a=E*Math.sin(W);Z.isEmitterTransformNode?B.ql.TransformCoordinatesFromFloatsToRef(G,f,a,Z.emitterWorldMatrix,C.position):(C.position.rb(G,f,a),C.position.addInPlace(Z.emitterPosition))},this.output._storedValue=l}});class WC extends Ql{constructor(Z){super(Z),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Ml.Particle),this.registerOutput("output",Ml.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);const l=this.particle.getConnectedValue(Z);l._isAnimationSheetEnabled=!0,l.spriteCellWidth=this.width,l.spriteCellHeight=this.height,l.startSpriteCellID=this.start,l.endSpriteCellID=this.end,l.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=l}serialize(){const Z=super.serialize();return Z.width=this.width,Z.height=this.height,Z.start=this.start,Z.end=this.end,Z.randomStartCell=this.randomStartCell,Z}_deserialize(Z){super._deserialize(Z),this.width=Z.width,this.height=Z.height,this.start=Z.start,this.end=Z.end,this.randomStartCell=Z.randomStartCell}}(0,R.b)([hl("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WC.prototype,"start",void 0),(0,R.b)([hl("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WC.prototype,"end",void 0),(0,R.b)([hl("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WC.prototype,"width",void 0),(0,R.b)([hl("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WC.prototype,"height",void 0),(0,R.b)([hl("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],WC.prototype,"loop",void 0),(0,R.b)([hl("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],WC.prototype,"randomStartCell",void 0),(0,f.c)("BABYLON.SetupSpriteSheetBlock",WC);class JC extends Ql{constructor(Z){super(Z),this.reference=0,this.registerInput("value",Ml.AutoDetect),this.registerOutput("output",Ml.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=Z=>{switch(Z){case Ml.Float:return Ml.FloatGradient;case Ml.Vector2:return Ml.Vector2Gradient;case Ml.ql:return Ml.Vector3Gradient;case Ml.Rb:return Ml.Color4Gradient}return Z},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ml.Float|Ml.Vector2|Ml.ql|Ml.Rb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=Z=>null}serialize(){const Z=super.serialize();return Z.reference=this.reference,Z}_deserialize(Z){super._deserialize(Z),this.reference=Z.reference}}(0,R.b)([hl("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],JC.prototype,"reference",void 0),(0,f.c)("BABYLON.ParticleGradientValueBlock",JC);(0,f.c)("BABYLON.ParticleGradientBlock",class extends Ql{constructor(Z){super(Z),this._entryCount=1,this.registerInput("gradient",Ml.Float,!0,1,0,1),this.registerInput("value0",Ml.AutoDetect),this.registerOutput("output",Ml.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=Z=>{switch(Z){case Ml.FloatGradient:return Ml.Float;case Ml.Vector2Gradient:return Ml.Vector2;case Ml.Vector3Gradient:return Ml.ql;case Ml.Color4Gradient:return Ml.Rb}return Z},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Ml.FloatGradient|Ml.Vector2Gradient|Ml.Vector3Gradient|Ml.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(Z){this._inputs[Z].onConnectionObservable.add((()=>{this._entryCount>Z||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Ml.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const Z=[];for(let C=1;C<this._inputs.length;C++){var l;if(this._inputs[C].isConnected)Z.push(null===(l=this._inputs[C].connectedPoint)||void 0===l?void 0:l.ownerBlock)}Z.sort(((Z,l)=>Z.reference-l.reference)),this.output._storedFunction=l=>{const C=this.gradient.getConnectedValue(l);if(1===Z.length)return Z[0].value.getConnectedValue(l);let x=null;for(let b=Z.length-1;b>=0;b--){const f=Z[b];if(f.reference<=C){const Z=f.value.getConnectedValue(l);if(x){const b=x.value.getConnectedValue(l),W=x.reference,d=f.reference,E=Math.max(0,Math.min(1,(C-d)/(W-d)));switch(this.output.type){case Ml.Float:return(0,J.Lerp)(Z,b,E);case Ml.Vector2:return B.Vector2.Lerp(Z,b,E);case Ml.ql:return B.ql.Lerp(Z,b,E);case Ml.Rb:return K.Rb.Lerp(Z,b,E)}}return Z}x=f}return 0}}});(0,f.c)("BABYLON.ParticleConverterBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("color ",Ml.Rb,!0),this.registerInput("xyz ",Ml.ql,!0),this.registerInput("xy ",Ml.Vector2,!0),this.registerInput("zw ",Ml.Vector2,!0),this.registerInput("x ",Ml.Float,!0),this.registerInput("y ",Ml.Float,!0),this.registerInput("z ",Ml.Float,!0),this.registerInput("w ",Ml.Float,!0),this.registerOutput("color",Ml.Rb),this.registerOutput("xyz",Ml.ql),this.registerOutput("xy",Ml.Vector2),this.registerOutput("zw",Ml.Vector2),this.registerOutput("x",Ml.Float),this.registerOutput("y",Ml.Float),this.registerOutput("z",Ml.Float),this.registerOutput("w",Ml.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(Z){return"color "===Z?"colorIn":"xyz "===Z?"xyzIn":"xy "===Z?"xyIn":"zw "===Z?"zwIn":"x "===Z?"xIn":"y "===Z?"yIn":"z "===Z?"zIn":"w "===Z?"wIn":Z}_outputRename(Z){switch(Z){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return Z}}_build(Z){super._build(Z);const l=this.xIn,C=this.yIn,x=this.zIn,b=this.wIn,f=this.xyIn,W=this.zwIn,J=this.xyzIn,d=this.colorIn,E=this.colorOut,G=this.xyzOut,a=this.xyOut,q=this.zwOut,z=this.xOut,Y=this.yOut,P=this.zOut,S=this.wOut,i=Z=>{if(d.isConnected)return d.getConnectedValue(Z);let B=0,E=0,G=0,a=0;if(l.isConnected&&(B=l.getConnectedValue(Z)),C.isConnected&&(E=C.getConnectedValue(Z)),x.isConnected&&(G=x.getConnectedValue(Z)),b.isConnected&&(a=b.getConnectedValue(Z)),f.isConnected){const l=f.getConnectedValue(Z);l&&(B=l.x,E=l.y)}if(W.isConnected){const l=W.getConnectedValue(Z);l&&(G=l.x,a=l.y)}if(J.isConnected){const l=J.getConnectedValue(Z);l&&(B=l.x,E=l.y,G=l.z)}return new K.Rb(B,E,G,a)};E._storedFunction=Z=>i(Z),G._storedFunction=Z=>{const l=i(Z);return new B.ql(l.r,l.g,l.b)},a._storedFunction=Z=>{const l=i(Z);return new B.Vector2(l.r,l.g)},q._storedFunction=Z=>{const l=i(Z);return new B.Vector2(l.b,l.a)},z._storedFunction=Z=>i(Z).r,Y._storedFunction=Z=>i(Z).g,P._storedFunction=Z=>i(Z).b,S._storedFunction=Z=>i(Z).a}}),function(Z){Z[Z.Cos=0]="Cos",Z[Z.Sin=1]="Sin",Z[Z.Abs=2]="Abs",Z[Z.Exp=3]="Exp",Z[Z.Exp2=4]="Exp2",Z[Z.Round=5]="Round",Z[Z.Floor=6]="Floor",Z[Z.Ceiling=7]="Ceiling",Z[Z.Sqrt=8]="Sqrt",Z[Z.Log=9]="Log",Z[Z.Tan=10]="Tan",Z[Z.ArcTan=11]="ArcTan",Z[Z.ArcCos=12]="ArcCos",Z[Z.ArcSin=13]="ArcSin",Z[Z.Sign=14]="Sign",Z[Z.Negate=15]="Negate",Z[Z.OneMinus=16]="OneMinus",Z[Z.Reciprocal=17]="Reciprocal",Z[Z.ToDegrees=18]="ToDegrees",Z[Z.ToRadians=19]="ToRadians",Z[Z.Fract=20]="Fract"}(ul||(ul={}));class dC extends Ql{constructor(Z){super(Z),this.operation=ul.Cos,this.registerInput("input",Ml.AutoDetect),this.registerOutput("output",Ml.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Ml.Float|Ml.Int|Ml.Vector2|Ml.ql|Ml.Rb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);let l=null;switch(this.operation){case ul.Cos:l=Z=>Math.cos(Z);break;case ul.Sin:l=Z=>Math.sin(Z);break;case ul.Abs:l=Z=>Math.abs(Z);break;case ul.Exp:l=Z=>Math.exp(Z);break;case ul.Exp2:l=Z=>Math.pow(2,Z);break;case ul.Round:l=Z=>Math.round(Z);break;case ul.Floor:l=Z=>Math.floor(Z);break;case ul.Ceiling:l=Z=>Math.ceil(Z);break;case ul.Sqrt:l=Z=>Math.sqrt(Z);break;case ul.Log:l=Z=>Math.log(Z);break;case ul.Tan:l=Z=>Math.tan(Z);break;case ul.ArcTan:l=Z=>Math.atan(Z);break;case ul.ArcCos:l=Z=>Math.acos(Z);break;case ul.ArcSin:l=Z=>Math.asin(Z);break;case ul.Sign:l=Z=>Math.sign(Z);break;case ul.Negate:l=Z=>-Z;break;case ul.OneMinus:l=Z=>1-Z;break;case ul.Reciprocal:l=Z=>1/Z;break;case ul.ToRadians:l=Z=>Z*Math.PI/180;break;case ul.ToDegrees:l=Z=>180*Z/Math.PI;break;case ul.Fract:l=Z=>Z>=0?Z-Math.floor(Z):Z-Math.ceil(Z)}if(!l)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Ml.Int:case Ml.Float:this.output._storedFunction=Z=>{const C=this.input.getConnectedValue(Z);return l(C)};break;case Ml.Vector2:this.output._storedFunction=Z=>{const C=this.input.getConnectedValue(Z);return new B.Vector2(l(C.x),l(C.y))};break;case Ml.ql:this.output._storedFunction=Z=>{const C=this.input.getConnectedValue(Z);return new B.ql(l(C.x),l(C.y),l(C.z))};break;case Ml.Rb:this.output._storedFunction=Z=>{const C=this.input.getConnectedValue(Z);return new K.Rb(l(C.r),l(C.g),l(C.b),l(C.a))}}return this}serialize(){const Z=super.serialize();return Z.operation=this.operation,Z}_deserialize(Z){super._deserialize(Z),this.operation=Z.operation}}(0,R.b)([hl("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:ul.Cos},{label:"Sin",value:ul.Sin},{label:"Abs",value:ul.Abs},{label:"Exp",value:ul.Exp},{label:"Exp2",value:ul.Exp2},{label:"Round",value:ul.Round},{label:"Floor",value:ul.Floor},{label:"Ceiling",value:ul.Ceiling},{label:"Sqrt",value:ul.Sqrt},{label:"Log",value:ul.Log},{label:"Tan",value:ul.Tan},{label:"ArcTan",value:ul.ArcTan},{label:"ArcCos",value:ul.ArcCos},{label:"ArcSin",value:ul.ArcSin},{label:"Sign",value:ul.Sign},{label:"Negate",value:ul.Negate},{label:"OneMinus",value:ul.OneMinus},{label:"Reciprocal",value:ul.Reciprocal},{label:"ToDegrees",value:ul.ToDegrees},{label:"ToRadians",value:ul.ToRadians},{label:"Fract",value:ul.Fract}]})],dC.prototype,"operation",void 0),(0,f.c)("BABYLON.ParticleTrigonometryBlock",dC);var EC,GC=C(13513);class aC extends Ql{constructor(Z){super(Z),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Ml.AutoDetect),this.registerOutput("output",Ml.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Ml.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Ml.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ml.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ml.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Ml.System),this._inputs[0].excludedConnectionPointTypes.push(Ml.Particle),this._inputs[0].excludedConnectionPointTypes.push(Ml.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const l=Z=>{const l=this.input.getConnectedValue(Z);if(this.log.length>=this.stackSize)return l;if(null===l||void 0===l)return this.log.push(["null",""]),l;switch(this.input.type){case Ml.Vector2:this.log.push([(0,GC.k)(l,4),l.toString()]);break;case Ml.ql:this.log.push([(0,GC.n)(l,4),l.toString()]);break;case Ml.Rb:this.log.push([`{R: ${l.r.toFixed(4)} G: ${l.g.toFixed(4)} B: ${l.b.toFixed(4)} A: ${l.a.toFixed(4)}}`,l.toString()]);break;default:this.log.push([l.toString(),l.toString()])}return l};this.output.isConnected?this.output._storedFunction=l:this.output._storedValue=l(Z)}serialize(){const Z=super.serialize();return Z.stackSize=this.stackSize,Z}_deserialize(Z){super._deserialize(Z),this.stackSize=Z.stackSize}}(0,R.b)([hl("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],aC.prototype,"stackSize",void 0),(0,f.c)("BABYLON.ParticleDebugBlock",aC);(0,f.c)("BABYLON.ParticleElbowBlock",class extends Ql{constructor(Z){super(Z),this.registerInput("input",Ml.AutoDetect),this.registerOutput("output",Ml.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);const l=this._outputs[0],C=this._inputs[0];l._storedFunction=Z=>C.getConnectedValue(Z)}});(0,f.c)("BABYLON.ParticleTeleportInBlock",class extends Ql{get endpoints(){return this._endpoints}constructor(Z){super(Z),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Ml.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(Z){if(this.getClassName()===Z)return!0;for(const l of this.endpoints)if(l.isAnAncestorOfType(Z))return!0;return!1}isAnAncestorOf(Z){for(const l of this.endpoints){if(l===Z)return!0;if(l.isAnAncestorOf(Z))return!0}return!1}attachToEndpoint(Z){Z.detach(),this._endpoints.push(Z),Z._entryPoint=this,Z._outputs[0]._typeConnectionSource=this._inputs[0],Z._tempEntryPointUniqueId=null,Z.name="> "+this.name}detachFromEndpoint(Z){const l=this._endpoints.indexOf(Z);-1!==l&&(this._endpoints.splice(l,1),Z._outputs[0]._typeConnectionSource=null,Z._entryPoint=null)}_build(){for(const Z of this._endpoints)Z.output._storedFunction=Z=>this.input.getConnectedValue(Z)}});(0,f.c)("BABYLON.ParticleTeleportOutBlock",class extends Ql{constructor(Z){super(Z),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Ml.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(Z){this.entryPoint&&this.entryPoint.build(Z)}clone(){const Z=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(Z),Z}serialize(){var Z;const l=super.serialize();return l.entryPoint=(null===(Z=this.entryPoint)||void 0===Z?void 0:Z.uniqueId)??"",l}_deserialize(Z){super._deserialize(Z),this._tempEntryPointUniqueId=Z.entryPoint}}),function(Z){Z[Z.Equal=0]="Equal",Z[Z.NotEqual=1]="NotEqual",Z[Z.LessThan=2]="LessThan",Z[Z.GreaterThan=3]="GreaterThan",Z[Z.LessOrEqual=4]="LessOrEqual",Z[Z.GreaterOrEqual=5]="GreaterOrEqual",Z[Z.Xor=6]="Xor",Z[Z.Or=7]="Or",Z[Z.And=8]="And"}(EC||(EC={}));class qC extends Ql{constructor(Z){super(Z),this.test=EC.Equal,this.epsilon=0,this.registerInput("left",Ml.Float),this.registerInput("right",Ml.Float,!0,0),this.registerInput("ifTrue",Ml.AutoDetect,!0,1),this.registerInput("ifFalse",Ml.AutoDetect,!0,0),this.registerOutput("output",Ml.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Ml.Float,this._inputs[0].acceptedConnectionPointTypes.push(Ml.Int),this._inputs[1].acceptedConnectionPointTypes.push(Ml.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const Z=Z=>{const l=this.left.getConnectedValue(Z),C=this.right.getConnectedValue(Z);let B=!1;switch(this.test){case EC.Equal:B=(0,J.WithinEpsilon)(l,C,this.epsilon);break;case EC.NotEqual:B=!(0,J.WithinEpsilon)(l,C,this.epsilon);break;case EC.LessThan:B=l<C+this.epsilon;break;case EC.GreaterThan:B=l>C-this.epsilon;break;case EC.LessOrEqual:B=l<=C+this.epsilon;break;case EC.GreaterOrEqual:B=l>=C-this.epsilon;break;case EC.Xor:B=!!l&&!C||!l&&!!C;break;case EC.Or:B=!!l||!!C;break;case EC.And:B=!!l&&!!C}return B};this.output._storedFunction=l=>Z(l)?this.ifTrue.getConnectedValue(l):this.ifFalse.getConnectedValue(l)}serialize(){const Z=super.serialize();return Z.test=this.test,Z.epsilon=this.epsilon,Z}_deserialize(Z){super._deserialize(Z),this.test=Z.test,void 0!==Z.epsilon&&(this.epsilon=Z.epsilon)}}(0,R.b)([hl("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:EC.Equal},{label:"NotEqual",value:EC.NotEqual},{label:"LessThan",value:EC.LessThan},{label:"GreaterThan",value:EC.GreaterThan},{label:"LessOrEqual",value:EC.LessOrEqual},{label:"GreaterOrEqual",value:EC.GreaterOrEqual},{label:"Xor",value:EC.Xor},{label:"Or",value:EC.Or},{label:"And",value:EC.And}]})],qC.prototype,"test",void 0),(0,R.b)([hl("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],qC.prototype,"epsilon",void 0),(0,f.c)("BABYLON.ParticleConditionBlock",qC);class zC extends Ql{constructor(Z){super(Z),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Ml.Particle),this.registerInput("condition",Ml.Float,!0,0),this.registerInput("system",Ml.System),this.registerOutput("output",Ml.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){this._triggerCount=0;const l=this.input.getConnectedValue(Z),C={process:C=>{if(Z.particleContext=C,Z.systemContext=l,0!==this.condition.getConnectedValue(Z)&&(0===this.limit||this._triggerCount<this.limit)){const B=(new Date).getTime();if(this._previousOne&&B-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=B;const x=this.system.getConnectedValue(Z);if(x){const B=Ll(x,Z.Yl,C.position);B.xb.addOnce((()=>{this._triggerCount--})),l.xb.addOnce((()=>{B.dispose()}))}}},previousItem:null,nextItem:null};l._updateQueueStart?yZ(C,l._updateQueueStart):l._updateQueueStart=C,this.output._storedValue=l}serialize(){const Z=super.serialize();return Z.limit=this.limit,Z.delay=this.delay,Z}_deserialize(Z){super._deserialize(Z),void 0!==Z.limit&&(this.limit=Z.limit),void 0!==Z.delay&&(this.delay=Z.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,R.b)([hl("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zC.prototype,"limit",void 0),(0,R.b)([hl("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zC.prototype,"delay",void 0),(0,f.c)("BABYLON.ParticleTriggerBlock",zC);C(13520),C(13533),C(13541),C(13599)},13586:(Z,l,C)=>{"use strict";var B=C(12356);const x="clipPlaneFragment",b="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13548:(Z,l,C)=>{"use strict";var B=C(12356);const x="clipPlaneFragmentDeclaration",b="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13615:(Z,l,C)=>{"use strict";var B=C(12356);const x="clipPlaneVertex",b="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13602:(Z,l,C)=>{"use strict";var B=C(12356);const x="clipPlaneVertexDeclaration",b="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13594:(Z,l,C)=>{"use strict";var B=C(12356);const x="fogFragment",b="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13580:(Z,l,C)=>{"use strict";var B=C(12356);const x="fogFragmentDeclaration",b="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13622:(Z,l,C)=>{"use strict";var B=C(12356);const x="fogVertex",b="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13611:(Z,l,C)=>{"use strict";var B=C(12356);const x="fogVertexDeclaration",b="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13565:(Z,l,C)=>{"use strict";var B=C(12356);const x="helperFunctions",b="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13553:(Z,l,C)=>{"use strict";var B=C(12356);const x="imageProcessingDeclaration",b="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13574:(Z,l,C)=>{"use strict";var B=C(12356);const x="imageProcessingFunctions",b="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13562:(Z,l,C)=>{"use strict";var B=C(12356);const x="logDepthDeclaration",b="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13589:(Z,l,C)=>{"use strict";var B=C(12356);const x="logDepthFragment",b="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13628:(Z,l,C)=>{"use strict";var B=C(12356);const x="logDepthVertex",b="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";B.b.IncludesShadersStoreWGSL[x]||(B.b.IncludesShadersStoreWGSL[x]=b)},13541:(Z,l,C)=>{"use strict";C.r(l),C.d(l,{particlesPixelShaderWGSL:()=>K});var B=C(12356);C(13548),C(13553),C(13562),C(13565),C(13574),C(13580),C(13586),C(13589),C(13594);const x="particlesPixelShader",b="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";B.b.ShadersStoreWGSL[x]||(B.b.ShadersStoreWGSL[x]=b);const K={name:x,shader:b}},13599:(Z,l,C)=>{"use strict";C.r(l),C.d(l,{particlesVertexShaderWGSL:()=>K});var B=C(12356);C(13602),C(13611),C(13562),C(13615),C(13622),C(13628);const x="particlesVertexShader",b="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";B.b.ShadersStoreWGSL[x]||(B.b.ShadersStoreWGSL[x]=b);const K={name:x,shader:b}},13455:(Z,l,C)=>{"use strict";var B=C(12356);const x="clipPlaneFragment",b="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13528:(Z,l,C)=>{"use strict";var B=C(12356);const x="clipPlaneFragmentDeclaration",b="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13475:(Z,l,C)=>{"use strict";var B=C(12356);const x="clipPlaneVertex",b="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13537:(Z,l,C)=>{"use strict";var B=C(12356);const x="clipPlaneVertexDeclaration",b="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13465:(Z,l,C)=>{"use strict";var B=C(12356);const x="fogFragment",b="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13447:(Z,l,C)=>{"use strict";var B=C(12356);const x="fogFragmentDeclaration",b="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13478:(Z,l,C)=>{"use strict";var B=C(12356);const x="fogVertex",b="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13468:(Z,l,C)=>{"use strict";var B=C(12356);const x="fogVertexDeclaration",b="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13441:(Z,l,C)=>{"use strict";var B=C(12356);const x="helperFunctions",b="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13432:(Z,l,C)=>{"use strict";var B=C(12356);const x="imageProcessingDeclaration",b="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13445:(Z,l,C)=>{"use strict";var B=C(12356);const x="imageProcessingFunctions",b="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13436:(Z,l,C)=>{"use strict";var B=C(12356);const x="logDepthDeclaration",b="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13461:(Z,l,C)=>{"use strict";var B=C(12356);const x="logDepthFragment",b="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13486:(Z,l,C)=>{"use strict";var B=C(12356);const x="logDepthVertex",b="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";B.b.IncludesShadersStore[x]||(B.b.IncludesShadersStore[x]=b)},13520:(Z,l,C)=>{"use strict";C.r(l),C.d(l,{particlesPixelShader:()=>K});var B=C(12356);C(13528),C(13432),C(13436),C(13441),C(13445),C(13447),C(13455),C(13461),C(13465);const x="particlesPixelShader",b="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";B.b.ShadersStore[x]||(B.b.ShadersStore[x]=b);const K={name:x,shader:b}},13533:(Z,l,C)=>{"use strict";C.r(l),C.d(l,{particlesVertexShader:()=>K});var B=C(12356);C(13537),C(13468),C(13436),C(13475),C(13478),C(13486);const x="particlesVertexShader",b="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";B.b.ShadersStore[x]||(B.b.ShadersStore[x]=b);const K={name:x,shader:b}},13871:(Z,l,C)=>{"use strict";C.r(l),C.d(l,{FlowGraphGLTFDataProvider:()=>b});var B=C(13853),x=C(13830);class b extends B.d{constructor(Z){var l,C;super();const B=Z.glTF,b=(null===(l=B.animations)||void 0===l?void 0:l.map((Z=>Z._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",x.c,b);const K=(null===(C=B.nodes)||void 0===C?void 0:C.map((Z=>Z._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",x.c,K)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13779:(Z,l,C)=>{"use strict";C.d(l,{e:()=>Y,i:()=>q,m:()=>a,q:()=>z});var B=C(12442),x=C(12906),b=C(12494),K=C(13785);const f=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class W{constructor(Z,l){this._gltf=Z,this._infoTree=l}convert(Z){let l,C=this._gltf,B=this._infoTree;if(!Z.startsWith("/"))throw new Error("Path must start with a /");const x=Z.split("/");if(x.shift(),x[x.length-1].includes(".length")){const Z=x[x.length-1].split(".");x.pop(),x.push(...Z)}let b=!1;for(const W of x){const x="length"===W;if(x&&!B.__array__)throw new Error(`Path ${Z} is invalid`);if(B.__ignoreObjectTree__&&(b=!0),B.__array__&&!x)B=B.__array__;else if(B=B[W],!B)throw new Error(`Path ${Z} is invalid`);if(!b)if(void 0===C){if(!f.find((l=>l.regex.test(Z))))throw new Error(`Path ${Z} is invalid`)}else if(!x){var K;C=null===(K=C)||void 0===K?void 0:K[W]}(B.__target__||x)&&(l=C)}return{object:l,info:B}}}function J(Z,l,C,B){const x=d(Z,l);return B?x[C][B]:x[C]}function d(Z,l,C){var B,b;return null===(B=Z._data)||void 0===B||null===(b=B[(null===C||void 0===C?void 0:C.fillMode)??x.c.MATERIAL_TriangleFillMode])||void 0===b?void 0:b.babylonMaterial}function E(Z,l){return{offset:{componentsCount:2,type:"Vector2",get:(C,x,b)=>{const K=J(C,b,Z,l);return new B.Vector2(null===K||void 0===K?void 0:K.uOffset,null===K||void 0===K?void 0:K.vOffset)},getTarget:d,set:(C,B,x,b)=>{const K=J(B,b,Z,l);K.uOffset=C.x,K.vOffset=C.y},getPropertyName:[()=>`${Z}${l?"."+l:""}.uOffset`,()=>`${Z}${l?"."+l:""}.vOffset`]},rotation:{type:"number",get:(C,B,x)=>{var b;return null===(b=J(C,x,Z,l))||void 0===b?void 0:b.wAng},getTarget:d,set:(C,B,x,b)=>J(B,b,Z,l).wAng=C,getPropertyName:[()=>`${Z}${l?"."+l:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(C,x,b)=>{const K=J(C,b,Z,l);return new B.Vector2(null===K||void 0===K?void 0:K.uScale,null===K||void 0===K?void 0:K.vScale)},getTarget:d,set:(C,B,x,b)=>{const K=J(B,b,Z,l);K.uScale=C.x,K.vScale=C.y},getPropertyName:[()=>`${Z}${l?"."+l:""}.uScale`,()=>`${Z}${l?"."+l:""}.vScale`]}}}const G={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:Z=>{var l,C;return new B.Vector2((null===(l=Z._babylonCamera)||void 0===l?void 0:l.orthoLeft)??0,(null===(C=Z._babylonCamera)||void 0===C?void 0:C.orthoRight)??0)},set:(Z,l)=>{l._babylonCamera&&(l._babylonCamera.orthoLeft=Z.x,l._babylonCamera.orthoRight=Z.y)},getTarget:Z=>Z,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:Z=>{var l,C;return new B.Vector2((null===(l=Z._babylonCamera)||void 0===l?void 0:l.orthoBottom)??0,(null===(C=Z._babylonCamera)||void 0===C?void 0:C.orthoTop)??0)},set:(Z,l)=>{l._babylonCamera&&(l._babylonCamera.orthoBottom=Z.x,l._babylonCamera.orthoTop=Z.y)},getTarget:Z=>Z,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:Z=>{var l;return null===(l=Z._babylonCamera)||void 0===l?void 0:l.maxZ},set:(Z,l)=>{l._babylonCamera&&(l._babylonCamera.maxZ=Z)},getTarget:Z=>Z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Z=>{var l;return null===(l=Z._babylonCamera)||void 0===l?void 0:l.ib},set:(Z,l)=>{l._babylonCamera&&(l._babylonCamera.ib=Z)},getTarget:Z=>Z,getPropertyName:[()=>"ib"]}},perspective:{aspectRatio:{type:"number",get:Z=>{var l;return null===(l=Z._babylonCamera)||void 0===l?void 0:l.getEngine().getAspectRatio(Z._babylonCamera)},getTarget:Z=>Z,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:Z=>{var l;return null===(l=Z._babylonCamera)||void 0===l?void 0:l.fov},set:(Z,l)=>{l._babylonCamera&&(l._babylonCamera.fov=Z)},getTarget:Z=>Z,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:Z=>{var l;return null===(l=Z._babylonCamera)||void 0===l?void 0:l.maxZ},set:(Z,l)=>{l._babylonCamera&&(l._babylonCamera.maxZ=Z)},getTarget:Z=>Z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Z=>{var l;return null===(l=Z._babylonCamera)||void 0===l?void 0:l.ib},set:(Z,l)=>{l._babylonCamera&&(l._babylonCamera.ib=Z)},getTarget:Z=>Z,getPropertyName:[()=>"ib"]}}}},nodes:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ql",get:Z=>{var l;return null===(l=Z._babylonTransformNode)||void 0===l?void 0:l.position},set:(Z,l)=>{var C;return null===(C=l._babylonTransformNode)||void 0===C?void 0:C.position.B(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:Z=>{var l;return null===(l=Z._babylonTransformNode)||void 0===l?void 0:l.rotationQuaternion},set:(Z,l)=>{var C,B;return null===(C=l._babylonTransformNode)||void 0===C||null===(B=C.rotationQuaternion)||void 0===B?void 0:B.B(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ql",get:Z=>{var l;return null===(l=Z._babylonTransformNode)||void 0===l?void 0:l.eb},set:(Z,l)=>{var C;return null===(C=l._babylonTransformNode)||void 0===C?void 0:C.eb.B(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"eb"]},weights:{length:{type:"number",get:Z=>Z._numMorphTargets,getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(Z,l)=>{var C,B;return void 0!==l?null===(C=Z._primitiveBabylonMeshes)||void 0===C||null===(B=C[0].morphTargetManager)||void 0===B?void 0:B.getTarget(l).influence:void 0},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(Z,l)=>[0],getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:Z=>{var l,C,x;return B.Matrix.Compose(null===(l=Z._babylonTransformNode)||void 0===l?void 0:l.eb,null===(C=Z._babylonTransformNode)||void 0===C?void 0:C.rotationQuaternion,null===(x=Z._babylonTransformNode)||void 0===x?void 0:x.position)},getTarget:Z=>Z._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:Z=>{var l,C,x,b;const K=B.Matrix.Identity();let f=Z.parent;for(;f&&f.parent;)f=f.parent;const W=(null===(l=Z._babylonTransformNode)||void 0===l?void 0:l.position._isDirty)||(null===(C=Z._babylonTransformNode)||void 0===C||null===(x=C.rotationQuaternion)||void 0===x?void 0:x._isDirty)||(null===(b=Z._babylonTransformNode)||void 0===b?void 0:b.eb._isDirty);if(f){var J;const l=null===(J=f._babylonTransformNode)||void 0===J?void 0:J.Fb(!0).invert();var d,E;if(l)null===(d=Z._babylonTransformNode)||void 0===d||null===(E=d.Fb(W))||void 0===E||E.multiplyToRef(l,K)}else Z._babylonTransformNode&&K.B(Z._babylonTransformNode.Fb(W));return K},getTarget:Z=>Z._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:Z=>{var l,C;return null===(l=Z._babylonTransformNode)||void 0===l||null===(C=l.getChildren((Z=>Z instanceof K.d),!0)[0])||void 0===C?void 0:C.jb},getTarget:Z=>{var l;return null===(l=Z._babylonTransformNode)||void 0===l?void 0:l.getChildren((Z=>Z instanceof K.d),!0)[0]},set:(Z,l)=>{if(l._babylonTransformNode){const C=l._babylonTransformNode.getChildren((Z=>Z instanceof K.d),!0)[0];C&&(C.jb=Z)}}},color:{type:"Sl",get:Z=>{var l,C;return null===(l=Z._babylonTransformNode)||void 0===l||null===(C=l.getChildren((Z=>Z instanceof K.d),!0)[0])||void 0===C?void 0:C.Mb},getTarget:Z=>{var l;return null===(l=Z._babylonTransformNode)||void 0===l?void 0:l.getChildren((Z=>Z instanceof K.d),!0)[0]},set:(Z,l)=>{if(l._babylonTransformNode){const C=l._babylonTransformNode.getChildren((Z=>Z instanceof K.d),!0)[0];C&&(C.Mb=Z)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Sl",get:(Z,l,C)=>d(Z,l,C).emissiveColor,set:(Z,l,C,B)=>d(l,C,B).emissiveColor.B(Z),getTarget:(Z,l,C)=>d(Z,l,C),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:E("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(Z,l,C)=>{var B;return null===(B=J(Z,C,"bumpTexture"))||void 0===B?void 0:B.level},set:(Z,l,C,B)=>{const x=J(l,B,"bumpTexture");x&&(x.level=Z)},getTarget:(Z,l,C)=>d(Z,l,C),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:E("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(Z,l,C)=>d(Z,l,C).ambientTextureStrength,set:(Z,l,C,B)=>{const x=d(l,C,B);x&&(x.ambientTextureStrength=Z)},getTarget:(Z,l,C)=>d(Z,l,C),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:E("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Rb",get:(Z,l,C)=>{const B=d(Z,l,C);return b.Rb.FromColor3(B.albedoColor,B.alpha)},set:(Z,l,C,B)=>{const x=d(l,C,B);x.albedoColor.set(Z.r,Z.g,Z.b),x.alpha=Z.a},getTarget:(Z,l,C)=>d(Z,l,C),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:E("albedoTexture")}},metallicFactor:{type:"number",get:(Z,l,C)=>d(Z,l,C).metallic,set:(Z,l,C,B)=>{const x=d(l,C,B);x&&(x.metallic=Z)},getTarget:(Z,l,C)=>d(Z,l,C),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(Z,l,C)=>d(Z,l,C).roughness,set:(Z,l,C,B)=>{const x=d(l,C,B);x&&(x.roughness=Z)},getTarget:(Z,l,C)=>d(Z,l,C),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:E("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(Z,l,C)=>d(Z,l,C).anisotropy.jb,set:(Z,l,C,B)=>{d(l,C,B).anisotropy.jb=Z},getTarget:(Z,l,C)=>d(Z,l,C),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(Z,l,C)=>d(Z,l,C).anisotropy.angle,set:(Z,l,C,B)=>{d(l,C,B).anisotropy.angle=Z},getTarget:(Z,l,C)=>d(Z,l,C),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:E("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(Z,l,C)=>d(Z,l,C).clearCoat.jb,set:(Z,l,C,B)=>{d(l,C,B).clearCoat.jb=Z},getTarget:(Z,l,C)=>d(Z,l,C),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(Z,l,C)=>d(Z,l,C).clearCoat.roughness,set:(Z,l,C,B)=>{d(l,C,B).clearCoat.roughness=Z},getTarget:(Z,l,C)=>d(Z,l,C),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:E("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(Z,l,C)=>{var B;return null===(B=d(Z,l,C).clearCoat.bumpTexture)||void 0===B?void 0:B.level},getTarget:d,set:(Z,l,C,B)=>d(l,C,B).clearCoat.bumpTexture.level=Z},extensions:{KHR_texture_transform:E("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:E("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(Z,l,C)=>d(Z,l,C).subSurface.dispersion,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).subSurface.dispersion=Z}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(Z,l,C)=>d(Z,l,C).emissiveIntensity,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).emissiveIntensity=Z}},KHR_materials_ior:{ior:{type:"number",get:(Z,l,C)=>d(Z,l,C).indexOfRefraction,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).indexOfRefraction=Z}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(Z,l,C)=>d(Z,l,C).iridescence.jb,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).iridescence.jb=Z},iridescenceIor:{type:"number",get:(Z,l,C)=>d(Z,l,C).iridescence.indexOfRefraction,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).iridescence.indexOfRefraction=Z},iridescenceTexture:{extensions:{KHR_texture_transform:E("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(Z,l,C)=>d(Z,l,C).iridescence.maximumThickness,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).iridescence.maximumThickness=Z},iridescenceThicknessMinimum:{type:"number",get:(Z,l,C)=>d(Z,l,C).iridescence.minimumThickness,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).iridescence.minimumThickness=Z},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:E("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Sl",get:(Z,l,C)=>d(Z,l,C).sheen.color,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).sheen.color.B(Z)},sheenColorTexture:{extensions:{KHR_texture_transform:E("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(Z,l,C)=>d(Z,l,C).sheen.jb,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).sheen.jb=Z},sheenRoughnessTexture:{extensions:{KHR_texture_transform:E("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(Z,l,C)=>d(Z,l,C).metallicF0Factor,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).metallicF0Factor=Z,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Sl",get:(Z,l,C)=>d(Z,l,C).metallicReflectanceColor,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).metallicReflectanceColor.B(Z),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:E("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:E("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(Z,l,C)=>d(Z,l,C).subSurface.refractionIntensity,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).subSurface.refractionIntensity=Z,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:E("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(Z,l,C)=>d(Z,l,C).subSurface.translucencyIntensity,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).subSurface.translucencyIntensity=Z},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:E("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Sl",get:(Z,l,C)=>d(Z,l,C).subSurface.translucencyColor,getTarget:d,set:(Z,l,C,B)=>{var x;return Z&&(null===(x=d(l,C,B).subSurface.translucencyColor)||void 0===x?void 0:x.B(Z))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:E("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Sl",get:(Z,l,C)=>d(Z,l,C).subSurface.tintColor,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).subSurface.tintColor.B(Z)},attenuationDistance:{type:"number",get:(Z,l,C)=>d(Z,l,C).subSurface.tintColorAtDistance,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).subSurface.tintColorAtDistance=Z},thicknessFactor:{type:"number",get:(Z,l,C)=>d(Z,l,C).subSurface.maximumThickness,getTarget:d,set:(Z,l,C,B)=>d(l,C,B).subSurface.maximumThickness=Z},thicknessTexture:{extensions:{KHR_texture_transform:E("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonLight)),getPropertyName:[Z=>"length"]},__array__:{__target__:!0,color:{type:"Sl",get:Z=>{var l;return null===(l=Z._babylonLight)||void 0===l?void 0:l.Mb},set:(Z,l)=>{var C;return null===(C=l._babylonLight)||void 0===C?void 0:C.Mb.B(Z)},getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"diffuse"]},jb:{type:"number",get:Z=>{var l;return null===(l=Z._babylonLight)||void 0===l?void 0:l.jb},set:(Z,l)=>l._babylonLight?l._babylonLight.jb=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"intensity"]},range:{type:"number",get:Z=>{var l;return null===(l=Z._babylonLight)||void 0===l?void 0:l.range},set:(Z,l)=>l._babylonLight?l._babylonLight.range=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"range"]},spot:{innerConeAngle:{type:"number",get:Z=>{var l;return null===(l=Z._babylonLight)||void 0===l?void 0:l.innerAngle},set:(Z,l)=>l._babylonLight?l._babylonLight.innerAngle=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"innerConeAngle"]},outerConeAngle:{type:"number",get:Z=>{var l;return null===(l=Z._babylonLight)||void 0===l?void 0:l.angle},set:(Z,l)=>l._babylonLight?l._babylonLight.angle=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonLight)),getPropertyName:[Z=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonTexture)),getPropertyName:[Z=>"length"]},__array__:{__target__:!0,jb:{type:"number",get:Z=>{var l;return null===(l=Z._babylonTexture)||void 0===l?void 0:l.level},set:(Z,l)=>{l._babylonTexture&&(l._babylonTexture.level=Z)},getTarget:Z=>Z._babylonTexture},rotation:{type:"Quaternion",get:Z=>{var l;return Z._babylonTexture&&B.Quaternion.FromRotationMatrix(null===(l=Z._babylonTexture)||void 0===l?void 0:l.getReflectionTextureMatrix())},set:(Z,l)=>{var C;l._babylonTexture&&(null!==(C=l._babylonTexture.cZ())&&void 0!==C&&C.useRightHandedSystem||(Z=B.Quaternion.Inverse(Z)),B.Matrix.FromQuaternionToRef(Z,l._babylonTexture.getReflectionTextureMatrix()))},getTarget:Z=>Z._babylonTexture}}}}},animations:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>{var l;return null===(l=Z.primitives[0]._instanceData)||void 0===l?void 0:l.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function a(Z){return new W(Z,G)}function q(Z){const l=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let C=G;for(const B of l)B&&(C=C[B]);if(C&&C.type&&C.get)return C}function z(Z,l){const C=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let B=G;for(const x of C)x&&(B=B[x]);B&&B.type&&B.get&&(B.interpolation=l)}function Y(Z,l){const C=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let B=G;for(const x of C)if(x){if(!B[x]){if("?"===x){B.__ignoreObjectTree__=!0;continue}B[x]={},"__array__"===x&&(B[x].__target__=!0)}B=B[x]}Object.assign(B,l)}},13790:(Z,l,C)=>{"use strict";C.r(l),C.d(l,{AnimationPropertyInfo:()=>J,TransformNodeAnimationPropertyInfo:()=>d,WeightAnimationPropertyInfo:()=>E,getQuaternion:()=>f,getVector3:()=>K,getWeights:()=>W});var B=C(12942),x=C(12442),b=C(13779);function K(Z,l,C,B){return x.ql.il(l,C).scaleInPlace(B)}function f(Z,l,C,B){return x.Quaternion.il(l,C).scaleInPlace(B)}function W(Z,l,C,B){const x=new Array(Z._numMorphTargets);for(let b=0;b<x.length;b++)x[b]=l[C++]*B;return x}class J{constructor(Z,l,C,B){this.type=Z,this.name=l,this.getValue=C,this.getStride=B}_buildAnimation(Z,l,C){const x=new B.b(Z,this.name,l,this.type);return x.setKeys(C),x}}class d extends J{buildAnimations(Z,l,C,B){const x=[];return x.push({babylonAnimatable:Z._babylonTransformNode,babylonAnimation:this._buildAnimation(l,C,B)}),x}}class E extends J{buildAnimations(Z,l,C,x){const b=[];if(Z._numMorphTargets)for(let K=0;K<Z._numMorphTargets;K++){const f=new B.b(`${l}_${K}`,this.name,C,this.type);if(f.setKeys(x.map((Z=>({frame:Z.frame,inTangent:Z.inTangent?Z.inTangent[K]:void 0,value:Z.value[K],outTangent:Z.outTangent?Z.outTangent[K]:void 0,interpolation:Z.interpolation})))),Z._primitiveBabylonMeshes)for(const l of Z._primitiveBabylonMeshes)if(l.morphTargetManager){const Z=l.morphTargetManager.getTarget(K),C=f.clone();Z.animations.push(C),b.push({babylonAnimatable:Z,babylonAnimation:C})}}return b}}(0,b.q)("/nodes/{}/translation",[new d(B.b.ANIMATIONTYPE_VECTOR3,"position",K,(()=>3))]),(0,b.q)("/nodes/{}/rotation",[new d(B.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",f,(()=>4))]),(0,b.q)("/nodes/{}/scale",[new d(B.b.ANIMATIONTYPE_VECTOR3,"eb",K,(()=>3))]),(0,b.q)("/nodes/{}/weights",[new E(B.b.ANIMATIONTYPE_FLOAT,"influence",W,(Z=>Z._numMorphTargets))])},13746:(Z,l,C)=>{"use strict";class B{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((Z,l)=>{this._resolve=Z,this._reject=l}))}}var x=C(12442),b=C(12494),K=C(12248),f=C(12880),W=C(13751),J=C(13765),d=C(12251),E=C(12897),G=C(12942),a=C(12951),q=C(12295),z=C(12263),Y=C(12266);class P{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(Z){this._useTextureToStoreBoneMatrices=Z,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(Z){this._animationPropertiesOverride=Z}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(Z,l,C){this.name=Z,this.id=l,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=x.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new d.b,this.bones=[],this._scene=C||q.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const B=this._scene.getEngine().getCaps();this._canUseTextureForBones=B.textureFloat&&B.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((Z=>!Z.getParent()))}getTransformMatrices(Z){if(this.needInitialSkinMatrix){if(!Z)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return Z._bonesTransformMatrices||this.prepare(!0),Z._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(Z){return this.needInitialSkinMatrix&&Z._transformMatrixTexture?Z._transformMatrixTexture:this._transformMatrixTexture}cZ(){return this._scene}toString(Z){let l=`Name: ${this.name}, nBones: ${this.bones.length}`;if(l+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,Z){l+=", Ranges: {";let Z=!0;for(const C in this._ranges)Z&&(l+=", ",Z=!1),l+=C;l+="}"}return l}getBoneIndexByName(Z){for(let l=0,C=this.bones.length;l<C;l++)if(this.bones[l].name===Z)return l;return-1}createAnimationRange(Z,l,C){if(!this._ranges[Z]){this._ranges[Z]=new a.e(Z,l,C);for(let B=0,x=this.bones.length;B<x;B++)this.bones[B].animations[0]&&this.bones[B].animations[0].createRange(Z,l,C)}}deleteAnimationRange(Z){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let C=0,B=this.bones.length;C<B;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].deleteRange(Z,l);this._ranges[Z]=null}getAnimationRange(Z){return this._ranges[Z]||null}getAnimationRanges(){const Z=[];let l;for(l in this._ranges)Z.push(this._ranges[l]);return Z}copyAnimationRange(Z,l){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[l]||!Z.getAnimationRange(l))return!1;let B=!0;const x=this._getHighestAnimationFrame()+1,b={},K=Z.bones;let f,W;for(W=0,f=K.length;W<f;W++)b[K[W].name]=K[W];this.bones.length!==K.length&&(z.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${K.length}`),B=!1);const J=C&&this.dimensionsAtRest&&Z.dimensionsAtRest?this.dimensionsAtRest.divide(Z.dimensionsAtRest):null;for(W=0,f=this.bones.length;W<f;W++){const Z=this.bones[W].name,K=b[Z];K?B=B&&this.bones[W].copyAnimationRange(K,l,x,C,J):(z.e.Warn("copyAnimationRange: not same rig, missing source bone "+Z),B=!1)}const d=Z.getAnimationRange(l);return d&&(this._ranges[l]=new a.e(l,d.from+x,d.to+x)),B}returnToRest(){for(const Z of this.bones)-1!==Z._index&&Z.returnToRest()}_getHighestAnimationFrame(){let Z=0;for(let l=0,C=this.bones.length;l<C;l++)if(this.bones[l].animations[0]){const C=this.bones[l].animations[0].getHighestFrame();Z<C&&(Z=C)}return Z}beginAnimation(Z,l,C,B){const x=this.getAnimationRange(Z);return x?this._scene.beginAnimation(this,x.from,x.to,l,C,B):null}static MakeAnimationAdditive(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const B=Z.getAnimationRange(C);if(!B)return null;const x=Z._scene.getAllAnimatablesByTarget(Z);let b=null;for(let f=0;f<x.length;f++){const Z=x[f];if(Z.fromFrame===(null===B||void 0===B?void 0:B.from)&&Z.toFrame===(null===B||void 0===B?void 0:B.to)){b=Z;break}}const K=Z.getAnimatables();for(let f=0;f<K.length;f++){const Z=K[f].animations;if(Z)for(let B=0;B<Z.length;B++)G.b.MakeAnimationAdditive(Z[B],l,C)}return b&&(b.isAdditive=!0),Z}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(Z){this._meshesWithPoseMatrix.push(Z)}_unregisterMeshWithPoseMatrix(Z){const l=this._meshesWithPoseMatrix.indexOf(Z);l>-1&&this._meshesWithPoseMatrix.splice(l,1)}_computeTransformMatrices(Z,l){this.onBeforeComputeObservable.notifyObservers(this);for(let C=0;C<this.bones.length;C++){const B=this.bones[C];B._childUpdateId++;const x=B.getParent();if(x?B.getLocalMatrix().multiplyToRef(x.getFinalMatrix(),B.getFinalMatrix()):l?B.getLocalMatrix().multiplyToRef(l,B.getFinalMatrix()):B.getFinalMatrix().B(B.getLocalMatrix()),-1!==B._index){const l=null===B._index?C:B._index;B.getAbsoluteInverseBindMatrix().multiplyToArray(B.getFinalMatrix(),Z,16*l)}}this._identity.copyToArray(Z,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const Z=this.cZ().getRenderId();if(this._currentRenderId===Z)return;this._currentRenderId=Z}if(this._numBonesWithLinkedTransformNode>0)for(const Z of this.bones)if(Z._linkedTransformNode){const l=Z._linkedTransformNode;Z.position=l.position,l.rotationQuaternion?Z.rotationQuaternion=l.rotationQuaternion:Z.rotation=l.rotation,Z.eb=l.eb}if(this.needInitialSkinMatrix)for(const Z of this._meshesWithPoseMatrix){const l=Z.getPoseMatrix();let C=this._isDirty;if(Z._bonesTransformMatrices&&Z._bonesTransformMatrices.length===16*(this.bones.length+1)||(Z._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),C=!0),C){if(this._synchronizedWithMesh!==Z){this._synchronizedWithMesh=Z;for(const Z of this.bones)if(!Z.getParent()){Z.getBindMatrix().multiplyToRef(l,x.TmpVectors.Matrix[1]),Z._updateAbsoluteBindMatrices(x.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const l=4*(this.bones.length+1);Z._transformMatrixTexture&&Z._transformMatrixTexture.getSize().width===l||(Z._transformMatrixTexture&&Z._transformMatrixTexture.dispose(),Z._transformMatrixTexture=E.e.CreateRGBATexture(Z._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(Z._bonesTransformMatrices,l),this.isUsingTextureForMatrices&&Z._transformMatrixTexture&&Z._transformMatrixTexture.update(Z._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=E.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let Z=0;Z<this.bones.length;Z++)this._animatables.push(this.bones[Z])}return this._animatables}clone(Z,l){const C=new P(Z,l||Z,this._scene);C.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let B=0;B<this.bones.length;B++){const Z=this.bones[B];let l=null;const x=Z.getParent();if(x){const Z=this.bones.indexOf(x);l=C.bones[Z]}const b=new J.e(Z.name,C,l,Z.getBindMatrix().clone(),Z.getRestMatrix().clone());b._index=Z._index,Z._linkedTransformNode&&b.linkTransformNode(Z._linkedTransformNode),Y.d.DeepCopy(Z.animations,b.animations)}if(this._ranges){C._ranges={};for(const Z in this._ranges){const l=this._ranges[Z];l&&(C._ranges[Z]=l.clone())}}return this._isDirty=!0,C.prepare(!0),C}enableBlending(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const l of this.bones)for(const C of l.animations)C.enableBlending=!0,C.blendingSpeed=Z}dispose(){if(this._meshesWithPoseMatrix.length=0,this.cZ().stopAnimation(this),this.cZ().removeSkeleton(this),this._parentContainer){const Z=this._parentContainer.skeletons.indexOf(this);Z>-1&&this._parentContainer.skeletons.splice(Z,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const Z={};Z.name=this.name,Z.id=this.id,this.dimensionsAtRest&&(Z.dimensionsAtRest=this.dimensionsAtRest.Yb()),Z.bones=[],Z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){var l;const B=this.bones[C],x=B.getParent(),b={parentBoneIndex:x?this.bones.indexOf(x):-1,index:B.getIndex(),name:B.name,id:B.id,matrix:B.getBindMatrix().Yb(),rest:B.getRestMatrix().Yb(),linkedTransformNodeId:null===(l=B.getTransformNode())||void 0===l?void 0:l.id};Z.bones.push(b),B.length&&(b.length=B.length),B.metadata&&(b.metadata=B.metadata),B.animations&&B.animations.length>0&&(b.animation=B.animations[0].serialize()),Z.ranges=[];for(const l in this._ranges){const C=this._ranges[l];if(!C)continue;const B={};B.name=l,B.from=C.from,B.to=C.to,Z.ranges.push(B)}}return Z}static Parse(Z,l){const C=new P(Z.name,Z.id,l);let B;for(Z.dimensionsAtRest&&(C.dimensionsAtRest=x.ql.il(Z.dimensionsAtRest)),C.needInitialSkinMatrix=Z.needInitialSkinMatrix,B=0;B<Z.bones.length;B++){const l=Z.bones[B],b=Z.bones[B].index;let K=null;l.parentBoneIndex>-1&&(K=C.bones[l.parentBoneIndex]);const f=l.rest?x.Matrix.il(l.rest):null,W=new J.e(l.name,C,K,x.Matrix.il(l.matrix),f,null,b);void 0!==l.id&&null!==l.id&&(W.id=l.id),l.length&&(W.length=l.length),l.metadata&&(W.metadata=l.metadata),l.animation&&W.animations.push(G.b.Parse(l.animation)),void 0!==l.linkedTransformNodeId&&null!==l.linkedTransformNodeId&&(C._hasWaitingData=!0,W._waitingTransformNodeId=l.linkedTransformNodeId)}if(Z.ranges)for(B=0;B<Z.ranges.length;B++){const l=Z.ranges[B];C.createAnimationRange(l.name,l.from,l.to)}return C}computeAbsoluteMatrices(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||Z)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(Z)}getPoseMatrix(){let Z=null;return this._meshesWithPoseMatrix.length>0&&(Z=this._meshesWithPoseMatrix[0].getPoseMatrix()),Z}sortBones(){const Z=[],l=new Array(this.bones.length);for(let C=0;C<this.bones.length;C++)this._sortBones(C,Z,l);this.bones=Z}_sortBones(Z,l,C){if(C[Z])return;C[Z]=!0;const B=this.bones[Z];if(!B)return;void 0===B._index&&(B._index=Z);const x=B.getParent();x&&this._sortBones(this.bones.indexOf(x),l,C),l.push(B)}setCurrentPoseAsRest(){for(const Z of this.bones)Z.setCurrentPoseAsRest()}}var S=C(12769),i=C(12914),s=C(12423),F=C(12844),n=C(12530),c=C(12888),U=C(12855),t=C(12874),r=C(12954),e=C(12561),o=C(13708);class v{set areUpdatesFrozen(Z){Z?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new e.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,Z||(Z=q.b.LastCreatedScene),this._scene=Z,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const Z=this._scene.getEngine().getCaps();this._canUseTextureForTargets=Z.canUseGLVertexID&&Z.textureFloat&&Z.maxVertexTextureImageUnits>0&&Z.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return v.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?v.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(Z){this._numMaxInfluencers!==Z&&(this._numMaxInfluencers=Z,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(Z){this._useTextureToStoreTargets!==Z&&(this._useTextureToStoreTargets=Z,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var Z;return v.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(Z=this._scene)&&void 0!==Z&&Z.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(Z){return this._activeTargets.data[Z]}getTarget(Z){return this._targets[Z]}getTargetByName(Z){for(const l of this._targets)if(l.name===Z)return l;return null}addTarget(Z){this._targets.push(Z),this._targetInfluenceChangedObservers.push(Z.onInfluenceChanged.add((Z=>{this.areUpdatesFrozen&&Z&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(Z)}))),this._targetDataLayoutChangedObservers.push(Z._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(Z){const l=this._targets.indexOf(Z);l>=0&&(this._targets.splice(l,1),Z.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(l,1)[0]),Z._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(l,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(Z)}_bind(Z){Z.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),Z.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),Z.setTexture("morphTargets",this._targetStoreTexture),Z.setInt("morphTargetCount",this.numInfluencers)}clone(){const Z=new v(this._scene);for(const l of this._targets)Z.addTarget(l.clone());return Z.enablePositionMorphing=this.enablePositionMorphing,Z.enableNormalMorphing=this.enableNormalMorphing,Z.enableTangentMorphing=this.enableTangentMorphing,Z.enableUVMorphing=this.enableUVMorphing,Z.enableUV2Morphing=this.enableUV2Morphing,Z.enableColorMorphing=this.enableColorMorphing,Z}serialize(){const Z={};Z.id=this.uniqueId,Z.targets=[];for(const l of this._targets)Z.targets.push(l.serialize());return Z}_syncActiveTargets(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const l=!!this._targetStoreTexture,C=this.isUsingTextureForTargets;(this._mustSynchronize||l!==C)&&(this._mustSynchronize=!1,this.synchronize());let B=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let x=-1;for(const b of this._targets)if(x++,0!==b.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=v.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(b),this._morphTargetTextureIndices[B]=x,this._tempInfluences[B++]=b.influence}this._morphTargetTextureIndices.length!==B&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,B)),this._influences&&this._influences.length===B||(this._influences=new Float32Array(B));for(let b=0;b<B;b++)this._influences[b]=this._tempInfluences[b];if(Z&&this._scene)for(const b of this._scene.meshes)b.morphTargetManager===this&&(C?b._markSubMeshesAsAttributesDirty():b._syncGeometryWithMorphTargetManager())}synchronize(){var Z;if(!this._scene||this.areUpdatesFrozen)return;const l=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(Z=this._targetStoreTexture)||void 0===Z||Z.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>l.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const C of this._targets){this._supportsPositions=this._supportsPositions&&C.hasPositions,this._supportsNormals=this._supportsNormals&&C.hasNormals,this._supportsTangents=this._supportsTangents&&C.hasTangents,this._supportsUVs=this._supportsUVs&&C.hasUVs,this._supportsUV2s=this._supportsUV2s&&C.hasUV2s,this._supportsColors=this._supportsColors&&C.hasColors;const Z=C.vertexCount;if(0===this._vertexCount)this._vertexCount=Z;else if(this._vertexCount!==Z)return void z.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${C.name}": ${Z}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const Z=l.getCaps().maxTextureSize;this._textureWidth>Z&&(this._textureHeight=Math.ceil(this._textureWidth/Z),this._textureWidth=Z);const C=this._targets.length,B=new Float32Array(C*this._textureWidth*this._textureHeight*4);let x=0;for(let l=0;l<C;l++){const Z=this._targets[l],C=Z.getPositions(),b=Z.getNormals(),K=Z.getUVs(),f=Z.getTangents(),W=Z.getUV2s(),J=Z.getColors();x=l*this._textureWidth*this._textureHeight*4;for(let l=0;l<this._vertexCount;l++)this._supportsPositions&&C&&(B[x]=C[3*l],B[x+1]=C[3*l+1],B[x+2]=C[3*l+2],x+=4),this._supportsNormals&&b&&(B[x]=b[3*l],B[x+1]=b[3*l+1],B[x+2]=b[3*l+2],x+=4),this._supportsUVs&&K&&(B[x]=K[2*l],B[x+1]=K[2*l+1],x+=4),this._supportsTangents&&f&&(B[x]=f[3*l],B[x+1]=f[3*l+1],B[x+2]=f[3*l+2],x+=4),this._supportsUV2s&&W&&(B[x]=W[2*l],B[x+1]=W[2*l+1],x+=4),this._supportsColors&&J&&(B[x]=J[4*l],B[x+1]=J[4*l+1],B[x+2]=J[4*l+2],B[x+3]=J[4*l+3],x+=4)}this._targetStoreTexture=o.d.CreateRGBATexture(B,this._textureWidth,this._textureHeight,C,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const C of this._scene.meshes)C.morphTargetManager===this&&C._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const Z=this._parentContainer.morphTargetManagers.indexOf(this);Z>-1&&this._parentContainer.morphTargetManagers.splice(Z,1),this._parentContainer=null}for(const Z of this._targets)this._scene.stopAnimation(Z)}}static Parse(Z,l){const C=new v(l);for(const B of Z.targets)C.addTarget(r.e.Parse(B,l));return C}}v.EnableTextureStorage=!0,v.MaxActiveMorphTargetsInVertexAttributeMode=8,v.ConstantTargetCountForTextureMode=0;var R=C(13768),k=C(12298),V=C(12781);const g=new Map,j=g;function M(Z,l,C){I(Z)&&z.e.Warn(`Extension with the name '${Z}' already exists`),g.set(Z,{isGLTFExtension:l,factory:C})}function I(Z){return g.delete(Z)}var w=C(13779),O=C(13015),D=C(12544);class y{static Get(Z,l,C){if(!l||void 0==C||!l[C])throw new Error(`${Z}: Failed to find index (${C})`);return l[C]}static TryGet(Z,l){return Z&&void 0!=l&&Z[l]?Z[l]:null}static Assign(Z){if(Z)for(let l=0;l<Z.length;l++)Z[l].index=l}}function X(Z){if(Z.min&&Z.max){const l=Z.min,C=Z.max,B=x.TmpVectors.ql[0].rb(l[0],l[1],l[2]),b=x.TmpVectors.ql[1].rb(C[0],C[1],C[2]);if(Z.normalized&&5126!==Z.componentType){let l=1;switch(Z.componentType){case 5120:l=127;break;case 5121:l=255;break;case 5122:l=32767;break;case 5123:l=65535}const C=1/l;B.scaleInPlace(C),b.scaleInPlace(C)}return new V.d(B,b)}return null}class T{static RegisterExtension(Z,l){M(Z,!1,l)}static UnregisterExtension(Z){return I(Z)}get Eb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(Z){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=Z}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((Z=>Z.dispose&&Z.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(Z,l,C,B,x,b){let K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=l,this._assetContainer=C,this._loadData(B);let b=null;if(Z){const l={};if(this._gltf.nodes)for(const Z of this._gltf.nodes)Z.name&&(l[Z.name]=Z.index);b=(Z instanceof Array?Z:[Z]).map((Z=>{const C=l[Z];if(void 0===C)throw new Error(`Failed to find node '${Z}'`);return C}))}return await this._loadAsync(x,K,b,(()=>({meshes:this._getMeshes(),Ka:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=Z,this._loadData(l),await this._loadAsync(C,x,null,(()=>{}))}async _loadAsync(Z,l,C,B){return await Promise.resolve().then((async()=>{this._rootUrl=Z,this._uniqueRootUrl=!Z.startsWith("file:")&&l?Z:`${Z}${Date.now()}/`,this._fileName=l,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const x=`${R.j[R.j.LOADING]} => ${R.j[R.j.READY]}`,b=`${R.j[R.j.LOADING]} => ${R.j[R.j.COMPLETE]}`;this._parent._startPerformanceCounter(x),this._parent._startPerformanceCounter(b),this._parent._setState(R.j.LOADING),this._extensionsOnLoading();const f=new Array;if(!this.parent.loadOnlyMaterials)if(C)f.push(this.loadSceneAsync("/nodes",{nodes:C,index:-1}));else if(void 0!=this._gltf.Yl||this._gltf.scenes&&this._gltf.scenes[0]){const Z=y.Get("/scene",this._gltf.scenes,this._gltf.Yl||0);f.push(this.loadSceneAsync(`/scenes/${Z.index}`,Z))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let Z=0;Z<this._gltf.materials.length;++Z){const l=this._gltf.materials[Z],C="/materials/"+Z,B=S.b.TriangleFillMode;f.push(this._loadMaterialAsync(C,l,null,B,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&f.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&f.push(this._compileShadowGeneratorsAsync());const W=Promise.all(f).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.VW(!0);for(const Z of this._babylonScene.materials){const l=Z;void 0!==l.maxSimultaneousLights&&(l.maxSimultaneousLights=Math.max(l.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(R.j.READY),this._skipStartAnimationStep||this._startAnimations(),B()}));return await W.then((Z=>(this._parent._endPerformanceCounter(x),K.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(b),this._parent._setState(R.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(Z=>{this._parent.onErrorObservable.notifyObservers(Z),this._parent.onErrorObservable.clear(),this.dispose()}))})),Z)))})).catch((Z=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(Z),this._parent.onErrorObservable.clear(),this.dispose()),Z}))}_loadData(Z){if(this._gltf=Z.json,this._setupData(),Z.bin){const l=this._gltf.buffers;if(l&&l[0]&&!l[0].uri){const C=l[0];(C.byteLength<Z.bin.byteLength-3||C.byteLength>Z.bin.byteLength)&&z.e.Warn(`Binary buffer length (${C.byteLength}) from JSON does not match chunk length (${Z.bin.byteLength})`),this._bin=Z.bin}else z.e.Warn("Unexpected BIN chunk")}}_setupData(){if(y.Assign(this._gltf.accessors),y.Assign(this._gltf.animations),y.Assign(this._gltf.buffers),y.Assign(this._gltf.bufferViews),y.Assign(this._gltf.cameras),y.Assign(this._gltf.images),y.Assign(this._gltf.materials),y.Assign(this._gltf.meshes),y.Assign(this._gltf.nodes),y.Assign(this._gltf.samplers),y.Assign(this._gltf.scenes),y.Assign(this._gltf.skins),y.Assign(this._gltf.textures),this._gltf.nodes){const Z={};for(const C of this._gltf.nodes)if(C.children)for(const l of C.children)Z[l]=C.index;const l=this._createRootNode();for(const C of this._gltf.nodes){const B=Z[C.index];C.parent=void 0===B?l:this._gltf.nodes[B]}}}async _loadExtensionsAsync(){const Z=[];if(j.forEach(((l,C)=>{var B;!1===(null===(B=this.parent.extensionOptions[C])||void 0===B?void 0:B.enabled)?l.isGLTFExtension&&this.isExtensionUsed(C)&&z.e.Warn(`Extension ${C} is used but has been explicitly disabled.`):l.isGLTFExtension&&!this.isExtensionUsed(C)||Z.push((async()=>{const Z=await l.factory(this);return Z.name!==C&&z.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${Z.name} !== ${C}`),this._parent.onExtensionLoadedObservable.notifyObservers(Z),Z})())})),this._extensions.push(...await Promise.all(Z)),this._extensions.sort(((Z,l)=>(Z.order||Number.MAX_VALUE)-(l.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const C of this._gltf.extensionsRequired){if(!this._extensions.some((Z=>Z.name===C&&Z.enabled))){var l;if(!1===(null===(l=this.parent.extensionOptions[C])||void 0===l?void 0:l.enabled))throw new Error(`Required extension ${C} is disabled`);throw new Error(`Required extension ${C} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new t.b("__root__",this._babylonScene);this._rootBabylonMesh=Z,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.VW(!1);const l={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case R.h.AUTO:this._babylonScene.useRightHandedSystem||(l.rotation=[0,1,0,0],l.scale=[1,1,-1],T._LoadTransform(l,this._rootBabylonMesh));break;case R.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(Z),l}loadSceneAsync(Z,l){const C=this._extensionsLoadSceneAsync(Z,l);if(C)return C;const B=new Array;if(this.logOpen(`${Z} ${l.name||""}`),l.nodes)for(const x of l.nodes){const l=y.Get(`${Z}/nodes/${x}`,this._gltf.nodes,x);B.push(this.loadNodeAsync(`/nodes/${l.index}`,l,(Z=>{Z.parent=this._rootBabylonMesh})))}for(const x of this._postSceneLoadActions)x();return B.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(B).then((()=>{}))}_forEachPrimitive(Z,l){if(Z._primitiveBabylonMeshes)for(const C of Z._primitiveBabylonMeshes)l(C)}_getGeometries(){const Z=[],l=this._gltf.nodes;if(l)for(const C of l)this._forEachPrimitive(C,(l=>{const C=l.nb;C&&-1===Z.indexOf(C)&&Z.push(C)}));return Z}_getMeshes(){const Z=[];this._rootBabylonMesh instanceof U.e&&Z.push(this._rootBabylonMesh);const l=this._gltf.nodes;if(l)for(const C of l)this._forEachPrimitive(C,(l=>{Z.push(l)}));return Z}_getTransformNodes(){const Z=[],l=this._gltf.nodes;if(l)for(const C of l)C._babylonTransformNode&&"Db"===C._babylonTransformNode.getClassName()&&Z.push(C._babylonTransformNode),C._babylonTransformNodeForSkin&&Z.push(C._babylonTransformNodeForSkin);return Z}_getSkeletons(){const Z=[],l=this._gltf.skins;if(l)for(const C of l)C._data&&Z.push(C._data.babylonSkeleton);return Z}_getAnimationGroups(){const Z=[],l=this._gltf.animations;if(l)for(const C of l)C._babylonAnimationGroup&&Z.push(C._babylonAnimationGroup);return Z}_startAnimations(){switch(this._parent.animationStartMode){case R.g.NONE:break;case R.g.FIRST:{const Z=this._getAnimationGroups();0!==Z.length&&Z[0].start(!0);break}case R.g.ALL:{const Z=this._getAnimationGroups();for(const l of Z)l.start(!0);break}default:return void z.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadNodeAsync(Z,l,C);if(B)return B;if(l._babylonTransformNode)throw new Error(`${Z}: Invalid recursive node hierarchy`);const x=new Array;this.logOpen(`${Z} ${l.name||""}`);const b=B=>{if(T.AddPointerMetadata(B,Z),T._LoadTransform(l,B),void 0!=l.camera){const C=y.Get(`${Z}/camera`,this._gltf.cameras,l.camera);x.push(this.loadCameraAsync(`/cameras/${C.index}`,C,(Z=>{Z.parent=B,this._babylonScene.useRightHandedSystem||(B.eb.x=-1)})))}if(l.children)for(const C of l.children){const l=y.Get(`${Z}/children/${C}`,this._gltf.nodes,C);x.push(this.loadNodeAsync(`/nodes/${l.index}`,l,(Z=>{Z.parent=B})))}C(B)},K=void 0!=l.mesh,f=this._parent.loadSkins&&void 0!=l.skin;if(!K||f){const Z=l.name||`node${l.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new F.e(Z,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==l.mesh?l._babylonTransformNode=C:l._babylonTransformNodeForSkin=C,b(C)}if(K)if(f){const C=y.Get(`${Z}/mesh`,this._gltf.meshes,l.mesh);x.push(this._loadMeshAsync(`/meshes/${C.index}`,l,C,(C=>{const B=l._babylonTransformNodeForSkin;C.metadata=(0,O.c)(B.metadata,C.metadata||{});const b=y.Get(`${Z}/skin`,this._gltf.skins,l.skin);x.push(this._loadSkinAsync(`/skins/${b.index}`,l,b,(Z=>{this._forEachPrimitive(l,(l=>{l.skeleton=Z})),this._postSceneLoadActions.push((()=>{if(void 0!=b.skeleton){const Z=y.Get(`/skins/${b.index}/skeleton`,this._gltf.nodes,b.skeleton).parent;l.index===Z.index?C.parent=B.parent:C.parent=Z._babylonTransformNode}else C.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:B,skinnedNode:C})}))})))})))}else{const C=y.Get(`${Z}/mesh`,this._gltf.meshes,l.mesh);x.push(this._loadMeshAsync(`/meshes/${C.index}`,l,C,b))}return this.logClose(),Promise.all(x).then((()=>(this._forEachPrimitive(l,(Z=>{const l=Z;!l.isAnInstance&&l.nb&&l.nb.useBoundingInfoFromGeometry?Z.VZ():Z.refreshBoundingInfo(!0,!0)})),l._babylonTransformNode)))}_loadMeshAsync(Z,l,C,B){const x=C.primitives;if(!x||!x.length)throw new Error(`${Z}: Primitives are missing`);void 0==x[0].index&&y.Assign(x);const b=new Array;this.logOpen(`${Z} ${C.name||""}`);const K=l.name||`node${l.index}`;if(1===x.length){const B=C.primitives[0];b.push(this._loadMeshPrimitiveAsync(`${Z}/primitives/${B.index}`,K,l,C,B,(Z=>{l._babylonTransformNode=Z,l._primitiveBabylonMeshes=[Z]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,l._babylonTransformNode=new F.e(K,this._babylonScene),l._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l._primitiveBabylonMeshes=[];for(const B of x)b.push(this._loadMeshPrimitiveAsync(`${Z}/primitives/${B.index}`,`${K}_primitive${B.index}`,l,C,B,(Z=>{Z.parent=l._babylonTransformNode,l._primitiveBabylonMeshes.push(Z)})))}return B(l._babylonTransformNode),this.logClose(),Promise.all(b).then((()=>l._babylonTransformNode))}_loadMeshPrimitiveAsync(Z,l,C,B,x,b){const K=this._extensionsLoadMeshPrimitiveAsync(Z,l,C,B,x,b);if(K)return K;this.logOpen(`${Z}`);const f=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==C.skin&&!B.primitives[0].targets;let W,J;if(f&&x._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,W=x._instanceData.babylonSourceMesh.createInstance(l),W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J=x._instanceData.promise;else{const b=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new t.b(l,this._babylonScene);K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,K.sideOrientation=this._babylonScene.useRightHandedSystem?S.b.CounterClockWiseSideOrientation:S.b.ClockWiseSideOrientation,this._createMorphTargets(Z,C,B,x,K),b.push(this._loadVertexDataAsync(Z,x,K).then((async l=>await this._loadMorphTargetsAsync(Z,x,K,l).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,l.RZ(K),l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const d=T._GetDrawMode(Z,x.mode);if(void 0==x.material){let Z=this._defaultBabylonMaterialData[d];Z||(Z=this._createDefaultMaterial("__GLTFLoader._default",d),this._parent.onMaterialLoadedObservable.notifyObservers(Z),this._defaultBabylonMaterialData[d]=Z),K.material=Z}else if(!this.parent.skipMaterials){const l=y.Get(`${Z}/material`,this._gltf.materials,x.material);b.push(this._loadMaterialAsync(`/materials/${l.index}`,l,K,d,(Z=>{K.material=Z})))}J=Promise.all(b),f&&(x._instanceData={babylonSourceMesh:K,promise:J}),W=K}return T.AddPointerMetadata(W,Z),this._parent.onMeshLoadedObservable.notifyObservers(W),b(W),this.logClose(),J.then((()=>W))}_loadVertexDataAsync(Z,l,C){const B=this._extensionsLoadVertexDataAsync(Z,l,C);if(B)return B;const x=l.attributes;if(!x)throw new Error(`${Z}: Attributes are missing`);const b=new Array,K=new c.b(C.name,this._babylonScene);if(void 0==l.indices)C.isUnIndexed=!0;else{const C=y.Get(`${Z}/indices`,this._gltf.accessors,l.indices);b.push(this._loadIndicesAccessorAsync(`/accessors/${C.index}`,C).then((Z=>{K.setIndices(Z)})))}const f=(l,B,f)=>{if(void 0==x[l])return;C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(B)&&C._delayInfo.push(B);const W=y.Get(`${Z}/attributes/${l}`,this._gltf.accessors,x[l]);b.push(this._loadVertexAccessorAsync(`/accessors/${W.index}`,W,B).then((Z=>{if(Z.getKind()===n.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!C.skeleton){const Z=X(W);Z&&(K._boundingInfo=Z,K.useBoundingInfoFromGeometry=!0)}K.setVerticesBuffer(Z,W.count)}))),B==n.h.MatricesIndicesExtraKind&&(C.numBoneInfluencers=8),f&&f(W)};return f("POSITION",n.h.PositionKind),f("NORMAL",n.h.NormalKind),f("TANGENT",n.h.TangentKind),f("TEXCOORD_0",n.h.UVKind),f("TEXCOORD_1",n.h.UV2Kind),f("TEXCOORD_2",n.h.UV3Kind),f("TEXCOORD_3",n.h.UV4Kind),f("TEXCOORD_4",n.h.UV5Kind),f("TEXCOORD_5",n.h.UV6Kind),f("JOINTS_0",n.h.MatricesIndicesKind),f("WEIGHTS_0",n.h.MatricesWeightsKind),f("JOINTS_1",n.h.MatricesIndicesExtraKind),f("WEIGHTS_1",n.h.MatricesWeightsExtraKind),f("COLOR_0",n.h.ColorKind,(Z=>{"VEC4"===Z.type&&(C.hasVertexAlpha=!0)})),Promise.all(b).then((()=>K))}_createMorphTargets(Z,l,C,B,x){if(!B.targets||!this._parent.loadMorphTargets)return;if(void 0==l._numMorphTargets)l._numMorphTargets=B.targets.length;else if(B.targets.length!==l._numMorphTargets)throw new Error(`${Z}: Primitives do not have the same number of targets`);const b=C.extras?C.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,x.morphTargetManager=new v(this._babylonScene),x.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.morphTargetManager.areUpdatesFrozen=!0;for(let K=0;K<B.targets.length;K++){const Z=l.weights?l.weights[K]:C.weights?C.weights[K]:0,B=b?b[K]:`morphTarget${K}`;x.morphTargetManager.addTarget(new r.e(B,Z,x.cZ()))}}_loadMorphTargetsAsync(Z,l,C,B){if(!l.targets||!this._parent.loadMorphTargets)return Promise.resolve();const x=new Array,b=C.morphTargetManager;for(let K=0;K<b.numTargets;K++){const C=b.getTarget(K);x.push(this._loadMorphTargetVertexDataAsync(`${Z}/targets/${K}`,B,l.targets[K],C))}return Promise.all(x).then((()=>{b.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(Z,l,C,B){const x=new Array,b=(B,b,K)=>{if(void 0==C[B])return;const f=l.getVertexBuffer(b);if(!f)return;const W=y.Get(`${Z}/${B}`,this._gltf.accessors,C[B]);x.push(this._loadFloatAccessorAsync(`/accessors/${W.index}`,W).then((Z=>{K(f,Z)})))};return b("POSITION",n.h.PositionKind,((Z,l)=>{const C=new Float32Array(l.length);Z.forEach(l.length,((Z,B)=>{C[B]=l[B]+Z})),B.setPositions(C)})),b("NORMAL",n.h.NormalKind,((Z,l)=>{const C=new Float32Array(l.length);Z.forEach(C.length,((Z,B)=>{C[B]=l[B]+Z})),B.setNormals(C)})),b("TANGENT",n.h.TangentKind,((Z,l)=>{const C=new Float32Array(l.length/3*4);let x=0;Z.forEach(l.length/3*4,((Z,B)=>{(B+1)%4!==0&&(C[x]=l[x]+Z,x++)})),B.setTangents(C)})),b("TEXCOORD_0",n.h.UVKind,((Z,l)=>{const C=new Float32Array(l.length);Z.forEach(l.length,((Z,B)=>{C[B]=l[B]+Z})),B.setUVs(C)})),b("TEXCOORD_1",n.h.UV2Kind,((Z,l)=>{const C=new Float32Array(l.length);Z.forEach(l.length,((Z,B)=>{C[B]=l[B]+Z})),B.setUV2s(C)})),b("COLOR_0",n.h.ColorKind,((l,C)=>{let x=null;const b=l.getSize();if(3===b){x=new Float32Array(C.length/3*4),l.forEach(C.length,((Z,l)=>{const B=Math.floor(l/3),b=l%3;x[4*B+b]=C[3*B+b]+Z}));for(let Z=0;Z<C.length/3;++Z)x[4*Z+3]=1}else{if(4!==b)throw new Error(`${Z}: Invalid number of components (${b}) for COLOR_0 attribute`);x=new Float32Array(C.length),l.forEach(C.length,((Z,l)=>{x[l]=C[l]+Z}))}B.setColors(x)})),await Promise.all(x).then((()=>{}))}static _LoadTransform(Z,l){if(void 0!=Z.skin)return;let C=x.ql.Zero(),B=x.Quaternion.Identity(),b=x.ql.One();if(Z.matrix){x.Matrix.il(Z.matrix).decompose(b,B,C)}else Z.translation&&(C=x.ql.il(Z.translation)),Z.rotation&&(B=x.Quaternion.il(Z.rotation)),Z.scale&&(b=x.ql.il(Z.scale));l.position=C,l.rotationQuaternion=B,l.eb=b}_loadSkinAsync(Z,l,C,B){if(!this._parent.loadSkins)return Promise.resolve();const x=this._extensionsLoadSkinAsync(Z,l,C);if(x)return x;if(C._data)return B(C._data.babylonSkeleton),C._data.promise;const b=`skeleton${C.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new P(C.name||b,b,this._babylonScene);K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(Z,C,K);const f=this._loadSkinInverseBindMatricesDataAsync(Z,C).then((Z=>{this._updateBoneMatrices(K,Z)}));return C._data={babylonSkeleton:K,promise:f},B(K),f}_loadBones(Z,l,C){if(void 0==l.skeleton||this._parent.alwaysComputeSkeletonRootNode){const C=this._findSkeletonRootNode(`${Z}/joints`,l.joints);if(C)if(void 0===l.skeleton)l.skeleton=C.index;else{const B=(Z,l)=>{for(;l.parent;l=l.parent)if(l.parent===Z)return!0;return!1},x=y.Get(`${Z}/skeleton`,this._gltf.nodes,l.skeleton);x===C||B(x,C)||(z.e.Warn(`${Z}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),l.skeleton=C.index)}else z.e.Warn(`${Z}: Failed to find common root`)}const B={};for(const x of l.joints){const b=y.Get(`${Z}/joints/${x}`,this._gltf.nodes,x);this._loadBone(b,l,C,B)}}_findSkeletonRootNode(Z,l){if(0===l.length)return null;const C={};for(const x of l){const l=[];let B=y.Get(`${Z}/${x}`,this._gltf.nodes,x);for(;-1!==B.index;)l.unshift(B),B=B.parent;C[x]=l}let B=null;for(let x=0;;++x){let Z=C[l[0]];if(x>=Z.length)return B;const b=Z[x];for(let K=1;K<l.length;++K)if(Z=C[l[K]],x>=Z.length||b!==Z[x])return B;B=b}}_loadBone(Z,l,C,B){Z._isJoint=!0;let x=B[Z.index];if(x)return x;let b=null;Z.index!==l.skeleton&&(Z.parent&&-1!==Z.parent.index?b=this._loadBone(Z.parent,l,C,B):void 0!==l.skeleton&&z.e.Warn(`/skins/${l.index}/skeleton: Skeleton node is not a common root`));const K=l.joints.indexOf(Z.index);return x=new J.e(Z.name||`joint${Z.index}`,C,b,this._getNodeMatrix(Z),null,null,K),B[Z.index]=x,this._postSceneLoadActions.push((()=>{x.linkTransformNode(Z._babylonTransformNode)})),x}_loadSkinInverseBindMatricesDataAsync(Z,l){if(void 0==l.inverseBindMatrices)return Promise.resolve(null);const C=y.Get(`${Z}/inverseBindMatrices`,this._gltf.accessors,l.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${C.index}`,C)}_updateBoneMatrices(Z,l){for(const C of Z.bones){const Z=x.Matrix.Identity(),B=C._index;l&&-1!==B&&(x.Matrix.FromArrayToRef(l,16*B,Z),Z.invertToRef(Z));const b=C.getParent();b&&Z.multiplyToRef(b.getAbsoluteInverseBindMatrix(),Z),C.sb(Z,!1,!1),C._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(Z){return Z.matrix?x.Matrix.il(Z.matrix):x.Matrix.Compose(Z.scale?x.ql.il(Z.scale):x.ql.One(),Z.rotation?x.Quaternion.il(Z.rotation):x.Quaternion.Identity(),Z.translation?x.ql.il(Z.translation):x.ql.Zero())}loadCameraAsync(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadCameraAsync(Z,l,C);if(B)return B;const b=new Array;this.logOpen(`${Z} ${l.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new W.d(l.name||`camera${l.index}`,x.ql.Zero(),this._babylonScene,!1);switch(K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l._babylonCamera=K,K.setTarget(new x.ql(0,0,-1)),l.type){case"perspective":{const C=l.perspective;if(!C)throw new Error(`${Z}: Camera perspective properties are missing`);K.fov=C.yfov,K.ib=C.znear,K.maxZ=C.zfar||0;break}case"orthographic":if(!l.orthographic)throw new Error(`${Z}: Camera orthographic properties are missing`);K.mode=f.d.ORTHOGRAPHIC_CAMERA,K.orthoLeft=-l.orthographic.xmag,K.orthoRight=l.orthographic.xmag,K.orthoBottom=-l.orthographic.ymag,K.orthoTop=l.orthographic.ymag,K.ib=l.orthographic.znear,K.maxZ=l.orthographic.zfar;break;default:throw new Error(`${Z}: Invalid camera type (${l.type})`)}return T.AddPointerMetadata(K,Z),this._parent.onCameraLoadedObservable.notifyObservers(K),C(K),this.logClose(),Promise.all(b).then((()=>K))}_loadAnimationsAsync(){const Z=this._gltf.animations;if(!Z)return Promise.resolve();const l=new Array;for(let C=0;C<Z.length;C++){const B=Z[C];l.push(this.loadAnimationAsync(`/animations/${B.index}`,B).then((Z=>{0===Z.targetedAnimations.length&&Z.dispose()})))}return Promise.all(l).then((()=>{}))}loadAnimationAsync(Z,l){const B=this._extensionsLoadAnimationAsync(Z,l);return B||C.e(78).then(C.bind(C,15296)).then((C=>{let{AnimationGroup:B}=C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new B(l.name||`animation${l.index}`,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l._babylonAnimationGroup=x;const b=new Array;y.Assign(l.channels),y.Assign(l.samplers);for(const K of l.channels)b.push(this._loadAnimationChannelAsync(`${Z}/channels/${K.index}`,Z,l,K,((Z,l)=>{Z.animations=Z.animations||[],Z.animations.push(l),x.addTargetedAnimation(l,Z)})));return Promise.all(b).then((()=>(x.normalize(0),x)))}))}async _loadAnimationChannelAsync(Z,l,B,x,b){const K=this._extensionsLoadAnimationChannelAsync(Z,l,B,x,b);if(K)return await K;if(void 0==x.target.node)return await Promise.resolve();const f=y.Get(`${Z}/target/node`,this._gltf.nodes,x.target.node),W=x.target.path,J="weights"===W;if(J&&!f._numMorphTargets||!J&&!f._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!J&&!f._isJoint)return await Promise.resolve();let d;switch(await Promise.resolve().then(C.bind(C,13790)),W){case"translation":var E;d=null===(E=(0,w.i)("/nodes/{}/translation"))||void 0===E?void 0:E.interpolation;break;case"rotation":var G;d=null===(G=(0,w.i)("/nodes/{}/rotation"))||void 0===G?void 0:G.interpolation;break;case"scale":var a;d=null===(a=(0,w.i)("/nodes/{}/scale"))||void 0===a?void 0:a.interpolation;break;case"weights":var q;d=null===(q=(0,w.i)("/nodes/{}/weights"))||void 0===q?void 0:q.interpolation;break;default:throw new Error(`${Z}/target/path: Invalid value (${x.target.path})`)}if(!d)throw new Error(`${Z}/target/path: Could not find interpolation properties for target path (${x.target.path})`);const z={object:f,info:d};return await this._loadAnimationChannelFromTargetInfoAsync(Z,l,B,x,z,b)}_loadAnimationChannelFromTargetInfoAsync(Z,l,C,B,x,b){const K=this.parent.targetFps,f=1/K,W=y.Get(`${Z}/sampler`,C.samplers,B.sampler);return this._loadAnimationSamplerAsync(`${l}/samplers/${B.sampler}`,W).then((Z=>{let l=0;const W=x.object,J=x.info;for(const x of J){const J=x.getStride(W),d=Z.input,E=Z.output,G=new Array(d.length);let a=0;switch(Z.interpolation){case"STEP":for(let Z=0;Z<d.length;Z++){const l=x.getValue(W,E,a,1);a+=J,G[Z]={frame:d[Z]*K,value:l,interpolation:1}}break;case"CUBICSPLINE":for(let Z=0;Z<d.length;Z++){const l=x.getValue(W,E,a,f);a+=J;const C=x.getValue(W,E,a,1);a+=J;const B=x.getValue(W,E,a,f);a+=J,G[Z]={frame:d[Z]*K,inTangent:l,value:C,outTangent:B}}break;case"LINEAR":for(let Z=0;Z<d.length;Z++){const l=x.getValue(W,E,a,1);a+=J,G[Z]={frame:d[Z]*K,value:l}}}if(a>0){const Z=`${C.name||`animation${C.index}`}_channel${B.index}_${l}`,f=x.buildAnimations(W,Z,K,G);for(const C of f)l++,b(C.babylonAnimatable,C.babylonAnimation)}}}))}_loadAnimationSamplerAsync(Z,l){if(l._data)return l._data;const C=l.interpolation||"LINEAR";switch(C){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${Z}/interpolation: Invalid value (${l.interpolation})`)}const B=y.Get(`${Z}/input`,this._gltf.accessors,l.input),x=y.Get(`${Z}/output`,this._gltf.accessors,l.output);return l._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${B.index}`,B),this._loadFloatAccessorAsync(`/accessors/${x.index}`,x)]).then((Z=>{let[l,B]=Z;return{input:l,interpolation:C,output:B}})),l._data}loadBufferAsync(Z,l,C,B){const x=this._extensionsLoadBufferAsync(Z,l,C,B);if(x)return x;if(!l._data)if(l.uri)l._data=this.loadUriAsync(`${Z}/uri`,l,l.uri);else{if(!this._bin)throw new Error(`${Z}: Uri is missing or the binary glTF is missing its binary chunk`);l._data=this._bin.readAsync(0,l.byteLength)}return l._data.then((l=>{try{return new Uint8Array(l.buffer,l.byteOffset+C,B)}catch(x){throw new Error(`${Z}: ${x.message}`)}}))}loadBufferViewAsync(Z,l){const C=this._extensionsLoadBufferViewAsync(Z,l);if(C)return C;if(l._data)return l._data;const B=y.Get(`${Z}/buffer`,this._gltf.buffers,l.buffer);return l._data=this.loadBufferAsync(`/buffers/${B.index}`,B,l.byteOffset||0,l.byteLength),l._data}_loadAccessorAsync(Z,l,C){if(l._data)return l._data;const B=T._GetNumComponents(Z,l.type),x=B*n.h.GetTypeByteLength(l.componentType),b=B*l.count;if(void 0==l.bufferView)l._data=Promise.resolve(new C(b));else{const K=y.Get(`${Z}/bufferView`,this._gltf.bufferViews,l.bufferView);l._data=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K).then((f=>{if(5126!==l.componentType||l.normalized||K.byteStride&&K.byteStride!==x){const Z=new C(b);return n.h.ForEach(f,l.byteOffset||0,K.byteStride||x,B,l.componentType,Z.length,l.normalized||!1,((l,C)=>{Z[C]=l})),Z}return T._GetTypedArray(Z,l.componentType,f,l.byteOffset,b)}))}if(l.sparse){const b=l.sparse;l._data=l._data.then((K=>{const f=K,W=y.Get(`${Z}/sparse/indices/bufferView`,this._gltf.bufferViews,b.indices.bufferView),J=y.Get(`${Z}/sparse/values/bufferView`,this._gltf.bufferViews,b.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${W.index}`,W),this.loadBufferViewAsync(`/bufferViews/${J.index}`,J)]).then((K=>{let[W,J]=K;const d=T._GetTypedArray(`${Z}/sparse/indices`,b.indices.componentType,W,b.indices.byteOffset,b.count),E=B*b.count;let G;if(5126!==l.componentType||l.normalized){const K=T._GetTypedArray(`${Z}/sparse/values`,l.componentType,J,b.values.byteOffset,E);G=new C(E),n.h.ForEach(K,0,x,B,l.componentType,G.length,l.normalized||!1,((Z,l)=>{G[l]=Z}))}else G=T._GetTypedArray(`${Z}/sparse/values`,l.componentType,J,b.values.byteOffset,E);let a=0;for(let Z=0;Z<d.length;Z++){let l=d[Z]*B;for(let Z=0;Z<B;Z++)f[l++]=G[a++]}return f}))}))}return l._data}_loadFloatAccessorAsync(Z,l){return this._loadAccessorAsync(Z,l,Float32Array)}_loadIndicesAccessorAsync(Z,l){if("SCALAR"!==l.type)throw new Error(`${Z}/type: Invalid value ${l.type}`);if(5121!==l.componentType&&5123!==l.componentType&&5125!==l.componentType)throw new Error(`${Z}/componentType: Invalid value ${l.componentType}`);if(l._data)return l._data;if(l.sparse){const C=T._GetTypedArrayConstructor(`${Z}/componentType`,l.componentType);l._data=this._loadAccessorAsync(Z,l,C)}else{const C=y.Get(`${Z}/bufferView`,this._gltf.bufferViews,l.bufferView);l._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((C=>T._GetTypedArray(Z,l.componentType,C,l.byteOffset,l.count)))}return l._data}_loadVertexBufferViewAsync(Z){if(Z._babylonBuffer)return Z._babylonBuffer;const l=this._babylonScene.getEngine();return Z._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((Z=>new n.d(l,Z,!1))),Z._babylonBuffer}_loadVertexAccessorAsync(Z,l,C){var B;if(null!==(B=l._babylonVertexBuffer)&&void 0!==B&&B[C])return l._babylonVertexBuffer[C];l._babylonVertexBuffer||(l._babylonVertexBuffer={});const x=this._babylonScene.getEngine();if(l.sparse||void 0==l.bufferView)l._babylonVertexBuffer[C]=this._loadFloatAccessorAsync(Z,l).then((Z=>new n.h(x,Z,C,!1)));else{const B=y.Get(`${Z}/bufferView`,this._gltf.bufferViews,l.bufferView);l._babylonVertexBuffer[C]=this._loadVertexBufferViewAsync(B).then((b=>{const K=T._GetNumComponents(Z,l.type);return new n.h(x,b,C,!1,void 0,B.byteStride,void 0,l.byteOffset,K,l.componentType,l.normalized,!0,void 0,!0)}))}return l._babylonVertexBuffer[C]}_loadMaterialMetallicRoughnessPropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const B=new Array;return l&&(l.baseColorFactor?(C.albedoColor=b.Sl.il(l.baseColorFactor),C.alpha=l.baseColorFactor[3]):C.albedoColor=b.Sl.White(),C.metallic=void 0==l.metallicFactor?1:l.metallicFactor,C.roughness=void 0==l.roughnessFactor?1:l.roughnessFactor,l.baseColorTexture&&B.push(this.loadTextureInfoAsync(`${Z}/baseColorTexture`,l.baseColorTexture,(Z=>{Z.name=`${C.name} (Base Color)`,C.albedoTexture=Z}))),l.metallicRoughnessTexture&&(l.metallicRoughnessTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${Z}/metallicRoughnessTexture`,l.metallicRoughnessTexture,(Z=>{Z.name=`${C.name} (Metallic Roughness)`,C.metallicTexture=Z}))),C.useMetallnessFromMetallicTextureBlue=!0,C.useRoughnessFromMetallicTextureGreen=!0,C.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(B).then((()=>{}))}_loadMaterialAsync(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const b=this._extensionsLoadMaterialAsync(Z,l,C,B,x);if(b)return b;l._data=l._data||{};let K=l._data[B];if(!K){this.logOpen(`${Z} ${l.name||""}`);const C=this.createMaterial(Z,l,B);K={babylonMaterial:C,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(Z,l,C)},l._data[B]=K,T.AddPointerMetadata(C,Z),this._parent.onMaterialLoadedObservable.notifyObservers(C),this.logClose()}return C&&(K.babylonMeshes.push(C),C.xb.addOnce((()=>{const Z=K.babylonMeshes.indexOf(C);-1!==Z&&K.babylonMeshes.splice(Z,1)}))),x(K.babylonMaterial),K.promise.then((()=>K.babylonMaterial))}_createDefaultMaterial(Z,l){this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new i.e(Z,this._babylonScene);return C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.fillMode=l,C.enableSpecularAntiAliasing=!0,C.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,C.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,C.transparencyMode=i.e.PBRMATERIAL_OPAQUE,C.metallic=1,C.roughness=1,C}createMaterial(Z,l,C){const B=this._extensionsCreateMaterial(Z,l,C);if(B)return B;const x=l.name||`material${l.index}`;return this._createDefaultMaterial(x,C)}loadMaterialPropertiesAsync(Z,l,C){const B=this._extensionsLoadMaterialPropertiesAsync(Z,l,C);if(B)return B;const x=new Array;return x.push(this.loadMaterialBasePropertiesAsync(Z,l,C)),l.pbrMetallicRoughness&&x.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${Z}/pbrMetallicRoughness`,l.pbrMetallicRoughness,C)),this.loadMaterialAlphaProperties(Z,l,C),Promise.all(x).then((()=>{}))}loadMaterialBasePropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const B=new Array;return C.emissiveColor=l.emissiveFactor?b.Sl.il(l.emissiveFactor):new b.Sl(0,0,0),l.doubleSided&&(C.Ub=!1,C.twoSidedLighting=!0),l.normalTexture&&(l.normalTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${Z}/normalTexture`,l.normalTexture,(Z=>{Z.name=`${C.name} (Normal)`,C.bumpTexture=Z}))),C.invertNormalMapX=!this._babylonScene.useRightHandedSystem,C.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=l.normalTexture.scale&&C.bumpTexture&&(C.bumpTexture.level=l.normalTexture.scale),C.forceIrradianceInFragment=!0),l.occlusionTexture&&(l.occlusionTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${Z}/occlusionTexture`,l.occlusionTexture,(Z=>{Z.name=`${C.name} (Occlusion)`,C.ambientTexture=Z}))),C.useAmbientInGrayScale=!0,void 0!=l.occlusionTexture.strength&&(C.ambientTextureStrength=l.occlusionTexture.strength)),l.emissiveTexture&&B.push(this.loadTextureInfoAsync(`${Z}/emissiveTexture`,l.emissiveTexture,(Z=>{Z.name=`${C.name} (Emissive)`,C.emissiveTexture=Z}))),Promise.all(B).then((()=>{}))}loadMaterialAlphaProperties(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);switch(l.alphaMode||"OPAQUE"){case"OPAQUE":C.transparencyMode=i.e.PBRMATERIAL_OPAQUE,C.alpha=1;break;case"MASK":C.transparencyMode=i.e.PBRMATERIAL_ALPHATEST,C.alphaCutOff=void 0==l.alphaCutoff?.5:l.alphaCutoff,C.albedoTexture&&(C.albedoTexture.Pb=!0);break;case"BLEND":C.transparencyMode=i.e.PBRMATERIAL_ALPHABLEND,C.albedoTexture&&(C.albedoTexture.Pb=!0,C.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${Z}/alphaMode: Invalid value (${l.alphaMode})`)}}loadTextureInfoAsync(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadTextureInfoAsync(Z,l,C);if(B)return B;if(this.logOpen(`${Z}`),l.texCoord>=6)throw new Error(`${Z}/texCoord: Invalid value (${l.texCoord})`);const x=y.Get(`${Z}/index`,this._gltf.textures,l.index);x._textureInfo=l;const b=this._loadTextureAsync(`/textures/${l.index}`,x,(B=>{B.coordinatesIndex=l.texCoord||0,T.AddPointerMetadata(B,Z),this._parent.onTextureLoadedObservable.notifyObservers(B),C(B)}));return this.logClose(),b}_loadTextureAsync(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadTextureAsync(Z,l,C);if(B)return B;this.logOpen(`${Z} ${l.name||""}`);const x=void 0==l.sampler?T.DefaultSampler:y.Get(`${Z}/sampler`,this._gltf.samplers,l.sampler),b=y.Get(`${Z}/source`,this._gltf.images,l.source),K=this._createTextureAsync(Z,x,b,C,void 0,!l._textureInfo.nonColorData);return this.logClose(),K}_createTextureAsync(Z,l,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},b=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0;const f=this._loadSampler(`/samplers/${l.index}`,l),W=new Array,J=new B;this._babylonScene._blockEntityCollection=!!this._assetContainer;const d={noMipmap:f.noMipMaps,invertY:!1,samplingMode:f.samplingMode,p:()=>{this._disposed||J.resolve()},onError:(l,C)=>{this._disposed||J.reject(new Error(`${Z}: ${C&&C.message?C.message:l||"Failed to load texture"}`))},mimeType:C.mimeType??(0,k.g)(C.uri??""),loaderOptions:b,useSRGBBuffer:!!K&&this._parent.useSRGBBuffers},E=new s.c(null,this._babylonScene,d);return E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W.push(J.promise),W.push(this.loadImageAsync(`/images/${C.index}`,C).then((Z=>{const l=C.uri||`${this._fileName}#image${C.index}`,B=`data:${this._uniqueRootUrl}${l}`;E.updateURL(B,Z);const x=E.getInternalTexture();x&&(x.label=C.name)}))),E.wrapU=f.wrapU,E.wrapV=f.wrapV,x(E),this._parent.useGltfTextureNames&&(E.name=C.name||C.uri||`image${C.index}`),Promise.all(W).then((()=>E))}_loadSampler(Z,l){return l._data||(l._data={noMipMaps:9728===l.minFilter||9729===l.minFilter,samplingMode:T._GetTextureSamplingMode(Z,l),wrapU:T._GetTextureWrapMode(`${Z}/wrapS`,l.wrapS),wrapV:T._GetTextureWrapMode(`${Z}/wrapT`,l.wrapT)}),l._data}loadImageAsync(Z,l){if(!l._data){if(this.logOpen(`${Z} ${l.name||""}`),l.uri)l._data=this.loadUriAsync(`${Z}/uri`,l,l.uri);else{const C=y.Get(`${Z}/bufferView`,this._gltf.bufferViews,l.bufferView);l._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)}this.logClose()}return l._data}loadUriAsync(Z,l,C){const B=this._extensionsLoadUriAsync(Z,l,C);if(B)return B;if(!T._ValidateUri(C))throw new Error(`${Z}: '${C}' is invalid`);if((0,k.h)(C)){const l=new Uint8Array((0,k.b)(C));return this.log(`${Z}: Decoded ${C.substring(0,64)}... (${l.length} bytes)`),Promise.resolve(l)}return this.log(`${Z}: Loading ${C}`),this._parent.preprocessUrlAsync(this._rootUrl+C).then((l=>new Promise(((B,x)=>{this._parent._loadFile(this._babylonScene,l,(l=>{this._disposed||(this.log(`${Z}: Loaded ${C} (${l.byteLength} bytes)`),B(new Uint8Array(l)))}),!0,(l=>{x(new k.l(`${Z}: Failed to load '${C}'${l?": "+l.status+" "+l.statusText:""}`,l))}))}))))}static AddPointerMetadata(Z,l){Z.metadata=Z.metadata||{};const C=Z._internalMetadata=Z._internalMetadata||{},B=C.Eb=C.Eb||{};(B.pointers=B.pointers||[]).push(l)}static _GetTextureWrapMode(Z,l){switch(l=void 0==l?10497:l){case 33071:return s.c.CLAMP_ADDRESSMODE;case 33648:return s.c.MIRROR_ADDRESSMODE;case 10497:return s.c.WRAP_ADDRESSMODE;default:return z.e.Warn(`${Z}: Invalid value (${l})`),s.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(Z,l){const C=void 0==l.magFilter?9729:l.magFilter,B=void 0==l.minFilter?9987:l.minFilter;if(9729===C)switch(B){case 9728:return s.c.LINEAR_NEAREST;case 9729:return s.c.LINEAR_LINEAR;case 9984:return s.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return s.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return s.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return s.c.LINEAR_LINEAR_MIPLINEAR;default:return z.e.Warn(`${Z}/minFilter: Invalid value (${B})`),s.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==C&&z.e.Warn(`${Z}/magFilter: Invalid value (${C})`),B){case 9728:return s.c.NEAREST_NEAREST;case 9729:return s.c.NEAREST_LINEAR;case 9984:return s.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return s.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return s.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return s.c.NEAREST_LINEAR_MIPLINEAR;default:return z.e.Warn(`${Z}/minFilter: Invalid value (${B})`),s.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(Z,l){try{return(0,D.n)(l)}catch(C){throw new Error(`${Z}: ${C.message}`)}}static _GetTypedArray(Z,l,C,B,x){const b=C.buffer;B=C.byteOffset+(B||0);const K=T._GetTypedArrayConstructor(`${Z}/componentType`,l),f=n.h.GetTypeByteLength(l);return B%f!==0?(z.e.Warn(`${Z}: Copying buffer as byte offset (${B}) is not a multiple of component type byte length (${f})`),new K(b.slice(B,B+x*f),0)):new K(b,B,x)}static _GetNumComponents(Z,l){switch(l){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${Z}: Invalid type (${l})`)}static _ValidateUri(Z){return K.Tools.IsBase64(Z)||-1===Z.indexOf("..")}static _GetDrawMode(Z,l){switch(void 0==l&&(l=4),l){case 0:return S.b.PointListDrawMode;case 1:return S.b.LineListDrawMode;case 2:return S.b.LineLoopDrawMode;case 3:return S.b.LineStripDrawMode;case 4:return S.b.TriangleFillMode;case 5:return S.b.TriangleStripDrawMode;case 6:return S.b.TriangleFanDrawMode}throw new Error(`${Z}: Invalid mesh primitive mode (${l})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const Z=new Array;if(this._gltf.materials)for(const l of this._gltf.materials)if(l._data)for(const C in l._data){const B=l._data[C];for(const l of B.babylonMeshes){l.Fb(!0);const C=B.babylonMaterial;Z.push(C.forceCompilationAsync(l)),Z.push(C.forceCompilationAsync(l,{useInstances:!0})),this._parent.useClipPlane&&(Z.push(C.forceCompilationAsync(l,{clipPlane:!0})),Z.push(C.forceCompilationAsync(l,{clipPlane:!0,useInstances:!0})))}}return Promise.all(Z).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const Z=new Array,l=this._babylonScene.lights;for(const C of l){const l=C.getShadowGenerator();l&&Z.push(l.forceCompilationAsync())}return Promise.all(Z).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(Z){for(const l of this._extensions)l.enabled&&Z(l)}_applyExtensions(Z,l,C){for(const B of this._extensions)if(B.enabled){const x=`${B.name}.${l}`,b=Z;b._activeLoaderExtensionFunctions=b._activeLoaderExtensionFunctions||{};const K=b._activeLoaderExtensionFunctions;if(!K[x]){K[x]=!0;try{const Z=C(B);if(Z)return Z}finally{delete K[x]}}}return null}_extensionsOnLoading(){this._forEachExtensions((Z=>Z.onLoading&&Z.onLoading()))}_extensionsOnReady(){this._forEachExtensions((Z=>Z.onReady&&Z.onReady()))}_extensionsLoadSceneAsync(Z,l){return this._applyExtensions(l,"loadScene",(C=>C.loadSceneAsync&&C.loadSceneAsync(Z,l)))}_extensionsLoadNodeAsync(Z,l,C){return this._applyExtensions(l,"loadNode",(B=>B.loadNodeAsync&&B.loadNodeAsync(Z,l,C)))}_extensionsLoadCameraAsync(Z,l,C){return this._applyExtensions(l,"loadCamera",(B=>B.loadCameraAsync&&B.loadCameraAsync(Z,l,C)))}_extensionsLoadVertexDataAsync(Z,l,C){return this._applyExtensions(l,"loadVertexData",(B=>B._loadVertexDataAsync&&B._loadVertexDataAsync(Z,l,C)))}_extensionsLoadMeshPrimitiveAsync(Z,l,C,B,x,b){return this._applyExtensions(x,"loadMeshPrimitive",(K=>K._loadMeshPrimitiveAsync&&K._loadMeshPrimitiveAsync(Z,l,C,B,x,b)))}_extensionsLoadMaterialAsync(Z,l,C,B,x){return this._applyExtensions(l,"loadMaterial",(b=>b._loadMaterialAsync&&b._loadMaterialAsync(Z,l,C,B,x)))}_extensionsCreateMaterial(Z,l,C){return this._applyExtensions(l,"createMaterial",(B=>B.createMaterial&&B.createMaterial(Z,l,C)))}_extensionsLoadMaterialPropertiesAsync(Z,l,C){return this._applyExtensions(l,"loadMaterialProperties",(B=>B.loadMaterialPropertiesAsync&&B.loadMaterialPropertiesAsync(Z,l,C)))}_extensionsLoadTextureInfoAsync(Z,l,C){return this._applyExtensions(l,"loadTextureInfo",(B=>B.loadTextureInfoAsync&&B.loadTextureInfoAsync(Z,l,C)))}_extensionsLoadTextureAsync(Z,l,C){return this._applyExtensions(l,"loadTexture",(B=>B._loadTextureAsync&&B._loadTextureAsync(Z,l,C)))}_extensionsLoadAnimationAsync(Z,l){return this._applyExtensions(l,"loadAnimation",(C=>C.loadAnimationAsync&&C.loadAnimationAsync(Z,l)))}_extensionsLoadAnimationChannelAsync(Z,l,C,B,x){return this._applyExtensions(C,"loadAnimationChannel",(b=>b._loadAnimationChannelAsync&&b._loadAnimationChannelAsync(Z,l,C,B,x)))}_extensionsLoadSkinAsync(Z,l,C){return this._applyExtensions(C,"loadSkin",(B=>B._loadSkinAsync&&B._loadSkinAsync(Z,l,C)))}_extensionsLoadUriAsync(Z,l,C){return this._applyExtensions(l,"loadUri",(B=>B._loadUriAsync&&B._loadUriAsync(Z,l,C)))}_extensionsLoadBufferViewAsync(Z,l){return this._applyExtensions(l,"loadBufferView",(C=>C.loadBufferViewAsync&&C.loadBufferViewAsync(Z,l)))}_extensionsLoadBufferAsync(Z,l,C,B){return this._applyExtensions(l,"loadBuffer",(x=>x.loadBufferAsync&&x.loadBufferAsync(Z,l,C,B)))}static LoadExtensionAsync(Z,l,C,B){if(!l.extensions)return null;const x=l.extensions[C];return x?B(`${Z}/extensions/${C}`,x):null}static LoadExtraAsync(Z,l,C,B){if(!l.extras)return null;const x=l.extras[C];return x?B(`${Z}/extras/${C}`,x):null}isExtensionUsed(Z){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(Z)}logOpen(Z){this._parent._logOpen(Z)}logClose(){this._parent._logClose()}log(Z){this._parent._log(Z)}startPerformanceCounter(Z){this._parent._startPerformanceCounter(Z)}endPerformanceCounter(Z){this._parent._endPerformanceCounter(Z)}}T.DefaultSampler={index:-1},R.e._CreateGLTF2Loader=Z=>new T(Z);var u=C(13790),H=C(12652),Q=C(12478),h=C(13793),A=C(13798);class L extends A.d{constructor(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",Z),this._texture=Z.getEngine().createRawCubeTexture(l,C,B,x,b,K,f,W)}update(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,Z,l,C,B,x)}updateRGBDAsync(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,h.j)(this._texture,Z,l,C,B).then((()=>{}))}clone(){return Q.b.Clone((()=>{const Z=this.cZ(),l=this._texture,C=new L(Z,l._bufferViewArray,l.width,l.format,l.type,l.generateMipMaps,l.invertY,l.samplingMode,l._compression);return 13===l.source&&C.updateRGBDAsync(l._bufferViewArrayArray,l._sphericalPolynomial,l._lodGenerationScale,l._lodGenerationOffset),C}),this)}}const p="EXT_lights_image_based";class N{constructor(Z){this.name=p,this._loader=Z,this.enabled=this._loader.isExtensionUsed(p)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Eb.extensions;if(Z&&Z[this.name]){const l=Z[this.name];this._lights=l.lights}}loadSceneAsync(Z,l){return T.LoadExtensionAsync(Z,l,this.name,(async(C,B)=>{this._loader._allMaterialsDirtyRequired=!0;const x=new Array;x.push(this._loader.loadSceneAsync(Z,l)),this._loader.logOpen(`${C}`);const b=y.Get(`${C}/light`,this._lights,B.Zb);return x.push(this._loadLightAsync(`/extensions/${this.name}/lights/${B.Zb}`,b).then((Z=>{this._loader.babylonScene.environmentTexture=Z}))),this._loader.logClose(),await Promise.all(x).then((()=>{}))}))}_loadLightAsync(Z,l){if(!l._loaded){const C=new Array;this._loader.logOpen(`${Z}`);const B=new Array(l.specularImages.length);for(let x=0;x<l.specularImages.length;x++){const b=l.specularImages[x];B[x]=new Array(b.length);for(let l=0;l<b.length;l++){const K=`${Z}/specularImages/${x}/${l}`;this._loader.logOpen(`${K}`);const f=b[l],W=y.Get(K,this._loader.Eb.images,f);C.push(this._loader.loadImageAsync(`/images/${f}`,W).then((Z=>{B[x][l]=Z}))),this._loader.logClose()}}this._loader.logClose(),l._loaded=Promise.all(C).then((async()=>{const C=new L(this._loader.babylonScene,null,l.specularImageSize);if(C.name=l.name||"environment",l._babylonTexture=C,void 0!=l.jb&&(C.level=l.jb),l.rotation){let Z=x.Quaternion.il(l.rotation);this._loader.babylonScene.useRightHandedSystem||(Z=x.Quaternion.Inverse(Z)),x.Matrix.FromQuaternionToRef(Z,C.getReflectionTextureMatrix())}if(!l.irradianceCoefficients)throw new Error(`${Z}: Irradiance coefficients are missing`);const b=H.d.il(l.irradianceCoefficients);b.scaleInPlace(l.jb),b.convertIrradianceToLambertianRadiance();const K=H.g.FromHarmonics(b),f=(B.length-1)/Math.log2(l.specularImageSize);return await C.updateRGBDAsync(B,K,f)}))}return l._loaded.then((()=>l._babylonTexture))}}I(p),M(p,!0,(Z=>new N(Z)));C(12987);const mZ="EXT_mesh_gpu_instancing";class ZZ{constructor(Z){this.name=mZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(mZ)}dispose(){this._loader=null}loadNodeAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(Z,B)=>{this._loader._disableInstancedMesh++;const b=this._loader.loadNodeAsync(`/nodes/${l.index}`,l,C);if(this._loader._disableInstancedMesh--,!l._primitiveBabylonMeshes)return await b;const K=new Array;let f=0;const W=l=>{if(void 0==B.attributes[l])return void K.push(Promise.resolve(null));const C=y.Get(`${Z}/attributes/${l}`,this._loader.Eb.accessors,B.attributes[l]);if(K.push(this._loader._loadFloatAccessorAsync(`/accessors/${C.bufferView}`,C)),0===f)f=C.count;else if(f!==C.count)throw new Error(`${Z}/attributes: Instance buffer accessors do not have the same count.`)};return W("TRANSLATION"),W("ROTATION"),W("SCALE"),await b.then((async Z=>{const[C,B,b]=await Promise.all(K),W=new Float32Array(16*f);x.TmpVectors.ql[0].rb(0,0,0),x.TmpVectors.Quaternion[0].rb(0,0,0,1),x.TmpVectors.ql[1].rb(1,1,1);for(let l=0;l<f;++l)C&&x.ql.FromArrayToRef(C,3*l,x.TmpVectors.ql[0]),B&&x.Quaternion.FromArrayToRef(B,4*l,x.TmpVectors.Quaternion[0]),b&&x.ql.FromArrayToRef(b,3*l,x.TmpVectors.ql[1]),x.Matrix.ComposeToRef(x.TmpVectors.ql[1],x.TmpVectors.Quaternion[0],x.TmpVectors.ql[0],x.TmpVectors.Matrix[0]),x.TmpVectors.Matrix[0].copyToArray(W,16*l);for(const x of l._primitiveBabylonMeshes)x.tG("matrix",W,16,!0);return Z}))}))}}I(mZ),M(mZ,!0,(Z=>new ZZ(Z)));let lZ=0,CZ=null;class BZ{static get Default(){return BZ._Default||(BZ._Default=new BZ),BZ._Default}constructor(){const Z=BZ.Configuration.decoder;this._decoderModulePromise=K.Tools.LoadBabylonScriptAsync(Z.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(Z,l,C,B,x){await this._decoderModulePromise,0===lZ&&(MeshoptDecoder.useWorkers(1),lZ=1);const b=await MeshoptDecoder.decodeGltfBufferAsync(l,C,Z,B,x);return null!==CZ&&clearTimeout(CZ),CZ=setTimeout((()=>{MeshoptDecoder.useWorkers(0),lZ=0,CZ=null}),1e3),b}}BZ.Configuration={decoder:{url:`${K.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},BZ._Default=null;const xZ="EXT_meshopt_compression";class bZ{constructor(Z){this.name=xZ,this.enabled=Z.isExtensionUsed(xZ),this._loader=Z}dispose(){this._loader=null}loadBufferViewAsync(Z,l){return T.LoadExtensionAsync(Z,l,this.name,(async(C,B)=>{const x=l;if(x._meshOptData)return await x._meshOptData;const b=y.Get(`${Z}/buffer`,this._loader.Eb.buffers,B.buffer);return x._meshOptData=this._loader.loadBufferAsync(`/buffers/${b.index}`,b,B.byteOffset||0,B.byteLength).then((async Z=>await BZ.Default.decodeGltfBufferAsync(Z,B.count,B.byteStride,B.mode,B.filter))),await x._meshOptData}))}}I(xZ),M(xZ,!0,(Z=>new bZ(Z)));const KZ="EXT_texture_webp";class fZ{constructor(Z){this.name=KZ,this._loader=Z,this.enabled=Z.isExtensionUsed(KZ)}dispose(){this._loader=null}_loadTextureAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=void 0==l.sampler?T.DefaultSampler:y.Get(`${Z}/sampler`,this._loader.Eb.samplers,l.sampler),K=y.Get(`${B}/source`,this._loader.Eb.images,x.source);return await this._loader._createTextureAsync(Z,b,K,(Z=>{C(Z)}),void 0,!l._textureInfo.nonColorData)}))}}I(KZ),M(KZ,!0,(Z=>new fZ(Z)));const WZ="EXT_texture_avif";class JZ{constructor(Z){this.name=WZ,this._loader=Z,this.enabled=Z.isExtensionUsed(WZ)}dispose(){this._loader=null}_loadTextureAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=void 0==l.sampler?T.DefaultSampler:y.Get(`${Z}/sampler`,this._loader.Eb.samplers,l.sampler),K=y.Get(`${B}/source`,this._loader.Eb.images,x.source);return await this._loader._createTextureAsync(Z,b,K,(Z=>{C(Z)}),void 0,!l._textureInfo.nonColorData)}))}}I(WZ),M(WZ,!0,(Z=>new JZ(Z)));var dZ=C(13785),EZ=C(12960);const GZ="EXT_lights_ies";class aZ{constructor(Z){this.name=GZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(GZ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Eb.extensions;if(Z&&Z[this.name]){const l=Z[this.name];this._lights=l.lights,y.Assign(this._lights)}}loadNodeAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,K)=>{let f,W;this._loader._allMaterialsDirtyRequired=!0;const J=await this._loader.loadNodeAsync(Z,l,(Z=>{W=y.Get(B,this._lights,K.Zb);const l=W.name||Z.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,f=new dZ.d(l,x.ql.Zero(),x.ql.Backward(),0,1,this._loader.babylonScene),f.angle=Math.PI/2,f.innerAngle=0,f._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,W._babylonLight=f,f.falloffType=EZ.d.FALLOFF_GLTF,f.Mb=K.color?b.Sl.il(K.color):b.Sl.White(),f.jb=K.multiplier||1,f.range=Number.MAX_VALUE,f.parent=Z,this._loader._babylonLights.push(f),T.AddPointerMetadata(f,B),C(Z)}));let d;if(W.uri)d=await this._loader.loadUriAsync(Z,W,W.uri);else{const l=y.Get(`${Z}/bufferView`,this._loader.Eb.bufferViews,W.bufferView);d=await this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l)}return f.iesProfileTexture=new s.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,d,!0,void 0,void 0,void 0,void 0,".ies"),J}))}}I(GZ),M(GZ,!0,(Z=>new aZ(Z)));var qZ=C(13810);const zZ="KHR_draco_mesh_compression";class YZ{constructor(Z){this.name=zZ,this.useNormalizedFlagFromAccessor=!0,this._loader=Z,this.enabled=qZ.c.DefaultAvailable&&this._loader.isExtensionUsed(zZ)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{if(void 0!=l.mode&&4!==l.mode&&5!==l.mode)throw new Error(`${Z}: Unsupported mode ${l.mode}`);const b={},K={},f=(Z,B)=>{const f=x.attributes[Z];if(void 0!=f&&(C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(B)&&C._delayInfo.push(B),b[B]=f,this.useNormalizedFlagFromAccessor)){const C=y.TryGet(this._loader.Eb.accessors,l.attributes[Z]);C&&(K[B]=C.normalized||!1)}};f("POSITION",n.h.PositionKind),f("NORMAL",n.h.NormalKind),f("TANGENT",n.h.TangentKind),f("TEXCOORD_0",n.h.UVKind),f("TEXCOORD_1",n.h.UV2Kind),f("TEXCOORD_2",n.h.UV3Kind),f("TEXCOORD_3",n.h.UV4Kind),f("TEXCOORD_4",n.h.UV5Kind),f("TEXCOORD_5",n.h.UV6Kind),f("JOINTS_0",n.h.MatricesIndicesKind),f("WEIGHTS_0",n.h.MatricesWeightsKind),f("COLOR_0",n.h.ColorKind);const W=y.Get(B,this._loader.Eb.bufferViews,x.bufferView);return W._dracoBabylonGeometry||(W._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${W.index}`,W).then((async B=>{const x=this.dracoDecoder||qZ.c.Default,f=y.TryGet(this._loader.Eb.accessors,l.attributes.POSITION),W=this._loader.parent.alwaysComputeBoundingBox||C.skeleton||!f?null:X(f);return await x._decodeMeshToGeometryForGltfAsync(C.name,this._loader.babylonScene,B,b,K,W).catch((l=>{throw new Error(`${Z}: ${l.message}`)}))}))),await W._dracoBabylonGeometry}))}}I(zZ),M(zZ,!0,(Z=>new YZ(Z)));var PZ=C(13813),SZ=C(12428),iZ=C(12432),sZ=C(12850),FZ=C(13020),nZ=C(12400);sZ.d.AddNodeConstructor("Light_Type_0",((Z,l)=>()=>new cZ(Z,x.ql.Zero(),l)));class cZ extends FZ.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(Z){this._shadowAngle=Z,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(Z){const l=this.needCube();if(this._direction=Z,this.needCube()!==l&&this._shadowGenerators){const Z=this._shadowGenerators.values();for(let l=Z.next();!0!==l.done;l=Z.next()){l.value.recreateShadowMap()}}}constructor(Z,l,C){super(Z,C),this._shadowAngle=Math.PI/2,this.position=l}getClassName(){return"PointLight"}getTypeID(){return EZ.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(Z){if(this.direction)return super.getShadowDirection(Z);switch(Z){case 0:return new x.ql(1,0,0);case 1:return new x.ql(-1,0,0);case 2:return new x.ql(0,-1,0);case 3:return new x.ql(0,1,0);case 4:return new x.ql(0,0,1);case 5:return new x.ql(0,0,-1)}return x.ql.Zero()}_setDefaultShadowProjectionMatrix(Z,l,C){const B=this.cZ().activeCamera;if(!B)return;const b=void 0!==this.shadowMinZ?this.shadowMinZ:B.ib,K=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,f=this.cZ().getEngine().lb;x.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,f?K:b,f?b:K,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,f)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Z,l){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,l):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,l),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,l),this}transferToNodeMaterialEffect(Z,l){return this.computeTransformedInformation()?Z.setFloat3(l,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):Z.setFloat3(l,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(Z,l){Z["POINTLIGHT"+l]=!0}}(0,SZ.b)([(0,iZ.R)()],cZ.prototype,"shadowAngle",null),(0,nZ.c)("BABYLON.PointLight",cZ);const UZ="KHR_lights_punctual";class tZ{constructor(Z){this.name=UZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(UZ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Eb.extensions;if(Z&&Z[this.name]){const l=Z[this.name];this._lights=l.lights,y.Assign(this._lights)}}loadNodeAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,K)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(Z,l,(Z=>{let l;const f=y.Get(B,this._lights,K.Zb),W=f.name||Z.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,f.type){case"directional":{const Z=new PZ.e(W,x.ql.Backward(),this._loader.babylonScene);Z.position.ob(0),l=Z;break}case"point":l=new cZ(W,x.ql.Zero(),this._loader.babylonScene);break;case"spot":{const Z=new dZ.d(W,x.ql.Zero(),x.ql.Backward(),0,1,this._loader.babylonScene);Z.angle=2*(f.spot&&f.spot.outerConeAngle||Math.PI/4),Z.innerAngle=2*(f.spot&&f.spot.innerConeAngle||0),l=Z;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${B}: Invalid light type (${f.type})`)}l._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,f._babylonLight=l,l.falloffType=EZ.d.FALLOFF_GLTF,l.Mb=f.color?b.Sl.il(f.color):b.Sl.White(),l.jb=void 0==f.jb?1:f.jb,l.range=void 0==f.range?Number.MAX_VALUE:f.range,l.parent=Z,this._loader._babylonLights.push(l),T.AddPointerMetadata(l,B),C(Z)})))))}}I(UZ),M(UZ,!0,(Z=>new tZ(Z)));const rZ="KHR_materials_pbrSpecularGlossiness";class eZ{constructor(Z){this.name=rZ,this.order=200,this._loader=Z,this.enabled=this._loader.isExtensionUsed(rZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;return b.push(this._loader.loadMaterialBasePropertiesAsync(Z,l,C)),b.push(this._loadSpecularGlossinessPropertiesAsync(B,x,C)),this._loader.loadMaterialAlphaProperties(Z,l,C),await Promise.all(b).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const B=new Array;return C.metallic=null,C.roughness=null,l.diffuseFactor?(C.albedoColor=b.Sl.il(l.diffuseFactor),C.alpha=l.diffuseFactor[3]):C.albedoColor=b.Sl.White(),C.reflectivityColor=l.specularFactor?b.Sl.il(l.specularFactor):b.Sl.White(),C.microSurface=void 0==l.glossinessFactor?1:l.glossinessFactor,l.diffuseTexture&&B.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTexture`,l.diffuseTexture,(Z=>{Z.name=`${C.name} (Diffuse)`,C.albedoTexture=Z}))),l.specularGlossinessTexture&&(B.push(this._loader.loadTextureInfoAsync(`${Z}/specularGlossinessTexture`,l.specularGlossinessTexture,(Z=>{Z.name=`${C.name} (Specular Glossiness)`,C.reflectivityTexture=Z,C.reflectivityTexture.Pb=!0}))),C.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(B).then((()=>{}))}}I(rZ),M(rZ,!0,(Z=>new eZ(Z)));const oZ="KHR_materials_unlit";class vZ{constructor(Z){this.name=oZ,this.order=210,this._loader=Z,this.enabled=this._loader.isExtensionUsed(oZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async()=>await this._loadUnlitPropertiesAsync(Z,l,C)))}_loadUnlitPropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const B=new Array;C.unlit=!0;const x=l.pbrMetallicRoughness;return x&&(x.baseColorFactor?(C.albedoColor=b.Sl.il(x.baseColorFactor),C.alpha=x.baseColorFactor[3]):C.albedoColor=b.Sl.White(),x.baseColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${Z}/baseColorTexture`,x.baseColorTexture,(Z=>{Z.name=`${C.name} (Base Color)`,C.albedoTexture=Z})))),l.doubleSided&&(C.Ub=!1,C.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(Z,l,C),Promise.all(B).then((()=>{}))}}I(oZ),M(oZ,!0,(Z=>new vZ(Z)));const RZ="KHR_materials_clearcoat";class kZ{constructor(Z){this.name=RZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(RZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadClearCoatPropertiesAsync(B,x,C)),await Promise.all(b)}))}_loadClearCoatPropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const B=new Array;return C.clearCoat.isEnabled=!0,C.clearCoat.useRoughnessFromMainTexture=!1,C.clearCoat.remapF0OnInterfaceChange=!1,void 0!=l.clearcoatFactor?C.clearCoat.jb=l.clearcoatFactor:C.clearCoat.jb=0,l.clearcoatTexture&&B.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatTexture`,l.clearcoatTexture,(Z=>{Z.name=`${C.name} (ClearCoat)`,C.clearCoat.texture=Z}))),void 0!=l.clearcoatRoughnessFactor?C.clearCoat.roughness=l.clearcoatRoughnessFactor:C.clearCoat.roughness=0,l.clearcoatRoughnessTexture&&(l.clearcoatRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatRoughnessTexture`,l.clearcoatRoughnessTexture,(Z=>{Z.name=`${C.name} (ClearCoat Roughness)`,C.clearCoat.textureRoughness=Z})))),l.clearcoatNormalTexture&&(l.clearcoatNormalTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatNormalTexture`,l.clearcoatNormalTexture,(Z=>{Z.name=`${C.name} (ClearCoat Normal)`,C.clearCoat.bumpTexture=Z}))),C.invertNormalMapX=!C.cZ().useRightHandedSystem,C.invertNormalMapY=C.cZ().useRightHandedSystem,void 0!=l.clearcoatNormalTexture.scale&&(C.clearCoat.bumpTexture.level=l.clearcoatNormalTexture.scale)),Promise.all(B).then((()=>{}))}}I(RZ),M(RZ,!0,(Z=>new kZ(Z)));const VZ="KHR_materials_iridescence";class gZ{constructor(Z){this.name=VZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(VZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadIridescencePropertiesAsync(B,x,C)),await Promise.all(b).then((()=>{}))}))}_loadIridescencePropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const B=new Array;return C.iridescence.isEnabled=!0,C.iridescence.jb=l.iridescenceFactor??0,C.iridescence.indexOfRefraction=l.iridescenceIor??l.iridescenceIOR??1.3,C.iridescence.minimumThickness=l.iridescenceThicknessMinimum??100,C.iridescence.maximumThickness=l.iridescenceThicknessMaximum??400,l.iridescenceTexture&&B.push(this._loader.loadTextureInfoAsync(`${Z}/iridescenceTexture`,l.iridescenceTexture,(Z=>{Z.name=`${C.name} (Iridescence)`,C.iridescence.texture=Z}))),l.iridescenceThicknessTexture&&B.push(this._loader.loadTextureInfoAsync(`${Z}/iridescenceThicknessTexture`,l.iridescenceThicknessTexture,(Z=>{Z.name=`${C.name} (Iridescence Thickness)`,C.iridescence.thicknessTexture=Z}))),Promise.all(B).then((()=>{}))}}I(VZ),M(VZ,!0,(Z=>new gZ(Z)));const jZ="KHR_materials_anisotropy";class MZ{constructor(Z){this.name=jZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(jZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadIridescencePropertiesAsync(B,x,C)),await Promise.all(b)}))}async _loadIridescencePropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const B=new Array;C.anisotropy.isEnabled=!0,C.anisotropy.jb=l.anisotropyStrength??0,C.anisotropy.angle=l.anisotropyRotation??0,l.anisotropyTexture&&(l.anisotropyTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${Z}/anisotropyTexture`,l.anisotropyTexture,(Z=>{Z.name=`${C.name} (Anisotropy Intensity)`,C.anisotropy.texture=Z})))),await Promise.all(B)}}I(jZ),M(jZ,!0,(Z=>new MZ(Z)));const IZ="KHR_materials_emissive_strength";class wZ{constructor(Z){this.name=IZ,this.order=170,this._loader=Z,this.enabled=this._loader.isExtensionUsed(IZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>await this._loader.loadMaterialPropertiesAsync(Z,l,C).then((()=>{this._loadEmissiveProperties(B,x,C)}))))}_loadEmissiveProperties(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);void 0!==l.emissiveStrength&&(C.emissiveIntensity=l.emissiveStrength)}}I(IZ),M(IZ,!0,(Z=>new wZ(Z)));const OZ="KHR_materials_sheen";class DZ{constructor(Z){this.name=OZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(OZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadSheenPropertiesAsync(B,x,C)),await Promise.all(b).then((()=>{}))}))}_loadSheenPropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const B=new Array;return C.sheen.isEnabled=!0,C.sheen.jb=1,void 0!=l.sheenColorFactor?C.sheen.color=b.Sl.il(l.sheenColorFactor):C.sheen.color=b.Sl.Black(),l.sheenColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${Z}/sheenColorTexture`,l.sheenColorTexture,(Z=>{Z.name=`${C.name} (Sheen Color)`,C.sheen.texture=Z}))),void 0!==l.sheenRoughnessFactor?C.sheen.roughness=l.sheenRoughnessFactor:C.sheen.roughness=0,l.sheenRoughnessTexture&&(l.sheenRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${Z}/sheenRoughnessTexture`,l.sheenRoughnessTexture,(Z=>{Z.name=`${C.name} (Sheen Roughness)`,C.sheen.textureRoughness=Z})))),C.sheen.albedoScaling=!0,C.sheen.useRoughnessFromMainTexture=!1,Promise.all(B).then((()=>{}))}}I(OZ),M(OZ,!0,(Z=>new DZ(Z)));var yZ=C(12906);const XZ="KHR_materials_specular";class TZ{constructor(Z){this.name=XZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(XZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;if(b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadSpecularPropertiesAsync(B,x,C)),x.extensions&&x.extensions.EXT_materials_specular_edge_color&&C instanceof i.e){x.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(C.brdf.dielectricSpecularModel=yZ.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,C.brdf.conductorSpecularModel=yZ.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(b).then((()=>{}))}))}_loadSpecularPropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const B=new Array;return void 0!==l.specularFactor&&(C.metallicF0Factor=l.specularFactor),void 0!==l.specularColorFactor&&(C.metallicReflectanceColor=b.Sl.il(l.specularColorFactor)),l.specularTexture&&(l.specularTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${Z}/specularTexture`,l.specularTexture,(Z=>{Z.name=`${C.name} (Specular)`,C.metallicReflectanceTexture=Z,C.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),l.specularColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${Z}/specularColorTexture`,l.specularColorTexture,(Z=>{Z.name=`${C.name} (Specular Color)`,C.reflectanceTexture=Z}))),Promise.all(B).then((()=>{}))}}I(XZ),M(XZ,!0,(Z=>new TZ(Z)));const uZ="KHR_materials_ior";class HZ{constructor(Z){this.name=uZ,this.order=180,this._loader=Z,this.enabled=this._loader.isExtensionUsed(uZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadIorPropertiesAsync(B,x,C)),await Promise.all(b).then((()=>{}))}))}_loadIorPropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);return void 0!==l.ior?C.indexOfRefraction=l.ior:C.indexOfRefraction=HZ._DEFAULT_IOR,Promise.resolve()}}HZ._DEFAULT_IOR=1.5,I(uZ),M(uZ,!0,(Z=>new HZ(Z)));const QZ="KHR_materials_variants";class hZ{constructor(Z){this.name=QZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(QZ)}dispose(){this._loader=null}static GetAvailableVariants(Z){const l=this._GetExtensionMetadata(Z);return l?Object.keys(l.variants):[]}getAvailableVariants(Z){return hZ.GetAvailableVariants(Z)}static SelectVariant(Z,l){const C=this._GetExtensionMetadata(Z);if(!C)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${QZ} extension`);const B=Z=>{const l=C.variants[Z];if(l)for(const C of l)C.mesh.material=C.material};if(l instanceof Array)for(const x of l)B(x);else B(l);C.lastSelected=l}selectVariant(Z,l){hZ.SelectVariant(Z,l)}static Reset(Z){const l=this._GetExtensionMetadata(Z);if(!l)throw new Error(`Cannot reset on a glTF mesh that does not have the ${QZ} extension`);for(const C of l.original)C.mesh.material=C.material;l.lastSelected=null}reset(Z){hZ.Reset(Z)}static GetLastSelectedVariant(Z){const l=this._GetExtensionMetadata(Z);if(!l)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${QZ} extension`);return l.lastSelected}getLastSelectedVariant(Z){return hZ.GetLastSelectedVariant(Z)}static _GetExtensionMetadata(Z){var l,C;return(null===Z||void 0===Z||null===(l=Z._internalMetadata)||void 0===l||null===(C=l.Eb)||void 0===C?void 0:C[QZ])||null}onLoading(){const Z=this._loader.Eb.extensions;if(Z&&Z[this.name]){const l=Z[this.name];this._variants=l.variants}}onReady(){const Z=this._loader.rootBabylonMesh;if(Z){var l;const C=this._loader.parent.extensionOptions[QZ];null!==C&&void 0!==C&&C.defaultVariant&&hZ.SelectVariant(Z,C.defaultVariant),null===C||void 0===C||null===(l=C.onLoaded)||void 0===l||l.call(C,{get variants(){return hZ.GetAvailableVariants(Z)},get selectedVariant(){const l=hZ.GetLastSelectedVariant(Z);return l?Array.isArray(l)?l[0]:l:hZ.GetAvailableVariants(Z)[0]},set selectedVariant(l){hZ.SelectVariant(Z,l)}})}}_loadMeshPrimitiveAsync(Z,l,C,B,x,b){return T.LoadExtensionAsync(Z,x,this.name,(async(K,f)=>{const W=new Array;return W.push(this._loader._loadMeshPrimitiveAsync(Z,l,C,B,x,(l=>{if(b(l),l instanceof t.b){const C=T._GetDrawMode(Z,x.mode),B=this._loader.rootBabylonMesh,b=B?B._internalMetadata=B._internalMetadata||{}:{},J=b.Eb=b.Eb||{},d=J[QZ]=J[QZ]||{lastSelected:null,original:[],variants:{}};d.original.push({mesh:l,material:l.material});for(let Z=0;Z<f.mappings.length;++Z){const x=f.mappings[Z],b=y.Get(`${K}/mappings/${Z}/material`,this._loader.Eb.materials,x.material);W.push(this._loader._loadMaterialAsync(`#/materials/${x.material}`,b,l,C,(Z=>{for(let C=0;C<x.variants.length;++C){const b=x.variants[C],K=y.Get(`/extensions/${QZ}/variants/${b}`,this._variants,b);d.variants[K.name]=d.variants[K.name]||[],d.variants[K.name].push({mesh:l,material:Z}),l.onClonedObservable.add((Z=>{const C=Z;let x=null,b=C;do{if(b=b.parent,!b)return;x=hZ._GetExtensionMetadata(b)}while(null===x);if(B&&x===hZ._GetExtensionMetadata(B)){b._internalMetadata={};for(const Z in B._internalMetadata)b._internalMetadata[Z]=B._internalMetadata[Z];b._internalMetadata.Eb=[];for(const Z in B._internalMetadata.Eb)b._internalMetadata.Eb[Z]=B._internalMetadata.Eb[Z];b._internalMetadata.Eb[QZ]={lastSelected:null,original:[],variants:{}};for(const Z of x.original)b._internalMetadata.Eb[QZ].original.push({mesh:Z.mesh,material:Z.material});for(const Z in x.variants)if(Object.prototype.hasOwnProperty.call(x.variants,Z)){b._internalMetadata.Eb[QZ].variants[Z]=[];for(const l of x.variants[Z])b._internalMetadata.Eb[QZ].variants[Z].push({mesh:l.mesh,material:l.material})}x=b._internalMetadata.Eb[QZ]}for(const B of x.original)B.mesh===l&&(B.mesh=C);for(const B of x.variants[K.name])B.mesh===l&&(B.mesh=C)}))}})))}}}))),await Promise.all(W).then((Z=>{let[l]=Z;return l}))}))}}I(QZ),M(QZ,!0,(Z=>new hZ(Z)));var AZ=C(12519);class LZ{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:yZ.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(Z,l){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...LZ._GetDefaultOptions(),...Z},this._scene=l,this._scene._transmissionHelper=this,this.onErrorObservable=new d.b,this._scene.xb.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(Z){if(!Object.keys(Z).filter((l=>this._options[l]!==Z[l])).length)return;const l={...this._options,...Z},C=this._options;this._options=l,l.renderSize===C.renderSize&&l.renderTargetTextureType===C.renderTargetTextureType&&l.generateMipmaps===C.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=l.samples,this._opaqueRenderTarget.lodGenerationScale=l.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=l.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(Z){return!!Z&&!!(Z instanceof i.e&&Z.subSurface.isRefractionEnabled)}_addMesh(Z){this._materialObservers[Z.uniqueId]=Z.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),K.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(Z.material)?(Z.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(Z)&&this._transparentMeshesCache.push(Z)):-1===this._opaqueMeshesCache.indexOf(Z)&&this._opaqueMeshesCache.push(Z)}))}_removeMesh(Z){Z.onMaterialChangedObservable.remove(this._materialObservers[Z.uniqueId]),delete this._materialObservers[Z.uniqueId];let l=this._transparentMeshesCache.indexOf(Z);-1!==l&&this._transparentMeshesCache.splice(l,1),l=this._opaqueMeshesCache.indexOf(Z),-1!==l&&this._opaqueMeshesCache.splice(l,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(Z){const l=this._transparentMeshesCache.indexOf(Z),C=this._opaqueMeshesCache.indexOf(Z);this._shouldRenderAsTransmission(Z.material)?(Z.material instanceof i.e&&(Z.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==C?(this._opaqueMeshesCache.splice(C,1),this._transparentMeshesCache.push(Z)):-1===l&&this._transparentMeshesCache.push(Z)):-1!==l?(this._transparentMeshesCache.splice(l,1),this._opaqueMeshesCache.push(Z)):-1===C&&this._opaqueMeshesCache.push(Z)}_isRenderTargetValid(){var Z;return null!==(null===(Z=this._opaqueRenderTarget)||void 0===Z?void 0:Z.getInternalTexture())}_setupRenderTargets(){var Z;let l;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new AZ.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(Z=this._options.clearColor)||void 0===Z?void 0:Z.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((Z=>{l=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?Z.clearColor.B(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(Z.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=l}));for(const C of this._transparentMeshesCache)this._shouldRenderAsTransmission(C.material)&&(C.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const pZ="KHR_materials_transmission";class NZ{constructor(Z){this.name=pZ,this.order=175,this._loader=Z,this.enabled=this._loader.isExtensionUsed(pZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadTransparentPropertiesAsync(B,l,C,x)),await Promise.all(b).then((()=>{}))}))}_loadTransparentPropertiesAsync(Z,l,C,B){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const x=C;if(x.subSurface.isRefractionEnabled=!0,x.subSurface.volumeIndexOfRefraction=1,x.subSurface.useAlbedoToTintRefraction=!0,void 0===B.transmissionFactor)return x.subSurface.refractionIntensity=0,x.subSurface.isRefractionEnabled=!1,Promise.resolve();{var b;x.subSurface.refractionIntensity=B.transmissionFactor;const Z=x.cZ();if(x.subSurface.refractionIntensity&&!Z._transmissionHelper)new LZ({},x.cZ());else if(x.subSurface.refractionIntensity&&(null===(b=Z._transmissionHelper)||void 0===b||!b._isRenderTargetValid())){var K;null===(K=Z._transmissionHelper)||void 0===K||K._setupRenderTargets()}}return x.subSurface.minimumThickness=0,x.subSurface.maximumThickness=0,B.transmissionTexture?(B.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Z}/transmissionTexture`,B.transmissionTexture,void 0).then((Z=>{Z.name=`${C.name} (Transmission)`,x.subSurface.refractionIntensityTexture=Z,x.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}I(pZ),M(pZ,!0,(Z=>new NZ(Z)));const ml="KHR_materials_diffuse_transmission";class Zl{constructor(Z){this.name=ml,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(ml),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadTranslucentPropertiesAsync(B,l,C,x)),await Promise.all(b).then((()=>{}))}))}_loadTranslucentPropertiesAsync(Z,l,C,B){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const x=C;if(x.subSurface.isTranslucencyEnabled=!0,x.subSurface.volumeIndexOfRefraction=1,x.subSurface.minimumThickness=0,x.subSurface.maximumThickness=0,x.subSurface.useAlbedoToTintTranslucency=!1,void 0===B.diffuseTransmissionFactor)return x.subSurface.translucencyIntensity=0,x.subSurface.isTranslucencyEnabled=!1,Promise.resolve();x.subSurface.translucencyIntensity=B.diffuseTransmissionFactor;const K=new Array;return x.subSurface.useGltfStyleTextures=!0,B.diffuseTransmissionTexture&&(B.diffuseTransmissionTexture.nonColorData=!0,K.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTransmissionTexture`,B.diffuseTransmissionTexture).then((Z=>{Z.name=`${C.name} (Diffuse Transmission)`,x.subSurface.translucencyIntensityTexture=Z})))),void 0!==B.diffuseTransmissionColorFactor?x.subSurface.translucencyColor=b.Sl.il(B.diffuseTransmissionColorFactor):x.subSurface.translucencyColor=b.Sl.White(),B.diffuseTransmissionColorTexture&&K.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTransmissionColorTexture`,B.diffuseTransmissionColorTexture).then((Z=>{Z.name=`${C.name} (Diffuse Transmission Color)`,x.subSurface.translucencyColorTexture=Z}))),Promise.all(K).then((()=>{}))}}I(ml),M(ml,!0,(Z=>new Zl(Z)));const ll="KHR_materials_volume";class Cl{constructor(Z){this.name=ll,this.order=173,this._loader=Z,this.enabled=this._loader.isExtensionUsed(ll),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadVolumePropertiesAsync(B,l,C,x)),await Promise.all(b).then((()=>{}))}))}_loadVolumePropertiesAsync(Z,l,C,B){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);if(!C.subSurface.isRefractionEnabled&&!C.subSurface.isTranslucencyEnabled||!B.thicknessFactor)return Promise.resolve();C.subSurface.volumeIndexOfRefraction=C.indexOfRefraction;const x=void 0!==B.attenuationDistance?B.attenuationDistance:Number.MAX_VALUE;return C.subSurface.tintColorAtDistance=x,void 0!==B.attenuationColor&&3==B.attenuationColor.length&&C.subSurface.tintColor.rb(B.attenuationColor[0],B.attenuationColor[1],B.attenuationColor[2]),C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=B.thicknessFactor,C.subSurface.useThicknessAsDepth=!0,B.thicknessTexture?(B.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Z}/thicknessTexture`,B.thicknessTexture).then((Z=>{Z.name=`${C.name} (Thickness)`,C.subSurface.thicknessTexture=Z,C.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}I(ll),M(ll,!0,(Z=>new Cl(Z)));const Bl="KHR_materials_dispersion";class xl{constructor(Z){this.name=Bl,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(Bl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadDispersionPropertiesAsync(B,l,C,x)),await Promise.all(b).then((()=>{}))}))}_loadDispersionPropertiesAsync(Z,l,C,B){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);return C.subSurface.isRefractionEnabled&&B.dispersion?(C.subSurface.isDispersionEnabled=!0,C.subSurface.dispersion=B.dispersion,Promise.resolve()):Promise.resolve()}}I(Bl),M(Bl,!0,(Z=>new xl(Z)));const bl="EXT_materials_diffuse_roughness";class Kl{constructor(Z){this.name=bl,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(bl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=new Array;return b.push(this._loader.loadMaterialPropertiesAsync(Z,l,C)),b.push(this._loadDiffuseRoughnessPropertiesAsync(B,x,C)),await Promise.all(b).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(Z,l,C){if(!(C instanceof i.e))throw new Error(`${Z}: Material type not supported`);const B=new Array;return C.brdf.baseDiffuseModel=yZ.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=l.diffuseRoughnessFactor?C.baseDiffuseRoughness=l.diffuseRoughnessFactor:C.baseDiffuseRoughness=0,l.diffuseRoughnessTexture&&B.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseRoughnessTexture`,l.diffuseRoughnessTexture,(Z=>{Z.name=`${C.name} (Diffuse Roughness)`,C.baseDiffuseRoughnessTexture=Z}))),Promise.all(B).then((()=>{}))}}I(bl),M(bl,!0,(Z=>new Kl(Z)));const fl="KHR_mesh_quantization";class Wl{constructor(Z){this.name=fl,this.enabled=Z.isExtensionUsed(fl)}dispose(){}}I(fl),M(fl,!0,(Z=>new Wl(Z)));const Jl="KHR_texture_basisu";class dl{constructor(Z){this.name=Jl,this._loader=Z,this.enabled=Z.isExtensionUsed(Jl)}dispose(){this._loader=null}_loadTextureAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>{const b=void 0==l.sampler?T.DefaultSampler:y.Get(`${Z}/sampler`,this._loader.Eb.samplers,l.sampler),K=y.Get(`${B}/source`,this._loader.Eb.images,x.source);return await this._loader._createTextureAsync(Z,b,K,(Z=>{C(Z)}),l._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!l._textureInfo.nonColorData)}))}}I(Jl),M(Jl,!0,(Z=>new dl(Z)));const El="KHR_texture_transform";class Gl{constructor(Z){this.name=El,this._loader=Z,this.enabled=this._loader.isExtensionUsed(El)}dispose(){this._loader=null}loadTextureInfoAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(B,x)=>await this._loader.loadTextureInfoAsync(Z,l,(Z=>{if(!(Z instanceof s.c))throw new Error(`${B}: Texture type not supported`);x.offset&&(Z.uOffset=x.offset[0],Z.vOffset=x.offset[1]),Z.uRotationCenter=0,Z.vRotationCenter=0,x.rotation&&(Z.wAng=-x.rotation),x.scale&&(Z.uScale=x.scale[0],Z.vScale=x.scale[1]),void 0!=x.texCoord&&(Z.coordinatesIndex=x.texCoord),C(Z)}))))}}I(El),M(El,!0,(Z=>new Gl(Z)));const al="KHR_xmp_json_ld";class ql{constructor(Z){this.name=al,this.order=100,this._loader=Z,this.enabled=this._loader.isExtensionUsed(al)}dispose(){this._loader=null}onLoading(){var Z,l,C;if(null===this._loader.rootBabylonMesh)return;const B=null===(Z=this._loader.Eb.extensions)||void 0===Z?void 0:Z.KHR_xmp_json_ld,x=null===(l=this._loader.Eb.asset)||void 0===l||null===(C=l.extensions)||void 0===C?void 0:C.KHR_xmp_json_ld;if(B&&x){const Z=+x.packet;B.packets&&Z<B.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=B.packets[Z])}}}function zl(Z,l,C,B){return b.Sl.il(l,C).scale(B)}function Yl(Z,l,C,B){return l[C]*B}function Pl(Z,l,C,B){return-l[C]*B}function Sl(Z,l,C,B){return l[C+1]*B}function il(Z,l,C,B){return l[C]*B*2}function sl(Z){return{scale:[new nl(G.b.ANIMATIONTYPE_FLOAT,`${Z}.uScale`,Yl,(()=>2)),new nl(G.b.ANIMATIONTYPE_FLOAT,`${Z}.vScale`,Sl,(()=>2))],offset:[new nl(G.b.ANIMATIONTYPE_FLOAT,`${Z}.uOffset`,Yl,(()=>2)),new nl(G.b.ANIMATIONTYPE_FLOAT,`${Z}.vOffset`,Sl,(()=>2))],rotation:[new nl(G.b.ANIMATIONTYPE_FLOAT,`${Z}.wAng`,Pl,(()=>1))]}}I(al),M(al,!0,(Z=>new ql(Z)));class Fl extends u.AnimationPropertyInfo{buildAnimations(Z,l,C,B){return[{babylonAnimatable:Z._babylonCamera,babylonAnimation:this._buildAnimation(l,C,B)}]}}class nl extends u.AnimationPropertyInfo{buildAnimations(Z,l,C,B){const x=[];for(const b in Z._data)x.push({babylonAnimatable:Z._data[b].babylonMaterial,babylonAnimation:this._buildAnimation(l,C,B)});return x}}class cl extends u.AnimationPropertyInfo{buildAnimations(Z,l,C,B){return[{babylonAnimatable:Z._babylonLight,babylonAnimation:this._buildAnimation(l,C,B)}]}}(0,w.q)("/cameras/{}/orthographic/xmag",[new Fl(G.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Pl,(()=>1)),new Fl(G.b.ANIMATIONTYPE_FLOAT,"orthoRight",Sl,(()=>1))]),(0,w.q)("/cameras/{}/orthographic/ymag",[new Fl(G.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Pl,(()=>1)),new Fl(G.b.ANIMATIONTYPE_FLOAT,"orthoTop",Sl,(()=>1))]),(0,w.q)("/cameras/{}/orthographic/zfar",[new Fl(G.b.ANIMATIONTYPE_FLOAT,"maxZ",Yl,(()=>1))]),(0,w.q)("/cameras/{}/orthographic/znear",[new Fl(G.b.ANIMATIONTYPE_FLOAT,"ib",Yl,(()=>1))]),(0,w.q)("/cameras/{}/perspective/yfov",[new Fl(G.b.ANIMATIONTYPE_FLOAT,"fov",Yl,(()=>1))]),(0,w.q)("/cameras/{}/perspective/zfar",[new Fl(G.b.ANIMATIONTYPE_FLOAT,"maxZ",Yl,(()=>1))]),(0,w.q)("/cameras/{}/perspective/znear",[new Fl(G.b.ANIMATIONTYPE_FLOAT,"ib",Yl,(()=>1))]),(0,w.q)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new nl(G.b.ANIMATIONTYPE_COLOR3,"albedoColor",zl,(()=>4)),new nl(G.b.ANIMATIONTYPE_FLOAT,"alpha",(function(Z,l,C,B){return l[C+3]*B}),(()=>4))]),(0,w.q)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"metallic",Yl,(()=>1))]),(0,w.q)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"roughness",Yl,(()=>1))]);const Ul=sl("albedoTexture");(0,w.q)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Ul.scale),(0,w.q)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Ul.offset),(0,w.q)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Ul.rotation);const tl=sl("metallicTexture");(0,w.q)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",tl.scale),(0,w.q)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",tl.offset),(0,w.q)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",tl.rotation),(0,w.q)("/materials/{}/emissiveFactor",[new nl(G.b.ANIMATIONTYPE_COLOR3,"emissiveColor",zl,(()=>3))]);const rl=sl("bumpTexture");(0,w.q)("/materials/{}/normalTexture/scale",[new nl(G.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Yl,(()=>1))]),(0,w.q)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",rl.scale),(0,w.q)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",rl.offset),(0,w.q)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",rl.rotation),(0,w.q)("/materials/{}/occlusionTexture/strength",[new nl(G.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Yl,(()=>1))]);const el=sl("ambientTexture");(0,w.q)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",el.scale),(0,w.q)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",el.offset),(0,w.q)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",el.rotation);const ol=sl("emissiveTexture");(0,w.q)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",ol.scale),(0,w.q)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",ol.offset),(0,w.q)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",ol.rotation),(0,w.q)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new nl(G.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new nl(G.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Yl,(()=>1))]);const vl=sl("anisotropy.texture");(0,w.q)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",vl.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",vl.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",vl.rotation),(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Yl,(()=>1))]);const Rl=sl("clearCoat.texture");(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Rl.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Rl.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Rl.rotation);const kl=sl("clearCoat.bumpTexture");(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new nl(G.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",kl.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",kl.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",kl.rotation);const Vl=sl("clearCoat.textureRoughness");(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Vl.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Vl.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Vl.rotation),(0,w.q)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new nl(G.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_ior/ior",[new nl(G.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new nl(G.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new nl(G.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Yl,(()=>1))]);const gl=sl("iridescence.texture");(0,w.q)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",gl.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",gl.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",gl.rotation);const jl=sl("iridescence.thicknessTexture");(0,w.q)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",jl.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",jl.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",jl.rotation),(0,w.q)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new nl(G.b.ANIMATIONTYPE_COLOR3,"sheen.color",zl,(()=>3))]),(0,w.q)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Yl,(()=>1))]);const Ml=sl("sheen.texture");(0,w.q)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Ml.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Ml.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Ml.rotation);const Il=sl("sheen.textureRoughness");(0,w.q)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Il.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Il.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Il.rotation),(0,w.q)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new nl(G.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",zl,(()=>3))]);const wl=sl("metallicReflectanceTexture");(0,w.q)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",wl.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",wl.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",wl.rotation);const Ol=sl("reflectanceTexture");(0,w.q)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Ol.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Ol.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Ol.rotation),(0,w.q)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Yl,(()=>1))]);const Dl=sl("subSurface.refractionIntensityTexture");(0,w.q)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Dl.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Dl.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Dl.rotation),(0,w.q)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new nl(G.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",zl,(()=>3))]),(0,w.q)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new nl(G.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Yl,(()=>1))]),(0,w.q)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Yl,(()=>1))]);const yl=sl("subSurface.thicknessTexture");(0,w.q)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",yl.scale),(0,w.q)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",yl.offset),(0,w.q)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",yl.rotation),(0,w.q)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new nl(G.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Yl,(()=>1))]);const Xl=sl("subSurface.translucencyIntensityTexture");(0,w.q)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Xl.scale),(0,w.q)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Xl.offset),(0,w.q)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Xl.rotation),(0,w.q)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new nl(G.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",zl,(()=>3))]);const Tl=sl("subSurface.translucencyColorTexture");(0,w.q)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Tl.scale),(0,w.q)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Tl.offset),(0,w.q)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Tl.rotation),(0,w.q)("/extensions/KHR_lights_punctual/lights/{}/color",[new cl(G.b.ANIMATIONTYPE_COLOR3,"diffuse",zl,(()=>3))]),(0,w.q)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new cl(G.b.ANIMATIONTYPE_FLOAT,"intensity",Yl,(()=>1))]),(0,w.q)("/extensions/KHR_lights_punctual/lights/{}/range",[new cl(G.b.ANIMATIONTYPE_FLOAT,"range",Yl,(()=>1))]),(0,w.q)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new cl(G.b.ANIMATIONTYPE_FLOAT,"innerAngle",il,(()=>1))]),(0,w.q)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new cl(G.b.ANIMATIONTYPE_FLOAT,"angle",il,(()=>1))]),(0,w.q)("/nodes/{}/extensions/EXT_lights_ies/color",[new cl(G.b.ANIMATIONTYPE_COLOR3,"diffuse",zl,(()=>3))]),(0,w.q)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new cl(G.b.ANIMATIONTYPE_FLOAT,"intensity",Yl,(()=>1))]);const ul="KHR_animation_pointer";class Hl{constructor(Z){this.name=ul,this._loader=Z,this._pathToObjectConverter=(0,w.m)(this._loader.Eb)}get enabled(){return this._loader.isExtensionUsed(ul)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(Z,l,C,B,x){var b;const K=null===(b=B.target.extensions)||void 0===b?void 0:b.KHR_animation_pointer;if(!K||!this._pathToObjectConverter)return null;"pointer"!==B.target.path&&z.e.Warn(`${Z}/target/path: Value (${B.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=B.target.node&&z.e.Warn(`${Z}/target/node: Value (${B.target.node}) must not be present when using the ${this.name} extension`);const f=`${Z}/extensions/${this.name}`,W=K.pointer;if(!W)throw new Error(`${f}: Pointer is missing`);try{const b=this._pathToObjectConverter.convert(W);if(!b.info.interpolation)throw new Error(`${f}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(Z,l,C,B,{object:b.object,info:b.info.interpolation},x)}catch(J){return z.e.Warn(`${f}/pointer: Invalid pointer (${W}) skipped`),null}}}I(ul),M(ul,!0,(Z=>new Hl(Z)));class Ql{constructor(Z,l,C){this.frame=Z,this.action=l,this.onlyOnce=C,this.isDone=!1}_clone(){return new Ql(this.frame,this.action,this.onlyOnce)}}var hl=C(12282),Al=C(12346),Ll=C(12339);class pl{get loop(){return this._loop}set loop(Z){Z!==this._loop&&(this._loop=Z,this.updateOptions({loop:Z}))}get currentTime(){var Z;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(Z=Al.d.audioEngine)&&void 0!==Z&&Z.audioContext&&(this.isPlaying||this.isPaused)){const Z=this.isPaused?0:Al.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+Z}return 0}get spatialSound(){return this._spatialSound}set spatialSound(Z){if(Z==this._spatialSound)return;const l=this.isPlaying;this.pause(),Z?(this._spatialSound=Z,this._updateSpatialParameters()):this._disableSpatialSound(),l&&this.play()}constructor(Z,l,C){var B;let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new d.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=x.ql.Zero(),this._localDirection=new x.ql(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=Z,C=C||q.b.LastCreatedScene)if(this._scene=C,pl._SceneComponentInitialization(C),this._readyToPlayCallback=b,this._customAttenuationFunction=(Z,l,C,B,x)=>l<C?Z*(1-l/C):0,f&&(this.autoplay=f.autoplay||!1,this._loop=f.loop||!1,void 0!==f.volume&&(this._volume=f.volume),this._spatialSound=f.spatialSound??!1,this.maxDistance=f.maxDistance??100,this.useCustomAttenuation=f.useCustomAttenuation??!1,this.rolloffFactor=f.rolloffFactor||1,this.refDistance=f.refDistance||1,this.distanceModel=f.distanceModel||"linear",this._playbackRate=f.playbackRate||1,this._streaming=f.streaming??!1,this._length=f.length,this._offset=f.offset),null!==(B=Al.d.audioEngine)&&void 0!==B&&B.canUseWebAudio&&Al.d.audioEngine.audioContext){this._soundGain=Al.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let Z=!0;if(l)try{"string"===typeof l?(this._urlType="String",this._url=l):l instanceof ArrayBuffer?this._urlType="ArrayBuffer":l instanceof HTMLMediaElement?this._urlType="MediaElement":l instanceof MediaStream?this._urlType="MediaStream":l instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(l)&&(this._urlType="Array");let C=[],B=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Al.d.audioEngine.audioContext.createMediaElementSource(l),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Al.d.audioEngine.audioContext.createMediaStreamSource(l),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":l.byteLength>0&&(B=!0,this._soundLoaded(l));break;case"AudioBuffer":this._audioBufferLoaded(l);break;case"String":C.push(l);case"Array":0===C.length&&(C=l);for(let Z=0;Z<C.length;Z++){const l=C[Z];if(B=f&&f.skipCodecCheck||-1!==l.indexOf(".mp3",l.length-4)&&Al.d.audioEngine.isMP3supported||-1!==l.indexOf(".ogg",l.length-4)&&Al.d.audioEngine.isOGGsupported||-1!==l.indexOf(".wav",l.length-4)||-1!==l.indexOf(".m4a",l.length-4)||-1!==l.indexOf(".mp4",l.length-4)||-1!==l.indexOf("blob:"),B){this._streaming?(this._htmlAudioElement=new Audio(l),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,K.Tools.SetCorsBehavior(l,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(l,(Z=>{this._soundLoaded(Z)}),void 0,!0,!0,(Z=>{Z&&z.e.Error("XHR "+Z.status+" error on: "+l+"."),z.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:Z=!1}Z?B||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):z.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(W){z.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Al.d.audioEngine&&!Al.d.audioEngine.WarnedWebAudioUnsupported&&(z.e.Error("Web Audio is not supported by your browser."),Al.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var Z;null!==(Z=Al.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(Z){var l;null!==(l=Al.d.audioEngine)&&void 0!==l&&l.audioContext&&(this._audioBuffer=Z,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(Z){var l;null!==(l=Al.d.audioEngine)&&void 0!==l&&l.audioContext&&Al.d.audioEngine.audioContext.decodeAudioData(Z,(Z=>{this._audioBufferLoaded(Z)}),(Z=>{z.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+Z)}))}setAudioBuffer(Z){var l;null!==(l=Al.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&(this._audioBuffer=Z,this._isReadyToPlay=!0)}updateOptions(Z){Z&&(this.loop=Z.loop??this.loop,this.maxDistance=Z.maxDistance??this.maxDistance,this.useCustomAttenuation=Z.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=Z.rolloffFactor??this.rolloffFactor,this.refDistance=Z.refDistance??this.refDistance,this.distanceModel=Z.distanceModel??this.distanceModel,this._playbackRate=Z.playbackRate??this._playbackRate,this._length=Z.length??void 0,this.spatialSound=Z.spatialSound??this._spatialSound,this._setOffset(Z.offset??void 0),this.setVolume(Z.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var Z;null!==(Z=Al.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&Al.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Al.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var Z;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(Z=this._soundPanner)||void 0===Z||Z.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var Z;null!==(Z=Al.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(Z){var l;null!==(l=Al.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(Z),this._isOutputConnected=!0)}setDirectionalCone(Z,l,C){l<Z?z.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=Z,this._coneOuterAngle=l,this._coneOuterGain=C,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Z){if(Z!=this._coneInnerAngle){var l;if(this._coneOuterAngle<Z)return void z.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z,null!==(l=Al.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Z){if(Z!=this._coneOuterAngle){var l;if(Z<this._coneInnerAngle)return void z.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z,null!==(l=Al.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(Z){var l;Z.equals(this._position)||(this._position.B(Z),null!==(l=Al.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(Z){var l;this._localDirection=Z,null!==(l=Al.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const Z=this._connectedTransformNode.getWorldMatrix(),l=x.ql.TransformNormal(this._localDirection,Z);l.normalize(),this._soundPanner.orientationX.value=l.x,this._soundPanner.orientationY.value=l.y,this._soundPanner.orientationZ.value=l.z}updateDistanceFromListener(){var Z;if(null!==(Z=Al.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const Z=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.zl(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,Z,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(Z){this._customAttenuationFunction=Z}play(Z,l,C){var B;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(B=Al.d.audioEngine)&&void 0!==B&&B.audioContext)try{var x,b;this._clearTimeoutsAndObservers();let B=Z?(null===(x=Al.d.audioEngine)||void 0===x?void 0:x.audioContext.currentTime)+Z:null===(b=Al.d.audioEngine)||void 0===b?void 0:b.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Al.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const Z=()=>{var C;if(null!==(C=Al.d.audioEngine)&&void 0!==C&&C.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=l??0;const C=this._htmlAudioElement.play();void 0!==C&&C.catch((()=>{var l,C;(null===(l=Al.d.audioEngine)||void 0===l||l.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(C=Al.d.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{Z()})))}))}else{var B;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(B=Al.d.audioEngine)||void 0===B?void 0:B.onAudioUnlockedObservable.addOnce((()=>{Z()}))}};Z()}}else{var K;const x=()=>{var x;if(null!==(x=Al.d.audioEngine)&&void 0!==x&&x.audioContext){var b;if(C=C||this._length,void 0!==l&&this._setOffset(l),this._soundSource){const Z=this._soundSource;Z.onended=()=>{Z.disconnect()}}if(this._soundSource=null===(b=Al.d.audioEngine)||void 0===b?void 0:b.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var K;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==l&&(this._soundSource.loopStart=l),void 0!==C&&(this._soundSource.loopEnd=(0|l)+C),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},B=Z?(null===(K=Al.d.audioEngine)||void 0===K?void 0:K.audioContext.currentTime)+Z:Al.d.audioEngine.audioContext.currentTime;const x=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(B,x,this.loop?void 0:C)}}};"suspended"===(null===(K=Al.d.audioEngine)||void 0===K?void 0:K.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var Z;"suspended"===(null===(Z=Al.d.audioEngine)||void 0===Z?void 0:Z.audioContext.state)?(Al.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Al.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{x()})))):x()}),500):x()}this._startTime=B,this.isPlaying=!0,this.isPaused=!1}catch(f){z.e.Error("Error while trying to play audio: "+this.name+", "+f.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(Z){var l;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var C;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(C=this._streamingSource)||void 0===C||C.disconnect();this.isPlaying=!1}else if(null!==(l=Al.d.audioEngine)&&void 0!==l&&l.audioContext&&this._soundSource){const l=Z?Al.d.audioEngine.audioContext.currentTime+Z:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(l)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var Z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var l;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(l=this._streamingSource)||void 0===l||l.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(Z=Al.d.audioEngine)&&void 0!==Z&&Z.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Al.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(Z,l){var C;null!==(C=Al.d.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._soundGain&&(l&&Al.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Al.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Al.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(Z,Al.d.audioEngine.audioContext.currentTime+l)):this._soundGain.gain.value=Z),this._volume=Z}setPlaybackRate(Z){this._playbackRate=Z,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(Z){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=Z,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=Z=>this._onRegisterAfterWorldMatrixUpdate(Z),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(Z){var l;if(Z.getBoundingInfo){const l=Z.getBoundingInfo();this.setPosition(l.boundingSphere.centerWorld)}else this.setPosition(Z.absolutePosition);null!==(l=Al.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const Z=()=>{(0,Ll.d)((()=>this._isReadyToPlay),(()=>{C._audioBuffer=this.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,this._offset,this._length)}),void 0,300)},l={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},C=new pl(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,l);return this.useCustomAttenuation&&C.setAttenuationFunction(this._customAttenuationFunction),C.setPosition(this._position),C.setPlaybackRate(this._playbackRate),Z(),C}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const Z={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(Z.connectedMeshId=this._connectedTransformNode.id),Z.position=this._position.Yb(),Z.refDistance=this.refDistance,Z.distanceModel=this.distanceModel,Z.isDirectional=this._isDirectional,Z.localDirectionToMesh=this._localDirection.Yb(),Z.coneInnerAngle=this._coneInnerAngle,Z.coneOuterAngle=this._coneOuterAngle,Z.coneOuterGain=this._coneOuterGain),Z}static Parse(Z,l,C,B){const b=Z.name;let K;K=Z.url?C+Z.url:C+b;const f={autoplay:Z.autoplay,loop:Z.loop,volume:Z.volume,spatialSound:Z.spatialSound,maxDistance:Z.maxDistance,rolloffFactor:Z.rolloffFactor,refDistance:Z.refDistance,distanceModel:Z.distanceModel,playbackRate:Z.playbackRate};let W;if(B){const Z=()=>{(0,Ll.d)((()=>B._isReadyToPlay),(()=>{W._audioBuffer=B.getAudioBuffer(),W._isReadyToPlay=!0,W.autoplay&&W.play(0,W._offset,W._length)}),void 0,300)};W=new pl(b,new ArrayBuffer(0),l,null,f),Z()}else W=new pl(b,K,l,(()=>{l.removePendingData(W)}),f),l.addPendingData(W);if(Z.position){const l=x.ql.il(Z.position);W.setPosition(l)}if(Z.isDirectional&&(W.setDirectionalCone(Z.coneInnerAngle||360,Z.coneOuterAngle||360,Z.coneOuterGain||0),Z.localDirectionToMesh)){const l=x.ql.il(Z.localDirectionToMesh);W.setLocalDirectionToMesh(l)}if(Z.connectedMeshId){const C=l.getMeshById(Z.connectedMeshId);C&&W.attachToMesh(C)}return Z.metadata&&(W.metadata=Z.metadata),W}_setOffset(Z){this._offset!==Z&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=Z)}_clearTimeoutsAndObservers(){var Z;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(Z=Al.d.audioEngine)||void 0===Z||Z.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}pl._SceneComponentInitialization=Z=>{throw(0,hl.d)("AudioSceneComponent")},(0,nZ.c)("BABYLON.Sound",pl);class Nl{constructor(Z,l,C){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],l.length!==C.length)throw new Error("Sounds length does not equal weights length");this.loop=Z,this._weights=C;let B=0;for(const b of C)B+=b;const x=B>0?1/B:0;for(let b=0;b<this._weights.length;b++)this._weights[b]*=x;this._sounds=l;for(const b of this._sounds)b.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Z){if(Z!==this._coneInnerAngle){if(this._coneOuterAngle<Z)return void z.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z;for(const l of this._sounds)l.directionalConeInnerAngle=Z}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Z){if(Z!==this._coneOuterAngle){if(Z<this._coneInnerAngle)return void z.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z;for(const l of this._sounds)l.directionalConeOuterAngle=Z}}get volume(){return this._volume}set volume(Z){if(Z!==this._volume)for(const l of this._sounds)l.setVolume(Z)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(Z){if(!this.isPaused){this.stop();const Z=Math.random();let l=0;for(let C=0;C<this._weights.length;C++)if(l+=this._weights[C],Z<=l){this._currentIndex=C;break}}const l=this._sounds[this._currentIndex??0];l.isReady()?l.play(0,this.isPaused?void 0:Z):l.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class mC{constructor(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(Z=Z||q.b.LastCreatedScene)&&(this._scene=Z,this.soundCollection=[],this._options=l,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var Z;null!==(Z=Al.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&Al.d.audioEngine.audioContext&&(this._outputAudioNode=Al.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Al.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Al.d.audioEngine&&Al.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(Z){var l;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(l=Al.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._outputAudioNode&&Z.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==Z.soundTrackId&&(-1===Z.soundTrackId?this._scene.mainSoundTrack.removeSound(Z):this._scene.soundTracks&&this._scene.soundTracks[Z.soundTrackId].removeSound(Z)),this.soundCollection.push(Z),Z.soundTrackId=this.id}removeSound(Z){const l=this.soundCollection.indexOf(Z);-1!==l&&this.soundCollection.splice(l,1)}setVolume(Z){var l;null!==(l=Al.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=Z)}switchPanningModelToHRTF(){var Z;if(null!==(Z=Al.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio)for(let l=0;l<this.soundCollection.length;l++)this.soundCollection[l].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var Z;if(null!==(Z=Al.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio)for(let l=0;l<this.soundCollection.length;l++)this.soundCollection[l].switchPanningModelToEqualPower()}connectToAnalyser(Z){var l;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=Z,null!==(l=Al.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Al.d.audioEngine.masterGain))}}var ZC=C(12735),lC=C(12704),CC=C(12255);Al.d.AudioEngineFactory=(Z,l,C)=>new BC(Z,l,C);class BC{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new d.b,this.onAudioLockedObservable=new d.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,CC.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const B=document.createElement("audio");this._hostElement=Z,this._audioContext=l,this._audioDestination=C;try{B&&B.canPlayType&&(B.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||B.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(x){}try{B&&B.canPlayType&&B.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(x){}}lock(){this._triggerSuspendedState()}unlock(){var Z,l;if("running"===(null===(Z=this._audioContext)||void 0===Z?void 0:Z.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(l=this._audioContext)||void 0===l||l.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{z.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var Z;null===(Z=this._audioContext)||void 0===Z||Z.addEventListener("statechange",(()=>{var Z;this.unlocked&&"running"!==(null===(Z=this._audioContext)||void 0===Z?void 0:Z.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var Z;return null!==(Z=this._audioContext)&&void 0!==Z&&Z.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(Z){this.canUseWebAudio=!1,z.e.Error("Web Audio: "+Z.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(Z){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const Z=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",l=document.createElement("style");l.appendChild(document.createTextNode(Z)),document.getElementsByTagName("head")[0].appendChild(l),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var Z;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(Z=this._audioContext)||void 0===Z||Z.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(Z){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=Z)}connectToAnalyser(Z){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=Z,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var xC=C(12275);(0,C(13499).i)(ZC.d.NAME_AUDIO,((Z,l,C,B)=>{let x,b=[];if(C.Da=C.Da||[],void 0!==Z.Da&&null!==Z.Da)for(let f=0,W=Z.Da.length;f<W;f++){var K;const W=Z.Da[f];null!==(K=Al.d.audioEngine)&&void 0!==K&&K.canUseWebAudio?(W.url||(W.url=W.name),b[W.url]?C.Da.push(pl.Parse(W,l,B,b[W.url])):(x=pl.Parse(W,l,B),b[W.url]=x,C.Da.push(x))):C.Da.push(new pl(W.name,null,l))}b=[]})),Object.defineProperty(lC.e.prototype,"mainSoundTrack",{get:function(){let Z=this._getComponent(ZC.d.NAME_AUDIO);return Z||(Z=new bC(this),this.o(Z)),this._mainSoundTrack||(this._mainSoundTrack=new mC(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),lC.e.prototype.getSoundByName=function(Z){let l;for(l=0;l<this.mainSoundTrack.soundCollection.length;l++)if(this.mainSoundTrack.soundCollection[l].name===Z)return this.mainSoundTrack.soundCollection[l];if(this.soundTracks)for(let C=0;C<this.soundTracks.length;C++)for(l=0;l<this.soundTracks[C].soundCollection.length;l++)if(this.soundTracks[C].soundCollection[l].name===Z)return this.soundTracks[C].soundCollection[l];return null},Object.defineProperty(lC.e.prototype,"audioEnabled",{get:function(){let Z=this._getComponent(ZC.d.NAME_AUDIO);return Z||(Z=new bC(this),this.o(Z)),Z.audioEnabled},set:function(Z){let l=this._getComponent(ZC.d.NAME_AUDIO);l||(l=new bC(this),this.o(l)),Z?l.enableAudio():l.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(lC.e.prototype,"headphone",{get:function(){let Z=this._getComponent(ZC.d.NAME_AUDIO);return Z||(Z=new bC(this),this.o(Z)),Z.headphone},set:function(Z){let l=this._getComponent(ZC.d.NAME_AUDIO);l||(l=new bC(this),this.o(l)),Z?l.switchAudioModeForHeadphones():l.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(lC.e.prototype,"audioListenerPositionProvider",{get:function(){let Z=this._getComponent(ZC.d.NAME_AUDIO);return Z||(Z=new bC(this),this.o(Z)),Z.audioListenerPositionProvider},set:function(Z){let l=this._getComponent(ZC.d.NAME_AUDIO);if(l||(l=new bC(this),this.o(l)),Z&&"function"!==typeof Z)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");l.audioListenerPositionProvider=Z},enumerable:!0,configurable:!0}),Object.defineProperty(lC.e.prototype,"audioListenerRotationProvider",{get:function(){let Z=this._getComponent(ZC.d.NAME_AUDIO);return Z||(Z=new bC(this),this.o(Z)),Z.audioListenerRotationProvider},set:function(Z){let l=this._getComponent(ZC.d.NAME_AUDIO);if(l||(l=new bC(this),this.o(l)),Z&&"function"!==typeof Z)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");l.audioListenerRotationProvider=Z},enumerable:!0,configurable:!0}),Object.defineProperty(lC.e.prototype,"audioPositioningRefreshRate",{get:function(){let Z=this._getComponent(ZC.d.NAME_AUDIO);return Z||(Z=new bC(this),this.o(Z)),Z.audioPositioningRefreshRate},set:function(Z){let l=this._getComponent(ZC.d.NAME_AUDIO);l||(l=new bC(this),this.o(l)),l.audioPositioningRefreshRate=Z},enumerable:!0,configurable:!0});class bC{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(Z){this.name=ZC.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new x.ql,this._cachedCameraPosition=new x.ql,this._lastCheck=0,this._invertMatrixTemp=new x.Matrix,this._cameraDirectionTemp=new x.ql,(Z=Z||q.b.LastCreatedScene)&&(this.Yl=Z,Z.soundTracks=[],Z.Da=[])}register(){this.Yl._afterRenderStage.registerStep(ZC.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(Z){if(Z.Da=[],this.Yl.soundTracks)for(let l=0;l<this.Yl.soundTracks.length;l++){const C=this.Yl.soundTracks[l];for(let l=0;l<C.soundCollection.length;l++)Z.Da.push(C.soundCollection[l].serialize())}}addFromContainer(Z){if(Z.Da)for(const l of Z.Da)l.play(),l.autoplay=!0,this.Yl.mainSoundTrack.addSound(l)}removeFromContainer(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Z.Da)for(const C of Z.Da)C.stop(),C.autoplay=!1,this.Yl.mainSoundTrack.removeSound(C),l&&C.dispose()}dispose(){const Z=this.Yl;if(Z._mainSoundTrack&&Z.mainSoundTrack.dispose(),Z.soundTracks)for(let l=0;l<Z.soundTracks.length;l++)Z.soundTracks[l].dispose()}disableAudio(){const Z=this.Yl;let l;for(this._audioEnabled=!1,Al.d.audioEngine&&Al.d.audioEngine.audioContext&&Al.d.audioEngine.audioContext.suspend(),l=0;l<Z.mainSoundTrack.soundCollection.length;l++)Z.mainSoundTrack.soundCollection[l].pause();if(Z.soundTracks)for(l=0;l<Z.soundTracks.length;l++)for(let C=0;C<Z.soundTracks[l].soundCollection.length;C++)Z.soundTracks[l].soundCollection[C].pause()}enableAudio(){const Z=this.Yl;let l;for(this._audioEnabled=!0,Al.d.audioEngine&&Al.d.audioEngine.audioContext&&Al.d.audioEngine.audioContext.resume(),l=0;l<Z.mainSoundTrack.soundCollection.length;l++)Z.mainSoundTrack.soundCollection[l].isPaused&&Z.mainSoundTrack.soundCollection[l].play();if(Z.soundTracks)for(l=0;l<Z.soundTracks.length;l++)for(let C=0;C<Z.soundTracks[l].soundCollection.length;C++)Z.soundTracks[l].soundCollection[C].isPaused&&Z.soundTracks[l].soundCollection[C].play()}switchAudioModeForHeadphones(){const Z=this.Yl;if(this._headphone=!0,Z.mainSoundTrack.switchPanningModelToHRTF(),Z.soundTracks)for(let l=0;l<Z.soundTracks.length;l++)Z.soundTracks[l].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const Z=this.Yl;if(this._headphone=!1,Z.mainSoundTrack.switchPanningModelToEqualPower(),Z.soundTracks)for(let l=0;l<Z.soundTracks.length;l++)Z.soundTracks[l].switchPanningModelToEqualPower()}_afterRender(){const Z=xC.d.Now;if(this._lastCheck&&Z-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=Z;const l=this.Yl;if(!this._audioEnabled||!l._mainSoundTrack||!l.soundTracks||0===l._mainSoundTrack.soundCollection.length&&1===l.soundTracks.length)return;const C=Al.d.audioEngine;if(C&&C.audioContext){let Z,B=l.activeCamera;if(l.activeCameras&&l.activeCameras.length>0&&(B=l.activeCameras[0]),this.audioListenerPositionProvider){const Z=this.audioListenerPositionProvider();C.audioContext.listener.setPosition(Z.x||0,Z.y||0,Z.z||0)}else B?this._cachedCameraPosition.equals(B.globalPosition)||(this._cachedCameraPosition.B(B.globalPosition),C.audioContext.listener.setPosition(B.globalPosition.x,B.globalPosition.y,B.globalPosition.z)):C.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const Z=this.audioListenerRotationProvider();C.audioContext.listener.setOrientation(Z.x||0,Z.y||0,Z.z||0,0,1,0)}else B?(B.rigCameras&&B.rigCameras.length>0&&(B=B.rigCameras[0]),B.getViewMatrix().invertToRef(this._invertMatrixTemp),x.ql.TransformNormalToRef(bC._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.B(this._cameraDirectionTemp),C.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):C.audioContext.listener.setOrientation(0,0,0,0,1,0);for(Z=0;Z<l.mainSoundTrack.soundCollection.length;Z++){const C=l.mainSoundTrack.soundCollection[Z];C.useCustomAttenuation&&C.updateDistanceFromListener()}if(l.soundTracks)for(Z=0;Z<l.soundTracks.length;Z++)for(let C=0;C<l.soundTracks[Z].soundCollection.length;C++){const B=l.soundTracks[Z].soundCollection[C];B.useCustomAttenuation&&B.updateDistanceFromListener()}}}}bC._CameraDirection=new x.ql(0,0,-1),pl._SceneComponentInitialization=Z=>{let l=Z._getComponent(ZC.d.NAME_AUDIO);l||(l=new bC(Z),Z.o(l))};const KC="MSFT_audio_emitter";class fC{constructor(Z){this.name=KC,this._loader=Z,this.enabled=this._loader.isExtensionUsed(KC)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const Z=this._loader.Eb.extensions;if(Z&&Z[this.name]){const l=Z[this.name];this._clips=l.clips,this._emitters=l.emitters,y.Assign(this._clips),y.Assign(this._emitters)}}loadSceneAsync(Z,l){return T.LoadExtensionAsync(Z,l,this.name,(async(C,B)=>{const x=new Array;x.push(this._loader.loadSceneAsync(Z,l));for(const Z of B.emitters){const l=y.Get(`${C}/emitters`,this._emitters,Z);if(void 0!=l.refDistance||void 0!=l.maxDistance||void 0!=l.rolloffFactor||void 0!=l.distanceModel||void 0!=l.innerAngle||void 0!=l.outerAngle)throw new Error(`${C}: Direction or Distance properties are not allowed on emitters attached to a scene`);x.push(this._loadEmitterAsync(`${C}/emitters/${l.index}`,l))}await Promise.all(x)}))}loadNodeAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(Z,B)=>{const b=new Array,f=await this._loader.loadNodeAsync(Z,l,(l=>{for(const C of B.emitters){const B=y.Get(`${Z}/emitters`,this._emitters,C);b.push(this._loadEmitterAsync(`${Z}/emitters/${B.index}`,B).then((()=>{for(const Z of B._babylonSounds)Z.attachToMesh(l),void 0==B.innerAngle&&void 0==B.outerAngle||(Z.setLocalDirectionToMesh(x.ql.Forward()),Z.setDirectionalCone(2*K.Tools.ToDegrees(void 0==B.innerAngle?Math.PI:B.innerAngle),2*K.Tools.ToDegrees(void 0==B.outerAngle?Math.PI:B.outerAngle),0))})))}C(l)}));return await Promise.all(b),f}))}loadAnimationAsync(Z,l){return T.LoadExtensionAsync(Z,l,this.name,(async(C,B)=>{const x=await this._loader.loadAnimationAsync(Z,l),b=new Array;y.Assign(B.events);for(const K of B.events)b.push(this._loadAnimationEventAsync(`${C}/events/${K.index}`,Z,l,K,x));return await Promise.all(b),x}))}_loadClipAsync(Z,l){if(l._objectURL)return l._objectURL;let C;if(l.uri)C=this._loader.loadUriAsync(Z,l,l.uri);else{const B=y.Get(`${Z}/bufferView`,this._loader.Eb.bufferViews,l.bufferView);C=this._loader.loadBufferViewAsync(`/bufferViews/${B.index}`,B)}return l._objectURL=C.then((Z=>URL.createObjectURL(new Blob([Z],{type:l.mimeType})))),l._objectURL}_loadEmitterAsync(Z,l){if(l._babylonSounds=l._babylonSounds||[],!l._babylonData){const Z=new Array,C=l.name||`emitter${l.index}`,B={loop:!1,autoplay:!1,volume:void 0==l.volume?1:l.volume};for(let b=0;b<l.clips.length;b++){const x=`/extensions/${this.name}/clips`,K=y.Get(x,this._clips,l.clips[b].clip);Z.push(this._loadClipAsync(`${x}/${l.clips[b].clip}`,K).then((Z=>{const x=l._babylonSounds[b]=new pl(C,Z,this._loader.babylonScene,null,B);x.refDistance=l.refDistance||1,x.maxDistance=l.maxDistance||256,x.rolloffFactor=l.rolloffFactor||1,x.distanceModel=l.distanceModel||"exponential"})))}const x=Promise.all(Z).then((()=>{const Z=l.clips.map((Z=>Z.weight||1)),C=new Nl(l.loop||!1,l._babylonSounds,Z);l.innerAngle&&(C.directionalConeInnerAngle=2*K.Tools.ToDegrees(l.innerAngle)),l.outerAngle&&(C.directionalConeOuterAngle=2*K.Tools.ToDegrees(l.outerAngle)),l.volume&&(C.volume=l.volume),l._babylonData.sound=C}));l._babylonData={loaded:x}}return l._babylonData.loaded}_getEventAction(Z,l,C,B,x){switch(C){case"play":return Z=>{const C=(x||0)+(Z-B);l.play(C)};case"stop":return()=>{l.stop()};case"pause":return()=>{l.pause()};default:throw new Error(`${Z}: Unsupported action ${C}`)}}_loadAnimationEventAsync(Z,l,C,B,x){if(0==x.targetedAnimations.length)return Promise.resolve();const b=x.targetedAnimations[0],K=B.Bl,f=y.Get(`/extensions/${this.name}/emitters`,this._emitters,K);return this._loadEmitterAsync(Z,f).then((()=>{const l=f._babylonData.sound;if(l){const C=new Ql(B.time,this._getEventAction(Z,l,B.action,B.time,B.startOffset));b.animation.addEvent(C),x.onAnimationGroupEndObservable.add((()=>{l.stop()})),x.onAnimationGroupPauseObservable.add((()=>{l.pause()}))}}))}}I(KC),M(KC,!0,(Z=>new fC(Z)));const WC="MSFT_lod";class JC{constructor(Z){var l;this.name=WC,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new d.b,this.onMaterialLODsLoadedObservable=new d.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=Z,this.maxLODsToLoad=(null===(l=this._loader.parent.extensionOptions[WC])||void 0===l?void 0:l.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(WC)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let Z=0;Z<this._nodePromiseLODs.length;Z++){const l=Promise.all(this._nodePromiseLODs[Z]).then((()=>{0!==Z&&(this._loader.endPerformanceCounter(`Node LOD ${Z}`),this._loader.log(`Loaded node LOD ${Z}`)),this.onNodeLODsLoadedObservable.notifyObservers(Z),Z!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${Z+1}`),this._loadBufferLOD(this._nodeBufferLODs,Z+1),this._nodeSignalLODs[Z]&&this._nodeSignalLODs[Z].resolve())}));this._loader._completePromises.push(l)}for(let Z=0;Z<this._materialPromiseLODs.length;Z++){const l=Promise.all(this._materialPromiseLODs[Z]).then((()=>{0!==Z&&(this._loader.endPerformanceCounter(`Material LOD ${Z}`),this._loader.log(`Loaded material LOD ${Z}`)),this.onMaterialLODsLoadedObservable.notifyObservers(Z),Z!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${Z+1}`),this._loadBufferLOD(this._materialBufferLODs,Z+1),this._materialSignalLODs[Z]&&this._materialSignalLODs[Z].resolve())}));this._loader._completePromises.push(l)}}loadSceneAsync(Z,l){const C=this._loader.loadSceneAsync(Z,l);return this._loadBufferLOD(this._bufferLODs,0),C}loadNodeAsync(Z,l,C){return T.LoadExtensionAsync(Z,l,this.name,(async(Z,x)=>{let b;const K=this._getLODs(Z,l,this._loader.Eb.nodes,x.ids);this._loader.logOpen(`${Z}`);for(let l=0;l<K.length;l++){const Z=K[l];0!==l&&(this._nodeIndexLOD=l,this._nodeSignalLODs[l]=this._nodeSignalLODs[l]||new B);const x=Z=>{C(Z),Z.VW(!1)},f=this._loader.loadNodeAsync(`/nodes/${Z.index}`,Z,x).then((Z=>{if(0!==l){const Z=K[l-1];Z._babylonTransformNode&&(this._disposeTransformNode(Z._babylonTransformNode),delete Z._babylonTransformNode)}return Z.VW(!0),Z}));this._nodePromiseLODs[l]=this._nodePromiseLODs[l]||[],0===l?b=f:(this._nodeIndexLOD=null,this._nodePromiseLODs[l].push(f))}return this._loader.logClose(),await b}))}_loadMaterialAsync(Z,l,C,B,x){return this._nodeIndexLOD?null:T.LoadExtensionAsync(Z,l,this.name,(async(Z,b)=>{let K;const f=this._getLODs(Z,l,this._loader.Eb.materials,b.ids);this._loader.logOpen(`${Z}`);for(let l=0;l<f.length;l++){const Z=f[l];0!==l&&(this._materialIndexLOD=l);const b=this._loader._loadMaterialAsync(`/materials/${Z.index}`,Z,C,B,(Z=>{0===l&&x(Z)})).then((Z=>{if(0!==l){x(Z);const C=f[l-1]._data;C[B]&&(this._disposeMaterials([C[B].babylonMaterial]),delete C[B])}return Z}));this._materialPromiseLODs[l]=this._materialPromiseLODs[l]||[],0===l?K=b:(this._materialIndexLOD=null,this._materialPromiseLODs[l].push(b))}return this._loader.logClose(),await K}))}_loadUriAsync(Z,l,C){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const x=this._nodeIndexLOD-1;return this._nodeSignalLODs[x]=this._nodeSignalLODs[x]||new B,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(Z,l,C)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const x=this._materialIndexLOD-1;return this._materialSignalLODs[x]=this._materialSignalLODs[x]||new B,this._materialSignalLODs[x].promise.then((async()=>await this._loader.loadUriAsync(Z,l,C)))}return null}loadBufferAsync(Z,l,C,x){if(this._loader.parent.useRangeRequests&&!l.uri){if(!this._loader.bin)throw new Error(`${Z}: Uri is missing or the binary glTF is missing its binary chunk`);const l=async(Z,l)=>{const b=C,K=b+x-1;let f=Z[l];return f?(f.start=Math.min(f.start,b),f.end=Math.max(f.end,K)):(f={start:b,end:K,loaded:new B},Z[l]=f),await f.loaded.promise.then((Z=>new Uint8Array(Z.buffer,Z.byteOffset+C-f.start,x)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?l(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?l(this._materialBufferLODs,this._materialIndexLOD):l(this._bufferLODs,0)}return null}_loadBufferLOD(Z,l){const C=Z[l];C&&(this._loader.log(`Loading buffer range [${C.start}-${C.end}]`),this._loader.bin.readAsync(C.start,C.end-C.start+1).then((Z=>{C.loaded.resolve(Z)}),(Z=>{C.loaded.reject(Z)})))}_getLODs(Z,l,C,B){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const x=[];for(let b=B.length-1;b>=0;b--)if(x.push(y.Get(`${Z}/ids/${B[b]}`,C,B[b])),x.length===this.maxLODsToLoad)return x;return x.push(l),x}_disposeTransformNode(Z){const l=[],C=Z.material;C&&l.push(C);for(const x of Z.getChildMeshes())x.material&&l.push(x.material);Z.dispose();const B=l.filter((Z=>this._loader.babylonScene.meshes.every((l=>l.material!=Z))));this._disposeMaterials(B)}_disposeMaterials(Z){const l={};for(const C of Z){for(const Z of C.getActiveTextures())l[Z.uniqueId]=Z;C.dispose()}for(const C in l)for(const Z of this._loader.babylonScene.materials)Z.hasTexture(l[C])&&delete l[C];for(const C in l)l[C].dispose()}}I(WC),M(WC,!0,(Z=>new JC(Z)));const dC="MSFT_minecraftMesh";class EC{constructor(Z){this.name=dC,this._loader=Z,this.enabled=this._loader.isExtensionUsed(dC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtraAsync(Z,l,this.name,(async(B,x)=>{if(x){if(!(C instanceof i.e))throw new Error(`${B}: Material type not supported`);const x=this._loader.loadMaterialPropertiesAsync(Z,l,C);return C.needAlphaBlending()&&(C.forceDepthWrite=!0,C.separateCullingPass=!0),C.Ub=C.forceDepthWrite,C.twoSidedLighting=!0,await x}}))}}I(dC),M(dC,!0,(Z=>new EC(Z)));const GC="MSFT_sRGBFactors";class aC{constructor(Z){this.name=GC,this._loader=Z,this.enabled=this._loader.isExtensionUsed(GC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,l,C){return T.LoadExtraAsync(Z,l,this.name,(async(B,x)=>{if(x){if(!(C instanceof i.e))throw new Error(`${B}: Material type not supported`);const x=this._loader.loadMaterialPropertiesAsync(Z,l,C),b=C.cZ().getEngine().useExactSrgbConversions;return C.albedoTexture||C.albedoColor.toLinearSpaceToRef(C.albedoColor,b),C.reflectivityTexture||C.reflectivityColor.toLinearSpaceToRef(C.reflectivityColor,b),await x}}))}}I(GC),M(GC,!0,(Z=>new aC(Z)));var qC=C(13820);const zC={};var YC=C(13864),PC=C(13844),SC=C(13824),iC=C(13830);function sC(Z,l){for(const C of Z)for(const Z of C.dataOutputs)if(Z.uniqueId===l)return Z;throw new Error("Could not find data out connection with unique id "+l)}function FC(Z,l){for(const C of Z)if(C instanceof PC.e)for(const Z of C.signalInputs)if(Z.uniqueId===l)return Z;throw new Error("Could not find signal in connection with unique id "+l)}async function nC(Z,l){const B=await Promise.all(Z.allBlocks.map((async Z=>{const l=function(Z){switch(Z){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([C.e(78),C.e(79)]).then(C.bind(C,15305))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await C.e(80).then(C.bind(C,15311))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await C.e(81).then(C.bind(C,15320))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await C.e(82).then(C.bind(C,15327))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await C.e(83).then(C.bind(C,15330))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await C.e(84).then(C.bind(C,15334))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await C.e(85).then(C.bind(C,15342))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await C.e(86).then(C.bind(C,15350))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await C.e(87).then(C.bind(C,15355))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await C.e(90).then(C.bind(C,15395))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await C.e(90).then(C.bind(C,15395))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await C.e(90).then(C.bind(C,15395))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await C.e(90).then(C.bind(C,15395))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await C.e(95).then(C.bind(C,15397))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await C.e(96).then(C.bind(C,15404))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await C.e(97).then(C.bind(C,15406))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await C.e(98).then(C.bind(C,15408))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await C.e(99).then(C.bind(C,15413))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await C.e(100).then(C.bind(C,15420))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await C.e(101).then(C.bind(C,15428))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await C.e(102).then(C.bind(C,15435))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await C.e(103).then(C.bind(C,15442))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await C.e(104).then(C.bind(C,15446))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await C.e(105).then(C.bind(C,15455))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await C.e(106).then(C.bind(C,15457))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await C.e(107).then(C.bind(C,15463))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await C.e(108).then(C.bind(C,15466))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await C.e(109).then(C.bind(C,15472))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await C.e(110).then(C.bind(C,15480))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await C.e(111).then(C.bind(C,15483))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await C.e(112).then(C.bind(C,15489))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await C.e(113).then(C.bind(C,15493))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await C.e(92).then(C.bind(C,15495))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await C.e(114).then(C.bind(C,15499))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await C.e(115).then(C.bind(C,15508))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await C.e(116).then(C.bind(C,15511))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await C.e(93).then(C.bind(C,15515))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await C.e(88).then(C.bind(C,15361))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await C.e(94).then(C.bind(C,15524))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await C.e(94).then(C.bind(C,15524))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await C.e(94).then(C.bind(C,15524))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,15524))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await C.e(94).then(C.bind(C,15524))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await C.e(94).then(C.bind(C,15524))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await C.e(94).then(C.bind(C,15524))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,15524))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await C.e(89).then(C.bind(C,15387))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await C.e(90).then(C.bind(C,15395))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await C.e(90).then(C.bind(C,15395))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await C.e(91).then(C.bind(C,15526))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await C.e(91).then(C.bind(C,15526))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await C.e(91).then(C.bind(C,15526))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await C.e(91).then(C.bind(C,15526))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await C.e(91).then(C.bind(C,15526))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await C.e(91).then(C.bind(C,15526))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await C.e(117).then(C.bind(C,15534))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await C.e(118).then(C.bind(C,15543))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await C.e(119).then(C.bind(C,15552))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await C.e(120).then(C.bind(C,15559))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await C.e(121).then(C.bind(C,15568))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await C.e(122).then(C.bind(C,15573))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await C.e(123).then(C.bind(C,15577))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await C.e(124).then(C.bind(C,15583))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await C.e(125).then(C.bind(C,15586))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await C.e(126).then(C.bind(C,15590))).FlowGraphDataSwitchBlock;default:if(zC[Z])return zC[Z];throw new Error(`Unknown block name ${Z}`)}}(Z.className);return await l()})));return function(Z,l,C){const B=l.coordinator.createGraph(),x=[],b=l.valueParseFunction??SC.e;for(let K=0;K<Z.allBlocks.length;K++){const f=UC(Z.allBlocks[K],{Yl:l.coordinator.config.Yl,pathConverter:l.pathConverter,assetsContainer:l.coordinator.config.Yl,valueParseFunction:b},C[K]);x.push(f),f instanceof YC.d&&B.addEventBlock(f)}for(const K of x){for(const Z of K.dataInputs)for(const l of Z.connectedPointIds){const C=sC(x,l);Z.connectTo(C)}if(K instanceof PC.e)for(const Z of K.signalOutputs)for(const l of Z.connectedPointIds){const C=FC(x,l);Z.connectTo(C)}}for(const K of Z.executionContexts)cC(K,{graph:B,valueParseFunction:b},Z.rightHanded);return B}(Z,l,B)}function cC(Z,l,C){const B=l.graph.createContext();Z.enableLogging&&(B.enableLogging=!0),B.treatDataAsRightHanded=C||!1;const x=l.valueParseFunction??SC.e;B.uniqueId=Z.uniqueId;const b=B.cZ();if(Z._assetsContext){var K,f,W,J,d,E,G,a,q,z;const l=Z._assetsContext,C={meshes:null===(K=l.meshes)||void 0===K?void 0:K.map((Z=>b.getMeshById(Z))),lights:null===(f=l.lights)||void 0===f?void 0:f.map((Z=>b.getLightByName(Z))),cameras:null===(W=l.cameras)||void 0===W?void 0:W.map((Z=>b.getCameraByName(Z))),materials:null===(J=l.materials)||void 0===J?void 0:J.map((Z=>b.getMaterialById(Z))),textures:null===(d=l.textures)||void 0===d?void 0:d.map((Z=>b.getTextureByName(Z))),animations:null===(E=l.animations)||void 0===E?void 0:E.map((Z=>b.animations.find((l=>l.name===Z)))),skeletons:null===(G=l.skeletons)||void 0===G?void 0:G.map((Z=>b.getSkeletonByName(Z))),Ka:null===(a=l.Ka)||void 0===a?void 0:a.map((Z=>b.getParticleSystemById(Z))),animationGroups:null===(q=l.animationGroups)||void 0===q?void 0:q.map((Z=>b.getAnimationGroupByName(Z))),transformNodes:null===(z=l.transformNodes)||void 0===z?void 0:z.map((Z=>b.getTransformNodeById(Z))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Da:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};B.assetsContext=C}for(const Y in Z._userVariables){const l=x(Y,Z._userVariables,B.assetsContext,b);B.userVariables[Y]=l}for(const Y in Z._connectionValues){const l=x(Y,Z._connectionValues,B.assetsContext,b);B._setConnectionValueByKey(Y,l)}return B}function UC(Z,l,C){const B={},x=l.valueParseFunction??SC.e;if(Z.config)for(const K in Z.config)B[K]=x(K,Z.config,l.assetsContainer||l.Yl,l.Yl);if((0,SC.i)(Z.className)){if(!l.pathConverter)throw new Error("Path converter is required for this block");B.pathConverter=l.pathConverter}const b=new C(B);b.uniqueId=Z.uniqueId;for(let K=0;K<Z.dataInputs.length;K++){const l=b.getDataInput(Z.dataInputs[K].name);if(!l)throw new Error("Could not find data input with name "+Z.dataInputs[K].name+" in block "+Z.className);l.deserialize(Z.dataInputs[K])}for(let K=0;K<Z.dataOutputs.length;K++){const l=b.getDataOutput(Z.dataOutputs[K].name);if(!l)throw new Error("Could not find data output with name "+Z.dataOutputs[K].name+" in block "+Z.className);l.deserialize(Z.dataOutputs[K])}return b.metadata=Z.metadata,b.deserialize&&b.deserialize(Z),b}function tC(Z){const[l,C]=Z.split(":");return rC({op:l,extension:C})}function rC(Z){var l;let C=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const B=Z.extension?null===(l=oC[Z.extension])||void 0===l?void 0:l[Z.op]:vC[Z.op];if(!B&&(z.e.Warn(`No mapping found for operation ${Z.op} and extension ${Z.extension||"KHR_interactivity"}`),C)){const l={},C={flows:{}};if(Z.inputValueSockets){l.values={};for(const C in Z.inputValueSockets)l.values[C]={name:C}}return Z.outputValueSockets&&(C.values={},Object.keys(Z.outputValueSockets).forEach((Z=>{C.values[Z]={name:Z}}))),{UE:[],inputs:l,outputs:C}}return B}function eC(Z,l,C){oC[l]||(oC[l]={}),oC[l][Z]=C}const oC={BABYLON:{"flow/log":{UE:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},vC={"event/onStart":{UE:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{UE:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{UE:["FlowGraphSendCustomEventBlock"],extraProcessor(Z,l,C,B,x){if("event/send"!==l.op||!Z.configuration||1!==Object.keys(Z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const b=Z.configuration.event.value[0];if("number"!==typeof b)throw new Error("Event id should be a number");const K=B.arrays.events[b],f=x[0];return f.config||(f.config={}),f.config.eventId=K.eventId,f.config.eventData=K.eventData,x}},"event/receive":{UE:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(Z,l){var C;if(!Z.configuration)return z.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const B=Z.configuration.event;if(!B)return z.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const x=B.value[0];if("number"!==typeof x)return z.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(C=l.events)||void 0===C?void 0:C[x])?{valid:!0}:(z.e.Error(`Event with id ${x} not found`),{valid:!1,error:`Event with id ${x} not found`})},extraProcessor(Z,l,C,B,x){if("event/receive"!==l.op||!Z.configuration||1!==Object.keys(Z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const b=Z.configuration.event.value[0];if("number"!==typeof b)throw new Error("Event id should be a number");const K=B.arrays.events[b],f=x[0];return f.config||(f.config={}),f.config.eventId=K.eventId,f.config.eventData=K.eventData,x}},"math/e":RC("FlowGraphEBlock"),"math/pi":RC("FlowGraphPIBlock"),"math/inf":RC("FlowGraphInfBlock"),"math/nan":RC("FlowGraphNaNBlock"),"math/abs":RC("FlowGraphAbsBlock"),"math/sign":RC("FlowGraphSignBlock"),"math/trunc":RC("FlowGraphTruncBlock"),"math/floor":RC("FlowGraphFloorBlock"),"math/ceil":RC("FlowGraphCeilBlock"),"math/round":{UE:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,l,C,B,x){var b;return(b=x[0]).config||(b.config={}),x[0].config.roundHalfAwayFromZero=!0,x}},"math/fract":RC("FlowGraphFractBlock"),"math/neg":RC("FlowGraphNegationBlock"),"math/add":RC("FlowGraphAddBlock",["a","b"],!0),"math/sub":RC("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{UE:["FlowGraphMultiplyBlock"],extraProcessor(Z,l,C,B,x){var b;(b=x[0]).config||(b.config={}),x[0].config.useMatrixPerComponent=!0,x[0].config.preventIntegerFloatArithmetic=!0;let K=-1;return Object.keys(Z.values||{}).find((l=>{var C;return void 0!==(null===(C=Z.values)||void 0===C?void 0:C[l].type)&&(K=Z.values[l].type,!0)})),-1!==K&&(x[0].config.type=B.arrays.types[K].flowGraphType),x},validation:Z=>Z.values?kC(Z):{valid:!0}},"math/div":RC("FlowGraphDivideBlock",["a","b"],!0),"math/rem":RC("FlowGraphModuloBlock",["a","b"]),"math/min":RC("FlowGraphMinBlock",["a","b"]),"math/max":RC("FlowGraphMaxBlock",["a","b"]),"math/clamp":RC("FlowGraphClampBlock",["a","b","c"]),"math/saturate":RC("FlowGraphSaturateBlock"),"math/mix":RC("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":RC("FlowGraphEqualityBlock",["a","b"]),"math/lt":RC("FlowGraphLessThanBlock",["a","b"]),"math/le":RC("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":RC("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":RC("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":RC("FlowGraphIsNaNBlock"),"math/isinf":RC("FlowGraphIsInfBlock"),"math/select":{UE:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{UE:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":RC("FlowGraphSinBlock"),"math/cos":RC("FlowGraphCosBlock"),"math/tan":RC("FlowGraphTanBlock"),"math/asin":RC("FlowGraphASinBlock"),"math/acos":RC("FlowGraphACosBlock"),"math/atan":RC("FlowGraphATanBlock"),"math/atan2":RC("FlowGraphATan2Block",["a","b"]),"math/sinh":RC("FlowGraphSinhBlock"),"math/cosh":RC("FlowGraphCoshBlock"),"math/tanh":RC("FlowGraphTanhBlock"),"math/asinh":RC("FlowGraphASinhBlock"),"math/acosh":RC("FlowGraphACoshBlock"),"math/atanh":RC("FlowGraphATanhBlock"),"math/exp":RC("FlowGraphExponentialBlock"),"math/log":RC("FlowGraphLogBlock"),"math/log2":RC("FlowGraphLog2Block"),"math/log10":RC("FlowGraphLog10Block"),"math/sqrt":RC("FlowGraphSquareRootBlock"),"math/cbrt":RC("FlowGraphCubeRootBlock"),"math/pow":RC("FlowGraphPowerBlock",["a","b"]),"math/length":RC("FlowGraphLengthBlock"),"math/normalize":RC("FlowGraphNormalizeBlock"),"math/dot":RC("FlowGraphDotBlock",["a","b"]),"math/cross":RC("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":RC("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":RC("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{UE:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{UE:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{UE:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{UE:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{UE:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{UE:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{UE:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":RC("FlowGraphTransposeBlock"),"math/determinant":RC("FlowGraphDeterminantBlock"),"math/inverse":RC("FlowGraphInvertMatrixBlock"),"math/matmul":RC("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{UE:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"eb",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,l,C,B,x,b){const K=x[0].dataInputs.find((Z=>"rotationQuaternion"===Z.name));if(!K)throw new Error("Rotation quaternion input not found");return b._connectionValues[K.uniqueId]&&(b._connectionValues[K.uniqueId].type="Quaternion"),x}},"math/matDecompose":{UE:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"eb"}}}},"math/quatConjugate":RC("FlowGraphConjugateBlock",["a"]),"math/quatMul":{UE:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,l,C,B,x){var b;return(b=x[0]).config||(b.config={}),x[0].config.type="Quaternion",x}},"math/quatAngleBetween":RC("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{UE:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":RC("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":RC("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{UE:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,l,C,B,x){var b;return(b=x[0]).config||(b.config={}),x[0].config.inputIsColumnMajor=!0,x}},"math/extract2x2":{UE:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{UE:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,l,C,B,x){var b;return(b=x[0]).config||(b.config={}),x[0].config.inputIsColumnMajor=!0,x}},"math/extract3x3":{UE:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{UE:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,l,C,B,x){var b;return(b=x[0]).config||(b.config={}),x[0].config.inputIsColumnMajor=!0,x}},"math/extract4x4":{UE:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{UE:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,l,C,B,x,b){var K,f;(f=x[0]).config||(f.config={});const W=x[0].dataInputs[0];return x[0].config.valueType=(null===(K=b._connectionValues[W.uniqueId])||void 0===K?void 0:K.type)??"FlowGraphInteger",x}},"math/and":{UE:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,l,C,B,x,b){var K,f,W;(W=x[0]).config||(W.config={});const J=x[0].dataInputs[0],d=x[0].dataInputs[1];return x[0].config.valueType=(null===(K=b._connectionValues[J.uniqueId])||void 0===K?void 0:K.type)??(null===(f=b._connectionValues[d.uniqueId])||void 0===f?void 0:f.type)??"FlowGraphInteger",x}},"math/or":{UE:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,l,C,B,x,b){var K,f,W;(W=x[0]).config||(W.config={});const J=x[0].dataInputs[0],d=x[0].dataInputs[1];return x[0].config.valueType=(null===(K=b._connectionValues[J.uniqueId])||void 0===K?void 0:K.type)??(null===(f=b._connectionValues[d.uniqueId])||void 0===f?void 0:f.type)??"FlowGraphInteger",x}},"math/xor":{UE:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,l,C,B,x,b){var K,f,W;(W=x[0]).config||(W.config={});const J=x[0].dataInputs[0],d=x[0].dataInputs[1];return x[0].config.valueType=(null===(K=b._connectionValues[J.uniqueId])||void 0===K?void 0:K.type)??(null===(f=b._connectionValues[d.uniqueId])||void 0===f?void 0:f.type)??"FlowGraphInteger",x}},"math/asr":RC("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":RC("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":RC("FlowGraphLeadingZerosBlock"),"math/ctz":RC("FlowGraphTrailingZerosBlock"),"math/popcnt":RC("FlowGraphOneBitsCounterBlock"),"math/rad":RC("FlowGraphDegToRadBlock"),"math/deg":RC("FlowGraphRadToDegBlock"),"type/boolToInt":RC("FlowGraphBooleanToInt"),"type/boolToFloat":RC("FlowGraphBooleanToFloat"),"type/intToBool":RC("FlowGraphIntToBoolean"),"type/intToFloat":RC("FlowGraphIntToFloat"),"type/floatToInt":RC("FlowGraphFloatToInt"),"type/floatToBool":RC("FlowGraphFloatToBoolean"),"flow/sequence":{UE:["FlowGraphSequenceBlock"],extraProcessor(Z,l,C,B,x){const b=x[0];return b.config||(b.config={}),b.config.outputSignalCount=Object.keys(Z.flows||[]).length,b.signalOutputs.forEach(((Z,l)=>{Z.name="out_"+l})),x}},"flow/branch":{UE:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{UE:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(Z){if(Z.configuration&&Z.configuration.cases){const l=Z.configuration.cases.value;if(!l.every((Z=>"number"===typeof Z&&/^-?\d+$/.test(Z.toString()))))return z.e.Warn("Switch cases should be integers. Using empty array instead."),Z.configuration.cases.value=[],{valid:!0};const C=new Set(l);Z.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(Z,l,C,B,x){if("flow/switch"!==l.op||!Z.flows||0===Object.keys(Z.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return x[0].signalOutputs.forEach((Z=>{"default"!==Z.name&&(Z.name="out_"+Z.name)})),x}},"flow/while":{UE:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{UE:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(Z,l,C,B,x){const b=x[0];return b.config||(b.config={}),b.config.incrementIndexWhenLoopDone=!0,x}},"flow/doN":{UE:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{UE:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(Z,l,C,B,x){if("flow/multiGate"!==l.op||!Z.flows||0===Object.keys(Z.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const b=x[0];return b.config||(b.config={}),b.config.outputSignalCount=Object.keys(Z.flows).length,b.signalOutputs.forEach(((Z,l)=>{Z.name="out_"+l})),x}},"flow/waitAll":{UE:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(Z){var l,C;return"number"!==typeof(null===(l=Z.configuration)||void 0===l||null===(C=l.inputFlows)||void 0===C?void 0:C.value[0])&&(Z.configuration=Z.configuration||{inputFlows:{value:[0]}},Z.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{UE:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{UE:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{UE:["FlowGraphCancelDelayBlock"]},"variable/get":{UE:["FlowGraphGetVariableBlock"],validation(Z){var l,C;return null!==(l=Z.configuration)&&void 0!==l&&null!==(C=l.variable)&&void 0!==C&&C.value?{valid:!0}:(z.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Z,l)=>[l.getVariableName(Z[0])]}}},"variable/set":{UE:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Z,l)=>[l.getVariableName(Z[0])]}}},"variable/setMultiple":{UE:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(Z,l)=>[Z[0].map((Z=>l.getVariableName(Z)))]}},extraProcessor:(Z,l,C,B,x)=>(x[0].dataInputs.forEach((Z=>{Z.name=B.getVariableName(+Z.name)})),x)},"variable/interpolate":{UE:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(Z,l)=>[l.getVariableName(Z[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:Z=>!0===Z[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",YC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",YC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",YC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",YC:"FlowGraphPlayAnimationBlock"},out:{name:"out",YC:"FlowGraphPlayAnimationBlock"},done:{name:"done",YC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(Z,l,C,B,x){var b,K,f;const W=x[0],J=null===(b=Z.configuration)||void 0===b?void 0:b.variable.value[0];if("number"!==typeof J)throw z.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const d=B.arrays.staticVariables[J];"undefined"===typeof W.config.animationType.value&&(B.arrays.staticVariables,W.config.animationType.value=(0,iC.D)(d.type));const E=x[4];return E.config||(E.config={}),(K=E.config).variable||(K.variable={}),E.config.variable.value=B.getVariableName(J),(f=x[3]).config||(f.config={}),x}},"pointer/get":{UE:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",YC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",YC:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,l,C,B,x)=>(x.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className&&(Z.config||(Z.config={}),Z.config.outputValue=!0)})),x)},"pointer/set":{UE:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",YC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",YC:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,l,C,B,x)=>(x.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className&&(Z.config||(Z.config={}),Z.config.outputValue=!0)})),x)},"pointer/interpolate":{UE:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",YC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",YC:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",YC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",YC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",YC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",YC:"FlowGraphPlayAnimationBlock"},out:{name:"out",YC:"FlowGraphPlayAnimationBlock"},done:{name:"done",YC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,l,C,B,x)=>(x.forEach((l=>{"FlowGraphJsonPointerParserBlock"===l.className?(l.config||(l.config={}),l.config.outputValue=!0):"FlowGraphInterpolationBlock"===l.className&&(l.config||(l.config={}),Object.keys(Z.values||[]).forEach((C=>{var x;const b=null===(x=Z.values)||void 0===x?void 0:x[C];if("value"===C&&b){const Z=b.type;void 0!==Z&&(l.config.animationType=B.arrays.types[Z].flowGraphType)}})))})),x)},"animation/start":{UE:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",YC:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(Z,l)=>[Z[0]*l._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(Z,l)=>[Z[0]*l._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,l,C,B,x,b,K){const f=x[x.length-1];return f.config||(f.config={}),f.config.glTF=K,x}},"animation/stop":{UE:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",YC:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,l,C,B,x,b,K){const f=x[x.length-1];return f.config||(f.config={}),f.config.glTF=K,x}},"animation/stopAt":{UE:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",YC:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(Z,l)=>[Z[0]*l._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,l,C,B,x,b,K){const f=x[x.length-1];return f.config||(f.config={}),f.config.glTF=K,x}},"math/switch":{UE:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(Z){if(Z.configuration&&Z.configuration.cases){const l=Z.configuration.cases.value;if(!l.every((Z=>"number"===typeof Z&&/^-?\d+$/.test(Z.toString()))))return z.e.Warn("Switch cases should be integers. Using empty array instead."),Z.configuration.cases.value=[],{valid:!0};const C=new Set(l);Z.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(Z,l,C,B,x){const b=x[0];return b.dataInputs.forEach((Z=>{"default"!==Z.name&&"case"!==Z.name&&(Z.name="in_"+Z.name)})),b.config||(b.config={}),b.config.treatCasesAsIntegers=!0,x}},"debug/log":{UE:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function RC(Z){let l=arguments.length>2?arguments[2]:void 0;return{UE:[Z],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((Z,l)=>(Z[l]={name:l},Z)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,C,B,x,b){var K;if(l){(K=b[0]).config||(K.config={}),b[0].config.preventIntegerFloatArithmetic=!0;let l=-1;Object.keys(Z.values||{}).find((C=>{var B;return void 0!==(null===(B=Z.values)||void 0===B?void 0:B[C].type)&&(l=Z.values[C].type,!0)})),-1!==l&&(b[0].config.type=x.arrays.types[l].flowGraphType)}return b},validation:Z=>l?kC(Z):{valid:!0}}}function kC(Z){if(Z.values){const l=Object.keys(Z.values).map((l=>Z.values[l].type)).filter((Z=>void 0!==Z));if(!l.every((Z=>Z===l[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}vC["math/compose"]=vC["math/matCompose"],vC["math/decompose"]=vC["math/matDecompose"];var VC=C(12403);const gC={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ql",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class jC{constructor(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=Z,this._gltf=l,this._animationTargetFps=C,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const Z of this._interactivityGraph.types)this._types.push(gC[Z.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const Z of this._interactivityGraph.declarations){const l=rC(Z);if(!l)throw z.e.Error(["No mapping found for declaration",Z]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:l,fullOperationName:Z.extension?Z.op+":"+Z.extension:Z.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const Z of this._interactivityGraph.variables){const l=this._parseVariable(Z);this._staticVariables.push(l)}}_parseVariable(Z,l){const C=this._types[Z.type];if(!C)throw z.e.Error(["No type found for variable",Z]),new Error("Error parsing variables");if(Z.value&&Z.value.length!==C.length)throw z.e.Error(["Invalid value length for variable",Z,C]),new Error("Error parsing variables");const B=Z.value||[];if(!B.length)switch(C.flowGraphType){case"boolean":B.push(!1);break;case"FlowGraphInteger":B.push(0);break;case"number":B.push(NaN);break;case"Vector2":B.push(NaN,NaN);break;case"ql":B.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":B.fill(NaN,0,4);break;case"Matrix":B.fill(NaN,0,16);break;case"Matrix3D":B.fill(NaN,0,9)}return"number"===C.elementType&&"string"===typeof B[0]&&(B[0]=parseFloat(B[0])),{type:C.flowGraphType,value:l?l(B,this):B}}_parseEvents(){if(this._interactivityGraph.events)for(const Z of this._interactivityGraph.events){const l={eventId:Z.id||"internalEvent_"+this._internalEventsCounter++};Z.values&&(l.eventData=Object.keys(Z.values).map((l=>{var C;const B=null===(C=Z.values)||void 0===C?void 0:C[l];if(!B)throw z.e.Error(["No value found for event key",l]),new Error("Error parsing events");const x=this._types[B.type];if(!x)throw z.e.Error(["No type found for event value",B]),new Error("Error parsing events");const b="undefined"!==typeof B.value?this._parseVariable(B):void 0;return{id:l,type:x.flowGraphType,eventData:!0,value:b}}))),this._events.push(l)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const l of this._interactivityGraph.nodes){if("number"!==typeof l.declaration)throw z.e.Error(["No declaration found for node",l]),new Error("Error parsing nodes");const C=this._mappings[l.declaration];if(!C)throw z.e.Error(["No mapping found for node",l]),new Error("Error parsing nodes");if(C.flowGraphMapping.validation){const B=C.flowGraphMapping.validation(l,this._interactivityGraph,this._gltf);var Z;if(!B.valid)throw new Error(`Error validating interactivity node ${null===(Z=this._interactivityGraph.declarations)||void 0===Z?void 0:Z[l.declaration].op} - ${B.error}`)}const B=[];for(const Z of C.flowGraphMapping.UE){const x=this._getEmptyBlock(Z,C.fullOperationName);this._parseNodeConfiguration(l,x,C.flowGraphMapping,Z),B.push(x)}this._nodes.push({UE:B,fullOperationName:C.fullOperationName})}}_getEmptyBlock(Z,l){return{uniqueId:(0,VC.d)(),className:Z,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:l,metadata:{}}}_parseNodeConfiguration(Z,l,C,B){const x=l.config;if(Z.configuration){const l=Object.keys(Z.configuration);for(const f of l){var b,K;const l=null===(b=Z.configuration)||void 0===b?void 0:b[f];if(!l)throw z.e.Error(["No value found for node configuration",f]),new Error("Error parsing node configuration");const W=null===(K=C.configuration)||void 0===K?void 0:K[f];if(W&&W.YC?W.YC===B:0===C.UE.indexOf(B)){const Z=(null===W||void 0===W?void 0:W.name)||f;l&&"undefined"!==typeof l.value||"undefined"===typeof(null===W||void 0===W?void 0:W.defaultValue)?l.value.length>=0?x[Z]={value:1===l.value.length?l.value[0]:l.value}:z.e.Warn(["Invalid value for node configuration",l]):x[Z]={value:W.defaultValue},W&&W.dataTransformer&&(x[Z].value=W.dataTransformer([x[Z].value],this)[0])}}}}_parseNodeConnections(Z){for(let n=0;n<this._nodes.length;n++){var l;const c=null===(l=this._interactivityGraph.nodes)||void 0===l?void 0:l[n];if(!c)throw z.e.Error(["No node found for interactivity node",this._nodes[n]]),new Error("Error parsing node connections");const U=this._nodes[n],t=this._mappings[c.declaration];if(!t)throw z.e.Error(["No mapping found for node",c]),new Error("Error parsing node connections");const r=c.flows||{},e=Object.keys(r).sort();for(const Z of e){var C,B,x,b;const l=r[Z],J=null===(C=t.flowGraphMapping.outputs)||void 0===C||null===(B=C.flows)||void 0===B?void 0:B[Z],d=(null===J||void 0===J?void 0:J.name)||Z,E=this._createNewSocketConnection(d,!0);(J&&J.YC&&U.UE.find((Z=>Z.className===J.YC))||U.UE[0]).signalOutputs.push(E);const G=l.node,a=this._nodes[G];if(!a)throw z.e.Error(["No node found for input node id",G]),new Error("Error parsing node connections");const q=tC(a.fullOperationName);if(!q)throw z.e.Error(["No mapping found for input node",a]),new Error("Error parsing node connections");let Y=null===(x=q.inputs)||void 0===x||null===(b=x.flows)||void 0===b?void 0:b[l.socket||"in"],P=!1;if(!Y)for(const Z in null===(K=q.inputs)||void 0===K?void 0:K.flows){var K,f,W;if(Z.startsWith("[")&&Z.endsWith("]"))P=!0,Y=null===(f=q.inputs)||void 0===f||null===(W=f.flows)||void 0===W?void 0:W[Z]}const S=Y?P?Y.name.replace("$1",l.socket||""):Y.name:l.socket||"in",i=Y&&Y.YC&&a.UE.find((Z=>Z.className===Y.YC))||a.UE[0];let s=i.signalInputs.find((Z=>Z.name===S));s||(s=this._createNewSocketConnection(S),i.signalInputs.push(s)),s.connectedPointIds.push(E.uniqueId),E.connectedPointIds.push(s.uniqueId)}const o=c.values||{},v=Object.keys(o);for(const l of v){var J,d;const C=o[l];let B=null===(J=t.flowGraphMapping.inputs)||void 0===J||null===(d=J.values)||void 0===d?void 0:d[l],x=!1;if(!B)for(const Z in null===(E=t.flowGraphMapping.inputs)||void 0===E?void 0:E.values){var E,G,a;if(Z.startsWith("[")&&Z.endsWith("]"))x=!0,B=null===(G=t.flowGraphMapping.inputs)||void 0===G||null===(a=G.values)||void 0===a?void 0:a[Z]}const b=B?x?B.name.replace("$1",l):B.name:l,K=this._createNewSocketConnection(b);if((B&&B.YC&&U.UE.find((Z=>Z.className===B.YC))||U.UE[0]).dataInputs.push(K),void 0!==C.value){const l=this._parseVariable(C,B&&B.dataTransformer);Z._connectionValues[K.uniqueId]=l}else{if("undefined"===typeof C.node)throw z.e.Error(["Invalid value for value connection",C]),new Error("Error parsing node connections");{var q,Y,P;const Z=C.node,l=C.socket||"value",B=this._nodes[Z];if(!B)throw z.e.Error(["No node found for output socket reference",C]),new Error("Error parsing node connections");const x=tC(B.fullOperationName);if(!x)throw z.e.Error(["No mapping found for output socket reference",C]),new Error("Error parsing node connections");let b=null===(q=x.outputs)||void 0===q||null===(Y=q.values)||void 0===Y?void 0:Y[l],f=!1;if(!b)for(const C in null===(S=x.outputs)||void 0===S?void 0:S.values){var S,i,s;if(C.startsWith("[")&&C.endsWith("]"))f=!0,b=null===(i=x.outputs)||void 0===i||null===(s=i.values)||void 0===s?void 0:s[C]}const W=b?f?b.name.replace("$1",l):null===(P=b)||void 0===P?void 0:P.name:l,J=b&&b.YC&&B.UE.find((Z=>Z.className===b.YC))||B.UE[0];let d=J.dataOutputs.find((Z=>Z.name===W));d||(d=this._createNewSocketConnection(W,!0),J.dataOutputs.push(d)),K.connectedPointIds.push(d.uniqueId),d.connectedPointIds.push(K.uniqueId)}}}if(t.flowGraphMapping.interBlockConnectors)for(const Z of t.flowGraphMapping.interBlockConnectors){const l=Z.input,C=Z.output,B=Z.isVariable;this._connectFlowGraphNodes(l,C,U.UE[Z.inputBlockIndex],U.UE[Z.outputBlockIndex],B)}if(t.flowGraphMapping.extraProcessor){var F;const l=null===(F=this._interactivityGraph.declarations)||void 0===F?void 0:F[c.declaration];if(!l)throw z.e.Error(["No declaration found for extra processor",c]),new Error("Error parsing node connections");U.UE=t.flowGraphMapping.extraProcessor(c,l,t.flowGraphMapping,this,U.UE,Z,this._gltf)}}}_createNewSocketConnection(Z,l){return{uniqueId:(0,VC.d)(),name:Z,_connectionType:l?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(Z,l,C,B,x){const b=x?C.dataInputs:C.signalInputs,K=x?B.dataOutputs:B.signalOutputs,f=b.find((l=>l.name===Z))||this._createNewSocketConnection(Z),W=K.find((Z=>Z.name===l))||this._createNewSocketConnection(l,!0);b.find((l=>l.name===Z))||b.push(f),K.find((Z=>Z.name===l))||K.push(W),f.connectedPointIds.push(W.uniqueId),W.connectedPointIds.push(f.uniqueId)}getVariableName(Z){return"staticVariable_"+Z}serializeToFlowGraph(){const Z={uniqueId:(0,VC.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(Z);for(let l=0;l<this._staticVariables.length;l++){const C=this._staticVariables[l];Z._userVariables[this.getVariableName(l)]=C}return{rightHanded:!0,allBlocks:this._nodes.reduce(((Z,l)=>Z.concat(l.UE)),[]),executionContexts:[Z]}}}const MC="KHR_interactivity";class IC{constructor(Z){this._loader=Z,this.name=MC,this.enabled=this._loader.isExtensionUsed(MC),this._pathConverter=(0,w.m)(this._loader.Eb),Z._skipStartAnimationStep=!0;const l=Z.babylonScene;l&&function(Z){(0,w.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!Z.activeCamera)return new x.Quaternion(NaN,NaN,NaN,NaN);const l=x.Quaternion.FromRotationMatrix(Z.activeCamera.getWorldMatrix()).normalize();return Z.useRightHandedSystem||(l.w*=-1,l.x*=-1),l},type:"Quaternion",getTarget:()=>Z.activeCamera}),(0,w.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!Z.activeCamera)return new x.ql(NaN,NaN,NaN);const l=Z.activeCamera.getWorldMatrix().getTranslation();return Z.useRightHandedSystem||(l.x*=-1),l},type:"ql",getTarget:()=>Z.activeCamera}),(0,w.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:Z=>{var l;return(null===(l=Z._babylonAnimationGroup)||void 0===l?void 0:l.isPlaying)??!1},type:"boolean",getTarget:Z=>Z._babylonAnimationGroup}),(0,w.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:Z=>{var l;return((null===(l=Z._babylonAnimationGroup)||void 0===l?void 0:l.from)??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,w.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:Z=>{var l;return((null===(l=Z._babylonAnimationGroup)||void 0===l?void 0:l.to)??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,w.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:Z=>{var l;return((null===(l=Z._babylonAnimationGroup)||void 0===l?void 0:l.getCurrentFrame())??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,w.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:Z=>{var l;return((null===(l=Z._babylonAnimationGroup)||void 0===l?void 0:l.getCurrentFrame())??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup})}(l)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var Z;if(!this._loader.babylonScene||!this._pathConverter)return;const l=this._loader.babylonScene,C=null===(Z=this._loader.Eb.extensions)||void 0===Z?void 0:Z.KHR_interactivity;if(!C)return;const B=new qC.d({Yl:l});B.dispatchEventsSynchronously=!1;const x=C.graphs.map((Z=>new jC(Z,this._loader.Eb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(x.map((async Z=>await nC(Z,{coordinator:B,pathConverter:this._pathConverter})))),B.start()}}var wC;wC=async()=>(await Promise.resolve().then(C.bind(C,13871))).FlowGraphGLTFDataProvider,zC[`${MC}/${"FlowGraphGLTFDataProvider"}`]=wC,I(MC),M(MC,!0,(Z=>new IC(Z)));const OC="KHR_node_visibility";(0,w.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:Z=>{const l=Z._babylonTransformNode;return!l||void 0===l.isVisible||l.isVisible},set:(Z,l)=>{var C,B;null===(C=l._primitiveBabylonMeshes)||void 0===C||C.forEach((Z=>{Z.inheritVisibility=!0})),l._babylonTransformNode&&(l._babylonTransformNode.isVisible=Z),null===(B=l._primitiveBabylonMeshes)||void 0===B||B.forEach((l=>{l.isVisible=Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class DC{constructor(Z){this.name=OC,this._loader=Z,this.enabled=Z.isExtensionUsed(OC)}async onReady(){var Z;null===(Z=this._loader.Eb.nodes)||void 0===Z||Z.forEach((Z=>{var l,C,B,x;(null===(l=Z._primitiveBabylonMeshes)||void 0===l||l.forEach((Z=>{Z.inheritVisibility=!0})),null!==(C=Z.extensions)&&void 0!==C&&C.KHR_node_visibility)&&(!1===(null===(B=Z.extensions)||void 0===B?void 0:B.KHR_node_visibility.visible)&&(Z._babylonTransformNode&&(Z._babylonTransformNode.isVisible=!1),null===(x=Z._primitiveBabylonMeshes)||void 0===x||x.forEach((Z=>{Z.isVisible=!1}))))}))}dispose(){this._loader=null}}I(OC),M(OC,!0,(Z=>new DC(Z)));const yC="KHR_node_selectability";eC("event/onSelect",yC,{UE:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",YC:"FlowGraphGetVariableBlock",dataTransformer:Z=>["pickedMesh_"+Z[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",YC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,l,C,B,x,b,K){var f,W,J,d,E,G;const a=x[x.length-1];a.config=a.config||{},a.config.glTF=K;const q=null===(f=Z.configuration)||void 0===f||null===(W=f.nodeIndex)||void 0===W?void 0:W.value[0];if(void 0===q||"number"!==typeof q)throw new Error("nodeIndex not found in configuration");const z="pickedMesh_"+q;return x[1].config.variable=z,b._userVariables[z]={className:"Mesh",id:null===K||void 0===K||null===(J=K.nodes)||void 0===J||null===(d=J[q]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===K||void 0===K||null===(E=K.nodes)||void 0===E||null===(G=E[q]._babylonTransformNode)||void 0===G?void 0:G.uniqueId},x}}),(0,w.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:Z=>{const l=Z._babylonTransformNode;return!l||void 0===l.rJ||l.rJ},set:(Z,l)=>{var C;null===(C=l._primitiveBabylonMeshes)||void 0===C||C.forEach((l=>{l.rJ=Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"rJ"],type:"boolean"});class XC{constructor(Z){this.name=yC,this._loader=Z,this.enabled=Z.isExtensionUsed(yC)}async onReady(){var Z;null===(Z=this._loader.Eb.nodes)||void 0===Z||Z.forEach((Z=>{var l,C,B;null!==(l=Z.extensions)&&void 0!==l&&l.KHR_node_selectability&&!1===(null===(C=Z.extensions)||void 0===C?void 0:C.KHR_node_selectability.selectable)&&(null===(B=Z._babylonTransformNode)||void 0===B||B.getChildMeshes().forEach((Z=>{Z.rJ=!1})))}))}dispose(){this._loader=null}}I(yC),M(yC,!0,(Z=>new XC(Z)));const TC="KHR_node_hoverability",uC="targetMeshPointerOver_";eC("event/onHoverIn",TC,{UE:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",YC:"FlowGraphGetVariableBlock",dataTransformer:Z=>[uC+Z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",YC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,l,C,B,x,b,K){var f,W,J,d,E,G;const a=x[x.length-1];a.config=a.config||{},a.config.glTF=K;const q=null===(f=Z.configuration)||void 0===f||null===(W=f.nodeIndex)||void 0===W?void 0:W.value[0];if(void 0===q||"number"!==typeof q)throw new Error("nodeIndex not found in configuration");const z=uC+q;return x[1].config.variable=z,b._userVariables[z]={className:"Mesh",id:null===K||void 0===K||null===(J=K.nodes)||void 0===J||null===(d=J[q]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===K||void 0===K||null===(E=K.nodes)||void 0===E||null===(G=E[q]._babylonTransformNode)||void 0===G?void 0:G.uniqueId},x}});const HC="targetMeshPointerOut_";eC("event/onHoverOut",TC,{UE:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",YC:"FlowGraphGetVariableBlock",dataTransformer:Z=>[HC+Z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",YC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,l,C,B,x,b,K){var f,W,J,d,E,G;const a=x[x.length-1];a.config=a.config||{},a.config.glTF=K;const q=null===(f=Z.configuration)||void 0===f||null===(W=f.nodeIndex)||void 0===W?void 0:W.value[0];if(void 0===q||"number"!==typeof q)throw new Error("nodeIndex not found in configuration");const z=HC+q;return x[1].config.variable=z,b._userVariables[z]={className:"Mesh",id:null===K||void 0===K||null===(J=K.nodes)||void 0===J||null===(d=J[q]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===K||void 0===K||null===(E=K.nodes)||void 0===E||null===(G=E[q]._babylonTransformNode)||void 0===G?void 0:G.uniqueId},x}}),(0,w.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:Z=>{const l=Z._babylonTransformNode;return!l||void 0===l.pointerOverDisableMeshTesting||l.pointerOverDisableMeshTesting},set:(Z,l)=>{var C;null===(C=l._primitiveBabylonMeshes)||void 0===C||C.forEach((l=>{l.pointerOverDisableMeshTesting=!Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class QC{constructor(Z){this.name=TC,this._loader=Z,this.enabled=Z.isExtensionUsed(TC)}async onReady(){var Z;null===(Z=this._loader.Eb.nodes)||void 0===Z||Z.forEach((Z=>{var l,C,B;null!==(l=Z.extensions)&&void 0!==l&&l.KHR_node_hoverability&&!1===(null===(C=Z.extensions)||void 0===C?void 0:C.KHR_node_hoverability.hoverable)&&(null===(B=Z._babylonTransformNode)||void 0===B||B.getChildMeshes().forEach((Z=>{Z.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}I(TC),M(TC,!0,(Z=>new QC(Z)));const hC="ExtrasAsMetadata";class AC{_assignExtras(Z,l){if(l.extras&&Object.keys(l.extras).length>0){const C=Z.metadata=Z.metadata||{};(C.Eb=C.Eb||{}).extras=l.extras}}constructor(Z){this.name=hC,this.enabled=!0,this._loader=Z}dispose(){this._loader=null}loadNodeAsync(Z,l,C){return this._loader.loadNodeAsync(Z,l,(Z=>{this._assignExtras(Z,l),C(Z)}))}loadCameraAsync(Z,l,C){return this._loader.loadCameraAsync(Z,l,(Z=>{this._assignExtras(Z,l),C(Z)}))}createMaterial(Z,l,C){const B=this._loader.createMaterial(Z,l,C);return this._assignExtras(B,l),B}}I(hC),M(hC,!1,(Z=>new AC(Z)));C(13871)},13768:(Z,l,C)=>{"use strict";C.d(l,{e:()=>k,g:()=>t,h:()=>U,j:()=>r});var B=C(12251),x=C(12248),b=C(13410),K=C(12874),f=C(12844),W=C(12855),J=C(12263),d=C(12295),E=C(12871),G=C(12960),a=C(12880),q=C(12486);class z{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ka=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Da=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(Z){this._environmentTexture=Z}getNodes(){let Z=[];Z=Z.concat(this.meshes),Z=Z.concat(this.lights),Z=Z.concat(this.cameras),Z=Z.concat(this.transformNodes);for(const l of this.skeletons)Z=Z.concat(l.bones);return Z}}class Y extends z{}class P{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const Z=this.rootNodes;for(const B of Z)B.dispose();Z.length=0;const l=this.skeletons;for(const B of l)B.dispose();l.length=0;const C=this.animationGroups;for(const B of C)B.dispose();C.length=0}}class S extends z{constructor(Z){super(),this._wasAddedToScene=!1,(Z=Z||d.b.LastCreatedScene)&&(this.Yl=Z,this.proceduralTextures=[],Z.xb.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=Z.getEngine().onContextRestoredObservable.add((()=>{for(const Z of this.geometries)Z._rebuild();for(const Z of this.meshes)Z._rebuild();for(const Z of this.Ka)Z.rebuild();for(const Z of this.textures)Z._rebuild()})))}_topologicalSort(Z){const l=new Map;for(const K of Z)l.set(K.uniqueId,K);const C={dependsOn:new Map,dependedBy:new Map};for(const K of Z){const Z=K.uniqueId;C.dependsOn.set(Z,new Set),C.dependedBy.set(Z,new Set)}for(const K of Z){const Z=K.uniqueId,B=C.dependsOn.get(Z);if(K instanceof E.e){const x=K.sourceMesh;l.has(x.uniqueId)&&(B.add(x.uniqueId),C.dependedBy.get(x.uniqueId).add(Z))}const x=C.dependedBy.get(Z);for(const b of K.getDescendants()){const B=b.uniqueId;if(l.has(B)){x.add(B);C.dependsOn.get(B).add(Z)}}}const B=[],x=[];for(const K of Z){const Z=K.uniqueId;0===C.dependsOn.get(Z).size&&(x.push(K),l.delete(Z))}const b=x;for(;b.length>0;){const Z=b.shift();B.push(Z);const x=C.dependedBy.get(Z.uniqueId);for(const B of Array.from(x.values())){const x=C.dependsOn.get(B);x.delete(Z.uniqueId),0===x.size&&l.get(B)&&(b.push(l.get(B)),l.delete(B))}}return l.size>0&&(J.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),l.forEach((Z=>{J.e.Error(Z.name)}))),B}_addNodeAndDescendantsToList(Z,l,C,B){if(C&&(!B||B(C))&&!l.has(C.uniqueId)){Z.push(C),l.add(C.uniqueId);for(const x of C.getDescendants(!0))this._addNodeAndDescendantsToList(Z,l,x,B)}}_isNodeInContainer(Z){return Z instanceof W.e&&-1!==this.meshes.indexOf(Z)||(Z instanceof f.e&&-1!==this.transformNodes.indexOf(Z)||(Z instanceof G.d&&-1!==this.lights.indexOf(Z)||Z instanceof a.d&&-1!==this.cameras.indexOf(Z)))}_isValidHierarchy(){for(const Z of this.meshes)if(Z.parent&&!this._isNodeInContainer(Z.parent))return J.e.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.transformNodes)if(Z.parent&&!this._isNodeInContainer(Z.parent))return J.e.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.lights)if(Z.parent&&!this._isNodeInContainer(Z.parent))return J.e.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.cameras)if(Z.parent&&!this._isNodeInContainer(Z.parent))return J.e.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||x.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const B={},b={},f=new P,W=[],J=[],d={doNotInstantiate:!0,...C},E=[],G=new Set;for(const x of this.transformNodes)null===x.parent&&this._addNodeAndDescendantsToList(E,G,x,d.predicate);for(const x of this.meshes)null===x.parent&&this._addNodeAndDescendantsToList(E,G,x,d.predicate);const a=this._topologicalSort(E),q=(C,x)=>{if(((l,C)=>{if(B[l.uniqueId]=C.uniqueId,b[C.uniqueId]=C,Z&&(C.name=Z(l.name)),C instanceof K.b){const Z=C;if(Z.morphTargetManager){const C=l.morphTargetManager;Z.morphTargetManager=C.clone();for(let l=0;l<C.numTargets;l++){const x=C.getTarget(l),K=Z.morphTargetManager.getTarget(l);B[x.uniqueId]=K.uniqueId,b[K.uniqueId]=K}}}})(C,x),C.parent){const Z=B[C.parent.uniqueId],l=b[Z];x.parent=l||C.parent}if(x.position&&C.position&&x.position.B(C.position),x.rotationQuaternion&&C.rotationQuaternion&&x.rotationQuaternion.B(C.rotationQuaternion),x.rotation&&C.rotation&&x.rotation.B(C.rotation),x.eb&&C.eb&&x.eb.B(C.eb),x.material){const K=x;if(K.material)if(l){const l=C.material;if(-1===J.indexOf(l)){let C=l.clone(Z?Z(l.name):"Clone of "+l.name);if(J.push(l),B[l.uniqueId]=C.uniqueId,b[C.uniqueId]=C,"MultiMaterial"===l.getClassName()){const x=l;for(const l of x.kb)l&&(C=l.clone(Z?Z(l.name):"Clone of "+l.name),J.push(l),B[l.uniqueId]=C.uniqueId,b[C.uniqueId]=C);x.kb=x.kb.map((Z=>Z&&b[B[Z.uniqueId]]))}}"InstancedMesh"!==K.getClassName()&&(K.material=b[B[l.uniqueId]])}else"MultiMaterial"===K.material.getClassName()?-1===this.Yl.multiMaterials.indexOf(K.material)&&this.Yl.addMultiMaterial(K.material):-1===this.Yl.materials.indexOf(K.material)&&this.Yl.addMaterial(K.material)}null===x.parent&&f.rootNodes.push(x)};for(const x of a)if("InstancedMesh"===x.getClassName()){const Z=x,l=Z.sourceMesh,C=B[l.uniqueId];q(Z,("number"===typeof C?b[C]:l).createInstance(Z.name))}else{let Z=!0;"Db"===x.getClassName()||"Node"===x.getClassName()||x.skeleton||!x.getTotalVertices||0===x.getTotalVertices()?Z=!1:d.doNotInstantiate&&(Z="function"===typeof d.doNotInstantiate?!d.doNotInstantiate(x):!d.doNotInstantiate);const l=Z?x.createInstance(`instance of ${x.name}`):x.clone(`Clone of ${x.name}`,null,!0);if(!l)throw new Error(`Could not clone or instantiate node on Asset Container ${x.name}`);q(x,l)}for(const x of this.skeletons){if(d.predicate&&!d.predicate(x))continue;const l=x.clone(Z?Z(x.name):"Clone of "+x.name);for(const Z of this.meshes)if(Z.skeleton===x&&!Z.isAnInstance){const C=b[B[Z.uniqueId]];if(!C||C.isAnInstance)continue;if(C.skeleton=l,-1!==W.indexOf(l))continue;W.push(l);for(const Z of l.bones)Z._linkedTransformNode&&(Z._linkedTransformNode=b[B[Z._linkedTransformNode.uniqueId]])}f.skeletons.push(l)}for(const x of this.animationGroups){if(d.predicate&&!d.predicate(x))continue;const l=x.clone(Z?Z(x.name):"Clone of "+x.name,(Z=>b[B[Z.uniqueId]]||Z));f.animationGroups.push(l)}return f}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||x.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Yl.environmentTexture=this.environmentTexture);for(const Z of this.Yl._serializableComponents)Z.addFromContainer(this);this.Yl.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const l=[];for(const C of this.cameras)Z&&!Z(C)||(this.Yl.addCamera(C),l.push(C));for(const C of this.lights)Z&&!Z(C)||(this.Yl.addLight(C),l.push(C));for(const C of this.meshes)Z&&!Z(C)||(this.Yl.GE(C),l.push(C));for(const C of this.skeletons)Z&&!Z(C)||this.Yl.addSkeleton(C);for(const C of this.animations)Z&&!Z(C)||this.Yl.addAnimation(C);for(const C of this.animationGroups)Z&&!Z(C)||this.Yl.addAnimationGroup(C);for(const C of this.multiMaterials)Z&&!Z(C)||this.Yl.addMultiMaterial(C);for(const C of this.materials)Z&&!Z(C)||this.Yl.addMaterial(C);for(const C of this.morphTargetManagers)Z&&!Z(C)||this.Yl.addMorphTargetManager(C);for(const C of this.geometries)Z&&!Z(C)||this.Yl.addGeometry(C);for(const C of this.transformNodes)Z&&!Z(C)||(this.Yl.addTransformNode(C),l.push(C));for(const C of this.actionManagers)Z&&!Z(C)||this.Yl.addActionManager(C);for(const C of this.textures)Z&&!Z(C)||this.Yl.addTexture(C);for(const C of this.reflectionProbes)Z&&!Z(C)||this.Yl.addReflectionProbe(C);for(const C of l)C.parent&&-1===this.Yl.getNodes().indexOf(C.parent)&&(C.setParent?C.setParent(null):C.parent=null)}removeAllFromScene(){this._isValidHierarchy()||x.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Yl.environmentTexture&&(this.Yl.environmentTexture=null);for(const Z of this.Yl._serializableComponents)Z.removeFromContainer(this)}removeFromScene(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const l of this.cameras)Z&&!Z(l)||this.Yl.removeCamera(l);for(const l of this.lights)Z&&!Z(l)||this.Yl.removeLight(l);for(const l of this.meshes)Z&&!Z(l)||this.Yl.EE(l,!0);for(const l of this.skeletons)Z&&!Z(l)||this.Yl.removeSkeleton(l);for(const l of this.animations)Z&&!Z(l)||this.Yl.removeAnimation(l);for(const l of this.animationGroups)Z&&!Z(l)||this.Yl.removeAnimationGroup(l);for(const l of this.multiMaterials)Z&&!Z(l)||this.Yl.removeMultiMaterial(l);for(const l of this.materials)Z&&!Z(l)||this.Yl.removeMaterial(l);for(const l of this.morphTargetManagers)Z&&!Z(l)||this.Yl.removeMorphTargetManager(l);for(const l of this.geometries)Z&&!Z(l)||this.Yl.removeGeometry(l);for(const l of this.transformNodes)Z&&!Z(l)||this.Yl.removeTransformNode(l);for(const l of this.actionManagers)Z&&!Z(l)||this.Yl.removeActionManager(l);for(const l of this.textures)Z&&!Z(l)||this.Yl.removeTexture(l);for(const l of this.reflectionProbes)Z&&!Z(l)||this.Yl.removeReflectionProbe(l)}dispose(){const Z=this.cameras.slice(0);for(const a of Z)a.dispose();this.cameras.length=0;const l=this.lights.slice(0);for(const a of l)a.dispose();this.lights.length=0;const C=this.meshes.slice(0);for(const a of C)a.dispose();this.meshes.length=0;const B=this.skeletons.slice(0);for(const a of B)a.dispose();this.skeletons.length=0;const x=this.animationGroups.slice(0);for(const a of x)a.dispose();this.animationGroups.length=0;const b=this.multiMaterials.slice(0);for(const a of b)a.dispose();this.multiMaterials.length=0;const K=this.materials.slice(0);for(const a of K)a.dispose();this.materials.length=0;const f=this.geometries.slice(0);for(const a of f)a.dispose();this.geometries.length=0;const W=this.transformNodes.slice(0);for(const a of W)a.dispose();this.transformNodes.length=0;const J=this.actionManagers.slice(0);for(const a of J)a.dispose();this.actionManagers.length=0;const d=this.textures.slice(0);for(const a of d)a.dispose();this.textures.length=0;const E=this.reflectionProbes.slice(0);for(const a of E)a.dispose();this.reflectionProbes.length=0;const G=this.morphTargetManagers.slice(0);for(const a of G)a.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const a of this.Yl._serializableComponents)a.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Yl.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(Z,l,C){if(Z&&l)for(const B of Z){let Z=!0;if(C)for(const l of C)if(B===l){Z=!1;break}Z&&(l.push(B),B._parentContainer=this)}}moveAllFromScene(Z){this._wasAddedToScene=!1,void 0===Z&&(Z=new Y);for(const l in this)Object.prototype.hasOwnProperty.call(this,l)&&(this[l]=this[l]||("_environmentTexture"===l?null:[]),this._moveAssets(this.Yl[l],this[l],Z[l]));this.environmentTexture=this.Yl.environmentTexture,this.removeAllFromScene()}createRootMesh(){const Z=new K.b("assetContainerRootMesh",this.Yl);for(const l of this.meshes)l.parent||Z.addChild(l);return this.meshes.unshift(Z),Z}mergeAnimationsTo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.b.LastCreatedScene,l=arguments.length>1?arguments[1]:void 0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Z)return J.e.Error("No scene available to merge animations to"),[];const B=C||(l=>{let C=null;const B=l.animations.length?l.animations[0].targetProperty:"",x=l.name.split(".").join("").split("_primitive")[0];switch(B){case"position":case"rotationQuaternion":C=Z.getTransformNodeByName(l.name)||Z.getTransformNodeByName(x);break;case"influence":C=Z.getMorphTargetByName(l.name)||Z.getMorphTargetByName(x);break;default:C=Z.getNodeByName(l.name)||Z.getNodeByName(x)}return C}),x=this.getNodes();for(const f of x){const Z=B(f);if(null!==Z){for(const l of f.animations){const C=Z.animations.filter((Z=>Z.targetProperty===l.targetProperty));for(const l of C){const C=Z.animations.indexOf(l,0);C>-1&&Z.animations.splice(C,1)}}Z.animations=Z.animations.concat(f.animations)}}const b=[],K=this.animationGroups.slice();for(const f of K){b.push(f.clone(f.name,B));for(const Z of f.animatables)Z.stop()}for(const f of l){const l=B(f.target);l&&(Z.beginAnimation(l,f.fromFrame,f.toFrame,f.loopAnimation,f.speedRatio,f.onAnimationEnd?f.onAnimationEnd:void 0,void 0,!0,void 0,f.onAnimationLoop?f.onAnimationLoop:void 0),Z.stopAnimation(f.target))}return b}populateRootNodes(){this.rootNodes.length=0;for(const Z of this.meshes)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.transformNodes)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.lights)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.cameras)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z)}addAllAssetsToContainer(Z){if(!Z)return;const l=[],C=new Set;for(l.push(Z);l.length>0;){const Z=l.pop();if(Z instanceof K.b?(Z.nb&&-1===this.geometries.indexOf(Z.nb)&&this.geometries.push(Z.nb),this.meshes.push(Z)):Z instanceof E.e?this.meshes.push(Z):Z instanceof f.e?this.transformNodes.push(Z):Z instanceof G.d?this.lights.push(Z):Z instanceof a.d&&this.cameras.push(Z),Z instanceof W.e){if(Z.material&&-1===this.materials.indexOf(Z.material)){this.materials.push(Z.material);for(const l of Z.material.getActiveTextures())-1===this.textures.indexOf(l)&&this.textures.push(l)}Z.skeleton&&-1===this.skeletons.indexOf(Z.skeleton)&&this.skeletons.push(Z.skeleton),Z.morphTargetManager&&-1===this.morphTargetManagers.indexOf(Z.morphTargetManager)&&this.morphTargetManagers.push(Z.morphTargetManager)}for(const B of Z.getChildren())C.has(B)||l.push(B);C.add(Z)}this.populateRootNodes()}_getByTags(Z,l,C){if(void 0===l)return Z;const B=[];for(const x in Z){const b=Z[x];q.e&&q.e.MatchesQuery(b,l)&&(!C||C(b))&&B.push(b)}return B}getMeshesByTags(Z,l){return this._getByTags(this.meshes,Z,l)}getCamerasByTags(Z,l){return this._getByTags(this.cameras,Z,l)}getLightsByTags(Z,l){return this._getByTags(this.lights,Z,l)}getMaterialsByTags(Z,l){return this._getByTags(this.materials,Z,l).concat(this._getByTags(this.multiMaterials,Z,l))}getTransformNodesByTags(Z,l){return this._getByTags(this.transformNodes,Z,l)}}var i=C(12316);class s{constructor(Z){this.byteOffset=0,this.buffer=Z}async loadAsync(Z){const l=await this.buffer.readAsync(this.byteOffset,Z);this._dataView=new DataView(l.buffer,l.byteOffset,l.byteLength),this._dataByteOffset=0}readUint32(){const Z=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,Z}readUint8Array(Z){const l=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,Z);return this._dataByteOffset+=Z,this.byteOffset+=Z,l}readString(Z){return(0,i.g)(this.readUint8Array(Z))}skipBytes(Z){this._dataByteOffset+=Z,this.byteOffset+=Z}}var F=C(13772);const n="Z2xURg",c={name:"Eb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:Z=>-1!==Z.indexOf("asset")&&-1!==Z.indexOf("version")||Z.startsWith("data:base64,"+n)||Z.startsWith("data:;base64,"+n)||Z.startsWith("data:application/octet-stream;base64,"+n)||Z.startsWith("data:model/gltf-binary;base64,"+n)};var U,t,r,e=C(12298),o=C(12307);function v(Z,l,C){try{return Promise.resolve(new Uint8Array(Z,l,C))}catch(B){return Promise.reject(B)}}!function(Z){Z[Z.AUTO=0]="AUTO",Z[Z.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(U||(U={})),function(Z){Z[Z.NONE=0]="NONE",Z[Z.FIRST=1]="FIRST",Z[Z.ALL=2]="ALL"}(t||(t={})),function(Z){Z[Z.LOADING=0]="LOADING",Z[Z.READY=1]="READY",Z[Z.COMPLETE=2]="COMPLETE"}(r||(r={}));class R{constructor(){this.coordinateSystemMode=U.AUTO,this.animationStartMode=t.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=Z=>Promise.resolve(Z),this.extensionOptions={}}B(Z){Z&&(this.onParsed=Z.onParsed,this.coordinateSystemMode=Z.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=Z.animationStartMode??this.animationStartMode,this.loadNodeAnimations=Z.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=Z.loadSkins??this.loadSkins,this.loadMorphTargets=Z.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=Z.compileMaterials??this.compileMaterials,this.useClipPlane=Z.useClipPlane??this.useClipPlane,this.compileShadowGenerators=Z.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=Z.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=Z.useRangeRequests??this.useRangeRequests,this.createInstances=Z.createInstances??this.createInstances,this.alwaysComputeBoundingBox=Z.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=Z.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=Z.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=Z.skipMaterials??this.skipMaterials,this.useSRGBBuffers=Z.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=Z.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=Z.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=Z.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=Z.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=Z.customRootNode,this.onMeshLoaded=Z.onMeshLoaded,this.onSkinLoaded=Z.onSkinLoaded,this.onTextureLoaded=Z.onTextureLoaded,this.onMaterialLoaded=Z.onMaterialLoaded,this.onCameraLoaded=Z.onCameraLoaded,this.extensionOptions=Z.extensionOptions??this.extensionOptions)}}class k extends R{constructor(Z){super(),this.onParsedObservable=new B.b,this.onMeshLoadedObservable=new B.b,this.onSkinLoadedObservable=new B.b,this.onTextureLoadedObservable=new B.b,this.onMaterialLoadedObservable=new B.b,this.onCameraLoadedObservable=new B.b,this.onCompleteObservable=new B.b,this.onErrorObservable=new B.b,this.xb=new B.b,this.onExtensionLoadedObservable=new B.b,this.validate=!1,this.onValidatedObservable=new B.b,this._loader=null,this._state=null,this._requests=new Array,this.name=c.name,this.extensions=c.extensions,this.onLoaderStateChangedObservable=new B.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.B(Z)}set onParsed(Z){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),Z&&(this._onParsedObserver=this.onParsedObservable.add(Z))}set onMeshLoaded(Z){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),Z&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(Z))}set onSkinLoaded(Z){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),Z&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((l=>Z(l.node,l.skinnedNode))))}set onTextureLoaded(Z){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),Z&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(Z))}set onMaterialLoaded(Z){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),Z&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(Z))}set onCameraLoaded(Z){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),Z&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(Z))}set onComplete(Z){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(Z)}set onError(Z){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(Z)}set onDispose(Z){this._onDisposeObserver&&this.xb.remove(this._onDisposeObserver),this._onDisposeObserver=this.xb.add(Z)}set onExtensionLoaded(Z){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(Z)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(Z){this._loggingEnabled!==Z&&(this._loggingEnabled=Z,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(Z){this._capturePerformanceCounters!==Z&&(this._capturePerformanceCounters=Z,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(Z){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(Z)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const Z of this._requests)Z.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=Z=>Promise.resolve(Z),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.xb.notifyObservers(void 0),this.xb.clear()}loadFile(Z,l,C,b,K,f,W,d){if(ArrayBuffer.isView(l))return this._loadBinary(Z,l,C,b,W,d),null;this._progressCallback=K;const E=l.name||x.Tools.GetFilename(l);if(f){if(this.useRangeRequests){this.validate&&J.e.Warn("glTF validation is not supported when range requests are enabled");const C={abort:()=>{},onCompleteObservable:new B.b},x={readAsync:(C,B)=>new Promise(((x,b)=>{this._loadFile(Z,l,(Z=>{x(new Uint8Array(Z))}),!0,(Z=>{b(Z)}),(Z=>{Z.setRequestHeader("Range",`bytes=${C}-${C+B-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new s(x)).then((Z=>{C.onCompleteObservable.notifyObservers(C),b(Z)}),W?Z=>W(void 0,Z):void 0),C}return this._loadFile(Z,l,(l=>{this._validate(Z,new Uint8Array(l,0,l.byteLength),C,E),this._unpackBinaryAsync(new s({readAsync:(Z,C)=>v(l,Z,C),byteLength:l.byteLength})).then((Z=>{b(Z)}),W?Z=>W(void 0,Z):void 0)}),!0,W)}return this._loadFile(Z,l,(l=>{try{this._validate(Z,l,C,E),b({json:this._parseJson(l)})}catch{W&&W()}}),!1,W)}_loadBinary(Z,l,C,B,x,b){this._validate(Z,new Uint8Array(l.buffer,l.byteOffset,l.byteLength),C,b),this._unpackBinaryAsync(new s({readAsync:(Z,C)=>function(Z,l,C){try{if(l<0||l>=Z.byteLength)throw new RangeError("Offset is out of range.");if(l+C>Z.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(Z.buffer,Z.byteOffset+l,C))}catch(B){return Promise.reject(B)}}(l,Z,C),byteLength:l.byteLength})).then((Z=>{B(Z)}),x?Z=>x(void 0,Z):void 0)}importMeshAsync(Z,l,C,B,x,b){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(C),this.onParsedObservable.clear(),this._log(`Loading ${b||""}`),this._loader=this._getLoader(C),this._loader.importMeshAsync(Z,l,null,C,B,x,b))))}loadAsync(Z,l,C,B,x){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(l),this.onParsedObservable.clear(),this._log(`Loading ${x||""}`),this._loader=this._getLoader(l),this._loader.loadAsync(Z,l,C,B,x))))}loadAssetContainerAsync(Z,l,C,B,x){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(l),this.onParsedObservable.clear(),this._log(`Loading ${x||""}`),this._loader=this._getLoader(l);const b=new S(Z),K=[];this.onMaterialLoadedObservable.add((Z=>{K.push(Z)}));const f=[];this.onTextureLoadedObservable.add((Z=>{f.push(Z)}));const W=[];this.onCameraLoadedObservable.add((Z=>{W.push(Z)}));const J=[];return this.onMeshLoadedObservable.add((Z=>{Z.morphTargetManager&&J.push(Z.morphTargetManager)})),this._loader.importMeshAsync(null,Z,b,l,C,B,x).then((Z=>(Array.prototype.push.apply(b.geometries,Z.geometries),Array.prototype.push.apply(b.meshes,Z.meshes),Array.prototype.push.apply(b.Ka,Z.Ka),Array.prototype.push.apply(b.skeletons,Z.skeletons),Array.prototype.push.apply(b.animationGroups,Z.animationGroups),Array.prototype.push.apply(b.materials,K),Array.prototype.push.apply(b.textures,f),Array.prototype.push.apply(b.lights,Z.lights),Array.prototype.push.apply(b.transformNodes,Z.transformNodes),Array.prototype.push.apply(b.cameras,W),Array.prototype.push.apply(b.morphTargetManagers,J),b)))}))}canDirectLoad(Z){return c.canDirectLoad(Z)}directLoad(Z,l){if(l.startsWith("base64,"+n)||l.startsWith(";base64,"+n)||l.startsWith("application/octet-stream;base64,"+n)||l.startsWith("model/gltf-binary;base64,"+n)){const C=(0,e.b)(l);return this._validate(Z,new Uint8Array(C,0,C.byteLength)),this._unpackBinaryAsync(new s({readAsync:(Z,l)=>v(C,Z,l),byteLength:C.byteLength}))}return this._validate(Z,l),Promise.resolve({json:this._parseJson(l)})}createPlugin(Z){return new k(Z[c.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((Z,l)=>{this.onCompleteObservable.addOnce((()=>{Z()})),this.onErrorObservable.addOnce((Z=>{l(Z)}))}))}_setState(Z){this._state!==Z&&(this._state=Z,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(r[this._state]))}_loadFile(Z,l,C,B,x,b){const K=Z._loadFile(l,C,(Z=>{this._onProgress(Z,K)}),!0,B,x,b);return K.onCompleteObservable.add((()=>{K._lengthComputable=!0,K._total=K._loaded})),this._requests.push(K),K}_onProgress(Z,l){if(!this._progressCallback)return;l._lengthComputable=Z.lengthComputable,l._loaded=Z.loaded,l._total=Z.total;let C=!0,B=0,x=0;for(const b of this._requests){if(void 0===b._lengthComputable||void 0===b._loaded||void 0===b._total)return;C=C&&b._lengthComputable,B+=b._loaded,x+=b._total}this._progressCallback({lengthComputable:C,loaded:B,total:C?x:0})}_validate(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),F.d.ValidateAsync(l,C,B,(l=>this.preprocessUrlAsync(C+l).then((l=>Z._loadFileAsync(l,void 0,!0,!0).then((Z=>new Uint8Array(Z,0,Z.byteLength))))))).then((Z=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(Z),this.onValidatedObservable.clear()}),(Z=>{this._endPerformanceCounter("Validate JSON"),x.Tools.Warn(`Failed to validate: ${Z.message}`),this.onValidatedObservable.clear()})))}_getLoader(Z){const l=Z.json.asset||{};this._log(`Asset version: ${l.version}`),l.minVersion&&this._log(`Asset minimum version: ${l.minVersion}`),l.generator&&this._log(`Asset generator: ${l.generator}`);const C=k._parseVersion(l.version);if(!C)throw new Error("Invalid version: "+l.version);if(void 0!==l.minVersion){const Z=k._parseVersion(l.minVersion);if(!Z)throw new Error("Invalid minimum version: "+l.minVersion);if(k._compareVersion(Z,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+l.minVersion)}const B={1:k._CreateGLTF1Loader,2:k._CreateGLTF2Loader}[C.major];if(!B)throw new Error("Unsupported version: "+l.version);return B(this)}_parseJson(Z){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${Z.length}`);const l=JSON.parse(Z);return this._endPerformanceCounter("Parse JSON"),l}_unpackBinaryAsync(Z){return this._startPerformanceCounter("Unpack Binary"),Z.loadAsync(20).then((()=>{const l=Z.readUint32();if(1179937895!==l)throw new o.g("Unexpected magic: "+l,o.f.GLTFLoaderUnexpectedMagicError);const C=Z.readUint32();this.loggingEnabled&&this._log(`Binary version: ${C}`);const B=Z.readUint32();let x;switch(this.useRangeRequests||B===Z.buffer.byteLength||J.e.Warn(`Length in header does not match actual data length: ${B} != ${Z.buffer.byteLength}`),C){case 1:x=this._unpackBinaryV1Async(Z,B);break;case 2:x=this._unpackBinaryV2Async(Z,B);break;default:throw new Error("Unsupported version: "+C)}return this._endPerformanceCounter("Unpack Binary"),x}))}_unpackBinaryV1Async(Z,l){const C=Z.readUint32(),B=Z.readUint32();if(0!==B)throw new Error(`Unexpected content format: ${B}`);const x=l-Z.byteOffset,b={json:this._parseJson(Z.readString(C)),bin:null};if(0!==x){const l=Z.byteOffset;b.bin={readAsync:(C,B)=>Z.buffer.readAsync(l+C,B),byteLength:x}}return Promise.resolve(b)}_unpackBinaryV2Async(Z,l){const C=1313821514,B=5130562,x=Z.readUint32();if(Z.readUint32()!==C)throw new Error("First chunk format is not JSON");return Z.byteOffset+x===l?Z.loadAsync(x).then((()=>({json:this._parseJson(Z.readString(x)),bin:null}))):Z.loadAsync(x+8).then((()=>{const b={json:this._parseJson(Z.readString(x)),bin:null},K=()=>{const x=Z.readUint32();switch(Z.readUint32()){case C:throw new Error("Unexpected JSON chunk");case B:{const l=Z.byteOffset;b.bin={readAsync:(C,B)=>Z.buffer.readAsync(l+C,B),byteLength:x},Z.skipBytes(x);break}default:Z.skipBytes(x)}return Z.byteOffset!==l?Z.loadAsync(8).then(K):Promise.resolve(b)};return K()}))}static _parseVersion(Z){if("1.0"===Z||"1.0.1"===Z)return{major:1,minor:0};const l=(Z+"").match(/^(\d+)\.(\d+)/);return l?{major:parseInt(l[1]),minor:parseInt(l[2])}:null}static _compareVersion(Z,l){return Z.major>l.major?1:Z.major<l.major?-1:Z.minor>l.minor?1:Z.minor<l.minor?-1:0}_logOpen(Z){this._log(Z),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(Z){const l=k._logSpaces.substring(0,2*this._logIndentLevel);J.e.Log(`${l}${Z}`)}_logDisabled(Z){}_startPerformanceCounterEnabled(Z){x.Tools.StartPerformanceCounter(Z)}_startPerformanceCounterDisabled(Z){}_endPerformanceCounterEnabled(Z){x.Tools.EndPerformanceCounter(Z)}_endPerformanceCounterDisabled(Z){}}k.IncrementalLoading=!0,k.HomogeneousCoordinates=!1,k._logSpaces="                                ",(0,b.d)(new k)},13772:(Z,l,C)=>{"use strict";C.d(l,{d:()=>K});var B=C(12248);function x(Z,l,C,B){const x={externalResourceFunction:B};return C&&(x.uri="file:"===l?C:l+C),ArrayBuffer.isView(Z)?GLTFValidator.validateBytes(Z,x):GLTFValidator.validateString(Z,x)}function b(){const Z=[];onmessage=l=>{const C=l.data;switch(C.id){case"init":importScripts(C.url);break;case"validate":x(C.data,C.rootUrl,C.fileName,(l=>new Promise(((C,B)=>{const x=Z.length;Z.push({resolve:C,reject:B}),postMessage({id:"getExternalResource",index:x,uri:l})})))).then((Z=>{postMessage({id:"validate.resolve",value:Z})}),(Z=>{postMessage({id:"validate.reject",reason:Z})}));break;case"getExternalResource.resolve":Z[C.index].resolve(C.value);break;case"getExternalResource.reject":Z[C.index].reject(C.reason)}}}class K{static ValidateAsync(Z,l,C,K){return"function"===typeof Worker?new Promise(((f,W)=>{const J=`${x}(${b})()`,d=URL.createObjectURL(new Blob([J],{type:"application/javascript"})),E=new Worker(d),G=Z=>{E.removeEventListener("error",G),E.removeEventListener("message",a),W(Z)},a=Z=>{const l=Z.data;switch(l.id){case"getExternalResource":K(l.uri).then((Z=>{E.postMessage({id:"getExternalResource.resolve",index:l.index,value:Z},[Z.buffer])}),(Z=>{E.postMessage({id:"getExternalResource.reject",index:l.index,reason:Z})}));break;case"validate.resolve":E.removeEventListener("error",G),E.removeEventListener("message",a),f(l.value),E.terminate();break;case"validate.reject":E.removeEventListener("error",G),E.removeEventListener("message",a),W(l.reason),E.terminate()}};if(E.addEventListener("error",G),E.addEventListener("message",a),E.postMessage({id:"init",url:B.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(Z)){const B=Z.slice();E.postMessage({id:"validate",data:B,rootUrl:l,fileName:C},[B.buffer])}else E.postMessage({id:"validate",data:Z,rootUrl:l,fileName:C})})):(this._LoadScriptPromise||(this._LoadScriptPromise=B.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>x(Z,l,C,K))))}}K.Configuration={url:`${B.Tools._DefaultCdnUrl}/gltf_validator.js`}},14288:(Z,l,C)=>{"use strict";C.d(l,{d:()=>c});var B=C(12428),x=C(12432),b=C(12478),K=C(12442),f=C(12820),W=C(12760),J=C(12530),d=C(12704),E=C(12400),G=C(12356);C(13528),C(13436),C(13447),C(13441),C(13455),C(13461),C(13465);const a="imageProcessingCompatibility",q="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";G.b.IncludesShadersStore[a]||(G.b.IncludesShadersStore[a]=q);const z="skyPixelShader",Y="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";G.b.ShadersStore[z]||(G.b.ShadersStore[z]=Y);C(13537),C(13468),C(13475),C(13486),C(13478);const P="skyVertexShader",S="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";G.b.ShadersStore[P]||(G.b.ShadersStore[P]=S);var i=C(12758),s=C(12804),F=C(12800);class n extends f.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class c extends W.e{constructor(Z,l){super(Z,l),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new K.ql(0,100,0),this.useSunPosition=!1,this.cameraOffset=K.ql.Zero(),this.up=K.ql.Up(),this.dithering=!1,this._cameraPosition=K.ql.Zero(),this._skyOrientation=new K.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(Z,l){const C=l._drawWrapper;if(this.isFrozen&&C.effect&&C._wasPreviouslyReady)return!0;l.materialDefines||(l.materialDefines=new n);const B=l.materialDefines,x=this.cZ();if(this._isReadyForSubMesh(l))return!0;if((0,F.Y)(Z,x,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,B),(0,F.O)(Z,B,!0,!1),B.IMAGEPROCESSINGPOSTPROCESS!==x.imageProcessingConfiguration.applyByPostProcess&&B.markAsMiscDirty(),B.DITHER!==this.dithering&&B.markAsMiscDirty(),B.isDirty){B.markAsProcessed(),x.resetCachedMaterial();const Z=new i.d;B.FOG&&Z.addFallback(1,"FOG"),B.IMAGEPROCESSINGPOSTPROCESS=x.imageProcessingConfiguration.applyByPostProcess,B.DITHER=this.dithering;const C=[J.h.PositionKind];B.VERTEXCOLOR&&C.push(J.h.ColorKind);const b="sky",K=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,s.b)(K);const f=B.toString();l.setEffect(x.getEngine().createEffect(b,C,K,[],f,Z,this.onCompiled,this.onError),B,this._materialContext)}return!(!l.effect||!l.effect.isReady())&&(B._renderId=x.getRenderId(),C._wasPreviouslyReady=!0,!0)}bindForSubMesh(Z,l,C){const B=this.cZ(),x=C.materialDefines;if(!x)return;const b=C.effect;if(!b)return;this._activeEffect=b,this.bindOnlyWorldMatrix(Z),this._activeEffect.setMatrix("viewProjection",B.getTransformMatrix()),this._mustRebind(B,b,C)&&((0,s.d)(b,this,B),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,F.j)(x,b,B)),B.fogEnabled&&l.applyFog&&B.fogMode!==d.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",B.getViewMatrix()),(0,F.f)(B,l,this._activeEffect);const f=B.activeCamera;if(f){const Z=f.getWorldMatrix();this._cameraPosition.x=Z.m[12],this._cameraPosition.y=Z.m[13],this._cameraPosition.z=Z.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const Z=Math.PI*(this.inclination-.5),l=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(l)*Math.cos(Z),this.sunPosition.y=this.distance*Math.sin(-Z),this.sunPosition.z=this.distance*Math.sin(l)*Math.cos(Z),K.Quaternion.FromUnitVectorsToRef(K.ql.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(l,this._activeEffect,C)}getAnimatables(){return[]}dispose(Z){super.dispose(Z)}clone(Z){return b.b.Clone((()=>new c(Z,this.cZ())),this)}serialize(){const Z=super.serialize();return Z.customType="BABYLON.SkyMaterial",Z}getClassName(){return"SkyMaterial"}static Parse(Z,l,C){return b.b.Parse((()=>new c(Z.name,l)),Z,l,C)}}(0,B.b)([(0,x.R)()],c.prototype,"luminance",void 0),(0,B.b)([(0,x.R)()],c.prototype,"turbidity",void 0),(0,B.b)([(0,x.R)()],c.prototype,"rayleigh",void 0),(0,B.b)([(0,x.R)()],c.prototype,"mieCoefficient",void 0),(0,B.b)([(0,x.R)()],c.prototype,"mieDirectionalG",void 0),(0,B.b)([(0,x.R)()],c.prototype,"distance",void 0),(0,B.b)([(0,x.R)()],c.prototype,"inclination",void 0),(0,B.b)([(0,x.R)()],c.prototype,"azimuth",void 0),(0,B.b)([(0,x.Q)()],c.prototype,"sunPosition",void 0),(0,B.b)([(0,x.R)()],c.prototype,"useSunPosition",void 0),(0,B.b)([(0,x.Q)()],c.prototype,"cameraOffset",void 0),(0,B.b)([(0,x.Q)()],c.prototype,"up",void 0),(0,B.b)([(0,x.R)()],c.prototype,"dithering",void 0),(0,E.c)("BABYLON.SkyMaterial",c)},13100:(Z,l,C)=>{"use strict";function B(Z,l){l.headers=Z.headers||{},l.statusMessage=Z.statusText,l.statusCode=Z.status,l.data=Z.response}function x(Z,l,C){return new Promise((function(x,b){C=C||{};var K,f,W,J=new XMLHttpRequest,d=C.body,E=C.headers||{};for(K in C.timeout&&(J.timeout=C.timeout),J.ontimeout=J.onerror=function(Z){Z.timeout="timeout"==Z.type,b(Z)},J.open(Z,l.href||l),J.onload=function(){for(W=J.getAllResponseHeaders().trim().split(/[\r\n]+/),B(J,J);f=W.shift();)f=f.split(": "),J.headers[f.shift().toLowerCase()]=f.join(": ");if((f=J.headers["content-type"])&&~f.indexOf("application/json"))try{J.data=JSON.parse(J.data,C.reviver)}catch(Z){return B(J,Z),b(Z)}(J.status>=400?b:x)(J)},typeof FormData<"u"&&d instanceof FormData||d&&"object"==typeof d&&(E["content-type"]="application/json",d=JSON.stringify(d)),J.withCredentials=!!C.withCredentials,E)J.setRequestHeader(K,E[K]);J.send(d)}))}C.r(l),C.d(l,{del:()=>W,get:()=>b,patch:()=>f,post:()=>K,put:()=>J,send:()=>x});var b=x.bind(x,"GET"),K=x.bind(x,"POST"),f=x.bind(x,"PATCH"),W=x.bind(x,"DELETE"),J=x.bind(x,"PUT")},14409:(Z,l,C)=>{"use strict";C.d(l,{b:()=>E});const B=.5*(Math.sqrt(3)-1),x=(3-Math.sqrt(3))/6,b=1/3,K=1/6,f=(Math.sqrt(5)-1)/4,W=(5-Math.sqrt(5))/20,J=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),d=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const E=class{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const l="function"==typeof Z?Z:function(Z){let l=0,C=0,B=0,x=1;const b=function(){let Z=4022871197;return function(l){l=l.toString();for(let C=0;C<l.length;C++){Z+=l.charCodeAt(C);let B=.02519603282416938*Z;Z=B>>>0,B-=Z,B*=Z,Z=B>>>0,B-=Z,Z+=4294967296*B}return 2.3283064365386963e-10*(Z>>>0)}}();l=b(" "),C=b(" "),B=b(" "),l-=b(Z),l<0&&(l+=1);C-=b(Z),C<0&&(C+=1);B-=b(Z),B<0&&(B+=1);return function(){const Z=2091639*l+2.3283064365386963e-10*x;return l=C,C=B,B=Z-(x=0|Z)}}(Z);this.p=function(Z){const l=new Uint8Array(256);for(let C=0;C<256;C++)l[C]=C;for(let C=0;C<255;C++){const B=C+~~(Z()*(256-C)),x=l[C];l[C]=l[B],l[B]=x}return l}(l),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let C=0;C<512;C++)this.perm[C]=this.p[255&C],this.permMod12[C]=this.perm[C]%12}noise2D(Z,l){const C=this.permMod12,b=this.perm;let K=0,f=0,W=0;const d=(Z+l)*B,E=Math.floor(Z+d),G=Math.floor(l+d),a=(E+G)*x,q=Z-(E-a),z=l-(G-a);let Y,P;q>z?(Y=1,P=0):(Y=0,P=1);const S=q-Y+x,i=z-P+x,s=q-1+2*x,F=z-1+2*x,n=255&E,c=255&G;let U=.5-q*q-z*z;if(U>=0){const Z=3*C[n+b[c]];U*=U,K=U*U*(J[Z]*q+J[Z+1]*z)}let t=.5-S*S-i*i;if(t>=0){const Z=3*C[n+Y+b[c+P]];t*=t,f=t*t*(J[Z]*S+J[Z+1]*i)}let r=.5-s*s-F*F;if(r>=0){const Z=3*C[n+1+b[c+1]];r*=r,W=r*r*(J[Z]*s+J[Z+1]*F)}return 70*(K+f+W)}noise3D(Z,l,C){const B=this.permMod12,x=this.perm;let f,W,d,E;const G=(Z+l+C)*b,a=Math.floor(Z+G),q=Math.floor(l+G),z=Math.floor(C+G),Y=(a+q+z)*K,P=Z-(a-Y),S=l-(q-Y),i=C-(z-Y);let s,F,n,c,U,t;P>=S?S>=i?(s=1,F=0,n=0,c=1,U=1,t=0):P>=i?(s=1,F=0,n=0,c=1,U=0,t=1):(s=0,F=0,n=1,c=1,U=0,t=1):S<i?(s=0,F=0,n=1,c=0,U=1,t=1):P<i?(s=0,F=1,n=0,c=0,U=1,t=1):(s=0,F=1,n=0,c=1,U=1,t=0);const r=P-s+K,e=S-F+K,o=i-n+K,v=P-c+2*K,R=S-U+2*K,k=i-t+2*K,V=P-1+.5,g=S-1+.5,j=i-1+.5,M=255&a,I=255&q,w=255&z;let O=.6-P*P-S*S-i*i;if(O<0)f=0;else{const Z=3*B[M+x[I+x[w]]];O*=O,f=O*O*(J[Z]*P+J[Z+1]*S+J[Z+2]*i)}let D=.6-r*r-e*e-o*o;if(D<0)W=0;else{const Z=3*B[M+s+x[I+F+x[w+n]]];D*=D,W=D*D*(J[Z]*r+J[Z+1]*e+J[Z+2]*o)}let y=.6-v*v-R*R-k*k;if(y<0)d=0;else{const Z=3*B[M+c+x[I+U+x[w+t]]];y*=y,d=y*y*(J[Z]*v+J[Z+1]*R+J[Z+2]*k)}let X=.6-V*V-g*g-j*j;if(X<0)E=0;else{const Z=3*B[M+1+x[I+1+x[w+1]]];X*=X,E=X*X*(J[Z]*V+J[Z+1]*g+J[Z+2]*j)}return 32*(f+W+d+E)}noise4D(Z,l,C,B){const x=this.perm;let b,K,J,E,G;const a=(Z+l+C+B)*f,q=Math.floor(Z+a),z=Math.floor(l+a),Y=Math.floor(C+a),P=Math.floor(B+a),S=(q+z+Y+P)*W,i=Z-(q-S),s=l-(z-S),F=C-(Y-S),n=B-(P-S);let c=0,U=0,t=0,r=0;i>s?c++:U++,i>F?c++:t++,i>n?c++:r++,s>F?U++:t++,s>n?U++:r++,F>n?t++:r++;const e=c>=3?1:0,o=U>=3?1:0,v=t>=3?1:0,R=r>=3?1:0,k=c>=2?1:0,V=U>=2?1:0,g=t>=2?1:0,j=r>=2?1:0,M=c>=1?1:0,I=U>=1?1:0,w=t>=1?1:0,O=r>=1?1:0,D=i-e+W,y=s-o+W,X=F-v+W,T=n-R+W,u=i-k+2*W,H=s-V+2*W,Q=F-g+2*W,h=n-j+2*W,A=i-M+3*W,L=s-I+3*W,p=F-w+3*W,N=n-O+3*W,mZ=i-1+4*W,ZZ=s-1+4*W,lZ=F-1+4*W,CZ=n-1+4*W,BZ=255&q,xZ=255&z,bZ=255&Y,KZ=255&P;let fZ=.6-i*i-s*s-F*F-n*n;if(fZ<0)b=0;else{const Z=x[BZ+x[xZ+x[bZ+x[KZ]]]]%32*4;fZ*=fZ,b=fZ*fZ*(d[Z]*i+d[Z+1]*s+d[Z+2]*F+d[Z+3]*n)}let WZ=.6-D*D-y*y-X*X-T*T;if(WZ<0)K=0;else{const Z=x[BZ+e+x[xZ+o+x[bZ+v+x[KZ+R]]]]%32*4;WZ*=WZ,K=WZ*WZ*(d[Z]*D+d[Z+1]*y+d[Z+2]*X+d[Z+3]*T)}let JZ=.6-u*u-H*H-Q*Q-h*h;if(JZ<0)J=0;else{const Z=x[BZ+k+x[xZ+V+x[bZ+g+x[KZ+j]]]]%32*4;JZ*=JZ,J=JZ*JZ*(d[Z]*u+d[Z+1]*H+d[Z+2]*Q+d[Z+3]*h)}let dZ=.6-A*A-L*L-p*p-N*N;if(dZ<0)E=0;else{const Z=x[BZ+M+x[xZ+I+x[bZ+w+x[KZ+O]]]]%32*4;dZ*=dZ,E=dZ*dZ*(d[Z]*A+d[Z+1]*L+d[Z+2]*p+d[Z+3]*N)}let EZ=.6-mZ*mZ-ZZ*ZZ-lZ*lZ-CZ*CZ;if(EZ<0)G=0;else{const Z=x[BZ+1+x[xZ+1+x[bZ+1+x[KZ+1]]]]%32*4;EZ*=EZ,G=EZ*EZ*(d[Z]*mZ+d[Z+1]*ZZ+d[Z+2]*lZ+d[Z+3]*CZ)}return 27*(b+K+J+E+G)}}}}]);