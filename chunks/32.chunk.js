/*! For license information please see iizldo.32.707a61bc.chunk.js.LICENSE.txt */
(self.ra6kpa9z1sg=self.ra6kpa9z1sg||[]).push([[32],{14609:(p,b,M)=>{"use strict";var h=M(14618),Q=M(14625),mp=M(14629);M.g.__TYPEDARRAY_POOL||(M.g.__TYPEDARRAY_POOL={UINT8:Q([32,0]),UINT16:Q([32,0]),UINT32:Q([32,0]),INT8:Q([32,0]),INT16:Q([32,0]),INT32:Q([32,0]),FLOAT:Q([32,0]),DOUBLE:Q([32,0]),DATA:Q([32,0]),UINT8C:Q([32,0]),BUFFER:Q([32,0])});var y="undefined"!==typeof Uint8ClampedArray,P=M.g.__TYPEDARRAY_POOL;P.UINT8C||(P.UINT8C=Q([32,0])),P.BUFFER||(P.BUFFER=Q([32,0]));var w=P.DATA,t=P.BUFFER;function z(p){if(p){var b=p.length||p.byteLength,M=h.log2(b);w[M].push(p)}}function x(p){p=h.nextPow2(p);var b=h.log2(p),M=w[b];return M.length>0?M.pop():new ArrayBuffer(p)}function S(p){return new Uint8Array(x(p),0,p)}function X(p){return new Uint16Array(x(2*p),0,p)}function c(p){return new Uint32Array(x(4*p),0,p)}function J(p){return new Int8Array(x(p),0,p)}function g(p){return new Int16Array(x(2*p),0,p)}function f(p){return new Int32Array(x(4*p),0,p)}function Y(p){return new Float32Array(x(4*p),0,p)}function a(p){return new Float64Array(x(8*p),0,p)}function o(p){return y?new Uint8ClampedArray(x(p),0,p):S(p)}function l(p){return new DataView(x(p),0,p)}b.free=function(p){if(mp(p))t[h.log2(p.length)].push(p);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(p)&&(p=p.buffer),!p)return;var b=p.length||p.byteLength,M=0|h.log2(b);w[M].push(p)}},b.freeUint8=b.freeUint16=b.freeUint32=b.freeInt8=b.freeInt16=b.freeInt32=b.freeFloat32=b.freeFloat=b.freeFloat64=b.freeDouble=b.freeUint8Clamped=b.freeDataView=function(p){z(p.buffer)},b.freeArrayBuffer=z,b.freeBuffer=function(p){t[h.log2(p.length)].push(p)},b.malloc=function(p,b){if(void 0===b||"arraybuffer"===b)return x(p);switch(b){case"uint8":return S(p);case"uint16":return X(p);case"uint32":return c(p);case"int8":return J(p);case"int16":return g(p);case"int32":return f(p);case"float":case"float32":return Y(p);case"double":case"float64":return a(p);case"uint8_clamped":return o(p);case"buffer":throw"Buffer not supported";case"data":case"dataview":return l(p);default:return null}return null},b.mallocArrayBuffer=x,b.mallocUint8=S,b.mallocUint16=X,b.mallocUint32=c,b.mallocInt8=J,b.mallocInt16=g,b.mallocInt32=f,b.mallocFloat32=b.mallocFloat=Y,b.mallocFloat64=b.mallocDouble=a,b.mallocUint8Clamped=o,b.mallocDataView=l,b.clearCache=function(){for(var p=0;p<32;++p)P.UINT8[p].length=0,P.UINT16[p].length=0,P.UINT32[p].length=0,P.INT8[p].length=0,P.INT16[p].length=0,P.INT32[p].length=0,P.FLOAT[p].length=0,P.DOUBLE[p].length=0,P.UINT8C[p].length=0,w[p].length=0,t[p].length=0}},14714:(p,b,M)=>{p.exports=Q;var h=M(13573);function Q(p,b){if(!(this instanceof Q))return new Q(p,b);var M=h.create();h.add(M,p,b),this.base=h.min(h.create(),p,M),this.Jx=h.clone(b),this.max=h.max(h.create(),p,M),this.mag=h.length(this.Jx)}var mp=Q.prototype;mp.width=function(){return this.Jx[0]},mp.height=function(){return this.Jx[1]},mp.depth=function(){return this.Jx[2]},mp.x0=function(){return this.base[0]},mp.y0=function(){return this.base[1]},mp.z0=function(){return this.base[2]},mp.x1=function(){return this.max[0]},mp.y1=function(){return this.max[1]},mp.z1=function(){return this.max[2]},mp.translate=function(p){return h.add(this.max,this.max,p),h.add(this.base,this.base,p),this},mp.setPosition=function(p){return h.add(this.max,p,this.Jx),h.k(this.base,p),this},mp.expand=function(p){var b=h.create(),M=h.create();return h.max(b,p.max,this.max),h.min(M,p.base,this.base),h.mh(b,b,M),new Q(M,b)},mp.intersects=function(p){return!(p.base[0]>this.max[0])&&(!(p.base[1]>this.max[1])&&(!(p.base[2]>this.max[2])&&(!(p.max[0]<this.base[0])&&(!(p.max[1]<this.base[1])&&!(p.max[2]<this.base[2])))))},mp.touches=function(p){var b=this.union(p);return null!==b&&(0==b.width()||0==b.height()||0==b.depth())},mp.union=function(p){if(!this.intersects(p))return null;var b=Math.max(p.base[0],this.base[0]),M=Math.max(p.base[1],this.base[1]),h=Math.max(p.base[2],this.base[2]);return new Q([b,M,h],[Math.min(p.max[0],this.max[0])-b,Math.min(p.max[1],this.max[1])-M,Math.min(p.max[2],this.max[2])-h])}},14618:(p,b)=>{"use strict";function M(p){var b=32;return(p&=-p)&&b--,65535&p&&(b-=16),16711935&p&&(b-=8),252645135&p&&(b-=4),858993459&p&&(b-=2),1431655765&p&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(p){return(p>0)-(p<0)},b.abs=function(p){var b=p>>31;return(p^b)-b},b.min=function(p,b){return b^(p^b)&-(p<b)},b.max=function(p,b){return p^(p^b)&-(p<b)},b.isPow2=function(p){return!(p&p-1)&&!!p},b.log2=function(p){var b,M;return b=(p>65535)<<4,b|=M=((p>>>=b)>255)<<3,b|=M=((p>>>=M)>15)<<2,(b|=M=((p>>>=M)>3)<<1)|(p>>>=M)>>1},b.log10=function(p){return p>=1e9?9:p>=1e8?8:p>=1e7?7:p>=1e6?6:p>=1e5?5:p>=1e4?4:p>=1e3?3:p>=100?2:p>=10?1:0},b.popCount=function(p){return 16843009*((p=(858993459&(p-=p>>>1&1431655765))+(p>>>2&858993459))+(p>>>4)&252645135)>>>24},b.countTrailingZeros=M,b.nextPow2=function(p){return p+=0===p,--p,p|=p>>>1,p|=p>>>2,p|=p>>>4,p|=p>>>8,(p|=p>>>16)+1},b.prevPow2=function(p){return p|=p>>>1,p|=p>>>2,p|=p>>>4,p|=p>>>8,(p|=p>>>16)-(p>>>1)},b.parity=function(p){return p^=p>>>16,p^=p>>>8,p^=p>>>4,27030>>>(p&=15)&1};var h=new Array(256);!function(p){for(var b=0;b<256;++b){var M=b,h=b,Q=7;for(M>>>=1;M;M>>>=1)h<<=1,h|=1&M,--Q;p[b]=h<<Q&255}}(h),b.reverse=function(p){return h[255&p]<<24|h[p>>>8&255]<<16|h[p>>>16&255]<<8|h[p>>>24&255]},b.interleave2=function(p,b){return(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p&=65535)|p<<8))|p<<4))|p<<2))|p<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(p,b){return(p=65535&((p=16711935&((p=252645135&((p=858993459&((p=p>>>b&1431655765)|p>>>1))|p>>>2))|p>>>4))|p>>>16))<<16>>16},b.interleave3=function(p,b,M){return p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2),(p|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2))<<2},b.deinterleave3=function(p,b){return(p=1023&((p=4278190335&((p=251719695&((p=3272356035&((p=p>>>b&1227133513)|p>>>2))|p>>>4))|p>>>8))|p>>>16))<<22>>22},b.nextCombination=function(p){var b=p|p-1;return b+1|(~b&-~b)-1>>>M(p)+1}},14602:(p,b,M)=>{"use strict";p.exports=function(p,b,M){switch(arguments.length){case 1:return h=[],t(Q=p,Q,z,!0),h;case 2:return"function"===typeof b?t(p,p,b,!0):function(p,b){return h=[],t(p,b,z,!1),h}(p,b);case 3:return t(p,b,M,!1);default:throw new Error("box-intersect: Invalid arguments")}var Q};var h,Q=M(14609),mp=M(14634),y=M(14642);function P(p,b){for(var M=0;M<p;++M)if(!(b[M]<=b[M+p]))return!0;return!1}function w(p,b,M,h){for(var Q=0,mp=0,y=0,w=p.length;y<w;++y){var t=p[y];if(!P(b,t)){for(var z=0;z<2*b;++z)M[Q++]=t[z];h[mp++]=y}}return mp}function t(p,b,M,h){var P=p.length,t=b.length;if(!(P<=0||t<=0)){var z=p[0].length>>>1;if(!(z<=0)){var x,S=Q.mallocDouble(2*z*P),X=Q.mallocInt32(P);if((P=w(p,z,S,X))>0){if(1===z&&h)mp.init(P),x=mp.sweepComplete(z,M,0,P,S,X,0,P,S,X);else{var c=Q.mallocDouble(2*z*t),J=Q.mallocInt32(t);(t=w(b,z,c,J))>0&&(mp.init(P+t),x=1===z?mp.sweepBipartite(z,M,0,P,S,X,0,t,c,J):y(z,M,h,P,S,X,t,c,J),Q.free(c),Q.free(J))}Q.free(S),Q.free(X)}return x}}}function z(p,b){h.push([p,b])}},14651:(p,b)=>{"use strict";var M="d",h="ax",Q="fp",mp="es",y="rs",P="re",w="rb",t="bs",z="be",x="bb",S=[M,h,"vv",y,P,w,"ri",t,z,x,"bi"];function X(p){var b="bruteForce"+(p?"Full":"Partial"),h=[],y=S.slice();p||y.splice(3,0,Q);var P=["function "+b+"("+y.join()+"){"];function w(b,Q){var y=function(p,b,h){var Q="bruteForce"+(p?"Red":"Blue")+(b?"Flip":"")+(h?"Full":""),y=["function ",Q,"(",S.join(),"){","var ",mp,"=2*",M,";"],P="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",w="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(h?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return p?y.push(P,"Q",":",w):y.push(w,"Q",":",P),h?y.push("if(y1<x0||x1<y0)continue;"):b?y.push("if(y0<=x0||x1<y0)continue;"):y.push("if(y0<x0||x1<y0)continue;"),y.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),b?y.push("yi,xi"):y.push("xi,yi"),y.push(");if(rv!==void 0)return rv;}}}"),{name:Q,code:y.join("")}}(b,Q,p);h.push(y.code),P.push("return "+y.name+"("+S.join()+");")}P.push("if(re-rs>be-bs){"),p?(w(!0,!1),P.push("}else{"),w(!1,!1)):(P.push("if(fp){"),w(!0,!0),P.push("}else{"),w(!0,!1),P.push("}}else{if(fp){"),w(!1,!0),P.push("}else{"),w(!1,!1),P.push("}")),P.push("}}return "+b);var t=h.join("")+P.join("");return new Function(t)()}b.partial=X(!1),b.full=X(!0)},14642:(p,b,M)=>{"use strict";p.exports=function(p,b,M,mp,z,G,v,Z,U){!function(p,b){var M=8*Q.log2(b+1)*(p+1)|0,mp=Q.nextPow2(o*M);L.length<mp&&(h.free(L),L=h.mallocInt32(mp));var y=Q.nextPow2(l*M);u.length<y&&(h.free(u),u=h.mallocDouble(y))}(p,mp+v);var q,B=0,s=2*p;e(B++,0,0,mp,0,v,M?16:0,-1/0,1/0),M||e(B++,0,0,v,0,mp,1,-1/0,1/0);for(;B>0;){var i=(B-=1)*o,T=L[i],W=L[i+1],H=L[i+2],E=L[i+3],j=L[i+4],V=L[i+5],D=B*l,N=u[D],O=u[D+1],R=1&V,K=!!(16&V),r=z,k=G,A=Z,n=U;if(R&&(r=Z,k=U,A=z,n=G),!(2&V&&W>=(H=g(p,T,W,H,r,k,O)))&&!(4&V&&(W=f(p,T,W,H,r,k,N))>=H)){var C=H-W,F=j-E;if(K){if(p*C*(C+F)<X){if(void 0!==(q=w.scanComplete(p,T,b,W,H,r,k,E,j,A,n)))return q;continue}}else{if(p*Math.min(C,F)<x){if(void 0!==(q=y(p,T,b,R,W,H,r,k,E,j,A,n)))return q;continue}if(p*C*F<S){if(void 0!==(q=w.scanBipartite(p,T,b,R,W,H,r,k,E,j,A,n)))return q;continue}}var pp=c(p,T,W,H,r,k,N,O);if(W<pp)if(p*(pp-W)<x){if(void 0!==(q=P(p,T+1,b,W,pp,r,k,E,j,A,n)))return q}else if(T===p-2){if(void 0!==(q=R?w.sweepBipartite(p,b,E,j,A,n,W,pp,r,k):w.sweepBipartite(p,b,W,pp,r,k,E,j,A,n)))return q}else e(B++,T+1,W,pp,E,j,R,-1/0,1/0),e(B++,T+1,E,j,W,pp,1^R,-1/0,1/0);if(pp<H){var bp=t(p,T,E,j,A,n),Mp=A[s*bp+T],hp=J(p,T,bp,j,A,n,Mp);if(hp<j&&e(B++,T,pp,H,hp,j,(4|R)+(K?16:0),Mp,O),E<bp&&e(B++,T,pp,H,E,bp,(2|R)+(K?16:0),N,Mp),bp+1===hp){if(void 0!==(q=K?I(p,T,b,pp,H,r,k,bp,A,n[bp]):d(p,T,b,R,pp,H,r,k,bp,A,n[bp])))return q}else if(bp<hp){var Qp;if(K){if(pp<(Qp=Y(p,T,pp,H,r,k,Mp))){var mb=J(p,T,pp,Qp,r,k,Mp);if(T===p-2){if(pp<mb&&void 0!==(q=w.sweepComplete(p,b,pp,mb,r,k,bp,hp,A,n)))return q;if(mb<Qp&&void 0!==(q=w.sweepBipartite(p,b,mb,Qp,r,k,bp,hp,A,n)))return q}else pp<mb&&e(B++,T+1,pp,mb,bp,hp,16,-1/0,1/0),mb<Qp&&(e(B++,T+1,mb,Qp,bp,hp,0,-1/0,1/0),e(B++,T+1,bp,hp,mb,Qp,1,-1/0,1/0))}}else pp<(Qp=R?a(p,T,pp,H,r,k,Mp):Y(p,T,pp,H,r,k,Mp))&&(T===p-2?q=R?w.sweepBipartite(p,b,bp,hp,A,n,pp,Qp,r,k):w.sweepBipartite(p,b,pp,Qp,r,k,bp,hp,A,n):(e(B++,T+1,pp,Qp,bp,hp,R,-1/0,1/0),e(B++,T+1,bp,hp,pp,Qp,1^R,-1/0,1/0)))}}}}};var h=M(14609),Q=M(14618),mp=M(14651),y=mp.partial,P=mp.full,w=M(14634),t=M(14659),z=M(14662),x=128,S=1<<22,X=1<<22,c=z("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),J=z("lo===p0",["p0"]),g=z("lo<p0",["p0"]),f=z("hi<=p0",["p0"]),Y=z("lo<=p0&&p0<=hi",["p0"]),a=z("lo<p0&&p0<=hi",["p0"]),o=6,l=2,L=h.mallocInt32(1024),u=h.mallocDouble(1024);function e(p,b,M,h,Q,mp,y,P,w){var t=o*p;L[t]=b,L[t+1]=M,L[t+2]=h,L[t+3]=Q,L[t+4]=mp,L[t+5]=y;var z=l*p;u[z]=P,u[z+1]=w}function d(p,b,M,h,Q,mp,y,P,w,t,z){var x=2*p,S=w*x,X=t[S+b];p:for(var c=Q,J=Q*x;c<mp;++c,J+=x){var g=y[J+b],f=y[J+b+p];if(!(X<g||f<X)&&(!h||X!==g)){for(var Y,a=P[c],o=b+1;o<p;++o){g=y[J+o],f=y[J+o+p];var l=t[S+o],L=t[S+o+p];if(f<l||L<g)continue p}if(void 0!==(Y=h?M(z,a):M(a,z)))return Y}}}function I(p,b,M,h,Q,mp,y,P,w,t){var z=2*p,x=P*z,S=w[x+b];p:for(var X=h,c=h*z;X<Q;++X,c+=z){var J=y[X];if(J!==t){var g=mp[c+b],f=mp[c+b+p];if(!(S<g||f<S)){for(var Y=b+1;Y<p;++Y){g=mp[c+Y],f=mp[c+Y+p];var a=w[x+Y],o=w[x+Y+p];if(f<a||o<g)continue p}var l=M(J,t);if(void 0!==l)return l}}}}},14659:(p,b,M)=>{"use strict";p.exports=function(p,b,M,y,P,w){if(y<=M+1)return M;var t=M,z=y,x=y+M>>>1,S=2*p,X=x,c=P[S*x+b];for(;t<z;){if(z-t<Q){mp(p,b,t,z,P,w),c=P[S*x+b];break}var J=z-t,g=Math.random()*J+t|0,f=P[S*g+b],Y=Math.random()*J+t|0,a=P[S*Y+b],o=Math.random()*J+t|0,l=P[S*o+b];f<=a?l>=a?(X=Y,c=a):f>=l?(X=g,c=f):(X=o,c=l):a>=l?(X=Y,c=a):l>=f?(X=g,c=f):(X=o,c=l);for(var L=S*(z-1),u=S*X,e=0;e<S;++e,++L,++u){var d=P[L];P[L]=P[u],P[u]=d}var I=w[z-1];w[z-1]=w[X],w[X]=I;for(L=S*(z-1),u=S*(X=h(p,b,t,z-1,P,w,c)),e=0;e<S;++e,++L,++u){d=P[L];P[L]=P[u],P[u]=d}I=w[z-1];if(w[z-1]=w[X],w[X]=I,x<X){for(z=X-1;t<z&&P[S*(z-1)+b]===c;)z-=1;z+=1}else{if(!(X<x))break;for(t=X+1;t<z&&P[S*t+b]===c;)t+=1}}return h(p,b,M,x,P,w,P[S*x+b])};var h=M(14662)("lo<p0",["p0"]),Q=8;function mp(p,b,M,h,Q,mp){for(var y=2*p,P=y*(M+1)+b,w=M+1;w<h;++w,P+=y)for(var t=Q[P],z=w,x=y*(w-1);z>M&&Q[x+b]>t;--z,x-=y){for(var S=x,X=x+y,c=0;c<y;++c,++S,++X){var J=Q[S];Q[S]=Q[X],Q[X]=J}var g=mp[z];mp[z]=mp[z-1],mp[z-1]=g}}},14662:p=>{"use strict";p.exports=function(p,M){var h="abcdef".split("").concat(M),Q=[];p.indexOf("lo")>=0&&Q.push("lo=e[k+n]");p.indexOf("hi")>=0&&Q.push("hi=e[k+o]");return h.push(b.replace("_",Q.join()).replace("$",p)),Function.apply(void 0,h)};var b="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14636:p=>{"use strict";p.exports=function(p,h){h<=4*b?M(0,h-1,p):t(0,h-1,p)};var b=32;function M(p,b,M){for(var h=2*(p+1),Q=p+1;Q<=b;++Q){for(var mp=M[h++],y=M[h++],P=Q,w=h-2;P-- >p;){var t=M[w-2],z=M[w-1];if(t<mp)break;if(t===mp&&z<y)break;M[w]=t,M[w+1]=z,w-=2}M[w]=mp,M[w+1]=y}}function h(p,b,M){b*=2;var h=M[p*=2],Q=M[p+1];M[p]=M[b],M[p+1]=M[b+1],M[b]=h,M[b+1]=Q}function Q(p,b,M){b*=2,M[p*=2]=M[b],M[p+1]=M[b+1]}function mp(p,b,M,h){b*=2,M*=2;var Q=h[p*=2],mp=h[p+1];h[p]=h[b],h[p+1]=h[b+1],h[b]=h[M],h[b+1]=h[M+1],h[M]=Q,h[M+1]=mp}function y(p,b,M,h,Q){b*=2,Q[p*=2]=Q[b],Q[b]=M,Q[p+1]=Q[b+1],Q[b+1]=h}function P(p,b,M){b*=2;var h=M[p*=2],Q=M[b];return!(h<Q)&&(h!==Q||M[p+1]>M[b+1])}function w(p,b,M,h){var Q=h[p*=2];return Q<b||Q===b&&h[p+1]<M}function t(p,z,x){var S=(z-p+1)/6|0,X=p+S,c=z-S,J=p+z>>1,g=J-S,f=J+S,Y=X,a=g,o=J,l=f,L=c,u=p+1,e=z-1,d=0;P(Y,a,x)&&(d=Y,Y=a,a=d),P(l,L,x)&&(d=l,l=L,L=d),P(Y,o,x)&&(d=Y,Y=o,o=d),P(a,o,x)&&(d=a,a=o,o=d),P(Y,l,x)&&(d=Y,Y=l,l=d),P(o,l,x)&&(d=o,o=l,l=d),P(a,L,x)&&(d=a,a=L,L=d),P(a,o,x)&&(d=a,a=o,o=d),P(l,L,x)&&(d=l,l=L,L=d);for(var I=x[2*a],G=x[2*a+1],v=x[2*l],Z=x[2*l+1],U=2*Y,q=2*o,B=2*L,s=2*X,i=2*J,T=2*c,W=0;W<2;++W){var H=x[U+W],E=x[q+W],j=x[B+W];x[s+W]=H,x[i+W]=E,x[T+W]=j}Q(g,p,x),Q(f,z,x);for(var V=u;V<=e;++V)if(w(V,I,G,x))V!==u&&h(V,u,x),++u;else if(!w(V,v,Z,x))for(;;){if(w(e,v,Z,x)){w(e,I,G,x)?(mp(V,u,e,x),++u,--e):(h(V,e,x),--e);break}if(--e<V)break}y(p,u-1,I,G,x),y(z,e+1,v,Z,x),u-2-p<=b?M(p,u-2,x):t(p,u-2,x),z-(e+2)<=b?M(e+2,z,x):t(e+2,z,x),e-u<=b?M(u,e,x):t(u,e,x)}},14634:(p,b,M)=>{"use strict";p.exports={init:function(p){var b=Q.nextPow2(p);w.length<b&&(h.free(w),w=h.mallocInt32(b));t.length<b&&(h.free(t),t=h.mallocInt32(b));z.length<b&&(h.free(z),z=h.mallocInt32(b));x.length<b&&(h.free(x),x=h.mallocInt32(b));S.length<b&&(h.free(S),S=h.mallocInt32(b));X.length<b&&(h.free(X),X=h.mallocInt32(b));var M=8*b;c.length<M&&(h.free(c),c=h.mallocDouble(M))},sweepBipartite:function(p,b,M,h,Q,P,S,X,f,Y){for(var a=0,o=2*p,l=p-1,L=o-1,u=M;u<h;++u){var e=P[u],d=o*u;c[a++]=Q[d+l],c[a++]=-(e+1),c[a++]=Q[d+L],c[a++]=e}for(u=S;u<X;++u){e=Y[u]+y;var I=o*u;c[a++]=f[I+l],c[a++]=-e,c[a++]=f[I+L],c[a++]=e}var G=a>>>1;mp(c,G);var v=0,Z=0;for(u=0;u<G;++u){var U=0|c[2*u+1];if(U>=y)J(z,x,Z--,U=U-y|0);else if(U>=0)J(w,t,v--,U);else if(U<=-y){U=-U-y|0;for(var q=0;q<v;++q){if(void 0!==(B=b(w[q],U)))return B}g(z,x,Z++,U)}else{U=-U-1|0;for(q=0;q<Z;++q){var B;if(void 0!==(B=b(U,z[q])))return B}g(w,t,v++,U)}}},sweepComplete:function(p,b,M,h,Q,y,P,f,Y,a){for(var o=0,l=2*p,L=p-1,u=l-1,e=M;e<h;++e){var d=y[e]+1<<1,I=l*e;c[o++]=Q[I+L],c[o++]=-d,c[o++]=Q[I+u],c[o++]=d}for(e=P;e<f;++e){d=a[e]+1<<1;var G=l*e;c[o++]=Y[G+L],c[o++]=1|-d,c[o++]=Y[G+u],c[o++]=1|d}var v=o>>>1;mp(c,v);var Z=0,U=0,q=0;for(e=0;e<v;++e){var B=0|c[2*e+1],s=1&B;if(e<v-1&&B>>1===c[2*e+3]>>1&&(s=2,e+=1),B<0){for(var i=-(B>>1)-1,T=0;T<q;++T){if(void 0!==(W=b(S[T],i)))return W}if(0!==s)for(T=0;T<Z;++T){if(void 0!==(W=b(w[T],i)))return W}if(1!==s)for(T=0;T<U;++T){var W;if(void 0!==(W=b(z[T],i)))return W}0===s?g(w,t,Z++,i):1===s?g(z,x,U++,i):2===s&&g(S,X,q++,i)}else{i=(B>>1)-1;0===s?J(w,t,Z--,i):1===s?J(z,x,U--,i):2===s&&J(S,X,q--,i)}}},scanBipartite:function(p,b,M,h,Q,P,z,x,S,X,f,Y){var a=0,o=2*p,l=b,L=b+p,u=1,e=1;h?e=y:u=y;for(var d=Q;d<P;++d){var I=d+u,G=o*d;c[a++]=z[G+l],c[a++]=-I,c[a++]=z[G+L],c[a++]=I}for(d=S;d<X;++d){I=d+e;var v=o*d;c[a++]=f[v+l],c[a++]=-I}var Z=a>>>1;mp(c,Z);var U=0;for(d=0;d<Z;++d){var q=0|c[2*d+1];if(q<0){var B=!1;if((I=-q)>=y?(B=!h,I-=y):(B=!!h,I-=1),B)g(w,t,U++,I);else{var s=Y[I],i=o*I,T=f[i+b+1],W=f[i+b+1+p];p:for(var H=0;H<U;++H){var E=w[H],j=o*E;if(!(W<z[j+b+1]||z[j+b+1+p]<T)){for(var V=b+2;V<p;++V)if(f[i+V+p]<z[j+V]||z[j+V+p]<f[i+V])continue p;var D,N=x[E];if(void 0!==(D=h?M(s,N):M(N,s)))return D}}}}else J(w,t,U--,q-u)}},scanComplete:function(p,b,M,h,Q,P,t,z,x,S,X){for(var J=0,g=2*p,f=b,Y=b+p,a=h;a<Q;++a){var o=a+y,l=g*a;c[J++]=P[l+f],c[J++]=-o,c[J++]=P[l+Y],c[J++]=o}for(a=z;a<x;++a){o=a+1;var L=g*a;c[J++]=S[L+f],c[J++]=-o}var u=J>>>1;mp(c,u);var e=0;for(a=0;a<u;++a){var d=0|c[2*a+1];if(d<0){if((o=-d)>=y)w[e++]=o-y;else{var I=X[o-=1],G=g*o,v=S[G+b+1],Z=S[G+b+1+p];p:for(var U=0;U<e;++U){var q=w[U],B=t[q];if(B===I)break;var s=g*q;if(!(Z<P[s+b+1]||P[s+b+1+p]<v)){for(var i=b+2;i<p;++i)if(S[G+i+p]<P[s+i]||P[s+i+p]<S[G+i])continue p;var T=M(B,I);if(void 0!==T)return T}}}}else{for(o=d-y,U=e-1;U>=0;--U)if(w[U]===o){for(i=U+1;i<e;++i)w[i-1]=w[i];break}--e}}}};var h=M(14609),Q=M(14618),mp=M(14636),y=1<<28,P=1024,w=h.mallocInt32(P),t=h.mallocInt32(P),z=h.mallocInt32(P),x=h.mallocInt32(P),S=h.mallocInt32(P),X=h.mallocInt32(P),c=h.mallocDouble(8192);function J(p,b,M,h){var Q=b[h],mp=p[M-1];p[Q]=mp,b[mp]=Q}function g(p,b,M,h){p[M]=h,b[h]=M}},14625:p=>{"use strict";function b(p,M,h){var Q=0|p[h];if(Q<=0)return[];var mp,y=new Array(Q);if(h===p.length-1)for(mp=0;mp<Q;++mp)y[mp]=M;else for(mp=0;mp<Q;++mp)y[mp]=b(p,M,h+1);return y}p.exports=function(p,M){switch("undefined"===typeof M&&(M=0),typeof p){case"number":if(p>0)return function(p,b){var M,h;for(M=new Array(p),h=0;h<p;++h)M[h]=b;return M}(0|p,M);break;case"object":if("number"===typeof p.length)return b(p,M,0)}return[]}},14568:(p,b,M)=>{p.exports=function(){var p=this;this.components={},this.comps=this.components;var b=this.components,M=1,Q={},mp=[],y=[],P={timeout:!1,removals:[],multiComps:[]};function w(p,M){var h=b[M],mp=Q[M],y=mp.hash[p];y&&(mp.remove(p),h.yb&&(h.multi?(y.forEach((b=>{b&&h.yb(p,b)})),y.length=0):h.yb(p,y)),P.removals.push(mp),t())}function t(){P.timeout||(P.timeout=!0,setTimeout(z,1))}function z(){P.timeout=!1,x()}function x(){P.multiComps.length&&function(p){for(var b=0;b<p.length;b++){var{entID:M,data:h}=p[b],Q=h.hash[M];if(Q){for(var mp=0;mp<Q.length;mp++)Q[mp]||(Q.splice(mp,1),mp--);0===Q.length&&(h.remove(M),P.removals.push(h))}}p.length=0}(P.multiComps),P.removals.length&&function(p){for(var b=0;b<p.length;b++){p[b].flush()}p.length=0}(P.removals)}this.WS=Q,this._systems=mp,this._renderSystems=y,this.mx=function(b){var h=M++;return Array.isArray(b)&&b.forEach((b=>p.At(h,b))),h},this.deleteEntity=function(b){return Object.keys(Q).forEach((p=>{Q[p].hash[b]&&w(b,p)})),p},this.Ex=function(p){if(!p)throw new Error("Missing component definition");var M=p.name;if(!M)throw new Error("Component definition must have a name property.");if("string"!==typeof M)throw new Error("Component name must be a string.");if(""===M)throw new Error("Component name must be a non-empty string.");if(Q[M])throw new Error(`Component ${M} already exists.`);var P={};return P.name=M,P.multi=!!p.multi,P.order=isNaN(p.order)?99:p.order,P.stateConstructor=p.stateConstructor||null,P.state=p.state||{},P.QQ=p.QQ||null,P.yb=p.yb||null,P.system=p.system||null,P.Fw=p.Fw||null,b[M]=P,Q[M]=new h,Q[M]._pendingMultiCleanup=!1,Q[M]._multiCleanupIDs=P.multi?[]:null,P.system&&(mp.push(M),mp.sort(((p,M)=>b[p].order-b[M].order))),P.Fw&&(y.push(M),y.sort(((p,M)=>b[p].order-b[M].order))),M},this.overwriteComponent=function(p,M){var h=b[p];if(!h)throw new Error(`Unknown component: ${p}`);if(!M)throw new Error("Missing component definition");if(h.name!==M.name)throw new Error("Overwriting component must use the same name property.");var P={};P.name=p,P.multi=!!M.multi,P.order=isNaN(M.order)?99:M.order,P.state=M.state||{},P.QQ=M.QQ||null,P.yb=M.yb||null,P.system=M.system||null,P.Fw=M.Fw||null,b[p]=P,Q[p]._pendingMultiCleanup=!1,Q[p]._multiCleanupIDs=P.multi?[]:null;var w=mp.indexOf(p);P.system&&w<0&&mp.push(p),!P.system&&w>=0&&mp.splice(w,1),mp.sort(((p,M)=>b[p].order-b[M].order));var t=y.indexOf(p);P.Fw&&t<0&&y.push(p),!P.Fw&&t>=0&&y.splice(t,1),y.sort(((p,M)=>b[p].order-b[M].order));var z=P.state;return this.Cz(p).forEach((p=>{for(var b in z)b in p||(p[b]=z[b]);P.QQ&&P.QQ(p.nw,p)})),p},this.deleteComponent=function(M){var h=Q[M];if(!h)throw new Error(`Unknown component: ${M}`);h.flush(),h.list.forEach((p=>{p&&w(p.nw||p[0].nw,M)}));var P=mp.indexOf(M),t=y.indexOf(M);return P>-1&&mp.splice(P,1),t>-1&&y.splice(t,1),Q[M].dispose(),delete Q[M],delete b[M],p},this.At=function(p,M,h){var mp,y=b[M],P=Q[M];if(!P)throw new Error(`Unknown component: ${M}.`);if(P.hash[p]&&!y.multi)throw new Error(`Entity ${p} already has component: ${M}.`);if(y.stateConstructor){if(!(mp=new y.stateConstructor).hasOwnProperty("nw"))throw new Error(`Component ${y.name} stateConstructor type does not have property __id`)}else mp=Object.assign({},{nw:p},y.state,h);if(mp.nw=p,y.multi){var w=P.hash[p];w||(w=[],P.add(p,w)),w.push(mp)}else P.add(p,mp);return y.QQ&&y.QQ(p,mp),this},this.wz=function(p,b){var M=Q[b];if(!M)throw new Error(`Unknown component: ${b}.`);return!!M.hash[p]},this.bz=function(b,M){if(!Q[M])throw new Error(`Unknown component: ${M}.`);return w(b,M),p},this.getState=function(p,b){var M=Q[b];if(!M)throw new Error(`Unknown component: ${b}.`);return M.hash[p]},this.Cz=function(p){var b=Q[p];if(!b)throw new Error(`Unknown component: ${p}.`);return x(),b.list},this.JJ=function(p){if(!Q[p])throw new Error(`Unknown component: ${p}.`);var b=Q[p].hash;return p=>b[p]},this.YJ=function(p){if(!Q[p])throw new Error(`Unknown component: ${p}.`);var b=Q[p].hash;return p=>!!b[p]},this.Kw=function(M){x();for(var h=0;h<mp.length;h++){var y=mp[h],P=b[y],w=Q[y];P.system(M,w.list),x()}return p},this.render=function(M){x();for(var h=0;h<y.length;h++){var mp=y[h],P=b[mp],w=Q[mp];P.Fw(M,w.list),x()}return p},this.removeMultiComponent=function(M,h,mp){var y=b[h],w=Q[h];if(!w)throw new Error(`Unknown component: ${h}.`);if(!y.multi)throw new Error("removeMultiComponent called on non-multi component");return function(p,b,M,h){var Q=M.hash[p];if(Q){var mp=Q[h];mp&&(Q[h]=null,b.yb&&b.yb(p,mp),P.multiComps.push({entID:p,data:M}),t())}}(M,y,w,mp),p}};var h=M(14575)},14575:p=>{function b(p,b){var M=p._map[b];if(delete p.hash[b],delete p._map[b],M===p.list.length-1)p.list.pop();else{var h=p.list.pop();if(p.list[M]=h,null===h||null===h[0]){var Q=p.list.length;for(var mp in p._map)if(p._map[mp]===Q)return void(p._map[mp]=M)}else{var y=h.nw||h[0].nw;p._map[y]=M}}}p.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(p,b){if("number"===typeof this._map[p]){var M=this._map[p];this.hash[p]=b,this.list[M]=b}else this._map[p]=this.list.length,this.hash[p]=b,this.list.push(b)}remove(p){var b=this._map[p];this.hash[p]=null,this.list[b]=null,this._pendingRemovals.push(p)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var p=0;p<this._pendingRemovals.length;p++){var M=this._pendingRemovals[p];null===this.hash[M]&&b(this,M)}this._pendingRemovals.length=0}}},14533:p=>{"use strict";var b,M="object"===typeof Reflect?Reflect:null,h=function(p,b,M){return Function.prototype.apply.call(p,b,M)};b=M&&"function"===typeof M.ownKeys?M.ownKeys:Object.getOwnPropertySymbols?function(p){return Object.getOwnPropertyNames(p).concat(Object.getOwnPropertySymbols(p))}:function(p){return Object.getOwnPropertyNames(p)};var Q=Number.isNaN||function(p){return p!==p};function mp(){mp.init.call(this)}p.exports=mp,p.exports.once=function(p,b){return new Promise((function(M,h){function Q(M){p.removeListener(b,mp),h(M)}function mp(){"function"===typeof p.removeListener&&p.removeListener("error",Q),M([].slice.call(arguments))}J(p,b,mp,{once:!0}),"error"!==b&&function(p,b,M){"function"===typeof p.on&&J(p,"error",b,M)}(p,Q,{once:!0})}))},mp.EventEmitter=mp,mp.prototype._events=void 0,mp.prototype._eventsCount=0,mp.prototype._maxListeners=void 0;var y=10;function P(p){if("function"!==typeof p)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}function w(p){return void 0===p._maxListeners?mp.defaultMaxListeners:p._maxListeners}function t(p,b,M,h){var Q,mp,y,t;if(P(M),void 0===(mp=p._events)?(mp=p._events=Object.create(null),p._eventsCount=0):(void 0!==mp.newListener&&(p.emit("newListener",b,M.listener?M.listener:M),mp=p._events),y=mp[b]),void 0===y)y=mp[b]=M,++p._eventsCount;else if("function"===typeof y?y=mp[b]=h?[M,y]:[y,M]:h?y.unshift(M):y.push(M),(Q=w(p))>0&&y.length>Q&&!y.warned){y.warned=!0;var z=new Error("Possible EventEmitter memory leak detected. "+y.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");z.name="MaxListenersExceededWarning",z.hb=p,z.type=b,z.count=y.length,t=z,console&&console.warn&&console.warn(t)}return p}function z(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function x(p,b,M){var h={fired:!1,wrapFn:void 0,target:p,type:b,listener:M},Q=z.bind(h);return Q.listener=M,h.wrapFn=Q,Q}function S(p,b,M){var h=p._events;if(void 0===h)return[];var Q=h[b];return void 0===Q?[]:"function"===typeof Q?M?[Q.listener||Q]:[Q]:M?function(p){for(var b=new Array(p.length),M=0;M<b.length;++M)b[M]=p[M].listener||p[M];return b}(Q):c(Q,Q.length)}function X(p){var b=this._events;if(void 0!==b){var M=b[p];if("function"===typeof M)return 1;if(void 0!==M)return M.length}return 0}function c(p,b){for(var M=new Array(b),h=0;h<b;++h)M[h]=p[h];return M}function J(p,b,M,h){if("function"===typeof p.on)h.once?p.once(b,M):p.on(b,M);else{if("function"!==typeof p.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p);p.addEventListener(b,(function Q(mp){h.once&&p.removeEventListener(b,Q),M(mp)}))}}Object.defineProperty(mp,"defaultMaxListeners",{enumerable:!0,get:function(){return y},set:function(p){if("number"!==typeof p||p<0||Q(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");y=p}}),mp.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},mp.prototype.setMaxListeners=function(p){if("number"!==typeof p||p<0||Q(p))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+p+".");return this._maxListeners=p,this},mp.prototype.getMaxListeners=function(){return w(this)},mp.prototype.emit=function(p){for(var b=[],M=1;M<arguments.length;M++)b.push(arguments[M]);var Q="error"===p,mp=this._events;if(void 0!==mp)Q=Q&&void 0===mp.error;else if(!Q)return!1;if(Q){var y;if(b.length>0&&(y=b[0]),y instanceof Error)throw y;var P=new Error("Unhandled error."+(y?" ("+y.message+")":""));throw P.context=y,P}var w=mp[p];if(void 0===w)return!1;if("function"===typeof w)h(w,this,b);else{var t=w.length,z=c(w,t);for(M=0;M<t;++M)h(z[M],this,b)}return!0},mp.prototype.addListener=function(p,b){return t(this,p,b,!1)},mp.prototype.on=mp.prototype.addListener,mp.prototype.prependListener=function(p,b){return t(this,p,b,!0)},mp.prototype.once=function(p,b){return P(b),this.on(p,x(this,p,b)),this},mp.prototype.prependOnceListener=function(p,b){return P(b),this.prependListener(p,x(this,p,b)),this},mp.prototype.removeListener=function(p,b){var M,h,Q,mp,y;if(P(b),void 0===(h=this._events))return this;if(void 0===(M=h[p]))return this;if(M===b||M.listener===b)0===--this._eventsCount?this._events=Object.create(null):(delete h[p],h.removeListener&&this.emit("removeListener",p,M.listener||b));else if("function"!==typeof M){for(Q=-1,mp=M.length-1;mp>=0;mp--)if(M[mp]===b||M[mp].listener===b){y=M[mp].listener,Q=mp;break}if(Q<0)return this;0===Q?M.shift():function(p,b){for(;b+1<p.length;b++)p[b]=p[b+1];p.pop()}(M,Q),1===M.length&&(h[p]=M[0]),void 0!==h.removeListener&&this.emit("removeListener",p,y||b)}return this},mp.prototype.off=mp.prototype.removeListener,mp.prototype.Qb=function(p){var b,M,h;if(void 0===(M=this._events))return this;if(void 0===M.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==M[p]&&(0===--this._eventsCount?this._events=Object.create(null):delete M[p]),this;if(0===arguments.length){var Q,mp=Object.keys(M);for(h=0;h<mp.length;++h)"removeListener"!==(Q=mp[h])&&this.Qb(Q);return this.Qb("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(b=M[p]))this.removeListener(p,b);else if(void 0!==b)for(h=b.length-1;h>=0;h--)this.removeListener(p,b[h]);return this},mp.prototype.listeners=function(p){return S(this,p,!0)},mp.prototype.rawListeners=function(p){return S(this,p,!1)},mp.listenerCount=function(p,b){return"function"===typeof p.listenerCount?p.listenerCount(b):X.call(p,b)},mp.prototype.listenerCount=X,mp.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]}},14984:p=>{"use strict";p.exports=function(p,b,M,h,Q,mp){var y=+b[0],P=+b[1],w=+b[2],t=+M[0],z=+M[1],x=+M[2],S=Math.sqrt(t*t+z*z+x*x);if(0===S)throw new Error("Can't raycast along a zero vector");return function(p,b,M,h,Q,mp,y,P,w,t){for(var z=0,x=Math.floor,S=0|x(b),X=0|x(M),c=0|x(h),J=Q>0?1:-1,g=mp>0?1:-1,f=y>0?1:-1,Y=Math.abs(1/Q),a=Math.abs(1/mp),o=Math.abs(1/y),l=Y<1/0?Y*(J>0?S+1-b:b-S):1/0,L=a<1/0?a*(g>0?X+1-M:M-X):1/0,u=o<1/0?o*(f>0?c+1-h:h-c):1/0,e=-1;z<=P;){var d=p(S,X,c);if(d)return w&&(w[0]=b+z*Q,w[1]=M+z*mp,w[2]=h+z*y),t&&(t[0]=t[1]=t[2]=0,0===e&&(t[0]=-J),1===e&&(t[1]=-g),2===e&&(t[2]=-f)),d;l<L?l<u?(S+=J,z=l,l+=Y,e=0):(c+=f,z=u,u+=o,e=2):L<u?(X+=g,z=L,L+=a,e=1):(c+=f,z=u,u+=o,e=2)}return w&&(w[0]=b+z*Q,w[1]=M+z*mp,w[2]=h+z*y),t&&(t[0]=t[1]=t[2]=0),0}(p,y,P,w,t/=S,z/=S,x/=S,h="undefined"===typeof h?64:+h,Q,mp)}},15013:(p,b,M)=>{"use strict";M.d(b,{d:()=>mp});var h=M(14533);function Q(){this.vX=!1,this.stopPropagation=!1,this.ZX=!1,this.disabled=!1}class mp{constructor(p,b){this.version="0.7.0";var M=Object.assign({},new Q,b||{});this.element=p||document,this.vX=!!M.vX,this.stopPropagation=!!M.stopPropagation,this.ZX=!!M.ZX,this.disabled=!!M.disabled,this.filterEvents=(p,b)=>!0,this.down=new h.EventEmitter,this.up=new h.EventEmitter,this.state={},this.Rz={dx:0,dy:0,PJ:0,Oz:0,wJ:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?P(this):document.addEventListener("DOMContentLoaded",(p=>{P(this)}),{once:!0})}bind(p){for(var b=arguments.length,M=new Array(b>1?b-1:0),h=1;h<b;h++)M[h-1]=arguments[h];M.forEach((b=>{var M=this._keyBindmap[b]||[];M.includes(p)||(M.push(p),this._keyBindmap[b]=M)})),this.state[p]=!!this.state[p],this.pressCount[p]=this.pressCount[p]||0,this.releaseCount[p]=this.releaseCount[p]||0}unbind(p){for(var b in this._keyBindmap){var M=this._keyBindmap[b],h=M.indexOf(p);h>-1&&M.splice(h,1)}}getBindings(){var p={};for(var b in this._keyBindmap){this._keyBindmap[b].forEach((M=>{p[M]=p[M]||[],p[M].push(b)}))}return p}Kw(){y(this.Rz),y(this.pressCount),y(this.releaseCount)}}function y(p){for(var b in p)p[b]=0}function P(p){window.addEventListener("keydown",c.bind(null,p,!0),!1),window.addEventListener("keyup",c.bind(null,p,!1),!1);var b={passive:!0};p.element.addEventListener("touchstart",x.bind(void 0,p),{passive:!1}),p.element.addEventListener("touchend",X.bind(void 0,p),b),p.element.addEventListener("mousedown",J.bind(null,p,!0),b),window.document.addEventListener("mouseup",J.bind(null,p,!1),b),p.element.addEventListener("touchmove",g.bind(null,p),b),p.element.addEventListener("mousemove",g.bind(null,p),b),window.PointerEvent,p.element.addEventListener("wheel",f.bind(null,p),b),p.element.addEventListener("contextmenu",Y.bind(null,p),!1),window.addEventListener("blur",a.bind(null,p),!1)}var w=0,t=0,z=null;function x(p,b){b.preventDefault(),S(b)}function S(p){let b=!1;for(let M=0;M<p.touches.length;++M)if(p.touches[M].identifier===z){b=!0;break}if(!b){const b=p.changedTouches[0];w=b.clientX,t=b.clientY,z=b.identifier}}function X(p,b){for(var M=b.changedTouches,h=0;h<M.length;++h)M[h].identifier===z&&(z=null)}function c(p,b,M){o(M.code,b,p,M)}function J(p,b,M){if("pointerId"in M)if(b){if(null!==p._touches.currID)return;p._touches.currID=M.pointerId}else{if(p._touches.currID!==M.pointerId)return;p._touches.currID=null}return o("Mouse"+("button"in M?M.button+1:1),b,p,M),!1}function g(p,b){var M=b.movementX||b.mozMovementX||0,h=b.movementY||b.mozMovementY||0;if(b.touches&&0===(M|h)){var Q=function(p){S(p);for(let b=0;b<p.changedTouches.length;++b)if(p.changedTouches[b].identifier==z){const M=p.changedTouches[b],h=[M.clientX-w,M.clientY-t];return w=M.clientX,t=M.clientY,h}return console.error(`Did not find touch id ${z}`),[0,0]}(b);M=Q[0],h=Q[1]}p.Rz.dx+=M,p.Rz.dy+=h}function f(p,b){var M=1;switch(b.deltaMode){case 0:M=1;break;case 1:M=12;break;case 2:M=p.element.clientHeight||window.innerHeight}p.Rz.PJ+=(b.deltaX||0)*M,p.Rz.Oz+=(b.deltaY||0)*M,p.Rz.wJ+=(b.deltaZ||0)*M}function Y(p,b){if(!p.ZX)return b.preventDefault(),!1}function a(p){for(var b in p._keyStates)p._keyStates[b]&&(/^Mouse\d/.test(b)||o(b,!1,p,{code:b,note:"v3gjfuotw7",preventDefault:()=>{},stopPropagation:()=>{}}))}function o(p,b,M,h){var Q=M._keyBindmap[p];Q&&(l(M._keyStates[p],b)&&(M._keyStates[p]=b,Q.forEach((p=>{(!M.filterEvents||M.filterEvents(h,p))&&function(p,b,M,h){var Q=b?M.pressCount:M.releaseCount;Q[p]=(Q[p]||0)+1;var mp=M._bindPressCount[p]||0;(mp+=b?1:-1)<0&&(mp=0);M._bindPressCount[p]=mp;var y=M.state[p];if(l(y,mp)){M.state[p]=mp>0;var P=b?M.down:M.up;M.disabled||P.emit(p,h)}}(p,b,M,h)}))),"button"in h||(M.vX&&!h.defaultPrevented&&h.preventDefault(),M.stopPropagation&&h.stopPropagation()))}function l(p,b){return p?!b:b}},13642:p=>{p.exports=function(p,b,M){return p[0]=b[0]+M[0],p[1]=b[1]+M[1],p[2]=b[2]+M[2],p}},13599:(p,b,M)=>{p.exports=function(p,b){var M=h(p[0],p[1],p[2]),y=h(b[0],b[1],b[2]);Q(M,M),Q(y,y);var P=mp(M,y);return P>1?0:Math.acos(P)};var h=M(13604),Q=M(13612),mp=M(13619)},13694:p=>{p.exports=function(p,b){return p[0]=Math.ceil(b[0]),p[1]=Math.ceil(b[1]),p[2]=Math.ceil(b[2]),p}},13592:p=>{p.exports=function(p){var b=new Float32Array(3);return b[0]=p[0],b[1]=p[1],b[2]=p[2],b}},13626:p=>{p.exports=function(p,b){return p[0]=b[0],p[1]=b[1],p[2]=b[2],p}},13584:p=>{p.exports=function(){var p=new Float32Array(3);return p[0]=0,p[1]=0,p[2]=0,p}},13756:p=>{p.exports=function(p,b,M){var h=b[0],Q=b[1],mp=b[2],y=M[0],P=M[1],w=M[2];return p[0]=Q*w-mp*P,p[1]=mp*y-h*w,p[2]=h*P-Q*y,p}},13713:(p,b,M)=>{p.exports=M(13710)},13710:p=>{p.exports=function(p,b){var M=b[0]-p[0],h=b[1]-p[1],Q=b[2]-p[2];return Math.sqrt(M*M+h*h+Q*Q)}},13668:(p,b,M)=>{p.exports=M(13661)},13661:p=>{p.exports=function(p,b,M){return p[0]=b[0]/M[0],p[1]=b[1]/M[1],p[2]=b[2]/M[2],p}},13619:p=>{p.exports=function(p,b){return p[0]*b[0]+p[1]*b[1]+p[2]*b[2]}},13576:p=>{p.exports=1e-6},13632:(p,b,M)=>{p.exports=function(p,b){var M=p[0],Q=p[1],mp=p[2],y=b[0],P=b[1],w=b[2];return Math.abs(M-y)<=h*Math.max(1,Math.abs(M),Math.abs(y))&&Math.abs(Q-P)<=h*Math.max(1,Math.abs(Q),Math.abs(P))&&Math.abs(mp-w)<=h*Math.max(1,Math.abs(mp),Math.abs(w))};var h=M(13576)},13637:p=>{p.exports=function(p,b){return p[0]===b[0]&&p[1]===b[1]&&p[2]===b[2]}},13686:p=>{p.exports=function(p,b){return p[0]=Math.floor(b[0]),p[1]=Math.floor(b[1]),p[2]=Math.floor(b[2]),p}},13809:(p,b,M)=>{p.exports=function(p,b,M,Q,mp,y){var P,w;b||(b=3);M||(M=0);w=Q?Math.min(Q*b+M,p.length):p.length;for(P=M;P<w;P+=b)h[0]=p[P],h[1]=p[P+1],h[2]=p[P+2],mp(h,h,y),p[P]=h[0],p[P+1]=h[1],p[P+2]=h[2];return p};var h=M(13584)()},13604:p=>{p.exports=function(p,b,M){var h=new Float32Array(3);return h[0]=p,h[1]=b,h[2]=M,h}},13573:(p,b,M)=>{p.exports={EPSILON:M(13576),create:M(13584),clone:M(13592),angle:M(13599),Ww:M(13604),k:M(13626),set:M(13628),equals:M(13632),exactEquals:M(13637),add:M(13642),mh:M(13644),sub:M(13650),multiply:M(13652),mul:M(13659),divide:M(13661),div:M(13668),min:M(13670),max:M(13679),floor:M(13686),ceil:M(13694),round:M(13702),scale:M(13706),Hw:M(13708),distance:M(13710),i:M(13713),squaredDistance:M(13720),sqrDist:M(13724),length:M(13726),len:M(13730),squaredLength:M(13737),Ew:M(13740),negate:M(13742),inverse:M(13750),normalize:M(13612),dot:M(13619),cross:M(13756),Lw:M(13765),random:M(13768),transformMat4:M(13774),transformMat3:M(13776),transformQuat:M(13785),jw:M(13791),Vw:M(13794),Dw:M(13802),forEach:M(13809)}},13750:p=>{p.exports=function(p,b){return p[0]=1/b[0],p[1]=1/b[1],p[2]=1/b[2],p}},13730:(p,b,M)=>{p.exports=M(13726)},13726:p=>{p.exports=function(p){var b=p[0],M=p[1],h=p[2];return Math.sqrt(b*b+M*M+h*h)}},13765:p=>{p.exports=function(p,b,M,h){var Q=b[0],mp=b[1],y=b[2];return p[0]=Q+h*(M[0]-Q),p[1]=mp+h*(M[1]-mp),p[2]=y+h*(M[2]-y),p}},13679:p=>{p.exports=function(p,b,M){return p[0]=Math.max(b[0],M[0]),p[1]=Math.max(b[1],M[1]),p[2]=Math.max(b[2],M[2]),p}},13670:p=>{p.exports=function(p,b,M){return p[0]=Math.min(b[0],M[0]),p[1]=Math.min(b[1],M[1]),p[2]=Math.min(b[2],M[2]),p}},13659:(p,b,M)=>{p.exports=M(13652)},13652:p=>{p.exports=function(p,b,M){return p[0]=b[0]*M[0],p[1]=b[1]*M[1],p[2]=b[2]*M[2],p}},13742:p=>{p.exports=function(p,b){return p[0]=-b[0],p[1]=-b[1],p[2]=-b[2],p}},13612:p=>{p.exports=function(p,b){var M=b[0],h=b[1],Q=b[2],mp=M*M+h*h+Q*Q;mp>0&&(mp=1/Math.sqrt(mp),p[0]=b[0]*mp,p[1]=b[1]*mp,p[2]=b[2]*mp);return p}},13768:p=>{p.exports=function(p,b){b=b||1;var M=2*Math.random()*Math.PI,h=2*Math.random()-1,Q=Math.sqrt(1-h*h)*b;return p[0]=Math.cos(M)*Q,p[1]=Math.sin(M)*Q,p[2]=h*b,p}},13791:p=>{p.exports=function(p,b,M,h){var Q=M[1],mp=M[2],y=b[1]-Q,P=b[2]-mp,w=Math.sin(h),t=Math.cos(h);return p[0]=b[0],p[1]=Q+y*t-P*w,p[2]=mp+y*w+P*t,p}},13794:p=>{p.exports=function(p,b,M,h){var Q=M[0],mp=M[2],y=b[0]-Q,P=b[2]-mp,w=Math.sin(h),t=Math.cos(h);return p[0]=Q+P*w+y*t,p[1]=b[1],p[2]=mp+P*t-y*w,p}},13802:p=>{p.exports=function(p,b,M,h){var Q=M[0],mp=M[1],y=b[0]-Q,P=b[1]-mp,w=Math.sin(h),t=Math.cos(h);return p[0]=Q+y*t-P*w,p[1]=mp+y*w+P*t,p[2]=b[2],p}},13702:p=>{p.exports=function(p,b){return p[0]=Math.round(b[0]),p[1]=Math.round(b[1]),p[2]=Math.round(b[2]),p}},13706:p=>{p.exports=function(p,b,M){return p[0]=b[0]*M,p[1]=b[1]*M,p[2]=b[2]*M,p}},13708:p=>{p.exports=function(p,b,M,h){return p[0]=b[0]+M[0]*h,p[1]=b[1]+M[1]*h,p[2]=b[2]+M[2]*h,p}},13628:p=>{p.exports=function(p,b,M,h){return p[0]=b,p[1]=M,p[2]=h,p}},13724:(p,b,M)=>{p.exports=M(13720)},13740:(p,b,M)=>{p.exports=M(13737)},13720:p=>{p.exports=function(p,b){var M=b[0]-p[0],h=b[1]-p[1],Q=b[2]-p[2];return M*M+h*h+Q*Q}},13737:p=>{p.exports=function(p){var b=p[0],M=p[1],h=p[2];return b*b+M*M+h*h}},13650:(p,b,M)=>{p.exports=M(13644)},13644:p=>{p.exports=function(p,b,M){return p[0]=b[0]-M[0],p[1]=b[1]-M[1],p[2]=b[2]-M[2],p}},13776:p=>{p.exports=function(p,b,M){var h=b[0],Q=b[1],mp=b[2];return p[0]=h*M[0]+Q*M[3]+mp*M[6],p[1]=h*M[1]+Q*M[4]+mp*M[7],p[2]=h*M[2]+Q*M[5]+mp*M[8],p}},13774:p=>{p.exports=function(p,b,M){var h=b[0],Q=b[1],mp=b[2],y=M[3]*h+M[7]*Q+M[11]*mp+M[15];return y=y||1,p[0]=(M[0]*h+M[4]*Q+M[8]*mp+M[12])/y,p[1]=(M[1]*h+M[5]*Q+M[9]*mp+M[13])/y,p[2]=(M[2]*h+M[6]*Q+M[10]*mp+M[14])/y,p}},13785:p=>{p.exports=function(p,b,M){var h=b[0],Q=b[1],mp=b[2],y=M[0],P=M[1],w=M[2],t=M[3],z=t*h+P*mp-w*Q,x=t*Q+w*h-y*mp,S=t*mp+y*Q-P*h,X=-y*h-P*Q-w*mp;return p[0]=z*t+X*-y+x*-w-S*-P,p[1]=x*t+X*-P+S*-y-z*-w,p[2]=S*t+X*-w+z*-P-x*-y,p}},14555:p=>{"use strict";p.exports=function(p){for(var b=new Array(p),M=0;M<p;++M)b[M]=M;return b}},14629:p=>{p.exports=function(p){return null!=p&&null!=p.constructor&&"function"===typeof p.constructor.isBuffer&&p.constructor.isBuffer(p)}},14992:(p,b,M)=>{"use strict";M.d(b,{e:()=>h});class h{constructor(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.wS=!1,this.tS=!1,this.yS=30,this.PS=0,this.fS=!1,this.fullscreen=!1,this.xS=function(p){},this.SS=function(){},this.JS=function(){},this.Pb=function(){},this.XS=function(p){},this.onFullscreenChanged=function(p){},t((()=>{!function(p,b){p._nowObject=performance||Date,p._lastTick=0,p._renderAccum=0,p._rt=0,p._frameCB=P.bind(null,p),requestAnimationFrame(p._frameCB),b>0&&(p._intervalCB=y.bind(null,p),p._interval=setInterval(p._intervalCB,Math.max(b,1e3/p.yS/2)))}(this,b),function(p,b){if(!b)return;var M=!1,h=!1;document.addEventListener("pointerlockchange",(h=>{M=document.pointerLockElement===b,p.XS(M)})),document.addEventListener("fullscreenchange",(M=>{h=document.fullscreenElement===b,p.onFullscreenChanged(h)})),Object.defineProperty(p,"fS",{get:()=>M,set:p=>{p&&!M?w(b):M&&!p&&function(p){p.exitPointerLock&&p.exitPointerLock()}(document)}}),Object.defineProperty(p,"fullscreen",{get:()=>h,set:p=>{p&&!h?b.requestFullscreen():h&&!p&&document.exitFullscreen()}}),b.addEventListener("click",(Q=>{p.wS&&!M&&w(b),p.tS&&!h&&b.requestFullscreen()}));var Q=()=>p.Pb();if(window.ResizeObserver){new ResizeObserver(Q).observe(b)}else window.addEventListener("resize",Q)}(this,p),this.JS()}))}}var Q=3,mp=20;function y(p){for(var b=1e3/p.yS,M=p._nowObject.now()+mp,h=0;p._nowObject.now()>=p._lastTick+b&&p._nowObject.now()<M&&++h<=Q;)p.xS(b),p._lastTick+=b;var y=5*(b+5),P=p._nowObject.now();if(P-p._lastTick>y)for(;P>=p._lastTick+b;)p._lastTick+=b}function P(p){requestAnimationFrame(p._frameCB),y(p);var b=p._nowObject.now(),M=b-p._rt;if(p._rt=b,p.PS>0){p._renderAccum+=M;var h=1e3/p.PS;if(p._renderAccum<h)return;p._renderAccum=Math.min(p._renderAccum-h,h)}var Q=1e3/p.yS,mp=(b-p._lastTick)/Q;p.SS(M,mp,Q)}function w(p){p.requestPointerLock&&p.requestPointerLock()}var t=p=>{if("loading"===document.readyState){var b=()=>{document.removeEventListener("readystatechange",b),p()};document.addEventListener("readystatechange",b)}else setTimeout(p,1)}},14547:(p,b,M)=>{var h=M(14555),Q=M(14564),mp="undefined"!==typeof Float64Array;function y(p,b){return p[0]-b[0]}function P(){var p,b=this.stride,M=new Array(b.length);for(p=0;p<M.length;++p)M[p]=[Math.abs(b[p]),p];M.sort(y);var h=new Array(M.length);for(p=0;p<h.length;++p)h[p]=M[p][1];return h}function w(p,b){var M=["View",b,"d",p].join("");b<0&&(M="View_Nil"+p);var Q="generic"===p;if(-1===b){var mp="function "+M+"(a){this.data=a;};var proto="+M+".prototype;proto.dtype='"+p+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+M+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+M+"(a){return new "+M+"(a);}";return new Function(mp)()}if(0===b){mp="function "+M+"(a,d) {this.data = a;this.offset = d};var proto="+M+".prototype;proto.dtype='"+p+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+M+"_copy() {return new "+M+"(this.data,this.offset)};proto.pick=function "+M+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+M+"_get(){return "+(Q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+M+"_set(v){return "+(Q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+M+"(a,b,c,d){return new "+M+"(a,d)}";return new Function("TrivialArray",mp)(t[p][0])}mp=["'use strict'"];var y=h(b),w=y.map((function(p){return"i"+p})),z="this.offset+"+y.map((function(p){return"this.stride["+p+"]*i"+p})).join("+"),x=y.map((function(p){return"b"+p})).join(","),S=y.map((function(p){return"c"+p})).join(",");mp.push("function "+M+"(a,"+x+","+S+",d){this.data=a","this.shape=["+x+"]","this.stride=["+S+"]","this.offset=d|0}","var proto="+M+".prototype","proto.dtype='"+p+"'","proto.dimension="+b),mp.push("Object.defineProperty(proto,'size',{get:function "+M+"_size(){return "+y.map((function(p){return"this.shape["+p+"]"})).join("*"),"}})"),1===b?mp.push("proto.order=[0]"):(mp.push("Object.defineProperty(proto,'order',{get:"),b<4?(mp.push("function "+M+"_order(){"),2===b?mp.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&mp.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):mp.push("ORDER})")),mp.push("proto.set=function "+M+"_set("+w.join(",")+",v){"),Q?mp.push("return this.data.set("+z+",v)}"):mp.push("return this.data["+z+"]=v}"),mp.push("proto.get=function "+M+"_get("+w.join(",")+"){"),Q?mp.push("return this.data.get("+z+")}"):mp.push("return this.data["+z+"]}"),mp.push("proto.index=function "+M+"_index(",w.join(),"){return "+z+"}"),mp.push("proto.hi=function "+M+"_hi("+w.join(",")+"){return new "+M+"(this.data,"+y.map((function(p){return["(typeof i",p,"!=='number'||i",p,"<0)?this.shape[",p,"]:i",p,"|0"].join("")})).join(",")+","+y.map((function(p){return"this.stride["+p+"]"})).join(",")+",this.offset)}");var X=y.map((function(p){return"a"+p+"=this.shape["+p+"]"})),c=y.map((function(p){return"c"+p+"=this.stride["+p+"]"}));mp.push("proto.lo=function "+M+"_lo("+w.join(",")+"){var b=this.offset,d=0,"+X.join(",")+","+c.join(","));for(var J=0;J<b;++J)mp.push("if(typeof i"+J+"==='number'&&i"+J+">=0){d=i"+J+"|0;b+=c"+J+"*d;a"+J+"-=d}");mp.push("return new "+M+"(this.data,"+y.map((function(p){return"a"+p})).join(",")+","+y.map((function(p){return"c"+p})).join(",")+",b)}"),mp.push("proto.step=function "+M+"_step("+w.join(",")+"){var "+y.map((function(p){return"a"+p+"=this.shape["+p+"]"})).join(",")+","+y.map((function(p){return"b"+p+"=this.stride["+p+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(J=0;J<b;++J)mp.push("if(typeof i"+J+"==='number'){d=i"+J+"|0;if(d<0){c+=b"+J+"*(a"+J+"-1);a"+J+"=ceil(-a"+J+"/d)}else{a"+J+"=ceil(a"+J+"/d)}b"+J+"*=d}");mp.push("return new "+M+"(this.data,"+y.map((function(p){return"a"+p})).join(",")+","+y.map((function(p){return"b"+p})).join(",")+",c)}");var g=new Array(b),f=new Array(b);for(J=0;J<b;++J)g[J]="a[i"+J+"]",f[J]="b[i"+J+"]";mp.push("proto.transpose=function "+M+"_transpose("+w+"){"+w.map((function(p,b){return p+"=("+p+"===undefined?"+b+":"+p+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+M+"(this.data,"+g.join(",")+","+f.join(",")+",this.offset)}"),mp.push("proto.pick=function "+M+"_pick("+w+"){var a=[],b=[],c=this.offset");for(J=0;J<b;++J)mp.push("if(typeof i"+J+"==='number'&&i"+J+">=0){c=(c+this.stride["+J+"]*i"+J+")|0}else{a.push(this.shape["+J+"]);b.push(this.stride["+J+"])}");return mp.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),mp.push("return function construct_"+M+"(data,shape,stride,offset){return new "+M+"(data,"+y.map((function(p){return"shape["+p+"]"})).join(",")+","+y.map((function(p){return"stride["+p+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",mp.join("\n"))(t[p],P)}var t={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};p.exports=function(p,b,M,h){if(void 0===p)return(0,t.array[0])([]);"number"===typeof p&&(p=[p]),void 0===b&&(b=[p.length]);var y=b.length;if(void 0===M){M=new Array(y);for(var P=y-1,z=1;P>=0;--P)M[P]=z,z*=b[P]}if(void 0===h){h=0;for(P=0;P<y;++P)M[P]<0&&(h-=(b[P]-1)*M[P])}for(var x=function(p){if(Q(p))return"buffer";if(mp)switch(Object.prototype.toString.call(p)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(p)?"array":"generic"}(p),S=t[x];S.length<=y+1;)S.push(w(x,S.length-1));return(0,S[y+1])(p,b,M,h)}},14564:p=>{function b(p){return!!p.constructor&&"function"===typeof p.constructor.isBuffer&&p.constructor.isBuffer(p)}p.exports=function(p){return null!=p&&(b(p)||function(p){return"function"===typeof p.readFloatLE&&"function"===typeof p.slice&&b(p.slice(0,0))}(p)||!!p._isBuffer)}},14719:p=>{"use strict";var b=[],M=[],h=[],Q=[],mp=[],y=[],P=[],w=[],t=[],z=[],x=[],S=[];p.exports=function(p,X,c,J,g,f){for(var Y=P,a=t,o=z,l=S,L=0;L<3;L++)Y[L]=+c[L],o[L]=+X.max[L],a[L]=+X.base[L];f||(f=1e-10);var u=function(p,P,t,z,S,X){var c=b,J=M,g=h,f=Q,Y=mp,a=y,o=w,l=Math.floor,L=0,u=0,e=0,d=0,I=0;if(G(),0===e)return 0;for(d=U();u<=e;){if(v(d)&&Z())return L;d=U()}for(L+=e,I=0;I<3;I++)z[I]+=t[I],S[I]+=t[I];return L;function G(){if(u=0,0!==(e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])))for(var p=0;p<3;p++){var b=t[p]>=0;f[p]=b?1:-1;var M=b?S[p]:z[p];c[p]=b?z[p]:S[p],J[p]=q(M,f[p]),g[p]=B(c[p],f[p]),o[p]=t[p]/e,Y[p]=Math.abs(1/o[p]);var h=b?J[p]+1-M:M-J[p];a[p]=Y[p]<1/0?Y[p]*h:1/0}}function v(b){for(var M=f[0],h=0===b?J[0]:g[0],Q=J[0]+M,mp=f[1],y=1===b?J[1]:g[1],P=J[1]+mp,w=f[2],t=2===b?J[2]:g[2],z=J[2]+w,x=h;x!=Q;x+=M)for(var S=y;S!=P;S+=mp)for(var X=t;X!=z;X+=w)if(p(x,S,X))return!0;return!1}function Z(){L+=u;var p=f[d],b=u/e,M=x;for(I=0;I<3;I++){var h=t[I]*b;z[I]+=h,S[I]+=h,M[I]=t[I]-h}if(p>0?S[d]=Math.round(S[d]):z[d]=Math.round(z[d]),P(L,d,p,M))return!0;for(I=0;I<3;I++)t[I]=M[I];return G(),0===e}function U(){var p=a[0]<a[1]?a[0]<a[2]?0:2:a[1]<a[2]?1:2,b=a[p]-u;for(u=a[p],J[p]+=f[p],a[p]+=Y[p],I=0;I<3;I++)c[I]+=b*o[I],g[I]=B(c[I],f[I]);return p}function q(p,b){return l(p-b*X)}function B(p,b){return l(p+b*X)}}(p,J,Y,a,o,f);if(!g){for(L=0;L<3;L++)l[L]=c[L]>0?o[L]-X.max[L]:a[L]-X.base[L];X.translate(l)}return u}},15016:(p,b,M)=>{"use strict";M.d(b,{c:()=>x});var h=M(14714),Q=M(13573);class mp{constructor(p,b,M,mp,y,P,w){this.Az=new h(p.base,p.Jx),this.tm=b,this.friction=M,this.restitution=mp,this.Jw=y,this.IJ=P,this.gw=!!w,this.Xx=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.gg=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Sz=Q.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=Q.create(),this._impulses=Q.create(),this._sleepFrameCount=10}loadFromCopy(p){Q.k(this.Az.base,p.Az.base),Q.k(this.Az.Jx,p.Az.Jx),Q.k(this.Az.max,p.Az.max),this.Az.mag=p.Az.mag,this.tm=p.tm,this.friction=p.friction,this.restitution=p.restitution,this.Jw=p.Jw,this.IJ=p.IJ,this.gw=p.gw,this.Xx=p.Xx,this.fluidDrag=p.fluidDrag,this.gg=p.gg,this.preventFallOffEdge=p.preventFallOffEdge,this.rolledBackLastTick=p.rolledBackLastTick,Q.k(this.Sz,p.Sz),Q.k(this.resting,p.resting),this.inFluid=p.inFluid,this._ratioInFluid=p._ratioInFluid,Q.k(this._forces,p._forces),Q.k(this._impulses,p._impulses),this._sleepFrameCount=p._sleepFrameCount}setPosition(p){y(p),Q.mh(p,p,this.Az.base),this.Az.translate(p),this.Xz()}wb(){return Q.clone(this.Az.base)}applyForce(p){y(p),Q.add(this._forces,this._forces,p),this.Xz()}applyImpulse(p){y(p),Q.add(this._impulses,this._impulses,p),this.Xz()}Xz(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var y=p=>{};var P=M(14714),w=M(13573),t=M(14719);function z(){this.Xx=.1,this.fluidDrag=.4,this.lw=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function x(p,b,M){p=Object.assign(new z,p),this.gravity=p.gravity||[0,-10,0],this.Xx=p.Xx||.1,this.lw=p.lw||2,this.fluidDrag=p.fluidDrag||.4,this.minBounceImpulse=p.minBounceImpulse,this.bodies=[],this.Wc=p.Wc,this.testSolid=b,this.testFluid=M}x.prototype.sJ=function(p,b,M,h,Q,y){p=p||new P([0,0,0],[1,1,1]),"undefined"==typeof b&&(b=1),"undefined"==typeof M&&(M=1),"undefined"==typeof h&&(h=0),"undefined"==typeof Q&&(Q=1);var w=new mp(p,b,M,h,Q,y);return this.bodies.push(w),w},x.prototype.iJ=function(p){var b=this.bodies.indexOf(p);b<0||(this.bodies.splice(b,1),p.Az=p.IJ=null)};var S=w.create(),X=w.create(),c=w.create(),J=w.create(),g=w.create(),f=w.create(),Y=w.create(),a=new P([0,0,0],[1,1,1]),o=new mp(a,1,1,0,1,(()=>{}),!1);function l(p,b,M){return b=M,b*=1-(1-p.ratioInFluid)**2}x.prototype.Kw=function(p){p/=1e3;var b=H(0,w.squaredLength(this.gravity));this.bodies.forEach((M=>function(p,b,M,h){w.k(g,b.resting),p.Wc&&o.loadFromCopy(b);if(b.tm<=0)return w.set(b.Sz,0,0,0),w.set(b._forces,0,0,0),void w.set(b._impulses,0,0,0);var Q=h||0===b.Jw;if(function(p,b,M,h){if(b._sleepFrameCount>0)return!1;if(h)return!0;var Q=!1,mp=.5*M*M*b.Jw;return w.scale(W,p.gravity,mp),t(p.testSolid,b.Az,W,(function(){return Q=!0,!0}),!0),Q}(p,b,M,Q))return;b._sleepFrameCount--,function(p,b){var M=b.Az,h=Math.floor(M.base[0]),Q=Math.floor(M.base[2]),mp=Math.floor(M.base[1]),y=Math.floor(M.max[1]);if(!p.testFluid(h,mp,Q))return b.inFluid=!1,void(b.ratioInFluid=0);var P=1,t=mp+1;for(;t<=y&&p.testFluid(h,t,Q);)P++,t++;var z=(mp+P-M.base[1])/M.Jx[1];z>1&&(z=1);var x=M.Jx[0]*M.Jx[1]*M.Jx[2]*z,S=u;w.scale(S,p.gravity,-p.lw*x*b.Jw),b.applyForce(S),b.inFluid=!0,b.ratioInFluid=z}(p,b),j(b._forces),j(b._impulses),j(b.Sz),j(b.resting),w.scale(S,b._forces,1/b.tm),w.Hw(S,S,p.gravity,b.Jw),w.scale(X,b._impulses,1/b.tm),w.Hw(X,X,S,M),w.add(b.Sz,b.Sz,X),b.friction&&(e(p,0,b,X,M),e(p,1,b,X,M),e(p,2,b,X,M));var mp=b.fluidDrag>=0?b.fluidDrag:p.fluidDrag,y=b.Xx>=0?b.Xx:p.Xx,P=y,z=y;b.inFluid&&(P=l(b,P,b.fluidDragHoriz>=0?b.fluidDragHoriz:mp),z=l(b,z,b.fluidDragVert>=0?b.fluidDragVert:mp));P=Math.max(1-P*M/b.tm,0),z=Math.max(1-z*M/b.tm,0),w.set(L,P,z,P),w.multiply(b.Sz,b.Sz,L),w.scale(c,b.Sz,M),w.set(b._forces,0,0,0),w.set(b._impulses,0,0,0),b.gw&&E(G,b.Az);w.k(f,c),w.set(Y,0,0,0),b.preventFallOffEdge&&function(p,b,M,h){if(!b.resting[1]||M[1]>0)return;var Q=s;E(Q,b.Az);for(var mp=0;mp<3;mp+=2){w.set(B,0,0,0),B[mp]=M[mp];var y=!0;(y=(y=(y=(y=y&&!T(p,Q.base[0]+B[0]+1e-5,Q.base[1],Q.base[2]+B[2]+1e-5))&&!T(p,Q.max[0]+B[0]-1e-5,Q.base[1],Q.base[2]+B[2]+1e-5))&&!T(p,Q.base[0]+B[0]+1e-5,Q.base[1],Q.max[2]+B[2]-1e-5))&&!T(p,Q.max[0]+B[0]-1e-5,Q.base[1],Q.max[2]+B[2]-1e-5))?(h[mp]=M[mp]>0?1:-1,M[mp]=0):0===mp&&(w.set(i,M[0],0,0),I(p,Q,i,h,b.slideOnCollision))}}(p,b,c,Y);I(p,b.Az,c,b.resting,b.slideOnCollision),b.gw&&function(p,b,M,h){if(b.resting[1]>=0&&!b.inFluid)return;var Q=0!==b.resting[0],mp=0!==b.resting[2];if(!Q&&!mp)return;var y=Math.abs(h[0]/h[2]),P=4;if(!Q&&y>P)return;if(!mp&&y<1/P)return;w.add(Z,M.base,h);var z=p.testSolid;t(z,M,h,(function(p,b,M,h){if(1!==b)return!0;h[b]=0}));var x=M.base[1],S=b.inFluid?1.951:1.001,X=Math.floor(x+S)-x;w.set(U,0,X,0);var c=!1;if(t(z,M,U,(function(p,b,M,h){return c=!0,!0})),c)return;w.mh(q,Z,M.base),q[1]=0,I(p,M,q,v,!0);var J=H(M.base[0],Z[0]),g=H(M.base[2],Z[2]);if(Q&&!J&&(!g||!mp))return;if(mp&&(!J||!Q)&&!g)return;var f=!0;if(f=f&&!T(p,M.base[0]+1e-5,M.base[1],M.base[2]+1e-5),f=f&&!T(p,M.max[0]-1e-5,M.base[1],M.base[2]+1e-5),f=f&&!T(p,M.base[0]+1e-5,M.base[1],M.max[2]-1e-5),f=f&&!T(p,M.max[0]-1e-5,M.base[1],M.max[2]-1e-5),f)return;E(b.Az,M),b.resting[0]=v[0],b.resting[2]=v[2],b.gg&&b.gg()}(p,b,G,f);for(var x=0;x<3;++x)b.resting[x]=b.resting[x]||Y[x],J[x]=0,b.resting[x]&&(g[x]||(J[x]=-b.Sz[x]),b.Sz[x]=0);var a=w.length(J);a>.001&&(w.scale(J,J,b.tm),b.IJ&&b.IJ(J),b.restitution>0&&a>p.minBounceImpulse&&(w.scale(J,J,b.restitution),b.applyImpulse(J)));var d=w.squaredLength(b.Sz);d>1e-5&&b.Xz();p.Wc&&p.Wc(b)?(b.loadFromCopy(o),b.rolledBackLastTick=!0):b.rolledBackLastTick=!1}(this,M,p,b)))};var L=w.create([0,0,0]);var u=w.create();function e(p,b,M,h,Q){var mp=M.resting[b],y=h[b];if(!M.alwaysApplyHorizFriction||1!==b){if(0===mp)return;if(mp*y<=0)return}w.k(d,M.Sz),d[b]=0;var P=w.length(d);if(!H(P,0)){var t=Math.abs(M.friction*p.gravity[b]*Q),z=P>t?(P-t)/P:0;M.Sz[(b+1)%3]*=z,M.Sz[(b+2)%3]*=z}}var d=w.create();function I(p,b,M,h,Q){return w.set(h,0,0,0),t(p.testSolid,b,M,(function(p,b,M,mp){h[b]=M,mp[b]=0,Q||(mp[0]=0,mp[1]=0,mp[2]=0)}))}var G=new P([],[]),v=w.create(),Z=w.create(),U=w.create(),q=w.create();var B=w.create(),s=new P([],[]),i=w.create();function T(p,b,M,h){return p.testSolid(Math.floor(b),Math.floor(M-1),Math.floor(h))}var W=w.create();function H(p,b){return Math.abs(p-b)<1e-5}function E(p,b){for(var M=0;M<3;M++)p.base[M]=b.base[M],p.max[M]=b.max[M],p.Jx[M]=b.Jx[M]}var j=function(p){}},13447:function(p,b){!function(p){"use strict";var b=function(p,M){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,b){p.__proto__=b}||function(p,b){for(var M in b)Object.prototype.hasOwnProperty.call(b,M)&&(p[M]=b[M])},b(p,M)};function M(p,M){if("function"!==typeof M&&null!==M)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function h(){this.constructor=p}b(p,M),p.prototype=null===M?Object.create(M):(h.prototype=M.prototype,new h)}function h(p,b,M,h){var Q,mp=arguments.length,y=mp<3?b:null===h?h=Object.getOwnPropertyDescriptor(b,M):h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)y=Reflect.decorate(p,b,M,h);else for(var P=p.length-1;P>=0;P--)(Q=p[P])&&(y=(mp<3?Q(y):mp>3?Q(b,M,y):Q(b,M))||y);return mp>3&&y&&Object.defineProperty(b,M,y),y}function Q(p,b,M){if(M||2===arguments.length)for(var h,Q=0,mp=b.length;Q<mp;Q++)!h&&Q in b||(h||(h=Array.prototype.slice.call(b,0,Q)),h[Q]=b[Q]);return p.concat(h||Array.prototype.slice.call(b))}var mp,y=255,P=213;p.OPERATION=void 0,(mp=p.OPERATION||(p.OPERATION={}))[mp.ADD=128]="ADD",mp[mp.REPLACE=0]="REPLACE",mp[mp.DELETE=64]="DELETE",mp[mp.DELETE_AND_ADD=192]="DELETE_AND_ADD",mp[mp.TOUCH=1]="TOUCH",mp[mp.CLEAR=10]="CLEAR";var w=function(){function b(p,b,M){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=p,this.setParent(b,M)}return b.prototype.setParent=function(p,b,M){var h=this;if(this.indexes||(this.indexes=this.ref instanceof qp?this.ref._definition.indexes:{}),this.parent=p,this.parentIndex=M,b)if(this.root=b,this.ref instanceof qp){var Q=this.ref._definition;for(var mp in Q.schema){var y=this.ref[mp];if(y&&y.$changes){var P=Q.indexes[mp];y.$changes.setParent(this.ref,b,P)}}}else"object"===typeof this.ref&&this.ref.forEach((function(p,b){if(p instanceof qp){var M=p.$changes,Q=h.ref.$changes.indexes[b];M.setParent(h.ref,h.root,Q)}}))},b.prototype.operation=function(p){this.changes.set(--this.currentCustomOperation,p)},b.prototype.change=function(b,M){void 0===M&&(M=p.OPERATION.ADD);var h="number"===typeof b?b:this.indexes[b];this.assertValidIndex(h,b);var Q=this.changes.get(h);Q&&Q.op!==p.OPERATION.DELETE&&Q.op!==p.OPERATION.TOUCH||this.changes.set(h,{op:Q&&Q.op===p.OPERATION.DELETE?p.OPERATION.DELETE_AND_ADD:M,index:h}),this.allChanges.add(h),this.changed=!0,this.touchParents()},b.prototype.touch=function(b){var M="number"===typeof b?b:this.indexes[b];this.assertValidIndex(M,b),this.changes.has(M)||this.changes.set(M,{op:p.OPERATION.TOUCH,index:M}),this.allChanges.add(M),this.touchParents()},b.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},b.prototype.getType=function(p){if(this.ref._definition)return(b=this.ref._definition).schema[b.fieldsByIndex[p]];var b,M=(b=this.parent._definition).schema[b.fieldsByIndex[this.parentIndex]];return Object.values(M)[0]},b.prototype.getChildrenFilter=function(){var p=this.parent._definition.childFilters;return p&&p[this.parentIndex]},b.prototype.getValue=function(p){return this.ref.getByIndex(p)},b.prototype.delete=function(b){var M="number"===typeof b?b:this.indexes[b];if(void 0!==M){var h=this.getValue(M);this.changes.set(M,{op:p.OPERATION.DELETE,index:M}),this.allChanges.delete(M),delete this.caches[M],h&&h.$changes&&(h.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(b," (").concat(M,")"))},b.prototype.discard=function(b,M){var h=this;void 0===b&&(b=!1),void 0===M&&(M=!1),this.ref instanceof qp||this.changes.forEach((function(b){if(b.op===p.OPERATION.DELETE){var M=h.ref.getIndex(b.index);delete h.indexes[M]}})),this.changes.clear(),this.changed=b,M&&this.allChanges.clear(),this.currentCustomOperation=0},b.prototype.discardAll=function(){var p=this;this.changes.forEach((function(b){var M=p.getValue(b.index);M&&M.$changes&&M.$changes.discardAll()})),this.discard()},b.prototype.cache=function(p,b){this.caches[p]=b},b.prototype.clone=function(){return new b(this.ref,this.parent,this.root)},b.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},b.prototype.assertValidIndex=function(p,b){if(void 0===p)throw new Error('ChangeTree: missing index for field "'.concat(b,'"'))},b}();function t(p,b,M,h){return p[b]||(p[b]=[]),p[b].push(M),null===h||void 0===h||h.forEach((function(p,b){return M(p,b)})),function(){return x(p[b],p[b].indexOf(M))}}function z(b){var M=this,h="string"!==typeof this.$changes.getType();this.$items.forEach((function(Q,mp){b.push({refId:M.$changes.refId,op:p.OPERATION.DELETE,field:mp,value:void 0,previousValue:Q}),h&&M.$changes.root.removeRef(Q.$changes.refId)}))}function x(p,b){if(-1===b||b>=p.length)return!1;for(var M=p.length-1,h=b;h<M;h++)p[h]=p[h+1];return p.length=M,!0}var S=function(p,b){var M=p.toString(),h=b.toString();return M<h?-1:M>h?1:0};function X(p){return p.$proxy=!0,p=new Proxy(p,{get:function(p,b){return"symbol"===typeof b||isNaN(b)?p[b]:p.at(b)},set:function(p,b,M){if("symbol"===typeof b||isNaN(b))p[b]=M;else{var h=Array.from(p.$items.keys()),Q=parseInt(h[b]||b);void 0===M||null===M?p.deleteAt(Q):p.setAt(Q,M)}return!0},deleteProperty:function(p,b){return"number"===typeof b?p.deleteAt(b):delete p[b],!0}})}var c=function(){function b(){for(var p=[],b=0;b<arguments.length;b++)p[b]=arguments[b];this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,p)}return b.prototype.QQ=function(b,M){return void 0===M&&(M=!0),t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.ADD,b,M?this.$items:void 0)},b.prototype.yb=function(b){return t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.REPLACE,b)},b.is=function(p){return Array.isArray(p)||void 0!==p.array},Object.defineProperty(b.prototype,"length",{get:function(){return this.$items.size},set:function(p){0===p?this.clear():this.splice(p,this.length-p)},enumerable:!1,configurable:!0}),b.prototype.push=function(){for(var p,b=this,M=[],h=0;h<arguments.length;h++)M[h]=arguments[h];return M.forEach((function(M){p=b.$refId++,b.setAt(p,M)})),p},b.prototype.pop=function(){var p=Array.from(this.$indexes.values()).pop();if(void 0!==p){this.$changes.delete(p),this.$indexes.delete(p);var b=this.$items.get(p);return this.$items.delete(p),b}},b.prototype.at=function(p){var b=Array.from(this.$items.keys())[p];return this.$items.get(b)},b.prototype.setAt=function(b,M){var h,Q;if(void 0!==M&&null!==M){if(this.$items.get(b)!==M){void 0!==M.$changes&&M.$changes.setParent(this,this.$changes.root,b);var mp=null!==(Q=null===(h=this.$changes.indexes[b])||void 0===h?void 0:h.op)&&void 0!==Q?Q:p.OPERATION.ADD;this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,M),this.$changes.change(b,mp)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},b.prototype.deleteAt=function(p){var b=Array.from(this.$items.keys())[p];return void 0!==b&&this.$deleteAt(b)},b.prototype.$deleteAt=function(p){return this.$changes.delete(p),this.$indexes.delete(p),this.$items.delete(p)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&z.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:p.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.concat=function(){for(var p,M=[],h=0;h<arguments.length;h++)M[h]=arguments[h];return new(b.bind.apply(b,Q([void 0],(p=Array.from(this.$items.values())).concat.apply(p,M),!1)))},b.prototype.join=function(p){return Array.from(this.$items.values()).join(p)},b.prototype.reverse=function(){var p=this,b=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(M,h){p.setAt(b[h],M)})),this},b.prototype.shift=function(){var p=Array.from(this.$items.keys()).shift();if(void 0!==p){var b=this.$items.get(p);return this.$deleteAt(p),b}},b.prototype.slice=function(p,M){var h=new b;return h.push.apply(h,Array.from(this.$items.values()).slice(p,M)),h},b.prototype.sort=function(p){var b=this;void 0===p&&(p=S);var M=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(p).forEach((function(p,h){b.setAt(M[h],p)})),this},b.prototype.splice=function(p,b){void 0===b&&(b=this.length-p);for(var M=Array.from(this.$items.keys()),h=[],Q=p;Q<p+b;Q++)h.push(this.$items.get(M[Q])),this.$deleteAt(M[Q]);return h},b.prototype.unshift=function(){for(var p=this,b=[],M=0;M<arguments.length;M++)b[M]=arguments[M];var h=this.length,Q=b.length,mp=Array.from(this.$items.values());return b.forEach((function(b,M){p.setAt(M,b)})),mp.forEach((function(b,M){p.setAt(Q+M,b)})),h+Q},b.prototype.indexOf=function(p,b){return Array.from(this.$items.values()).indexOf(p,b)},b.prototype.lastIndexOf=function(p,b){return void 0===b&&(b=this.length-1),Array.from(this.$items.values()).lastIndexOf(p,b)},b.prototype.every=function(p,b){return Array.from(this.$items.values()).every(p,b)},b.prototype.some=function(p,b){return Array.from(this.$items.values()).some(p,b)},b.prototype.forEach=function(p,b){Array.from(this.$items.values()).forEach(p,b)},b.prototype.map=function(p,b){return Array.from(this.$items.values()).map(p,b)},b.prototype.filter=function(p,b){return Array.from(this.$items.values()).filter(p,b)},b.prototype.reduce=function(p,b){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},b.prototype.reduceRight=function(p,b){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},b.prototype.find=function(p,b){return Array.from(this.$items.values()).find(p,b)},b.prototype.findIndex=function(p,b){return Array.from(this.$items.values()).findIndex(p,b)},b.prototype.fill=function(p,b,M){throw new Error("ArraySchema#fill() not implemented")},b.prototype.copyWithin=function(p,b,M){throw new Error("ArraySchema#copyWithin() not implemented")},b.prototype.toString=function(){return this.$items.toString()},b.prototype.toLocaleString=function(){return this.$items.toLocaleString()},b.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},b.prototype.includes=function(p,b){return Array.from(this.$items.values()).includes(p,b)},b.prototype.flatMap=function(p,b){throw new Error("ArraySchema#flatMap() is not supported.")},b.prototype.flat=function(p){throw new Error("ArraySchema#flat() is not supported.")},b.prototype.findLast=function(){var p=Array.from(this.$items.values());return p.findLast.apply(p,arguments)},b.prototype.findLastIndex=function(){var p=Array.from(this.$items.values());return p.findLastIndex.apply(p,arguments)},b.prototype.setIndex=function(p,b){this.$indexes.set(p,b)},b.prototype.getIndex=function(p){return this.$indexes.get(p)},b.prototype.getByIndex=function(p){return this.$items.get(this.$indexes.get(p))},b.prototype.deleteByIndex=function(p){var b=this.$indexes.get(p);this.$items.delete(b),this.$indexes.delete(p)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){return this.toArray().map((function(p){return"function"===typeof p.toJSON?p.toJSON():p}))},b.prototype.clone=function(p){return p?new(b.bind.apply(b,Q([void 0],Array.from(this.$items.values()),!1))):new(b.bind.apply(b,Q([void 0],this.map((function(p){return p.$changes?p.clone():p})),!1)))},b}();function J(p){return p.$proxy=!0,p=new Proxy(p,{get:function(p,b){return"symbol"!==typeof b&&"undefined"===typeof p[b]?p.get(b):p[b]},set:function(p,b,M){return"symbol"!==typeof b&&-1===b.indexOf("$")&&"QQ"!==b&&"yb"!==b&&"onChange"!==b?p.set(b,M):p[b]=M,!0},deleteProperty:function(p,b){return p.delete(b),!0}})}var g=function(){function b(p){var M=this;if(this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,p)if(p instanceof Map||p instanceof b)p.forEach((function(p,b){return M.set(b,p)}));else for(var h in p)this.set(h,p[h])}return b.prototype.QQ=function(b,M){return void 0===M&&(M=!0),t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.ADD,b,M?this.$items:void 0)},b.prototype.yb=function(b){return t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.REPLACE,b)},b.is=function(p){return void 0!==p.map},b.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(b.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.set=function(b,M){if(void 0===M||null===M)throw new Error("MapSchema#set('".concat(b,"', ").concat(M,"): trying to set ").concat(M," value on '").concat(b,"'."));b=b.toString();var h="undefined"!==typeof this.$changes.indexes[b],Q=h?this.$changes.indexes[b]:this.$refId++,mp=h?p.OPERATION.REPLACE:p.OPERATION.ADD,y=void 0!==M.$changes;if(y&&M.$changes.setParent(this,this.$changes.root,Q),h){if(!y&&this.$items.get(b)===M)return;y&&this.$items.get(b)!==M&&(mp=p.OPERATION.ADD)}else this.$changes.indexes[b]=Q,this.$indexes.set(Q,b);return this.$items.set(b,M),this.$changes.change(b,mp),this},b.prototype.get=function(p){return this.$items.get(p)},b.prototype.delete=function(p){return this.$changes.delete(p),this.$items.delete(p)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&z.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:p.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(p){return this.$items.has(p)},b.prototype.forEach=function(p){this.$items.forEach(p)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(p,b){this.$indexes.set(p,b)},b.prototype.getIndex=function(p){return this.$indexes.get(p)},b.prototype.getByIndex=function(p){return this.$items.get(this.$indexes.get(p))},b.prototype.deleteByIndex=function(p){var b=this.$indexes.get(p);this.$items.delete(b),this.$indexes.delete(p)},b.prototype.toJSON=function(){var p={};return this.forEach((function(b,M){p[M]="function"===typeof b.toJSON?b.toJSON():b})),p},b.prototype.clone=function(p){var M;return p?M=Object.assign(new b,this):(M=new b,this.forEach((function(p,b){p.$changes?M.set(b,p.clone()):M.set(b,p)}))),M},b}(),f={};function Y(p,b){f[p]=b}function a(p){return f[p]}var o=function(){function p(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return p.create=function(b){var M=new p;return M.schema=Object.assign({},b&&b.schema||{}),M.indexes=Object.assign({},b&&b.indexes||{}),M.fieldsByIndex=Object.assign({},b&&b.fieldsByIndex||{}),M.descriptors=Object.assign({},b&&b.descriptors||{}),M.deprecated=Object.assign({},b&&b.deprecated||{}),M},p.prototype.addField=function(p,b){var M=this.getNextFieldIndex();this.fieldsByIndex[M]=p,this.indexes[p]=M,this.schema[p]=Array.isArray(b)?{array:b[0]}:b},p.prototype.hasField=function(p){return void 0!==this.indexes[p]},p.prototype.addFilter=function(p,b){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[p]]=b,this.indexesWithFilters.push(this.indexes[p]),!0},p.prototype.addChildrenFilter=function(p,b){var M=this.indexes[p],h=this.schema[p];if(a(Object.keys(h)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[M]=b,!0;console.warn("@filterChildren: field '".concat(p,"' can't have children. Ignoring filter."))},p.prototype.getChildrenFilter=function(p){return this.childFilters&&this.childFilters[this.indexes[p]]},p.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},p}();function l(p){return p._context&&p._context.useFilters}var L=function(){function p(){this.types={},this.schemas=new Map,this.useFilters=!1}return p.prototype.has=function(p){return this.schemas.has(p)},p.prototype.get=function(p){return this.types[p]},p.prototype.add=function(p,b){void 0===b&&(b=this.schemas.size),p._definition=o.create(p._definition),p._typeid=b,this.types[b]=p,this.schemas.set(p,b)},p.create=function(b){return void 0===b&&(b={}),function(M){return b.context||(b.context=new p),e(M,b)}},p}(),u=new L;function e(p,b){return void 0===b&&(b={}),function(M,h){var mp=b.context||u,y=M.constructor;if(y._context=mp,!p)throw new Error("".concat(y.name,': @type() reference provided for "').concat(h,"\" is undefined. Make sure you don't have any circular dependencies."));mp.has(y)||mp.add(y);var P=y._definition;if(P.addField(h,p),P.descriptors[h]){if(P.deprecated[h])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(h,"' definition on '").concat(y.name,"'.\nCheck @type() annotation"))}catch(f){var w=f.stack.split("\n")[4].trim();throw new Error("".concat(f.message," ").concat(w))}}var t=c.is(p),z=!t&&g.is(p);if("string"!==typeof p&&!qp.is(p)){var x=Object.values(p)[0];"string"===typeof x||mp.has(x)||mp.add(x)}if(b.manual)P.descriptors[h]={enumerable:!0,configurable:!0,writable:!0};else{var S="_".concat(h);P.descriptors[S]={enumerable:!1,configurable:!1,writable:!0},P.descriptors[h]={get:function(){return this[S]},set:function(p){p!==this[S]&&(void 0!==p&&null!==p?(!t||p instanceof c||(p=new(c.bind.apply(c,Q([void 0],p,!1)))),!z||p instanceof g||(p=new g(p)),void 0===p.$proxy&&(z?p=J(p):t&&(p=X(p))),this.$changes.change(h),p.$changes&&p.$changes.setParent(this,this.$changes.root,this._definition.indexes[h])):this[S]&&this.$changes.delete(h),this[S]=p)},enumerable:!0,configurable:!0}}}}function d(p){return function(b,M){var h=b.constructor;h._definition.addFilter(M,p)&&(h._context.useFilters=!0)}}function I(p){return function(b,M){var h=b.constructor;h._definition.addChildrenFilter(M,p)&&(h._context.useFilters=!0)}}function G(p){return void 0===p&&(p=!0),function(b,M){var h=b.constructor._definition;h.deprecated[M]=!0,p&&(h.descriptors[M]={get:function(){throw new Error("".concat(M," is deprecated."))},set:function(p){},enumerable:!1,configurable:!0})}}function v(p,b,M){for(var h in void 0===M&&(M={}),M.context||(M.context=p._context||M.context||u),b)e(b[h],M)(p.prototype,h);return p}function Z(p){for(var b=0,M=0,h=0,Q=p.length;h<Q;h++)(b=p.charCodeAt(h))<128?M+=1:b<2048?M+=2:b<55296||b>=57344?M+=3:(h++,M+=4);return M}function U(p,b,M){for(var h=0,Q=0,mp=M.length;Q<mp;Q++)(h=M.charCodeAt(Q))<128?p[b++]=h:h<2048?(p[b++]=192|h>>6,p[b++]=128|63&h):h<55296||h>=57344?(p[b++]=224|h>>12,p[b++]=128|h>>6&63,p[b++]=128|63&h):(Q++,h=65536+((1023&h)<<10|1023&M.charCodeAt(Q)),p[b++]=240|h>>18,p[b++]=128|h>>12&63,p[b++]=128|h>>6&63,p[b++]=128|63&h)}function q(p,b){p.push(255&b)}function B(p,b){p.push(255&b)}function s(p,b){p.push(255&b),p.push(b>>8&255)}function i(p,b){p.push(255&b),p.push(b>>8&255)}function T(p,b){p.push(255&b),p.push(b>>8&255),p.push(b>>16&255),p.push(b>>24&255)}function W(p,b){var M=b>>24,h=b>>16,Q=b>>8,mp=b;p.push(255&mp),p.push(255&Q),p.push(255&h),p.push(255&M)}function H(p,b){var M=Math.floor(b/Math.pow(2,32));W(p,b>>>0),W(p,M)}function E(p,b){var M=b/Math.pow(2,32)|0;W(p,b>>>0),W(p,M)}function j(p,b){R(p,b)}function V(p,b){K(p,b)}var D=new Int32Array(2),N=new Float32Array(D.buffer),O=new Float64Array(D.buffer);function R(p,b){N[0]=b,T(p,D[0])}function K(p,b){O[0]=b,T(p,D[0]),T(p,D[1])}function r(p,b){return B(p,b?1:0)}function k(p,b){b||(b="");var M=Z(b),h=0;if(M<32)p.push(160|M),h=1;else if(M<256)p.push(217),B(p,M),h=2;else if(M<65536)p.push(218),i(p,M),h=3;else{if(!(M<4294967296))throw new Error("String too long");p.push(219),W(p,M),h=5}return U(p,p.length,b),h+M}function A(p,b){return isNaN(b)?A(p,0):isFinite(b)?b!==(0|b)?(p.push(203),K(p,b),9):b>=0?b<128?(B(p,b),1):b<256?(p.push(204),B(p,b),2):b<65536?(p.push(205),i(p,b),3):b<4294967296?(p.push(206),W(p,b),5):(p.push(207),E(p,b),9):b>=-32?(p.push(224|b+32),1):b>=-128?(p.push(208),q(p,b),2):b>=-32768?(p.push(209),s(p,b),3):b>=-2147483648?(p.push(210),T(p,b),5):(p.push(211),H(p,b),9):A(p,b>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var n=Object.freeze({__proto__:null,utf8Write:U,int8:q,uint8:B,int16:s,uint16:i,int32:T,uint32:W,int64:H,uint64:E,float32:j,float64:V,writeFloat32:R,writeFloat64:K,boolean:r,string:k,number:A});function C(p,b,M){for(var h="",Q=0,mp=b,y=b+M;mp<y;mp++){var P=p[mp];0!==(128&P)?192!==(224&P)?224!==(240&P)?240!==(248&P)?console.error("Invalid byte "+P.toString(16)):(Q=(7&P)<<18|(63&p[++mp])<<12|(63&p[++mp])<<6|63&p[++mp])>=65536?(Q-=65536,h+=String.fromCharCode(55296+(Q>>>10),56320+(1023&Q))):h+=String.fromCharCode(Q):h+=String.fromCharCode((15&P)<<12|(63&p[++mp])<<6|63&p[++mp]):h+=String.fromCharCode((31&P)<<6|63&p[++mp]):h+=String.fromCharCode(P)}return h}function F(p,b){return pp(p,b)<<24>>24}function pp(p,b){return p[b.offset++]}function bp(p,b){return Mp(p,b)<<16>>16}function Mp(p,b){return p[b.offset++]|p[b.offset++]<<8}function hp(p,b){return p[b.offset++]|p[b.offset++]<<8|p[b.offset++]<<16|p[b.offset++]<<24}function Qp(p,b){return hp(p,b)>>>0}function mb(p,b){return Sp(p,b)}function yp(p,b){return Xp(p,b)}function Pp(p,b){var M=Qp(p,b);return hp(p,b)*Math.pow(2,32)+M}function wp(p,b){var M=Qp(p,b);return Qp(p,b)*Math.pow(2,32)+M}var tp=new Int32Array(2),zp=new Float32Array(tp.buffer),xp=new Float64Array(tp.buffer);function Sp(p,b){return tp[0]=hp(p,b),zp[0]}function Xp(p,b){return tp[0]=hp(p,b),tp[1]=hp(p,b),xp[0]}function cp(p,b){return pp(p,b)>0}function Jp(p,b){var M,h=p[b.offset++];h<192?M=31&h:217===h?M=pp(p,b):218===h?M=Mp(p,b):219===h&&(M=Qp(p,b));var Q=C(p,b.offset,M);return b.offset+=M,Q}function gp(p,b){var M=p[b.offset];return M<192&&M>160||217===M||218===M||219===M}function fp(p,b){var M=p[b.offset++];return M<128?M:202===M?Sp(p,b):203===M?Xp(p,b):204===M?pp(p,b):205===M?Mp(p,b):206===M?Qp(p,b):207===M?wp(p,b):208===M?F(p,b):209===M?bp(p,b):210===M?hp(p,b):211===M?Pp(p,b):M>223?-1*(255-M+1):void 0}function Yp(p,b){var M=p[b.offset];return M<128||M>=202&&M<=211}function ap(p,b){return p[b.offset]<160}function op(p,b){return p[b.offset-1]===y&&(p[b.offset]<128||p[b.offset]>=202&&p[b.offset]<=211)}var lp=Object.freeze({__proto__:null,int8:F,uint8:pp,int16:bp,uint16:Mp,int32:hp,uint32:Qp,float32:mb,float64:yp,int64:Pp,uint64:wp,readFloat32:Sp,readFloat64:Xp,boolean:cp,string:Jp,stringCheck:gp,number:fp,numberCheck:Yp,arrayCheck:ap,switchStructureCheck:op}),Lp=function(){function b(p){var b=this;this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,p&&p.forEach((function(p){return b.add(p)}))}return b.prototype.QQ=function(b,M){return void 0===M&&(M=!0),t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.ADD,b,M?this.$items:void 0)},b.prototype.yb=function(b){return t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.REPLACE,b)},b.is=function(p){return void 0!==p.collection},b.prototype.add=function(p){var b=this.$refId++;return void 0!==p.$changes&&p.$changes.setParent(this,this.$changes.root,b),this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,p),this.$changes.change(b),b},b.prototype.at=function(p){var b=Array.from(this.$items.keys())[p];return this.$items.get(b)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(p){for(var b,M,h=this.$items.entries();(M=h.next())&&!M.done;)if(p===M.value[1]){b=M.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&z.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:p.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(p){return Array.from(this.$items.values()).some((function(b){return b===p}))},b.prototype.forEach=function(p){var b=this;this.$items.forEach((function(M,h,Q){return p(M,h,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(p,b){this.$indexes.set(p,b)},b.prototype.getIndex=function(p){return this.$indexes.get(p)},b.prototype.getByIndex=function(p){return this.$items.get(this.$indexes.get(p))},b.prototype.deleteByIndex=function(p){var b=this.$indexes.get(p);this.$items.delete(b),this.$indexes.delete(p)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var p=[];return this.forEach((function(b,M){p.push("function"===typeof b.toJSON?b.toJSON():b)})),p},b.prototype.clone=function(p){var M;return p?M=Object.assign(new b,this):(M=new b,this.forEach((function(p){p.$changes?M.add(p.clone()):M.add(p)}))),M},b}(),upp=function(){function b(p){var b=this;this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,p&&p.forEach((function(p){return b.add(p)}))}return b.prototype.QQ=function(b,M){return void 0===M&&(M=!0),t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.ADD,b,M?this.$items:void 0)},b.prototype.yb=function(b){return t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.REPLACE,b)},b.is=function(p){return void 0!==p.set},b.prototype.add=function(b){var M,h;if(this.has(b))return!1;var Q=this.$refId++;void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,Q);var mp=null!==(h=null===(M=this.$changes.indexes[Q])||void 0===M?void 0:M.op)&&void 0!==h?h:p.OPERATION.ADD;return this.$changes.indexes[Q]=Q,this.$indexes.set(Q,Q),this.$items.set(Q,b),this.$changes.change(Q,mp),Q},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(p){for(var b,M,h=this.$items.entries();(M=h.next())&&!M.done;)if(p===M.value[1]){b=M.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&z.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:p.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(p){for(var b,M=this.$items.values(),h=!1;(b=M.next())&&!b.done;)if(p===b.value){h=!0;break}return h},b.prototype.forEach=function(p){var b=this;this.$items.forEach((function(M,h,Q){return p(M,h,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(p,b){this.$indexes.set(p,b)},b.prototype.getIndex=function(p){return this.$indexes.get(p)},b.prototype.getByIndex=function(p){return this.$items.get(this.$indexes.get(p))},b.prototype.deleteByIndex=function(p){var b=this.$indexes.get(p);this.$items.delete(b),this.$indexes.delete(p)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var p=[];return this.forEach((function(b,M){p.push("function"===typeof b.toJSON?b.toJSON():b)})),p},b.prototype.clone=function(p){var M;return p?M=Object.assign(new b,this):(M=new b,this.forEach((function(p){p.$changes?M.add(p.clone()):M.add(p)}))),M},b}(),ep=function(){function p(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return p.prototype.addRefId=function(p){this.refIds.has(p)||(this.refIds.add(p),this.containerIndexes.set(p,new Set))},p.get=function(b){return void 0===b.$filterState&&(b.$filterState=new p),b.$filterState},p}(),dp=function(){function p(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return p.prototype.getNextUniqueId=function(){return this.nextUniqueId++},p.prototype.addRef=function(p,b,M){void 0===M&&(M=!0),this.refs.set(p,b),M&&(this.refCounts[p]=(this.refCounts[p]||0)+1)},p.prototype.removeRef=function(p){this.refCounts[p]=this.refCounts[p]-1,this.deletedRefs.add(p)},p.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},p.prototype.garbageCollectDeletedRefs=function(){var p=this;this.deletedRefs.forEach((function(b){if(!(p.refCounts[b]>0)){var M=p.refs.get(b);if(M instanceof qp)for(var h in M._definition.schema)"string"!==typeof M._definition.schema[h]&&M[h]&&M[h].$changes&&p.removeRef(M[h].$changes.refId);else{var Q=M.$changes.parent._definition,mp=Q.schema[Q.fieldsByIndex[M.$changes.parentIndex]];"function"===typeof Object.values(mp)[0]&&Array.from(M.values()).forEach((function(b){return p.removeRef(b.$changes.refId)}))}p.refs.delete(b),delete p.refCounts[b]}})),this.deletedRefs.clear()},p}(),Ip=function(p){function b(){return null!==p&&p.apply(this,arguments)||this}return M(b,p),b}(Error);function Gp(p,b,M,h){var Q,mp=!1;switch(b){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":Q="number",isNaN(p)&&console.log('trying to encode "NaN" in '.concat(M.constructor.name,"#").concat(h));break;case"string":Q="string",mp=!0;break;case"boolean":return}if(typeof p!==Q&&(!mp||mp&&null!==p)){var y="'".concat(JSON.stringify(p),"'").concat(p&&p.constructor&&" (".concat(p.constructor.name,")")||"");throw new Ip("a '".concat(Q,"' was expected, but ").concat(y," was provided in ").concat(M.constructor.name,"#").concat(h))}}function vp(p,b,M,h){if(!(p instanceof b))throw new Ip("a '".concat(b.name,"' was expected, but '").concat(p.constructor.name,"' was provided in ").concat(M.constructor.name,"#").concat(h))}function Zp(p,b,M,h,Q){Gp(M,p,h,Q);var mp=n[p];if(!mp)throw new Ip("a '".concat(p,"' was expected, but ").concat(M," was provided in ").concat(h.constructor.name,"#").concat(Q));mp(b,M)}function Up(p,b,M){return lp[p](b,M)}var qp=function(){function b(){for(var p=[],b=0;b<arguments.length;b++)p[b]=arguments[b];Object.defineProperties(this,{$changes:{value:new w(this,void 0,new dp),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var M=this._definition.descriptors;M&&Object.defineProperties(this,M),p[0]&&this.assign(p[0])}return b.onError=function(p){console.error(p)},b.is=function(p){return p._definition&&void 0!==p._definition.schema},b.prototype.onChange=function(b){return t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.REPLACE,b)},b.prototype.yb=function(b){return t(this.$callbacks||(this.$callbacks=[]),p.OPERATION.DELETE,b)},b.prototype.assign=function(p){return Object.assign(this,p),this},Object.defineProperty(b.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),b.prototype.setDirty=function(p,b){this.$changes.change(p,b)},b.prototype.listen=function(p,b,M){var h=this;return void 0===M&&(M=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[p]||(this.$callbacks[p]=[]),this.$callbacks[p].push(b),M&&void 0!==this[p]&&b(this[p],void 0),function(){return x(h.$callbacks[p],h.$callbacks[p].indexOf(b))}},b.prototype.decode=function(M,h,Q){var mp;void 0===h&&(h={offset:0}),void 0===Q&&(Q=this);var P=[],w=this.$changes.root,t=M.length,z=0;for(w.refs.set(z,this);h.offset<t;){var x=M[h.offset++];if(x!=y){var S=Q.$changes,X=void 0!==Q._definition,J=X?x>>6<<6:x;if(J!==p.OPERATION.CLEAR){var f=X?x%(J||255):fp(M,h),Y=X?Q._definition.fieldsByIndex[f]:"",o=S.getType(f),l=void 0,L=void 0,u=void 0;if(X?L=Q["_".concat(Y)]:(L=Q.getByIndex(f),(J&p.OPERATION.ADD)===p.OPERATION.ADD?(u=Q instanceof g?Jp(M,h):f,Q.setIndex(f,u)):u=Q.getIndex(f)),(J&p.OPERATION.DELETE)===p.OPERATION.DELETE&&(J!==p.OPERATION.DELETE_AND_ADD&&Q.deleteByIndex(f),L&&L.$changes&&w.removeRef(L.$changes.refId),l=null),void 0!==Y){if(J===p.OPERATION.DELETE);else if(b.is(o)){var e=fp(M,h);if(l=w.refs.get(e),J!==p.OPERATION.REPLACE){var d=this.getSchemaType(M,h,o);l||((l=this.createTypeInstance(d)).$changes.refId=e,L&&(l.$callbacks=L.$callbacks,L.$changes.refId&&e!==L.$changes.refId&&w.removeRef(L.$changes.refId))),w.addRef(e,l,l!==L)}}else if("string"===typeof o)l=Up(o,M,h);else{var I=a(Object.keys(o)[0]),G=fp(M,h),v=w.refs.has(G)?L||w.refs.get(G):new I.constructor;if((l=v.clone(!0)).$changes.refId=G,L&&(l.$callbacks=L.$callbacks,L.$changes.refId&&G!==L.$changes.refId)){w.removeRef(L.$changes.refId);for(var Z=L.entries(),U=void 0;(U=Z.next())&&!U.done;){var q=(mp=U.value)[0],B=mp[1];P.push({refId:G,op:p.OPERATION.DELETE,field:q,value:void 0,previousValue:B})}}w.addRef(G,l,v!==L)}if(null!==l&&void 0!==l)if(l.$changes&&l.$changes.setParent(S.ref,S.root,f),Q instanceof b)Q[Y]=l;else if(Q instanceof g)q=u,Q.$items.set(q,l),Q.$changes.allChanges.add(f);else if(Q instanceof c)Q.setAt(f,l);else if(Q instanceof Lp){var s=Q.add(l);Q.setIndex(f,s)}else Q instanceof upp&&!1!==(s=Q.add(l))&&Q.setIndex(f,s);L!==l&&P.push({refId:z,op:J,field:Y,dynamicIndex:u,value:l,previousValue:L})}else{console.warn("@colyseus/schema: definition mismatch");for(var i={offset:h.offset};h.offset<t&&(!op(M,h)||(i.offset=h.offset+1,!w.refs.has(fp(M,i))));)h.offset++}}else Q.clear(P)}else{z=fp(M,h);var T=w.refs.get(z);if(!T)throw new Error('"refId" not found: '.concat(z));Q=T}}return this._triggerChanges(P),w.garbageCollectDeletedRefs(),P},b.prototype.encode=function(M,h,Q){void 0===M&&(M=!1),void 0===h&&(h=[]),void 0===Q&&(Q=!1);for(var mp=this.$changes,P=new WeakSet,w=[mp],t=1,z=0;z<t;z++){var x=w[z],S=x.ref,X=S instanceof b;x.ensureRefId(),P.add(x),x!==mp&&(x.changed||M)&&(B(h,y),A(h,x.refId));for(var c=M?Array.from(x.allChanges):Array.from(x.changes.values()),J=0,f=c.length;J<f;J++){var Y=M?{op:p.OPERATION.ADD,index:c[J]}:c[J],o=Y.index,l=X?S._definition.fieldsByIndex&&S._definition.fieldsByIndex[o]:o,L=h.length;if(Y.op!==p.OPERATION.TOUCH)if(X)B(h,o|Y.op);else{if(B(h,Y.op),Y.op===p.OPERATION.CLEAR)continue;A(h,o)}if(X||(Y.op&p.OPERATION.ADD)!=p.OPERATION.ADD||S instanceof g&&k(h,x.ref.$indexes.get(o)),Y.op!==p.OPERATION.DELETE){var u=x.getType(o),e=x.getValue(o);if(e&&e.$changes&&!P.has(e.$changes)&&(w.push(e.$changes),e.$changes.ensureRefId(),t++),Y.op!==p.OPERATION.TOUCH){if(b.is(u))vp(e,u,S,l),A(h,e.$changes.refId),(Y.op&p.OPERATION.ADD)===p.OPERATION.ADD&&this.tryEncodeTypeId(h,u,e.constructor);else if("string"===typeof u)Zp(u,h,e,S,l);else{var d=a(Object.keys(u)[0]);vp(S["_".concat(l)],d.constructor,S,l),A(h,e.$changes.refId)}Q&&x.cache(o,h.slice(L))}}}M||Q||x.discard()}return h},b.prototype.encodeAll=function(p){return this.encode(!0,[],p)},b.prototype.applyFilters=function(M,h){var Q,mp;void 0===h&&(h=!1);for(var P=this,w=new Set,t=ep.get(M),z=[this.$changes],x=1,S=[],X=function(X){var c=z[X];if(w.has(c.refId))return"continue";var J=c.ref,f=J instanceof b;B(S,y),A(S,c.refId);var Y=t.refIds.has(c),a=h||!Y;t.addRefId(c);var o=t.containerIndexes.get(c),l=a?Array.from(c.allChanges):Array.from(c.changes.values());!h&&f&&J._definition.indexesWithFilters&&J._definition.indexesWithFilters.forEach((function(b){!o.has(b)&&c.allChanges.has(b)&&(a?l.push(b):l.push({op:p.OPERATION.ADD,index:b}))}));for(var L=0,u=l.length;L<u;L++){var e=a?{op:p.OPERATION.ADD,index:l[L]}:l[L];if(e.op!==p.OPERATION.CLEAR){var d=e.index;if(e.op!==p.OPERATION.DELETE){var I=c.getValue(d),G=c.getType(d);if(f){if((v=J._definition.filters&&J._definition.filters[d])&&!v.call(J,M,I,P)){I&&I.$changes&&w.add(I.$changes.refId);continue}}else{var v,Z=c.parent;if((v=c.getChildrenFilter())&&!v.call(Z,M,J.$indexes.get(d),I,P)){I&&I.$changes&&w.add(I.$changes.refId);continue}}if(I.$changes&&(z.push(I.$changes),x++),e.op!==p.OPERATION.TOUCH)if(e.op===p.OPERATION.ADD||f)S.push.apply(S,null!==(Q=c.caches[d])&&void 0!==Q?Q:[]),o.add(d);else if(o.has(d))S.push.apply(S,null!==(mp=c.caches[d])&&void 0!==mp?mp:[]);else{if(o.add(d),B(S,p.OPERATION.ADD),A(S,d),J instanceof g){var U=c.ref.$indexes.get(d);k(S,U)}I.$changes?A(S,I.$changes.refId):n[G](S,I)}else I.$changes&&!f&&(B(S,p.OPERATION.ADD),A(S,d),J instanceof g&&(U=c.ref.$indexes.get(d),k(S,U)),A(S,I.$changes.refId))}else f?B(S,e.op|d):(B(S,e.op),A(S,d))}else B(S,e.op)}},c=0;c<x;c++)X(c);return S},b.prototype.clone=function(){var p,b=new this.constructor,M=this._definition.schema;for(var h in M)"object"===typeof this[h]&&"function"===typeof(null===(p=this[h])||void 0===p?void 0:p.clone)?b[h]=this[h].clone():b[h]=this[h];return b},b.prototype.toJSON=function(){var p=this._definition.schema,b=this._definition.deprecated,M={};for(var h in p)b[h]||null===this[h]||"undefined"===typeof this[h]||(M[h]="function"===typeof this[h].toJSON?this[h].toJSON():this["_".concat(h)]);return M},b.prototype.discardAllChanges=function(){this.$changes.discardAll()},b.prototype.getByIndex=function(p){return this[this._definition.fieldsByIndex[p]]},b.prototype.deleteByIndex=function(p){this[this._definition.fieldsByIndex[p]]=void 0},b.prototype.tryEncodeTypeId=function(p,b,M){b._typeid!==M._typeid&&(B(p,P),A(p,M._typeid))},b.prototype.getSchemaType=function(p,b,M){var h;return p[b.offset]===P&&(b.offset++,h=this.constructor._context.get(fp(p,b))),h||M},b.prototype.createTypeInstance=function(p){var b=new p;return b.$changes.root=this.$changes.root,b},b.prototype._triggerChanges=function(M){for(var h,Q,mp,y,P,w,t,z,x,S=new Set,X=this.$changes.root.refs,c=function(c){var J=M[c],g=J.refId,f=X.get(g),Y=f.$callbacks;if((J.op&p.OPERATION.DELETE)===p.OPERATION.DELETE&&J.previousValue instanceof b&&(null===(Q=null===(h=J.previousValue.$callbacks)||void 0===h?void 0:h[p.OPERATION.DELETE])||void 0===Q||Q.forEach((function(p){return p()}))),!Y)return"continue";if(f instanceof b){if(!S.has(g))try{null===(mp=null===Y||void 0===Y?void 0:Y[p.OPERATION.REPLACE])||void 0===mp||mp.forEach((function(p){return p()}))}catch(a){b.onError(a)}try{Y.hasOwnProperty(J.field)&&(null===(y=Y[J.field])||void 0===y||y.forEach((function(p){return p(J.value,J.previousValue)})))}catch(a){b.onError(a)}}else J.op===p.OPERATION.ADD&&void 0===J.previousValue?null===(P=Y[p.OPERATION.ADD])||void 0===P||P.forEach((function(p){var b;return p(J.value,null!==(b=J.dynamicIndex)&&void 0!==b?b:J.field)})):J.op===p.OPERATION.DELETE?void 0!==J.previousValue&&(null===(w=Y[p.OPERATION.DELETE])||void 0===w||w.forEach((function(p){var b;return p(J.previousValue,null!==(b=J.dynamicIndex)&&void 0!==b?b:J.field)}))):J.op===p.OPERATION.DELETE_AND_ADD&&(void 0!==J.previousValue&&(null===(t=Y[p.OPERATION.DELETE])||void 0===t||t.forEach((function(p){var b;return p(J.previousValue,null!==(b=J.dynamicIndex)&&void 0!==b?b:J.field)}))),null===(z=Y[p.OPERATION.ADD])||void 0===z||z.forEach((function(p){var b;return p(J.value,null!==(b=J.dynamicIndex)&&void 0!==b?b:J.field)}))),J.value!==J.previousValue&&(null===(x=Y[p.OPERATION.REPLACE])||void 0===x||x.forEach((function(p){var b;return p(J.value,null!==(b=J.dynamicIndex)&&void 0!==b?b:J.field)})));S.add(g)},J=0;J<M.length;J++)c(J)},b._definition=o.create(),b}();function Bp(p){for(var b=[p.$changes],M=1,h={},Q=h,mp=function(p){var M=b[p];M.changes.forEach((function(p){var b=M.ref,h=p.index,mp=b._definition?b._definition.fieldsByIndex[h]:b.$indexes.get(h);Q[mp]=M.getValue(h)}))},y=0;y<M;y++)mp(y);return h}var sp={context:new L},ip=function(p){function b(){return null!==p&&p.apply(this,arguments)||this}return M(b,p),h([e("string",sp)],b.prototype,"name",void 0),h([e("string",sp)],b.prototype,"type",void 0),h([e("number",sp)],b.prototype,"referencedType",void 0),b}(qp),Tp=function(p){function b(){var b=null!==p&&p.apply(this,arguments)||this;return b.fields=new c,b}return M(b,p),h([e("number",sp)],b.prototype,"id",void 0),h([e([ip],sp)],b.prototype,"fields",void 0),b}(qp),Wp=function(p){function b(){var b=null!==p&&p.apply(this,arguments)||this;return b.types=new c,b}return M(b,p),b.encode=function(p){var M=p.constructor,h=new b;h.rootType=M._typeid;var Q=function(p,b){for(var M in b){var Q=new ip;Q.name=M;var mp=void 0;if("string"===typeof b[M])mp=b[M];else{var y=b[M],P=void 0;qp.is(y)?(mp="ref",P=b[M]):"string"===typeof y[mp=Object.keys(y)[0]]?mp+=":"+y[mp]:P=y[mp],Q.referencedType=P?P._typeid:-1}Q.type=mp,p.fields.push(Q)}h.types.push(p)},mp=M._context.types;for(var y in mp){var P=new Tp;P.id=Number(y),Q(P,mp[y]._definition.schema)}return h.encodeAll()},b.decode=function(p,h){var Q=new L,mp=new b;mp.decode(p,h);var y=mp.types.reduce((function(p,b){var h=function(p){function b(){return null!==p&&p.apply(this,arguments)||this}return M(b,p),b}(qp),mp=b.id;return p[mp]=h,Q.add(h,mp),p}),{});mp.types.forEach((function(p){var b=y[p.id];p.fields.forEach((function(p){var M;if(void 0!==p.referencedType){var h=p.type,mp=y[p.referencedType];if(!mp){var P=p.type.split(":");h=P[0],mp=P[1]}"ref"===h?e(mp,{context:Q})(b.prototype,p.name):e(((M={})[h]=mp,M),{context:Q})(b.prototype,p.name)}else e(p.type,{context:Q})(b.prototype,p.name)}))}));var P=y[mp.rootType],w=new P;for(var t in P._definition.schema){var z=P._definition.schema[t];"string"!==typeof z&&(w[t]="function"===typeof z?new z:new(a(Object.keys(z)[0]).constructor))}return w},h([e([Tp],sp)],b.prototype,"types",void 0),h([e("number",sp)],b.prototype,"rootType",void 0),b}(qp);Y("map",{constructor:g}),Y("array",{constructor:c}),Y("set",{constructor:upp}),Y("collection",{constructor:Lp}),p.ArraySchema=c,p.CollectionSchema=Lp,p.Context=L,p.MapSchema=g,p.Reflection=Wp,p.ReflectionField=ip,p.ReflectionType=Tp,p.Schema=qp,p.SchemaDefinition=o,p.SetSchema=upp,p.decode=lp,p.defineTypes=v,p.deprecated=G,p.dumpChanges=Bp,p.encode=n,p.filter=d,p.filterChildren=I,p.hasFilter=l,p.registerType=Y,p.type=e,Object.defineProperty(p,"__esModule",{value:!0})}(b)},14893:p=>{"use strict";p.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14890:(p,b,M)=>{var h=M(14893),Q=M(14900),mp=Object.hasOwnProperty,y=Object.create(null);for(var P in h)mp.call(h,P)&&(y[h[P]]=P);var w=p.exports={to:{},get:{}};function t(p,b,M){return Math.min(Math.max(b,p),M)}function z(p){var b=Math.round(p).toString(16).toUpperCase();return b.length<2?"0"+b:b}w.get=function(p){var b,M;switch(p.substring(0,3).toLowerCase()){case"hsl":b=w.get.hsl(p),M="hsl";break;case"hwb":b=w.get.hwb(p),M="hwb";break;default:b=w.get.rgb(p),M="rgb"}return b?{model:M,value:b}:null},w.get.rgb=function(p){if(!p)return null;var b,M,Q,y=[0,0,0,1];if(b=p.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(Q=b[2],b=b[1],M=0;M<3;M++){var P=2*M;y[M]=parseInt(b.slice(P,P+2),16)}Q&&(y[3]=parseInt(Q,16)/255)}else if(b=p.match(/^#([a-f0-9]{3,4})$/i)){for(Q=(b=b[1])[3],M=0;M<3;M++)y[M]=parseInt(b[M]+b[M],16);Q&&(y[3]=parseInt(Q+Q,16)/255)}else if(b=p.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(M=0;M<3;M++)y[M]=parseInt(b[M+1],0);b[4]&&(b[5]?y[3]=.01*parseFloat(b[4]):y[3]=parseFloat(b[4]))}else{if(!(b=p.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(b=p.match(/^(\w+)$/))?"transparent"===b[1]?[0,0,0,0]:mp.call(h,b[1])?((y=h[b[1]])[3]=1,y):null:null;for(M=0;M<3;M++)y[M]=Math.round(2.55*parseFloat(b[M+1]));b[4]&&(b[5]?y[3]=.01*parseFloat(b[4]):y[3]=parseFloat(b[4]))}for(M=0;M<3;M++)y[M]=t(y[M],0,255);return y[3]=t(y[3],0,1),y},w.get.hsl=function(p){if(!p)return null;var b=p.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var M=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,t(parseFloat(b[2]),0,100),t(parseFloat(b[3]),0,100),t(isNaN(M)?1:M,0,1)]}return null},w.get.hwb=function(p){if(!p)return null;var b=p.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var M=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,t(parseFloat(b[2]),0,100),t(parseFloat(b[3]),0,100),t(isNaN(M)?1:M,0,1)]}return null},w.to.hex=function(){var p=Q(arguments);return"#"+z(p[0])+z(p[1])+z(p[2])+(p[3]<1?z(Math.round(255*p[3])):"")},w.to.rgb=function(){var p=Q(arguments);return p.length<4||1===p[3]?"rgb("+Math.round(p[0])+", "+Math.round(p[1])+", "+Math.round(p[2])+")":"rgba("+Math.round(p[0])+", "+Math.round(p[1])+", "+Math.round(p[2])+", "+p[3]+")"},w.to.rgb.percent=function(){var p=Q(arguments),b=Math.round(p[0]/255*100),M=Math.round(p[1]/255*100),h=Math.round(p[2]/255*100);return p.length<4||1===p[3]?"rgb("+b+"%, "+M+"%, "+h+"%)":"rgba("+b+"%, "+M+"%, "+h+"%, "+p[3]+")"},w.to.hsl=function(){var p=Q(arguments);return p.length<4||1===p[3]?"hsl("+p[0]+", "+p[1]+"%, "+p[2]+"%)":"hsla("+p[0]+", "+p[1]+"%, "+p[2]+"%, "+p[3]+")"},w.to.hwb=function(){var p=Q(arguments),b="";return p.length>=4&&1!==p[3]&&(b=", "+p[3]),"hwb("+p[0]+", "+p[1]+"%, "+p[2]+"%"+b+")"},w.to.keyword=function(p){return y[p.slice(0,3)]}},14884:(p,b,M)=>{const h=M(14890),Q=M(14905),mp=["keyword","gray","hex"],y={};for(const X of Object.keys(Q))y[[...Q[X].labels].sort().join("")]=X;const P={};function w(p,b){if(!(this instanceof w))return new w(p,b);if(b&&b in mp&&(b=null),b&&!(b in Q))throw new Error("Unknown model: "+b);let M,t;if(null==p)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(p instanceof w)this.model=p.model,this.color=[...p.color],this.valpha=p.valpha;else if("string"===typeof p){const b=h.get(p);if(null===b)throw new Error("Unable to parse color from string: "+p);this.model=b.model,t=Q[this.model].channels,this.color=b.value.slice(0,t),this.valpha="number"===typeof b.value[t]?b.value[t]:1}else if(p.length>0){this.model=b||"rgb",t=Q[this.model].channels;const M=Array.prototype.slice.call(p,0,t);this.color=S(M,t),this.valpha="number"===typeof p[t]?p[t]:1}else if("number"===typeof p)this.model="rgb",this.color=[p>>16&255,p>>8&255,255&p],this.valpha=1;else{this.valpha=1;const b=Object.keys(p);"alpha"in p&&(b.splice(b.indexOf("alpha"),1),this.valpha="number"===typeof p.alpha?p.alpha:0);const h=b.sort().join("");if(!(h in y))throw new Error("Unable to parse color from object: "+JSON.stringify(p));this.model=y[h];const{labels:mp}=Q[this.model],P=[];for(M=0;M<mp.length;M++)P.push(p[mp[M]]);this.color=S(P)}if(P[this.model])for(t=Q[this.model].channels,M=0;M<t;M++){const p=P[this.model][M];p&&(this.color[M]=p(this.color[M]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}w.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(p){let b=this.model in h.to?this:this.rgb();b=b.round("number"===typeof p?p:1);const M=1===b.valpha?b.color:[...b.color,this.valpha];return h.to[b.model](M)},percentString(p){const b=this.rgb().round("number"===typeof p?p:1),M=1===b.valpha?b.color:[...b.color,this.valpha];return h.to.rgb.percent(M)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const p={},{channels:b}=Q[this.model],{labels:M}=Q[this.model];for(let h=0;h<b;h++)p[M[h]]=this.color[h];return 1!==this.valpha&&(p.alpha=this.valpha),p},unitArray(){const p=this.rgb().color;return p[0]/=255,p[1]/=255,p[2]/=255,1!==this.valpha&&p.push(this.valpha),p},unitObject(){const p=this.rgb().object();return p.r/=255,p.g/=255,p.b/=255,1!==this.valpha&&(p.alpha=this.valpha),p},round(p){return p=Math.max(p||0,0),new w([...this.color.map(t(p)),this.valpha],this.model)},alpha(p){return void 0!==p?new w([...this.color,Math.max(0,Math.min(1,p))],this.model):this.valpha},red:z("rgb",0,x(255)),green:z("rgb",1,x(255)),blue:z("rgb",2,x(255)),hue:z(["hsl","hsv","hsl","hwb","hcg"],0,(p=>(p%360+360)%360)),saturationl:z("hsl",1,x(100)),lightness:z("hsl",2,x(100)),saturationv:z("hsv",1,x(100)),value:z("hsv",2,x(100)),chroma:z("hcg",1,x(100)),gray:z("hcg",2,x(100)),white:z("hwb",1,x(100)),wblack:z("hwb",2,x(100)),cyan:z("cmyk",0,x(100)),magenta:z("cmyk",1,x(100)),yellow:z("cmyk",2,x(100)),black:z("cmyk",3,x(100)),x:z("xyz",0,x(95.047)),y:z("xyz",1,x(100)),z:z("xyz",2,x(108.833)),l:z("lab",0,x(100)),a:z("lab",1),b:z("lab",2),keyword(p){return void 0!==p?new w(p):Q[this.model].keyword(this.color)},hex(p){return void 0!==p?new w(p):h.to.hex(this.rgb().round().color)},hexa(p){if(void 0!==p)return new w(p);const b=this.rgb().round().color;let M=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===M.length&&(M="0"+M),h.to.hex(b)+M},rgbNumber(){const p=this.rgb().color;return(255&p[0])<<16|(255&p[1])<<8|255&p[2]},luminosity(){const p=this.rgb().color,b=[];for(const[M,h]of p.entries()){const p=h/255;b[M]=p<=.04045?p/12.92:((p+.055)/1.055)**2.4}return.2126*b[0]+.7152*b[1]+.0722*b[2]},contrast(p){const b=this.luminosity(),M=p.luminosity();return b>M?(b+.05)/(M+.05):(M+.05)/(b+.05)},level(p){const b=this.contrast(p);return b>=7?"AAA":b>=4.5?"AA":""},isDark(){const p=this.rgb().color;return(2126*p[0]+7152*p[1]+722*p[2])/1e4<128},isLight(){return!this.isDark()},negate(){const p=this.rgb();for(let b=0;b<3;b++)p.color[b]=255-p.color[b];return p},lighten(p){const b=this.hsl();return b.color[2]+=b.color[2]*p,b},darken(p){const b=this.hsl();return b.color[2]-=b.color[2]*p,b},saturate(p){const b=this.hsl();return b.color[1]+=b.color[1]*p,b},desaturate(p){const b=this.hsl();return b.color[1]-=b.color[1]*p,b},whiten(p){const b=this.hwb();return b.color[1]+=b.color[1]*p,b},blacken(p){const b=this.hwb();return b.color[2]+=b.color[2]*p,b},grayscale(){const p=this.rgb().color,b=.3*p[0]+.59*p[1]+.11*p[2];return w.rgb(b,b,b)},fade(p){return this.alpha(this.valpha-this.valpha*p)},opaquer(p){return this.alpha(this.valpha+this.valpha*p)},rotate(p){const b=this.hsl();let M=b.color[0];return M=(M+p)%360,M=M<0?360+M:M,b.color[0]=M,b},mix(p,b){if(!p||!p.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof p);const M=p.rgb(),h=this.rgb(),Q=void 0===b?.5:b,mp=2*Q-1,y=M.alpha()-h.alpha(),P=((mp*y===-1?mp:(mp+y)/(1+mp*y))+1)/2,t=1-P;return w.rgb(P*M.red()+t*h.red(),P*M.green()+t*h.green(),P*M.blue()+t*h.blue(),M.alpha()*Q+h.alpha()*(1-Q))}};for(const X of Object.keys(Q)){if(mp.includes(X))continue;const{channels:p}=Q[X];w.prototype[X]=function(){if(this.model===X)return new w(this);for(var p=arguments.length,b=new Array(p),M=0;M<p;M++)b[M]=arguments[M];return b.length>0?new w(b,X):new w([...(h=Q[this.model][X].raw(this.color),Array.isArray(h)?h:[h]),this.valpha],X);var h},w[X]=function(){for(var b=arguments.length,M=new Array(b),h=0;h<b;h++)M[h]=arguments[h];let Q=M[0];return"number"===typeof Q&&(Q=S(M,p)),new w(Q,X)}}function t(p){return function(b){return function(p,b){return Number(p.toFixed(b))}(b,p)}}function z(p,b,M){p=Array.isArray(p)?p:[p];for(const h of p)(P[h]||(P[h]=[]))[b]=M;return p=p[0],function(h){let Q;return void 0!==h?(M&&(h=M(h)),Q=this[p](),Q.color[b]=h,Q):(Q=this[p]().color[b],M&&(Q=M(Q)),Q)}}function x(p){return function(b){return Math.max(0,Math.min(p,b))}}function S(p,b){for(let M=0;M<b;M++)"number"!==typeof p[M]&&(p[M]=0);return p}p.exports=w},14910:(p,b,M)=>{const h=M(14918),Q={};for(const y of Object.keys(h))Q[h[y]]=y;const mp={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};p.exports=mp;for(const y of Object.keys(mp)){if(!("channels"in mp[y]))throw new Error("missing channels property: "+y);if(!("labels"in mp[y]))throw new Error("missing channel labels property: "+y);if(mp[y].labels.length!==mp[y].channels)throw new Error("channel and label counts mismatch: "+y);const{channels:p,labels:b}=mp[y];delete mp[y].channels,delete mp[y].labels,Object.defineProperty(mp[y],"channels",{value:p}),Object.defineProperty(mp[y],"labels",{value:b})}mp.rgb.hsl=function(p){const b=p[0]/255,M=p[1]/255,h=p[2]/255,Q=Math.min(b,M,h),mp=Math.max(b,M,h),y=mp-Q;let P,w;mp===Q?P=0:b===mp?P=(M-h)/y:M===mp?P=2+(h-b)/y:h===mp&&(P=4+(b-M)/y),P=Math.min(60*P,360),P<0&&(P+=360);const t=(Q+mp)/2;return w=mp===Q?0:t<=.5?y/(mp+Q):y/(2-mp-Q),[P,100*w,100*t]},mp.rgb.hsv=function(p){let b,M,h,Q,mp;const y=p[0]/255,P=p[1]/255,w=p[2]/255,t=Math.max(y,P,w),z=t-Math.min(y,P,w),x=function(p){return(t-p)/6/z+.5};return 0===z?(Q=0,mp=0):(mp=z/t,b=x(y),M=x(P),h=x(w),y===t?Q=h-M:P===t?Q=1/3+b-h:w===t&&(Q=2/3+M-b),Q<0?Q+=1:Q>1&&(Q-=1)),[360*Q,100*mp,100*t]},mp.rgb.hwb=function(p){const b=p[0],M=p[1];let h=p[2];const Q=mp.rgb.hsl(p)[0],y=1/255*Math.min(b,Math.min(M,h));return h=1-1/255*Math.max(b,Math.max(M,h)),[Q,100*y,100*h]},mp.rgb.cmyk=function(p){const b=p[0]/255,M=p[1]/255,h=p[2]/255,Q=Math.min(1-b,1-M,1-h);return[100*((1-b-Q)/(1-Q)||0),100*((1-M-Q)/(1-Q)||0),100*((1-h-Q)/(1-Q)||0),100*Q]},mp.rgb.keyword=function(p){const b=Q[p];if(b)return b;let M,mp=1/0;for(const Q of Object.keys(h)){const b=h[Q],w=(P=b,((y=p)[0]-P[0])**2+(y[1]-P[1])**2+(y[2]-P[2])**2);w<mp&&(mp=w,M=Q)}var y,P;return M},mp.keyword.rgb=function(p){return h[p]},mp.rgb.xyz=function(p){let b=p[0]/255,M=p[1]/255,h=p[2]/255;b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,M=M>.04045?((M+.055)/1.055)**2.4:M/12.92,h=h>.04045?((h+.055)/1.055)**2.4:h/12.92;return[100*(.4124*b+.3576*M+.1805*h),100*(.2126*b+.7152*M+.0722*h),100*(.0193*b+.1192*M+.9505*h)]},mp.rgb.lab=function(p){const b=mp.rgb.xyz(p);let M=b[0],h=b[1],Q=b[2];M/=95.047,h/=100,Q/=108.883,M=M>.008856?M**(1/3):7.787*M+16/116,h=h>.008856?h**(1/3):7.787*h+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116;return[116*h-16,500*(M-h),200*(h-Q)]},mp.hsl.rgb=function(p){const b=p[0]/360,M=p[1]/100,h=p[2]/100;let Q,mp,y;if(0===M)return y=255*h,[y,y,y];Q=h<.5?h*(1+M):h+M-h*M;const P=2*h-Q,w=[0,0,0];for(let t=0;t<3;t++)mp=b+1/3*-(t-1),mp<0&&mp++,mp>1&&mp--,y=6*mp<1?P+6*(Q-P)*mp:2*mp<1?Q:3*mp<2?P+(Q-P)*(2/3-mp)*6:P,w[t]=255*y;return w},mp.hsl.hsv=function(p){const b=p[0];let M=p[1]/100,h=p[2]/100,Q=M;const mp=Math.max(h,.01);h*=2,M*=h<=1?h:2-h,Q*=mp<=1?mp:2-mp;return[b,100*(0===h?2*Q/(mp+Q):2*M/(h+M)),100*((h+M)/2)]},mp.hsv.rgb=function(p){const b=p[0]/60,M=p[1]/100;let h=p[2]/100;const Q=Math.floor(b)%6,mp=b-Math.floor(b),y=255*h*(1-M),P=255*h*(1-M*mp),w=255*h*(1-M*(1-mp));switch(h*=255,Q){case 0:return[h,w,y];case 1:return[P,h,y];case 2:return[y,h,w];case 3:return[y,P,h];case 4:return[w,y,h];case 5:return[h,y,P]}},mp.hsv.hsl=function(p){const b=p[0],M=p[1]/100,h=p[2]/100,Q=Math.max(h,.01);let mp,y;y=(2-M)*h;const P=(2-M)*Q;return mp=M*Q,mp/=P<=1?P:2-P,mp=mp||0,y/=2,[b,100*mp,100*y]},mp.hwb.rgb=function(p){const b=p[0]/360;let M=p[1]/100,h=p[2]/100;const Q=M+h;let mp;Q>1&&(M/=Q,h/=Q);const y=Math.floor(6*b),P=1-h;mp=6*b-y,0!==(1&y)&&(mp=1-mp);const w=M+mp*(P-M);let t,z,x;switch(y){default:case 6:case 0:t=P,z=w,x=M;break;case 1:t=w,z=P,x=M;break;case 2:t=M,z=P,x=w;break;case 3:t=M,z=w,x=P;break;case 4:t=w,z=M,x=P;break;case 5:t=P,z=M,x=w}return[255*t,255*z,255*x]},mp.cmyk.rgb=function(p){const b=p[0]/100,M=p[1]/100,h=p[2]/100,Q=p[3]/100;return[255*(1-Math.min(1,b*(1-Q)+Q)),255*(1-Math.min(1,M*(1-Q)+Q)),255*(1-Math.min(1,h*(1-Q)+Q))]},mp.xyz.rgb=function(p){const b=p[0]/100,M=p[1]/100,h=p[2]/100;let Q,mp,y;return Q=3.2406*b+-1.5372*M+-.4986*h,mp=-.9689*b+1.8758*M+.0415*h,y=.0557*b+-.204*M+1.057*h,Q=Q>.0031308?1.055*Q**(1/2.4)-.055:12.92*Q,mp=mp>.0031308?1.055*mp**(1/2.4)-.055:12.92*mp,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,Q=Math.min(Math.max(0,Q),1),mp=Math.min(Math.max(0,mp),1),y=Math.min(Math.max(0,y),1),[255*Q,255*mp,255*y]},mp.xyz.lab=function(p){let b=p[0],M=p[1],h=p[2];b/=95.047,M/=100,h/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,M=M>.008856?M**(1/3):7.787*M+16/116,h=h>.008856?h**(1/3):7.787*h+16/116;return[116*M-16,500*(b-M),200*(M-h)]},mp.lab.xyz=function(p){let b,M,h;M=(p[0]+16)/116,b=p[1]/500+M,h=M-p[2]/200;const Q=M**3,mp=b**3,y=h**3;return M=Q>.008856?Q:(M-16/116)/7.787,b=mp>.008856?mp:(b-16/116)/7.787,h=y>.008856?y:(h-16/116)/7.787,b*=95.047,M*=100,h*=108.883,[b,M,h]},mp.lab.lch=function(p){const b=p[0],M=p[1],h=p[2];let Q;Q=360*Math.atan2(h,M)/2/Math.PI,Q<0&&(Q+=360);return[b,Math.sqrt(M*M+h*h),Q]},mp.lch.lab=function(p){const b=p[0],M=p[1],h=p[2]/360*2*Math.PI;return[b,M*Math.cos(h),M*Math.sin(h)]},mp.rgb.ansi16=function(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[M,h,Q]=p;let y=null===b?mp.rgb.hsv(p)[2]:b;if(y=Math.round(y/50),0===y)return 30;let P=30+(Math.round(Q/255)<<2|Math.round(h/255)<<1|Math.round(M/255));return 2===y&&(P+=60),P},mp.hsv.ansi16=function(p){return mp.rgb.ansi16(mp.hsv.rgb(p),p[2])},mp.rgb.ansi256=function(p){const b=p[0],M=p[1],h=p[2];if(b===M&&M===h)return b<8?16:b>248?231:Math.round((b-8)/247*24)+232;return 16+36*Math.round(b/255*5)+6*Math.round(M/255*5)+Math.round(h/255*5)},mp.ansi16.rgb=function(p){let b=p%10;if(0===b||7===b)return p>50&&(b+=3.5),b=b/10.5*255,[b,b,b];const M=.5*(1+~~(p>50));return[(1&b)*M*255,(b>>1&1)*M*255,(b>>2&1)*M*255]},mp.ansi256.rgb=function(p){if(p>=232){const b=10*(p-232)+8;return[b,b,b]}let b;p-=16;return[Math.floor(p/36)/5*255,Math.floor((b=p%36)/6)/5*255,b%6/5*255]},mp.rgb.hex=function(p){const b=(((255&Math.round(p[0]))<<16)+((255&Math.round(p[1]))<<8)+(255&Math.round(p[2]))).toString(16).toUpperCase();return"000000".substring(b.length)+b},mp.hex.rgb=function(p){const b=p.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!b)return[0,0,0];let M=b[0];3===b[0].length&&(M=M.split("").map((p=>p+p)).join(""));const h=parseInt(M,16);return[h>>16&255,h>>8&255,255&h]},mp.rgb.hcg=function(p){const b=p[0]/255,M=p[1]/255,h=p[2]/255,Q=Math.max(Math.max(b,M),h),mp=Math.min(Math.min(b,M),h),y=Q-mp;let P,w;return P=y<1?mp/(1-y):0,w=y<=0?0:Q===b?(M-h)/y%6:Q===M?2+(h-b)/y:4+(b-M)/y,w/=6,w%=1,[360*w,100*y,100*P]},mp.hsl.hcg=function(p){const b=p[1]/100,M=p[2]/100,h=M<.5?2*b*M:2*b*(1-M);let Q=0;return h<1&&(Q=(M-.5*h)/(1-h)),[p[0],100*h,100*Q]},mp.hsv.hcg=function(p){const b=p[1]/100,M=p[2]/100,h=b*M;let Q=0;return h<1&&(Q=(M-h)/(1-h)),[p[0],100*h,100*Q]},mp.hcg.rgb=function(p){const b=p[0]/360,M=p[1]/100,h=p[2]/100;if(0===M)return[255*h,255*h,255*h];const Q=[0,0,0],mp=b%1*6,y=mp%1,P=1-y;let w=0;switch(Math.floor(mp)){case 0:Q[0]=1,Q[1]=y,Q[2]=0;break;case 1:Q[0]=P,Q[1]=1,Q[2]=0;break;case 2:Q[0]=0,Q[1]=1,Q[2]=y;break;case 3:Q[0]=0,Q[1]=P,Q[2]=1;break;case 4:Q[0]=y,Q[1]=0,Q[2]=1;break;default:Q[0]=1,Q[1]=0,Q[2]=P}return w=(1-M)*h,[255*(M*Q[0]+w),255*(M*Q[1]+w),255*(M*Q[2]+w)]},mp.hcg.hsv=function(p){const b=p[1]/100,M=b+p[2]/100*(1-b);let h=0;return M>0&&(h=b/M),[p[0],100*h,100*M]},mp.hcg.hsl=function(p){const b=p[1]/100,M=p[2]/100*(1-b)+.5*b;let h=0;return M>0&&M<.5?h=b/(2*M):M>=.5&&M<1&&(h=b/(2*(1-M))),[p[0],100*h,100*M]},mp.hcg.hwb=function(p){const b=p[1]/100,M=b+p[2]/100*(1-b);return[p[0],100*(M-b),100*(1-M)]},mp.hwb.hcg=function(p){const b=p[1]/100,M=1-p[2]/100,h=M-b;let Q=0;return h<1&&(Q=(M-h)/(1-h)),[p[0],100*h,100*Q]},mp.apple.rgb=function(p){return[p[0]/65535*255,p[1]/65535*255,p[2]/65535*255]},mp.rgb.apple=function(p){return[p[0]/255*65535,p[1]/255*65535,p[2]/255*65535]},mp.gray.rgb=function(p){return[p[0]/100*255,p[0]/100*255,p[0]/100*255]},mp.gray.hsl=function(p){return[0,0,p[0]]},mp.gray.hsv=mp.gray.hsl,mp.gray.hwb=function(p){return[0,100,p[0]]},mp.gray.cmyk=function(p){return[0,0,0,p[0]]},mp.gray.lab=function(p){return[p[0],0,0]},mp.gray.hex=function(p){const b=255&Math.round(p[0]/100*255),M=((b<<16)+(b<<8)+b).toString(16).toUpperCase();return"000000".substring(M.length)+M},mp.rgb.gray=function(p){return[(p[0]+p[1]+p[2])/3/255*100]}},14905:(p,b,M)=>{const h=M(14910),Q=M(14924),mp={};Object.keys(h).forEach((p=>{mp[p]={},Object.defineProperty(mp[p],"channels",{value:h[p].channels}),Object.defineProperty(mp[p],"labels",{value:h[p].labels});const b=Q(p);Object.keys(b).forEach((M=>{const h=b[M];mp[p][M]=function(p){const b=function(){for(var b=arguments.length,M=new Array(b),h=0;h<b;h++)M[h]=arguments[h];const Q=M[0];if(void 0===Q||null===Q)return Q;Q.length>1&&(M=Q);const mp=p(M);if("object"===typeof mp)for(let p=mp.length,y=0;y<p;y++)mp[y]=Math.round(mp[y]);return mp};return"conversion"in p&&(b.conversion=p.conversion),b}(h),mp[p][M].raw=function(p){const b=function(){for(var b=arguments.length,M=new Array(b),h=0;h<b;h++)M[h]=arguments[h];const Q=M[0];return void 0===Q||null===Q?Q:(Q.length>1&&(M=Q),p(M))};return"conversion"in p&&(b.conversion=p.conversion),b}(h)}))})),p.exports=mp},14924:(p,b,M)=>{const h=M(14910);function Q(p){const b=function(){const p={},b=Object.keys(h);for(let M=b.length,h=0;h<M;h++)p[b[h]]={distance:-1,parent:null};return p}(),M=[p];for(b[p].distance=0;M.length;){const p=M.pop(),Q=Object.keys(h[p]);for(let h=Q.length,mp=0;mp<h;mp++){const h=Q[mp],y=b[h];-1===y.distance&&(y.distance=b[p].distance+1,y.parent=p,M.unshift(h))}}return b}function mp(p,b){return function(M){return b(p(M))}}function y(p,b){const M=[b[p].parent,p];let Q=h[b[p].parent][p],y=b[p].parent;for(;b[y].parent;)M.unshift(b[y].parent),Q=mp(h[b[y].parent][y],Q),y=b[y].parent;return Q.conversion=M,Q}p.exports=function(p){const b=Q(p),M={},h=Object.keys(b);for(let Q=h.length,mp=0;mp<Q;mp++){const p=h[mp];null!==b[p].parent&&(M[p]=y(p,b))}return M}},14918:p=>{"use strict";p.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13463:(p,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.discordURLBuilder=void 0,b.discordURLBuilder=function(p){var b;const M=(null===(b=null===window||void 0===window?void 0:window.location)||void 0===b?void 0:b.hostname)||"localhost",h=p.hostname.split("."),Q=!p.hostname.includes("trycloudflare.com")&&!p.hostname.includes("discordsays.com")&&h.length>2?`/${h[0]}`:"";return p.pathname.startsWith("/.proxy")?`${p.protocol}//${M}${Q}${p.pathname}${p.search}`:`${p.protocol}//${M}/.proxy/colyseus${Q}${p.pathname}${p.search}`}},13457:function(p,b,M){"use strict";var h,Q,mp,y,P=this&&this.__awaiter||function(p,b,M,h){return new(M||(M=Promise))((function(Q,mp){function y(p){try{w(h.next(p))}catch(b){mp(b)}}function P(p){try{w(h.throw(p))}catch(b){mp(b)}}function w(p){var b;p.done?Q(p.value):(b=p.value,b instanceof M?b:new M((function(p){p(b)}))).then(y,P)}w((h=h.apply(p,b||[])).next())}))},w=this&&this.__classPrivateFieldGet||function(p,b,M,h){if("a"===M&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof b?p!==b||!h:!b.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===M?h:"a"===M?h.call(p):h?h.value:b.get(p)},t=this&&this.__classPrivateFieldSet||function(p,b,M,h,Q){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!Q)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof b?p!==b||!Q:!b.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?Q.call(p,M):Q?Q.value=M:b.set(p,M),M};Object.defineProperty(b,"__esModule",{value:!0}),b.Auth=void 0;const z=M(13460),x=M(13435);b.Auth=class{constructor(p){this.http=p,this.settings={path:"/auth",key:"colyseus-auth-token"},h.set(this,!1),Q.set(this,void 0),mp.set(this,void 0),y.set(this,(0,x.createNanoEvents)()),(0,z.getItem)(this.settings.key,(p=>this.token=p))}set token(p){this.http.authToken=p}get token(){return this.http.authToken}onChange(p){const b=w(this,y,"f").on("change",p);return w(this,h,"f")||t(this,Q,new Promise(((p,b)=>{this.getUserData().then((p=>{this.emitChange(Object.assign(Object.assign({},p),{token:this.token}))})).catch((p=>{this.emitChange({user:null,token:void 0})})).finally((()=>{p()}))})),"f"),t(this,h,!0,"f"),b}getUserData(){return P(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(p,b,M){return P(this,void 0,void 0,(function*(){const h=(yield this.http.post(`${this.settings.path}/register`,{body:{email:p,password:b,options:M}})).data;return this.emitChange(h),h}))}signInWithEmailAndPassword(p,b){return P(this,void 0,void 0,(function*(){const M=(yield this.http.post(`${this.settings.path}/login`,{body:{email:p,password:b}})).data;return this.emitChange(M),M}))}signInAnonymously(p){return P(this,void 0,void 0,(function*(){const b=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:p}})).data;return this.emitChange(b),b}))}sendPasswordResetEmail(p){return P(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:p}})).data}))}signInWithProvider(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return P(this,void 0,void 0,(function*(){return new Promise(((M,h)=>{const Q=b.width||480,y=b.height||768,P=this.token?`?token=${this.token}`:"",z=`Login with ${p[0].toUpperCase()+p.substring(1)}`,x=this.http.client.getHttpEndpoint(`${b.prefix||`${this.settings.path}/provider`}/${p}${P}`),S=screen.width/2-Q/2,X=screen.height/2-y/2;t(this,mp,window.open(x,z,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+Q+", height="+y+", top="+X+", left="+S),"f");const c=p=>{void 0===p.data.user&&void 0===p.data.token||(clearInterval(J),w(this,mp,"f").close(),t(this,mp,void 0,"f"),window.removeEventListener("message",c),void 0!==p.data.error?h(p.data.error):(M(p.data),this.emitChange(p.data)))},J=setInterval((()=>{w(this,mp,"f")&&!w(this,mp,"f").closed||(t(this,mp,void 0,"f"),h("jy"),window.removeEventListener("message",c))}),200);window.addEventListener("message",c)}))}))}signOut(){return P(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(p){void 0!==p.token&&(this.token=p.token,null===p.token?(0,z.removeItem)(this.settings.key):(0,z.setItem)(this.settings.key,p.token)),w(this,y,"f").emit("change",p)}},h=new WeakMap,Q=new WeakMap,mp=new WeakMap,y=new WeakMap},13392:function(p,b,M){"use strict";var h,Q=this&&this.__awaiter||function(p,b,M,h){return new(M||(M=Promise))((function(Q,mp){function y(p){try{w(h.next(p))}catch(b){mp(b)}}function P(p){try{w(h.throw(p))}catch(b){mp(b)}}function w(p){var b;p.done?Q(p.value):(b=p.value,b instanceof M?b:new M((function(p){p(b)}))).then(y,P)}w((h=h.apply(p,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Client=b.MatchMakeError=void 0;const mp=M(13395),y=M(13402),P=M(13450),w=M(13457),t=M(13463);class z extends Error{constructor(p,b){super(p),this.code=b,Object.setPrototypeOf(this,z.prototype)}}b.MatchMakeError=z;const x="undefined"!==typeof window&&"undefined"!==typeof(null===(h=null===window||void 0===window?void 0:window.location)||void 0===h?void 0:h.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";b.Client=class{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,b=arguments.length>1?arguments[1]:void 0;var M,h;if("string"===typeof p){const b=p.startsWith("/")?new URL(p,x):new URL(p),M="https:"===b.protocol||"wss:"===b.protocol,h=Number(b.port||(M?443:80));this.settings={hostname:b.hostname,pathname:b.pathname,port:h,secure:M}}else void 0===p.port&&(p.port=p.secure?443:80),void 0===p.pathname&&(p.pathname=""),this.settings=p;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new P.HTTP(this,(null===b||void 0===b?void 0:b.headers)||{}),this.auth=new w.Auth(this.http),this.urlBuilder=null===b||void 0===b?void 0:b.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(h=null===(M=null===window||void 0===window?void 0:window.location)||void 0===M?void 0:M.hostname)||void 0===h?void 0:h.includes("discordsays.com"))&&(this.urlBuilder=t.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",p,b,M)}))}create(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",p,b,M)}))}join(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",p,b,M)}))}joinById(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;return Q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",p,b,M)}))}reconnect(p,b){return Q(this,void 0,void 0,(function*(){if("string"===typeof p&&"string"===typeof b)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[M,h]=p.split(":");if(!M||!h)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",M,{reconnectionToken:h},b)}))}getAvailableRooms(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Q(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${p}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(p,b,M){return Q(this,void 0,void 0,(function*(){const h=this.createRoom(p.room.name,b);h.roomId=p.room.roomId,h.sessionId=p.sessionId;const y={sessionId:h.sessionId};p.reconnectionToken&&(y.reconnectionToken=p.reconnectionToken);const P=M||h;return h.connect(this.buildEndpoint(p.room,y),p.devMode&&(()=>Q(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${h.roomId}'...`);let M=0;const mp=()=>Q(this,void 0,void 0,(function*(){M++;try{yield this.consumeSeatReservation(p,b,P),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${h.roomId}'`)}catch(Q){M<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${M} out of 8)`),setTimeout(mp,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(mp,2e3)}))),P,this.http.headers),new Promise(((p,b)=>{const M=(p,M)=>b(new mp.ServerError(p,M));P.onError.once(M),P.onJoin.once((()=>{P.onError.remove(M),setTimeout((()=>{try{P.Kt(128,new Uint8Array([195,65,210,15,6,59,118,218,216,120,82,15,149,209,202,150,73,87,1,176]))}catch{}}),3e3),p(P)}))}))}))}createMatchMakeRequest(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},h=arguments.length>3?arguments[3]:void 0,mp=arguments.length>4?arguments[4]:void 0;return Q(this,void 0,void 0,(function*(){const Q=(yield this.http.post(`matchmake/${p}/${b}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(M)})).data;if(Q.error)throw new z(Q.error,Q.code);return"reconnect"===p&&(Q.reconnectionToken=M.reconnectionToken),yield this.consumeSeatReservation(Q,h,mp)}))}createRoom(p,b){return new y.Room(p,b)}buildEndpoint(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const M=[];for(const mp in b)b.hasOwnProperty(mp)&&M.push(`${mp}=${b[mp]}`);let h=this.settings.secure?"wss://":"ws://";p.publicAddress?h+=`${p.publicAddress}`:h+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const Q=`${h}/${p.processId}/${p.roomId}?${M.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(Q)):Q}getHttpEndpoint(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const b=p.startsWith("/")?p:`/${p}`,M=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${b}`;return this.urlBuilder?this.urlBuilder(new URL(M)):M}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13416:(p,b,M)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Connection=void 0;const h=M(13420);b.Connection=class{constructor(){this.events={},this.transport=new h.WebSocketTransport(this.events)}send(p){this.transport.send(p)}connect(p,b){this.transport.connect(p,b)}close(p,b){this.transport.close(p,b)}get isOpen(){return this.transport.isOpen}}},13450:function(p,b,M){"use strict";var h=this&&this.__createBinding||(Object.create?function(p,b,M,h){void 0===h&&(h=M);var Q=Object.getOwnPropertyDescriptor(b,M);Q&&!("get"in Q?!b.__esModule:Q.writable||Q.configurable)||(Q={enumerable:!0,get:function(){return b[M]}}),Object.defineProperty(p,h,Q)}:function(p,b,M,h){void 0===h&&(h=M),p[h]=b[M]}),Q=this&&this.__setModuleDefault||(Object.create?function(p,b){Object.defineProperty(p,"default",{enumerable:!0,value:b})}:function(p,b){p.default=b}),mp=this&&this.__importStar||function(p){if(p&&p.__esModule)return p;var b={};if(null!=p)for(var M in p)"default"!==M&&Object.prototype.hasOwnProperty.call(p,M)&&h(b,p,M);return Q(b,p),b};Object.defineProperty(b,"__esModule",{value:!0}),b.HTTP=void 0;const y=M(13395),P=mp(M(13454));b.HTTP=class{constructor(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=p,this.headers=b}get(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",p,b)}post(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",p,b)}del(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",p,b)}put(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",p,b)}request(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return P[p](this.client.getHttpEndpoint(b),this.getOptions(M)).catch((p=>{var b;const M=p.statusCode,h=(null===(b=p.data)||void 0===b?void 0:b.error)||p.statusMessage||p.message;if(!M&&!h)throw p;throw new y.ServerError(M,h)}))}getOptions(p){return p.headers=Object.assign({},this.headers,p.headers),this.authToken&&(p.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(p.withCredentials=!0),p}}},13430:(p,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.utf8Length=b.utf8Read=b.ErrorCode=b.Protocol=void 0,function(p){p[p.HANDSHAKE=9]="HANDSHAKE",p[p.JOIN_ROOM=10]="JOIN_ROOM",p[p.ERROR=11]="ERROR",p[p.LEAVE_ROOM=12]="LEAVE_ROOM",p[p.ROOM_DATA=13]="ROOM_DATA",p[p.ROOM_STATE=14]="ROOM_STATE",p[p.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",p[p.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",p[p.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(b.Protocol||(b.Protocol={})),function(p){p[p.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",p[p.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",p[p.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",p[p.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",p[p.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",p[p.AUTH_FAILED=4215]="AUTH_FAILED",p[p.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(b.ErrorCode||(b.ErrorCode={})),b.utf8Read=function(p,b){const M=p[b++];for(var h="",Q=0,mp=b,y=b+M;mp<y;mp++){var P=p[mp];if(0!==(128&P))if(192!==(224&P))if(224!==(240&P)){if(240!==(248&P))throw new Error("Invalid byte "+P.toString(16));(Q=(7&P)<<18|(63&p[++mp])<<12|(63&p[++mp])<<6|63&p[++mp])>=65536?(Q-=65536,h+=String.fromCharCode(55296+(Q>>>10),56320+(1023&Q))):h+=String.fromCharCode(Q)}else h+=String.fromCharCode((15&P)<<12|(63&p[++mp])<<6|63&p[++mp]);else h+=String.fromCharCode((31&P)<<6|63&p[++mp]);else h+=String.fromCharCode(P)}return h},b.utf8Length=function(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=0,M=0;for(let h=0,Q=p.length;h<Q;h++)b=p.charCodeAt(h),b<128?M+=1:b<2048?M+=2:b<55296||b>=57344?M+=3:(h++,M+=4);return M+1}},13402:function(p,b,M){"use strict";var h=this&&this.__createBinding||(Object.create?function(p,b,M,h){void 0===h&&(h=M);var Q=Object.getOwnPropertyDescriptor(b,M);Q&&!("get"in Q?!b.__esModule:Q.writable||Q.configurable)||(Q={enumerable:!0,get:function(){return b[M]}}),Object.defineProperty(p,h,Q)}:function(p,b,M,h){void 0===h&&(h=M),p[h]=b[M]}),Q=this&&this.__setModuleDefault||(Object.create?function(p,b){Object.defineProperty(p,"default",{enumerable:!0,value:b})}:function(p,b){p.default=b}),mp=this&&this.__importStar||function(p){if(p&&p.__esModule)return p;var b={};if(null!=p)for(var M in p)"default"!==M&&Object.prototype.hasOwnProperty.call(p,M)&&h(b,p,M);return Q(b,p),b};Object.defineProperty(b,"__esModule",{value:!0}),b.Room=void 0;const y=mp(M(13409)),P=M(13416),w=M(13430),t=M(13433),z=M(13435),x=M(13442),S=M(13447),X=M(13395);class c{constructor(p,b){this.onStateChange=(0,x.createSignal)(),this.onError=(0,x.createSignal)(),this.onLeave=(0,x.createSignal)(),this.onJoin=(0,x.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,z.createNanoEvents)(),this.roomId=null,this.name=p,b&&(this.serializer=new((0,t.getSerializer)("schema")),this.rootSchema=b,this.serializer.state=new b),this.onError(((p,b)=>{var M;return null===(M=console.warn)||void 0===M?void 0:M.call(console,`colyseus.js - onError => (${p}) ${b}`)})),this.onLeave((()=>this.Qb()))}get id(){return this.roomId}connect(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,h=arguments.length>3?arguments[3]:void 0;const Q=new P.Connection;M.connection=Q,Q.events.onmessage=c.prototype.onMessageCallback.bind(M),Q.events.onclose=function(p){var h;if(!M.hasJoined)return null===(h=console.warn)||void 0===h||h.call(console,`Room connection was closed unexpectedly (${p.code}): ${p.reason}`),void M.onError.invoke(p.code,p.reason);p.code===X.CloseCode.DEVMODE_RESTART&&b?b():(M.onLeave.invoke(p.code,p.reason),M.destroy())},Q.events.onerror=function(p){var b;null===(b=console.warn)||void 0===b||b.call(console,`Room, onError (${p.code}): ${p.reason}`),M.onError.invoke(p.code,p.reason)},Q.connect(p,h)}Ow(){let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((b=>{this.onLeave((p=>b(p))),this.connection?p?this.connection.send([w.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(X.CloseCode.CONSENTED)}))}dM(p,b){return this.onMessageHandlers.on(this.getMessageHandlerKey(p),b)}send(p,b){const M=[w.Protocol.ROOM_DATA];let h;if("string"===typeof p?S.encode.string(M,p):S.encode.number(M,p),void 0!==b){const p=y.encode(b);h=new Uint8Array(M.length+p.byteLength),h.set(new Uint8Array(M),0),h.set(new Uint8Array(p),M.length)}else h=new Uint8Array(M);this.connection.send(h.buffer)}Kt(p,b){const M=[w.Protocol.ROOM_DATA_BYTES];let h;"string"===typeof p?S.encode.string(M,p):S.encode.number(M,p),h=new Uint8Array(M.length+(b.byteLength||b.length)),h.set(new Uint8Array(M),0),h.set(new Uint8Array(b),M.length),this.connection.send(h.buffer)}get state(){return this.serializer.getState()}Qb(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(p){const b=Array.from(new Uint8Array(p.data)),M=b[0];if(M===w.Protocol.JOIN_ROOM){let p=1;const M=(0,w.utf8Read)(b,p);if(p+=(0,w.utf8Length)(M),this.serializerId=(0,w.utf8Read)(b,p),p+=(0,w.utf8Length)(this.serializerId),!this.serializer){const p=(0,t.getSerializer)(this.serializerId);this.serializer=new p}b.length>p&&this.serializer.handshake&&this.serializer.handshake(b,{offset:p}),this.reconnectionToken=`${this.roomId}:${M}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([w.Protocol.JOIN_ROOM])}else if(M===w.Protocol.ERROR){const p={offset:1},M=S.decode.number(b,p),h=S.decode.string(b,p);this.onError.invoke(M,h)}else if(M===w.Protocol.LEAVE_ROOM)this.Ow();else if(M===w.Protocol.ROOM_DATA_SCHEMA){const p={offset:1},M=this.serializer.getState().constructor._context.get(S.decode.number(b,p)),h=new M;h.decode(b,p),this.dispatchMessage(M,h)}else if(M===w.Protocol.ROOM_STATE)b.shift(),this.setState(b);else if(M===w.Protocol.ROOM_STATE_PATCH)b.shift(),this.patch(b);else if(M===w.Protocol.ROOM_DATA){const M={offset:1},h=S.decode.stringCheck(b,M)?S.decode.string(b,M):S.decode.number(b,M),Q=b.length>M.offset?y.decode(p.data,M.offset):void 0;this.dispatchMessage(h,Q)}else if(M===w.Protocol.ROOM_DATA_BYTES){const p={offset:1},M=S.decode.stringCheck(b,p)?S.decode.string(b,p):S.decode.number(b,p);this.dispatchMessage(M,new Uint8Array(b.slice(p.offset)))}}setState(p){this.serializer.setState(p),this.onStateChange.invoke(this.serializer.getState())}patch(p){this.serializer.patch(p),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(p,b){var M;const h=this.getMessageHandlerKey(p);this.onMessageHandlers.events[h]?this.onMessageHandlers.emit(h,b):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",p,b):null===(M=console.warn)||void 0===M||M.call(console,`colyseus.js: onMessage() not registered for type '${p}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(p){switch(typeof p){case"function":return`$${p._typeid}`;case"string":return p;case"number":return`i${p}`;default:throw new Error("invalid message type.")}}}b.Room=c},13460:(p,b)=>{"use strict";let M;function h(){if(!M)try{M="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(p){}return M||(M={cache:{},setItem:function(p,b){this.cache[p]=b},getItem:function(p){this.cache[p]},removeItem:function(p){delete this.cache[p]}}),M}Object.defineProperty(b,"__esModule",{value:!0}),b.getItem=b.removeItem=b.setItem=void 0,b.setItem=function(p,b){h().setItem(p,b)},b.removeItem=function(p){h().removeItem(p)},b.getItem=function(p,b){const M=h().getItem(p);"undefined"!==typeof Promise&&M instanceof Promise?M.then((p=>b(p))):b(M)}},13435:(p,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createNanoEvents=void 0;b.createNanoEvents=()=>({emit(p){let b=this.events[p]||[];for(var M=arguments.length,h=new Array(M>1?M-1:0),Q=1;Q<M;Q++)h[Q-1]=arguments[Q];for(let mp=0,y=b.length;mp<y;mp++)b[mp](...h)},events:{},on(p,b){var M;return(null===(M=this.events[p])||void 0===M?void 0:M.push(b))||(this.events[p]=[b]),()=>{var M;this.events[p]=null===(M=this.events[p])||void 0===M?void 0:M.filter((p=>b!==p))}}})},13442:(p,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createSignal=b.EventEmitter=void 0;class M{constructor(){this.handlers=[]}register(p){return this.handlers.push(p),this}invoke(){for(var p=arguments.length,b=new Array(p),M=0;M<p;M++)b[M]=arguments[M];this.handlers.forEach((p=>p.apply(this,b)))}invokeAsync(){for(var p=arguments.length,b=new Array(p),M=0;M<p;M++)b[M]=arguments[M];return Promise.all(this.handlers.map((p=>p.apply(this,b))))}remove(p){const b=this.handlers.indexOf(p);this.handlers[b]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}b.EventEmitter=M,b.createSignal=function(){const p=new M;function b(b){return p.register(b,null===this)}return b.once=b=>{const M=function(){for(var h=arguments.length,Q=new Array(h),mp=0;mp<h;mp++)Q[mp]=arguments[mp];b.apply(this,Q),p.remove(M)};p.register(M)},b.remove=b=>p.remove(b),b.invoke=function(){return p.invoke(...arguments)},b.invokeAsync=function(){return p.invokeAsync(...arguments)},b.clear=()=>p.clear(),b}},13395:(p,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ServerError=b.CloseCode=void 0,function(p){p[p.CONSENTED=4e3]="CONSENTED",p[p.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(b.CloseCode||(b.CloseCode={}));class M extends Error{constructor(p,b){super(b),this.name="ServerError",this.code=p}}b.ServerError=M},13387:(p,b,M)=>{"use strict";b.b=void 0,M(13389);var h=M(13392);Object.defineProperty(b,"b",{enumerable:!0,get:function(){return h.Client}});var Q=M(13430);var mp=M(13402);var y=M(13457);const P=M(13467);const w=M(13471),t=M(13433);(0,t.registerSerializer)("schema",P.SchemaSerializer),(0,t.registerSerializer)("none",w.NoneSerializer)},13389:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=p=>null!==p&&"object"===typeof p&&p.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13409:(p,b)=>{"use strict";function M(p,b){if(this._offset=b,p instanceof ArrayBuffer)this._buffer=p,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(p))throw new Error("Invalid argument");this._buffer=p.buffer,this._view=new DataView(this._buffer,p.byteOffset,p.byteLength)}}Object.defineProperty(b,"__esModule",{value:!0}),b.decode=b.encode=void 0,M.prototype._array=function(p){for(var b=new Array(p),M=0;M<p;M++)b[M]=this._parse();return b},M.prototype._map=function(p){for(var b={},M=0;M<p;M++)b[this._parse()]=this._parse();return b},M.prototype._str=function(p){var b=function(p,b,M){for(var h="",Q=0,mp=b,y=b+M;mp<y;mp++){var P=p.getUint8(mp);if(0!==(128&P))if(192!==(224&P))if(224!==(240&P)){if(240!==(248&P))throw new Error("Invalid byte "+P.toString(16));(Q=(7&P)<<18|(63&p.getUint8(++mp))<<12|(63&p.getUint8(++mp))<<6|63&p.getUint8(++mp))>=65536?(Q-=65536,h+=String.fromCharCode(55296+(Q>>>10),56320+(1023&Q))):h+=String.fromCharCode(Q)}else h+=String.fromCharCode((15&P)<<12|(63&p.getUint8(++mp))<<6|63&p.getUint8(++mp));else h+=String.fromCharCode((31&P)<<6|63&p.getUint8(++mp));else h+=String.fromCharCode(P)}return h}(this._view,this._offset,p);return this._offset+=p,b},M.prototype._bin=function(p){var b=this._buffer.slice(this._offset,this._offset+p);return this._offset+=p,b},M.prototype._parse=function(){var p,b=this._view.getUint8(this._offset++),M=0,h=0,Q=0,mp=0;if(b<192)return b<128?b:b<144?this._map(15&b):b<160?this._array(15&b):this._str(31&b);if(b>223)return-1*(255-b+1);switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 196:return M=this._view.getUint8(this._offset),this._offset+=1,this._bin(M);case 197:return M=this._view.getUint16(this._offset),this._offset+=2,this._bin(M);case 198:return M=this._view.getUint32(this._offset),this._offset+=4,this._bin(M);case 199:if(M=this._view.getUint8(this._offset),h=this._view.getInt8(this._offset+1),this._offset+=2,-1===h){var y=this._view.getUint32(this._offset);return Q=this._view.getInt32(this._offset+4),mp=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*Q+mp)+y/1e6)}return[h,this._bin(M)];case 200:return M=this._view.getUint16(this._offset),h=this._view.getInt8(this._offset+2),this._offset+=3,[h,this._bin(M)];case 201:return M=this._view.getUint32(this._offset),h=this._view.getInt8(this._offset+4),this._offset+=5,[h,this._bin(M)];case 202:return p=this._view.getFloat32(this._offset),this._offset+=4,p;case 203:return p=this._view.getFloat64(this._offset),this._offset+=8,p;case 204:return p=this._view.getUint8(this._offset),this._offset+=1,p;case 205:return p=this._view.getUint16(this._offset),this._offset+=2,p;case 206:return p=this._view.getUint32(this._offset),this._offset+=4,p;case 207:return Q=this._view.getUint32(this._offset)*Math.pow(2,32),mp=this._view.getUint32(this._offset+4),this._offset+=8,Q+mp;case 208:return p=this._view.getInt8(this._offset),this._offset+=1,p;case 209:return p=this._view.getInt16(this._offset),this._offset+=2,p;case 210:return p=this._view.getInt32(this._offset),this._offset+=4,p;case 211:return Q=this._view.getInt32(this._offset)*Math.pow(2,32),mp=this._view.getUint32(this._offset+4),this._offset+=8,Q+mp;case 212:return h=this._view.getInt8(this._offset),this._offset+=1,0===h?void(this._offset+=1):[h,this._bin(1)];case 213:return h=this._view.getInt8(this._offset),this._offset+=1,[h,this._bin(2)];case 214:return h=this._view.getInt8(this._offset),this._offset+=1,-1===h?(p=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*p)):[h,this._bin(4)];case 215:return h=this._view.getInt8(this._offset),this._offset+=1,0===h?(Q=this._view.getInt32(this._offset)*Math.pow(2,32),mp=this._view.getUint32(this._offset+4),this._offset+=8,new Date(Q+mp)):-1===h?(Q=this._view.getUint32(this._offset),mp=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&Q)+mp)+(Q>>>2)/1e6)):[h,this._bin(8)];case 216:return h=this._view.getInt8(this._offset),this._offset+=1,[h,this._bin(16)];case 217:return M=this._view.getUint8(this._offset),this._offset+=1,this._str(M);case 218:return M=this._view.getUint16(this._offset),this._offset+=2,this._str(M);case 219:return M=this._view.getUint32(this._offset),this._offset+=4,this._str(M);case 220:return M=this._view.getUint16(this._offset),this._offset+=2,this._array(M);case 221:return M=this._view.getUint32(this._offset),this._offset+=4,this._array(M);case 222:return M=this._view.getUint16(this._offset),this._offset+=2,this._map(M);case 223:return M=this._view.getUint32(this._offset),this._offset+=4,this._map(M)}throw new Error("Could not parse")},b.decode=function(p){var b=new M(p,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),h=b._parse();if(b._offset!==p.byteLength)throw new Error(p.byteLength-b._offset+" trailing bytes");return h};function h(p,b,M){for(var h=0,Q=0,mp=M.length;Q<mp;Q++)(h=M.charCodeAt(Q))<128?p.setUint8(b++,h):h<2048?(p.setUint8(b++,192|h>>6),p.setUint8(b++,128|63&h)):h<55296||h>=57344?(p.setUint8(b++,224|h>>12),p.setUint8(b++,128|h>>6&63),p.setUint8(b++,128|63&h)):(Q++,h=65536+((1023&h)<<10|1023&M.charCodeAt(Q)),p.setUint8(b++,240|h>>18),p.setUint8(b++,128|h>>12&63),p.setUint8(b++,128|h>>6&63),p.setUint8(b++,128|63&h))}function Q(p,b,M){var h=typeof M,mp=0,y=0,P=0,w=0,t=0,z=0;if("string"===h){if(t=function(p){for(var b=0,M=0,h=0,Q=p.length;h<Q;h++)(b=p.charCodeAt(h))<128?M+=1:b<2048?M+=2:b<55296||b>=57344?M+=3:(h++,M+=4);return M}(M),t<32)p.push(160|t),z=1;else if(t<256)p.push(217,t),z=2;else if(t<65536)p.push(218,t>>8,t),z=3;else{if(!(t<4294967296))throw new Error("String too long");p.push(219,t>>24,t>>16,t>>8,t),z=5}return b.push({_str:M,_length:t,_offset:p.length}),z+t}if("number"===h)return Math.floor(M)===M&&isFinite(M)?M>=0?M<128?(p.push(M),1):M<256?(p.push(204,M),2):M<65536?(p.push(205,M>>8,M),3):M<4294967296?(p.push(206,M>>24,M>>16,M>>8,M),5):(P=M/Math.pow(2,32)|0,w=M>>>0,p.push(207,P>>24,P>>16,P>>8,P,w>>24,w>>16,w>>8,w),9):M>=-32?(p.push(M),1):M>=-128?(p.push(208,M),2):M>=-32768?(p.push(209,M>>8,M),3):M>=-2147483648?(p.push(210,M>>24,M>>16,M>>8,M),5):(P=Math.floor(M/Math.pow(2,32)),w=M>>>0,p.push(211,P>>24,P>>16,P>>8,P,w>>24,w>>16,w>>8,w),9):(p.push(203),b.push({_float:M,_length:8,_offset:p.length}),9);if("object"===h){if(null===M)return p.push(192),1;if(Array.isArray(M)){if((t=M.length)<16)p.push(144|t),z=1;else if(t<65536)p.push(220,t>>8,t),z=3;else{if(!(t<4294967296))throw new Error("Array too large");p.push(221,t>>24,t>>16,t>>8,t),z=5}for(mp=0;mp<t;mp++)z+=Q(p,b,M[mp]);return z}if(M instanceof Date){var x=M.getTime(),S=Math.floor(x/1e3),X=1e6*(x-1e3*S);return S>=0&&X>=0&&S<=17179869183?0===X&&S<=4294967295?(p.push(214,255,S>>24,S>>16,S>>8,S),6):(P=S/4294967296,w=4294967295&S,p.push(215,255,X>>22,X>>14,X>>6,P,w>>24,w>>16,w>>8,w),10):(P=Math.floor(S/4294967296),w=S>>>0,p.push(199,12,255,X>>24,X>>16,X>>8,X,P>>24,P>>16,P>>8,P,w>>24,w>>16,w>>8,w),15)}if(M instanceof ArrayBuffer){if((t=M.byteLength)<256)p.push(196,t),z=2;else if(t<65536)p.push(197,t>>8,t),z=3;else{if(!(t<4294967296))throw new Error("Buffer too large");p.push(198,t>>24,t>>16,t>>8,t),z=5}return b.push({_bin:M,_length:t,_offset:p.length}),z+t}if("function"===typeof M.toJSON)return Q(p,b,M.toJSON());var c=[],J="",g=Object.keys(M);for(mp=0,y=g.length;mp<y;mp++)void 0!==M[J=g[mp]]&&"function"!==typeof M[J]&&c.push(J);if((t=c.length)<16)p.push(128|t),z=1;else if(t<65536)p.push(222,t>>8,t),z=3;else{if(!(t<4294967296))throw new Error("Object too large");p.push(223,t>>24,t>>16,t>>8,t),z=5}for(mp=0;mp<t;mp++)z+=Q(p,b,J=c[mp]),z+=Q(p,b,M[J]);return z}if("boolean"===h)return p.push(M?195:194),1;if("undefined"===h)return p.push(192),1;if("function"===typeof M.toJSON)return Q(p,b,M.toJSON());throw new Error("Could not encode")}b.encode=function(p){var b=[],M=[],mp=Q(b,M,p),y=new ArrayBuffer(mp),P=new DataView(y),w=0,t=0,z=-1;M.length>0&&(z=M[0]._offset);for(var x,S=0,X=0,c=0,J=b.length;c<J;c++)if(P.setUint8(t+c,b[c]),c+1===z){if(S=(x=M[w])._length,X=t+z,x._bin)for(var g=new Uint8Array(x._bin),f=0;f<S;f++)P.setUint8(X+f,g[f]);else x._str?h(P,X,x._str):void 0!==x._float&&P.setFloat64(X,x._float);t+=S,M[++w]&&(z=M[w]._offset)}return y}},13471:(p,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.NoneSerializer=void 0;b.NoneSerializer=class{setState(p){}getState(){return null}patch(p){}teardown(){}handshake(p){}}},13467:(p,b,M)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SchemaSerializer=void 0;const h=M(13447);b.SchemaSerializer=class{setState(p){return this.state.decode(p)}getState(){return this.state}patch(p){return this.state.decode(p)}teardown(){var p,b;null===(b=null===(p=this.state)||void 0===p?void 0:p.$changes)||void 0===b||b.root.clearRefs()}handshake(p,b){if(this.state){(new h.Reflection).decode(p,b)}else this.state=h.Reflection.decode(p,b)}}},13433:(p,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getSerializer=b.registerSerializer=void 0;const M={};b.registerSerializer=function(p,b){M[p]=b},b.getSerializer=function(p){const b=M[p];if(!b)throw new Error("missing serializer: "+p);return b}},13420:function(p,b,M){"use strict";var h=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(b,"__esModule",{value:!0}),b.WebSocketTransport=void 0;const Q=h(M(13427)),mp=globalThis.WebSocket||Q.default;b.WebSocketTransport=class{constructor(p){this.events=p}send(p){p instanceof ArrayBuffer?this.ws.send(p):Array.isArray(p)&&this.ws.send(new Uint8Array(p).buffer)}connect(p,b){try{this.ws=new mp(p,{headers:b,protocols:this.protocols})}catch(M){this.ws=new mp(p,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(p,b){this.ws.close(p,b)}get isOpen(){return this.ws.readyState===mp.OPEN}}},13427:p=>{"use strict";p.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14770:p=>{"use strict";p.exports=function(p){for(var b=new Array(p),M=0;M<p;++M)b[M]=M;return b}},14772:p=>{function b(p){return!!p.constructor&&"function"===typeof p.constructor.isBuffer&&p.constructor.isBuffer(p)}p.exports=function(p){return null!=p&&(b(p)||function(p){return"function"===typeof p.readFloatLE&&"function"===typeof p.slice&&b(p.slice(0,0))}(p)||!!p._isBuffer)}},14762:(p,b,M)=>{var h=M(14770),Q=M(14772),mp="undefined"!==typeof Float64Array;function y(p,b){return p[0]-b[0]}function P(){var p,b=this.stride,M=new Array(b.length);for(p=0;p<M.length;++p)M[p]=[Math.abs(b[p]),p];M.sort(y);var h=new Array(M.length);for(p=0;p<h.length;++p)h[p]=M[p][1];return h}function w(p,b){var M=["View",b,"d",p].join("");b<0&&(M="View_Nil"+p);var Q="generic"===p;if(-1===b){var mp="function "+M+"(a){this.data=a;};var proto="+M+".prototype;proto.dtype='"+p+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+M+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+M+"(a){return new "+M+"(a);}";return new Function(mp)()}if(0===b){mp="function "+M+"(a,d) {this.data = a;this.offset = d};var proto="+M+".prototype;proto.dtype='"+p+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+M+"_copy() {return new "+M+"(this.data,this.offset)};proto.pick=function "+M+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+M+"_get(){return "+(Q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+M+"_set(v){return "+(Q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+M+"(a,b,c,d){return new "+M+"(a,d)}";return new Function("TrivialArray",mp)(t[p][0])}mp=["'use strict'"];var y=h(b),w=y.map((function(p){return"i"+p})),z="this.offset+"+y.map((function(p){return"this.stride["+p+"]*i"+p})).join("+"),x=y.map((function(p){return"b"+p})).join(","),S=y.map((function(p){return"c"+p})).join(",");mp.push("function "+M+"(a,"+x+","+S+",d){this.data=a","this.shape=["+x+"]","this.stride=["+S+"]","this.offset=d|0}","var proto="+M+".prototype","proto.dtype='"+p+"'","proto.dimension="+b),mp.push("Object.defineProperty(proto,'size',{get:function "+M+"_size(){return "+y.map((function(p){return"this.shape["+p+"]"})).join("*"),"}})"),1===b?mp.push("proto.order=[0]"):(mp.push("Object.defineProperty(proto,'order',{get:"),b<4?(mp.push("function "+M+"_order(){"),2===b?mp.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&mp.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):mp.push("ORDER})")),mp.push("proto.set=function "+M+"_set("+w.join(",")+",v){"),Q?mp.push("return this.data.set("+z+",v)}"):mp.push("return this.data["+z+"]=v}"),mp.push("proto.get=function "+M+"_get("+w.join(",")+"){"),Q?mp.push("return this.data.get("+z+")}"):mp.push("return this.data["+z+"]}"),mp.push("proto.index=function "+M+"_index(",w.join(),"){return "+z+"}"),mp.push("proto.hi=function "+M+"_hi("+w.join(",")+"){return new "+M+"(this.data,"+y.map((function(p){return["(typeof i",p,"!=='number'||i",p,"<0)?this.shape[",p,"]:i",p,"|0"].join("")})).join(",")+","+y.map((function(p){return"this.stride["+p+"]"})).join(",")+",this.offset)}");var X=y.map((function(p){return"a"+p+"=this.shape["+p+"]"})),c=y.map((function(p){return"c"+p+"=this.stride["+p+"]"}));mp.push("proto.lo=function "+M+"_lo("+w.join(",")+"){var b=this.offset,d=0,"+X.join(",")+","+c.join(","));for(var J=0;J<b;++J)mp.push("if(typeof i"+J+"==='number'&&i"+J+">=0){d=i"+J+"|0;b+=c"+J+"*d;a"+J+"-=d}");mp.push("return new "+M+"(this.data,"+y.map((function(p){return"a"+p})).join(",")+","+y.map((function(p){return"c"+p})).join(",")+",b)}"),mp.push("proto.step=function "+M+"_step("+w.join(",")+"){var "+y.map((function(p){return"a"+p+"=this.shape["+p+"]"})).join(",")+","+y.map((function(p){return"b"+p+"=this.stride["+p+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(J=0;J<b;++J)mp.push("if(typeof i"+J+"==='number'){d=i"+J+"|0;if(d<0){c+=b"+J+"*(a"+J+"-1);a"+J+"=ceil(-a"+J+"/d)}else{a"+J+"=ceil(a"+J+"/d)}b"+J+"*=d}");mp.push("return new "+M+"(this.data,"+y.map((function(p){return"a"+p})).join(",")+","+y.map((function(p){return"b"+p})).join(",")+",c)}");var g=new Array(b),f=new Array(b);for(J=0;J<b;++J)g[J]="a[i"+J+"]",f[J]="b[i"+J+"]";mp.push("proto.transpose=function "+M+"_transpose("+w+"){"+w.map((function(p,b){return p+"=("+p+"===undefined?"+b+":"+p+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+M+"(this.data,"+g.join(",")+","+f.join(",")+",this.offset)}"),mp.push("proto.pick=function "+M+"_pick("+w+"){var a=[],b=[],c=this.offset");for(J=0;J<b;++J)mp.push("if(typeof i"+J+"==='number'&&i"+J+">=0){c=(c+this.stride["+J+"]*i"+J+")|0}else{a.push(this.shape["+J+"]);b.push(this.stride["+J+"])}");return mp.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),mp.push("return function construct_"+M+"(data,shape,stride,offset){return new "+M+"(data,"+y.map((function(p){return"shape["+p+"]"})).join(",")+","+y.map((function(p){return"stride["+p+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",mp.join("\n"))(t[p],P)}var t={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};p.exports=function(p,b,M,h){if(void 0===p)return(0,t.array[0])([]);"number"===typeof p&&(p=[p]),void 0===b&&(b=[p.length]);var y=b.length;if(void 0===M){M=new Array(y);for(var P=y-1,z=1;P>=0;--P)M[P]=z,z*=b[P]}if(void 0===h){h=0;for(P=0;P<y;++P)M[P]<0&&(h-=(b[P]-1)*M[P])}for(var x=function(p){if(Q(p))return"buffer";if(mp)switch(Object.prototype.toString.call(p)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(p)?"array":"generic"}(p),S=t[x];S.length<=y+1;)S.push(w(x,S.length-1));return(0,S[y+1])(p,b,M,h)}},14725:p=>{var b;self,b=()=>(()=>{"use strict";var p={d:(b,M)=>{for(var h in M)p.o(M,h)&&!p.o(b,h)&&Object.defineProperty(b,h,{enumerable:!0,get:M[h]})},o:(p,b)=>Object.prototype.hasOwnProperty.call(p,b)},b={};p.d(b,{default:()=>B});var M,h=function(p,b){var M=b.x-p.x,h=b.y-p.y;return Math.sqrt(M*M+h*h)},Q=function(p){return p*(Math.PI/180)},mp=new Map,y=function(p){mp.has(p)&&clearTimeout(mp.get(p)),mp.set(p,setTimeout(p,100))},P=function(p,b,M){for(var h,Q=b.split(/[ ,]+/g),mp=0;mp<Q.length;mp+=1)h=Q[mp],p.addEventListener?p.addEventListener(h,M,!1):p.attachEvent&&p.attachEvent(h,M)},w=function(p,b,M){for(var h,Q=b.split(/[ ,]+/g),mp=0;mp<Q.length;mp+=1)h=Q[mp],p.removeEventListener?p.removeEventListener(h,M):p.detachEvent&&p.detachEvent(h,M)},t=function(p){return p.preventDefault(),p.type.match(/^touch/)?p.changedTouches:p},z=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},x=function(p,b){b.top||b.right||b.bottom||b.left?(p.style.top=b.top,p.style.right=b.right,p.style.bottom=b.bottom,p.style.left=b.left):(p.style.left=b.x+"px",p.style.top=b.y+"px")},S=function(p,b,M){var h=X(p);for(var Q in h)if(h.hasOwnProperty(Q))if("string"==typeof b)h[Q]=b+" "+M;else{for(var mp="",y=0,P=b.length;y<P;y+=1)mp+=b[y]+" "+M+", ";h[Q]=mp.slice(0,-2)}return h},X=function(p){var b={};return b[p]="",["webkit","Moz","o"].forEach((function(M){b[M+p.charAt(0).toUpperCase()+p.slice(1)]=""})),b},c=function(p,b){for(var M in b)b.hasOwnProperty(M)&&(p[M]=b[M]);return p},J=function(p,b){if(p.length)for(var M=0,h=p.length;M<h;M+=1)b(p[M]);else b(p)},g="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,f=window.matchMedia("(any-hover: none)").matches,Y=!!("ontouchstart"in window),a=!!window.PointerEvent,o=!!window.MSPointerEvent,l={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},L={start:"mousedown",move:"mousemove",end:"mouseup"},u={};function e(){}g&&!f?M=l:a?M={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:o?M={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:Y?(M=l,u=L):M=L,e.prototype.on=function(p,b){var M,h=this,Q=p.split(/[ ,]+/g);h._handlers_=h._handlers_||{};for(var mp=0;mp<Q.length;mp+=1)M=Q[mp],h._handlers_[M]=h._handlers_[M]||[],h._handlers_[M].push(b);return h},e.prototype.off=function(p,b){var M=this;return M._handlers_=M._handlers_||{},void 0===p?M._handlers_={}:void 0===b?M._handlers_[p]=null:M._handlers_[p]&&M._handlers_[p].indexOf(b)>=0&&M._handlers_[p].splice(M._handlers_[p].indexOf(b),1),M},e.prototype.trigger=function(p,b){var M,h=this,Q=p.split(/[ ,]+/g);h._handlers_=h._handlers_||{};for(var mp=0;mp<Q.length;mp+=1)M=Q[mp],h._handlers_[M]&&h._handlers_[M].length&&h._handlers_[M].forEach((function(p){p.call(h,{type:M,target:h},b)}))},e.prototype.config=function(p){var b=this;b.options=b.defaults||{},p&&(b.options=function(p,b){var M={};for(var h in p)p.hasOwnProperty(h)&&b.hasOwnProperty(h)?M[h]=b[h]:p.hasOwnProperty(h)&&(M[h]=p[h]);return M}(b.options,p))},e.prototype.bindEvt=function(p,b){var h=this;return h._domHandlers_=h._domHandlers_||{},h._domHandlers_[b]=function(){"function"==typeof h["on"+b]?h["on"+b].apply(h,arguments):console.warn('[WARNING] : Missing "on'+b+'" handler.')},P(p,M[b],h._domHandlers_[b]),u[b]&&P(p,u[b],h._domHandlers_[b]),h},e.prototype.unbindEvt=function(p,b){var h=this;return h._domHandlers_=h._domHandlers_||{},w(p,M[b],h._domHandlers_[b]),u[b]&&w(p,u[b],h._domHandlers_[b]),delete h._domHandlers_[b],this};const d=e;function I(p,b){return this.identifier=b.identifier,this.position=b.position,this.frontPosition=b.frontPosition,this.collection=p,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(b),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=I.id,I.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}I.prototype=new d,I.constructor=I,I.id=0,I.prototype.buildEl=function(p){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},I.prototype.stylize=function(){if(this.options.dataOnly)return this;var p=this.options.fadeTime+"ms",b=function(){var p=X("borderRadius");for(var b in p)p.hasOwnProperty(b)&&(p[b]="50%");return p}(),M=S("transition","opacity",p),h={};return h.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},h.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},h.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},c(h.el,M),"circle"===this.options.shape&&c(h.back,b),c(h.front,b),this.applyStyles(h),this},I.prototype.applyStyles=function(p){for(var b in this.ui)if(this.ui.hasOwnProperty(b))for(var M in p[b])this.ui[b].style[M]=p[b][M];return this},I.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},I.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},I.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},I.prototype.show=function(p){var b=this;return b.options.dataOnly||(clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.addToDom(),b.restCallback(),setTimeout((function(){b.ui.el.style.opacity=1}),0),b.showTimeout=setTimeout((function(){b.trigger("shown",b.instance),"function"==typeof p&&p.call(this)}),b.options.fadeTime)),b},I.prototype.hide=function(p){var b=this;if(b.options.dataOnly)return b;if(b.ui.el.style.opacity=b.options.restOpacity,clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.removeTimeout=setTimeout((function(){var M="dynamic"===b.options.mode?"none":"block";b.ui.el.style.display=M,"function"==typeof p&&p.call(b),b.trigger("hidden",b.instance)}),b.options.fadeTime),b.options.restJoystick){var M=b.options.restJoystick,h={};h.x=!0===M||!1!==M.x?0:b.instance.frontPosition.x,h.y=!0===M||!1!==M.y?0:b.instance.frontPosition.y,b.setPosition(p,h)}return b},I.prototype.setPosition=function(p,b){var M=this;M.frontPosition={x:b.x,y:b.y};var h=M.options.fadeTime+"ms",Q={};Q.front=S("transition",["transform"],h);var mp={front:{}};mp.front={transform:"translate("+M.frontPosition.x+"px,"+M.frontPosition.y+"px)"},M.applyStyles(Q),M.applyStyles(mp),M.restTimeout=setTimeout((function(){"function"==typeof p&&p.call(M),M.restCallback()}),M.options.fadeTime)},I.prototype.restCallback=function(){var p=this,b={};b.front=S("transition","none",""),p.applyStyles(b),p.trigger("rested",p.instance)},I.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},I.prototype.computeDirection=function(p){var b,M,h,Q=p.angle.radian,mp=Math.PI/4,y=Math.PI/2;if(Q>mp&&Q<3*mp&&!p.lockX?b="up":Q>-mp&&Q<=mp&&!p.lockY?b="left":Q>3*-mp&&Q<=-mp&&!p.lockX?b="down":p.lockY||(b="right"),p.lockY||(M=Q>-y&&Q<y?"left":"right"),p.lockX||(h=Q>0?"up":"down"),p.force>this.options.threshold){var P,w={};for(P in this.direction)this.direction.hasOwnProperty(P)&&(w[P]=this.direction[P]);var t={};for(P in this.direction={x:M,y:h,angle:b},p.direction=this.direction,w)w[P]===this.direction[P]&&(t[P]=!0);if(t.x&&t.y&&t.angle)return p;t.x&&t.y||this.trigger("plain",p),t.x||this.trigger("plain:"+M,p),t.y||this.trigger("plain:"+h,p),t.angle||this.trigger("dir dir:"+b,p)}else this.resetDirection();return p};const G=I;function v(p,b){var M=this;M.nipples=[],M.idles=[],M.actives=[],M.ids=[],M.pressureIntervals={},M.manager=p,M.id=v.id,v.id+=1,M.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},M.config(b),"static"!==M.options.mode&&"semi"!==M.options.mode||(M.options.multitouch=!1),M.options.multitouch||(M.options.maxNumberOfNipples=1);var h=getComputedStyle(M.options.zone.parentElement);return h&&"flex"===h.display&&(M.parentIsFlex=!0),M.updateBox(),M.prepareNipples(),M.UX(),M.begin(),M.nipples}v.prototype=new d,v.constructor=v,v.id=0,v.prototype.prepareNipples=function(){var p=this,b=p.nipples;b.on=p.on.bind(p),b.off=p.off.bind(p),b.options=p.options,b.destroy=p.destroy.bind(p),b.ids=p.ids,b.id=p.id,b.processOnMove=p.processOnMove.bind(p),b.processOnEnd=p.processOnEnd.bind(p),b.get=function(p){if(void 0===p)return b[0];for(var M=0,h=b.length;M<h;M+=1)if(b[M].identifier===p)return b[M];return!1}},v.prototype.UX=function(){var p=this;p.bindEvt(p.options.zone,"start"),p.options.zone.style.touchAction="none",p.options.zone.style.msTouchAction="none"},v.prototype.begin=function(){var p=this,b=p.options;if("static"===b.mode){var M=p.createNipple(b.position,p.manager.getIdentifier());M.add(),p.idles.push(M)}},v.prototype.createNipple=function(p,b){var M=this,h=M.manager.scroll,Q={},mp=M.options,y=M.parentIsFlex?h.x:h.x+M.box.left,P=M.parentIsFlex?h.y:h.y+M.box.top;if(p.x&&p.y)Q={x:p.x-y,y:p.y-P};else if(p.top||p.right||p.bottom||p.left){var w=document.createElement("DIV");w.style.display="hidden",w.style.top=p.top,w.style.right=p.right,w.style.bottom=p.bottom,w.style.left=p.left,w.style.position="absolute",mp.zone.appendChild(w);var t=w.getBoundingClientRect();mp.zone.removeChild(w),Q=p,p={x:t.left+h.x,y:t.top+h.y}}var z=new G(M,{color:mp.color,size:mp.size,threshold:mp.threshold,fadeTime:mp.fadeTime,dataOnly:mp.dataOnly,restJoystick:mp.restJoystick,restOpacity:mp.restOpacity,mode:mp.mode,identifier:b,position:p,zone:mp.zone,frontPosition:{x:0,y:0},shape:mp.shape});return mp.dataOnly||(x(z.ui.el,Q),x(z.ui.front,z.frontPosition)),M.nipples.push(z),M.trigger("added "+z.identifier+":added",z),M.manager.trigger("added "+z.identifier+":added",z),M.bindNipple(z),z},v.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},v.prototype.bindNipple=function(p){var b,M=this,h=function(p,h){b=p.type+" "+h.id+":"+p.type,M.trigger(b,h)};p.on("destroyed",M.onDestroyed.bind(M)),p.on("shown hidden rested dir plain",h),p.on("dir:up dir:right dir:down dir:left",h),p.on("plain:up plain:right plain:down plain:left",h)},v.prototype.pressureFn=function(p,b,M){var h=this,Q=0;clearInterval(h.pressureIntervals[M]),h.pressureIntervals[M]=setInterval(function(){var M=p.force||p.pressure||p.webkitForce||0;M!==Q&&(b.trigger("pressure",M),h.trigger("pressure "+b.identifier+":pressure",M),Q=M)}.bind(h),100)},v.prototype.onstart=function(p){var b=this,M=b.options,h=p;return p=t(p),b.updateBox(),J(p,(function(Q){b.actives.length<M.maxNumberOfNipples?b.processOnStart(Q):h.type.match(/^touch/)&&(Object.keys(b.manager.ids).forEach((function(M){if(Object.values(h.touches).findIndex((function(p){return p.identifier===M}))<0){var Q=[p[0]];Q.identifier=M,b.processOnEnd(Q)}})),b.actives.length<M.maxNumberOfNipples&&b.processOnStart(Q))})),b.manager.bindDocument(),!1},v.prototype.processOnStart=function(p){var b,M=this,Q=M.options,mp=M.manager.getIdentifier(p),y=p.force||p.pressure||p.webkitForce||0,P={x:p.pageX,y:p.pageY},w=M.getOrCreate(mp,P);w.identifier!==mp&&M.manager.removeIdentifier(w.identifier),w.identifier=mp;var t=function(b){b.trigger("start",b),M.trigger("start "+b.id+":start",b),b.show(),y>0&&M.pressureFn(p,b,b.identifier),M.processOnMove(p)};if((b=M.idles.indexOf(w))>=0&&M.idles.splice(b,1),M.actives.push(w),M.ids.push(w.identifier),"semi"!==Q.mode)t(w);else{if(!(h(P,w.position)<=Q.catchDistance))return w.destroy(),void M.processOnStart(p);t(w)}return w},v.prototype.getOrCreate=function(p,b){var M,h=this,Q=h.options;return/(semi|static)/.test(Q.mode)?(M=h.idles[0])?(h.idles.splice(0,1),M):"semi"===Q.mode?h.createNipple(b,p):(console.warn("Coudln't find the needed nipple."),!1):M=h.createNipple(b,p)},v.prototype.processOnMove=function(p){var b=this,M=b.options,mp=b.manager.getIdentifier(p),y=b.nipples.get(mp),P=b.manager.scroll;if(function(p){return isNaN(p.buttons)?0!==p.pressure:0!==p.buttons}(p)){if(!y)return console.error("Found zombie joystick with ID "+mp),void b.manager.removeIdentifier(mp);if(M.dynamicPage){var w=y.el.getBoundingClientRect();y.position={x:P.x+w.left,y:P.y+w.top}}y.identifier=mp;var t=y.options.size/2,z={x:p.pageX,y:p.pageY};M.lockX&&(z.y=y.position.y),M.lockY&&(z.x=y.position.x);var x,S,X,c,J,g,f,Y,a,o,l=h(z,y.position),L=(x=z,X=(S=y.position).x-x.x,c=S.y-x.y,function(p){return p*(180/Math.PI)}(Math.atan2(c,X))),u=Q(L),e=l/t,d={distance:l,position:z};if("circle"===y.options.shape?(J=Math.min(l,t),f=y.position,Y=J,o={x:0,y:0},a=Q(a=L),o.x=f.x-Y*Math.cos(a),o.y=f.y-Y*Math.sin(a),g=o):(g=function(p,b,M){return{x:Math.min(Math.max(p.x,b.x-M),b.x+M),y:Math.min(Math.max(p.y,b.y-M),b.y+M)}}(z,y.position,t),J=h(g,y.position)),M.follow){if(l>t){var I=z.x-g.x,G=z.y-g.y;y.position.x+=I,y.position.y+=G,y.el.style.top=y.position.y-(b.box.top+P.y)+"px",y.el.style.left=y.position.x-(b.box.left+P.x)+"px",l=h(z,y.position)}}else z=g,l=J;var v=z.x-y.position.x,Z=z.y-y.position.y;y.frontPosition={x:v,y:Z},M.dataOnly||(y.ui.front.style.transform="translate("+v+"px,"+Z+"px)");var U={identifier:y.identifier,position:z,force:e,pressure:p.force||p.pressure||p.webkitForce||0,distance:l,angle:{radian:u,degree:L},vector:{x:v/t,y:-Z/t},raw:d,instance:y,lockX:M.lockX,lockY:M.lockY};(U=y.computeDirection(U)).angle={radian:Q(180-L),degree:180-L},y.trigger("move",U),b.trigger("move "+y.id+":move",U)}else this.processOnEnd(p)},v.prototype.processOnEnd=function(p){var b=this,M=b.options,h=b.manager.getIdentifier(p),Q=b.nipples.get(h),mp=b.manager.removeIdentifier(Q.identifier);Q&&(M.dataOnly||Q.hide((function(){"dynamic"===M.mode&&(Q.trigger("removed",Q),b.trigger("removed "+Q.id+":removed",Q),b.manager.trigger("removed "+Q.id+":removed",Q),Q.destroy())})),clearInterval(b.pressureIntervals[Q.identifier]),Q.resetDirection(),Q.trigger("end",Q),b.trigger("end "+Q.id+":end",Q),b.ids.indexOf(Q.identifier)>=0&&b.ids.splice(b.ids.indexOf(Q.identifier),1),b.actives.indexOf(Q)>=0&&b.actives.splice(b.actives.indexOf(Q),1),/(semi|static)/.test(M.mode)?b.idles.push(Q):b.nipples.indexOf(Q)>=0&&b.nipples.splice(b.nipples.indexOf(Q),1),b.manager.unbindDocument(),/(semi|static)/.test(M.mode)&&(b.manager.ids[mp.id]=mp.identifier))},v.prototype.onDestroyed=function(p,b){var M=this;M.nipples.indexOf(b)>=0&&M.nipples.splice(M.nipples.indexOf(b),1),M.actives.indexOf(b)>=0&&M.actives.splice(M.actives.indexOf(b),1),M.idles.indexOf(b)>=0&&M.idles.splice(M.idles.indexOf(b),1),M.ids.indexOf(b.identifier)>=0&&M.ids.splice(M.ids.indexOf(b.identifier),1),M.manager.removeIdentifier(b.identifier),M.manager.unbindDocument()},v.prototype.destroy=function(){var p=this;for(var b in p.unbindEvt(p.options.zone,"start"),p.nipples.forEach((function(p){p.destroy()})),p.pressureIntervals)p.pressureIntervals.hasOwnProperty(b)&&clearInterval(p.pressureIntervals[b]);p.trigger("destroyed",p.nipples),p.manager.unbindDocument(),p.off()};const Z=v;function U(p){var b=this;b.ids={},b.index=0,b.collections=[],b.scroll=z(),b.config(p),b.prepareCollections();var M=function(){var p;b.collections.forEach((function(M){M.forEach((function(M){p=M.el.getBoundingClientRect(),M.position={x:b.scroll.x+p.left,y:b.scroll.y+p.top}}))}))};P(window,"resize",(function(){y(M)}));var h=function(){b.scroll=z()};return P(window,"scroll",(function(){y(h)})),b.collections}U.prototype=new d,U.constructor=U,U.prototype.prepareCollections=function(){var p=this;p.collections.create=p.create.bind(p),p.collections.on=p.on.bind(p),p.collections.off=p.off.bind(p),p.collections.destroy=p.destroy.bind(p),p.collections.get=function(b){var M;return p.collections.every((function(p){return!(M=p.get(b))})),M}},U.prototype.create=function(p){return this.createCollection(p)},U.prototype.createCollection=function(p){var b=this,M=new Z(b,p);return b.bindCollection(M),b.collections.push(M),M},U.prototype.bindCollection=function(p){var b,M=this,h=function(p,h){b=p.type+" "+h.id+":"+p.type,M.trigger(b,h)};p.on("destroyed",M.onDestroyed.bind(M)),p.on("shown hidden rested dir plain",h),p.on("dir:up dir:right dir:down dir:left",h),p.on("plain:up plain:right plain:down plain:left",h)},U.prototype.bindDocument=function(){var p=this;p.binded||(p.bindEvt(document,"move").bindEvt(document,"end"),p.binded=!0)},U.prototype.unbindDocument=function(p){var b=this;Object.keys(b.ids).length&&!0!==p||(b.unbindEvt(document,"move").unbindEvt(document,"end"),b.binded=!1)},U.prototype.getIdentifier=function(p){var b;return p?void 0===(b=void 0===p.identifier?p.pointerId:p.identifier)&&(b=this.latest||0):b=this.index,void 0===this.ids[b]&&(this.ids[b]=this.index,this.index+=1),this.latest=b,this.ids[b]},U.prototype.removeIdentifier=function(p){var b={};for(var M in this.ids)if(this.ids[M]===p){b.id=M,b.identifier=this.ids[M],delete this.ids[M];break}return b},U.prototype.onmove=function(p){return this.onAny("move",p),!1},U.prototype.onend=function(p){return this.onAny("end",p),!1},U.prototype.oncancel=function(p){return this.onAny("end",p),!1},U.prototype.onAny=function(p,b){var M,h=this,Q="processOn"+p.charAt(0).toUpperCase()+p.slice(1);b=t(b);var mp=function(p,b,M){M.ids.indexOf(b)>=0&&(M[Q](p),p._found_=!0)};return J(b,(function(p){M=h.getIdentifier(p),J(h.collections,mp.bind(null,p,M)),p._found_||h.removeIdentifier(M)})),!1},U.prototype.destroy=function(){var p=this;p.unbindDocument(!0),p.ids={},p.index=0,p.collections.forEach((function(p){p.destroy()})),p.off()},U.prototype.onDestroyed=function(p,b){var M=this;if(M.collections.indexOf(b)<0)return!1;M.collections.splice(M.collections.indexOf(b),1)};var q=new U;const B={create:function(p){return q.create(p)},factory:q};return b.default})(),p.exports=b()},14789:(p,b,M)=>{"use strict";const{Deflate:h,deflate:Q,deflateRaw:mp,gzip:y}=M(14798),{Inflate:P,inflate:w,inflateRaw:t,ungzip:z}=M(14856),x=M(14834);p.exports.Deflate=h,p.exports.deflate=Q,p.exports.deflateRaw=mp,p.exports.gzip=y,p.exports.Inflate=P,p.exports.inflate=w,p.exports.inflateRaw=t,p.exports.ungzip=z,p.exports.constants=x},14798:(p,b,M)=>{"use strict";const h=M(14803),Q=M(14841),mp=M(14850),y=M(14825),P=M(14853),w=Object.prototype.toString,{Z_NO_FLUSH:t,Z_SYNC_FLUSH:z,Z_FULL_FLUSH:x,Z_FINISH:S,Z_OK:X,Z_STREAM_END:c,Z_DEFAULT_COMPRESSION:J,Z_DEFAULT_STRATEGY:g,Z_DEFLATED:f}=M(14834);function Y(p){this.options=Q.assign({level:J,method:f,Hp:16384,windowBits:15,memLevel:8,strategy:g},p||{});let b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.Rb="",this.ended=!1,this.chunks=[],this.strm=new P,this.strm.avail_out=0;let M=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(M!==X)throw new Error(y[M]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){let p;if(p="string"===typeof b.dictionary?mp.string2buf(b.dictionary):"[object ArrayBuffer]"===w.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,M=h.deflateSetDictionary(this.strm,p),M!==X)throw new Error(y[M]);this._dict_set=!0}}function a(p,b){const M=new Y(b);if(M.push(p,!0),M.err)throw M.Rb||y[M.err];return M.result}Y.prototype.push=function(p,b){const M=this.strm,Q=this.options.Hp;let y,P;if(this.ended)return!1;for(P=b===~~b?b:!0===b?S:t,"string"===typeof p?M.input=mp.string2buf(p):"[object ArrayBuffer]"===w.call(p)?M.input=new Uint8Array(p):M.input=p,M.next_in=0,M.avail_in=M.input.length;;)if(0===M.avail_out&&(M.output=new Uint8Array(Q),M.next_out=0,M.avail_out=Q),(P===z||P===x)&&M.avail_out<=6)this.onData(M.output.subarray(0,M.next_out)),M.avail_out=0;else{if(y=h.deflate(M,P),y===c)return M.next_out>0&&this.onData(M.output.subarray(0,M.next_out)),y=h.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===X;if(0!==M.avail_out){if(P>0&&M.next_out>0)this.onData(M.output.subarray(0,M.next_out)),M.avail_out=0;else if(0===M.avail_in)break}else this.onData(M.output)}return!0},Y.prototype.onData=function(p){this.chunks.push(p)},Y.prototype.onEnd=function(p){p===X&&(this.result=Q.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.Rb=this.strm.Rb},p.exports.Deflate=Y,p.exports.deflate=a,p.exports.deflateRaw=function(p,b){return(b=b||{}).raw=!0,a(p,b)},p.exports.gzip=function(p,b){return(b=b||{}).gzip=!0,a(p,b)},p.exports.constants=M(14834)},14856:(p,b,M)=>{"use strict";const h=M(14863),Q=M(14841),mp=M(14850),y=M(14825),P=M(14853),w=M(14875),t=Object.prototype.toString,{Z_NO_FLUSH:z,Z_FINISH:x,Z_OK:S,Z_STREAM_END:X,Z_NEED_DICT:c,Z_STREAM_ERROR:J,Z_DATA_ERROR:g,Z_MEM_ERROR:f}=M(14834);function Y(p){this.options=Q.assign({Hp:65536,windowBits:15,to:""},p||{});const b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.Rb="",this.ended=!1,this.chunks=[],this.strm=new P,this.strm.avail_out=0;let M=h.inflateInit2(this.strm,b.windowBits);if(M!==S)throw new Error(y[M]);if(this.header=new w,h.inflateGetHeader(this.strm,this.header),b.dictionary&&("string"===typeof b.dictionary?b.dictionary=mp.string2buf(b.dictionary):"[object ArrayBuffer]"===t.call(b.dictionary)&&(b.dictionary=new Uint8Array(b.dictionary)),b.raw&&(M=h.inflateSetDictionary(this.strm,b.dictionary),M!==S)))throw new Error(y[M])}function a(p,b){const M=new Y(b);if(M.push(p),M.err)throw M.Rb||y[M.err];return M.result}Y.prototype.push=function(p,b){const M=this.strm,Q=this.options.Hp,y=this.options.dictionary;let P,w,Y;if(this.ended)return!1;for(w=b===~~b?b:!0===b?x:z,"[object ArrayBuffer]"===t.call(p)?M.input=new Uint8Array(p):M.input=p,M.next_in=0,M.avail_in=M.input.length;;){for(0===M.avail_out&&(M.output=new Uint8Array(Q),M.next_out=0,M.avail_out=Q),P=h.inflate(M,w),P===c&&y&&(P=h.inflateSetDictionary(M,y),P===S?P=h.inflate(M,w):P===g&&(P=c));M.avail_in>0&&P===X&&M.state.wrap>0&&0!==p[M.next_in];)h.inflateReset(M),P=h.inflate(M,w);switch(P){case J:case g:case c:case f:return this.onEnd(P),this.ended=!0,!1}if(Y=M.avail_out,M.next_out&&(0===M.avail_out||P===X))if("string"===this.options.to){let p=mp.utf8border(M.output,M.next_out),b=M.next_out-p,h=mp.buf2string(M.output,p);M.next_out=b,M.avail_out=Q-b,b&&M.output.set(M.output.subarray(p,p+b),0),this.onData(h)}else this.onData(M.output.length===M.next_out?M.output:M.output.subarray(0,M.next_out));if(P!==S||0!==Y){if(P===X)return P=h.inflateEnd(this.strm),this.onEnd(P),this.ended=!0,!0;if(0===M.avail_in)break}}return!0},Y.prototype.onData=function(p){this.chunks.push(p)},Y.prototype.onEnd=function(p){p===S&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Q.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.Rb=this.strm.Rb},p.exports.Inflate=Y,p.exports.inflate=a,p.exports.inflateRaw=function(p,b){return(b=b||{}).raw=!0,a(p,b)},p.exports.ungzip=a,p.exports.constants=M(14834)},14841:p=>{"use strict";const b=(p,b)=>Object.prototype.hasOwnProperty.call(p,b);p.exports.assign=function(p){const M=Array.prototype.slice.call(arguments,1);for(;M.length;){const h=M.shift();if(h){if("object"!==typeof h)throw new TypeError(h+"must be non-object");for(const M in h)b(h,M)&&(p[M]=h[M])}}return p},p.exports.flattenChunks=p=>{let b=0;for(let h=0,Q=p.length;h<Q;h++)b+=p[h].length;const M=new Uint8Array(b);for(let h=0,Q=0,mp=p.length;h<mp;h++){let b=p[h];M.set(b,Q),Q+=b.length}return M}},14850:p=>{"use strict";let b=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){b=!1}const M=new Uint8Array(256);for(let Q=0;Q<256;Q++)M[Q]=Q>=252?6:Q>=248?5:Q>=240?4:Q>=224?3:Q>=192?2:1;M[254]=M[254]=1,p.exports.string2buf=p=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(p);let b,M,h,Q,mp,y=p.length,P=0;for(Q=0;Q<y;Q++)M=p.charCodeAt(Q),55296===(64512&M)&&Q+1<y&&(h=p.charCodeAt(Q+1),56320===(64512&h)&&(M=65536+(M-55296<<10)+(h-56320),Q++)),P+=M<128?1:M<2048?2:M<65536?3:4;for(b=new Uint8Array(P),mp=0,Q=0;mp<P;Q++)M=p.charCodeAt(Q),55296===(64512&M)&&Q+1<y&&(h=p.charCodeAt(Q+1),56320===(64512&h)&&(M=65536+(M-55296<<10)+(h-56320),Q++)),M<128?b[mp++]=M:M<2048?(b[mp++]=192|M>>>6,b[mp++]=128|63&M):M<65536?(b[mp++]=224|M>>>12,b[mp++]=128|M>>>6&63,b[mp++]=128|63&M):(b[mp++]=240|M>>>18,b[mp++]=128|M>>>12&63,b[mp++]=128|M>>>6&63,b[mp++]=128|63&M);return b};p.exports.buf2string=(p,h)=>{const Q=h||p.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(p.subarray(0,h));let mp,y;const P=new Array(2*Q);for(y=0,mp=0;mp<Q;){let b=p[mp++];if(b<128){P[y++]=b;continue}let h=M[b];if(h>4)P[y++]=65533,mp+=h-1;else{for(b&=2===h?31:3===h?15:7;h>1&&mp<Q;)b=b<<6|63&p[mp++],h--;h>1?P[y++]=65533:b<65536?P[y++]=b:(b-=65536,P[y++]=55296|b>>10&1023,P[y++]=56320|1023&b)}}return((p,M)=>{if(M<65534&&p.subarray&&b)return String.fromCharCode.apply(null,p.length===M?p:p.subarray(0,M));let h="";for(let b=0;b<M;b++)h+=String.fromCharCode(p[b]);return h})(P,y)},p.exports.utf8border=(p,b)=>{(b=b||p.length)>p.length&&(b=p.length);let h=b-1;for(;h>=0&&128===(192&p[h]);)h--;return h<0||0===h?b:h+M[p[h]]>b?h:b}},14814:p=>{"use strict";p.exports=(p,b,M,h)=>{let Q=65535&p,mp=p>>>16&65535,y=0;for(;0!==M;){y=M>2e3?2e3:M,M-=y;do{Q=Q+b[h++]|0,mp=mp+Q|0}while(--y);Q%=65521,mp%=65521}return Q|mp<<16}},14834:p=>{"use strict";p.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14819:p=>{"use strict";const b=new Uint32Array((()=>{let p,b=[];for(var M=0;M<256;M++){p=M;for(var h=0;h<8;h++)p=1&p?3988292384^p>>>1:p>>>1;b[M]=p}return b})());p.exports=(p,M,h,Q)=>{const mp=b,y=Q+h;p^=-1;for(let b=Q;b<y;b++)p=p>>>8^mp[255&(p^M[b])];return~p}},14803:(p,b,M)=>{"use strict";const{_tr_init:h,_tr_stored_block:Q,_tr_flush_block:mp,_tr_tally:y,_tr_align:P}=M(14805),w=M(14814),t=M(14819),z=M(14825),{Z_NO_FLUSH:x,Z_PARTIAL_FLUSH:S,Z_FULL_FLUSH:X,Z_FINISH:c,Z_BLOCK:J,Z_OK:g,Z_STREAM_END:f,Z_STREAM_ERROR:Y,Z_DATA_ERROR:a,Z_BUF_ERROR:o,Z_DEFAULT_COMPRESSION:l,Z_FILTERED:L,Z_HUFFMAN_ONLY:u,Z_RLE:e,Z_FIXED:d,Z_DEFAULT_STRATEGY:I,Z_UNKNOWN:G,Z_DEFLATED:v}=M(14834),Z=258,U=262,q=103,B=113,s=666,i=(p,b)=>(p.Rb=z[b],b),T=p=>(p<<1)-(p>4?9:0),W=p=>{let b=p.length;for(;--b>=0;)p[b]=0};let H=(p,b,M)=>(b<<p.hash_shift^M)&p.hash_mask;const E=p=>{const b=p.state;let M=b.pending;M>p.avail_out&&(M=p.avail_out),0!==M&&(p.output.set(b.pending_buf.subarray(b.pending_out,b.pending_out+M),p.next_out),p.next_out+=M,b.pending_out+=M,p.total_out+=M,p.avail_out-=M,b.pending-=M,0===b.pending&&(b.pending_out=0))},j=(p,b)=>{mp(p,p.block_start>=0?p.block_start:-1,p.strstart-p.block_start,b),p.block_start=p.strstart,E(p.strm)},V=(p,b)=>{p.pending_buf[p.pending++]=b},D=(p,b)=>{p.pending_buf[p.pending++]=b>>>8&255,p.pending_buf[p.pending++]=255&b},N=(p,b,M,h)=>{let Q=p.avail_in;return Q>h&&(Q=h),0===Q?0:(p.avail_in-=Q,b.set(p.input.subarray(p.next_in,p.next_in+Q),M),1===p.state.wrap?p.adler=w(p.adler,b,Q,M):2===p.state.wrap&&(p.adler=t(p.adler,b,Q,M)),p.next_in+=Q,p.total_in+=Q,Q)},O=(p,b)=>{let M,h,Q=p.max_chain_length,mp=p.strstart,y=p.prev_length,P=p.nice_match;const w=p.strstart>p.w_size-U?p.strstart-(p.w_size-U):0,t=p.window,z=p.w_mask,x=p.prev,S=p.strstart+Z;let X=t[mp+y-1],c=t[mp+y];p.prev_length>=p.good_match&&(Q>>=2),P>p.lookahead&&(P=p.lookahead);do{if(M=b,t[M+y]===c&&t[M+y-1]===X&&t[M]===t[mp]&&t[++M]===t[mp+1]){mp+=2,M++;do{}while(t[++mp]===t[++M]&&t[++mp]===t[++M]&&t[++mp]===t[++M]&&t[++mp]===t[++M]&&t[++mp]===t[++M]&&t[++mp]===t[++M]&&t[++mp]===t[++M]&&t[++mp]===t[++M]&&mp<S);if(h=Z-(S-mp),mp=S-Z,h>y){if(p.match_start=b,y=h,h>=P)break;X=t[mp+y-1],c=t[mp+y]}}}while((b=x[b&z])>w&&0!==--Q);return y<=p.lookahead?y:p.lookahead},R=p=>{const b=p.w_size;let M,h,Q,mp,y;do{if(mp=p.window_size-p.lookahead-p.strstart,p.strstart>=b+(b-U)){p.window.set(p.window.subarray(b,b+b),0),p.match_start-=b,p.strstart-=b,p.block_start-=b,h=p.hash_size,M=h;do{Q=p.head[--M],p.head[M]=Q>=b?Q-b:0}while(--h);h=b,M=h;do{Q=p.prev[--M],p.prev[M]=Q>=b?Q-b:0}while(--h);mp+=b}if(0===p.strm.avail_in)break;if(h=N(p.strm,p.window,p.strstart+p.lookahead,mp),p.lookahead+=h,p.lookahead+p.insert>=3)for(y=p.strstart-p.insert,p.ins_h=p.window[y],p.ins_h=H(p,p.ins_h,p.window[y+1]);p.insert&&(p.ins_h=H(p,p.ins_h,p.window[y+3-1]),p.prev[y&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=y,y++,p.insert--,!(p.lookahead+p.insert<3)););}while(p.lookahead<U&&0!==p.strm.avail_in)},K=(p,b)=>{let M,h;for(;;){if(p.lookahead<U){if(R(p),p.lookahead<U&&b===x)return 1;if(0===p.lookahead)break}if(M=0,p.lookahead>=3&&(p.ins_h=H(p,p.ins_h,p.window[p.strstart+3-1]),M=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),0!==M&&p.strstart-M<=p.w_size-U&&(p.match_length=O(p,M)),p.match_length>=3)if(h=y(p,p.strstart-p.match_start,p.match_length-3),p.lookahead-=p.match_length,p.match_length<=p.max_lazy_match&&p.lookahead>=3){p.match_length--;do{p.strstart++,p.ins_h=H(p,p.ins_h,p.window[p.strstart+3-1]),M=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart}while(0!==--p.match_length);p.strstart++}else p.strstart+=p.match_length,p.match_length=0,p.ins_h=p.window[p.strstart],p.ins_h=H(p,p.ins_h,p.window[p.strstart+1]);else h=y(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++;if(h&&(j(p,!1),0===p.strm.avail_out))return 1}return p.insert=p.strstart<2?p.strstart:2,b===c?(j(p,!0),0===p.strm.avail_out?3:4):p.last_lit&&(j(p,!1),0===p.strm.avail_out)?1:2},r=(p,b)=>{let M,h,Q;for(;;){if(p.lookahead<U){if(R(p),p.lookahead<U&&b===x)return 1;if(0===p.lookahead)break}if(M=0,p.lookahead>=3&&(p.ins_h=H(p,p.ins_h,p.window[p.strstart+3-1]),M=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),p.prev_length=p.match_length,p.prev_match=p.match_start,p.match_length=2,0!==M&&p.prev_length<p.max_lazy_match&&p.strstart-M<=p.w_size-U&&(p.match_length=O(p,M),p.match_length<=5&&(p.strategy===L||3===p.match_length&&p.strstart-p.match_start>4096)&&(p.match_length=2)),p.prev_length>=3&&p.match_length<=p.prev_length){Q=p.strstart+p.lookahead-3,h=y(p,p.strstart-1-p.prev_match,p.prev_length-3),p.lookahead-=p.prev_length-1,p.prev_length-=2;do{++p.strstart<=Q&&(p.ins_h=H(p,p.ins_h,p.window[p.strstart+3-1]),M=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart)}while(0!==--p.prev_length);if(p.match_available=0,p.match_length=2,p.strstart++,h&&(j(p,!1),0===p.strm.avail_out))return 1}else if(p.match_available){if(h=y(p,0,p.window[p.strstart-1]),h&&j(p,!1),p.strstart++,p.lookahead--,0===p.strm.avail_out)return 1}else p.match_available=1,p.strstart++,p.lookahead--}return p.match_available&&(h=y(p,0,p.window[p.strstart-1]),p.match_available=0),p.insert=p.strstart<2?p.strstart:2,b===c?(j(p,!0),0===p.strm.avail_out?3:4):p.last_lit&&(j(p,!1),0===p.strm.avail_out)?1:2};function k(p,b,M,h,Q){this.good_length=p,this.max_lazy=b,this.nice_length=M,this.max_chain=h,this.func=Q}const A=[new k(0,0,0,0,((p,b)=>{let M=65535;for(M>p.pending_buf_size-5&&(M=p.pending_buf_size-5);;){if(p.lookahead<=1){if(R(p),0===p.lookahead&&b===x)return 1;if(0===p.lookahead)break}p.strstart+=p.lookahead,p.lookahead=0;const h=p.block_start+M;if((0===p.strstart||p.strstart>=h)&&(p.lookahead=p.strstart-h,p.strstart=h,j(p,!1),0===p.strm.avail_out))return 1;if(p.strstart-p.block_start>=p.w_size-U&&(j(p,!1),0===p.strm.avail_out))return 1}return p.insert=0,b===c?(j(p,!0),0===p.strm.avail_out?3:4):(p.strstart>p.block_start&&(j(p,!1),p.strm.avail_out),1)})),new k(4,4,8,4,K),new k(4,5,16,8,K),new k(4,6,32,32,K),new k(4,4,16,16,r),new k(8,16,32,32,r),new k(8,16,128,128,r),new k(8,32,128,256,r),new k(32,128,258,1024,r),new k(32,258,258,4096,r)];function n(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),W(this.dyn_ltree),W(this.dyn_dtree),W(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),W(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),W(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const C=p=>{if(!p||!p.state)return i(p,Y);p.total_in=p.total_out=0,p.data_type=G;const b=p.state;return b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?42:B,p.adler=2===b.wrap?0:1,b.last_flush=x,h(b),g},F=p=>{const b=C(p);var M;return b===g&&((M=p.state).window_size=2*M.w_size,W(M.head),M.max_lazy_match=A[M.level].max_lazy,M.good_match=A[M.level].good_length,M.nice_match=A[M.level].nice_length,M.max_chain_length=A[M.level].max_chain,M.strstart=0,M.block_start=0,M.lookahead=0,M.insert=0,M.match_length=M.prev_length=2,M.match_available=0,M.ins_h=0),b},pp=(p,b,M,h,Q,mp)=>{if(!p)return Y;let y=1;if(b===l&&(b=6),h<0?(y=0,h=-h):h>15&&(y=2,h-=16),Q<1||Q>9||M!==v||h<8||h>15||b<0||b>9||mp<0||mp>d)return i(p,Y);8===h&&(h=9);const P=new n;return p.state=P,P.strm=p,P.wrap=y,P.gzhead=null,P.w_bits=h,P.w_size=1<<P.w_bits,P.w_mask=P.w_size-1,P.hash_bits=Q+7,P.hash_size=1<<P.hash_bits,P.hash_mask=P.hash_size-1,P.hash_shift=~~((P.hash_bits+3-1)/3),P.window=new Uint8Array(2*P.w_size),P.head=new Uint16Array(P.hash_size),P.prev=new Uint16Array(P.w_size),P.lit_bufsize=1<<Q+6,P.pending_buf_size=4*P.lit_bufsize,P.pending_buf=new Uint8Array(P.pending_buf_size),P.d_buf=1*P.lit_bufsize,P.l_buf=3*P.lit_bufsize,P.level=b,P.strategy=mp,P.method=M,F(p)};p.exports.deflateInit=(p,b)=>pp(p,b,v,15,8,I),p.exports.deflateInit2=pp,p.exports.deflateReset=F,p.exports.deflateResetKeep=C,p.exports.deflateSetHeader=(p,b)=>p&&p.state?2!==p.state.wrap?Y:(p.state.gzhead=b,g):Y,p.exports.deflate=(p,b)=>{let M,h;if(!p||!p.state||b>J||b<0)return p?i(p,Y):Y;const mp=p.state;if(!p.output||!p.input&&0!==p.avail_in||mp.status===s&&b!==c)return i(p,0===p.avail_out?o:Y);mp.strm=p;const w=mp.last_flush;if(mp.last_flush=b,42===mp.status)if(2===mp.wrap)p.adler=0,V(mp,31),V(mp,139),V(mp,8),mp.gzhead?(V(mp,(mp.gzhead.text?1:0)+(mp.gzhead.hcrc?2:0)+(mp.gzhead.extra?4:0)+(mp.gzhead.name?8:0)+(mp.gzhead.comment?16:0)),V(mp,255&mp.gzhead.time),V(mp,mp.gzhead.time>>8&255),V(mp,mp.gzhead.time>>16&255),V(mp,mp.gzhead.time>>24&255),V(mp,9===mp.level?2:mp.strategy>=u||mp.level<2?4:0),V(mp,255&mp.gzhead.os),mp.gzhead.extra&&mp.gzhead.extra.length&&(V(mp,255&mp.gzhead.extra.length),V(mp,mp.gzhead.extra.length>>8&255)),mp.gzhead.hcrc&&(p.adler=t(p.adler,mp.pending_buf,mp.pending,0)),mp.gzindex=0,mp.status=69):(V(mp,0),V(mp,0),V(mp,0),V(mp,0),V(mp,0),V(mp,9===mp.level?2:mp.strategy>=u||mp.level<2?4:0),V(mp,3),mp.status=B);else{let b=v+(mp.w_bits-8<<4)<<8,M=-1;M=mp.strategy>=u||mp.level<2?0:mp.level<6?1:6===mp.level?2:3,b|=M<<6,0!==mp.strstart&&(b|=32),b+=31-b%31,mp.status=B,D(mp,b),0!==mp.strstart&&(D(mp,p.adler>>>16),D(mp,65535&p.adler)),p.adler=1}if(69===mp.status)if(mp.gzhead.extra){for(M=mp.pending;mp.gzindex<(65535&mp.gzhead.extra.length)&&(mp.pending!==mp.pending_buf_size||(mp.gzhead.hcrc&&mp.pending>M&&(p.adler=t(p.adler,mp.pending_buf,mp.pending-M,M)),E(p),M=mp.pending,mp.pending!==mp.pending_buf_size));)V(mp,255&mp.gzhead.extra[mp.gzindex]),mp.gzindex++;mp.gzhead.hcrc&&mp.pending>M&&(p.adler=t(p.adler,mp.pending_buf,mp.pending-M,M)),mp.gzindex===mp.gzhead.extra.length&&(mp.gzindex=0,mp.status=73)}else mp.status=73;if(73===mp.status)if(mp.gzhead.name){M=mp.pending;do{if(mp.pending===mp.pending_buf_size&&(mp.gzhead.hcrc&&mp.pending>M&&(p.adler=t(p.adler,mp.pending_buf,mp.pending-M,M)),E(p),M=mp.pending,mp.pending===mp.pending_buf_size)){h=1;break}h=mp.gzindex<mp.gzhead.name.length?255&mp.gzhead.name.charCodeAt(mp.gzindex++):0,V(mp,h)}while(0!==h);mp.gzhead.hcrc&&mp.pending>M&&(p.adler=t(p.adler,mp.pending_buf,mp.pending-M,M)),0===h&&(mp.gzindex=0,mp.status=91)}else mp.status=91;if(91===mp.status)if(mp.gzhead.comment){M=mp.pending;do{if(mp.pending===mp.pending_buf_size&&(mp.gzhead.hcrc&&mp.pending>M&&(p.adler=t(p.adler,mp.pending_buf,mp.pending-M,M)),E(p),M=mp.pending,mp.pending===mp.pending_buf_size)){h=1;break}h=mp.gzindex<mp.gzhead.comment.length?255&mp.gzhead.comment.charCodeAt(mp.gzindex++):0,V(mp,h)}while(0!==h);mp.gzhead.hcrc&&mp.pending>M&&(p.adler=t(p.adler,mp.pending_buf,mp.pending-M,M)),0===h&&(mp.status=q)}else mp.status=q;if(mp.status===q&&(mp.gzhead.hcrc?(mp.pending+2>mp.pending_buf_size&&E(p),mp.pending+2<=mp.pending_buf_size&&(V(mp,255&p.adler),V(mp,p.adler>>8&255),p.adler=0,mp.status=B)):mp.status=B),0!==mp.pending){if(E(p),0===p.avail_out)return mp.last_flush=-1,g}else if(0===p.avail_in&&T(b)<=T(w)&&b!==c)return i(p,o);if(mp.status===s&&0!==p.avail_in)return i(p,o);if(0!==p.avail_in||0!==mp.lookahead||b!==x&&mp.status!==s){let M=mp.strategy===u?((p,b)=>{let M;for(;;){if(0===p.lookahead&&(R(p),0===p.lookahead)){if(b===x)return 1;break}if(p.match_length=0,M=y(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++,M&&(j(p,!1),0===p.strm.avail_out))return 1}return p.insert=0,b===c?(j(p,!0),0===p.strm.avail_out?3:4):p.last_lit&&(j(p,!1),0===p.strm.avail_out)?1:2})(mp,b):mp.strategy===e?((p,b)=>{let M,h,Q,mp;const P=p.window;for(;;){if(p.lookahead<=Z){if(R(p),p.lookahead<=Z&&b===x)return 1;if(0===p.lookahead)break}if(p.match_length=0,p.lookahead>=3&&p.strstart>0&&(Q=p.strstart-1,h=P[Q],h===P[++Q]&&h===P[++Q]&&h===P[++Q])){mp=p.strstart+Z;do{}while(h===P[++Q]&&h===P[++Q]&&h===P[++Q]&&h===P[++Q]&&h===P[++Q]&&h===P[++Q]&&h===P[++Q]&&h===P[++Q]&&Q<mp);p.match_length=Z-(mp-Q),p.match_length>p.lookahead&&(p.match_length=p.lookahead)}if(p.match_length>=3?(M=y(p,1,p.match_length-3),p.lookahead-=p.match_length,p.strstart+=p.match_length,p.match_length=0):(M=y(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++),M&&(j(p,!1),0===p.strm.avail_out))return 1}return p.insert=0,b===c?(j(p,!0),0===p.strm.avail_out?3:4):p.last_lit&&(j(p,!1),0===p.strm.avail_out)?1:2})(mp,b):A[mp.level].func(mp,b);if(3!==M&&4!==M||(mp.status=s),1===M||3===M)return 0===p.avail_out&&(mp.last_flush=-1),g;if(2===M&&(b===S?P(mp):b!==J&&(Q(mp,0,0,!1),b===X&&(W(mp.head),0===mp.lookahead&&(mp.strstart=0,mp.block_start=0,mp.insert=0))),E(p),0===p.avail_out))return mp.last_flush=-1,g}return b!==c?g:mp.wrap<=0?f:(2===mp.wrap?(V(mp,255&p.adler),V(mp,p.adler>>8&255),V(mp,p.adler>>16&255),V(mp,p.adler>>24&255),V(mp,255&p.total_in),V(mp,p.total_in>>8&255),V(mp,p.total_in>>16&255),V(mp,p.total_in>>24&255)):(D(mp,p.adler>>>16),D(mp,65535&p.adler)),E(p),mp.wrap>0&&(mp.wrap=-mp.wrap),0!==mp.pending?g:f)},p.exports.deflateEnd=p=>{if(!p||!p.state)return Y;const b=p.state.status;return 42!==b&&69!==b&&73!==b&&91!==b&&b!==q&&b!==B&&b!==s?i(p,Y):(p.state=null,b===B?i(p,a):g)},p.exports.deflateSetDictionary=(p,b)=>{let M=b.length;if(!p||!p.state)return Y;const h=p.state,Q=h.wrap;if(2===Q||1===Q&&42!==h.status||h.lookahead)return Y;if(1===Q&&(p.adler=w(p.adler,b,M,0)),h.wrap=0,M>=h.w_size){0===Q&&(W(h.head),h.strstart=0,h.block_start=0,h.insert=0);let p=new Uint8Array(h.w_size);p.set(b.subarray(M-h.w_size,M),0),b=p,M=h.w_size}const mp=p.avail_in,y=p.next_in,P=p.input;for(p.avail_in=M,p.next_in=0,p.input=b,R(h);h.lookahead>=3;){let p=h.strstart,b=h.lookahead-2;do{h.ins_h=H(h,h.ins_h,h.window[p+3-1]),h.prev[p&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=p,p++}while(--b);h.strstart=p,h.lookahead=2,R(h)}return h.strstart+=h.lookahead,h.block_start=h.strstart,h.insert=h.lookahead,h.lookahead=0,h.match_length=h.prev_length=2,h.match_available=0,p.next_in=y,p.input=P,p.avail_in=mp,h.wrap=Q,g},p.exports.deflateInfo="pako deflate (from Nodeca project)"},14875:p=>{"use strict";p.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14867:p=>{"use strict";p.exports=function(p,b){let M,h,Q,mp,y,P,w,t,z,x,S,X,c,J,g,f,Y,a,o,l,L,u,e,d;const I=p.state;M=p.next_in,e=p.input,h=M+(p.avail_in-5),Q=p.next_out,d=p.output,mp=Q-(b-p.avail_out),y=Q+(p.avail_out-257),P=I.dmax,w=I.wsize,t=I.whave,z=I.wnext,x=I.window,S=I.hold,X=I.bits,c=I.lencode,J=I.distcode,g=(1<<I.lenbits)-1,f=(1<<I.distbits)-1;p:do{X<15&&(S+=e[M++]<<X,X+=8,S+=e[M++]<<X,X+=8),Y=c[S&g];b:for(;;){if(a=Y>>>24,S>>>=a,X-=a,a=Y>>>16&255,0===a)d[Q++]=65535&Y;else{if(!(16&a)){if(0===(64&a)){Y=c[(65535&Y)+(S&(1<<a)-1)];continue b}if(32&a){I.mode=12;break p}p.Rb="invalid literal/length code",I.mode=30;break p}o=65535&Y,a&=15,a&&(X<a&&(S+=e[M++]<<X,X+=8),o+=S&(1<<a)-1,S>>>=a,X-=a),X<15&&(S+=e[M++]<<X,X+=8,S+=e[M++]<<X,X+=8),Y=J[S&f];M:for(;;){if(a=Y>>>24,S>>>=a,X-=a,a=Y>>>16&255,!(16&a)){if(0===(64&a)){Y=J[(65535&Y)+(S&(1<<a)-1)];continue M}p.Rb="invalid distance code",I.mode=30;break p}if(l=65535&Y,a&=15,X<a&&(S+=e[M++]<<X,X+=8,X<a&&(S+=e[M++]<<X,X+=8)),l+=S&(1<<a)-1,l>P){p.Rb="invalid distance too far back",I.mode=30;break p}if(S>>>=a,X-=a,a=Q-mp,l>a){if(a=l-a,a>t&&I.sane){p.Rb="invalid distance too far back",I.mode=30;break p}if(L=0,u=x,0===z){if(L+=w-a,a<o){o-=a;do{d[Q++]=x[L++]}while(--a);L=Q-l,u=d}}else if(z<a){if(L+=w+z-a,a-=z,a<o){o-=a;do{d[Q++]=x[L++]}while(--a);if(L=0,z<o){a=z,o-=a;do{d[Q++]=x[L++]}while(--a);L=Q-l,u=d}}}else if(L+=z-a,a<o){o-=a;do{d[Q++]=x[L++]}while(--a);L=Q-l,u=d}for(;o>2;)d[Q++]=u[L++],d[Q++]=u[L++],d[Q++]=u[L++],o-=3;o&&(d[Q++]=u[L++],o>1&&(d[Q++]=u[L++]))}else{L=Q-l;do{d[Q++]=d[L++],d[Q++]=d[L++],d[Q++]=d[L++],o-=3}while(o>2);o&&(d[Q++]=d[L++],o>1&&(d[Q++]=d[L++]))}break}}break}}while(M<h&&Q<y);o=X>>3,M-=o,X-=o<<3,S&=(1<<X)-1,p.next_in=M,p.next_out=Q,p.avail_in=M<h?h-M+5:5-(M-h),p.avail_out=Q<y?y-Q+257:257-(Q-y),I.hold=S,I.bits=X}},14863:(p,b,M)=>{"use strict";const h=M(14814),Q=M(14819),mp=M(14867),y=M(14869),{Z_FINISH:P,Z_BLOCK:w,Z_TREES:t,Z_OK:z,Z_STREAM_END:x,Z_NEED_DICT:S,Z_STREAM_ERROR:X,Z_DATA_ERROR:c,Z_MEM_ERROR:J,Z_BUF_ERROR:g,Z_DEFLATED:f}=M(14834),Y=12,a=30,o=p=>(p>>>24&255)+(p>>>8&65280)+((65280&p)<<8)+((255&p)<<24);function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const L=p=>{if(!p||!p.state)return X;const b=p.state;return p.total_in=p.total_out=b.total=0,p.Rb="",b.wrap&&(p.adler=1&b.wrap),b.mode=1,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new Int32Array(852),b.distcode=b.distdyn=new Int32Array(592),b.sane=1,b.back=-1,z},u=p=>{if(!p||!p.state)return X;const b=p.state;return b.wsize=0,b.whave=0,b.wnext=0,L(p)},e=(p,b)=>{let M;if(!p||!p.state)return X;const h=p.state;return b<0?(M=0,b=-b):(M=1+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?X:(null!==h.window&&h.wbits!==b&&(h.window=null),h.wrap=M,h.wbits=b,u(p))},d=(p,b)=>{if(!p)return X;const M=new l;p.state=M,M.window=null;const h=e(p,b);return h!==z&&(p.state=null),h};let I,G,v=!0;const Z=p=>{if(v){I=new Int32Array(512),G=new Int32Array(32);let b=0;for(;b<144;)p.lens[b++]=8;for(;b<256;)p.lens[b++]=9;for(;b<280;)p.lens[b++]=7;for(;b<288;)p.lens[b++]=8;for(y(1,p.lens,0,288,I,0,p.work,{bits:9}),b=0;b<32;)p.lens[b++]=5;y(2,p.lens,0,32,G,0,p.work,{bits:5}),v=!1}p.lencode=I,p.lenbits=9,p.distcode=G,p.distbits=5},U=(p,b,M,h)=>{let Q;const mp=p.state;return null===mp.window&&(mp.wsize=1<<mp.wbits,mp.wnext=0,mp.whave=0,mp.window=new Uint8Array(mp.wsize)),h>=mp.wsize?(mp.window.set(b.subarray(M-mp.wsize,M),0),mp.wnext=0,mp.whave=mp.wsize):(Q=mp.wsize-mp.wnext,Q>h&&(Q=h),mp.window.set(b.subarray(M-h,M-h+Q),mp.wnext),(h-=Q)?(mp.window.set(b.subarray(M-h,M),0),mp.wnext=h,mp.whave=mp.wsize):(mp.wnext+=Q,mp.wnext===mp.wsize&&(mp.wnext=0),mp.whave<mp.wsize&&(mp.whave+=Q))),0};p.exports.inflateReset=u,p.exports.inflateReset2=e,p.exports.inflateResetKeep=L,p.exports.inflateInit=p=>d(p,15),p.exports.inflateInit2=d,p.exports.inflate=(p,b)=>{let M,l,L,u,e,d,I,G,v,q,B,s,i,T,W,H,E,j,V,D,N,O,R=0;const K=new Uint8Array(4);let r,k;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!p||!p.state||!p.output||!p.input&&0!==p.avail_in)return X;M=p.state,M.mode===Y&&(M.mode=13),e=p.next_out,L=p.output,I=p.avail_out,u=p.next_in,l=p.input,d=p.avail_in,G=M.hold,v=M.bits,q=d,B=I,O=z;p:for(;;)switch(M.mode){case 1:if(0===M.wrap){M.mode=13;break}for(;v<16;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}if(2&M.wrap&&35615===G){M.check=0,K[0]=255&G,K[1]=G>>>8&255,M.check=Q(M.check,K,2,0),G=0,v=0,M.mode=2;break}if(M.flags=0,M.head&&(M.head.done=!1),!(1&M.wrap)||(((255&G)<<8)+(G>>8))%31){p.Rb="incorrect header check",M.mode=a;break}if((15&G)!==f){p.Rb="unknown compression method",M.mode=a;break}if(G>>>=4,v-=4,N=8+(15&G),0===M.wbits)M.wbits=N;else if(N>M.wbits){p.Rb="invalid window size",M.mode=a;break}M.dmax=1<<M.wbits,p.adler=M.check=1,M.mode=512&G?10:Y,G=0,v=0;break;case 2:for(;v<16;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}if(M.flags=G,(255&M.flags)!==f){p.Rb="unknown compression method",M.mode=a;break}if(57344&M.flags){p.Rb="unknown header flags set",M.mode=a;break}M.head&&(M.head.text=G>>8&1),512&M.flags&&(K[0]=255&G,K[1]=G>>>8&255,M.check=Q(M.check,K,2,0)),G=0,v=0,M.mode=3;case 3:for(;v<32;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}M.head&&(M.head.time=G),512&M.flags&&(K[0]=255&G,K[1]=G>>>8&255,K[2]=G>>>16&255,K[3]=G>>>24&255,M.check=Q(M.check,K,4,0)),G=0,v=0,M.mode=4;case 4:for(;v<16;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}M.head&&(M.head.xflags=255&G,M.head.os=G>>8),512&M.flags&&(K[0]=255&G,K[1]=G>>>8&255,M.check=Q(M.check,K,2,0)),G=0,v=0,M.mode=5;case 5:if(1024&M.flags){for(;v<16;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}M.length=G,M.head&&(M.head.extra_len=G),512&M.flags&&(K[0]=255&G,K[1]=G>>>8&255,M.check=Q(M.check,K,2,0)),G=0,v=0}else M.head&&(M.head.extra=null);M.mode=6;case 6:if(1024&M.flags&&(s=M.length,s>d&&(s=d),s&&(M.head&&(N=M.head.extra_len-M.length,M.head.extra||(M.head.extra=new Uint8Array(M.head.extra_len)),M.head.extra.set(l.subarray(u,u+s),N)),512&M.flags&&(M.check=Q(M.check,l,s,u)),d-=s,u+=s,M.length-=s),M.length))break p;M.length=0,M.mode=7;case 7:if(2048&M.flags){if(0===d)break p;s=0;do{N=l[u+s++],M.head&&N&&M.length<65536&&(M.head.name+=String.fromCharCode(N))}while(N&&s<d);if(512&M.flags&&(M.check=Q(M.check,l,s,u)),d-=s,u+=s,N)break p}else M.head&&(M.head.name=null);M.length=0,M.mode=8;case 8:if(4096&M.flags){if(0===d)break p;s=0;do{N=l[u+s++],M.head&&N&&M.length<65536&&(M.head.comment+=String.fromCharCode(N))}while(N&&s<d);if(512&M.flags&&(M.check=Q(M.check,l,s,u)),d-=s,u+=s,N)break p}else M.head&&(M.head.comment=null);M.mode=9;case 9:if(512&M.flags){for(;v<16;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}if(G!==(65535&M.check)){p.Rb="header crc mismatch",M.mode=a;break}G=0,v=0}M.head&&(M.head.hcrc=M.flags>>9&1,M.head.done=!0),p.adler=M.check=0,M.mode=Y;break;case 10:for(;v<32;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}p.adler=M.check=o(G),G=0,v=0,M.mode=11;case 11:if(0===M.havedict)return p.next_out=e,p.avail_out=I,p.next_in=u,p.avail_in=d,M.hold=G,M.bits=v,S;p.adler=M.check=1,M.mode=Y;case Y:if(b===w||b===t)break p;case 13:if(M.last){G>>>=7&v,v-=7&v,M.mode=27;break}for(;v<3;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}switch(M.last=1&G,G>>>=1,v-=1,3&G){case 0:M.mode=14;break;case 1:if(Z(M),M.mode=20,b===t){G>>>=2,v-=2;break p}break;case 2:M.mode=17;break;case 3:p.Rb="invalid block type",M.mode=a}G>>>=2,v-=2;break;case 14:for(G>>>=7&v,v-=7&v;v<32;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}if((65535&G)!==(G>>>16^65535)){p.Rb="invalid stored block lengths",M.mode=a;break}if(M.length=65535&G,G=0,v=0,M.mode=15,b===t)break p;case 15:M.mode=16;case 16:if(s=M.length,s){if(s>d&&(s=d),s>I&&(s=I),0===s)break p;L.set(l.subarray(u,u+s),e),d-=s,u+=s,I-=s,e+=s,M.length-=s;break}M.mode=Y;break;case 17:for(;v<14;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}if(M.nlen=257+(31&G),G>>>=5,v-=5,M.ndist=1+(31&G),G>>>=5,v-=5,M.ncode=4+(15&G),G>>>=4,v-=4,M.nlen>286||M.ndist>30){p.Rb="too many length or distance symbols",M.mode=a;break}M.have=0,M.mode=18;case 18:for(;M.have<M.ncode;){for(;v<3;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}M.lens[A[M.have++]]=7&G,G>>>=3,v-=3}for(;M.have<19;)M.lens[A[M.have++]]=0;if(M.lencode=M.lendyn,M.lenbits=7,r={bits:M.lenbits},O=y(0,M.lens,0,19,M.lencode,0,M.work,r),M.lenbits=r.bits,O){p.Rb="invalid code lengths set",M.mode=a;break}M.have=0,M.mode=19;case 19:for(;M.have<M.nlen+M.ndist;){for(;R=M.lencode[G&(1<<M.lenbits)-1],W=R>>>24,H=R>>>16&255,E=65535&R,!(W<=v);){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}if(E<16)G>>>=W,v-=W,M.lens[M.have++]=E;else{if(16===E){for(k=W+2;v<k;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}if(G>>>=W,v-=W,0===M.have){p.Rb="invalid bit length repeat",M.mode=a;break}N=M.lens[M.have-1],s=3+(3&G),G>>>=2,v-=2}else if(17===E){for(k=W+3;v<k;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}G>>>=W,v-=W,N=0,s=3+(7&G),G>>>=3,v-=3}else{for(k=W+7;v<k;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}G>>>=W,v-=W,N=0,s=11+(127&G),G>>>=7,v-=7}if(M.have+s>M.nlen+M.ndist){p.Rb="invalid bit length repeat",M.mode=a;break}for(;s--;)M.lens[M.have++]=N}}if(M.mode===a)break;if(0===M.lens[256]){p.Rb="invalid code -- missing end-of-block",M.mode=a;break}if(M.lenbits=9,r={bits:M.lenbits},O=y(1,M.lens,0,M.nlen,M.lencode,0,M.work,r),M.lenbits=r.bits,O){p.Rb="invalid literal/lengths set",M.mode=a;break}if(M.distbits=6,M.distcode=M.distdyn,r={bits:M.distbits},O=y(2,M.lens,M.nlen,M.ndist,M.distcode,0,M.work,r),M.distbits=r.bits,O){p.Rb="invalid distances set",M.mode=a;break}if(M.mode=20,b===t)break p;case 20:M.mode=21;case 21:if(d>=6&&I>=258){p.next_out=e,p.avail_out=I,p.next_in=u,p.avail_in=d,M.hold=G,M.bits=v,mp(p,B),e=p.next_out,L=p.output,I=p.avail_out,u=p.next_in,l=p.input,d=p.avail_in,G=M.hold,v=M.bits,M.mode===Y&&(M.back=-1);break}for(M.back=0;R=M.lencode[G&(1<<M.lenbits)-1],W=R>>>24,H=R>>>16&255,E=65535&R,!(W<=v);){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}if(H&&0===(240&H)){for(j=W,V=H,D=E;R=M.lencode[D+((G&(1<<j+V)-1)>>j)],W=R>>>24,H=R>>>16&255,E=65535&R,!(j+W<=v);){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}G>>>=j,v-=j,M.back+=j}if(G>>>=W,v-=W,M.back+=W,M.length=E,0===H){M.mode=26;break}if(32&H){M.back=-1,M.mode=Y;break}if(64&H){p.Rb="invalid literal/length code",M.mode=a;break}M.extra=15&H,M.mode=22;case 22:if(M.extra){for(k=M.extra;v<k;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}M.length+=G&(1<<M.extra)-1,G>>>=M.extra,v-=M.extra,M.back+=M.extra}M.was=M.length,M.mode=23;case 23:for(;R=M.distcode[G&(1<<M.distbits)-1],W=R>>>24,H=R>>>16&255,E=65535&R,!(W<=v);){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}if(0===(240&H)){for(j=W,V=H,D=E;R=M.distcode[D+((G&(1<<j+V)-1)>>j)],W=R>>>24,H=R>>>16&255,E=65535&R,!(j+W<=v);){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}G>>>=j,v-=j,M.back+=j}if(G>>>=W,v-=W,M.back+=W,64&H){p.Rb="invalid distance code",M.mode=a;break}M.offset=E,M.extra=15&H,M.mode=24;case 24:if(M.extra){for(k=M.extra;v<k;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}M.offset+=G&(1<<M.extra)-1,G>>>=M.extra,v-=M.extra,M.back+=M.extra}if(M.offset>M.dmax){p.Rb="invalid distance too far back",M.mode=a;break}M.mode=25;case 25:if(0===I)break p;if(s=B-I,M.offset>s){if(s=M.offset-s,s>M.whave&&M.sane){p.Rb="invalid distance too far back",M.mode=a;break}s>M.wnext?(s-=M.wnext,i=M.wsize-s):i=M.wnext-s,s>M.length&&(s=M.length),T=M.window}else T=L,i=e-M.offset,s=M.length;s>I&&(s=I),I-=s,M.length-=s;do{L[e++]=T[i++]}while(--s);0===M.length&&(M.mode=21);break;case 26:if(0===I)break p;L[e++]=M.length,I--,M.mode=21;break;case 27:if(M.wrap){for(;v<32;){if(0===d)break p;d--,G|=l[u++]<<v,v+=8}if(B-=I,p.total_out+=B,M.total+=B,B&&(p.adler=M.check=M.flags?Q(M.check,L,B,e-B):h(M.check,L,B,e-B)),B=I,(M.flags?G:o(G))!==M.check){p.Rb="incorrect data check",M.mode=a;break}G=0,v=0}M.mode=28;case 28:if(M.wrap&&M.flags){for(;v<32;){if(0===d)break p;d--,G+=l[u++]<<v,v+=8}if(G!==(4294967295&M.total)){p.Rb="incorrect length check",M.mode=a;break}G=0,v=0}M.mode=29;case 29:O=x;break p;case a:O=c;break p;case 31:return J;default:return X}return p.next_out=e,p.avail_out=I,p.next_in=u,p.avail_in=d,M.hold=G,M.bits=v,(M.wsize||B!==p.avail_out&&M.mode<a&&(M.mode<27||b!==P))&&U(p,p.output,p.next_out,B-p.avail_out)?(M.mode=31,J):(q-=p.avail_in,B-=p.avail_out,p.total_in+=q,p.total_out+=B,M.total+=B,M.wrap&&B&&(p.adler=M.check=M.flags?Q(M.check,L,B,p.next_out-B):h(M.check,L,B,p.next_out-B)),p.data_type=M.bits+(M.last?64:0)+(M.mode===Y?128:0)+(20===M.mode||15===M.mode?256:0),(0===q&&0===B||b===P)&&O===z&&(O=g),O)},p.exports.inflateEnd=p=>{if(!p||!p.state)return X;let b=p.state;return b.window&&(b.window=null),p.state=null,z},p.exports.inflateGetHeader=(p,b)=>{if(!p||!p.state)return X;const M=p.state;return 0===(2&M.wrap)?X:(M.head=b,b.done=!1,z)},p.exports.inflateSetDictionary=(p,b)=>{const M=b.length;let Q,mp,y;return p&&p.state?(Q=p.state,0!==Q.wrap&&11!==Q.mode?X:11===Q.mode&&(mp=1,mp=h(mp,b,M,0),mp!==Q.check)?c:(y=U(p,b,M,M),y?(Q.mode=31,J):(Q.havedict=1,z))):X},p.exports.inflateInfo="pako inflate (from Nodeca project)"},14869:p=>{"use strict";const b=15,M=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),h=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Q=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),mp=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);p.exports=(p,y,P,w,t,z,x,S)=>{const X=S.bits;let c,J,g,f,Y,a,o=0,l=0,L=0,u=0,e=0,d=0,I=0,G=0,v=0,Z=0,U=null,q=0;const B=new Uint16Array(16),s=new Uint16Array(16);let i,T,W,H=null,E=0;for(o=0;o<=b;o++)B[o]=0;for(l=0;l<w;l++)B[y[P+l]]++;for(e=X,u=b;u>=1&&0===B[u];u--);if(e>u&&(e=u),0===u)return t[z++]=20971520,t[z++]=20971520,S.bits=1,0;for(L=1;L<u&&0===B[L];L++);for(e<L&&(e=L),G=1,o=1;o<=b;o++)if(G<<=1,G-=B[o],G<0)return-1;if(G>0&&(0===p||1!==u))return-1;for(s[1]=0,o=1;o<b;o++)s[o+1]=s[o]+B[o];for(l=0;l<w;l++)0!==y[P+l]&&(x[s[y[P+l]]++]=l);if(0===p?(U=H=x,a=19):1===p?(U=M,q-=257,H=h,E-=257,a=256):(U=Q,H=mp,a=-1),Z=0,l=0,o=L,Y=z,d=e,I=0,g=-1,v=1<<e,f=v-1,1===p&&v>852||2===p&&v>592)return 1;for(;;){i=o-I,x[l]<a?(T=0,W=x[l]):x[l]>a?(T=H[E+x[l]],W=U[q+x[l]]):(T=96,W=0),c=1<<o-I,J=1<<d,L=J;do{J-=c,t[Y+(Z>>I)+J]=i<<24|T<<16|W}while(0!==J);for(c=1<<o-1;Z&c;)c>>=1;if(0!==c?(Z&=c-1,Z+=c):Z=0,l++,0===--B[o]){if(o===u)break;o=y[P+x[l]]}if(o>e&&(Z&f)!==g){for(0===I&&(I=e),Y+=L,d=o-I,G=1<<d;d+I<u&&(G-=B[d+I],!(G<=0));)d++,G<<=1;if(v+=1<<d,1===p&&v>852||2===p&&v>592)return 1;g=Z&f,t[g]=e<<24|d<<16|Y-z}}return 0!==Z&&(t[Y+Z]=o-I<<24|64<<16),S.bits=e,0}},14825:p=>{"use strict";p.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14805:p=>{"use strict";function b(p){let b=p.length;for(;--b>=0;)p[b]=0}const M=256,h=286,Q=30,mp=15,y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),P=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),w=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),t=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),z=new Array(576);b(z);const x=new Array(60);b(x);const S=new Array(512);b(S);const X=new Array(256);b(X);const c=new Array(29);b(c);const J=new Array(Q);function g(p,b,M,h,Q){this.static_tree=p,this.extra_bits=b,this.extra_base=M,this.elems=h,this.max_length=Q,this.has_stree=p&&p.length}let f,Y,a;function o(p,b){this.dyn_tree=p,this.max_code=0,this.stat_desc=b}b(J);const l=p=>p<256?S[p]:S[256+(p>>>7)],L=(p,b)=>{p.pending_buf[p.pending++]=255&b,p.pending_buf[p.pending++]=b>>>8&255},u=(p,b,M)=>{p.bi_valid>16-M?(p.bi_buf|=b<<p.bi_valid&65535,L(p,p.bi_buf),p.bi_buf=b>>16-p.bi_valid,p.bi_valid+=M-16):(p.bi_buf|=b<<p.bi_valid&65535,p.bi_valid+=M)},e=(p,b,M)=>{u(p,M[2*b],M[2*b+1])},d=(p,b)=>{let M=0;do{M|=1&p,p>>>=1,M<<=1}while(--b>0);return M>>>1},I=(p,b,M)=>{const h=new Array(16);let Q,y,P=0;for(Q=1;Q<=mp;Q++)h[Q]=P=P+M[Q-1]<<1;for(y=0;y<=b;y++){let b=p[2*y+1];0!==b&&(p[2*y]=d(h[b]++,b))}},G=p=>{let b;for(b=0;b<h;b++)p.dyn_ltree[2*b]=0;for(b=0;b<Q;b++)p.dyn_dtree[2*b]=0;for(b=0;b<19;b++)p.bl_tree[2*b]=0;p.dyn_ltree[512]=1,p.opt_len=p.static_len=0,p.last_lit=p.matches=0},v=p=>{p.bi_valid>8?L(p,p.bi_buf):p.bi_valid>0&&(p.pending_buf[p.pending++]=p.bi_buf),p.bi_buf=0,p.bi_valid=0},Z=(p,b,M,h)=>{const Q=2*b,mp=2*M;return p[Q]<p[mp]||p[Q]===p[mp]&&h[b]<=h[M]},U=(p,b,M)=>{const h=p.heap[M];let Q=M<<1;for(;Q<=p.heap_len&&(Q<p.heap_len&&Z(b,p.heap[Q+1],p.heap[Q],p.depth)&&Q++,!Z(b,h,p.heap[Q],p.depth));)p.heap[M]=p.heap[Q],M=Q,Q<<=1;p.heap[M]=h},q=(p,b,h)=>{let Q,mp,w,t,z=0;if(0!==p.last_lit)do{Q=p.pending_buf[p.d_buf+2*z]<<8|p.pending_buf[p.d_buf+2*z+1],mp=p.pending_buf[p.l_buf+z],z++,0===Q?e(p,mp,b):(w=X[mp],e(p,w+M+1,b),t=y[w],0!==t&&(mp-=c[w],u(p,mp,t)),Q--,w=l(Q),e(p,w,h),t=P[w],0!==t&&(Q-=J[w],u(p,Q,t)))}while(z<p.last_lit);e(p,256,b)},B=(p,b)=>{const M=b.dyn_tree,h=b.stat_desc.static_tree,Q=b.stat_desc.has_stree,y=b.stat_desc.elems;let P,w,t,z=-1;for(p.heap_len=0,p.heap_max=573,P=0;P<y;P++)0!==M[2*P]?(p.heap[++p.heap_len]=z=P,p.depth[P]=0):M[2*P+1]=0;for(;p.heap_len<2;)t=p.heap[++p.heap_len]=z<2?++z:0,M[2*t]=1,p.depth[t]=0,p.opt_len--,Q&&(p.static_len-=h[2*t+1]);for(b.max_code=z,P=p.heap_len>>1;P>=1;P--)U(p,M,P);t=y;do{P=p.heap[1],p.heap[1]=p.heap[p.heap_len--],U(p,M,1),w=p.heap[1],p.heap[--p.heap_max]=P,p.heap[--p.heap_max]=w,M[2*t]=M[2*P]+M[2*w],p.depth[t]=(p.depth[P]>=p.depth[w]?p.depth[P]:p.depth[w])+1,M[2*P+1]=M[2*w+1]=t,p.heap[1]=t++,U(p,M,1)}while(p.heap_len>=2);p.heap[--p.heap_max]=p.heap[1],((p,b)=>{const M=b.dyn_tree,h=b.max_code,Q=b.stat_desc.static_tree,y=b.stat_desc.has_stree,P=b.stat_desc.extra_bits,w=b.stat_desc.extra_base,t=b.stat_desc.max_length;let z,x,S,X,c,J,g=0;for(X=0;X<=mp;X++)p.bl_count[X]=0;for(M[2*p.heap[p.heap_max]+1]=0,z=p.heap_max+1;z<573;z++)x=p.heap[z],X=M[2*M[2*x+1]+1]+1,X>t&&(X=t,g++),M[2*x+1]=X,x>h||(p.bl_count[X]++,c=0,x>=w&&(c=P[x-w]),J=M[2*x],p.opt_len+=J*(X+c),y&&(p.static_len+=J*(Q[2*x+1]+c)));if(0!==g){do{for(X=t-1;0===p.bl_count[X];)X--;p.bl_count[X]--,p.bl_count[X+1]+=2,p.bl_count[t]--,g-=2}while(g>0);for(X=t;0!==X;X--)for(x=p.bl_count[X];0!==x;)S=p.heap[--z],S>h||(M[2*S+1]!==X&&(p.opt_len+=(X-M[2*S+1])*M[2*S],M[2*S+1]=X),x--)}})(p,b),I(M,z,p.bl_count)},s=(p,b,M)=>{let h,Q,mp=-1,y=b[1],P=0,w=7,t=4;for(0===y&&(w=138,t=3),b[2*(M+1)+1]=65535,h=0;h<=M;h++)Q=y,y=b[2*(h+1)+1],++P<w&&Q===y||(P<t?p.bl_tree[2*Q]+=P:0!==Q?(Q!==mp&&p.bl_tree[2*Q]++,p.bl_tree[32]++):P<=10?p.bl_tree[34]++:p.bl_tree[36]++,P=0,mp=Q,0===y?(w=138,t=3):Q===y?(w=6,t=3):(w=7,t=4))},i=(p,b,M)=>{let h,Q,mp=-1,y=b[1],P=0,w=7,t=4;for(0===y&&(w=138,t=3),h=0;h<=M;h++)if(Q=y,y=b[2*(h+1)+1],!(++P<w&&Q===y)){if(P<t)do{e(p,Q,p.bl_tree)}while(0!==--P);else 0!==Q?(Q!==mp&&(e(p,Q,p.bl_tree),P--),e(p,16,p.bl_tree),u(p,P-3,2)):P<=10?(e(p,17,p.bl_tree),u(p,P-3,3)):(e(p,18,p.bl_tree),u(p,P-11,7));P=0,mp=Q,0===y?(w=138,t=3):Q===y?(w=6,t=3):(w=7,t=4)}};let T=!1;const W=(p,b,M,h)=>{u(p,0+(h?1:0),3),((p,b,M,h)=>{v(p),h&&(L(p,M),L(p,~M)),p.pending_buf.set(p.window.subarray(b,b+M),p.pending),p.pending+=M})(p,b,M,!0)};p.exports._tr_init=p=>{T||((()=>{let p,b,M,t,o;const l=new Array(16);for(M=0,t=0;t<28;t++)for(c[t]=M,p=0;p<1<<y[t];p++)X[M++]=t;for(X[M-1]=t,o=0,t=0;t<16;t++)for(J[t]=o,p=0;p<1<<P[t];p++)S[o++]=t;for(o>>=7;t<Q;t++)for(J[t]=o<<7,p=0;p<1<<P[t]-7;p++)S[256+o++]=t;for(b=0;b<=mp;b++)l[b]=0;for(p=0;p<=143;)z[2*p+1]=8,p++,l[8]++;for(;p<=255;)z[2*p+1]=9,p++,l[9]++;for(;p<=279;)z[2*p+1]=7,p++,l[7]++;for(;p<=287;)z[2*p+1]=8,p++,l[8]++;for(I(z,287,l),p=0;p<Q;p++)x[2*p+1]=5,x[2*p]=d(p,5);f=new g(z,y,257,h,mp),Y=new g(x,P,0,Q,mp),a=new g(new Array(0),w,0,19,7)})(),T=!0),p.l_desc=new o(p.dyn_ltree,f),p.d_desc=new o(p.dyn_dtree,Y),p.bl_desc=new o(p.bl_tree,a),p.bi_buf=0,p.bi_valid=0,G(p)},p.exports._tr_stored_block=W,p.exports._tr_flush_block=(p,b,h,Q)=>{let mp,y,P=0;p.level>0?(2===p.strm.data_type&&(p.strm.data_type=(p=>{let b,h=4093624447;for(b=0;b<=31;b++,h>>>=1)if(1&h&&0!==p.dyn_ltree[2*b])return 0;if(0!==p.dyn_ltree[18]||0!==p.dyn_ltree[20]||0!==p.dyn_ltree[26])return 1;for(b=32;b<M;b++)if(0!==p.dyn_ltree[2*b])return 1;return 0})(p)),B(p,p.l_desc),B(p,p.d_desc),P=(p=>{let b;for(s(p,p.dyn_ltree,p.l_desc.max_code),s(p,p.dyn_dtree,p.d_desc.max_code),B(p,p.bl_desc),b=18;b>=3&&0===p.bl_tree[2*t[b]+1];b--);return p.opt_len+=3*(b+1)+5+5+4,b})(p),mp=p.opt_len+3+7>>>3,y=p.static_len+3+7>>>3,y<=mp&&(mp=y)):mp=y=h+5,h+4<=mp&&-1!==b?W(p,b,h,Q):4===p.strategy||y===mp?(u(p,2+(Q?1:0),3),q(p,z,x)):(u(p,4+(Q?1:0),3),((p,b,M,h)=>{let Q;for(u(p,b-257,5),u(p,M-1,5),u(p,h-4,4),Q=0;Q<h;Q++)u(p,p.bl_tree[2*t[Q]+1],3);i(p,p.dyn_ltree,b-1),i(p,p.dyn_dtree,M-1)})(p,p.l_desc.max_code+1,p.d_desc.max_code+1,P+1),q(p,p.dyn_ltree,p.dyn_dtree)),G(p),Q&&v(p)},p.exports._tr_tally=(p,b,h)=>(p.pending_buf[p.d_buf+2*p.last_lit]=b>>>8&255,p.pending_buf[p.d_buf+2*p.last_lit+1]=255&b,p.pending_buf[p.l_buf+p.last_lit]=255&h,p.last_lit++,0===b?p.dyn_ltree[2*h]++:(p.matches++,b--,p.dyn_ltree[2*(X[h]+M+1)]++,p.dyn_dtree[2*l(b)]++),p.last_lit===p.lit_bufsize-1),p.exports._tr_align=p=>{u(p,2,3),e(p,256,z),(p=>{16===p.bi_valid?(L(p,p.bi_buf),p.bi_buf=0,p.bi_valid=0):p.bi_valid>=8&&(p.pending_buf[p.pending++]=255&p.bi_buf,p.bi_buf>>=8,p.bi_valid-=8)})(p)}},14853:p=>{"use strict";p.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Rb="",this.state=null,this.data_type=2,this.adler=0}},13558:p=>{function b(p,b,M){for(var h=p.length,Q=-1/0,mp=1/0,y=0;y<h;y++){var P=(M[0][y]-p[y])/b[y],w=(M[1][y]-p[y])/b[y];if(P>w){var t=P;P=w,w=t}if(w<Q||P>mp)return 1/0;P>Q&&(Q=P),w<mp&&(mp=w)}return Q>mp?1/0:Q}p.exports=function(p,M,h,Q){var mp=b(M,h,Q);if(mp===1/0)p=null;else{p=p||[];for(var y=0;y<M.length;y++)p[y]=M[y]+h[y]*mp}return p},p.exports.distance=b},14932:(p,b,M)=>{"use strict";M.d(b,{d:()=>y});var h=M(24);const Q=h.useLayoutEffect;const mp=function(p){var b=(0,h.useRef)(p);return Q((function(){b.current=p})),b};var y=function(p){var b=mp(p);(0,h.ob)((function(){var p=function(p){var M;if(null!=b.current&&(M=b.current(p)),p.defaultPrevented&&(p.returnValue=""),"string"===typeof M)return p.returnValue=M,M};return window.addEventListener("beforeunload",p),function(){window.removeEventListener("beforeunload",p)}}),[])}},14900:(p,b,M)=>{"use strict";var h=M(14902),Q=Array.prototype.concat,mp=Array.prototype.slice,y=p.exports=function(p){for(var b=[],M=0,y=p.length;M<y;M++){var P=p[M];h(P)?b=Q.call(b,mp.call(P)):b.push(P)}return b};y.wrap=function(p){return function(){return p(y(arguments))}}},14902:p=>{p.exports=function(p){return!(!p||"string"===typeof p)&&(p instanceof Array||Array.isArray(p)||p.length>=0&&(p.splice instanceof Function||Object.getOwnPropertyDescriptor(p,p.length-1)&&"String"!==p.constructor.name))}},14748:(p,b,M)=>{var h=M(14756);function Q(p){for(var b,M,Q=0,mp=p.length,y=0;y<p.length;){for(b=p[y],M=0;y<mp&&p[y]===b;)++y,++M;Q+=h.log2(M)/7|0,Q+=h.log2(b>>>0)/7|0,Q+=2}return Q}b.size=Q,b.encode=function(p,b){b||(b=new Uint8Array(Q(p)));for(var M,h,mp=0,y=b.length,P=0;P<p.length;){for(M=p[P],h=0;P<p.length&&p[P]===M;)++P,++h;for(;mp<y&&h>=128;)b[mp++]=128+(127&h),h>>>=7;if(mp>=y)throw new Error("RLE buffer overflow");for(b[mp++]=h,M>>>=0;mp<y&&M>=128;)b[mp++]=128+(127&M),M>>>=7;if(mp>=y)throw new Error("RLE buffer overflow");b[mp++]=M}return b},b.decode=function(p,b){for(var M,h,Q,mp,y=b.length,P=p.length,w=0,t=0;t<P;){for(M=0,h=0;t<P&&p[t]>=128;)M+=(127&p[t++])<<h,h+=7;if(M+=p[t++]<<h,t>=P)throw new Error("RLE buffer underrun");if(w+M>y)throw new Error("Chunk buffer overflow");for(Q=0,h=0;t<P&&p[t]>=128;)Q+=(127&p[t++])<<h,h+=7;if(t>=P)throw new Error("RLE buffer underrun");for(Q+=p[t++]<<h,mp=0;mp<M;++mp)b[w++]=Q}return b}},14756:(p,b)=>{"use strict";function M(p){var b=32;return(p&=-p)&&b--,65535&p&&(b-=16),16711935&p&&(b-=8),252645135&p&&(b-=4),858993459&p&&(b-=2),1431655765&p&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(p){return(p>0)-(p<0)},b.abs=function(p){var b=p>>31;return(p^b)-b},b.min=function(p,b){return b^(p^b)&-(p<b)},b.max=function(p,b){return p^(p^b)&-(p<b)},b.isPow2=function(p){return!(p&p-1)&&!!p},b.log2=function(p){var b,M;return b=(p>65535)<<4,b|=M=((p>>>=b)>255)<<3,b|=M=((p>>>=M)>15)<<2,(b|=M=((p>>>=M)>3)<<1)|(p>>>=M)>>1},b.log10=function(p){return p>=1e9?9:p>=1e8?8:p>=1e7?7:p>=1e6?6:p>=1e5?5:p>=1e4?4:p>=1e3?3:p>=100?2:p>=10?1:0},b.popCount=function(p){return 16843009*((p=(858993459&(p-=p>>>1&1431655765))+(p>>>2&858993459))+(p>>>4)&252645135)>>>24},b.countTrailingZeros=M,b.nextPow2=function(p){return p+=0===p,--p,p|=p>>>1,p|=p>>>2,p|=p>>>4,p|=p>>>8,(p|=p>>>16)+1},b.prevPow2=function(p){return p|=p>>>1,p|=p>>>2,p|=p>>>4,p|=p>>>8,(p|=p>>>16)-(p>>>1)},b.parity=function(p){return p^=p>>>16,p^=p>>>8,p^=p>>>4,27030>>>(p&=15)&1};var h=new Array(256);!function(p){for(var b=0;b<256;++b){var M=b,h=b,Q=7;for(M>>>=1;M;M>>>=1)h<<=1,h|=1&M,--Q;p[b]=h<<Q&255}}(h),b.reverse=function(p){return h[255&p]<<24|h[p>>>8&255]<<16|h[p>>>16&255]<<8|h[p>>>24&255]},b.interleave2=function(p,b){return(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p&=65535)|p<<8))|p<<4))|p<<2))|p<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(p,b){return(p=65535&((p=16711935&((p=252645135&((p=858993459&((p=p>>>b&1431655765)|p>>>1))|p>>>2))|p>>>4))|p>>>16))<<16>>16},b.interleave3=function(p,b,M){return p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2),(p|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2))<<2},b.deinterleave3=function(p,b){return(p=1023&((p=4278190335&((p=251719695&((p=3272356035&((p=p>>>b&1227133513)|p>>>2))|p>>>4))|p>>>8))|p>>>16))<<22>>22},b.nextCombination=function(p){var b=p|p-1;return b+1|(~b&-~b)-1>>>M(p)+1}},14786:p=>{"use strict";p.exports=function(p,b,M,h){var Q=self||window;try{try{var mp;try{mp=new Q.Blob([p])}catch(t){(mp=new(Q.BlobBuilder||Q.WebKitBlobBuilder||Q.MozBlobBuilder||Q.MSBlobBuilder)).append(p),mp=mp.getBlob()}var y=Q.URL||Q.webkitURL,P=y.createObjectURL(mp),w=new Q[b](P,M);return y.revokeObjectURL(P),w}catch(t){return new Q[b]("data:application/javascript,".concat(encodeURIComponent(p)),M)}}catch(t){if(!h)throw Error("Inline worker is not supported");return new Q[b](h,M)}}},13542:(p,b,M)=>{"use strict";function h(p,b,M,h,Q){var mp={};return Object.keys(h).forEach((function(p){mp[p]=h[p]})),mp.enumerable=!!mp.enumerable,mp.configurable=!!mp.configurable,("value"in mp||mp.initializer)&&(mp.writable=!0),mp=M.slice().reverse().reduce((function(M,h){return h(p,b,M)||M}),mp),Q&&void 0!==mp.initializer&&(mp.value=mp.initializer?mp.initializer.call(Q):void 0,mp.initializer=void 0),void 0===mp.initializer&&(Object.defineProperty(p,b,mp),mp=null),mp}M.d(b,{e:()=>h})},13535:(p,b,M)=>{"use strict";function h(p,b,M,h){M&&Object.defineProperty(p,b,{enumerable:M.enumerable,configurable:M.configurable,writable:M.writable,value:M.initializer?M.initializer.call(h):void 0})}M.d(b,{d:()=>h})},14938:(p,b,M)=>{"use strict";M.d(b,{b:()=>y,e:()=>x,i:()=>P,m:()=>mp,n:()=>w,r:()=>Q,v:()=>t,y:()=>z});var h=M(12986);class Q{constructor(){this._easingMode=Q.EASINGMODE_EASEIN}setEasingMode(p){const b=Math.min(Math.max(p,0),2);this._easingMode=b}getEasingMode(){return this._easingMode}easeInCore(p){throw new Error("You must implement this method")}ease(p){switch(this._easingMode){case Q.EASINGMODE_EASEIN:return this.easeInCore(p);case Q.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-p)}return p>=.5?.5*(1-this.easeInCore(2*(1-p)))+.5:.5*this.easeInCore(2*p)}}Q.EASINGMODE_EASEIN=0,Q.EASINGMODE_EASEOUT=1,Q.EASINGMODE_EASEINOUT=2;class mp extends Q{easeInCore(p){return p=Math.max(0,Math.min(1,p)),1-Math.sqrt(1-p*p)}}class y extends Q{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=p}easeInCore(p){const b=Math.max(0,this.amplitude);return Math.pow(p,3)-p*b*Math.sin(3.141592653589793*p)}}class P extends Q{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=p,this.bounciness=b}easeInCore(p){const b=Math.max(0,this.bounces);let M=this.bounciness;M<=1&&(M=1.001);const h=Math.pow(M,b),Q=1-M,mp=(1-h)/Q+.5*h,y=p*mp,P=Math.log(-y*(1-M)+1)/Math.log(M),w=Math.floor(P),t=w+1,z=(1-Math.pow(M,w))/(Q*mp),x=.5*(z+(1-Math.pow(M,t))/(Q*mp)),S=p-x,X=x-z;return-Math.pow(1/M,b-w)/(X*X)*(S-X)*(S+X)}}class w extends Q{easeInCore(p){return p*p*p}}class t extends Q{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=p,this.springiness=b}easeInCore(p){let b;const M=Math.max(0,this.oscillations),h=Math.max(0,this.springiness);return b=0==h?p:(Math.exp(h*p)-1)/(Math.exp(h)-1),b*Math.sin((6.283185307179586*M+1.5707963267948966)*p)}}class z extends Q{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=p}easeInCore(p){return this.exponent<=0?p:(Math.exp(this.exponent*p)-1)/(Math.exp(this.exponent)-1)}}class x extends Q{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=p,this.y1=b,this.x2=M,this.y2=h}easeInCore(p){return h.d.Interpolate(p,this.x1,this.y1,this.x2,this.y2)}}},14233:(p,b,M)=>{"use strict";M.d(b,{e:()=>y});var h=M(12777),Q=M(12785),mp=M(13213);class y extends mp.d{get _matrix(){return this._compose(),this.KX}set _matrix(p){(p.updateFlag!==this.KX.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.KX.mp(p),this._markAsDirtyAndDecompose())}constructor(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,mp=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(p,b.upp(),!1),this.name=p,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=b,this.KX=(null===Q||void 0===Q?void 0:Q.clone())??h.Matrix.Identity(),this._restMatrix=mp??this.KX.clone(),this._bindMatrix=y??this.KX.clone(),this._index=P,this._absoluteMatrix=new h.Matrix,this._absoluteBindMatrix=new h.Matrix,this._absoluteInverseBindMatrix=new h.Matrix,this._finalMatrix=new h.Matrix,b.bones.push(this),this.setParent(M,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(p){this.setParent(p)}setParent(p){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==p){if(this.parent){const p=this.parent.children.indexOf(this);-1!==p&&this.parent.children.splice(p,1)}this._parentNode=p,this.parent&&this.parent.children.push(this),b&&this._updateAbsoluteBindMatrices(),this.yx()}}getLocalMatrix(){return this._compose(),this.KX}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(p){this._restMatrix.mp(p)}setRestPose(p){this.setRestMatrix(p)}getBindPose(){return this.getBindMatrix()}setBindMatrix(p){this.Gb(p)}setBindPose(p){this.setBindMatrix(p)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const p=h.TmpVectors.QM[0],b=h.TmpVectors.Quaternion[0],M=h.TmpVectors.QM[1];this.getRestMatrix().decompose(p,b,M),this._linkedTransformNode.position.mp(M),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??h.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.mp(b),this._linkedTransformNode.ib.mp(p)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(p){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=p,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.yt}set position(p){this._decompose(),this.yt.mp(p),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(p){this.setRotation(p)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(p){this.setRotationQuaternion(p)}get ib(){return this.getScale()}set ib(p){this.setScale(p)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=h.QM.Zero(),this._localRotation=h.Quaternion.Zero(),this.yt=h.QM.Zero()),this.KX.decompose(this._localScaling,this._localRotation,this.yt))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,h.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.yt,this.KX)):this._needToCompose=!1)}Gb(p){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.mp(p),b&&this._updateAbsoluteBindMatrices(),M?this._matrix=p:this.yx()}_updateAbsoluteBindMatrices(p){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(p||(p=this._bindMatrix),this.parent?p.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.mp(p),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),b)for(let M=0;M<this.children.length;M++)this.children[M]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}yx(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.yx(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.yx(),this._needToDecompose=!0}_updatePosition(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const mp=this.getLocalMatrix();if(0==b)Q?(mp.addAtIndex(12,p.x),mp.addAtIndex(13,p.y),mp.addAtIndex(14,p.z)):mp.setTranslationFromFloats(p.x,p.y,p.z);else{let b=null;M&&(b=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=y._TmpMats[0],w=y._TmpVecs[0];this.parent?M&&b?(P.mp(this.parent.getAbsoluteMatrix()),P.multiplyToRef(b,P)):P.mp(this.parent.getAbsoluteMatrix()):h.Matrix.IdentityToRef(P),Q&&P.setTranslationFromFloats(0,0,0),P.invert(),h.QM.TransformCoordinatesToRef(p,P,w),Q?(mp.addAtIndex(12,w.x),mp.addAtIndex(13,w.y),mp.addAtIndex(14,w.z)):mp.setTranslationFromFloats(w.x,w.y,w.z)}this._markAsDirtyAndDecompose()}translate(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;this._updatePosition(p,b,M,!0)}setPosition(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;this._updatePosition(p,b,M,!1)}setAbsolutePosition(p,b){this.setPosition(p,1,b)}scale(p,b,M){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const mp=this.getLocalMatrix(),P=y._TmpMats[0];h.Matrix.ScalingToRef(p,b,M,P),P.multiplyToRef(mp,mp),P.invert();for(const h of this.children){const Q=h.getLocalMatrix();Q.multiplyToRef(P,Q),Q.multiplyAtIndex(12,p),Q.multiplyAtIndex(13,b),Q.multiplyAtIndex(14,M),h._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),Q)for(const h of this.children)h.scale(p,b,M,Q)}setScale(p){this._decompose(),this._localScaling.mp(p),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(p){this._decompose(),p.mp(this._localScaling)}setYawPitchRoll(p,b,M){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,mp=arguments.length>4?arguments[4]:void 0;if(0===Q){const P=y._TmpQuat;return h.Quaternion.RotationYawPitchRollToRef(p,b,M,P),void this.setRotationQuaternion(P,Q,mp)}const P=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(P,mp))return;const w=y._TmpMats[1];h.Matrix.RotationYawPitchRollToRef(p,b,M,w),P.multiplyToRef(w,w),this._rotateWithMatrix(w,Q,mp)}rotate(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3?arguments[3]:void 0;const mp=y._TmpMats[0];mp.setTranslationFromFloats(0,0,0),h.Matrix.RotationAxisToRef(p,b,mp),this._rotateWithMatrix(mp,M,Q)}setAxisAngle(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3?arguments[3]:void 0;if(0===M){const mp=y._TmpQuat;return h.Quaternion.RotationAxisToRef(p,b,mp),void this.setRotationQuaternion(mp,M,Q)}const mp=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(mp,Q))return;const P=y._TmpMats[1];h.Matrix.RotationAxisToRef(p,b,P),mp.multiplyToRef(P,P),this._rotateWithMatrix(P,M,Q)}setRotation(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(p.y,p.x,p.z,b,M)}setRotationQuaternion(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;if(0===b)return this._decompose(),this._localRotation.mp(p),void this._markAsDirtyAndCompose();const Q=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,M))return;const mp=y._TmpMats[1];h.Matrix.FromQuaternionToRef(p,mp),Q.multiplyToRef(mp,mp),this._rotateWithMatrix(mp,b,M)}setRotationMatrix(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;if(0===b){const Q=y._TmpQuat;return h.Quaternion.FromRotationMatrixToRef(p,Q),void this.setRotationQuaternion(Q,b,M)}const Q=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,M))return;const mp=y._TmpMats[1];mp.mp(p),Q.multiplyToRef(p,mp),this._rotateWithMatrix(mp,b,M)}_rotateWithMatrix(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;const h=this.getLocalMatrix(),Q=h.m[12],mp=h.m[13],P=h.m[14],w=this.getParent(),t=y._TmpMats[3],z=y._TmpMats[4];w&&1==b?(M?(t.mp(M.getWorldMatrix()),w.getAbsoluteMatrix().multiplyToRef(t,t)):t.mp(w.getAbsoluteMatrix()),z.mp(t),z.invert(),h.multiplyToRef(t,h),h.multiplyToRef(p,h),h.multiplyToRef(z,h)):1==b&&M?(t.mp(M.getWorldMatrix()),z.mp(t),z.invert(),h.multiplyToRef(t,h),h.multiplyToRef(p,h),h.multiplyToRef(z,h)):h.multiplyToRef(p,h),h.setTranslationFromFloats(Q,mp,P),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(p,b){const M=y._TmpMats[2];return p.mp(this.getAbsoluteMatrix()),b?(p.multiplyToRef(b.getWorldMatrix(),p),h.Matrix.ScalingToRef(b.ib.x,b.ib.y,b.ib.z,M)):h.Matrix.IdentityToRef(M),p.invert(),!isNaN(p.m[0])&&(M.multiplyAtIndex(0,this._scalingDeterminant),p.multiplyToRef(M,p),!0)}wb(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=h.QM.Zero();return this.getPositionToRef(p,b,M),M}getPositionToRef(){let p=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const p=this.getLocalMatrix();b.x=p.m[12],b.y=p.m[13],b.z=p.m[14]}else{let M=null;p&&(M=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let h=y._TmpMats[0];p&&M?(h.mp(this.getAbsoluteMatrix()),h.multiplyToRef(M,h)):h=this.getAbsoluteMatrix(),b.x=h.m[12],b.y=h.m[13],b.z=h.m[14]}}getAbsolutePosition(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=h.QM.Zero();return this.getPositionToRef(1,p,b),b}getAbsolutePositionToRef(p,b){this.getPositionToRef(1,p,b)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.KX.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.mp(this.KX);const p=this._skeleton.getPoseMatrix();p&&this._absoluteMatrix.multiplyToRef(p,this._absoluteMatrix)}const p=this.children,b=p.length;for(let M=0;M<b;M++)p[M].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}st(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=h.QM.Zero();return this.getDirectionToRef(p,b,M),M}getDirectionToRef(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0,Q=null;b&&(Q=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const mp=y._TmpMats[0];mp.mp(this.getAbsoluteMatrix()),b&&Q&&mp.multiplyToRef(Q,mp),h.QM.TransformNormalToRef(p,mp,M),M.normalize()}getRotation(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=h.QM.Zero();return this.getRotationToRef(p,b,M),M}getRotationToRef(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0;const h=y._TmpQuat;this.getRotationQuaternionToRef(p,b,h),h.toEulerAnglesToRef(M)}getRotationQuaternion(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=h.Quaternion.Identity();return this.getRotationQuaternionToRef(p,b,M),M}getRotationQuaternionToRef(){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),b.mp(this._localRotation);else{const M=y._TmpMats[0],h=this.getAbsoluteMatrix();p?h.multiplyToRef(p.getWorldMatrix(),M):M.mp(h),M.multiplyAtIndex(0,this._scalingDeterminant),M.multiplyAtIndex(1,this._scalingDeterminant),M.multiplyAtIndex(2,this._scalingDeterminant),M.decompose(void 0,b,void 0)}}getRotationMatrix(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0;const M=h.Matrix.Identity();return this.getRotationMatrixToRef(p,b,M),M}getRotationMatrixToRef(){let p=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(b);else{const M=y._TmpMats[0],h=this.getAbsoluteMatrix();p?h.multiplyToRef(p.getWorldMatrix(),M):M.mp(h),M.multiplyAtIndex(0,this._scalingDeterminant),M.multiplyAtIndex(1,this._scalingDeterminant),M.multiplyAtIndex(2,this._scalingDeterminant),M.getRotationMatrixToRef(b)}}getAbsolutePositionFromLocal(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=h.QM.Zero();return this.getAbsolutePositionFromLocalToRef(p,b,M),M}getAbsolutePositionFromLocalToRef(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0,Q=null;b&&(Q=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const mp=y._TmpMats[0];mp.mp(this.getAbsoluteMatrix()),b&&Q&&mp.multiplyToRef(Q,mp),h.QM.TransformCoordinatesToRef(p,mp,M)}getLocalPositionFromAbsolute(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=h.QM.Zero();return this.getLocalPositionFromAbsoluteToRef(p,b,M),M}getLocalPositionFromAbsoluteToRef(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0,Q=null;b&&(Q=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const mp=y._TmpMats[0];mp.mp(this.getAbsoluteMatrix()),b&&Q&&mp.multiplyToRef(Q,mp),mp.invert(),h.QM.TransformCoordinatesToRef(p,mp,M)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const p=this._skeleton.bones.indexOf(this);if(-1!==p&&this._skeleton.bones.splice(p,1),this._parentNode&&this._parentNode.children){const p=this._parentNode.children,b=p.indexOf(this);-1!==b&&p.splice(b,1)}super.dispose()}}y._TmpVecs=(0,Q.e)(2,h.QM.Zero),y._TmpQuat=h.Quaternion.Identity(),y._TmpMats=(0,Q.e)(5,h.Matrix.Identity)},14935:(p,b,M)=>{"use strict";M.d(b,{d:()=>B});var h=M(12757),Q=M(12764),mp=M(12617),y=M(12777),P=M(12789),w=M(13213),t=M(13231),z=M(13051),x=M(12630),S=M(12779);class X{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(p){this._zoomStopsAnimation=p}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(p){this._idleRotationSpeed=p}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(p){this._idleRotationWaitTime=p}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(p){this._idleRotationSpinupTime=p}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(p){this._attachedCamera=p;const b=this._attachedCamera.upp();this._onPrePointerObservableObserver=b.onPrePointerObservable.add((p=>{p.type!==z.e.POINTERDOWN?p.type===z.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=p.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const p=x.d.Now;let b=0;null!=this._lastFrameTime&&(b=p-this._lastFrameTime),this._lastFrameTime=p,this._applyUserInteraction();const M=p-this._lastInteractionTime-this._idleRotationWaitTime,h=Math.max(Math.min(M/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*h,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(b/1e3))}))}detach(){if(!this._attachedCamera)return;const p=this._attachedCamera.upp();this._onPrePointerObservableObserver&&p.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(p){this._lastInteractionTime=p??x.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<S.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let p=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(p=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?p:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=x.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var c=M(14938),J=M(13311);class g{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(p){if(this._autoTransitionRange===p)return;this._autoTransitionRange=p;const b=this._attachedCamera;b&&(p?this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((p=>{if(p&&(p.Zb(!0),p.getBoundingInfo)){const b=p.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*b,this.upperRadiusTransitionRange=.05*b}})):this._onMeshTargetChangedObserver&&b.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(p){this._attachedCamera=p,this._onAfterCheckInputsObserver=p.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(p){return!!this._attachedCamera&&(this._attachedCamera.radius===p&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(p){if(!this._attachedCamera)return;this._radiusBounceTransition||(g.EasingFunction.setEasingMode(g.EasingMode),this._radiusBounceTransition=J.d.CreateAnimation("radius",J.d.ANIMATIONTYPE_FLOAT,60,g.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const b=J.d.TransitionTo("radius",this._attachedCamera.radius+p,this._attachedCamera,this._attachedCamera.upp(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));b&&this._animatables.push(b)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}g.EasingFunction=new c.b(.3),g.EasingMode=c.r.EASINGMODE_EASEOUT;class f{constructor(){this.onTargetFramingAnimationEndObservable=new mp.d,this._mode=f.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(p){this._mode=p}get mode(){return this._mode}set radiusScale(p){this._radiusScale=p}get radiusScale(){return this._radiusScale}set positionScale(p){this._positionScale=p}get positionScale(){return this._positionScale}set defaultElevation(p){this._defaultElevation=p}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(p){this._elevationReturnTime=p}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(p){this._elevationReturnWaitTime=p}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(p){this._zoomStopsAnimation=p}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(p){this._framingTime=p}get framingTime(){return this._framingTime}init(){}attach(p){this._attachedCamera=p;const b=this._attachedCamera.upp();f.EasingFunction.setEasingMode(f.EasingMode),this._onPrePointerObservableObserver=b.onPrePointerObservable.add((p=>{p.type!==z.e.POINTERDOWN?p.type===z.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=p.onMeshTargetChangedObservable.add((p=>{p&&p.getBoundingInfo&&this.zoomOnMesh(p,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=p.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const p=this._attachedCamera.upp();this._onPrePointerObservableObserver&&p.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;p.Zb(!0);const h=p.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(h.minimumWorld,h.maximumWorld,b,M)}zoomOnMeshHierarchy(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;p.Zb(!0);const h=p.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(h.min,h.max,b,M)}zoomOnMeshesHierarchy(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new y.QM(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Q=new y.QM(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let mp=0;mp<p.length;mp++){const b=p[mp].getHierarchyBoundingVectors(!0);y.QM.CheckExtends(b.min,h,Q),y.QM.CheckExtends(b.max,h,Q)}this.zoomOnBoundingInfo(h,Q,b,M)}zoomOnBoundingInfo(p,b){let M,h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const mp=p.y,P=mp+(b.y-mp)*this._positionScale,w=b.mh(p).scale(.5);if(!isFinite(P))return!1;if(h)M=new y.QM(0,P,0);else{const b=p.add(w);M=new y.QM(b.x,P,b.z)}this._vectorTransition||(this._vectorTransition=J.d.CreateAnimation("target",J.d.ANIMATIONTYPE_VECTOR3,60,f.EasingFunction)),this._betaIsAnimating=!0;let t=J.d.TransitionTo("target",M,this._attachedCamera,this._attachedCamera.upp(),60,this._vectorTransition,this._framingTime);t&&this._animatables.push(t);let z=0;if(this._mode===f.FitFrustumSidesMode){const M=this._calculateLowerRadiusFromModelBoundingSphere(p,b);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=w.length()+this._attachedCamera.Ib),z=M}else this._mode===f.IgnoreBoundsSizeMode&&(z=this._calculateLowerRadiusFromModelBoundingSphere(p,b),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ib));if(this.autoCorrectCameraLimitsAndSensibility){const M=b.mh(p).length();this._attachedCamera.panningSensibility=5e3/M,this._attachedCamera.wheelPrecision=100/z}return this._radiusTransition||(this._radiusTransition=J.d.CreateAnimation("radius",J.d.ANIMATIONTYPE_FLOAT,60,f.EasingFunction)),t=J.d.TransitionTo("radius",z,this._attachedCamera,this._attachedCamera.upp(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),Q&&Q(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),t&&this._animatables.push(t),!0}_calculateLowerRadiusFromModelBoundingSphere(p,b){const M=this._attachedCamera;if(!M)return 0;let h=M._calculateLowerRadiusFromModelBoundingSphere(p,b,this._radiusScale);return M.lowerRadiusLimit&&this._mode===f.IgnoreBoundsSizeMode&&(h=h<M.lowerRadiusLimit?M.lowerRadiusLimit:h),M.upperRadiusLimit&&(h=h>M.upperRadiusLimit?M.upperRadiusLimit:h),h}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const p=x.d.Now-this._lastInteractionTime,b=.5*Math.PI-this._defaultElevation,M=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>M&&p>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=J.d.CreateAnimation("beta",J.d.ANIMATIONTYPE_FLOAT,60,f.EasingFunction));const p=J.d.TransitionTo("beta",b,this._attachedCamera,this._attachedCamera.upp(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));p&&this._animatables.push(p)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=x.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}f.EasingFunction=new c.y,f.EasingMode=c.r.EASINGMODE_EASEINOUT,f.IgnoreBoundsSizeMode=0,f.FitFrustumSidesMode=1;var Y=M(13235),a=M(13266),o=M(14225),l=M(12608);class L{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(p){p=l.Tools.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),M=b.getInputElement();let h=0,Q=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=mp=>{var y,P;const w=mp.event,t="touch"===w.pointerType;if(mp.type!==z.e.POINTERMOVE&&-1===this.buttons.indexOf(w.button))return;const x=w.target;if(this._altKey=w.altKey,this._ctrlKey=w.ctrlKey,this._metaKey=w.metaKey,this._shiftKey=w.shiftKey,this._buttonsPressed=w.buttons,b.isPointerLock){const p=w.movementX,b=w.movementY;this.onTouch(null,p,b),this._pointA=null,this._pointB=null}else{if(mp.type!==z.e.POINTERDOWN&&mp.type!==z.e.POINTERDOUBLETAP&&t&&(null===(y=this._pointA)||void 0===y?void 0:y.pointerId)!==w.pointerId&&(null===(P=this._pointB)||void 0===P?void 0:P.pointerId)!==w.pointerId)return;if(mp.type!==z.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!t)if(mp.type===z.e.POINTERDOUBLETAP)this.onDoubleTap(w.pointerType);else if(mp.type!==z.e.POINTERUP||this._currentMousePointerIdDown!==w.pointerId&&!t){if(mp.type===z.e.POINTERMOVE)if(p||w.preventDefault(),this._pointA&&null===this._pointB){const p=w.clientX-this._pointA.x,b=w.clientY-this._pointA.y;this._pointA.x=w.clientX,this._pointA.y=w.clientY,this.onTouch(this._pointA,p,b)}else if(this._pointA&&this._pointB){const p=this._pointA.pointerId===w.pointerId?this._pointA:this._pointB;p.x=w.clientX,p.y=w.clientY;const b=this._pointA.x-this._pointB.x,M=this._pointA.y-this._pointB.y,y=b*b+M*M,P={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:w.pointerId,type:mp.type};this.onMultiTouch(this._pointA,this._pointB,h,y,Q,P),Q=P,h=y}}else{try{null===x||void 0===x||x.releasePointerCapture(w.pointerId)}catch(S){}t||(this._pointB=null),b._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==w.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==w.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==h||Q)&&(this.onMultiTouch(this._pointA,this._pointB,h,0,Q,null),h=0,Q=null),this._currentMousePointerIdDown=-1,this.onButtonUp(w),p||w.preventDefault()}else{try{null===x||void 0===x||x.setPointerCapture(w.pointerId)}catch(S){}if(null===this._pointA)this._pointA={x:w.clientX,y:w.clientY,pointerId:w.pointerId,type:w.pointerType};else{if(null!==this._pointB)return;this._pointB={x:w.clientX,y:w.clientY,pointerId:w.pointerId,type:w.pointerType}}-1!==this._currentMousePointerIdDown||t||(this._currentMousePointerIdDown=w.pointerId),this.onButtonDown(w),p||(w.preventDefault(),M&&M.focus())}}},this._observer=this.camera.upp()._inputManager._addCameraPointerObserver(this._pointerInput,z.e.POINTERDOWN|z.e.POINTERUP|z.e.POINTERMOVE|z.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,h=0,Q=null,this.onLostFocus()},this._contextMenuBind=p=>this.onContextMenu(p),M&&M.addEventListener("contextmenu",this._contextMenuBind,!1);const mp=this.camera.upp().getEngine().getHostWindow();mp&&l.Tools.RegisterTopRootEvents(mp,[{name:"blur",handler:this._onLostFocus}])}bX(){if(this._onLostFocus){const p=this.camera.upp().getEngine().getHostWindow();p&&l.Tools.UnregisterTopRootEvents(p,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.upp()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const p=this.camera.upp().getEngine().getInputElement();p&&p.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(p){}onTouch(p,b,M){}onMultiTouch(p,b,M,h,Q,mp){}onContextMenu(p){p.preventDefault()}onButtonDown(p){}onButtonUp(p){}onLostFocus(){}}(0,h.e)([(0,Q.N)()],L.prototype,"buttons",void 0);class u extends L{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(p,b){if(0!==this.panningSensibility&&p&&b){const M=b.x-p.x,h=b.y-p.y;this.camera.inertialPanningX+=-M/this.panningSensibility,this.camera.inertialPanningY+=h/this.panningSensibility}}_computePinchZoom(p,b){const M=this.camera.radius||u.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=M*Math.sqrt(p)/Math.sqrt(b):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(b-p)*M*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(b-p)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(p,b,M){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=M/this.panningSensibility):(this.camera.inertialAlphaOffset-=b/this.angularSensibilityX,this.camera.inertialBetaOffset-=M/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(p,b,M,h,Q,mp){0===M&&null===Q||0===h&&null===mp||(this.multiTouchPanAndZoom?(this._computePinchZoom(M,h),this._computeMultiTouchPanning(Q,mp)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(h)-Math.sqrt(M))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(M,h),this._isPinching=!0):this._computeMultiTouchPanning(Q,mp)):this.multiTouchPanning?this._computeMultiTouchPanning(Q,mp):this.pinchZoom&&this._computePinchZoom(M,h))}onButtonDown(p){this._isPanClick=p.button===this.camera._panningMouseButton}onButtonUp(p){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}u.MinimumRadiusForPinch=.001,(0,h.e)([(0,Q.N)()],u.prototype,"buttons",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"angularSensibilityX",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"angularSensibilityY",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"pinchPrecision",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"pinchDeltaPercentage",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"useNaturalPinchZoom",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"pinchZoom",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"panningSensibility",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"multiTouchPanning",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"multiTouchPanAndZoom",void 0),o.d.ArcRotateCameraPointersInput=u;var e=M(13054);class d{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(p){p=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.upp(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const M=b.event;if(!M.metaKey)if(b.type===e.d.KEYDOWN){if(this._ctrlPressed=M.ctrlKey,this._altPressed=M.altKey,-1!==this.keysUp.indexOf(M.keyCode)||-1!==this.keysDown.indexOf(M.keyCode)||-1!==this.keysLeft.indexOf(M.keyCode)||-1!==this.keysRight.indexOf(M.keyCode)||-1!==this.keysReset.indexOf(M.keyCode)){-1===this._keys.indexOf(M.keyCode)&&this._keys.push(M.keyCode),M.preventDefault&&(p||M.preventDefault())}}else if(-1!==this.keysUp.indexOf(M.keyCode)||-1!==this.keysDown.indexOf(M.keyCode)||-1!==this.keysLeft.indexOf(M.keyCode)||-1!==this.keysRight.indexOf(M.keyCode)||-1!==this.keysReset.indexOf(M.keyCode)){const b=this._keys.indexOf(M.keyCode);b>=0&&this._keys.splice(b,1),M.preventDefault&&(p||M.preventDefault())}})))}bX(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const p=this.camera;for(let b=0;b<this._keys.length;b++){const M=this._keys[b];-1!==this.keysLeft.indexOf(M)?this._ctrlPressed&&this.camera._useCtrlForPanning?p.inertialPanningX-=1/this.panningSensibility:p.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(M)?this._ctrlPressed&&this.camera._useCtrlForPanning?p.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?p.inertialRadiusOffset+=1/this.zoomingSensibility:p.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(M)?this._ctrlPressed&&this.camera._useCtrlForPanning?p.inertialPanningX+=1/this.panningSensibility:p.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(M)?this._ctrlPressed&&this.camera._useCtrlForPanning?p.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?p.inertialRadiusOffset-=1/this.zoomingSensibility:p.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(M)&&p.useInputToRestoreState&&p.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,h.e)([(0,Q.N)()],d.prototype,"keysUp",void 0),(0,h.e)([(0,Q.N)()],d.prototype,"keysDown",void 0),(0,h.e)([(0,Q.N)()],d.prototype,"keysLeft",void 0),(0,h.e)([(0,Q.N)()],d.prototype,"keysRight",void 0),(0,h.e)([(0,Q.N)()],d.prototype,"keysReset",void 0),(0,h.e)([(0,Q.N)()],d.prototype,"panningSensibility",void 0),(0,h.e)([(0,Q.N)()],d.prototype,"zoomingSensibility",void 0),(0,h.e)([(0,Q.N)()],d.prototype,"useAltToZoom",void 0),(0,h.e)([(0,Q.N)()],d.prototype,"angularSpeed",void 0),o.d.ArcRotateCameraKeyboardMoveInput=d;var I=M(12829),G=M(13060);class v{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new y.QM(0,0,0),this._globalOffset=new y.QM(0,0,0),this._inertialPanning=y.QM.Zero()}_computeDeltaFromMouseWheelLegacyEvent(p,b){let M=0;const h=.01*p*this.wheelDeltaPercentage*b;return M=p>0?h/(1+this.wheelDeltaPercentage):h*(1+this.wheelDeltaPercentage),M}attachControl(p){p=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==z.e.POINTERWHEEL)return;const M=b.event;let h=0;const Q=M.deltaMode===G.c.DOM_DELTA_LINE?40:1,mp=-M.deltaY*Q;if(this.customComputeDeltaFromMouseWheel)h=this.customComputeDeltaFromMouseWheel(mp,this,M);else if(this.wheelDeltaPercentage){if(h=this._computeDeltaFromMouseWheelLegacyEvent(mp,this.camera.radius),h>0){let p=this.camera.radius,b=this.camera.inertialRadiusOffset+h;for(let M=0;M<20&&!(p<=b)&&!(Math.abs(b*this.camera.inertia)<.001);M++)p-=b,b*=this.camera.inertia;p=(0,P.Clamp)(p,0,Number.MAX_VALUE),h=this._computeDeltaFromMouseWheelLegacyEvent(mp,p)}}else h=mp/(40*this.wheelPrecision);h&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(h)):this.camera.inertialRadiusOffset+=h),M.preventDefault&&(p||M.preventDefault())},this._observer=this.camera.upp()._inputManager._addCameraPointerObserver(this._wheel,z.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Tb(0)}bX(){this._observer&&(this.camera.upp()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const p=this.camera;0+p.inertialAlphaOffset+p.inertialBetaOffset+p.inertialRadiusOffset&&(this._updateHitPlane(),p.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(p.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const p=this.camera,b=p.target.mh(p.position);this._hitPlane=I.e.FromPositionAndNormal(p.target,b)}_getPosition(){const p=this.camera,b=p.upp(),M=b.createPickingRay(b.pointerX,b.pointerY,y.Matrix.Identity(),p,!1);0===p.targetScreenOffset.x&&0===p.targetScreenOffset.y||(this._viewOffset.set(p.targetScreenOffset.x,p.targetScreenOffset.y,0),p.getViewMatrix().invertToRef(p._cameraTransformMatrix),this._globalOffset=y.QM.TransformNormal(this._viewOffset,p._cameraTransformMatrix),M.origin.addInPlace(this._globalOffset));let h=0;return this._hitPlane&&(h=M.intersectsPlane(this._hitPlane)??0),M.origin.addInPlace(M.direction.scaleInPlace(h))}_zoomToMouse(p){const b=this.camera,M=1-b.inertia;if(b.lowerRadiusLimit){const h=b.lowerRadiusLimit??0;b.radius-(b.inertialRadiusOffset+p)/M<h&&(p=(b.radius-h)*M-b.inertialRadiusOffset)}if(b.upperRadiusLimit){const h=b.upperRadiusLimit??0;b.radius-(b.inertialRadiusOffset+p)/M>h&&(p=(b.radius-h)*M-b.inertialRadiusOffset)}const h=p/M/b.radius,Q=this._getPosition(),mp=y.TmpVectors.QM[6];Q.subtractToRef(b.target,mp),mp.scaleInPlace(h),mp.scaleInPlace(M),this._inertialPanning.addInPlace(mp),b.inertialRadiusOffset+=p}_zeroIfClose(p){Math.abs(p.x)<S.d&&(p.x=0),Math.abs(p.y)<S.d&&(p.y=0),Math.abs(p.z)<S.d&&(p.z=0)}}(0,h.e)([(0,Q.N)()],v.prototype,"wheelPrecision",void 0),(0,h.e)([(0,Q.N)()],v.prototype,"zoomToMouseLocation",void 0),(0,h.e)([(0,Q.N)()],v.prototype,"wheelDeltaPercentage",void 0),o.d.ArcRotateCameraMouseWheelInput=v;class Z extends o.h{constructor(p){super(p)}addMouseWheel(){return this.add(new v),this}addPointers(){return this.add(new u),this}addKeyboard(){return this.add(new d),this}}var U=M(12730);function q(p,b){return isNaN(p)?b:p}w.d.AddNodeConstructor("ArcRotateCamera",((p,b)=>()=>new B(p,0,0,1,y.QM.Zero(),b)));class B extends a.e{get target(){return this._target}set target(p){this.setTarget(p)}get targetHost(){return this._targetHost}set targetHost(p){p&&this.setTarget(p)}getTarget(){return this.target}get position(){return this._position}set position(p){this.setPosition(p)}set upVector(p){this._upToYMatrix||(this._yToUpMatrix=new y.Matrix,this._upToYMatrix=new y.Matrix,this._upVector=y.QM.Zero()),p.normalize(),this._upVector.mp(p),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){y.Matrix.RotationAlignToRef(y.QM.UpReadOnly,this._upVector,this._yToUpMatrix),y.Matrix.RotationAlignToRef(this._upVector,y.QM.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const p=this.inputs.attached.pointers;return p?p.angularSensibilityX:0}set angularSensibilityX(p){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityX=p)}get angularSensibilityY(){const p=this.inputs.attached.pointers;return p?p.angularSensibilityY:0}set angularSensibilityY(p){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityY=p)}get pinchPrecision(){const p=this.inputs.attached.pointers;return p?p.pinchPrecision:0}set pinchPrecision(p){const b=this.inputs.attached.pointers;b&&(b.pinchPrecision=p)}get pinchDeltaPercentage(){const p=this.inputs.attached.pointers;return p?p.pinchDeltaPercentage:0}set pinchDeltaPercentage(p){const b=this.inputs.attached.pointers;b&&(b.pinchDeltaPercentage=p)}get useNaturalPinchZoom(){const p=this.inputs.attached.pointers;return!!p&&p.useNaturalPinchZoom}set useNaturalPinchZoom(p){const b=this.inputs.attached.pointers;b&&(b.useNaturalPinchZoom=p)}get panningSensibility(){const p=this.inputs.attached.pointers;return p?p.panningSensibility:0}set panningSensibility(p){const b=this.inputs.attached.pointers;b&&(b.panningSensibility=p)}get keysUp(){const p=this.inputs.attached.keyboard;return p?p.keysUp:[]}set keysUp(p){const b=this.inputs.attached.keyboard;b&&(b.keysUp=p)}get keysDown(){const p=this.inputs.attached.keyboard;return p?p.keysDown:[]}set keysDown(p){const b=this.inputs.attached.keyboard;b&&(b.keysDown=p)}get keysLeft(){const p=this.inputs.attached.keyboard;return p?p.keysLeft:[]}set keysLeft(p){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=p)}get keysRight(){const p=this.inputs.attached.keyboard;return p?p.keysRight:[]}set keysRight(p){const b=this.inputs.attached.keyboard;b&&(b.keysRight=p)}get wheelPrecision(){const p=this.inputs.attached.mousewheel;return p?p.wheelPrecision:0}set wheelPrecision(p){const b=this.inputs.attached.mousewheel;b&&(b.wheelPrecision=p)}get zoomToMouseLocation(){const p=this.inputs.attached.mousewheel;return!!p&&p.zoomToMouseLocation}set zoomToMouseLocation(p){const b=this.inputs.attached.mousewheel;b&&(b.zoomToMouseLocation=p)}get wheelDeltaPercentage(){const p=this.inputs.attached.mousewheel;return p?p.wheelDeltaPercentage:0}set wheelDeltaPercentage(p){const b=this.inputs.attached.mousewheel;b&&(b.wheelDeltaPercentage=p)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(p){p!==this.useBouncingBehavior&&(p?(this._bouncingBehavior=new g,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(p){p!==this.useFramingBehavior&&(p?(this._framingBehavior=new f,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(p){p!==this.useAutoRotationBehavior&&(p?(this._autoRotationBehavior=new X,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(p,b,M,h,Q,P){var w;let t=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(p,y.QM.Zero(),P,t),w=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=y.QM.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=y.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new y.Matrix,this.panningAxis=new y.QM(1,1,0),this._transformedDirection=new y.QM,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new mp.d,this.checkCollisions=!1,this.collisionRadius=new y.QM(.5,.5,.5),this._previousPosition=y.QM.Zero(),this._collisionVelocity=y.QM.Zero(),this._newPosition=y.QM.Zero(),this._computationVector=y.QM.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new y.QM(NaN,NaN,NaN),this._goalTargetScreenOffset=new y.Vector2(NaN,NaN),this._onCollisionPositionChange=function(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M?(w.setPosition(b),w.IJ&&w.IJ(M)):w._previousPosition.mp(w._position);const h=Math.cos(w.alpha),Q=Math.sin(w.alpha),mp=Math.cos(w.beta);let y=Math.sin(w.beta);0===y&&(y=1e-4);const P=w._getTargetPosition();w._computationVector.sb(w.radius*h*y,w.radius*mp,w.radius*Q*y),P.addToRef(w._computationVector,w._newPosition),w._position.mp(w._newPosition);let t=w.upVector;w.allowUpsideDown&&w.beta<0&&(t=t.clone(),t=t.negate()),w._computeViewMatrix(w._position,P,t),w._viewMatrix.addAtIndex(12,w.targetScreenOffset.x),w._viewMatrix.addAtIndex(13,w.targetScreenOffset.y),w._collisionTriggered=!1},this._target=y.QM.Zero(),Q&&this.setTarget(Q),this.alpha=b,this.beta=M,this.radius=h,this.getViewMatrix(),this.inputs=new Z(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new y.QM(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=y.Vector2.Zero()}_updateCache(p){p||super._updateCache(),this._cache._target.mp(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.mp(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const p=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?p.addToRef(this._targetBoundingCenter,this._target):this._target.mp(p)}const p=this._getLockedTargetPosition();return p||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>S.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,mp=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=mp?this._currentInterpolationFactor=mp:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=q(p,this._goalAlpha),this._goalBeta=q(b,this._goalBeta),this._goalRadius=q(M,this._goalRadius),this._goalTarget.set(q(h.x,this._goalTarget.x),q(h.y,this._goalTarget.y),q(h.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(q(Q.x,this._goalTargetScreenOffset.x),q(Q.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,P.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,P.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,P.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,P.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(p,b){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const Q=arguments;b=l.Tools.BackCompatCameraNoPreventDefault(Q),this._useCtrlForPanning=M,this._panningMouseButton=h,"boolean"===typeof Q[0]&&(Q.length>1&&(this._useCtrlForPanning=Q[1]),Q.length>2&&(this._panningMouseButton=Q[2])),this.inputs.attachElement(b),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}bX(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let p=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){p=!0;const b=this.invertRotation?-1:1,M=this._calculateHandednessMultiplier();let h=this.inertialAlphaOffset*M;this.beta<0&&(h*=-1),this.alpha+=h*b,this.beta+=this.inertialBetaOffset*b,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<S.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<S.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*S.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){p=!0;const b=new y.QM(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),b.multiplyInPlace(this.panningAxis),y.QM.TransformNormalToRef(b,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const p=this.upVector,b=y.QM.CrossToRef(this._transformedDirection,p,this._transformedDirection);y.QM.CrossToRef(p,b,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);y.QM.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.mp(this._transformedDirection)}else{if(this.parent){const p=y.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(p),p.transposeToRef(p),y.QM.TransformCoordinatesToRef(this._transformedDirection,p,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*S.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*S.d&&(this.inertialPanningY=0)}if(p)this.stopInterpolation();else if(this._isInterpolating){let p=!1;const b=this._scene.getEngine().getDeltaTime()/1e3,M=1-Math.pow(2,-b/this._currentInterpolationFactor),h=q(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const b=y.TmpVectors.QM[0].set(q(this._goalTarget.x,this._target.x),q(this._goalTarget.y,this._target.y),q(this._goalTarget.z,this._target.z));y.QM.LerpToRef(this.target,b,M,this._target),10*y.QM.Distance(this.target,b)/h<S.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.mp(b),this.setTarget(this.target,!1,!0,!0)):p=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const b=y.Quaternion.RotationAlphaBetaGammaToRef(q(this._goalAlpha,this.alpha),q(this._goalBeta,this.beta),0,y.TmpVectors.Quaternion[0]),h=y.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,y.TmpVectors.Quaternion[1]),Q=y.Quaternion.SlerpToRef(h,b,M,y.TmpVectors.Quaternion[2]);Q.normalize();const mp=Q.toAlphaBetaGammaToRef(y.TmpVectors.QM[0]);if(this.alpha=mp.x,this.beta=mp.y,Q.isApprox(b,S.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const p=b.toAlphaBetaGammaToRef(y.TmpVectors.QM[0]);this.alpha=p.x,this.beta=p.y}else p=!0}if(isNaN(this._goalRadius)||(this.radius+=(h-this.radius)*M,Math.abs(h/this.radius-1)<S.d?(this._goalRadius=NaN,this.radius=h):p=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const b=y.TmpVectors.Vector2[0].set(q(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),q(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));y.Vector2.LerpToRef(this.targetScreenOffset,b,M,this.targetScreenOffset),y.Vector2.Distance(this.targetScreenOffset,b)<S.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.mp(b)):p=!0}this._isInterpolating=p}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||y.QM.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const p=this.alpha;var b,M;this.alpha=function(p){let b=Math.PI/2;return 0===p.x&&0===p.z||(b=Math.acos(p.x/Math.sqrt(Math.pow(p.x,2)+Math.pow(p.z,2)))),p.z<0&&(b=2*Math.PI-b),b}(this._computationVector),this.beta=(b=this._computationVector.y,M=this.radius,Math.acos(b/M));const h=Math.round((p-this.alpha)/(2*Math.PI));this.alpha+=2*h*Math.PI,this._checkLimits()}setPosition(p){this._position.equals(p)||(this._position.mp(p),this.rebuildAnglesAndRadius())}setTarget(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(h=this.overrideCloneAlphaBetaRadius??h,p.Zb)b&&p.getBoundingInfo?this._targetBoundingCenter=p.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,p.Zb(),this._targetHost=p,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const b=p,h=this._getTargetPosition();if(h&&!M&&h.equals(b))return;this._targetHost=null,this._target=b,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}h||this.rebuildAnglesAndRadius()}_getViewMatrix(){const p=Math.cos(this.alpha),b=Math.sin(this.alpha),M=Math.cos(this.beta);let h=Math.sin(this.beta);0===h&&(h=1e-4),0===this.radius&&(this.radius=1e-4);const Q=this._getTargetPosition();if(this._computationVector.sb(this.radius*p*h,this.radius*M,this.radius*b*h),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||y.QM.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),Q.addToRef(this._computationVector,this._newPosition),this.upp().collisionsEnabled&&this.checkCollisions){const p=this.upp().collisionCoordinator;this._collider||(this._collider=p.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,p.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.mp(this._newPosition);let p=this.upVector;this.allowUpsideDown&&h<0&&(p=p.negate()),this._computeViewMatrix(this._position,Q,p),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.mp(Q),this._viewMatrix}zoomOn(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];p=p||this.upp().meshes;const M=t.e.MinMax(p);let h=this._calculateLowerRadiusFromModelBoundingSphere(M.min,M.max);if(h=Math.max(Math.min(h,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=h*this.zoomOnFactor,this.mode===Y.e.ORTHOGRAPHIC_CAMERA){const p=this.upp().getEngine().getAspectRatio(this),b=h*this.zoomOnFactor/2;this.orthoLeft=-b*p,this.orthoRight=b*p,this.orthoBottom=-b,this.orthoTop=b}this.focusOn({min:M.min,max:M.max,distance:h},b)}focusOn(p){let b,M,h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===p.min){const h=p||this.upp().meshes;b=t.e.MinMax(h),M=y.QM.Distance(b.min,b.max)}else{b=p,M=p.distance}this._target=t.e.Center(b),h||(this.maxZ=2*M)}createRigCamera(p,b){let M=0;switch(this.cameraRigMode){case Y.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Y.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Y.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Y.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case Y.e.RIG_MODE_VR:M=this._cameraRigParams.stereoHalfAngle*(0===b?1:-1);break;case Y.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:M=this._cameraRigParams.stereoHalfAngle*(0===b?-1:1)}const h=new B(p,this.alpha+M,this.beta,this.radius,this._target,this.upp());return h._cameraRigParams={},h.isRigCamera=!0,h.rigParent=this,h.upVector=this.upVector,h.mode=this.mode,h.orthoLeft=this.orthoLeft,h.orthoRight=this.orthoRight,h.orthoBottom=this.orthoBottom,h.orthoTop=this.orthoTop,h}_updateRigCameras(){const p=this._rigCameras[0],b=this._rigCameras[1];switch(p.beta=b.beta=this.beta,this.cameraRigMode){case Y.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Y.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Y.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Y.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case Y.e.RIG_MODE_VR:p.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Y.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:p.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const h=y.QM.Distance(p,b),Q=this.upp().getEngine().getAspectRatio(this),mp=Math.tan(this.fov/2),P=mp*Q,w=.5*h*M,t=w*Math.sqrt(1+1/(P*P)),z=w*Math.sqrt(1+1/(mp*mp));return Math.max(t,z)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,h.e)([(0,Q.N)()],B.prototype,"alpha",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"beta",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"radius",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,h.e)([(0,Q.J)("target")],B.prototype,"_target",void 0),(0,h.e)([(0,Q.A)("targetHost")],B.prototype,"_targetHost",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"inertialAlphaOffset",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"inertialBetaOffset",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"inertialRadiusOffset",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"lowerAlphaLimit",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"upperAlphaLimit",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"lowerBetaLimit",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"upperBetaLimit",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"lowerRadiusLimit",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"upperRadiusLimit",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"lowerTargetYLimit",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"inertialPanningX",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"inertialPanningY",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"pinchToPanMaxDistance",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"panningDistanceLimit",void 0),(0,h.e)([(0,Q.J)()],B.prototype,"panningOriginTarget",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"panningInertia",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"zoomToMouseLocation",null),(0,h.e)([(0,Q.N)()],B.prototype,"zoomOnFactor",void 0),(0,h.e)([(0,Q.H)()],B.prototype,"targetScreenOffset",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"allowUpsideDown",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"useInputToRestoreState",void 0),(0,h.e)([(0,Q.N)()],B.prototype,"restoreStateInterpolationFactor",void 0),(0,U.c)("BABYLON.ArcRotateCamera",B)},14225:(p,b,M)=>{"use strict";M.d(b,{d:()=>y,h:()=>P});var h=M(12622),Q=M(12812),mp=M(13235),y={};class P{constructor(p){this.attachedToElement=!1,this.attached={},this.camera=p,this.checkInputs=()=>{}}add(p){const b=p.getSimpleName();this.attached[b]?h.d.Warn("camera input of type "+b+" already exists on camera"):(this.attached[b]=p,p.camera=this.camera,p.checkInputs&&(this.checkInputs=this._addCheckInputs(p.checkInputs.bind(p))),this.attachedToElement&&p.attachControl(this.noPreventDefault))}remove(p){for(const b in this.attached){const M=this.attached[b];if(M===p)return M.bX(),M.camera=null,delete this.attached[b],void this.rebuildInputCheck()}}removeByType(p){for(const b in this.attached){const M=this.attached[b];M.getClassName()===p&&(M.bX(),M.camera=null,delete this.attached[b],this.rebuildInputCheck())}}_addCheckInputs(p){const b=this.checkInputs;return()=>{b(),p()}}attachInput(p){this.attachedToElement&&p.attachControl(this.noPreventDefault)}attachElement(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){p=!mp.e.ForceAttachControlToAlwaysPreventDefault&&p,this.attachedToElement=!0,this.noPreventDefault=p;for(const b in this.attached)this.attached[b].attachControl(p)}}detachElement(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const b in this.attached)this.attached[b].bX(),p&&(this.attached[b].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const p in this.attached){const b=this.attached[p];b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(p){const b={};for(const M in this.attached){const p=this.attached[M],h=Q.e.Serialize(p);b[p.getClassName()]=h}p.inputsmgr=b}parse(p){const b=p.inputsmgr;if(b){this.clear();for(const p in b){const M=y[p];if(M){const h=b[p],mp=Q.e.Parse((()=>new M),h,null);this.add(mp)}}}else for(const M in this.attached){const b=y[this.attached[M].getClassName()];if(b){const h=Q.e.Parse((()=>new b),p,null);this.remove(this.attached[M]),this.add(h)}}}}},14218:(p,b,M)=>{"use strict";M.d(b,{d:()=>L});var h=M(12757),Q=M(12764),mp=M(12777),y=M(13266),P=M(14225),w=M(13054),t=M(12608);class z{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(p){p=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.upp(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const M=b.event;if(!M.metaKey)if(b.type===w.d.KEYDOWN){if(-1!==this.keysUp.indexOf(M.keyCode)||-1!==this.keysDown.indexOf(M.keyCode)||-1!==this.keysLeft.indexOf(M.keyCode)||-1!==this.keysRight.indexOf(M.keyCode)||-1!==this.keysUpward.indexOf(M.keyCode)||-1!==this.keysDownward.indexOf(M.keyCode)||-1!==this.keysRotateLeft.indexOf(M.keyCode)||-1!==this.keysRotateRight.indexOf(M.keyCode)||-1!==this.keysRotateUp.indexOf(M.keyCode)||-1!==this.keysRotateDown.indexOf(M.keyCode)){-1===this._keys.indexOf(M.keyCode)&&this._keys.push(M.keyCode),p||M.preventDefault()}}else if(-1!==this.keysUp.indexOf(M.keyCode)||-1!==this.keysDown.indexOf(M.keyCode)||-1!==this.keysLeft.indexOf(M.keyCode)||-1!==this.keysRight.indexOf(M.keyCode)||-1!==this.keysUpward.indexOf(M.keyCode)||-1!==this.keysDownward.indexOf(M.keyCode)||-1!==this.keysRotateLeft.indexOf(M.keyCode)||-1!==this.keysRotateRight.indexOf(M.keyCode)||-1!==this.keysRotateUp.indexOf(M.keyCode)||-1!==this.keysRotateDown.indexOf(M.keyCode)){const b=this._keys.indexOf(M.keyCode);b>=0&&this._keys.splice(b,1),p||M.preventDefault()}})))}bX(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const p=this.camera;for(let b=0;b<this._keys.length;b++){const M=this._keys[b],h=p._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(M)?p._localDirection.sb(-h,0,0):-1!==this.keysUp.indexOf(M)?p._localDirection.sb(0,0,h):-1!==this.keysRight.indexOf(M)?p._localDirection.sb(h,0,0):-1!==this.keysDown.indexOf(M)?p._localDirection.sb(0,0,-h):-1!==this.keysUpward.indexOf(M)?p._localDirection.sb(0,h,0):-1!==this.keysDownward.indexOf(M)?p._localDirection.sb(0,-h,0):-1!==this.keysRotateLeft.indexOf(M)?(p._localDirection.sb(0,0,0),p.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(M)?(p._localDirection.sb(0,0,0),p.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(M)?(p._localDirection.sb(0,0,0),p.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(M)&&(p._localDirection.sb(0,0,0),p.cameraRotation.x+=this._getLocalRotation()),p.upp().useRightHandedSystem&&(p._localDirection.z*=-1),p.getViewMatrix().invertToRef(p._cameraTransformMatrix),mp.QM.TransformNormalToRef(p._localDirection,p._cameraTransformMatrix,p._transformedDirection),p.cameraDirection.addInPlace(p._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const p=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*p}}(0,h.e)([(0,Q.N)()],z.prototype,"keysUp",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"keysUpward",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"keysDown",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"keysDownward",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"keysLeft",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"keysRight",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"rotationSpeed",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"keysRotateLeft",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"keysRotateRight",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"keysRotateUp",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"keysRotateDown",void 0),P.d.FreeCameraKeyboardMoveInput=z;var x=M(12617),S=M(13051);class X{constructor(){let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=p,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new x.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(p){p=t.Tools.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),M=b.getInputElement();this._pointerInput||(this._pointerInput=h=>{const Q=h.event,mp="touch"===Q.pointerType;if(!this.touchEnabled&&mp)return;if(h.type!==S.e.POINTERMOVE&&-1===this.buttons.indexOf(Q.button))return;const y=Q.target;if(h.type===S.e.POINTERDOWN){if(mp&&-1!==this._activePointerId||!mp&&-1!==this._currentActiveButton)return;this._activePointerId=Q.pointerId;try{null===y||void 0===y||y.setPointerCapture(Q.pointerId)}catch(P){}-1===this._currentActiveButton&&(this._currentActiveButton=Q.button),this._previousPosition={x:Q.clientX,y:Q.clientY},p||(Q.preventDefault(),M&&M.focus()),b.isPointerLock&&this._onMouseMove&&this._onMouseMove(h.event)}else if(h.type===S.e.POINTERUP){if(mp&&this._activePointerId!==Q.pointerId||!mp&&this._currentActiveButton!==Q.button)return;try{null===y||void 0===y||y.releasePointerCapture(Q.pointerId)}catch(P){}this._currentActiveButton=-1,this._previousPosition=null,p||Q.preventDefault(),this._activePointerId=-1}else if(h.type===S.e.POINTERMOVE&&(this._activePointerId===Q.pointerId||!mp))if(b.isPointerLock&&this._onMouseMove)this._onMouseMove(h.event);else if(this._previousPosition){const b=this.camera._calculateHandednessMultiplier(),M=(Q.clientX-this._previousPosition.x)*b,h=Q.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=M/this.angularSensibility,this.camera.cameraRotation.x+=h/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:M,offsetY:h}),this._previousPosition={x:Q.clientX,y:Q.clientY},p||Q.preventDefault()}}),this._onMouseMove=M=>{if(!b.isPointerLock)return;const h=this.camera._calculateHandednessMultiplier(),Q=M.movementX*h;this.camera.cameraRotation.y+=Q/this.angularSensibility;const mp=M.movementY;this.camera.cameraRotation.x+=mp/this.angularSensibility,this._previousPosition=null,p||M.preventDefault()},this._observer=this.camera.upp()._inputManager._addCameraPointerObserver(this._pointerInput,S.e.POINTERDOWN|S.e.POINTERUP|S.e.POINTERMOVE),M&&(this._contextMenuBind=p=>this.onContextMenu(p),M.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(p){p.preventDefault()}bX(){if(this._observer){if(this.camera.upp()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const p=this.camera.getEngine().getInputElement();p&&p.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,h.e)([(0,Q.N)()],X.prototype,"buttons",void 0),(0,h.e)([(0,Q.N)()],X.prototype,"angularSensibility",void 0),P.d.FreeCameraMouseInput=X;var c,J=M(13060);class g{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new x.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(p){p=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==S.e.POINTERWHEEL)return;const M=b.event,h=M.deltaMode===J.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*h*M.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*h*M.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*h*M.deltaZ/this._normalize,M.preventDefault&&(p||M.preventDefault())},this._observer=this.camera.upp()._inputManager._addCameraPointerObserver(this._wheel,S.e.POINTERWHEEL)}bX(){this._observer&&(this.camera.upp()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,h.e)([(0,Q.N)()],g.prototype,"wheelPrecisionX",void 0),(0,h.e)([(0,Q.N)()],g.prototype,"wheelPrecisionY",void 0),(0,h.e)([(0,Q.N)()],g.prototype,"wheelPrecisionZ",void 0),function(p){p[p.MoveRelative=0]="MoveRelative",p[p.RotateRelative=1]="RotateRelative",p[p.MoveScene=2]="MoveScene"}(c||(c={}));class f extends g{constructor(){super(...arguments),this._moveRelative=mp.QM.Zero(),this._rotateRelative=mp.QM.Zero(),this._moveScene=mp.QM.Zero(),this._wheelXAction=c.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=c.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(p){null===p&&this._wheelXAction!==c.MoveRelative||(this._wheelXAction=c.MoveRelative,this._wheelXActionCoordinate=p)}get wheelXMoveRelative(){return this._wheelXAction!==c.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(p){null===p&&this._wheelYAction!==c.MoveRelative||(this._wheelYAction=c.MoveRelative,this._wheelYActionCoordinate=p)}get wheelYMoveRelative(){return this._wheelYAction!==c.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(p){null===p&&this._wheelZAction!==c.MoveRelative||(this._wheelZAction=c.MoveRelative,this._wheelZActionCoordinate=p)}get wheelZMoveRelative(){return this._wheelZAction!==c.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(p){null===p&&this._wheelXAction!==c.RotateRelative||(this._wheelXAction=c.RotateRelative,this._wheelXActionCoordinate=p)}get wheelXRotateRelative(){return this._wheelXAction!==c.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(p){null===p&&this._wheelYAction!==c.RotateRelative||(this._wheelYAction=c.RotateRelative,this._wheelYActionCoordinate=p)}get wheelYRotateRelative(){return this._wheelYAction!==c.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(p){null===p&&this._wheelZAction!==c.RotateRelative||(this._wheelZAction=c.RotateRelative,this._wheelZActionCoordinate=p)}get wheelZRotateRelative(){return this._wheelZAction!==c.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(p){null===p&&this._wheelXAction!==c.MoveScene||(this._wheelXAction=c.MoveScene,this._wheelXActionCoordinate=p)}get wheelXMoveScene(){return this._wheelXAction!==c.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(p){null===p&&this._wheelYAction!==c.MoveScene||(this._wheelYAction=c.MoveScene,this._wheelYActionCoordinate=p)}get wheelYMoveScene(){return this._wheelYAction!==c.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(p){null===p&&this._wheelZAction!==c.MoveScene||(this._wheelZAction=c.MoveScene,this._wheelZActionCoordinate=p)}get wheelZMoveScene(){return this._wheelZAction!==c.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Tb(0),this._rotateRelative.Tb(0),this._moveScene.Tb(0),this._updateCamera(),this.camera.upp().useRightHandedSystem&&(this._moveRelative.z*=-1);const p=mp.Matrix.Zero();this.camera.getViewMatrix().invertToRef(p);const b=mp.QM.Zero();mp.QM.TransformNormalToRef(this._moveRelative,p,b),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(b),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(p,b,M){if(0===p)return;if(null===b||null===M)return;let h=null;switch(b){case c.MoveRelative:h=this._moveRelative;break;case c.RotateRelative:h=this._rotateRelative;break;case c.MoveScene:h=this._moveScene}switch(M){case 0:h.set(p,0,0);break;case 1:h.set(0,p,0);break;case 2:h.set(0,0,p)}}}(0,h.e)([(0,Q.N)()],f.prototype,"wheelXMoveRelative",null),(0,h.e)([(0,Q.N)()],f.prototype,"wheelYMoveRelative",null),(0,h.e)([(0,Q.N)()],f.prototype,"wheelZMoveRelative",null),(0,h.e)([(0,Q.N)()],f.prototype,"wheelXRotateRelative",null),(0,h.e)([(0,Q.N)()],f.prototype,"wheelYRotateRelative",null),(0,h.e)([(0,Q.N)()],f.prototype,"wheelZRotateRelative",null),(0,h.e)([(0,Q.N)()],f.prototype,"wheelXMoveScene",null),(0,h.e)([(0,Q.N)()],f.prototype,"wheelYMoveScene",null),(0,h.e)([(0,Q.N)()],f.prototype,"wheelZMoveScene",null),P.d.FreeCameraMouseWheelInput=f;class Y{constructor(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=p,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=t.Tools.IsSafari()}attachControl(p){p=t.Tools.BackCompatCameraNoPreventDefault(arguments);let b=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=M=>{const h=M.event,Q="mouse"===h.pointerType||this._isSafari&&"undefined"===typeof h.pointerType;if(this.allowMouse||!Q)if(M.type===S.e.POINTERDOWN){if(p||h.preventDefault(),this._pointerPressed.push(h.pointerId),1!==this._pointerPressed.length)return;b={x:h.clientX,y:h.clientY}}else if(M.type===S.e.POINTERUP){p||h.preventDefault();const M=this._pointerPressed.indexOf(h.pointerId);if(-1===M)return;if(this._pointerPressed.splice(M,1),0!=M)return;b=null,this._offsetX=null,this._offsetY=null}else if(M.type===S.e.POINTERMOVE){if(p||h.preventDefault(),!b)return;if(0!=this._pointerPressed.indexOf(h.pointerId))return;this._offsetX=h.clientX-b.x,this._offsetY=-(h.clientY-b.y)}}),this._observer=this.camera.upp()._inputManager._addCameraPointerObserver(this._pointerInput,S.e.POINTERDOWN|S.e.POINTERUP|S.e.POINTERMOVE),this._onLostFocus){const p=this.camera.getEngine().getInputElement();p&&p.addEventListener("blur",this._onLostFocus)}}bX(){if(this._pointerInput){if(this._observer&&(this.camera.upp()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const p=this.camera.getEngine().getInputElement();p&&p.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const p=this.camera,b=p._calculateHandednessMultiplier();p.cameraRotation.y=b*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)p.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const b=p._computeLocalCameraSpeed(),M=new mp.QM(0,0,0!==this.touchMoveSensibility?b*this._offsetY/this.touchMoveSensibility:0);mp.Matrix.RotationYawPitchRollToRef(p.rotation.y,p.rotation.x,0,p._cameraRotationMatrix),p.cameraDirection.addInPlace(mp.QM.TransformCoordinates(M,p._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,h.e)([(0,Q.N)()],Y.prototype,"touchAngularSensibility",void 0),(0,h.e)([(0,Q.N)()],Y.prototype,"touchMoveSensibility",void 0),P.d.FreeCameraTouchInput=Y;class a extends P.h{constructor(p){super(p),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new z),this}addMouse(){let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new X(p),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new f,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new Y),this}clear(){super.clear(),this._mouseInput=null}}var o=M(12730),l=M(12682);class L extends y.e{get angularSensibility(){const p=this.inputs.attached.mouse;return p?p.angularSensibility:0}set angularSensibility(p){const b=this.inputs.attached.mouse;b&&(b.angularSensibility=p)}get keysUp(){const p=this.inputs.attached.keyboard;return p?p.keysUp:[]}set keysUp(p){const b=this.inputs.attached.keyboard;b&&(b.keysUp=p)}get keysUpward(){const p=this.inputs.attached.keyboard;return p?p.keysUpward:[]}set keysUpward(p){const b=this.inputs.attached.keyboard;b&&(b.keysUpward=p)}get keysDown(){const p=this.inputs.attached.keyboard;return p?p.keysDown:[]}set keysDown(p){const b=this.inputs.attached.keyboard;b&&(b.keysDown=p)}get keysDownward(){const p=this.inputs.attached.keyboard;return p?p.keysDownward:[]}set keysDownward(p){const b=this.inputs.attached.keyboard;b&&(b.keysDownward=p)}get keysLeft(){const p=this.inputs.attached.keyboard;return p?p.keysLeft:[]}set keysLeft(p){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=p)}get keysRight(){const p=this.inputs.attached.keyboard;return p?p.keysRight:[]}set keysRight(p){const b=this.inputs.attached.keyboard;b&&(b.keysRight=p)}get keysRotateLeft(){const p=this.inputs.attached.keyboard;return p?p.keysRotateLeft:[]}set keysRotateLeft(p){const b=this.inputs.attached.keyboard;b&&(b.keysRotateLeft=p)}get keysRotateRight(){const p=this.inputs.attached.keyboard;return p?p.keysRotateRight:[]}set keysRotateRight(p){const b=this.inputs.attached.keyboard;b&&(b.keysRotateRight=p)}get keysRotateUp(){const p=this.inputs.attached.keyboard;return p?p.keysRotateUp:[]}set keysRotateUp(p){const b=this.inputs.attached.keyboard;b&&(b.keysRotateUp=p)}get keysRotateDown(){const p=this.inputs.attached.keyboard;return p?p.keysRotateDown:[]}set keysRotateDown(p){const b=this.inputs.attached.keyboard;b&&(b.keysRotateDown=p)}constructor(p,b,M){var h;super(p,b,M,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),h=this,this.ellipsoid=new mp.QM(.5,1,.5),this.ellipsoidOffset=new mp.QM(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=mp.QM.Zero(),this._diffPosition=mp.QM.Zero(),this._newPosition=mp.QM.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h._newPosition.mp(b),h._newPosition.subtractToRef(h._oldPosition,h._diffPosition),h._diffPosition.length()>l.b.CollisionsEpsilon&&(h.position.addToRef(h._diffPosition,h._deferredPositionUpdate),h._deferOnly?h._deferredUpdated=!0:h.position.mp(h._deferredPositionUpdate),h.IJ&&M&&h.IJ(M))},this.inputs=new a(this),this.inputs.addKeyboard().addMouse()}attachControl(p,b){b=t.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(b)}bX(){this.inputs.detachElement(),this.cameraDirection=new mp.QM(0,0,0),this.cameraRotation=new mp.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(p){this._collisionMask=isNaN(p)?-1:p}_collideWithWorld(p){let b;b=this.parent?mp.QM.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,b.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const M=this.upp().collisionCoordinator;this._collider||(this._collider=M.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let h=p;this.applyGravity&&(h=p.add(this.upp().gravity)),M.getNewPosition(this._oldPosition,h,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=mp.QM.Zero(),this._transformedDirection=mp.QM.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(p){this._needMoveForGravity=p}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.upp().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"kb"}}(0,h.e)([(0,Q.J)()],L.prototype,"ellipsoid",void 0),(0,h.e)([(0,Q.J)()],L.prototype,"ellipsoidOffset",void 0),(0,h.e)([(0,Q.N)()],L.prototype,"checkCollisions",void 0),(0,h.e)([(0,Q.N)()],L.prototype,"applyGravity",void 0),(0,o.c)("BABYLON.FreeCamera",L)},14995:(p,b,M)=>{"use strict";M.d(b,{e:()=>mp});var h=M(12867),Q=M(14997);class mp{constructor(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=M,this.oS=[],this._maxBlockCapacity=b||64,this._selectionContent=new h.b(1024),this._creationFunc=p}update(p,b,M){Q.e._CreateBlocks(p,b,M,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}ux(p){for(let b=0;b<this.ix.length;b++){this.ix[b].addEntry(p)}}Lx(p){for(let b=0;b<this.ix.length;b++){this.ix[b].removeEntry(p)}}select(p,b){this._selectionContent.reset();for(let M=0;M<this.ix.length;M++){this.ix[M].select(p,this._selectionContent,b)}return b?this._selectionContent.concat(this.oS):this._selectionContent.concatWithNoDuplicate(this.oS),this._selectionContent}intersects(p,b,M){this._selectionContent.reset();for(let h=0;h<this.ix.length;h++){this.ix[h].intersects(p,b,this._selectionContent,M)}return M?this._selectionContent.concat(this.oS):this._selectionContent.concatWithNoDuplicate(this.oS),this._selectionContent}intersectsRay(p){this._selectionContent.reset();for(let b=0;b<this.ix.length;b++){this.ix[b].intersectsRay(p,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.oS),this._selectionContent}}mp.CreationFuncForMeshes=(p,b)=>{const M=p.getBoundingInfo();!p.isBlocked&&M.boundingBox.intersectsMinMax(b.dS,b.IS)&&b.entries.push(p)},mp.CreationFuncForSubMeshes=(p,b)=>{p.getBoundingInfo().boundingBox.intersectsMinMax(b.dS,b.IS)&&b.entries.push(p)}},14997:(p,b,M)=>{"use strict";M.d(b,{e:()=>mp});var h=M(12777),Q=M(13120);class mp{constructor(p,b,M,h,Q,mp){this.entries=[],this.GS=new Array,this._capacity=M,this._depth=h,this._maxDepth=Q,this._creationFunc=mp,this._minPoint=p,this._maxPoint=b,this.GS.push(p.clone()),this.GS.push(b.clone()),this.GS.push(p.clone()),this.GS[2].x=b.x,this.GS.push(p.clone()),this.GS[3].y=b.y,this.GS.push(p.clone()),this.GS[4].z=b.z,this.GS.push(b.clone()),this.GS[5].z=p.z,this.GS.push(b.clone()),this.GS[6].x=p.x,this.GS.push(b.clone()),this.GS[7].y=p.y}get XM(){return this._capacity}get dS(){return this._minPoint}get IS(){return this._maxPoint}addEntry(p){if(this.ix)for(let b=0;b<this.ix.length;b++){this.ix[b].addEntry(p)}else this._creationFunc(p,this),this.entries.length>this.XM&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(p){if(this.ix){for(let b=0;b<this.ix.length;b++){this.ix[b].removeEntry(p)}return}const b=this.entries.indexOf(p);b>-1&&this.entries.splice(b,1)}addEntries(p){for(let b=0;b<p.length;b++){const M=p[b];this.addEntry(M)}}select(p,b,M){if(Q.c.IsInFrustum(this.GS,p)){if(this.ix){for(let h=0;h<this.ix.length;h++){this.ix[h].select(p,b,M)}return}M?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersects(p,b,M,h){if(Q.c.IntersectsSphere(this._minPoint,this._maxPoint,p,b)){if(this.ix){for(let Q=0;Q<this.ix.length;Q++){this.ix[Q].intersects(p,b,M,h)}return}h?M.concat(this.entries):M.concatWithNoDuplicate(this.entries)}}intersectsRay(p,b){if(p.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.ix){for(let M=0;M<this.ix.length;M++){this.ix[M].intersectsRay(p,b)}return}b.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){mp._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(p,b,M,Q,y,P,w,t){w.ix=new Array;const z=new h.QM((b.x-p.x)/2,(b.y-p.y)/2,(b.z-p.z)/2);for(let h=0;h<2;h++)for(let b=0;b<2;b++)for(let x=0;x<2;x++){const S=p.add(z.multiplyByFloats(h,b,x)),X=p.add(z.multiplyByFloats(h+1,b+1,x+1)),c=new mp(S,X,Q,y+1,P,t);c.addEntries(M),w.ix.push(c)}}}},15001:(p,b,M)=>{"use strict";M.d(b,{e:()=>z});var h=M(13013),Q=M(12777),mp=M(13217),y=M(14001),P=M(13043),w=M(14995),t=M(12652);h.b.prototype.createOrUpdateSelectionOctree=function(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,M=this._getComponent(P.c.NAME_OCTREE);M||(M=new z(this),this.o(M)),this.YS||(this.YS=new w.e(w.e.CreationFuncForMeshes,p,b));const h=this.getWorldExtends();return this.YS.update(h.min,h.max,this.meshes),this.YS},Object.defineProperty(h.b.prototype,"selectionOctree",{get:function(){return this.YS},enumerable:!0,configurable:!0}),mp.c.prototype.createOrUpdateSubmeshesOctree=function(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const M=this.upp();let h=M._getComponent(P.c.NAME_OCTREE);h||(h=new z(M),M.o(h)),this._submeshesOctree||(this._submeshesOctree=new w.e(w.e.CreationFuncForSubMeshes,p,b)),this.Zb(!0);const Q=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(Q.minimumWorld,Q.maximumWorld,this.Lb),this._submeshesOctree};class z{constructor(p){this.name=P.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new y.c(Q.QM.Zero(),new Q.QM(1,1,1)),(p=p||t.c.LastCreatedScene)&&(this.yM=p,this.yM.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.yM.getActiveSubMeshCandidates=p=>this.getActiveSubMeshCandidates(p),this.yM.getCollidingSubMeshCandidates=(p,b)=>this.getCollidingSubMeshCandidates(p,b),this.yM.getIntersectingSubMeshCandidates=(p,b)=>this.getIntersectingSubMeshCandidates(p,b))}register(){this.yM.onMeshRemovedObservable.add((p=>{const b=this.yM.selectionOctree;if(void 0!==b&&null!==b){const M=b.oS.indexOf(p);-1!==M&&b.oS.splice(M,1)}})),this.yM.onMeshImportedObservable.add((p=>{const b=this.yM.selectionOctree;void 0!==b&&null!==b&&b.ux(p)}))}getActiveMeshCandidates(){var p;return(null===(p=this.yM.YS)||void 0===p?void 0:p.select(this.yM.frustumPlanes))||this.yM._getDefaultMeshCandidates()}getActiveSubMeshCandidates(p){if(p._submeshesOctree&&p.useOctreeForRenderingSelection){return p._submeshesOctree.select(this.yM.frustumPlanes)}return this.yM._getDefaultSubMeshCandidates(p)}getIntersectingSubMeshCandidates(p,b){if(p._submeshesOctree&&p.useOctreeForPicking){y.c.TransformToRef(b,p.getWorldMatrix(),this._tempRay);return p._submeshesOctree.intersectsRay(this._tempRay)}return this.yM._getDefaultSubMeshCandidates(p)}getCollidingSubMeshCandidates(p,b){if(p._submeshesOctree&&p.useOctreeForCollisions){const M=b._velocityWorldLength+Math.max(b._radius.x,b._radius.y,b._radius.z);return p._submeshesOctree.intersects(b._basePointWorld,M)}return this.yM._getDefaultSubMeshCandidates(p)}rebuild(){}dispose(){}}},14001:(p,b,M)=>{"use strict";M.d(b,{c:()=>X});var h=M(13013),Q=M(13235),mp=M(12779),y=M(12777),P=M(12785),w=M(13107),t=M(13041),z=M(12652),x=M(13066);const S={internalPickerForMesh:void 0};class X{constructor(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:mp.d;this.origin=p,this.direction=b,this.length=M,this.epsilon=h}clone(){return new X(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const h=X._TmpVector3[0].sb(p.x-M,p.y-M,p.z-M),Q=X._TmpVector3[1].sb(b.x+M,b.y+M,b.z+M);let mp,y,P,w,t=0,z=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<h.x||this.origin.x>Q.x)return!1}else if(mp=1/this.direction.x,y=(h.x-this.origin.x)*mp,P=(Q.x-this.origin.x)*mp,P===-1/0&&(P=1/0),y>P&&(w=y,y=P,P=w),t=Math.max(y,t),z=Math.min(P,z),t>z)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<h.y||this.origin.y>Q.y)return!1}else if(mp=1/this.direction.y,y=(h.y-this.origin.y)*mp,P=(Q.y-this.origin.y)*mp,P===-1/0&&(P=1/0),y>P&&(w=y,y=P,P=w),t=Math.max(y,t),z=Math.min(P,z),t>z)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<h.z||this.origin.z>Q.z)return!1}else if(mp=1/this.direction.z,y=(h.z-this.origin.z)*mp,P=(Q.z-this.origin.z)*mp,P===-1/0&&(P=1/0),y>P&&(w=y,y=P,P=w),t=Math.max(y,t),z=Math.min(P,z),t>z)return!1;return!0}intersectsBox(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(p.minimum,p.maximum,b)}intersectsSphere(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const M=p.center.x-this.origin.x,h=p.center.y-this.origin.y,Q=p.center.z-this.origin.z,mp=M*M+h*h+Q*Q,y=p.radius+b,P=y*y;if(mp<=P)return!0;const w=M*this.direction.x+h*this.direction.y+Q*this.direction.z;if(w<0)return!1;return mp-w*w<=P}intersectsTriangle(p,b,M){const h=X._TmpVector3[0],Q=X._TmpVector3[1],mp=X._TmpVector3[2],P=X._TmpVector3[3],t=X._TmpVector3[4];b.subtractToRef(p,h),M.subtractToRef(p,Q),y.QM.CrossToRef(this.direction,Q,mp);const z=y.QM.Dot(h,mp);if(0===z)return null;const x=1/z;this.origin.subtractToRef(p,P);const S=y.QM.Dot(P,mp)*x;if(S<-this.epsilon||S>1+this.epsilon)return null;y.QM.CrossToRef(P,h,t);const c=y.QM.Dot(this.direction,t)*x;if(c<-this.epsilon||S+c>1+this.epsilon)return null;const J=y.QM.Dot(Q,t)*x;return J>this.length?null:new w.e(1-S-c,S,J)}intersectsPlane(p){let b;const M=y.QM.Dot(p.normal,this.direction);if(Math.abs(M)<9.99999997475243e-7)return null;{const h=y.QM.Dot(p.normal,this.origin);return b=(-p.d-h)/M,b<0?b<-9.99999997475243e-7?null:0:b}}intersectsAxis(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(p){case"y":{const p=(this.origin.y-b)/this.direction.y;return p>0?null:new y.QM(this.origin.x+this.direction.x*-p,b,this.origin.z+this.direction.z*-p)}case"x":{const p=(this.origin.x-b)/this.direction.x;return p>0?null:new y.QM(b,this.origin.y+this.direction.y*-p,this.origin.z+this.direction.z*-p)}case"z":{const p=(this.origin.z-b)/this.direction.z;return p>0?null:new y.QM(this.origin.x+this.direction.x*-p,this.origin.y+this.direction.y*-p,b)}default:return null}}intersectsMesh(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0,mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const P=y.TmpVectors.Matrix[0];return p.getWorldMatrix().invertToRef(P),this._tmpRay?X.TransformToRef(this,P,this._tmpRay):this._tmpRay=X.Transform(this,P),p.intersects(this._tmpRay,b,M,h,Q,mp)}intersectsMeshes(p,b,M){M?M.length=0:M=[];for(let h=0;h<p.length;h++){const Q=this.intersectsMesh(p[h],b);Q.hit&&M.push(Q)}return M.sort(this._comparePickingInfo),M}_comparePickingInfo(p,b){return p.distance<b.distance?-1:p.distance>b.distance?1:0}intersectionSegment(p,b,M){const h=this.origin,Q=y.TmpVectors.QM[0],mp=y.TmpVectors.QM[1],P=y.TmpVectors.QM[2],w=y.TmpVectors.QM[3];b.subtractToRef(p,Q),this.direction.scaleToRef(X._Rayl,P),h.addToRef(P,mp),p.subtractToRef(h,w);const t=y.QM.Dot(Q,Q),z=y.QM.Dot(Q,P),x=y.QM.Dot(P,P),S=y.QM.Dot(Q,w),c=y.QM.Dot(P,w),J=t*x-z*z;let g,f,Y=J,a=J;J<X._Smallnum?(g=0,Y=1,f=c,a=x):(g=z*c-x*S,f=t*c-z*S,g<0?(g=0,f=c,a=x):g>Y&&(g=Y,f=c+z,a=x)),f<0?(f=0,-S<0?g=0:-S>t?g=Y:(g=-S,Y=t)):f>a&&(f=a,-S+z<0?g=0:-S+z>t?g=Y:(g=-S+z,Y=t));const o=Math.abs(g)<X._Smallnum?0:g/Y,l=Math.abs(f)<X._Smallnum?0:f/a,L=y.TmpVectors.QM[4];P.scaleToRef(l,L);const u=y.TmpVectors.QM[5];Q.scaleToRef(o,u),u.addInPlace(w);const e=y.TmpVectors.QM[6];u.subtractToRef(L,e);return l>0&&l<=this.length&&e.lengthSquared()<M*M?u.length():-1}update(p,b,M,h,Q,mp,P){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){X._RayDistant||(X._RayDistant=X.Zero()),X._RayDistant.unprojectRayToRef(p,b,M,h,y.Matrix.IdentityReadOnly,mp,P);const w=y.TmpVectors.Matrix[0];Q.invertToRef(w),X.TransformToRef(X._RayDistant,w,this)}else this.unprojectRayToRef(p,b,M,h,Q,mp,P);return this}static Zero(){return new X(y.QM.Zero(),y.QM.Zero())}static CreateNew(p,b,M,h,Q,mp,y){return X.Zero().update(p,b,M,h,Q,mp,y)}static CreateNewFromTo(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.Matrix.IdentityReadOnly;const h=new X(new y.QM(0,0,0),new y.QM(0,0,0));return X.CreateFromToToRef(p,b,h,M)}static CreateFromToToRef(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.Matrix.IdentityReadOnly;M.origin.mp(p);const Q=b.subtractToRef(p,M.direction),mp=Math.sqrt(Q.x*Q.x+Q.y*Q.y+Q.z*Q.z);return M.length=mp,M.direction.normalize(),X.TransformToRef(M,h,M)}static Transform(p,b){const M=new X(new y.QM(0,0,0),new y.QM(0,0,0));return X.TransformToRef(p,b,M),M}static TransformToRef(p,b,M){y.QM.TransformCoordinatesToRef(p.origin,b,M.origin),y.QM.TransformNormalToRef(p.direction,b,M.direction),M.length=p.length,M.epsilon=p.epsilon;const h=M.direction,Q=h.length();if(0!==Q&&1!==Q){const p=1/Q;h.x*=p,h.y*=p,h.z*=p,M.length*=Q}return M}unprojectRayToRef(p,b,M,h,Q,mp,P){const w=y.TmpVectors.Matrix[0];Q.multiplyToRef(mp,w),w.multiplyToRef(P,w),w.invert();const t=z.c.LastCreatedEngine,x=y.TmpVectors.QM[0];x.x=p/M*2-1,x.y=-(b/h*2-1),x.z=null!==t&&void 0!==t&&t.zb?1:null!==t&&void 0!==t&&t.isNDCHalfZRange?0:-1;const S=y.TmpVectors.QM[1].sb(x.x,x.y,1-1e-8),X=y.TmpVectors.QM[2],c=y.TmpVectors.QM[3];y.QM._UnprojectFromInvertedMatrixToRef(x,w,X),y.QM._UnprojectFromInvertedMatrixToRef(S,w,c),this.origin.mp(X),c.subtractToRef(X,this.direction),this.direction.normalize()}}function c(p,b,M,h,Q){let mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=X.Zero();return J(p,b,M,h,y,Q,mp),y}function J(p,b,M,h,Q,mp){let P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const t=p.getEngine();if(!mp&&!(mp=p.activeCamera))return p;const z=mp.viewport,x=t.getRenderHeight(),{x:S,y:X,width:c,height:J}=z.toGlobal(t.getRenderWidth(),x),g=1/t.getHardwareScalingLevel();return b=b*g-S,M=M*g-(x-X-J),Q.update(b,M,c,J,h||y.Matrix.IdentityReadOnly,P?y.Matrix.IdentityReadOnly:mp.getViewMatrix(),mp.getProjectionMatrix(),w),p}function g(p,b,M,h,Q){if(!t.d)return p;const mp=p.getEngine();if(!Q&&!(Q=p.activeCamera))throw new Error("Active camera not set");const P=Q.viewport,w=mp.getRenderHeight(),{x:z,y:x,width:S,height:X}=P.toGlobal(mp.getRenderWidth(),w),c=y.Matrix.Identity(),J=1/mp.getHardwareScalingLevel();return b=b*J-z,M=M*J-(w-x-X),h.update(b,M,S,X,c,c,Q.getProjectionMatrix()),p}function f(p,b,M,h,Q,mp,y,P){const w=b(h,M.enableDistantPicking),t=M.intersects(w,Q,y,mp,h,P);return t&&t.hit?!Q&&null!=p&&t.distance>=p.distance?null:t:null}function Y(p,b,M,h,Q,mp){let P=null;const w=!!(p.activeCameras&&p.activeCameras.length>1&&p.cameraToUseForPointers!==p.activeCamera),z=p.cameraToUseForPointers||p.activeCamera,x=S.internalPickerForMesh||f;for(let t=0;t<p.meshes.length;t++){const S=p.meshes[t];if(M){if(!M(S,-1))continue}else if(!S.isEnabled()||!S.isVisible||!S.Ct)continue;const X=w&&S.isWorldMatrixCameraDependent(),c=S.Zb(X,z);if(S.hasThinInstances&&S.sz){const p=x(P,b,S,c,!0,!0,mp);if(p){if(Q)return p;const w=y.TmpVectors.Matrix[1],t=S.thinInstanceGetWorldMatrices();for(let p=0;p<t.length;p++){if(M&&!M(S,p))continue;t[p].multiplyToRef(c,w);const y=x(P,b,S,w,h,Q,mp,!0);if(y&&(P=y,P.thinInstanceIndex=p,h))return P}}}else{const p=x(P,b,S,c,h,Q,mp);if(p&&(P=p,h))return P}}return P||new t.d}function a(p,b,M,h){if(!t.d)return null;const Q=[],mp=!!(p.activeCameras&&p.activeCameras.length>1&&p.cameraToUseForPointers!==p.activeCamera),P=p.cameraToUseForPointers||p.activeCamera,w=S.internalPickerForMesh||f;for(let t=0;t<p.meshes.length;t++){const z=p.meshes[t];if(M){if(!M(z,-1))continue}else if(!z.isEnabled()||!z.isVisible||!z.Ct)continue;const x=mp&&z.isWorldMatrixCameraDependent(),S=z.Zb(x,P);if(z.hasThinInstances&&z.sz){if(w(null,b,z,S,!0,!0,h)){const p=y.TmpVectors.Matrix[1],mp=z.thinInstanceGetWorldMatrices();for(let y=0;y<mp.length;y++){if(M&&!M(z,y))continue;mp[y].multiplyToRef(S,p);const P=w(null,b,z,p,!1,!1,h,!0);P&&(P.thinInstanceIndex=y,Q.push(P))}}}else{const p=w(null,b,z,S,!1,!1,h);p&&Q.push(p)}}return Q}function o(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,h=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0;h||(h=p.getWorldMatrix()),b.length=M,Q?b.origin.mp(Q):b.origin.mp(p.position);const mp=y.TmpVectors.QM[2];mp.set(0,0,p._scene.useRightHandedSystem?-1:1);const P=y.TmpVectors.QM[3];return y.QM.TransformNormalToRef(mp,h,P),y.QM.NormalizeToRef(P,b.direction),b}var l,L;X._TmpVector3=(0,P.e)(6,y.QM.Zero),X._RayDistant=X.Zero(),X._Smallnum=1e-8,X._Rayl=1e9,l=h.b,(L=Q.e)&&(L.prototype.getForwardRay=function(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,b=arguments.length>1?arguments[1]:void 0,M=arguments.length>2?arguments[2]:void 0;return o(this,new X(y.QM.Zero(),y.QM.Zero(),p),p,b,M)},L.prototype.getForwardRayToRef=function(p){return o(this,p,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),l&&(x.c._IsPickingAvailable=!0,l.prototype.createPickingRay=function(p,b,M,h){return c(this,p,b,M,h,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),h.b.prototype.createPickingRayToRef=function(p,b,M,h,Q){return J(this,p,b,M,h,Q,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},h.b.prototype.createPickingRayInCameraSpace=function(p,b,M){return function(p,b,M,h){const Q=X.Zero();return g(p,b,M,Q,h),Q}(this,p,b,M)},h.b.prototype.createPickingRayInCameraSpaceToRef=function(p,b,M,h){return g(this,p,b,M,h)},h.b.prototype.pickWithBoundingInfo=function(p,b,M,h,Q){return function(p,b,M,h,Q,mp){if(!t.d)return null;const P=Y(p,(h=>(p._tempPickingRay||(p._tempPickingRay=X.Zero()),J(p,b,M,h,p._tempPickingRay,mp||null),p._tempPickingRay)),h,Q,!0);return P&&(P.ray=c(p,b,M,y.Matrix.Identity(),mp||null)),P}(this,p,b,M,h,Q)},h.b.prototype.Xh=function(p,b,M,h,Q,mp){return function(p,b,M,h,Q,mp,P){const w=Y(p,((h,Q)=>(p._tempPickingRay||(p._tempPickingRay=X.Zero()),J(p,b,M,h,p._tempPickingRay,mp||null,!1,Q),p._tempPickingRay)),h,Q,!1,P);return w&&(w.ray=c(p,b,M,y.Matrix.Identity(),mp||null)),w}(this,p,b,M,h,Q,mp)},h.b.prototype.pickWithRay=function(p,b,M,h){return function(p,b,M,h,Q){const mp=Y(p,(M=>(p._pickWithRayInverseMatrix||(p._pickWithRayInverseMatrix=y.Matrix.Identity()),M.invertToRef(p._pickWithRayInverseMatrix),p._cachedRayForTransform||(p._cachedRayForTransform=X.Zero()),X.TransformToRef(b,p._pickWithRayInverseMatrix,p._cachedRayForTransform),p._cachedRayForTransform)),M,h,!1,Q);return mp&&(mp.ray=b),mp}(this,p,b,M,h)},h.b.prototype.multiPick=function(p,b,M,h,Q){return function(p,b,M,h,Q,mp){return a(p,(h=>c(p,b,M,h,Q||null)),h,mp)}(this,p,b,M,h,Q)},h.b.prototype.multiPickWithRay=function(p,b,M){return function(p,b,M,h){return a(p,(M=>(p._pickWithRayInverseMatrix||(p._pickWithRayInverseMatrix=y.Matrix.Identity()),M.invertToRef(p._pickWithRayInverseMatrix),p._cachedRayForTransform||(p._cachedRayForTransform=X.Zero()),X.TransformToRef(b,p._pickWithRayInverseMatrix,p._cachedRayForTransform),p._cachedRayForTransform)),M,h)}(this,p,b,M)}},14284:(p,b,M)=>{"use strict";var h=M(12711),Q=M(12622),mp=M(12655),y=M(12739),P=M(12682),w=M(12721);P.b.prototype._partialLoadFile=function(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(p,(p=>{M[b]=p,M._internalCount++,6===M._internalCount&&h(M)}),void 0,void 0,!0,((p,b)=>{Q&&p&&Q(p.status+" "+p.statusText,b)}))},P.b.prototype._cascadeLoadFiles=function(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Q=[];Q._internalCount=0;for(let mp=0;mp<6;mp++)this._partialLoadFile(M[mp],mp,Q,b,h)},P.b.prototype._cascadeLoadImgs=function(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,mp=arguments.length>5?arguments[5]:void 0;const y=[];y._internalCount=0;for(let P=0;P<6;P++)this._partialLoadImg(h[P],P,y,p,b,M,Q,mp)},P.b.prototype._partialLoadImg=function(p,b,M,h,Q,P){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7?arguments[7]:void 0;const z=(0,y.c)();(0,mp.o)(p,(p=>{M[b]=p,M._internalCount++,h&&h.removePendingData(z),6===M._internalCount&&P&&P(Q,M)}),((p,b)=>{h&&h.removePendingData(z),w&&w(p,b)}),h?h.offlineProvider:null,t),h&&h.addPendingData(z)},P.b.prototype.createCubeTextureBase=function(p,b,M,mp){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,J=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,f=arguments.length>14&&void 0!==arguments[14]&&arguments[14],Y=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const a=c||new h.e(this,7);a.isCube=!0,a.url=p,a.generateMipMaps=!mp,a._lodGenerationScale=S,a._lodGenerationOffset=X,a._useSRGBBuffer=!!f&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!mp),a!==c&&(a.label=p.substring(0,60)),this._doNotHandleContextLost||(a._extension=z,a._files=M,a._buffer=Y);const o=p;this._transformTextureUrl&&!c&&(p=this._transformTextureUrl(p));const l=z??function(p){const b=p.split("?")[0],M=b.lastIndexOf(".");return M>-1?b.substring(M).toLowerCase():""}(p),L=(0,w.c)(l),u=(p,b)=>{a.dispose(),P?P(p,b):p&&Q.d.Warn(p)},e=(h,P)=>{p===o?h&&u(h.status+" "+h.statusText,P):(Q.d.Warn(`Failed to load ${p}, falling back to the ${o}`),this.createCubeTextureBase(o,b,M,!!mp,y,u,t,z,x,S,X,a,J,g,f,Y))};if(L)L.then((h=>{const Q=p=>{J&&J(a,p),h.loadCubeData(p,a,x,y,((p,b)=>{u(p,b)}))};Y?Q(Y):M&&6===M.length?h.supportCascades?this._cascadeLoadFiles(b,(p=>Q(p.map((p=>new Uint8Array(p))))),M,u):u("Textures type does not support cascades."):this._loadFile(p,(p=>Q(new Uint8Array(p))),void 0,void 0,!0,e)}));else{if(!M||0===M.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(b,a,((p,b)=>{g&&g(p,b)}),M,u)}return this._internalTexturesCache.push(a),a}},15005:(p,b,M)=>{"use strict";M(12622);var h=M(12897);M(12711),M(12852),M(12705),M(12948),M(12912);h.e},14311:(p,b,M)=>{"use strict";M.d(b,{e:()=>Q});var h=M(12730);class Q{constructor(p){this.value=this._toInt(p)}_toInt(p){return 0|p}add(p){return new Q(this.value+p.value)}mh(p){return new Q(this.value-p.value)}multiply(p){return new Q(Math.imul(this.value,p.value))}divide(p){return new Q(this.value/p.value)}getClassName(){return Q.ClassName}equals(p){return this.value===p.value}static FromValue(p){return new Q(p)}toString(){return this.value.toString()}}Q.ClassName="FlowGraphInteger",(0,h.c)("FlowGraphInteger",Q)},14321:(p,b,M)=>{"use strict";M.d(b,{c:()=>Q,e:()=>mp});var h=M(12777);class Q{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Jb=p}get m(){return this.Jb}transformVector(p){return this.transformVectorToRef(p,new h.Vector2)}transformVectorToRef(p,b){return b.x=p.x*this.Jb[0]+p.y*this.Jb[1],b.y=p.x*this.Jb[2]+p.y*this.Jb[3],b}ub(){return this.toArray()}toArray(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let b=0;b<4;b++)p[b]=this.Jb[b];return p}Jh(p){for(let b=0;b<4;b++)this.Jb[b]=p[b];return this}multiplyToRef(p,b){const M=p.Jb,h=this.Jb,Q=b.Jb;return Q[0]=M[0]*h[0]+M[1]*h[2],Q[1]=M[0]*h[1]+M[1]*h[3],Q[2]=M[2]*h[0]+M[3]*h[2],Q[3]=M[2]*h[1]+M[3]*h[3],b}multiply(p){return this.multiplyToRef(p,new Q)}divideToRef(p,b){const M=this.Jb,h=p.Jb,Q=b.Jb;return Q[0]=M[0]/h[0],Q[1]=M[1]/h[1],Q[2]=M[2]/h[2],Q[3]=M[3]/h[3],b}divide(p){return this.divideToRef(p,new Q)}addToRef(p,b){const M=this.Jb,h=p.m,Q=b.m;return Q[0]=M[0]+h[0],Q[1]=M[1]+h[1],Q[2]=M[2]+h[2],Q[3]=M[3]+h[3],b}add(p){return this.addToRef(p,new Q)}subtractToRef(p,b){const M=this.Jb,h=p.m,Q=b.m;return Q[0]=M[0]-h[0],Q[1]=M[1]-h[1],Q[2]=M[2]-h[2],Q[3]=M[3]-h[3],b}mh(p){return this.subtractToRef(p,new Q)}transpose(){const p=this.Jb;return new Q([p[0],p[2],p[1],p[3]])}determinant(){const p=this.Jb;return p[0]*p[3]-p[1]*p[2]}inverse(){const p=this.determinant();if(0===p)throw new Error("Matrix is not invertible");const b=this.Jb,M=1/p;return new Q([b[3]*M,-b[1]*M,-b[2]*M,b[0]*M])}equals(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const M=this.Jb,h=p.m;return 0===b?M[0]===h[0]&&M[1]===h[1]&&M[2]===h[2]&&M[3]===h[3]:Math.abs(M[0]-h[0])<b&&Math.abs(M[1]-h[1])<b&&Math.abs(M[2]-h[2])<b&&Math.abs(M[3]-h[3])<b}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Jb.join(", ")})`}}class mp{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Jb=p}get m(){return this.Jb}transformVector(p){return this.transformVectorToRef(p,new h.QM)}transformVectorToRef(p,b){const M=this.Jb;return b.x=p.x*M[0]+p.y*M[1]+p.z*M[2],b.y=p.x*M[3]+p.y*M[4]+p.z*M[5],b.z=p.x*M[6]+p.y*M[7]+p.z*M[8],b}multiplyToRef(p,b){const M=p.Jb,h=this.Jb,Q=b.m;return Q[0]=M[0]*h[0]+M[1]*h[3]+M[2]*h[6],Q[1]=M[0]*h[1]+M[1]*h[4]+M[2]*h[7],Q[2]=M[0]*h[2]+M[1]*h[5]+M[2]*h[8],Q[3]=M[3]*h[0]+M[4]*h[3]+M[5]*h[6],Q[4]=M[3]*h[1]+M[4]*h[4]+M[5]*h[7],Q[5]=M[3]*h[2]+M[4]*h[5]+M[5]*h[8],Q[6]=M[6]*h[0]+M[7]*h[3]+M[8]*h[6],Q[7]=M[6]*h[1]+M[7]*h[4]+M[8]*h[7],Q[8]=M[6]*h[2]+M[7]*h[5]+M[8]*h[8],b}multiply(p){return this.multiplyToRef(p,new mp)}divideToRef(p,b){const M=this.Jb,h=p.m,Q=b.m;return Q[0]=M[0]/h[0],Q[1]=M[1]/h[1],Q[2]=M[2]/h[2],Q[3]=M[3]/h[3],Q[4]=M[4]/h[4],Q[5]=M[5]/h[5],Q[6]=M[6]/h[6],Q[7]=M[7]/h[7],Q[8]=M[8]/h[8],b}divide(p){return this.divideToRef(p,new mp)}addToRef(p,b){const M=this.Jb,h=p.m,Q=b.m;return Q[0]=M[0]+h[0],Q[1]=M[1]+h[1],Q[2]=M[2]+h[2],Q[3]=M[3]+h[3],Q[4]=M[4]+h[4],Q[5]=M[5]+h[5],Q[6]=M[6]+h[6],Q[7]=M[7]+h[7],Q[8]=M[8]+h[8],b}add(p){return this.addToRef(p,new mp)}subtractToRef(p,b){const M=this.Jb,h=p.m,Q=b.m;return Q[0]=M[0]-h[0],Q[1]=M[1]-h[1],Q[2]=M[2]-h[2],Q[3]=M[3]-h[3],Q[4]=M[4]-h[4],Q[5]=M[5]-h[5],Q[6]=M[6]-h[6],Q[7]=M[7]-h[7],Q[8]=M[8]-h[8],b}mh(p){return this.subtractToRef(p,new mp)}toArray(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let b=0;b<9;b++)p[b]=this.Jb[b];return p}ub(){return this.toArray()}Jh(p){for(let b=0;b<9;b++)this.Jb[b]=p[b];return this}transpose(){const p=this.Jb;return new mp([p[0],p[3],p[6],p[1],p[4],p[7],p[2],p[5],p[8]])}determinant(){const p=this.Jb;return p[0]*(p[4]*p[8]-p[5]*p[7])-p[1]*(p[3]*p[8]-p[5]*p[6])+p[2]*(p[3]*p[7]-p[4]*p[6])}inverse(){const p=this.determinant();if(0===p)throw new Error("Matrix is not invertible");const b=this.Jb,M=1/p;return new mp([(b[4]*b[8]-b[5]*b[7])*M,(b[2]*b[7]-b[1]*b[8])*M,(b[1]*b[5]-b[2]*b[4])*M,(b[5]*b[6]-b[3]*b[8])*M,(b[0]*b[8]-b[2]*b[6])*M,(b[2]*b[3]-b[0]*b[5])*M,(b[3]*b[7]-b[4]*b[6])*M,(b[1]*b[6]-b[0]*b[7])*M,(b[0]*b[4]-b[1]*b[3])*M])}equals(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const M=this.Jb,h=p.m;return 0===b?M[0]===h[0]&&M[1]===h[1]&&M[2]===h[2]&&M[3]===h[3]&&M[4]===h[4]&&M[5]===h[5]&&M[6]===h[6]&&M[7]===h[7]&&M[8]===h[8]:Math.abs(M[0]-h[0])<b&&Math.abs(M[1]-h[1])<b&&Math.abs(M[2]-h[2])<b&&Math.abs(M[3]-h[3])<b&&Math.abs(M[4]-h[4])<b&&Math.abs(M[5]-h[5])<b&&Math.abs(M[6]-h[6])<b&&Math.abs(M[7]-h[7])<b&&Math.abs(M[8]-h[8])<b}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Jb.join(", ")})`}}},14328:(p,b,M)=>{"use strict";var h;function Q(p,b,M,h){switch(b){case"Animation":return h?p.animations.find((p=>p.uniqueId===M))??null:p.animations[M]??null;case"AnimationGroup":return h?p.animationGroups.find((p=>p.uniqueId===M))??null:p.animationGroups[M]??null;case"Mesh":return h?p.meshes.find((p=>p.uniqueId===M))??null:p.meshes[M]??null;case"Material":return h?p.materials.find((p=>p.uniqueId===M))??null:p.materials[M]??null;case"Wx":return h?p.cameras.find((p=>p.uniqueId===M))??null:p.cameras[M]??null;case"Light":return h?p.lights.find((p=>p.uniqueId===M))??null:p.lights[M]??null;default:return null}}M.d(b,{e:()=>Q}),function(p){p.Animation="Animation",p.AnimationGroup="AnimationGroup",p.Mesh="Mesh",p.Material="Material",p.Wx="Wx",p.Light="Light"}(h||(h={}))},14362:(p,b,M)=>{"use strict";M.d(b,{d:()=>Q});var h=M(14367);class Q extends h.d{constructor(p,b){if(super(p),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),b)for(const M of b)this._eventsSignalOutputs[M]=this._registerSignalOutput(M+"Event")}_executeOnTick(p){}_startPendingTasks(p){p._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(p),this._resetAfterCanceled(p)),this._preparePendingTasks(p),p._addPendingBlock(this),this.out._activateSignal(p),p._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(p){p._deleteExecutionVariable(this,"_initialized"),p._removePendingBlock(this)}}},14341:(p,b,M)=>{"use strict";M.d(b,{d:()=>t});var h=M(12739),Q=M(12730),mp=M(14344),y=M(12617),P=M(14306);class w extends mp.d{constructor(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:h.defaultValue,mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(p,b,M),this.richType=h,this._defaultValue=Q,this._optional=mp,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new y.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(p){this._isDisabled!==p&&(this._isDisabled=p,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(p,b){b._getConnectionValue(this)!==p&&(b._setConnectionValue(this,p),this.onValueChangedObservable.notifyObservers(p))}resetToDefaultValue(p){p._setConnectionValue(this,this._defaultValue)}connectTo(p){this._isDisabled||super.connectTo(p)}_getValueOrDefault(p){const b=p._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(b):b}getValue(p){if(1===this.connectionType){p._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(p);const b=this._getValueOrDefault(p);return this._lastValue=b,this.richType.typeTransformer?this.richType.typeTransformer(b):b}const b=this.isConnected()?this._connectedPoint[0].getValue(p):this._getValueOrDefault(p);return this._lastValue=b,this.richType.typeTransformer?this.richType.typeTransformer(b):b}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(p),p.richType={},this.richType.serialize(p.richType),p.optional=this._optional,(0,P.e)("defaultValue",this._defaultValue,p)}}(0,Q.c)("FlowGraphDataConnection",w);class t{constructor(p){var b;this.config=p,this.uniqueId=(0,h.c)(),this.name=(null===(b=this.config)||void 0===b?void 0:b.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(p){}registerDataInput(p,b,M){const h=new w(p,0,this,b,M);return this.dataInputs.push(h),h}registerDataOutput(p,b,M){const h=new w(p,1,this,b,M);return this.dataOutputs.push(h),h}getDataInput(p){return this.dataInputs.find((b=>b.name===p))}getDataOutput(p){return this.dataOutputs.find((b=>b.name===p))}serialize(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.e;if(p.uniqueId=this.uniqueId,p.config={},this.config){const M=this.config,h=Object.keys(M);for(const Q of h)b(Q,M[Q],p.config)}p.dataInputs=[],p.dataOutputs=[],p.className=this.getClassName();for(const M of this.dataInputs){const b={};M.serialize(b),p.dataInputs.push(b)}for(const M of this.dataOutputs){const b={};M.serialize(b),p.dataOutputs.push(b)}}deserialize(p){}_log(p,b,M){var h;null===(h=p.logger)||void 0===h||h.addLogItem({action:b,fh:M,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14344:(p,b,M)=>{"use strict";M.d(b,{d:()=>mp});var h,Q=M(12739);!function(p){p[p.Input=0]="Input",p[p.Output=1]="Output"}(h||(h={}));class mp{constructor(p,b,M){this._ownerBlock=M,this._connectedPoint=[],this.uniqueId=(0,Q.c)(),this.connectedPointIds=[],this.name=p,this._connectionType=b}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(p){if(this._connectionType===p._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||p._isSingularConnection()&&p._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(p),p._connectedPoint.push(this)}disconnectFrom(p){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const M=this._connectedPoint.indexOf(p),h=p._connectedPoint.indexOf(this);-1!==M&&-1!==h&&(b&&this._connectedPoint.splice(M,1),p._connectedPoint.splice(h,1))}disconnectFromAll(){for(const p of this._connectedPoint)this.disconnectFrom(p,!1);this._connectedPoint.length=0}dispose(){for(const p of this._connectedPoint)this.disconnectFrom(p)}serialize(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p.uniqueId=this.uniqueId,p.name=this.name,p._connectionType=this._connectionType,p.connectedPointIds=[],p.className=this.getClassName();for(const b of this._connectedPoint)p.connectedPointIds.push(b.uniqueId)}getClassName(){return"FGConnection"}deserialize(p){this.uniqueId=p.uniqueId,this.name=p.name,this._connectionType=p._connectionType,this.connectedPointIds=p.connectedPointIds}}},14298:(p,b,M)=>{"use strict";M.d(b,{c:()=>a});var h,Q=M(12617),mp=M(12757),y=M(12764),P=M(12739),w=M(14306),t=M(14328),z=M(12622);!function(p){p.ExecuteBlock="ExecuteBlock",p.ExecuteEvent="ExecuteEvent",p.TriggerConnection="TriggerConnection",p.ContextVariableSet="ContextVariableSet",p.GlobalVariableSet="GlobalVariableSet",p.GlobalVariableDelete="GlobalVariableDelete",p.GlobalVariableGet="GlobalVariableGet",p.AddConnection="AddConnection",p.GetConnectionValue="GetConnectionValue",p.SetConnectionValue="SetConnectionValue",p.ActivateSignal="ActivateSignal",p.ContextVariableGet="ContextVariableGet"}(h||(h={}));class x{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(p){if(p.time||(p.time=Date.now()),this.log.push(p),this.logToConsole){var b;const M=null===(b=p.fh)||void 0===b?void 0:b.value;"object"===typeof M&&M.getClassName?z.d.Log(`[FGLog] ${p.className}:${p.uniqueId.split("-")[0]} ${p.action} - ${JSON.stringify(M.getClassName())}: ${M.toString()}`):z.d.Log(`[FGLog] ${p.className}:${p.uniqueId.split("-")[0]} ${p.action} - ${JSON.stringify(p.fh)}`)}}getItemsOfType(p){return this.log.filter((b=>b.action===p))}}class S{get enableLogging(){return this._enableLogging}set enableLogging(p){this._enableLogging!==p&&(this._enableLogging=p,this._enableLogging?(this.logger=new x,this.logger.logToConsole=!0):this.logger=null)}constructor(p){this.uniqueId=(0,P.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new Q.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=p,this.assetsContext=p.assetsContext??p.yM}hasVariable(p){return p in this._userVariables}setVariable(p,b){var M;this._userVariables[p]=b,null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",fh:{name:p,value:b}})}getAsset(p,b){return(0,t.e)(this.assetsContext,p,b)}getVariable(p){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",fh:{name:p,value:this._userVariables[p]}}),this._userVariables[p]}get userVariables(){return this._userVariables}upp(){return this._configuration.yM}_getUniqueIdPrefixedName(p,b){return`${p.uniqueId}_${b}`}_getGlobalContextVariable(p,b){var M;return null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",fh:{name:p,defaultValue:b,possibleValue:this._globalContextVariables[p]}}),this._hasGlobalContextVariable(p)?this._globalContextVariables[p]:b}_setGlobalContextVariable(p,b){var M;null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",fh:{name:p,value:b}}),this._globalContextVariables[p]=b}_deleteGlobalContextVariable(p){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",fh:{name:p}}),delete this._globalContextVariables[p]}_hasGlobalContextVariable(p){return p in this._globalContextVariables}_setExecutionVariable(p,b,M){this._executionVariables[this._getUniqueIdPrefixedName(p,b)]=M}_getExecutionVariable(p,b,M){return this._hasExecutionVariable(p,b)?this._executionVariables[this._getUniqueIdPrefixedName(p,b)]:M}_deleteExecutionVariable(p,b){delete this._executionVariables[this._getUniqueIdPrefixedName(p,b)]}_hasExecutionVariable(p,b){return this._getUniqueIdPrefixedName(p,b)in this._executionVariables}_hasConnectionValue(p){return p.uniqueId in this._connectionValues}_setConnectionValue(p,b){var M;this._connectionValues[p.uniqueId]=b,null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",fh:{connectionPointId:p.uniqueId,value:b}})}_setConnectionValueByKey(p,b){this._connectionValues[p]=b}_getConnectionValue(p){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",fh:{connectionPointId:p.uniqueId,value:this._connectionValues[p.uniqueId]}}),this._connectionValues[p.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(p){this._pendingBlocks.includes(p)||(this._pendingBlocks.push(p),this._pendingBlocks.sort(((p,b)=>p.priority-b.priority)))}_removePendingBlock(p){const b=this._pendingBlocks.indexOf(p);-1!==b&&this._pendingBlocks.splice(b,1)}_clearPendingBlocks(){for(const p of this._pendingBlocks)p._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(p){var b;this.onNodeExecutedObservable.notifyObservers(p),null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:p.getClassName(),uniqueId:p.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(p){this._setGlobalContextVariable("timeSinceStart",p.timeSinceStart),this._setGlobalContextVariable("deltaTime",p.deltaTime);for(const M of this._pendingBlocks){var b;null===(b=M._executeOnTick)||void 0===b||b.call(M,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.e;p.uniqueId=this.uniqueId,p._userVariables={};for(const h in this._userVariables)b(h,this._userVariables[h],p._userVariables);p._connectionValues={};for(const h in this._connectionValues)b(h,this._connectionValues[h],p._connectionValues);var M;this.assetsContext!==this.upp()&&(p._assetsContext={meshes:this.assetsContext.meshes.map((p=>p.id)),materials:this.assetsContext.materials.map((p=>p.id)),textures:this.assetsContext.textures.map((p=>p.name)),animations:this.assetsContext.animations.map((p=>p.name)),lights:this.assetsContext.lights.map((p=>p.id)),cameras:this.assetsContext.cameras.map((p=>p.id)),ac:null===(M=this.assetsContext.ac)||void 0===M?void 0:M.map((p=>p.name)),skeletons:this.assetsContext.skeletons.map((p=>p.id)),LX:this.assetsContext.LX.map((p=>p.name)),geometries:this.assetsContext.geometries.map((p=>p.id)),multiMaterials:this.assetsContext.multiMaterials.map((p=>p.id)),transformNodes:this.assetsContext.transformNodes.map((p=>p.id))})}getClassName(){return"FlowGraphContext"}}(0,mp.e)([(0,y.N)()],S.prototype,"uniqueId",void 0);var X=M(14337),c=M(13051);class J{constructor(p){this.onEventTriggeredObservable=new Q.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=p,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Xb.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const p=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",fh:{timeSinceStart:this._startingTime,deltaTime:p}}),this._startingTime+=p})),this._meshPickedObserver=this._scene.onPointerObservable.add((p=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",fh:p})}),c.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((p=>{const b=p.pointerId,M=p.mesh,h=this._pointerUnderMeshState[b];!h&&M?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",fh:{pointerId:b,mesh:M}}):h&&!M?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",fh:{pointerId:b,mesh:h}}):h&&M&&h!==M&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",fh:{pointerId:b,mesh:h,over:M}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",fh:{pointerId:b,mesh:M,out:h}})),this._pointerUnderMeshState[b]=M}),c.e.POINTERMOVE)}dispose(){var p,b,M,h,Q;null===(p=this._sceneDisposeObserver)||void 0===p||p.remove(),null===(b=this._sceneReadyObserver)||void 0===b||b.remove(),null===(M=this._sceneOnBeforeRenderObserver)||void 0===M||M.remove(),null===(h=this._meshPickedObserver)||void 0===h||h.remove(),null===(Q=this._meshUnderPointerObserver)||void 0===Q||Q.remove(),this.onEventTriggeredObservable.clear()}}var g,f=M(14351);!function(p){p[p.Stopped=0]="Stopped",p[p.Started=1]="Started"}(g||(g={}));class Y{get state(){return this._state}set state(p){this._state=p,this.onStateChangedObservable.notifyObservers(p)}constructor(p){this.onStateChangedObservable=new Q.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=p.yM,this._sceneEventCoordinator=new J(this._scene),this._coordinator=p.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((p=>{for(const b of this._executionContexts){const M=this._getContextualOrder(p.type,b);for(const h of M)if(!h._executeEvent(b,p.fh))break}switch(p.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const b of this._executionContexts)b._notifyOnTick(p.fh);break;case"SceneDispose":this.dispose()}}))}createContext(){const p=new S({yM:this._scene,coordinator:this._coordinator});return this._executionContexts.push(p),p}getContext(p){return this._executionContexts[p]}addEventBlock(p){if("PointerOver"!==p.type&&"PointerOut"!==p.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==p.type&&this._eventBlocks[p.type].push(p),1===this.state)for(const b of this._executionContexts)p._startPendingTasks(b);else this.onStateChangedObservable.addOnce((b=>{if(1===b)for(const M of this._executionContexts)p._startPendingTasks(M)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((p=>{1===p&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const p of this._executionContexts)for(const b in this._eventBlocks){const M=this._getContextualOrder(b,p);for(const b of M)b._startPendingTasks(p)}}_getContextualOrder(p,b){const M=this._eventBlocks[p].sort(((p,b)=>b.initPriority-p.initPriority));if("MeshPick"===p){const p=[];for(const h of M){const Q=h.asset.getValue(b);let mp=0;for(;mp<M.length;mp++){const p=M[mp].asset.getValue(b);if(Q&&p&&(0,f.r)(Q,p))break}p.splice(mp,0,h)}return p}return M}dispose(){var p;if(0!==this.state){this.state=0;for(const p of this._executionContexts)p._clearPendingBlocks();this._executionContexts.length=0;for(const p in this._eventBlocks)this._eventBlocks[p].length=0;null===(p=this._eventObserver)||void 0===p||p.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(p){const b=[],M=new Set;for(const h in this._eventBlocks)for(const p of this._eventBlocks[h])b.push(p),M.add(p.uniqueId);for(;b.length>0;){const h=b.pop();p(h);for(const p of h.dataInputs)for(const h of p._connectedPoint)M.has(h._ownerBlock.uniqueId)||(b.push(h._ownerBlock),M.add(h._ownerBlock.uniqueId));if(h instanceof X.e)for(const p of h.signalOutputs)for(const h of p._connectedPoint)M.has(h._ownerBlock.uniqueId)||(b.push(h._ownerBlock),M.add(h._ownerBlock.uniqueId))}}serialize(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;p.allBlocks=[],this.visitAllBlocks((b=>{const M={};b.serialize(M),p.allBlocks.push(M)})),p.executionContexts=[];for(const M of this._executionContexts){const h={};M.serialize(h,b),p.executionContexts.push(h)}}}class a{constructor(p){this.config=p,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.yM.Xb.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.yM.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const p=this._executeOnNextFrame.slice(0);if(p.length)for(const b of p){this.notifyCustomEvent(b.id,b.data,!1);const p=this._executeOnNextFrame.findIndex((p=>p.uniqueId===b.uniqueId));-1!==p&&this._executeOnNextFrame.splice(p,1)}}));(a.SceneCoordinators.get(this.config.yM)??[]).push(this)}createGraph(){const p=new Y({yM:this.config.yM,coordinator:this});return this._flowGraphs.push(p),p}removeGraph(p){const b=this._flowGraphs.indexOf(p);-1!==b&&(p.dispose(),this._flowGraphs.splice(b,1))}start(){for(const p of this._flowGraphs)p.start()}dispose(){var p,b;for(const Q of this._flowGraphs)Q.dispose();this._flowGraphs.length=0,null===(p=this._disposeObserver)||void 0===p||p.remove(),null===(b=this._onBeforeRenderObserver)||void 0===b||b.remove();const M=a.SceneCoordinators.get(this.config.yM)??[],h=M.indexOf(this);-1!==h&&M.splice(h,1)}serialize(p,b){p._flowGraphs=[];for(const M of this._flowGraphs){const h={};M.serialize(h,b),p._flowGraphs.push(h)}p.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(p){let b=this._customEventsMap.get(p);return b||(b=new Q.d,this._customEventsMap.set(p,b)),b}notifyCustomEvent(p,b){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:p,data:b,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(p)){const b=this._eventExecutionCounter.get(p);if(this._eventExecutionCounter.set(p,b+1),b>=a.MaxEventTypeExecutionPerFrame)return void(b===a.MaxEventTypeExecutionPerFrame&&z.d.Warn(`FlowGraphCoordinator: Too many executions of event "${p}".`))}else this._eventExecutionCounter.set(p,1);const M=this._customEventsMap.get(p);M&&M.notifyObservers(b)}}a.MaxEventsPerType=30,a.MaxEventTypeExecutionPerFrame=30,a.SceneCoordinators=new Map},14353:(p,b,M)=>{"use strict";M.d(b,{e:()=>Q});var h=M(14362);class Q extends h.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(p){p._notifyExecuteNode(this),this.done._activateSignal(p)}}},14337:(p,b,M)=>{"use strict";M.d(b,{e:()=>P});var h=M(14341),Q=M(14344),mp=M(12730);class y extends Q.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(p){super.connectTo(p),this._connectedPoint.sort(((p,b)=>b.priority-p.priority))}_activateSignal(p){var b;if(null===(b=p.logger)||void 0===b||b.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,fh:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)p._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(p,this),p._increaseExecutionId();else for(const M of this._connectedPoint)M._activateSignal(p)}}(0,mp.c)("FlowGraphSignalConnection",y);class P extends h.d{constructor(p){super(p),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(p){const b=new y(p,0,this);return this.signalInputs.push(b),b}_registerSignalOutput(p){const b=new y(p,1,this);return this.signalOutputs.push(b),b}_unregisterSignalInput(p){const b=this.signalInputs.findIndex((b=>b.name===p));-1!==b&&(this.signalInputs[b].dispose(),this.signalInputs.splice(b,1))}_unregisterSignalOutput(p){const b=this.signalOutputs.findIndex((b=>b.name===p));-1!==b&&(this.signalOutputs[b].dispose(),this.signalOutputs.splice(b,1))}_reportError(p,b){this.error.fh="string"===typeof b?new Error(b):b,this.error._activateSignal(p)}getSignalInput(p){return this.signalInputs.find((b=>b.name===p))}getSignalOutput(p){return this.signalOutputs.find((b=>b.name===p))}serialize(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(p),p.signalInputs=[],p.signalOutputs=[];for(const b of this.signalInputs){const M={};b.serialize(M),p.signalInputs.push(M)}for(const b of this.signalOutputs){const M={};b.serialize(M),p.signalOutputs.push(M)}}deserialize(p){for(let b=0;b<p.signalInputs.length;b++){const M=this.getSignalInput(p.signalInputs[b].name);if(!M)throw new Error("Could not find signal input with name "+p.signalInputs[b].name+" in block "+p.className);M.deserialize(p.signalInputs[b])}for(let b=0;b<p.signalOutputs.length;b++){const M=this.getSignalOutput(p.signalOutputs[b].name);if(!M)throw new Error("Could not find signal output with name "+p.signalOutputs[b].name+" in block "+p.className);M.deserialize(p.signalOutputs[b])}}getClassName(){return"FlowGraphExecutionBlock"}}},14367:(p,b,M)=>{"use strict";M.d(b,{d:()=>Q});var h=M(14337);class Q extends h.e{constructor(p){super(p),this.out=this._registerSignalOutput("out")}}},14316:(p,b,M)=>{"use strict";M.d(b,{D:()=>J,G:()=>d,I:()=>I,L:()=>e,O:()=>u,e:()=>t,g:()=>S,k:()=>L,l:()=>g,m:()=>f,p:()=>Y,t:()=>x,v:()=>l,w:()=>z,y:()=>X,z:()=>c});var h,Q=M(12777),mp=M(12820),y=M(14311),P=M(14321);!function(p){p.Any="any",p.String="string",p.Number="number",p.Boolean="boolean",p.Object="object",p.Integer="FlowGraphInteger",p.Vector2="Vector2",p.QM="QM",p.Vector4="Vector4",p.Quaternion="Quaternion",p.Matrix="Matrix",p.Matrix2D="Matrix2D",p.Matrix3D="Matrix3D",p.wM="wM",p.Hb="Hb"}(h||(h={}));class w{constructor(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=p,this.defaultValue=b,this.animationType=M}serialize(p){p.typeName=this.typeName,p.defaultValue=this.defaultValue}}const t=new w("any",void 0),z=new w("string",""),x=new w("number",0,0),S=new w("boolean",!1),X=new w("Vector2",Q.Vector2.Zero(),5),c=new w("QM",Q.QM.Zero(),1),J=new w("Vector4",Q.Vector4.Zero()),g=new w("Matrix",Q.Matrix.Identity(),3),f=new w("Matrix2D",new P.c),Y=new w("Matrix3D",new P.e),a=new w("wM",mp.wM.Black(),4),o=new w("Hb",new mp.Hb(0,0,0,0),7),l=new w("Quaternion",Q.Quaternion.Identity(),2);l.typeTransformer=p=>{if(p.getClassName){if("Vector4"===p.getClassName())return Q.Quaternion.tM(p.ub());if("QM"===p.getClassName())return Q.Quaternion.FromEulerVector(p);if("Matrix"===p.getClassName())return Q.Quaternion.FromRotationMatrix(p)}return p};const L=new w("FlowGraphInteger",new y.e(0),0);function u(p){const b=p;switch(typeof p){case"string":return z;case"number":return x;case"boolean":return S;case"object":if(b.getClassName)switch(b.getClassName()){case"Vector2":return X;case"QM":return c;case"Vector4":return J;case"Matrix":return g;case"wM":return a;case"Hb":return o;case"Quaternion":return l;case"FlowGraphInteger":return L;case"Matrix2D":return f;case"Matrix3D":return Y}return t;default:return t}}function e(p){switch(p){case"string":return z;case"number":return x;case"boolean":return S;case"Vector2":return X;case"QM":return c;case"Vector4":return J;case"Matrix":return g;case"wM":return a;case"Hb":return o;case"Quaternion":return l;case"FlowGraphInteger":return L;case"Matrix2D":return f;case"Matrix3D":return Y;default:return t}}function d(p){switch(p){case"number":default:return 0;case"Vector2":return 5;case"QM":return 1;case"Matrix":return 3;case"wM":return 4;case"Hb":return 7;case"Quaternion":return 2}}function I(p){switch(p){case 0:return x;case 5:return X;case 1:return c;case 3:return g;case 4:return a;case 7:return o;case 2:return l;default:return t}}},14306:(p,b,M)=>{"use strict";M.d(b,{c:()=>z,e:()=>t,f:()=>x});var h=M(12820),Q=M(12777),mp=M(14311),y=M(14316),P=M(14321);function w(p){return"Vector2"===p||"QM"===p||"Vector4"===p||"Quaternion"===p||"wM"===p||"Hb"===p}function t(p,b,M){var h;const Q=(null===b||void 0===b||null===(h=b.getClassName)||void 0===h?void 0:h.call(b))??"";if(w(Q)||function(p){return"Matrix"===p||"Matrix2D"===p||"Matrix3D"===p}(Q))M[p]={value:b.ub(),className:Q};else if("FlowGraphInteger"===Q)M[p]={value:b.value,className:Q};else if(Q&&(b.id||b.name))M[p]={id:b.id,name:b.name,className:Q};else{if("object"===typeof b)throw new Error(`Could not serialize value ${b}`);M[p]=b}}function z(p,b,M,t){const x=b[p];let S;const X=(null===x||void 0===x?void 0:x.type)??(null===x||void 0===x?void 0:x.className);if(function(p){return"Mesh"===p||"AbstractMesh"===p||"GroundMesh"===p||"InstanceMesh"===p||"LinesMesh"===p||"GoldbergMesh"===p||"GreasedLineMesh"===p||"TrailMesh"===p}(X)){let p=t.meshes.filter((p=>x.id?p.id===x.id:p.name===x.name));0===p.length&&(p=t.transformNodes.filter((p=>x.id?p.id===x.id:p.name===x.name))),S=x.uniqueId?p.find((p=>p.uniqueId===x.uniqueId)):p[0]}else if(w(X))S=function(p,b){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===p)return Q.Vector2.tM(b);if("QM"===p)return M&&(b[2]*=-1),Q.QM.tM(b);if("Vector4"===p)return Q.Vector4.tM(b);if("Quaternion"===p)return M&&(b[2]*=-1,b[3]*=-1),Q.Quaternion.tM(b);if("wM"===p)return new h.wM(b[0],b[1],b[2]);if("Hb"===p)return new h.Hb(b[0],b[1],b[2],b[3]);throw new Error(`Unknown vector class name ${p}`)}(X,x.value);else if(function(p){return"AnimationGroup"===p}(X)){const p=t.animationGroups.filter((p=>p.name===x.name));S=1===p.length?p[0]:p.find((p=>p.uniqueId===x.uniqueId))}else S="Matrix"===X?Q.Matrix.tM(x.value):"Matrix2D"===X?new P.c(x.value):"Matrix3D"===X?new P.e(x.value):"FlowGraphInteger"===X?mp.e.FromValue(x.value):"number"===X||"string"===X||"boolean"===X?x.value[0]:x&&void 0!==x.value?x.value:Array.isArray(x)?x.reduce(((p,b)=>b.eventData?(p[b.id]={type:(0,y.L)(b.type)},"undefined"!==typeof b.value&&(p[b.id].value=z("value",b,M,t)),p):p),{}):x;return S}function x(p){return"FlowGraphJsonPointerParserBlock"===p}},14351:(p,b,M)=>{"use strict";function h(p,b){return!(!p.parent||p.parent!==b&&!h(p.parent,b))}function Q(p){if(p.getClassName)return p.getClassName()}function mp(p,b){return p===b&&("Vector2"===p||"QM"===p||"Vector4"===p||"Quaternion"===p)}function y(p,b){return p===b&&("Matrix"===p||"Matrix2D"===p||"Matrix3D"===p)}function P(p,b){return"FlowGraphInteger"===p&&"FlowGraphInteger"===b}function w(p,b){const M="number"===typeof p||"number"===typeof(null===p||void 0===p?void 0:p.value);return M&&!b?!isNaN(t(p)):M}function t(p){return"number"===typeof p?p:p.value}M.d(b,{e:()=>P,h:()=>y,k:()=>mp,n:()=>Q,r:()=>h,v:()=>t,x:()=>w})},14779:(p,b,M)=>{"use strict";M.r(b),M.d(b,{SceneInstrumentation:()=>mp});var h=M(12608),Q=M(12989);class mp{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(p){p!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=p,p?(this._onBeforeActiveMeshesEvaluationObserver=this.yM.onBeforeActiveMeshesEvaluationObservable.add((()=>{h.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.yM.onAfterActiveMeshesEvaluationObservable.add((()=>{h.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.yM.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yM.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(p){p!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=p,p?(this._onBeforeRenderTargetsRenderObserver=this.yM.onBeforeRenderTargetsRenderObservable.add((()=>{h.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.yM.onAfterRenderTargetsRenderObservable.add((()=>{h.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.yM.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yM.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(p){p!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=p,p?(this._onBeforeParticlesRenderingObserver=this.yM.onBeforeParticlesRenderingObservable.add((()=>{h.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.yM.onAfterParticlesRenderingObservable.add((()=>{h.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.yM.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yM.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(p){p!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=p,this.yM.spriteManagers&&(p?(this._onBeforeSpritesRenderingObserver=this.yM.onBeforeSpritesRenderingObservable.add((()=>{h.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.yM.onAfterSpritesRenderingObservable.add((()=>{h.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.yM.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.yM.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(p){p!==this._capturePhysicsTime&&this.yM.onBeforePhysicsObservable&&(this._capturePhysicsTime=p,p?(this._onBeforePhysicsObserver=this.yM.onBeforePhysicsObservable.add((()=>{h.Tools.StartPerformanceCounter("Ab"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.yM.onAfterPhysicsObservable.add((()=>{h.Tools.EndPerformanceCounter("Ab"),this._physicsTime.endMonitoring()}))):(this.yM.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.yM.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(p){p!==this._captureAnimationsTime&&(this._captureAnimationsTime=p,p?this._onAfterAnimationsObserver=this.yM.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.yM.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(p){this._captureFrameTime=p}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(p){this._captureInterFrameTime=p}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(p){p!==this._captureRenderTime&&(this._captureRenderTime=p,p?(this._onBeforeDrawPhaseObserver=this.yM.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),h.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.yM.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),h.Tools.EndPerformanceCounter("Main render")}))):(this.yM.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yM.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(p){p!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=p,p?(this._onBeforeCameraRenderObserver=this.yM.onBeforeCameraRenderObservable.add((p=>{this._cameraRenderTime.beginMonitoring(),h.Tools.StartPerformanceCounter(`Rendering camera ${p.name}`)})),this._onAfterCameraRenderObserver=this.yM.onAfterCameraRenderObservable.add((p=>{this._cameraRenderTime.endMonitoring(!1),h.Tools.EndPerformanceCounter(`Rendering camera ${p.name}`)}))):(this.yM.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yM.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.yM.getEngine()._drawCalls}constructor(p){this.yM=p,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new Q.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new Q.b,this._captureFrameTime=!1,this._frameTime=new Q.b,this._captureRenderTime=!1,this._renderTime=new Q.b,this._captureInterFrameTime=!1,this._interFrameTime=new Q.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new Q.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new Q.b,this._capturePhysicsTime=!1,this._physicsTime=new Q.b,this._captureAnimationsTime=!1,this._animationsTime=new Q.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new Q.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=p.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(h.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.yM.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=p.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(h.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Sb(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Sb(),this._captureParticlesRenderTime&&this._particlesRenderTime.Sb(),this._captureSpritesRenderTime&&this._spritesRenderTime.Sb(),this._captureRenderTime&&this._renderTime.Sb(),this._captureCameraRenderTime&&this._cameraRenderTime.Sb()}))}dispose(){this._disposed||(this.yM.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.yM.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yM.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.yM.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yM.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.yM.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.yM.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yM.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.yM.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.yM.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.yM.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yM.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.yM.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.yM.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.yM.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.yM.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yM.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.yM=null,this._disposed=!0)}}},14293:(p,b,M)=>{"use strict";M.d(b,{d:()=>z});var h=M(12757),Q=M(12764),mp=M(12777),y=M(13213),P=M(13327),w=M(13376),t=M(12730);y.d.AddNodeConstructor("Light_Type_1",((p,b)=>()=>new z(p,mp.QM.Zero(),b)));class z extends w.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(p){this._shadowFrustumSize=p,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(p){this._shadowOrthoScale=p,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(p){this._orthoLeft=p}get orthoRight(){return this._orthoRight}set orthoRight(p){this._orthoRight=p}get orthoTop(){return this._orthoTop}set orthoTop(p){this._orthoTop=p}get orthoBottom(){return this._orthoBottom}set orthoBottom(p){this._orthoBottom=p}constructor(p,b,M){super(p,M),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=b.scale(-1),this.direction=b}getClassName(){return"nb"}getTypeID(){return P.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(p,b,M){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(p):this._setDefaultAutoExtendShadowProjectionMatrix(p,b,M)}_setDefaultFixedFrustumShadowProjectionMatrix(p){const b=this.upp().activeCamera;b&&mp.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:b.Ib,void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,p,this.upp().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(p,b,M){const h=this.upp().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const p=mp.QM.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let h=Number.MAX_VALUE,Q=-Number.MAX_VALUE;for(let y=0;y<M.length;y++){const P=M[y];if(!P)continue;const w=P.getBoundingInfo().boundingBox;for(let M=0;M<w.vectorsWorld.length;M++)mp.QM.TransformCoordinatesToRef(w.vectorsWorld[M],b,p),p.x<this._orthoLeft&&(this._orthoLeft=p.x),p.y<this._orthoBottom&&(this._orthoBottom=p.y),p.x>this._orthoRight&&(this._orthoRight=p.x),p.y>this._orthoTop&&(this._orthoTop=p.y),this.autoCalcShadowZBounds&&(p.z<h&&(h=p.z),p.z>Q&&(Q=p.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=h,this._shadowMaxZ=Q)}const Q=this._orthoRight-this._orthoLeft,y=this._orthoTop-this._orthoBottom,P=void 0!==this.shadowMinZ?this.shadowMinZ:(null===h||void 0===h?void 0:h.Ib)||0,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===h||void 0===h?void 0:h.maxZ)||1e4,t=this.upp().getEngine().zb;mp.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-Q*this.shadowOrthoScale,this._orthoRight+Q*this.shadowOrthoScale,this._orthoBottom-y*this.shadowOrthoScale,this._orthoTop+y*this.shadowOrthoScale,t?w:P,t?P:w,p,this.upp().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(p,b){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,b),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,b),this)}transferToNodeMaterialEffect(p,b){return this.computeTransformedInformation()?(p.setFloat3(b,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(p.setFloat3(b,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(p){const b=this._scene.getEngine();return!b.zb&&b.isNDCHalfZRange?0:1}getDepthMaxZ(p){const b=this._scene.getEngine();return b.zb&&b.isNDCHalfZRange?0:1}prepareLightSpecificDefines(p,b){p["DIRLIGHT"+b]=!0}}(0,h.e)([(0,Q.N)()],z.prototype,"shadowFrustumSize",null),(0,h.e)([(0,Q.N)()],z.prototype,"shadowOrthoScale",null),(0,h.e)([(0,Q.N)()],z.prototype,"autoUpdateExtends",void 0),(0,h.e)([(0,Q.N)()],z.prototype,"autoCalcShadowZBounds",void 0),(0,h.e)([(0,Q.N)("orthoLeft")],z.prototype,"_orthoLeft",void 0),(0,h.e)([(0,Q.N)("orthoRight")],z.prototype,"_orthoRight",void 0),(0,h.e)([(0,Q.N)("orthoTop")],z.prototype,"_orthoTop",void 0),(0,h.e)([(0,Q.N)("orthoBottom")],z.prototype,"_orthoBottom",void 0),(0,t.c)("BABYLON.DirectionalLight",z)},14946:(p,b,M)=>{"use strict";M.d(b,{d:()=>z});var h=M(12757),Q=M(12764),mp=M(12777),y=M(12820),P=M(13213),w=M(13327),t=M(12730);P.d.AddNodeConstructor("Light_Type_3",((p,b)=>()=>new z(p,mp.QM.Zero(),b)));class z extends w.c{constructor(p,b,M){super(p,M),this.groundColor=new y.wM(0,0,0),this.direction=b||mp.QM.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Fb"}setDirectionToTarget(p){return this.direction=mp.QM.Normalize(p.mh(mp.QM.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(p,b){const M=mp.QM.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",M.x,M.y,M.z,0,b),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Vb),b),this}transferToNodeMaterialEffect(p,b){const M=mp.QM.Normalize(this.direction);return p.setFloat3(b,M.x,M.y,M.z),this}Zb(){return this._worldMatrix||(this._worldMatrix=mp.Matrix.Identity()),this._worldMatrix}getTypeID(){return w.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(p,b){p["HEMILIGHT"+b]=!0}}(0,h.e)([(0,Q.k)()],z.prototype,"groundColor",void 0),(0,h.e)([(0,Q.J)()],z.prototype,"direction",void 0),(0,t.c)("BABYLON.HemisphericLight",z)},14254:(p,b,M)=>{"use strict";M.d(b,{b:()=>x});var h=M(12757),Q=M(12764),mp=M(12777),y=M(13213),P=M(13327),w=M(13376),t=M(12753),z=M(12730);y.d.AddNodeConstructor("Light_Type_2",((p,b)=>()=>new x(p,mp.QM.Zero(),mp.QM.Zero(),0,0,b)));class x extends w.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(p){this._iesProfileTexture!==p&&(this._iesProfileTexture=p,this._iesProfileTexture&&x._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(p){this._angle=p,this._cosHalfAngle=Math.cos(.5*p),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(p){this._innerAngle=p,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(p){this._shadowAngleScale=p,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(p){this._projectionTextureLightNear=p,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(p){this._projectionTextureLightFar=p,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(p){this._projectionTextureUpDirection=p,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(p){this._projectionTexture!==p&&(this._projectionTexture=p,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(x._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):x._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(p){return void 0!==p.onGeneratedObservable}static _IsTexture(p){return void 0!==p.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(p){this._projectionTextureProjectionLightMatrix=p,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(p,b,M,h,Q,y){super(p,y),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=mp.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=mp.QM.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=mp.QM.Zero(),this._projectionTextureViewLightMatrix=mp.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=mp.Matrix.Zero(),this._projectionTextureScalingMatrix=mp.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=b,this.direction=M,this.angle=h,this.exponent=Q}getClassName(){return"SpotLight"}getTypeID(){return P.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(p){super._setDirection(p),this._projectionTextureViewLightDirty=!0}_setPosition(p){super._setPosition(p),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(p,b,M){const h=this.upp().activeCamera;if(!h)return;this._shadowAngleScale=this._shadowAngleScale||1;const Q=this._shadowAngleScale*this._angle,y=void 0!==this.shadowMinZ?this.shadowMinZ:h.Ib,P=void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,w=this.upp().getEngine().zb;mp.Matrix.PerspectiveFovLHToRef(Q,1,w?P:y,w?y:P,p,!0,this._scene.getEngine().isNDCHalfZRange,void 0,w)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),mp.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const p=this.projectionTextureLightFar,b=this.projectionTextureLightNear,M=p/(p-b),h=-M*b,Q=1/Math.tan(this._angle/2);mp.Matrix.FromValuesToRef(Q/1,0,0,0,0,Q,0,0,0,0,M,1,0,0,h,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof t.c){const p=this._projectionTexture.uScale/2,b=this._projectionTexture.vScale/2;mp.Matrix.FromValuesToRef(p,0,0,0,0,b,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(p,b){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),p.setMatrix("textureProjectionMatrix"+b,this._projectionTextureMatrix),p.setTexture("projectionLightTexture"+b,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&p.setTexture("iesLightTexture"+b,this._iesProfileTexture),this}transferToEffect(p,b){let M;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,b),M=mp.QM.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,b),M=mp.QM.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",M.x,M.y,M.z,this._cosHalfAngle,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,b),this}transferToNodeMaterialEffect(p,b){let M;return M=this.computeTransformedInformation()?mp.QM.Normalize(this.transformedDirection):mp.QM.Normalize(this.direction),this.upp().useRightHandedSystem?p.setFloat3(b,-M.x,-M.y,-M.z):p.setFloat3(b,M.x,M.y,M.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(p){const b=this._scene.getEngine(),M=void 0!==this.shadowMinZ?this.shadowMinZ:(null===p||void 0===p?void 0:p.Ib)??0;return b.zb&&b.isNDCHalfZRange?M:this._scene.getEngine().isNDCHalfZRange?0:M}getDepthMaxZ(p){const b=this._scene.getEngine(),M=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===p||void 0===p?void 0:p.maxZ)??1e4;return b.zb&&b.isNDCHalfZRange?0:M}prepareLightSpecificDefines(p,b){p["SPOTLIGHT"+b]=!0,p["PROJECTEDLIGHTTEXTURE"+b]=!(!this.projectionTexture||!this.projectionTexture.isReady()),p["IESLIGHTTEXTURE"+b]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,h.e)([(0,Q.N)()],x.prototype,"angle",null),(0,h.e)([(0,Q.N)()],x.prototype,"innerAngle",null),(0,h.e)([(0,Q.N)()],x.prototype,"shadowAngleScale",null),(0,h.e)([(0,Q.N)()],x.prototype,"exponent",void 0),(0,h.e)([(0,Q.N)()],x.prototype,"projectionTextureLightNear",null),(0,h.e)([(0,Q.N)()],x.prototype,"projectionTextureLightFar",null),(0,h.e)([(0,Q.N)()],x.prototype,"projectionTextureUpDirection",null),(0,h.e)([(0,Q.E)("projectedLightTexture")],x.prototype,"_projectionTexture",void 0),(0,z.c)("BABYLON.SpotLight",x)},13996:(p,b,M)=>{"use strict";M.d(b,{d:()=>y,e:()=>mp,f:()=>P});const h={},Q={};function mp(p,b){h[p]=b}function y(p,b){Q[p]=b}function P(p){return Q[p]?Q[p]:null}},13893:(p,b,M)=>{"use strict";M.d(b,{c:()=>u,g:()=>i});var h,Q=M(12608),mp=M(12617),y=M(13013),P=M(12652),w=M(12622),t=M(13243),z=M(12655),x=M(12664),S=M(12739),X=M(12682),c=M(12644);!function(p){p[p.Clean=0]="Clean",p[p.Stop=1]="Stop",p[p.Sync=2]="Sync",p[p.NoSync=3]="NoSync"}(h||(h={}));const J=new mp.d,g={};let f=!1;function Y(){return g[".babylon"]}function a(p,b){const M=g[p];return M||(w.d.Warn("Unable to find a plugin to load "+p+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),b?Y():void 0)}function o(p,b,M){let h="Unable to load from "+(p.rawData?"binary data":p.url);return b?h+=`: ${b}`:M&&(h+=`: ${M}`),h}async function l(p,b,M,h,Q,mp,y,P,w){var t;const x="data:"===(S=p.url).substring(0,5)?S.substring(5):null;var S;if(p.rawData&&!y)throw"When using ArrayBufferView to load data the file extension must be provided.";const f=x||y?"":function(p){const b=p.indexOf("?");-1!==b&&(p=p.substring(0,b));const M=p.lastIndexOf(".");return p.substring(M,p.length).toLowerCase()}(p.url);let o=y?a(y,!0):x?function(p){for(const b in g){const M=g[b].plugin;if(M.canDirectLoad&&M.canDirectLoad(p))return g[b]}return Y()}(p.url):a(f,!1);if(!o&&f){if(p.url&&!p.url.startsWith("blob:")){const b=await async function(p,b){const M=b.method||"GET";return await new Promise(((h,Q)=>{const mp=new c.e;mp.addEventListener("readystatechange",(()=>{if(4==mp.readyState)if(200==mp.status){const p={};if(b.responseHeaders)for(const M of b.responseHeaders)p[M]=mp.getResponseHeader(M)||"";h({response:mp.response,headerValues:p})}else Q(`Unable to fetch data from ${p}. Error code: ${mp.status}`)})),mp.open(M,p),mp.send()}))}(p.url,{method:"HEAD",responseHeaders:["Content-Type"]}),M=b.headerValues?b.headerValues["Content-Type"]:"";M&&(o=function(p){for(const b in g){const M=g[b];if(M.mimeType===p)return M}}(M))}o||(o=Y())}if(!o)throw new Error(`No plugin or fallback for ${y??p.url}`);if(!1===(null===w||void 0===w||null===(t=w[o.plugin.name])||void 0===t?void 0:t.enabled))throw new Error(`The '${o.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(p.rawData&&!o.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(p=>{if(o.plugin.createPlugin){const b=o.plugin.createPlugin(w??{});return b instanceof Promise?(b.then(p).catch((p=>{Q("Error instantiating plugin.",p)})),null):(p(b),b)}return p(o.plugin),o.plugin})((w=>{var t;if(!w)throw`The loader plugin corresponding to the '${y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(J.notifyObservers(w),x&&(w.canDirectLoad&&w.canDirectLoad(p.url)||!(0,z.k)(p.url))){if(w.directLoad){const p=w.directLoad(b,x);p instanceof Promise?p.then((p=>{M(w,p)})).catch((p=>{Q("Error in directLoad of _loadData: "+p,p)})):M(w,p)}else M(w,x);return}const S=o.isBinary,c=(p,h)=>{b.S?Q("Scene has been disposed"):M(w,p,h)};let g=null,f=!1;null===(t=w.Xb)||void 0===t||t.add((()=>{f=!0,g&&(g.abort(),g=null),mp()}));const Y=()=>{if(f)return;const M=(p,b)=>{Q(null===p||void 0===p?void 0:p.statusText,b)};if(!w.loadFile&&p.rawData)throw"Plugin does not support loading ArrayBufferView.";g=w.loadFile?w.loadFile(b,p.rawData||p.file||p.url,p.rootUrl,c,h,S,M,P):b._loadFile(p.file||p.url,c,h,!0,S,M)},a=b.getEngine();let l=a.enableOfflineSupport;if(l){let M=!1;for(const h of b.disableOfflineSupportExceptionRules)if(h.test(p.url)){M=!0;break}l=!M}l&&X.b.OfflineProviderFactory?b.offlineProvider=X.b.OfflineProviderFactory(p.url,Y,a.disableManifestCheck):Y()}))}function L(p,b){let M,h,mp=null,y=null;if(b)if(b.name)M=`file:${b.name}`,h=b.name,mp=b;else if(ArrayBuffer.isView(b))M="",h=(0,S.c)(),y=b;else if(b.startsWith("data:"))M=b,h="";else if(p){const mp=b;if("/"===mp.substring(0,1))return Q.Tools.Error("Wrong sceneFilename parameter"),null;M=p+mp,h=mp}else M=b,h=Q.Tools.GetFilename(b),p=Q.Tools.GetFolderPath(b);else M=p,h=Q.Tools.GetFilename(p),p=Q.Tools.GetFolderPath(p);return{url:M,rootUrl:p,name:h,file:mp,rawData:y}}function u(p){if("string"===typeof p.extensions){const b=p.extensions;g[b.toLowerCase()]={plugin:p,isBinary:!1}}else{const b=p.extensions,M=Object.keys(b);for(const h of M)g[h.toLowerCase()]={plugin:p,isBinary:b[h].isBinary,mimeType:b[h].mimeType}}}async function e(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.c.LastCreatedScene,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,mp=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!h)return w.d.Error("No scene available to import mesh to"),null;const X=L(b,M);if(!X)return null;const c={};h.addPendingData(c);const J=()=>{h.removePendingData(c)},g=(p,b)=>{const M=o(X,p,b);y?y(h,M,new x.k(M,x.i.SceneLoaderError,b)):w.d.Error(M),J()},f=mp?p=>{try{mp(p)}catch(b){g("Error in onProgress callback: "+b,b)}}:void 0,Y=(p,b,M,mp,y,P,w,t)=>{if(h.importedMeshesFiles.push(X.url),Q)try{Q(p,b,M,mp,y,P,w,t)}catch(z){g("Error in onSuccess callback: "+z,z)}h.removePendingData(c)};return await l(X,h,((b,M,Q)=>{if(b.rewriteRootURL&&(X.rootUrl=b.rewriteRootURL(X.rootUrl,Q)),b.importMesh){const Q=[],mp=[],y=[];if(!b.importMesh(p,h,M,X.rootUrl,Q,mp,y,g))return;h.loadingPluginName=b.name,Y(Q,mp,y,[],[],[],[],[])}else{b.importMeshAsync(p,h,M,X.rootUrl,f,X.name).then((p=>{h.loadingPluginName=b.name,Y(p.meshes,p.LX,p.skeletons,p.animationGroups,p.transformNodes,p.geometries,p.lights,p.spriteManagers)})).catch((p=>{g(p.message,p)}))}}),f,g,J,t,z,S)}async function d(p,b,M,h,Q,mp,y,P){return await new Promise(((w,t)=>{try{e(p,b,M,h,((p,b,M,h,Q,mp,y,P)=>{w({meshes:p,LX:b,skeletons:M,animationGroups:h,transformNodes:Q,geometries:mp,lights:y,spriteManagers:P})}),Q,((p,b,M)=>{t(M||new Error(b))}),mp,y,P).catch(t)}catch(x){t(x)}}))}async function I(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.c.LastCreatedEngine,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,mp=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};M?await v(p,b,new y.b(M),h,mp,w,t,z,x):Q.Tools.Error("No engine available")}async function G(p,b,M,h,Q,mp,y){return await new Promise(((P,w)=>{I(p,b,M,(p=>{P(p)}),h,((p,b,M)=>{w(M||new Error(b))}),Q,mp,y)}))}async function v(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.c.LastCreatedScene,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,mp=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!M)return w.d.Error("No scene available to append to"),null;const X=L(p,b);if(!X)return null;const c={};M.addPendingData(c);const J=()=>{M.removePendingData(c)};t.e.ShowLoadingScreen&&!f&&(f=!0,M.getEngine().displayLoadingUI(),M.executeWhenReady((()=>{M.getEngine().hideLoadingUI(),f=!1})));const g=(p,b)=>{const h=o(X,p,b);mp?mp(M,h,new x.k(h,x.i.SceneLoaderError,b)):w.d.Error(h),J()},Y=Q?p=>{try{Q(p)}catch(b){g("Error in onProgress callback",b)}}:void 0,a=()=>{if(h)try{h(M)}catch(p){g("Error in onSuccess callback",p)}M.removePendingData(c)};return await l(X,M,((p,b)=>{if(p.load){if(!p.load(M,b,X.rootUrl,g))return;M.loadingPluginName=p.name,a()}else{p.loadAsync(M,b,X.rootUrl,Y,X.name).then((()=>{M.loadingPluginName=p.name,a()})).catch((p=>{g(p.message,p)}))}}),Y,g,J,y,z,S)}async function Z(p,b,M,h,Q,mp,y){return await new Promise(((P,w)=>{try{v(p,b,M,(p=>{P(p)}),h,((p,b,M)=>{w(M||new Error(b))}),Q,mp,y).catch(w)}catch(x){w(x)}}))}async function U(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.c.LastCreatedScene,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,mp=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!M)return w.d.Error("No scene available to load asset container to"),null;const S=L(p,b);if(!S)return null;const X={};M.addPendingData(X);const c=()=>{M.removePendingData(X)},J=(p,b)=>{const h=o(S,p,b);mp?mp(M,h,new x.k(h,x.i.SceneLoaderError,b)):w.d.Error(h),c()},g=Q?p=>{try{Q(p)}catch(b){J("Error in onProgress callback",b)}}:void 0,f=p=>{if(h)try{h(p)}catch(b){J("Error in onSuccess callback",b)}M.removePendingData(X)};return await l(S,M,((p,b)=>{if(p.loadAssetContainer){const h=p.loadAssetContainer(M,b,S.rootUrl,J);if(!h)return;h.populateRootNodes(),M.loadingPluginName=p.name,f(h)}else if(p.loadAssetContainerAsync){p.loadAssetContainerAsync(M,b,S.rootUrl,g,S.name).then((b=>{b.populateRootNodes(),M.loadingPluginName=p.name,f(b)})).catch((p=>{J(p.message,p)}))}else J("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),g,J,c,y,t,z)}async function q(p,b,M,h,Q,mp,y){return await new Promise(((P,w)=>{try{U(p,b,M,(p=>{P(p)}),h,((p,b,M)=>{w(M||new Error(b))}),Q,mp,y).catch(w)}catch(x){w(x)}}))}async function B(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.c.LastCreatedScene,h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,mp=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,S=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!M)return void w.d.Error("No scene available to load animations to");if(h){for(const h of M.animatables)h.reset();M.stopAllAnimations();const p=M.animationGroups.slice();for(const M of p)M.dispose();const b=M.getNodes();for(const M of b)M.animations&&(M.animations=[])}else switch(Q){case 0:const p=M.animationGroups.slice();for(const b of p)b.dispose();break;case 1:for(const b of M.animationGroups)b.stop();break;case 2:for(const b of M.animationGroups)b.reset(),b.restart();break;case 3:break;default:return void w.d.Error("Unknown animation group loading mode value '"+Q+"'")}const c=M.animatables.length;await U(p,b,M,(p=>{p.mergeAnimationsTo(M,M.animatables.slice(c),mp),p.dispose(),M.onAnimationFileImportedObservable.notifyObservers(M),y&&y(M)}),t,z,x,S,X)}async function s(p,b,M,h,Q,mp,y,P,w,t){return await new Promise(((z,S)=>{try{B(p,b,M,h,Q,mp,(p=>{z(p)}),y,((p,b,M)=>{S(M||new Error(b))}),P,w,t).catch(S)}catch(x){S(x)}}))}class i{static get ForceFullSceneLoadingForIncremental(){return t.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(p){t.e.ForceFullSceneLoadingForIncremental=p}static get ShowLoadingScreen(){return t.e.ShowLoadingScreen}static set ShowLoadingScreen(p){t.e.ShowLoadingScreen=p}static get loggingLevel(){return t.e.loggingLevel}static set loggingLevel(p){t.e.loggingLevel=p}static get CleanBoneMatrixWeights(){return t.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(p){t.e.CleanBoneMatrixWeights=p}static GetDefaultPlugin(){return Y()}static GetPluginForExtension(p){var b;return null===(b=a(p,!0))||void 0===b?void 0:b.plugin}static IsPluginForExtensionAvailable(p){return function(p){return!!g[p]}(p)}static RegisterPlugin(p){u(p)}static ImportMesh(p,b,M,h,Q,mp,y,w,t){e(p,b,M,h,Q,mp,y,w,t).catch((p=>null===y||void 0===y?void 0:y(P.c.LastCreatedScene,null===p||void 0===p?void 0:p.message,p)))}static async ImportMeshAsync(p,b,M,h,Q,mp,y){return await d(p,b,M,h,Q,mp,y)}static Load(p,b,M,h,Q,mp,y,w){I(p,b,M,h,Q,mp,y,w).catch((p=>null===mp||void 0===mp?void 0:mp(P.c.LastCreatedScene,null===p||void 0===p?void 0:p.message,p)))}static async LoadAsync(p,b,M,h,Q,mp){return await G(p,b,M,h,Q,mp)}static Append(p,b,M,h,Q,mp,y,w){v(p,b,M,h,Q,mp,y,w).catch((p=>null===mp||void 0===mp?void 0:mp(M??P.c.LastCreatedScene,null===p||void 0===p?void 0:p.message,p)))}static async AppendAsync(p,b,M,h,Q,mp){return await Z(p,b,M,h,Q,mp)}static LoadAssetContainer(p,b,M,h,Q,mp,y,w){U(p,b,M,h,Q,mp,y,w).catch((p=>null===mp||void 0===mp?void 0:mp(M??P.c.LastCreatedScene,null===p||void 0===p?void 0:p.message,p)))}static async LoadAssetContainerAsync(p,b,M,h,Q,mp){return await q(p,b,M,h,Q,mp)}static ImportAnimations(p,b,M,h,Q,mp,y,w,t,z,x){B(p,b,M,h,Q,mp,y,w,t,z,x).catch((p=>null===t||void 0===t?void 0:t(M??P.c.LastCreatedScene,null===p||void 0===p?void 0:p.message,p)))}static async ImportAnimationsAsync(p,b,M,h,Q,mp,y,P,w,t,z){return await s(p,b,M,h,Q,mp,P,t,z)}}i.NO_LOGGING=0,i.MINIMAL_LOGGING=1,i.SUMMARY_LOGGING=2,i.DETAILED_LOGGING=3,i.OnPluginActivatedObservable=J},14275:(p,b,M)=>{"use strict";M.d(b,{b:()=>S});var h=M(12757),Q=M(12764),mp=M(12608),y=M(12777),P=M(12798),w=M(12753),t=M(12730),z=M(12617),x=M(12812);M(14284);class S extends P.e{set boundingBoxSize(p){if(this._boundingBoxSize&&this._boundingBoxSize.equals(p))return;this._boundingBoxSize=p;const b=this.upp();b&&b.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(p){this._rotationY=p,this.setReflectionTextureMatrix(y.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(p,b,M){let h="";for(const Q of p)h+=Q;return new S(h,b,null,M,p)}static CreateFromPrefilteredData(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Q=b.useDelayedTextureLoading;b.useDelayedTextureLoading=!1;const mp=new S(p,b,null,!1,null,null,null,void 0,!0,M,h);return b.useDelayedTextureLoading=Q,mp}constructor(p,b){var M;let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],mp=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,S=arguments.length>8&&void 0!==arguments[8]&&arguments[8],X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]&&arguments[10],J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,g=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13?arguments[13]:void 0,Y=arguments.length>14?arguments[14]:void 0;super(b),this.onLoadObservable=new z.d,this.boundingBoxPosition=y.QM.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new y.Matrix,this._buffer=null,this.name=p,this.url=p,this._noMipmap=Q,this.lb=!1,this.isCube=!0,this._textureMatrix=y.Matrix.Identity(),this.coordinatesMode=w.c.CUBIC_MODE;let a=null,o=null;null===h||Array.isArray(h)?(this._noMipmap=Q,this._format=x,this._createPolynomials=c,a=h,this._loaderOptions=f,this._useSRGBBuffer=Y,this._lodScale=J,this._lodOffset=g):(a=h.extensions??null,this._noMipmap=h.noMipmap??!1,mp=h.files??null,o=h.buffer??null,this._format=h.format??5,S=h.prefiltered??!1,X=h.forcedExtension??null,this._createPolynomials=h.createPolynomials??!1,this._lodScale=h.lodScale??.8,this._lodOffset=h.lodOffset??0,this._loaderOptions=h.loaderOptions,this._useSRGBBuffer=h.useSRGBBuffer,P=h.A??null,t=h.onError??null),(p||mp)&&this.updateURL(p,X,P,S,t,a,null===(M=this.upp())||void 0===M?void 0:M.useDelayedTextureLoading,mp,o)}getClassName(){return"CubeTexture"}updateURL(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,mp=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=p),this.url=p,b&&(this._forcedExtension=b);const t=p.lastIndexOf("."),z=b||(t>-1?p.substring(t).toLowerCase():""),x=0===z.indexOf(".dds"),S=0===z.indexOf(".env"),X=0===z.indexOf(".basis");if(S?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=h,h&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),P)this._files=P;else if(X||S||x||mp||(mp=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,mp){for(let b=0;b<mp.length;b++)this._files.push(p+mp[b]);this._extensions=mp}this._buffer=w,y?(this.delayLoadState=4,this._delayedOnLoad=M,this._delayedOnError=Q):this._loadTexture(M,Q)}delayLoad(p){4===this.delayLoadState&&(p&&(this._forcedExtension=p),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(p){var b,M;if(p.updateFlag===this._textureMatrix.updateFlag)return;p.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(M=this.upp())||void 0===M||M.markAllMaterialsAsDirty(1,(p=>-1!==p.getActiveTextures().indexOf(this))));if(this._textureMatrix=p,null===(b=this.upp())||void 0===b||!b.useRightHandedSystem)return;const h=y.TmpVectors.QM[0],Q=y.TmpVectors.Quaternion[0],mp=y.TmpVectors.QM[1];this._textureMatrix.decompose(h,Q,mp),Q.z*=-1,Q.w*=-1,y.Matrix.ComposeToRef(h,Q,mp,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var p;return null!==(p=this.upp())&&void 0!==p&&p.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=this.upp(),h=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const Q=()=>{var b;(this.onLoadObservable.notifyObservers(this),h)&&(h.dispose(),null===(b=this.upp())||void 0===b||b.markAllMaterialsAsDirty(1));p&&p()},y=(p,M)=>{this._loadingError=!0,this._errorObject={message:p,exception:M},b&&b(p,M),w.c.OnTextureLoadErrorObservable.notifyObservers(this)};var P;this._texture?this._texture.isReady?mp.Tools.SetImmediate((()=>Q())):this._texture.onLoadedObservable.add((()=>Q())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,M,this._lodScale,this._lodOffset,p,y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,M,this._files,this._noMipmap,p,y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(P=this._texture)||void 0===P||P.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(p,b,M){const h=x.e.Parse((()=>{let h=!1;return p.prefiltered&&(h=p.prefiltered),new S(M+(p.url??p.name),b,p.extensions,!1,p.files||null,null,null,void 0,h,p.forcedExtension)}),p,b);if(p.boundingBoxPosition&&(h.boundingBoxPosition=y.QM.tM(p.boundingBoxPosition)),p.boundingBoxSize&&(h.boundingBoxSize=y.QM.tM(p.boundingBoxSize)),p.animations)for(let Q=0;Q<p.animations.length;Q++){const b=p.animations[Q],M=(0,t.b)("BABYLON.Animation");M&&h.animations.push(M.Parse(b))}return h}clone(){let p=0;const b=x.e.Clone((()=>{const b=new S(this.url,this.upp()||this._getEngine(),this._extensions,this._noMipmap,this._files);return p=b.uniqueId,b}),this);return b.uniqueId=p,b}}(0,h.e)([(0,Q.N)()],S.prototype,"url",void 0),(0,h.e)([(0,Q.J)()],S.prototype,"boundingBoxPosition",void 0),(0,h.e)([(0,Q.J)()],S.prototype,"boundingBoxSize",null),(0,h.e)([(0,Q.N)("rotationY")],S.prototype,"rotationY",null),(0,h.e)([(0,Q.N)("files")],S.prototype,"_files",void 0),(0,h.e)([(0,Q.N)("forcedExtension")],S.prototype,"_forcedExtension",void 0),(0,h.e)([(0,Q.N)("extensions")],S.prototype,"_extensions",void 0),(0,h.e)([(0,Q.x)("textureMatrix")],S.prototype,"_textureMatrix",void 0),(0,h.e)([(0,Q.x)("textureMatrixRefraction")],S.prototype,"_textureMatrixRefraction",void 0),w.c._CubeTextureParser=S.Parse,(0,t.c)("BABYLON.CubeTexture",S)},14955:(p,b,M)=>{"use strict";M.d(b,{e:()=>w});var h=M(12622),Q=M(12753),mp=M(12741),y=M(12905),P=M(12711);y.ThinEngine.prototype.createDynamicTexture=function(p,b,M,h){const Q=new P.e(this,4);return Q.baseWidth=p,Q.baseHeight=b,M&&(p=this.needPOTTextures?(0,mp.i)(p,this._caps.maxTextureSize):p,b=this.needPOTTextures?(0,mp.i)(b,this._caps.maxTextureSize):b),Q.width=p,Q.height=b,Q.isReady=!1,Q.generateMipMaps=M,Q.samplingMode=h,this.updateTextureSamplingMode(h,Q),this._internalTexturesCache.push(Q),Q},y.ThinEngine.prototype.updateDynamicTexture=function(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0,mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!p)return;const y=this._gl,P=y.TEXTURE_2D,w=this._bindTextureDirectly(P,p,!0,mp);this._unpackFlipY(void 0===M?p.invertY:M),h&&y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const t=this._getWebGLTextureType(p.type),z=this._getInternalFormat(Q||p.format),x=this._getRGBABufferInternalSizedFormat(p.type,z);y.texImage2D(P,0,x,z,t,b),p.generateMipMaps&&y.generateMipmap(P),w||this._bindTextureDirectly(P,null),h&&y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Q&&(p.format=Q),p._dynamicTextureSource=b,p._premulAlpha=h,p.invertY=M||!1,p.isReady=!0};class w extends Q.c{constructor(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],mp=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,P=arguments.length>6?arguments[6]:void 0;const w=!M||M._isScene;super(null,w?M:null===M||void 0===M?void 0:M.yM,w?!h:M,P,mp,void 0,void 0,void 0,void 0,y),this.name=p,this.wrapU=Q.c.CLAMP_ADDRESSMODE,this.wrapV=Q.c.CLAMP_ADDRESSMODE,this._generateMipMaps=h;const t=this._getEngine();if(!t)return;if(b.getContext)this._canvas=b,this._ownCanvas=!1,this._texture=t.createDynamicTexture(this._canvas.width,this._canvas.height,h,mp);else{this._canvas=t.createCanvas(1,1),this._ownCanvas=!0;const p=b;p.width||0===p.width?this._texture=t.createDynamicTexture(p.width,p.height,h,mp):this._texture=t.createDynamicTexture(b,b,h,mp)}const z=this.getSize();this._canvas.width!==z.width&&(this._canvas.width=z.width),this._canvas.height!==z.height&&(this._canvas.height=z.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(p){this._canvas.width=p.width,this._canvas.height=p.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(p.width,p.height,this._generateMipMaps,this.samplingMode)}scale(p){const b=this.getSize();b.width*=p,b.height*=p,this._recreate(b)}scaleTo(p,b){const M=this.getSize();M.width=p,M.height=b,this._recreate(M)}getContext(){return this._context}clear(p){const b=this.getSize();p&&(this._context.fillStyle=p),this._context.clearRect(0,0,b.width,b.height)}update(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===p||p,b,this._format||void 0,void 0,M)}drawText(p,b,M,h,Q,mp,y){let P=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const w=this.getSize();if(mp&&(this._context.fillStyle=mp,this._context.fillRect(0,0,w.width,w.height)),this._context.font=h,null===b||void 0===b){const M=this._context.measureText(p);b=(w.width-M.width)/2}if(null===M||void 0===M){const p=parseInt(h.replace(/\D/g,""));M=w.height/2+p/3.65}this._context.fillStyle=Q||"",this._context.fillText(p,b,M),P&&this.update(y)}dispose(){var p,b;(super.dispose(),this._ownCanvas)&&(null===(p=this._canvas)||void 0===p||null===(b=p.remove)||void 0===b||b.call(p));this._canvas=null,this._context=null}clone(){const p=this.upp();if(!p)return this;const b=this.getSize(),M=new w(this.name,b,p,this._generateMipMaps);return M.lb=this.lb,M.level=this.level,M.wrapU=this.wrapU,M.wrapV=this.wrapV,M}serialize(){const p=this.upp();p&&!p.isReady()&&h.d.Warn("The scene must be ready before serializing the dynamic texture");const b=super.serialize();return w._IsCanvasElement(this._canvas)&&(b.base64String=this._canvas.toDataURL()),b.invertY=this._invertY,b.samplingMode=this.samplingMode,b}static _IsCanvasElement(p){return void 0!==p.toDataURL}_rebuild(){this.update()}}},14181:(p,b,M)=>{"use strict";M.d(b,{c:()=>Q});var h=M(12753);class Q extends h.c{get depth(){return this._depth}constructor(p,b,M,Q,mp,y){let P=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],w=arguments.length>7&&void 0!==arguments[7]&&arguments[7],t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:h.c.TRILINEAR_SAMPLINGMODE,z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10?arguments[10]:void 0;super(null,y,!P,w),this.format=mp,this._texture=y.getEngine().createRawTexture2DArray(p,b,M,Q,mp,P,w,t,null,z,x),this._depth=Q,this.is2DArray=!0}update(p){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,p,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(p,b,M,h,mp){return new Q(p,b,M,h,5,mp,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14008:(p,b,M)=>{"use strict";M.d(b,{d:()=>P,f:()=>w,h:()=>mp,l:()=>y});var h=M(12789),Q=M(12777);function mp(p,b){return`{X: ${p.x.toFixed(b)} Y: ${p.y.toFixed(b)}}`}function y(p,b){return`{X: ${p._x.toFixed(b)} Y: ${p._y.toFixed(b)} Z: ${p._z.toFixed(b)}}`}function P(p,b){return 2*Math.acos((0,h.Clamp)(Q.Quaternion.Dot(p,b)))}function w(p,b){const M=new Q.Quaternion;return function(p,b,M){const mp=Q.QM.Cross(p,b),y=Math.acos((0,h.Clamp)(Q.QM.Dot(p,b),-1,1));Q.Quaternion.RotationAxisToRef(mp,y,M)}(p,b,M),M}},13837:(p,b,M)=>{"use strict";M.d(b,{c:()=>t});var h=M(12777),Q=M(12820),mp=M(13231),y=M(13219),P=M(12834);M(13841);function w(p){let b=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const M=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],mp=[];let w=[];const t=p.width||p.size||1,z=p.height||p.size||1,x=p.depth||p.size||1,S=p.wrap||!1;let X=void 0===p.topBaseAt?1:p.topBaseAt,c=void 0===p.bottomBaseAt?0:p.bottomBaseAt;X=(X+4)%4,c=(c+4)%4;let J=[2,0,3,1][X],g=[2,0,1,3][c],f=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(S){b=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],f=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let p=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],M=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const h=[17,18,19,16],Q=[22,23,20,21];for(;J>0;)p.unshift(p.pop()),h.unshift(h.pop()),J--;for(;g>0;)M.unshift(M.pop()),Q.unshift(Q.pop()),g--;p=p.flat(),M=M.flat(),f=f.concat(p).concat(M),b.push(h[0],h[2],h[3],h[0],h[1],h[2]),b.push(Q[0],Q[2],Q[3],Q[0],Q[1],Q[2])}const Y=[t/2,z/2,x/2];w=f.reduce(((p,b,M)=>p.concat(b*Y[M%3])),[]);const a=0===p.sideOrientation?0:p.sideOrientation||y.e.DEFAULTSIDE,o=p.faceUV||new Array(6),l=p.faceColors,L=[];for(let y=0;y<6;y++)void 0===o[y]&&(o[y]=new h.Vector4(0,0,1,1)),l&&void 0===l[y]&&(l[y]=new Q.Hb(1,1,1,1));for(let h=0;h<6;h++)if(mp.push(o[h].z,P.c?1-o[h].w:o[h].w),mp.push(o[h].x,P.c?1-o[h].w:o[h].w),mp.push(o[h].x,P.c?1-o[h].y:o[h].y),mp.push(o[h].z,P.c?1-o[h].y:o[h].y),l)for(let p=0;p<4;p++)L.push(l[h].r,l[h].g,l[h].b,l[h].a);y.e._ComputeSides(a,w,b,M,mp,p.frontUVs,p.backUVs);const u=new y.e;if(u.indices=b,u.dp=w,u.Ip=M,u.vp=mp,l){const p=a===y.e.DOUBLESIDE?L.concat(L):L;u.Gp=p}return u}function t(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new mp.e(p,M);b.sideOrientation=mp.e._GetDefaultSideOrientation(b.sideOrientation),h._originalBuilderSideOrientation=b.sideOrientation;return w(b).Up(h,b.updatable),h}y.e.CreateBox=w,mp.e.CreateBox=function(p,b){return t(p,{size:b,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13998:(p,b,M)=>{"use strict";M.d(b,{c:()=>P});var h=M(13231),Q=M(13219),mp=M(12834);function y(p){const b=[],M=[],h=[],y=[],P=p.radius||.5,w=p.tessellation||64,t=p.arc&&(p.arc<=0||p.arc>1)?1:p.arc||1,z=0===p.sideOrientation?0:p.sideOrientation||Q.e.DEFAULTSIDE;b.push(0,0,0),y.push(.5,.5);const x=2*Math.PI*t,S=1===t?x/w:x/(w-1);let X=0;for(let Q=0;Q<w;Q++){const p=Math.cos(X),M=Math.sin(X),h=(p+1)/2,Q=(1-M)/2;b.push(P*p,P*M,0),y.push(h,mp.c?1-Q:Q),X+=S}1===t&&(b.push(b[3],b[4],b[5]),y.push(y[2],mp.c?1-y[3]:y[3]));const c=b.length/3;for(let Q=1;Q<c-1;Q++)M.push(Q+1,0,Q);Q.e.ComputeNormals(b,M,h),Q.e._ComputeSides(z,b,M,h,y,p.frontUVs,p.backUVs);const J=new Q.e;return J.indices=M,J.dp=b,J.Ip=h,J.vp=y,J}function P(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new h.e(p,M);b.sideOrientation=h.e._GetDefaultSideOrientation(b.sideOrientation),Q._originalBuilderSideOrientation=b.sideOrientation;return y(b).Up(Q,b.updatable),Q}Q.e.CreateDisc=y,h.e.CreateDisc=function(p,b,M){return P(p,{radius:b,tessellation:M,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13841:(p,b,M)=>{"use strict";M.d(b,{f:()=>g,e:()=>Y,g:()=>f});var h=M(12777),Q=M(12820),mp=M(13231),y=M(13219),P=M(12847);mp.e._GroundMeshParser=(p,b)=>w.Parse(p,b);class w extends mp.e{constructor(p,b){super(p,b),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=p,this._subdivisionsY=p,this.subdivide(p);const M=this;M.createOrUpdateSubmeshesOctree&&M.createOrUpdateSubmeshesOctree(b)}getHeightAtCoordinates(p,b){const M=this.getWorldMatrix(),Q=h.TmpVectors.Matrix[5];M.invertToRef(Q);const mp=h.TmpVectors.QM[8];if(h.QM.TransformCoordinatesFromFloatsToRef(p,0,b,Q,mp),p=mp.x,b=mp.z,p<this._minX||p>=this._maxX||b<=this._minZ||b>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const y=this._getFacetAt(p,b),P=-(y.x*p+y.z*b+y.w)/y.y;return h.QM.TransformCoordinatesFromFloatsToRef(0,P,0,M,mp),mp.y}getNormalAtCoordinates(p,b){const M=new h.QM(0,1,0);return this.getNormalAtCoordinatesToRef(p,b,M),M}getNormalAtCoordinatesToRef(p,b,M){const Q=this.getWorldMatrix(),mp=h.TmpVectors.Matrix[5];Q.invertToRef(mp);const y=h.TmpVectors.QM[8];if(h.QM.TransformCoordinatesFromFloatsToRef(p,0,b,mp,y),p=y.x,b=y.z,p<this._minX||p>this._maxX||b<this._minZ||b>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const P=this._getFacetAt(p,b);return h.QM.TransformNormalFromFloatsToRef(P.x,P.y,P.z,Q,M),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(p,b){const M=Math.floor((p+this._maxX)*this._subdivisionsX/this._width),h=Math.floor(-(b+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),Q=this._heightQuads[h*this._subdivisionsX+M];let mp;return mp=b<Q.slope.x*p+Q.slope.y?Q.facet1:Q.facet2,mp}_initHeightQuads(){const p=this._subdivisionsX,b=this._subdivisionsY;this._heightQuads=[];for(let M=0;M<b;M++)for(let b=0;b<p;b++){const Q={slope:h.Vector2.Zero(),facet1:new h.Vector4(0,0,0,0),facet2:new h.Vector4(0,0,0,0)};this._heightQuads[M*p+b]=Q}return this}_computeHeightQuads(){const p=this.getVerticesData(P.f.PositionKind);if(!p)return this;const b=h.TmpVectors.QM[3],M=h.TmpVectors.QM[2],Q=h.TmpVectors.QM[1],mp=h.TmpVectors.QM[0],y=h.TmpVectors.QM[4],w=h.TmpVectors.QM[5],t=h.TmpVectors.QM[6],z=h.TmpVectors.QM[7],x=h.TmpVectors.QM[8];let S=0,X=0,c=0,J=0,g=0,f=0,Y=0;const a=this._subdivisionsX,o=this._subdivisionsY;for(let P=0;P<o;P++)for(let o=0;o<a;o++){S=3*o,X=P*(a+1)*3,c=(P+1)*(a+1)*3,b.x=p[X+S],b.y=p[X+S+1],b.z=p[X+S+2],M.x=p[X+S+3],M.y=p[X+S+4],M.z=p[X+S+5],Q.x=p[c+S],Q.y=p[c+S+1],Q.z=p[c+S+2],mp.x=p[c+S+3],mp.y=p[c+S+4],mp.z=p[c+S+5],J=(mp.z-b.z)/(mp.x-b.x),g=b.z-J*b.x,M.subtractToRef(b,y),Q.subtractToRef(b,w),mp.subtractToRef(b,t),h.QM.CrossToRef(t,w,z),h.QM.CrossToRef(y,t,x),z.normalize(),x.normalize(),f=-(z.x*b.x+z.y*b.y+z.z*b.z),Y=-(x.x*M.x+x.y*M.y+x.z*M.z);const l=this._heightQuads[P*a+o];l.slope.sb(J,g),l.facet1.sb(z.x,z.y,z.z,f),l.facet2.sb(x.x,x.y,x.z,Y)}return this}serialize(p){super.serialize(p),p.subdivisionsX=this._subdivisionsX,p.subdivisionsY=this._subdivisionsY,p.minX=this._minX,p.maxX=this._maxX,p.Ib=this._minZ,p.maxZ=this._maxZ,p.width=this._width,p.height=this._height}static Parse(p,b){const M=new w(p.name,b);return M._subdivisionsX=p.subdivisionsX||1,M._subdivisionsY=p.subdivisionsY||1,M._minX=p.minX,M._maxX=p.maxX,M._minZ=p.Ib,M._maxZ=p.maxZ,M._width=p.width,M._height=p.height,M}}var t=M(12608),z=M(12652),x=M(12779),S=M(12834);function X(p){const b=[],M=[],Q=[],mp=[];let P,w;const t=p.width||p.size||1,z=p.height||p.size||1,x=0|(p.subdivisionsX||p.subdivisions||1),X=0|(p.subdivisionsY||p.subdivisions||1);for(P=0;P<=X;P++)for(w=0;w<=x;w++){const p=new h.QM(w*t/x-t/2,0,(X-P)*z/X-z/2),b=new h.QM(0,1,0);M.push(p.x,p.y,p.z),Q.push(b.x,b.y,b.z),mp.push(w/x,S.c?P/X:1-P/X)}for(P=0;P<X;P++)for(w=0;w<x;w++)b.push(w+1+(P+1)*(x+1)),b.push(w+1+P*(x+1)),b.push(w+P*(x+1)),b.push(w+(P+1)*(x+1)),b.push(w+1+(P+1)*(x+1)),b.push(w+P*(x+1));const c=new y.e;return c.indices=b,c.dp=M,c.Ip=Q,c.vp=mp,c}function c(p){const b=void 0!==p.xmin&&null!==p.xmin?p.xmin:-1,M=void 0!==p.zmin&&null!==p.zmin?p.zmin:-1,Q=void 0!==p.xmax&&null!==p.xmax?p.xmax:1,mp=void 0!==p.zmax&&null!==p.zmax?p.zmax:1,P=p.subdivisions||{w:1,h:1},w=p.precision||{w:1,h:1},t=[],z=[],x=[],S=[];let X,c,J,g;P.h=P.h<1?1:P.h,P.w=P.w<1?1:P.w,w.w=w.w<1?1:w.w,w.h=w.h<1?1:w.h;const f=(Q-b)/P.w,Y=(mp-M)/P.h;function a(p,b,M,Q){const mp=z.length/3,y=w.w+1;for(X=0;X<w.h;X++)for(c=0;c<w.w;c++){const p=[mp+c+X*y,mp+(c+1)+X*y,mp+(c+1)+(X+1)*y,mp+c+(X+1)*y];t.push(p[1]),t.push(p[2]),t.push(p[3]),t.push(p[0]),t.push(p[1]),t.push(p[3])}const P=h.QM.Zero(),J=new h.QM(0,1,0);for(X=0;X<=w.h;X++)for(P.z=X*(Q-b)/w.h+b,c=0;c<=w.w;c++)P.x=c*(M-p)/w.w+p,P.y=0,z.push(P.x,P.y,P.z),x.push(J.x,J.y,J.z),S.push(c/w.w,X/w.h)}for(J=0;J<P.h;J++)for(g=0;g<P.w;g++)a(b+g*f,M+J*Y,b+(g+1)*f,M+(J+1)*Y);const o=new y.e;return o.indices=t,o.dp=z,o.Ip=x,o.vp=S,o}function J(p){const b=[],M=[],mp=[],P=[];let w,t;const z=p.colorFilter||new Q.wM(.3,.59,.11),S=p.alphaFilter||0;let X=!1;if(p.minHeight>p.maxHeight){X=!0;const b=p.maxHeight;p.maxHeight=p.minHeight,p.minHeight=b}for(w=0;w<=p.subdivisions;w++)for(t=0;t<=p.subdivisions;t++){const b=new h.QM(t*p.width/p.subdivisions-p.width/2,0,(p.subdivisions-w)*p.height/p.subdivisions-p.height/2),Q=4*(((b.x+p.width/2)/p.width*(p.bufferWidth-1)|0)+((1-(b.z+p.height/2)/p.height)*(p.bufferHeight-1)|0)*p.bufferWidth);let y=p.buffer[Q]/255,c=p.buffer[Q+1]/255,J=p.buffer[Q+2]/255;const g=p.buffer[Q+3]/255;X&&(y=1-y,c=1-c,J=1-J);const f=y*z.r+c*z.g+J*z.b;b.y=g>=S?p.minHeight+(p.maxHeight-p.minHeight)*f:p.minHeight-x.d,p.heightBuffer&&(p.heightBuffer[w*(p.subdivisions+1)+t]=b.y),M.push(b.x,b.y,b.z),mp.push(0,0,0),P.push(t/p.subdivisions,1-w/p.subdivisions)}for(w=0;w<p.subdivisions;w++)for(t=0;t<p.subdivisions;t++){const h=t+1+(w+1)*(p.subdivisions+1),Q=t+1+w*(p.subdivisions+1),mp=t+w*(p.subdivisions+1),y=t+(w+1)*(p.subdivisions+1),P=M[3*h+1]>=p.minHeight,z=M[3*Q+1]>=p.minHeight,x=M[3*mp+1]>=p.minHeight;P&&z&&x&&(b.push(h),b.push(Q),b.push(mp));M[3*y+1]>=p.minHeight&&P&&x&&(b.push(y),b.push(h),b.push(mp))}y.e.ComputeNormals(M,b,mp);const c=new y.e;return c.indices=b,c.dp=M,c.Ip=mp,c.vp=P,c}function g(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const M=new w(p,arguments.length>2?arguments[2]:void 0);M._setReady(!1),M._subdivisionsX=b.subdivisionsX||b.subdivisions||1,M._subdivisionsY=b.subdivisionsY||b.subdivisions||1,M._width=b.width||1,M._height=b.height||1,M._maxX=M._width/2,M._maxZ=M._height/2,M._minX=-M._maxX,M._minZ=-M._maxZ;return X(b).Up(M,b.updatable),M._setReady(!0),M}function f(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new mp.e(p,M);return c(b).Up(h,b.updatable),h}function Y(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const mp=M.width||10,y=M.height||10,P=M.subdivisions||1,x=M.minHeight||0,S=M.maxHeight||1,X=M.colorFilter||new Q.wM(.3,.59,.11),c=M.alphaFilter||0,g=M.updatable,f=M.onReady;h=h||z.c.LastCreatedScene;const Y=new w(p,h);let a;Y._subdivisionsX=P,Y._subdivisionsY=P,Y._width=mp,Y._height=y,Y._maxX=Y._width/2,Y._maxZ=Y._height/2,Y._minX=-Y._maxX,Y._minZ=-Y._maxZ,Y._setReady(!1),M.passHeightBufferInCallback&&(a=new Float32Array((P+1)*(P+1)));const o=(p,b,M)=>{J({width:mp,height:y,subdivisions:P,minHeight:x,maxHeight:S,colorFilter:X,buffer:p,bufferWidth:b,bufferHeight:M,alphaFilter:c,heightBuffer:a}).Up(Y,g),f&&f(Y,a),Y._setReady(!0)};if("string"===typeof b){const p=p=>{var b;const M=p.width,Q=p.height;if(h.S)return;const mp=null===(b=h)||void 0===b?void 0:b.getEngine().resizeImageBitmap(p,M,Q);o(mp,M,Q)};t.Tools.LoadImage(b,p,M.onError?M.onError:()=>{},h.offlineProvider)}else o(b.data,b.width,b.height);return Y}y.e.CreateGround=X,y.e.CreateTiledGround=c,y.e.CreateGroundFromHeightMap=J,mp.e.CreateGround=(p,b,M,h,Q,mp)=>g(p,{width:b,height:M,subdivisions:h,updatable:mp},Q),mp.e.CreateTiledGround=(p,b,M,h,Q,mp,y,P,w)=>f(p,{xmin:b,zmin:M,xmax:h,zmax:Q,subdivisions:mp,precision:y,updatable:w},P),mp.e.CreateGroundFromHeightMap=(p,b,M,h,Q,mp,y,P,w,t,z)=>Y(p,b,{width:M,height:h,subdivisions:Q,minHeight:mp,maxHeight:y,updatable:w,onReady:t,alphaFilter:z},P)},14506:(p,b,M)=>{"use strict";M.d(b,{c:()=>X,e:()=>x,i:()=>S});var h=M(12777),Q=M(13231),mp=M(13219),y=M(13330),P=M(12847),w=M(12622);function t(p){const b=[],M=[],h=p.lines,Q=p.Gp,y=[];let P=0;for(let mp=0;mp<h.length;mp++){const p=h[mp];for(let h=0;h<p.length;h++){const{x:w,y:t,z:z}=p[h];if(M.push(w,t,z),Q){const p=Q[mp],{r:b,g:M,b:P,a:w}=p[h];y.push(b,M,P,w)}h>0&&(b.push(P-1),b.push(P)),P++}}const w=new mp.e;return w.indices=b,w.dp=M,Q&&(w.Gp=y),w}function z(p){const b=p.dashSize||3,M=p.gapSize||1,Q=p.dashNb||200,y=p.points,P=[],w=[],t=h.QM.Zero();let z=0,x=0,S=0,X=0,c=0,J=0,g=0;for(g=0;g<y.length-1;g++)y[g+1].subtractToRef(y[g],t),z+=t.length();for(S=z/Q,X=b*S/(b+M),g=0;g<y.length-1;g++){y[g+1].subtractToRef(y[g],t),x=Math.floor(t.length()/S),t.normalize();for(let p=0;p<x;p++)c=S*p,P.push(y[g].x+c*t.x,y[g].y+c*t.y,y[g].z+c*t.z),P.push(y[g].x+(c+X)*t.x,y[g].y+(c+X)*t.y,y[g].z+(c+X)*t.z),w.push(J,J+1),J+=2}const f=new mp.e;return f.dp=P,f.indices=w,f}function x(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=b.instance,Q=b.lines,mp=b.Gp;if(h){const p=h.getVerticesData(P.f.PositionKind);let b,M;mp&&(b=h.getVerticesData(P.f.ColorKind));let y=0,w=0;for(let h=0;h<Q.length;h++){const P=Q[h];for(let Q=0;Q<P.length;Q++)p[y]=P[Q].x,p[y+1]=P[Q].y,p[y+2]=P[Q].z,mp&&b&&(M=mp[h],b[w]=M[Q].r,b[w+1]=M[Q].g,b[w+2]=M[Q].b,b[w+3]=M[Q].a,w+=4),y+=3}return h.updateVerticesData(P.f.PositionKind,p,!1,!1),mp&&b&&h.updateVerticesData(P.f.ColorKind,b,!1,!1),h.refreshBoundingInfo(),h}const w=!!mp,z=new y.e(p,M,null,void 0,void 0,w,b.useVertexAlpha,b.material);return t(b).Up(z,b.updatable),z}function S(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=b.Gp?[b.Gp]:null;return x(p,{lines:[b.points],updatable:b.updatable,instance:b.instance,Gp:h,useVertexAlpha:b.useVertexAlpha,material:b.material},M)}function X(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mp=b.points,P=b.instance,t=b.gapSize||1,x=b.dashSize||3;if(P){const p=p=>{const b=h.QM.Zero(),M=p.length/6;let Q=0,y=0,w=0,t=0,z=0,x=0,S=0,X=0;for(S=0;S<mp.length-1;S++)mp[S+1].subtractToRef(mp[S],b),Q+=b.length();w=Q/M;const c=P._creationDataStorage.dashSize;for(t=c*w/(c+P._creationDataStorage.gapSize),S=0;S<mp.length-1;S++)for(mp[S+1].subtractToRef(mp[S],b),y=Math.floor(b.length()/w),b.normalize(),X=0;X<y&&x<p.length;)z=w*X,p[x]=mp[S].x+z*b.x,p[x+1]=mp[S].y+z*b.y,p[x+2]=mp[S].z+z*b.z,p[x+3]=mp[S].x+(z+t)*b.x,p[x+4]=mp[S].y+(z+t)*b.y,p[x+5]=mp[S].z+(z+t)*b.z,x+=6,X++;for(;x<p.length;)p[x]=mp[S].x,p[x+1]=mp[S].y,p[x+2]=mp[S].z,x+=3};return(b.dashNb||b.dashSize||b.gapSize||b.useVertexAlpha||b.material)&&w.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),P.updateMeshPositions(p,!1),P}const S=new y.e(p,M,null,void 0,void 0,void 0,b.useVertexAlpha,b.material);return z(b).Up(S,b.updatable),S._creationDataStorage=new Q.g,S._creationDataStorage.dashSize=x,S._creationDataStorage.gapSize=t,S}mp.e.CreateLineSystem=t,mp.e.CreateDashedLines=z,Q.e.Bz=function(p,b){return S(p,{points:b,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},Q.e.CreateDashedLines=function(p,b,M,h,Q){return X(p,{points:b,dashSize:M,gapSize:h,dashNb:Q,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13896:(p,b,M)=>{"use strict";M.d(b,{d:()=>P,e:()=>w});var h=M(13231),Q=M(13219),mp=M(12834);function y(p){const b=[],M=[],h=[],y=[],P=void 0!==p.width?p.width:void 0!==p.size?p.size:1,w=void 0!==p.height?p.height:void 0!==p.size?p.size:1,t=0===p.sideOrientation?0:p.sideOrientation||Q.e.DEFAULTSIDE,z=P/2,x=w/2;M.push(-z,-x,0),h.push(0,0,-1),y.push(0,mp.c?1:0),M.push(z,-x,0),h.push(0,0,-1),y.push(1,mp.c?1:0),M.push(z,x,0),h.push(0,0,-1),y.push(1,mp.c?0:1),M.push(-z,x,0),h.push(0,0,-1),y.push(0,mp.c?0:1),b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),Q.e._ComputeSides(t,M,b,h,y,p.frontUVs,p.backUVs);const S=new Q.e;return S.indices=b,S.dp=M,S.Ip=h,S.vp=y,S}function P(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new h.e(p,M);b.sideOrientation=h.e._GetDefaultSideOrientation(b.sideOrientation),Q._originalBuilderSideOrientation=b.sideOrientation;return y(b).Up(Q,b.updatable),b.sourcePlane&&(Q.translate(b.sourcePlane.normal,-b.sourcePlane.d),Q.setDirection(b.sourcePlane.normal.scale(-1))),Q}const w={Tz:P};Q.e.Tz=y,h.e.Tz=(p,b,M,h,Q)=>P(p,{size:b,width:b,height:b,sideOrientation:Q,updatable:h},M)},13988:(p,b,M)=>{"use strict";M.d(b,{d:()=>w});var h=M(12777),Q=M(13231),mp=M(13219),y=M(12834);function P(p){const b=0|(p.segments||32),M=p.diameterX||p.diameter||1,Q=p.diameterY||p.diameter||1,P=p.diameterZ||p.diameter||1,w=p.arc&&(p.arc<=0||p.arc>1)?1:p.arc||1,t=p.slice&&p.slice<=0?1:p.slice||1,z=0===p.sideOrientation?0:p.sideOrientation||mp.e.DEFAULTSIDE,x=!!p.dedupTopBottomIndices,S=new h.QM(M/2,Q/2,P/2),X=2+b,c=2*X,J=[],g=[],f=[],Y=[];for(let mp=0;mp<=X;mp++){const p=mp/X,b=p*Math.PI*t;for(let M=0;M<=c;M++){const Q=M/c,mp=Q*Math.PI*2*w,P=h.Matrix.RotationZ(-b),t=h.Matrix.RotationY(mp),z=h.QM.TransformCoordinates(h.QM.Up(),P),x=h.QM.TransformCoordinates(z,t),X=x.multiply(S),J=x.divide(S).normalize();g.push(X.x,X.y,X.z),f.push(J.x,J.y,J.z),Y.push(Q,y.c?1-p:p)}if(mp>0){const p=g.length/3;for(let b=p-2*(c+1);b+c+2<p;b++)x?(mp>1&&(J.push(b),J.push(b+1),J.push(b+c+1)),(mp<X||t<1)&&(J.push(b+c+1),J.push(b+1),J.push(b+c+2))):(J.push(b),J.push(b+1),J.push(b+c+1),J.push(b+c+1),J.push(b+1),J.push(b+c+2))}}mp.e._ComputeSides(z,g,J,f,Y,p.frontUVs,p.backUVs);const a=new mp.e;return a.indices=J,a.dp=g,a.Ip=f,a.vp=Y,a}function w(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new Q.e(p,M);b.sideOrientation=Q.e._GetDefaultSideOrientation(b.sideOrientation),h._originalBuilderSideOrientation=b.sideOrientation;return P(b).Up(h,b.updatable),h}mp.e.CreateSphere=P,Q.e.CreateSphere=(p,b,M,h,Q,mp)=>w(p,{segments:b,diameterX:M,diameterY:M,diameterZ:M,sideOrientation:mp,updatable:Q},h)},14964:(p,b,M)=>{"use strict";M.d(b,{c:()=>P});var h=M(13344),Q=M(14286),mp=M(13363),y=M(13219);class P{static get Configuration(){return{get decoder(){return Q.e.DefaultConfiguration},set decoder(p){Q.e.DefaultConfiguration=p}}}static set Configuration(p){Q.e.DefaultConfiguration=p.decoder}static get DecoderAvailable(){return(0,h.j)(Q.e.DefaultConfiguration)}static get Default(){return P._Default??(P._Default=new P),P._Default}static ResetDefault(p){P._Default&&(p||P._Default.dispose(),P._Default=null)}constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.DefaultNumWorkers;const b="number"===typeof p?{...Q.e.DefaultConfiguration,numWorkers:p}:{...Q.e.DefaultConfiguration,...p};this._decoder=new Q.e(b)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(p,b,M){return this._decoder.decodeMeshToMeshDataAsync(p,b,M)}async decodeMeshToGeometryAsync(p,b,M,h){return await this._decoder.decodeMeshToGeometryAsync(p,b,M,h)}async _decodeMeshToGeometryForGltfAsync(p,b,M,h,Q,mp){return await this._decoder._decodeMeshToGeometryForGltfAsync(p,b,M,h,Q,mp)}async decodeMeshAsync(p,b){const M=await this._decoder.decodeMeshToMeshDataAsync(p,b),h=new y.e;M.indices&&(h.indices=M.indices);for(const Q of M.attributes){const p=mp.e.GetFloatData(Q.data,Q.size,mp.e.GetDataType(Q.data),Q.byteOffset,Q.byteStride,Q.normalized,M.totalVertices);h.set(p,Q.kind)}return h}}P.DefaultNumWorkers=(0,h.h)(),P._Default=null},14286:(p,b,M)=>{"use strict";M.d(b,{e:()=>t});var h=M(13344),Q=M(12608),mp=M(13238),y=M(13363),P=M(12622),w=M(13360);class t extends h.e{static get DefaultAvailable(){return(0,h.j)(t.DefaultConfiguration)}static get Default(){return t._Default??(t._Default=new t),t._Default}static ResetDefault(p){t._Default&&(p||t._Default.dispose(),t._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(p,b){return{module:await(b||DracoDecoderModule)({wasmBinary:p})}}_getWorkerContent(){return`${w.c}(${w.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DefaultConfiguration)}decodeMeshToMeshDataAsync(p,b,M){const h=p instanceof ArrayBuffer?new Int8Array(p):new Int8Array(p.buffer,p.byteOffset,p.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async p=>await new Promise(((Q,mp)=>{p.push(((p,y)=>{let w=null;const t=[],z=b=>{p.removeEventListener("error",z),p.removeEventListener("message",x),mp(b),y()},x=b=>{const h=b.data;switch(h.id){case"indices":w=h.data;break;case"attribute":t.push({kind:h.kind,data:h.data,size:h.size,byteOffset:h.byteOffset,byteStride:h.byteStride,normalized:(mp=h.kind,S=h.normalized,M&&void 0!==M[mp]?(S!==M[mp]&&P.d.Warn(`Normalized flag from Draco data (${S}) does not match normalized flag from glTF accessor (${M[mp]}). Using flag from glTF accessor.`),M[mp]):S)});break;case"decodeMeshDone":p.removeEventListener("error",z),p.removeEventListener("message",x),Q({indices:w,attributes:t,totalVertices:h.totalVertices}),y()}var mp,S};p.addEventListener("error",z),p.addEventListener("message",x);const S=h.slice();p.postMessage({id:"decodeMesh",dataView:S,attributes:b},[S.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((p=>{let M=null;const Q=[],mp=(0,w.c)(p.module,h,b,(p=>{M=p}),((p,b,M,h,mp,y)=>{Q.push({kind:p,data:b,size:M,byteOffset:h,byteStride:mp,normalized:y})}));return{indices:M,attributes:Q,totalVertices:mp}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(p,b,M,h){const Q=await this.decodeMeshToMeshDataAsync(M,h),P=new mp.b(p,b);Q.indices&&P.setIndices(Q.indices);for(const mp of Q.attributes)P.setVerticesBuffer(new y.e(b.getEngine(),mp.data,mp.kind,!1,void 0,mp.byteStride,void 0,mp.byteOffset,mp.size,void 0,mp.normalized,!0),Q.totalVertices);return P}async _decodeMeshToGeometryForGltfAsync(p,b,M,h,Q,P){const w=await this.decodeMeshToMeshDataAsync(M,h,Q),t=new mp.b(p,b);P&&(t._boundingInfo=P,t.useBoundingInfoFromGeometry=!0),w.indices&&t.setIndices(w.indices);for(const mp of w.attributes)t.setVerticesBuffer(new y.e(b.getEngine(),mp.data,mp.kind,!1,void 0,mp.byteStride,void 0,mp.byteOffset,mp.size,void 0,mp.normalized,!0),w.totalVertices);return t}}t.DefaultConfiguration={wasmUrl:`${Q.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${Q.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${Q.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},t._Default=null},14500:(p,b,M)=>{"use strict";M.d(b,{c:()=>Pp});var h=M(12777),Q=M(13231),mp=M(12847),y=M(13219),P=M(12834);function w(p){let b=p.pathArray;const M=p.closeArray||!1,h=p.closePath||!1,Q=p.invertUV||!1,w=Math.floor(b[0].length/2);let t=p.offset||w;t=t>w?w:Math.floor(t);const z=0===p.sideOrientation?0:p.sideOrientation||y.e.DEFAULTSIDE,x=p.vp,S=p.Gp,X=[],c=[],J=[],g=[],f=[],Y=[],a=[],o=[];let l;const L=[],u=[];let e,d,I;if(b.length<2){const p=[],M=[];for(d=0;d<b[0].length-t;d++)p.push(b[0][d]),M.push(b[0][d+t]);b=[p,M]}let G=0;const v=h?1:0,Z=M?1:0;let U,q,B,s,i,T;for(l=b[0].length,e=0;e<b.length+Z;e++){for(a[e]=0,f[e]=[0],U=e===b.length?b[0]:b[e],q=U.length,l=l<q?l:q,I=0;I<q;)X.push(U[I].x,U[I].y,U[I].z),I>0&&(B=U[I].mh(U[I-1]).length(),s=B+a[e],f[e].push(s),a[e]=s),I++;h&&(I--,X.push(U[0].x,U[0].y,U[0].z),B=U[I].mh(U[0]).length(),s=B+a[e],f[e].push(s),a[e]=s),L[e]=q+v,u[e]=G,G+=q+v}let W,H,E=null,j=null;for(d=0;d<l+v;d++)for(o[d]=0,Y[d]=[0],e=0;e<b.length-1+Z;e++)i=b[e],T=e===b.length-1?b[0]:b[e+1],d===l?(E=i[0],j=T[0]):(E=i[d],j=T[d]),B=j.mh(E).length(),s=B+o[d],Y[d].push(s),o[d]=s;if(x)for(e=0;e<x.length;e++)g.push(x[e].x,P.c?1-x[e].y:x[e].y);else for(e=0;e<b.length+Z;e++)for(d=0;d<l+v;d++)W=0!=a[e]?f[e][d]/a[e]:0,H=0!=o[d]?Y[d][e]/o[d]:0,Q?g.push(H,W):g.push(W,P.c?1-H:H);e=0;let V=0,D=L[e]-1,N=L[e+1]-1,O=D<N?D:N,R=u[1]-u[0];const K=L.length-1;for(;V<=O&&e<K;)c.push(V,V+R,V+1),c.push(V+R+1,V+1,V+R),V+=1,V===O&&(e++,R=u[e+1]-u[e],D=L[e]-1,N=L[e+1]-1,V=u[e],O=D<N?D+V:N+V);if(y.e.ComputeNormals(X,c,J),h){let p=0,M=0;for(e=0;e<b.length;e++){p=3*u[e],M=e+1<b.length?3*(u[e+1]-1):J.length-3,J[p]=.5*(J[p]+J[M]),J[p+1]=.5*(J[p+1]+J[M+1]),J[p+2]=.5*(J[p+2]+J[M+2]);const h=Math.sqrt(J[p]*J[p]+J[p+1]*J[p+1]+J[p+2]*J[p+2]);J[p]/=h,J[p+1]/=h,J[p+2]/=h,J[M]=J[p],J[M+1]=J[p+1],J[M+2]=J[p+2]}}if(M){let p=3*u[0],M=3*u[b.length];for(d=0;d<l+v;d++){J[p]=.5*(J[p]+J[M]),J[p+1]=.5*(J[p+1]+J[M+1]),J[p+2]=.5*(J[p+2]+J[M+2]);const b=Math.sqrt(J[p]*J[p]+J[p+1]*J[p+1]+J[p+2]*J[p+2]);J[p]/=b,J[p+1]/=b,J[p+2]/=b,J[M]=J[p],J[M+1]=J[p+1],J[M+2]=J[p+2],p+=3,M+=3}}y.e._ComputeSides(z,X,c,J,g,p.frontUVs,p.backUVs);let r=null;if(S){r=new Float32Array(4*S.length);for(let p=0;p<S.length;p++)r[4*p]=S[p].r,r[4*p+1]=S[p].g,r[4*p+2]=S[p].b,r[4*p+3]=S[p].a}const k=new y.e,A=new Float32Array(X),n=new Float32Array(J),C=new Float32Array(g);return k.indices=c,k.dp=A,k.Ip=n,k.vp=C,r&&k.set(r,mp.f.ColorKind),h&&(k._idx=u),k}function t(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=b.pathArray,z=b.closeArray,x=b.closePath,S=Q.e._GetDefaultSideOrientation(b.sideOrientation),X=b.instance,c=b.updatable;if(X){const p=h.TmpVectors.QM[0].Tb(Number.MAX_VALUE),M=h.TmpVectors.QM[1].Tb(-Number.MAX_VALUE),w=b=>{let h=t[0].length;const mp=X;let y=0;const P=mp._originalBuilderSideOrientation===Q.e.DOUBLESIDE?2:1;for(let Q=1;Q<=P;++Q)for(let P=0;P<t.length;++P){const Q=t[P],w=Q.length;h=h<w?h:w;for(let mp=0;mp<h;++mp){const h=Q[mp];b[y]=h.x,b[y+1]=h.y,b[y+2]=h.z,p.minimizeInPlaceFromFloats(h.x,h.y,h.z),M.maximizeInPlaceFromFloats(h.x,h.y,h.z),y+=3}if(mp._creationDataStorage&&mp._creationDataStorage.closePath){const p=Q[0];b[y]=p.x,b[y+1]=p.y,b[y+2]=p.z,y+=3}}},z=X.getVerticesData(mp.f.PositionKind);if(w(z),X.hasBoundingInfo?X.getBoundingInfo().reConstruct(p,M,X._worldMatrix):X.buildBoundingInfo(p,M,X._worldMatrix),X.updateVerticesData(mp.f.PositionKind,z,!1,!1),b.Gp){const p=X.getVerticesData(mp.f.ColorKind);for(let M=0,h=0;M<b.Gp.length;M++,h+=4){const Q=b.Gp[M];p[h]=Q.r,p[h+1]=Q.g,p[h+2]=Q.b,p[h+3]=Q.a}X.updateVerticesData(mp.f.ColorKind,p,!1,!1)}if(b.vp){const p=X.getVerticesData(mp.f.UVKind);for(let M=0;M<b.vp.length;M++)p[2*M]=b.vp[M].x,p[2*M+1]=P.c?1-b.vp[M].y:b.vp[M].y;X.updateVerticesData(mp.f.UVKind,p,!1,!1)}if(!X.areNormalsFrozen||X.isFacetDataEnabled){const p=X.qb(),b=X.getVerticesData(mp.f.NormalKind),M=X.isFacetDataEnabled?X.getFacetDataParameters():null;if(y.e.ComputeNormals(z,p,b,M),X._creationDataStorage&&X._creationDataStorage.closePath){let p=0,M=0;for(let h=0;h<t.length;h++)p=3*X._creationDataStorage.idx[h],M=h+1<t.length?3*(X._creationDataStorage.idx[h+1]-1):b.length-3,b[p]=.5*(b[p]+b[M]),b[p+1]=.5*(b[p+1]+b[M+1]),b[p+2]=.5*(b[p+2]+b[M+2]),b[M]=b[p],b[M+1]=b[p+1],b[M+2]=b[p+2]}X.areNormalsFrozen||X.updateVerticesData(mp.f.NormalKind,b,!1,!1)}return X}{const h=new Q.e(p,M);h._originalBuilderSideOrientation=S,h._creationDataStorage=new Q.g;const mp=w(b);return x&&(h._creationDataStorage.idx=mp._idx),h._creationDataStorage.closePath=x,h._creationDataStorage.closeArray=z,mp.Up(h,c),h}}y.e.CreateRibbon=w,Q.e.CreateRibbon=function(p,b){return t(p,{pathArray:b,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var z=M(13998),x=M(13837),S=M(12820);function X(p){const b=p.pattern||Q.e.NO_FLIP,M=p.tileWidth||p.tileSize||1,h=p.tileHeight||p.tileSize||1,mp=p.alignHorizontal||0,P=p.alignVertical||0,w=p.width||p.size||1,t=Math.floor(w/M);let z=w-t*M;const x=p.height||p.size||1,S=Math.floor(x/h);let X=x-S*h;const c=M*t/2,J=h*S/2;let g=0,f=0,Y=0,a=0,o=0,l=0;if(z>0||X>0){switch(Y=-c,a=-J,o=c,l=J,mp){case Q.e.CENTER:z/=2,Y-=z,o+=z;break;case Q.e.LEFT:o+=z,g=-z/2;break;case Q.e.RIGHT:Y-=z,g=z/2}switch(P){case Q.e.CENTER:X/=2,a-=X,l+=X;break;case Q.e.BOTTOM:l+=X,f=-X/2;break;case Q.e.TOP:a-=X,f=X/2}}const L=[],u=[],e=[];e[0]=[0,0,1,0,1,1,0,1],e[1]=[0,0,1,0,1,1,0,1],b!==Q.e.ROTATE_TILE&&b!==Q.e.ROTATE_ROW||(e[1]=[1,1,0,1,0,0,1,0]),b!==Q.e.FLIP_TILE&&b!==Q.e.FLIP_ROW||(e[1]=[1,0,0,0,0,1,1,1]),b!==Q.e.FLIP_N_ROTATE_TILE&&b!==Q.e.FLIP_N_ROTATE_ROW||(e[1]=[0,1,1,1,1,0,0,0]);let d=[];const I=[],G=[];let v=0;for(let y=0;y<S;y++)for(let p=0;p<t;p++)L.push(p*M-c+g,y*h-J+f,0),L.push((p+1)*M-c+g,y*h-J+f,0),L.push((p+1)*M-c+g,(y+1)*h-J+f,0),L.push(p*M-c+g,(y+1)*h-J+f,0),G.push(v,v+1,v+3,v+1,v+2,v+3),d=b===Q.e.FLIP_TILE||b===Q.e.ROTATE_TILE||b===Q.e.FLIP_N_ROTATE_TILE?d.concat(e[(p%2+y%2)%2]):b===Q.e.FLIP_ROW||b===Q.e.ROTATE_ROW||b===Q.e.FLIP_N_ROTATE_ROW?d.concat(e[y%2]):d.concat(e[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),v+=4;if(z>0||X>0){const p=X>0&&(P===Q.e.CENTER||P===Q.e.TOP),y=X>0&&(P===Q.e.CENTER||P===Q.e.BOTTOM),w=z>0&&(mp===Q.e.CENTER||mp===Q.e.RIGHT),x=z>0&&(mp===Q.e.CENTER||mp===Q.e.LEFT);let e,Z,U,q,B=[];if(p&&w&&(L.push(Y+g,a+f,0),L.push(-c+g,a+f,0),L.push(-c+g,a+X+f,0),L.push(Y+g,a+X+f,0),G.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,e=1-z/M,Z=1-X/h,U=1,q=1,B=[e,Z,U,Z,U,q,e,q],b===Q.e.ROTATE_ROW&&(B=[1-e,1-Z,1-U,1-Z,1-U,1-q,1-e,1-q]),b===Q.e.FLIP_ROW&&(B=[1-e,Z,1-U,Z,1-U,q,1-e,q]),b===Q.e.FLIP_N_ROTATE_ROW&&(B=[e,1-Z,U,1-Z,U,1-q,e,1-q]),d=d.concat(B),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),p&&x&&(L.push(c+g,a+f,0),L.push(o+g,a+f,0),L.push(o+g,a+X+f,0),L.push(c+g,a+X+f,0),G.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,e=0,Z=1-X/h,U=z/M,q=1,B=[e,Z,U,Z,U,q,e,q],(b===Q.e.ROTATE_ROW||b===Q.e.ROTATE_TILE&&t%2===0)&&(B=[1-e,1-Z,1-U,1-Z,1-U,1-q,1-e,1-q]),(b===Q.e.FLIP_ROW||b===Q.e.FLIP_TILE&&t%2===0)&&(B=[1-e,Z,1-U,Z,1-U,q,1-e,q]),(b===Q.e.FLIP_N_ROTATE_ROW||b===Q.e.FLIP_N_ROTATE_TILE&&t%2===0)&&(B=[e,1-Z,U,1-Z,U,1-q,e,1-q]),d=d.concat(B),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&w&&(L.push(Y+g,J+f,0),L.push(-c+g,J+f,0),L.push(-c+g,l+f,0),L.push(Y+g,l+f,0),G.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,e=1-z/M,Z=0,U=1,q=X/h,B=[e,Z,U,Z,U,q,e,q],(b===Q.e.ROTATE_ROW&&S%2===1||b===Q.e.ROTATE_TILE&&S%1===0)&&(B=[1-e,1-Z,1-U,1-Z,1-U,1-q,1-e,1-q]),(b===Q.e.FLIP_ROW&&S%2===1||b===Q.e.FLIP_TILE&&S%2===0)&&(B=[1-e,Z,1-U,Z,1-U,q,1-e,q]),(b===Q.e.FLIP_N_ROTATE_ROW&&S%2===1||b===Q.e.FLIP_N_ROTATE_TILE&&S%2===0)&&(B=[e,1-Z,U,1-Z,U,1-q,e,1-q]),d=d.concat(B),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&x&&(L.push(c+g,J+f,0),L.push(o+g,J+f,0),L.push(o+g,l+f,0),L.push(c+g,l+f,0),G.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,e=0,Z=0,U=z/M,q=X/h,B=[e,Z,U,Z,U,q,e,q],(b===Q.e.ROTATE_ROW&&S%2===1||b===Q.e.ROTATE_TILE&&(S+t)%2===1)&&(B=[1-e,1-Z,1-U,1-Z,1-U,1-q,1-e,1-q]),(b===Q.e.FLIP_ROW&&S%2===1||b===Q.e.FLIP_TILE&&(S+t)%2===1)&&(B=[1-e,Z,1-U,Z,1-U,q,1-e,q]),(b===Q.e.FLIP_N_ROTATE_ROW&&S%2===1||b===Q.e.FLIP_N_ROTATE_TILE&&(S+t)%2===1)&&(B=[e,1-Z,U,1-Z,U,1-q,e,1-q]),d=d.concat(B),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),p){const p=[];e=0,Z=1-X/h,U=1,q=1,p[0]=[e,Z,U,Z,U,q,e,q],p[1]=[e,Z,U,Z,U,q,e,q],b!==Q.e.ROTATE_TILE&&b!==Q.e.ROTATE_ROW||(p[1]=[1-e,1-Z,1-U,1-Z,1-U,1-q,1-e,1-q]),b!==Q.e.FLIP_TILE&&b!==Q.e.FLIP_ROW||(p[1]=[1-e,Z,1-U,Z,1-U,q,1-e,q]),b!==Q.e.FLIP_N_ROTATE_TILE&&b!==Q.e.FLIP_N_ROTATE_ROW||(p[1]=[e,1-Z,U,1-Z,U,1-q,e,1-q]);for(let h=0;h<t;h++)L.push(h*M-c+g,a+f,0),L.push((h+1)*M-c+g,a+f,0),L.push((h+1)*M-c+g,a+X+f,0),L.push(h*M-c+g,a+X+f,0),G.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,d=b===Q.e.FLIP_TILE||b===Q.e.ROTATE_TILE||b===Q.e.FLIP_N_ROTATE_TILE?d.concat(p[(h+1)%2]):b===Q.e.FLIP_ROW||b===Q.e.ROTATE_ROW||b===Q.e.FLIP_N_ROTATE_ROW?d.concat(p[1]):d.concat(p[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const p=[];e=0,Z=0,U=1,q=X/h,p[0]=[e,Z,U,Z,U,q,e,q],p[1]=[e,Z,U,Z,U,q,e,q],b!==Q.e.ROTATE_TILE&&b!==Q.e.ROTATE_ROW||(p[1]=[1-e,1-Z,1-U,1-Z,1-U,1-q,1-e,1-q]),b!==Q.e.FLIP_TILE&&b!==Q.e.FLIP_ROW||(p[1]=[1-e,Z,1-U,Z,1-U,q,1-e,q]),b!==Q.e.FLIP_N_ROTATE_TILE&&b!==Q.e.FLIP_N_ROTATE_ROW||(p[1]=[e,1-Z,U,1-Z,U,1-q,e,1-q]);for(let h=0;h<t;h++)L.push(h*M-c+g,l-X+f,0),L.push((h+1)*M-c+g,l-X+f,0),L.push((h+1)*M-c+g,l+f,0),L.push(h*M-c+g,l+f,0),G.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,d=b===Q.e.FLIP_TILE||b===Q.e.ROTATE_TILE||b===Q.e.FLIP_N_ROTATE_TILE?d.concat(p[(h+S)%2]):b===Q.e.FLIP_ROW||b===Q.e.ROTATE_ROW||b===Q.e.FLIP_N_ROTATE_ROW?d.concat(p[S%2]):d.concat(p[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(w){const p=[];e=1-z/M,Z=0,U=1,q=1,p[0]=[e,Z,U,Z,U,q,e,q],p[1]=[e,Z,U,Z,U,q,e,q],b!==Q.e.ROTATE_TILE&&b!==Q.e.ROTATE_ROW||(p[1]=[1-e,1-Z,1-U,1-Z,1-U,1-q,1-e,1-q]),b!==Q.e.FLIP_TILE&&b!==Q.e.FLIP_ROW||(p[1]=[1-e,Z,1-U,Z,1-U,q,1-e,q]),b!==Q.e.FLIP_N_ROTATE_TILE&&b!==Q.e.FLIP_N_ROTATE_ROW||(p[1]=[e,1-Z,U,1-Z,U,1-q,e,1-q]);for(let M=0;M<S;M++)L.push(Y+g,M*h-J+f,0),L.push(Y+z+g,M*h-J+f,0),L.push(Y+z+g,(M+1)*h-J+f,0),L.push(Y+g,(M+1)*h-J+f,0),G.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,d=b===Q.e.FLIP_TILE||b===Q.e.ROTATE_TILE||b===Q.e.FLIP_N_ROTATE_TILE?d.concat(p[(M+1)%2]):b===Q.e.FLIP_ROW||b===Q.e.ROTATE_ROW||b===Q.e.FLIP_N_ROTATE_ROW?d.concat(p[M%2]):d.concat(p[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const p=[];e=0,Z=0,U=z/h,q=1,p[0]=[e,Z,U,Z,U,q,e,q],p[1]=[e,Z,U,Z,U,q,e,q],b!==Q.e.ROTATE_TILE&&b!==Q.e.ROTATE_ROW||(p[1]=[1-e,1-Z,1-U,1-Z,1-U,1-q,1-e,1-q]),b!==Q.e.FLIP_TILE&&b!==Q.e.FLIP_ROW||(p[1]=[1-e,Z,1-U,Z,1-U,q,1-e,q]),b!==Q.e.FLIP_N_ROTATE_TILE&&b!==Q.e.FLIP_N_ROTATE_ROW||(p[1]=[e,1-Z,U,1-Z,U,1-q,e,1-q]);for(let M=0;M<S;M++)L.push(o-z+g,M*h-J+f,0),L.push(o+g,M*h-J+f,0),L.push(o+g,(M+1)*h-J+f,0),L.push(o-z+g,(M+1)*h-J+f,0),G.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,d=b===Q.e.FLIP_TILE||b===Q.e.ROTATE_TILE||b===Q.e.FLIP_N_ROTATE_TILE?d.concat(p[(M+t)%2]):b===Q.e.FLIP_ROW||b===Q.e.ROTATE_ROW||b===Q.e.FLIP_N_ROTATE_ROW?d.concat(p[M%2]):d.concat(p[0]),I.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const Z=0===p.sideOrientation?0:p.sideOrientation||y.e.DEFAULTSIDE;y.e._ComputeSides(Z,L,G,u,d,p.frontUVs,p.backUVs);const U=new y.e;U.indices=G,U.dp=L,U.Ip=u,U.vp=d;const q=Z===y.e.DOUBLESIDE?I.concat(I):I;return U.Gp=q,U}function c(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new Q.e(p,M);b.sideOrientation=Q.e._GetDefaultSideOrientation(b.sideOrientation),h._originalBuilderSideOrientation=b.sideOrientation;return X(b).Up(h,b.updatable),h}function J(p){const b=p.faceUV||new Array(6),M=p.faceColors,mp=p.pattern||Q.e.NO_FLIP,w=p.width||p.size||1,t=p.height||p.size||1,z=p.depth||p.size||1,x=p.tileWidth||p.tileSize||1,c=p.tileHeight||p.tileSize||1,J=p.alignHorizontal||0,g=p.alignVertical||0,f=0===p.sideOrientation?0:p.sideOrientation||y.e.DEFAULTSIDE;for(let Q=0;Q<6;Q++)void 0===b[Q]&&(b[Q]=new h.Vector4(0,0,1,1)),M&&void 0===M[Q]&&(M[Q]=new S.Hb(1,1,1,1));const Y=w/2,a=t/2,o=z/2,l=[];for(let h=0;h<2;h++)l[h]=X({pattern:mp,tileWidth:x,tileHeight:c,width:w,height:t,alignVertical:g,alignHorizontal:J,sideOrientation:f});for(let h=2;h<4;h++)l[h]=X({pattern:mp,tileWidth:x,tileHeight:c,width:z,height:t,alignVertical:g,alignHorizontal:J,sideOrientation:f});let L=g;g===Q.e.BOTTOM?L=Q.e.TOP:g===Q.e.TOP&&(L=Q.e.BOTTOM);for(let h=4;h<6;h++)l[h]=X({pattern:mp,tileWidth:x,tileHeight:c,width:w,height:z,alignVertical:L,alignHorizontal:J,sideOrientation:f});let u=[],e=[],d=[],I=[];const G=[],v=[],Z=[],U=[];let q=0,B=0;for(let Q=0;Q<6;Q++){const p=l[Q].dp.length;v[Q]=[],Z[Q]=[];for(let b=0;b<p/3;b++)v[Q].push(new h.QM(l[Q].dp[3*b],l[Q].dp[3*b+1],l[Q].dp[3*b+2])),Z[Q].push(new h.QM(l[Q].Ip[3*b],l[Q].Ip[3*b+1],l[Q].Ip[3*b+2]));q=l[Q].vp.length,U[Q]=[];for(let M=0;M<q;M+=2)U[Q][M]=b[Q].x+(b[Q].z-b[Q].x)*l[Q].vp[M],U[Q][M+1]=b[Q].y+(b[Q].w-b[Q].y)*l[Q].vp[M+1],P.c&&(U[Q][M+1]=1-U[Q][M+1]);if(d=d.concat(U[Q]),I=I.concat(l[Q].indices.map((p=>p+B))),B+=v[Q].length,M)for(let b=0;b<4;b++)G.push(M[Q].r,M[Q].g,M[Q].b,M[Q].a)}const s=new h.QM(0,0,o),i=h.Matrix.RotationY(Math.PI);u=v[0].map((p=>h.QM.TransformNormal(p,i).add(s))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[]),e=Z[0].map((p=>h.QM.TransformNormal(p,i))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[]),u=u.concat(v[1].map((p=>p.mh(s))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[])),e=e.concat(Z[1].map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[]));const T=new h.QM(Y,0,0),W=h.Matrix.RotationY(-Math.PI/2);u=u.concat(v[2].map((p=>h.QM.TransformNormal(p,W).add(T))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[])),e=e.concat(Z[2].map((p=>h.QM.TransformNormal(p,W))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[]));const H=h.Matrix.RotationY(Math.PI/2);u=u.concat(v[3].map((p=>h.QM.TransformNormal(p,H).mh(T))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[])),e=e.concat(Z[3].map((p=>h.QM.TransformNormal(p,H))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[]));const E=new h.QM(0,a,0),j=h.Matrix.RotationX(Math.PI/2);u=u.concat(v[4].map((p=>h.QM.TransformNormal(p,j).add(E))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[])),e=e.concat(Z[4].map((p=>h.QM.TransformNormal(p,j))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[]));const V=h.Matrix.RotationX(-Math.PI/2);u=u.concat(v[5].map((p=>h.QM.TransformNormal(p,V).mh(E))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[])),e=e.concat(Z[5].map((p=>h.QM.TransformNormal(p,V))).map((p=>[p.x,p.y,p.z])).reduce(((p,b)=>p.concat(b)),[])),y.e._ComputeSides(f,u,I,e,d);const D=new y.e;if(D.indices=I,D.dp=u,D.Ip=e,D.vp=d,M){const p=f===y.e.DOUBLESIDE?G.concat(G):G;D.Gp=p}return D}function g(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new Q.e(p,M);b.sideOrientation=Q.e._GetDefaultSideOrientation(b.sideOrientation),h._originalBuilderSideOrientation=b.sideOrientation;return J(b).Up(h,b.updatable),h}y.e.CreateTiledPlane=X;y.e.CreateTiledBox=J;var f=M(13988),Y=M(13013),a=M(12975);function o(p){const b=p.height||2;let M=0===p.diameterTop?0:p.diameterTop||p.diameter||1,mp=0===p.diameterBottom?0:p.diameterBottom||p.diameter||1;M=M||1e-5,mp=mp||1e-5;const w=0|(p.tessellation||24),t=0|(p.subdivisions||1),z=!!p.hasRings,x=!!p.enclose,X=0===p.cap?0:p.cap||Q.e.CAP_ALL,c=p.arc&&(p.arc<=0||p.arc>1)?1:p.arc||1,J=0===p.sideOrientation?0:p.sideOrientation||y.e.DEFAULTSIDE,g=p.faceUV||new Array(3),f=p.faceColors,Y=2+(1+(1!==c&&x?2:0))*(z?t:1);let o;for(o=0;o<Y;o++)f&&void 0===f[o]&&(f[o]=new S.Hb(1,1,1,1));for(o=0;o<Y;o++)g&&void 0===g[o]&&(g[o]=new h.Vector4(0,0,1,1));const l=[],L=[],u=[],e=[],d=[],I=2*Math.PI*c/w;let G,v,Z;const U=(mp-M)/2/b,q=h.QM.Zero(),B=h.QM.Zero(),s=h.QM.Zero(),i=h.QM.Zero(),T=h.QM.Zero(),W=a.b.Y;let H,E,j,V=1,D=1,N=0,O=0;for(H=0;H<=t;H++)for(v=H/t,Z=(v*(M-mp)+mp)/2,V=z&&0!==H&&H!==t?2:1,j=0;j<V;j++){for(z&&(D+=j),x&&(D+=2*j),E=0;E<=w;E++)G=E*I,q.x=Math.cos(-G)*Z,q.y=-b/2+v*b,q.z=Math.sin(-G)*Z,0===M&&H===t?(B.x=u[u.length-3*(w+1)],B.y=u[u.length-3*(w+1)+1],B.z=u[u.length-3*(w+1)+2]):(B.x=q.x,B.z=q.z,B.y=Math.sqrt(B.x*B.x+B.z*B.z)*U,B.normalize()),0===E&&(s.mp(q),i.mp(B)),L.push(q.x,q.y,q.z),u.push(B.x,B.y,B.z),O=z?N!==D?g[D].y:g[D].w:g[D].y+(g[D].w-g[D].y)*v,e.push(g[D].x+(g[D].z-g[D].x)*E/w,P.c?1-O:O),f&&d.push(f[D].r,f[D].g,f[D].b,f[D].a);1!==c&&x&&(L.push(q.x,q.y,q.z),L.push(0,q.y,0),L.push(0,q.y,0),L.push(s.x,s.y,s.z),h.QM.CrossToRef(W,B,T),T.normalize(),u.push(T.x,T.y,T.z,T.x,T.y,T.z),h.QM.CrossToRef(i,W,T),T.normalize(),u.push(T.x,T.y,T.z,T.x,T.y,T.z),O=z?N!==D?g[D+1].y:g[D+1].w:g[D+1].y+(g[D+1].w-g[D+1].y)*v,e.push(g[D+1].x,P.c?1-O:O),e.push(g[D+1].z,P.c?1-O:O),O=z?N!==D?g[D+2].y:g[D+2].w:g[D+2].y+(g[D+2].w-g[D+2].y)*v,e.push(g[D+2].x,P.c?1-O:O),e.push(g[D+2].z,P.c?1-O:O),f&&(d.push(f[D+1].r,f[D+1].g,f[D+1].b,f[D+1].a),d.push(f[D+1].r,f[D+1].g,f[D+1].b,f[D+1].a),d.push(f[D+2].r,f[D+2].g,f[D+2].b,f[D+2].a),d.push(f[D+2].r,f[D+2].g,f[D+2].b,f[D+2].a))),N!==D&&(N=D)}const R=1!==c&&x?w+4:w;for(H=0,D=0;D<t;D++){let p=0,b=0,M=0,h=0;for(E=0;E<w;E++)p=H*(R+1)+E,b=(H+1)*(R+1)+E,M=H*(R+1)+(E+1),h=(H+1)*(R+1)+(E+1),l.push(p,b,M),l.push(h,M,b);1!==c&&x&&(l.push(p+2,b+2,M+2),l.push(h+2,M+2,b+2),l.push(p+4,b+4,M+4),l.push(h+4,M+4,b+4)),H=z?H+2:H+1}const K=p=>{const Q=p?M/2:mp/2;if(0===Q)return;let y,t,z;const x=p?g[Y-1]:g[0];let S=null;f&&(S=p?f[Y-1]:f[0]);const X=L.length/3,J=p?b/2:-b/2,a=new h.QM(0,J,0);L.push(a.x,a.y,a.z),u.push(0,p?1:-1,0);const o=x.y+.5*(x.w-x.y);e.push(x.x+.5*(x.z-x.x),P.c?1-o:o),S&&d.push(S.r,S.g,S.b,S.a);const I=new h.Vector2(.5,.5);for(z=0;z<=w;z++){y=2*Math.PI*z*c/w;const b=Math.cos(-y),M=Math.sin(-y);t=new h.QM(b*Q,J,M*Q);const mp=new h.Vector2(b*I.x+.5,M*I.y+.5);L.push(t.x,t.y,t.z),u.push(0,p?1:-1,0);const X=x.y+(x.w-x.y)*mp.y;e.push(x.x+(x.z-x.x)*mp.x,P.c?1-X:X),S&&d.push(S.r,S.g,S.b,S.a)}for(z=0;z<w;z++)p?(l.push(X),l.push(X+(z+2)),l.push(X+(z+1))):(l.push(X),l.push(X+(z+1)),l.push(X+(z+2)))};X!==Q.e.CAP_START&&X!==Q.e.CAP_ALL||K(!1),X!==Q.e.CAP_END&&X!==Q.e.CAP_ALL||K(!0),y.e._ComputeSides(J,L,l,u,e,p.frontUVs,p.backUVs);const r=new y.e;return r.indices=l,r.dp=L,r.Ip=u,r.vp=e,f&&(r.Gp=d),r}function l(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;const h=new Q.e(p,M);b.sideOrientation=Q.e._GetDefaultSideOrientation(b.sideOrientation),h._originalBuilderSideOrientation=b.sideOrientation;return o(b).Up(h,b.updatable),h}function L(p){const b=[],M=[],Q=[],mp=[],w=p.diameter||1,t=p.thickness||.5,z=0|(p.tessellation||16),x=0===p.sideOrientation?0:p.sideOrientation||y.e.DEFAULTSIDE,S=z+1;for(let y=0;y<=z;y++){const p=y/z,x=y*Math.PI*2/z-Math.PI/2,X=h.Matrix.Translation(w/2,0,0).multiply(h.Matrix.RotationY(x));for(let w=0;w<=z;w++){const x=1-w/z,c=w*Math.PI*2/z+Math.PI,J=Math.cos(c),g=Math.sin(c);let f=new h.QM(J,g,0),Y=f.scale(t/2);const a=new h.Vector2(p,x);Y=h.QM.TransformCoordinates(Y,X),f=h.QM.TransformNormal(f,X),M.push(Y.x,Y.y,Y.z),Q.push(f.x,f.y,f.z),mp.push(a.x,P.c?1-a.y:a.y);const o=(y+1)%S,l=(w+1)%S;b.push(y*S+w),b.push(y*S+l),b.push(o*S+w),b.push(y*S+l),b.push(o*S+l),b.push(o*S+w)}}y.e._ComputeSides(x,M,b,Q,mp,p.frontUVs,p.backUVs);const X=new y.e;return X.indices=b,X.dp=M,X.Ip=Q,X.vp=mp,X}function u(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;const h=new Q.e(p,M);b.sideOrientation=Q.e._GetDefaultSideOrientation(b.sideOrientation),h._originalBuilderSideOrientation=b.sideOrientation;return L(b).Up(h,b.updatable),h}y.e.CreateCylinder=o,Q.e.CreateCylinder=(p,b,M,h,mp,y,P,w,t)=>{void 0!==P&&P instanceof Y.b||(void 0!==P&&(t=w||Q.e.DEFAULTSIDE,w=P),P=y,y=1);return l(p,{height:b,diameterTop:M,diameterBottom:h,tessellation:mp,subdivisions:y,sideOrientation:t,updatable:w},P)};function e(p){const b=[],M=[],Q=[],mp=[],w=p.radius||2,t=p.tube||.5,z=p.radialSegments||32,x=p.tubularSegments||32,S=p.p||2,X=p.q||3,c=0===p.sideOrientation?0:p.sideOrientation||y.e.DEFAULTSIDE,J=p=>{const b=Math.cos(p),M=Math.sin(p),Q=X/S*p,mp=Math.cos(Q),y=w*(2+mp)*.5*b,P=w*(2+mp)*M*.5,t=w*Math.sin(Q)*.5;return new h.QM(y,P,t)};let g,f;for(g=0;g<=z;g++){const p=g%z/z*2*S*Math.PI,b=J(p),Q=J(p+.01),y=Q.mh(b);let w=Q.add(b);const X=h.QM.Cross(y,w);for(w=h.QM.Cross(X,y),X.normalize(),w.normalize(),f=0;f<x;f++){const p=f%x/x*2*Math.PI,h=-t*Math.cos(p),Q=t*Math.sin(p);M.push(b.x+h*w.x+Q*X.x),M.push(b.y+h*w.y+Q*X.y),M.push(b.z+h*w.z+Q*X.z),mp.push(g/z),mp.push(P.c?1-f/x:f/x)}}for(g=0;g<z;g++)for(f=0;f<x;f++){const p=(f+1)%x,M=g*x+f,h=(g+1)*x+f,Q=(g+1)*x+p,mp=g*x+p;b.push(mp),b.push(h),b.push(M),b.push(mp),b.push(Q),b.push(h)}y.e.ComputeNormals(M,b,Q),y.e._ComputeSides(c,M,b,Q,mp,p.frontUVs,p.backUVs);const Y=new y.e;return Y.indices=b,Y.dp=M,Y.Ip=Q,Y.vp=mp,Y}function d(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;const h=new Q.e(p,M);b.sideOrientation=Q.e._GetDefaultSideOrientation(b.sideOrientation),h._originalBuilderSideOrientation=b.sideOrientation;return e(b).Up(h,b.updatable),h}y.e.CreateTorus=L,Q.e.CreateTorus=(p,b,M,h,Q,mp,y)=>u(p,{diameter:b,thickness:M,tessellation:h,sideOrientation:y,updatable:mp},Q);y.e.CreateTorusKnot=e,Q.e.CreateTorusKnot=(p,b,M,h,Q,mp,y,P,w,t)=>d(p,{radius:b,tube:M,radialSegments:h,tubularSegments:Q,p:mp,q:y,sideOrientation:t,updatable:w},P);var I=M(14506),G=M(13337),v=M(12986);function Z(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=b.path,mp=b.shape,y=b.scale||1,P=b.rotation||0,w=0===b.cap?0:b.cap||Q.e.NO_CAP,t=b.updatable,z=Q.e._GetDefaultSideOrientation(b.sideOrientation),x=b.instance||null,S=b.invertUV||!1,X=b.closeShape||!1,c=b.closePath||!1,J=b.capFunction||null;return q(p,mp,h,y,P,null,null,c,X,w,!1,M,!!t,z,x,S,b.frontUVs||null,b.backUVs||null,b.firstNormal||null,!!b.adjustFrame,J)}function U(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=b.path,mp=b.shape,y=b.scaleFunction||(()=>1),P=b.rotationFunction||(()=>0),w=b.closePath||b.ribbonCloseArray||!1,t=b.closeShape||b.ribbonClosePath||!1,z=0===b.cap?0:b.cap||Q.e.NO_CAP,x=b.updatable,S=b.firstNormal||null,X=b.adjustFrame||!1,c=Q.e._GetDefaultSideOrientation(b.sideOrientation),J=b.instance,g=b.invertUV||!1,f=b.capFunction||null;return q(p,mp,h,null,null,y,P,w,t,z,!0,M,!!x,c,J||null,g,b.frontUVs||null,b.backUVs||null,S,X,f||null)}function q(p,b,M,mp,y,P,w,z,x,S,X,c,J,g,f,Y,a,o,l,L,u){const e=(p,b,M,mp,y,P,w,t,z,x,S)=>{const X=M.getTangents(),c=M.getNormals(),J=M.getBinormals(),g=M.getDistances();if(S)for(let Q=0;Q<X.length;Q++)if(0==X[Q].x&&0==X[Q].y&&0==X[Q].z&&X[Q].mp(X[Q-1]),0==c[Q].x&&0==c[Q].y&&0==c[Q].z&&c[Q].mp(c[Q-1]),0==J[Q].x&&0==J[Q].y&&0==J[Q].z&&J[Q].mp(J[Q-1]),Q>0){let p=X[Q-1];h.QM.Dot(p,X[Q])<0&&X[Q].scaleInPlace(-1),p=c[Q-1],h.QM.Dot(p,c[Q])<0&&c[Q].scaleInPlace(-1),p=J[Q-1],h.QM.Dot(p,J[Q])<0&&J[Q].scaleInPlace(-1)}let f=0;const Y=x&&t?t:()=>null!==P?P:0,a=x&&w?w:()=>null!==y?y:1;let o=z===Q.e.NO_CAP||z===Q.e.CAP_END?0:2;const l=h.TmpVectors.Matrix[0];for(let Q=0;Q<b.length;Q++){const M=[],y=Y(Q,g[Q]),P=a(Q,g[Q]);h.Matrix.RotationAxisToRef(X[Q],f,l);for(let mp=0;mp<p.length;mp++){const y=X[Q].scale(p[mp].z).add(c[Q].scale(p[mp].x)).add(J[Q].scale(p[mp].y)),w=h.QM.Zero();h.QM.TransformCoordinatesToRef(y,l,w),w.scaleInPlace(P).addInPlace(b[Q]),M[mp]=w}mp[o]=M,f+=y,o++}const L=u||(p=>{const b=Array(),M=h.QM.Zero();let Q;for(Q=0;Q<p.length;Q++)M.addInPlace(p[Q]);for(M.scaleInPlace(1/p.length),Q=0;Q<p.length;Q++)b.push(M);return b});switch(z){case Q.e.NO_CAP:break;case Q.e.CAP_START:mp[0]=L(mp[2]),mp[1]=mp[2];break;case Q.e.CAP_END:mp[o]=mp[o-1],mp[o+1]=L(mp[o-1]);break;case Q.e.CAP_ALL:mp[0]=L(mp[2]),mp[1]=mp[2],mp[o]=mp[o-1],mp[o+1]=L(mp[o-1])}return mp};let d,I;if(f){const p=f._creationDataStorage;return d=l?p.path3D.update(M,l):p.path3D.update(M),I=e(b,M,p.path3D,p.pathArray,mp,y,P,w,p.cap,X,L),f=t("",{pathArray:I,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:f},c||void 0)}d=l?new v.k(M,l):new v.k(M);I=e(b,M,d,new Array,mp,y,P,w,S=S<0||S>3?0:S,X,L);const G=t(p,{pathArray:I,closeArray:z,closePath:x,updatable:J,sideOrientation:g,invertUV:Y,frontUVs:a||void 0,backUVs:o||void 0},c);return G._creationDataStorage.pathArray=I,G._creationDataStorage.path3D=d,G._creationDataStorage.cap=S,G}function B(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mp=b.arc?b.arc<=0||b.arc>1?1:b.arc:1,y=void 0===b.closed||b.closed,P=b.shape,w=b.radius||1,z=b.tessellation||64,x=b.clip||0,S=b.updatable,X=Q.e._GetDefaultSideOrientation(b.sideOrientation),c=b.cap||Q.e.NO_CAP,J=2*Math.PI,g=[],f=b.invertUV||!1;let Y=0,a=0;const o=J/z*mp;let l,L;for(Y=0;Y<=z-x;Y++){for(L=[],c!=Q.e.CAP_START&&c!=Q.e.CAP_ALL||(L.push(new h.QM(0,P[0].y,0)),L.push(new h.QM(Math.cos(Y*o)*P[0].x*w,P[0].y,Math.sin(Y*o)*P[0].x*w))),a=0;a<P.length;a++)l=new h.QM(Math.cos(Y*o)*P[a].x*w,P[a].y,Math.sin(Y*o)*P[a].x*w),L.push(l);c!=Q.e.CAP_END&&c!=Q.e.CAP_ALL||(L.push(new h.QM(Math.cos(Y*o)*P[P.length-1].x*w,P[P.length-1].y,Math.sin(Y*o)*P[P.length-1].x*w)),L.push(new h.QM(0,P[P.length-1].y,0))),g.push(L)}return t(p,{pathArray:g,closeArray:y,sideOrientation:X,updatable:S,invertUV:f,frontUVs:b.frontUVs,backUVs:b.backUVs},M)}Q.e.ExtrudeShape=function(p,b,M,h,mp,y){let P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0,z=arguments.length>9?arguments[9]:void 0;return Z(p,{shape:b,path:M,scale:h,rotation:mp,cap:0===y?0:y||Q.e.NO_CAP,sideOrientation:t,instance:z,updatable:w},P)},Q.e.ExtrudeShapeCustom=(p,b,M,h,mp,y,P,w,t,z,x,S)=>U(p,{shape:b,path:M,scaleFunction:h,rotationFunction:mp,ribbonCloseArray:y,ribbonClosePath:P,cap:0===w?0:w||Q.e.NO_CAP,sideOrientation:x,instance:S,updatable:z},t);Q.e.CreateLathe=(p,b,M,h,Q,mp,y)=>B(p,{shape:b,radius:M,tessellation:h,sideOrientation:y,updatable:mp},Q);var s=M(13896),i=M(13841);function T(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mp=b.path;let y=b.instance,P=1;void 0!==b.radius?P=b.radius:y&&(P=y._creationDataStorage.radius);const w=b.tessellation||64,z=b.radiusFunction||null;let x=b.cap||Q.e.NO_CAP;const S=b.invertUV||!1,X=b.updatable,c=Q.e._GetDefaultSideOrientation(b.sideOrientation);b.arc=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1;const J=(p,b,M,mp,y,P,w,t)=>{const z=b.getTangents(),x=b.getNormals(),S=b.getDistances(),X=2*Math.PI/y*t,c=P||(()=>mp);let J,g,f,Y;const a=h.TmpVectors.Matrix[0];let o=w===Q.e.NO_CAP||w===Q.e.CAP_END?0:2;for(let Q=0;Q<p.length;Q++){g=c(Q,S[Q]),J=Array(),f=x[Q];for(let b=0;b<y;b++)h.Matrix.RotationAxisToRef(z[Q],X*b,a),Y=J[b]?J[b]:h.QM.Zero(),h.QM.TransformCoordinatesToRef(f,a,Y),Y.scaleInPlace(g).addInPlace(p[Q]),J[b]=Y;M[o]=J,o++}const l=(b,M)=>{const h=Array();for(let Q=0;Q<b;Q++)h.push(p[M]);return h};switch(w){case Q.e.NO_CAP:break;case Q.e.CAP_START:M[0]=l(y,0),M[1]=M[2].slice(0);break;case Q.e.CAP_END:M[o]=M[o-1].slice(0),M[o+1]=l(y,p.length-1);break;case Q.e.CAP_ALL:M[0]=l(y,0),M[1]=M[2].slice(0),M[o]=M[o-1].slice(0),M[o+1]=l(y,p.length-1)}return M};let g,f;if(y){const p=y._creationDataStorage,M=b.arc||p.arc;return g=p.path3D.update(mp),f=J(mp,g,p.pathArray,P,p.tessellation,z,p.cap,M),y=t("",{pathArray:f,instance:y}),p.path3D=g,p.pathArray=f,p.arc=M,p.radius=P,y}g=new v.k(mp);x=x<0||x>3?0:x,f=J(mp,g,new Array,P,w,z,x,b.arc);const Y=t(p,{pathArray:f,closePath:!0,closeArray:!1,updatable:X,sideOrientation:c,invertUV:S,frontUVs:b.frontUVs,backUVs:b.backUVs},M);return Y._creationDataStorage.pathArray=f,Y._creationDataStorage.path3D=g,Y._creationDataStorage.tessellation=w,Y._creationDataStorage.cap=x,Y._creationDataStorage.arc=b.arc,Y._creationDataStorage.radius=P,Y}function W(p){const b=[];b[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},b[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},b[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},b[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},b[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},b[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},b[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},b[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},b[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},b[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},b[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},b[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},b[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},b[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},b[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const M=p.type&&(p.type<0||p.type>=b.length)?0:p.type||0,Q=p.size,mp=p.sizeX||Q||1,w=p.sizeY||Q||1,t=p.sizeZ||Q||1,z=p.custom||b[M],x=z.face.length,X=p.faceUV||new Array(x),c=p.faceColors,J=void 0===p.flat||p.flat,g=0===p.sideOrientation?0:p.sideOrientation||y.e.DEFAULTSIDE,f=[],Y=[],a=[],o=[],l=[];let L=0,u=0;const e=[];let d,I,G,v,Z,U,q=0,B=0;if(J)for(B=0;B<x;B++)c&&void 0===c[B]&&(c[B]=new S.Hb(1,1,1,1)),X&&void 0===X[B]&&(X[B]=new h.Vector4(0,0,1,1));if(J)for(B=0;B<x;B++){const p=z.face[B].length;for(G=2*Math.PI/p,v=.5*Math.tan(G/2),Z=.5,q=0;q<p;q++)f.push(z.vertex[z.face[B][q]][0]*mp,z.vertex[z.face[B][q]][1]*w,z.vertex[z.face[B][q]][2]*t),e.push(L),L++,d=X[B].x+(X[B].z-X[B].x)*(.5+v),I=X[B].y+(X[B].w-X[B].y)*(Z-.5),o.push(d,P.c?1-I:I),U=v*Math.cos(G)-Z*Math.sin(G),Z=v*Math.sin(G)+Z*Math.cos(G),v=U,c&&l.push(c[B].r,c[B].g,c[B].b,c[B].a);for(q=0;q<p-2;q++)Y.push(e[0+u],e[q+2+u],e[q+1+u]);u+=p}else{for(q=0;q<z.vertex.length;q++)f.push(z.vertex[q][0]*mp,z.vertex[q][1]*w,z.vertex[q][2]*t),o.push(0,P.c?1:0);for(B=0;B<x;B++)for(q=0;q<z.face[B].length-2;q++)Y.push(z.face[B][0],z.face[B][q+2],z.face[B][q+1])}y.e.ComputeNormals(f,Y,a),y.e._ComputeSides(g,f,Y,a,o,p.frontUVs,p.backUVs);const s=new y.e;return s.dp=f,s.indices=Y,s.Ip=a,s.vp=o,c&&J&&(s.Gp=l),s}function H(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new Q.e(p,M);b.sideOrientation=Q.e._GetDefaultSideOrientation(b.sideOrientation),h._originalBuilderSideOrientation=b.sideOrientation;return W(b).Up(h,b.updatable),h}Q.e.CreateTube=(p,b,M,h,Q,mp,y,P,w,t)=>T(p,{path:b,radius:M,tessellation:h,radiusFunction:Q,arc:1,cap:mp,updatable:P,sideOrientation:w,instance:t},y);function E(p){const b=p.sideOrientation||y.e.DEFAULTSIDE,M=p.radius||1,Q=void 0===p.flat||p.flat,mp=0|(p.subdivisions||4),w=p.radiusX||M,t=p.radiusY||M,z=p.radiusZ||M,x=(1+Math.sqrt(5))/2,S=[-1,x,-0,1,x,0,-1,-x,0,1,-x,0,0,-1,-x,0,1,-x,0,-1,x,0,1,x,x,0,1,x,0,-1,-x,0,1,-x,0,-1],X=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],c=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],J=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],g=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],f=[],Y=[],a=[],o=[];let l=0;const L=new Array(3),u=new Array(3);let e;for(e=0;e<3;e++)L[e]=h.QM.Zero(),u[e]=h.Vector2.Zero();for(let y=0;y<20;y++){for(e=0;e<3;e++){const p=X[3*y+e];L[e].sb(S[3*c[p]],S[3*c[p]+1],S[3*c[p]+2]),L[e].normalize(),u[e].sb(.134765625*J[2*p]+.05859375+-.0390625*g[y],.2333984375*J[2*p+1]+.025390625+.01953125*g[y])}const p=(p,b,M,y)=>{const x=h.QM.Lerp(L[0],L[2],b/mp),S=h.QM.Lerp(L[1],L[2],b/mp),X=mp===b?L[2]:h.QM.Lerp(x,S,p/(mp-b));let c;if(X.normalize(),Q){const p=h.QM.Lerp(L[0],L[2],y/mp),b=h.QM.Lerp(L[1],L[2],y/mp);c=h.QM.Lerp(p,b,M/(mp-y))}else c=new h.QM(X.x,X.y,X.z);c.x/=w,c.y/=t,c.z/=z,c.normalize();const J=h.Vector2.Lerp(u[0],u[2],b/mp),g=h.Vector2.Lerp(u[1],u[2],b/mp),e=mp===b?u[2]:h.Vector2.Lerp(J,g,p/(mp-b));Y.push(X.x*w,X.y*t,X.z*z),a.push(c.x,c.y,c.z),o.push(e.x,P.c?1-e.y:e.y),f.push(l),l++};for(let b=0;b<mp;b++)for(let M=0;M+b<mp;M++)p(M,b,M+1/3,b+1/3),p(M+1,b,M+1/3,b+1/3),p(M,b+1,M+1/3,b+1/3),M+b+1<mp&&(p(M+1,b,M+2/3,b+2/3),p(M+1,b+1,M+2/3,b+2/3),p(M,b+1,M+2/3,b+2/3))}y.e._ComputeSides(b,Y,f,a,o,p.frontUVs,p.backUVs);const d=new y.e;return d.indices=f,d.dp=Y,d.Ip=a,d.vp=o,d}function j(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new Q.e(p,M);b.sideOrientation=Q.e._GetDefaultSideOrientation(b.sideOrientation),h._originalBuilderSideOrientation=b.sideOrientation;return E(b).Up(h,b.updatable),h}y.e.CreatePolyhedron=W,Q.e.CreatePolyhedron=(p,b,M)=>H(p,b,M);y.e.CreateIcoSphere=E,Q.e.CreateIcoSphere=(p,b,M)=>j(p,b,M);var V=M(12789);const D=new h.QM(1,0,0),N=new h.QM(-1,0,0),O=new h.QM(0,1,0),R=new h.QM(0,-1,0),K=new h.QM(0,0,1),r=new h.QM(0,0,-1);class k{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.QM.Zero(),b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.QM.Up(),M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.Vector2.Zero(),Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,mp=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=p,this.normal=b,this.uv=M,this.vertexIdx=Q,this.vertexIdxForBones=mp,this.localPositionOverride=y,this.localNormalOverride=P,this.matrixIndicesOverride=w,this.matrixWeightsOverride=t}clone(){var p,b,M,h;return new k(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(p=this.localPositionOverride)||void 0===p?void 0:p.slice(),null===(b=this.localNormalOverride)||void 0===b?void 0:b.slice(),null===(M=this.matrixIndicesOverride)||void 0===M?void 0:M.slice(),null===(h=this.matrixWeightsOverride)||void 0===h?void 0:h.slice())}}function A(p,b,M){var w,t,z,x,S;const X=!!b.skeleton,c=!(null===(w=b.morphTargetManager)||void 0===w||!w.numTargets),J=M.localMode||X,g=b.qb(),f=X||c?b.kw(!0,!0):b.getVerticesData(mp.f.PositionKind),Y=X||c?b.getNormalsData(!0,!0):b.getVerticesData(mp.f.NormalKind),a=J?X?b.getVerticesData(mp.f.PositionKind):f:null,o=J?X?b.getVerticesData(mp.f.NormalKind):Y:null,l=b.getVerticesData(mp.f.UVKind),L=X?b.getVerticesData(mp.f.MatricesIndicesKind):null,u=X?b.getVerticesData(mp.f.MatricesWeightsKind):null,e=X?b.getVerticesData(mp.f.MatricesIndicesExtraKind):null,d=X?b.getVerticesData(mp.f.MatricesWeightsExtraKind):null,I=M.position||h.QM.Zero();let G=M.normal||h.QM.Up();const v=M.size||h.QM.One(),Z=M.angle||0;if(!G){const p=new h.QM(0,0,1),M=b.upp().activeCamera,Q=h.QM.TransformCoordinates(p,M.getWorldMatrix());G=M.globalPosition.mh(Q)}const U=-Math.atan2(G.z,G.x)-Math.PI/2,q=Math.sqrt(G.x*G.x+G.z*G.z),B=Math.atan2(G.y,q),s=new y.e;s.indices=[],s.dp=[],s.Ip=[],s.vp=[],s.matricesIndices=X?[]:null,s.matricesWeights=X?[]:null,s.matricesIndicesExtra=e?[]:null,s.matricesWeightsExtra=d?[]:null;let i=0;const T=(p,b)=>{const Q=new k;if(!g||!f||!Y)return Q;const mp=g[p];if(Q.vertexIdx=3*mp,Q.vertexIdxForBones=4*mp,Q.position=new h.QM(f[3*mp],f[3*mp+1],f[3*mp+2]),h.QM.TransformCoordinatesToRef(Q.position,b,Q.position),Q.normal=new h.QM(Y[3*mp],Y[3*mp+1],Y[3*mp+2]),h.QM.TransformNormalToRef(Q.normal,b,Q.normal),M.captureUVS&&l){const p=l[2*mp+1];Q.uv=new h.Vector2(l[2*mp],P.c?1-p:p)}return Q},W=[0,0,0,0],H=(p,b)=>{if(0===p.length)return p;const M=.5*Math.abs(h.QM.Dot(v,b)),Q=(p,b,M,h)=>{for(let Q=0;Q<h;++Q)if(p[M+Q]===b)return M+Q;return-1},mp=(p,mp)=>{const y=h.QM.GetClipFactor(p.position,mp.position,b,M);let P=W,w=W;if(L&&u){const b=p.matrixIndicesOverride?0:p.vertexIdxForBones,M=p.matrixIndicesOverride??L,h=p.matrixWeightsOverride??u,t=mp.matrixIndicesOverride?0:mp.vertexIdxForBones,z=mp.matrixIndicesOverride??L,x=mp.matrixWeightsOverride??u;P=[0,0,0,0],w=[0,0,0,0];let S=0;for(let p=0;p<4;++p)if(h[b+p]>0){const mp=Q(z,M[b+p],t,4);P[S]=M[b+p],w[S]=(0,V.Lerp)(h[b+p],mp>=0?x[mp]:0,y),S++}for(let p=0;p<4&&S<4;++p){const h=z[t+p];-1===Q(M,h,b,4)&&(P[S]=h,w[S]=(0,V.Lerp)(0,x[t+p],y),S++)}const X=w[0]+w[1]+w[2]+w[3];w[0]/=X,w[1]/=X,w[2]/=X,w[3]/=X}const t=p.localPositionOverride?p.localPositionOverride[0]:(null===a||void 0===a?void 0:a[p.vertexIdx])??0,z=p.localPositionOverride?p.localPositionOverride[1]:(null===a||void 0===a?void 0:a[p.vertexIdx+1])??0,x=p.localPositionOverride?p.localPositionOverride[2]:(null===a||void 0===a?void 0:a[p.vertexIdx+2])??0,S=mp.localPositionOverride?mp.localPositionOverride[0]:(null===a||void 0===a?void 0:a[mp.vertexIdx])??0,X=mp.localPositionOverride?mp.localPositionOverride[1]:(null===a||void 0===a?void 0:a[mp.vertexIdx+1])??0,c=mp.localPositionOverride?mp.localPositionOverride[2]:(null===a||void 0===a?void 0:a[mp.vertexIdx+2])??0,J=p.localNormalOverride?p.localNormalOverride[0]:(null===o||void 0===o?void 0:o[p.vertexIdx])??0,g=p.localNormalOverride?p.localNormalOverride[1]:(null===o||void 0===o?void 0:o[p.vertexIdx+1])??0,f=p.localNormalOverride?p.localNormalOverride[2]:(null===o||void 0===o?void 0:o[p.vertexIdx+2])??0,Y=J+((mp.localNormalOverride?mp.localNormalOverride[0]:(null===o||void 0===o?void 0:o[mp.vertexIdx])??0)-J)*y,l=g+((mp.localNormalOverride?mp.localNormalOverride[1]:(null===o||void 0===o?void 0:o[mp.vertexIdx+1])??0)-g)*y,e=f+((mp.localNormalOverride?mp.localNormalOverride[2]:(null===o||void 0===o?void 0:o[mp.vertexIdx+2])??0)-f)*y,d=Math.sqrt(Y*Y+l*l+e*e);return new k(h.QM.Lerp(p.position,mp.position,y),h.QM.Lerp(p.normal,mp.normal,y).normalize(),h.Vector2.Lerp(p.uv,mp.uv,y),-1,-1,a?[t+(S-t)*y,z+(X-z)*y,x+(c-x)*y]:null,o?[Y/d,l/d,e/d]:null,P,w)};let y=null;p.length>3&&(y=[]);for(let P=0;P<p.length;P+=3){let Q=0,w=null,t=null,z=null,x=null;const S=h.QM.Dot(p[P].position,b)-M>0,X=h.QM.Dot(p[P+1].position,b)-M>0,c=h.QM.Dot(p[P+2].position,b)-M>0;switch(Q=(S?1:0)+(X?1:0)+(c?1:0),Q){case 0:p.length>3?(y.push(p[P]),y.push(p[P+1]),y.push(p[P+2])):y=p;break;case 1:if(y=y??new Array,S&&(w=p[P+1],t=p[P+2],z=mp(p[P],w),x=mp(p[P],t)),X){w=p[P],t=p[P+2],z=mp(p[P+1],w),x=mp(p[P+1],t),y.push(z),y.push(t.clone()),y.push(w.clone()),y.push(t.clone()),y.push(z.clone()),y.push(x);break}c&&(w=p[P],t=p[P+1],z=mp(p[P+2],w),x=mp(p[P+2],t)),w&&t&&z&&x&&(y.push(w.clone()),y.push(t.clone()),y.push(z),y.push(x),y.push(z.clone()),y.push(t.clone()));break;case 2:y=y??new Array,S||(w=p[P].clone(),t=mp(w,p[P+1]),z=mp(w,p[P+2]),y.push(w),y.push(t),y.push(z)),X||(w=p[P+1].clone(),t=mp(w,p[P+2]),z=mp(w,p[P]),y.push(w),y.push(t),y.push(z)),c||(w=p[P+2].clone(),t=mp(w,p[P]),z=mp(w,p[P+1]),y.push(w),y.push(t),y.push(z))}}return y},E=b instanceof Q.e?b:null,j=null===E||void 0===E?void 0:E._thinInstanceDataStorage.matrixData,A=(null===E||void 0===E?void 0:E.jb)||1,n=h.TmpVectors.Matrix[0];n.mp(h.Matrix.IdentityReadOnly);for(let Q=0;Q<A;++Q){if(null!==E&&void 0!==E&&E.hasThinInstances&&j){const p=16*Q;n.setRowFromFloats(0,j[p+0],j[p+1],j[p+2],j[p+3]),n.setRowFromFloats(1,j[p+4],j[p+5],j[p+6],j[p+7]),n.setRowFromFloats(2,j[p+8],j[p+9],j[p+10],j[p+11]),n.setRowFromFloats(3,j[p+12],j[p+13],j[p+14],j[p+15])}const p=h.Matrix.RotationYawPitchRoll(U,B,Z).multiply(h.Matrix.Translation(I.x,I.y,I.z)),mp=h.Matrix.Invert(p),y=b.getWorldMatrix(),w=n.multiply(y).multiply(mp),t=new Array(3);for(let b=0;b<g.length;b+=3){let p=t;if(p[0]=T(b,w),p[1]=T(b+1,w),p[2]=T(b+2,w),!(M.cullBackFaces&&-p[0].normal.z<=0&&-p[1].normal.z<=0&&-p[2].normal.z<=0)&&(p=H(p,D),p&&(p=H(p,N),p&&(p=H(p,O),p&&(p=H(p,R),p&&(p=H(p,K),p&&(p=H(p,r),p)))))))for(let b=0;b<p.length;b++){const h=p[b];if(s.indices.push(i),J?(h.localPositionOverride?(s.dp[3*i]=h.localPositionOverride[0],s.dp[3*i+1]=h.localPositionOverride[1],s.dp[3*i+2]=h.localPositionOverride[2]):a&&(s.dp[3*i]=a[h.vertexIdx],s.dp[3*i+1]=a[h.vertexIdx+1],s.dp[3*i+2]=a[h.vertexIdx+2]),h.localNormalOverride?(s.Ip[3*i]=h.localNormalOverride[0],s.Ip[3*i+1]=h.localNormalOverride[1],s.Ip[3*i+2]=h.localNormalOverride[2]):o&&(s.Ip[3*i]=o[h.vertexIdx],s.Ip[3*i+1]=o[h.vertexIdx+1],s.Ip[3*i+2]=o[h.vertexIdx+2])):(h.position.toArray(s.dp,3*i),h.normal.toArray(s.Ip,3*i)),s.matricesIndices&&s.matricesWeights&&(h.matrixIndicesOverride?(s.matricesIndices[4*i]=h.matrixIndicesOverride[0],s.matricesIndices[4*i+1]=h.matrixIndicesOverride[1],s.matricesIndices[4*i+2]=h.matrixIndicesOverride[2],s.matricesIndices[4*i+3]=h.matrixIndicesOverride[3]):(L&&(s.matricesIndices[4*i]=L[h.vertexIdxForBones],s.matricesIndices[4*i+1]=L[h.vertexIdxForBones+1],s.matricesIndices[4*i+2]=L[h.vertexIdxForBones+2],s.matricesIndices[4*i+3]=L[h.vertexIdxForBones+3]),e&&s.matricesIndicesExtra&&(s.matricesIndicesExtra[4*i]=e[h.vertexIdxForBones],s.matricesIndicesExtra[4*i+1]=e[h.vertexIdxForBones+1],s.matricesIndicesExtra[4*i+2]=e[h.vertexIdxForBones+2],s.matricesIndicesExtra[4*i+3]=e[h.vertexIdxForBones+3])),h.matrixWeightsOverride?(s.matricesWeights[4*i]=h.matrixWeightsOverride[0],s.matricesWeights[4*i+1]=h.matrixWeightsOverride[1],s.matricesWeights[4*i+2]=h.matrixWeightsOverride[2],s.matricesWeights[4*i+3]=h.matrixWeightsOverride[3]):(u&&(s.matricesWeights[4*i]=u[h.vertexIdxForBones],s.matricesWeights[4*i+1]=u[h.vertexIdxForBones+1],s.matricesWeights[4*i+2]=u[h.vertexIdxForBones+2],s.matricesWeights[4*i+3]=u[h.vertexIdxForBones+3]),d&&s.matricesWeightsExtra&&(s.matricesWeightsExtra[4*i]=d[h.vertexIdxForBones],s.matricesWeightsExtra[4*i+1]=d[h.vertexIdxForBones+1],s.matricesWeightsExtra[4*i+2]=d[h.vertexIdxForBones+2],s.matricesWeightsExtra[4*i+3]=d[h.vertexIdxForBones+3]))),M.captureUVS)h.uv.toArray(s.vp,2*i);else{s.vp.push(.5+h.position.x/v.x);const p=.5+h.position.y/v.y;s.vp.push(P.c?1-p:p)}i++}}}0===s.indices.length&&(s.indices=null),0===s.dp.length&&(s.dp=null),0===s.Ip.length&&(s.Ip=null),0===s.vp.length&&(s.vp=null),0===(null===(t=s.matricesIndices)||void 0===t?void 0:t.length)&&(s.matricesIndices=null),0===(null===(z=s.matricesWeights)||void 0===z?void 0:z.length)&&(s.matricesWeights=null),0===(null===(x=s.matricesIndicesExtra)||void 0===x?void 0:x.length)&&(s.matricesIndicesExtra=null),0===(null===(S=s.matricesWeightsExtra)||void 0===S?void 0:S.length)&&(s.matricesWeightsExtra=null);const C=new Q.e(p,b.upp());return s.Up(C),J?(C.skeleton=b.skeleton,C.parent=b):(C.position=I.clone(),C.rotation=new h.QM(B,U,Z)),C.Zb(!0),C.refreshBoundingInfo(!0,!0),C}function n(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const b=0|Math.max(p.subdivisions?p.subdivisions:2,1),M=0|Math.max(p.tessellation?p.tessellation:16,3),Q=Math.max(p.height?p.height:1,0),mp=Math.max(p.radius?p.radius:.25,0),w=0|Math.max(p.capSubdivisions?p.capSubdivisions:6,1),t=M,z=b,x=Math.max(p.radiusTop?p.radiusTop:mp,0),S=Math.max(p.radiusBottom?p.radiusBottom:mp,0),X=Q-(x+S),c=2*Math.PI,J=Math.max(p.topCapSubdivisions?p.topCapSubdivisions:w,1),g=Math.max(p.bottomCapSubdivisions?p.bottomCapSubdivisions:w,1),f=Math.acos((S-x)/Q);let Y=[];const a=[],o=[],l=[];let L=0;const u=[],e=.5*X,d=.5*Math.PI;let I,G;const v=h.QM.Zero(),Z=h.QM.Zero(),U=Math.cos(f),q=Math.sin(f),B=new h.Vector2(x*q,e+x*U).mh(new h.Vector2(S*q,S*U-e)).length(),s=x*f+B+S*(d-f);let i=0;for(G=0;G<=J;G++){const p=[],b=d-f*(G/J);i+=x*f/J;const M=Math.cos(b),h=Math.sin(b),Q=M*x;for(I=0;I<=t;I++){const b=I/t,mp=b*c+0,y=Math.sin(mp),w=Math.cos(mp);Z.x=Q*y,Z.y=e+h*x,Z.z=Q*w,a.push(Z.x,Z.y,Z.z),v.set(M*y,h,M*w),o.push(v.x,v.y,v.z),l.push(b,P.c?i/s:1-i/s),p.push(L),L++}u.push(p)}const T=Q-x-S+U*x-U*S,W=q*(S-x)/T;for(G=1;G<=z;G++){const p=[];i+=B/z;const b=q*(G*(S-x)/z+x);for(I=0;I<=t;I++){const M=I/t,h=M*c+0,Q=Math.sin(h),mp=Math.cos(h);Z.x=b*Q,Z.y=e+U*x-G*T/z,Z.z=b*mp,a.push(Z.x,Z.y,Z.z),v.set(Q,W,mp).normalize(),o.push(v.x,v.y,v.z),l.push(M,P.c?i/s:1-i/s),p.push(L),L++}u.push(p)}for(G=1;G<=g;G++){const p=[],b=d-f-(Math.PI-f)*(G/g);i+=S*f/g;const M=Math.cos(b),h=Math.sin(b),Q=M*S;for(I=0;I<=t;I++){const b=I/t,mp=b*c+0,y=Math.sin(mp),w=Math.cos(mp);Z.x=Q*y,Z.y=h*S-e,Z.z=Q*w,a.push(Z.x,Z.y,Z.z),v.set(M*y,h,M*w),o.push(v.x,v.y,v.z),l.push(b,P.c?i/s:1-i/s),p.push(L),L++}u.push(p)}for(I=0;I<t;I++)for(G=0;G<J+z+g;G++){const p=u[G][I],b=u[G+1][I],M=u[G+1][I+1],h=u[G][I+1];Y.push(p),Y.push(b),Y.push(h),Y.push(b),Y.push(M),Y.push(h)}if(Y=Y.reverse(),p.orientation&&!p.orientation.equals(h.QM.Up())){const b=new h.Matrix;p.orientation.clone().scale(.5*Math.PI).cross(h.QM.Up()).toQuaternion().toRotationMatrix(b);const M=h.QM.Zero();for(let p=0;p<a.length;p+=3)M.set(a[p],a[p+1],a[p+2]),h.QM.TransformCoordinatesToRef(M.clone(),b,M),a[p]=M.x,a[p+1]=M.y,a[p+2]=M.z}const H=new y.e;return H.dp=a,H.Ip=o,H.vp=l,H.indices=Y,H}function C(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:h.QM.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mp=new Q.e(p,M);return n(b).Up(mp,b.updatable),mp}Q.e.CreateDecal=(p,b,M,h,Q,mp)=>A(p,b,{position:M,normal:h,size:Q,angle:mp});Q.e.CreateCapsule=(p,b,M)=>C(p,b,M),y.e.CreateCapsule=n;var F=M(12622),pp=M(12779);class bp{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=p,this.y=b,p!==Math.floor(p)&&(p=Math.floor(p),F.d.Warn("x is not an integer, floor(x) used")),b!==Math.floor(b)&&(b=Math.floor(b),F.d.Warn("y is not an integer, floor(y) used"))}clone(){return new bp(this.x,this.y)}rotate60About(p){const b=this.x;return this.x=p.x+p.y-this.y,this.y=b+this.y-p.x,this}rotateNeg60About(p){const b=this.x;return this.x=b+this.y-p.y,this.y=p.x+p.y-b,this}rotate120(p,b){p!==Math.floor(p)&&(p=Math.floor(p),F.d.Warn("m not an integer only floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),F.d.Warn("n not an integer only floor(n) used"));const M=this.x;return this.x=p-M-this.y,this.y=b+M,this}rotateNeg120(p,b){p!==Math.floor(p)&&(p=Math.floor(p),F.d.Warn("m is not an integer, floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),F.d.Warn("n is not an integer,   floor(n) used"));const M=this.x;return this.x=this.y-b,this.y=p+b-M-this.y,this}toCartesianOrigin(p,b){const M=h.QM.Zero();return M.x=p.x+2*this.x*b+this.y*b,M.y=p.y+Math.sqrt(3)*this.y*b,M}static Zero(){return new bp(0,0)}}class Mp{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new hp("icosahedron","Regular",[[0,pp.h,-1],[-pp.h,1,0],[-1,0,-pp.h],[1,0,-pp.h],[pp.h,1,0],[0,pp.h,1],[-1,0,pp.h],[-pp.h,-1,0],[0,-pp.h,-1],[pp.h,-1,0],[1,0,pp.h],[0,-pp.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let p=12;const b={},M=this.m,h=this.n;let Q,mp,y,P,w,t=M,z=1,x=0;0!==h&&(t=(0,V.HighestCommonFactor)(M,h)),z=M/t,x=h/t;const S=bp.Zero(),X=new bp(M,h),c=new bp(-h,M+h),J=bp.Zero(),g=bp.Zero(),f=bp.Zero();let Y,a,o,l,L=[];const u=[],e=this.vertByDist,d=(M,h,Q,mp)=>{Y=M+"|"+Q,a=h+"|"+mp,Y in b||a in b?Y in b&&!(a in b)?b[a]=b[Y]:a in b&&!(Y in b)&&(b[Y]=b[a]):(b[Y]=p,b[a]=p,p++),e[Q][0]>2?u[b[Y]]=[-e[Q][0],e[Q][1],b[Y]]:u[b[Y]]=[L[e[Q][0]],e[Q][1],b[Y]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let I=0;I<20;I++){if(L=this.IDATA.face[I],y=L[2],P=L[1],w=L[0],o=S.x+"|"+S.y,Y=I+"|"+o,Y in b||(b[Y]=y,u[y]=[L[e[o][0]],e[o][1]]),o=X.x+"|"+X.y,Y=I+"|"+o,Y in b||(b[Y]=P,u[P]=[L[e[o][0]],e[o][1]]),o=c.x+"|"+c.y,Y=I+"|"+o,Y in b||(b[Y]=w,u[w]=[L[e[o][0]],e[o][1]]),Q=this.IDATA.edgematch[I][0],mp=this.IDATA.edgematch[I][1],"B"===mp)for(let p=1;p<t;p++)g.x=M-p*(z+x),g.y=h+p*z,f.x=-p*x,f.y=p*(z+x),o=g.x+"|"+g.y,l=f.x+"|"+f.y,d(I,Q,o,l);if("O"===mp)for(let p=1;p<t;p++)f.x=-p*x,f.y=p*(z+x),J.x=p*z,J.y=p*x,o=f.x+"|"+f.y,l=J.x+"|"+J.y,d(I,Q,o,l);if(Q=this.IDATA.edgematch[I][2],mp=this.IDATA.edgematch[I][3],mp&&"A"===mp)for(let p=1;p<t;p++)J.x=p*z,J.y=p*x,g.x=M-(t-p)*(z+x),g.y=h+(t-p)*z,o=J.x+"|"+J.y,l=g.x+"|"+g.y,d(I,Q,o,l);for(let M=0;M<this.vertices.length;M++)o=this.vertices[M].x+"|"+this.vertices[M].y,Y=I+"|"+o,Y in b||(b[Y]=p++,e[o][0]>2?u[b[Y]]=[-e[o][0],e[o][1],b[Y]]:u[b[Y]]=[L[e[o][0]],e[o][1],b[Y]])}this.closestTo=u,this.vecToidx=b}calcCoeffs(){const p=this.m,b=this.n,M=Math.sqrt(3)/3,h=p*p+b*b+p*b;this.coau=(p+b)/h,this.cobu=-b/h,this.coav=-M*(p-b)/h,this.cobv=M*(2*p+b)/h}createInnerFacets(){const p=this.m,b=this.n;for(let M=0;M<b+p+1;M++)for(let p=this.min[M];p<this.max[M]+1;p++)p<this.max[M]&&p<this.max[M+1]+1&&this.innerFacets.push(["|"+p+"|"+M,"|"+p+"|"+(M+1),"|"+(p+1)+"|"+M]),M>0&&p<this.max[M-1]&&p+1<this.max[M]+1&&this.innerFacets.push(["|"+p+"|"+M,"|"+(p+1)+"|"+M,"|"+(p+1)+"|"+(M-1)])}edgeVecsABOB(){const p=this.m,b=this.n,M=new bp(-b,p+b);for(let h=1;h<p+b;h++){const p=new bp(this.min[h],h),b=new bp(this.min[h-1],h-1),Q=new bp(this.min[h+1],h+1),mp=p.clone(),y=b.clone(),P=Q.clone();mp.rotate60About(M),y.rotate60About(M),P.rotate60About(M);const w=new bp(this.max[mp.y],mp.y),t=new bp(this.max[mp.y-1],mp.y-1),z=new bp(this.max[mp.y-1]-1,mp.y-1);mp.x===w.x&&mp.y===w.y||(mp.x!==t.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([p,t,z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([p,z,w])):mp.y===P.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([p,b,t]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([p,t,Q])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([p,b,t]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([p,t,w])))}}mapABOBtoOBOA(){const p=new bp(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const M=[];for(let h=0;h<3;h++)p.x=this.isoVecsABOB[b][h].x,p.y=this.isoVecsABOB[b][h].y,0===this.vertexTypes[b][h]&&p.rotateNeg120(this.m,this.n),M.push(p.clone());this.isoVecsOBOA.push(M)}}mapABOBtoBAOA(){const p=new bp(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const M=[];for(let h=0;h<3;h++)p.x=this.isoVecsABOB[b][h].x,p.y=this.isoVecsABOB[b][h].y,1===this.vertexTypes[b][h]&&p.rotate120(this.m,this.n),M.push(p.clone());this.isoVecsBAOA.push(M)}}MapToFace(p,b){const M=this.IDATA.face[p],Q=M[2],mp=M[1],y=M[0],P=h.QM.tM(this.IDATA.vertex[Q]),w=h.QM.tM(this.IDATA.vertex[mp]),t=h.QM.tM(this.IDATA.vertex[y]),z=w.mh(P),x=t.mh(P),S=z.scale(this.coau).add(x.scale(this.cobu)),X=z.scale(this.coav).add(x.scale(this.cobv)),c=[];let J,g=h.TmpVectors.QM[0];for(let h=0;h<this.cartesian.length;h++)g=S.scale(this.cartesian[h].x).add(X.scale(this.cartesian[h].y)).add(P),c[h]=[g.x,g.y,g.z],J=p+"|"+this.vertices[h].x+"|"+this.vertices[h].y,b.vertex[this.vecToidx[J]]=[g.x,g.y,g.z]}build(p,b){const M=[],h=bp.Zero(),Q=new bp(p,b),mp=new bp(-b,p+b);M.push(h,Q,mp);for(let o=b;o<p+1;o++)for(let b=0;b<p+1-o;b++)M.push(new bp(b,o));if(b>0){const h=(0,V.HighestCommonFactor)(p,b),Q=p/h,mp=b/h;for(let P=1;P<h;P++)M.push(new bp(P*Q,P*mp)),M.push(new bp(-P*mp,P*(Q+mp))),M.push(new bp(p-P*(Q+mp),b+P*Q));const y=p/b;for(let P=1;P<b;P++)for(let h=0;h<P*y;h++)M.push(new bp(h,P)),M.push(new bp(h,P).rotate120(p,b)),M.push(new bp(h,P).rotateNeg120(p,b))}M.sort(((p,b)=>p.x-b.x)),M.sort(((p,b)=>p.y-b.y));const y=new Array(p+b+1),P=new Array(p+b+1);for(let o=0;o<y.length;o++)y[o]=1/0,P[o]=-1/0;let w=0,t=0;const z=M.length;for(let o=0;o<z;o++)t=M[o].x,w=M[o].y,y[w]=Math.min(t,y[w]),P[w]=Math.max(t,P[w]);const x=(M,h)=>{const Q=M.clone();return"A"===h&&Q.rotateNeg120(p,b),"B"===h&&Q.rotate120(p,b),Q.x<0?Q.y:Q.x+Q.y},S=[],X=[],c=[],J=[],g={},f=[];let Y=-1,a=-1;for(let o=0;o<z;o++)S[o]=M[o].toCartesianOrigin(new bp(0,0),.5),X[o]=x(M[o],"O"),c[o]=x(M[o],"A"),J[o]=x(M[o],"B"),X[o]===c[o]&&c[o]===J[o]?(Y=3,a=X[o]):X[o]===c[o]?(Y=4,a=X[o]):c[o]===J[o]?(Y=5,a=c[o]):J[o]===X[o]&&(Y=6,a=X[o]),X[o]<c[o]&&X[o]<J[o]&&(Y=2,a=X[o]),c[o]<X[o]&&c[o]<J[o]&&(Y=1,a=c[o]),J[o]<c[o]&&J[o]<X[o]&&(Y=0,a=J[o]),f.push([Y,a,M[o].x,M[o].y]);f.sort(((p,b)=>p[2]-b[2])),f.sort(((p,b)=>p[3]-b[3])),f.sort(((p,b)=>p[1]-b[1])),f.sort(((p,b)=>p[0]-b[0]));for(let o=0;o<f.length;o++)g[f[o][2]+"|"+f[o][3]]=[f[o][0],f[o][1],o];return this.m=p,this.n=b,this.vertices=M,this.vertByDist=g,this.cartesian=S,this.min=y,this.max=P,this}}class hp{constructor(p,b,M,h){this.name=p,this.category=b,this.vertex=M,this.face=h}}class Qp extends hp{innerToData(p,b){for(let M=0;M<b.innerFacets.length;M++)this.face.push(b.innerFacets[M].map((M=>b.vecToidx[p+M])))}mapABOBtoDATA(p,b){const M=b.IDATA.edgematch[p][0];for(let h=0;h<b.isoVecsABOB.length;h++){const Q=[];for(let mp=0;mp<3;mp++)0===b.vertexTypes[h][mp]?Q.push(p+"|"+b.isoVecsABOB[h][mp].x+"|"+b.isoVecsABOB[h][mp].y):Q.push(M+"|"+b.isoVecsABOB[h][mp].x+"|"+b.isoVecsABOB[h][mp].y);this.face.push([b.vecToidx[Q[0]],b.vecToidx[Q[1]],b.vecToidx[Q[2]]])}}mapOBOAtoDATA(p,b){const M=b.IDATA.edgematch[p][0];for(let h=0;h<b.isoVecsOBOA.length;h++){const Q=[];for(let mp=0;mp<3;mp++)1===b.vertexTypes[h][mp]?Q.push(p+"|"+b.isoVecsOBOA[h][mp].x+"|"+b.isoVecsOBOA[h][mp].y):Q.push(M+"|"+b.isoVecsOBOA[h][mp].x+"|"+b.isoVecsOBOA[h][mp].y);this.face.push([b.vecToidx[Q[0]],b.vecToidx[Q[1]],b.vecToidx[Q[2]]])}}mapBAOAtoDATA(p,b){const M=b.IDATA.edgematch[p][2];for(let h=0;h<b.isoVecsBAOA.length;h++){const Q=[];for(let mp=0;mp<3;mp++)1===b.vertexTypes[h][mp]?Q.push(p+"|"+b.isoVecsBAOA[h][mp].x+"|"+b.isoVecsBAOA[h][mp].y):Q.push(M+"|"+b.isoVecsBAOA[h][mp].x+"|"+b.isoVecsBAOA[h][mp].y);this.face.push([b.vecToidx[Q[0]],b.vecToidx[Q[1]],b.vecToidx[Q[2]]])}}orderData(p){const b=[];for(let mp=0;mp<13;mp++)b[mp]=[];const M=p.closestTo;for(let mp=0;mp<M.length;mp++)M[mp][0]>-1?M[mp][1]>0&&b[M[mp][0]].push([mp,M[mp][1]]):b[12].push([mp,M[mp][0]]);const h=[];for(let mp=0;mp<12;mp++)h[mp]=mp;let Q=12;for(let mp=0;mp<12;mp++){b[mp].sort(((p,b)=>p[1]-b[1]));for(let p=0;p<b[mp].length;p++)h[b[mp][p][0]]=Q++}for(let mp=0;mp<b[12].length;mp++)h[b[12][mp][0]]=Q++;for(let mp=0;mp<this.vertex.length;mp++)this.vertex[mp].push(h[mp]);this.vertex.sort(((p,b)=>p[3]-b[3]));for(let mp=0;mp<this.vertex.length;mp++)this.vertex[mp].pop();for(let mp=0;mp<this.face.length;mp++)for(let p=0;p<this.face[mp].length;p++)this.face[mp][p]=h[this.face[mp][p]];this.sharedNodes=b[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(p,b){const M=[],h=[];let Q=b.pop();h.push(Q);let mp=this.face[Q].indexOf(p);mp=(mp+2)%3;let y=this.face[Q][mp];M.push(y);let P=0;for(;b.length>0;)Q=b[P],this.face[Q].indexOf(y)>-1?(mp=(this.face[Q].indexOf(y)+1)%3,y=this.face[Q][mp],M.push(y),h.push(Q),b.splice(P,1),P=0):P++;return this.adjacentFaces.push(M),h}toGoldbergPolyhedronData(){const p=new hp("GeoDual","Goldberg",[],[]);p.name="GD dual";const b=this.vertex.length,M=new Array(b);for(let w=0;w<b;w++)M[w]=[];for(let w=0;w<this.face.length;w++)for(let p=0;p<3;p++)M[this.face[w][p]].push(w);let h=0,Q=0,mp=0,y=[],P=[];this.adjacentFaces=[];for(let w=0;w<M.length;w++){p.face[w]=this.setOrder(w,M[w].concat([]));for(const b of M[w]){h=0,Q=0,mp=0,y=this.face[b];for(let p=0;p<3;p++)P=this.vertex[y[p]],h+=P[0],Q+=P[1],mp+=P[2];p.vertex[b]=[h/3,Q/3,mp/3]}}return p}static BuildGeodesicData(p){const b=new Qp("Geodesic-m-n","Geodesic",[[0,pp.h,-1],[-pp.h,1,0],[-1,0,-pp.h],[1,0,-pp.h],[pp.h,1,0],[0,pp.h,1],[-1,0,pp.h],[-pp.h,-1,0],[0,-pp.h,-1],[pp.h,-1,0],[1,0,pp.h],[0,-pp.h,1]],[]);p.setIndices(),p.calcCoeffs(),p.createInnerFacets(),p.edgeVecsABOB(),p.mapABOBtoOBOA(),p.mapABOBtoBAOA();for(let M=0;M<p.IDATA.face.length;M++)p.MapToFace(M,b),b.innerToData(M,p),"B"===p.IDATA.edgematch[M][1]&&b.mapABOBtoDATA(M,p),"O"===p.IDATA.edgematch[M][1]&&b.mapOBOAtoDATA(M,p),"A"===p.IDATA.edgematch[M][3]&&b.mapBAOAtoDATA(M,p);b.orderData(p);return b.vertex=b.vertex.map((function(p){const b=p[0],M=p[1],h=p[2],Q=Math.sqrt(b*b+M*M+h*h);return p[0]*=1/Q,p[1]*=1/Q,p[2]*=1/Q,p})),b}}Q.e._GoldbergMeshParser=(p,b)=>mb.Parse(p,b);class mb extends Q.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(p,b){return void 0===b?(p>this.goldbergData.nbUnsharedFaces-1&&(F.d.Warn("Maximum number of unshared faces used"),p=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+p):(p>11&&(F.d.Warn("Last pole used"),p=11),b>this.goldbergData.nbFacesAtPole-1&&(F.d.Warn("Maximum number of faces at a pole used"),b=this.goldbergData.nbFacesAtPole-1),12+p*this.goldbergData.nbFacesAtPole+b)}_changeGoldbergFaceColors(p){for(let M=0;M<p.length;M++){const b=p[M][0],h=p[M][1],Q=p[M][2];for(let p=b;p<h+1;p++)this.goldbergData.faceColors[p]=Q}const b=[];for(let M=0;M<12;M++)for(let p=0;p<5;p++)b.push(this.goldbergData.faceColors[M].r,this.goldbergData.faceColors[M].g,this.goldbergData.faceColors[M].b,this.goldbergData.faceColors[M].a);for(let M=12;M<this.goldbergData.faceColors.length;M++)for(let p=0;p<6;p++)b.push(this.goldbergData.faceColors[M].r,this.goldbergData.faceColors[M].g,this.goldbergData.faceColors[M].b,this.goldbergData.faceColors[M].a);return b}setGoldbergFaceColors(p){const b=this._changeGoldbergFaceColors(p);this.ip(mp.f.ColorKind,b)}updateGoldbergFaceColors(p){const b=this._changeGoldbergFaceColors(p);this.updateVerticesData(mp.f.ColorKind,b)}_changeGoldbergFaceUVs(p){const b=this.getVerticesData(mp.f.UVKind);for(let M=0;M<p.length;M++){const h=p[M][0],Q=p[M][1],mp=p[M][2],y=p[M][3],P=p[M][4],w=[],t=[];let z,x;for(let p=0;p<5;p++)z=mp.x+y*Math.cos(P+p*Math.PI/2.5),x=mp.y+y*Math.sin(P+p*Math.PI/2.5),z<0&&(z=0),z>1&&(z=1),w.push(z,x);for(let p=0;p<6;p++)z=mp.x+y*Math.cos(P+p*Math.PI/3),x=mp.y+y*Math.sin(P+p*Math.PI/3),z<0&&(z=0),z>1&&(z=1),t.push(z,x);for(let p=h;p<Math.min(12,Q+1);p++)for(let M=0;M<5;M++)b[10*p+2*M]=w[2*M],b[10*p+2*M+1]=w[2*M+1];for(let p=Math.max(12,h);p<Q+1;p++)for(let M=0;M<6;M++)b[12*p-24+2*M]=t[2*M],b[12*p-23+2*M]=t[2*M+1]}return b}setGoldbergFaceUVs(p){const b=this._changeGoldbergFaceUVs(p);this.ip(mp.f.UVKind,b)}updateGoldbergFaceUVs(p){const b=this._changeGoldbergFaceUVs(p);this.updateVerticesData(mp.f.UVKind,b)}placeOnGoldbergFaceAt(p,b,M){const Q=h.QM.RotationFromAxis(this.goldbergData.faceXaxis[b],this.goldbergData.faceYaxis[b],this.goldbergData.faceZaxis[b]);p.rotation=Q,p.position=this.goldbergData.faceCenters[b].add(this.goldbergData.faceXaxis[b].scale(M.x)).add(this.goldbergData.faceYaxis[b].scale(M.y)).add(this.goldbergData.faceZaxis[b].scale(M.z))}serialize(p){super.serialize(p),p.type="GoldbergMesh";const b={};if(b.adjacentFaces=this.goldbergData.adjacentFaces,b.nbSharedFaces=this.goldbergData.nbSharedFaces,b.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,b.nbFaces=this.goldbergData.nbFaces,b.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){b.faceColors=[];for(const p of this.goldbergData.faceColors)b.faceColors.push(p.ub())}if(this.goldbergData.faceCenters){b.faceCenters=[];for(const p of this.goldbergData.faceCenters)b.faceCenters.push(p.ub())}if(this.goldbergData.faceZaxis){b.faceZaxis=[];for(const p of this.goldbergData.faceZaxis)b.faceZaxis.push(p.ub())}if(this.goldbergData.faceYaxis){b.faceYaxis=[];for(const p of this.goldbergData.faceYaxis)b.faceYaxis.push(p.ub())}if(this.goldbergData.faceXaxis){b.faceXaxis=[];for(const p of this.goldbergData.faceXaxis)b.faceXaxis.push(p.ub())}p.goldbergData=b}static Parse(p,b){const M=p.goldbergData;M.faceColors=M.faceColors.map((p=>S.Hb.tM(p))),M.faceCenters=M.faceCenters.map((p=>h.QM.tM(p))),M.faceZaxis=M.faceZaxis.map((p=>h.QM.tM(p))),M.faceXaxis=M.faceXaxis.map((p=>h.QM.tM(p))),M.faceYaxis=M.faceYaxis.map((p=>h.QM.tM(p)));const Q=new mb(p.name,b);return Q.goldbergData=M,Q}}var yp=M(13335);const Pp={CreateBox:x.c,CreateTiledBox:g,CreateSphere:f.d,CreateDisc:z.c,CreateIcoSphere:j,CreateRibbon:t,CreateCylinder:l,CreateTorus:u,CreateTorusKnot:d,CreateLineSystem:I.e,Bz:I.i,CreateDashedLines:I.c,ExtrudeShape:Z,ExtrudeShapeCustom:U,CreateLathe:B,CreateTiledPlane:c,Tz:s.d,CreateGround:i.f,CreateTiledGround:i.g,CreateGroundFromHeightMap:i.e,CreatePolygon:G.d,ExtrudePolygon:G.e,CreateTube:T,CreatePolyhedron:H,CreateGeodesic:function(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=b.m||1;h!==Math.floor(h)&&(h=Math.floor(h),F.d.Warn("m not an integer only floor(m) used"));let Q=b.n||0;if(Q!==Math.floor(Q)&&(Q=Math.floor(Q),F.d.Warn("n not an integer only floor(n) used")),Q>h){const p=Q;Q=h,h=p,F.d.Warn("n > m therefore m and n swapped")}const mp=new Mp;return mp.build(h,Q),H(p,{custom:Qp.BuildGeodesicData(mp),size:b.size,sizeX:b.sizeX,sizeY:b.sizeY,sizeZ:b.sizeZ,faceUV:b.faceUV,faceColors:b.faceColors,flat:b.flat,updatable:b.updatable,sideOrientation:b.sideOrientation,frontUVs:b.frontUVs,backUVs:b.backUVs},M)},CreateGoldberg:function(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mp=b.size,w=b.sizeX||mp||1,t=b.sizeY||mp||1,z=b.sizeZ||mp||1;let x=b.m||1;x!==Math.floor(x)&&(x=Math.floor(x),F.d.Warn("m not an integer only floor(m) used"));let X=b.n||0;if(X!==Math.floor(X)&&(X=Math.floor(X),F.d.Warn("n not an integer only floor(n) used")),X>x){const p=X;X=x,x=p,F.d.Warn("n > m therefore m and n swapped")}const c=new Mp;c.build(x,X);const J=Qp.BuildGeodesicData(c),g=J.toGoldbergPolyhedronData(),f=new mb(p,M);b.sideOrientation=Q.e._GetDefaultSideOrientation(b.sideOrientation),f._originalBuilderSideOrientation=b.sideOrientation;(function(p,b){const M=p.size,Q=p.sizeX||M||1,mp=p.sizeY||M||1,w=p.sizeZ||M||1,t=0===p.sideOrientation?0:p.sideOrientation||y.e.DEFAULTSIDE,z=[],x=[],S=[],X=[];let c=1/0,J=-1/0,g=1/0,f=-1/0;for(let h=0;h<b.vertex.length;h++)c=Math.min(c,b.vertex[h][0]*Q),J=Math.max(J,b.vertex[h][0]*Q),g=Math.min(g,b.vertex[h][1]*mp),f=Math.max(f,b.vertex[h][1]*mp);let Y=0;for(let y=0;y<b.face.length;y++){const p=b.face[y],M=h.QM.tM(b.vertex[p[0]]),t=h.QM.tM(b.vertex[p[2]]),a=h.QM.tM(b.vertex[p[1]]),o=t.mh(M),l=a.mh(M),L=h.QM.Cross(l,o).normalize();for(let h=0;h<p.length;h++){S.push(L.x,L.y,L.z);const M=b.vertex[p[h]];z.push(M[0]*Q,M[1]*mp,M[2]*w);const y=(M[1]*mp-g)/(f-g);X.push((M[0]*Q-c)/(J-c),P.c?1-y:y)}for(let b=0;b<p.length-2;b++)x.push(Y,Y+b+2,Y+b+1);Y+=p.length}y.e._ComputeSides(t,z,x,S,X);const a=new y.e;return a.dp=z,a.indices=x,a.Ip=S,a.vp=X,a})(b,g).Up(f,b.updatable),f.goldbergData.nbSharedFaces=J.sharedNodes,f.goldbergData.nbUnsharedFaces=J.poleNodes,f.goldbergData.adjacentFaces=J.adjacentFaces,f.goldbergData.nbFaces=f.goldbergData.nbSharedFaces+f.goldbergData.nbUnsharedFaces,f.goldbergData.nbFacesAtPole=(f.goldbergData.nbUnsharedFaces-12)/12;for(let Q=0;Q<J.vertex.length;Q++)f.goldbergData.faceCenters.push(h.QM.tM(J.vertex[Q])),f.goldbergData.faceCenters[Q].x*=w,f.goldbergData.faceCenters[Q].y*=t,f.goldbergData.faceCenters[Q].z*=z,f.goldbergData.faceColors.push(new S.Hb(1,1,1,1));for(let Q=0;Q<g.face.length;Q++){const p=g.face[Q],b=h.QM.tM(g.vertex[p[0]]),M=h.QM.tM(g.vertex[p[2]]),mp=h.QM.tM(g.vertex[p[1]]),y=M.mh(b),P=mp.mh(b),w=h.QM.Cross(P,y).normalize(),t=h.QM.Cross(P,w).normalize();f.goldbergData.faceXaxis.push(P.normalize()),f.goldbergData.faceYaxis.push(w),f.goldbergData.faceZaxis.push(t)}return f},CreateDecal:A,CreateCapsule:C,CreateText:yp.g}},13915:(p,b,M)=>{"use strict";M.d(b,{b:()=>Pb});var h=M(12777),Q=M(13170);class mp extends Q.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var y=M(12820),P=(M(12935),M(12730));class w{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(p){this._targetStopDuration!==p&&(this._targetStopDuration=p)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(p){this._noiseTexture!==p&&(this._noiseTexture=p,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(p){this._animationSheetEnabled!==p&&(this._animationSheetEnabled=p)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(p){this._isAnimationSheetEnabled!=p&&(this._isAnimationSheetEnabled=p,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(p){this._useLogarithmicDepth=p&&this.upp().getEngine().getCaps().fragmentDepthSupported}upp(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(p){switch(p){case w.BLENDMODE_MULTIPLYADD:return;case w.BLENDMODE_ADD:p=1;break;case w.BLENDMODE_ONEONE:p=6;break;case w.BLENDMODE_STANDARD:p=2;break;case w.BLENDMODE_MULTIPLY:p=4;break;case w.BLENDMODE_SUBTRACT:p=3}this._engine.setAlphaMode(p)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:h.QM.Zero()}set direction1(p){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=p)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:h.QM.Zero()}set direction2(p){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=p)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:h.QM.Zero()}set minEmitBox(p){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=p)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:h.QM.Zero()}set maxEmitBox(p){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=p)}get billboardMode(){return this._billboardMode}set billboardMode(p){this._billboardMode!==p&&(this._billboardMode=p,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(p){this._isBillboardBased!==p&&(this._isBillboardBased=p,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(p){this._attachImageProcessingConfiguration(p)}_attachImageProcessingConfiguration(p){p!==this._imageProcessingConfiguration&&(!p&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=p)}_reset(){}_removeGradientAndTexture(p,b,M){if(!b)return this;let h=0;for(const Q of b){if(Q.gradient===p){b.splice(h,1);break}h++}return M&&M.dispose(),this}constructor(p){this.animations=[],this.renderingGroupId=0,this.hb=h.QM.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new h.QM(10,10,10),this.onAnimationEnd=null,this.blendMode=w.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new h.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Zz=new h.QM(0,0,0),this._useLogarithmicDepth=!1,this.gravity=h.QM.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new y.Hb(1,1,1,1),this.color2=new y.Hb(1,1,1,1),this.colorDead=new y.Hb(0,0,0,1),this.textureMask=new y.Hb(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new mp,this.id=p,this.name=p}createPointEmitter(p,b){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new h.QM(0,1,0),arguments.length>2&&void 0!==arguments[2]||new h.QM(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new h.QM(0,1,0),arguments.length>4&&void 0!==arguments[4]||new h.QM(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new h.QM(0,1,0),arguments.length>3&&void 0!==arguments[3]||new h.QM(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(p,b,M,h){throw new Error("Method not implemented.")}}w.BLENDMODE_ONEONE=0,w.BLENDMODE_STANDARD=1,w.BLENDMODE_ADD=2,w.BLENDMODE_MULTIPLY=3,w.BLENDMODE_MULTIPLYADD=4,w.BLENDMODE_SUBTRACT=-1,(0,P.c)("BABYLON.BaseParticleSystem",w);var t=M(12789),z=M(12624);class x{constructor(){this.direction1=new h.QM(0,1,0),this.direction2=new h.QM(0,1,0),this.minEmitBox=new h.QM(-.5,-.5,-.5),this.maxEmitBox=new h.QM(.5,.5,.5)}startDirectionFunction(p,b,M,Q){const mp=(0,t.RandomRange)(this.direction1.x,this.direction2.x),y=(0,t.RandomRange)(this.direction1.y,this.direction2.y),P=(0,t.RandomRange)(this.direction1.z,this.direction2.z);if(Q)return b.x=mp,b.y=y,void(b.z=P);h.QM.TransformNormalFromFloatsToRef(mp,y,P,p,b)}startPositionFunction(p,b,M,Q){const mp=(0,t.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),y=(0,t.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),P=(0,t.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(Q)return b.x=mp,b.y=y,void(b.z=P);h.QM.TransformCoordinatesFromFloatsToRef(mp,y,P,p,b)}clone(){const p=new x;return z.b.DeepCopy(this,p),p}applyToShader(p){p.setVector3("direction1",this.direction1),p.setVector3("direction2",this.direction2),p.setVector3("minEmitBox",this.minEmitBox),p.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(p){p.addUniform("direction1",3),p.addUniform("direction2",3),p.addUniform("minEmitBox",3),p.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const p={};return p.type=this.getClassName(),p.direction1=this.direction1.ub(),p.direction2=this.direction2.ub(),p.minEmitBox=this.minEmitBox.ub(),p.maxEmitBox=this.maxEmitBox.ub(),p}parse(p){h.QM.FromArrayToRef(p.direction1,0,this.direction1),h.QM.FromArrayToRef(p.direction2,0,this.direction2),h.QM.FromArrayToRef(p.minEmitBox,0,this.minEmitBox),h.QM.FromArrayToRef(p.maxEmitBox,0,this.maxEmitBox)}}class S{get radius(){return this._radius}set radius(p){this._radius=p,this._buildHeight()}get angle(){return this._angle}set angle(p){this._angle=p,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=M,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=b,this.radius=p}startDirectionFunction(p,b,M,Q){Q?h.TmpVectors.QM[0].mp(M.yt).normalize():M.position.subtractToRef(p.getTranslation(),h.TmpVectors.QM[0]).normalize();const mp=(0,t.RandomRange)(0,this.directionRandomizer),y=(0,t.RandomRange)(0,this.directionRandomizer),P=(0,t.RandomRange)(0,this.directionRandomizer);b.x=h.TmpVectors.QM[0].x+mp,b.y=h.TmpVectors.QM[0].y+y,b.z=h.TmpVectors.QM[0].z+P,b.normalize()}startPositionFunction(p,b,M,Q){const mp=(0,t.RandomRange)(0,2*Math.PI);let y;this.emitFromSpawnPointOnly?y=1e-4:(y=(0,t.RandomRange)(0,this.heightRange),y=1-y*y);let P=this._radius-(0,t.RandomRange)(0,this._radius*this.radiusRange);P*=y;const w=P*Math.sin(mp),z=P*Math.cos(mp),x=y*this._height;if(Q)return b.x=w,b.y=x,void(b.z=z);h.QM.TransformCoordinatesFromFloatsToRef(w,x,z,p,b)}clone(){const p=new S(this._radius,this._angle,this.directionRandomizer);return z.b.DeepCopy(this,p),p}applyToShader(p){p.setFloat2("radius",this._radius,this.radiusRange),p.setFloat("coneAngle",this._angle),p.setFloat2("height",this._height,this.heightRange),p.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(p){p.addUniform("radius",2),p.addUniform("coneAngle",1),p.addUniform("height",2),p.addUniform("directionRandomizer",1)}getEffectDefines(){let p="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(p+="\n#define CONEEMITTERSPAWNPOINT"),p}getClassName(){return"ConeParticleEmitter"}serialize(){const p={};return p.type=this.getClassName(),p.radius=this._radius,p.angle=this._angle,p.directionRandomizer=this.directionRandomizer,p.radiusRange=this.radiusRange,p.heightRange=this.heightRange,p.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,p}parse(p){this.radius=p.radius,this.angle=p.angle,this.directionRandomizer=p.directionRandomizer,this.radiusRange=void 0!==p.radiusRange?p.radiusRange:1,this.heightRange=void 0!==p.radiusRange?p.heightRange:1,this.emitFromSpawnPointOnly=void 0!==p.emitFromSpawnPointOnly&&p.emitFromSpawnPointOnly}}class X extends S{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.QM(0,1,0),Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.QM(0,1,0);super(p,b),this.direction1=M,this.direction2=Q}startDirectionFunction(p,b){const M=(0,t.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,t.RandomRange)(this.direction1.y,this.direction2.y),mp=(0,t.RandomRange)(this.direction1.z,this.direction2.z);h.QM.TransformNormalFromFloatsToRef(M,Q,mp,p,b)}clone(){const p=new X(this.radius,this.angle,this.direction1,this.direction2);return z.b.DeepCopy(this,p),p}applyToShader(p){p.setFloat("radius",this.radius),p.setFloat("radiusRange",this.radiusRange),p.setVector3("direction1",this.direction1),p.setVector3("direction2",this.direction2)}buildUniformLayout(p){p.addUniform("radius",1),p.addUniform("radiusRange",1),p.addUniform("direction1",3),p.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const p=super.serialize();return p.direction1=this.direction1.ub(),p.direction2=this.direction2.ub(),p}parse(p){super.parse(p),this.direction1.mp(p.direction1),this.direction2.mp(p.direction2)}}class c{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=p,this.height=b,this.radiusRange=M,this.directionRandomizer=Q,this._tempVector=h.QM.Zero()}startDirectionFunction(p,b,M,Q,mp){M.position.subtractToRef(p.getTranslation(),this._tempVector),this._tempVector.normalize(),h.QM.TransformNormalToRef(this._tempVector,mp,this._tempVector);const y=(0,t.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let P=Math.atan2(this._tempVector.x,this._tempVector.z);P+=(0,t.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=y,this._tempVector.x=Math.sin(P),this._tempVector.z=Math.cos(P),this._tempVector.normalize(),Q?b.mp(this._tempVector):h.QM.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,p,b)}startPositionFunction(p,b,M,Q){const mp=(0,t.RandomRange)(-this.height/2,this.height/2),y=(0,t.RandomRange)(0,2*Math.PI),P=(0,t.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),w=Math.sqrt(P)*this.radius,z=w*Math.cos(y),x=w*Math.sin(y);Q?b.sb(z,mp,x):h.QM.TransformCoordinatesFromFloatsToRef(z,mp,x,p,b)}clone(){const p=new c(this.radius,this.directionRandomizer);return z.b.DeepCopy(this,p),p}applyToShader(p){p.setFloat("radius",this.radius),p.setFloat("height",this.height),p.setFloat("radiusRange",this.radiusRange),p.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(p){p.addUniform("radius",1),p.addUniform("height",1),p.addUniform("radiusRange",1),p.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const p={};return p.type=this.getClassName(),p.radius=this.radius,p.height=this.height,p.radiusRange=this.radiusRange,p.directionRandomizer=this.directionRandomizer,p}parse(p){this.radius=p.radius,this.height=p.height,this.radiusRange=p.radiusRange,this.directionRandomizer=p.directionRandomizer}}class J extends c{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.QM(0,1,0),mp=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new h.QM(0,1,0);super(p,b,M),this.direction1=Q,this.direction2=mp}startDirectionFunction(p,b,M,Q){const mp=(0,t.RandomRange)(this.direction1.x,this.direction2.x),y=(0,t.RandomRange)(this.direction1.y,this.direction2.y),P=(0,t.RandomRange)(this.direction1.z,this.direction2.z);Q?b.sb(mp,y,P):h.QM.TransformNormalFromFloatsToRef(mp,y,P,p,b)}clone(){const p=new J(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return z.b.DeepCopy(this,p),p}applyToShader(p){p.setFloat("radius",this.radius),p.setFloat("height",this.height),p.setFloat("radiusRange",this.radiusRange),p.setVector3("direction1",this.direction1),p.setVector3("direction2",this.direction2)}buildUniformLayout(p){p.addUniform("radius",1),p.addUniform("height",1),p.addUniform("radiusRange",1),p.addUniform("direction1",3),p.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const p=super.serialize();return p.direction1=this.direction1.ub(),p.direction2=this.direction2.ub(),p}parse(p){super.parse(p),h.QM.FromArrayToRef(p.direction1,0,this.direction1),h.QM.FromArrayToRef(p.direction2,0,this.direction2)}}class g{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=p,this.radiusRange=b,this.directionRandomizer=M}startDirectionFunction(p,b,M,Q){const mp=M.position.mh(p.getTranslation()).normalize(),y=(0,t.RandomRange)(0,this.directionRandomizer),P=(0,t.RandomRange)(0,this.directionRandomizer),w=(0,t.RandomRange)(0,this.directionRandomizer);mp.x+=y,mp.y+=P,mp.z+=w,mp.normalize(),Q?b.mp(mp):h.QM.TransformNormalFromFloatsToRef(mp.x,mp.y,mp.z,p,b)}startPositionFunction(p,b,M,Q){const mp=this.radius-(0,t.RandomRange)(0,this.radius*this.radiusRange),y=(0,t.RandomRange)(0,1),P=(0,t.RandomRange)(0,2*Math.PI),w=Math.acos(2*y-1),z=mp*Math.cos(P)*Math.sin(w),x=mp*Math.cos(w),S=mp*Math.sin(P)*Math.sin(w);Q?b.sb(z,Math.abs(x),S):h.QM.TransformCoordinatesFromFloatsToRef(z,Math.abs(x),S,p,b)}clone(){const p=new g(this.radius,this.directionRandomizer);return z.b.DeepCopy(this,p),p}applyToShader(p){p.setFloat("radius",this.radius),p.setFloat("radiusRange",this.radiusRange),p.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(p){p.addUniform("radius",1),p.addUniform("radiusRange",1),p.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const p={};return p.type=this.getClassName(),p.radius=this.radius,p.radiusRange=this.radiusRange,p.directionRandomizer=this.directionRandomizer,p}parse(p){this.radius=p.radius,this.radiusRange=p.radiusRange,this.directionRandomizer=p.directionRandomizer}}class f{constructor(){this.direction1=new h.QM(0,1,0),this.direction2=new h.QM(0,1,0)}startDirectionFunction(p,b,M,Q){const mp=(0,t.RandomRange)(this.direction1.x,this.direction2.x),y=(0,t.RandomRange)(this.direction1.y,this.direction2.y),P=(0,t.RandomRange)(this.direction1.z,this.direction2.z);Q?b.sb(mp,y,P):h.QM.TransformNormalFromFloatsToRef(mp,y,P,p,b)}startPositionFunction(p,b,M,Q){Q?b.sb(0,0,0):h.QM.TransformCoordinatesFromFloatsToRef(0,0,0,p,b)}clone(){const p=new f;return z.b.DeepCopy(this,p),p}applyToShader(p){p.setVector3("direction1",this.direction1),p.setVector3("direction2",this.direction2)}buildUniformLayout(p){p.addUniform("direction1",3),p.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const p={};return p.type=this.getClassName(),p.direction1=this.direction1.ub(),p.direction2=this.direction2.ub(),p}parse(p){h.QM.FromArrayToRef(p.direction1,0,this.direction1),h.QM.FromArrayToRef(p.direction2,0,this.direction2)}}class Y{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=p,this.radiusRange=b,this.directionRandomizer=M}startDirectionFunction(p,b,M,Q){const mp=M.position.mh(p.getTranslation()).normalize(),y=(0,t.RandomRange)(0,this.directionRandomizer),P=(0,t.RandomRange)(0,this.directionRandomizer),w=(0,t.RandomRange)(0,this.directionRandomizer);mp.x+=y,mp.y+=P,mp.z+=w,mp.normalize(),Q?b.mp(mp):h.QM.TransformNormalFromFloatsToRef(mp.x,mp.y,mp.z,p,b)}startPositionFunction(p,b,M,Q){const mp=this.radius-(0,t.RandomRange)(0,this.radius*this.radiusRange),y=(0,t.RandomRange)(0,1),P=(0,t.RandomRange)(0,2*Math.PI),w=Math.acos(2*y-1),z=mp*Math.cos(P)*Math.sin(w),x=mp*Math.cos(w),S=mp*Math.sin(P)*Math.sin(w);Q?b.sb(z,x,S):h.QM.TransformCoordinatesFromFloatsToRef(z,x,S,p,b)}clone(){const p=new Y(this.radius,this.directionRandomizer);return z.b.DeepCopy(this,p),p}applyToShader(p){p.setFloat("radius",this.radius),p.setFloat("radiusRange",this.radiusRange),p.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(p){p.addUniform("radius",1),p.addUniform("radiusRange",1),p.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const p={};return p.type=this.getClassName(),p.radius=this.radius,p.radiusRange=this.radiusRange,p.directionRandomizer=this.directionRandomizer,p}parse(p){this.radius=p.radius,this.radiusRange=p.radiusRange,this.directionRandomizer=p.directionRandomizer}}class a extends Y{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.QM(0,1,0),M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.QM(0,1,0);super(p),this.direction1=b,this.direction2=M}startDirectionFunction(p,b){const M=(0,t.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,t.RandomRange)(this.direction1.y,this.direction2.y),mp=(0,t.RandomRange)(this.direction1.z,this.direction2.z);h.QM.TransformNormalFromFloatsToRef(M,Q,mp,p,b)}clone(){const p=new a(this.radius,this.direction1,this.direction2);return z.b.DeepCopy(this,p),p}applyToShader(p){p.setFloat("radius",this.radius),p.setFloat("radiusRange",this.radiusRange),p.setVector3("direction1",this.direction1),p.setVector3("direction2",this.direction2)}buildUniformLayout(p){p.addUniform("radius",1),p.addUniform("radiusRange",1),p.addUniform("direction1",3),p.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const p=super.serialize();return p.direction1=this.direction1.ub(),p.direction2=this.direction2.ub(),p}parse(p){super.parse(p),this.direction1.mp(p.direction1),this.direction2.mp(p.direction2)}}class o{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(p,b,M,Q){const mp=h.TmpVectors.QM[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,M,mp);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,M,mp);const p=h.TmpVectors.QM[1];mp.subtractToRef(M.position,p),p.scaleToRef(1/M.lifeTime,mp)}else mp.set(0,0,0);Q?b.mp(mp):h.QM.TransformNormalToRef(mp,p,b)}startPositionFunction(p,b,M,Q){const mp=h.TmpVectors.QM[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,M,mp):mp.set(0,0,0),Q?b.mp(mp):h.QM.TransformCoordinatesToRef(mp,p,b)}clone(){const p=new o;return z.b.DeepCopy(this,p),p}applyToShader(p){}buildUniformLayout(p){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const p={};return p.type=this.getClassName(),p.particlePositionGenerator=this.particlePositionGenerator,p.particleDestinationGenerator=this.particleDestinationGenerator,p}parse(p){p.particlePositionGenerator&&(this.particlePositionGenerator=p.particlePositionGenerator),p.particleDestinationGenerator&&(this.particleDestinationGenerator=p.particleDestinationGenerator)}}var l=M(12847);class L{get mesh(){return this._mesh}set mesh(p){this._mesh!==p&&(this._mesh=p,p?(this._indices=p.qb(),this._positions=p.getVerticesData(l.f.PositionKind),this._normals=p.getVerticesData(l.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=h.QM.Zero(),this._mesh=null,this.direction1=new h.QM(0,1,0),this.direction2=new h.QM(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=p}startDirectionFunction(p,b,M,Q){if(this.useMeshNormalsForDirection&&this._normals)return void h.QM.TransformNormalToRef(this._storedNormal,p,b);const mp=(0,t.RandomRange)(this.direction1.x,this.direction2.x),y=(0,t.RandomRange)(this.direction1.y,this.direction2.y),P=(0,t.RandomRange)(this.direction1.z,this.direction2.z);Q?b.sb(mp,y,P):h.QM.TransformNormalFromFloatsToRef(mp,y,P,p,b)}startPositionFunction(p,b,M,Q){if(!this._indices||!this._positions)return;const mp=3*(Math.random()*(this._indices.length/3)|0),y=Math.random(),P=Math.random()*(1-y),w=1-y-P,t=this._indices[mp],z=this._indices[mp+1],x=this._indices[mp+2],S=h.TmpVectors.QM[0],X=h.TmpVectors.QM[1],c=h.TmpVectors.QM[2],J=h.TmpVectors.QM[3];h.QM.FromArrayToRef(this._positions,3*t,S),h.QM.FromArrayToRef(this._positions,3*z,X),h.QM.FromArrayToRef(this._positions,3*x,c),J.x=y*S.x+P*X.x+w*c.x,J.y=y*S.y+P*X.y+w*c.y,J.z=y*S.z+P*X.z+w*c.z,Q?b.sb(J.x,J.y,J.z):h.QM.TransformCoordinatesFromFloatsToRef(J.x,J.y,J.z,p,b),this.useMeshNormalsForDirection&&this._normals&&(h.QM.FromArrayToRef(this._normals,3*t,S),h.QM.FromArrayToRef(this._normals,3*z,X),h.QM.FromArrayToRef(this._normals,3*x,c),this._storedNormal.x=y*S.x+P*X.x+w*c.x,this._storedNormal.y=y*S.y+P*X.y+w*c.y,this._storedNormal.z=y*S.z+P*X.z+w*c.z)}clone(){const p=new L(this.mesh);return z.b.DeepCopy(this,p),p}applyToShader(p){p.setVector3("direction1",this.direction1),p.setVector3("direction2",this.direction2)}buildUniformLayout(p){p.addUniform("direction1",3),p.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var p;const b={};return b.type=this.getClassName(),b.direction1=this.direction1.ub(),b.direction2=this.direction2.ub(),b.meshId=null===(p=this.mesh)||void 0===p?void 0:p.id,b.useMeshNormalsForDirection=this.useMeshNormalsForDirection,b}parse(p,b){h.QM.FromArrayToRef(p.direction1,0,this.direction1),h.QM.FromArrayToRef(p.direction2,0,this.direction2),p.meshId&&b&&(this.mesh=b.getLastMeshById(p.meshId)),this.useMeshNormalsForDirection=p.useMeshNormalsForDirection}}class u{_isUbo(p){return void 0!==p.addUniform}constructor(p){this._isUbo(p)?(this.setMatrix3x3=p.updateMatrix3x3.bind(p),this.setMatrix2x2=p.updateMatrix2x2.bind(p),this.setFloat=p.updateFloat.bind(p),this.setFloat2=p.updateFloat2.bind(p),this.setFloat3=p.updateFloat3.bind(p),this.setFloat4=p.updateFloat4.bind(p),this.setFloatArray=p.updateFloatArray.bind(p),this.setArray=p.updateArray.bind(p),this.setIntArray=p.updateIntArray.bind(p),this.setMatrix=p.Gb.bind(p),this.setMatrices=p.updateMatrices.bind(p),this.setVector3=p.updateVector3.bind(p),this.setVector4=p.updateVector4.bind(p),this.setColor3=p.updateColor3.bind(p),this.setColor4=p.updateColor4.bind(p),this.setDirectColor4=p.updateDirectColor4.bind(p),this.setInt=p.updateInt.bind(p),this.setInt2=p.updateInt2.bind(p),this.setInt3=p.updateInt3.bind(p),this.setInt4=p.updateInt4.bind(p)):(this.setMatrix3x3=p.setMatrix3x3.bind(p),this.setMatrix2x2=p.setMatrix2x2.bind(p),this.setFloat=p.setFloat.bind(p),this.setFloat2=p.setFloat2.bind(p),this.setFloat3=p.setFloat3.bind(p),this.setFloat4=p.setFloat4.bind(p),this.setFloatArray=p.setFloatArray.bind(p),this.setArray=p.setArray.bind(p),this.setIntArray=p.setIntArray.bind(p),this.setMatrix=p.setMatrix.bind(p),this.setMatrices=p.setMatrices.bind(p),this.setVector3=p.setVector3.bind(p),this.setVector4=p.setVector4.bind(p),this.setColor3=p.setColor3.bind(p),this.setColor4=p.setColor4.bind(p),this.setDirectColor4=p.setDirectColor4.bind(p),this.setInt=p.setInt.bind(p),this.setInt2=p.setInt2.bind(p),this.setInt3=p.setInt3.bind(p),this.setInt4=p.setInt4.bind(p))}}var e=M(12695);const d="gpuUpdateParticlesPixelShader",I="#version 300 es\nvoid main() {discard;}\n";e.d.ShadersStore[d]||(e.d.ShadersStore[d]=I);const G="gpuUpdateParticlesVertexShader",v="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";e.d.ShadersStore[G]||(e.d.ShadersStore[G]=v);(0,P.c)("BABYLON.WebGL2ParticleSystem",class{constructor(p,b){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=p,this._engine=b,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var p;return(null===(p=this._updateEffect)||void 0===p?void 0:p.isReady())??!1}createUpdateBuffer(p){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof o&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=p,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new u(this._updateEffect)}createVertexBuffers(p,b){this._updateVAO.push(this._createUpdateVAO(p)),this._renderVAO.push(this._engine.recordVertexArrayObject(b,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=b}createParticleBuffer(p){return p}bindDrawBuffers(p,b,M){M?this._engine.bindBuffers(this._renderVertexBuffers,M,b):this._engine.bindVertexArrayObject(this._renderVAO[p],null)}preUpdateParticleBuffer(){const p=this._engine;if(this._engine.enableEffect(this._updateEffect),!p.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(p,b,M){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[p],null);const h=this._engine;h.bindTransformFeedbackBuffer(b.getBuffer()),h.setRasterizerState(!1),h.beginTransformFeedback(!0),h.drawArraysType(3,0,M),h.endTransformFeedback(),h.setRasterizerState(!0),h.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let p=0;p<this._updateVAO.length;p++)this._engine.releaseVertexArrayObject(this._updateVAO[p]);this._updateVAO.length=0;for(let p=0;p<this._renderVAO.length;p++)this._engine.releaseVertexArrayObject(this._renderVAO[p]);this._renderVAO.length=0}_createUpdateVAO(p){const b={};b.position=p.createVertexBuffer("position",0,3);let M=3;b.age=p.createVertexBuffer("age",M,1),M+=1,b.size=p.createVertexBuffer("size",M,3),M+=3,b.life=p.createVertexBuffer("life",M,1),M+=1,b.seed=p.createVertexBuffer("seed",M,4),M+=4,b.direction=p.createVertexBuffer("direction",M,3),M+=3,this._parent.particleEmitterType instanceof o&&(b.initialPosition=p.createVertexBuffer("initialPosition",M,3),M+=3),this._parent._colorGradientsTexture||(b.color=p.createVertexBuffer("color",M,4),M+=4),this._parent._isBillboardBased||(b.initialDirection=p.createVertexBuffer("initialDirection",M,3),M+=3),this._parent.noiseTexture&&(b.noiseCoordinates1=p.createVertexBuffer("noiseCoordinates1",M,3),M+=3,b.noiseCoordinates2=p.createVertexBuffer("noiseCoordinates2",M,3),M+=3),this._parent._angularSpeedGradientsTexture?(b.angle=p.createVertexBuffer("angle",M,1),M+=1):(b.angle=p.createVertexBuffer("angle",M,2),M+=2),this._parent._isAnimationSheetEnabled&&(b.cellIndex=p.createVertexBuffer("cellIndex",M,1),M+=1,this._parent.spriteRandomStartCell&&(b.cellStartOffset=p.createVertexBuffer("cellStartOffset",M,1),M+=1));const h=this._engine.recordVertexArrayObject(b,null,this._updateEffect);return this._engine.bindArrayBuffer(null),h}});class Z{constructor(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,h=arguments.length>3?arguments[3]:void 0;this._engine=p,this._label=h,this._engine._storageBuffers.push(this),this._create(b,M)}_create(p,b){this._bufferSize=p,this._creationFlags=b,this._buffer=this._engine.createStorageBuffer(p,b,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(p,b,M){this._buffer&&this._engine.updateStorageBuffer(this._buffer,p,b,M)}async read(p,b,M,h){return await this._engine.readFromStorageBuffer(this._buffer,p,b,M,h)}dispose(){const p=this._engine._storageBuffers,b=p.indexOf(this);-1!==b&&(p[b]=p[p.length-1],p.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var U=M(12757),q=M(12764),B=M(12812),s=M(12753),i=M(13075),T=M(12622),W=M(12714),H=M(12989);class E{constructor(){this._gpuTimeInFrameId=-1,this.counter=new H.b}_addDuration(p,b){p<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==p?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(b,!1),this._gpuTimeInFrameId=p):this.counter.addCount(b,!1))}}var j=M(12680);class V{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=p,this._engine=b,this.uniqueId=i.e.UniqueId,b.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new E),this._engine.getCaps().supportComputeShaders?h.bindingsMapping?(this._context=b.createComputeContext(),this._shaderPath=M,this._options={bindingsMapping:{},defines:[],...h}):T.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):T.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(p,b){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const h=this._bindings[p];this._bindings[p]={type:M?0:4,object:b,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!h||h.object!==b||h.type!==this._bindings[p].type)}setStorageTexture(p,b){const M=this._bindings[p];this._contextIsDirty||(this._contextIsDirty=!M||M.object!==b),this._bindings[p]={type:1,object:b,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries}}setExternalTexture(p,b){const M=this._bindings[p];this._contextIsDirty||(this._contextIsDirty=!M||M.object!==b),this._bindings[p]={type:6,object:b,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries}}setVideoTexture(p,b){return!!b.externalTexture&&(this.setExternalTexture(p,b.externalTexture),!0)}setUniformBuffer(p,b){const M=this._bindings[p];this._contextIsDirty||(this._contextIsDirty=!M||M.object!==b),this._bindings[p]={type:V._BufferIsDataBuffer(b)?7:2,object:b,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries}}setStorageBuffer(p,b){const M=this._bindings[p];this._contextIsDirty||(this._contextIsDirty=!M||M.object!==b),this._bindings[p]={type:V._BufferIsDataBuffer(b)?7:3,object:b,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries}}setTextureSampler(p,b){const M=this._bindings[p];this._contextIsDirty||(this._contextIsDirty=!M||!b.compareSampler(M.object)),this._bindings[p]={type:5,object:b,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries}}isReady(){let p=this._effect;for(const Q in this._bindings){const p=this._bindings[Q],b=p.type,M=p.object;switch(b){case 0:case 4:case 1:if(!M.isReady())return!1;break;case 6:if(!M.isReady())return!1;break}}const b=[],M=this._shaderPath;if(this._options.defines)for(let Q=0;Q<this._options.defines.length;Q++)b.push(this._options.defines[Q]);const h=b.join("\n");return this._cachedDefines!==h&&(this._cachedDefines=h,p=this._engine.createComputeEffect(M,{defines:h,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=p),!!p.isReady()}dispatch(p,b,M){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,p,b,M,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const M=V._BufferIsDataBuffer(p)?p:p.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,M,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const b in this._bindings){const M=this._bindings[b];if(!this._options.bindingsMapping[b])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+b+"'");switch(M.type){case 0:{const h=this._samplers[b],Q=M.object;var p;if(!h||!Q._texture||!h.compareSampler(Q._texture))this._samplers[b]=(new W.e).setParameters(Q.wrapU,Q.wrapV,Q.wrapR,Q.anisotropicFilteringLevel,Q._texture.samplingMode,null===(p=Q._texture)||void 0===p?void 0:p._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const p=M.object;p.getBuffer()!==M.buffer&&(M.buffer=p.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((Q=>{(0,j.g)((()=>this.dispatch(p,b,M)),Q,void 0,h)}))}serialize(){const p=B.e.Serialize(this);p.options=this._options,p.shaderPath=this._shaderPath,p.UX={},p.textures={};for(const b in this._bindings){const M=this._bindings[b],h=M.object;switch(M.type){case 0:case 4:case 1:{const Q=h.serialize();Q&&(p.textures[b]=Q,p.UX[b]={type:M.type});break}}}return p}static Parse(p,b,M){const h=B.e.Parse((()=>new V(p.name,b.getEngine(),p.shaderPath,p.options)),p,b,M);for(const Q in p.textures){const mp=p.UX[Q],y=s.c.Parse(p.textures[Q],b,M);0===mp.type?h.setTexture(Q,y):4===mp.type?h.setTexture(Q,y,!1):h.setStorageTexture(Q,y)}return h}static _BufferIsDataBuffer(p){return void 0!==p.underlyingResource}}(0,U.e)([(0,q.N)()],V.prototype,"name",void 0),(0,U.e)([(0,q.N)()],V.prototype,"fastMode",void 0),(0,P.c)("BABYLON.ComputeShader",V);var D=M(13035);const N="gpuUpdateParticlesComputeShader",O="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";e.d.ShadersStoreWGSL[N]||(e.d.ShadersStoreWGSL[N]=O);(0,P.c)("BABYLON.ComputeShaderParticleSystem",class{constructor(p,b){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=p,this._engine=b}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var p;return(null===(p=this._updateComputeShader)||void 0===p?void 0:p.isReady())??!1}createUpdateBuffer(p){var b;const M={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(M.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(M.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(M.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(M.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(M.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(M.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(M.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new V("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:M,defines:p.split("\n")}),null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=new D.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new u(this._simParamsComputeShader)}createVertexBuffers(p,b){this._renderVertexBuffers.push(b)}createParticleBuffer(p){const b=new Z(this._engine,4*p.length,11,"ComputeShaderParticleSystemBuffer");return b.update(p),this._bufferComputeShader.push(b),b.getBuffer()}bindDrawBuffers(p,b,M){this._engine.bindBuffers(this._renderVertexBuffers[p],M,b)}preUpdateParticleBuffer(){}updateParticleBuffer(p,b,M){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[p]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^p]),this._updateComputeShader.dispatch(Math.ceil(M/64))}releaseBuffers(){var p;for(let b=0;b<this._bufferComputeShader.length;++b)this._bufferComputeShader[b].dispose();this._bufferComputeShader.length=0,null===(p=this._simParamsComputeShader)||void 0===p||p.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class R{constructor(p,b,M){this.gradient=p,this.color1=b,this.color2=M}getColorToRef(p){this.color2?y.Hb.LerpToRef(this.color1,this.color2,Math.random(),p):p.mp(this.color1)}}class K{constructor(p,b){this.gradient=p,this.color=b}}class r{constructor(p,b,M){this.gradient=p,this.factor1=b,this.factor2=M}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class k{static GetCurrentGradient(p,b,M){if(b[0].gradient>p)return void M(b[0],b[0],1);for(let Q=0;Q<b.length-1;Q++){const h=b[Q],mp=b[Q+1];if(p>=h.gradient&&p<=mp.gradient){return void M(h,mp,(p-h.gradient)/(mp.gradient-h.gradient))}}const h=b.length-1;M(b[h],b[h],1)}}var A=M(12617),n=M(13251),C=M(12652);class F{constructor(p){this.particleSystem=p,this.position=h.QM.Zero(),this.direction=h.QM.Zero(),this.color=new y.Hb(0,0,0,0),this.colorStep=new y.Hb(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new h.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new y.Hb(0,0,0,0),this._currentColor2=new y.Hb(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=F._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let p=this.age,b=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===b?(b=1,p=this._randomCellOffset):p+=this._randomCellOffset);const M=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let h;h=this._initialSpriteCellLoop?(0,t.Clamp)(p*b%this.lifeTime/this.lifeTime):(0,t.Clamp)(p*b/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+h*M|0}_inheritParticleInfoToSubEmitter(p){if(p.particleSystem.hb.position){const b=p.particleSystem.hb;if(b.position.mp(this.position),p.inheritDirection){const p=h.TmpVectors.QM[0];this.direction.normalizeToRef(p),b.setDirection(p,0,Math.PI/2)}}else{p.particleSystem.hb.mp(this.position)}this.direction.scaleToRef(p.inheritedVelocityAmount/2,h.TmpVectors.QM[0]),p.particleSystem._inheritedVelocityOffset.mp(h.TmpVectors.QM[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const p of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(p)}_reset(){this.age=0,this.id=F._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(p){p.position.mp(this.position),this._initialDirection?p._initialDirection?p._initialDirection.mp(this._initialDirection):p._initialDirection=this._initialDirection.clone():p._initialDirection=null,p.direction.mp(this.direction),this.yt&&(p.yt?p.yt.mp(this.yt):p.yt=this.yt.clone()),p.color.mp(this.color),p.colorStep.mp(this.colorStep),p.lifeTime=this.lifeTime,p.age=this.age,p._randomCellOffset=this._randomCellOffset,p.size=this.size,p.scale.mp(this.scale),p.angle=this.angle,p.angularSpeed=this.angularSpeed,p.particleSystem=this.particleSystem,p.cellIndex=this.cellIndex,p.id=this.id,p._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(p._currentColorGradient=this._currentColorGradient,p._currentColor1.mp(this._currentColor1),p._currentColor2.mp(this._currentColor2)),this._currentSizeGradient&&(p._currentSizeGradient=this._currentSizeGradient,p._currentSize1=this._currentSize1,p._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(p._currentAngularSpeedGradient=this._currentAngularSpeedGradient,p._currentAngularSpeed1=this._currentAngularSpeed1,p._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(p._currentVelocityGradient=this._currentVelocityGradient,p._currentVelocity1=this._currentVelocity1,p._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(p._currentLimitVelocityGradient=this._currentLimitVelocityGradient,p._currentLimitVelocity1=this._currentLimitVelocity1,p._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(p._currentDragGradient=this._currentDragGradient,p._currentDrag1=this._currentDrag1,p._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(p._initialStartSpriteCellId=this._initialStartSpriteCellId,p._initialEndSpriteCellId=this._initialEndSpriteCellId,p._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(p.remapData&&this.remapData?p.remapData.mp(this.remapData):p.remapData=new h.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(p._randomNoiseCoordinates1?(p._randomNoiseCoordinates1.mp(this._randomNoiseCoordinates1),p._randomNoiseCoordinates2.mp(this._randomNoiseCoordinates2)):(p._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),p._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}F._Count=0;var pp=M(12888),bp=(M(12933),M(13147)),Mp=M(13143),hp=M(13032);function Qp(p,b){const M=(0,t.RandomRange)(0,1);y.Hb.LerpToRef(b.color1,b.color2,M,p.color),b.colorDead.subtractToRef(p.color,b._colorDiff),b._colorDiff.scaleToRef(1/p.lifeTime,p.colorStep)}function mb(p,b){p._currentColorGradient=b._colorGradients[0],p._currentColorGradient.getColorToRef(p.color),p._currentColor1.mp(p.color),b._colorGradients.length>1?b._colorGradients[1].getColorToRef(p._currentColor2):p._currentColor2.mp(p.color)}function yp(p,b){const M=b._colorGradients;k.GetCurrentGradient(b._ratio,M,((b,M,h)=>{b!==p._currentColorGradient&&(p._currentColor1.mp(p._currentColor2),M.getColorToRef(p._currentColor2),p._currentColorGradient=b),y.Hb.LerpToRef(p._currentColor1,p._currentColor2,h,p.color)}))}function Pp(p,b){p.colorStep.scaleToRef(b._scaledUpdateSpeed,b._scaledColorStep),p.color.addInPlace(b._scaledColorStep),p.color.a<0&&(p.color.a=0)}function wp(p,b){k.GetCurrentGradient(b._ratio,b._angularSpeedGradients,((b,M,h)=>{b!==p._currentAngularSpeedGradient&&(p._currentAngularSpeed1=p._currentAngularSpeed2,p._currentAngularSpeed2=M.getFactor(),p._currentAngularSpeedGradient=b),p.angularSpeed=(0,t.Lerp)(p._currentAngularSpeed1,p._currentAngularSpeed2,h)}))}function tp(p,b){p.angle+=p.angularSpeed*b._scaledUpdateSpeed}function zp(p,b){b.particleEmitterType.startDirectionFunction(b._emitterWorldMatrix,p.direction,p,b.isLocal,b._emitterInverseWorldMatrix)}function xp(p,b){b.startDirectionFunction(b._emitterWorldMatrix,p.direction,p,b.isLocal)}function Sp(p,b){p._currentVelocityGradient=b._velocityGradients[0],p._currentVelocity1=p._currentVelocityGradient.getFactor(),b._velocityGradients.length>1?p._currentVelocity2=b._velocityGradients[1].getFactor():p._currentVelocity2=p._currentVelocity1}function Xp(p,b){p._currentLimitVelocityGradient=b._limitVelocityGradients[0],p._currentLimitVelocity1=p._currentLimitVelocityGradient.getFactor(),b._limitVelocityGradients.length>1?p._currentLimitVelocity2=b._limitVelocityGradients[1].getFactor():p._currentLimitVelocity2=p._currentLimitVelocity1}function cp(p,b){k.GetCurrentGradient(b._ratio,b._velocityGradients,((M,h,Q)=>{M!==p._currentVelocityGradient&&(p._currentVelocity1=p._currentVelocity2,p._currentVelocity2=h.getFactor(),p._currentVelocityGradient=M),b._directionScale*=(0,t.Lerp)(p._currentVelocity1,p._currentVelocity2,Q)}))}function Jp(p,b){k.GetCurrentGradient(b._ratio,b._limitVelocityGradients,((M,h,Q)=>{M!==p._currentLimitVelocityGradient&&(p._currentLimitVelocity1=p._currentLimitVelocity2,p._currentLimitVelocity2=h.getFactor(),p._currentLimitVelocityGradient=M);const mp=(0,t.Lerp)(p._currentLimitVelocity1,p._currentLimitVelocity2,Q);p.direction.length()>mp&&p.direction.scaleInPlace(b.limitVelocityDamping)}))}function gp(p,b){p.direction.scaleToRef(b._directionScale,b._scaledDirection)}function fp(p,b){b.particleEmitterType.startPositionFunction(b._emitterWorldMatrix,p.position,p,b.isLocal)}function Yp(p,b){b.startPositionFunction(b._emitterWorldMatrix,p.position,p,b.isLocal)}function ap(p,b){p.yt?p.yt.mp(p.position):p.yt=p.position.clone(),h.QM.TransformCoordinatesToRef(p.yt,b._emitterWorldMatrix,p.position)}function op(p,b){b.isLocal&&p.yt?(p.yt.addInPlace(b._scaledDirection),h.QM.TransformCoordinatesToRef(p.yt,b._emitterWorldMatrix,p.position)):p.position.addInPlace(b._scaledDirection)}function lp(p,b){p._currentDragGradient=b._dragGradients[0],p._currentDrag1=p._currentDragGradient.getFactor(),b._dragGradients.length>1?p._currentDrag2=b._dragGradients[1].getFactor():p._currentDrag2=p._currentDrag1}function Lp(p,b){k.GetCurrentGradient(b._ratio,b._dragGradients,((M,h,Q)=>{M!==p._currentDragGradient&&(p._currentDrag1=p._currentDrag2,p._currentDrag2=h.getFactor(),p._currentDragGradient=M);const mp=(0,t.Lerp)(p._currentDrag1,p._currentDrag2,Q);b._scaledDirection.scaleInPlace(1-mp)}))}function upp(p,b){p._randomNoiseCoordinates1?(p._randomNoiseCoordinates1.sb(Math.random(),Math.random(),Math.random()),p._randomNoiseCoordinates2.sb(Math.random(),Math.random(),Math.random())):(p._randomNoiseCoordinates1=new h.QM(Math.random(),Math.random(),Math.random()),p._randomNoiseCoordinates2=new h.QM(Math.random(),Math.random(),Math.random()))}function ep(p,b){const M=b._noiseTextureData,Q=b._noiseTextureSize;if(M&&Q&&p._randomNoiseCoordinates1){const mp=b._fetchR(p._randomNoiseCoordinates1.x,p._randomNoiseCoordinates1.y,Q.width,Q.height,M),y=b._fetchR(p._randomNoiseCoordinates1.z,p._randomNoiseCoordinates2.x,Q.width,Q.height,M),P=b._fetchR(p._randomNoiseCoordinates2.y,p._randomNoiseCoordinates2.z,Q.width,Q.height,M),w=h.TmpVectors.QM[0],t=h.TmpVectors.QM[1];w.sb((2*mp-1)*b.noiseStrength.x,(2*y-1)*b.noiseStrength.y,(2*P-1)*b.noiseStrength.z),w.scaleToRef(b._tempScaledUpdateSpeed,t),p.direction.addInPlace(t)}}function dp(p,b){b.gravity.scaleToRef(b._tempScaledUpdateSpeed,b._scaledGravity),p.direction.addInPlace(b._scaledGravity)}function Ip(p,b){p.size=(0,t.RandomRange)(b.minSize,b.maxSize),p.scale.sb((0,t.RandomRange)(b.minScaleX,b.maxScaleX),(0,t.RandomRange)(b.minScaleY,b.maxScaleY))}function Gp(p,b){p._currentSizeGradient=b._sizeGradients[0],p._currentSize1=p._currentSizeGradient.getFactor(),p.size=p._currentSize1,b._sizeGradients.length>1?p._currentSize2=b._sizeGradients[1].getFactor():p._currentSize2=p._currentSize1,p.scale.sb((0,t.RandomRange)(b.minScaleX,b.maxScaleX),(0,t.RandomRange)(b.minScaleY,b.maxScaleY))}function vp(p,b){const M=b._actualFrame/b.targetStopDuration;k.GetCurrentGradient(M,b._startSizeGradients,((M,h,Q)=>{M!==b._currentStartSizeGradient&&(b._currentStartSize1=b._currentStartSize2,b._currentStartSize2=h.getFactor(),b._currentStartSizeGradient=M);const mp=(0,t.Lerp)(b._currentStartSize1,b._currentStartSize2,Q);p.scale.scaleInPlace(mp)}))}function Zp(p,b){k.GetCurrentGradient(b._ratio,b._sizeGradients,((b,M,h)=>{b!==p._currentSizeGradient&&(p._currentSize1=p._currentSize2,p._currentSize2=M.getFactor(),p._currentSizeGradient=b),p.size=(0,t.Lerp)(p._currentSize1,p._currentSize2,h)}))}function Up(p,b){p.remapData=new h.Vector4(0,1,0,1)}function qp(p,b){b._colorRemapGradients&&b._colorRemapGradients.length>0&&k.GetCurrentGradient(b._ratio,b._colorRemapGradients,((b,M,h)=>{const Q=(0,t.Lerp)(b.factor1,M.factor1,h),mp=(0,t.Lerp)(b.factor2,M.factor2,h);p.remapData.x=Q,p.remapData.y=mp-Q})),b._alphaRemapGradients&&b._alphaRemapGradients.length>0&&k.GetCurrentGradient(b._ratio,b._alphaRemapGradients,((b,M,h)=>{const Q=(0,t.Lerp)(b.factor1,M.factor1,h),mp=(0,t.Lerp)(b.factor2,M.factor2,h);p.remapData.z=Q,p.remapData.w=mp-Q}))}function Bp(p,b){const M=(0,t.Clamp)(b._actualFrame/b.targetStopDuration);k.GetCurrentGradient(M,b._lifeTimeGradients,((b,h)=>{const Q=b,mp=h,y=Q.getFactor(),P=mp.getFactor(),w=(M-Q.gradient)/(mp.gradient-Q.gradient);p.lifeTime=(0,t.Lerp)(y,P,w)})),b._emitPower=(0,t.RandomRange)(b.minEmitPower,b.maxEmitPower)}function sp(p,b){p.lifeTime=(0,t.RandomRange)(b.minLifeTime,b.maxLifeTime),b._emitPower=(0,t.RandomRange)(b.minEmitPower,b.maxEmitPower)}function ip(p,b){0===b._emitPower?(p._initialDirection?p._initialDirection.mp(p.direction):p._initialDirection=p.direction.clone(),p.direction.set(0,0,0)):(p._initialDirection=null,p.direction.scaleInPlace(b._emitPower)),p.direction.addInPlace(b._inheritedVelocityOffset)}function Tp(p,b){p.angularSpeed=(0,t.RandomRange)(b.minAngularSpeed,b.maxAngularSpeed),p.angle=(0,t.RandomRange)(b.minInitialRotation,b.maxInitialRotation)}function Wp(p,b){p._currentAngularSpeedGradient=b._angularSpeedGradients[0],p.angularSpeed=p._currentAngularSpeedGradient.getFactor(),p._currentAngularSpeed1=p.angularSpeed,b._angularSpeedGradients.length>1?p._currentAngularSpeed2=b._angularSpeedGradients[1].getFactor():p._currentAngularSpeed2=p._currentAngularSpeed1,p.angle=(0,t.RandomRange)(b.minInitialRotation,b.maxInitialRotation)}function Hp(p,b){p._initialStartSpriteCellId=b.startSpriteCellID,p._initialEndSpriteCellId=b.endSpriteCellID,p._initialSpriteCellLoop=b.spriteCellLoop}function Ep(p,b){p.previousItem=b.previousItem,p.nextItem=b,b.previousItem&&(b.previousItem.nextItem=p),b.previousItem=p}function jp(p,b){p.previousItem=b,p.nextItem=b.nextItem,b.nextItem&&(b.nextItem.previousItem=p),b.nextItem=p}function Vp(p,b){let M=b;for(;M.nextItem;)M=M.nextItem;p.previousItem=M,p.nextItem=M.nextItem,M.nextItem=p}function Dp(p){p.previousItem&&(p.previousItem.nextItem=p.nextItem),p.nextItem&&(p.nextItem.previousItem=p.previousItem)}class Np extends w{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(p){this._startDirectionFunction!==p&&(this._startDirectionFunction=p,this._directionProcessing.process=p?xp:zp)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(p){this._startPositionFunction!==p&&(this._startPositionFunction=p,this._positionCreation.process=p?Yp:fp)}set onDispose(p){this._onDisposeObserver&&this.Xb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xb.add(p)}get S(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(p){this._useRampGradients!==p&&(this._useRampGradients=p,this._resetEffect(),p?(this._rampCreation={process:Up,previousItem:null,nextItem:null},jp(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:qp,previousItem:null,nextItem:null},jp(this._remapGradientProcessing,this._gravityProcessing)):(Dp(this._rampCreation),Dp(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(p){this._isLocal!==p&&(this._isLocal=p,p?(this._isLocalCreation={process:ap,previousItem:null,nextItem:null},jp(this._isLocalCreation,this._positionCreation)):Dp(this._isLocalCreation))}get particles(){return this.eX}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(p){this._animationSheetEnabled!==p&&(this._animationSheetEnabled=p,p?(this._sheetCreation={process:Hp,previousItem:null,nextItem:null},jp(this._sheetCreation,this._colorCreation)):Dp(this._sheetCreation),this._reset())}getActiveCount(){return this.eX.length}getClassName(){return"Ob"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var p;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(p=this._customWrappers[b])||void 0===p?void 0:p.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[p]??this._customWrappers[0]}setCustomEffect(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new pp.c(this._engine),this._customWrappers[b].effect=p,this._customWrappers[b].drawContext&&(this._customWrappers[b].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new A.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(p){if(this.noiseTexture!==p){if(this._noiseTexture=p,!p)return Dp(this._noiseCreation),void Dp(this._noiseProcessing);this._noiseCreation={process:upp,previousItem:null,nextItem:null},jp(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:ep,previousItem:null,nextItem:null},jp(this._noiseProcessing,this._positionProcessing)}}constructor(p,b,M){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,mp=arguments.length>4&&void 0!==arguments[4]&&arguments[4],P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(p),this._emitterInverseWorldMatrix=h.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new h.QM,this.Xb=new A.d,this.onStoppedObservable=new A.d,this.onStartedObservable=new A.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.eX=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new y.Hb(0,0,0,0),this._colorDiff=new y.Hb(0,0,0,0),this._scaledDirection=h.QM.Zero(),this._scaledGravity=h.QM.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=p=>{},this.recycleParticle=p=>{const b=this.eX.pop();b!==p&&b.copyTo(p),this._stockParticles.push(b)},this._createParticle=()=>{let p;return 0!==this._stockParticles.length?(p=this._stockParticles.pop(),p._reset()):p=new F(this),this._prepareParticle(p),p},this.paused=!1,this._shadersLoaded=!1,this._capacity=b,this._epsilon=P,M&&"Scene"!==M.getClassName()?(this._engine=M,this.defaultProjectionMatrix=h.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=M||C.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.LX.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:sp,previousItem:null,nextItem:null},this._positionCreation={process:fp,previousItem:null,nextItem:null},jp(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:zp,previousItem:null,nextItem:null},jp(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:ip,previousItem:null,nextItem:null},jp(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Ip,previousItem:null,nextItem:null},jp(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Tp,previousItem:null,nextItem:null},jp(this._angleCreation,this._sizeCreation),this._colorCreation={process:Qp,previousItem:null,nextItem:null},jp(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,w||(this._colorProcessing={process:Pp,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:tp,previousItem:null,nextItem:null},jp(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:gp,previousItem:null,nextItem:null},jp(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:op,previousItem:null,nextItem:null},jp(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:dp,previousItem:null,nextItem:null},jp(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=mp,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new pp.c(this._engine)},this._customWrappers[0].effect=Q,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new x,this.updateFunction=p=>{var b;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(b=this.noiseTexture.getContent())||void 0===b||b.then((p=>{this._noiseTextureData=p})));const M=p===this.eX;for(let h=0;h<p.length;h++){const b=p[h];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const Q=b.age;if(b.age+=this._tempScaledUpdateSpeed,b.age>b.lifeTime){const p=b.age-Q,M=b.lifeTime-Q;this._tempScaledUpdateSpeed=M*this._tempScaledUpdateSpeed/p,b.age=b.lifeTime}this._ratio=b.age/b.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let mp=this._updateQueueStart;for(;mp;)mp.process(b,this),mp=mp.nextItem;if(this._isAnimationSheetEnabled&&!w&&b.updateCellIndex(),b._inheritParticleInfoToSubEmitters(),b.age>=b.lifeTime){if(this._emitFromParticle(b),b._attachedSubEmitters){for(const p of b._attachedSubEmitters)p.particleSystem.disposeOnStop=!0,p.particleSystem.stop();b._attachedSubEmitters=null}this.recycleParticle(b),M&&h--}else;}}}serialize(p){throw new Error("Method not implemented.")}clone(p,b){throw new Error("Method not implemented.")}_addFactorGradient(p,b,M,h){const Q=new r(b,M,h);p.push(Q),p.sort(((p,b)=>p.gradient<b.gradient?-1:p.gradient>b.gradient?1:0))}_removeFactorGradient(p,b){if(!p)return;let M=0;for(const h of p){if(h.gradient===b){p.splice(M,1);break}M++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Bp:this._lifeTimeCreation.process=sp}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:vp,previousItem:null,nextItem:null},jp(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Dp(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(p){this.targetStopDuration!==p&&(this._targetStopDuration=p,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(p,b,M){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,p,b,M),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(p){return this._removeFactorGradient(this._lifeTimeGradients,p),this._syncLifeTimeCreation(),this}addSizeGradient(p,b,M){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Gp,this._sizeGradientProcessing={process:Zp,previousItem:null,nextItem:null},Ep(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,p,b,M),this}removeSizeGradient(p){var b;return this._removeFactorGradient(this._sizeGradients,p),0===(null===(b=this._sizeGradients)||void 0===b?void 0:b.length)&&(Dp(this._sizeGradientProcessing),this._sizeCreation.process=Ip),this}addColorRemapGradient(p,b,M){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,p,b,M),this}removeColorRemapGradient(p){return this._removeFactorGradient(this._colorRemapGradients,p),this}addAlphaRemapGradient(p,b,M){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,p,b,M),this}removeAlphaRemapGradient(p){return this._removeFactorGradient(this._alphaRemapGradients,p),this}addAngularSpeedGradient(p,b,M){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Wp,this._angularSpeedGradientProcessing={process:wp,previousItem:null,nextItem:null},Ep(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,p,b,M),this}removeAngularSpeedGradient(p){var b;return this._removeFactorGradient(this._angularSpeedGradients,p),0===(null===(b=this._angularSpeedGradients)||void 0===b?void 0:b.length)&&(this._angleCreation.process=Tp,Dp(this._angularSpeedGradientProcessing)),this}addVelocityGradient(p,b,M){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Sp,previousItem:null,nextItem:null},jp(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:cp,previousItem:null,nextItem:null},Ep(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,p,b,M),this}removeVelocityGradient(p){var b;return this._removeFactorGradient(this._velocityGradients,p),0===(null===(b=this._velocityGradients)||void 0===b?void 0:b.length)&&(Dp(this._velocityCreation),Dp(this._velocityGradientProcessing)),this}addLimitVelocityGradient(p,b,M){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Xp,previousItem:null,nextItem:null},jp(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Jp,previousItem:null,nextItem:null},jp(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,p,b,M),this}removeLimitVelocityGradient(p){var b;return this._removeFactorGradient(this._limitVelocityGradients,p),0===(null===(b=this._limitVelocityGradients)||void 0===b?void 0:b.length)&&(Dp(this._limitVelocityCreation),Dp(this._limitVelocityGradientProcessing)),this}addDragGradient(p,b,M){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:lp,previousItem:null,nextItem:null},Ep(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Lp,previousItem:null,nextItem:null},Ep(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,p,b,M),this}removeDragGradient(p){var b;return this._removeFactorGradient(this._dragGradients,p),0===(null===(b=this._dragGradients)||void 0===b?void 0:b.length)&&(Dp(this._dragCreation),Dp(this._dragGradientProcessing)),this}addEmitRateGradient(p,b,M){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,p,b,M),this}removeEmitRateGradient(p){return this._removeFactorGradient(this._emitRateGradients,p),this}addStartSizeGradient(p,b,M){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,p,b,M),this._syncStartSizeCreation(),this}removeStartSizeGradient(p){return this._removeFactorGradient(this._startSizeGradients,p),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const p=new Uint8Array(4*this._rawTextureWidth),b=y.TmpColors.wM[0];for(let M=0;M<this._rawTextureWidth;M++){const h=M/this._rawTextureWidth;k.GetCurrentGradient(h,this._rampGradients,((h,Q,mp)=>{y.wM.LerpToRef(h.color,Q.color,mp,b),p[4*M]=255*b.r,p[4*M+1]=255*b.g,p[4*M+2]=255*b.b,p[4*M+3]=255}))}this._rampGradientsTexture=n.c.CreateRGBATexture(p,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((p,b)=>p.gradient<b.gradient?-1:p.gradient>b.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(p,b){this._rampGradients||(this._rampGradients=[]);const M=new K(p,b);return this._rampGradients.push(M),this._syncRampGradientTexture(),this}removeRampGradient(p){return this._removeGradientAndTexture(p,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(p,b,M){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=mb,this._colorProcessing.process=yp);const h=new R(p,b,M);return this._colorGradients.push(h),this._colorGradients.sort(((p,b)=>p.gradient<b.gradient?-1:p.gradient>b.gradient?1:0)),this}removeColorGradient(p){if(!this._colorGradients)return this;let b=0;for(const M of this._colorGradients){if(M.gradient===p){this._colorGradients.splice(b,1);break}b++}return 0===this._colorGradients.length&&(this._colorCreation.process=Qp,this._colorProcessing.process=Pp),this}resetDrawCache(){if(this._drawWrappers){for(const p of this._drawWrappers)if(p)for(const b of p)null===b||void 0===b||b.dispose();this._drawWrappers=[]}}_fetchR(p,b,M,h,Q){return Q[4*(((p=.5*Math.abs(p)+.5)*M%M|0)+((b=.5*Math.abs(b)+.5)*h%h|0)*M)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const p=this._engine,b=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*b),this._vertexBuffer=new l.d(p,this._vertexData,!0,b);let M=0;const h=this._vertexBuffer.createVertexBuffer(l.f.PositionKind,M,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[l.f.PositionKind]=h,M+=3;const Q=this._vertexBuffer.createVertexBuffer(l.f.ColorKind,M,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[l.f.ColorKind]=Q,M+=4;const mp=this._vertexBuffer.createVertexBuffer("angle",M,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=mp,M+=1;const y=this._vertexBuffer.createVertexBuffer("size",M,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=y,M+=2,this._isAnimationSheetEnabled){const p=this._vertexBuffer.createVertexBuffer("cellIndex",M,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=p,M+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const p=this._vertexBuffer.createVertexBuffer("direction",M,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=p,M+=3}if(this._useRampGradients){const p=this._vertexBuffer.createVertexBuffer("remapData",M,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=p,M+=4}let P;if(this._useInstancing){const b=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new l.d(p,b,!1,2),P=this._spriteBuffer.createVertexBuffer("offset",0,2)}else P=this._vertexBuffer.createVertexBuffer("offset",M,2,this._vertexBufferSize,this._useInstancing),M+=2;this._vertexBuffers.offset=P,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const p=[],b=[];let M=0;for(let h=0;h<this._capacity;h++)p.push(M),p.push(M+1),p.push(M+2),p.push(M),p.push(M+2),p.push(M+3),b.push(M,M+1,M+1,M+2,M+2,M+3,M+3,M,M,M+3),M+=4;this._indexBuffer=this._engine.createIndexBuffer(p),this._linesIndexBuffer=this._engine.createIndexBuffer(b)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(p)setTimeout((()=>{this.start(0)}),p);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var b;-1!==(null===(b=this.hb)||void 0===b?void 0:b.getClassName().indexOf("Mesh"))&&this.hb.Zb(!0);const p=this.noiseTexture;if(p&&p.onGeneratedObservable)p.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),p.render()}))}));else for(let b=0;b<this.preWarmCycles;b++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(p))}_postStop(p){}reset(){this._stockParticles.length=0,this.eX.length=0}_appendParticleVertex(p,b,M,Q){let mp=p*this._vertexBufferSize;if(this._vertexData[mp++]=b.position.x+this.Zz.x,this._vertexData[mp++]=b.position.y+this.Zz.y,this._vertexData[mp++]=b.position.z+this.Zz.z,this._vertexData[mp++]=b.color.r,this._vertexData[mp++]=b.color.g,this._vertexData[mp++]=b.color.b,this._vertexData[mp++]=b.color.a,this._vertexData[mp++]=b.angle,this._vertexData[mp++]=b.scale.x*b.size,this._vertexData[mp++]=b.scale.y*b.size,this._isAnimationSheetEnabled&&(this._vertexData[mp++]=b.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[mp++]=b.direction.x,this._vertexData[mp++]=b.direction.y,this._vertexData[mp++]=b.direction.z);else if(b._initialDirection){let p=b._initialDirection;this.isLocal&&(h.QM.TransformNormalToRef(p,this._emitterWorldMatrix,h.TmpVectors.QM[0]),p=h.TmpVectors.QM[0]),0===p.x&&0===p.z&&(p.x=.001),this._vertexData[mp++]=p.x,this._vertexData[mp++]=p.y,this._vertexData[mp++]=p.z}else{let p=b.direction;this.isLocal&&(h.QM.TransformNormalToRef(p,this._emitterWorldMatrix,h.TmpVectors.QM[0]),p=h.TmpVectors.QM[0]),0===p.x&&0===p.z&&(p.x=.001),this._vertexData[mp++]=p.x,this._vertexData[mp++]=p.y,this._vertexData[mp++]=p.z}this._useRampGradients&&b.remapData&&(this._vertexData[mp++]=b.remapData.x,this._vertexData[mp++]=b.remapData.y,this._vertexData[mp++]=b.remapData.z,this._vertexData[mp++]=b.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===M?M=this._epsilon:1===M&&(M=1-this._epsilon),0===Q?Q=this._epsilon:1===Q&&(Q=1-this._epsilon)),this._vertexData[mp++]=M,this._vertexData[mp++]=Q)}_prepareParticle(p){}_createNewOnes(p){let b;for(let M=0;M<p&&this.eX.length!==this._capacity;M++){b=this._createParticle(),this.eX.push(b);let p=this._createQueueStart;for(;p;)p.process(b,this),p=p.nextItem;b._inheritParticleInfoToSubEmitters()}}_update(p){if(this._alive=this.eX.length>0,this.hb.position){const p=this.hb;this._emitterWorldMatrix=p.getWorldMatrix()}else{const p=this.hb;this._emitterWorldMatrix=h.Matrix.Translation(p.x,p.y,p.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.eX),this._createNewOnes(p)}static _GetAttributeNamesOrOptions(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h=[l.f.PositionKind,l.f.ColorKind,"angle","offset","size"];return p&&h.push("cellIndex"),b||h.push("direction"),M&&h.push("remapData"),h}static _GetEffectCreationOptions(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,bp.e)(h),p&&h.push("particlesInfos"),b&&h.push("logarithmicDepthConstant"),M&&(h.push("vFogInfos"),h.push("vFogColor")),h}fillDefines(p,b){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bp.o)(this,this._scene,p),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&p.push("#define FOG")),this._isAnimationSheetEnabled&&p.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&p.push("#define LOGARITHMICDEPTH"),b===w.BLENDMODE_MULTIPLY&&p.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&p.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(p.push("#define BILLBOARD"),this.billboardMode){case 2:p.push("#define BILLBOARDY");break;case 8:case 9:p.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&p.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:p.push("#define BILLBOARDMODE_ALL")}M&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),p.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(p,b,M){b.push(...Np._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),p.push(...Np._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),M.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,hp.f)(p,this._imageProcessingConfigurationDefines),(0,hp.c)(M,this._imageProcessingConfigurationDefines))}_getWrapper(p){const b=this._getCustomDrawWrapper(p);if(null!==b&&void 0!==b&&b.effect)return b;const M=[];this.fillDefines(M,p);const h=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let Q=this._drawWrappers[h];Q||(Q=this._drawWrappers[h]=[]);let mp=Q[p];mp||(mp=new pp.c(this._engine),mp.drawContext&&(mp.drawContext.useInstancing=this._useInstancing),Q[p]=mp);const y=M.join("\n");if(mp.defines!==y){const p=[],b=[],M=[];this.fillUniformsAttributesAndSamplerNames(b,p,M),mp.setEffect(this._engine.createEffect("particles",p,b,M,y,void 0,void 0,void 0,void 0,this._shaderLanguage),y)}return mp}animate(){var p;let b,M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!M&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(M?this.preWarmStepOffset:(null===(p=this._scene)||void 0===p?void 0:p.getAnimationRatio())||1),this.manualEmitCount>-1)b=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let p=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const b=this._actualFrame/this.targetStopDuration;k.GetCurrentGradient(b,this._emitRateGradients,((b,M,h)=>{b!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=M.getFactor(),this._currentEmitRateGradient=b),p=(0,t.Lerp)(this._currentEmitRate1,this._currentEmitRate2,h)}))}b=p*this._scaledUpdateSpeed|0,this._newPartsExcess+=p*this._scaledUpdateSpeed-b}if(this._newPartsExcess>1&&(b+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?b=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(b),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!M){let p=0;for(let b=0;b<this.eX.length;b++){const M=this.eX[b];this._appendParticleVertices(p,M),p+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.eX.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(p,b){this._appendParticleVertex(p++,b,0,0),this._useInstancing||(this._appendParticleVertex(p++,b,1,0),this._appendParticleVertex(p++,b,1,1),this._appendParticleVertex(p++,b,0,1))}rebuild(){var p;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(p=this._spriteBuffer)||void 0===p||p._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Np.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(M.bind(M,14084)),Promise.resolve().then(M.bind(M,14026))])):await Promise.all([Promise.resolve().then(M.bind(M,14022)),Promise.resolve().then(M.bind(M,14013))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.hb||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==w.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(w.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(w.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(p){const b=this._getWrapper(p),M=b.effect,Q=this._engine;Q.enableEffect(b);const mp=this.defaultViewMatrix??this._scene.getViewMatrix();if(M.setTexture("diffuseSampler",this.particleTexture),M.setMatrix("view",mp),M.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const p=this.particleTexture.getBaseSize();M.setFloat3("particlesInfos",this.spriteCellWidth/p.width,this.spriteCellHeight/p.height,this.spriteCellWidth/p.width)}if(M.setVector2("translationPivot",this.translationPivot),M.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const p=this._scene.activeCamera;M.setVector3("eyePosition",p.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),M.setTexture("rampSampler",this._rampGradientsTexture));const y=M.defines;var P,w,t,z,x,S;(this._scene&&((0,bp.i)(M,this,this._scene),this.applyFog&&(0,Mp.g)(this._scene,void 0,M)),y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(mp.invertToRef(h.TmpVectors.Matrix[0]),M.setMatrix("invView",h.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?Q.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,M):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,M)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?Q.bindBuffers(this._vertexBuffers,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBuffer:this._indexBuffer,M):Q.bindBuffers(this._vertexBuffers,null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._linesIndexBufferUseInstancing:null,M);(this.useLogarithmicDepth&&this._scene&&(0,Mp.n)(y,M,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(M),this._setEngineBasedOnBlendMode(p),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(M),this._useInstancing)?null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?Q.drawElementsType(6,0,10,this.eX.length):Q.drawArraysType(7,0,4,this.eX.length):null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?Q.drawElementsType(1,0,10*this.eX.length):Q.drawElementsType(0,0,6*this.eX.length);return this.eX.length}render(){if(!this.isReady()||!this.eX.length)return 0;const p=this._engine;p.setState&&(p.setState(!1),this.forceDepthWrite&&p.setDepthWrite(!0));let b=0;return b=this.blendMode===w.BLENDMODE_MULTIPLYADD?this._render(w.BLENDMODE_MULTIPLY)+this._render(w.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),b}_onDispose(){}dispose(){let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),p&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),p&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(b,M),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const p=this._scene.LX.indexOf(this);p>-1&&this._scene.LX.splice(p,1),this._scene._activeParticleSystems.dispose()}this.Xb.notifyObservers(this),this.Xb.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Np.ForceGLSL=!1;var Op,Rp=M(12635);!function(p){p[p.ATTACHED=0]="ATTACHED",p[p.END=1]="END"}(Op||(Op={}));class Kp{constructor(p){if(this.particleSystem=p,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!p.hb||!p.hb.dispose){const b=(0,P.b)("BABYLON.AbstractMesh");p.hb=new b("SubemitterSystemEmitter",p.upp()),p._disposeEmitterOnDispose=!0}}clone(){let p=this.particleSystem.hb;if(p){if(p instanceof h.QM)p=p.clone();else if(-1!==p.getClassName().indexOf("Mesh")){p=new((0,P.b)("BABYLON.Mesh"))("",p.upp()),p.isVisible=!1}}else p=new h.QM;const b=new Kp(this.particleSystem.clone(this.particleSystem.name,p));return b.particleSystem.name+="Clone",b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem._disposeEmitterOnDispose=!0,b.particleSystem.disposeOnStop=!0,b}serialize(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem=this.particleSystem.serialize(p),b}static _ParseParticleSystem(p,b,M){throw(0,Rp.b)("ParseParticle")}static Parse(p,b,M){const h=p.particleSystem,Q=new Kp(Kp._ParseParticleSystem(h,b,M,!0));return Q.type=p.type,Q.inheritDirection=p.inheritDirection,Q.inheritedVelocityAmount=p.inheritedVelocityAmount,Q.particleSystem._isSubEmitter=!0,Q}dispose(){this.particleSystem.dispose()}}var rp=M(12682);function kp(p,b){const M=new f;return M.direction1=p,M.direction2=b,M}function Ap(){return new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function np(){return new Y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Cp(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.QM(0,1,0),M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.QM(0,1,0);return new a(p,b,M)}function Fp(){return new c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function pb(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.QM(0,1,0),mp=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new h.QM(0,1,0);return new J(p,b,M,Q,mp)}function bb(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new S(p,b)}function Mb(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.QM(0,1,0),Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.QM(0,1,0);return new X(p,b,M,Q)}const hb=h.QM.Zero(),Qb=h.QM.Zero(),mM=h.QM.Zero();class yb{constructor(){this.strength=0,this.position=h.QM.Zero()}_processParticle(p,b){this.position.subtractToRef(p.position,hb);const M=hb.lengthSquared()+1;hb.normalize().scaleToRef(this.strength/M,Qb),Qb.scaleToRef(b._tempScaledUpdateSpeed,mM),p.direction.addInPlace(mM)}serialize(){return{position:this.position.ub(),strength:this.strength}}}class Pb extends Np{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=p=>{if(!this._subEmitters||0===this._subEmitters.length)return;const b=Math.floor(Math.random()*this._subEmitters.length);for(const M of this._subEmitters[b])if(1===M.type){const b=M.clone();p._inheritParticleInfoToSubEmitter(b),b.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(b.particleSystem),b.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(p,b){const M=kp(p,b);return this.particleEmitterType=M,M}get flowMap(){return this._flowMap}set flowMap(p){this._flowMap!==p&&(this._flowMap=p,this._flowMapUpdate&&(Dp(this._flowMapUpdate),this._flowMapUpdate=null),p&&(this._flowMapUpdate={process:p=>{var b;const M=null===(b=this.upp())||void 0===b?void 0:b.getTransformMatrix();this._flowMap._processParticle(p,this.flowMapStrength*this._tempScaledUpdateSpeed,M)},previousItem:null,nextItem:null},jp(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(p){this._attractors.push(p),1===this._attractors.length&&(this._attractorUpdate={process:p=>{for(const b of this._attractors)b._processParticle(p,this)},previousItem:null,nextItem:null},jp(this._attractorUpdate,this._directionProcessing))}removeAttractor(p){const b=this._attractors.indexOf(p);-1!==b&&this._attractors.splice(b,1),0===this._attractors.length&&Dp(this._attractorUpdate)}start(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(p)}createHemisphericEmitter(){const p=Ap(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=p,p}createSphereEmitter(){const p=np(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=p,p}createDirectedSphereEmitter(){const p=Cp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.QM(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.QM(0,1,0));return this.particleEmitterType=p,p}createCylinderEmitter(){const p=Fp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=p,p}createDirectedCylinderEmitter(){const p=pb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.QM(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new h.QM(0,1,0));return this.particleEmitterType=p,p}createConeEmitter(){const p=bb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=p,p}createDirectedConeEmitter(){const p=Mb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.QM(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.QM(0,1,0));return this.particleEmitterType=p,p}createBoxEmitter(p,b,M,h){const Q=new x;return this.particleEmitterType=Q,this.direction1=p,this.direction2=b,this.minEmitBox=M,this.maxEmitBox=h,Q}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const p of this.subEmitters)p instanceof Pb?this._subEmitters.push([new Kp(p)]):p instanceof Kp?this._subEmitters.push([p]):p instanceof Array&&this._subEmitters.push(p)}_stopSubEmitters(){if(this.activeSubSystems){for(const p of this.activeSubSystems)p.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const p=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==p&&this._rootParticleSystem.activeSubSystems.splice(p,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(p){p&&this._stopSubEmitters()}_prepareParticle(p){if(this._subEmitters&&this._subEmitters.length>0){const b=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];p._attachedSubEmitters=[];for(const M of b)if(0===M.type){const b=M.clone();p._attachedSubEmitters.push(b),b.particleSystem.start()}}}_onDispose(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),p&&this.particles)for(const M of this.particles)if(M._attachedSubEmitters)for(let p=M._attachedSubEmitters.length-1;p>=0;p-=1)M._attachedSubEmitters[p].dispose();if(b&&this.activeSubSystems)for(let M=this.activeSubSystems.length-1;M>=0;M-=1)this.activeSubSystems[M].dispose();if(this._subEmitters&&this._subEmitters.length){for(let p=0;p<this._subEmitters.length;p++)for(const b of this._subEmitters[p])b.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.hb&&this.hb.dispose&&this.hb.dispose(!0)}static _Parse(p,b,M,Q){let mp;mp=M instanceof rp.b?null:M;const w=(0,P.b)("BABYLON.Texture");if(w&&mp&&(p.texture?b.particleTexture=w.Parse(p.texture,mp,Q):p.textureName&&(b.particleTexture=new w(Q+p.textureName,mp,!1,void 0===p.invertY||p.invertY),b.particleTexture.name=p.textureName)),p.emitterId||0===p.emitterId||void 0!==p.hb?p.emitterId&&mp?b.hb=mp.getLastMeshById(p.emitterId):b.hb=h.QM.tM(p.hb):b.hb=h.QM.Zero(),b.isLocal=!!p.isLocal,void 0!==p.renderingGroupId&&(b.renderingGroupId=p.renderingGroupId),void 0!==p.isBillboardBased&&(b.isBillboardBased=p.isBillboardBased),void 0!==p.billboardMode&&(b.billboardMode=p.billboardMode),void 0!==p.useLogarithmicDepth&&(b.useLogarithmicDepth=p.useLogarithmicDepth),p.animations){for(let M=0;M<p.animations.length;M++){const h=p.animations[M],Q=(0,P.b)("BABYLON.Animation");Q&&b.animations.push(Q.Parse(h))}b.beginAnimationOnStart=p.beginAnimationOnStart,b.beginAnimationFrom=p.beginAnimationFrom,b.beginAnimationTo=p.beginAnimationTo,b.beginAnimationLoop=p.beginAnimationLoop}if(p.autoAnimate&&mp&&mp.beginAnimation(b,p.autoAnimateFrom,p.autoAnimateTo,p.autoAnimateLoop,p.autoAnimateSpeed||1),b.startDelay=0|p.startDelay,b.minAngularSpeed=p.minAngularSpeed,b.maxAngularSpeed=p.maxAngularSpeed,b.minSize=p.minSize,b.maxSize=p.maxSize,p.minScaleX&&(b.minScaleX=p.minScaleX,b.maxScaleX=p.maxScaleX,b.minScaleY=p.minScaleY,b.maxScaleY=p.maxScaleY),void 0!==p.preWarmCycles&&(b.preWarmCycles=p.preWarmCycles,b.preWarmStepOffset=p.preWarmStepOffset),void 0!==p.minInitialRotation&&(b.minInitialRotation=p.minInitialRotation,b.maxInitialRotation=p.maxInitialRotation),b.minLifeTime=p.minLifeTime,b.maxLifeTime=p.maxLifeTime,b.minEmitPower=p.minEmitPower,b.maxEmitPower=p.maxEmitPower,b.emitRate=p.emitRate,b.gravity=h.QM.tM(p.gravity),p.noiseStrength&&(b.noiseStrength=h.QM.tM(p.noiseStrength)),b.color1=y.Hb.tM(p.color1),b.color2=y.Hb.tM(p.color2),b.colorDead=y.Hb.tM(p.colorDead),b.updateSpeed=p.updateSpeed,b.targetStopDuration=p.targetStopDuration,b.blendMode=p.blendMode,p.colorGradients)for(const h of p.colorGradients)b.addColorGradient(h.gradient,y.Hb.tM(h.color1),h.color2?y.Hb.tM(h.color2):void 0);if(p.rampGradients){for(const M of p.rampGradients)b.addRampGradient(M.gradient,y.wM.tM(M.color));b.useRampGradients=p.useRampGradients}if(p.colorRemapGradients)for(const h of p.colorRemapGradients)b.addColorRemapGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(p.alphaRemapGradients)for(const h of p.alphaRemapGradients)b.addAlphaRemapGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(p.sizeGradients)for(const h of p.sizeGradients)b.addSizeGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(p.angularSpeedGradients)for(const h of p.angularSpeedGradients)b.addAngularSpeedGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(p.velocityGradients)for(const h of p.velocityGradients)b.addVelocityGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(p.dragGradients)for(const h of p.dragGradients)b.addDragGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(p.emitRateGradients)for(const h of p.emitRateGradients)b.addEmitRateGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(p.startSizeGradients)for(const h of p.startSizeGradients)b.addStartSizeGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(p.lifeTimeGradients)for(const h of p.lifeTimeGradients)b.addLifeTimeGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(p.limitVelocityGradients){for(const M of p.limitVelocityGradients)b.addLimitVelocityGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);b.limitVelocityDamping=p.limitVelocityDamping}if(p.noiseTexture&&mp){const M=(0,P.b)("BABYLON.ProceduralTexture");b.noiseTexture=M.Parse(p.noiseTexture,mp,Q)}let t;if(p.particleEmitterType){switch(p.particleEmitterType.type){case"SphereParticleEmitter":t=new Y;break;case"SphereDirectedParticleEmitter":t=new a;break;case"ConeEmitter":case"ConeParticleEmitter":t=new S;break;case"ConeDirectedParticleEmitter":t=new X;break;case"CylinderParticleEmitter":t=new c;break;case"CylinderDirectedParticleEmitter":t=new J;break;case"HemisphericParticleEmitter":t=new g;break;case"PointParticleEmitter":t=new f;break;case"MeshParticleEmitter":t=new L;break;case"CustomParticleEmitter":t=new o;break;default:t=new x}t.parse(p.particleEmitterType,mp)}else t=new x,t.parse(p,mp);b.particleEmitterType=t,b.startSpriteCellID=p.startSpriteCellID,b.endSpriteCellID=p.endSpriteCellID,b.spriteCellLoop=p.spriteCellLoop??!0,b.spriteCellWidth=p.spriteCellWidth,b.spriteCellHeight=p.spriteCellHeight,b.spriteCellChangeSpeed=p.spriteCellChangeSpeed,b.spriteRandomStartCell=p.spriteRandomStartCell,b.disposeOnStop=p.disposeOnStop??!1,b.manualEmitCount=p.manualEmitCount??-1}static Parse(p,b,M){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],mp=arguments.length>4?arguments[4]:void 0;const P=p.name;let w,t,z=null,x=null;if(b instanceof rp.b?w=b:(t=b,w=t.getEngine()),p.customShader&&w.createEffectForParticles){x=p.customShader;const b=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"";z=w.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,b)}const S=new Pb(P,mp||p.XM,b,z,p.isAnimationSheetEnabled);if(S.customShader=x,S._rootUrl=M,p.id&&(S.id=p.id),p.subEmitters){S.subEmitters=[];for(const h of p.subEmitters){const p=[];for(const Q of h)p.push(Kp.Parse(Q,b,M));S.subEmitters.push(p)}}if(p.attractors)for(const y of p.attractors){const p=new yb;p.position=h.QM.tM(y.position),p.strength=y.strength,S.addAttractor(p)}return Pb._Parse(p,S,b,M),p.textureMask&&(S.textureMask=y.Hb.tM(p.textureMask)),p.Zz&&(S.Zz=h.QM.tM(p.Zz)),p.preventAutoStart&&(S.preventAutoStart=p.preventAutoStart),Q||S.preventAutoStart||S.start(),S}serialize(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};if(Pb._Serialize(b,this,p),b.textureMask=this.textureMask.ub(),b.customShader=this.customShader,b.preventAutoStart=this.preventAutoStart,b.Zz=this.Zz.ub(),this.subEmitters){b.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const M of this._subEmitters){const h=[];for(const b of M)h.push(b.serialize(p));b.subEmitters.push(h)}}if(this._attractors&&this._attractors.length){b.attractors=[];for(const p of this._attractors)b.attractors.push(p.serialize())}return b}static _Serialize(p,b,M){if(p.name=b.name,p.id=b.id,p.XM=b.getCapacity(),p.disposeOnStop=b.disposeOnStop,p.manualEmitCount=b.manualEmitCount,b.hb.position){const M=b.hb;p.emitterId=M.id}else{const M=b.hb;p.hb=M.ub()}b.particleEmitterType&&(p.particleEmitterType=b.particleEmitterType.serialize()),b.particleTexture&&(M?p.texture=b.particleTexture.serialize():(p.textureName=b.particleTexture.name,p.invertY=!!b.particleTexture._invertY)),p.isLocal=b.isLocal,B.e.AppendSerializedAnimations(b,p),p.beginAnimationOnStart=b.beginAnimationOnStart,p.beginAnimationFrom=b.beginAnimationFrom,p.beginAnimationTo=b.beginAnimationTo,p.beginAnimationLoop=b.beginAnimationLoop,p.startDelay=b.startDelay,p.renderingGroupId=b.renderingGroupId,p.isBillboardBased=b.isBillboardBased,p.billboardMode=b.billboardMode,p.minAngularSpeed=b.minAngularSpeed,p.maxAngularSpeed=b.maxAngularSpeed,p.minSize=b.minSize,p.maxSize=b.maxSize,p.minScaleX=b.minScaleX,p.maxScaleX=b.maxScaleX,p.minScaleY=b.minScaleY,p.maxScaleY=b.maxScaleY,p.minEmitPower=b.minEmitPower,p.maxEmitPower=b.maxEmitPower,p.minLifeTime=b.minLifeTime,p.maxLifeTime=b.maxLifeTime,p.emitRate=b.emitRate,p.gravity=b.gravity.ub(),p.noiseStrength=b.noiseStrength.ub(),p.color1=b.color1.ub(),p.color2=b.color2.ub(),p.colorDead=b.colorDead.ub(),p.updateSpeed=b.updateSpeed,p.targetStopDuration=b.targetStopDuration,p.blendMode=b.blendMode,p.preWarmCycles=b.preWarmCycles,p.preWarmStepOffset=b.preWarmStepOffset,p.minInitialRotation=b.minInitialRotation,p.maxInitialRotation=b.maxInitialRotation,p.startSpriteCellID=b.startSpriteCellID,p.spriteCellLoop=b.spriteCellLoop,p.endSpriteCellID=b.endSpriteCellID,p.spriteCellChangeSpeed=b.spriteCellChangeSpeed,p.spriteCellWidth=b.spriteCellWidth,p.spriteCellHeight=b.spriteCellHeight,p.spriteRandomStartCell=b.spriteRandomStartCell,p.isAnimationSheetEnabled=b.isAnimationSheetEnabled,p.useLogarithmicDepth=b.useLogarithmicDepth;const h=b.getColorGradients();if(h){p.colorGradients=[];for(const b of h){const M={gradient:b.gradient,color1:b.color1.ub()};b.color2?M.color2=b.color2.ub():M.color2=b.color1.ub(),p.colorGradients.push(M)}}const Q=b.getRampGradients();if(Q){p.rampGradients=[];for(const b of Q){const M={gradient:b.gradient,color:b.color.ub()};p.rampGradients.push(M)}p.useRampGradients=b.useRampGradients}const mp=b.getColorRemapGradients();if(mp){p.colorRemapGradients=[];for(const b of mp){const M={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?M.factor2=b.factor2:M.factor2=b.factor1,p.colorRemapGradients.push(M)}}const y=b.getAlphaRemapGradients();if(y){p.alphaRemapGradients=[];for(const b of y){const M={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?M.factor2=b.factor2:M.factor2=b.factor1,p.alphaRemapGradients.push(M)}}const P=b.getSizeGradients();if(P){p.sizeGradients=[];for(const b of P){const M={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?M.factor2=b.factor2:M.factor2=b.factor1,p.sizeGradients.push(M)}}const w=b.getAngularSpeedGradients();if(w){p.angularSpeedGradients=[];for(const b of w){const M={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?M.factor2=b.factor2:M.factor2=b.factor1,p.angularSpeedGradients.push(M)}}const t=b.getVelocityGradients();if(t){p.velocityGradients=[];for(const b of t){const M={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?M.factor2=b.factor2:M.factor2=b.factor1,p.velocityGradients.push(M)}}const z=b.getDragGradients();if(z){p.dragGradients=[];for(const b of z){const M={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?M.factor2=b.factor2:M.factor2=b.factor1,p.dragGradients.push(M)}}const x=b.getEmitRateGradients();if(x){p.emitRateGradients=[];for(const b of x){const M={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?M.factor2=b.factor2:M.factor2=b.factor1,p.emitRateGradients.push(M)}}const S=b.getStartSizeGradients();if(S){p.startSizeGradients=[];for(const b of S){const M={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?M.factor2=b.factor2:M.factor2=b.factor1,p.startSizeGradients.push(M)}}const X=b.getLifeTimeGradients();if(X){p.lifeTimeGradients=[];for(const b of X){const M={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?M.factor2=b.factor2:M.factor2=b.factor1,p.lifeTimeGradients.push(M)}}const c=b.getLimitVelocityGradients();if(c){p.limitVelocityGradients=[];for(const b of c){const M={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?M.factor2=b.factor2:M.factor2=b.factor1,p.limitVelocityGradients.push(M)}p.limitVelocityDamping=b.limitVelocityDamping}b.noiseTexture&&(p.noiseTexture=b.noiseTexture.serialize())}clone(p,b){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h={...this._customWrappers};let Q=null;const mp=this._engine;if(mp.createEffectForParticles&&null!=this.customShader){Q=this.customShader;const p=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"",b=mp.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,p);h[0]?h[0].effect=b:this.setCustomEffect(b,0)}const y=this.serialize(M),P=Pb.Parse(y,this._scene||this._engine,this._rootUrl);return P.name=p,P.customShader=Q,P._customWrappers=h,void 0===b&&(b=this.hb),this.noiseTexture&&(P.noiseTexture=this.noiseTexture.clone()),P.hb=b,this.preventAutoStart||P.start(),P}}Pb.BILLBOARDMODE_Y=2,Pb.BILLBOARDMODE_ALL=7,Pb.BILLBOARDMODE_STRETCHED=8,Pb.BILLBOARDMODE_STRETCHED_LOCAL=9,Kp._ParseParticleSystem=Pb.Parse;var wb=M(13021),tb=M(13013),zb=M(12897);zb.e.prototype.createTransformFeedback=function(){const p=this._gl.createTransformFeedback();if(!p)throw new Error("Unable to create Transform Feedback");return p},zb.e.prototype.deleteTransformFeedback=function(p){this._gl.deleteTransformFeedback(p)},zb.e.prototype.bindTransformFeedback=function(p){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,p)},zb.e.prototype.beginTransformFeedback=function(){let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(p?this._gl.POINTS:this._gl.TRIANGLES)},zb.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},zb.e.prototype.setTranformFeedbackVaryings=function(p,b){this._gl.transformFeedbackVaryings(p,b,this._gl.INTERLEAVED_ATTRIBS)},zb.e.prototype.bindTransformFeedbackBuffer=function(p){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,p?p.underlyingResource:null)},zb.e.prototype.readTransformFeedbackBuffer=function(p){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,p)};const xb="clipPlaneFragmentDeclaration2",Sb="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";e.d.IncludesShadersStore[xb]||(e.d.IncludesShadersStore[xb]=Sb);M(13918),M(13923),M(13930),M(13936),M(13942),M(13945),M(13950),M(13954);const Xb="gpuRenderParticlesPixelShader",cb="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";e.d.ShadersStore[Xb]||(e.d.ShadersStore[Xb]=cb);const Jb="clipPlaneVertexDeclaration2",gb="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";e.d.IncludesShadersStore[Jb]||(e.d.IncludesShadersStore[Jb]=gb);M(13962),M(13970),M(13976),M(13979);const fb="gpuRenderParticlesVertexShader",Yb="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";e.d.ShadersStore[fb]||(e.d.ShadersStore[fb]=Yb);class ab extends w{static get IsSupported(){if(!C.c.LastCreatedEngine)return!1;const p=C.c.LastCreatedEngine.getCaps();return p.supportTransformFeedbacks||p.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(p){this._maxActiveParticleCount=Math.min(p,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(p){this.maxActiveParticleCount=p}createPointEmitter(p,b){const M=kp(p,b);return this.particleEmitterType=M,M}createHemisphericEmitter(){const p=Ap(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=p,p}createSphereEmitter(){const p=np(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=p,p}createDirectedSphereEmitter(){const p=Cp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.QM(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.QM(0,1,0));return this.particleEmitterType=p,p}createCylinderEmitter(){const p=Fp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=p,p}createDirectedCylinderEmitter(){const p=pb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.QM(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new h.QM(0,1,0));return this.particleEmitterType=p,p}createConeEmitter(){const p=bb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=p,p}createDirectedConeEmitter(){const p=Mb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.QM(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.QM(0,1,0));return this.particleEmitterType=p,p}createBoxEmitter(p,b,M,h){const Q=new x;return this.particleEmitterType=Q,this.direction1=p,this.direction2=b,this.minEmitBox=M,this.maxEmitBox=h,Q}get flowMap(){return this._flowMap}set flowMap(p){this._flowMap!==p&&(this._flowMap=p)}isReady(){if(!this.hb||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Pb.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Pb.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Pb.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";p?setTimeout((()=>{this.start(0)}),p):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var p;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(p=this._customWrappers[b])||void 0===p?void 0:p.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[p]??this._customWrappers[0]}setCustomEffect(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new pp.c(this._engine),this._customWrappers[b].effect=p}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new A.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(p,b,M){return super._removeGradientAndTexture(p,b,M),this._releaseBuffers(),this}addColorGradient(p,b){this._colorGradients||(this._colorGradients=[]);const M=new R(p,b);return this._colorGradients.push(M),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(p&&this._colorGradients.sort(((p,b)=>p.gradient<b.gradient?-1:p.gradient>b.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(p){return this._removeGradientAndTexture(p,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const b in this._drawWrappers){var p;null===(p=this._drawWrappers[b].drawContext)||void 0===p||p.reset()}}_addFactorGradient(p,b,M){const h=new r(b,M);p.push(h),this._releaseBuffers()}addSizeGradient(p,b){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,p,b),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(p){return this._removeGradientAndTexture(p,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(p,b){if(!p)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&p.sort(((p,b)=>p.gradient<b.gradient?-1:p.gradient>b.gradient?1:0));const M=this;M[b]&&(M[b].dispose(),M[b]=null)}addAngularSpeedGradient(p,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,p,b),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(p){return this._removeGradientAndTexture(p,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(p,b){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,p,b),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(p){return this._removeGradientAndTexture(p,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(p,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,p,b),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(p){return this._removeGradientAndTexture(p,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(p,b){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,p,b),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(p){return this._removeGradientAndTexture(p,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(p){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(p,b,M){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,mp=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(p),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Xb=new A.d,this.onStoppedObservable=new A.d,this.onStartedObservable=new A.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,M&&"Scene"!==M.getClassName()?(this._engine=M,this.defaultProjectionMatrix=h.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=M||C.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.LX.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,P.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,P.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,P.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,P.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new pp.c(this._engine)},this._customWrappers[0].effect=Q,this._drawWrappers={0:new pp.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(b=b??{}).randomTextureSize||delete b.randomTextureSize;const y={XM:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...b},w=b;isFinite(w)&&(y.XM=w),this._capacity=y.XM,this._maxActiveParticleCount=y.XM,this._currentActiveCount=0,this._isAnimationSheetEnabled=mp,this.particleEmitterType=new x;const t=Math.min(this._engine.getCaps().maxTextureSize,y.randomTextureSize);let z=[];for(let h=0;h<t;++h)z.push(Math.random()),z.push(Math.random()),z.push(Math.random()),z.push(Math.random());this._randomTexture=new n.c(new Float32Array(z),t,1,5,M,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,z=[];for(let h=0;h<t;++h)z.push(Math.random()),z.push(Math.random()),z.push(Math.random()),z.push(Math.random());this._randomTexture2=new n.c(new Float32Array(z),t,1,5,M,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=t}_reset(){this._releaseBuffers()}_createVertexBuffers(p,b,M){const h={};h.position=b.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let Q=3;h.age=b.createVertexBuffer("age",Q,1,this._attributesStrideSize,!0),Q+=1,h.size=b.createVertexBuffer("size",Q,3,this._attributesStrideSize,!0),Q+=3,h.life=b.createVertexBuffer("life",Q,1,this._attributesStrideSize,!0),Q+=1,Q+=4,this.billboardMode===Pb.BILLBOARDMODE_STRETCHED&&(h.direction=b.createVertexBuffer("direction",Q,3,this._attributesStrideSize,!0)),Q+=3,this._platform.alignDataInBuffer&&(Q+=1),this.particleEmitterType instanceof o&&(Q+=3,this._platform.alignDataInBuffer&&(Q+=1)),this._colorGradientsTexture||(h.color=b.createVertexBuffer("color",Q,4,this._attributesStrideSize,!0),Q+=4),this._isBillboardBased||(h.initialDirection=b.createVertexBuffer("initialDirection",Q,3,this._attributesStrideSize,!0),Q+=3,this._platform.alignDataInBuffer&&(Q+=1)),this.noiseTexture&&(h.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",Q,3,this._attributesStrideSize,!0),Q+=3,this._platform.alignDataInBuffer&&(Q+=1),h.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",Q,3,this._attributesStrideSize,!0),Q+=3,this._platform.alignDataInBuffer&&(Q+=1)),h.angle=b.createVertexBuffer("angle",Q,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?Q++:Q+=2,this._isAnimationSheetEnabled&&(h.cellIndex=b.createVertexBuffer("cellIndex",Q,1,this._attributesStrideSize,!0),Q+=1,this.spriteRandomStartCell&&(h.cellStartOffset=b.createVertexBuffer("cellStartOffset",Q,1,this._attributesStrideSize,!0),Q+=1)),h.offset=M.createVertexBuffer("offset",0,2),h.uv=M.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(h),this._platform.createVertexBuffers(p,h),this.resetDrawCache()}_initialize(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!p)return;const b=this._engine,M=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof o&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const Q=this.particleEmitterType instanceof o,mp=h.TmpVectors.QM[0];let y=0;for(let h=0;h<this._capacity;h++)if(M.push(0),M.push(0),M.push(0),M.push(0),M.push(0),M.push(0),M.push(0),M.push(0),M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),Q?(this.particleEmitterType.particleDestinationGenerator(h,null,mp),M.push(mp.x),M.push(mp.y),M.push(mp.z)):(M.push(0),M.push(0),M.push(0)),this._platform.alignDataInBuffer&&M.push(0),y+=16,Q&&(this.particleEmitterType.particlePositionGenerator(h,null,mp),M.push(mp.x),M.push(mp.y),M.push(mp.z),this._platform.alignDataInBuffer&&M.push(0),y+=4),this._colorGradientsTexture||(M.push(0),M.push(0),M.push(0),M.push(0),y+=4),this.isBillboardBased||(M.push(0),M.push(0),M.push(0),this._platform.alignDataInBuffer&&M.push(0),y+=4),this.noiseTexture&&(M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),this._platform.alignDataInBuffer&&M.push(0),M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),this._platform.alignDataInBuffer&&M.push(0),y+=8),M.push(0),y+=1,this._angularSpeedGradientsTexture||(M.push(0),y+=1),this._isAnimationSheetEnabled&&(M.push(0),y+=1,this.spriteRandomStartCell&&(M.push(0),y+=1)),this._platform.alignDataInBuffer){let p=3-(y+3&3);for(y+=p;p-- >0;)M.push(0)}const P=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),w=this._platform.createParticleBuffer(M),t=this._platform.createParticleBuffer(M);this._buffer0=new l.d(b,w,!1,this._attributesStrideSize),this._buffer1=new l.d(b,t,!1,this._attributesStrideSize),this._spriteBuffer=new l.d(b,P,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let p=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(p+="\n#define BILLBOARD"),this._colorGradientsTexture&&(p+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(p+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(p+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(p+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(p+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(p+="\n#define DRAGGRADIENTS"),this._flowMap&&(p+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(p+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(p+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(p+="\n#define NOISE"),this.isLocal&&(p+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===p||(this._cachedUpdateDefines=p,this._updateBuffer=this._platform.createUpdateBuffer(p)),this._platform.isUpdateBufferReady()}_getWrapper(p){const b=this._getCustomDrawWrapper(p);if(null!==b&&void 0!==b&&b.effect)return b;const M=[];this.fillDefines(M,p);let h=this._drawWrappers[p];h||(h=new pp.c(this._engine),h.drawContext&&(h.drawContext.useInstancing=!0),this._drawWrappers[p]=h);const Q=M.join("\n");if(h.defines!==Q){const p=[],b=[],M=[];this.fillUniformsAttributesAndSamplerNames(b,p,M),h.setEffect(this._engine.createEffect("gpuRenderParticles",p,b,M,Q),Q)}return h}static _GetAttributeNamesOrOptions(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Q=[l.f.PositionKind,"age","life","size","angle"];return p||Q.push(l.f.ColorKind),b&&Q.push("cellIndex"),M||Q.push("initialDirection"),h&&Q.push("direction"),Q.push("offset",l.f.UVKind),Q}static _GetEffectCreationOptions(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h=["emitterWM","Zz","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,bp.e)(h),p&&h.push("sheetInfos"),b&&h.push("logarithmicDepthConstant"),M&&(h.push("vFogInfos"),h.push("vFogColor")),h}fillDefines(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bp.o)(this,this._scene,p),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==tb.b.FOGMODE_NONE&&p.push("#define FOG")),b===Pb.BLENDMODE_MULTIPLY&&p.push("#define BLENDMULTIPLYMODE"),this.isLocal&&p.push("#define LOCAL"),this.useLogarithmicDepth&&p.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(p.push("#define BILLBOARD"),this.billboardMode){case Pb.BILLBOARDMODE_Y:p.push("#define BILLBOARDY");break;case Pb.BILLBOARDMODE_STRETCHED:p.push("#define BILLBOARDSTRETCHED");break;case Pb.BILLBOARDMODE_ALL:p.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&p.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&p.push("#define ANIMATESHEET"),M&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),p.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(p,b,M){b.push(...ab._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Pb.BILLBOARDMODE_STRETCHED)),p.push(...ab._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),M.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(wb.c.PrepareUniforms(p,this._imageProcessingConfigurationDefines),wb.c.PrepareSamplers(M,this._imageProcessingConfigurationDefines))}animate(){var p;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(b?this.preWarmStepOffset:(null===(p=this._scene)||void 0===p?void 0:p.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(p,b){const M=this[b];if(!p||!p.length||M)return;const h=new Float32Array(this._rawTextureWidth);for(let Q=0;Q<this._rawTextureWidth;Q++){const b=Q/this._rawTextureWidth;k.GetCurrentGradient(b,p,((p,b,M)=>{h[Q]=(0,t.Lerp)(p.factor1,b.factor1,M)}))}this[b]=n.c.CreateRTexture(h,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[b].name=b.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const p=new Uint8Array(4*this._rawTextureWidth),b=y.TmpColors.Hb[0];for(let M=0;M<this._rawTextureWidth;M++){const h=M/this._rawTextureWidth;k.GetCurrentGradient(h,this._colorGradients,((h,Q,mp)=>{y.Hb.LerpToRef(h.color1,Q.color1,mp,b),p[4*M]=255*b.r,p[4*M+1]=255*b.g,p[4*M+2]=255*b.b,p[4*M+3]=255*b.a}))}this._colorGradientsTexture=n.c.CreateRGBATexture(p,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(p,b){var M,Q,mp,y;const P=this._getWrapper(p),w=P.effect;this._engine.enableEffect(P);const t=(null===(M=this._scene)||void 0===M?void 0:M.getViewMatrix())||h.Matrix.IdentityReadOnly;if(w.setMatrix("view",t),w.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),w.setTexture("diffuseSampler",this.particleTexture),w.setVector2("translationPivot",this.translationPivot),w.setVector3("Zz",this.Zz),this.isLocal&&w.setMatrix("emitterWM",b),this._colorGradientsTexture?w.setTexture("colorGradientSampler",this._colorGradientsTexture):w.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const p=this.particleTexture.getBaseSize();w.setFloat3("sheetInfos",this.spriteCellWidth/p.width,this.spriteCellHeight/p.height,p.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const p=this._scene.activeCamera;w.setVector3("eyePosition",p.globalPosition)}const z=w.defines;if(this._scene&&((0,bp.i)(w,this,this._scene),this.applyFog&&(0,Mp.g)(this._scene,void 0,w)),z.indexOf("#define BILLBOARDMODE_ALL")>=0){const p=t.clone();p.invert(),w.setMatrix("invView",p)}return this.useLogarithmicDepth&&this._scene&&(0,Mp.n)(z,w,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(w),this._setEngineBasedOnBlendMode(p),this._platform.bindDrawBuffers(this._targetIndex,w,null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(w),null!==(mp=this._scene)&&void 0!==mp&&mp.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(y=this._scene)&&void 0!==y&&y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(p){if(!this.hb||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!p)if(this.hb.position){p=this.hb.getWorldMatrix()}else{const b=this.hb;p=h.TmpVectors.Matrix[0],h.Matrix.TranslationToRef(b.x,b.y,b.z,p)}const b=this._engine,M=b.getDepthWrite();if(b.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const p=this.upp();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",p.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",p),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const Q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=Q,b.setDepthWrite(M)}render(){let p,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!b&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let p=0;p<this.preWarmCycles;p++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const p=0|this._accumulatedCount;this._accumulatedCount-=p,this._currentActiveCount+=p}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.hb.position){p=this.hb.getWorldMatrix()}else{const b=this.hb;p=h.TmpVectors.Matrix[0],h.Matrix.TranslationToRef(b.x,b.y,b.z,p)}const Q=this._engine;this.updateInAnimate||this._update(p);let mp=0;return b||M||(Q.setState(!1),this.forceDepthWrite&&Q.setDepthWrite(!0),mp=this.blendMode===Pb.BLENDMODE_MULTIPLYADD?this._render(Pb.BLENDMODE_MULTIPLY,p)+this._render(Pb.BLENDMODE_ADD,p):this._render(this.blendMode,p),this._engine.setAlphaMode(0)),mp}rebuild(){const p=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(p,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,p()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const b in this._drawWrappers){this._drawWrappers[b].dispose()}if(this._drawWrappers={},this._scene){const p=this._scene.LX.indexOf(this);p>-1&&this._scene.LX.splice(p,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let b=0;b<this._renderVertexBuffers.length;++b){const p=this._renderVertexBuffers[b];for(const b in p)p[b].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),p&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),p&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Xb.notifyObservers(this),this.Xb.clear()}clone(p,b){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h={...this._customWrappers};let Q=null;const mp=this._engine;if(mp.createEffectForParticles&&null!=this.customShader){Q=this.customShader;const p=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"";h[0]=mp.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,p,void 0,void 0,void 0,this)}const y=this.serialize(M),P=ab.Parse(y,this._scene||this._engine,this._rootUrl);return P.name=p,P.customShader=Q,P._customWrappers=h,void 0===b&&(b=this.hb),this.noiseTexture&&(P.noiseTexture=this.noiseTexture.clone()),P.hb=b,P}serialize(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return Pb._Serialize(b,this,p),b.activeParticleCount=this.activeParticleCount,b.randomTextureSize=this._randomTextureSize,b.customShader=this.customShader,b}static Parse(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0;const mp=p.name;let y,P;b instanceof rp.b?y=b:(P=b,y=P.getEngine());const w=new ab(mp,{XM:Q||p.XM,randomTextureSize:p.randomTextureSize},b,null,p.isAnimationSheetEnabled);if(w._rootUrl=M,p.customShader&&y.createEffectForParticles){const b=p.customShader,M=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",h=y.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,M,void 0,void 0,void 0,w);w.setCustomEffect(h,0),w.customShader=b}return p.id&&(w.id=p.id),p.activeParticleCount&&(w.activeParticleCount=p.activeParticleCount),Pb._Parse(p,w,b,M),p.preventAutoStart&&(w.preventAutoStart=p.preventAutoStart),h||w.preventAutoStart||w.start(),w}}var ob=M(12608),lb=M(13988),Lb=M(13156);class ub{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(p){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const b of this.systems)b.hb=p;this._emitterNode=p}setEmitterAsSphere(p,b,M){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:p,renderingGroupId:b};const h=(0,lb.d)("emitterSphere",{diameter:p.diameter,segments:p.segments},M);h.renderingGroupId=b;const Q=new Lb.PM("emitterSphereMaterial",M);Q.emissiveColor=p.color,h.material=Q;for(const mp of this.systems)mp.hb=h;this._emitterNode=h}start(p){for(const b of this.systems)p&&(b.hb=p),b.start()}dispose(){for(const p of this.systems)p.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={systems:[]};for(const M of this.systems)b.systems.push(M.serialize(p));return this._emitterNode&&(b.hb=this._emitterCreationOptions),b}static Parse(p,b){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3?arguments[3]:void 0;const Q=new ub,mp=this.BaseAssetsUrl+"/textures/";b=b||C.c.LastCreatedScene;for(const y of p.systems)Q.systems.push(M?ab.Parse(y,b,mp,!0,h):Pb.Parse(y,b,mp,!0,h));if(p.hb){const M=p.hb.options;if("Sphere"===p.hb.kind)Q.setEmitterAsSphere({diameter:M.diameter,segments:M.segments,color:y.wM.tM(M.color)},p.hb.renderingGroupId,b)}return Q}}ub.BaseAssetsUrl="https://assets.babylonjs.com/particles";var eb=M(12644);class db{static CreateDefault(p){let b,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,h=arguments.length>2?arguments[2]:void 0;b=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ab("default system",{XM:M},h):new Pb("default system",M,h),b.hb=p;const Q=ob.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return b.particleTexture=new s.c(Q,b.upp()),b.createConeEmitter(.1,Math.PI/4),b.color1=new y.Hb(1,1,1,1),b.color2=new y.Hb(1,1,1,1),b.colorDead=new y.Hb(1,1,1,0),b.minSize=.1,b.maxSize=.1,b.minEmitPower=2,b.maxEmitPower=2,b.updateSpeed=1/60,b.emitRate=30,b}static CreateAsync(p,b){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3?arguments[3]:void 0;b||(b=C.c.LastCreatedScene);const Q={};return b.addPendingData(Q),new Promise(((mp,y)=>{if(M&&!ab.IsSupported)return b.removePendingData(Q),y("Particle system with GPU is not supported.");ob.Tools.LoadFile(`${db.BaseAssetsUrl}/systems/${p}.json`,(p=>{b.removePendingData(Q);const y=JSON.parse(p.toString());return mp(ub.Parse(y,b,M,h))}),void 0,void 0,void 0,(()=>(b.removePendingData(Q),y(`An error occurred with the creation of your particle system. Check if your type '${p}' exists.`))))}))}static ExportSet(p){const b=new ub;for(const M of p)b.systems.push(M);return b}static ParseFromFileAsync(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",mp=arguments.length>5?arguments[5]:void 0;return new Promise(((y,P)=>{const w=new eb.e;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const b=JSON.parse(w.responseText);let P;P=h?ab.Parse(b,M,Q,!1,mp):Pb.Parse(b,M,Q,!1,mp),p&&(P.name=p),y(P)}else P("Unable to load the particle system")})),w.open("GET",b),w.send()}))}static ParseFromSnippetAsync(p,b){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Q=arguments.length>4?arguments[4]:void 0;if("_BLANK"===p){const p=this.CreateDefault(null);return p.start(),Promise.resolve(p)}return new Promise(((mp,y)=>{const P=new eb.e;P.addEventListener("readystatechange",(()=>{if(4==P.readyState)if(200==P.status){const y=JSON.parse(JSON.parse(P.responseText).jsonPayload),w=JSON.parse(y.particleSystem);let t;t=M?ab.Parse(w,b,h,!1,Q):Pb.Parse(w,b,h,!1,Q),t.snippetId=p,mp(t)}else y("Unable to load the snippet "+p)})),P.open("GET",this.SnippetUrl+"/"+p.replace(/#/g,"/")),P.send()}))}}db.BaseAssetsUrl=ub.BaseAssetsUrl,db.SnippetUrl="https://snippet.babylonjs.com",db.CreateFromSnippetAsync=db.ParseFromSnippetAsync;var Ib=M(13231),Gb=M(13043),vb=M(13996);(0,vb.e)(Gb.c.NAME_PARTICLESYSTEM,((p,b,M,h)=>{const Q=(0,vb.f)(Gb.c.NAME_PARTICLESYSTEM);if(Q&&void 0!==p.LX&&null!==p.LX)for(let mp=0,y=p.LX.length;mp<y;mp++){const y=p.LX[mp];M.LX.push(Q(y,b,h))}})),(0,vb.d)(Gb.c.NAME_PARTICLESYSTEM,((p,b,M)=>{if(p.activeParticleCount){return ab.Parse(p,b,M)}return Pb.Parse(p,b,M)})),rp.b.prototype.createEffectForParticles=function(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",mp=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0,P=arguments.length>6?arguments[6]:void 0,w=arguments.length>7?arguments[7]:void 0,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,z=arguments.length>9?arguments[9]:void 0,x=[],S=[];const X=[];return w?w.fillUniformsAttributesAndSamplerNames(S,x,X):(x=Pb._GetAttributeNamesOrOptions(),S=Pb._GetEffectCreationOptions()),-1===Q.indexOf(" BILLBOARD")&&(Q+="\n#define BILLBOARD\n"),null!==w&&void 0!==w&&w.isAnimationSheetEnabled&&-1===Q.indexOf(" ANIMATESHEET")&&(Q+="\n#define ANIMATESHEET\n"),-1===h.indexOf("diffuseSampler")&&h.push("diffuseSampler"),this.createEffect({vertex:z??(null===w||void 0===w?void 0:w.vertexShaderName)??"particles",fragmentElement:p},x,S.concat(b),X.concat(h),Q,mp,y,P,void 0,t,(async()=>{0===t?await Promise.resolve().then(M.bind(M,14022)):await Promise.resolve().then(M.bind(M,14084))}))},Ib.e.prototype.getEmittedParticleSystems=function(){const p=[];for(let b=0;b<this.upp().LX.length;b++){const M=this.upp().LX[b];M.hb===this&&p.push(M)}return p},Ib.e.prototype.getHierarchyEmittedParticleSystems=function(){const p=[],b=this.getDescendants();b.push(this);for(let M=0;M<this.upp().LX.length;M++){const h=this.upp().LX[M],Q=h.hb;Q.position&&-1!==b.indexOf(Q)&&p.push(h)}return p};M(13111),M(13128),M(13217);M(13219),M(13998),M(12975),M(13100),M(13245);M(12966);var Zb;M(14001),M(12798);!function(p){p[p.Color=2]="Color",p[p.UV=1]="UV",p[p.Random=0]="Random",p[p.Stated=3]="Stated"}(Zb||(Zb={}));var Ub=M(13001);const qb=new h.QM(0,0,0),Bb=new h.QM(0,0,0),sb=new h.QM(0,0,0);class ib{constructor(p,b,M){this.width=p,this.height=b,this.data=M}processFlowable(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2?arguments[2]:void 0;if(!M)return;M instanceof h.Matrix?h.QM.TransformCoordinatesToRef(p.position,M,sb):(sb.x=M.x,sb.y=M.y,sb.z=M.z);const Q=.5*sb.x+.5,mp=1-(.5*sb.y+.5),y=Math.floor(Q*this.width),P=Math.floor(mp*this.height);if(y<0||y>=this.width||P<0||P>=this.height)return;const w=4*(P*this.width+y),t=this.data[w]/255*2-1,z=this.data[w+1]/255*2-1,x=this.data[w+2]/255*2-1,S=this.data[w+3]/255;qb.set(t,z,x),qb.scaleToRef(b*S,Bb),p.direction.addInPlace(Bb)}_processParticle(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2?arguments[2]:void 0;this.processFlowable(p,b,M)}static async FromUrlAsync(p){return await new Promise(((b,M)=>{const h=document.createElement("canvas"),Q=h.getContext("2d");let mp=null;const y=new Image;y.crossOrigin="anonymous",y.src=p,y.onerror=b=>{M(new Error(`Failed to load image: ${p} : ${b}`))},y.onload=()=>{h.width=y.width,h.height=y.height,Q.drawImage(y,0,0),mp=Q.getImageData(0,0,h.width,h.height),b(new ib(h.width,h.height,mp.data))}}))}static async ExtractFromTextureAsync(p){return await new Promise(((b,M)=>{if(!p.isReady())return void p.onLoadObservable.addOnce((async()=>{try{const M=await this.ExtractFromTextureAsync(p);b(M)}catch(h){M(h)}}));const h=p.getSize();Ub.i.GetTextureDataAsync(p,h.width,h.height).then((p=>{b(new ib(h.width,h.height,new Uint8ClampedArray(p)))})).catch(M)}))}}var Tb,Wb,Hb,Eb,jb,Vb,Db,Nb,Ob;!function(p){p[p.Int=1]="Int",p[p.Float=2]="Float",p[p.Vector2=4]="Vector2",p[p.QM=8]="QM",p[p.Matrix=16]="Matrix",p[p.Particle=32]="Particle",p[p.Texture=64]="Texture",p[p.Hb=128]="Hb",p[p.FloatGradient=256]="FloatGradient",p[p.Vector2Gradient=512]="Vector2Gradient",p[p.Vector3Gradient=1024]="Vector3Gradient",p[p.Color4Gradient=2048]="Color4Gradient",p[p.System=4096]="System",p[p.AutoDetect=8192]="AutoDetect",p[p.BasedOnInput=16384]="BasedOnInput",p[p.Undefined=32768]="Undefined",p[p.All=65535]="All"}(Tb||(Tb={})),function(p){p[p.Compatible=0]="Compatible",p[p.TypeIncompatible=1]="TypeIncompatible",p[p.HierarchyIssue=2]="HierarchyIssue"}(Wb||(Wb={})),function(p){p[p.Input=0]="Input",p[p.Output=1]="Output"}(Hb||(Hb={}));class Rb{get direction(){return this._direction}get type(){if(this._type===Tb.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Tb.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(p){this._type=p}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((p=>p.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(p,b,M){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Tb.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new A.d,this.onDisconnectionObservable=new A.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=b,this.name=p,this._direction=M}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(p){var b;return this.isConnected?null!==(b=this._connectedPoint)&&void 0!==b&&b._storedFunction?this._connectedPoint._storedFunction(p):this._connectedPoint._storedValue:this.value}canConnectTo(p){return 0===this.checkCompatibilityState(p)}checkCompatibilityState(p){const b=this._ownerBlock,M=p.ownerBlock;if(this.type!==p.type&&p.innerType!==Tb.AutoDetect)return p.acceptedConnectionPointTypes&&-1!==p.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(p.excludedConnectionPointTypes&&-1!==p.excludedConnectionPointTypes.indexOf(this.type))return 1;let h=M,Q=b;return 0===this.direction&&(h=b,Q=M),h.isAnAncestorOf(Q)?2:0}connectTo(p){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(p))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${p.ownerBlock.name}".${p.name}`;return this._endpoints.push(p),p._connectedPoint=this,this.onConnectionObservable.notifyObservers(p),p.onConnectionObservable.notifyObservers(this),this}disconnectFrom(p){const b=this._endpoints.indexOf(p);return-1===b||(this._endpoints.splice(b,1),p._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(p),p.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(p){let b=1;for(;b<Tb.All;)p&b||this.excludedConnectionPointTypes.push(b),b<<=1}serialize(){let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const b={};return b.name=this.name,b.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.ub?(b.valueType="BABYLON."+this.value.getClassName(),b.value=this.value.ub()):(b.valueType="number",b.value=this.value)),p&&this.connectedPoint&&(b.inputName=this.name,b.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,b.targetConnectionName=this.connectedPoint.name,b.isExposedOnFrame=!0,b.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(b.isExposedOnFrame=!0,b.exposedPortPosition=this.exposedPortPosition),b}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Kb{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(p){this._name=p}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(p){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new A.d,this.Xb=new A.d,this.onInputChangedObservable=new A.d,this.visibleOnFrame=!1,this._name=p,this.uniqueId=i.e.UniqueId}_inputRename(p){return p}_outputRename(p){return p}isAnAncestorOf(p){for(const b of this._outputs)if(b.hasEndpoints)for(const M of b.endpoints){if(M.ownerBlock===p)return!0;if(M.ownerBlock.isAnAncestorOf(p))return!0}return!1}isAnAncestorOfType(p){if(this.getClassName()===p)return!0;for(const b of this._outputs)if(b.hasEndpoints)for(const M of b.endpoints)if(M.ownerBlock.isAnAncestorOfType(p))return!0;return!1}getInputByName(p){const b=this._inputs.filter((b=>b.name===p));return b.length?b[0]:null}_linkConnectionTypes(p,b){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[b]._acceptedConnectionPointType=this._inputs[p]:(this._inputs[p]._linkedConnectionSource=this._inputs[b],this._inputs[p]._isMainLinkSource=!0),this._inputs[b]._linkedConnectionSource=this._inputs[p]}registerInput(p,b){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0,mp=arguments.length>5?arguments[5]:void 0;const y=new Rb(p,this,0);return y.type=b,y.isOptional=M,y.defaultValue=h,y.value=h,y.valueMin=Q,y.valueMax=mp,this._inputs.push(y),this.onInputChangedObservable.notifyObservers(y),this}registerOutput(p,b,M){return(M=M??new Rb(p,this,1)).type=b,this._outputs.push(M),this}_build(p){}_customBuildStep(p){}build(p){if(this._buildId===p.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((p=>p.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=p.buildId;for(const b of this._inputs){if(!b.connectedPoint){b.isOptional||p.notConnectedNonOptionalInputs.push(b);continue}const M=b.connectedPoint.ownerBlock;M&&M!==this&&!M.isSystem&&M.build(p)}return this._customBuildStep(p),p.verbose&&T.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(p),this.onBuildObservable.notifyObservers(this),!1}serialize(){const p={};p.customType="BABYLON."+this.getClassName(),p.id=this.uniqueId,p.name=this.name,p.visibleOnFrame=this.visibleOnFrame,p.inputs=[],p.outputs=[];for(const b of this.inputs)p.inputs.push(b.serialize());for(const b of this.outputs)p.outputs.push(b.serialize(!1));return p}_deserialize(p){this._name=p.name,this.comments=p.comments,this.visibleOnFrame=!!p.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(p)}_deserializePortDisplayNamesAndExposedOnFrame(p){const b=p.inputs,M=p.outputs;if(b)for(const h of b){const p=this.inputs.find((p=>p.name===h.name));if(!p)return;if(h.displayName&&(p.displayName=h.displayName),h.isExposedOnFrame&&(p.isExposedOnFrame=h.isExposedOnFrame,p.exposedPortPosition=h.exposedPortPosition),void 0!==h.value&&null!==h.value)if("number"===h.valueType)p.value=h.value;else{const b=(0,P.b)(h.valueType);b&&(p.value=b.tM(h.value))}}if(M)for(let h=0;h<M.length;h++){const p=M[h];p.displayName&&(this.outputs[h].displayName=p.displayName),p.isExposedOnFrame&&(this.outputs[h].isExposedOnFrame=p.isExposedOnFrame,this.outputs[h].exposedPortPosition=p.exposedPortPosition)}}clone(){const p=this.serialize(),b=(0,P.b)(p.customType);if(b){const M=new b;return M._deserialize(p),M}return null}dispose(){this.Xb.notifyObservers(this),this.Xb.clear();for(const p of this.inputs)p.dispose();for(const p of this.outputs)p.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function rb(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",h=arguments.length>3?arguments[3]:void 0;return(Q,mp)=>{let y=Q._propStore;y||(y=[],Q._propStore=y),y.push({propertyName:mp,displayName:p,type:b,groupName:M,options:h??{},className:Q.getClassName()})}}(0,U.e)([(0,q.N)("comment")],Kb.prototype,"comments",void 0),function(p){p[p.Boolean=0]="Boolean",p[p.Float=1]="Float",p[p.Int=2]="Int",p[p.Vector2=3]="Vector2",p[p.List=4]="List",p[p.Hb=5]="Hb",p[p.SamplingMode=6]="SamplingMode",p[p.TextureFormat=7]="TextureFormat",p[p.TextureType=8]="TextureType"}(Eb||(Eb={})),function(p){p[p.None=0]="None",p[p.Position=1]="Position",p[p.Direction=2]="Direction",p[p.Age=3]="Age",p[p.Lifetime=4]="Lifetime",p[p.Color=5]="Color",p[p.ScaledDirection=6]="ScaledDirection",p[p.Scale=7]="Scale",p[p.AgeGradient=8]="AgeGradient",p[p.Angle=9]="Angle",p[p.SpriteCellIndex=16]="SpriteCellIndex",p[p.SpriteCellStart=17]="SpriteCellStart",p[p.SpriteCellEnd=18]="SpriteCellEnd"}(jb||(jb={})),function(p){p[p.None=0]="None",p[p.Time=1]="Time",p[p.Delta=2]="Delta",p[p.Emitter=3]="Emitter"}(Vb||(Vb={}));class kb{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let p="";for(const b of this.notConnectedNonOptionalInputs)p+=`input ${b.name} from block ${b.ownerBlock.name}[${b.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(p)throw"Build of Node Particle System Set failed:\n"+p}adapt(p,b){const M=p.getConnectedValue(this)||0;if(p.type===b)return M;switch(b){case Tb.Vector2:return new h.Vector2(M,M);case Tb.QM:return new h.QM(M,M,M);case Tb.Hb:return new y.Hb(M,M,M,M)}return null}getContextualValue(p){if(!this.particleContext||!this.systemContext)return null;switch(p){case jb.Position:return this.particleContext.position;case jb.Direction:return this.particleContext.direction;case jb.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case jb.Color:return this.particleContext.color;case jb.Age:return this.particleContext.age;case jb.Lifetime:return this.particleContext.lifeTime;case jb.Angle:return this.particleContext.angle;case jb.Scale:return this.particleContext.scale;case jb.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case jb.SpriteCellEnd:return this.systemContext.endSpriteCellID;case jb.SpriteCellIndex:return this.particleContext.cellIndex;case jb.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.hb.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.hb.absolutePosition:this.systemContext.hb:null}getSystemValue(p){if(!this.particleContext||!this.systemContext)return null;switch(p){case Vb.Time:return this.systemContext._actualFrame;case Vb.Delta:return this.systemContext._scaledUpdateSpeed;case Vb.Emitter:if(this.isEmitterTransformNode){return this.systemContext.hb.absolutePosition}return this.systemContext.hb}return null}}function Ab(p,b,M){const h=new kb;h.yM=b;const Q=p.createSystem(h);return Q.canStart=()=>!0,Q.hb=M.clone(),Q.disposeOnStop=!0,Q.start(),Q}class nb extends Kb{constructor(p){super(p),this.blendMode=w.BLENDMODE_ONEONE,this.XM=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Tb.Particle),this.registerInput("texture",Tb.Texture),this.registerInput("onStart",Tb.System,!0),this.registerInput("onEnd",Tb.System,!0),this.registerOutput("system",Tb.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(p){p.XM=this.XM,p.buildId=this._buildId++,this.build(p);const b=this.particle.getConnectedValue(p);return b.particleTexture=this.texture.getConnectedValue(p),b.emitRate=this.emitRate,b.blendMode=this.blendMode,b.name=this.name,b._nodeGenerated=!0,b._targetStopDuration=this.targetStopDuration,b.startDelay=this.startDelay,this.system._storedValue=this,b.canStart=()=>!this.doNoStart,b.onStartedObservable.add((M=>{const h=this.onStart.getConnectedValue(p);h&&M.onStartedObservable.addOnce((()=>{p.systemContext=b;const M=Ab(h,p.yM,p.emitterPosition);this.Xb.addOnce((()=>{M.dispose()}))}));const Q=this.onEnd.getConnectedValue(p);Q&&M.onStoppedObservable.addOnce((()=>{p.systemContext=b;const M=Ab(Q,p.yM,p.emitterPosition);this.Xb.addOnce((()=>{M.dispose()}))}))})),this.Xb.addOnce((()=>{b.dispose()})),b}serialize(){const p=super.serialize();return p.XM=this.XM,p.emitRate=this.emitRate,p.blendMode=this.blendMode,p.doNoStart=this.doNoStart,p.targetStopDuration=this.targetStopDuration,p.startDelay=this.startDelay,p}_deserialize(p){super._deserialize(p),this.XM=p.XM,this.emitRate=p.emitRate,this.doNoStart=!!p.doNoStart,void 0!==p.blendMode&&(this.blendMode=p.blendMode),void 0!==p.targetStopDuration&&(this.targetStopDuration=p.targetStopDuration),void 0!==p.startDelay&&(this.startDelay=p.startDelay)}}(0,U.e)([rb("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:w.BLENDMODE_ONEONE},{label:"Standard",value:w.BLENDMODE_STANDARD},{label:"Add",value:w.BLENDMODE_ADD},{label:"Multiply",value:w.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:w.BLENDMODE_MULTIPLYADD}]})],nb.prototype,"blendMode",void 0),(0,U.e)([rb("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],nb.prototype,"XM",void 0),(0,U.e)([rb("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nb.prototype,"emitRate",void 0),(0,U.e)([rb("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nb.prototype,"targetStopDuration",void 0),(0,U.e)([rb("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nb.prototype,"startDelay",void 0),(0,U.e)([rb("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],nb.prototype,"doNoStart",void 0),(0,P.c)("BABYLON.SystemBlock",nb);class Cb extends Kb{get type(){if(this._type===Tb.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Tb.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Tb.Vector2,this._type;case"QM":return this._type=Tb.QM,this._type;case"Hb":return this._type=Tb.Hb,this._type;case"Matrix":return this._type=Tb.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===jb.None&&this._systemSource!==Vb.None}get systemSource(){return this._systemSource}set systemSource(p){if(this._systemSource=p,p!==Vb.None){switch(this._contextualSource=jb.None,this._type=Tb.Float,p){case Vb.Time:case Vb.Delta:this._type=Tb.Float;break;case Vb.Emitter:this._type=Tb.QM}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==jb.None}get contextualValue(){return this._contextualSource}set contextualValue(p){if(this._contextualSource=p,p!==jb.None){switch(this._systemSource=Vb.None,p){case jb.Scale:this._type=Tb.Vector2;break;case jb.Position:case jb.Direction:case jb.ScaledDirection:this._type=Tb.QM;break;case jb.Color:this._type=Tb.Hb;break;case jb.Age:case jb.Lifetime:case jb.Angle:case jb.AgeGradient:this._type=Tb.Float;break;case jb.SpriteCellEnd:case jb.SpriteCellStart:case jb.SpriteCellIndex:this._type=Tb.Int}this.output&&(this.output.type=this._type)}}constructor(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tb.AutoDetect;super(p),this._type=Tb.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new A.d,this._systemSource=Vb.None,this._contextualSource=jb.None,this._type=b,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",b)}get value(){return this._storedValue}set value(p){this.type===Tb.Float&&this.min!==this.max&&(p=Math.max(this.min,p),p=Math.min(this.max,p)),this._storedValue=p,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(p){this._valueCallback=p}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Tb.Int:case Tb.Float:this.value=0;break;case Tb.Vector2:this.value=h.Vector2.Zero();break;case Tb.QM:this.value=h.QM.Zero();break;case Tb.Hb:this.value=new y.Hb(1,1,1,1);break;case Tb.Matrix:this.value=h.Matrix.Identity()}}_build(p){super._build(p),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=p=>p.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=p=>p.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const p=super.serialize();return p.type=this.type,p.contextualValue=this.contextualValue,p.systemSource=this.systemSource,p.min=this.min,p.max=this.max,p.groupInInspector=this.groupInInspector,p.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.ub?(p.valueType="BABYLON."+this._storedValue.getClassName(),p.value=this._storedValue.ub()):(p.valueType="number",p.value=this._storedValue)),p}_deserialize(p){if(super._deserialize(p),this._type=p.type,this.contextualValue=p.contextualValue,this.systemSource=p.systemSource||Vb.None,this.min=p.min||0,this.max=p.max||0,this.groupInInspector=p.groupInInspector||"",void 0!==p.displayInInspector&&(this.displayInInspector=p.displayInInspector),p.valueType)if("number"===p.valueType)this._storedValue=p.value;else{const b=(0,P.b)(p.valueType);b&&(this._storedValue=b.tM(p.value))}}}(0,P.c)("BABYLON.ParticleInputBlock",Cb);class Fb extends Kb{get url(){return this._url}set url(p){this._url!==p&&(this._cachedData=null,this._url=p,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(p){this._textureDataUrl!==p&&(this._cachedData=null,this._textureDataUrl=p,this._url="",this._sourceTexture=null)}set sourceTexture(p){this._sourceTexture!==p&&(this._cachedData=null,this._sourceTexture=p,this._url="",this._textureDataUrl="")}constructor(p){super(p),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Tb.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const p=this.texture._storedValue;return await new Promise(((b,M)=>{if(!p.isReady())return void p.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),b(this._cachedData)}catch(p){M(p)}}));const h=p.getSize();Ub.i.GetTextureDataAsync(p,h.width,h.height).then((M=>{this._cachedData={width:h.width,height:h.height,data:new Uint8ClampedArray(M)},p.dispose(),b(this._cachedData)})).catch(M)}))}_build(p){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new s.c(this._textureDataUrl,p.yM):this.texture._storedValue=new s.c(this._url,p.yM):this.texture._storedValue=null}serialize(){const p=super.serialize();return p.url=this.url,p.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(p.textureDataUrl=this.textureDataUrl),p}_deserialize(p){super._deserialize(p),this.url=p.url,this.serializedCachedData=!!p.serializedCachedData,p.textureDataUrl&&(this.textureDataUrl=p.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,P.c)("BABYLON.ParticleTextureSourceBlock",Fb);class pM extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerInput("position",Tb.QM),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(p){const b=this.particle.getConnectedValue(p);if(this.output._storedValue=b,!this.position.isConnected)return;const M={process:M=>{p.particleContext=M,p.systemContext=b,M.position.mp(this.position.getConnectedValue(p))},previousItem:null,nextItem:null};b._updateQueueStart?Vp(M,b._updateQueueStart):b._updateQueueStart=M}}(0,P.c)("BABYLON.UpdatePositionBlock",pM),function(p){p[p.Add=0]="Add",p[p.Subtract=1]="Subtract",p[p.Multiply=2]="Multiply",p[p.Divide=3]="Divide",p[p.Max=4]="Max",p[p.Min=5]="Min"}(Db||(Db={}));class bM extends Kb{constructor(p){super(p),this.operation=Db.Add,this.registerInput("left",Tb.AutoDetect),this.registerInput("right",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this.output._typeConnectionSource=this.left;const b=[Tb.Matrix,Tb.Particle,Tb.Texture,Tb.System,Tb.FloatGradient,Tb.Color4Gradient,Tb.Vector2Gradient,Tb.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...b),this.right.excludedConnectionPointTypes.push(...b),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(p){let b;const M=this.left,Q=this.right;if(!M.isConnected||!Q.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const mp=M.type===Tb.Float||M.type===Tb.Int,P=Q.type===Tb.Float||Q.type===Tb.Int,w=mp&&P;switch(this.operation){case Db.Add:b=w?p=>M.getConnectedValue(p)+Q.getConnectedValue(p):mp?p=>p.adapt(M,Q.type).add(Q.getConnectedValue(p)):p=>M.getConnectedValue(p).add(p.adapt(Q,M.type));break;case Db.Subtract:b=w?p=>M.getConnectedValue(p)-Q.getConnectedValue(p):mp?p=>p.adapt(M,Q.type).mh(Q.getConnectedValue(p)):p=>M.getConnectedValue(p).mh(p.adapt(Q,M.type));break;case Db.Multiply:b=w?p=>M.getConnectedValue(p)*Q.getConnectedValue(p):mp?p=>p.adapt(M,Q.type).multiply(Q.getConnectedValue(p)):p=>M.getConnectedValue(p).multiply(p.adapt(Q,M.type));break;case Db.Divide:b=w?p=>M.getConnectedValue(p)/Q.getConnectedValue(p):mp?p=>p.adapt(M,Q.type).divide(Q.getConnectedValue(p)):p=>M.getConnectedValue(p).divide(p.adapt(Q,M.type));break;case Db.Min:if(w)b=p=>Math.min(M.getConnectedValue(p),Q.getConnectedValue(p));else{const[p,P]=mp?[Q,M]:[M,Q];switch(p.type){case Tb.Vector2:b=b=>h.Vector2.Minimize(p.getConnectedValue(b),b.adapt(P,p.type));break;case Tb.QM:b=b=>h.QM.Minimize(p.getConnectedValue(b),b.adapt(P,p.type));break;case Tb.Hb:b=b=>{const M=p.getConnectedValue(b),{r:h,g:Q,b:mp,a:w}=b.adapt(P,p.type);return new y.Hb(Math.min(M.r,h),Math.min(M.g,Q),Math.min(M.b,mp),Math.min(M.a,w))}}}break;case Db.Max:if(!w){const[p,P]=mp?[Q,M]:[M,Q];switch(p.type){case Tb.Vector2:b=b=>h.Vector2.Maximize(p.getConnectedValue(b),b.adapt(P,p.type));break;case Tb.QM:b=b=>h.QM.Maximize(p.getConnectedValue(b),b.adapt(P,p.type));break;case Tb.Hb:b=b=>{const M=p.getConnectedValue(b),{r:h,g:Q,b:mp,a:w}=b.adapt(P,p.type);return new y.Hb(Math.max(M.r,h),Math.min(M.g,Q),Math.min(M.b,mp),Math.min(M.a,w))}}break}b=p=>Math.max(M.getConnectedValue(p),Q.getConnectedValue(p))}this.output._storedFunction=p=>M.type===Tb.Int?0|b(p):b(p)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Tb.Int||this.left.type===Tb.Float&&this.right.type!==Tb.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[p,b]of[[this.left,this.right],[this.right,this.left]])p.acceptedConnectionPointTypes=[Tb.Int,Tb.Float],b.isConnected&&(p.acceptedConnectionPointTypes.push(b.type),b.type!==Tb.Int&&b.type!==Tb.Float||p.acceptedConnectionPointTypes.push(Tb.Vector2,Tb.QM,Tb.Hb))}dispose(){super.dispose();for(const p of this._connectionObservers)p.remove();this._connectionObservers.length=0}serialize(){const p=super.serialize();return p.operation=this.operation,p}_deserialize(p){super._deserialize(p),this.operation=p.operation}}(0,U.e)([rb("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Db.Add},{label:"Subtract",value:Db.Subtract},{label:"Multiply",value:Db.Multiply},{label:"Divide",value:Db.Divide},{label:"Max",value:Db.Max},{label:"Min",value:Db.Min}]})],bM.prototype,"operation",void 0),(0,P.c)("BABYLON.ParticleMathBlock",bM);class MM extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerInput("direction1",Tb.QM,!0,new h.QM(0,1,0)),this.registerInput("direction2",Tb.QM,!0,new h.QM(0,1,0)),this.registerInput("minEmitBox",Tb.QM,!0,new h.QM(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Tb.QM,!0,new h.QM(.5,.5,.5)),this.registerOutput("output",Tb.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(p){const b=this.particle.getConnectedValue(p);b._directionCreation.process=M=>{p.particleContext=M,p.systemContext=b;const Q=this.direction1.getConnectedValue(p),mp=this.direction2.getConnectedValue(p),y=(0,t.RandomRange)(Q.x,mp.x),P=(0,t.RandomRange)(Q.y,mp.y),w=(0,t.RandomRange)(Q.z,mp.z);p.isEmitterTransformNode?h.QM.TransformNormalFromFloatsToRef(y,P,w,p.emitterWorldMatrix,M.direction):M.direction.sb(y,P,w)},b._positionCreation.process=M=>{p.particleContext=M,p.systemContext=b;const Q=this.minEmitBox.getConnectedValue(p),mp=this.maxEmitBox.getConnectedValue(p),y=(0,t.RandomRange)(Q.x,mp.x),P=(0,t.RandomRange)(Q.y,mp.y),w=(0,t.RandomRange)(Q.z,mp.z);p.isEmitterTransformNode?h.QM.TransformCoordinatesFromFloatsToRef(y,P,w,p.emitterWorldMatrix,M.position):(M.position.sb(y,P,w),M.position.addInPlace(p.emitterPosition))},this.output._storedValue=b}}(0,P.c)("BABYLON.BoxShapeBlock",MM);class hM extends Kb{constructor(p){super(p),this.registerInput("emitPower",Tb.Float,!0,1),this.registerInput("lifeTime",Tb.Float,!0,1),this.registerInput("color",Tb.Hb,!0,new y.Hb(1,1,1,1)),this.registerInput("scale",Tb.Vector2,!0,new h.Vector2(1,1)),this.registerInput("angle",Tb.Float,!0,0),this.registerOutput("particle",Tb.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(p){const b=new Pb(this.name,p.XM,p.yM,null,!1,void 0,!0);b.particleEmitterType=new f,b._lifeTimeCreation.process=(b,M)=>{p.particleContext=b,b.lifeTime=this.lifeTime.getConnectedValue(p),M._emitPower=this.emitPower.getConnectedValue(p)},b._colorCreation.process=b=>{p.particleContext=b,b.color.mp(this.color.getConnectedValue(p))},b._sizeCreation.process=b=>{p.particleContext=b,b.size=1,b.scale.mp(this.scale.getConnectedValue(p))},b._angleCreation.process=b=>{p.particleContext=b,b.angle=this.angle.getConnectedValue(p)},this.particle._storedValue=b}}(0,P.c)("BABYLON.CreateParticleBlock",hM);class QM{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const p=[];for(const b of this.attachedBlocks)b.isInput&&p.push(b);return p}constructor(p){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new A.d,this.name=p}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(p){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(p)&&this.attachedBlocks.push(p);for(const M of p.inputs){const h=M.connectedPoint;if(h){const M=h.ownerBlock;M!==p&&this._initializeBlock(M,b)}}}async buildAsync(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((M=>{const h=new ub;for(const p of this._systemBlocks)this._initializeBlock(p);for(const Q of this.systemBlocks){const M=new kb;M.buildId=this._buildId++,M.yM=p,M.verbose=b;const mp=Q.createSystem(M);M.emitErrors(),h.systems.push(mp)}this.onBuildObservable.notifyObservers(this),M(h)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const p=new nb("Particle system"),b=new pM("Update position");b.output.connectTo(p.particle);const M=new Cb("Position");M.contextualValue=jb.Position;const h=new Cb("Scaled direction");h.contextualValue=jb.ScaledDirection;const Q=new bM("Add");Q.operation=Db.Add,M.output.connectTo(Q.left),h.output.connectTo(Q.right),Q.output.connectTo(b.position);const mp=new hM("Create particle"),y=new MM("Box shape");mp.particle.connectTo(y.particle),y.output.connectTo(b.particle);const P=new Fb("Texture");P.texture.connectTo(p.texture),P.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(p)}removeBlock(p){const b=this.attachedBlocks.indexOf(p);if(b>-1&&this.attachedBlocks.splice(b,1),p.isSystem){const b=this._systemBlocks.indexOf(p);b>-1&&this._systemBlocks.splice(b,1)}}parseSerializedObject(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b||this.clear();const M={};for(const h of p.ix){const p=(0,P.b)(h.customType);if(p){const b=new p;b._deserialize(h),M[h.id]=b,this.attachedBlocks.push(b),b.isSystem&&this._systemBlocks.push(b)}}for(const h of this.attachedBlocks)if(h.isTeleportOut){const p=h,b=p._tempEntryPointUniqueId;if(b){const h=M[b];h&&h.attachToEndpoint(p)}}for(let h=0;h<p.ix.length;h++){const Q=p.ix[h],mp=M[Q.id];mp&&(mp.inputs.length&&Q.inputs.some((p=>p.targetConnectionName))&&!b||this._restoreConnections(mp,p,M))}if(p.locations||p.editorData&&p.editorData.locations){const h=p.locations||p.editorData.locations;for(const p of h)M[p.oQ]&&(p.oQ=M[p.oQ].uniqueId);b&&this.editorData&&this.editorData.locations&&h.concat(this.editorData.locations),p.locations?this.editorData={locations:h}:(this.editorData=p.editorData,this.editorData.locations=h);const Q=[];for(const p in M)Q[p]=M[p].uniqueId;this.editorData.map=Q}this.comment=p.comment}_restoreConnections(p,b,M){for(const h of p.outputs)for(const Q of b.ix){const mp=M[Q.id];if(mp)for(const y of Q.inputs)if(M[y.targetBlockId]!==p||y.targetConnectionName!==h.name);else{const p=mp.getInputByName(y.inputName);if(!p||p.isConnected)continue;h.connectTo(p,!0),this._restoreConnections(mp,b,M)}}}serialize(p){const b=p?{}:B.e.Serialize(this);b.editorData=JSON.parse(JSON.stringify(this.editorData));let M=[];p?M=p:b.customType="BABYLON.NodeParticleSystemSet",b.ix=[];for(const h of M)b.ix.push(h.serialize());if(!p)for(const h of this.attachedBlocks)-1===M.indexOf(h)&&b.ix.push(h.serialize());return b}dispose(){for(const p of this.attachedBlocks)p.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(p){const b=new QM(p);return b.setToDefault(),b}static Parse(p){const b=B.e.Parse((()=>new QM(p.name)),p,null);return b.parseSerializedObject(p),b}static ParseFromSnippetAsync(p,b){return"_BLANK"===p?Promise.resolve(QM.CreateDefault("blank")):new Promise(((M,h)=>{const Q=new eb.e;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const y=JSON.parse(JSON.parse(Q.responseText).jsonPayload),P=JSON.parse(y.nodeParticle);b||(b=B.e.Parse((()=>new QM(p)),P,null)),b.parseSerializedObject(P),b.snippetId=p;try{M(b)}catch(mp){h(mp)}}else h("Unable to load the snippet "+p)})),Q.open("GET",this.SnippetUrl+"/"+p.replace(/#/g,"/")),Q.send()}))}}QM.EditorURL=`${ob.Tools._DefaultCdnUrl}/v${rp.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,QM.SnippetUrl="https://snippet.babylonjs.com",(0,U.e)([(0,q.N)()],QM.prototype,"name",void 0),(0,U.e)([(0,q.N)("comment")],QM.prototype,"comment",void 0),function(p){p[p.None=0]="None",p[p.PerParticle=1]="PerParticle",p[p.PerSystem=2]="PerSystem"}(Nb||(Nb={}));class mh extends Kb{constructor(p){super(p),this._currentLockId=-2,this.lockMode=Nb.PerParticle,this.registerInput("min",Tb.AutoDetect,!0,0),this.registerInput("max",Tb.AutoDetect,!0,1),this.registerOutput("output",Tb.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tb.Float|Tb.Int|Tb.Vector2|Tb.QM|Tb.Hb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Tb.Float|Tb.Int|Tb.Vector2|Tb.QM|Tb.Hb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Tb.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let p=null;switch(this._currentLockId=-2,this.min.type){case Tb.AutoDetect:case Tb.Int:case Tb.Float:p=p=>{const b=this.min.getConnectedValue(p)||0,M=this.max.getConnectedValue(p)||1;return b+Math.random()*(M-b)};break;case Tb.Vector2:p=p=>{const b=this.min.getConnectedValue(p)||h.Vector2.Zero(),M=this.max.getConnectedValue(p)||h.Vector2.One();return new h.Vector2(b.x+Math.random()*(M.x-b.x),b.y+Math.random()*(M.y-b.y))};break;case Tb.QM:p=p=>{const b=this.min.getConnectedValue(p)||h.QM.Zero(),M=this.max.getConnectedValue(p)||h.QM.One();return new h.QM(b.x+Math.random()*(M.x-b.x),b.y+Math.random()*(M.y-b.y),b.z+Math.random()*(M.z-b.z))};break;case Tb.Hb:p=p=>{const b=this.min.getConnectedValue(p)||new y.Hb(0,0,0,0),M=this.max.getConnectedValue(p)||new y.Hb(1,1,1,1);return new y.Hb(b.x+Math.random()*(M.x-b.x),b.y+Math.random()*(M.y-b.y),b.z+Math.random()*(M.z-b.z),b.w+Math.random()*(M.w-b.w))}}this.output._storedFunction=b=>{var M;let h=0;switch(this.lockMode){case Nb.PerParticle:h=(null===(M=b.particleContext)||void 0===M?void 0:M.id)||-1;break;case Nb.PerSystem:h=b.buildId||0}return this._currentLockId!==h&&(this.lockMode!==Nb.None&&(this._currentLockId=h),this.output._storedValue=p(b)),this.output._storedValue}}serialize(){const p=super.serialize();return p.lockMode=this.lockMode,p}_deserialize(p){super._deserialize(p),this.lockMode=p.lockMode}}(0,U.e)([rb("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Nb.None},{label:"Per particle",value:Nb.PerParticle},{label:"Per system",value:Nb.PerSystem}]})],mh.prototype,"lockMode",void 0),(0,P.c)("BABYLON.ParticleRandomBlock",mh);class yM extends Kb{constructor(p){super(p),this._currentLockId=-2,this.lockMode=Nb.PerParticle,this.registerInput("min",Tb.AutoDetect),this.registerInput("max",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const b=[Tb.Matrix,Tb.Particle,Tb.Texture,Tb.System,Tb.FloatGradient,Tb.Color4Gradient,Tb.Vector2Gradient,Tb.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...b),this.max.excludedConnectionPointTypes.push(...b)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let p=null;switch(this._currentLockId=-2,this.min.type){case Tb.Float:case Tb.Int:p=p=>{const b=this.min.getConnectedValue(p),M=this.max.getConnectedValue(p);return Math.random()*(M-b)+b};break;case Tb.Vector2:p=p=>{const b=this.min.getConnectedValue(p),M=this.max.getConnectedValue(p);return new h.Vector2(Math.random()*(M.x-b.x)+b.x,Math.random()*(M.y-b.y)+b.y)};break;case Tb.QM:p=p=>{const b=this.min.getConnectedValue(p),M=this.max.getConnectedValue(p);return new h.QM(Math.random()*(M.x-b.x)+b.x,Math.random()*(M.y-b.y)+b.y,Math.random()*(M.z-b.z)+b.z)};break;case Tb.Hb:p=p=>{const b=this.min.getConnectedValue(p),M=this.max.getConnectedValue(p);return new y.Hb(Math.random()*(M.r-b.r)+b.r,Math.random()*(M.g-b.g)+b.g,Math.random()*(M.b-b.b)+b.b,Math.random()*(M.a-b.a)+b.a)}}this.output._storedFunction=b=>{var M;let h=0;switch(this.lockMode){case Nb.PerParticle:h=(null===(M=b.particleContext)||void 0===M?void 0:M.id)||-1;break;case Nb.PerSystem:h=b.buildId||0}return this._currentLockId!==h&&(this.lockMode!==Nb.None&&(this._currentLockId=h),this.output._storedValue=p(b)),this.output._storedValue}}serialize(){const p=super.serialize();return p.lockMode=this.lockMode,p}_deserialize(p){super._deserialize(p),void 0!==p.lockMode&&(this.lockMode=p.lockMode)}}(0,U.e)([rb("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Nb.None},{label:"Per particle",value:Nb.PerParticle},{label:"Per system",value:Nb.PerSystem}]})],yM.prototype,"lockMode",void 0),(0,P.c)("BABYLON.RandomRangeBlock",yM);(0,P.c)("BABYLON.ParticleLerpBlock",class extends Kb{constructor(p){super(p),this.registerInput("left",Tb.AutoDetect),this.registerInput("right",Tb.AutoDetect),this.registerInput("gradient",Tb.Float,!0,0,0,1),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tb.Float|Tb.Int|Tb.Vector2|Tb.QM|Tb.Hb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const p=(p,b,M)=>(1-p)*b+p*M;this.output._storedFunction=b=>{const M=this.left.getConnectedValue(b),Q=this.right.getConnectedValue(b),mp=this.gradient.getConnectedValue(b);switch(this.left.type){case Tb.Int:case Tb.Float:return p(mp,M,Q);case Tb.Vector2:return new h.Vector2(p(mp,M.x,Q.x),p(mp,M.y,Q.y));case Tb.QM:return new h.QM(p(mp,M.x,Q.x),p(mp,M.y,Q.y),p(mp,M.z,Q.z));case Tb.Hb:return new y.Hb(p(mp,M.r,Q.r),p(mp,M.g,Q.g),p(mp,M.b,Q.b),p(mp,M.a,Q.a))}return 0}}});(0,P.c)("BABYLON.UpdateDirectionBlock",class extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerInput("direction",Tb.QM),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(p){const b=this.particle.getConnectedValue(p);if(this.output._storedValue=b,!this.direction.isConnected)return;const M={process:M=>{p.particleContext=M,p.systemContext=b,M.direction.mp(this.direction.getConnectedValue(p))},previousItem:null,nextItem:null};b._updateQueueStart?Vp(M,b._updateQueueStart):b._updateQueueStart=M}});(0,P.c)("BABYLON.UpdateColorBlock",class extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerInput("color",Tb.Hb),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(p){const b=this.particle.getConnectedValue(p);if(this.output._storedValue=b,!this.color.isConnected)return;const M={process:M=>{p.particleContext=M,p.systemContext=b,M.color.mp(this.color.getConnectedValue(p))},previousItem:null,nextItem:null};b._updateQueueStart?Vp(M,b._updateQueueStart):b._updateQueueStart=M}});(0,P.c)("BABYLON.UpdateScaleBlock",class extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerInput("scale",Tb.Vector2),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(p){const b=this.particle.getConnectedValue(p);if(this.output._storedValue=b,!this.scale.isConnected)return;const M={process:M=>{p.particleContext=M,p.systemContext=b,M.scale.mp(this.scale.getConnectedValue(p))},previousItem:null,nextItem:null};b._updateQueueStart?Vp(M,b._updateQueueStart):b._updateQueueStart=M}});(0,P.c)("BABYLON.UpdateAngleBlock",class extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerInput("angle",Tb.Float),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(p){const b=this.particle.getConnectedValue(p);if(this.output._storedValue=b,!this.angle.isConnected)return;const M={process:M=>{p.particleContext=M,p.systemContext=b,M.angle=this.angle.getConnectedValue(p)},previousItem:null,nextItem:null};b._updateQueueStart?Vp(M,b._updateQueueStart):b._updateQueueStart=M}});(0,P.c)("BABYLON.BasicPositionUpdateBlock",class extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(p){const b=this.particle.getConnectedValue(p),M={process:M=>{p.particleContext=M,p.systemContext=b,M.direction.scaleToRef(b._directionScale,b._scaledDirection),M.position.addInPlace(b._scaledDirection)},previousItem:null,nextItem:null};b._updateQueueStart?Vp(M,b._updateQueueStart):b._updateQueueStart=M,this.output._storedValue=b}});(0,P.c)("BABYLON.BasicSpriteUpdateBlock",class extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(p){const b=this.particle.getConnectedValue(p),M={process:M=>{p.particleContext=M,p.systemContext=b,M.updateCellIndex()},previousItem:null,nextItem:null};b._updateQueueStart?Vp(M,b._updateQueueStart):b._updateQueueStart=M,this.output._storedValue=b}});(0,P.c)("BABYLON.UpdateSpriteCellIndexBlock",class extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerInput("cellIndex",Tb.Int),this.registerOutput("output",Tb.Particle),this.cellIndex.acceptedConnectionPointTypes=[Tb.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(p){const b=this.particle.getConnectedValue(p);if(this.output._storedValue=b,!this.cellIndex.isConnected)return;const M={process:M=>{p.particleContext=M,p.systemContext=b,M.cellIndex=Math.floor(this.cellIndex.getConnectedValue(p))},previousItem:null,nextItem:null};b._updateQueueStart?Vp(M,b._updateQueueStart):b._updateQueueStart=M}});class PM extends Kb{constructor(p){super(p),this.strength=1,this.registerInput("particle",Tb.Particle),this.registerInput("flowMap",Tb.Texture),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(p){var b;const M=this.particle.getConnectedValue(p),h=p.yM;let Q;(null===(b=this.flowMap.connectedPoint)||void 0===b?void 0:b.ownerBlock).extractTextureContentAsync().then((p=>{p&&(Q=new ib(p.width,p.height,p.data))}));const mp={process:p=>{const b=h.getTransformMatrix();Q&&Q._processParticle(p,this.strength*M._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null};M._updateQueueStart?Vp(mp,M._updateQueueStart):M._updateQueueStart=mp,this.output._storedValue=M}serialize(){const p=super.serialize();return p.strength=this.strength,p}_deserialize(p){super._deserialize(p),this.strength=p.strength}}(0,U.e)([rb("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],PM.prototype,"strength",void 0),(0,P.c)("BABYLON.UpdateFlowMapBlock",PM);(0,P.c)("BABYLON.SphereShapeBlock",class extends Kb{constructor(p){super(p),this.registerInput("input",Tb.Particle),this.registerInput("radius",Tb.Float,!0,1),this.registerInput("radiusRange",Tb.Float,!0,1,0,1),this.registerInput("directionRandomizer",Tb.Float,!0,0,0,1),this.registerOutput("output",Tb.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(p){const b=this.input.getConnectedValue(p);b._directionCreation.process=M=>{p.particleContext=M,p.systemContext=b;const Q=this.directionRandomizer.getConnectedValue(p),mp=M.position.mh(p.emitterPosition).normalize(),y=(0,t.RandomRange)(0,Q),P=(0,t.RandomRange)(0,Q),w=(0,t.RandomRange)(0,Q);mp.x+=y,mp.y+=P,mp.z+=w,mp.normalize(),p.isEmitterTransformNode?h.QM.TransformNormalFromFloatsToRef(y,P,w,p.emitterWorldMatrix,M.direction):M.direction.sb(y,P,w)},b._positionCreation.process=M=>{p.particleContext=M,p.systemContext=b;const Q=this.radius.getConnectedValue(p),mp=this.radiusRange.getConnectedValue(p),y=Q-(0,t.RandomRange)(0,Q*mp),P=(0,t.RandomRange)(0,1),w=(0,t.RandomRange)(0,2*Math.PI),z=Math.acos(2*P-1),x=y*Math.cos(w)*Math.sin(z),S=y*Math.cos(z),X=y*Math.sin(w)*Math.sin(z);p.isEmitterTransformNode?h.QM.TransformCoordinatesFromFloatsToRef(x,S,X,p.emitterWorldMatrix,M.position):(M.position.sb(x,S,X),M.position.addInPlace(p.emitterPosition))},this.output._storedValue=b}});(0,P.c)("BABYLON.PointShapeBlock",class extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerInput("direction1",Tb.QM,!0,new h.QM(0,1,0)),this.registerInput("direction2",Tb.QM,!0,new h.QM(0,1,0)),this.registerOutput("output",Tb.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(p){const b=this.particle.getConnectedValue(p);b._directionCreation.process=M=>{p.particleContext=M,p.systemContext=b;const Q=this.direction1.getConnectedValue(p),mp=this.direction2.getConnectedValue(p),y=(0,t.RandomRange)(Q.x,mp.x),P=(0,t.RandomRange)(Q.y,mp.y),w=(0,t.RandomRange)(Q.z,mp.z);p.isEmitterTransformNode?h.QM.TransformNormalFromFloatsToRef(y,P,w,p.emitterWorldMatrix,M.direction):M.direction.sb(y,P,w)},b._positionCreation.process=M=>{p.systemContext=b,p.isEmitterTransformNode?h.QM.TransformCoordinatesFromFloatsToRef(0,0,0,p.emitterWorldMatrix,M.position):M.position.mp(p.emitterPosition)},this.output._storedValue=b}});(0,P.c)("BABYLON.CustomShapeBlock",class extends Kb{constructor(p){super(p),this.registerInput("particle",Tb.Particle),this.registerInput("position",Tb.QM,!0,new h.QM(0,0,0)),this.registerInput("direction",Tb.QM,!0,new h.QM(0,1,0)),this.registerOutput("output",Tb.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(p){const b=this.particle.getConnectedValue(p);b._directionCreation.process=M=>{p.particleContext=M,p.systemContext=b;const Q=this.direction.getConnectedValue(p);p.isEmitterTransformNode?h.QM.TransformNormalToRef(Q,p.emitterWorldMatrix,M.direction):M.direction.mp(Q)},b._positionCreation.process=M=>{p.particleContext=M,p.systemContext=b;const Q=this.position.getConnectedValue(p);p.isEmitterTransformNode?h.QM.TransformCoordinatesToRef(Q,p.emitterWorldMatrix,M.position):(M.position.mp(Q),M.position.addInPlace(p.emitterPosition))},this.output._storedValue=b}});(0,P.c)("BABYLON.CylinderShapeBlock",class extends Kb{constructor(p){super(p),this._tempVector=h.QM.Zero(),this.registerInput("particle",Tb.Particle),this.registerInput("radius",Tb.Float,!0,1),this.registerInput("height",Tb.Float,!0,1,0),this.registerInput("radiusRange",Tb.Float,!0,1,0,1),this.registerInput("directionRandomizer",Tb.Float,!0,0,0,1),this.registerOutput("output",Tb.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(p){const b=this.particle.getConnectedValue(p);b._directionCreation.process=M=>{p.particleContext=M,p.systemContext=b;const Q=this.directionRandomizer.getConnectedValue(p);M.position.subtractToRef(p.emitterPosition,this._tempVector),this._tempVector.normalize(),p.isEmitterTransformNode&&h.QM.TransformNormalToRef(this._tempVector,p.emitterInverseWorldMatrix,this._tempVector);const mp=(0,t.RandomRange)(-Q/2,Q/2);let y=Math.atan2(this._tempVector.x,this._tempVector.z);y+=(0,t.RandomRange)(-Math.PI/2,Math.PI/2)*Q,this._tempVector.y=mp,this._tempVector.x=Math.sin(y),this._tempVector.z=Math.cos(y),this._tempVector.normalize(),p.isEmitterTransformNode?h.QM.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,p.emitterWorldMatrix,M.direction):M.direction.mp(this._tempVector)},b._positionCreation.process=M=>{p.particleContext=M,p.systemContext=b;const Q=this.height.getConnectedValue(p),mp=this.radiusRange.getConnectedValue(p),y=this.radius.getConnectedValue(p),P=(0,t.RandomRange)(-Q/2,Q/2),w=(0,t.RandomRange)(0,2*Math.PI),z=(0,t.RandomRange)((1-mp)*(1-mp),1),x=Math.sqrt(z)*y,S=x*Math.cos(w),X=x*Math.sin(w);p.isEmitterTransformNode?h.QM.TransformCoordinatesFromFloatsToRef(S,P,X,p.emitterWorldMatrix,M.position):(M.position.sb(S,P,X),M.position.addInPlace(p.emitterPosition))},this.output._storedValue=b}});class wM extends Kb{constructor(p){super(p),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Tb.Particle),this.registerOutput("output",Tb.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(p){super._build(p);const b=this.particle.getConnectedValue(p);b._isAnimationSheetEnabled=!0,b.spriteCellWidth=this.width,b.spriteCellHeight=this.height,b.startSpriteCellID=this.start,b.endSpriteCellID=this.end,b.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=b}serialize(){const p=super.serialize();return p.width=this.width,p.height=this.height,p.start=this.start,p.end=this.end,p.randomStartCell=this.randomStartCell,p}_deserialize(p){super._deserialize(p),this.width=p.width,this.height=p.height,this.start=p.start,this.end=p.end,this.randomStartCell=p.randomStartCell}}(0,U.e)([rb("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wM.prototype,"start",void 0),(0,U.e)([rb("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wM.prototype,"end",void 0),(0,U.e)([rb("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wM.prototype,"width",void 0),(0,U.e)([rb("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wM.prototype,"height",void 0),(0,U.e)([rb("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wM.prototype,"loop",void 0),(0,U.e)([rb("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wM.prototype,"randomStartCell",void 0),(0,P.c)("BABYLON.SetupSpriteSheetBlock",wM);class tM extends Kb{constructor(p){super(p),this.reference=0,this.registerInput("value",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=p=>{switch(p){case Tb.Float:return Tb.FloatGradient;case Tb.Vector2:return Tb.Vector2Gradient;case Tb.QM:return Tb.Vector3Gradient;case Tb.Hb:return Tb.Color4Gradient}return p},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tb.Float|Tb.Vector2|Tb.QM|Tb.Hb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=p=>null}serialize(){const p=super.serialize();return p.reference=this.reference,p}_deserialize(p){super._deserialize(p),this.reference=p.reference}}(0,U.e)([rb("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],tM.prototype,"reference",void 0),(0,P.c)("BABYLON.ParticleGradientValueBlock",tM);(0,P.c)("BABYLON.ParticleGradientBlock",class extends Kb{constructor(p){super(p),this._entryCount=1,this.registerInput("gradient",Tb.Float,!0,1,0,1),this.registerInput("value0",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=p=>{switch(p){case Tb.FloatGradient:return Tb.Float;case Tb.Vector2Gradient:return Tb.Vector2;case Tb.Vector3Gradient:return Tb.QM;case Tb.Color4Gradient:return Tb.Hb}return p},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Tb.FloatGradient|Tb.Vector2Gradient|Tb.Vector3Gradient|Tb.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(p){this._inputs[p].onConnectionObservable.add((()=>{this._entryCount>p||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Tb.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const p=[];for(let M=1;M<this._inputs.length;M++){var b;if(this._inputs[M].isConnected)p.push(null===(b=this._inputs[M].connectedPoint)||void 0===b?void 0:b.ownerBlock)}p.sort(((p,b)=>p.reference-b.reference)),this.output._storedFunction=b=>{const M=this.gradient.getConnectedValue(b);if(1===p.length)return p[0].value.getConnectedValue(b);let Q=null;for(let mp=p.length-1;mp>=0;mp--){const P=p[mp];if(P.reference<=M){const p=P.value.getConnectedValue(b);if(Q){const mp=Q.value.getConnectedValue(b),w=Q.reference,z=P.reference,x=Math.max(0,Math.min(1,(M-z)/(w-z)));switch(this.output.type){case Tb.Float:return(0,t.Lerp)(p,mp,x);case Tb.Vector2:return h.Vector2.Lerp(p,mp,x);case Tb.QM:return h.QM.Lerp(p,mp,x);case Tb.Hb:return y.Hb.Lerp(p,mp,x)}}return p}Q=P}return 0}}});(0,P.c)("BABYLON.ParticleConverterBlock",class extends Kb{constructor(p){super(p),this.registerInput("color ",Tb.Hb,!0),this.registerInput("xyz ",Tb.QM,!0),this.registerInput("xy ",Tb.Vector2,!0),this.registerInput("zw ",Tb.Vector2,!0),this.registerInput("x ",Tb.Float,!0),this.registerInput("y ",Tb.Float,!0),this.registerInput("z ",Tb.Float,!0),this.registerInput("w ",Tb.Float,!0),this.registerOutput("color",Tb.Hb),this.registerOutput("xyz",Tb.QM),this.registerOutput("xy",Tb.Vector2),this.registerOutput("zw",Tb.Vector2),this.registerOutput("x",Tb.Float),this.registerOutput("y",Tb.Float),this.registerOutput("z",Tb.Float),this.registerOutput("w",Tb.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(p){return"color "===p?"colorIn":"xyz "===p?"xyzIn":"xy "===p?"xyIn":"zw "===p?"zwIn":"x "===p?"xIn":"y "===p?"yIn":"z "===p?"zIn":"w "===p?"wIn":p}_outputRename(p){switch(p){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return p}}_build(p){super._build(p);const b=this.xIn,M=this.yIn,Q=this.zIn,mp=this.wIn,P=this.xyIn,w=this.zwIn,t=this.xyzIn,z=this.colorIn,x=this.colorOut,S=this.xyzOut,X=this.xyOut,c=this.zwOut,J=this.xOut,g=this.yOut,f=this.zOut,Y=this.wOut,a=p=>{if(z.isConnected)return z.getConnectedValue(p);let h=0,x=0,S=0,X=0;if(b.isConnected&&(h=b.getConnectedValue(p)),M.isConnected&&(x=M.getConnectedValue(p)),Q.isConnected&&(S=Q.getConnectedValue(p)),mp.isConnected&&(X=mp.getConnectedValue(p)),P.isConnected){const b=P.getConnectedValue(p);b&&(h=b.x,x=b.y)}if(w.isConnected){const b=w.getConnectedValue(p);b&&(S=b.x,X=b.y)}if(t.isConnected){const b=t.getConnectedValue(p);b&&(h=b.x,x=b.y,S=b.z)}return new y.Hb(h,x,S,X)};x._storedFunction=p=>a(p),S._storedFunction=p=>{const b=a(p);return new h.QM(b.r,b.g,b.b)},X._storedFunction=p=>{const b=a(p);return new h.Vector2(b.r,b.g)},c._storedFunction=p=>{const b=a(p);return new h.Vector2(b.b,b.a)},J._storedFunction=p=>a(p).r,g._storedFunction=p=>a(p).g,f._storedFunction=p=>a(p).b,Y._storedFunction=p=>a(p).a}}),function(p){p[p.Cos=0]="Cos",p[p.Sin=1]="Sin",p[p.Abs=2]="Abs",p[p.Exp=3]="Exp",p[p.Exp2=4]="Exp2",p[p.Round=5]="Round",p[p.Floor=6]="Floor",p[p.Ceiling=7]="Ceiling",p[p.Sqrt=8]="Sqrt",p[p.Log=9]="Log",p[p.Tan=10]="Tan",p[p.ArcTan=11]="ArcTan",p[p.ArcCos=12]="ArcCos",p[p.ArcSin=13]="ArcSin",p[p.Sign=14]="Sign",p[p.Negate=15]="Negate",p[p.OneMinus=16]="OneMinus",p[p.Reciprocal=17]="Reciprocal",p[p.ToDegrees=18]="ToDegrees",p[p.ToRadians=19]="ToRadians",p[p.Fract=20]="Fract"}(Ob||(Ob={}));class zM extends Kb{constructor(p){super(p),this.operation=Ob.Cos,this.registerInput("input",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tb.Float|Tb.Int|Tb.Vector2|Tb.QM|Tb.Hb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(p){super._build(p);let b=null;switch(this.operation){case Ob.Cos:b=p=>Math.cos(p);break;case Ob.Sin:b=p=>Math.sin(p);break;case Ob.Abs:b=p=>Math.abs(p);break;case Ob.Exp:b=p=>Math.exp(p);break;case Ob.Exp2:b=p=>Math.pow(2,p);break;case Ob.Round:b=p=>Math.round(p);break;case Ob.Floor:b=p=>Math.floor(p);break;case Ob.Ceiling:b=p=>Math.ceil(p);break;case Ob.Sqrt:b=p=>Math.sqrt(p);break;case Ob.Log:b=p=>Math.log(p);break;case Ob.Tan:b=p=>Math.tan(p);break;case Ob.ArcTan:b=p=>Math.atan(p);break;case Ob.ArcCos:b=p=>Math.acos(p);break;case Ob.ArcSin:b=p=>Math.asin(p);break;case Ob.Sign:b=p=>Math.sign(p);break;case Ob.Negate:b=p=>-p;break;case Ob.OneMinus:b=p=>1-p;break;case Ob.Reciprocal:b=p=>1/p;break;case Ob.ToRadians:b=p=>p*Math.PI/180;break;case Ob.ToDegrees:b=p=>180*p/Math.PI;break;case Ob.Fract:b=p=>p>=0?p-Math.floor(p):p-Math.ceil(p)}if(!b)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Tb.Int:case Tb.Float:this.output._storedFunction=p=>{const M=this.input.getConnectedValue(p);return b(M)};break;case Tb.Vector2:this.output._storedFunction=p=>{const M=this.input.getConnectedValue(p);return new h.Vector2(b(M.x),b(M.y))};break;case Tb.QM:this.output._storedFunction=p=>{const M=this.input.getConnectedValue(p);return new h.QM(b(M.x),b(M.y),b(M.z))};break;case Tb.Hb:this.output._storedFunction=p=>{const M=this.input.getConnectedValue(p);return new y.Hb(b(M.r),b(M.g),b(M.b),b(M.a))}}return this}serialize(){const p=super.serialize();return p.operation=this.operation,p}_deserialize(p){super._deserialize(p),this.operation=p.operation}}(0,U.e)([rb("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Ob.Cos},{label:"Sin",value:Ob.Sin},{label:"Abs",value:Ob.Abs},{label:"Exp",value:Ob.Exp},{label:"Exp2",value:Ob.Exp2},{label:"Round",value:Ob.Round},{label:"Floor",value:Ob.Floor},{label:"Ceiling",value:Ob.Ceiling},{label:"Sqrt",value:Ob.Sqrt},{label:"Log",value:Ob.Log},{label:"Tan",value:Ob.Tan},{label:"ArcTan",value:Ob.ArcTan},{label:"ArcCos",value:Ob.ArcCos},{label:"ArcSin",value:Ob.ArcSin},{label:"Sign",value:Ob.Sign},{label:"Negate",value:Ob.Negate},{label:"OneMinus",value:Ob.OneMinus},{label:"Reciprocal",value:Ob.Reciprocal},{label:"ToDegrees",value:Ob.ToDegrees},{label:"ToRadians",value:Ob.ToRadians},{label:"Fract",value:Ob.Fract}]})],zM.prototype,"operation",void 0),(0,P.c)("BABYLON.ParticleTrigonometryBlock",zM);var xM,SM=M(14008);class XM extends Kb{constructor(p){super(p),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Tb.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Tb.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tb.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tb.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tb.System),this._inputs[0].excludedConnectionPointTypes.push(Tb.Particle),this._inputs[0].excludedConnectionPointTypes.push(Tb.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(p){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const b=p=>{const b=this.input.getConnectedValue(p);if(this.log.length>=this.stackSize)return b;if(null===b||void 0===b)return this.log.push(["null",""]),b;switch(this.input.type){case Tb.Vector2:this.log.push([(0,SM.h)(b,4),b.toString()]);break;case Tb.QM:this.log.push([(0,SM.l)(b,4),b.toString()]);break;case Tb.Hb:this.log.push([`{R: ${b.r.toFixed(4)} G: ${b.g.toFixed(4)} B: ${b.b.toFixed(4)} A: ${b.a.toFixed(4)}}`,b.toString()]);break;default:this.log.push([b.toString(),b.toString()])}return b};this.output.isConnected?this.output._storedFunction=b:this.output._storedValue=b(p)}serialize(){const p=super.serialize();return p.stackSize=this.stackSize,p}_deserialize(p){super._deserialize(p),this.stackSize=p.stackSize}}(0,U.e)([rb("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],XM.prototype,"stackSize",void 0),(0,P.c)("BABYLON.ParticleDebugBlock",XM);(0,P.c)("BABYLON.ParticleElbowBlock",class extends Kb{constructor(p){super(p),this.registerInput("input",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(p){super._build(p);const b=this._outputs[0],M=this._inputs[0];b._storedFunction=p=>M.getConnectedValue(p)}});(0,P.c)("BABYLON.ParticleTeleportInBlock",class extends Kb{get endpoints(){return this._endpoints}constructor(p){super(p),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Tb.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(p){if(this.getClassName()===p)return!0;for(const b of this.endpoints)if(b.isAnAncestorOfType(p))return!0;return!1}isAnAncestorOf(p){for(const b of this.endpoints){if(b===p)return!0;if(b.isAnAncestorOf(p))return!0}return!1}attachToEndpoint(p){p.detach(),this._endpoints.push(p),p._entryPoint=this,p._outputs[0]._typeConnectionSource=this._inputs[0],p._tempEntryPointUniqueId=null,p.name="> "+this.name}detachFromEndpoint(p){const b=this._endpoints.indexOf(p);-1!==b&&(this._endpoints.splice(b,1),p._outputs[0]._typeConnectionSource=null,p._entryPoint=null)}_build(){for(const p of this._endpoints)p.output._storedFunction=p=>this.input.getConnectedValue(p)}});(0,P.c)("BABYLON.ParticleTeleportOutBlock",class extends Kb{constructor(p){super(p),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Tb.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(p){this.entryPoint&&this.entryPoint.build(p)}clone(){const p=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(p),p}serialize(){var p;const b=super.serialize();return b.entryPoint=(null===(p=this.entryPoint)||void 0===p?void 0:p.uniqueId)??"",b}_deserialize(p){super._deserialize(p),this._tempEntryPointUniqueId=p.entryPoint}}),function(p){p[p.Equal=0]="Equal",p[p.NotEqual=1]="NotEqual",p[p.LessThan=2]="LessThan",p[p.GreaterThan=3]="GreaterThan",p[p.LessOrEqual=4]="LessOrEqual",p[p.GreaterOrEqual=5]="GreaterOrEqual",p[p.Xor=6]="Xor",p[p.Or=7]="Or",p[p.And=8]="And"}(xM||(xM={}));class cM extends Kb{constructor(p){super(p),this.test=xM.Equal,this.epsilon=0,this.registerInput("left",Tb.Float),this.registerInput("right",Tb.Float,!0,0),this.registerInput("ifTrue",Tb.AutoDetect,!0,1),this.registerInput("ifFalse",Tb.AutoDetect,!0,0),this.registerOutput("output",Tb.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Tb.Float,this._inputs[0].acceptedConnectionPointTypes.push(Tb.Int),this._inputs[1].acceptedConnectionPointTypes.push(Tb.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const p=p=>{const b=this.left.getConnectedValue(p),M=this.right.getConnectedValue(p);let h=!1;switch(this.test){case xM.Equal:h=(0,t.WithinEpsilon)(b,M,this.epsilon);break;case xM.NotEqual:h=!(0,t.WithinEpsilon)(b,M,this.epsilon);break;case xM.LessThan:h=b<M+this.epsilon;break;case xM.GreaterThan:h=b>M-this.epsilon;break;case xM.LessOrEqual:h=b<=M+this.epsilon;break;case xM.GreaterOrEqual:h=b>=M-this.epsilon;break;case xM.Xor:h=!!b&&!M||!b&&!!M;break;case xM.Or:h=!!b||!!M;break;case xM.And:h=!!b&&!!M}return h};this.output._storedFunction=b=>p(b)?this.ifTrue.getConnectedValue(b):this.ifFalse.getConnectedValue(b)}serialize(){const p=super.serialize();return p.test=this.test,p.epsilon=this.epsilon,p}_deserialize(p){super._deserialize(p),this.test=p.test,void 0!==p.epsilon&&(this.epsilon=p.epsilon)}}(0,U.e)([rb("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:xM.Equal},{label:"NotEqual",value:xM.NotEqual},{label:"LessThan",value:xM.LessThan},{label:"GreaterThan",value:xM.GreaterThan},{label:"LessOrEqual",value:xM.LessOrEqual},{label:"GreaterOrEqual",value:xM.GreaterOrEqual},{label:"Xor",value:xM.Xor},{label:"Or",value:xM.Or},{label:"And",value:xM.And}]})],cM.prototype,"test",void 0),(0,U.e)([rb("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],cM.prototype,"epsilon",void 0),(0,P.c)("BABYLON.ParticleConditionBlock",cM);class JM extends Kb{constructor(p){super(p),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Tb.Particle),this.registerInput("condition",Tb.Float,!0,0),this.registerInput("system",Tb.System),this.registerOutput("output",Tb.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(p){this._triggerCount=0;const b=this.input.getConnectedValue(p),M={process:M=>{if(p.particleContext=M,p.systemContext=b,0!==this.condition.getConnectedValue(p)&&(0===this.limit||this._triggerCount<this.limit)){const h=(new Date).getTime();if(this._previousOne&&h-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=h;const Q=this.system.getConnectedValue(p);if(Q){const h=Ab(Q,p.yM,M.position);h.Xb.addOnce((()=>{this._triggerCount--})),b.Xb.addOnce((()=>{h.dispose()}))}}},previousItem:null,nextItem:null};b._updateQueueStart?Vp(M,b._updateQueueStart):b._updateQueueStart=M,this.output._storedValue=b}serialize(){const p=super.serialize();return p.limit=this.limit,p.delay=this.delay,p}_deserialize(p){super._deserialize(p),void 0!==p.limit&&(this.limit=p.limit),void 0!==p.delay&&(this.delay=p.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,U.e)([rb("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JM.prototype,"limit",void 0),(0,U.e)([rb("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JM.prototype,"delay",void 0),(0,P.c)("BABYLON.ParticleTriggerBlock",JM);M(14013),M(14022),M(14026),M(14084)},14063:(p,b,M)=>{"use strict";var h=M(12695);const Q="clipPlaneFragment",mp="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14033:(p,b,M)=>{"use strict";var h=M(12695);const Q="clipPlaneFragmentDeclaration",mp="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14099:(p,b,M)=>{"use strict";var h=M(12695);const Q="clipPlaneVertex",mp="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14086:(p,b,M)=>{"use strict";var h=M(12695);const Q="clipPlaneVertexDeclaration",mp="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14080:(p,b,M)=>{"use strict";var h=M(12695);const Q="fogFragment",mp="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14055:(p,b,M)=>{"use strict";var h=M(12695);const Q="fogFragmentDeclaration",mp="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14108:(p,b,M)=>{"use strict";var h=M(12695);const Q="fogVertex",mp="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14093:(p,b,M)=>{"use strict";var h=M(12695);const Q="fogVertexDeclaration",mp="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14046:(p,b,M)=>{"use strict";var h=M(12695);const Q="helperFunctions",mp="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14038:(p,b,M)=>{"use strict";var h=M(12695);const Q="imageProcessingDeclaration",mp="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14051:(p,b,M)=>{"use strict";var h=M(12695);const Q="imageProcessingFunctions",mp="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14043:(p,b,M)=>{"use strict";var h=M(12695);const Q="logDepthDeclaration",mp="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14071:(p,b,M)=>{"use strict";var h=M(12695);const Q="logDepthFragment",mp="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14111:(p,b,M)=>{"use strict";var h=M(12695);const Q="logDepthVertex",mp="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";h.d.IncludesShadersStoreWGSL[Q]||(h.d.IncludesShadersStoreWGSL[Q]=mp)},14026:(p,b,M)=>{"use strict";M.r(b),M.d(b,{particlesPixelShaderWGSL:()=>y});var h=M(12695);M(14033),M(14038),M(14043),M(14046),M(14051),M(14055),M(14063),M(14071),M(14080);const Q="particlesPixelShader",mp="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";h.d.ShadersStoreWGSL[Q]||(h.d.ShadersStoreWGSL[Q]=mp);const y={name:Q,shader:mp}},14084:(p,b,M)=>{"use strict";M.r(b),M.d(b,{particlesVertexShaderWGSL:()=>y});var h=M(12695);M(14086),M(14093),M(14043),M(14099),M(14108),M(14111);const Q="particlesVertexShader",mp="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";h.d.ShadersStoreWGSL[Q]||(h.d.ShadersStoreWGSL[Q]=mp);const y={name:Q,shader:mp}},13945:(p,b,M)=>{"use strict";var h=M(12695);const Q="clipPlaneFragment",mp="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},14020:(p,b,M)=>{"use strict";var h=M(12695);const Q="clipPlaneFragmentDeclaration",mp="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13970:(p,b,M)=>{"use strict";var h=M(12695);const Q="clipPlaneVertex",mp="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},14024:(p,b,M)=>{"use strict";var h=M(12695);const Q="clipPlaneVertexDeclaration",mp="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13954:(p,b,M)=>{"use strict";var h=M(12695);const Q="fogFragment",mp="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13942:(p,b,M)=>{"use strict";var h=M(12695);const Q="fogFragmentDeclaration",mp="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13976:(p,b,M)=>{"use strict";var h=M(12695);const Q="fogVertex",mp="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13962:(p,b,M)=>{"use strict";var h=M(12695);const Q="fogVertexDeclaration",mp="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13930:(p,b,M)=>{"use strict";var h=M(12695);const Q="helperFunctions",mp="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13918:(p,b,M)=>{"use strict";var h=M(12695);const Q="imageProcessingDeclaration",mp="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13936:(p,b,M)=>{"use strict";var h=M(12695);const Q="imageProcessingFunctions",mp="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13923:(p,b,M)=>{"use strict";var h=M(12695);const Q="logDepthDeclaration",mp="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13950:(p,b,M)=>{"use strict";var h=M(12695);const Q="logDepthFragment",mp="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},13979:(p,b,M)=>{"use strict";var h=M(12695);const Q="logDepthVertex",mp="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";h.d.IncludesShadersStore[Q]||(h.d.IncludesShadersStore[Q]=mp)},14013:(p,b,M)=>{"use strict";M.r(b),M.d(b,{particlesPixelShader:()=>y});var h=M(12695);M(14020),M(13918),M(13923),M(13930),M(13936),M(13942),M(13945),M(13950),M(13954);const Q="particlesPixelShader",mp="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";h.d.ShadersStore[Q]||(h.d.ShadersStore[Q]=mp);const y={name:Q,shader:mp}},14022:(p,b,M)=>{"use strict";M.r(b),M.d(b,{particlesVertexShader:()=>y});var h=M(12695);M(14024),M(13962),M(13923),M(13970),M(13976),M(13979);const Q="particlesVertexShader",mp="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";h.d.ShadersStore[Q]||(h.d.ShadersStore[Q]=mp);const y={name:Q,shader:mp}},14371:(p,b,M)=>{"use strict";M.r(b),M.d(b,{FlowGraphGLTFDataProvider:()=>mp});var h=M(14341),Q=M(14316);class mp extends h.d{constructor(p){var b,M;super();const h=p.glTF,mp=(null===(b=h.animations)||void 0===b?void 0:b.map((p=>p._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",Q.e,mp);const y=(null===(M=h.nodes)||void 0===M?void 0:M.map((p=>p._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",Q.e,y)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14252:(p,b,M)=>{"use strict";M.d(b,{c:()=>g,f:()=>c,g:()=>X,h:()=>J});var h=M(12777),Q=M(13258),mp=M(12820),y=M(14254);const P=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class w{constructor(p,b){this._gltf=p,this._infoTree=b}convert(p){let b,M=this._gltf,h=this._infoTree;if(!p.startsWith("/"))throw new Error("Path must start with a /");const Q=p.split("/");if(Q.shift(),Q[Q.length-1].includes(".length")){const p=Q[Q.length-1].split(".");Q.pop(),Q.push(...p)}let mp=!1;for(const w of Q){const Q="length"===w;if(Q&&!h.__array__)throw new Error(`Path ${p} is invalid`);if(h.__ignoreObjectTree__&&(mp=!0),h.__array__&&!Q)h=h.__array__;else if(h=h[w],!h)throw new Error(`Path ${p} is invalid`);if(!mp)if(void 0===M){if(!P.find((b=>b.regex.test(p))))throw new Error(`Path ${p} is invalid`)}else if(!Q){var y;M=null===(y=M)||void 0===y?void 0:y[w]}(h.__target__||Q)&&(b=M)}return{object:b,info:h}}}function t(p,b,M,h){const Q=z(p,b);return h?Q[M][h]:Q[M]}function z(p,b,M){var h,mp;return null===(h=p._data)||void 0===h||null===(mp=h[(null===M||void 0===M?void 0:M.fillMode)??Q.b.MATERIAL_TriangleFillMode])||void 0===mp?void 0:mp.babylonMaterial}function x(p,b){return{offset:{componentsCount:2,type:"Vector2",get:(M,Q,mp)=>{const y=t(M,mp,p,b);return new h.Vector2(null===y||void 0===y?void 0:y.uOffset,null===y||void 0===y?void 0:y.vOffset)},getTarget:z,set:(M,h,Q,mp)=>{const y=t(h,mp,p,b);y.uOffset=M.x,y.vOffset=M.y},getPropertyName:[()=>`${p}${b?"."+b:""}.uOffset`,()=>`${p}${b?"."+b:""}.vOffset`]},rotation:{type:"number",get:(M,h,Q)=>{var mp;return null===(mp=t(M,Q,p,b))||void 0===mp?void 0:mp.wAng},getTarget:z,set:(M,h,Q,mp)=>t(h,mp,p,b).wAng=M,getPropertyName:[()=>`${p}${b?"."+b:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(M,Q,mp)=>{const y=t(M,mp,p,b);return new h.Vector2(null===y||void 0===y?void 0:y.uScale,null===y||void 0===y?void 0:y.vScale)},getTarget:z,set:(M,h,Q,mp)=>{const y=t(h,mp,p,b);y.uScale=M.x,y.vScale=M.y},getPropertyName:[()=>`${p}${b?"."+b:""}.uScale`,()=>`${p}${b?"."+b:""}.vScale`]}}}const S={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:p=>{var b,M;return new h.Vector2((null===(b=p._babylonCamera)||void 0===b?void 0:b.orthoLeft)??0,(null===(M=p._babylonCamera)||void 0===M?void 0:M.orthoRight)??0)},set:(p,b)=>{b._babylonCamera&&(b._babylonCamera.orthoLeft=p.x,b._babylonCamera.orthoRight=p.y)},getTarget:p=>p,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:p=>{var b,M;return new h.Vector2((null===(b=p._babylonCamera)||void 0===b?void 0:b.orthoBottom)??0,(null===(M=p._babylonCamera)||void 0===M?void 0:M.orthoTop)??0)},set:(p,b)=>{b._babylonCamera&&(b._babylonCamera.orthoBottom=p.x,b._babylonCamera.orthoTop=p.y)},getTarget:p=>p,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:p=>{var b;return null===(b=p._babylonCamera)||void 0===b?void 0:b.maxZ},set:(p,b)=>{b._babylonCamera&&(b._babylonCamera.maxZ=p)},getTarget:p=>p,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:p=>{var b;return null===(b=p._babylonCamera)||void 0===b?void 0:b.Ib},set:(p,b)=>{b._babylonCamera&&(b._babylonCamera.Ib=p)},getTarget:p=>p,getPropertyName:[()=>"Ib"]}},perspective:{aspectRatio:{type:"number",get:p=>{var b;return null===(b=p._babylonCamera)||void 0===b?void 0:b.getEngine().getAspectRatio(p._babylonCamera)},getTarget:p=>p,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:p=>{var b;return null===(b=p._babylonCamera)||void 0===b?void 0:b.fov},set:(p,b)=>{b._babylonCamera&&(b._babylonCamera.fov=p)},getTarget:p=>p,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:p=>{var b;return null===(b=p._babylonCamera)||void 0===b?void 0:b.maxZ},set:(p,b)=>{b._babylonCamera&&(b._babylonCamera.maxZ=p)},getTarget:p=>p,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:p=>{var b;return null===(b=p._babylonCamera)||void 0===b?void 0:b.Ib},set:(p,b)=>{b._babylonCamera&&(b._babylonCamera.Ib=p)},getTarget:p=>p,getPropertyName:[()=>"Ib"]}}}},nodes:{length:{type:"number",get:p=>p.length,getTarget:p=>p.map((p=>p._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"QM",get:p=>{var b;return null===(b=p._babylonTransformNode)||void 0===b?void 0:b.position},set:(p,b)=>{var M;return null===(M=b._babylonTransformNode)||void 0===M?void 0:M.position.mp(p)},getTarget:p=>p._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:p=>{var b;return null===(b=p._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion},set:(p,b)=>{var M,h;return null===(M=b._babylonTransformNode)||void 0===M||null===(h=M.rotationQuaternion)||void 0===h?void 0:h.mp(p)},getTarget:p=>p._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"QM",get:p=>{var b;return null===(b=p._babylonTransformNode)||void 0===b?void 0:b.ib},set:(p,b)=>{var M;return null===(M=b._babylonTransformNode)||void 0===M?void 0:M.ib.mp(p)},getTarget:p=>p._babylonTransformNode,getPropertyName:[()=>"ib"]},weights:{length:{type:"number",get:p=>p._numMorphTargets,getTarget:p=>p._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(p,b)=>{var M,h;return void 0!==b?null===(M=p._primitiveBabylonMeshes)||void 0===M||null===(h=M[0].morphTargetManager)||void 0===h?void 0:h.getTarget(b).influence:void 0},getTarget:p=>p._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(p,b)=>[0],getTarget:p=>p._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:p=>{var b,M,Q;return h.Matrix.Compose(null===(b=p._babylonTransformNode)||void 0===b?void 0:b.ib,null===(M=p._babylonTransformNode)||void 0===M?void 0:M.rotationQuaternion,null===(Q=p._babylonTransformNode)||void 0===Q?void 0:Q.position)},getTarget:p=>p._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:p=>{var b,M,Q,mp;const y=h.Matrix.Identity();let P=p.parent;for(;P&&P.parent;)P=P.parent;const w=(null===(b=p._babylonTransformNode)||void 0===b?void 0:b.position._isDirty)||(null===(M=p._babylonTransformNode)||void 0===M||null===(Q=M.rotationQuaternion)||void 0===Q?void 0:Q._isDirty)||(null===(mp=p._babylonTransformNode)||void 0===mp?void 0:mp.ib._isDirty);if(P){var t;const b=null===(t=P._babylonTransformNode)||void 0===t?void 0:t.Zb(!0).invert();var z,x;if(b)null===(z=p._babylonTransformNode)||void 0===z||null===(x=z.Zb(w))||void 0===x||x.multiplyToRef(b,y)}else p._babylonTransformNode&&y.mp(p._babylonTransformNode.Zb(w));return y},getTarget:p=>p._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:p=>{var b,M;return null===(b=p._babylonTransformNode)||void 0===b||null===(M=b.getChildren((p=>p instanceof y.b),!0)[0])||void 0===M?void 0:M.Vb},getTarget:p=>{var b;return null===(b=p._babylonTransformNode)||void 0===b?void 0:b.getChildren((p=>p instanceof y.b),!0)[0]},set:(p,b)=>{if(b._babylonTransformNode){const M=b._babylonTransformNode.getChildren((p=>p instanceof y.b),!0)[0];M&&(M.Vb=p)}}},color:{type:"wM",get:p=>{var b,M;return null===(b=p._babylonTransformNode)||void 0===b||null===(M=b.getChildren((p=>p instanceof y.b),!0)[0])||void 0===M?void 0:M.Db},getTarget:p=>{var b;return null===(b=p._babylonTransformNode)||void 0===b?void 0:b.getChildren((p=>p instanceof y.b),!0)[0]},set:(p,b)=>{if(b._babylonTransformNode){const M=b._babylonTransformNode.getChildren((p=>p instanceof y.b),!0)[0];M&&(M.Db=p)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"wM",get:(p,b,M)=>z(p,b,M).emissiveColor,set:(p,b,M,h)=>z(b,M,h).emissiveColor.mp(p),getTarget:(p,b,M)=>z(p,b,M),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:x("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(p,b,M)=>{var h;return null===(h=t(p,M,"bumpTexture"))||void 0===h?void 0:h.level},set:(p,b,M,h)=>{const Q=t(b,h,"bumpTexture");Q&&(Q.level=p)},getTarget:(p,b,M)=>z(p,b,M),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:x("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(p,b,M)=>z(p,b,M).ambientTextureStrength,set:(p,b,M,h)=>{const Q=z(b,M,h);Q&&(Q.ambientTextureStrength=p)},getTarget:(p,b,M)=>z(p,b,M),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:x("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Hb",get:(p,b,M)=>{const h=z(p,b,M);return mp.Hb.FromColor3(h.albedoColor,h.alpha)},set:(p,b,M,h)=>{const Q=z(b,M,h);Q.albedoColor.set(p.r,p.g,p.b),Q.alpha=p.a},getTarget:(p,b,M)=>z(p,b,M),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:x("albedoTexture")}},metallicFactor:{type:"number",get:(p,b,M)=>z(p,b,M).metallic,set:(p,b,M,h)=>{const Q=z(b,M,h);Q&&(Q.metallic=p)},getTarget:(p,b,M)=>z(p,b,M),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(p,b,M)=>z(p,b,M).roughness,set:(p,b,M,h)=>{const Q=z(b,M,h);Q&&(Q.roughness=p)},getTarget:(p,b,M)=>z(p,b,M),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:x("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(p,b,M)=>z(p,b,M).anisotropy.Vb,set:(p,b,M,h)=>{z(b,M,h).anisotropy.Vb=p},getTarget:(p,b,M)=>z(p,b,M),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(p,b,M)=>z(p,b,M).anisotropy.angle,set:(p,b,M,h)=>{z(b,M,h).anisotropy.angle=p},getTarget:(p,b,M)=>z(p,b,M),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:x("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(p,b,M)=>z(p,b,M).clearCoat.Vb,set:(p,b,M,h)=>{z(b,M,h).clearCoat.Vb=p},getTarget:(p,b,M)=>z(p,b,M),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(p,b,M)=>z(p,b,M).clearCoat.roughness,set:(p,b,M,h)=>{z(b,M,h).clearCoat.roughness=p},getTarget:(p,b,M)=>z(p,b,M),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:x("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(p,b,M)=>{var h;return null===(h=z(p,b,M).clearCoat.bumpTexture)||void 0===h?void 0:h.level},getTarget:z,set:(p,b,M,h)=>z(b,M,h).clearCoat.bumpTexture.level=p},extensions:{KHR_texture_transform:x("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:x("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(p,b,M)=>z(p,b,M).subSurface.dispersion,getTarget:z,set:(p,b,M,h)=>z(b,M,h).subSurface.dispersion=p}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(p,b,M)=>z(p,b,M).emissiveIntensity,getTarget:z,set:(p,b,M,h)=>z(b,M,h).emissiveIntensity=p}},KHR_materials_ior:{ior:{type:"number",get:(p,b,M)=>z(p,b,M).indexOfRefraction,getTarget:z,set:(p,b,M,h)=>z(b,M,h).indexOfRefraction=p}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(p,b,M)=>z(p,b,M).iridescence.Vb,getTarget:z,set:(p,b,M,h)=>z(b,M,h).iridescence.Vb=p},iridescenceIor:{type:"number",get:(p,b,M)=>z(p,b,M).iridescence.indexOfRefraction,getTarget:z,set:(p,b,M,h)=>z(b,M,h).iridescence.indexOfRefraction=p},iridescenceTexture:{extensions:{KHR_texture_transform:x("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(p,b,M)=>z(p,b,M).iridescence.maximumThickness,getTarget:z,set:(p,b,M,h)=>z(b,M,h).iridescence.maximumThickness=p},iridescenceThicknessMinimum:{type:"number",get:(p,b,M)=>z(p,b,M).iridescence.minimumThickness,getTarget:z,set:(p,b,M,h)=>z(b,M,h).iridescence.minimumThickness=p},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:x("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"wM",get:(p,b,M)=>z(p,b,M).sheen.color,getTarget:z,set:(p,b,M,h)=>z(b,M,h).sheen.color.mp(p)},sheenColorTexture:{extensions:{KHR_texture_transform:x("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(p,b,M)=>z(p,b,M).sheen.Vb,getTarget:z,set:(p,b,M,h)=>z(b,M,h).sheen.Vb=p},sheenRoughnessTexture:{extensions:{KHR_texture_transform:x("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(p,b,M)=>z(p,b,M).metallicF0Factor,getTarget:z,set:(p,b,M,h)=>z(b,M,h).metallicF0Factor=p,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"wM",get:(p,b,M)=>z(p,b,M).metallicReflectanceColor,getTarget:z,set:(p,b,M,h)=>z(b,M,h).metallicReflectanceColor.mp(p),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:x("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:x("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(p,b,M)=>z(p,b,M).subSurface.refractionIntensity,getTarget:z,set:(p,b,M,h)=>z(b,M,h).subSurface.refractionIntensity=p,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:x("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(p,b,M)=>z(p,b,M).subSurface.translucencyIntensity,getTarget:z,set:(p,b,M,h)=>z(b,M,h).subSurface.translucencyIntensity=p},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:x("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"wM",get:(p,b,M)=>z(p,b,M).subSurface.translucencyColor,getTarget:z,set:(p,b,M,h)=>{var Q;return p&&(null===(Q=z(b,M,h).subSurface.translucencyColor)||void 0===Q?void 0:Q.mp(p))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:x("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"wM",get:(p,b,M)=>z(p,b,M).subSurface.tintColor,getTarget:z,set:(p,b,M,h)=>z(b,M,h).subSurface.tintColor.mp(p)},attenuationDistance:{type:"number",get:(p,b,M)=>z(p,b,M).subSurface.tintColorAtDistance,getTarget:z,set:(p,b,M,h)=>z(b,M,h).subSurface.tintColorAtDistance=p},thicknessFactor:{type:"number",get:(p,b,M)=>z(p,b,M).subSurface.maximumThickness,getTarget:z,set:(p,b,M,h)=>z(b,M,h).subSurface.maximumThickness=p},thicknessTexture:{extensions:{KHR_texture_transform:x("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:p=>p.length,getTarget:p=>p.map((p=>p._babylonLight)),getPropertyName:[p=>"length"]},__array__:{__target__:!0,color:{type:"wM",get:p=>{var b;return null===(b=p._babylonLight)||void 0===b?void 0:b.Db},set:(p,b)=>{var M;return null===(M=b._babylonLight)||void 0===M?void 0:M.Db.mp(p)},getTarget:p=>p._babylonLight,getPropertyName:[p=>"diffuse"]},Vb:{type:"number",get:p=>{var b;return null===(b=p._babylonLight)||void 0===b?void 0:b.Vb},set:(p,b)=>b._babylonLight?b._babylonLight.Vb=p:void 0,getTarget:p=>p._babylonLight,getPropertyName:[p=>"intensity"]},range:{type:"number",get:p=>{var b;return null===(b=p._babylonLight)||void 0===b?void 0:b.range},set:(p,b)=>b._babylonLight?b._babylonLight.range=p:void 0,getTarget:p=>p._babylonLight,getPropertyName:[p=>"range"]},spot:{innerConeAngle:{type:"number",get:p=>{var b;return null===(b=p._babylonLight)||void 0===b?void 0:b.innerAngle},set:(p,b)=>b._babylonLight?b._babylonLight.innerAngle=p:void 0,getTarget:p=>p._babylonLight,getPropertyName:[p=>"innerConeAngle"]},outerConeAngle:{type:"number",get:p=>{var b;return null===(b=p._babylonLight)||void 0===b?void 0:b.angle},set:(p,b)=>b._babylonLight?b._babylonLight.angle=p:void 0,getTarget:p=>p._babylonLight,getPropertyName:[p=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:p=>p.length,getTarget:p=>p.map((p=>p._babylonLight)),getPropertyName:[p=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:p=>p.length,getTarget:p=>p.map((p=>p._babylonTexture)),getPropertyName:[p=>"length"]},__array__:{__target__:!0,Vb:{type:"number",get:p=>{var b;return null===(b=p._babylonTexture)||void 0===b?void 0:b.level},set:(p,b)=>{b._babylonTexture&&(b._babylonTexture.level=p)},getTarget:p=>p._babylonTexture},rotation:{type:"Quaternion",get:p=>{var b;return p._babylonTexture&&h.Quaternion.FromRotationMatrix(null===(b=p._babylonTexture)||void 0===b?void 0:b.getReflectionTextureMatrix())},set:(p,b)=>{var M;b._babylonTexture&&(null!==(M=b._babylonTexture.upp())&&void 0!==M&&M.useRightHandedSystem||(p=h.Quaternion.Inverse(p)),h.Matrix.FromQuaternionToRef(p,b._babylonTexture.getReflectionTextureMatrix()))},getTarget:p=>p._babylonTexture}}}}},animations:{length:{type:"number",get:p=>p.length,getTarget:p=>p.map((p=>p._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:p=>p.length,getTarget:p=>p.map((p=>{var b;return null===(b=p.primitives[0]._instanceData)||void 0===b?void 0:b.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function X(p){return new w(p,S)}function c(p){const b=p.split("/").map((p=>p.replace(/{}/g,"__array__")));let M=S;for(const h of b)h&&(M=M[h]);if(M&&M.type&&M.get)return M}function J(p,b){const M=p.split("/").map((p=>p.replace(/{}/g,"__array__")));let h=S;for(const Q of M)Q&&(h=h[Q]);h&&h.type&&h.get&&(h.interpolation=b)}function g(p,b){const M=p.split("/").map((p=>p.replace(/{}/g,"__array__")));let h=S;for(const Q of M)if(Q){if(!h[Q]){if("?"===Q){h.__ignoreObjectTree__=!0;continue}h[Q]={},"__array__"===Q&&(h[Q].__target__=!0)}h=h[Q]}Object.assign(h,b)}},14259:(p,b,M)=>{"use strict";M.r(b),M.d(b,{AnimationPropertyInfo:()=>t,TransformNodeAnimationPropertyInfo:()=>z,WeightAnimationPropertyInfo:()=>x,getQuaternion:()=>P,getVector3:()=>y,getWeights:()=>w});var h=M(13311),Q=M(12777),mp=M(14252);function y(p,b,M,h){return Q.QM.tM(b,M).scaleInPlace(h)}function P(p,b,M,h){return Q.Quaternion.tM(b,M).scaleInPlace(h)}function w(p,b,M,h){const Q=new Array(p._numMorphTargets);for(let mp=0;mp<Q.length;mp++)Q[mp]=b[M++]*h;return Q}class t{constructor(p,b,M,h){this.type=p,this.name=b,this.getValue=M,this.getStride=h}_buildAnimation(p,b,M){const Q=new h.d(p,this.name,b,this.type);return Q.setKeys(M),Q}}class z extends t{buildAnimations(p,b,M,h){const Q=[];return Q.push({babylonAnimatable:p._babylonTransformNode,babylonAnimation:this._buildAnimation(b,M,h)}),Q}}class x extends t{buildAnimations(p,b,M,Q){const mp=[];if(p._numMorphTargets)for(let y=0;y<p._numMorphTargets;y++){const P=new h.d(`${b}_${y}`,this.name,M,this.type);if(P.setKeys(Q.map((p=>({frame:p.frame,inTangent:p.inTangent?p.inTangent[y]:void 0,value:p.value[y],outTangent:p.outTangent?p.outTangent[y]:void 0,interpolation:p.interpolation})))),p._primitiveBabylonMeshes)for(const b of p._primitiveBabylonMeshes)if(b.morphTargetManager){const p=b.morphTargetManager.getTarget(y),M=P.clone();p.animations.push(M),mp.push({babylonAnimatable:p,babylonAnimation:M})}}return mp}}(0,mp.h)("/nodes/{}/translation",[new z(h.d.ANIMATIONTYPE_VECTOR3,"position",y,(()=>3))]),(0,mp.h)("/nodes/{}/rotation",[new z(h.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",P,(()=>4))]),(0,mp.h)("/nodes/{}/scale",[new z(h.d.ANIMATIONTYPE_VECTOR3,"ib",y,(()=>3))]),(0,mp.h)("/nodes/{}/weights",[new x(h.d.ANIMATIONTYPE_FLOAT,"influence",w,(p=>p._numMorphTargets))])},14215:(p,b,M)=>{"use strict";class h{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((p,b)=>{this._resolve=p,this._reject=b}))}}var Q=M(12777),mp=M(12820),y=M(12608),P=M(13235),w=M(14218),t=M(14233),z=M(12617),x=M(13251),S=M(13311),X=M(13313),c=M(12652),J=M(12622),g=M(12624);class f{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(p){this._useTextureToStoreBoneMatrices=p,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(p){this._animationPropertiesOverride=p}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(p,b,M){this.name=p,this.id=b,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=Q.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new z.d,this.bones=[],this._scene=M||c.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const h=this._scene.getEngine().getCaps();this._canUseTextureForBones=h.textureFloat&&h.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((p=>!p.getParent()))}getTransformMatrices(p){if(this.needInitialSkinMatrix){if(!p)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return p._bonesTransformMatrices||this.prepare(!0),p._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(p){return this.needInitialSkinMatrix&&p._transformMatrixTexture?p._transformMatrixTexture:this._transformMatrixTexture}upp(){return this._scene}toString(p){let b=`Name: ${this.name}, nBones: ${this.bones.length}`;if(b+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,p){b+=", Ranges: {";let p=!0;for(const M in this._ranges)p&&(b+=", ",p=!1),b+=M;b+="}"}return b}getBoneIndexByName(p){for(let b=0,M=this.bones.length;b<M;b++)if(this.bones[b].name===p)return b;return-1}createAnimationRange(p,b,M){if(!this._ranges[p]){this._ranges[p]=new X.b(p,b,M);for(let h=0,Q=this.bones.length;h<Q;h++)this.bones[h].animations[0]&&this.bones[h].animations[0].createRange(p,b,M)}}deleteAnimationRange(p){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let M=0,h=this.bones.length;M<h;M++)this.bones[M].animations[0]&&this.bones[M].animations[0].deleteRange(p,b);this._ranges[p]=null}getAnimationRange(p){return this._ranges[p]||null}getAnimationRanges(){const p=[];let b;for(b in this._ranges)p.push(this._ranges[b]);return p}copyAnimationRange(p,b){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[b]||!p.getAnimationRange(b))return!1;let h=!0;const Q=this._getHighestAnimationFrame()+1,mp={},y=p.bones;let P,w;for(w=0,P=y.length;w<P;w++)mp[y[w].name]=y[w];this.bones.length!==y.length&&(J.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${y.length}`),h=!1);const t=M&&this.dimensionsAtRest&&p.dimensionsAtRest?this.dimensionsAtRest.divide(p.dimensionsAtRest):null;for(w=0,P=this.bones.length;w<P;w++){const p=this.bones[w].name,y=mp[p];y?h=h&&this.bones[w].copyAnimationRange(y,b,Q,M,t):(J.d.Warn("copyAnimationRange: not same rig, missing source bone "+p),h=!1)}const z=p.getAnimationRange(b);return z&&(this._ranges[b]=new X.b(b,z.from+Q,z.to+Q)),h}returnToRest(){for(const p of this.bones)-1!==p._index&&p.returnToRest()}_getHighestAnimationFrame(){let p=0;for(let b=0,M=this.bones.length;b<M;b++)if(this.bones[b].animations[0]){const M=this.bones[b].animations[0].getHighestFrame();p<M&&(p=M)}return p}beginAnimation(p,b,M,h){const Q=this.getAnimationRange(p);return Q?this._scene.beginAnimation(this,Q.from,Q.to,b,M,h):null}static MakeAnimationAdditive(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;const h=p.getAnimationRange(M);if(!h)return null;const Q=p._scene.getAllAnimatablesByTarget(p);let mp=null;for(let P=0;P<Q.length;P++){const p=Q[P];if(p.fromFrame===(null===h||void 0===h?void 0:h.from)&&p.toFrame===(null===h||void 0===h?void 0:h.to)){mp=p;break}}const y=p.getAnimatables();for(let P=0;P<y.length;P++){const p=y[P].animations;if(p)for(let h=0;h<p.length;h++)S.d.MakeAnimationAdditive(p[h],b,M)}return mp&&(mp.isAdditive=!0),p}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(p){this._meshesWithPoseMatrix.push(p)}_unregisterMeshWithPoseMatrix(p){const b=this._meshesWithPoseMatrix.indexOf(p);b>-1&&this._meshesWithPoseMatrix.splice(b,1)}_computeTransformMatrices(p,b){this.onBeforeComputeObservable.notifyObservers(this);for(let M=0;M<this.bones.length;M++){const h=this.bones[M];h._childUpdateId++;const Q=h.getParent();if(Q?h.getLocalMatrix().multiplyToRef(Q.getFinalMatrix(),h.getFinalMatrix()):b?h.getLocalMatrix().multiplyToRef(b,h.getFinalMatrix()):h.getFinalMatrix().mp(h.getLocalMatrix()),-1!==h._index){const b=null===h._index?M:h._index;h.getAbsoluteInverseBindMatrix().multiplyToArray(h.getFinalMatrix(),p,16*b)}}this._identity.copyToArray(p,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const p=this.upp().getRenderId();if(this._currentRenderId===p)return;this._currentRenderId=p}if(this._numBonesWithLinkedTransformNode>0)for(const p of this.bones)if(p._linkedTransformNode){const b=p._linkedTransformNode;p.position=b.position,b.rotationQuaternion?p.rotationQuaternion=b.rotationQuaternion:p.rotation=b.rotation,p.ib=b.ib}if(this.needInitialSkinMatrix)for(const p of this._meshesWithPoseMatrix){const b=p.getPoseMatrix();let M=this._isDirty;if(p._bonesTransformMatrices&&p._bonesTransformMatrices.length===16*(this.bones.length+1)||(p._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),M=!0),M){if(this._synchronizedWithMesh!==p){this._synchronizedWithMesh=p;for(const p of this.bones)if(!p.getParent()){p.getBindMatrix().multiplyToRef(b,Q.TmpVectors.Matrix[1]),p._updateAbsoluteBindMatrices(Q.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const b=4*(this.bones.length+1);p._transformMatrixTexture&&p._transformMatrixTexture.getSize().width===b||(p._transformMatrixTexture&&p._transformMatrixTexture.dispose(),p._transformMatrixTexture=x.c.CreateRGBATexture(p._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(p._bonesTransformMatrices,b),this.isUsingTextureForMatrices&&p._transformMatrixTexture&&p._transformMatrixTexture.update(p._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=x.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let p=0;p<this.bones.length;p++)this._animatables.push(this.bones[p])}return this._animatables}clone(p,b){const M=new f(p,b||p,this._scene);M.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let h=0;h<this.bones.length;h++){const p=this.bones[h];let b=null;const Q=p.getParent();if(Q){const p=this.bones.indexOf(Q);b=M.bones[p]}const mp=new t.e(p.name,M,b,p.getBindMatrix().clone(),p.getRestMatrix().clone());mp._index=p._index,p._linkedTransformNode&&mp.linkTransformNode(p._linkedTransformNode),g.b.DeepCopy(p.animations,mp.animations)}if(this._ranges){M._ranges={};for(const p in this._ranges){const b=this._ranges[p];b&&(M._ranges[p]=b.clone())}}return this._isDirty=!0,M.prepare(!0),M}enableBlending(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const b of this.bones)for(const M of b.animations)M.enableBlending=!0,M.blendingSpeed=p}dispose(){if(this._meshesWithPoseMatrix.length=0,this.upp().stopAnimation(this),this.upp().removeSkeleton(this),this._parentContainer){const p=this._parentContainer.skeletons.indexOf(this);p>-1&&this._parentContainer.skeletons.splice(p,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const p={};p.name=this.name,p.id=this.id,this.dimensionsAtRest&&(p.dimensionsAtRest=this.dimensionsAtRest.ub()),p.bones=[],p.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let M=0;M<this.bones.length;M++){var b;const h=this.bones[M],Q=h.getParent(),mp={parentBoneIndex:Q?this.bones.indexOf(Q):-1,index:h.getIndex(),name:h.name,id:h.id,matrix:h.getBindMatrix().ub(),rest:h.getRestMatrix().ub(),linkedTransformNodeId:null===(b=h.getTransformNode())||void 0===b?void 0:b.id};p.bones.push(mp),h.length&&(mp.length=h.length),h.metadata&&(mp.metadata=h.metadata),h.animations&&h.animations.length>0&&(mp.animation=h.animations[0].serialize()),p.ranges=[];for(const b in this._ranges){const M=this._ranges[b];if(!M)continue;const h={};h.name=b,h.from=M.from,h.to=M.to,p.ranges.push(h)}}return p}static Parse(p,b){const M=new f(p.name,p.id,b);let h;for(p.dimensionsAtRest&&(M.dimensionsAtRest=Q.QM.tM(p.dimensionsAtRest)),M.needInitialSkinMatrix=p.needInitialSkinMatrix,h=0;h<p.bones.length;h++){const b=p.bones[h],mp=p.bones[h].index;let y=null;b.parentBoneIndex>-1&&(y=M.bones[b.parentBoneIndex]);const P=b.rest?Q.Matrix.tM(b.rest):null,w=new t.e(b.name,M,y,Q.Matrix.tM(b.matrix),P,null,mp);void 0!==b.id&&null!==b.id&&(w.id=b.id),b.length&&(w.length=b.length),b.metadata&&(w.metadata=b.metadata),b.animation&&w.animations.push(S.d.Parse(b.animation)),void 0!==b.linkedTransformNodeId&&null!==b.linkedTransformNodeId&&(M._hasWaitingData=!0,w._waitingTransformNodeId=b.linkedTransformNodeId)}if(p.ranges)for(h=0;h<p.ranges.length;h++){const b=p.ranges[h];M.createAnimationRange(b.name,b.from,b.to)}return M}computeAbsoluteMatrices(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||p)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(p)}getPoseMatrix(){let p=null;return this._meshesWithPoseMatrix.length>0&&(p=this._meshesWithPoseMatrix[0].getPoseMatrix()),p}sortBones(){const p=[],b=new Array(this.bones.length);for(let M=0;M<this.bones.length;M++)this._sortBones(M,p,b);this.bones=p}_sortBones(p,b,M){if(M[p])return;M[p]=!0;const h=this.bones[p];if(!h)return;void 0===h._index&&(h._index=p);const Q=h.getParent();Q&&this._sortBones(this.bones.indexOf(Q),b,M),b.push(h)}setCurrentPoseAsRest(){for(const p of this.bones)p.setCurrentPoseAsRest()}}var Y=M(13097),a=M(13273),o=M(12753),l=M(13206),L=M(12847),u=M(13238),e=M(13217),d=M(13231),I=M(13318),G=M(12867),v=M(14181);class Z{set areUpdatesFrozen(p){p?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new G.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,p||(p=c.c.LastCreatedScene),this._scene=p,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const p=this._scene.getEngine().getCaps();this._canUseTextureForTargets=p.canUseGLVertexID&&p.textureFloat&&p.maxVertexTextureImageUnits>0&&p.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return Z.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?Z.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(p){this._numMaxInfluencers!==p&&(this._numMaxInfluencers=p,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(p){this._useTextureToStoreTargets!==p&&(this._useTextureToStoreTargets=p,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var p;return Z.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(p=this._scene)&&void 0!==p&&p.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(p){return this._activeTargets.data[p]}getTarget(p){return this._targets[p]}getTargetByName(p){for(const b of this._targets)if(b.name===p)return b;return null}addTarget(p){this._targets.push(p),this._targetInfluenceChangedObservers.push(p.onInfluenceChanged.add((p=>{this.areUpdatesFrozen&&p&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(p)}))),this._targetDataLayoutChangedObservers.push(p._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(p){const b=this._targets.indexOf(p);b>=0&&(this._targets.splice(b,1),p.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(b,1)[0]),p._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(b,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(p)}_bind(p){p.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),p.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),p.setTexture("morphTargets",this._targetStoreTexture),p.setInt("morphTargetCount",this.numInfluencers)}clone(){const p=new Z(this._scene);for(const b of this._targets)p.addTarget(b.clone());return p.enablePositionMorphing=this.enablePositionMorphing,p.enableNormalMorphing=this.enableNormalMorphing,p.enableTangentMorphing=this.enableTangentMorphing,p.enableUVMorphing=this.enableUVMorphing,p.enableUV2Morphing=this.enableUV2Morphing,p.enableColorMorphing=this.enableColorMorphing,p}serialize(){const p={};p.id=this.uniqueId,p.targets=[];for(const b of this._targets)p.targets.push(b.serialize());return p}_syncActiveTargets(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const b=!!this._targetStoreTexture,M=this.isUsingTextureForTargets;(this._mustSynchronize||b!==M)&&(this._mustSynchronize=!1,this.synchronize());let h=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let Q=-1;for(const mp of this._targets)if(Q++,0!==mp.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=Z.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(mp),this._morphTargetTextureIndices[h]=Q,this._tempInfluences[h++]=mp.influence}this._morphTargetTextureIndices.length!==h&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,h)),this._influences&&this._influences.length===h||(this._influences=new Float32Array(h));for(let mp=0;mp<h;mp++)this._influences[mp]=this._tempInfluences[mp];if(p&&this._scene)for(const mp of this._scene.meshes)mp.morphTargetManager===this&&(M?mp._markSubMeshesAsAttributesDirty():mp._syncGeometryWithMorphTargetManager())}synchronize(){var p;if(!this._scene||this.areUpdatesFrozen)return;const b=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(p=this._targetStoreTexture)||void 0===p||p.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>b.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const M of this._targets){this._supportsPositions=this._supportsPositions&&M.hasPositions,this._supportsNormals=this._supportsNormals&&M.hasNormals,this._supportsTangents=this._supportsTangents&&M.hasTangents,this._supportsUVs=this._supportsUVs&&M.hasUVs,this._supportsUV2s=this._supportsUV2s&&M.hasUV2s,this._supportsColors=this._supportsColors&&M.hasColors;const p=M.vertexCount;if(0===this._vertexCount)this._vertexCount=p;else if(this._vertexCount!==p)return void J.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${M.name}": ${p}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const p=b.getCaps().maxTextureSize;this._textureWidth>p&&(this._textureHeight=Math.ceil(this._textureWidth/p),this._textureWidth=p);const M=this._targets.length,h=new Float32Array(M*this._textureWidth*this._textureHeight*4);let Q=0;for(let b=0;b<M;b++){const p=this._targets[b],M=p.getPositions(),mp=p.getNormals(),y=p.getUVs(),P=p.getTangents(),w=p.getUV2s(),t=p.getColors();Q=b*this._textureWidth*this._textureHeight*4;for(let b=0;b<this._vertexCount;b++)this._supportsPositions&&M&&(h[Q]=M[3*b],h[Q+1]=M[3*b+1],h[Q+2]=M[3*b+2],Q+=4),this._supportsNormals&&mp&&(h[Q]=mp[3*b],h[Q+1]=mp[3*b+1],h[Q+2]=mp[3*b+2],Q+=4),this._supportsUVs&&y&&(h[Q]=y[2*b],h[Q+1]=y[2*b+1],Q+=4),this._supportsTangents&&P&&(h[Q]=P[3*b],h[Q+1]=P[3*b+1],h[Q+2]=P[3*b+2],Q+=4),this._supportsUV2s&&w&&(h[Q]=w[2*b],h[Q+1]=w[2*b+1],Q+=4),this._supportsColors&&t&&(h[Q]=t[4*b],h[Q+1]=t[4*b+1],h[Q+2]=t[4*b+2],h[Q+3]=t[4*b+3],Q+=4)}this._targetStoreTexture=v.c.CreateRGBATexture(h,this._textureWidth,this._textureHeight,M,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const M of this._scene.meshes)M.morphTargetManager===this&&M._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const p=this._parentContainer.morphTargetManagers.indexOf(this);p>-1&&this._parentContainer.morphTargetManagers.splice(p,1),this._parentContainer=null}for(const p of this._targets)this._scene.stopAnimation(p)}}static Parse(p,b){const M=new Z(b);for(const h of p.targets)M.addTarget(I.c.Parse(h,b));return M}}Z.EnableTextureStorage=!0,Z.MaxActiveMorphTargetsInVertexAttributeMode=8,Z.ConstantTargetCountForTextureMode=0;var U=M(14242),q=M(12655),B=M(13111);const s=new Map,i=s;function T(p,b,M){W(p)&&J.d.Warn(`Extension with the name '${p}' already exists`),s.set(p,{isGLTFExtension:b,factory:M})}function W(p){return s.delete(p)}var H=M(14252),E=M(13369),j=M(12860);class V{static Get(p,b,M){if(!b||void 0==M||!b[M])throw new Error(`${p}: Failed to find index (${M})`);return b[M]}static TryGet(p,b){return p&&void 0!=b&&p[b]?p[b]:null}static Assign(p){if(p)for(let b=0;b<p.length;b++)p[b].index=b}}function D(p){if(p.min&&p.max){const b=p.min,M=p.max,h=Q.TmpVectors.QM[0].sb(b[0],b[1],b[2]),mp=Q.TmpVectors.QM[1].sb(M[0],M[1],M[2]);if(p.normalized&&5126!==p.componentType){let b=1;switch(p.componentType){case 5120:b=127;break;case 5121:b=255;break;case 5122:b=32767;break;case 5123:b=65535}const M=1/b;h.scaleInPlace(M),mp.scaleInPlace(M)}return new B.b(h,mp)}return null}class N{static RegisterExtension(p,b){T(p,!1,b)}static UnregisterExtension(p){return W(p)}get fb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(p){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=p}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((p=>p.dispose&&p.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(p,b,M,h,Q,mp){let y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=b,this._assetContainer=M,this._loadData(h);let mp=null;if(p){const b={};if(this._gltf.nodes)for(const p of this._gltf.nodes)p.name&&(b[p.name]=p.index);mp=(p instanceof Array?p:[p]).map((p=>{const M=b[p];if(void 0===M)throw new Error(`Failed to find node '${p}'`);return M}))}return await this._loadAsync(Q,y,mp,(()=>({meshes:this._getMeshes(),LX:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=p,this._loadData(b),await this._loadAsync(M,Q,null,(()=>{}))}async _loadAsync(p,b,M,h){return await Promise.resolve().then((async()=>{this._rootUrl=p,this._uniqueRootUrl=!p.startsWith("file:")&&b?p:`${p}${Date.now()}/`,this._fileName=b,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const Q=`${U.l[U.l.LOADING]} => ${U.l[U.l.READY]}`,mp=`${U.l[U.l.LOADING]} => ${U.l[U.l.COMPLETE]}`;this._parent._startPerformanceCounter(Q),this._parent._startPerformanceCounter(mp),this._parent._setState(U.l.LOADING),this._extensionsOnLoading();const P=new Array;if(!this.parent.loadOnlyMaterials)if(M)P.push(this.loadSceneAsync("/nodes",{nodes:M,index:-1}));else if(void 0!=this._gltf.yM||this._gltf.scenes&&this._gltf.scenes[0]){const p=V.Get("/scene",this._gltf.scenes,this._gltf.yM||0);P.push(this.loadSceneAsync(`/scenes/${p.index}`,p))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let p=0;p<this._gltf.materials.length;++p){const b=this._gltf.materials[p],M="/materials/"+p,h=Y.b.TriangleFillMode;P.push(this._loadMaterialAsync(M,b,null,h,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&P.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&P.push(this._compileShadowGeneratorsAsync());const w=Promise.all(P).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Qt(!0);for(const p of this._babylonScene.materials){const b=p;void 0!==b.maxSimultaneousLights&&(b.maxSimultaneousLights=Math.max(b.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(U.l.READY),this._skipStartAnimationStep||this._startAnimations(),h()}));return await w.then((p=>(this._parent._endPerformanceCounter(Q),y.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(mp),this._parent._setState(U.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(p=>{this._parent.onErrorObservable.notifyObservers(p),this._parent.onErrorObservable.clear(),this.dispose()}))})),p)))})).catch((p=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(p),this._parent.onErrorObservable.clear(),this.dispose()),p}))}_loadData(p){if(this._gltf=p.json,this._setupData(),p.bin){const b=this._gltf.buffers;if(b&&b[0]&&!b[0].uri){const M=b[0];(M.byteLength<p.bin.byteLength-3||M.byteLength>p.bin.byteLength)&&J.d.Warn(`Binary buffer length (${M.byteLength}) from JSON does not match chunk length (${p.bin.byteLength})`),this._bin=p.bin}else J.d.Warn("Unexpected BIN chunk")}}_setupData(){if(V.Assign(this._gltf.accessors),V.Assign(this._gltf.animations),V.Assign(this._gltf.buffers),V.Assign(this._gltf.bufferViews),V.Assign(this._gltf.cameras),V.Assign(this._gltf.images),V.Assign(this._gltf.materials),V.Assign(this._gltf.meshes),V.Assign(this._gltf.nodes),V.Assign(this._gltf.samplers),V.Assign(this._gltf.scenes),V.Assign(this._gltf.skins),V.Assign(this._gltf.textures),this._gltf.nodes){const p={};for(const M of this._gltf.nodes)if(M.children)for(const b of M.children)p[b]=M.index;const b=this._createRootNode();for(const M of this._gltf.nodes){const h=p[M.index];M.parent=void 0===h?b:this._gltf.nodes[h]}}}async _loadExtensionsAsync(){const p=[];if(i.forEach(((b,M)=>{var h;!1===(null===(h=this.parent.extensionOptions[M])||void 0===h?void 0:h.enabled)?b.isGLTFExtension&&this.isExtensionUsed(M)&&J.d.Warn(`Extension ${M} is used but has been explicitly disabled.`):b.isGLTFExtension&&!this.isExtensionUsed(M)||p.push((async()=>{const p=await b.factory(this);return p.name!==M&&J.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${p.name} !== ${M}`),this._parent.onExtensionLoadedObservable.notifyObservers(p),p})())})),this._extensions.push(...await Promise.all(p)),this._extensions.sort(((p,b)=>(p.order||Number.MAX_VALUE)-(b.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const M of this._gltf.extensionsRequired){if(!this._extensions.some((p=>p.name===M&&p.enabled))){var b;if(!1===(null===(b=this.parent.extensionOptions[M])||void 0===b?void 0:b.enabled))throw new Error(`Required extension ${M} is disabled`);throw new Error(`Required extension ${M} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new d.e("__root__",this._babylonScene);this._rootBabylonMesh=p,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Qt(!1);const b={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case U.j.AUTO:this._babylonScene.useRightHandedSystem||(b.rotation=[0,1,0,0],b.scale=[1,1,-1],N._LoadTransform(b,this._rootBabylonMesh));break;case U.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(p),b}loadSceneAsync(p,b){const M=this._extensionsLoadSceneAsync(p,b);if(M)return M;const h=new Array;if(this.logOpen(`${p} ${b.name||""}`),b.nodes)for(const Q of b.nodes){const b=V.Get(`${p}/nodes/${Q}`,this._gltf.nodes,Q);h.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(p=>{p.parent=this._rootBabylonMesh})))}for(const Q of this._postSceneLoadActions)Q();return h.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(h).then((()=>{}))}_forEachPrimitive(p,b){if(p._primitiveBabylonMeshes)for(const M of p._primitiveBabylonMeshes)b(M)}_getGeometries(){const p=[],b=this._gltf.nodes;if(b)for(const M of b)this._forEachPrimitive(M,(b=>{const M=b.Ub;M&&-1===p.indexOf(M)&&p.push(M)}));return p}_getMeshes(){const p=[];this._rootBabylonMesh instanceof e.c&&p.push(this._rootBabylonMesh);const b=this._gltf.nodes;if(b)for(const M of b)this._forEachPrimitive(M,(b=>{p.push(b)}));return p}_getTransformNodes(){const p=[],b=this._gltf.nodes;if(b)for(const M of b)M._babylonTransformNode&&"rb"===M._babylonTransformNode.getClassName()&&p.push(M._babylonTransformNode),M._babylonTransformNodeForSkin&&p.push(M._babylonTransformNodeForSkin);return p}_getSkeletons(){const p=[],b=this._gltf.skins;if(b)for(const M of b)M._data&&p.push(M._data.babylonSkeleton);return p}_getAnimationGroups(){const p=[],b=this._gltf.animations;if(b)for(const M of b)M._babylonAnimationGroup&&p.push(M._babylonAnimationGroup);return p}_startAnimations(){switch(this._parent.animationStartMode){case U.f.NONE:break;case U.f.FIRST:{const p=this._getAnimationGroups();0!==p.length&&p[0].start(!0);break}case U.f.ALL:{const p=this._getAnimationGroups();for(const b of p)b.start(!0);break}default:return void J.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const h=this._extensionsLoadNodeAsync(p,b,M);if(h)return h;if(b._babylonTransformNode)throw new Error(`${p}: Invalid recursive node hierarchy`);const Q=new Array;this.logOpen(`${p} ${b.name||""}`);const mp=h=>{if(N.AddPointerMetadata(h,p),N._LoadTransform(b,h),void 0!=b.camera){const M=V.Get(`${p}/camera`,this._gltf.cameras,b.camera);Q.push(this.loadCameraAsync(`/cameras/${M.index}`,M,(p=>{p.parent=h,this._babylonScene.useRightHandedSystem||(h.ib.x=-1)})))}if(b.children)for(const M of b.children){const b=V.Get(`${p}/children/${M}`,this._gltf.nodes,M);Q.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(p=>{p.parent=h})))}M(h)},y=void 0!=b.mesh,P=this._parent.loadSkins&&void 0!=b.skin;if(!y||P){const p=b.name||`node${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new l.c(p,this._babylonScene);M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==b.mesh?b._babylonTransformNode=M:b._babylonTransformNodeForSkin=M,mp(M)}if(y)if(P){const M=V.Get(`${p}/mesh`,this._gltf.meshes,b.mesh);Q.push(this._loadMeshAsync(`/meshes/${M.index}`,b,M,(M=>{const h=b._babylonTransformNodeForSkin;M.metadata=(0,E.e)(h.metadata,M.metadata||{});const mp=V.Get(`${p}/skin`,this._gltf.skins,b.skin);Q.push(this._loadSkinAsync(`/skins/${mp.index}`,b,mp,(p=>{this._forEachPrimitive(b,(b=>{b.skeleton=p})),this._postSceneLoadActions.push((()=>{if(void 0!=mp.skeleton){const p=V.Get(`/skins/${mp.index}/skeleton`,this._gltf.nodes,mp.skeleton).parent;b.index===p.index?M.parent=h.parent:M.parent=p._babylonTransformNode}else M.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:h,skinnedNode:M})}))})))})))}else{const M=V.Get(`${p}/mesh`,this._gltf.meshes,b.mesh);Q.push(this._loadMeshAsync(`/meshes/${M.index}`,b,M,mp))}return this.logClose(),Promise.all(Q).then((()=>(this._forEachPrimitive(b,(p=>{const b=p;!b.isAnInstance&&b.Ub&&b.Ub.useBoundingInfoFromGeometry?p.Bp():p.refreshBoundingInfo(!0,!0)})),b._babylonTransformNode)))}_loadMeshAsync(p,b,M,h){const Q=M.primitives;if(!Q||!Q.length)throw new Error(`${p}: Primitives are missing`);void 0==Q[0].index&&V.Assign(Q);const mp=new Array;this.logOpen(`${p} ${M.name||""}`);const y=b.name||`node${b.index}`;if(1===Q.length){const h=M.primitives[0];mp.push(this._loadMeshPrimitiveAsync(`${p}/primitives/${h.index}`,y,b,M,h,(p=>{b._babylonTransformNode=p,b._primitiveBabylonMeshes=[p]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,b._babylonTransformNode=new l.c(y,this._babylonScene),b._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._primitiveBabylonMeshes=[];for(const h of Q)mp.push(this._loadMeshPrimitiveAsync(`${p}/primitives/${h.index}`,`${y}_primitive${h.index}`,b,M,h,(p=>{p.parent=b._babylonTransformNode,b._primitiveBabylonMeshes.push(p)})))}return h(b._babylonTransformNode),this.logClose(),Promise.all(mp).then((()=>b._babylonTransformNode))}_loadMeshPrimitiveAsync(p,b,M,h,Q,mp){const y=this._extensionsLoadMeshPrimitiveAsync(p,b,M,h,Q,mp);if(y)return y;this.logOpen(`${p}`);const P=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==M.skin&&!h.primitives[0].targets;let w,t;if(P&&Q._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,w=Q._instanceData.babylonSourceMesh.createInstance(b),w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t=Q._instanceData.promise;else{const mp=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new d.e(b,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.sideOrientation=this._babylonScene.useRightHandedSystem?Y.b.CounterClockWiseSideOrientation:Y.b.ClockWiseSideOrientation,this._createMorphTargets(p,M,h,Q,y),mp.push(this._loadVertexDataAsync(p,Q,y).then((async b=>await this._loadMorphTargetsAsync(p,Q,y,b).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,b.Up(y),b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const z=N._GetDrawMode(p,Q.mode);if(void 0==Q.material){let p=this._defaultBabylonMaterialData[z];p||(p=this._createDefaultMaterial("__GLTFLoader._default",z),this._parent.onMaterialLoadedObservable.notifyObservers(p),this._defaultBabylonMaterialData[z]=p),y.material=p}else if(!this.parent.skipMaterials){const b=V.Get(`${p}/material`,this._gltf.materials,Q.material);mp.push(this._loadMaterialAsync(`/materials/${b.index}`,b,y,z,(p=>{y.material=p})))}t=Promise.all(mp),P&&(Q._instanceData={babylonSourceMesh:y,promise:t}),w=y}return N.AddPointerMetadata(w,p),this._parent.onMeshLoadedObservable.notifyObservers(w),mp(w),this.logClose(),t.then((()=>w))}_loadVertexDataAsync(p,b,M){const h=this._extensionsLoadVertexDataAsync(p,b,M);if(h)return h;const Q=b.attributes;if(!Q)throw new Error(`${p}: Attributes are missing`);const mp=new Array,y=new u.b(M.name,this._babylonScene);if(void 0==b.indices)M.isUnIndexed=!0;else{const M=V.Get(`${p}/indices`,this._gltf.accessors,b.indices);mp.push(this._loadIndicesAccessorAsync(`/accessors/${M.index}`,M).then((p=>{y.setIndices(p)})))}const P=(b,h,P)=>{if(void 0==Q[b])return;M._delayInfo=M._delayInfo||[],-1===M._delayInfo.indexOf(h)&&M._delayInfo.push(h);const w=V.Get(`${p}/attributes/${b}`,this._gltf.accessors,Q[b]);mp.push(this._loadVertexAccessorAsync(`/accessors/${w.index}`,w,h).then((p=>{if(p.getKind()===L.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!M.skeleton){const p=D(w);p&&(y._boundingInfo=p,y.useBoundingInfoFromGeometry=!0)}y.setVerticesBuffer(p,w.count)}))),h==L.f.MatricesIndicesExtraKind&&(M.numBoneInfluencers=8),P&&P(w)};return P("POSITION",L.f.PositionKind),P("NORMAL",L.f.NormalKind),P("TANGENT",L.f.TangentKind),P("TEXCOORD_0",L.f.UVKind),P("TEXCOORD_1",L.f.UV2Kind),P("TEXCOORD_2",L.f.UV3Kind),P("TEXCOORD_3",L.f.UV4Kind),P("TEXCOORD_4",L.f.UV5Kind),P("TEXCOORD_5",L.f.UV6Kind),P("JOINTS_0",L.f.MatricesIndicesKind),P("WEIGHTS_0",L.f.MatricesWeightsKind),P("JOINTS_1",L.f.MatricesIndicesExtraKind),P("WEIGHTS_1",L.f.MatricesWeightsExtraKind),P("COLOR_0",L.f.ColorKind,(p=>{"VEC4"===p.type&&(M.hasVertexAlpha=!0)})),Promise.all(mp).then((()=>y))}_createMorphTargets(p,b,M,h,Q){if(!h.targets||!this._parent.loadMorphTargets)return;if(void 0==b._numMorphTargets)b._numMorphTargets=h.targets.length;else if(h.targets.length!==b._numMorphTargets)throw new Error(`${p}: Primitives do not have the same number of targets`);const mp=M.extras?M.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,Q.morphTargetManager=new Z(this._babylonScene),Q.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.morphTargetManager.areUpdatesFrozen=!0;for(let y=0;y<h.targets.length;y++){const p=b.weights?b.weights[y]:M.weights?M.weights[y]:0,h=mp?mp[y]:`morphTarget${y}`;Q.morphTargetManager.addTarget(new I.c(h,p,Q.upp()))}}_loadMorphTargetsAsync(p,b,M,h){if(!b.targets||!this._parent.loadMorphTargets)return Promise.resolve();const Q=new Array,mp=M.morphTargetManager;for(let y=0;y<mp.numTargets;y++){const M=mp.getTarget(y);Q.push(this._loadMorphTargetVertexDataAsync(`${p}/targets/${y}`,h,b.targets[y],M))}return Promise.all(Q).then((()=>{mp.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(p,b,M,h){const Q=new Array,mp=(h,mp,y)=>{if(void 0==M[h])return;const P=b.getVertexBuffer(mp);if(!P)return;const w=V.Get(`${p}/${h}`,this._gltf.accessors,M[h]);Q.push(this._loadFloatAccessorAsync(`/accessors/${w.index}`,w).then((p=>{y(P,p)})))};return mp("POSITION",L.f.PositionKind,((p,b)=>{const M=new Float32Array(b.length);p.forEach(b.length,((p,h)=>{M[h]=b[h]+p})),h.setPositions(M)})),mp("NORMAL",L.f.NormalKind,((p,b)=>{const M=new Float32Array(b.length);p.forEach(M.length,((p,h)=>{M[h]=b[h]+p})),h.setNormals(M)})),mp("TANGENT",L.f.TangentKind,((p,b)=>{const M=new Float32Array(b.length/3*4);let Q=0;p.forEach(b.length/3*4,((p,h)=>{(h+1)%4!==0&&(M[Q]=b[Q]+p,Q++)})),h.setTangents(M)})),mp("TEXCOORD_0",L.f.UVKind,((p,b)=>{const M=new Float32Array(b.length);p.forEach(b.length,((p,h)=>{M[h]=b[h]+p})),h.setUVs(M)})),mp("TEXCOORD_1",L.f.UV2Kind,((p,b)=>{const M=new Float32Array(b.length);p.forEach(b.length,((p,h)=>{M[h]=b[h]+p})),h.setUV2s(M)})),mp("COLOR_0",L.f.ColorKind,((b,M)=>{let Q=null;const mp=b.getSize();if(3===mp){Q=new Float32Array(M.length/3*4),b.forEach(M.length,((p,b)=>{const h=Math.floor(b/3),mp=b%3;Q[4*h+mp]=M[3*h+mp]+p}));for(let p=0;p<M.length/3;++p)Q[4*p+3]=1}else{if(4!==mp)throw new Error(`${p}: Invalid number of components (${mp}) for COLOR_0 attribute`);Q=new Float32Array(M.length),b.forEach(M.length,((p,b)=>{Q[b]=M[b]+p}))}h.setColors(Q)})),await Promise.all(Q).then((()=>{}))}static _LoadTransform(p,b){if(void 0!=p.skin)return;let M=Q.QM.Zero(),h=Q.Quaternion.Identity(),mp=Q.QM.One();if(p.matrix){Q.Matrix.tM(p.matrix).decompose(mp,h,M)}else p.translation&&(M=Q.QM.tM(p.translation)),p.rotation&&(h=Q.Quaternion.tM(p.rotation)),p.scale&&(mp=Q.QM.tM(p.scale));b.position=M,b.rotationQuaternion=h,b.ib=mp}_loadSkinAsync(p,b,M,h){if(!this._parent.loadSkins)return Promise.resolve();const Q=this._extensionsLoadSkinAsync(p,b,M);if(Q)return Q;if(M._data)return h(M._data.babylonSkeleton),M._data.promise;const mp=`skeleton${M.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new f(M.name||mp,mp,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(p,M,y);const P=this._loadSkinInverseBindMatricesDataAsync(p,M).then((p=>{this._updateBoneMatrices(y,p)}));return M._data={babylonSkeleton:y,promise:P},h(y),P}_loadBones(p,b,M){if(void 0==b.skeleton||this._parent.alwaysComputeSkeletonRootNode){const M=this._findSkeletonRootNode(`${p}/joints`,b.joints);if(M)if(void 0===b.skeleton)b.skeleton=M.index;else{const h=(p,b)=>{for(;b.parent;b=b.parent)if(b.parent===p)return!0;return!1},Q=V.Get(`${p}/skeleton`,this._gltf.nodes,b.skeleton);Q===M||h(Q,M)||(J.d.Warn(`${p}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),b.skeleton=M.index)}else J.d.Warn(`${p}: Failed to find common root`)}const h={};for(const Q of b.joints){const mp=V.Get(`${p}/joints/${Q}`,this._gltf.nodes,Q);this._loadBone(mp,b,M,h)}}_findSkeletonRootNode(p,b){if(0===b.length)return null;const M={};for(const Q of b){const b=[];let h=V.Get(`${p}/${Q}`,this._gltf.nodes,Q);for(;-1!==h.index;)b.unshift(h),h=h.parent;M[Q]=b}let h=null;for(let Q=0;;++Q){let p=M[b[0]];if(Q>=p.length)return h;const mp=p[Q];for(let y=1;y<b.length;++y)if(p=M[b[y]],Q>=p.length||mp!==p[Q])return h;h=mp}}_loadBone(p,b,M,h){p._isJoint=!0;let Q=h[p.index];if(Q)return Q;let mp=null;p.index!==b.skeleton&&(p.parent&&-1!==p.parent.index?mp=this._loadBone(p.parent,b,M,h):void 0!==b.skeleton&&J.d.Warn(`/skins/${b.index}/skeleton: Skeleton node is not a common root`));const y=b.joints.indexOf(p.index);return Q=new t.e(p.name||`joint${p.index}`,M,mp,this._getNodeMatrix(p),null,null,y),h[p.index]=Q,this._postSceneLoadActions.push((()=>{Q.linkTransformNode(p._babylonTransformNode)})),Q}_loadSkinInverseBindMatricesDataAsync(p,b){if(void 0==b.inverseBindMatrices)return Promise.resolve(null);const M=V.Get(`${p}/inverseBindMatrices`,this._gltf.accessors,b.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${M.index}`,M)}_updateBoneMatrices(p,b){for(const M of p.bones){const p=Q.Matrix.Identity(),h=M._index;b&&-1!==h&&(Q.Matrix.FromArrayToRef(b,16*h,p),p.invertToRef(p));const mp=M.getParent();mp&&p.multiplyToRef(mp.getAbsoluteInverseBindMatrix(),p),M.Gb(p,!1,!1),M._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(p){return p.matrix?Q.Matrix.tM(p.matrix):Q.Matrix.Compose(p.scale?Q.QM.tM(p.scale):Q.QM.One(),p.rotation?Q.Quaternion.tM(p.rotation):Q.Quaternion.Identity(),p.translation?Q.QM.tM(p.translation):Q.QM.Zero())}loadCameraAsync(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const h=this._extensionsLoadCameraAsync(p,b,M);if(h)return h;const mp=new Array;this.logOpen(`${p} ${b.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new w.d(b.name||`camera${b.index}`,Q.QM.Zero(),this._babylonScene,!1);switch(y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonCamera=y,y.setTarget(new Q.QM(0,0,-1)),b.type){case"perspective":{const M=b.perspective;if(!M)throw new Error(`${p}: Camera perspective properties are missing`);y.fov=M.yfov,y.Ib=M.znear,y.maxZ=M.zfar||0;break}case"orthographic":if(!b.orthographic)throw new Error(`${p}: Camera orthographic properties are missing`);y.mode=P.e.ORTHOGRAPHIC_CAMERA,y.orthoLeft=-b.orthographic.xmag,y.orthoRight=b.orthographic.xmag,y.orthoBottom=-b.orthographic.ymag,y.orthoTop=b.orthographic.ymag,y.Ib=b.orthographic.znear,y.maxZ=b.orthographic.zfar;break;default:throw new Error(`${p}: Invalid camera type (${b.type})`)}return N.AddPointerMetadata(y,p),this._parent.onCameraLoadedObservable.notifyObservers(y),M(y),this.logClose(),Promise.all(mp).then((()=>y))}_loadAnimationsAsync(){const p=this._gltf.animations;if(!p)return Promise.resolve();const b=new Array;for(let M=0;M<p.length;M++){const h=p[M];b.push(this.loadAnimationAsync(`/animations/${h.index}`,h).then((p=>{0===p.targetedAnimations.length&&p.dispose()})))}return Promise.all(b).then((()=>{}))}loadAnimationAsync(p,b){const h=this._extensionsLoadAnimationAsync(p,b);return h||M.e(78).then(M.bind(M,15948)).then((M=>{let{AnimationGroup:h}=M;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new h(b.name||`animation${b.index}`,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonAnimationGroup=Q;const mp=new Array;V.Assign(b.channels),V.Assign(b.samplers);for(const y of b.channels)mp.push(this._loadAnimationChannelAsync(`${p}/channels/${y.index}`,p,b,y,((p,b)=>{p.animations=p.animations||[],p.animations.push(b),Q.addTargetedAnimation(b,p)})));return Promise.all(mp).then((()=>(Q.normalize(0),Q)))}))}async _loadAnimationChannelAsync(p,b,h,Q,mp){const y=this._extensionsLoadAnimationChannelAsync(p,b,h,Q,mp);if(y)return await y;if(void 0==Q.target.node)return await Promise.resolve();const P=V.Get(`${p}/target/node`,this._gltf.nodes,Q.target.node),w=Q.target.path,t="weights"===w;if(t&&!P._numMorphTargets||!t&&!P._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!t&&!P._isJoint)return await Promise.resolve();let z;switch(await Promise.resolve().then(M.bind(M,14259)),w){case"translation":var x;z=null===(x=(0,H.f)("/nodes/{}/translation"))||void 0===x?void 0:x.interpolation;break;case"rotation":var S;z=null===(S=(0,H.f)("/nodes/{}/rotation"))||void 0===S?void 0:S.interpolation;break;case"scale":var X;z=null===(X=(0,H.f)("/nodes/{}/scale"))||void 0===X?void 0:X.interpolation;break;case"weights":var c;z=null===(c=(0,H.f)("/nodes/{}/weights"))||void 0===c?void 0:c.interpolation;break;default:throw new Error(`${p}/target/path: Invalid value (${Q.target.path})`)}if(!z)throw new Error(`${p}/target/path: Could not find interpolation properties for target path (${Q.target.path})`);const J={object:P,info:z};return await this._loadAnimationChannelFromTargetInfoAsync(p,b,h,Q,J,mp)}_loadAnimationChannelFromTargetInfoAsync(p,b,M,h,Q,mp){const y=this.parent.targetFps,P=1/y,w=V.Get(`${p}/sampler`,M.samplers,h.sampler);return this._loadAnimationSamplerAsync(`${b}/samplers/${h.sampler}`,w).then((p=>{let b=0;const w=Q.object,t=Q.info;for(const Q of t){const t=Q.getStride(w),z=p.input,x=p.output,S=new Array(z.length);let X=0;switch(p.interpolation){case"STEP":for(let p=0;p<z.length;p++){const b=Q.getValue(w,x,X,1);X+=t,S[p]={frame:z[p]*y,value:b,interpolation:1}}break;case"CUBICSPLINE":for(let p=0;p<z.length;p++){const b=Q.getValue(w,x,X,P);X+=t;const M=Q.getValue(w,x,X,1);X+=t;const h=Q.getValue(w,x,X,P);X+=t,S[p]={frame:z[p]*y,inTangent:b,value:M,outTangent:h}}break;case"LINEAR":for(let p=0;p<z.length;p++){const b=Q.getValue(w,x,X,1);X+=t,S[p]={frame:z[p]*y,value:b}}}if(X>0){const p=`${M.name||`animation${M.index}`}_channel${h.index}_${b}`,P=Q.buildAnimations(w,p,y,S);for(const M of P)b++,mp(M.babylonAnimatable,M.babylonAnimation)}}}))}_loadAnimationSamplerAsync(p,b){if(b._data)return b._data;const M=b.interpolation||"LINEAR";switch(M){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${p}/interpolation: Invalid value (${b.interpolation})`)}const h=V.Get(`${p}/input`,this._gltf.accessors,b.input),Q=V.Get(`${p}/output`,this._gltf.accessors,b.output);return b._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${h.index}`,h),this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q)]).then((p=>{let[b,h]=p;return{input:b,interpolation:M,output:h}})),b._data}loadBufferAsync(p,b,M,h){const Q=this._extensionsLoadBufferAsync(p,b,M,h);if(Q)return Q;if(!b._data)if(b.uri)b._data=this.loadUriAsync(`${p}/uri`,b,b.uri);else{if(!this._bin)throw new Error(`${p}: Uri is missing or the binary glTF is missing its binary chunk`);b._data=this._bin.readAsync(0,b.byteLength)}return b._data.then((b=>{try{return new Uint8Array(b.buffer,b.byteOffset+M,h)}catch(Q){throw new Error(`${p}: ${Q.message}`)}}))}loadBufferViewAsync(p,b){const M=this._extensionsLoadBufferViewAsync(p,b);if(M)return M;if(b._data)return b._data;const h=V.Get(`${p}/buffer`,this._gltf.buffers,b.buffer);return b._data=this.loadBufferAsync(`/buffers/${h.index}`,h,b.byteOffset||0,b.byteLength),b._data}_loadAccessorAsync(p,b,M){if(b._data)return b._data;const h=N._GetNumComponents(p,b.type),Q=h*L.f.GetTypeByteLength(b.componentType),mp=h*b.count;if(void 0==b.bufferView)b._data=Promise.resolve(new M(mp));else{const y=V.Get(`${p}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((P=>{if(5126!==b.componentType||b.normalized||y.byteStride&&y.byteStride!==Q){const p=new M(mp);return L.f.ForEach(P,b.byteOffset||0,y.byteStride||Q,h,b.componentType,p.length,b.normalized||!1,((b,M)=>{p[M]=b})),p}return N._GetTypedArray(p,b.componentType,P,b.byteOffset,mp)}))}if(b.sparse){const mp=b.sparse;b._data=b._data.then((y=>{const P=y,w=V.Get(`${p}/sparse/indices/bufferView`,this._gltf.bufferViews,mp.indices.bufferView),t=V.Get(`${p}/sparse/values/bufferView`,this._gltf.bufferViews,mp.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${w.index}`,w),this.loadBufferViewAsync(`/bufferViews/${t.index}`,t)]).then((y=>{let[w,t]=y;const z=N._GetTypedArray(`${p}/sparse/indices`,mp.indices.componentType,w,mp.indices.byteOffset,mp.count),x=h*mp.count;let S;if(5126!==b.componentType||b.normalized){const y=N._GetTypedArray(`${p}/sparse/values`,b.componentType,t,mp.values.byteOffset,x);S=new M(x),L.f.ForEach(y,0,Q,h,b.componentType,S.length,b.normalized||!1,((p,b)=>{S[b]=p}))}else S=N._GetTypedArray(`${p}/sparse/values`,b.componentType,t,mp.values.byteOffset,x);let X=0;for(let p=0;p<z.length;p++){let b=z[p]*h;for(let p=0;p<h;p++)P[b++]=S[X++]}return P}))}))}return b._data}_loadFloatAccessorAsync(p,b){return this._loadAccessorAsync(p,b,Float32Array)}_loadIndicesAccessorAsync(p,b){if("SCALAR"!==b.type)throw new Error(`${p}/type: Invalid value ${b.type}`);if(5121!==b.componentType&&5123!==b.componentType&&5125!==b.componentType)throw new Error(`${p}/componentType: Invalid value ${b.componentType}`);if(b._data)return b._data;if(b.sparse){const M=N._GetTypedArrayConstructor(`${p}/componentType`,b.componentType);b._data=this._loadAccessorAsync(p,b,M)}else{const M=V.Get(`${p}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${M.index}`,M).then((M=>N._GetTypedArray(p,b.componentType,M,b.byteOffset,b.count)))}return b._data}_loadVertexBufferViewAsync(p){if(p._babylonBuffer)return p._babylonBuffer;const b=this._babylonScene.getEngine();return p._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${p.index}`,p).then((p=>new L.d(b,p,!1))),p._babylonBuffer}_loadVertexAccessorAsync(p,b,M){var h;if(null!==(h=b._babylonVertexBuffer)&&void 0!==h&&h[M])return b._babylonVertexBuffer[M];b._babylonVertexBuffer||(b._babylonVertexBuffer={});const Q=this._babylonScene.getEngine();if(b.sparse||void 0==b.bufferView)b._babylonVertexBuffer[M]=this._loadFloatAccessorAsync(p,b).then((p=>new L.f(Q,p,M,!1)));else{const h=V.Get(`${p}/bufferView`,this._gltf.bufferViews,b.bufferView);b._babylonVertexBuffer[M]=this._loadVertexBufferViewAsync(h).then((mp=>{const y=N._GetNumComponents(p,b.type);return new L.f(Q,mp,M,!1,void 0,h.byteStride,void 0,b.byteOffset,y,b.componentType,b.normalized,!0,void 0,!0)}))}return b._babylonVertexBuffer[M]}_loadMaterialMetallicRoughnessPropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const h=new Array;return b&&(b.baseColorFactor?(M.albedoColor=mp.wM.tM(b.baseColorFactor),M.alpha=b.baseColorFactor[3]):M.albedoColor=mp.wM.White(),M.metallic=void 0==b.metallicFactor?1:b.metallicFactor,M.roughness=void 0==b.roughnessFactor?1:b.roughnessFactor,b.baseColorTexture&&h.push(this.loadTextureInfoAsync(`${p}/baseColorTexture`,b.baseColorTexture,(p=>{p.name=`${M.name} (Base Color)`,M.albedoTexture=p}))),b.metallicRoughnessTexture&&(b.metallicRoughnessTexture.nonColorData=!0,h.push(this.loadTextureInfoAsync(`${p}/metallicRoughnessTexture`,b.metallicRoughnessTexture,(p=>{p.name=`${M.name} (Metallic Roughness)`,M.metallicTexture=p}))),M.useMetallnessFromMetallicTextureBlue=!0,M.useRoughnessFromMetallicTextureGreen=!0,M.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(h).then((()=>{}))}_loadMaterialAsync(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const mp=this._extensionsLoadMaterialAsync(p,b,M,h,Q);if(mp)return mp;b._data=b._data||{};let y=b._data[h];if(!y){this.logOpen(`${p} ${b.name||""}`);const M=this.createMaterial(p,b,h);y={babylonMaterial:M,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(p,b,M)},b._data[h]=y,N.AddPointerMetadata(M,p),this._parent.onMaterialLoadedObservable.notifyObservers(M),this.logClose()}return M&&(y.babylonMeshes.push(M),M.Xb.addOnce((()=>{const p=y.babylonMeshes.indexOf(M);-1!==p&&y.babylonMeshes.splice(p,1)}))),Q(y.babylonMaterial),y.promise.then((()=>y.babylonMaterial))}_createDefaultMaterial(p,b){this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new a.c(p,this._babylonScene);return M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M.fillMode=b,M.enableSpecularAntiAliasing=!0,M.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,M.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,M.transparencyMode=a.c.PBRMATERIAL_OPAQUE,M.metallic=1,M.roughness=1,M}createMaterial(p,b,M){const h=this._extensionsCreateMaterial(p,b,M);if(h)return h;const Q=b.name||`material${b.index}`;return this._createDefaultMaterial(Q,M)}loadMaterialPropertiesAsync(p,b,M){const h=this._extensionsLoadMaterialPropertiesAsync(p,b,M);if(h)return h;const Q=new Array;return Q.push(this.loadMaterialBasePropertiesAsync(p,b,M)),b.pbrMetallicRoughness&&Q.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${p}/pbrMetallicRoughness`,b.pbrMetallicRoughness,M)),this.loadMaterialAlphaProperties(p,b,M),Promise.all(Q).then((()=>{}))}loadMaterialBasePropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const h=new Array;return M.emissiveColor=b.emissiveFactor?mp.wM.tM(b.emissiveFactor):new mp.wM(0,0,0),b.doubleSided&&(M.Bb=!1,M.twoSidedLighting=!0),b.normalTexture&&(b.normalTexture.nonColorData=!0,h.push(this.loadTextureInfoAsync(`${p}/normalTexture`,b.normalTexture,(p=>{p.name=`${M.name} (Normal)`,M.bumpTexture=p}))),M.invertNormalMapX=!this._babylonScene.useRightHandedSystem,M.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=b.normalTexture.scale&&M.bumpTexture&&(M.bumpTexture.level=b.normalTexture.scale),M.forceIrradianceInFragment=!0),b.occlusionTexture&&(b.occlusionTexture.nonColorData=!0,h.push(this.loadTextureInfoAsync(`${p}/occlusionTexture`,b.occlusionTexture,(p=>{p.name=`${M.name} (Occlusion)`,M.ambientTexture=p}))),M.useAmbientInGrayScale=!0,void 0!=b.occlusionTexture.strength&&(M.ambientTextureStrength=b.occlusionTexture.strength)),b.emissiveTexture&&h.push(this.loadTextureInfoAsync(`${p}/emissiveTexture`,b.emissiveTexture,(p=>{p.name=`${M.name} (Emissive)`,M.emissiveTexture=p}))),Promise.all(h).then((()=>{}))}loadMaterialAlphaProperties(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);switch(b.alphaMode||"OPAQUE"){case"OPAQUE":M.transparencyMode=a.c.PBRMATERIAL_OPAQUE,M.alpha=1;break;case"MASK":M.transparencyMode=a.c.PBRMATERIAL_ALPHATEST,M.alphaCutOff=void 0==b.alphaCutoff?.5:b.alphaCutoff,M.albedoTexture&&(M.albedoTexture.lb=!0);break;case"BLEND":M.transparencyMode=a.c.PBRMATERIAL_ALPHABLEND,M.albedoTexture&&(M.albedoTexture.lb=!0,M.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${p}/alphaMode: Invalid value (${b.alphaMode})`)}}loadTextureInfoAsync(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const h=this._extensionsLoadTextureInfoAsync(p,b,M);if(h)return h;if(this.logOpen(`${p}`),b.texCoord>=6)throw new Error(`${p}/texCoord: Invalid value (${b.texCoord})`);const Q=V.Get(`${p}/index`,this._gltf.textures,b.index);Q._textureInfo=b;const mp=this._loadTextureAsync(`/textures/${b.index}`,Q,(h=>{h.coordinatesIndex=b.texCoord||0,N.AddPointerMetadata(h,p),this._parent.onTextureLoadedObservable.notifyObservers(h),M(h)}));return this.logClose(),mp}_loadTextureAsync(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const h=this._extensionsLoadTextureAsync(p,b,M);if(h)return h;this.logOpen(`${p} ${b.name||""}`);const Q=void 0==b.sampler?N.DefaultSampler:V.Get(`${p}/sampler`,this._gltf.samplers,b.sampler),mp=V.Get(`${p}/source`,this._gltf.images,b.source),y=this._createTextureAsync(p,Q,mp,M,void 0,!b._textureInfo.nonColorData);return this.logClose(),y}_createTextureAsync(p,b,M){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},mp=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0;const P=this._loadSampler(`/samplers/${b.index}`,b),w=new Array,t=new h;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z={noMipmap:P.noMipMaps,invertY:!1,samplingMode:P.samplingMode,A:()=>{this._disposed||t.resolve()},onError:(b,M)=>{this._disposed||t.reject(new Error(`${p}: ${M&&M.message?M.message:b||"Failed to load texture"}`))},mimeType:M.mimeType??(0,q.j)(M.uri??""),loaderOptions:mp,useSRGBBuffer:!!y&&this._parent.useSRGBBuffers},x=new o.c(null,this._babylonScene,z);return x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.push(t.promise),w.push(this.loadImageAsync(`/images/${M.index}`,M).then((p=>{const b=M.uri||`${this._fileName}#image${M.index}`,h=`data:${this._uniqueRootUrl}${b}`;x.updateURL(h,p);const Q=x.getInternalTexture();Q&&(Q.label=M.name)}))),x.wrapU=P.wrapU,x.wrapV=P.wrapV,Q(x),this._parent.useGltfTextureNames&&(x.name=M.name||M.uri||`image${M.index}`),Promise.all(w).then((()=>x))}_loadSampler(p,b){return b._data||(b._data={noMipMaps:9728===b.minFilter||9729===b.minFilter,samplingMode:N._GetTextureSamplingMode(p,b),wrapU:N._GetTextureWrapMode(`${p}/wrapS`,b.wrapS),wrapV:N._GetTextureWrapMode(`${p}/wrapT`,b.wrapT)}),b._data}loadImageAsync(p,b){if(!b._data){if(this.logOpen(`${p} ${b.name||""}`),b.uri)b._data=this.loadUriAsync(`${p}/uri`,b,b.uri);else{const M=V.Get(`${p}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${M.index}`,M)}this.logClose()}return b._data}loadUriAsync(p,b,M){const h=this._extensionsLoadUriAsync(p,b,M);if(h)return h;if(!N._ValidateUri(M))throw new Error(`${p}: '${M}' is invalid`);if((0,q.k)(M)){const b=new Uint8Array((0,q.e)(M));return this.log(`${p}: Decoded ${M.substring(0,64)}... (${b.length} bytes)`),Promise.resolve(b)}return this.log(`${p}: Loading ${M}`),this._parent.preprocessUrlAsync(this._rootUrl+M).then((b=>new Promise(((h,Q)=>{this._parent._loadFile(this._babylonScene,b,(b=>{this._disposed||(this.log(`${p}: Loaded ${M} (${b.byteLength} bytes)`),h(new Uint8Array(b)))}),!0,(b=>{Q(new q.m(`${p}: Failed to load '${M}'${b?": "+b.status+" "+b.statusText:""}`,b))}))}))))}static AddPointerMetadata(p,b){p.metadata=p.metadata||{};const M=p._internalMetadata=p._internalMetadata||{},h=M.fb=M.fb||{};(h.pointers=h.pointers||[]).push(b)}static _GetTextureWrapMode(p,b){switch(b=void 0==b?10497:b){case 33071:return o.c.CLAMP_ADDRESSMODE;case 33648:return o.c.MIRROR_ADDRESSMODE;case 10497:return o.c.WRAP_ADDRESSMODE;default:return J.d.Warn(`${p}: Invalid value (${b})`),o.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(p,b){const M=void 0==b.magFilter?9729:b.magFilter,h=void 0==b.minFilter?9987:b.minFilter;if(9729===M)switch(h){case 9728:return o.c.LINEAR_NEAREST;case 9729:return o.c.LINEAR_LINEAR;case 9984:return o.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return o.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return o.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return o.c.LINEAR_LINEAR_MIPLINEAR;default:return J.d.Warn(`${p}/minFilter: Invalid value (${h})`),o.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==M&&J.d.Warn(`${p}/magFilter: Invalid value (${M})`),h){case 9728:return o.c.NEAREST_NEAREST;case 9729:return o.c.NEAREST_LINEAR;case 9984:return o.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return o.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return o.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return o.c.NEAREST_LINEAR_MIPLINEAR;default:return J.d.Warn(`${p}/minFilter: Invalid value (${h})`),o.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(p,b){try{return(0,j.n)(b)}catch(M){throw new Error(`${p}: ${M.message}`)}}static _GetTypedArray(p,b,M,h,Q){const mp=M.buffer;h=M.byteOffset+(h||0);const y=N._GetTypedArrayConstructor(`${p}/componentType`,b),P=L.f.GetTypeByteLength(b);return h%P!==0?(J.d.Warn(`${p}: Copying buffer as byte offset (${h}) is not a multiple of component type byte length (${P})`),new y(mp.slice(h,h+Q*P),0)):new y(mp,h,Q)}static _GetNumComponents(p,b){switch(b){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${p}: Invalid type (${b})`)}static _ValidateUri(p){return y.Tools.IsBase64(p)||-1===p.indexOf("..")}static _GetDrawMode(p,b){switch(void 0==b&&(b=4),b){case 0:return Y.b.PointListDrawMode;case 1:return Y.b.LineListDrawMode;case 2:return Y.b.LineLoopDrawMode;case 3:return Y.b.LineStripDrawMode;case 4:return Y.b.TriangleFillMode;case 5:return Y.b.TriangleStripDrawMode;case 6:return Y.b.TriangleFanDrawMode}throw new Error(`${p}: Invalid mesh primitive mode (${b})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const p=new Array;if(this._gltf.materials)for(const b of this._gltf.materials)if(b._data)for(const M in b._data){const h=b._data[M];for(const b of h.babylonMeshes){b.Zb(!0);const M=h.babylonMaterial;p.push(M.forceCompilationAsync(b)),p.push(M.forceCompilationAsync(b,{useInstances:!0})),this._parent.useClipPlane&&(p.push(M.forceCompilationAsync(b,{clipPlane:!0})),p.push(M.forceCompilationAsync(b,{clipPlane:!0,useInstances:!0})))}}return Promise.all(p).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const p=new Array,b=this._babylonScene.lights;for(const M of b){const b=M.getShadowGenerator();b&&p.push(b.forceCompilationAsync())}return Promise.all(p).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(p){for(const b of this._extensions)b.enabled&&p(b)}_applyExtensions(p,b,M){for(const h of this._extensions)if(h.enabled){const Q=`${h.name}.${b}`,mp=p;mp._activeLoaderExtensionFunctions=mp._activeLoaderExtensionFunctions||{};const y=mp._activeLoaderExtensionFunctions;if(!y[Q]){y[Q]=!0;try{const p=M(h);if(p)return p}finally{delete y[Q]}}}return null}_extensionsOnLoading(){this._forEachExtensions((p=>p.onLoading&&p.onLoading()))}_extensionsOnReady(){this._forEachExtensions((p=>p.onReady&&p.onReady()))}_extensionsLoadSceneAsync(p,b){return this._applyExtensions(b,"loadScene",(M=>M.loadSceneAsync&&M.loadSceneAsync(p,b)))}_extensionsLoadNodeAsync(p,b,M){return this._applyExtensions(b,"loadNode",(h=>h.loadNodeAsync&&h.loadNodeAsync(p,b,M)))}_extensionsLoadCameraAsync(p,b,M){return this._applyExtensions(b,"loadCamera",(h=>h.loadCameraAsync&&h.loadCameraAsync(p,b,M)))}_extensionsLoadVertexDataAsync(p,b,M){return this._applyExtensions(b,"loadVertexData",(h=>h._loadVertexDataAsync&&h._loadVertexDataAsync(p,b,M)))}_extensionsLoadMeshPrimitiveAsync(p,b,M,h,Q,mp){return this._applyExtensions(Q,"loadMeshPrimitive",(y=>y._loadMeshPrimitiveAsync&&y._loadMeshPrimitiveAsync(p,b,M,h,Q,mp)))}_extensionsLoadMaterialAsync(p,b,M,h,Q){return this._applyExtensions(b,"loadMaterial",(mp=>mp._loadMaterialAsync&&mp._loadMaterialAsync(p,b,M,h,Q)))}_extensionsCreateMaterial(p,b,M){return this._applyExtensions(b,"createMaterial",(h=>h.createMaterial&&h.createMaterial(p,b,M)))}_extensionsLoadMaterialPropertiesAsync(p,b,M){return this._applyExtensions(b,"loadMaterialProperties",(h=>h.loadMaterialPropertiesAsync&&h.loadMaterialPropertiesAsync(p,b,M)))}_extensionsLoadTextureInfoAsync(p,b,M){return this._applyExtensions(b,"loadTextureInfo",(h=>h.loadTextureInfoAsync&&h.loadTextureInfoAsync(p,b,M)))}_extensionsLoadTextureAsync(p,b,M){return this._applyExtensions(b,"loadTexture",(h=>h._loadTextureAsync&&h._loadTextureAsync(p,b,M)))}_extensionsLoadAnimationAsync(p,b){return this._applyExtensions(b,"loadAnimation",(M=>M.loadAnimationAsync&&M.loadAnimationAsync(p,b)))}_extensionsLoadAnimationChannelAsync(p,b,M,h,Q){return this._applyExtensions(M,"loadAnimationChannel",(mp=>mp._loadAnimationChannelAsync&&mp._loadAnimationChannelAsync(p,b,M,h,Q)))}_extensionsLoadSkinAsync(p,b,M){return this._applyExtensions(M,"loadSkin",(h=>h._loadSkinAsync&&h._loadSkinAsync(p,b,M)))}_extensionsLoadUriAsync(p,b,M){return this._applyExtensions(b,"loadUri",(h=>h._loadUriAsync&&h._loadUriAsync(p,b,M)))}_extensionsLoadBufferViewAsync(p,b){return this._applyExtensions(b,"loadBufferView",(M=>M.loadBufferViewAsync&&M.loadBufferViewAsync(p,b)))}_extensionsLoadBufferAsync(p,b,M,h){return this._applyExtensions(b,"loadBuffer",(Q=>Q.loadBufferAsync&&Q.loadBufferAsync(p,b,M,h)))}static LoadExtensionAsync(p,b,M,h){if(!b.extensions)return null;const Q=b.extensions[M];return Q?h(`${p}/extensions/${M}`,Q):null}static LoadExtraAsync(p,b,M,h){if(!b.extras)return null;const Q=b.extras[M];return Q?h(`${p}/extras/${M}`,Q):null}isExtensionUsed(p){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(p)}logOpen(p){this._parent._logOpen(p)}logClose(){this._parent._logClose()}log(p){this._parent._log(p)}startPerformanceCounter(p){this._parent._startPerformanceCounter(p)}endPerformanceCounter(p){this._parent._endPerformanceCounter(p)}}N.DefaultSampler={index:-1},U.d._CreateGLTF2Loader=p=>new N(p);var O=M(14259),R=M(12957),K=M(12812),r=M(14266),k=M(14275);class A extends k.b{constructor(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",p),this._texture=p.getEngine().createRawCubeTexture(b,M,h,Q,mp,y,P,w)}update(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,p,b,M,h,Q)}updateRGBDAsync(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,r.k)(this._texture,p,b,M,h).then((()=>{}))}clone(){return K.e.Clone((()=>{const p=this.upp(),b=this._texture,M=new A(p,b._bufferViewArray,b.width,b.format,b.type,b.generateMipMaps,b.invertY,b.samplingMode,b._compression);return 13===b.source&&M.updateRGBDAsync(b._bufferViewArrayArray,b._sphericalPolynomial,b._lodGenerationScale,b._lodGenerationOffset),M}),this)}}const n="EXT_lights_image_based";class C{constructor(p){this.name=n,this._loader=p,this.enabled=this._loader.isExtensionUsed(n)}dispose(){this._loader=null,delete this._lights}onLoading(){const p=this._loader.fb.extensions;if(p&&p[this.name]){const b=p[this.name];this._lights=b.lights}}loadSceneAsync(p,b){return N.LoadExtensionAsync(p,b,this.name,(async(M,h)=>{this._loader._allMaterialsDirtyRequired=!0;const Q=new Array;Q.push(this._loader.loadSceneAsync(p,b)),this._loader.logOpen(`${M}`);const mp=V.Get(`${M}/light`,this._lights,h.tb);return Q.push(this._loadLightAsync(`/extensions/${this.name}/lights/${h.tb}`,mp).then((p=>{this._loader.babylonScene.environmentTexture=p}))),this._loader.logClose(),await Promise.all(Q).then((()=>{}))}))}_loadLightAsync(p,b){if(!b._loaded){const M=new Array;this._loader.logOpen(`${p}`);const h=new Array(b.specularImages.length);for(let Q=0;Q<b.specularImages.length;Q++){const mp=b.specularImages[Q];h[Q]=new Array(mp.length);for(let b=0;b<mp.length;b++){const y=`${p}/specularImages/${Q}/${b}`;this._loader.logOpen(`${y}`);const P=mp[b],w=V.Get(y,this._loader.fb.images,P);M.push(this._loader.loadImageAsync(`/images/${P}`,w).then((p=>{h[Q][b]=p}))),this._loader.logClose()}}this._loader.logClose(),b._loaded=Promise.all(M).then((async()=>{const M=new A(this._loader.babylonScene,null,b.specularImageSize);if(M.name=b.name||"environment",b._babylonTexture=M,void 0!=b.Vb&&(M.level=b.Vb),b.rotation){let p=Q.Quaternion.tM(b.rotation);this._loader.babylonScene.useRightHandedSystem||(p=Q.Quaternion.Inverse(p)),Q.Matrix.FromQuaternionToRef(p,M.getReflectionTextureMatrix())}if(!b.irradianceCoefficients)throw new Error(`${p}: Irradiance coefficients are missing`);const mp=R.e.tM(b.irradianceCoefficients);mp.scaleInPlace(b.Vb),mp.convertIrradianceToLambertianRadiance();const y=R.f.FromHarmonics(mp),P=(h.length-1)/Math.log2(b.specularImageSize);return await M.updateRGBDAsync(h,y,P)}))}return b._loaded.then((()=>b._babylonTexture))}}W(n),T(n,!0,(p=>new C(p)));M(13339);const F="EXT_mesh_gpu_instancing";class pp{constructor(p){this.name=F,this._loader=p,this.enabled=this._loader.isExtensionUsed(F)}dispose(){this._loader=null}loadNodeAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(p,h)=>{this._loader._disableInstancedMesh++;const mp=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,M);if(this._loader._disableInstancedMesh--,!b._primitiveBabylonMeshes)return await mp;const y=new Array;let P=0;const w=b=>{if(void 0==h.attributes[b])return void y.push(Promise.resolve(null));const M=V.Get(`${p}/attributes/${b}`,this._loader.fb.accessors,h.attributes[b]);if(y.push(this._loader._loadFloatAccessorAsync(`/accessors/${M.bufferView}`,M)),0===P)P=M.count;else if(P!==M.count)throw new Error(`${p}/attributes: Instance buffer accessors do not have the same count.`)};return w("TRANSLATION"),w("ROTATION"),w("SCALE"),await mp.then((async p=>{const[M,h,mp]=await Promise.all(y),w=new Float32Array(16*P);Q.TmpVectors.QM[0].sb(0,0,0),Q.TmpVectors.Quaternion[0].sb(0,0,0,1),Q.TmpVectors.QM[1].sb(1,1,1);for(let b=0;b<P;++b)M&&Q.QM.FromArrayToRef(M,3*b,Q.TmpVectors.QM[0]),h&&Q.Quaternion.FromArrayToRef(h,4*b,Q.TmpVectors.Quaternion[0]),mp&&Q.QM.FromArrayToRef(mp,3*b,Q.TmpVectors.QM[1]),Q.Matrix.ComposeToRef(Q.TmpVectors.QM[1],Q.TmpVectors.Quaternion[0],Q.TmpVectors.QM[0],Q.TmpVectors.Matrix[0]),Q.TmpVectors.Matrix[0].copyToArray(w,16*b);for(const Q of b._primitiveBabylonMeshes)Q.VS("matrix",w,16,!0);return p}))}))}}W(F),T(F,!0,(p=>new pp(p)));let bp=0,Mp=null;class hp{static get Default(){return hp._Default||(hp._Default=new hp),hp._Default}constructor(){const p=hp.Configuration.decoder;this._decoderModulePromise=y.Tools.LoadBabylonScriptAsync(p.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(p,b,M,h,Q){await this._decoderModulePromise,0===bp&&(MeshoptDecoder.useWorkers(1),bp=1);const mp=await MeshoptDecoder.decodeGltfBufferAsync(b,M,p,h,Q);return null!==Mp&&clearTimeout(Mp),Mp=setTimeout((()=>{MeshoptDecoder.useWorkers(0),bp=0,Mp=null}),1e3),mp}}hp.Configuration={decoder:{url:`${y.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},hp._Default=null;const Qp="EXT_meshopt_compression";class mb{constructor(p){this.name=Qp,this.enabled=p.isExtensionUsed(Qp),this._loader=p}dispose(){this._loader=null}loadBufferViewAsync(p,b){return N.LoadExtensionAsync(p,b,this.name,(async(M,h)=>{const Q=b;if(Q._meshOptData)return await Q._meshOptData;const mp=V.Get(`${p}/buffer`,this._loader.fb.buffers,h.buffer);return Q._meshOptData=this._loader.loadBufferAsync(`/buffers/${mp.index}`,mp,h.byteOffset||0,h.byteLength).then((async p=>await hp.Default.decodeGltfBufferAsync(p,h.count,h.byteStride,h.mode,h.filter))),await Q._meshOptData}))}}W(Qp),T(Qp,!0,(p=>new mb(p)));const yp="EXT_texture_webp";class Pp{constructor(p){this.name=yp,this._loader=p,this.enabled=p.isExtensionUsed(yp)}dispose(){this._loader=null}_loadTextureAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=void 0==b.sampler?N.DefaultSampler:V.Get(`${p}/sampler`,this._loader.fb.samplers,b.sampler),y=V.Get(`${h}/source`,this._loader.fb.images,Q.source);return await this._loader._createTextureAsync(p,mp,y,(p=>{M(p)}),void 0,!b._textureInfo.nonColorData)}))}}W(yp),T(yp,!0,(p=>new Pp(p)));const wp="EXT_texture_avif";class tp{constructor(p){this.name=wp,this._loader=p,this.enabled=p.isExtensionUsed(wp)}dispose(){this._loader=null}_loadTextureAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=void 0==b.sampler?N.DefaultSampler:V.Get(`${p}/sampler`,this._loader.fb.samplers,b.sampler),y=V.Get(`${h}/source`,this._loader.fb.images,Q.source);return await this._loader._createTextureAsync(p,mp,y,(p=>{M(p)}),void 0,!b._textureInfo.nonColorData)}))}}W(wp),T(wp,!0,(p=>new tp(p)));var zp=M(14254),xp=M(13327);const Sp="EXT_lights_ies";class Xp{constructor(p){this.name=Sp,this._loader=p,this.enabled=this._loader.isExtensionUsed(Sp)}dispose(){this._loader=null,delete this._lights}onLoading(){const p=this._loader.fb.extensions;if(p&&p[this.name]){const b=p[this.name];this._lights=b.lights,V.Assign(this._lights)}}loadNodeAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,y)=>{let P,w;this._loader._allMaterialsDirtyRequired=!0;const t=await this._loader.loadNodeAsync(p,b,(p=>{w=V.Get(h,this._lights,y.tb);const b=w.name||p.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,P=new zp.b(b,Q.QM.Zero(),Q.QM.Backward(),0,1,this._loader.babylonScene),P.angle=Math.PI/2,P.innerAngle=0,P._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,w._babylonLight=P,P.falloffType=xp.c.FALLOFF_GLTF,P.Db=y.color?mp.wM.tM(y.color):mp.wM.White(),P.Vb=y.multiplier||1,P.range=Number.MAX_VALUE,P.parent=p,this._loader._babylonLights.push(P),N.AddPointerMetadata(P,h),M(p)}));let z;if(w.uri)z=await this._loader.loadUriAsync(p,w,w.uri);else{const b=V.Get(`${p}/bufferView`,this._loader.fb.bufferViews,w.bufferView);z=await this._loader.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}return P.iesProfileTexture=new o.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,z,!0,void 0,void 0,void 0,void 0,".ies"),t}))}}W(Sp),T(Sp,!0,(p=>new Xp(p)));var cp=M(14286);const Jp="KHR_draco_mesh_compression";class gp{constructor(p){this.name=Jp,this.useNormalizedFlagFromAccessor=!0,this._loader=p,this.enabled=cp.e.DefaultAvailable&&this._loader.isExtensionUsed(Jp)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{if(void 0!=b.mode&&4!==b.mode&&5!==b.mode)throw new Error(`${p}: Unsupported mode ${b.mode}`);const mp={},y={},P=(p,h)=>{const P=Q.attributes[p];if(void 0!=P&&(M._delayInfo=M._delayInfo||[],-1===M._delayInfo.indexOf(h)&&M._delayInfo.push(h),mp[h]=P,this.useNormalizedFlagFromAccessor)){const M=V.TryGet(this._loader.fb.accessors,b.attributes[p]);M&&(y[h]=M.normalized||!1)}};P("POSITION",L.f.PositionKind),P("NORMAL",L.f.NormalKind),P("TANGENT",L.f.TangentKind),P("TEXCOORD_0",L.f.UVKind),P("TEXCOORD_1",L.f.UV2Kind),P("TEXCOORD_2",L.f.UV3Kind),P("TEXCOORD_3",L.f.UV4Kind),P("TEXCOORD_4",L.f.UV5Kind),P("TEXCOORD_5",L.f.UV6Kind),P("JOINTS_0",L.f.MatricesIndicesKind),P("WEIGHTS_0",L.f.MatricesWeightsKind),P("COLOR_0",L.f.ColorKind);const w=V.Get(h,this._loader.fb.bufferViews,Q.bufferView);return w._dracoBabylonGeometry||(w._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((async h=>{const Q=this.dracoDecoder||cp.e.Default,P=V.TryGet(this._loader.fb.accessors,b.attributes.POSITION),w=this._loader.parent.alwaysComputeBoundingBox||M.skeleton||!P?null:D(P);return await Q._decodeMeshToGeometryForGltfAsync(M.name,this._loader.babylonScene,h,mp,y,w).catch((b=>{throw new Error(`${p}: ${b.message}`)}))}))),await w._dracoBabylonGeometry}))}}W(Jp),T(Jp,!0,(p=>new gp(p)));var fp=M(14293),Yp=M(12757),ap=M(12764),op=M(13213),lp=M(13376),Lp=M(12730);op.d.AddNodeConstructor("Light_Type_0",((p,b)=>()=>new upp(p,Q.QM.Zero(),b)));class upp extends lp.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(p){this._shadowAngle=p,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(p){const b=this.needCube();if(this._direction=p,this.needCube()!==b&&this._shadowGenerators){const p=this._shadowGenerators.values();for(let b=p.next();!0!==b.done;b=p.next()){b.value.recreateShadowMap()}}}constructor(p,b,M){super(p,M),this._shadowAngle=Math.PI/2,this.position=b}getClassName(){return"PointLight"}getTypeID(){return xp.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(p){if(this.direction)return super.getShadowDirection(p);switch(p){case 0:return new Q.QM(1,0,0);case 1:return new Q.QM(-1,0,0);case 2:return new Q.QM(0,-1,0);case 3:return new Q.QM(0,1,0);case 4:return new Q.QM(0,0,1);case 5:return new Q.QM(0,0,-1)}return Q.QM.Zero()}_setDefaultShadowProjectionMatrix(p,b,M){const h=this.upp().activeCamera;if(!h)return;const mp=void 0!==this.shadowMinZ?this.shadowMinZ:h.Ib,y=void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,P=this.upp().getEngine().zb;Q.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,P?y:mp,P?mp:y,p,!0,this._scene.getEngine().isNDCHalfZRange,void 0,P)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(p,b){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,b):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,b),this}transferToNodeMaterialEffect(p,b){return this.computeTransformedInformation()?p.setFloat3(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):p.setFloat3(b,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(p,b){p["POINTLIGHT"+b]=!0}}(0,Yp.e)([(0,ap.N)()],upp.prototype,"shadowAngle",null),(0,Lp.c)("BABYLON.PointLight",upp);const ep="KHR_lights_punctual";class dp{constructor(p){this.name=ep,this._loader=p,this.enabled=this._loader.isExtensionUsed(ep)}dispose(){this._loader=null,delete this._lights}onLoading(){const p=this._loader.fb.extensions;if(p&&p[this.name]){const b=p[this.name];this._lights=b.lights,V.Assign(this._lights)}}loadNodeAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(p,b,(p=>{let b;const P=V.Get(h,this._lights,y.tb),w=P.name||p.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,P.type){case"directional":{const p=new fp.d(w,Q.QM.Backward(),this._loader.babylonScene);p.position.Tb(0),b=p;break}case"point":b=new upp(w,Q.QM.Zero(),this._loader.babylonScene);break;case"spot":{const p=new zp.b(w,Q.QM.Zero(),Q.QM.Backward(),0,1,this._loader.babylonScene);p.angle=2*(P.spot&&P.spot.outerConeAngle||Math.PI/4),p.innerAngle=2*(P.spot&&P.spot.innerConeAngle||0),b=p;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${h}: Invalid light type (${P.type})`)}b._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,P._babylonLight=b,b.falloffType=xp.c.FALLOFF_GLTF,b.Db=P.color?mp.wM.tM(P.color):mp.wM.White(),b.Vb=void 0==P.Vb?1:P.Vb,b.range=void 0==P.range?Number.MAX_VALUE:P.range,b.parent=p,this._loader._babylonLights.push(b),N.AddPointerMetadata(b,h),M(p)})))))}}W(ep),T(ep,!0,(p=>new dp(p)));const Ip="KHR_materials_pbrSpecularGlossiness";class Gp{constructor(p){this.name=Ip,this.order=200,this._loader=p,this.enabled=this._loader.isExtensionUsed(Ip)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;return mp.push(this._loader.loadMaterialBasePropertiesAsync(p,b,M)),mp.push(this._loadSpecularGlossinessPropertiesAsync(h,Q,M)),this._loader.loadMaterialAlphaProperties(p,b,M),await Promise.all(mp).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const h=new Array;return M.metallic=null,M.roughness=null,b.diffuseFactor?(M.albedoColor=mp.wM.tM(b.diffuseFactor),M.alpha=b.diffuseFactor[3]):M.albedoColor=mp.wM.White(),M.reflectivityColor=b.specularFactor?mp.wM.tM(b.specularFactor):mp.wM.White(),M.microSurface=void 0==b.glossinessFactor?1:b.glossinessFactor,b.diffuseTexture&&h.push(this._loader.loadTextureInfoAsync(`${p}/diffuseTexture`,b.diffuseTexture,(p=>{p.name=`${M.name} (Diffuse)`,M.albedoTexture=p}))),b.specularGlossinessTexture&&(h.push(this._loader.loadTextureInfoAsync(`${p}/specularGlossinessTexture`,b.specularGlossinessTexture,(p=>{p.name=`${M.name} (Specular Glossiness)`,M.reflectivityTexture=p,M.reflectivityTexture.lb=!0}))),M.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(h).then((()=>{}))}}W(Ip),T(Ip,!0,(p=>new Gp(p)));const vp="KHR_materials_unlit";class Zp{constructor(p){this.name=vp,this.order=210,this._loader=p,this.enabled=this._loader.isExtensionUsed(vp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async()=>await this._loadUnlitPropertiesAsync(p,b,M)))}_loadUnlitPropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const h=new Array;M.unlit=!0;const Q=b.pbrMetallicRoughness;return Q&&(Q.baseColorFactor?(M.albedoColor=mp.wM.tM(Q.baseColorFactor),M.alpha=Q.baseColorFactor[3]):M.albedoColor=mp.wM.White(),Q.baseColorTexture&&h.push(this._loader.loadTextureInfoAsync(`${p}/baseColorTexture`,Q.baseColorTexture,(p=>{p.name=`${M.name} (Base Color)`,M.albedoTexture=p})))),b.doubleSided&&(M.Bb=!1,M.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(p,b,M),Promise.all(h).then((()=>{}))}}W(vp),T(vp,!0,(p=>new Zp(p)));const Up="KHR_materials_clearcoat";class qp{constructor(p){this.name=Up,this.order=190,this._loader=p,this.enabled=this._loader.isExtensionUsed(Up)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadClearCoatPropertiesAsync(h,Q,M)),await Promise.all(mp)}))}_loadClearCoatPropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const h=new Array;return M.clearCoat.isEnabled=!0,M.clearCoat.useRoughnessFromMainTexture=!1,M.clearCoat.remapF0OnInterfaceChange=!1,void 0!=b.clearcoatFactor?M.clearCoat.Vb=b.clearcoatFactor:M.clearCoat.Vb=0,b.clearcoatTexture&&h.push(this._loader.loadTextureInfoAsync(`${p}/clearcoatTexture`,b.clearcoatTexture,(p=>{p.name=`${M.name} (ClearCoat)`,M.clearCoat.texture=p}))),void 0!=b.clearcoatRoughnessFactor?M.clearCoat.roughness=b.clearcoatRoughnessFactor:M.clearCoat.roughness=0,b.clearcoatRoughnessTexture&&(b.clearcoatRoughnessTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${p}/clearcoatRoughnessTexture`,b.clearcoatRoughnessTexture,(p=>{p.name=`${M.name} (ClearCoat Roughness)`,M.clearCoat.textureRoughness=p})))),b.clearcoatNormalTexture&&(b.clearcoatNormalTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${p}/clearcoatNormalTexture`,b.clearcoatNormalTexture,(p=>{p.name=`${M.name} (ClearCoat Normal)`,M.clearCoat.bumpTexture=p}))),M.invertNormalMapX=!M.upp().useRightHandedSystem,M.invertNormalMapY=M.upp().useRightHandedSystem,void 0!=b.clearcoatNormalTexture.scale&&(M.clearCoat.bumpTexture.level=b.clearcoatNormalTexture.scale)),Promise.all(h).then((()=>{}))}}W(Up),T(Up,!0,(p=>new qp(p)));const Bp="KHR_materials_iridescence";class sp{constructor(p){this.name=Bp,this.order=195,this._loader=p,this.enabled=this._loader.isExtensionUsed(Bp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;return mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadIridescencePropertiesAsync(h,Q,M)),await Promise.all(mp).then((()=>{}))}))}_loadIridescencePropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const h=new Array;return M.iridescence.isEnabled=!0,M.iridescence.Vb=b.iridescenceFactor??0,M.iridescence.indexOfRefraction=b.iridescenceIor??b.iridescenceIOR??1.3,M.iridescence.minimumThickness=b.iridescenceThicknessMinimum??100,M.iridescence.maximumThickness=b.iridescenceThicknessMaximum??400,b.iridescenceTexture&&h.push(this._loader.loadTextureInfoAsync(`${p}/iridescenceTexture`,b.iridescenceTexture,(p=>{p.name=`${M.name} (Iridescence)`,M.iridescence.texture=p}))),b.iridescenceThicknessTexture&&h.push(this._loader.loadTextureInfoAsync(`${p}/iridescenceThicknessTexture`,b.iridescenceThicknessTexture,(p=>{p.name=`${M.name} (Iridescence Thickness)`,M.iridescence.thicknessTexture=p}))),Promise.all(h).then((()=>{}))}}W(Bp),T(Bp,!0,(p=>new sp(p)));const ip="KHR_materials_anisotropy";class Tp{constructor(p){this.name=ip,this.order=195,this._loader=p,this.enabled=this._loader.isExtensionUsed(ip)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadIridescencePropertiesAsync(h,Q,M)),await Promise.all(mp)}))}async _loadIridescencePropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const h=new Array;M.anisotropy.isEnabled=!0,M.anisotropy.Vb=b.anisotropyStrength??0,M.anisotropy.angle=b.anisotropyRotation??0,b.anisotropyTexture&&(b.anisotropyTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${p}/anisotropyTexture`,b.anisotropyTexture,(p=>{p.name=`${M.name} (Anisotropy Intensity)`,M.anisotropy.texture=p})))),await Promise.all(h)}}W(ip),T(ip,!0,(p=>new Tp(p)));const Wp="KHR_materials_emissive_strength";class Hp{constructor(p){this.name=Wp,this.order=170,this._loader=p,this.enabled=this._loader.isExtensionUsed(Wp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>await this._loader.loadMaterialPropertiesAsync(p,b,M).then((()=>{this._loadEmissiveProperties(h,Q,M)}))))}_loadEmissiveProperties(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);void 0!==b.emissiveStrength&&(M.emissiveIntensity=b.emissiveStrength)}}W(Wp),T(Wp,!0,(p=>new Hp(p)));const Ep="KHR_materials_sheen";class jp{constructor(p){this.name=Ep,this.order=190,this._loader=p,this.enabled=this._loader.isExtensionUsed(Ep)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;return mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadSheenPropertiesAsync(h,Q,M)),await Promise.all(mp).then((()=>{}))}))}_loadSheenPropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const h=new Array;return M.sheen.isEnabled=!0,M.sheen.Vb=1,void 0!=b.sheenColorFactor?M.sheen.color=mp.wM.tM(b.sheenColorFactor):M.sheen.color=mp.wM.Black(),b.sheenColorTexture&&h.push(this._loader.loadTextureInfoAsync(`${p}/sheenColorTexture`,b.sheenColorTexture,(p=>{p.name=`${M.name} (Sheen Color)`,M.sheen.texture=p}))),void 0!==b.sheenRoughnessFactor?M.sheen.roughness=b.sheenRoughnessFactor:M.sheen.roughness=0,b.sheenRoughnessTexture&&(b.sheenRoughnessTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${p}/sheenRoughnessTexture`,b.sheenRoughnessTexture,(p=>{p.name=`${M.name} (Sheen Roughness)`,M.sheen.textureRoughness=p})))),M.sheen.albedoScaling=!0,M.sheen.useRoughnessFromMainTexture=!1,Promise.all(h).then((()=>{}))}}W(Ep),T(Ep,!0,(p=>new jp(p)));var Vp=M(13258);const Dp="KHR_materials_specular";class Np{constructor(p){this.name=Dp,this.order=190,this._loader=p,this.enabled=this._loader.isExtensionUsed(Dp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;if(mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadSpecularPropertiesAsync(h,Q,M)),Q.extensions&&Q.extensions.EXT_materials_specular_edge_color&&M instanceof a.c){Q.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(M.brdf.dielectricSpecularModel=Vp.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,M.brdf.conductorSpecularModel=Vp.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(mp).then((()=>{}))}))}_loadSpecularPropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const h=new Array;return void 0!==b.specularFactor&&(M.metallicF0Factor=b.specularFactor),void 0!==b.specularColorFactor&&(M.metallicReflectanceColor=mp.wM.tM(b.specularColorFactor)),b.specularTexture&&(b.specularTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${p}/specularTexture`,b.specularTexture,(p=>{p.name=`${M.name} (Specular)`,M.metallicReflectanceTexture=p,M.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),b.specularColorTexture&&h.push(this._loader.loadTextureInfoAsync(`${p}/specularColorTexture`,b.specularColorTexture,(p=>{p.name=`${M.name} (Specular Color)`,M.reflectanceTexture=p}))),Promise.all(h).then((()=>{}))}}W(Dp),T(Dp,!0,(p=>new Np(p)));const Op="KHR_materials_ior";class Rp{constructor(p){this.name=Op,this.order=180,this._loader=p,this.enabled=this._loader.isExtensionUsed(Op)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;return mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadIorPropertiesAsync(h,Q,M)),await Promise.all(mp).then((()=>{}))}))}_loadIorPropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);return void 0!==b.ior?M.indexOfRefraction=b.ior:M.indexOfRefraction=Rp._DEFAULT_IOR,Promise.resolve()}}Rp._DEFAULT_IOR=1.5,W(Op),T(Op,!0,(p=>new Rp(p)));const Kp="KHR_materials_variants";class rp{constructor(p){this.name=Kp,this._loader=p,this.enabled=this._loader.isExtensionUsed(Kp)}dispose(){this._loader=null}static GetAvailableVariants(p){const b=this._GetExtensionMetadata(p);return b?Object.keys(b.variants):[]}getAvailableVariants(p){return rp.GetAvailableVariants(p)}static SelectVariant(p,b){const M=this._GetExtensionMetadata(p);if(!M)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Kp} extension`);const h=p=>{const b=M.variants[p];if(b)for(const M of b)M.mesh.material=M.material};if(b instanceof Array)for(const Q of b)h(Q);else h(b);M.lastSelected=b}selectVariant(p,b){rp.SelectVariant(p,b)}static Reset(p){const b=this._GetExtensionMetadata(p);if(!b)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Kp} extension`);for(const M of b.original)M.mesh.material=M.material;b.lastSelected=null}reset(p){rp.Reset(p)}static GetLastSelectedVariant(p){const b=this._GetExtensionMetadata(p);if(!b)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Kp} extension`);return b.lastSelected}getLastSelectedVariant(p){return rp.GetLastSelectedVariant(p)}static _GetExtensionMetadata(p){var b,M;return(null===p||void 0===p||null===(b=p._internalMetadata)||void 0===b||null===(M=b.fb)||void 0===M?void 0:M[Kp])||null}onLoading(){const p=this._loader.fb.extensions;if(p&&p[this.name]){const b=p[this.name];this._variants=b.variants}}onReady(){const p=this._loader.rootBabylonMesh;if(p){var b;const M=this._loader.parent.extensionOptions[Kp];null!==M&&void 0!==M&&M.defaultVariant&&rp.SelectVariant(p,M.defaultVariant),null===M||void 0===M||null===(b=M.onLoaded)||void 0===b||b.call(M,{get variants(){return rp.GetAvailableVariants(p)},get selectedVariant(){const b=rp.GetLastSelectedVariant(p);return b?Array.isArray(b)?b[0]:b:rp.GetAvailableVariants(p)[0]},set selectedVariant(b){rp.SelectVariant(p,b)}})}}_loadMeshPrimitiveAsync(p,b,M,h,Q,mp){return N.LoadExtensionAsync(p,Q,this.name,(async(y,P)=>{const w=new Array;return w.push(this._loader._loadMeshPrimitiveAsync(p,b,M,h,Q,(b=>{if(mp(b),b instanceof d.e){const M=N._GetDrawMode(p,Q.mode),h=this._loader.rootBabylonMesh,mp=h?h._internalMetadata=h._internalMetadata||{}:{},t=mp.fb=mp.fb||{},z=t[Kp]=t[Kp]||{lastSelected:null,original:[],variants:{}};z.original.push({mesh:b,material:b.material});for(let p=0;p<P.mappings.length;++p){const Q=P.mappings[p],mp=V.Get(`${y}/mappings/${p}/material`,this._loader.fb.materials,Q.material);w.push(this._loader._loadMaterialAsync(`#/materials/${Q.material}`,mp,b,M,(p=>{for(let M=0;M<Q.variants.length;++M){const mp=Q.variants[M],y=V.Get(`/extensions/${Kp}/variants/${mp}`,this._variants,mp);z.variants[y.name]=z.variants[y.name]||[],z.variants[y.name].push({mesh:b,material:p}),b.onClonedObservable.add((p=>{const M=p;let Q=null,mp=M;do{if(mp=mp.parent,!mp)return;Q=rp._GetExtensionMetadata(mp)}while(null===Q);if(h&&Q===rp._GetExtensionMetadata(h)){mp._internalMetadata={};for(const p in h._internalMetadata)mp._internalMetadata[p]=h._internalMetadata[p];mp._internalMetadata.fb=[];for(const p in h._internalMetadata.fb)mp._internalMetadata.fb[p]=h._internalMetadata.fb[p];mp._internalMetadata.fb[Kp]={lastSelected:null,original:[],variants:{}};for(const p of Q.original)mp._internalMetadata.fb[Kp].original.push({mesh:p.mesh,material:p.material});for(const p in Q.variants)if(Object.prototype.hasOwnProperty.call(Q.variants,p)){mp._internalMetadata.fb[Kp].variants[p]=[];for(const b of Q.variants[p])mp._internalMetadata.fb[Kp].variants[p].push({mesh:b.mesh,material:b.material})}Q=mp._internalMetadata.fb[Kp]}for(const h of Q.original)h.mesh===b&&(h.mesh=M);for(const h of Q.variants[y.name])h.mesh===b&&(h.mesh=M)}))}})))}}}))),await Promise.all(w).then((p=>{let[b]=p;return b}))}))}}W(Kp),T(Kp,!0,(p=>new rp(p)));var kp=M(12837);class Ap{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Vp.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(p,b){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Ap._GetDefaultOptions(),...p},this._scene=b,this._scene._transmissionHelper=this,this.onErrorObservable=new z.d,this._scene.Xb.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(p){if(!Object.keys(p).filter((b=>this._options[b]!==p[b])).length)return;const b={...this._options,...p},M=this._options;this._options=b,b.renderSize===M.renderSize&&b.renderTargetTextureType===M.renderTargetTextureType&&b.generateMipmaps===M.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=b.samples,this._opaqueRenderTarget.lodGenerationScale=b.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=b.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(p){return!!p&&!!(p instanceof a.c&&p.subSurface.isRefractionEnabled)}_addMesh(p){this._materialObservers[p.uniqueId]=p.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),y.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(p.material)?(p.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(p)&&this._transparentMeshesCache.push(p)):-1===this._opaqueMeshesCache.indexOf(p)&&this._opaqueMeshesCache.push(p)}))}_removeMesh(p){p.onMaterialChangedObservable.remove(this._materialObservers[p.uniqueId]),delete this._materialObservers[p.uniqueId];let b=this._transparentMeshesCache.indexOf(p);-1!==b&&this._transparentMeshesCache.splice(b,1),b=this._opaqueMeshesCache.indexOf(p),-1!==b&&this._opaqueMeshesCache.splice(b,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(p){const b=this._transparentMeshesCache.indexOf(p),M=this._opaqueMeshesCache.indexOf(p);this._shouldRenderAsTransmission(p.material)?(p.material instanceof a.c&&(p.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==M?(this._opaqueMeshesCache.splice(M,1),this._transparentMeshesCache.push(p)):-1===b&&this._transparentMeshesCache.push(p)):-1!==b?(this._transparentMeshesCache.splice(b,1),this._opaqueMeshesCache.push(p)):-1===M&&this._opaqueMeshesCache.push(p)}_isRenderTargetValid(){var p;return null!==(null===(p=this._opaqueRenderTarget)||void 0===p?void 0:p.getInternalTexture())}_setupRenderTargets(){var p;let b;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new kp.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(p=this._options.clearColor)||void 0===p?void 0:p.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((p=>{b=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?p.clearColor.mp(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(p.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=b}));for(const M of this._transparentMeshesCache)this._shouldRenderAsTransmission(M.material)&&(M.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const np="KHR_materials_transmission";class Cp{constructor(p){this.name=np,this.order=175,this._loader=p,this.enabled=this._loader.isExtensionUsed(np),this.enabled&&(p.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;return mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadTransparentPropertiesAsync(h,b,M,Q)),await Promise.all(mp).then((()=>{}))}))}_loadTransparentPropertiesAsync(p,b,M,h){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const Q=M;if(Q.subSurface.isRefractionEnabled=!0,Q.subSurface.volumeIndexOfRefraction=1,Q.subSurface.useAlbedoToTintRefraction=!0,void 0===h.transmissionFactor)return Q.subSurface.refractionIntensity=0,Q.subSurface.isRefractionEnabled=!1,Promise.resolve();{var mp;Q.subSurface.refractionIntensity=h.transmissionFactor;const p=Q.upp();if(Q.subSurface.refractionIntensity&&!p._transmissionHelper)new Ap({},Q.upp());else if(Q.subSurface.refractionIntensity&&(null===(mp=p._transmissionHelper)||void 0===mp||!mp._isRenderTargetValid())){var y;null===(y=p._transmissionHelper)||void 0===y||y._setupRenderTargets()}}return Q.subSurface.minimumThickness=0,Q.subSurface.maximumThickness=0,h.transmissionTexture?(h.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${p}/transmissionTexture`,h.transmissionTexture,void 0).then((p=>{p.name=`${M.name} (Transmission)`,Q.subSurface.refractionIntensityTexture=p,Q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}W(np),T(np,!0,(p=>new Cp(p)));const Fp="KHR_materials_diffuse_transmission";class pb{constructor(p){this.name=Fp,this.order=174,this._loader=p,this.enabled=this._loader.isExtensionUsed(Fp),this.enabled&&(p.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;return mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadTranslucentPropertiesAsync(h,b,M,Q)),await Promise.all(mp).then((()=>{}))}))}_loadTranslucentPropertiesAsync(p,b,M,h){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const Q=M;if(Q.subSurface.isTranslucencyEnabled=!0,Q.subSurface.volumeIndexOfRefraction=1,Q.subSurface.minimumThickness=0,Q.subSurface.maximumThickness=0,Q.subSurface.useAlbedoToTintTranslucency=!1,void 0===h.diffuseTransmissionFactor)return Q.subSurface.translucencyIntensity=0,Q.subSurface.isTranslucencyEnabled=!1,Promise.resolve();Q.subSurface.translucencyIntensity=h.diffuseTransmissionFactor;const y=new Array;return Q.subSurface.useGltfStyleTextures=!0,h.diffuseTransmissionTexture&&(h.diffuseTransmissionTexture.nonColorData=!0,y.push(this._loader.loadTextureInfoAsync(`${p}/diffuseTransmissionTexture`,h.diffuseTransmissionTexture).then((p=>{p.name=`${M.name} (Diffuse Transmission)`,Q.subSurface.translucencyIntensityTexture=p})))),void 0!==h.diffuseTransmissionColorFactor?Q.subSurface.translucencyColor=mp.wM.tM(h.diffuseTransmissionColorFactor):Q.subSurface.translucencyColor=mp.wM.White(),h.diffuseTransmissionColorTexture&&y.push(this._loader.loadTextureInfoAsync(`${p}/diffuseTransmissionColorTexture`,h.diffuseTransmissionColorTexture).then((p=>{p.name=`${M.name} (Diffuse Transmission Color)`,Q.subSurface.translucencyColorTexture=p}))),Promise.all(y).then((()=>{}))}}W(Fp),T(Fp,!0,(p=>new pb(p)));const bb="KHR_materials_volume";class Mb{constructor(p){this.name=bb,this.order=173,this._loader=p,this.enabled=this._loader.isExtensionUsed(bb),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;return mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadVolumePropertiesAsync(h,b,M,Q)),await Promise.all(mp).then((()=>{}))}))}_loadVolumePropertiesAsync(p,b,M,h){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);if(!M.subSurface.isRefractionEnabled&&!M.subSurface.isTranslucencyEnabled||!h.thicknessFactor)return Promise.resolve();M.subSurface.volumeIndexOfRefraction=M.indexOfRefraction;const Q=void 0!==h.attenuationDistance?h.attenuationDistance:Number.MAX_VALUE;return M.subSurface.tintColorAtDistance=Q,void 0!==h.attenuationColor&&3==h.attenuationColor.length&&M.subSurface.tintColor.sb(h.attenuationColor[0],h.attenuationColor[1],h.attenuationColor[2]),M.subSurface.minimumThickness=0,M.subSurface.maximumThickness=h.thicknessFactor,M.subSurface.useThicknessAsDepth=!0,h.thicknessTexture?(h.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${p}/thicknessTexture`,h.thicknessTexture).then((p=>{p.name=`${M.name} (Thickness)`,M.subSurface.thicknessTexture=p,M.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}W(bb),T(bb,!0,(p=>new Mb(p)));const hb="KHR_materials_dispersion";class Qb{constructor(p){this.name=hb,this.order=174,this._loader=p,this.enabled=this._loader.isExtensionUsed(hb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;return mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadDispersionPropertiesAsync(h,b,M,Q)),await Promise.all(mp).then((()=>{}))}))}_loadDispersionPropertiesAsync(p,b,M,h){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);return M.subSurface.isRefractionEnabled&&h.dispersion?(M.subSurface.isDispersionEnabled=!0,M.subSurface.dispersion=h.dispersion,Promise.resolve()):Promise.resolve()}}W(hb),T(hb,!0,(p=>new Qb(p)));const mM="EXT_materials_diffuse_roughness";class yb{constructor(p){this.name=mM,this.order=190,this._loader=p,this.enabled=this._loader.isExtensionUsed(mM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=new Array;return mp.push(this._loader.loadMaterialPropertiesAsync(p,b,M)),mp.push(this._loadDiffuseRoughnessPropertiesAsync(h,Q,M)),await Promise.all(mp).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(p,b,M){if(!(M instanceof a.c))throw new Error(`${p}: Material type not supported`);const h=new Array;return M.brdf.baseDiffuseModel=Vp.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=b.diffuseRoughnessFactor?M.baseDiffuseRoughness=b.diffuseRoughnessFactor:M.baseDiffuseRoughness=0,b.diffuseRoughnessTexture&&h.push(this._loader.loadTextureInfoAsync(`${p}/diffuseRoughnessTexture`,b.diffuseRoughnessTexture,(p=>{p.name=`${M.name} (Diffuse Roughness)`,M.baseDiffuseRoughnessTexture=p}))),Promise.all(h).then((()=>{}))}}W(mM),T(mM,!0,(p=>new yb(p)));const Pb="KHR_mesh_quantization";class wb{constructor(p){this.name=Pb,this.enabled=p.isExtensionUsed(Pb)}dispose(){}}W(Pb),T(Pb,!0,(p=>new wb(p)));const tb="KHR_texture_basisu";class zb{constructor(p){this.name=tb,this._loader=p,this.enabled=p.isExtensionUsed(tb)}dispose(){this._loader=null}_loadTextureAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>{const mp=void 0==b.sampler?N.DefaultSampler:V.Get(`${p}/sampler`,this._loader.fb.samplers,b.sampler),y=V.Get(`${h}/source`,this._loader.fb.images,Q.source);return await this._loader._createTextureAsync(p,mp,y,(p=>{M(p)}),b._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!b._textureInfo.nonColorData)}))}}W(tb),T(tb,!0,(p=>new zb(p)));const xb="KHR_texture_transform";class Sb{constructor(p){this.name=xb,this._loader=p,this.enabled=this._loader.isExtensionUsed(xb)}dispose(){this._loader=null}loadTextureInfoAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(h,Q)=>await this._loader.loadTextureInfoAsync(p,b,(p=>{if(!(p instanceof o.c))throw new Error(`${h}: Texture type not supported`);Q.offset&&(p.uOffset=Q.offset[0],p.vOffset=Q.offset[1]),p.uRotationCenter=0,p.vRotationCenter=0,Q.rotation&&(p.wAng=-Q.rotation),Q.scale&&(p.uScale=Q.scale[0],p.vScale=Q.scale[1]),void 0!=Q.texCoord&&(p.coordinatesIndex=Q.texCoord),M(p)}))))}}W(xb),T(xb,!0,(p=>new Sb(p)));const Xb="KHR_xmp_json_ld";class cb{constructor(p){this.name=Xb,this.order=100,this._loader=p,this.enabled=this._loader.isExtensionUsed(Xb)}dispose(){this._loader=null}onLoading(){var p,b,M;if(null===this._loader.rootBabylonMesh)return;const h=null===(p=this._loader.fb.extensions)||void 0===p?void 0:p.KHR_xmp_json_ld,Q=null===(b=this._loader.fb.asset)||void 0===b||null===(M=b.extensions)||void 0===M?void 0:M.KHR_xmp_json_ld;if(h&&Q){const p=+Q.packet;h.packets&&p<h.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=h.packets[p])}}}function Jb(p,b,M,h){return mp.wM.tM(b,M).scale(h)}function gb(p,b,M,h){return b[M]*h}function fb(p,b,M,h){return-b[M]*h}function Yb(p,b,M,h){return b[M+1]*h}function ab(p,b,M,h){return b[M]*h*2}function ob(p){return{scale:[new Lb(S.d.ANIMATIONTYPE_FLOAT,`${p}.uScale`,gb,(()=>2)),new Lb(S.d.ANIMATIONTYPE_FLOAT,`${p}.vScale`,Yb,(()=>2))],offset:[new Lb(S.d.ANIMATIONTYPE_FLOAT,`${p}.uOffset`,gb,(()=>2)),new Lb(S.d.ANIMATIONTYPE_FLOAT,`${p}.vOffset`,Yb,(()=>2))],rotation:[new Lb(S.d.ANIMATIONTYPE_FLOAT,`${p}.wAng`,fb,(()=>1))]}}W(Xb),T(Xb,!0,(p=>new cb(p)));class lb extends O.AnimationPropertyInfo{buildAnimations(p,b,M,h){return[{babylonAnimatable:p._babylonCamera,babylonAnimation:this._buildAnimation(b,M,h)}]}}class Lb extends O.AnimationPropertyInfo{buildAnimations(p,b,M,h){const Q=[];for(const mp in p._data)Q.push({babylonAnimatable:p._data[mp].babylonMaterial,babylonAnimation:this._buildAnimation(b,M,h)});return Q}}class ub extends O.AnimationPropertyInfo{buildAnimations(p,b,M,h){return[{babylonAnimatable:p._babylonLight,babylonAnimation:this._buildAnimation(b,M,h)}]}}(0,H.h)("/cameras/{}/orthographic/xmag",[new lb(S.d.ANIMATIONTYPE_FLOAT,"orthoLeft",fb,(()=>1)),new lb(S.d.ANIMATIONTYPE_FLOAT,"orthoRight",Yb,(()=>1))]),(0,H.h)("/cameras/{}/orthographic/ymag",[new lb(S.d.ANIMATIONTYPE_FLOAT,"orthoBottom",fb,(()=>1)),new lb(S.d.ANIMATIONTYPE_FLOAT,"orthoTop",Yb,(()=>1))]),(0,H.h)("/cameras/{}/orthographic/zfar",[new lb(S.d.ANIMATIONTYPE_FLOAT,"maxZ",gb,(()=>1))]),(0,H.h)("/cameras/{}/orthographic/znear",[new lb(S.d.ANIMATIONTYPE_FLOAT,"Ib",gb,(()=>1))]),(0,H.h)("/cameras/{}/perspective/yfov",[new lb(S.d.ANIMATIONTYPE_FLOAT,"fov",gb,(()=>1))]),(0,H.h)("/cameras/{}/perspective/zfar",[new lb(S.d.ANIMATIONTYPE_FLOAT,"maxZ",gb,(()=>1))]),(0,H.h)("/cameras/{}/perspective/znear",[new lb(S.d.ANIMATIONTYPE_FLOAT,"Ib",gb,(()=>1))]),(0,H.h)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Lb(S.d.ANIMATIONTYPE_COLOR3,"albedoColor",Jb,(()=>4)),new Lb(S.d.ANIMATIONTYPE_FLOAT,"alpha",(function(p,b,M,h){return b[M+3]*h}),(()=>4))]),(0,H.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"metallic",gb,(()=>1))]),(0,H.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"roughness",gb,(()=>1))]);const eb=ob("albedoTexture");(0,H.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",eb.scale),(0,H.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",eb.offset),(0,H.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",eb.rotation);const db=ob("metallicTexture");(0,H.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",db.scale),(0,H.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",db.offset),(0,H.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",db.rotation),(0,H.h)("/materials/{}/emissiveFactor",[new Lb(S.d.ANIMATIONTYPE_COLOR3,"emissiveColor",Jb,(()=>3))]);const Ib=ob("bumpTexture");(0,H.h)("/materials/{}/normalTexture/scale",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",gb,(()=>1))]),(0,H.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Ib.scale),(0,H.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Ib.offset),(0,H.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Ib.rotation),(0,H.h)("/materials/{}/occlusionTexture/strength",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",gb,(()=>1))]);const Gb=ob("ambientTexture");(0,H.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Gb.scale),(0,H.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Gb.offset),(0,H.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Gb.rotation);const vb=ob("emissiveTexture");(0,H.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",vb.scale),(0,H.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",vb.offset),(0,H.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",vb.rotation),(0,H.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",gb,(()=>1))]);const Zb=ob("anisotropy.texture");(0,H.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Zb.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Zb.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Zb.rotation),(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",gb,(()=>1))]);const Ub=ob("clearCoat.texture");(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Ub.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Ub.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Ub.rotation);const qb=ob("clearCoat.bumpTexture");(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",qb.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",qb.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",qb.rotation);const Bb=ob("clearCoat.textureRoughness");(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Bb.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Bb.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Bb.rotation),(0,H.h)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_ior/ior",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",gb,(()=>1))]);const sb=ob("iridescence.texture");(0,H.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",sb.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",sb.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",sb.rotation);const ib=ob("iridescence.thicknessTexture");(0,H.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",ib.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",ib.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",ib.rotation),(0,H.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Lb(S.d.ANIMATIONTYPE_COLOR3,"sheen.color",Jb,(()=>3))]),(0,H.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",gb,(()=>1))]);const Tb=ob("sheen.texture");(0,H.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Tb.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Tb.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Tb.rotation);const Wb=ob("sheen.textureRoughness");(0,H.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Wb.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Wb.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Wb.rotation),(0,H.h)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Lb(S.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Jb,(()=>3))]);const Hb=ob("metallicReflectanceTexture");(0,H.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Hb.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Hb.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Hb.rotation);const Eb=ob("reflectanceTexture");(0,H.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Eb.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Eb.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Eb.rotation),(0,H.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",gb,(()=>1))]);const jb=ob("subSurface.refractionIntensityTexture");(0,H.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",jb.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",jb.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",jb.rotation),(0,H.h)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Lb(S.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Jb,(()=>3))]),(0,H.h)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",gb,(()=>1))]),(0,H.h)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",gb,(()=>1))]);const Vb=ob("subSurface.thicknessTexture");(0,H.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Vb.scale),(0,H.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Vb.offset),(0,H.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Vb.rotation),(0,H.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Lb(S.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",gb,(()=>1))]);const Db=ob("subSurface.translucencyIntensityTexture");(0,H.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Db.scale),(0,H.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Db.offset),(0,H.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Db.rotation),(0,H.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Lb(S.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Jb,(()=>3))]);const Nb=ob("subSurface.translucencyColorTexture");(0,H.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Nb.scale),(0,H.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Nb.offset),(0,H.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Nb.rotation),(0,H.h)("/extensions/KHR_lights_punctual/lights/{}/color",[new ub(S.d.ANIMATIONTYPE_COLOR3,"diffuse",Jb,(()=>3))]),(0,H.h)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new ub(S.d.ANIMATIONTYPE_FLOAT,"intensity",gb,(()=>1))]),(0,H.h)("/extensions/KHR_lights_punctual/lights/{}/range",[new ub(S.d.ANIMATIONTYPE_FLOAT,"range",gb,(()=>1))]),(0,H.h)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new ub(S.d.ANIMATIONTYPE_FLOAT,"innerAngle",ab,(()=>1))]),(0,H.h)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new ub(S.d.ANIMATIONTYPE_FLOAT,"angle",ab,(()=>1))]),(0,H.h)("/nodes/{}/extensions/EXT_lights_ies/color",[new ub(S.d.ANIMATIONTYPE_COLOR3,"diffuse",Jb,(()=>3))]),(0,H.h)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new ub(S.d.ANIMATIONTYPE_FLOAT,"intensity",gb,(()=>1))]);const Ob="KHR_animation_pointer";class Rb{constructor(p){this.name=Ob,this._loader=p,this._pathToObjectConverter=(0,H.g)(this._loader.fb)}get enabled(){return this._loader.isExtensionUsed(Ob)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(p,b,M,h,Q){var mp;const y=null===(mp=h.target.extensions)||void 0===mp?void 0:mp.KHR_animation_pointer;if(!y||!this._pathToObjectConverter)return null;"pointer"!==h.target.path&&J.d.Warn(`${p}/target/path: Value (${h.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=h.target.node&&J.d.Warn(`${p}/target/node: Value (${h.target.node}) must not be present when using the ${this.name} extension`);const P=`${p}/extensions/${this.name}`,w=y.pointer;if(!w)throw new Error(`${P}: Pointer is missing`);try{const mp=this._pathToObjectConverter.convert(w);if(!mp.info.interpolation)throw new Error(`${P}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(p,b,M,h,{object:mp.object,info:mp.info.interpolation},Q)}catch(t){return J.d.Warn(`${P}/pointer: Invalid pointer (${w}) skipped`),null}}}W(Ob),T(Ob,!0,(p=>new Rb(p)));class Kb{constructor(p,b,M){this.frame=p,this.action=b,this.onlyOnce=M,this.isDone=!1}_clone(){return new Kb(this.frame,this.action,this.onlyOnce)}}var rb=M(12635),kb=M(12682),Ab=M(12680);class nb{get loop(){return this._loop}set loop(p){p!==this._loop&&(this._loop=p,this.updateOptions({loop:p}))}get currentTime(){var p;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(p=kb.b.audioEngine)&&void 0!==p&&p.audioContext&&(this.isPlaying||this.isPaused)){const p=this.isPaused?0:kb.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+p}return 0}get spatialSound(){return this._spatialSound}set spatialSound(p){if(p==this._spatialSound)return;const b=this.isPlaying;this.pause(),p?(this._spatialSound=p,this._updateSpatialParameters()):this._disableSpatialSound(),b&&this.play()}constructor(p,b,M){var h;let mp=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new z.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=Q.QM.Zero(),this._localDirection=new Q.QM(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=p,M=M||c.c.LastCreatedScene)if(this._scene=M,nb._SceneComponentInitialization(M),this._readyToPlayCallback=mp,this._customAttenuationFunction=(p,b,M,h,Q)=>b<M?p*(1-b/M):0,P&&(this.autoplay=P.autoplay||!1,this._loop=P.loop||!1,void 0!==P.volume&&(this._volume=P.volume),this._spatialSound=P.spatialSound??!1,this.maxDistance=P.maxDistance??100,this.useCustomAttenuation=P.useCustomAttenuation??!1,this.rolloffFactor=P.rolloffFactor||1,this.refDistance=P.refDistance||1,this.distanceModel=P.distanceModel||"linear",this._playbackRate=P.playbackRate||1,this._streaming=P.streaming??!1,this._length=P.length,this._offset=P.offset),null!==(h=kb.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&kb.b.audioEngine.audioContext){this._soundGain=kb.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let p=!0;if(b)try{"string"===typeof b?(this._urlType="String",this._url=b):b instanceof ArrayBuffer?this._urlType="ArrayBuffer":b instanceof HTMLMediaElement?this._urlType="MediaElement":b instanceof MediaStream?this._urlType="MediaStream":b instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(b)&&(this._urlType="Array");let M=[],h=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=kb.b.audioEngine.audioContext.createMediaElementSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=kb.b.audioEngine.audioContext.createMediaStreamSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":b.byteLength>0&&(h=!0,this._soundLoaded(b));break;case"AudioBuffer":this._audioBufferLoaded(b);break;case"String":M.push(b);case"Array":0===M.length&&(M=b);for(let p=0;p<M.length;p++){const b=M[p];if(h=P&&P.skipCodecCheck||-1!==b.indexOf(".mp3",b.length-4)&&kb.b.audioEngine.isMP3supported||-1!==b.indexOf(".ogg",b.length-4)&&kb.b.audioEngine.isOGGsupported||-1!==b.indexOf(".wav",b.length-4)||-1!==b.indexOf(".m4a",b.length-4)||-1!==b.indexOf(".mp4",b.length-4)||-1!==b.indexOf("blob:"),h){this._streaming?(this._htmlAudioElement=new Audio(b),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,y.Tools.SetCorsBehavior(b,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(b,(p=>{this._soundLoaded(p)}),void 0,!0,!0,(p=>{p&&J.d.Error("XHR "+p.status+" error on: "+b+"."),J.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:p=!1}p?h||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):J.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(w){J.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),kb.b.audioEngine&&!kb.b.audioEngine.WarnedWebAudioUnsupported&&(J.d.Error("Web Audio is not supported by your browser."),kb.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var p;null!==(p=kb.b.audioEngine)&&void 0!==p&&p.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(p){var b;null!==(b=kb.b.audioEngine)&&void 0!==b&&b.audioContext&&(this._audioBuffer=p,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(p){var b;null!==(b=kb.b.audioEngine)&&void 0!==b&&b.audioContext&&kb.b.audioEngine.audioContext.decodeAudioData(p,(p=>{this._audioBufferLoaded(p)}),(p=>{J.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+p)}))}setAudioBuffer(p){var b;null!==(b=kb.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this._audioBuffer=p,this._isReadyToPlay=!0)}updateOptions(p){p&&(this.loop=p.loop??this.loop,this.maxDistance=p.maxDistance??this.maxDistance,this.useCustomAttenuation=p.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=p.rolloffFactor??this.rolloffFactor,this.refDistance=p.refDistance??this.refDistance,this.distanceModel=p.distanceModel??this.distanceModel,this._playbackRate=p.playbackRate??this._playbackRate,this._length=p.length??void 0,this.spatialSound=p.spatialSound??this._spatialSound,this._setOffset(p.offset??void 0),this.setVolume(p.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var p;null!==(p=kb.b.audioEngine)&&void 0!==p&&p.canUseWebAudio&&kb.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??kb.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var p;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(p=this._soundPanner)||void 0===p||p.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var p;null!==(p=kb.b.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(p){var b;null!==(b=kb.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(p),this._isOutputConnected=!0)}setDirectionalCone(p,b,M){b<p?J.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=p,this._coneOuterAngle=b,this._coneOuterGain=M,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(p){if(p!=this._coneInnerAngle){var b;if(this._coneOuterAngle<p)return void J.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=p,null!==(b=kb.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(p){if(p!=this._coneOuterAngle){var b;if(p<this._coneInnerAngle)return void J.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=p,null!==(b=kb.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(p){var b;p.equals(this._position)||(this._position.mp(p),null!==(b=kb.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(p){var b;this._localDirection=p,null!==(b=kb.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const p=this._connectedTransformNode.getWorldMatrix(),b=Q.QM.TransformNormal(this._localDirection,p);b.normalize(),this._soundPanner.orientationX.value=b.x,this._soundPanner.orientationY.value=b.y,this._soundPanner.orientationZ.value=b.z}updateDistanceFromListener(){var p;if(null!==(p=kb.b.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const p=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.mh(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,p,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(p){this._customAttenuationFunction=p}play(p,b,M){var h;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(h=kb.b.audioEngine)&&void 0!==h&&h.audioContext)try{var Q,mp;this._clearTimeoutsAndObservers();let h=p?(null===(Q=kb.b.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime)+p:null===(mp=kb.b.audioEngine)||void 0===mp?void 0:mp.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=kb.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const p=()=>{var M;if(null!==(M=kb.b.audioEngine)&&void 0!==M&&M.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=b??0;const M=this._htmlAudioElement.play();void 0!==M&&M.catch((()=>{var b,M;(null===(b=kb.b.audioEngine)||void 0===b||b.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(M=kb.b.audioEngine)||void 0===M?void 0:M.onAudioUnlockedObservable.addOnce((()=>{p()})))}))}else{var h;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(h=kb.b.audioEngine)||void 0===h?void 0:h.onAudioUnlockedObservable.addOnce((()=>{p()}))}};p()}}else{var y;const Q=()=>{var Q;if(null!==(Q=kb.b.audioEngine)&&void 0!==Q&&Q.audioContext){var mp;if(M=M||this._length,void 0!==b&&this._setOffset(b),this._soundSource){const p=this._soundSource;p.onended=()=>{p.disconnect()}}if(this._soundSource=null===(mp=kb.b.audioEngine)||void 0===mp?void 0:mp.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==b&&(this._soundSource.loopStart=b),void 0!==M&&(this._soundSource.loopEnd=(0|b)+M),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},h=p?(null===(y=kb.b.audioEngine)||void 0===y?void 0:y.audioContext.currentTime)+p:kb.b.audioEngine.audioContext.currentTime;const Q=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(h,Q,this.loop?void 0:M)}}};"suspended"===(null===(y=kb.b.audioEngine)||void 0===y?void 0:y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var p;"suspended"===(null===(p=kb.b.audioEngine)||void 0===p?void 0:p.audioContext.state)?(kb.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=kb.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{Q()})))):Q()}),500):Q()}this._startTime=h,this.isPlaying=!0,this.isPaused=!1}catch(P){J.d.Error("Error while trying to play audio: "+this.name+", "+P.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(p){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var M;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(M=this._streamingSource)||void 0===M||M.disconnect();this.isPlaying=!1}else if(null!==(b=kb.b.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource){const b=p?kb.b.audioEngine.audioContext.currentTime+p:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(b)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var p;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(p=kb.b.audioEngine)&&void 0!==p&&p.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=kb.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(p,b){var M;null!==(M=kb.b.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._soundGain&&(b&&kb.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(kb.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,kb.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(p,kb.b.audioEngine.audioContext.currentTime+b)):this._soundGain.gain.value=p),this._volume=p}setPlaybackRate(p){this._playbackRate=p,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(p){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=p,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=p=>this._onRegisterAfterWorldMatrixUpdate(p),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(p){var b;if(p.getBoundingInfo){const b=p.getBoundingInfo();this.setPosition(b.boundingSphere.centerWorld)}else this.setPosition(p.absolutePosition);null!==(b=kb.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const p=()=>{(0,Ab.g)((()=>this._isReadyToPlay),(()=>{M._audioBuffer=this.getAudioBuffer(),M._isReadyToPlay=!0,M.autoplay&&M.play(0,this._offset,this._length)}),void 0,300)},b={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},M=new nb(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,b);return this.useCustomAttenuation&&M.setAttenuationFunction(this._customAttenuationFunction),M.setPosition(this._position),M.setPlaybackRate(this._playbackRate),p(),M}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const p={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(p.connectedMeshId=this._connectedTransformNode.id),p.position=this._position.ub(),p.refDistance=this.refDistance,p.distanceModel=this.distanceModel,p.isDirectional=this._isDirectional,p.localDirectionToMesh=this._localDirection.ub(),p.coneInnerAngle=this._coneInnerAngle,p.coneOuterAngle=this._coneOuterAngle,p.coneOuterGain=this._coneOuterGain),p}static Parse(p,b,M,h){const mp=p.name;let y;y=p.url?M+p.url:M+mp;const P={autoplay:p.autoplay,loop:p.loop,volume:p.volume,spatialSound:p.spatialSound,maxDistance:p.maxDistance,rolloffFactor:p.rolloffFactor,refDistance:p.refDistance,distanceModel:p.distanceModel,playbackRate:p.playbackRate};let w;if(h){const p=()=>{(0,Ab.g)((()=>h._isReadyToPlay),(()=>{w._audioBuffer=h.getAudioBuffer(),w._isReadyToPlay=!0,w.autoplay&&w.play(0,w._offset,w._length)}),void 0,300)};w=new nb(mp,new ArrayBuffer(0),b,null,P),p()}else w=new nb(mp,y,b,(()=>{b.removePendingData(w)}),P),b.addPendingData(w);if(p.position){const b=Q.QM.tM(p.position);w.setPosition(b)}if(p.isDirectional&&(w.setDirectionalCone(p.coneInnerAngle||360,p.coneOuterAngle||360,p.coneOuterGain||0),p.localDirectionToMesh)){const b=Q.QM.tM(p.localDirectionToMesh);w.setLocalDirectionToMesh(b)}if(p.connectedMeshId){const M=b.getMeshById(p.connectedMeshId);M&&w.attachToMesh(M)}return p.metadata&&(w.metadata=p.metadata),w}_setOffset(p){this._offset!==p&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=p)}_clearTimeoutsAndObservers(){var p;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(p=kb.b.audioEngine)||void 0===p||p.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}nb._SceneComponentInitialization=p=>{throw(0,rb.b)("AudioSceneComponent")},(0,Lp.c)("BABYLON.Sound",nb);class Cb{constructor(p,b,M){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],b.length!==M.length)throw new Error("Sounds length does not equal weights length");this.loop=p,this._weights=M;let h=0;for(const mp of M)h+=mp;const Q=h>0?1/h:0;for(let mp=0;mp<this._weights.length;mp++)this._weights[mp]*=Q;this._sounds=b;for(const mp of this._sounds)mp.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(p){if(p!==this._coneInnerAngle){if(this._coneOuterAngle<p)return void J.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=p;for(const b of this._sounds)b.directionalConeInnerAngle=p}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(p){if(p!==this._coneOuterAngle){if(p<this._coneInnerAngle)return void J.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=p;for(const b of this._sounds)b.directionalConeOuterAngle=p}}get volume(){return this._volume}set volume(p){if(p!==this._volume)for(const b of this._sounds)b.setVolume(p)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(p){if(!this.isPaused){this.stop();const p=Math.random();let b=0;for(let M=0;M<this._weights.length;M++)if(b+=this._weights[M],p<=b){this._currentIndex=M;break}}const b=this._sounds[this._currentIndex??0];b.isReady()?b.play(0,this.isPaused?void 0:p):b.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Fb{constructor(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(p=p||c.c.LastCreatedScene)&&(this._scene=p,this.soundCollection=[],this._options=b,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var p;null!==(p=kb.b.audioEngine)&&void 0!==p&&p.canUseWebAudio&&kb.b.audioEngine.audioContext&&(this._outputAudioNode=kb.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(kb.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(kb.b.audioEngine&&kb.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(p){var b;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(b=kb.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&p.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==p.soundTrackId&&(-1===p.soundTrackId?this._scene.mainSoundTrack.removeSound(p):this._scene.soundTracks&&this._scene.soundTracks[p.soundTrackId].removeSound(p)),this.soundCollection.push(p),p.soundTrackId=this.id}removeSound(p){const b=this.soundCollection.indexOf(p);-1!==b&&this.soundCollection.splice(b,1)}setVolume(p){var b;null!==(b=kb.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=p)}switchPanningModelToHRTF(){var p;if(null!==(p=kb.b.audioEngine)&&void 0!==p&&p.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var p;if(null!==(p=kb.b.audioEngine)&&void 0!==p&&p.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToEqualPower()}connectToAnalyser(p){var b;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=p,null!==(b=kb.b.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,kb.b.audioEngine.masterGain))}}var pM=M(13043),bM=M(13013),MM=M(12620);kb.b.AudioEngineFactory=(p,b,M)=>new hM(p,b,M);class hM{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new z.d,this.onAudioLockedObservable=new z.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,MM.o)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const h=document.createElement("audio");this._hostElement=p,this._audioContext=b,this._audioDestination=M;try{h&&h.canPlayType&&(h.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||h.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(Q){}try{h&&h.canPlayType&&h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(Q){}}lock(){this._triggerSuspendedState()}unlock(){var p,b;if("running"===(null===(p=this._audioContext)||void 0===p?void 0:p.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(b=this._audioContext)||void 0===b||b.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{J.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var p;null===(p=this._audioContext)||void 0===p||p.addEventListener("statechange",(()=>{var p;this.unlocked&&"running"!==(null===(p=this._audioContext)||void 0===p?void 0:p.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var p;return null!==(p=this._audioContext)&&void 0!==p&&p.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(p){this.canUseWebAudio=!1,J.d.Error("Web Audio: "+p.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(p){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const p=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",b=document.createElement("style");b.appendChild(document.createTextNode(p)),document.getElementsByTagName("head")[0].appendChild(b),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var p;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(p=this._audioContext)||void 0===p||p.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(p){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=p)}connectToAnalyser(p){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=p,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var QM=M(12630);(0,M(13996).e)(pM.c.NAME_AUDIO,((p,b,M,h)=>{let Q,mp=[];if(M.ac=M.ac||[],void 0!==p.ac&&null!==p.ac)for(let P=0,w=p.ac.length;P<w;P++){var y;const w=p.ac[P];null!==(y=kb.b.audioEngine)&&void 0!==y&&y.canUseWebAudio?(w.url||(w.url=w.name),mp[w.url]?M.ac.push(nb.Parse(w,b,h,mp[w.url])):(Q=nb.Parse(w,b,h),mp[w.url]=Q,M.ac.push(Q))):M.ac.push(new nb(w.name,null,b))}mp=[]})),Object.defineProperty(bM.b.prototype,"mainSoundTrack",{get:function(){let p=this._getComponent(pM.c.NAME_AUDIO);return p||(p=new mh(this),this.o(p)),this._mainSoundTrack||(this._mainSoundTrack=new Fb(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),bM.b.prototype.getSoundByName=function(p){let b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)if(this.mainSoundTrack.soundCollection[b].name===p)return this.mainSoundTrack.soundCollection[b];if(this.soundTracks)for(let M=0;M<this.soundTracks.length;M++)for(b=0;b<this.soundTracks[M].soundCollection.length;b++)if(this.soundTracks[M].soundCollection[b].name===p)return this.soundTracks[M].soundCollection[b];return null},Object.defineProperty(bM.b.prototype,"audioEnabled",{get:function(){let p=this._getComponent(pM.c.NAME_AUDIO);return p||(p=new mh(this),this.o(p)),p.audioEnabled},set:function(p){let b=this._getComponent(pM.c.NAME_AUDIO);b||(b=new mh(this),this.o(b)),p?b.enableAudio():b.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(bM.b.prototype,"headphone",{get:function(){let p=this._getComponent(pM.c.NAME_AUDIO);return p||(p=new mh(this),this.o(p)),p.headphone},set:function(p){let b=this._getComponent(pM.c.NAME_AUDIO);b||(b=new mh(this),this.o(b)),p?b.switchAudioModeForHeadphones():b.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(bM.b.prototype,"audioListenerPositionProvider",{get:function(){let p=this._getComponent(pM.c.NAME_AUDIO);return p||(p=new mh(this),this.o(p)),p.audioListenerPositionProvider},set:function(p){let b=this._getComponent(pM.c.NAME_AUDIO);if(b||(b=new mh(this),this.o(b)),p&&"function"!==typeof p)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");b.audioListenerPositionProvider=p},enumerable:!0,configurable:!0}),Object.defineProperty(bM.b.prototype,"audioListenerRotationProvider",{get:function(){let p=this._getComponent(pM.c.NAME_AUDIO);return p||(p=new mh(this),this.o(p)),p.audioListenerRotationProvider},set:function(p){let b=this._getComponent(pM.c.NAME_AUDIO);if(b||(b=new mh(this),this.o(b)),p&&"function"!==typeof p)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");b.audioListenerRotationProvider=p},enumerable:!0,configurable:!0}),Object.defineProperty(bM.b.prototype,"audioPositioningRefreshRate",{get:function(){let p=this._getComponent(pM.c.NAME_AUDIO);return p||(p=new mh(this),this.o(p)),p.audioPositioningRefreshRate},set:function(p){let b=this._getComponent(pM.c.NAME_AUDIO);b||(b=new mh(this),this.o(b)),b.audioPositioningRefreshRate=p},enumerable:!0,configurable:!0});class mh{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(p){this.name=pM.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new Q.QM,this._cachedCameraPosition=new Q.QM,this._lastCheck=0,this._invertMatrixTemp=new Q.Matrix,this._cameraDirectionTemp=new Q.QM,(p=p||c.c.LastCreatedScene)&&(this.yM=p,p.soundTracks=[],p.ac=[])}register(){this.yM._afterRenderStage.registerStep(pM.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(p){if(p.ac=[],this.yM.soundTracks)for(let b=0;b<this.yM.soundTracks.length;b++){const M=this.yM.soundTracks[b];for(let b=0;b<M.soundCollection.length;b++)p.ac.push(M.soundCollection[b].serialize())}}addFromContainer(p){if(p.ac)for(const b of p.ac)b.play(),b.autoplay=!0,this.yM.mainSoundTrack.addSound(b)}removeFromContainer(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(p.ac)for(const M of p.ac)M.stop(),M.autoplay=!1,this.yM.mainSoundTrack.removeSound(M),b&&M.dispose()}dispose(){const p=this.yM;if(p._mainSoundTrack&&p.mainSoundTrack.dispose(),p.soundTracks)for(let b=0;b<p.soundTracks.length;b++)p.soundTracks[b].dispose()}disableAudio(){const p=this.yM;let b;for(this._audioEnabled=!1,kb.b.audioEngine&&kb.b.audioEngine.audioContext&&kb.b.audioEngine.audioContext.suspend(),b=0;b<p.mainSoundTrack.soundCollection.length;b++)p.mainSoundTrack.soundCollection[b].pause();if(p.soundTracks)for(b=0;b<p.soundTracks.length;b++)for(let M=0;M<p.soundTracks[b].soundCollection.length;M++)p.soundTracks[b].soundCollection[M].pause()}enableAudio(){const p=this.yM;let b;for(this._audioEnabled=!0,kb.b.audioEngine&&kb.b.audioEngine.audioContext&&kb.b.audioEngine.audioContext.resume(),b=0;b<p.mainSoundTrack.soundCollection.length;b++)p.mainSoundTrack.soundCollection[b].isPaused&&p.mainSoundTrack.soundCollection[b].play();if(p.soundTracks)for(b=0;b<p.soundTracks.length;b++)for(let M=0;M<p.soundTracks[b].soundCollection.length;M++)p.soundTracks[b].soundCollection[M].isPaused&&p.soundTracks[b].soundCollection[M].play()}switchAudioModeForHeadphones(){const p=this.yM;if(this._headphone=!0,p.mainSoundTrack.switchPanningModelToHRTF(),p.soundTracks)for(let b=0;b<p.soundTracks.length;b++)p.soundTracks[b].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const p=this.yM;if(this._headphone=!1,p.mainSoundTrack.switchPanningModelToEqualPower(),p.soundTracks)for(let b=0;b<p.soundTracks.length;b++)p.soundTracks[b].switchPanningModelToEqualPower()}_afterRender(){const p=QM.d.Now;if(this._lastCheck&&p-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=p;const b=this.yM;if(!this._audioEnabled||!b._mainSoundTrack||!b.soundTracks||0===b._mainSoundTrack.soundCollection.length&&1===b.soundTracks.length)return;const M=kb.b.audioEngine;if(M&&M.audioContext){let p,h=b.activeCamera;if(b.activeCameras&&b.activeCameras.length>0&&(h=b.activeCameras[0]),this.audioListenerPositionProvider){const p=this.audioListenerPositionProvider();M.audioContext.listener.setPosition(p.x||0,p.y||0,p.z||0)}else h?this._cachedCameraPosition.equals(h.globalPosition)||(this._cachedCameraPosition.mp(h.globalPosition),M.audioContext.listener.setPosition(h.globalPosition.x,h.globalPosition.y,h.globalPosition.z)):M.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const p=this.audioListenerRotationProvider();M.audioContext.listener.setOrientation(p.x||0,p.y||0,p.z||0,0,1,0)}else h?(h.rigCameras&&h.rigCameras.length>0&&(h=h.rigCameras[0]),h.getViewMatrix().invertToRef(this._invertMatrixTemp),Q.QM.TransformNormalToRef(mh._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.mp(this._cameraDirectionTemp),M.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):M.audioContext.listener.setOrientation(0,0,0,0,1,0);for(p=0;p<b.mainSoundTrack.soundCollection.length;p++){const M=b.mainSoundTrack.soundCollection[p];M.useCustomAttenuation&&M.updateDistanceFromListener()}if(b.soundTracks)for(p=0;p<b.soundTracks.length;p++)for(let M=0;M<b.soundTracks[p].soundCollection.length;M++){const h=b.soundTracks[p].soundCollection[M];h.useCustomAttenuation&&h.updateDistanceFromListener()}}}}mh._CameraDirection=new Q.QM(0,0,-1),nb._SceneComponentInitialization=p=>{let b=p._getComponent(pM.c.NAME_AUDIO);b||(b=new mh(p),p.o(b))};const yM="MSFT_audio_emitter";class PM{constructor(p){this.name=yM,this._loader=p,this.enabled=this._loader.isExtensionUsed(yM)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const p=this._loader.fb.extensions;if(p&&p[this.name]){const b=p[this.name];this._clips=b.clips,this._emitters=b.emitters,V.Assign(this._clips),V.Assign(this._emitters)}}loadSceneAsync(p,b){return N.LoadExtensionAsync(p,b,this.name,(async(M,h)=>{const Q=new Array;Q.push(this._loader.loadSceneAsync(p,b));for(const p of h.emitters){const b=V.Get(`${M}/emitters`,this._emitters,p);if(void 0!=b.refDistance||void 0!=b.maxDistance||void 0!=b.rolloffFactor||void 0!=b.distanceModel||void 0!=b.innerAngle||void 0!=b.outerAngle)throw new Error(`${M}: Direction or Distance properties are not allowed on emitters attached to a scene`);Q.push(this._loadEmitterAsync(`${M}/emitters/${b.index}`,b))}await Promise.all(Q)}))}loadNodeAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(p,h)=>{const mp=new Array,P=await this._loader.loadNodeAsync(p,b,(b=>{for(const M of h.emitters){const h=V.Get(`${p}/emitters`,this._emitters,M);mp.push(this._loadEmitterAsync(`${p}/emitters/${h.index}`,h).then((()=>{for(const p of h._babylonSounds)p.attachToMesh(b),void 0==h.innerAngle&&void 0==h.outerAngle||(p.setLocalDirectionToMesh(Q.QM.Forward()),p.setDirectionalCone(2*y.Tools.ToDegrees(void 0==h.innerAngle?Math.PI:h.innerAngle),2*y.Tools.ToDegrees(void 0==h.outerAngle?Math.PI:h.outerAngle),0))})))}M(b)}));return await Promise.all(mp),P}))}loadAnimationAsync(p,b){return N.LoadExtensionAsync(p,b,this.name,(async(M,h)=>{const Q=await this._loader.loadAnimationAsync(p,b),mp=new Array;V.Assign(h.events);for(const y of h.events)mp.push(this._loadAnimationEventAsync(`${M}/events/${y.index}`,p,b,y,Q));return await Promise.all(mp),Q}))}_loadClipAsync(p,b){if(b._objectURL)return b._objectURL;let M;if(b.uri)M=this._loader.loadUriAsync(p,b,b.uri);else{const h=V.Get(`${p}/bufferView`,this._loader.fb.bufferViews,b.bufferView);M=this._loader.loadBufferViewAsync(`/bufferViews/${h.index}`,h)}return b._objectURL=M.then((p=>URL.createObjectURL(new Blob([p],{type:b.mimeType})))),b._objectURL}_loadEmitterAsync(p,b){if(b._babylonSounds=b._babylonSounds||[],!b._babylonData){const p=new Array,M=b.name||`emitter${b.index}`,h={loop:!1,autoplay:!1,volume:void 0==b.volume?1:b.volume};for(let mp=0;mp<b.clips.length;mp++){const Q=`/extensions/${this.name}/clips`,y=V.Get(Q,this._clips,b.clips[mp].clip);p.push(this._loadClipAsync(`${Q}/${b.clips[mp].clip}`,y).then((p=>{const Q=b._babylonSounds[mp]=new nb(M,p,this._loader.babylonScene,null,h);Q.refDistance=b.refDistance||1,Q.maxDistance=b.maxDistance||256,Q.rolloffFactor=b.rolloffFactor||1,Q.distanceModel=b.distanceModel||"exponential"})))}const Q=Promise.all(p).then((()=>{const p=b.clips.map((p=>p.weight||1)),M=new Cb(b.loop||!1,b._babylonSounds,p);b.innerAngle&&(M.directionalConeInnerAngle=2*y.Tools.ToDegrees(b.innerAngle)),b.outerAngle&&(M.directionalConeOuterAngle=2*y.Tools.ToDegrees(b.outerAngle)),b.volume&&(M.volume=b.volume),b._babylonData.sound=M}));b._babylonData={loaded:Q}}return b._babylonData.loaded}_getEventAction(p,b,M,h,Q){switch(M){case"play":return p=>{const M=(Q||0)+(p-h);b.play(M)};case"stop":return()=>{b.stop()};case"pause":return()=>{b.pause()};default:throw new Error(`${p}: Unsupported action ${M}`)}}_loadAnimationEventAsync(p,b,M,h,Q){if(0==Q.targetedAnimations.length)return Promise.resolve();const mp=Q.targetedAnimations[0],y=h.hb,P=V.Get(`/extensions/${this.name}/emitters`,this._emitters,y);return this._loadEmitterAsync(p,P).then((()=>{const b=P._babylonData.sound;if(b){const M=new Kb(h.time,this._getEventAction(p,b,h.action,h.time,h.startOffset));mp.animation.addEvent(M),Q.onAnimationGroupEndObservable.add((()=>{b.stop()})),Q.onAnimationGroupPauseObservable.add((()=>{b.pause()}))}}))}}W(yM),T(yM,!0,(p=>new PM(p)));const wM="MSFT_lod";class tM{constructor(p){var b;this.name=wM,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new z.d,this.onMaterialLODsLoadedObservable=new z.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=p,this.maxLODsToLoad=(null===(b=this._loader.parent.extensionOptions[wM])||void 0===b?void 0:b.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(wM)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let p=0;p<this._nodePromiseLODs.length;p++){const b=Promise.all(this._nodePromiseLODs[p]).then((()=>{0!==p&&(this._loader.endPerformanceCounter(`Node LOD ${p}`),this._loader.log(`Loaded node LOD ${p}`)),this.onNodeLODsLoadedObservable.notifyObservers(p),p!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${p+1}`),this._loadBufferLOD(this._nodeBufferLODs,p+1),this._nodeSignalLODs[p]&&this._nodeSignalLODs[p].resolve())}));this._loader._completePromises.push(b)}for(let p=0;p<this._materialPromiseLODs.length;p++){const b=Promise.all(this._materialPromiseLODs[p]).then((()=>{0!==p&&(this._loader.endPerformanceCounter(`Material LOD ${p}`),this._loader.log(`Loaded material LOD ${p}`)),this.onMaterialLODsLoadedObservable.notifyObservers(p),p!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${p+1}`),this._loadBufferLOD(this._materialBufferLODs,p+1),this._materialSignalLODs[p]&&this._materialSignalLODs[p].resolve())}));this._loader._completePromises.push(b)}}loadSceneAsync(p,b){const M=this._loader.loadSceneAsync(p,b);return this._loadBufferLOD(this._bufferLODs,0),M}loadNodeAsync(p,b,M){return N.LoadExtensionAsync(p,b,this.name,(async(p,Q)=>{let mp;const y=this._getLODs(p,b,this._loader.fb.nodes,Q.ids);this._loader.logOpen(`${p}`);for(let b=0;b<y.length;b++){const p=y[b];0!==b&&(this._nodeIndexLOD=b,this._nodeSignalLODs[b]=this._nodeSignalLODs[b]||new h);const Q=p=>{M(p),p.Qt(!1)},P=this._loader.loadNodeAsync(`/nodes/${p.index}`,p,Q).then((p=>{if(0!==b){const p=y[b-1];p._babylonTransformNode&&(this._disposeTransformNode(p._babylonTransformNode),delete p._babylonTransformNode)}return p.Qt(!0),p}));this._nodePromiseLODs[b]=this._nodePromiseLODs[b]||[],0===b?mp=P:(this._nodeIndexLOD=null,this._nodePromiseLODs[b].push(P))}return this._loader.logClose(),await mp}))}_loadMaterialAsync(p,b,M,h,Q){return this._nodeIndexLOD?null:N.LoadExtensionAsync(p,b,this.name,(async(p,mp)=>{let y;const P=this._getLODs(p,b,this._loader.fb.materials,mp.ids);this._loader.logOpen(`${p}`);for(let b=0;b<P.length;b++){const p=P[b];0!==b&&(this._materialIndexLOD=b);const mp=this._loader._loadMaterialAsync(`/materials/${p.index}`,p,M,h,(p=>{0===b&&Q(p)})).then((p=>{if(0!==b){Q(p);const M=P[b-1]._data;M[h]&&(this._disposeMaterials([M[h].babylonMaterial]),delete M[h])}return p}));this._materialPromiseLODs[b]=this._materialPromiseLODs[b]||[],0===b?y=mp:(this._materialIndexLOD=null,this._materialPromiseLODs[b].push(mp))}return this._loader.logClose(),await y}))}_loadUriAsync(p,b,M){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const Q=this._nodeIndexLOD-1;return this._nodeSignalLODs[Q]=this._nodeSignalLODs[Q]||new h,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(p,b,M)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const Q=this._materialIndexLOD-1;return this._materialSignalLODs[Q]=this._materialSignalLODs[Q]||new h,this._materialSignalLODs[Q].promise.then((async()=>await this._loader.loadUriAsync(p,b,M)))}return null}loadBufferAsync(p,b,M,Q){if(this._loader.parent.useRangeRequests&&!b.uri){if(!this._loader.bin)throw new Error(`${p}: Uri is missing or the binary glTF is missing its binary chunk`);const b=async(p,b)=>{const mp=M,y=mp+Q-1;let P=p[b];return P?(P.start=Math.min(P.start,mp),P.end=Math.max(P.end,y)):(P={start:mp,end:y,loaded:new h},p[b]=P),await P.loaded.promise.then((p=>new Uint8Array(p.buffer,p.byteOffset+M-P.start,Q)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?b(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?b(this._materialBufferLODs,this._materialIndexLOD):b(this._bufferLODs,0)}return null}_loadBufferLOD(p,b){const M=p[b];M&&(this._loader.log(`Loading buffer range [${M.start}-${M.end}]`),this._loader.bin.readAsync(M.start,M.end-M.start+1).then((p=>{M.loaded.resolve(p)}),(p=>{M.loaded.reject(p)})))}_getLODs(p,b,M,h){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const Q=[];for(let mp=h.length-1;mp>=0;mp--)if(Q.push(V.Get(`${p}/ids/${h[mp]}`,M,h[mp])),Q.length===this.maxLODsToLoad)return Q;return Q.push(b),Q}_disposeTransformNode(p){const b=[],M=p.material;M&&b.push(M);for(const Q of p.getChildMeshes())Q.material&&b.push(Q.material);p.dispose();const h=b.filter((p=>this._loader.babylonScene.meshes.every((b=>b.material!=p))));this._disposeMaterials(h)}_disposeMaterials(p){const b={};for(const M of p){for(const p of M.getActiveTextures())b[p.uniqueId]=p;M.dispose()}for(const M in b)for(const p of this._loader.babylonScene.materials)p.hasTexture(b[M])&&delete b[M];for(const M in b)b[M].dispose()}}W(wM),T(wM,!0,(p=>new tM(p)));const zM="MSFT_minecraftMesh";class xM{constructor(p){this.name=zM,this._loader=p,this.enabled=this._loader.isExtensionUsed(zM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtraAsync(p,b,this.name,(async(h,Q)=>{if(Q){if(!(M instanceof a.c))throw new Error(`${h}: Material type not supported`);const Q=this._loader.loadMaterialPropertiesAsync(p,b,M);return M.needAlphaBlending()&&(M.forceDepthWrite=!0,M.separateCullingPass=!0),M.Bb=M.forceDepthWrite,M.twoSidedLighting=!0,await Q}}))}}W(zM),T(zM,!0,(p=>new xM(p)));const SM="MSFT_sRGBFactors";class XM{constructor(p){this.name=SM,this._loader=p,this.enabled=this._loader.isExtensionUsed(SM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(p,b,M){return N.LoadExtraAsync(p,b,this.name,(async(h,Q)=>{if(Q){if(!(M instanceof a.c))throw new Error(`${h}: Material type not supported`);const Q=this._loader.loadMaterialPropertiesAsync(p,b,M),mp=M.upp().getEngine().useExactSrgbConversions;return M.albedoTexture||M.albedoColor.toLinearSpaceToRef(M.albedoColor,mp),M.reflectivityTexture||M.reflectivityColor.toLinearSpaceToRef(M.reflectivityColor,mp),await Q}}))}}W(SM),T(SM,!0,(p=>new XM(p)));var cM=M(14298);const JM={};var gM=M(14353),fM=M(14337),YM=M(14306),aM=M(14316);function oM(p,b){for(const M of p)for(const p of M.dataOutputs)if(p.uniqueId===b)return p;throw new Error("Could not find data out connection with unique id "+b)}function lM(p,b){for(const M of p)if(M instanceof fM.e)for(const p of M.signalInputs)if(p.uniqueId===b)return p;throw new Error("Could not find signal in connection with unique id "+b)}async function LM(p,b){const h=await Promise.all(p.allBlocks.map((async p=>{const b=function(p){switch(p){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([M.e(78),M.e(79)]).then(M.bind(M,15951))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await M.e(80).then(M.bind(M,15960))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await M.e(81).then(M.bind(M,15965))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await M.e(82).then(M.bind(M,15970))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await M.e(83).then(M.bind(M,15972))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await M.e(84).then(M.bind(M,15978))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await M.e(85).then(M.bind(M,15982))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await M.e(86).then(M.bind(M,15985))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await M.e(87).then(M.bind(M,15990))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await M.e(90).then(M.bind(M,16031))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await M.e(90).then(M.bind(M,16031))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await M.e(90).then(M.bind(M,16031))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await M.e(90).then(M.bind(M,16031))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await M.e(95).then(M.bind(M,16033))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await M.e(96).then(M.bind(M,16040))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await M.e(97).then(M.bind(M,16049))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await M.e(98).then(M.bind(M,16052))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await M.e(99).then(M.bind(M,16055))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await M.e(100).then(M.bind(M,16064))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await M.e(101).then(M.bind(M,16072))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await M.e(102).then(M.bind(M,16076))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await M.e(103).then(M.bind(M,16082))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await M.e(104).then(M.bind(M,16086))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await M.e(105).then(M.bind(M,16093))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await M.e(106).then(M.bind(M,16096))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await M.e(107).then(M.bind(M,16101))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await M.e(108).then(M.bind(M,16110))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await M.e(109).then(M.bind(M,16114))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await M.e(110).then(M.bind(M,16122))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await M.e(111).then(M.bind(M,16129))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await M.e(112).then(M.bind(M,16135))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await M.e(113).then(M.bind(M,16141))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await M.e(92).then(M.bind(M,16148))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await M.e(114).then(M.bind(M,16151))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await M.e(115).then(M.bind(M,16155))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await M.e(116).then(M.bind(M,16158))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await M.e(93).then(M.bind(M,16162))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await M.e(88).then(M.bind(M,15992))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await M.e(94).then(M.bind(M,16170))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await M.e(94).then(M.bind(M,16170))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await M.e(94).then(M.bind(M,16170))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await M.e(94).then(M.bind(M,16170))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await M.e(94).then(M.bind(M,16170))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await M.e(94).then(M.bind(M,16170))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await M.e(94).then(M.bind(M,16170))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await M.e(94).then(M.bind(M,16170))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await M.e(89).then(M.bind(M,16024))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await M.e(90).then(M.bind(M,16031))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await M.e(90).then(M.bind(M,16031))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await M.e(91).then(M.bind(M,16177))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await M.e(91).then(M.bind(M,16177))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await M.e(91).then(M.bind(M,16177))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await M.e(91).then(M.bind(M,16177))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await M.e(91).then(M.bind(M,16177))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await M.e(91).then(M.bind(M,16177))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await M.e(117).then(M.bind(M,16181))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await M.e(118).then(M.bind(M,16185))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await M.e(119).then(M.bind(M,16191))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await M.e(120).then(M.bind(M,16193))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await M.e(121).then(M.bind(M,16201))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await M.e(122).then(M.bind(M,16204))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await M.e(123).then(M.bind(M,16213))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await M.e(124).then(M.bind(M,16216))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await M.e(125).then(M.bind(M,16219))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await M.e(126).then(M.bind(M,16228))).FlowGraphDataSwitchBlock;default:if(JM[p])return JM[p];throw new Error(`Unknown block name ${p}`)}}(p.className);return await b()})));return function(p,b,M){const h=b.coordinator.createGraph(),Q=[],mp=b.valueParseFunction??YM.c;for(let y=0;y<p.allBlocks.length;y++){const P=eM(p.allBlocks[y],{yM:b.coordinator.config.yM,pathConverter:b.pathConverter,assetsContainer:b.coordinator.config.yM,valueParseFunction:mp},M[y]);Q.push(P),P instanceof gM.e&&h.addEventBlock(P)}for(const y of Q){for(const p of y.dataInputs)for(const b of p.connectedPointIds){const M=oM(Q,b);p.connectTo(M)}if(y instanceof fM.e)for(const p of y.signalOutputs)for(const b of p.connectedPointIds){const M=lM(Q,b);p.connectTo(M)}}for(const y of p.executionContexts)uM(y,{graph:h,valueParseFunction:mp},p.rightHanded);return h}(p,b,h)}function uM(p,b,M){const h=b.graph.createContext();p.enableLogging&&(h.enableLogging=!0),h.treatDataAsRightHanded=M||!1;const Q=b.valueParseFunction??YM.c;h.uniqueId=p.uniqueId;const mp=h.upp();if(p._assetsContext){var y,P,w,t,z,x,S,X,c,J;const b=p._assetsContext,M={meshes:null===(y=b.meshes)||void 0===y?void 0:y.map((p=>mp.getMeshById(p))),lights:null===(P=b.lights)||void 0===P?void 0:P.map((p=>mp.getLightByName(p))),cameras:null===(w=b.cameras)||void 0===w?void 0:w.map((p=>mp.getCameraByName(p))),materials:null===(t=b.materials)||void 0===t?void 0:t.map((p=>mp.getMaterialById(p))),textures:null===(z=b.textures)||void 0===z?void 0:z.map((p=>mp.getTextureByName(p))),animations:null===(x=b.animations)||void 0===x?void 0:x.map((p=>mp.animations.find((b=>b.name===p)))),skeletons:null===(S=b.skeletons)||void 0===S?void 0:S.map((p=>mp.getSkeletonByName(p))),LX:null===(X=b.LX)||void 0===X?void 0:X.map((p=>mp.getParticleSystemById(p))),animationGroups:null===(c=b.animationGroups)||void 0===c?void 0:c.map((p=>mp.getAnimationGroupByName(p))),transformNodes:null===(J=b.transformNodes)||void 0===J?void 0:J.map((p=>mp.getTransformNodeById(p))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],ac:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};h.assetsContext=M}for(const g in p._userVariables){const b=Q(g,p._userVariables,h.assetsContext,mp);h.userVariables[g]=b}for(const g in p._connectionValues){const b=Q(g,p._connectionValues,h.assetsContext,mp);h._setConnectionValueByKey(g,b)}return h}function eM(p,b,M){const h={},Q=b.valueParseFunction??YM.c;if(p.config)for(const y in p.config)h[y]=Q(y,p.config,b.assetsContainer||b.yM,b.yM);if((0,YM.f)(p.className)){if(!b.pathConverter)throw new Error("Path converter is required for this block");h.pathConverter=b.pathConverter}const mp=new M(h);mp.uniqueId=p.uniqueId;for(let y=0;y<p.dataInputs.length;y++){const b=mp.getDataInput(p.dataInputs[y].name);if(!b)throw new Error("Could not find data input with name "+p.dataInputs[y].name+" in block "+p.className);b.deserialize(p.dataInputs[y])}for(let y=0;y<p.dataOutputs.length;y++){const b=mp.getDataOutput(p.dataOutputs[y].name);if(!b)throw new Error("Could not find data output with name "+p.dataOutputs[y].name+" in block "+p.className);b.deserialize(p.dataOutputs[y])}return mp.metadata=p.metadata,mp.deserialize&&mp.deserialize(p),mp}function dM(p){const[b,M]=p.split(":");return IM({op:b,extension:M})}function IM(p){var b;let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=p.extension?null===(b=vM[p.extension])||void 0===b?void 0:b[p.op]:ZM[p.op];if(!h&&(J.d.Warn(`No mapping found for operation ${p.op} and extension ${p.extension||"KHR_interactivity"}`),M)){const b={},M={flows:{}};if(p.inputValueSockets){b.values={};for(const M in p.inputValueSockets)b.values[M]={name:M}}return p.outputValueSockets&&(M.values={},Object.keys(p.outputValueSockets).forEach((p=>{M.values[p]={name:p}}))),{ix:[],inputs:b,outputs:M}}return h}function GM(p,b,M){vM[b]||(vM[b]={}),vM[b][p]=M}const vM={BABYLON:{"flow/log":{ix:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},ZM={"event/onStart":{ix:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{ix:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{ix:["FlowGraphSendCustomEventBlock"],extraProcessor(p,b,M,h,Q){if("event/send"!==b.op||!p.configuration||1!==Object.keys(p.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const mp=p.configuration.event.value[0];if("number"!==typeof mp)throw new Error("Event id should be a number");const y=h.arrays.events[mp],P=Q[0];return P.config||(P.config={}),P.config.eventId=y.eventId,P.config.eventData=y.eventData,Q}},"event/receive":{ix:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(p,b){var M;if(!p.configuration)return J.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const h=p.configuration.event;if(!h)return J.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const Q=h.value[0];if("number"!==typeof Q)return J.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(M=b.events)||void 0===M?void 0:M[Q])?{valid:!0}:(J.d.Error(`Event with id ${Q} not found`),{valid:!1,error:`Event with id ${Q} not found`})},extraProcessor(p,b,M,h,Q){if("event/receive"!==b.op||!p.configuration||1!==Object.keys(p.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const mp=p.configuration.event.value[0];if("number"!==typeof mp)throw new Error("Event id should be a number");const y=h.arrays.events[mp],P=Q[0];return P.config||(P.config={}),P.config.eventId=y.eventId,P.config.eventData=y.eventData,Q}},"math/e":UM("FlowGraphEBlock"),"math/pi":UM("FlowGraphPIBlock"),"math/inf":UM("FlowGraphInfBlock"),"math/nan":UM("FlowGraphNaNBlock"),"math/abs":UM("FlowGraphAbsBlock"),"math/sign":UM("FlowGraphSignBlock"),"math/trunc":UM("FlowGraphTruncBlock"),"math/floor":UM("FlowGraphFloorBlock"),"math/ceil":UM("FlowGraphCeilBlock"),"math/round":{ix:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(p,b,M,h,Q){var mp;return(mp=Q[0]).config||(mp.config={}),Q[0].config.roundHalfAwayFromZero=!0,Q}},"math/fract":UM("FlowGraphFractBlock"),"math/neg":UM("FlowGraphNegationBlock"),"math/add":UM("FlowGraphAddBlock",["a","b"],!0),"math/sub":UM("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{ix:["FlowGraphMultiplyBlock"],extraProcessor(p,b,M,h,Q){var mp;(mp=Q[0]).config||(mp.config={}),Q[0].config.useMatrixPerComponent=!0,Q[0].config.preventIntegerFloatArithmetic=!0;let y=-1;return Object.keys(p.values||{}).find((b=>{var M;return void 0!==(null===(M=p.values)||void 0===M?void 0:M[b].type)&&(y=p.values[b].type,!0)})),-1!==y&&(Q[0].config.type=h.arrays.types[y].flowGraphType),Q},validation:p=>p.values?qM(p):{valid:!0}},"math/div":UM("FlowGraphDivideBlock",["a","b"],!0),"math/rem":UM("FlowGraphModuloBlock",["a","b"]),"math/min":UM("FlowGraphMinBlock",["a","b"]),"math/max":UM("FlowGraphMaxBlock",["a","b"]),"math/clamp":UM("FlowGraphClampBlock",["a","b","c"]),"math/saturate":UM("FlowGraphSaturateBlock"),"math/mix":UM("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":UM("FlowGraphEqualityBlock",["a","b"]),"math/lt":UM("FlowGraphLessThanBlock",["a","b"]),"math/le":UM("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":UM("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":UM("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":UM("FlowGraphIsNaNBlock"),"math/isinf":UM("FlowGraphIsInfBlock"),"math/select":{ix:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{ix:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":UM("FlowGraphSinBlock"),"math/cos":UM("FlowGraphCosBlock"),"math/tan":UM("FlowGraphTanBlock"),"math/asin":UM("FlowGraphASinBlock"),"math/acos":UM("FlowGraphACosBlock"),"math/atan":UM("FlowGraphATanBlock"),"math/atan2":UM("FlowGraphATan2Block",["a","b"]),"math/sinh":UM("FlowGraphSinhBlock"),"math/cosh":UM("FlowGraphCoshBlock"),"math/tanh":UM("FlowGraphTanhBlock"),"math/asinh":UM("FlowGraphASinhBlock"),"math/acosh":UM("FlowGraphACoshBlock"),"math/atanh":UM("FlowGraphATanhBlock"),"math/exp":UM("FlowGraphExponentialBlock"),"math/log":UM("FlowGraphLogBlock"),"math/log2":UM("FlowGraphLog2Block"),"math/log10":UM("FlowGraphLog10Block"),"math/sqrt":UM("FlowGraphSquareRootBlock"),"math/cbrt":UM("FlowGraphCubeRootBlock"),"math/pow":UM("FlowGraphPowerBlock",["a","b"]),"math/length":UM("FlowGraphLengthBlock"),"math/normalize":UM("FlowGraphNormalizeBlock"),"math/dot":UM("FlowGraphDotBlock",["a","b"]),"math/cross":UM("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":UM("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":UM("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{ix:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{ix:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{ix:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{ix:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{ix:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{ix:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{ix:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":UM("FlowGraphTransposeBlock"),"math/determinant":UM("FlowGraphDeterminantBlock"),"math/inverse":UM("FlowGraphInvertMatrixBlock"),"math/matmul":UM("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{ix:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ib",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(p,b,M,h,Q,mp){const y=Q[0].dataInputs.find((p=>"rotationQuaternion"===p.name));if(!y)throw new Error("Rotation quaternion input not found");return mp._connectionValues[y.uniqueId]&&(mp._connectionValues[y.uniqueId].type="Quaternion"),Q}},"math/matDecompose":{ix:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ib"}}}},"math/quatConjugate":UM("FlowGraphConjugateBlock",["a"]),"math/quatMul":{ix:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(p,b,M,h,Q){var mp;return(mp=Q[0]).config||(mp.config={}),Q[0].config.type="Quaternion",Q}},"math/quatAngleBetween":UM("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{ix:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":UM("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":UM("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{ix:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(p,b,M,h,Q){var mp;return(mp=Q[0]).config||(mp.config={}),Q[0].config.inputIsColumnMajor=!0,Q}},"math/extract2x2":{ix:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{ix:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(p,b,M,h,Q){var mp;return(mp=Q[0]).config||(mp.config={}),Q[0].config.inputIsColumnMajor=!0,Q}},"math/extract3x3":{ix:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{ix:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(p,b,M,h,Q){var mp;return(mp=Q[0]).config||(mp.config={}),Q[0].config.inputIsColumnMajor=!0,Q}},"math/extract4x4":{ix:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{ix:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(p,b,M,h,Q,mp){var y,P;(P=Q[0]).config||(P.config={});const w=Q[0].dataInputs[0];return Q[0].config.valueType=(null===(y=mp._connectionValues[w.uniqueId])||void 0===y?void 0:y.type)??"FlowGraphInteger",Q}},"math/and":{ix:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(p,b,M,h,Q,mp){var y,P,w;(w=Q[0]).config||(w.config={});const t=Q[0].dataInputs[0],z=Q[0].dataInputs[1];return Q[0].config.valueType=(null===(y=mp._connectionValues[t.uniqueId])||void 0===y?void 0:y.type)??(null===(P=mp._connectionValues[z.uniqueId])||void 0===P?void 0:P.type)??"FlowGraphInteger",Q}},"math/or":{ix:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(p,b,M,h,Q,mp){var y,P,w;(w=Q[0]).config||(w.config={});const t=Q[0].dataInputs[0],z=Q[0].dataInputs[1];return Q[0].config.valueType=(null===(y=mp._connectionValues[t.uniqueId])||void 0===y?void 0:y.type)??(null===(P=mp._connectionValues[z.uniqueId])||void 0===P?void 0:P.type)??"FlowGraphInteger",Q}},"math/xor":{ix:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(p,b,M,h,Q,mp){var y,P,w;(w=Q[0]).config||(w.config={});const t=Q[0].dataInputs[0],z=Q[0].dataInputs[1];return Q[0].config.valueType=(null===(y=mp._connectionValues[t.uniqueId])||void 0===y?void 0:y.type)??(null===(P=mp._connectionValues[z.uniqueId])||void 0===P?void 0:P.type)??"FlowGraphInteger",Q}},"math/asr":UM("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":UM("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":UM("FlowGraphLeadingZerosBlock"),"math/ctz":UM("FlowGraphTrailingZerosBlock"),"math/popcnt":UM("FlowGraphOneBitsCounterBlock"),"math/rad":UM("FlowGraphDegToRadBlock"),"math/deg":UM("FlowGraphRadToDegBlock"),"type/boolToInt":UM("FlowGraphBooleanToInt"),"type/boolToFloat":UM("FlowGraphBooleanToFloat"),"type/intToBool":UM("FlowGraphIntToBoolean"),"type/intToFloat":UM("FlowGraphIntToFloat"),"type/floatToInt":UM("FlowGraphFloatToInt"),"type/floatToBool":UM("FlowGraphFloatToBoolean"),"flow/sequence":{ix:["FlowGraphSequenceBlock"],extraProcessor(p,b,M,h,Q){const mp=Q[0];return mp.config||(mp.config={}),mp.config.outputSignalCount=Object.keys(p.flows||[]).length,mp.signalOutputs.forEach(((p,b)=>{p.name="out_"+b})),Q}},"flow/branch":{ix:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{ix:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(p){if(p.configuration&&p.configuration.cases){const b=p.configuration.cases.value;if(!b.every((p=>"number"===typeof p&&/^-?\d+$/.test(p.toString()))))return J.d.Warn("Switch cases should be integers. Using empty array instead."),p.configuration.cases.value=[],{valid:!0};const M=new Set(b);p.configuration.cases.value=Array.from(M)}return{valid:!0}},extraProcessor(p,b,M,h,Q){if("flow/switch"!==b.op||!p.flows||0===Object.keys(p.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return Q[0].signalOutputs.forEach((p=>{"default"!==p.name&&(p.name="out_"+p.name)})),Q}},"flow/while":{ix:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{ix:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(p,b,M,h,Q){const mp=Q[0];return mp.config||(mp.config={}),mp.config.incrementIndexWhenLoopDone=!0,Q}},"flow/doN":{ix:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{ix:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(p,b,M,h,Q){if("flow/multiGate"!==b.op||!p.flows||0===Object.keys(p.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const mp=Q[0];return mp.config||(mp.config={}),mp.config.outputSignalCount=Object.keys(p.flows).length,mp.signalOutputs.forEach(((p,b)=>{p.name="out_"+b})),Q}},"flow/waitAll":{ix:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(p){var b,M;return"number"!==typeof(null===(b=p.configuration)||void 0===b||null===(M=b.inputFlows)||void 0===M?void 0:M.value[0])&&(p.configuration=p.configuration||{inputFlows:{value:[0]}},p.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{ix:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{ix:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{ix:["FlowGraphCancelDelayBlock"]},"variable/get":{ix:["FlowGraphGetVariableBlock"],validation(p){var b,M;return null!==(b=p.configuration)&&void 0!==b&&null!==(M=b.variable)&&void 0!==M&&M.value?{valid:!0}:(J.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(p,b)=>[b.getVariableName(p[0])]}}},"variable/set":{ix:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(p,b)=>[b.getVariableName(p[0])]}}},"variable/setMultiple":{ix:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(p,b)=>[p[0].map((p=>b.getVariableName(p)))]}},extraProcessor:(p,b,M,h,Q)=>(Q[0].dataInputs.forEach((p=>{p.name=h.getVariableName(+p.name)})),Q)},"variable/interpolate":{ix:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(p,b)=>[b.getVariableName(p[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:p=>!0===p[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Bh:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Bh:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Bh:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Bh:"FlowGraphPlayAnimationBlock"},out:{name:"out",Bh:"FlowGraphPlayAnimationBlock"},done:{name:"done",Bh:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(p,b,M,h,Q){var mp,y,P;const w=Q[0],t=null===(mp=p.configuration)||void 0===mp?void 0:mp.variable.value[0];if("number"!==typeof t)throw J.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const z=h.arrays.staticVariables[t];"undefined"===typeof w.config.animationType.value&&(h.arrays.staticVariables,w.config.animationType.value=(0,aM.G)(z.type));const x=Q[4];return x.config||(x.config={}),(y=x.config).variable||(y.variable={}),x.config.variable.value=h.getVariableName(t),(P=Q[3]).config||(P.config={}),Q}},"pointer/get":{ix:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Bh:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Bh:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(p,b,M,h,Q)=>(Q.forEach((p=>{"FlowGraphJsonPointerParserBlock"===p.className&&(p.config||(p.config={}),p.config.outputValue=!0)})),Q)},"pointer/set":{ix:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Bh:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Bh:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(p,b,M,h,Q)=>(Q.forEach((p=>{"FlowGraphJsonPointerParserBlock"===p.className&&(p.config||(p.config={}),p.config.outputValue=!0)})),Q)},"pointer/interpolate":{ix:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Bh:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Bh:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Bh:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Bh:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Bh:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Bh:"FlowGraphPlayAnimationBlock"},out:{name:"out",Bh:"FlowGraphPlayAnimationBlock"},done:{name:"done",Bh:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(p,b,M,h,Q)=>(Q.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className?(b.config||(b.config={}),b.config.outputValue=!0):"FlowGraphInterpolationBlock"===b.className&&(b.config||(b.config={}),Object.keys(p.values||[]).forEach((M=>{var Q;const mp=null===(Q=p.values)||void 0===Q?void 0:Q[M];if("value"===M&&mp){const p=mp.type;void 0!==p&&(b.config.animationType=h.arrays.types[p].flowGraphType)}})))})),Q)},"animation/start":{ix:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Bh:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(p,b)=>[p[0]*b._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(p,b)=>[p[0]*b._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(p,b,M,h,Q,mp,y){const P=Q[Q.length-1];return P.config||(P.config={}),P.config.glTF=y,Q}},"animation/stop":{ix:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Bh:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(p,b,M,h,Q,mp,y){const P=Q[Q.length-1];return P.config||(P.config={}),P.config.glTF=y,Q}},"animation/stopAt":{ix:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Bh:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(p,b)=>[p[0]*b._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(p,b,M,h,Q,mp,y){const P=Q[Q.length-1];return P.config||(P.config={}),P.config.glTF=y,Q}},"math/switch":{ix:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(p){if(p.configuration&&p.configuration.cases){const b=p.configuration.cases.value;if(!b.every((p=>"number"===typeof p&&/^-?\d+$/.test(p.toString()))))return J.d.Warn("Switch cases should be integers. Using empty array instead."),p.configuration.cases.value=[],{valid:!0};const M=new Set(b);p.configuration.cases.value=Array.from(M)}return{valid:!0}},extraProcessor(p,b,M,h,Q){const mp=Q[0];return mp.dataInputs.forEach((p=>{"default"!==p.name&&"case"!==p.name&&(p.name="in_"+p.name)})),mp.config||(mp.config={}),mp.config.treatCasesAsIntegers=!0,Q}},"debug/log":{ix:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function UM(p){let b=arguments.length>2?arguments[2]:void 0;return{ix:[p],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((p,b)=>(p[b]={name:b},p)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(p,M,h,Q,mp){var y;if(b){(y=mp[0]).config||(y.config={}),mp[0].config.preventIntegerFloatArithmetic=!0;let b=-1;Object.keys(p.values||{}).find((M=>{var h;return void 0!==(null===(h=p.values)||void 0===h?void 0:h[M].type)&&(b=p.values[M].type,!0)})),-1!==b&&(mp[0].config.type=Q.arrays.types[b].flowGraphType)}return mp},validation:p=>b?qM(p):{valid:!0}}}function qM(p){if(p.values){const b=Object.keys(p.values).map((b=>p.values[b].type)).filter((p=>void 0!==p));if(!b.every((p=>p===b[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}ZM["math/compose"]=ZM["math/matCompose"],ZM["math/decompose"]=ZM["math/matDecompose"];var BM=M(12739);const sM={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"QM",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class iM{constructor(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=p,this._gltf=b,this._animationTargetFps=M,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const p of this._interactivityGraph.types)this._types.push(sM[p.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const p of this._interactivityGraph.declarations){const b=IM(p);if(!b)throw J.d.Error(["No mapping found for declaration",p]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:b,fullOperationName:p.extension?p.op+":"+p.extension:p.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const p of this._interactivityGraph.variables){const b=this._parseVariable(p);this._staticVariables.push(b)}}_parseVariable(p,b){const M=this._types[p.type];if(!M)throw J.d.Error(["No type found for variable",p]),new Error("Error parsing variables");if(p.value&&p.value.length!==M.length)throw J.d.Error(["Invalid value length for variable",p,M]),new Error("Error parsing variables");const h=p.value||[];if(!h.length)switch(M.flowGraphType){case"boolean":h.push(!1);break;case"FlowGraphInteger":h.push(0);break;case"number":h.push(NaN);break;case"Vector2":h.push(NaN,NaN);break;case"QM":h.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":h.fill(NaN,0,4);break;case"Matrix":h.fill(NaN,0,16);break;case"Matrix3D":h.fill(NaN,0,9)}return"number"===M.elementType&&"string"===typeof h[0]&&(h[0]=parseFloat(h[0])),{type:M.flowGraphType,value:b?b(h,this):h}}_parseEvents(){if(this._interactivityGraph.events)for(const p of this._interactivityGraph.events){const b={eventId:p.id||"internalEvent_"+this._internalEventsCounter++};p.values&&(b.eventData=Object.keys(p.values).map((b=>{var M;const h=null===(M=p.values)||void 0===M?void 0:M[b];if(!h)throw J.d.Error(["No value found for event key",b]),new Error("Error parsing events");const Q=this._types[h.type];if(!Q)throw J.d.Error(["No type found for event value",h]),new Error("Error parsing events");const mp="undefined"!==typeof h.value?this._parseVariable(h):void 0;return{id:b,type:Q.flowGraphType,eventData:!0,value:mp}}))),this._events.push(b)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const b of this._interactivityGraph.nodes){if("number"!==typeof b.declaration)throw J.d.Error(["No declaration found for node",b]),new Error("Error parsing nodes");const M=this._mappings[b.declaration];if(!M)throw J.d.Error(["No mapping found for node",b]),new Error("Error parsing nodes");if(M.flowGraphMapping.validation){const h=M.flowGraphMapping.validation(b,this._interactivityGraph,this._gltf);var p;if(!h.valid)throw new Error(`Error validating interactivity node ${null===(p=this._interactivityGraph.declarations)||void 0===p?void 0:p[b.declaration].op} - ${h.error}`)}const h=[];for(const p of M.flowGraphMapping.ix){const Q=this._getEmptyBlock(p,M.fullOperationName);this._parseNodeConfiguration(b,Q,M.flowGraphMapping,p),h.push(Q)}this._nodes.push({ix:h,fullOperationName:M.fullOperationName})}}_getEmptyBlock(p,b){return{uniqueId:(0,BM.c)(),className:p,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:b,metadata:{}}}_parseNodeConfiguration(p,b,M,h){const Q=b.config;if(p.configuration){const b=Object.keys(p.configuration);for(const P of b){var mp,y;const b=null===(mp=p.configuration)||void 0===mp?void 0:mp[P];if(!b)throw J.d.Error(["No value found for node configuration",P]),new Error("Error parsing node configuration");const w=null===(y=M.configuration)||void 0===y?void 0:y[P];if(w&&w.Bh?w.Bh===h:0===M.ix.indexOf(h)){const p=(null===w||void 0===w?void 0:w.name)||P;b&&"undefined"!==typeof b.value||"undefined"===typeof(null===w||void 0===w?void 0:w.defaultValue)?b.value.length>=0?Q[p]={value:1===b.value.length?b.value[0]:b.value}:J.d.Warn(["Invalid value for node configuration",b]):Q[p]={value:w.defaultValue},w&&w.dataTransformer&&(Q[p].value=w.dataTransformer([Q[p].value],this)[0])}}}}_parseNodeConnections(p){for(let L=0;L<this._nodes.length;L++){var b;const u=null===(b=this._interactivityGraph.nodes)||void 0===b?void 0:b[L];if(!u)throw J.d.Error(["No node found for interactivity node",this._nodes[L]]),new Error("Error parsing node connections");const e=this._nodes[L],d=this._mappings[u.declaration];if(!d)throw J.d.Error(["No mapping found for node",u]),new Error("Error parsing node connections");const I=u.flows||{},G=Object.keys(I).sort();for(const p of G){var M,h,Q,mp;const b=I[p],t=null===(M=d.flowGraphMapping.outputs)||void 0===M||null===(h=M.flows)||void 0===h?void 0:h[p],z=(null===t||void 0===t?void 0:t.name)||p,x=this._createNewSocketConnection(z,!0);(t&&t.Bh&&e.ix.find((p=>p.className===t.Bh))||e.ix[0]).signalOutputs.push(x);const S=b.node,X=this._nodes[S];if(!X)throw J.d.Error(["No node found for input node id",S]),new Error("Error parsing node connections");const c=dM(X.fullOperationName);if(!c)throw J.d.Error(["No mapping found for input node",X]),new Error("Error parsing node connections");let g=null===(Q=c.inputs)||void 0===Q||null===(mp=Q.flows)||void 0===mp?void 0:mp[b.socket||"in"],f=!1;if(!g)for(const p in null===(y=c.inputs)||void 0===y?void 0:y.flows){var y,P,w;if(p.startsWith("[")&&p.endsWith("]"))f=!0,g=null===(P=c.inputs)||void 0===P||null===(w=P.flows)||void 0===w?void 0:w[p]}const Y=g?f?g.name.replace("$1",b.socket||""):g.name:b.socket||"in",a=g&&g.Bh&&X.ix.find((p=>p.className===g.Bh))||X.ix[0];let o=a.signalInputs.find((p=>p.name===Y));o||(o=this._createNewSocketConnection(Y),a.signalInputs.push(o)),o.connectedPointIds.push(x.uniqueId),x.connectedPointIds.push(o.uniqueId)}const v=u.values||{},Z=Object.keys(v);for(const b of Z){var t,z;const M=v[b];let h=null===(t=d.flowGraphMapping.inputs)||void 0===t||null===(z=t.values)||void 0===z?void 0:z[b],Q=!1;if(!h)for(const p in null===(x=d.flowGraphMapping.inputs)||void 0===x?void 0:x.values){var x,S,X;if(p.startsWith("[")&&p.endsWith("]"))Q=!0,h=null===(S=d.flowGraphMapping.inputs)||void 0===S||null===(X=S.values)||void 0===X?void 0:X[p]}const mp=h?Q?h.name.replace("$1",b):h.name:b,y=this._createNewSocketConnection(mp);if((h&&h.Bh&&e.ix.find((p=>p.className===h.Bh))||e.ix[0]).dataInputs.push(y),void 0!==M.value){const b=this._parseVariable(M,h&&h.dataTransformer);p._connectionValues[y.uniqueId]=b}else{if("undefined"===typeof M.node)throw J.d.Error(["Invalid value for value connection",M]),new Error("Error parsing node connections");{var c,g,f;const p=M.node,b=M.socket||"value",h=this._nodes[p];if(!h)throw J.d.Error(["No node found for output socket reference",M]),new Error("Error parsing node connections");const Q=dM(h.fullOperationName);if(!Q)throw J.d.Error(["No mapping found for output socket reference",M]),new Error("Error parsing node connections");let mp=null===(c=Q.outputs)||void 0===c||null===(g=c.values)||void 0===g?void 0:g[b],P=!1;if(!mp)for(const M in null===(Y=Q.outputs)||void 0===Y?void 0:Y.values){var Y,a,o;if(M.startsWith("[")&&M.endsWith("]"))P=!0,mp=null===(a=Q.outputs)||void 0===a||null===(o=a.values)||void 0===o?void 0:o[M]}const w=mp?P?mp.name.replace("$1",b):null===(f=mp)||void 0===f?void 0:f.name:b,t=mp&&mp.Bh&&h.ix.find((p=>p.className===mp.Bh))||h.ix[0];let z=t.dataOutputs.find((p=>p.name===w));z||(z=this._createNewSocketConnection(w,!0),t.dataOutputs.push(z)),y.connectedPointIds.push(z.uniqueId),z.connectedPointIds.push(y.uniqueId)}}}if(d.flowGraphMapping.interBlockConnectors)for(const p of d.flowGraphMapping.interBlockConnectors){const b=p.input,M=p.output,h=p.isVariable;this._connectFlowGraphNodes(b,M,e.ix[p.inputBlockIndex],e.ix[p.outputBlockIndex],h)}if(d.flowGraphMapping.extraProcessor){var l;const b=null===(l=this._interactivityGraph.declarations)||void 0===l?void 0:l[u.declaration];if(!b)throw J.d.Error(["No declaration found for extra processor",u]),new Error("Error parsing node connections");e.ix=d.flowGraphMapping.extraProcessor(u,b,d.flowGraphMapping,this,e.ix,p,this._gltf)}}}_createNewSocketConnection(p,b){return{uniqueId:(0,BM.c)(),name:p,_connectionType:b?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(p,b,M,h,Q){const mp=Q?M.dataInputs:M.signalInputs,y=Q?h.dataOutputs:h.signalOutputs,P=mp.find((b=>b.name===p))||this._createNewSocketConnection(p),w=y.find((p=>p.name===b))||this._createNewSocketConnection(b,!0);mp.find((b=>b.name===p))||mp.push(P),y.find((p=>p.name===b))||y.push(w),P.connectedPointIds.push(w.uniqueId),w.connectedPointIds.push(P.uniqueId)}getVariableName(p){return"staticVariable_"+p}serializeToFlowGraph(){const p={uniqueId:(0,BM.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(p);for(let b=0;b<this._staticVariables.length;b++){const M=this._staticVariables[b];p._userVariables[this.getVariableName(b)]=M}return{rightHanded:!0,allBlocks:this._nodes.reduce(((p,b)=>p.concat(b.ix)),[]),executionContexts:[p]}}}const TM="KHR_interactivity";class WM{constructor(p){this._loader=p,this.name=TM,this.enabled=this._loader.isExtensionUsed(TM),this._pathConverter=(0,H.g)(this._loader.fb),p._skipStartAnimationStep=!0;const b=p.babylonScene;b&&function(p){(0,H.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!p.activeCamera)return new Q.Quaternion(NaN,NaN,NaN,NaN);const b=Q.Quaternion.FromRotationMatrix(p.activeCamera.getWorldMatrix()).normalize();return p.useRightHandedSystem||(b.w*=-1,b.x*=-1),b},type:"Quaternion",getTarget:()=>p.activeCamera}),(0,H.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!p.activeCamera)return new Q.QM(NaN,NaN,NaN);const b=p.activeCamera.getWorldMatrix().getTranslation();return p.useRightHandedSystem||(b.x*=-1),b},type:"QM",getTarget:()=>p.activeCamera}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:p=>{var b;return(null===(b=p._babylonAnimationGroup)||void 0===b?void 0:b.isPlaying)??!1},type:"boolean",getTarget:p=>p._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:p=>{var b;return((null===(b=p._babylonAnimationGroup)||void 0===b?void 0:b.from)??0)/60},type:"number",getTarget:p=>p._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:p=>{var b;return((null===(b=p._babylonAnimationGroup)||void 0===b?void 0:b.to)??0)/60},type:"number",getTarget:p=>p._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:p=>{var b;return((null===(b=p._babylonAnimationGroup)||void 0===b?void 0:b.getCurrentFrame())??0)/60},type:"number",getTarget:p=>p._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:p=>{var b;return((null===(b=p._babylonAnimationGroup)||void 0===b?void 0:b.getCurrentFrame())??0)/60},type:"number",getTarget:p=>p._babylonAnimationGroup})}(b)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var p;if(!this._loader.babylonScene||!this._pathConverter)return;const b=this._loader.babylonScene,M=null===(p=this._loader.fb.extensions)||void 0===p?void 0:p.KHR_interactivity;if(!M)return;const h=new cM.c({yM:b});h.dispatchEventsSynchronously=!1;const Q=M.graphs.map((p=>new iM(p,this._loader.fb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(Q.map((async p=>await LM(p,{coordinator:h,pathConverter:this._pathConverter})))),h.start()}}var HM;HM=async()=>(await Promise.resolve().then(M.bind(M,14371))).FlowGraphGLTFDataProvider,JM[`${TM}/${"FlowGraphGLTFDataProvider"}`]=HM,W(TM),T(TM,!0,(p=>new WM(p)));const EM="KHR_node_visibility";(0,H.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:p=>{const b=p._babylonTransformNode;return!b||void 0===b.isVisible||b.isVisible},set:(p,b)=>{var M,h;null===(M=b._primitiveBabylonMeshes)||void 0===M||M.forEach((p=>{p.inheritVisibility=!0})),b._babylonTransformNode&&(b._babylonTransformNode.isVisible=p),null===(h=b._primitiveBabylonMeshes)||void 0===h||h.forEach((b=>{b.isVisible=p}))},getTarget:p=>p._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class jM{constructor(p){this.name=EM,this._loader=p,this.enabled=p.isExtensionUsed(EM)}async onReady(){var p;null===(p=this._loader.fb.nodes)||void 0===p||p.forEach((p=>{var b,M,h,Q;(null===(b=p._primitiveBabylonMeshes)||void 0===b||b.forEach((p=>{p.inheritVisibility=!0})),null!==(M=p.extensions)&&void 0!==M&&M.KHR_node_visibility)&&(!1===(null===(h=p.extensions)||void 0===h?void 0:h.KHR_node_visibility.visible)&&(p._babylonTransformNode&&(p._babylonTransformNode.isVisible=!1),null===(Q=p._primitiveBabylonMeshes)||void 0===Q||Q.forEach((p=>{p.isVisible=!1}))))}))}dispose(){this._loader=null}}W(EM),T(EM,!0,(p=>new jM(p)));const VM="KHR_node_selectability";GM("event/onSelect",VM,{ix:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Bh:"FlowGraphGetVariableBlock",dataTransformer:p=>["pickedMesh_"+p[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Bh:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(p,b,M,h,Q,mp,y){var P,w,t,z,x,S;const X=Q[Q.length-1];X.config=X.config||{},X.config.glTF=y;const c=null===(P=p.configuration)||void 0===P||null===(w=P.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===c||"number"!==typeof c)throw new Error("nodeIndex not found in configuration");const J="pickedMesh_"+c;return Q[1].config.variable=J,mp._userVariables[J]={className:"Mesh",id:null===y||void 0===y||null===(t=y.nodes)||void 0===t||null===(z=t[c]._babylonTransformNode)||void 0===z?void 0:z.id,uniqueId:null===y||void 0===y||null===(x=y.nodes)||void 0===x||null===(S=x[c]._babylonTransformNode)||void 0===S?void 0:S.uniqueId},Q}}),(0,H.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:p=>{const b=p._babylonTransformNode;return!b||void 0===b.Ct||b.Ct},set:(p,b)=>{var M;null===(M=b._primitiveBabylonMeshes)||void 0===M||M.forEach((b=>{b.Ct=p}))},getTarget:p=>p._babylonTransformNode,getPropertyName:[()=>"Ct"],type:"boolean"});class DM{constructor(p){this.name=VM,this._loader=p,this.enabled=p.isExtensionUsed(VM)}async onReady(){var p;null===(p=this._loader.fb.nodes)||void 0===p||p.forEach((p=>{var b,M,h;null!==(b=p.extensions)&&void 0!==b&&b.KHR_node_selectability&&!1===(null===(M=p.extensions)||void 0===M?void 0:M.KHR_node_selectability.selectable)&&(null===(h=p._babylonTransformNode)||void 0===h||h.getChildMeshes().forEach((p=>{p.Ct=!1})))}))}dispose(){this._loader=null}}W(VM),T(VM,!0,(p=>new DM(p)));const NM="KHR_node_hoverability",OM="targetMeshPointerOver_";GM("event/onHoverIn",NM,{ix:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Bh:"FlowGraphGetVariableBlock",dataTransformer:p=>[OM+p[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Bh:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(p,b,M,h,Q,mp,y){var P,w,t,z,x,S;const X=Q[Q.length-1];X.config=X.config||{},X.config.glTF=y;const c=null===(P=p.configuration)||void 0===P||null===(w=P.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===c||"number"!==typeof c)throw new Error("nodeIndex not found in configuration");const J=OM+c;return Q[1].config.variable=J,mp._userVariables[J]={className:"Mesh",id:null===y||void 0===y||null===(t=y.nodes)||void 0===t||null===(z=t[c]._babylonTransformNode)||void 0===z?void 0:z.id,uniqueId:null===y||void 0===y||null===(x=y.nodes)||void 0===x||null===(S=x[c]._babylonTransformNode)||void 0===S?void 0:S.uniqueId},Q}});const RM="targetMeshPointerOut_";GM("event/onHoverOut",NM,{ix:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Bh:"FlowGraphGetVariableBlock",dataTransformer:p=>[RM+p[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Bh:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(p,b,M,h,Q,mp,y){var P,w,t,z,x,S;const X=Q[Q.length-1];X.config=X.config||{},X.config.glTF=y;const c=null===(P=p.configuration)||void 0===P||null===(w=P.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===c||"number"!==typeof c)throw new Error("nodeIndex not found in configuration");const J=RM+c;return Q[1].config.variable=J,mp._userVariables[J]={className:"Mesh",id:null===y||void 0===y||null===(t=y.nodes)||void 0===t||null===(z=t[c]._babylonTransformNode)||void 0===z?void 0:z.id,uniqueId:null===y||void 0===y||null===(x=y.nodes)||void 0===x||null===(S=x[c]._babylonTransformNode)||void 0===S?void 0:S.uniqueId},Q}}),(0,H.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:p=>{const b=p._babylonTransformNode;return!b||void 0===b.pointerOverDisableMeshTesting||b.pointerOverDisableMeshTesting},set:(p,b)=>{var M;null===(M=b._primitiveBabylonMeshes)||void 0===M||M.forEach((b=>{b.pointerOverDisableMeshTesting=!p}))},getTarget:p=>p._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class KM{constructor(p){this.name=NM,this._loader=p,this.enabled=p.isExtensionUsed(NM)}async onReady(){var p;null===(p=this._loader.fb.nodes)||void 0===p||p.forEach((p=>{var b,M,h;null!==(b=p.extensions)&&void 0!==b&&b.KHR_node_hoverability&&!1===(null===(M=p.extensions)||void 0===M?void 0:M.KHR_node_hoverability.hoverable)&&(null===(h=p._babylonTransformNode)||void 0===h||h.getChildMeshes().forEach((p=>{p.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}W(NM),T(NM,!0,(p=>new KM(p)));const rM="ExtrasAsMetadata";class kM{_assignExtras(p,b){if(b.extras&&Object.keys(b.extras).length>0){const M=p.metadata=p.metadata||{};(M.fb=M.fb||{}).extras=b.extras}}constructor(p){this.name=rM,this.enabled=!0,this._loader=p}dispose(){this._loader=null}loadNodeAsync(p,b,M){return this._loader.loadNodeAsync(p,b,(p=>{this._assignExtras(p,b),M(p)}))}loadCameraAsync(p,b,M){return this._loader.loadCameraAsync(p,b,(p=>{this._assignExtras(p,b),M(p)}))}createMaterial(p,b,M){const h=this._loader.createMaterial(p,b,M);return this._assignExtras(h,b),h}}W(rM),T(rM,!1,(p=>new kM(p)));M(14371)},14242:(p,b,M)=>{"use strict";M.d(b,{d:()=>q,f:()=>d,j:()=>e,l:()=>I});var h=M(12617),Q=M(12608),mp=M(13893),y=M(13231),P=M(13206),w=M(13217),t=M(12622),z=M(12652),x=M(13229),S=M(13327),X=M(13235),c=M(12815);class J{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.LX=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ac=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(p){this._environmentTexture=p}getNodes(){let p=[];p=p.concat(this.meshes),p=p.concat(this.lights),p=p.concat(this.cameras),p=p.concat(this.transformNodes);for(const b of this.skeletons)p=p.concat(b.bones);return p}}class g extends J{}class f{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const p=this.rootNodes;for(const h of p)h.dispose();p.length=0;const b=this.skeletons;for(const h of b)h.dispose();b.length=0;const M=this.animationGroups;for(const h of M)h.dispose();M.length=0}}class Y extends J{constructor(p){super(),this._wasAddedToScene=!1,(p=p||z.c.LastCreatedScene)&&(this.yM=p,this.proceduralTextures=[],p.Xb.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=p.getEngine().onContextRestoredObservable.add((()=>{for(const p of this.geometries)p._rebuild();for(const p of this.meshes)p._rebuild();for(const p of this.LX)p.rebuild();for(const p of this.textures)p._rebuild()})))}_topologicalSort(p){const b=new Map;for(const y of p)b.set(y.uniqueId,y);const M={dependsOn:new Map,dependedBy:new Map};for(const y of p){const p=y.uniqueId;M.dependsOn.set(p,new Set),M.dependedBy.set(p,new Set)}for(const y of p){const p=y.uniqueId,h=M.dependsOn.get(p);if(y instanceof x.b){const Q=y.sourceMesh;b.has(Q.uniqueId)&&(h.add(Q.uniqueId),M.dependedBy.get(Q.uniqueId).add(p))}const Q=M.dependedBy.get(p);for(const mp of y.getDescendants()){const h=mp.uniqueId;if(b.has(h)){Q.add(h);M.dependsOn.get(h).add(p)}}}const h=[],Q=[];for(const y of p){const p=y.uniqueId;0===M.dependsOn.get(p).size&&(Q.push(y),b.delete(p))}const mp=Q;for(;mp.length>0;){const p=mp.shift();h.push(p);const Q=M.dependedBy.get(p.uniqueId);for(const h of Array.from(Q.values())){const Q=M.dependsOn.get(h);Q.delete(p.uniqueId),0===Q.size&&b.get(h)&&(mp.push(b.get(h)),b.delete(h))}}return b.size>0&&(t.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),b.forEach((p=>{t.d.Error(p.name)}))),h}_addNodeAndDescendantsToList(p,b,M,h){if(M&&(!h||h(M))&&!b.has(M.uniqueId)){p.push(M),b.add(M.uniqueId);for(const Q of M.getDescendants(!0))this._addNodeAndDescendantsToList(p,b,Q,h)}}_isNodeInContainer(p){return p instanceof w.c&&-1!==this.meshes.indexOf(p)||(p instanceof P.c&&-1!==this.transformNodes.indexOf(p)||(p instanceof S.c&&-1!==this.lights.indexOf(p)||p instanceof X.e&&-1!==this.cameras.indexOf(p)))}_isValidHierarchy(){for(const p of this.meshes)if(p.parent&&!this._isNodeInContainer(p.parent))return t.d.Warn(`Node ${p.name} has a parent that is not in the container.`),!1;for(const p of this.transformNodes)if(p.parent&&!this._isNodeInContainer(p.parent))return t.d.Warn(`Node ${p.name} has a parent that is not in the container.`),!1;for(const p of this.lights)if(p.parent&&!this._isNodeInContainer(p.parent))return t.d.Warn(`Node ${p.name} has a parent that is not in the container.`),!1;for(const p of this.cameras)if(p.parent&&!this._isNodeInContainer(p.parent))return t.d.Warn(`Node ${p.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(p){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||Q.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const h={},mp={},P=new f,w=[],t=[],z={doNotInstantiate:!0,...M},x=[],S=new Set;for(const Q of this.transformNodes)null===Q.parent&&this._addNodeAndDescendantsToList(x,S,Q,z.predicate);for(const Q of this.meshes)null===Q.parent&&this._addNodeAndDescendantsToList(x,S,Q,z.predicate);const X=this._topologicalSort(x),c=(M,Q)=>{if(((b,M)=>{if(h[b.uniqueId]=M.uniqueId,mp[M.uniqueId]=M,p&&(M.name=p(b.name)),M instanceof y.e){const p=M;if(p.morphTargetManager){const M=b.morphTargetManager;p.morphTargetManager=M.clone();for(let b=0;b<M.numTargets;b++){const Q=M.getTarget(b),y=p.morphTargetManager.getTarget(b);h[Q.uniqueId]=y.uniqueId,mp[y.uniqueId]=y}}}})(M,Q),M.parent){const p=h[M.parent.uniqueId],b=mp[p];Q.parent=b||M.parent}if(Q.position&&M.position&&Q.position.mp(M.position),Q.rotationQuaternion&&M.rotationQuaternion&&Q.rotationQuaternion.mp(M.rotationQuaternion),Q.rotation&&M.rotation&&Q.rotation.mp(M.rotation),Q.ib&&M.ib&&Q.ib.mp(M.ib),Q.material){const y=Q;if(y.material)if(b){const b=M.material;if(-1===t.indexOf(b)){let M=b.clone(p?p(b.name):"Clone of "+b.name);if(t.push(b),h[b.uniqueId]=M.uniqueId,mp[M.uniqueId]=M,"MultiMaterial"===b.getClassName()){const Q=b;for(const b of Q.Eb)b&&(M=b.clone(p?p(b.name):"Clone of "+b.name),t.push(b),h[b.uniqueId]=M.uniqueId,mp[M.uniqueId]=M);Q.Eb=Q.Eb.map((p=>p&&mp[h[p.uniqueId]]))}}"InstancedMesh"!==y.getClassName()&&(y.material=mp[h[b.uniqueId]])}else"MultiMaterial"===y.material.getClassName()?-1===this.yM.multiMaterials.indexOf(y.material)&&this.yM.addMultiMaterial(y.material):-1===this.yM.materials.indexOf(y.material)&&this.yM.addMaterial(y.material)}null===Q.parent&&P.rootNodes.push(Q)};for(const Q of X)if("InstancedMesh"===Q.getClassName()){const p=Q,b=p.sourceMesh,M=h[b.uniqueId];c(p,("number"===typeof M?mp[M]:b).createInstance(p.name))}else{let p=!0;"rb"===Q.getClassName()||"Node"===Q.getClassName()||Q.skeleton||!Q.getTotalVertices||0===Q.getTotalVertices()?p=!1:z.doNotInstantiate&&(p="function"===typeof z.doNotInstantiate?!z.doNotInstantiate(Q):!z.doNotInstantiate);const b=p?Q.createInstance(`instance of ${Q.name}`):Q.clone(`Clone of ${Q.name}`,null,!0);if(!b)throw new Error(`Could not clone or instantiate node on Asset Container ${Q.name}`);c(Q,b)}for(const Q of this.skeletons){if(z.predicate&&!z.predicate(Q))continue;const b=Q.clone(p?p(Q.name):"Clone of "+Q.name);for(const p of this.meshes)if(p.skeleton===Q&&!p.isAnInstance){const M=mp[h[p.uniqueId]];if(!M||M.isAnInstance)continue;if(M.skeleton=b,-1!==w.indexOf(b))continue;w.push(b);for(const p of b.bones)p._linkedTransformNode&&(p._linkedTransformNode=mp[h[p._linkedTransformNode.uniqueId]])}P.skeletons.push(b)}for(const Q of this.animationGroups){if(z.predicate&&!z.predicate(Q))continue;const b=Q.clone(p?p(Q.name):"Clone of "+Q.name,(p=>mp[h[p.uniqueId]]||p));P.animationGroups.push(b)}return P}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||Q.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.yM.environmentTexture=this.environmentTexture);for(const p of this.yM._serializableComponents)p.addFromContainer(this);this.yM.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=[];for(const M of this.cameras)p&&!p(M)||(this.yM.addCamera(M),b.push(M));for(const M of this.lights)p&&!p(M)||(this.yM.addLight(M),b.push(M));for(const M of this.meshes)p&&!p(M)||(this.yM.ux(M),b.push(M));for(const M of this.skeletons)p&&!p(M)||this.yM.addSkeleton(M);for(const M of this.animations)p&&!p(M)||this.yM.addAnimation(M);for(const M of this.animationGroups)p&&!p(M)||this.yM.addAnimationGroup(M);for(const M of this.multiMaterials)p&&!p(M)||this.yM.addMultiMaterial(M);for(const M of this.materials)p&&!p(M)||this.yM.addMaterial(M);for(const M of this.morphTargetManagers)p&&!p(M)||this.yM.addMorphTargetManager(M);for(const M of this.geometries)p&&!p(M)||this.yM.addGeometry(M);for(const M of this.transformNodes)p&&!p(M)||(this.yM.addTransformNode(M),b.push(M));for(const M of this.actionManagers)p&&!p(M)||this.yM.addActionManager(M);for(const M of this.textures)p&&!p(M)||this.yM.addTexture(M);for(const M of this.reflectionProbes)p&&!p(M)||this.yM.addReflectionProbe(M);for(const M of b)M.parent&&-1===this.yM.getNodes().indexOf(M.parent)&&(M.setParent?M.setParent(null):M.parent=null)}removeAllFromScene(){this._isValidHierarchy()||Q.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.yM.environmentTexture&&(this.yM.environmentTexture=null);for(const p of this.yM._serializableComponents)p.removeFromContainer(this)}removeFromScene(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const b of this.cameras)p&&!p(b)||this.yM.removeCamera(b);for(const b of this.lights)p&&!p(b)||this.yM.removeLight(b);for(const b of this.meshes)p&&!p(b)||this.yM.Lx(b,!0);for(const b of this.skeletons)p&&!p(b)||this.yM.removeSkeleton(b);for(const b of this.animations)p&&!p(b)||this.yM.removeAnimation(b);for(const b of this.animationGroups)p&&!p(b)||this.yM.removeAnimationGroup(b);for(const b of this.multiMaterials)p&&!p(b)||this.yM.removeMultiMaterial(b);for(const b of this.materials)p&&!p(b)||this.yM.removeMaterial(b);for(const b of this.morphTargetManagers)p&&!p(b)||this.yM.removeMorphTargetManager(b);for(const b of this.geometries)p&&!p(b)||this.yM.removeGeometry(b);for(const b of this.transformNodes)p&&!p(b)||this.yM.removeTransformNode(b);for(const b of this.actionManagers)p&&!p(b)||this.yM.removeActionManager(b);for(const b of this.textures)p&&!p(b)||this.yM.removeTexture(b);for(const b of this.reflectionProbes)p&&!p(b)||this.yM.removeReflectionProbe(b)}dispose(){const p=this.cameras.slice(0);for(const X of p)X.dispose();this.cameras.length=0;const b=this.lights.slice(0);for(const X of b)X.dispose();this.lights.length=0;const M=this.meshes.slice(0);for(const X of M)X.dispose();this.meshes.length=0;const h=this.skeletons.slice(0);for(const X of h)X.dispose();this.skeletons.length=0;const Q=this.animationGroups.slice(0);for(const X of Q)X.dispose();this.animationGroups.length=0;const mp=this.multiMaterials.slice(0);for(const X of mp)X.dispose();this.multiMaterials.length=0;const y=this.materials.slice(0);for(const X of y)X.dispose();this.materials.length=0;const P=this.geometries.slice(0);for(const X of P)X.dispose();this.geometries.length=0;const w=this.transformNodes.slice(0);for(const X of w)X.dispose();this.transformNodes.length=0;const t=this.actionManagers.slice(0);for(const X of t)X.dispose();this.actionManagers.length=0;const z=this.textures.slice(0);for(const X of z)X.dispose();this.textures.length=0;const x=this.reflectionProbes.slice(0);for(const X of x)X.dispose();this.reflectionProbes.length=0;const S=this.morphTargetManagers.slice(0);for(const X of S)X.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const X of this.yM._serializableComponents)X.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.yM.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(p,b,M){if(p&&b)for(const h of p){let p=!0;if(M)for(const b of M)if(h===b){p=!1;break}p&&(b.push(h),h._parentContainer=this)}}moveAllFromScene(p){this._wasAddedToScene=!1,void 0===p&&(p=new g);for(const b in this)Object.prototype.hasOwnProperty.call(this,b)&&(this[b]=this[b]||("_environmentTexture"===b?null:[]),this._moveAssets(this.yM[b],this[b],p[b]));this.environmentTexture=this.yM.environmentTexture,this.removeAllFromScene()}createRootMesh(){const p=new y.e("assetContainerRootMesh",this.yM);for(const b of this.meshes)b.parent||p.addChild(b);return this.meshes.unshift(p),p}mergeAnimationsTo(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.c.LastCreatedScene,b=arguments.length>1?arguments[1]:void 0,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!p)return t.d.Error("No scene available to merge animations to"),[];const h=M||(b=>{let M=null;const h=b.animations.length?b.animations[0].targetProperty:"",Q=b.name.split(".").join("").split("_primitive")[0];switch(h){case"position":case"rotationQuaternion":M=p.getTransformNodeByName(b.name)||p.getTransformNodeByName(Q);break;case"influence":M=p.getMorphTargetByName(b.name)||p.getMorphTargetByName(Q);break;default:M=p.getNodeByName(b.name)||p.getNodeByName(Q)}return M}),Q=this.getNodes();for(const P of Q){const p=h(P);if(null!==p){for(const b of P.animations){const M=p.animations.filter((p=>p.targetProperty===b.targetProperty));for(const b of M){const M=p.animations.indexOf(b,0);M>-1&&p.animations.splice(M,1)}}p.animations=p.animations.concat(P.animations)}}const mp=[],y=this.animationGroups.slice();for(const P of y){mp.push(P.clone(P.name,h));for(const p of P.animatables)p.stop()}for(const P of b){const b=h(P.target);b&&(p.beginAnimation(b,P.fromFrame,P.toFrame,P.loopAnimation,P.speedRatio,P.onAnimationEnd?P.onAnimationEnd:void 0,void 0,!0,void 0,P.onAnimationLoop?P.onAnimationLoop:void 0),p.stopAnimation(P.target))}return mp}populateRootNodes(){this.rootNodes.length=0;for(const p of this.meshes)p.parent||-1!==this.rootNodes.indexOf(p)||this.rootNodes.push(p);for(const p of this.transformNodes)p.parent||-1!==this.rootNodes.indexOf(p)||this.rootNodes.push(p);for(const p of this.lights)p.parent||-1!==this.rootNodes.indexOf(p)||this.rootNodes.push(p);for(const p of this.cameras)p.parent||-1!==this.rootNodes.indexOf(p)||this.rootNodes.push(p)}addAllAssetsToContainer(p){if(!p)return;const b=[],M=new Set;for(b.push(p);b.length>0;){const p=b.pop();if(p instanceof y.e?(p.Ub&&-1===this.geometries.indexOf(p.Ub)&&this.geometries.push(p.Ub),this.meshes.push(p)):p instanceof x.b?this.meshes.push(p):p instanceof P.c?this.transformNodes.push(p):p instanceof S.c?this.lights.push(p):p instanceof X.e&&this.cameras.push(p),p instanceof w.c){if(p.material&&-1===this.materials.indexOf(p.material)){this.materials.push(p.material);for(const b of p.material.getActiveTextures())-1===this.textures.indexOf(b)&&this.textures.push(b)}p.skeleton&&-1===this.skeletons.indexOf(p.skeleton)&&this.skeletons.push(p.skeleton),p.morphTargetManager&&-1===this.morphTargetManagers.indexOf(p.morphTargetManager)&&this.morphTargetManagers.push(p.morphTargetManager)}for(const h of p.getChildren())M.has(h)||b.push(h);M.add(p)}this.populateRootNodes()}_getByTags(p,b,M){if(void 0===b)return p;const h=[];for(const Q in p){const mp=p[Q];c.b&&c.b.MatchesQuery(mp,b)&&(!M||M(mp))&&h.push(mp)}return h}getMeshesByTags(p,b){return this._getByTags(this.meshes,p,b)}getCamerasByTags(p,b){return this._getByTags(this.cameras,p,b)}getLightsByTags(p,b){return this._getByTags(this.lights,p,b)}getMaterialsByTags(p,b){return this._getByTags(this.materials,p,b).concat(this._getByTags(this.multiMaterials,p,b))}getTransformNodesByTags(p,b){return this._getByTags(this.transformNodes,p,b)}}var a=M(12671);class o{constructor(p){this.byteOffset=0,this.buffer=p}async loadAsync(p){const b=await this.buffer.readAsync(this.byteOffset,p);this._dataView=new DataView(b.buffer,b.byteOffset,b.byteLength),this._dataByteOffset=0}readUint32(){const p=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,p}readUint8Array(p){const b=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,p);return this._dataByteOffset+=p,this.byteOffset+=p,b}readString(p){return(0,a.j)(this.readUint8Array(p))}skipBytes(p){this._dataByteOffset+=p,this.byteOffset+=p}}var l=M(14244);const L="Z2xURg",u={name:"fb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:p=>-1!==p.indexOf("asset")&&-1!==p.indexOf("version")||p.startsWith("data:base64,"+L)||p.startsWith("data:;base64,"+L)||p.startsWith("data:application/octet-stream;base64,"+L)||p.startsWith("data:model/gltf-binary;base64,"+L)};var e,d,I,G=M(12655),v=M(12664);function Z(p,b,M){try{return Promise.resolve(new Uint8Array(p,b,M))}catch(h){return Promise.reject(h)}}!function(p){p[p.AUTO=0]="AUTO",p[p.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(e||(e={})),function(p){p[p.NONE=0]="NONE",p[p.FIRST=1]="FIRST",p[p.ALL=2]="ALL"}(d||(d={})),function(p){p[p.LOADING=0]="LOADING",p[p.READY=1]="READY",p[p.COMPLETE=2]="COMPLETE"}(I||(I={}));class U{constructor(){this.coordinateSystemMode=e.AUTO,this.animationStartMode=d.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=p=>Promise.resolve(p),this.extensionOptions={}}mp(p){p&&(this.onParsed=p.onParsed,this.coordinateSystemMode=p.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=p.animationStartMode??this.animationStartMode,this.loadNodeAnimations=p.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=p.loadSkins??this.loadSkins,this.loadMorphTargets=p.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=p.compileMaterials??this.compileMaterials,this.useClipPlane=p.useClipPlane??this.useClipPlane,this.compileShadowGenerators=p.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=p.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=p.useRangeRequests??this.useRangeRequests,this.createInstances=p.createInstances??this.createInstances,this.alwaysComputeBoundingBox=p.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=p.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=p.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=p.skipMaterials??this.skipMaterials,this.useSRGBBuffers=p.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=p.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=p.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=p.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=p.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=p.customRootNode,this.onMeshLoaded=p.onMeshLoaded,this.onSkinLoaded=p.onSkinLoaded,this.onTextureLoaded=p.onTextureLoaded,this.onMaterialLoaded=p.onMaterialLoaded,this.onCameraLoaded=p.onCameraLoaded,this.extensionOptions=p.extensionOptions??this.extensionOptions)}}class q extends U{constructor(p){super(),this.onParsedObservable=new h.d,this.onMeshLoadedObservable=new h.d,this.onSkinLoadedObservable=new h.d,this.onTextureLoadedObservable=new h.d,this.onMaterialLoadedObservable=new h.d,this.onCameraLoadedObservable=new h.d,this.onCompleteObservable=new h.d,this.onErrorObservable=new h.d,this.Xb=new h.d,this.onExtensionLoadedObservable=new h.d,this.validate=!1,this.onValidatedObservable=new h.d,this._loader=null,this._state=null,this._requests=new Array,this.name=u.name,this.extensions=u.extensions,this.onLoaderStateChangedObservable=new h.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.mp(p)}set onParsed(p){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),p&&(this._onParsedObserver=this.onParsedObservable.add(p))}set onMeshLoaded(p){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),p&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(p))}set onSkinLoaded(p){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),p&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((b=>p(b.node,b.skinnedNode))))}set onTextureLoaded(p){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),p&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(p))}set onMaterialLoaded(p){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),p&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(p))}set onCameraLoaded(p){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),p&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(p))}set onComplete(p){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(p)}set onError(p){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(p)}set onDispose(p){this._onDisposeObserver&&this.Xb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xb.add(p)}set onExtensionLoaded(p){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(p)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(p){this._loggingEnabled!==p&&(this._loggingEnabled=p,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(p){this._capturePerformanceCounters!==p&&(this._capturePerformanceCounters=p,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(p){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(p)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const p of this._requests)p.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=p=>Promise.resolve(p),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Xb.notifyObservers(void 0),this.Xb.clear()}loadFile(p,b,M,mp,y,P,w,z){if(ArrayBuffer.isView(b))return this._loadBinary(p,b,M,mp,w,z),null;this._progressCallback=y;const x=b.name||Q.Tools.GetFilename(b);if(P){if(this.useRangeRequests){this.validate&&t.d.Warn("glTF validation is not supported when range requests are enabled");const M={abort:()=>{},onCompleteObservable:new h.d},Q={readAsync:(M,h)=>new Promise(((Q,mp)=>{this._loadFile(p,b,(p=>{Q(new Uint8Array(p))}),!0,(p=>{mp(p)}),(p=>{p.setRequestHeader("Range",`bytes=${M}-${M+h-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new o(Q)).then((p=>{M.onCompleteObservable.notifyObservers(M),mp(p)}),w?p=>w(void 0,p):void 0),M}return this._loadFile(p,b,(b=>{this._validate(p,new Uint8Array(b,0,b.byteLength),M,x),this._unpackBinaryAsync(new o({readAsync:(p,M)=>Z(b,p,M),byteLength:b.byteLength})).then((p=>{mp(p)}),w?p=>w(void 0,p):void 0)}),!0,w)}return this._loadFile(p,b,(b=>{try{this._validate(p,b,M,x),mp({json:this._parseJson(b)})}catch{w&&w()}}),!1,w)}_loadBinary(p,b,M,h,Q,mp){this._validate(p,new Uint8Array(b.buffer,b.byteOffset,b.byteLength),M,mp),this._unpackBinaryAsync(new o({readAsync:(p,M)=>function(p,b,M){try{if(b<0||b>=p.byteLength)throw new RangeError("Offset is out of range.");if(b+M>p.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(p.buffer,p.byteOffset+b,M))}catch(h){return Promise.reject(h)}}(b,p,M),byteLength:b.byteLength})).then((p=>{h(p)}),Q?p=>Q(void 0,p):void 0)}importMeshAsync(p,b,M,h,Q,mp){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(M),this.onParsedObservable.clear(),this._log(`Loading ${mp||""}`),this._loader=this._getLoader(M),this._loader.importMeshAsync(p,b,null,M,h,Q,mp))))}loadAsync(p,b,M,h,Q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${Q||""}`),this._loader=this._getLoader(b),this._loader.loadAsync(p,b,M,h,Q))))}loadAssetContainerAsync(p,b,M,h,Q){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${Q||""}`),this._loader=this._getLoader(b);const mp=new Y(p),y=[];this.onMaterialLoadedObservable.add((p=>{y.push(p)}));const P=[];this.onTextureLoadedObservable.add((p=>{P.push(p)}));const w=[];this.onCameraLoadedObservable.add((p=>{w.push(p)}));const t=[];return this.onMeshLoadedObservable.add((p=>{p.morphTargetManager&&t.push(p.morphTargetManager)})),this._loader.importMeshAsync(null,p,mp,b,M,h,Q).then((p=>(Array.prototype.push.apply(mp.geometries,p.geometries),Array.prototype.push.apply(mp.meshes,p.meshes),Array.prototype.push.apply(mp.LX,p.LX),Array.prototype.push.apply(mp.skeletons,p.skeletons),Array.prototype.push.apply(mp.animationGroups,p.animationGroups),Array.prototype.push.apply(mp.materials,y),Array.prototype.push.apply(mp.textures,P),Array.prototype.push.apply(mp.lights,p.lights),Array.prototype.push.apply(mp.transformNodes,p.transformNodes),Array.prototype.push.apply(mp.cameras,w),Array.prototype.push.apply(mp.morphTargetManagers,t),mp)))}))}canDirectLoad(p){return u.canDirectLoad(p)}directLoad(p,b){if(b.startsWith("base64,"+L)||b.startsWith(";base64,"+L)||b.startsWith("application/octet-stream;base64,"+L)||b.startsWith("model/gltf-binary;base64,"+L)){const M=(0,G.e)(b);return this._validate(p,new Uint8Array(M,0,M.byteLength)),this._unpackBinaryAsync(new o({readAsync:(p,b)=>Z(M,p,b),byteLength:M.byteLength}))}return this._validate(p,b),Promise.resolve({json:this._parseJson(b)})}createPlugin(p){return new q(p[u.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((p,b)=>{this.onCompleteObservable.addOnce((()=>{p()})),this.onErrorObservable.addOnce((p=>{b(p)}))}))}_setState(p){this._state!==p&&(this._state=p,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(I[this._state]))}_loadFile(p,b,M,h,Q,mp){const y=p._loadFile(b,M,(p=>{this._onProgress(p,y)}),!0,h,Q,mp);return y.onCompleteObservable.add((()=>{y._lengthComputable=!0,y._total=y._loaded})),this._requests.push(y),y}_onProgress(p,b){if(!this._progressCallback)return;b._lengthComputable=p.lengthComputable,b._loaded=p.loaded,b._total=p.total;let M=!0,h=0,Q=0;for(const mp of this._requests){if(void 0===mp._lengthComputable||void 0===mp._loaded||void 0===mp._total)return;M=M&&mp._lengthComputable,h+=mp._loaded,Q+=mp._total}this._progressCallback({lengthComputable:M,loaded:h,total:M?Q:0})}_validate(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),l.e.ValidateAsync(b,M,h,(b=>this.preprocessUrlAsync(M+b).then((b=>p._loadFileAsync(b,void 0,!0,!0).then((p=>new Uint8Array(p,0,p.byteLength))))))).then((p=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(p),this.onValidatedObservable.clear()}),(p=>{this._endPerformanceCounter("Validate JSON"),Q.Tools.Warn(`Failed to validate: ${p.message}`),this.onValidatedObservable.clear()})))}_getLoader(p){const b=p.json.asset||{};this._log(`Asset version: ${b.version}`),b.minVersion&&this._log(`Asset minimum version: ${b.minVersion}`),b.generator&&this._log(`Asset generator: ${b.generator}`);const M=q._parseVersion(b.version);if(!M)throw new Error("Invalid version: "+b.version);if(void 0!==b.minVersion){const p=q._parseVersion(b.minVersion);if(!p)throw new Error("Invalid minimum version: "+b.minVersion);if(q._compareVersion(p,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+b.minVersion)}const h={1:q._CreateGLTF1Loader,2:q._CreateGLTF2Loader}[M.major];if(!h)throw new Error("Unsupported version: "+b.version);return h(this)}_parseJson(p){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${p.length}`);const b=JSON.parse(p);return this._endPerformanceCounter("Parse JSON"),b}_unpackBinaryAsync(p){return this._startPerformanceCounter("Unpack Binary"),p.loadAsync(20).then((()=>{const b=p.readUint32();if(1179937895!==b)throw new v.k("Unexpected magic: "+b,v.i.GLTFLoaderUnexpectedMagicError);const M=p.readUint32();this.loggingEnabled&&this._log(`Binary version: ${M}`);const h=p.readUint32();let Q;switch(this.useRangeRequests||h===p.buffer.byteLength||t.d.Warn(`Length in header does not match actual data length: ${h} != ${p.buffer.byteLength}`),M){case 1:Q=this._unpackBinaryV1Async(p,h);break;case 2:Q=this._unpackBinaryV2Async(p,h);break;default:throw new Error("Unsupported version: "+M)}return this._endPerformanceCounter("Unpack Binary"),Q}))}_unpackBinaryV1Async(p,b){const M=p.readUint32(),h=p.readUint32();if(0!==h)throw new Error(`Unexpected content format: ${h}`);const Q=b-p.byteOffset,mp={json:this._parseJson(p.readString(M)),bin:null};if(0!==Q){const b=p.byteOffset;mp.bin={readAsync:(M,h)=>p.buffer.readAsync(b+M,h),byteLength:Q}}return Promise.resolve(mp)}_unpackBinaryV2Async(p,b){const M=1313821514,h=5130562,Q=p.readUint32();if(p.readUint32()!==M)throw new Error("First chunk format is not JSON");return p.byteOffset+Q===b?p.loadAsync(Q).then((()=>({json:this._parseJson(p.readString(Q)),bin:null}))):p.loadAsync(Q+8).then((()=>{const mp={json:this._parseJson(p.readString(Q)),bin:null},y=()=>{const Q=p.readUint32();switch(p.readUint32()){case M:throw new Error("Unexpected JSON chunk");case h:{const b=p.byteOffset;mp.bin={readAsync:(M,h)=>p.buffer.readAsync(b+M,h),byteLength:Q},p.skipBytes(Q);break}default:p.skipBytes(Q)}return p.byteOffset!==b?p.loadAsync(8).then(y):Promise.resolve(mp)};return y()}))}static _parseVersion(p){if("1.0"===p||"1.0.1"===p)return{major:1,minor:0};const b=(p+"").match(/^(\d+)\.(\d+)/);return b?{major:parseInt(b[1]),minor:parseInt(b[2])}:null}static _compareVersion(p,b){return p.major>b.major?1:p.major<b.major?-1:p.minor>b.minor?1:p.minor<b.minor?-1:0}_logOpen(p){this._log(p),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(p){const b=q._logSpaces.substring(0,2*this._logIndentLevel);t.d.Log(`${b}${p}`)}_logDisabled(p){}_startPerformanceCounterEnabled(p){Q.Tools.StartPerformanceCounter(p)}_startPerformanceCounterDisabled(p){}_endPerformanceCounterEnabled(p){Q.Tools.EndPerformanceCounter(p)}_endPerformanceCounterDisabled(p){}}q.IncrementalLoading=!0,q.HomogeneousCoordinates=!1,q._logSpaces="                                ",(0,mp.c)(new q)},14244:(p,b,M)=>{"use strict";M.d(b,{e:()=>y});var h=M(12608);function Q(p,b,M,h){const Q={externalResourceFunction:h};return M&&(Q.uri="file:"===b?M:b+M),ArrayBuffer.isView(p)?GLTFValidator.validateBytes(p,Q):GLTFValidator.validateString(p,Q)}function mp(){const p=[];onmessage=b=>{const M=b.data;switch(M.id){case"init":importScripts(M.url);break;case"validate":Q(M.data,M.rootUrl,M.fileName,(b=>new Promise(((M,h)=>{const Q=p.length;p.push({resolve:M,reject:h}),postMessage({id:"getExternalResource",index:Q,uri:b})})))).then((p=>{postMessage({id:"validate.resolve",value:p})}),(p=>{postMessage({id:"validate.reject",reason:p})}));break;case"getExternalResource.resolve":p[M.index].resolve(M.value);break;case"getExternalResource.reject":p[M.index].reject(M.reason)}}}class y{static ValidateAsync(p,b,M,y){return"function"===typeof Worker?new Promise(((P,w)=>{const t=`${Q}(${mp})()`,z=URL.createObjectURL(new Blob([t],{type:"application/javascript"})),x=new Worker(z),S=p=>{x.removeEventListener("error",S),x.removeEventListener("message",X),w(p)},X=p=>{const b=p.data;switch(b.id){case"getExternalResource":y(b.uri).then((p=>{x.postMessage({id:"getExternalResource.resolve",index:b.index,value:p},[p.buffer])}),(p=>{x.postMessage({id:"getExternalResource.reject",index:b.index,reason:p})}));break;case"validate.resolve":x.removeEventListener("error",S),x.removeEventListener("message",X),P(b.value),x.terminate();break;case"validate.reject":x.removeEventListener("error",S),x.removeEventListener("message",X),w(b.reason),x.terminate()}};if(x.addEventListener("error",S),x.addEventListener("message",X),x.postMessage({id:"init",url:h.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(p)){const h=p.slice();x.postMessage({id:"validate",data:h,rootUrl:b,fileName:M},[h.buffer])}else x.postMessage({id:"validate",data:p,rootUrl:b,fileName:M})})):(this._LoadScriptPromise||(this._LoadScriptPromise=h.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>Q(p,b,M,y))))}}y.Configuration={url:`${h.Tools._DefaultCdnUrl}/gltf_validator.js`}},14957:(p,b,M)=>{"use strict";M.d(b,{e:()=>u});var h=M(12757),Q=M(12764),mp=M(12812),y=M(12777),P=M(13170),w=M(13094),t=M(12847),z=M(13013),x=M(12730),S=M(12695);M(14020),M(13923),M(13942),M(13930),M(13945),M(13950),M(13954);const X="imageProcessingCompatibility",c="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";S.d.IncludesShadersStore[X]||(S.d.IncludesShadersStore[X]=c);const J="skyPixelShader",g="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";S.d.ShadersStore[J]||(S.d.ShadersStore[J]=g);M(14024),M(13962),M(13970),M(13979),M(13976);const f="skyVertexShader",Y="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";S.d.ShadersStore[f]||(S.d.ShadersStore[f]=Y);var a=M(13087),o=M(13147),l=M(13143);class L extends P.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class u extends w.c{constructor(p,b){super(p,b),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new y.QM(0,100,0),this.useSunPosition=!1,this.cameraOffset=y.QM.Zero(),this.up=y.QM.Up(),this.dithering=!1,this._cameraPosition=y.QM.Zero(),this._skyOrientation=new y.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(p,b){const M=b._drawWrapper;if(this.isFrozen&&M.effect&&M._wasPreviouslyReady)return!0;b.materialDefines||(b.materialDefines=new L);const h=b.materialDefines,Q=this.upp();if(this._isReadyForSubMesh(b))return!0;if((0,l.W)(p,Q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,h),(0,l.O)(p,h,!0,!1),h.IMAGEPROCESSINGPOSTPROCESS!==Q.imageProcessingConfiguration.applyByPostProcess&&h.markAsMiscDirty(),h.DITHER!==this.dithering&&h.markAsMiscDirty(),h.isDirty){h.markAsProcessed(),Q.resetCachedMaterial();const p=new a.d;h.FOG&&p.addFallback(1,"FOG"),h.IMAGEPROCESSINGPOSTPROCESS=Q.imageProcessingConfiguration.applyByPostProcess,h.DITHER=this.dithering;const M=[t.f.PositionKind];h.VERTEXCOLOR&&M.push(t.f.ColorKind);const mp="sky",y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,o.e)(y);const P=h.toString();b.setEffect(Q.getEngine().createEffect(mp,M,y,[],P,p,this.onCompiled,this.onError),h,this._materialContext)}return!(!b.effect||!b.effect.isReady())&&(h._renderId=Q.getRenderId(),M._wasPreviouslyReady=!0,!0)}bindForSubMesh(p,b,M){const h=this.upp(),Q=M.materialDefines;if(!Q)return;const mp=M.effect;if(!mp)return;this._activeEffect=mp,this.bindOnlyWorldMatrix(p),this._activeEffect.setMatrix("viewProjection",h.getTransformMatrix()),this._mustRebind(h,mp,M)&&((0,o.i)(mp,this,h),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,l.n)(Q,mp,h)),h.fogEnabled&&b.applyFog&&h.fogMode!==z.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",h.getViewMatrix()),(0,l.g)(h,b,this._activeEffect);const P=h.activeCamera;if(P){const p=P.getWorldMatrix();this._cameraPosition.x=p.m[12],this._cameraPosition.y=p.m[13],this._cameraPosition.z=p.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const p=Math.PI*(this.inclination-.5),b=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(b)*Math.cos(p),this.sunPosition.y=this.distance*Math.sin(-p),this.sunPosition.z=this.distance*Math.sin(b)*Math.cos(p),y.Quaternion.FromUnitVectorsToRef(y.QM.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(b,this._activeEffect,M)}getAnimatables(){return[]}dispose(p){super.dispose(p)}clone(p){return mp.e.Clone((()=>new u(p,this.upp())),this)}serialize(){const p=super.serialize();return p.customType="BABYLON.SkyMaterial",p}getClassName(){return"SkyMaterial"}static Parse(p,b,M){return mp.e.Parse((()=>new u(p.name,b)),p,b,M)}}(0,h.e)([(0,Q.N)()],u.prototype,"luminance",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"turbidity",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"rayleigh",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"mieCoefficient",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"mieDirectionalG",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"distance",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"inclination",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"azimuth",void 0),(0,h.e)([(0,Q.J)()],u.prototype,"sunPosition",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"useSunPosition",void 0),(0,h.e)([(0,Q.J)()],u.prototype,"cameraOffset",void 0),(0,h.e)([(0,Q.J)()],u.prototype,"up",void 0),(0,h.e)([(0,Q.N)()],u.prototype,"dithering",void 0),(0,x.c)("BABYLON.SkyMaterial",u)},13454:(p,b,M)=>{"use strict";function h(p,b){b.headers=p.headers||{},b.statusMessage=p.statusText,b.statusCode=p.status,b.data=p.response}function Q(p,b,M){return new Promise((function(Q,mp){M=M||{};var y,P,w,t=new XMLHttpRequest,z=M.body,x=M.headers||{};for(y in M.timeout&&(t.timeout=M.timeout),t.ontimeout=t.onerror=function(p){p.timeout="timeout"==p.type,mp(p)},t.open(p,b.href||b),t.onload=function(){for(w=t.getAllResponseHeaders().trim().split(/[\r\n]+/),h(t,t);P=w.shift();)P=P.split(": "),t.headers[P.shift().toLowerCase()]=P.join(": ");if((P=t.headers["content-type"])&&~P.indexOf("application/json"))try{t.data=JSON.parse(t.data,M.reviver)}catch(p){return h(t,p),mp(p)}(t.status>=400?mp:Q)(t)},typeof FormData<"u"&&z instanceof FormData||z&&"object"==typeof z&&(x["content-type"]="application/json",z=JSON.stringify(z)),t.withCredentials=!!M.withCredentials,x)t.setRequestHeader(y,x[y]);t.send(z)}))}M.r(b),M.d(b,{del:()=>w,get:()=>mp,patch:()=>P,post:()=>y,put:()=>t,send:()=>Q});var mp=Q.bind(Q,"GET"),y=Q.bind(Q,"POST"),P=Q.bind(Q,"PATCH"),w=Q.bind(Q,"DELETE"),t=Q.bind(Q,"PUT")},15053:(p,b,M)=>{"use strict";M.d(b,{e:()=>x});const h=.5*(Math.sqrt(3)-1),Q=(3-Math.sqrt(3))/6,mp=1/3,y=1/6,P=(Math.sqrt(5)-1)/4,w=(5-Math.sqrt(5))/20,t=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),z=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const x=class{constructor(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const b="function"==typeof p?p:function(p){let b=0,M=0,h=0,Q=1;const mp=function(){let p=4022871197;return function(b){b=b.toString();for(let M=0;M<b.length;M++){p+=b.charCodeAt(M);let h=.02519603282416938*p;p=h>>>0,h-=p,h*=p,p=h>>>0,h-=p,p+=4294967296*h}return 2.3283064365386963e-10*(p>>>0)}}();b=mp(" "),M=mp(" "),h=mp(" "),b-=mp(p),b<0&&(b+=1);M-=mp(p),M<0&&(M+=1);h-=mp(p),h<0&&(h+=1);return function(){const p=2091639*b+2.3283064365386963e-10*Q;return b=M,M=h,h=p-(Q=0|p)}}(p);this.p=function(p){const b=new Uint8Array(256);for(let M=0;M<256;M++)b[M]=M;for(let M=0;M<255;M++){const h=M+~~(p()*(256-M)),Q=b[M];b[M]=b[h],b[h]=Q}return b}(b),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let M=0;M<512;M++)this.perm[M]=this.p[255&M],this.permMod12[M]=this.perm[M]%12}noise2D(p,b){const M=this.permMod12,mp=this.perm;let y=0,P=0,w=0;const z=(p+b)*h,x=Math.floor(p+z),S=Math.floor(b+z),X=(x+S)*Q,c=p-(x-X),J=b-(S-X);let g,f;c>J?(g=1,f=0):(g=0,f=1);const Y=c-g+Q,a=J-f+Q,o=c-1+2*Q,l=J-1+2*Q,L=255&x,u=255&S;let e=.5-c*c-J*J;if(e>=0){const p=3*M[L+mp[u]];e*=e,y=e*e*(t[p]*c+t[p+1]*J)}let d=.5-Y*Y-a*a;if(d>=0){const p=3*M[L+g+mp[u+f]];d*=d,P=d*d*(t[p]*Y+t[p+1]*a)}let I=.5-o*o-l*l;if(I>=0){const p=3*M[L+1+mp[u+1]];I*=I,w=I*I*(t[p]*o+t[p+1]*l)}return 70*(y+P+w)}noise3D(p,b,M){const h=this.permMod12,Q=this.perm;let P,w,z,x;const S=(p+b+M)*mp,X=Math.floor(p+S),c=Math.floor(b+S),J=Math.floor(M+S),g=(X+c+J)*y,f=p-(X-g),Y=b-(c-g),a=M-(J-g);let o,l,L,u,e,d;f>=Y?Y>=a?(o=1,l=0,L=0,u=1,e=1,d=0):f>=a?(o=1,l=0,L=0,u=1,e=0,d=1):(o=0,l=0,L=1,u=1,e=0,d=1):Y<a?(o=0,l=0,L=1,u=0,e=1,d=1):f<a?(o=0,l=1,L=0,u=0,e=1,d=1):(o=0,l=1,L=0,u=1,e=1,d=0);const I=f-o+y,G=Y-l+y,v=a-L+y,Z=f-u+2*y,U=Y-e+2*y,q=a-d+2*y,B=f-1+.5,s=Y-1+.5,i=a-1+.5,T=255&X,W=255&c,H=255&J;let E=.6-f*f-Y*Y-a*a;if(E<0)P=0;else{const p=3*h[T+Q[W+Q[H]]];E*=E,P=E*E*(t[p]*f+t[p+1]*Y+t[p+2]*a)}let j=.6-I*I-G*G-v*v;if(j<0)w=0;else{const p=3*h[T+o+Q[W+l+Q[H+L]]];j*=j,w=j*j*(t[p]*I+t[p+1]*G+t[p+2]*v)}let V=.6-Z*Z-U*U-q*q;if(V<0)z=0;else{const p=3*h[T+u+Q[W+e+Q[H+d]]];V*=V,z=V*V*(t[p]*Z+t[p+1]*U+t[p+2]*q)}let D=.6-B*B-s*s-i*i;if(D<0)x=0;else{const p=3*h[T+1+Q[W+1+Q[H+1]]];D*=D,x=D*D*(t[p]*B+t[p+1]*s+t[p+2]*i)}return 32*(P+w+z+x)}noise4D(p,b,M,h){const Q=this.perm;let mp,y,t,x,S;const X=(p+b+M+h)*P,c=Math.floor(p+X),J=Math.floor(b+X),g=Math.floor(M+X),f=Math.floor(h+X),Y=(c+J+g+f)*w,a=p-(c-Y),o=b-(J-Y),l=M-(g-Y),L=h-(f-Y);let u=0,e=0,d=0,I=0;a>o?u++:e++,a>l?u++:d++,a>L?u++:I++,o>l?e++:d++,o>L?e++:I++,l>L?d++:I++;const G=u>=3?1:0,v=e>=3?1:0,Z=d>=3?1:0,U=I>=3?1:0,q=u>=2?1:0,B=e>=2?1:0,s=d>=2?1:0,i=I>=2?1:0,T=u>=1?1:0,W=e>=1?1:0,H=d>=1?1:0,E=I>=1?1:0,j=a-G+w,V=o-v+w,D=l-Z+w,N=L-U+w,O=a-q+2*w,R=o-B+2*w,K=l-s+2*w,r=L-i+2*w,k=a-T+3*w,A=o-W+3*w,n=l-H+3*w,C=L-E+3*w,F=a-1+4*w,pp=o-1+4*w,bp=l-1+4*w,Mp=L-1+4*w,hp=255&c,Qp=255&J,mb=255&g,yp=255&f;let Pp=.6-a*a-o*o-l*l-L*L;if(Pp<0)mp=0;else{const p=Q[hp+Q[Qp+Q[mb+Q[yp]]]]%32*4;Pp*=Pp,mp=Pp*Pp*(z[p]*a+z[p+1]*o+z[p+2]*l+z[p+3]*L)}let wp=.6-j*j-V*V-D*D-N*N;if(wp<0)y=0;else{const p=Q[hp+G+Q[Qp+v+Q[mb+Z+Q[yp+U]]]]%32*4;wp*=wp,y=wp*wp*(z[p]*j+z[p+1]*V+z[p+2]*D+z[p+3]*N)}let tp=.6-O*O-R*R-K*K-r*r;if(tp<0)t=0;else{const p=Q[hp+q+Q[Qp+B+Q[mb+s+Q[yp+i]]]]%32*4;tp*=tp,t=tp*tp*(z[p]*O+z[p+1]*R+z[p+2]*K+z[p+3]*r)}let zp=.6-k*k-A*A-n*n-C*C;if(zp<0)x=0;else{const p=Q[hp+T+Q[Qp+W+Q[mb+H+Q[yp+E]]]]%32*4;zp*=zp,x=zp*zp*(z[p]*k+z[p+1]*A+z[p+2]*n+z[p+3]*C)}let xp=.6-F*F-pp*pp-bp*bp-Mp*Mp;if(xp<0)S=0;else{const p=Q[hp+1+Q[Qp+1+Q[mb+1+Q[yp+1]]]]%32*4;xp*=xp,S=xp*xp*(z[p]*F+z[p+1]*pp+z[p+2]*bp+z[p+3]*Mp)}return 27*(mp+y+t+x+S)}}}}]);