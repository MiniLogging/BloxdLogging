/*! For license information please see 7t1n9t.32.645f1506.chunk.js.LICENSE.txt */
(self.bbj0x35f849=self.bbj0x35f849||[]).push([[32],{13086:(N,q,C)=>{"use strict";var d=C(13093),U=C(13098),W=C(13107);C.g.__TYPEDARRAY_POOL||(C.g.__TYPEDARRAY_POOL={UINT8:U([32,0]),UINT16:U([32,0]),UINT32:U([32,0]),INT8:U([32,0]),INT16:U([32,0]),INT32:U([32,0]),FLOAT:U([32,0]),DOUBLE:U([32,0]),DATA:U([32,0]),UINT8C:U([32,0]),BUFFER:U([32,0])});var a="undefined"!==typeof Uint8ClampedArray,F=C.g.__TYPEDARRAY_POOL;F.UINT8C||(F.UINT8C=U([32,0])),F.BUFFER||(F.BUFFER=U([32,0]));var w=F.DATA,A=F.BUFFER;function n(N){if(N){var q=N.length||N.byteLength,C=d.log2(q);w[C].push(N)}}function t(N){N=d.nextPow2(N);var q=d.log2(N),C=w[q];return C.length>0?C.pop():new ArrayBuffer(N)}function V(N){return new Uint8Array(t(N),0,N)}function Z(N){return new Uint16Array(t(2*N),0,N)}function J(N){return new Uint32Array(t(4*N),0,N)}function Q(N){return new Int8Array(t(N),0,N)}function v(N){return new Int16Array(t(2*N),0,N)}function r(N){return new Int32Array(t(4*N),0,N)}function O(N){return new Float32Array(t(4*N),0,N)}function K(N){return new Float64Array(t(8*N),0,N)}function i(N){return a?new Uint8ClampedArray(t(N),0,N):V(N)}function I(N){return new DataView(t(N),0,N)}q.free=function(N){if(W(N))A[d.log2(N.length)].push(N);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(N)&&(N=N.buffer),!N)return;var q=N.length||N.byteLength,C=0|d.log2(q);w[C].push(N)}},q.freeUint8=q.freeUint16=q.freeUint32=q.freeInt8=q.freeInt16=q.freeInt32=q.freeFloat32=q.freeFloat=q.freeFloat64=q.freeDouble=q.freeUint8Clamped=q.freeDataView=function(N){n(N.buffer)},q.freeArrayBuffer=n,q.freeBuffer=function(N){A[d.log2(N.length)].push(N)},q.malloc=function(N,q){if(void 0===q||"arraybuffer"===q)return t(N);switch(q){case"uint8":return V(N);case"uint16":return Z(N);case"uint32":return J(N);case"int8":return Q(N);case"int16":return v(N);case"int32":return r(N);case"float":case"float32":return O(N);case"double":case"float64":return K(N);case"uint8_clamped":return i(N);case"buffer":throw"Buffer not supported";case"data":case"dataview":return I(N);default:return null}return null},q.mallocArrayBuffer=t,q.mallocUint8=V,q.mallocUint16=Z,q.mallocUint32=J,q.mallocInt8=Q,q.mallocInt16=v,q.mallocInt32=r,q.mallocFloat32=q.mallocFloat=O,q.mallocFloat64=q.mallocDouble=K,q.mallocUint8Clamped=i,q.mallocDataView=I,q.clearCache=function(){for(var N=0;N<32;++N)F.UINT8[N].length=0,F.UINT16[N].length=0,F.UINT32[N].length=0,F.INT8[N].length=0,F.INT16[N].length=0,F.INT32[N].length=0,F.FLOAT[N].length=0,F.DOUBLE[N].length=0,F.UINT8C[N].length=0,w[N].length=0,A[N].length=0}},13191:(N,q,C)=>{N.exports=U;var d=C(11942);function U(N,q){if(!(this instanceof U))return new U(N,q);var C=d.create();d.add(C,N,q),this.base=d.min(d.create(),N,C),this.GA=d.clone(q),this.max=d.max(d.create(),N,C),this.mag=d.length(this.GA)}var W=U.prototype;W.width=function(){return this.GA[0]},W.height=function(){return this.GA[1]},W.depth=function(){return this.GA[2]},W.x0=function(){return this.base[0]},W.y0=function(){return this.base[1]},W.z0=function(){return this.base[2]},W.x1=function(){return this.max[0]},W.y1=function(){return this.max[1]},W.z1=function(){return this.max[2]},W.translate=function(N){return d.add(this.max,this.max,N),d.add(this.base,this.base,N),this},W.setPosition=function(N){return d.add(this.max,N,this.GA),d.k(this.base,N),this},W.expand=function(N){var q=d.create(),C=d.create();return d.max(q,N.max,this.max),d.min(C,N.base,this.base),d.Qq(q,q,C),new U(C,q)},W.intersects=function(N){return!(N.base[0]>this.max[0])&&(!(N.base[1]>this.max[1])&&(!(N.base[2]>this.max[2])&&(!(N.max[0]<this.base[0])&&(!(N.max[1]<this.base[1])&&!(N.max[2]<this.base[2])))))},W.touches=function(N){var q=this.union(N);return null!==q&&(0==q.width()||0==q.height()||0==q.depth())},W.union=function(N){if(!this.intersects(N))return null;var q=Math.max(N.base[0],this.base[0]),C=Math.max(N.base[1],this.base[1]),d=Math.max(N.base[2],this.base[2]);return new U([q,C,d],[Math.min(N.max[0],this.max[0])-q,Math.min(N.max[1],this.max[1])-C,Math.min(N.max[2],this.max[2])-d])}},13093:(N,q)=>{"use strict";function C(N){var q=32;return(N&=-N)&&q--,65535&N&&(q-=16),16711935&N&&(q-=8),252645135&N&&(q-=4),858993459&N&&(q-=2),1431655765&N&&(q-=1),q}q.INT_BITS=32,q.INT_MAX=2147483647,q.INT_MIN=-1<<31,q.sign=function(N){return(N>0)-(N<0)},q.abs=function(N){var q=N>>31;return(N^q)-q},q.min=function(N,q){return q^(N^q)&-(N<q)},q.max=function(N,q){return N^(N^q)&-(N<q)},q.isPow2=function(N){return!(N&N-1)&&!!N},q.log2=function(N){var q,C;return q=(N>65535)<<4,q|=C=((N>>>=q)>255)<<3,q|=C=((N>>>=C)>15)<<2,(q|=C=((N>>>=C)>3)<<1)|(N>>>=C)>>1},q.log10=function(N){return N>=1e9?9:N>=1e8?8:N>=1e7?7:N>=1e6?6:N>=1e5?5:N>=1e4?4:N>=1e3?3:N>=100?2:N>=10?1:0},q.popCount=function(N){return 16843009*((N=(858993459&(N-=N>>>1&1431655765))+(N>>>2&858993459))+(N>>>4)&252645135)>>>24},q.countTrailingZeros=C,q.nextPow2=function(N){return N+=0===N,--N,N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)+1},q.prevPow2=function(N){return N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)-(N>>>1)},q.parity=function(N){return N^=N>>>16,N^=N>>>8,N^=N>>>4,27030>>>(N&=15)&1};var d=new Array(256);!function(N){for(var q=0;q<256;++q){var C=q,d=q,U=7;for(C>>>=1;C;C>>>=1)d<<=1,d|=1&C,--U;N[q]=d<<U&255}}(d),q.reverse=function(N){return d[255&N]<<24|d[N>>>8&255]<<16|d[N>>>16&255]<<8|d[N>>>24&255]},q.interleave2=function(N,q){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))|(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))<<1},q.deinterleave2=function(N,q){return(N=65535&((N=16711935&((N=252645135&((N=858993459&((N=N>>>q&1431655765)|N>>>1))|N>>>2))|N>>>4))|N>>>16))<<16>>16},q.interleave3=function(N,q,C){return N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2),(N|=(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},q.deinterleave3=function(N,q){return(N=1023&((N=4278190335&((N=251719695&((N=3272356035&((N=N>>>q&1227133513)|N>>>2))|N>>>4))|N>>>8))|N>>>16))<<22>>22},q.nextCombination=function(N){var q=N|N-1;return q+1|(~q&-~q)-1>>>C(N)+1}},13077:(N,q,C)=>{"use strict";N.exports=function(N,q,C){switch(arguments.length){case 1:return d=[],A(U=N,U,n,!0),d;case 2:return"function"===typeof q?A(N,N,q,!0):function(N,q){return d=[],A(N,q,n,!1),d}(N,q);case 3:return A(N,q,C,!1);default:throw new Error("box-intersect: Invalid arguments")}var U};var d,U=C(13086),W=C(13116),a=C(13130);function F(N,q){for(var C=0;C<N;++C)if(!(q[C]<=q[C+N]))return!0;return!1}function w(N,q,C,d){for(var U=0,W=0,a=0,w=N.length;a<w;++a){var A=N[a];if(!F(q,A)){for(var n=0;n<2*q;++n)C[U++]=A[n];d[W++]=a}}return W}function A(N,q,C,d){var F=N.length,A=q.length;if(!(F<=0||A<=0)){var n=N[0].length>>>1;if(!(n<=0)){var t,V=U.mallocDouble(2*n*F),Z=U.mallocInt32(F);if((F=w(N,n,V,Z))>0){if(1===n&&d)W.init(F),t=W.sweepComplete(n,C,0,F,V,Z,0,F,V,Z);else{var J=U.mallocDouble(2*n*A),Q=U.mallocInt32(A);(A=w(q,n,J,Q))>0&&(W.init(F+A),t=1===n?W.sweepBipartite(n,C,0,F,V,Z,0,A,J,Q):a(n,C,d,F,V,Z,A,J,Q),U.free(J),U.free(Q))}U.free(V),U.free(Z)}return t}}}function n(N,q){d.push([N,q])}},13136:(N,q)=>{"use strict";var C="d",d="ax",U="fp",W="es",a="rs",F="re",w="rb",A="bs",n="be",t="bb",V=[C,d,"vv",a,F,w,"ri",A,n,t,"bi"];function Z(N){var q="bruteForce"+(N?"Full":"Partial"),d=[],a=V.slice();N||a.splice(3,0,U);var F=["function "+q+"("+a.join()+"){"];function w(q,U){var a=function(N,q,d){var U="bruteForce"+(N?"Red":"Blue")+(q?"Flip":"")+(d?"Full":""),a=["function ",U,"(",V.join(),"){","var ",W,"=2*",C,";"],F="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",w="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(d?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return N?a.push(F,"Q",":",w):a.push(w,"Q",":",F),d?a.push("if(y1<x0||x1<y0)continue;"):q?a.push("if(y0<=x0||x1<y0)continue;"):a.push("if(y0<x0||x1<y0)continue;"),a.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),q?a.push("yi,xi"):a.push("xi,yi"),a.push(");if(rv!==void 0)return rv;}}}"),{name:U,code:a.join("")}}(q,U,N);d.push(a.code),F.push("return "+a.name+"("+V.join()+");")}F.push("if(re-rs>be-bs){"),N?(w(!0,!1),F.push("}else{"),w(!1,!1)):(F.push("if(fp){"),w(!0,!0),F.push("}else{"),w(!0,!1),F.push("}}else{if(fp){"),w(!1,!0),F.push("}else{"),w(!1,!1),F.push("}")),F.push("}}return "+q);var A=d.join("")+F.join("");return new Function(A)()}q.partial=Z(!1),q.full=Z(!0)},13130:(N,q,C)=>{"use strict";N.exports=function(N,q,C,W,n,s,X,P,M){!function(N,q){var C=8*U.log2(q+1)*(N+1)|0,W=U.nextPow2(i*C);j.length<W&&(d.free(j),j=d.mallocInt32(W));var a=U.nextPow2(I*C);l.length<a&&(d.free(l),l=d.mallocDouble(a))}(N,W+X);var Y,E=0,H=2*N;T(E++,0,0,W,0,X,C?16:0,-1/0,1/0),C||T(E++,0,0,X,0,W,1,-1/0,1/0);for(;E>0;){var e=(E-=1)*i,b=j[e],o=j[e+1],S=j[e+2],D=j[e+3],c=j[e+4],L=j[e+5],G=E*I,h=l[G],B=l[G+1],y=1&L,R=!!(16&L),u=n,m=s,f=P,k=M;if(y&&(u=P,m=M,f=n,k=s),!(2&L&&o>=(S=v(N,b,o,S,u,m,B)))&&!(4&L&&(o=r(N,b,o,S,u,m,h))>=S)){var g=S-o,x=c-D;if(R){if(N*g*(g+x)<Z){if(void 0!==(Y=w.scanComplete(N,b,q,o,S,u,m,D,c,f,k)))return Y;continue}}else{if(N*Math.min(g,x)<t){if(void 0!==(Y=a(N,b,q,y,o,S,u,m,D,c,f,k)))return Y;continue}if(N*g*x<V){if(void 0!==(Y=w.scanBipartite(N,b,q,y,o,S,u,m,D,c,f,k)))return Y;continue}}var NN=J(N,b,o,S,u,m,h,B);if(o<NN)if(N*(NN-o)<t){if(void 0!==(Y=F(N,b+1,q,o,NN,u,m,D,c,f,k)))return Y}else if(b===N-2){if(void 0!==(Y=y?w.sweepBipartite(N,q,D,c,f,k,o,NN,u,m):w.sweepBipartite(N,q,o,NN,u,m,D,c,f,k)))return Y}else T(E++,b+1,o,NN,D,c,y,-1/0,1/0),T(E++,b+1,D,c,o,NN,1^y,-1/0,1/0);if(NN<S){var qN=A(N,b,D,c,f,k),CN=f[H*qN+b],dN=Q(N,b,qN,c,f,k,CN);if(dN<c&&T(E++,b,NN,S,dN,c,(4|y)+(R?16:0),CN,B),D<qN&&T(E++,b,NN,S,D,qN,(2|y)+(R?16:0),h,CN),qN+1===dN){if(void 0!==(Y=R?p(N,b,q,NN,S,u,m,qN,f,k[qN]):z(N,b,q,y,NN,S,u,m,qN,f,k[qN])))return Y}else if(qN<dN){var UN;if(R){if(NN<(UN=O(N,b,NN,S,u,m,CN))){var WN=Q(N,b,NN,UN,u,m,CN);if(b===N-2){if(NN<WN&&void 0!==(Y=w.sweepComplete(N,q,NN,WN,u,m,qN,dN,f,k)))return Y;if(WN<UN&&void 0!==(Y=w.sweepBipartite(N,q,WN,UN,u,m,qN,dN,f,k)))return Y}else NN<WN&&T(E++,b+1,NN,WN,qN,dN,16,-1/0,1/0),WN<UN&&(T(E++,b+1,WN,UN,qN,dN,0,-1/0,1/0),T(E++,b+1,qN,dN,WN,UN,1,-1/0,1/0))}}else NN<(UN=y?K(N,b,NN,S,u,m,CN):O(N,b,NN,S,u,m,CN))&&(b===N-2?Y=y?w.sweepBipartite(N,q,qN,dN,f,k,NN,UN,u,m):w.sweepBipartite(N,q,NN,UN,u,m,qN,dN,f,k):(T(E++,b+1,NN,UN,qN,dN,y,-1/0,1/0),T(E++,b+1,qN,dN,NN,UN,1^y,-1/0,1/0)))}}}}};var d=C(13086),U=C(13093),W=C(13136),a=W.partial,F=W.full,w=C(13116),A=C(13143),n=C(13149),t=128,V=1<<22,Z=1<<22,J=n("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),Q=n("lo===p0",["p0"]),v=n("lo<p0",["p0"]),r=n("hi<=p0",["p0"]),O=n("lo<=p0&&p0<=hi",["p0"]),K=n("lo<p0&&p0<=hi",["p0"]),i=6,I=2,j=d.mallocInt32(1024),l=d.mallocDouble(1024);function T(N,q,C,d,U,W,a,F,w){var A=i*N;j[A]=q,j[A+1]=C,j[A+2]=d,j[A+3]=U,j[A+4]=W,j[A+5]=a;var n=I*N;l[n]=F,l[n+1]=w}function z(N,q,C,d,U,W,a,F,w,A,n){var t=2*N,V=w*t,Z=A[V+q];N:for(var J=U,Q=U*t;J<W;++J,Q+=t){var v=a[Q+q],r=a[Q+q+N];if(!(Z<v||r<Z)&&(!d||Z!==v)){for(var O,K=F[J],i=q+1;i<N;++i){v=a[Q+i],r=a[Q+i+N];var I=A[V+i],j=A[V+i+N];if(r<I||j<v)continue N}if(void 0!==(O=d?C(n,K):C(K,n)))return O}}}function p(N,q,C,d,U,W,a,F,w,A){var n=2*N,t=F*n,V=w[t+q];N:for(var Z=d,J=d*n;Z<U;++Z,J+=n){var Q=a[Z];if(Q!==A){var v=W[J+q],r=W[J+q+N];if(!(V<v||r<V)){for(var O=q+1;O<N;++O){v=W[J+O],r=W[J+O+N];var K=w[t+O],i=w[t+O+N];if(r<K||i<v)continue N}var I=C(Q,A);if(void 0!==I)return I}}}}},13143:(N,q,C)=>{"use strict";N.exports=function(N,q,C,a,F,w){if(a<=C+1)return C;var A=C,n=a,t=a+C>>>1,V=2*N,Z=t,J=F[V*t+q];for(;A<n;){if(n-A<U){W(N,q,A,n,F,w),J=F[V*t+q];break}var Q=n-A,v=Math.random()*Q+A|0,r=F[V*v+q],O=Math.random()*Q+A|0,K=F[V*O+q],i=Math.random()*Q+A|0,I=F[V*i+q];r<=K?I>=K?(Z=O,J=K):r>=I?(Z=v,J=r):(Z=i,J=I):K>=I?(Z=O,J=K):I>=r?(Z=v,J=r):(Z=i,J=I);for(var j=V*(n-1),l=V*Z,T=0;T<V;++T,++j,++l){var z=F[j];F[j]=F[l],F[l]=z}var p=w[n-1];w[n-1]=w[Z],w[Z]=p;for(j=V*(n-1),l=V*(Z=d(N,q,A,n-1,F,w,J)),T=0;T<V;++T,++j,++l){z=F[j];F[j]=F[l],F[l]=z}p=w[n-1];if(w[n-1]=w[Z],w[Z]=p,t<Z){for(n=Z-1;A<n&&F[V*(n-1)+q]===J;)n-=1;n+=1}else{if(!(Z<t))break;for(A=Z+1;A<n&&F[V*A+q]===J;)A+=1}}return d(N,q,C,t,F,w,F[V*t+q])};var d=C(13149)("lo<p0",["p0"]),U=8;function W(N,q,C,d,U,W){for(var a=2*N,F=a*(C+1)+q,w=C+1;w<d;++w,F+=a)for(var A=U[F],n=w,t=a*(w-1);n>C&&U[t+q]>A;--n,t-=a){for(var V=t,Z=t+a,J=0;J<a;++J,++V,++Z){var Q=U[V];U[V]=U[Z],U[Z]=Q}var v=W[n];W[n]=W[n-1],W[n-1]=v}}},13149:N=>{"use strict";N.exports=function(N,C){var d="abcdef".split("").concat(C),U=[];N.indexOf("lo")>=0&&U.push("lo=e[k+n]");N.indexOf("hi")>=0&&U.push("hi=e[k+o]");return d.push(q.replace("_",U.join()).replace("$",N)),Function.apply(void 0,d)};var q="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13124:N=>{"use strict";N.exports=function(N,d){d<=4*q?C(0,d-1,N):A(0,d-1,N)};var q=32;function C(N,q,C){for(var d=2*(N+1),U=N+1;U<=q;++U){for(var W=C[d++],a=C[d++],F=U,w=d-2;F-- >N;){var A=C[w-2],n=C[w-1];if(A<W)break;if(A===W&&n<a)break;C[w]=A,C[w+1]=n,w-=2}C[w]=W,C[w+1]=a}}function d(N,q,C){q*=2;var d=C[N*=2],U=C[N+1];C[N]=C[q],C[N+1]=C[q+1],C[q]=d,C[q+1]=U}function U(N,q,C){q*=2,C[N*=2]=C[q],C[N+1]=C[q+1]}function W(N,q,C,d){q*=2,C*=2;var U=d[N*=2],W=d[N+1];d[N]=d[q],d[N+1]=d[q+1],d[q]=d[C],d[q+1]=d[C+1],d[C]=U,d[C+1]=W}function a(N,q,C,d,U){q*=2,U[N*=2]=U[q],U[q]=C,U[N+1]=U[q+1],U[q+1]=d}function F(N,q,C){q*=2;var d=C[N*=2],U=C[q];return!(d<U)&&(d!==U||C[N+1]>C[q+1])}function w(N,q,C,d){var U=d[N*=2];return U<q||U===q&&d[N+1]<C}function A(N,n,t){var V=(n-N+1)/6|0,Z=N+V,J=n-V,Q=N+n>>1,v=Q-V,r=Q+V,O=Z,K=v,i=Q,I=r,j=J,l=N+1,T=n-1,z=0;F(O,K,t)&&(z=O,O=K,K=z),F(I,j,t)&&(z=I,I=j,j=z),F(O,i,t)&&(z=O,O=i,i=z),F(K,i,t)&&(z=K,K=i,i=z),F(O,I,t)&&(z=O,O=I,I=z),F(i,I,t)&&(z=i,i=I,I=z),F(K,j,t)&&(z=K,K=j,j=z),F(K,i,t)&&(z=K,K=i,i=z),F(I,j,t)&&(z=I,I=j,j=z);for(var p=t[2*K],s=t[2*K+1],X=t[2*I],P=t[2*I+1],M=2*O,Y=2*i,E=2*j,H=2*Z,e=2*Q,b=2*J,o=0;o<2;++o){var S=t[M+o],D=t[Y+o],c=t[E+o];t[H+o]=S,t[e+o]=D,t[b+o]=c}U(v,N,t),U(r,n,t);for(var L=l;L<=T;++L)if(w(L,p,s,t))L!==l&&d(L,l,t),++l;else if(!w(L,X,P,t))for(;;){if(w(T,X,P,t)){w(T,p,s,t)?(W(L,l,T,t),++l,--T):(d(L,T,t),--T);break}if(--T<L)break}a(N,l-1,p,s,t),a(n,T+1,X,P,t),l-2-N<=q?C(N,l-2,t):A(N,l-2,t),n-(T+2)<=q?C(T+2,n,t):A(T+2,n,t),T-l<=q?C(l,T,t):A(l,T,t)}},13116:(N,q,C)=>{"use strict";N.exports={init:function(N){var q=U.nextPow2(N);w.length<q&&(d.free(w),w=d.mallocInt32(q));A.length<q&&(d.free(A),A=d.mallocInt32(q));n.length<q&&(d.free(n),n=d.mallocInt32(q));t.length<q&&(d.free(t),t=d.mallocInt32(q));V.length<q&&(d.free(V),V=d.mallocInt32(q));Z.length<q&&(d.free(Z),Z=d.mallocInt32(q));var C=8*q;J.length<C&&(d.free(J),J=d.mallocDouble(C))},sweepBipartite:function(N,q,C,d,U,F,V,Z,r,O){for(var K=0,i=2*N,I=N-1,j=i-1,l=C;l<d;++l){var T=F[l],z=i*l;J[K++]=U[z+I],J[K++]=-(T+1),J[K++]=U[z+j],J[K++]=T}for(l=V;l<Z;++l){T=O[l]+a;var p=i*l;J[K++]=r[p+I],J[K++]=-T,J[K++]=r[p+j],J[K++]=T}var s=K>>>1;W(J,s);var X=0,P=0;for(l=0;l<s;++l){var M=0|J[2*l+1];if(M>=a)Q(n,t,P--,M=M-a|0);else if(M>=0)Q(w,A,X--,M);else if(M<=-a){M=-M-a|0;for(var Y=0;Y<X;++Y){if(void 0!==(E=q(w[Y],M)))return E}v(n,t,P++,M)}else{M=-M-1|0;for(Y=0;Y<P;++Y){var E;if(void 0!==(E=q(M,n[Y])))return E}v(w,A,X++,M)}}},sweepComplete:function(N,q,C,d,U,a,F,r,O,K){for(var i=0,I=2*N,j=N-1,l=I-1,T=C;T<d;++T){var z=a[T]+1<<1,p=I*T;J[i++]=U[p+j],J[i++]=-z,J[i++]=U[p+l],J[i++]=z}for(T=F;T<r;++T){z=K[T]+1<<1;var s=I*T;J[i++]=O[s+j],J[i++]=1|-z,J[i++]=O[s+l],J[i++]=1|z}var X=i>>>1;W(J,X);var P=0,M=0,Y=0;for(T=0;T<X;++T){var E=0|J[2*T+1],H=1&E;if(T<X-1&&E>>1===J[2*T+3]>>1&&(H=2,T+=1),E<0){for(var e=-(E>>1)-1,b=0;b<Y;++b){if(void 0!==(o=q(V[b],e)))return o}if(0!==H)for(b=0;b<P;++b){if(void 0!==(o=q(w[b],e)))return o}if(1!==H)for(b=0;b<M;++b){var o;if(void 0!==(o=q(n[b],e)))return o}0===H?v(w,A,P++,e):1===H?v(n,t,M++,e):2===H&&v(V,Z,Y++,e)}else{e=(E>>1)-1;0===H?Q(w,A,P--,e):1===H?Q(n,t,M--,e):2===H&&Q(V,Z,Y--,e)}}},scanBipartite:function(N,q,C,d,U,F,n,t,V,Z,r,O){var K=0,i=2*N,I=q,j=q+N,l=1,T=1;d?T=a:l=a;for(var z=U;z<F;++z){var p=z+l,s=i*z;J[K++]=n[s+I],J[K++]=-p,J[K++]=n[s+j],J[K++]=p}for(z=V;z<Z;++z){p=z+T;var X=i*z;J[K++]=r[X+I],J[K++]=-p}var P=K>>>1;W(J,P);var M=0;for(z=0;z<P;++z){var Y=0|J[2*z+1];if(Y<0){var E=!1;if((p=-Y)>=a?(E=!d,p-=a):(E=!!d,p-=1),E)v(w,A,M++,p);else{var H=O[p],e=i*p,b=r[e+q+1],o=r[e+q+1+N];N:for(var S=0;S<M;++S){var D=w[S],c=i*D;if(!(o<n[c+q+1]||n[c+q+1+N]<b)){for(var L=q+2;L<N;++L)if(r[e+L+N]<n[c+L]||n[c+L+N]<r[e+L])continue N;var G,h=t[D];if(void 0!==(G=d?C(H,h):C(h,H)))return G}}}}else Q(w,A,M--,Y-l)}},scanComplete:function(N,q,C,d,U,F,A,n,t,V,Z){for(var Q=0,v=2*N,r=q,O=q+N,K=d;K<U;++K){var i=K+a,I=v*K;J[Q++]=F[I+r],J[Q++]=-i,J[Q++]=F[I+O],J[Q++]=i}for(K=n;K<t;++K){i=K+1;var j=v*K;J[Q++]=V[j+r],J[Q++]=-i}var l=Q>>>1;W(J,l);var T=0;for(K=0;K<l;++K){var z=0|J[2*K+1];if(z<0){if((i=-z)>=a)w[T++]=i-a;else{var p=Z[i-=1],s=v*i,X=V[s+q+1],P=V[s+q+1+N];N:for(var M=0;M<T;++M){var Y=w[M],E=A[Y];if(E===p)break;var H=v*Y;if(!(P<F[H+q+1]||F[H+q+1+N]<X)){for(var e=q+2;e<N;++e)if(V[s+e+N]<F[H+e]||F[H+e+N]<V[s+e])continue N;var b=C(E,p);if(void 0!==b)return b}}}}else{for(i=z-a,M=T-1;M>=0;--M)if(w[M]===i){for(e=M+1;e<T;++e)w[e-1]=w[e];break}--T}}}};var d=C(13086),U=C(13093),W=C(13124),a=1<<28,F=1024,w=d.mallocInt32(F),A=d.mallocInt32(F),n=d.mallocInt32(F),t=d.mallocInt32(F),V=d.mallocInt32(F),Z=d.mallocInt32(F),J=d.mallocDouble(8192);function Q(N,q,C,d){var U=q[d],W=N[C-1];N[U]=W,q[W]=U}function v(N,q,C,d){N[C]=d,q[d]=C}},13098:N=>{"use strict";function q(N,C,d){var U=0|N[d];if(U<=0)return[];var W,a=new Array(U);if(d===N.length-1)for(W=0;W<U;++W)a[W]=C;else for(W=0;W<U;++W)a[W]=q(N,C,d+1);return a}N.exports=function(N,C){switch("undefined"===typeof C&&(C=0),typeof N){case"number":if(N>0)return function(N,q){var C,d;for(C=new Array(N),d=0;d<N;++d)C[d]=q;return C}(0|N,C);break;case"object":if("number"===typeof N.length)return q(N,C,0)}return[]}},13049:(N,q,C)=>{N.exports=function(){var N=this;this.components={},this.comps=this.components;var q=this.components,C=1,U={},W=[],a=[],F={timeout:!1,removals:[],multiComps:[]};function w(N,C){var d=q[C],W=U[C],a=W.hash[N];a&&(W.remove(N),d.eq&&(d.multi?(a.forEach((q=>{q&&d.eq(N,q)})),a.length=0):d.eq(N,a)),F.removals.push(W),A())}function A(){F.timeout||(F.timeout=!0,setTimeout(n,1))}function n(){F.timeout=!1,t()}function t(){F.multiComps.length&&function(N){for(var q=0;q<N.length;q++){var{entID:C,data:d}=N[q],U=d.hash[C];if(U){for(var W=0;W<U.length;W++)U[W]||(U.splice(W,1),W--);0===U.length&&(d.remove(C),F.removals.push(d))}}N.length=0}(F.multiComps),F.removals.length&&function(N){for(var q=0;q<N.length;q++){N[q].flush()}N.length=0}(F.removals)}this.Wt=U,this._systems=W,this._renderSystems=a,this.yA=function(q){var d=C++;return Array.isArray(q)&&q.forEach((q=>N.Xw(d,q))),d},this.deleteEntity=function(q){return Object.keys(U).forEach((N=>{U[N].hash[q]&&w(q,N)})),N},this.Fn=function(N){if(!N)throw new Error("Missing component definition");var C=N.name;if(!C)throw new Error("Component definition must have a name property.");if("string"!==typeof C)throw new Error("Component name must be a string.");if(""===C)throw new Error("Component name must be a non-empty string.");if(U[C])throw new Error(`Component ${C} already exists.`);var F={};return F.name=C,F.multi=!!N.multi,F.order=isNaN(N.order)?99:N.order,F.stateConstructor=N.stateConstructor||null,F.state=N.state||{},F.zF=N.zF||null,F.eq=N.eq||null,F.system=N.system||null,F.YF=N.YF||null,q[C]=F,U[C]=new d,U[C]._pendingMultiCleanup=!1,U[C]._multiCleanupIDs=F.multi?[]:null,F.system&&(W.push(C),W.sort(((N,C)=>q[N].order-q[C].order))),F.YF&&(a.push(C),a.sort(((N,C)=>q[N].order-q[C].order))),C},this.overwriteComponent=function(N,C){var d=q[N];if(!d)throw new Error(`Unknown component: ${N}`);if(!C)throw new Error("Missing component definition");if(d.name!==C.name)throw new Error("Overwriting component must use the same name property.");var F={};F.name=N,F.multi=!!C.multi,F.order=isNaN(C.order)?99:C.order,F.state=C.state||{},F.zF=C.zF||null,F.eq=C.eq||null,F.system=C.system||null,F.YF=C.YF||null,q[N]=F,U[N]._pendingMultiCleanup=!1,U[N]._multiCleanupIDs=F.multi?[]:null;var w=W.indexOf(N);F.system&&w<0&&W.push(N),!F.system&&w>=0&&W.splice(w,1),W.sort(((N,C)=>q[N].order-q[C].order));var A=a.indexOf(N);F.YF&&A<0&&a.push(N),!F.YF&&A>=0&&a.splice(A,1),a.sort(((N,C)=>q[N].order-q[C].order));var n=F.state;return this.pA(N).forEach((N=>{for(var q in n)q in N||(N[q]=n[q]);F.zF&&F.zF(N.PF,N)})),N},this.deleteComponent=function(C){var d=U[C];if(!d)throw new Error(`Unknown component: ${C}`);d.flush(),d.list.forEach((N=>{N&&w(N.PF||N[0].PF,C)}));var F=W.indexOf(C),A=a.indexOf(C);return F>-1&&W.splice(F,1),A>-1&&a.splice(A,1),U[C].dispose(),delete U[C],delete q[C],N},this.Xw=function(N,C,d){var W,a=q[C],F=U[C];if(!F)throw new Error(`Unknown component: ${C}.`);if(F.hash[N]&&!a.multi)throw new Error(`Entity ${N} already has component: ${C}.`);if(a.stateConstructor){if(!(W=new a.stateConstructor).hasOwnProperty("PF"))throw new Error(`Component ${a.name} stateConstructor type does not have property __id`)}else W=Object.assign({},{PF:N},a.state,d);if(W.PF=N,a.multi){var w=F.hash[N];w||(w=[],F.add(N,w)),w.push(W)}else F.add(N,W);return a.zF&&a.zF(N,W),this},this.Dw=function(N,q){var C=U[q];if(!C)throw new Error(`Unknown component: ${q}.`);return!!C.hash[N]},this.Ew=function(q,C){if(!U[C])throw new Error(`Unknown component: ${C}.`);return w(q,C),N},this.getState=function(N,q){var C=U[q];if(!C)throw new Error(`Unknown component: ${q}.`);return C.hash[N]},this.pA=function(N){var q=U[N];if(!q)throw new Error(`Unknown component: ${N}.`);return t(),q.list},this.fV=function(N){if(!U[N])throw new Error(`Unknown component: ${N}.`);var q=U[N].hash;return N=>q[N]},this.xV=function(N){if(!U[N])throw new Error(`Unknown component: ${N}.`);var q=U[N].hash;return N=>!!q[N]},this.rF=function(C){t();for(var d=0;d<W.length;d++){var a=W[d],F=q[a],w=U[a];F.system(C,w.list),t()}return N},this.render=function(C){t();for(var d=0;d<a.length;d++){var W=a[d],F=q[W],w=U[W];F.YF(C,w.list),t()}return N},this.removeMultiComponent=function(C,d,W){var a=q[d],w=U[d];if(!w)throw new Error(`Unknown component: ${d}.`);if(!a.multi)throw new Error("removeMultiComponent called on non-multi component");return function(N,q,C,d){var U=C.hash[N];if(U){var W=U[d];W&&(U[d]=null,q.eq&&q.eq(N,W),F.multiComps.push({entID:N,data:C}),A())}}(C,a,w,W),N}};var d=C(13057)},13057:N=>{function q(N,q){var C=N._map[q];if(delete N.hash[q],delete N._map[q],C===N.list.length-1)N.list.pop();else{var d=N.list.pop();if(N.list[C]=d,null===d||null===d[0]){var U=N.list.length;for(var W in N._map)if(N._map[W]===U)return void(N._map[W]=C)}else{var a=d.PF||d[0].PF;N._map[a]=C}}}N.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(N,q){if("number"===typeof this._map[N]){var C=this._map[N];this.hash[N]=q,this.list[C]=q}else this._map[N]=this.list.length,this.hash[N]=q,this.list.push(q)}remove(N){var q=this._map[N];this.hash[N]=null,this.list[q]=null,this._pendingRemovals.push(N)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var N=0;N<this._pendingRemovals.length;N++){var C=this._pendingRemovals[N];null===this.hash[C]&&q(this,C)}this._pendingRemovals.length=0}}},13015:N=>{"use strict";var q,C="object"===typeof Reflect?Reflect:null,d=function(N,q,C){return Function.prototype.apply.call(N,q,C)};q=C&&"function"===typeof C.ownKeys?C.ownKeys:Object.getOwnPropertySymbols?function(N){return Object.getOwnPropertyNames(N).concat(Object.getOwnPropertySymbols(N))}:function(N){return Object.getOwnPropertyNames(N)};var U=Number.isNaN||function(N){return N!==N};function W(){W.init.call(this)}N.exports=W,N.exports.once=function(N,q){return new Promise((function(C,d){function U(C){N.removeListener(q,W),d(C)}function W(){"function"===typeof N.removeListener&&N.removeListener("error",U),C([].slice.call(arguments))}Q(N,q,W,{once:!0}),"error"!==q&&function(N,q,C){"function"===typeof N.on&&Q(N,"error",q,C)}(N,U,{once:!0})}))},W.EventEmitter=W,W.prototype._events=void 0,W.prototype._eventsCount=0,W.prototype._maxListeners=void 0;var a=10;function F(N){if("function"!==typeof N)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof N)}function w(N){return void 0===N._maxListeners?W.defaultMaxListeners:N._maxListeners}function A(N,q,C,d){var U,W,a,A;if(F(C),void 0===(W=N._events)?(W=N._events=Object.create(null),N._eventsCount=0):(void 0!==W.newListener&&(N.emit("newListener",q,C.listener?C.listener:C),W=N._events),a=W[q]),void 0===a)a=W[q]=C,++N._eventsCount;else if("function"===typeof a?a=W[q]=d?[C,a]:[a,C]:d?a.unshift(C):a.push(C),(U=w(N))>0&&a.length>U&&!a.warned){a.warned=!0;var n=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(q)+" listeners added. Use emitter.setMaxListeners() to increase limit");n.name="MaxListenersExceededWarning",n.dq=N,n.type=q,n.count=a.length,A=n,console&&console.warn&&console.warn(A)}return N}function n(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function t(N,q,C){var d={fired:!1,wrapFn:void 0,target:N,type:q,listener:C},U=n.bind(d);return U.listener=C,d.wrapFn=U,U}function V(N,q,C){var d=N._events;if(void 0===d)return[];var U=d[q];return void 0===U?[]:"function"===typeof U?C?[U.listener||U]:[U]:C?function(N){for(var q=new Array(N.length),C=0;C<q.length;++C)q[C]=N[C].listener||N[C];return q}(U):J(U,U.length)}function Z(N){var q=this._events;if(void 0!==q){var C=q[N];if("function"===typeof C)return 1;if(void 0!==C)return C.length}return 0}function J(N,q){for(var C=new Array(q),d=0;d<q;++d)C[d]=N[d];return C}function Q(N,q,C,d){if("function"===typeof N.on)d.once?N.once(q,C):N.on(q,C);else{if("function"!==typeof N.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof N);N.addEventListener(q,(function U(W){d.once&&N.removeEventListener(q,U),C(W)}))}}Object.defineProperty(W,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(N){if("number"!==typeof N||N<0||U(N))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+N+".");a=N}}),W.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},W.prototype.setMaxListeners=function(N){if("number"!==typeof N||N<0||U(N))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+N+".");return this._maxListeners=N,this},W.prototype.getMaxListeners=function(){return w(this)},W.prototype.emit=function(N){for(var q=[],C=1;C<arguments.length;C++)q.push(arguments[C]);var U="error"===N,W=this._events;if(void 0!==W)U=U&&void 0===W.error;else if(!U)return!1;if(U){var a;if(q.length>0&&(a=q[0]),a instanceof Error)throw a;var F=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw F.context=a,F}var w=W[N];if(void 0===w)return!1;if("function"===typeof w)d(w,this,q);else{var A=w.length,n=J(w,A);for(C=0;C<A;++C)d(n[C],this,q)}return!0},W.prototype.addListener=function(N,q){return A(this,N,q,!1)},W.prototype.on=W.prototype.addListener,W.prototype.prependListener=function(N,q){return A(this,N,q,!0)},W.prototype.once=function(N,q){return F(q),this.on(N,t(this,N,q)),this},W.prototype.prependOnceListener=function(N,q){return F(q),this.prependListener(N,t(this,N,q)),this},W.prototype.removeListener=function(N,q){var C,d,U,W,a;if(F(q),void 0===(d=this._events))return this;if(void 0===(C=d[N]))return this;if(C===q||C.listener===q)0===--this._eventsCount?this._events=Object.create(null):(delete d[N],d.removeListener&&this.emit("removeListener",N,C.listener||q));else if("function"!==typeof C){for(U=-1,W=C.length-1;W>=0;W--)if(C[W]===q||C[W].listener===q){a=C[W].listener,U=W;break}if(U<0)return this;0===U?C.shift():function(N,q){for(;q+1<N.length;q++)N[q]=N[q+1];N.pop()}(C,U),1===C.length&&(d[N]=C[0]),void 0!==d.removeListener&&this.emit("removeListener",N,a||q)}return this},W.prototype.off=W.prototype.removeListener,W.prototype.Uq=function(N){var q,C,d;if(void 0===(C=this._events))return this;if(void 0===C.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==C[N]&&(0===--this._eventsCount?this._events=Object.create(null):delete C[N]),this;if(0===arguments.length){var U,W=Object.keys(C);for(d=0;d<W.length;++d)"removeListener"!==(U=W[d])&&this.Uq(U);return this.Uq("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(q=C[N]))this.removeListener(N,q);else if(void 0!==q)for(d=q.length-1;d>=0;d--)this.removeListener(N,q[d]);return this},W.prototype.listeners=function(N){return V(this,N,!0)},W.prototype.rawListeners=function(N){return V(this,N,!1)},W.listenerCount=function(N,q){return"function"===typeof N.listenerCount?N.listenerCount(q):Z.call(N,q)},W.prototype.listenerCount=Z,W.prototype.eventNames=function(){return this._eventsCount>0?q(this._events):[]}},13303:N=>{"use strict";N.exports=function(N,q,C,d,U,W){var a=+q[0],F=+q[1],w=+q[2],A=+C[0],n=+C[1],t=+C[2],V=Math.sqrt(A*A+n*n+t*t);if(0===V)throw new Error("Can't raycast along a zero vector");return function(N,q,C,d,U,W,a,F,w,A){for(var n=0,t=Math.floor,V=0|t(q),Z=0|t(C),J=0|t(d),Q=U>0?1:-1,v=W>0?1:-1,r=a>0?1:-1,O=Math.abs(1/U),K=Math.abs(1/W),i=Math.abs(1/a),I=O<1/0?O*(Q>0?V+1-q:q-V):1/0,j=K<1/0?K*(v>0?Z+1-C:C-Z):1/0,l=i<1/0?i*(r>0?J+1-d:d-J):1/0,T=-1;n<=F;){var z=N(V,Z,J);if(z)return w&&(w[0]=q+n*U,w[1]=C+n*W,w[2]=d+n*a),A&&(A[0]=A[1]=A[2]=0,0===T&&(A[0]=-Q),1===T&&(A[1]=-v),2===T&&(A[2]=-r)),z;I<j?I<l?(V+=Q,n=I,I+=O,T=0):(J+=r,n=l,l+=i,T=2):j<l?(Z+=v,n=j,j+=K,T=1):(J+=r,n=l,l+=i,T=2)}return w&&(w[0]=q+n*U,w[1]=C+n*W,w[2]=d+n*a),A&&(A[0]=A[1]=A[2]=0),0}(N,a,F,w,A/=V,n/=V,t/=V,d="undefined"===typeof d?64:+d,U,W)}},13338:(N,q,C)=>{"use strict";C.d(q,{c:()=>W});var d=C(13015);function U(){this.kt=!1,this.stopPropagation=!1,this.gt=!1,this.disabled=!1}class W{constructor(N,q){this.version="0.7.0";var C=Object.assign({},new U,q||{});this.element=N||document,this.kt=!!C.kt,this.stopPropagation=!!C.stopPropagation,this.gt=!!C.gt,this.disabled=!!C.disabled,this.filterEvents=(N,q)=>!0,this.down=new d.EventEmitter,this.up=new d.EventEmitter,this.state={},this.iA={dx:0,dy:0,cV:0,KA:0,LV:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?F(this):document.addEventListener("DOMContentLoaded",(N=>{F(this)}),{once:!0})}bind(N){for(var q=arguments.length,C=new Array(q>1?q-1:0),d=1;d<q;d++)C[d-1]=arguments[d];C.forEach((q=>{var C=this._keyBindmap[q]||[];C.includes(N)||(C.push(N),this._keyBindmap[q]=C)})),this.state[N]=!!this.state[N],this.pressCount[N]=this.pressCount[N]||0,this.releaseCount[N]=this.releaseCount[N]||0}unbind(N){for(var q in this._keyBindmap){var C=this._keyBindmap[q],d=C.indexOf(N);d>-1&&C.splice(d,1)}}getBindings(){var N={};for(var q in this._keyBindmap){this._keyBindmap[q].forEach((C=>{N[C]=N[C]||[],N[C].push(q)}))}return N}rF(){a(this.iA),a(this.pressCount),a(this.releaseCount)}}function a(N){for(var q in N)N[q]=0}function F(N){window.addEventListener("keydown",J.bind(null,N,!0),!1),window.addEventListener("keyup",J.bind(null,N,!1),!1);var q={passive:!0};N.element.addEventListener("touchstart",t.bind(void 0,N),{passive:!1}),N.element.addEventListener("touchend",Z.bind(void 0,N),q),N.element.addEventListener("mousedown",Q.bind(null,N,!0),q),window.document.addEventListener("mouseup",Q.bind(null,N,!1),q),N.element.addEventListener("touchmove",v.bind(null,N),q),N.element.addEventListener("mousemove",v.bind(null,N),q),window.PointerEvent,N.element.addEventListener("wheel",r.bind(null,N),q),N.element.addEventListener("contextmenu",O.bind(null,N),!1),window.addEventListener("blur",K.bind(null,N),!1)}var w=0,A=0,n=null;function t(N,q){q.preventDefault(),V(q)}function V(N){let q=!1;for(let C=0;C<N.touches.length;++C)if(N.touches[C].identifier===n){q=!0;break}if(!q){const q=N.changedTouches[0];w=q.clientX,A=q.clientY,n=q.identifier}}function Z(N,q){for(var C=q.changedTouches,d=0;d<C.length;++d)C[d].identifier===n&&(n=null)}function J(N,q,C){i(C.code,q,N,C)}function Q(N,q,C){if("pointerId"in C)if(q){if(null!==N._touches.currID)return;N._touches.currID=C.pointerId}else{if(N._touches.currID!==C.pointerId)return;N._touches.currID=null}return i("Mouse"+("button"in C?C.button+1:1),q,N,C),!1}function v(N,q){var C=q.movementX||q.mozMovementX||0,d=q.movementY||q.mozMovementY||0;if(q.touches&&0===(C|d)){var U=function(N){V(N);for(let q=0;q<N.changedTouches.length;++q)if(N.changedTouches[q].identifier==n){const C=N.changedTouches[q],d=[C.clientX-w,C.clientY-A];return w=C.clientX,A=C.clientY,d}return console.error(`Did not find touch id ${n}`),[0,0]}(q);C=U[0],d=U[1]}N.iA.dx+=C,N.iA.dy+=d}function r(N,q){var C=1;switch(q.deltaMode){case 0:C=1;break;case 1:C=12;break;case 2:C=N.element.clientHeight||window.innerHeight}N.iA.cV+=(q.deltaX||0)*C,N.iA.KA+=(q.deltaY||0)*C,N.iA.LV+=(q.deltaZ||0)*C}function O(N,q){if(!N.gt)return q.preventDefault(),!1}function K(N){for(var q in N._keyStates)N._keyStates[q]&&(/^Mouse\d/.test(q)||i(q,!1,N,{code:q,note:"rxsooxysza",preventDefault:()=>{},stopPropagation:()=>{}}))}function i(N,q,C,d){var U=C._keyBindmap[N];U&&(I(C._keyStates[N],q)&&(C._keyStates[N]=q,U.forEach((N=>{(!C.filterEvents||C.filterEvents(d,N))&&function(N,q,C,d){var U=q?C.pressCount:C.releaseCount;U[N]=(U[N]||0)+1;var W=C._bindPressCount[N]||0;(W+=q?1:-1)<0&&(W=0);C._bindPressCount[N]=W;var a=C.state[N];if(I(a,W)){C.state[N]=W>0;var F=q?C.down:C.up;C.disabled||F.emit(N,d)}}(N,q,C,d)}))),"button"in d||(C.kt&&!d.defaultPrevented&&d.preventDefault(),C.stopPropagation&&d.stopPropagation()))}function I(N,q){return N?!q:q}},12003:N=>{N.exports=function(N,q,C){return N[0]=q[0]+C[0],N[1]=q[1]+C[1],N[2]=q[2]+C[2],N}},11964:(N,q,C)=>{N.exports=function(N,q){var C=d(N[0],N[1],N[2]),a=d(q[0],q[1],q[2]);U(C,C),U(a,a);var F=W(C,a);return F>1?0:Math.acos(F)};var d=C(11967),U=C(11974),W=C(11976)},12055:N=>{N.exports=function(N,q){return N[0]=Math.ceil(q[0]),N[1]=Math.ceil(q[1]),N[2]=Math.ceil(q[2]),N}},11961:N=>{N.exports=function(N){var q=new Float32Array(3);return q[0]=N[0],q[1]=N[1],q[2]=N[2],q}},11980:N=>{N.exports=function(N,q){return N[0]=q[0],N[1]=q[1],N[2]=q[2],N}},11956:N=>{N.exports=function(){var N=new Float32Array(3);return N[0]=0,N[1]=0,N[2]=0,N}},12139:N=>{N.exports=function(N,q,C){var d=q[0],U=q[1],W=q[2],a=C[0],F=C[1],w=C[2];return N[0]=U*w-W*F,N[1]=W*a-d*w,N[2]=d*F-U*a,N}},12084:(N,q,C)=>{N.exports=C(12081)},12081:N=>{N.exports=function(N,q){var C=q[0]-N[0],d=q[1]-N[1],U=q[2]-N[2];return Math.sqrt(C*C+d*d+U*U)}},12038:(N,q,C)=>{N.exports=C(12032)},12032:N=>{N.exports=function(N,q,C){return N[0]=q[0]/C[0],N[1]=q[1]/C[1],N[2]=q[2]/C[2],N}},11976:N=>{N.exports=function(N,q){return N[0]*q[0]+N[1]*q[1]+N[2]*q[2]}},11949:N=>{N.exports=1e-6},11990:(N,q,C)=>{N.exports=function(N,q){var C=N[0],U=N[1],W=N[2],a=q[0],F=q[1],w=q[2];return Math.abs(C-a)<=d*Math.max(1,Math.abs(C),Math.abs(a))&&Math.abs(U-F)<=d*Math.max(1,Math.abs(U),Math.abs(F))&&Math.abs(W-w)<=d*Math.max(1,Math.abs(W),Math.abs(w))};var d=C(11949)},11994:N=>{N.exports=function(N,q){return N[0]===q[0]&&N[1]===q[1]&&N[2]===q[2]}},12052:N=>{N.exports=function(N,q){return N[0]=Math.floor(q[0]),N[1]=Math.floor(q[1]),N[2]=Math.floor(q[2]),N}},12183:(N,q,C)=>{N.exports=function(N,q,C,U,W,a){var F,w;q||(q=3);C||(C=0);w=U?Math.min(U*q+C,N.length):N.length;for(F=C;F<w;F+=q)d[0]=N[F],d[1]=N[F+1],d[2]=N[F+2],W(d,d,a),N[F]=d[0],N[F+1]=d[1],N[F+2]=d[2];return N};var d=C(11956)()},11967:N=>{N.exports=function(N,q,C){var d=new Float32Array(3);return d[0]=N,d[1]=q,d[2]=C,d}},11942:(N,q,C)=>{N.exports={EPSILON:C(11949),create:C(11956),clone:C(11961),angle:C(11964),wF:C(11967),k:C(11980),set:C(11982),equals:C(11990),exactEquals:C(11994),add:C(12003),Qq:C(12012),sub:C(12020),multiply:C(12022),mul:C(12024),divide:C(12032),div:C(12038),min:C(12044),max:C(12049),floor:C(12052),ceil:C(12055),round:C(12061),scale:C(12070),AF:C(12077),distance:C(12081),i:C(12084),squaredDistance:C(12091),sqrDist:C(12098),length:C(12105),len:C(12111),squaredLength:C(12116),nF:C(12122),negate:C(12125),inverse:C(12130),normalize:C(11974),dot:C(11976),cross:C(12139),WF:C(12142),random:C(12147),transformMat4:C(12154),transformMat3:C(12159),transformQuat:C(12167),tF:C(12172),VF:C(12175),ZF:C(12177),forEach:C(12183)}},12130:N=>{N.exports=function(N,q){return N[0]=1/q[0],N[1]=1/q[1],N[2]=1/q[2],N}},12111:(N,q,C)=>{N.exports=C(12105)},12105:N=>{N.exports=function(N){var q=N[0],C=N[1],d=N[2];return Math.sqrt(q*q+C*C+d*d)}},12142:N=>{N.exports=function(N,q,C,d){var U=q[0],W=q[1],a=q[2];return N[0]=U+d*(C[0]-U),N[1]=W+d*(C[1]-W),N[2]=a+d*(C[2]-a),N}},12049:N=>{N.exports=function(N,q,C){return N[0]=Math.max(q[0],C[0]),N[1]=Math.max(q[1],C[1]),N[2]=Math.max(q[2],C[2]),N}},12044:N=>{N.exports=function(N,q,C){return N[0]=Math.min(q[0],C[0]),N[1]=Math.min(q[1],C[1]),N[2]=Math.min(q[2],C[2]),N}},12024:(N,q,C)=>{N.exports=C(12022)},12022:N=>{N.exports=function(N,q,C){return N[0]=q[0]*C[0],N[1]=q[1]*C[1],N[2]=q[2]*C[2],N}},12125:N=>{N.exports=function(N,q){return N[0]=-q[0],N[1]=-q[1],N[2]=-q[2],N}},11974:N=>{N.exports=function(N,q){var C=q[0],d=q[1],U=q[2],W=C*C+d*d+U*U;W>0&&(W=1/Math.sqrt(W),N[0]=q[0]*W,N[1]=q[1]*W,N[2]=q[2]*W);return N}},12147:N=>{N.exports=function(N,q){q=q||1;var C=2*Math.random()*Math.PI,d=2*Math.random()-1,U=Math.sqrt(1-d*d)*q;return N[0]=Math.cos(C)*U,N[1]=Math.sin(C)*U,N[2]=d*q,N}},12172:N=>{N.exports=function(N,q,C,d){var U=C[1],W=C[2],a=q[1]-U,F=q[2]-W,w=Math.sin(d),A=Math.cos(d);return N[0]=q[0],N[1]=U+a*A-F*w,N[2]=W+a*w+F*A,N}},12175:N=>{N.exports=function(N,q,C,d){var U=C[0],W=C[2],a=q[0]-U,F=q[2]-W,w=Math.sin(d),A=Math.cos(d);return N[0]=U+F*w+a*A,N[1]=q[1],N[2]=W+F*A-a*w,N}},12177:N=>{N.exports=function(N,q,C,d){var U=C[0],W=C[1],a=q[0]-U,F=q[1]-W,w=Math.sin(d),A=Math.cos(d);return N[0]=U+a*A-F*w,N[1]=W+a*w+F*A,N[2]=q[2],N}},12061:N=>{N.exports=function(N,q){return N[0]=Math.round(q[0]),N[1]=Math.round(q[1]),N[2]=Math.round(q[2]),N}},12070:N=>{N.exports=function(N,q,C){return N[0]=q[0]*C,N[1]=q[1]*C,N[2]=q[2]*C,N}},12077:N=>{N.exports=function(N,q,C,d){return N[0]=q[0]+C[0]*d,N[1]=q[1]+C[1]*d,N[2]=q[2]+C[2]*d,N}},11982:N=>{N.exports=function(N,q,C,d){return N[0]=q,N[1]=C,N[2]=d,N}},12098:(N,q,C)=>{N.exports=C(12091)},12122:(N,q,C)=>{N.exports=C(12116)},12091:N=>{N.exports=function(N,q){var C=q[0]-N[0],d=q[1]-N[1],U=q[2]-N[2];return C*C+d*d+U*U}},12116:N=>{N.exports=function(N){var q=N[0],C=N[1],d=N[2];return q*q+C*C+d*d}},12020:(N,q,C)=>{N.exports=C(12012)},12012:N=>{N.exports=function(N,q,C){return N[0]=q[0]-C[0],N[1]=q[1]-C[1],N[2]=q[2]-C[2],N}},12159:N=>{N.exports=function(N,q,C){var d=q[0],U=q[1],W=q[2];return N[0]=d*C[0]+U*C[3]+W*C[6],N[1]=d*C[1]+U*C[4]+W*C[7],N[2]=d*C[2]+U*C[5]+W*C[8],N}},12154:N=>{N.exports=function(N,q,C){var d=q[0],U=q[1],W=q[2],a=C[3]*d+C[7]*U+C[11]*W+C[15];return a=a||1,N[0]=(C[0]*d+C[4]*U+C[8]*W+C[12])/a,N[1]=(C[1]*d+C[5]*U+C[9]*W+C[13])/a,N[2]=(C[2]*d+C[6]*U+C[10]*W+C[14])/a,N}},12167:N=>{N.exports=function(N,q,C){var d=q[0],U=q[1],W=q[2],a=C[0],F=C[1],w=C[2],A=C[3],n=A*d+F*W-w*U,t=A*U+w*d-a*W,V=A*W+a*U-F*d,Z=-a*d-F*U-w*W;return N[0]=n*A+Z*-a+t*-w-V*-F,N[1]=t*A+Z*-F+V*-a-n*-w,N[2]=V*A+Z*-w+n*-F-t*-a,N}},13036:N=>{"use strict";N.exports=function(N){for(var q=new Array(N),C=0;C<N;++C)q[C]=C;return q}},13107:N=>{N.exports=function(N){return null!=N&&null!=N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}},13311:(N,q,C)=>{"use strict";C.d(q,{d:()=>d});class d{constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Xn=!1,this.Pn=!1,this.pn=30,this.sn=0,this.Dn=!1,this.fullscreen=!1,this.Yn=function(N){},this.En=function(){},this.bn=function(){},this.XC=function(){},this.Hn=function(N){},this.onFullscreenChanged=function(N){},A((()=>{!function(N,q){N._nowObject=performance||Date,N._lastTick=0,N._renderAccum=0,N._rt=0,N._frameCB=F.bind(null,N),requestAnimationFrame(N._frameCB),q>0&&(N._intervalCB=a.bind(null,N),N._interval=setInterval(N._intervalCB,Math.max(q,1e3/N.pn/2)))}(this,q),function(N,q){if(!q)return;var C=!1,d=!1;document.addEventListener("pointerlockchange",(d=>{C=document.pointerLockElement===q,N.Hn(C)})),document.addEventListener("fullscreenchange",(C=>{d=document.fullscreenElement===q,N.onFullscreenChanged(d)})),Object.defineProperty(N,"Dn",{get:()=>C,set:N=>{N&&!C?w(q):C&&!N&&function(N){N.exitPointerLock&&N.exitPointerLock()}(document)}}),Object.defineProperty(N,"fullscreen",{get:()=>d,set:N=>{N&&!d?q.requestFullscreen():d&&!N&&document.exitFullscreen()}}),q.addEventListener("click",(U=>{N.Xn&&!C&&w(q),N.Pn&&!d&&q.requestFullscreen()}));var U=()=>N.XC();if(window.ResizeObserver){new ResizeObserver(U).observe(q)}else window.addEventListener("resize",U)}(this,N),this.bn()}))}}var U=3,W=20;function a(N){for(var q=1e3/N.pn,C=N._nowObject.now()+W,d=0;N._nowObject.now()>=N._lastTick+q&&N._nowObject.now()<C&&++d<=U;)N.Yn(q),N._lastTick+=q;var a=5*(q+5),F=N._nowObject.now();if(F-N._lastTick>a)for(;F>=N._lastTick+q;)N._lastTick+=q}function F(N){requestAnimationFrame(N._frameCB),a(N);var q=N._nowObject.now(),C=q-N._rt;if(N._rt=q,N.sn>0){N._renderAccum+=C;var d=1e3/N.sn;if(N._renderAccum<d)return;N._renderAccum=Math.min(N._renderAccum-d,d)}var U=1e3/N.pn,W=(q-N._lastTick)/U;N.En(C,W,U)}function w(N){N.requestPointerLock&&N.requestPointerLock()}var A=N=>{if("loading"===document.readyState){var q=()=>{document.removeEventListener("readystatechange",q),N()};document.addEventListener("readystatechange",q)}else setTimeout(N,1)}},13032:(N,q,C)=>{var d=C(13036),U=C(13041),W="undefined"!==typeof Float64Array;function a(N,q){return N[0]-q[0]}function F(){var N,q=this.stride,C=new Array(q.length);for(N=0;N<C.length;++N)C[N]=[Math.abs(q[N]),N];C.sort(a);var d=new Array(C.length);for(N=0;N<d.length;++N)d[N]=C[N][1];return d}function w(N,q){var C=["View",q,"d",N].join("");q<0&&(C="View_Nil"+N);var U="generic"===N;if(-1===q){var W="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+N+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(W)()}if(0===q){W="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+N+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(U?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(U?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",W)(A[N][0])}W=["'use strict'"];var a=d(q),w=a.map((function(N){return"i"+N})),n="this.offset+"+a.map((function(N){return"this.stride["+N+"]*i"+N})).join("+"),t=a.map((function(N){return"b"+N})).join(","),V=a.map((function(N){return"c"+N})).join(",");W.push("function "+C+"(a,"+t+","+V+",d){this.data=a","this.shape=["+t+"]","this.stride=["+V+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+N+"'","proto.dimension="+q),W.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+a.map((function(N){return"this.shape["+N+"]"})).join("*"),"}})"),1===q?W.push("proto.order=[0]"):(W.push("Object.defineProperty(proto,'order',{get:"),q<4?(W.push("function "+C+"_order(){"),2===q?W.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===q&&W.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):W.push("ORDER})")),W.push("proto.set=function "+C+"_set("+w.join(",")+",v){"),U?W.push("return this.data.set("+n+",v)}"):W.push("return this.data["+n+"]=v}"),W.push("proto.get=function "+C+"_get("+w.join(",")+"){"),U?W.push("return this.data.get("+n+")}"):W.push("return this.data["+n+"]}"),W.push("proto.index=function "+C+"_index(",w.join(),"){return "+n+"}"),W.push("proto.hi=function "+C+"_hi("+w.join(",")+"){return new "+C+"(this.data,"+a.map((function(N){return["(typeof i",N,"!=='number'||i",N,"<0)?this.shape[",N,"]:i",N,"|0"].join("")})).join(",")+","+a.map((function(N){return"this.stride["+N+"]"})).join(",")+",this.offset)}");var Z=a.map((function(N){return"a"+N+"=this.shape["+N+"]"})),J=a.map((function(N){return"c"+N+"=this.stride["+N+"]"}));W.push("proto.lo=function "+C+"_lo("+w.join(",")+"){var b=this.offset,d=0,"+Z.join(",")+","+J.join(","));for(var Q=0;Q<q;++Q)W.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){d=i"+Q+"|0;b+=c"+Q+"*d;a"+Q+"-=d}");W.push("return new "+C+"(this.data,"+a.map((function(N){return"a"+N})).join(",")+","+a.map((function(N){return"c"+N})).join(",")+",b)}"),W.push("proto.step=function "+C+"_step("+w.join(",")+"){var "+a.map((function(N){return"a"+N+"=this.shape["+N+"]"})).join(",")+","+a.map((function(N){return"b"+N+"=this.stride["+N+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Q=0;Q<q;++Q)W.push("if(typeof i"+Q+"==='number'){d=i"+Q+"|0;if(d<0){c+=b"+Q+"*(a"+Q+"-1);a"+Q+"=ceil(-a"+Q+"/d)}else{a"+Q+"=ceil(a"+Q+"/d)}b"+Q+"*=d}");W.push("return new "+C+"(this.data,"+a.map((function(N){return"a"+N})).join(",")+","+a.map((function(N){return"b"+N})).join(",")+",c)}");var v=new Array(q),r=new Array(q);for(Q=0;Q<q;++Q)v[Q]="a[i"+Q+"]",r[Q]="b[i"+Q+"]";W.push("proto.transpose=function "+C+"_transpose("+w+"){"+w.map((function(N,q){return N+"=("+N+"===undefined?"+q+":"+N+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+v.join(",")+","+r.join(",")+",this.offset)}"),W.push("proto.pick=function "+C+"_pick("+w+"){var a=[],b=[],c=this.offset");for(Q=0;Q<q;++Q)W.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){c=(c+this.stride["+Q+"]*i"+Q+")|0}else{a.push(this.shape["+Q+"]);b.push(this.stride["+Q+"])}");return W.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),W.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+a.map((function(N){return"shape["+N+"]"})).join(",")+","+a.map((function(N){return"stride["+N+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",W.join("\n"))(A[N],F)}var A={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};N.exports=function(N,q,C,d){if(void 0===N)return(0,A.array[0])([]);"number"===typeof N&&(N=[N]),void 0===q&&(q=[N.length]);var a=q.length;if(void 0===C){C=new Array(a);for(var F=a-1,n=1;F>=0;--F)C[F]=n,n*=q[F]}if(void 0===d){d=0;for(F=0;F<a;++F)C[F]<0&&(d-=(q[F]-1)*C[F])}for(var t=function(N){if(U(N))return"buffer";if(W)switch(Object.prototype.toString.call(N)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(N)?"array":"generic"}(N),V=A[t];V.length<=a+1;)V.push(w(t,V.length-1));return(0,V[a+1])(N,q,C,d)}},13041:N=>{function q(N){return!!N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}N.exports=function(N){return null!=N&&(q(N)||function(N){return"function"===typeof N.readFloatLE&&"function"===typeof N.slice&&q(N.slice(0,0))}(N)||!!N._isBuffer)}},13193:N=>{"use strict";var q=[],C=[],d=[],U=[],W=[],a=[],F=[],w=[],A=[],n=[],t=[],V=[];N.exports=function(N,Z,J,Q,v,r){for(var O=F,K=A,i=n,I=V,j=0;j<3;j++)O[j]=+J[j],i[j]=+Z.max[j],K[j]=+Z.base[j];r||(r=1e-10);var l=function(N,F,A,n,V,Z){var J=q,Q=C,v=d,r=U,O=W,K=a,i=w,I=Math.floor,j=0,l=0,T=0,z=0,p=0;if(s(),0===T)return 0;for(z=M();l<=T;){if(X(z)&&P())return j;z=M()}for(j+=T,p=0;p<3;p++)n[p]+=A[p],V[p]+=A[p];return j;function s(){if(l=0,0!==(T=Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2])))for(var N=0;N<3;N++){var q=A[N]>=0;r[N]=q?1:-1;var C=q?V[N]:n[N];J[N]=q?n[N]:V[N],Q[N]=Y(C,r[N]),v[N]=E(J[N],r[N]),i[N]=A[N]/T,O[N]=Math.abs(1/i[N]);var d=q?Q[N]+1-C:C-Q[N];K[N]=O[N]<1/0?O[N]*d:1/0}}function X(q){for(var C=r[0],d=0===q?Q[0]:v[0],U=Q[0]+C,W=r[1],a=1===q?Q[1]:v[1],F=Q[1]+W,w=r[2],A=2===q?Q[2]:v[2],n=Q[2]+w,t=d;t!=U;t+=C)for(var V=a;V!=F;V+=W)for(var Z=A;Z!=n;Z+=w)if(N(t,V,Z))return!0;return!1}function P(){j+=l;var N=r[z],q=l/T,C=t;for(p=0;p<3;p++){var d=A[p]*q;n[p]+=d,V[p]+=d,C[p]=A[p]-d}if(N>0?V[z]=Math.round(V[z]):n[z]=Math.round(n[z]),F(j,z,N,C))return!0;for(p=0;p<3;p++)A[p]=C[p];return s(),0===T}function M(){var N=K[0]<K[1]?K[0]<K[2]?0:2:K[1]<K[2]?1:2,q=K[N]-l;for(l=K[N],Q[N]+=r[N],K[N]+=O[N],p=0;p<3;p++)J[p]+=q*i[p],v[p]=E(J[p],r[p]);return N}function Y(N,q){return I(N-q*Z)}function E(N,q){return I(N+q*Z)}}(N,Q,O,K,i,r);if(!v){for(j=0;j<3;j++)I[j]=J[j]>0?i[j]-Z.max[j]:K[j]-Z.base[j];Z.translate(I)}return l}},13343:(N,q,C)=>{"use strict";C.d(q,{e:()=>t});var d=C(13191),U=C(11942);class W{constructor(N,q,C,W,a,F,w){this.zA=new d(N.base,N.GA),this.hC=q,this.friction=C,this.restitution=W,this.ga=a,this.wZ=F,this.xa=!!w,this.LA=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.mZ=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.qA=U.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=U.create(),this._impulses=U.create(),this._sleepFrameCount=10}loadFromCopy(N){U.k(this.zA.base,N.zA.base),U.k(this.zA.GA,N.zA.GA),U.k(this.zA.max,N.zA.max),this.zA.mag=N.zA.mag,this.hC=N.hC,this.friction=N.friction,this.restitution=N.restitution,this.ga=N.ga,this.wZ=N.wZ,this.xa=N.xa,this.LA=N.LA,this.fluidDrag=N.fluidDrag,this.mZ=N.mZ,this.preventFallOffEdge=N.preventFallOffEdge,this.rolledBackLastTick=N.rolledBackLastTick,U.k(this.qA,N.qA),U.k(this.resting,N.resting),this.inFluid=N.inFluid,this._ratioInFluid=N._ratioInFluid,U.k(this._forces,N._forces),U.k(this._impulses,N._impulses),this._sleepFrameCount=N._sleepFrameCount}setPosition(N){a(N),U.Qq(N,N,this.zA.base),this.zA.translate(N),this.UA()}qd(){return U.clone(this.zA.base)}applyForce(N){a(N),U.add(this._forces,this._forces,N),this.UA()}applyImpulse(N){a(N),U.add(this._impulses,this._impulses,N),this.UA()}UA(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var a=N=>{};var F=C(13191),w=C(11942),A=C(13193);function n(){this.LA=.1,this.fluidDrag=.4,this.UF=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function t(N,q,C){N=Object.assign(new n,N),this.gravity=N.gravity||[0,-10,0],this.LA=N.LA||.1,this.UF=N.UF||2,this.fluidDrag=N.fluidDrag||.4,this.minBounceImpulse=N.minBounceImpulse,this.bodies=[],this.PV=N.PV,this.testSolid=q,this.testFluid=C}t.prototype.QZ=function(N,q,C,d,U,a){N=N||new F([0,0,0],[1,1,1]),"undefined"==typeof q&&(q=1),"undefined"==typeof C&&(C=1),"undefined"==typeof d&&(d=0),"undefined"==typeof U&&(U=1);var w=new W(N,q,C,d,U,a);return this.bodies.push(w),w},t.prototype.vZ=function(N){var q=this.bodies.indexOf(N);q<0||(this.bodies.splice(q,1),N.zA=N.wZ=null)};var V=w.create(),Z=w.create(),J=w.create(),Q=w.create(),v=w.create(),r=w.create(),O=w.create(),K=new F([0,0,0],[1,1,1]),i=new W(K,1,1,0,1,(()=>{}),!1);function I(N,q,C){return q=C,q*=1-(1-N.ratioInFluid)**2}t.prototype.rF=function(N){N/=1e3;var q=S(0,w.squaredLength(this.gravity));this.bodies.forEach((C=>function(N,q,C,d){w.k(v,q.resting),N.PV&&i.loadFromCopy(q);if(q.hC<=0)return w.set(q.qA,0,0,0),w.set(q._forces,0,0,0),void w.set(q._impulses,0,0,0);var U=d||0===q.ga;if(function(N,q,C,d){if(q._sleepFrameCount>0)return!1;if(d)return!0;var U=!1,W=.5*C*C*q.ga;return w.scale(o,N.gravity,W),A(N.testSolid,q.zA,o,(function(){return U=!0,!0}),!0),U}(N,q,C,U))return;q._sleepFrameCount--,function(N,q){var C=q.zA,d=Math.floor(C.base[0]),U=Math.floor(C.base[2]),W=Math.floor(C.base[1]),a=Math.floor(C.max[1]);if(!N.testFluid(d,W,U))return q.inFluid=!1,void(q.ratioInFluid=0);var F=1,A=W+1;for(;A<=a&&N.testFluid(d,A,U);)F++,A++;var n=(W+F-C.base[1])/C.GA[1];n>1&&(n=1);var t=C.GA[0]*C.GA[1]*C.GA[2]*n,V=l;w.scale(V,N.gravity,-N.UF*t*q.ga),q.applyForce(V),q.inFluid=!0,q.ratioInFluid=n}(N,q),c(q._forces),c(q._impulses),c(q.qA),c(q.resting),w.scale(V,q._forces,1/q.hC),w.AF(V,V,N.gravity,q.ga),w.scale(Z,q._impulses,1/q.hC),w.AF(Z,Z,V,C),w.add(q.qA,q.qA,Z),q.friction&&(T(N,0,q,Z,C),T(N,1,q,Z,C),T(N,2,q,Z,C));var W=q.fluidDrag>=0?q.fluidDrag:N.fluidDrag,a=q.LA>=0?q.LA:N.LA,F=a,n=a;q.inFluid&&(F=I(q,F,q.fluidDragHoriz>=0?q.fluidDragHoriz:W),n=I(q,n,q.fluidDragVert>=0?q.fluidDragVert:W));F=Math.max(1-F*C/q.hC,0),n=Math.max(1-n*C/q.hC,0),w.set(j,F,n,F),w.multiply(q.qA,q.qA,j),w.scale(J,q.qA,C),w.set(q._forces,0,0,0),w.set(q._impulses,0,0,0),q.xa&&D(s,q.zA);w.k(r,J),w.set(O,0,0,0),q.preventFallOffEdge&&function(N,q,C,d){if(!q.resting[1]||C[1]>0)return;var U=H;D(U,q.zA);for(var W=0;W<3;W+=2){w.set(E,0,0,0),E[W]=C[W];var a=!0;(a=(a=(a=(a=a&&!b(N,U.base[0]+E[0]+1e-5,U.base[1],U.base[2]+E[2]+1e-5))&&!b(N,U.max[0]+E[0]-1e-5,U.base[1],U.base[2]+E[2]+1e-5))&&!b(N,U.base[0]+E[0]+1e-5,U.base[1],U.max[2]+E[2]-1e-5))&&!b(N,U.max[0]+E[0]-1e-5,U.base[1],U.max[2]+E[2]-1e-5))?(d[W]=C[W]>0?1:-1,C[W]=0):0===W&&(w.set(e,C[0],0,0),p(N,U,e,d,q.slideOnCollision))}}(N,q,J,O);p(N,q.zA,J,q.resting,q.slideOnCollision),q.xa&&function(N,q,C,d){if(q.resting[1]>=0&&!q.inFluid)return;var U=0!==q.resting[0],W=0!==q.resting[2];if(!U&&!W)return;var a=Math.abs(d[0]/d[2]),F=4;if(!U&&a>F)return;if(!W&&a<1/F)return;w.add(P,C.base,d);var n=N.testSolid;A(n,C,d,(function(N,q,C,d){if(1!==q)return!0;d[q]=0}));var t=C.base[1],V=q.inFluid?1.951:1.001,Z=Math.floor(t+V)-t;w.set(M,0,Z,0);var J=!1;if(A(n,C,M,(function(N,q,C,d){return J=!0,!0})),J)return;w.Qq(Y,P,C.base),Y[1]=0,p(N,C,Y,X,!0);var Q=S(C.base[0],P[0]),v=S(C.base[2],P[2]);if(U&&!Q&&(!v||!W))return;if(W&&(!Q||!U)&&!v)return;var r=!0;if(r=r&&!b(N,C.base[0]+1e-5,C.base[1],C.base[2]+1e-5),r=r&&!b(N,C.max[0]-1e-5,C.base[1],C.base[2]+1e-5),r=r&&!b(N,C.base[0]+1e-5,C.base[1],C.max[2]-1e-5),r=r&&!b(N,C.max[0]-1e-5,C.base[1],C.max[2]-1e-5),r)return;D(q.zA,C),q.resting[0]=X[0],q.resting[2]=X[2],q.mZ&&q.mZ()}(N,q,s,r);for(var t=0;t<3;++t)q.resting[t]=q.resting[t]||O[t],Q[t]=0,q.resting[t]&&(v[t]||(Q[t]=-q.qA[t]),q.qA[t]=0);var K=w.length(Q);K>.001&&(w.scale(Q,Q,q.hC),q.wZ&&q.wZ(Q),q.restitution>0&&K>N.minBounceImpulse&&(w.scale(Q,Q,q.restitution),q.applyImpulse(Q)));var z=w.squaredLength(q.qA);z>1e-5&&q.UA();N.PV&&N.PV(q)?(q.loadFromCopy(i),q.rolledBackLastTick=!0):q.rolledBackLastTick=!1}(this,C,N,q)))};var j=w.create([0,0,0]);var l=w.create();function T(N,q,C,d,U){var W=C.resting[q],a=d[q];if(!C.alwaysApplyHorizFriction||1!==q){if(0===W)return;if(W*a<=0)return}w.k(z,C.qA),z[q]=0;var F=w.length(z);if(!S(F,0)){var A=Math.abs(C.friction*N.gravity[q]*U),n=F>A?(F-A)/F:0;C.qA[(q+1)%3]*=n,C.qA[(q+2)%3]*=n}}var z=w.create();function p(N,q,C,d,U){return w.set(d,0,0,0),A(N.testSolid,q,C,(function(N,q,C,W){d[q]=C,W[q]=0,U||(W[0]=0,W[1]=0,W[2]=0)}))}var s=new F([],[]),X=w.create(),P=w.create(),M=w.create(),Y=w.create();var E=w.create(),H=new F([],[]),e=w.create();function b(N,q,C,d){return N.testSolid(Math.floor(q),Math.floor(C-1),Math.floor(d))}var o=w.create();function S(N,q){return Math.abs(N-q)<1e-5}function D(N,q){for(var C=0;C<3;C++)N.base[C]=q.base[C],N.max[C]=q.max[C],N.GA[C]=q.GA[C]}var c=function(N){}},11804:function(N,q){!function(N){"use strict";var q=function(N,C){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,q){N.__proto__=q}||function(N,q){for(var C in q)Object.prototype.hasOwnProperty.call(q,C)&&(N[C]=q[C])},q(N,C)};function C(N,C){if("function"!==typeof C&&null!==C)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function d(){this.constructor=N}q(N,C),N.prototype=null===C?Object.create(C):(d.prototype=C.prototype,new d)}function d(N,q,C,d){var U,W=arguments.length,a=W<3?q:null===d?d=Object.getOwnPropertyDescriptor(q,C):d;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(N,q,C,d);else for(var F=N.length-1;F>=0;F--)(U=N[F])&&(a=(W<3?U(a):W>3?U(q,C,a):U(q,C))||a);return W>3&&a&&Object.defineProperty(q,C,a),a}function U(N,q,C){if(C||2===arguments.length)for(var d,U=0,W=q.length;U<W;U++)!d&&U in q||(d||(d=Array.prototype.slice.call(q,0,U)),d[U]=q[U]);return N.concat(d||Array.prototype.slice.call(q))}var W,a=255,F=213;N.OPERATION=void 0,(W=N.OPERATION||(N.OPERATION={}))[W.ADD=128]="ADD",W[W.REPLACE=0]="REPLACE",W[W.DELETE=64]="DELETE",W[W.DELETE_AND_ADD=192]="DELETE_AND_ADD",W[W.TOUCH=1]="TOUCH",W[W.CLEAR=10]="CLEAR";var w=function(){function q(N,q,C){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=N,this.setParent(q,C)}return q.prototype.setParent=function(N,q,C){var d=this;if(this.indexes||(this.indexes=this.ref instanceof YN?this.ref._definition.indexes:{}),this.parent=N,this.parentIndex=C,q)if(this.root=q,this.ref instanceof YN){var U=this.ref._definition;for(var W in U.schema){var a=this.ref[W];if(a&&a.$changes){var F=U.indexes[W];a.$changes.setParent(this.ref,q,F)}}}else"object"===typeof this.ref&&this.ref.forEach((function(N,q){if(N instanceof YN){var C=N.$changes,U=d.ref.$changes.indexes[q];C.setParent(d.ref,d.root,U)}}))},q.prototype.operation=function(N){this.changes.set(--this.currentCustomOperation,N)},q.prototype.change=function(q,C){void 0===C&&(C=N.OPERATION.ADD);var d="number"===typeof q?q:this.indexes[q];this.assertValidIndex(d,q);var U=this.changes.get(d);U&&U.op!==N.OPERATION.DELETE&&U.op!==N.OPERATION.TOUCH||this.changes.set(d,{op:U&&U.op===N.OPERATION.DELETE?N.OPERATION.DELETE_AND_ADD:C,index:d}),this.allChanges.add(d),this.changed=!0,this.touchParents()},q.prototype.touch=function(q){var C="number"===typeof q?q:this.indexes[q];this.assertValidIndex(C,q),this.changes.has(C)||this.changes.set(C,{op:N.OPERATION.TOUCH,index:C}),this.allChanges.add(C),this.touchParents()},q.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},q.prototype.getType=function(N){if(this.ref._definition)return(q=this.ref._definition).schema[q.fieldsByIndex[N]];var q,C=(q=this.parent._definition).schema[q.fieldsByIndex[this.parentIndex]];return Object.values(C)[0]},q.prototype.getChildrenFilter=function(){var N=this.parent._definition.childFilters;return N&&N[this.parentIndex]},q.prototype.getValue=function(N){return this.ref.getByIndex(N)},q.prototype.delete=function(q){var C="number"===typeof q?q:this.indexes[q];if(void 0!==C){var d=this.getValue(C);this.changes.set(C,{op:N.OPERATION.DELETE,index:C}),this.allChanges.delete(C),delete this.caches[C],d&&d.$changes&&(d.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(q," (").concat(C,")"))},q.prototype.discard=function(q,C){var d=this;void 0===q&&(q=!1),void 0===C&&(C=!1),this.ref instanceof YN||this.changes.forEach((function(q){if(q.op===N.OPERATION.DELETE){var C=d.ref.getIndex(q.index);delete d.indexes[C]}})),this.changes.clear(),this.changed=q,C&&this.allChanges.clear(),this.currentCustomOperation=0},q.prototype.discardAll=function(){var N=this;this.changes.forEach((function(q){var C=N.getValue(q.index);C&&C.$changes&&C.$changes.discardAll()})),this.discard()},q.prototype.cache=function(N,q){this.caches[N]=q},q.prototype.clone=function(){return new q(this.ref,this.parent,this.root)},q.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},q.prototype.assertValidIndex=function(N,q){if(void 0===N)throw new Error('ChangeTree: missing index for field "'.concat(q,'"'))},q}();function A(N,q,C,d){return N[q]||(N[q]=[]),N[q].push(C),null===d||void 0===d||d.forEach((function(N,q){return C(N,q)})),function(){return t(N[q],N[q].indexOf(C))}}function n(q){var C=this,d="string"!==typeof this.$changes.getType();this.$items.forEach((function(U,W){q.push({refId:C.$changes.refId,op:N.OPERATION.DELETE,field:W,value:void 0,previousValue:U}),d&&C.$changes.root.removeRef(U.$changes.refId)}))}function t(N,q){if(-1===q||q>=N.length)return!1;for(var C=N.length-1,d=q;d<C;d++)N[d]=N[d+1];return N.length=C,!0}var V=function(N,q){var C=N.toString(),d=q.toString();return C<d?-1:C>d?1:0};function Z(N){return N.$proxy=!0,N=new Proxy(N,{get:function(N,q){return"symbol"===typeof q||isNaN(q)?N[q]:N.at(q)},set:function(N,q,C){if("symbol"===typeof q||isNaN(q))N[q]=C;else{var d=Array.from(N.$items.keys()),U=parseInt(d[q]||q);void 0===C||null===C?N.deleteAt(U):N.setAt(U,C)}return!0},deleteProperty:function(N,q){return"number"===typeof q?N.deleteAt(q):delete N[q],!0}})}var J=function(){function q(){for(var N=[],q=0;q<arguments.length;q++)N[q]=arguments[q];this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,N)}return q.prototype.zF=function(q,C){return void 0===C&&(C=!0),A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,q,C?this.$items:void 0)},q.prototype.eq=function(q){return A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,q)},q.is=function(N){return Array.isArray(N)||void 0!==N.array},Object.defineProperty(q.prototype,"length",{get:function(){return this.$items.size},set:function(N){0===N?this.clear():this.splice(N,this.length-N)},enumerable:!1,configurable:!0}),q.prototype.push=function(){for(var N,q=this,C=[],d=0;d<arguments.length;d++)C[d]=arguments[d];return C.forEach((function(C){N=q.$refId++,q.setAt(N,C)})),N},q.prototype.pop=function(){var N=Array.from(this.$indexes.values()).pop();if(void 0!==N){this.$changes.delete(N),this.$indexes.delete(N);var q=this.$items.get(N);return this.$items.delete(N),q}},q.prototype.at=function(N){var q=Array.from(this.$items.keys())[N];return this.$items.get(q)},q.prototype.setAt=function(q,C){var d,U;if(void 0!==C&&null!==C){if(this.$items.get(q)!==C){void 0!==C.$changes&&C.$changes.setParent(this,this.$changes.root,q);var W=null!==(U=null===(d=this.$changes.indexes[q])||void 0===d?void 0:d.op)&&void 0!==U?U:N.OPERATION.ADD;this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,C),this.$changes.change(q,W)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},q.prototype.deleteAt=function(N){var q=Array.from(this.$items.keys())[N];return void 0!==q&&this.$deleteAt(q)},q.prototype.$deleteAt=function(N){return this.$changes.delete(N),this.$indexes.delete(N),this.$items.delete(N)},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&n.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.concat=function(){for(var N,C=[],d=0;d<arguments.length;d++)C[d]=arguments[d];return new(q.bind.apply(q,U([void 0],(N=Array.from(this.$items.values())).concat.apply(N,C),!1)))},q.prototype.join=function(N){return Array.from(this.$items.values()).join(N)},q.prototype.reverse=function(){var N=this,q=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(C,d){N.setAt(q[d],C)})),this},q.prototype.shift=function(){var N=Array.from(this.$items.keys()).shift();if(void 0!==N){var q=this.$items.get(N);return this.$deleteAt(N),q}},q.prototype.slice=function(N,C){var d=new q;return d.push.apply(d,Array.from(this.$items.values()).slice(N,C)),d},q.prototype.sort=function(N){var q=this;void 0===N&&(N=V);var C=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(N).forEach((function(N,d){q.setAt(C[d],N)})),this},q.prototype.splice=function(N,q){void 0===q&&(q=this.length-N);for(var C=Array.from(this.$items.keys()),d=[],U=N;U<N+q;U++)d.push(this.$items.get(C[U])),this.$deleteAt(C[U]);return d},q.prototype.unshift=function(){for(var N=this,q=[],C=0;C<arguments.length;C++)q[C]=arguments[C];var d=this.length,U=q.length,W=Array.from(this.$items.values());return q.forEach((function(q,C){N.setAt(C,q)})),W.forEach((function(q,C){N.setAt(U+C,q)})),d+U},q.prototype.indexOf=function(N,q){return Array.from(this.$items.values()).indexOf(N,q)},q.prototype.lastIndexOf=function(N,q){return void 0===q&&(q=this.length-1),Array.from(this.$items.values()).lastIndexOf(N,q)},q.prototype.every=function(N,q){return Array.from(this.$items.values()).every(N,q)},q.prototype.some=function(N,q){return Array.from(this.$items.values()).some(N,q)},q.prototype.forEach=function(N,q){Array.from(this.$items.values()).forEach(N,q)},q.prototype.map=function(N,q){return Array.from(this.$items.values()).map(N,q)},q.prototype.filter=function(N,q){return Array.from(this.$items.values()).filter(N,q)},q.prototype.reduce=function(N,q){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},q.prototype.reduceRight=function(N,q){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},q.prototype.find=function(N,q){return Array.from(this.$items.values()).find(N,q)},q.prototype.findIndex=function(N,q){return Array.from(this.$items.values()).findIndex(N,q)},q.prototype.fill=function(N,q,C){throw new Error("ArraySchema#fill() not implemented")},q.prototype.copyWithin=function(N,q,C){throw new Error("ArraySchema#copyWithin() not implemented")},q.prototype.toString=function(){return this.$items.toString()},q.prototype.toLocaleString=function(){return this.$items.toLocaleString()},q.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(q,Symbol.species,{get:function(){return q},enumerable:!1,configurable:!0}),q.prototype.entries=function(){return this.$items.entries()},q.prototype.keys=function(){return this.$items.keys()},q.prototype.values=function(){return this.$items.values()},q.prototype.includes=function(N,q){return Array.from(this.$items.values()).includes(N,q)},q.prototype.flatMap=function(N,q){throw new Error("ArraySchema#flatMap() is not supported.")},q.prototype.flat=function(N){throw new Error("ArraySchema#flat() is not supported.")},q.prototype.findLast=function(){var N=Array.from(this.$items.values());return N.findLast.apply(N,arguments)},q.prototype.findLastIndex=function(){var N=Array.from(this.$items.values());return N.findLastIndex.apply(N,arguments)},q.prototype.setIndex=function(N,q){this.$indexes.set(N,q)},q.prototype.getIndex=function(N){return this.$indexes.get(N)},q.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},q.prototype.deleteByIndex=function(N){var q=this.$indexes.get(N);this.$items.delete(q),this.$indexes.delete(N)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){return this.toArray().map((function(N){return"function"===typeof N.toJSON?N.toJSON():N}))},q.prototype.clone=function(N){return N?new(q.bind.apply(q,U([void 0],Array.from(this.$items.values()),!1))):new(q.bind.apply(q,U([void 0],this.map((function(N){return N.$changes?N.clone():N})),!1)))},q}();function Q(N){return N.$proxy=!0,N=new Proxy(N,{get:function(N,q){return"symbol"!==typeof q&&"undefined"===typeof N[q]?N.get(q):N[q]},set:function(N,q,C){return"symbol"!==typeof q&&-1===q.indexOf("$")&&"zF"!==q&&"eq"!==q&&"onChange"!==q?N.set(q,C):N[q]=C,!0},deleteProperty:function(N,q){return N.delete(q),!0}})}var v=function(){function q(N){var C=this;if(this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N)if(N instanceof Map||N instanceof q)N.forEach((function(N,q){return C.set(q,N)}));else for(var d in N)this.set(d,N[d])}return q.prototype.zF=function(q,C){return void 0===C&&(C=!0),A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,q,C?this.$items:void 0)},q.prototype.eq=function(q){return A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,q)},q.is=function(N){return void 0!==N.map},q.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(q.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(q,Symbol.species,{get:function(){return q},enumerable:!1,configurable:!0}),q.prototype.set=function(q,C){if(void 0===C||null===C)throw new Error("MapSchema#set('".concat(q,"', ").concat(C,"): trying to set ").concat(C," value on '").concat(q,"'."));q=q.toString();var d="undefined"!==typeof this.$changes.indexes[q],U=d?this.$changes.indexes[q]:this.$refId++,W=d?N.OPERATION.REPLACE:N.OPERATION.ADD,a=void 0!==C.$changes;if(a&&C.$changes.setParent(this,this.$changes.root,U),d){if(!a&&this.$items.get(q)===C)return;a&&this.$items.get(q)!==C&&(W=N.OPERATION.ADD)}else this.$changes.indexes[q]=U,this.$indexes.set(U,q);return this.$items.set(q,C),this.$changes.change(q,W),this},q.prototype.get=function(N){return this.$items.get(N)},q.prototype.delete=function(N){return this.$changes.delete(N),this.$items.delete(N)},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&n.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(N){return this.$items.has(N)},q.prototype.forEach=function(N){this.$items.forEach(N)},q.prototype.entries=function(){return this.$items.entries()},q.prototype.keys=function(){return this.$items.keys()},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(N,q){this.$indexes.set(N,q)},q.prototype.getIndex=function(N){return this.$indexes.get(N)},q.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},q.prototype.deleteByIndex=function(N){var q=this.$indexes.get(N);this.$items.delete(q),this.$indexes.delete(N)},q.prototype.toJSON=function(){var N={};return this.forEach((function(q,C){N[C]="function"===typeof q.toJSON?q.toJSON():q})),N},q.prototype.clone=function(N){var C;return N?C=Object.assign(new q,this):(C=new q,this.forEach((function(N,q){N.$changes?C.set(q,N.clone()):C.set(q,N)}))),C},q}(),r={};function O(N,q){r[N]=q}function K(N){return r[N]}var i=function(){function N(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return N.create=function(q){var C=new N;return C.schema=Object.assign({},q&&q.schema||{}),C.indexes=Object.assign({},q&&q.indexes||{}),C.fieldsByIndex=Object.assign({},q&&q.fieldsByIndex||{}),C.descriptors=Object.assign({},q&&q.descriptors||{}),C.deprecated=Object.assign({},q&&q.deprecated||{}),C},N.prototype.addField=function(N,q){var C=this.getNextFieldIndex();this.fieldsByIndex[C]=N,this.indexes[N]=C,this.schema[N]=Array.isArray(q)?{array:q[0]}:q},N.prototype.hasField=function(N){return void 0!==this.indexes[N]},N.prototype.addFilter=function(N,q){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[N]]=q,this.indexesWithFilters.push(this.indexes[N]),!0},N.prototype.addChildrenFilter=function(N,q){var C=this.indexes[N],d=this.schema[N];if(K(Object.keys(d)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[C]=q,!0;console.warn("@filterChildren: field '".concat(N,"' can't have children. Ignoring filter."))},N.prototype.getChildrenFilter=function(N){return this.childFilters&&this.childFilters[this.indexes[N]]},N.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},N}();function I(N){return N._context&&N._context.useFilters}var j=function(){function N(){this.types={},this.schemas=new Map,this.useFilters=!1}return N.prototype.has=function(N){return this.schemas.has(N)},N.prototype.get=function(N){return this.types[N]},N.prototype.add=function(N,q){void 0===q&&(q=this.schemas.size),N._definition=i.create(N._definition),N._typeid=q,this.types[q]=N,this.schemas.set(N,q)},N.create=function(q){return void 0===q&&(q={}),function(C){return q.context||(q.context=new N),T(C,q)}},N}(),l=new j;function T(N,q){return void 0===q&&(q={}),function(C,d){var W=q.context||l,a=C.constructor;if(a._context=W,!N)throw new Error("".concat(a.name,': @type() reference provided for "').concat(d,"\" is undefined. Make sure you don't have any circular dependencies."));W.has(a)||W.add(a);var F=a._definition;if(F.addField(d,N),F.descriptors[d]){if(F.deprecated[d])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(d,"' definition on '").concat(a.name,"'.\nCheck @type() annotation"))}catch(r){var w=r.stack.split("\n")[4].trim();throw new Error("".concat(r.message," ").concat(w))}}var A=J.is(N),n=!A&&v.is(N);if("string"!==typeof N&&!YN.is(N)){var t=Object.values(N)[0];"string"===typeof t||W.has(t)||W.add(t)}if(q.manual)F.descriptors[d]={enumerable:!0,configurable:!0,writable:!0};else{var V="_".concat(d);F.descriptors[V]={enumerable:!1,configurable:!1,writable:!0},F.descriptors[d]={get:function(){return this[V]},set:function(N){N!==this[V]&&(void 0!==N&&null!==N?(!A||N instanceof J||(N=new(J.bind.apply(J,U([void 0],N,!1)))),!n||N instanceof v||(N=new v(N)),void 0===N.$proxy&&(n?N=Q(N):A&&(N=Z(N))),this.$changes.change(d),N.$changes&&N.$changes.setParent(this,this.$changes.root,this._definition.indexes[d])):this[V]&&this.$changes.delete(d),this[V]=N)},enumerable:!0,configurable:!0}}}}function z(N){return function(q,C){var d=q.constructor;d._definition.addFilter(C,N)&&(d._context.useFilters=!0)}}function p(N){return function(q,C){var d=q.constructor;d._definition.addChildrenFilter(C,N)&&(d._context.useFilters=!0)}}function s(N){return void 0===N&&(N=!0),function(q,C){var d=q.constructor._definition;d.deprecated[C]=!0,N&&(d.descriptors[C]={get:function(){throw new Error("".concat(C," is deprecated."))},set:function(N){},enumerable:!1,configurable:!0})}}function X(N,q,C){for(var d in void 0===C&&(C={}),C.context||(C.context=N._context||C.context||l),q)T(q[d],C)(N.prototype,d);return N}function P(N){for(var q=0,C=0,d=0,U=N.length;d<U;d++)(q=N.charCodeAt(d))<128?C+=1:q<2048?C+=2:q<55296||q>=57344?C+=3:(d++,C+=4);return C}function M(N,q,C){for(var d=0,U=0,W=C.length;U<W;U++)(d=C.charCodeAt(U))<128?N[q++]=d:d<2048?(N[q++]=192|d>>6,N[q++]=128|63&d):d<55296||d>=57344?(N[q++]=224|d>>12,N[q++]=128|d>>6&63,N[q++]=128|63&d):(U++,d=65536+((1023&d)<<10|1023&C.charCodeAt(U)),N[q++]=240|d>>18,N[q++]=128|d>>12&63,N[q++]=128|d>>6&63,N[q++]=128|63&d)}function Y(N,q){N.push(255&q)}function E(N,q){N.push(255&q)}function H(N,q){N.push(255&q),N.push(q>>8&255)}function e(N,q){N.push(255&q),N.push(q>>8&255)}function b(N,q){N.push(255&q),N.push(q>>8&255),N.push(q>>16&255),N.push(q>>24&255)}function o(N,q){var C=q>>24,d=q>>16,U=q>>8,W=q;N.push(255&W),N.push(255&U),N.push(255&d),N.push(255&C)}function S(N,q){var C=Math.floor(q/Math.pow(2,32));o(N,q>>>0),o(N,C)}function D(N,q){var C=q/Math.pow(2,32)|0;o(N,q>>>0),o(N,C)}function c(N,q){y(N,q)}function L(N,q){R(N,q)}var G=new Int32Array(2),h=new Float32Array(G.buffer),B=new Float64Array(G.buffer);function y(N,q){h[0]=q,b(N,G[0])}function R(N,q){B[0]=q,b(N,G[0]),b(N,G[1])}function u(N,q){return E(N,q?1:0)}function m(N,q){q||(q="");var C=P(q),d=0;if(C<32)N.push(160|C),d=1;else if(C<256)N.push(217),E(N,C),d=2;else if(C<65536)N.push(218),e(N,C),d=3;else{if(!(C<4294967296))throw new Error("String too long");N.push(219),o(N,C),d=5}return M(N,N.length,q),d+C}function f(N,q){return isNaN(q)?f(N,0):isFinite(q)?q!==(0|q)?(N.push(203),R(N,q),9):q>=0?q<128?(E(N,q),1):q<256?(N.push(204),E(N,q),2):q<65536?(N.push(205),e(N,q),3):q<4294967296?(N.push(206),o(N,q),5):(N.push(207),D(N,q),9):q>=-32?(N.push(224|q+32),1):q>=-128?(N.push(208),Y(N,q),2):q>=-32768?(N.push(209),H(N,q),3):q>=-2147483648?(N.push(210),b(N,q),5):(N.push(211),S(N,q),9):f(N,q>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var k=Object.freeze({__proto__:null,utf8Write:M,int8:Y,uint8:E,int16:H,uint16:e,int32:b,uint32:o,int64:S,uint64:D,float32:c,float64:L,writeFloat32:y,writeFloat64:R,boolean:u,string:m,number:f});function g(N,q,C){for(var d="",U=0,W=q,a=q+C;W<a;W++){var F=N[W];0!==(128&F)?192!==(224&F)?224!==(240&F)?240!==(248&F)?console.error("Invalid byte "+F.toString(16)):(U=(7&F)<<18|(63&N[++W])<<12|(63&N[++W])<<6|63&N[++W])>=65536?(U-=65536,d+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):d+=String.fromCharCode(U):d+=String.fromCharCode((15&F)<<12|(63&N[++W])<<6|63&N[++W]):d+=String.fromCharCode((31&F)<<6|63&N[++W]):d+=String.fromCharCode(F)}return d}function x(N,q){return NN(N,q)<<24>>24}function NN(N,q){return N[q.offset++]}function qN(N,q){return CN(N,q)<<16>>16}function CN(N,q){return N[q.offset++]|N[q.offset++]<<8}function dN(N,q){return N[q.offset++]|N[q.offset++]<<8|N[q.offset++]<<16|N[q.offset++]<<24}function UN(N,q){return dN(N,q)>>>0}function WN(N,q){return VN(N,q)}function aN(N,q){return ZN(N,q)}function FN(N,q){var C=UN(N,q);return dN(N,q)*Math.pow(2,32)+C}function wN(N,q){var C=UN(N,q);return UN(N,q)*Math.pow(2,32)+C}var AN=new Int32Array(2),nN=new Float32Array(AN.buffer),tN=new Float64Array(AN.buffer);function VN(N,q){return AN[0]=dN(N,q),nN[0]}function ZN(N,q){return AN[0]=dN(N,q),AN[1]=dN(N,q),tN[0]}function JN(N,q){return NN(N,q)>0}function QN(N,q){var C,d=N[q.offset++];d<192?C=31&d:217===d?C=NN(N,q):218===d?C=CN(N,q):219===d&&(C=UN(N,q));var U=g(N,q.offset,C);return q.offset+=C,U}function vN(N,q){var C=N[q.offset];return C<192&&C>160||217===C||218===C||219===C}function rN(N,q){var C=N[q.offset++];return C<128?C:202===C?VN(N,q):203===C?ZN(N,q):204===C?NN(N,q):205===C?CN(N,q):206===C?UN(N,q):207===C?wN(N,q):208===C?x(N,q):209===C?qN(N,q):210===C?dN(N,q):211===C?FN(N,q):C>223?-1*(255-C+1):void 0}function ON(N,q){var C=N[q.offset];return C<128||C>=202&&C<=211}function KN(N,q){return N[q.offset]<160}function iN(N,q){return N[q.offset-1]===a&&(N[q.offset]<128||N[q.offset]>=202&&N[q.offset]<=211)}var IN=Object.freeze({__proto__:null,int8:x,uint8:NN,int16:qN,uint16:CN,int32:dN,uint32:UN,float32:WN,float64:aN,int64:FN,uint64:wN,readFloat32:VN,readFloat64:ZN,boolean:JN,string:QN,stringCheck:vN,number:rN,numberCheck:ON,arrayCheck:KN,switchStructureCheck:iN}),jN=function(){function q(N){var q=this;this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N&&N.forEach((function(N){return q.add(N)}))}return q.prototype.zF=function(q,C){return void 0===C&&(C=!0),A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,q,C?this.$items:void 0)},q.prototype.eq=function(q){return A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,q)},q.is=function(N){return void 0!==N.collection},q.prototype.add=function(N){var q=this.$refId++;return void 0!==N.$changes&&N.$changes.setParent(this,this.$changes.root,q),this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,N),this.$changes.change(q),q},q.prototype.at=function(N){var q=Array.from(this.$items.keys())[N];return this.$items.get(q)},q.prototype.entries=function(){return this.$items.entries()},q.prototype.delete=function(N){for(var q,C,d=this.$items.entries();(C=d.next())&&!C.done;)if(N===C.value[1]){q=C.value[0];break}return void 0!==q&&(this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q))},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&n.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(N){return Array.from(this.$items.values()).some((function(q){return q===N}))},q.prototype.forEach=function(N){var q=this;this.$items.forEach((function(C,d,U){return N(C,d,q)}))},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(N,q){this.$indexes.set(N,q)},q.prototype.getIndex=function(N){return this.$indexes.get(N)},q.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},q.prototype.deleteByIndex=function(N){var q=this.$indexes.get(N);this.$items.delete(q),this.$indexes.delete(N)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){var N=[];return this.forEach((function(q,C){N.push("function"===typeof q.toJSON?q.toJSON():q)})),N},q.prototype.clone=function(N){var C;return N?C=Object.assign(new q,this):(C=new q,this.forEach((function(N){N.$changes?C.add(N.clone()):C.add(N)}))),C},q}(),lN=function(){function q(N){var q=this;this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N&&N.forEach((function(N){return q.add(N)}))}return q.prototype.zF=function(q,C){return void 0===C&&(C=!0),A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,q,C?this.$items:void 0)},q.prototype.eq=function(q){return A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,q)},q.is=function(N){return void 0!==N.set},q.prototype.add=function(q){var C,d;if(this.has(q))return!1;var U=this.$refId++;void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,U);var W=null!==(d=null===(C=this.$changes.indexes[U])||void 0===C?void 0:C.op)&&void 0!==d?d:N.OPERATION.ADD;return this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,q),this.$changes.change(U,W),U},q.prototype.entries=function(){return this.$items.entries()},q.prototype.delete=function(N){for(var q,C,d=this.$items.entries();(C=d.next())&&!C.done;)if(N===C.value[1]){q=C.value[0];break}return void 0!==q&&(this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q))},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&n.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(N){for(var q,C=this.$items.values(),d=!1;(q=C.next())&&!q.done;)if(N===q.value){d=!0;break}return d},q.prototype.forEach=function(N){var q=this;this.$items.forEach((function(C,d,U){return N(C,d,q)}))},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(N,q){this.$indexes.set(N,q)},q.prototype.getIndex=function(N){return this.$indexes.get(N)},q.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},q.prototype.deleteByIndex=function(N){var q=this.$indexes.get(N);this.$items.delete(q),this.$indexes.delete(N)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){var N=[];return this.forEach((function(q,C){N.push("function"===typeof q.toJSON?q.toJSON():q)})),N},q.prototype.clone=function(N){var C;return N?C=Object.assign(new q,this):(C=new q,this.forEach((function(N){N.$changes?C.add(N.clone()):C.add(N)}))),C},q}(),TN=function(){function N(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return N.prototype.addRefId=function(N){this.refIds.has(N)||(this.refIds.add(N),this.containerIndexes.set(N,new Set))},N.get=function(q){return void 0===q.$filterState&&(q.$filterState=new N),q.$filterState},N}(),zN=function(){function N(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return N.prototype.getNextUniqueId=function(){return this.nextUniqueId++},N.prototype.addRef=function(N,q,C){void 0===C&&(C=!0),this.refs.set(N,q),C&&(this.refCounts[N]=(this.refCounts[N]||0)+1)},N.prototype.removeRef=function(N){this.refCounts[N]=this.refCounts[N]-1,this.deletedRefs.add(N)},N.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},N.prototype.garbageCollectDeletedRefs=function(){var N=this;this.deletedRefs.forEach((function(q){if(!(N.refCounts[q]>0)){var C=N.refs.get(q);if(C instanceof YN)for(var d in C._definition.schema)"string"!==typeof C._definition.schema[d]&&C[d]&&C[d].$changes&&N.removeRef(C[d].$changes.refId);else{var U=C.$changes.parent._definition,W=U.schema[U.fieldsByIndex[C.$changes.parentIndex]];"function"===typeof Object.values(W)[0]&&Array.from(C.values()).forEach((function(q){return N.removeRef(q.$changes.refId)}))}N.refs.delete(q),delete N.refCounts[q]}})),this.deletedRefs.clear()},N}(),pN=function(N){function q(){return null!==N&&N.apply(this,arguments)||this}return C(q,N),q}(Error);function sN(N,q,C,d){var U,W=!1;switch(q){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":U="number",isNaN(N)&&console.log('trying to encode "NaN" in '.concat(C.constructor.name,"#").concat(d));break;case"string":U="string",W=!0;break;case"boolean":return}if(typeof N!==U&&(!W||W&&null!==N)){var a="'".concat(JSON.stringify(N),"'").concat(N&&N.constructor&&" (".concat(N.constructor.name,")")||"");throw new pN("a '".concat(U,"' was expected, but ").concat(a," was provided in ").concat(C.constructor.name,"#").concat(d))}}function XN(N,q,C,d){if(!(N instanceof q))throw new pN("a '".concat(q.name,"' was expected, but '").concat(N.constructor.name,"' was provided in ").concat(C.constructor.name,"#").concat(d))}function PN(N,q,C,d,U){sN(C,N,d,U);var W=k[N];if(!W)throw new pN("a '".concat(N,"' was expected, but ").concat(C," was provided in ").concat(d.constructor.name,"#").concat(U));W(q,C)}function MN(N,q,C){return IN[N](q,C)}var YN=function(){function q(){for(var N=[],q=0;q<arguments.length;q++)N[q]=arguments[q];Object.defineProperties(this,{$changes:{value:new w(this,void 0,new zN),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var C=this._definition.descriptors;C&&Object.defineProperties(this,C),N[0]&&this.assign(N[0])}return q.onError=function(N){console.error(N)},q.is=function(N){return N._definition&&void 0!==N._definition.schema},q.prototype.onChange=function(q){return A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,q)},q.prototype.eq=function(q){return A(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,q)},q.prototype.assign=function(N){return Object.assign(this,N),this},Object.defineProperty(q.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),q.prototype.setDirty=function(N,q){this.$changes.change(N,q)},q.prototype.listen=function(N,q,C){var d=this;return void 0===C&&(C=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[N]||(this.$callbacks[N]=[]),this.$callbacks[N].push(q),C&&void 0!==this[N]&&q(this[N],void 0),function(){return t(d.$callbacks[N],d.$callbacks[N].indexOf(q))}},q.prototype.decode=function(C,d,U){var W;void 0===d&&(d={offset:0}),void 0===U&&(U=this);var F=[],w=this.$changes.root,A=C.length,n=0;for(w.refs.set(n,this);d.offset<A;){var t=C[d.offset++];if(t!=a){var V=U.$changes,Z=void 0!==U._definition,Q=Z?t>>6<<6:t;if(Q!==N.OPERATION.CLEAR){var r=Z?t%(Q||255):rN(C,d),O=Z?U._definition.fieldsByIndex[r]:"",i=V.getType(r),I=void 0,j=void 0,l=void 0;if(Z?j=U["_".concat(O)]:(j=U.getByIndex(r),(Q&N.OPERATION.ADD)===N.OPERATION.ADD?(l=U instanceof v?QN(C,d):r,U.setIndex(r,l)):l=U.getIndex(r)),(Q&N.OPERATION.DELETE)===N.OPERATION.DELETE&&(Q!==N.OPERATION.DELETE_AND_ADD&&U.deleteByIndex(r),j&&j.$changes&&w.removeRef(j.$changes.refId),I=null),void 0!==O){if(Q===N.OPERATION.DELETE);else if(q.is(i)){var T=rN(C,d);if(I=w.refs.get(T),Q!==N.OPERATION.REPLACE){var z=this.getSchemaType(C,d,i);I||((I=this.createTypeInstance(z)).$changes.refId=T,j&&(I.$callbacks=j.$callbacks,j.$changes.refId&&T!==j.$changes.refId&&w.removeRef(j.$changes.refId))),w.addRef(T,I,I!==j)}}else if("string"===typeof i)I=MN(i,C,d);else{var p=K(Object.keys(i)[0]),s=rN(C,d),X=w.refs.has(s)?j||w.refs.get(s):new p.constructor;if((I=X.clone(!0)).$changes.refId=s,j&&(I.$callbacks=j.$callbacks,j.$changes.refId&&s!==j.$changes.refId)){w.removeRef(j.$changes.refId);for(var P=j.entries(),M=void 0;(M=P.next())&&!M.done;){var Y=(W=M.value)[0],E=W[1];F.push({refId:s,op:N.OPERATION.DELETE,field:Y,value:void 0,previousValue:E})}}w.addRef(s,I,X!==j)}if(null!==I&&void 0!==I)if(I.$changes&&I.$changes.setParent(V.ref,V.root,r),U instanceof q)U[O]=I;else if(U instanceof v)Y=l,U.$items.set(Y,I),U.$changes.allChanges.add(r);else if(U instanceof J)U.setAt(r,I);else if(U instanceof jN){var H=U.add(I);U.setIndex(r,H)}else U instanceof lN&&!1!==(H=U.add(I))&&U.setIndex(r,H);j!==I&&F.push({refId:n,op:Q,field:O,dynamicIndex:l,value:I,previousValue:j})}else{console.warn("@colyseus/schema: definition mismatch");for(var e={offset:d.offset};d.offset<A&&(!iN(C,d)||(e.offset=d.offset+1,!w.refs.has(rN(C,e))));)d.offset++}}else U.clear(F)}else{n=rN(C,d);var b=w.refs.get(n);if(!b)throw new Error('"refId" not found: '.concat(n));U=b}}return this._triggerChanges(F),w.garbageCollectDeletedRefs(),F},q.prototype.encode=function(C,d,U){void 0===C&&(C=!1),void 0===d&&(d=[]),void 0===U&&(U=!1);for(var W=this.$changes,F=new WeakSet,w=[W],A=1,n=0;n<A;n++){var t=w[n],V=t.ref,Z=V instanceof q;t.ensureRefId(),F.add(t),t!==W&&(t.changed||C)&&(E(d,a),f(d,t.refId));for(var J=C?Array.from(t.allChanges):Array.from(t.changes.values()),Q=0,r=J.length;Q<r;Q++){var O=C?{op:N.OPERATION.ADD,index:J[Q]}:J[Q],i=O.index,I=Z?V._definition.fieldsByIndex&&V._definition.fieldsByIndex[i]:i,j=d.length;if(O.op!==N.OPERATION.TOUCH)if(Z)E(d,i|O.op);else{if(E(d,O.op),O.op===N.OPERATION.CLEAR)continue;f(d,i)}if(Z||(O.op&N.OPERATION.ADD)!=N.OPERATION.ADD||V instanceof v&&m(d,t.ref.$indexes.get(i)),O.op!==N.OPERATION.DELETE){var l=t.getType(i),T=t.getValue(i);if(T&&T.$changes&&!F.has(T.$changes)&&(w.push(T.$changes),T.$changes.ensureRefId(),A++),O.op!==N.OPERATION.TOUCH){if(q.is(l))XN(T,l,V,I),f(d,T.$changes.refId),(O.op&N.OPERATION.ADD)===N.OPERATION.ADD&&this.tryEncodeTypeId(d,l,T.constructor);else if("string"===typeof l)PN(l,d,T,V,I);else{var z=K(Object.keys(l)[0]);XN(V["_".concat(I)],z.constructor,V,I),f(d,T.$changes.refId)}U&&t.cache(i,d.slice(j))}}}C||U||t.discard()}return d},q.prototype.encodeAll=function(N){return this.encode(!0,[],N)},q.prototype.applyFilters=function(C,d){var U,W;void 0===d&&(d=!1);for(var F=this,w=new Set,A=TN.get(C),n=[this.$changes],t=1,V=[],Z=function(Z){var J=n[Z];if(w.has(J.refId))return"continue";var Q=J.ref,r=Q instanceof q;E(V,a),f(V,J.refId);var O=A.refIds.has(J),K=d||!O;A.addRefId(J);var i=A.containerIndexes.get(J),I=K?Array.from(J.allChanges):Array.from(J.changes.values());!d&&r&&Q._definition.indexesWithFilters&&Q._definition.indexesWithFilters.forEach((function(q){!i.has(q)&&J.allChanges.has(q)&&(K?I.push(q):I.push({op:N.OPERATION.ADD,index:q}))}));for(var j=0,l=I.length;j<l;j++){var T=K?{op:N.OPERATION.ADD,index:I[j]}:I[j];if(T.op!==N.OPERATION.CLEAR){var z=T.index;if(T.op!==N.OPERATION.DELETE){var p=J.getValue(z),s=J.getType(z);if(r){if((X=Q._definition.filters&&Q._definition.filters[z])&&!X.call(Q,C,p,F)){p&&p.$changes&&w.add(p.$changes.refId);continue}}else{var X,P=J.parent;if((X=J.getChildrenFilter())&&!X.call(P,C,Q.$indexes.get(z),p,F)){p&&p.$changes&&w.add(p.$changes.refId);continue}}if(p.$changes&&(n.push(p.$changes),t++),T.op!==N.OPERATION.TOUCH)if(T.op===N.OPERATION.ADD||r)V.push.apply(V,null!==(U=J.caches[z])&&void 0!==U?U:[]),i.add(z);else if(i.has(z))V.push.apply(V,null!==(W=J.caches[z])&&void 0!==W?W:[]);else{if(i.add(z),E(V,N.OPERATION.ADD),f(V,z),Q instanceof v){var M=J.ref.$indexes.get(z);m(V,M)}p.$changes?f(V,p.$changes.refId):k[s](V,p)}else p.$changes&&!r&&(E(V,N.OPERATION.ADD),f(V,z),Q instanceof v&&(M=J.ref.$indexes.get(z),m(V,M)),f(V,p.$changes.refId))}else r?E(V,T.op|z):(E(V,T.op),f(V,z))}else E(V,T.op)}},J=0;J<t;J++)Z(J);return V},q.prototype.clone=function(){var N,q=new this.constructor,C=this._definition.schema;for(var d in C)"object"===typeof this[d]&&"function"===typeof(null===(N=this[d])||void 0===N?void 0:N.clone)?q[d]=this[d].clone():q[d]=this[d];return q},q.prototype.toJSON=function(){var N=this._definition.schema,q=this._definition.deprecated,C={};for(var d in N)q[d]||null===this[d]||"undefined"===typeof this[d]||(C[d]="function"===typeof this[d].toJSON?this[d].toJSON():this["_".concat(d)]);return C},q.prototype.discardAllChanges=function(){this.$changes.discardAll()},q.prototype.getByIndex=function(N){return this[this._definition.fieldsByIndex[N]]},q.prototype.deleteByIndex=function(N){this[this._definition.fieldsByIndex[N]]=void 0},q.prototype.tryEncodeTypeId=function(N,q,C){q._typeid!==C._typeid&&(E(N,F),f(N,C._typeid))},q.prototype.getSchemaType=function(N,q,C){var d;return N[q.offset]===F&&(q.offset++,d=this.constructor._context.get(rN(N,q))),d||C},q.prototype.createTypeInstance=function(N){var q=new N;return q.$changes.root=this.$changes.root,q},q.prototype._triggerChanges=function(C){for(var d,U,W,a,F,w,A,n,t,V=new Set,Z=this.$changes.root.refs,J=function(J){var Q=C[J],v=Q.refId,r=Z.get(v),O=r.$callbacks;if((Q.op&N.OPERATION.DELETE)===N.OPERATION.DELETE&&Q.previousValue instanceof q&&(null===(U=null===(d=Q.previousValue.$callbacks)||void 0===d?void 0:d[N.OPERATION.DELETE])||void 0===U||U.forEach((function(N){return N()}))),!O)return"continue";if(r instanceof q){if(!V.has(v))try{null===(W=null===O||void 0===O?void 0:O[N.OPERATION.REPLACE])||void 0===W||W.forEach((function(N){return N()}))}catch(K){q.onError(K)}try{O.hasOwnProperty(Q.field)&&(null===(a=O[Q.field])||void 0===a||a.forEach((function(N){return N(Q.value,Q.previousValue)})))}catch(K){q.onError(K)}}else Q.op===N.OPERATION.ADD&&void 0===Q.previousValue?null===(F=O[N.OPERATION.ADD])||void 0===F||F.forEach((function(N){var q;return N(Q.value,null!==(q=Q.dynamicIndex)&&void 0!==q?q:Q.field)})):Q.op===N.OPERATION.DELETE?void 0!==Q.previousValue&&(null===(w=O[N.OPERATION.DELETE])||void 0===w||w.forEach((function(N){var q;return N(Q.previousValue,null!==(q=Q.dynamicIndex)&&void 0!==q?q:Q.field)}))):Q.op===N.OPERATION.DELETE_AND_ADD&&(void 0!==Q.previousValue&&(null===(A=O[N.OPERATION.DELETE])||void 0===A||A.forEach((function(N){var q;return N(Q.previousValue,null!==(q=Q.dynamicIndex)&&void 0!==q?q:Q.field)}))),null===(n=O[N.OPERATION.ADD])||void 0===n||n.forEach((function(N){var q;return N(Q.value,null!==(q=Q.dynamicIndex)&&void 0!==q?q:Q.field)}))),Q.value!==Q.previousValue&&(null===(t=O[N.OPERATION.REPLACE])||void 0===t||t.forEach((function(N){var q;return N(Q.value,null!==(q=Q.dynamicIndex)&&void 0!==q?q:Q.field)})));V.add(v)},Q=0;Q<C.length;Q++)J(Q)},q._definition=i.create(),q}();function EN(N){for(var q=[N.$changes],C=1,d={},U=d,W=function(N){var C=q[N];C.changes.forEach((function(N){var q=C.ref,d=N.index,W=q._definition?q._definition.fieldsByIndex[d]:q.$indexes.get(d);U[W]=C.getValue(d)}))},a=0;a<C;a++)W(a);return d}var HN={context:new j},eN=function(N){function q(){return null!==N&&N.apply(this,arguments)||this}return C(q,N),d([T("string",HN)],q.prototype,"name",void 0),d([T("string",HN)],q.prototype,"type",void 0),d([T("number",HN)],q.prototype,"referencedType",void 0),q}(YN),bN=function(N){function q(){var q=null!==N&&N.apply(this,arguments)||this;return q.fields=new J,q}return C(q,N),d([T("number",HN)],q.prototype,"id",void 0),d([T([eN],HN)],q.prototype,"fields",void 0),q}(YN),oN=function(N){function q(){var q=null!==N&&N.apply(this,arguments)||this;return q.types=new J,q}return C(q,N),q.encode=function(N){var C=N.constructor,d=new q;d.rootType=C._typeid;var U=function(N,q){for(var C in q){var U=new eN;U.name=C;var W=void 0;if("string"===typeof q[C])W=q[C];else{var a=q[C],F=void 0;YN.is(a)?(W="ref",F=q[C]):"string"===typeof a[W=Object.keys(a)[0]]?W+=":"+a[W]:F=a[W],U.referencedType=F?F._typeid:-1}U.type=W,N.fields.push(U)}d.types.push(N)},W=C._context.types;for(var a in W){var F=new bN;F.id=Number(a),U(F,W[a]._definition.schema)}return d.encodeAll()},q.decode=function(N,d){var U=new j,W=new q;W.decode(N,d);var a=W.types.reduce((function(N,q){var d=function(N){function q(){return null!==N&&N.apply(this,arguments)||this}return C(q,N),q}(YN),W=q.id;return N[W]=d,U.add(d,W),N}),{});W.types.forEach((function(N){var q=a[N.id];N.fields.forEach((function(N){var C;if(void 0!==N.referencedType){var d=N.type,W=a[N.referencedType];if(!W){var F=N.type.split(":");d=F[0],W=F[1]}"ref"===d?T(W,{context:U})(q.prototype,N.name):T(((C={})[d]=W,C),{context:U})(q.prototype,N.name)}else T(N.type,{context:U})(q.prototype,N.name)}))}));var F=a[W.rootType],w=new F;for(var A in F._definition.schema){var n=F._definition.schema[A];"string"!==typeof n&&(w[A]="function"===typeof n?new n:new(K(Object.keys(n)[0]).constructor))}return w},d([T([bN],HN)],q.prototype,"types",void 0),d([T("number",HN)],q.prototype,"rootType",void 0),q}(YN);O("map",{constructor:v}),O("array",{constructor:J}),O("set",{constructor:lN}),O("collection",{constructor:jN}),N.ArraySchema=J,N.CollectionSchema=jN,N.Context=j,N.MapSchema=v,N.Reflection=oN,N.ReflectionField=eN,N.ReflectionType=bN,N.Schema=YN,N.SchemaDefinition=i,N.SetSchema=lN,N.decode=IN,N.defineTypes=X,N.deprecated=s,N.dumpChanges=EN,N.encode=k,N.filter=z,N.filterChildren=p,N.hasFilter=I,N.registerType=O,N.type=T,Object.defineProperty(N,"__esModule",{value:!0})}(q)},13230:N=>{"use strict";N.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13224:(N,q,C)=>{var d=C(13230),U=C(13234),W=Object.hasOwnProperty,a=Object.create(null);for(var F in d)W.call(d,F)&&(a[d[F]]=F);var w=N.exports={to:{},get:{}};function A(N,q,C){return Math.min(Math.max(q,N),C)}function n(N){var q=Math.round(N).toString(16).toUpperCase();return q.length<2?"0"+q:q}w.get=function(N){var q,C;switch(N.substring(0,3).toLowerCase()){case"hsl":q=w.get.hsl(N),C="hsl";break;case"hwb":q=w.get.hwb(N),C="hwb";break;default:q=w.get.rgb(N),C="rgb"}return q?{model:C,value:q}:null},w.get.rgb=function(N){if(!N)return null;var q,C,U,a=[0,0,0,1];if(q=N.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(U=q[2],q=q[1],C=0;C<3;C++){var F=2*C;a[C]=parseInt(q.slice(F,F+2),16)}U&&(a[3]=parseInt(U,16)/255)}else if(q=N.match(/^#([a-f0-9]{3,4})$/i)){for(U=(q=q[1])[3],C=0;C<3;C++)a[C]=parseInt(q[C]+q[C],16);U&&(a[3]=parseInt(U+U,16)/255)}else if(q=N.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(C=0;C<3;C++)a[C]=parseInt(q[C+1],0);q[4]&&(q[5]?a[3]=.01*parseFloat(q[4]):a[3]=parseFloat(q[4]))}else{if(!(q=N.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(q=N.match(/^(\w+)$/))?"transparent"===q[1]?[0,0,0,0]:W.call(d,q[1])?((a=d[q[1]])[3]=1,a):null:null;for(C=0;C<3;C++)a[C]=Math.round(2.55*parseFloat(q[C+1]));q[4]&&(q[5]?a[3]=.01*parseFloat(q[4]):a[3]=parseFloat(q[4]))}for(C=0;C<3;C++)a[C]=A(a[C],0,255);return a[3]=A(a[3],0,1),a},w.get.hsl=function(N){if(!N)return null;var q=N.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(q){var C=parseFloat(q[4]);return[(parseFloat(q[1])%360+360)%360,A(parseFloat(q[2]),0,100),A(parseFloat(q[3]),0,100),A(isNaN(C)?1:C,0,1)]}return null},w.get.hwb=function(N){if(!N)return null;var q=N.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(q){var C=parseFloat(q[4]);return[(parseFloat(q[1])%360+360)%360,A(parseFloat(q[2]),0,100),A(parseFloat(q[3]),0,100),A(isNaN(C)?1:C,0,1)]}return null},w.to.hex=function(){var N=U(arguments);return"#"+n(N[0])+n(N[1])+n(N[2])+(N[3]<1?n(Math.round(255*N[3])):"")},w.to.rgb=function(){var N=U(arguments);return N.length<4||1===N[3]?"rgb("+Math.round(N[0])+", "+Math.round(N[1])+", "+Math.round(N[2])+")":"rgba("+Math.round(N[0])+", "+Math.round(N[1])+", "+Math.round(N[2])+", "+N[3]+")"},w.to.rgb.percent=function(){var N=U(arguments),q=Math.round(N[0]/255*100),C=Math.round(N[1]/255*100),d=Math.round(N[2]/255*100);return N.length<4||1===N[3]?"rgb("+q+"%, "+C+"%, "+d+"%)":"rgba("+q+"%, "+C+"%, "+d+"%, "+N[3]+")"},w.to.hsl=function(){var N=U(arguments);return N.length<4||1===N[3]?"hsl("+N[0]+", "+N[1]+"%, "+N[2]+"%)":"hsla("+N[0]+", "+N[1]+"%, "+N[2]+"%, "+N[3]+")"},w.to.hwb=function(){var N=U(arguments),q="";return N.length>=4&&1!==N[3]&&(q=", "+N[3]),"hwb("+N[0]+", "+N[1]+"%, "+N[2]+"%"+q+")"},w.to.keyword=function(N){return a[N.slice(0,3)]}},13220:(N,q,C)=>{const d=C(13224),U=C(13242),W=["keyword","gray","hex"],a={};for(const Z of Object.keys(U))a[[...U[Z].labels].sort().join("")]=Z;const F={};function w(N,q){if(!(this instanceof w))return new w(N,q);if(q&&q in W&&(q=null),q&&!(q in U))throw new Error("Unknown model: "+q);let C,A;if(null==N)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(N instanceof w)this.model=N.model,this.color=[...N.color],this.valpha=N.valpha;else if("string"===typeof N){const q=d.get(N);if(null===q)throw new Error("Unable to parse color from string: "+N);this.model=q.model,A=U[this.model].channels,this.color=q.value.slice(0,A),this.valpha="number"===typeof q.value[A]?q.value[A]:1}else if(N.length>0){this.model=q||"rgb",A=U[this.model].channels;const C=Array.prototype.slice.call(N,0,A);this.color=V(C,A),this.valpha="number"===typeof N[A]?N[A]:1}else if("number"===typeof N)this.model="rgb",this.color=[N>>16&255,N>>8&255,255&N],this.valpha=1;else{this.valpha=1;const q=Object.keys(N);"alpha"in N&&(q.splice(q.indexOf("alpha"),1),this.valpha="number"===typeof N.alpha?N.alpha:0);const d=q.sort().join("");if(!(d in a))throw new Error("Unable to parse color from object: "+JSON.stringify(N));this.model=a[d];const{labels:W}=U[this.model],F=[];for(C=0;C<W.length;C++)F.push(N[W[C]]);this.color=V(F)}if(F[this.model])for(A=U[this.model].channels,C=0;C<A;C++){const N=F[this.model][C];N&&(this.color[C]=N(this.color[C]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}w.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(N){let q=this.model in d.to?this:this.rgb();q=q.round("number"===typeof N?N:1);const C=1===q.valpha?q.color:[...q.color,this.valpha];return d.to[q.model](C)},percentString(N){const q=this.rgb().round("number"===typeof N?N:1),C=1===q.valpha?q.color:[...q.color,this.valpha];return d.to.rgb.percent(C)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const N={},{channels:q}=U[this.model],{labels:C}=U[this.model];for(let d=0;d<q;d++)N[C[d]]=this.color[d];return 1!==this.valpha&&(N.alpha=this.valpha),N},unitArray(){const N=this.rgb().color;return N[0]/=255,N[1]/=255,N[2]/=255,1!==this.valpha&&N.push(this.valpha),N},unitObject(){const N=this.rgb().object();return N.r/=255,N.g/=255,N.b/=255,1!==this.valpha&&(N.alpha=this.valpha),N},round(N){return N=Math.max(N||0,0),new w([...this.color.map(A(N)),this.valpha],this.model)},alpha(N){return void 0!==N?new w([...this.color,Math.max(0,Math.min(1,N))],this.model):this.valpha},red:n("rgb",0,t(255)),green:n("rgb",1,t(255)),blue:n("rgb",2,t(255)),hue:n(["hsl","hsv","hsl","hwb","hcg"],0,(N=>(N%360+360)%360)),saturationl:n("hsl",1,t(100)),lightness:n("hsl",2,t(100)),saturationv:n("hsv",1,t(100)),value:n("hsv",2,t(100)),chroma:n("hcg",1,t(100)),gray:n("hcg",2,t(100)),white:n("hwb",1,t(100)),wblack:n("hwb",2,t(100)),cyan:n("cmyk",0,t(100)),magenta:n("cmyk",1,t(100)),yellow:n("cmyk",2,t(100)),black:n("cmyk",3,t(100)),x:n("xyz",0,t(95.047)),y:n("xyz",1,t(100)),z:n("xyz",2,t(108.833)),l:n("lab",0,t(100)),a:n("lab",1),b:n("lab",2),keyword(N){return void 0!==N?new w(N):U[this.model].keyword(this.color)},hex(N){return void 0!==N?new w(N):d.to.hex(this.rgb().round().color)},hexa(N){if(void 0!==N)return new w(N);const q=this.rgb().round().color;let C=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===C.length&&(C="0"+C),d.to.hex(q)+C},rgbNumber(){const N=this.rgb().color;return(255&N[0])<<16|(255&N[1])<<8|255&N[2]},luminosity(){const N=this.rgb().color,q=[];for(const[C,d]of N.entries()){const N=d/255;q[C]=N<=.04045?N/12.92:((N+.055)/1.055)**2.4}return.2126*q[0]+.7152*q[1]+.0722*q[2]},contrast(N){const q=this.luminosity(),C=N.luminosity();return q>C?(q+.05)/(C+.05):(C+.05)/(q+.05)},level(N){const q=this.contrast(N);return q>=7?"AAA":q>=4.5?"AA":""},isDark(){const N=this.rgb().color;return(2126*N[0]+7152*N[1]+722*N[2])/1e4<128},isLight(){return!this.isDark()},negate(){const N=this.rgb();for(let q=0;q<3;q++)N.color[q]=255-N.color[q];return N},lighten(N){const q=this.hsl();return q.color[2]+=q.color[2]*N,q},darken(N){const q=this.hsl();return q.color[2]-=q.color[2]*N,q},saturate(N){const q=this.hsl();return q.color[1]+=q.color[1]*N,q},desaturate(N){const q=this.hsl();return q.color[1]-=q.color[1]*N,q},whiten(N){const q=this.hwb();return q.color[1]+=q.color[1]*N,q},blacken(N){const q=this.hwb();return q.color[2]+=q.color[2]*N,q},grayscale(){const N=this.rgb().color,q=.3*N[0]+.59*N[1]+.11*N[2];return w.rgb(q,q,q)},fade(N){return this.alpha(this.valpha-this.valpha*N)},opaquer(N){return this.alpha(this.valpha+this.valpha*N)},rotate(N){const q=this.hsl();let C=q.color[0];return C=(C+N)%360,C=C<0?360+C:C,q.color[0]=C,q},mix(N,q){if(!N||!N.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof N);const C=N.rgb(),d=this.rgb(),U=void 0===q?.5:q,W=2*U-1,a=C.alpha()-d.alpha(),F=((W*a===-1?W:(W+a)/(1+W*a))+1)/2,A=1-F;return w.rgb(F*C.red()+A*d.red(),F*C.green()+A*d.green(),F*C.blue()+A*d.blue(),C.alpha()*U+d.alpha()*(1-U))}};for(const Z of Object.keys(U)){if(W.includes(Z))continue;const{channels:N}=U[Z];w.prototype[Z]=function(){if(this.model===Z)return new w(this);for(var N=arguments.length,q=new Array(N),C=0;C<N;C++)q[C]=arguments[C];return q.length>0?new w(q,Z):new w([...(d=U[this.model][Z].raw(this.color),Array.isArray(d)?d:[d]),this.valpha],Z);var d},w[Z]=function(){for(var q=arguments.length,C=new Array(q),d=0;d<q;d++)C[d]=arguments[d];let U=C[0];return"number"===typeof U&&(U=V(C,N)),new w(U,Z)}}function A(N){return function(q){return function(N,q){return Number(N.toFixed(q))}(q,N)}}function n(N,q,C){N=Array.isArray(N)?N:[N];for(const d of N)(F[d]||(F[d]=[]))[q]=C;return N=N[0],function(d){let U;return void 0!==d?(C&&(d=C(d)),U=this[N](),U.color[q]=d,U):(U=this[N]().color[q],C&&(U=C(U)),U)}}function t(N){return function(q){return Math.max(0,Math.min(N,q))}}function V(N,q){for(let C=0;C<q;C++)"number"!==typeof N[C]&&(N[C]=0);return N}N.exports=w},13248:(N,q,C)=>{const d=C(13250),U={};for(const a of Object.keys(d))U[d[a]]=a;const W={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};N.exports=W;for(const a of Object.keys(W)){if(!("channels"in W[a]))throw new Error("missing channels property: "+a);if(!("labels"in W[a]))throw new Error("missing channel labels property: "+a);if(W[a].labels.length!==W[a].channels)throw new Error("channel and label counts mismatch: "+a);const{channels:N,labels:q}=W[a];delete W[a].channels,delete W[a].labels,Object.defineProperty(W[a],"channels",{value:N}),Object.defineProperty(W[a],"labels",{value:q})}W.rgb.hsl=function(N){const q=N[0]/255,C=N[1]/255,d=N[2]/255,U=Math.min(q,C,d),W=Math.max(q,C,d),a=W-U;let F,w;W===U?F=0:q===W?F=(C-d)/a:C===W?F=2+(d-q)/a:d===W&&(F=4+(q-C)/a),F=Math.min(60*F,360),F<0&&(F+=360);const A=(U+W)/2;return w=W===U?0:A<=.5?a/(W+U):a/(2-W-U),[F,100*w,100*A]},W.rgb.hsv=function(N){let q,C,d,U,W;const a=N[0]/255,F=N[1]/255,w=N[2]/255,A=Math.max(a,F,w),n=A-Math.min(a,F,w),t=function(N){return(A-N)/6/n+.5};return 0===n?(U=0,W=0):(W=n/A,q=t(a),C=t(F),d=t(w),a===A?U=d-C:F===A?U=1/3+q-d:w===A&&(U=2/3+C-q),U<0?U+=1:U>1&&(U-=1)),[360*U,100*W,100*A]},W.rgb.hwb=function(N){const q=N[0],C=N[1];let d=N[2];const U=W.rgb.hsl(N)[0],a=1/255*Math.min(q,Math.min(C,d));return d=1-1/255*Math.max(q,Math.max(C,d)),[U,100*a,100*d]},W.rgb.cmyk=function(N){const q=N[0]/255,C=N[1]/255,d=N[2]/255,U=Math.min(1-q,1-C,1-d);return[100*((1-q-U)/(1-U)||0),100*((1-C-U)/(1-U)||0),100*((1-d-U)/(1-U)||0),100*U]},W.rgb.keyword=function(N){const q=U[N];if(q)return q;let C,W=1/0;for(const U of Object.keys(d)){const q=d[U],w=(F=q,((a=N)[0]-F[0])**2+(a[1]-F[1])**2+(a[2]-F[2])**2);w<W&&(W=w,C=U)}var a,F;return C},W.keyword.rgb=function(N){return d[N]},W.rgb.xyz=function(N){let q=N[0]/255,C=N[1]/255,d=N[2]/255;q=q>.04045?((q+.055)/1.055)**2.4:q/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92,d=d>.04045?((d+.055)/1.055)**2.4:d/12.92;return[100*(.4124*q+.3576*C+.1805*d),100*(.2126*q+.7152*C+.0722*d),100*(.0193*q+.1192*C+.9505*d)]},W.rgb.lab=function(N){const q=W.rgb.xyz(N);let C=q[0],d=q[1],U=q[2];C/=95.047,d/=100,U/=108.883,C=C>.008856?C**(1/3):7.787*C+16/116,d=d>.008856?d**(1/3):7.787*d+16/116,U=U>.008856?U**(1/3):7.787*U+16/116;return[116*d-16,500*(C-d),200*(d-U)]},W.hsl.rgb=function(N){const q=N[0]/360,C=N[1]/100,d=N[2]/100;let U,W,a;if(0===C)return a=255*d,[a,a,a];U=d<.5?d*(1+C):d+C-d*C;const F=2*d-U,w=[0,0,0];for(let A=0;A<3;A++)W=q+1/3*-(A-1),W<0&&W++,W>1&&W--,a=6*W<1?F+6*(U-F)*W:2*W<1?U:3*W<2?F+(U-F)*(2/3-W)*6:F,w[A]=255*a;return w},W.hsl.hsv=function(N){const q=N[0];let C=N[1]/100,d=N[2]/100,U=C;const W=Math.max(d,.01);d*=2,C*=d<=1?d:2-d,U*=W<=1?W:2-W;return[q,100*(0===d?2*U/(W+U):2*C/(d+C)),100*((d+C)/2)]},W.hsv.rgb=function(N){const q=N[0]/60,C=N[1]/100;let d=N[2]/100;const U=Math.floor(q)%6,W=q-Math.floor(q),a=255*d*(1-C),F=255*d*(1-C*W),w=255*d*(1-C*(1-W));switch(d*=255,U){case 0:return[d,w,a];case 1:return[F,d,a];case 2:return[a,d,w];case 3:return[a,F,d];case 4:return[w,a,d];case 5:return[d,a,F]}},W.hsv.hsl=function(N){const q=N[0],C=N[1]/100,d=N[2]/100,U=Math.max(d,.01);let W,a;a=(2-C)*d;const F=(2-C)*U;return W=C*U,W/=F<=1?F:2-F,W=W||0,a/=2,[q,100*W,100*a]},W.hwb.rgb=function(N){const q=N[0]/360;let C=N[1]/100,d=N[2]/100;const U=C+d;let W;U>1&&(C/=U,d/=U);const a=Math.floor(6*q),F=1-d;W=6*q-a,0!==(1&a)&&(W=1-W);const w=C+W*(F-C);let A,n,t;switch(a){default:case 6:case 0:A=F,n=w,t=C;break;case 1:A=w,n=F,t=C;break;case 2:A=C,n=F,t=w;break;case 3:A=C,n=w,t=F;break;case 4:A=w,n=C,t=F;break;case 5:A=F,n=C,t=w}return[255*A,255*n,255*t]},W.cmyk.rgb=function(N){const q=N[0]/100,C=N[1]/100,d=N[2]/100,U=N[3]/100;return[255*(1-Math.min(1,q*(1-U)+U)),255*(1-Math.min(1,C*(1-U)+U)),255*(1-Math.min(1,d*(1-U)+U))]},W.xyz.rgb=function(N){const q=N[0]/100,C=N[1]/100,d=N[2]/100;let U,W,a;return U=3.2406*q+-1.5372*C+-.4986*d,W=-.9689*q+1.8758*C+.0415*d,a=.0557*q+-.204*C+1.057*d,U=U>.0031308?1.055*U**(1/2.4)-.055:12.92*U,W=W>.0031308?1.055*W**(1/2.4)-.055:12.92*W,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,U=Math.min(Math.max(0,U),1),W=Math.min(Math.max(0,W),1),a=Math.min(Math.max(0,a),1),[255*U,255*W,255*a]},W.xyz.lab=function(N){let q=N[0],C=N[1],d=N[2];q/=95.047,C/=100,d/=108.883,q=q>.008856?q**(1/3):7.787*q+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,d=d>.008856?d**(1/3):7.787*d+16/116;return[116*C-16,500*(q-C),200*(C-d)]},W.lab.xyz=function(N){let q,C,d;C=(N[0]+16)/116,q=N[1]/500+C,d=C-N[2]/200;const U=C**3,W=q**3,a=d**3;return C=U>.008856?U:(C-16/116)/7.787,q=W>.008856?W:(q-16/116)/7.787,d=a>.008856?a:(d-16/116)/7.787,q*=95.047,C*=100,d*=108.883,[q,C,d]},W.lab.lch=function(N){const q=N[0],C=N[1],d=N[2];let U;U=360*Math.atan2(d,C)/2/Math.PI,U<0&&(U+=360);return[q,Math.sqrt(C*C+d*d),U]},W.lch.lab=function(N){const q=N[0],C=N[1],d=N[2]/360*2*Math.PI;return[q,C*Math.cos(d),C*Math.sin(d)]},W.rgb.ansi16=function(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[C,d,U]=N;let a=null===q?W.rgb.hsv(N)[2]:q;if(a=Math.round(a/50),0===a)return 30;let F=30+(Math.round(U/255)<<2|Math.round(d/255)<<1|Math.round(C/255));return 2===a&&(F+=60),F},W.hsv.ansi16=function(N){return W.rgb.ansi16(W.hsv.rgb(N),N[2])},W.rgb.ansi256=function(N){const q=N[0],C=N[1],d=N[2];if(q===C&&C===d)return q<8?16:q>248?231:Math.round((q-8)/247*24)+232;return 16+36*Math.round(q/255*5)+6*Math.round(C/255*5)+Math.round(d/255*5)},W.ansi16.rgb=function(N){let q=N%10;if(0===q||7===q)return N>50&&(q+=3.5),q=q/10.5*255,[q,q,q];const C=.5*(1+~~(N>50));return[(1&q)*C*255,(q>>1&1)*C*255,(q>>2&1)*C*255]},W.ansi256.rgb=function(N){if(N>=232){const q=10*(N-232)+8;return[q,q,q]}let q;N-=16;return[Math.floor(N/36)/5*255,Math.floor((q=N%36)/6)/5*255,q%6/5*255]},W.rgb.hex=function(N){const q=(((255&Math.round(N[0]))<<16)+((255&Math.round(N[1]))<<8)+(255&Math.round(N[2]))).toString(16).toUpperCase();return"000000".substring(q.length)+q},W.hex.rgb=function(N){const q=N.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!q)return[0,0,0];let C=q[0];3===q[0].length&&(C=C.split("").map((N=>N+N)).join(""));const d=parseInt(C,16);return[d>>16&255,d>>8&255,255&d]},W.rgb.hcg=function(N){const q=N[0]/255,C=N[1]/255,d=N[2]/255,U=Math.max(Math.max(q,C),d),W=Math.min(Math.min(q,C),d),a=U-W;let F,w;return F=a<1?W/(1-a):0,w=a<=0?0:U===q?(C-d)/a%6:U===C?2+(d-q)/a:4+(q-C)/a,w/=6,w%=1,[360*w,100*a,100*F]},W.hsl.hcg=function(N){const q=N[1]/100,C=N[2]/100,d=C<.5?2*q*C:2*q*(1-C);let U=0;return d<1&&(U=(C-.5*d)/(1-d)),[N[0],100*d,100*U]},W.hsv.hcg=function(N){const q=N[1]/100,C=N[2]/100,d=q*C;let U=0;return d<1&&(U=(C-d)/(1-d)),[N[0],100*d,100*U]},W.hcg.rgb=function(N){const q=N[0]/360,C=N[1]/100,d=N[2]/100;if(0===C)return[255*d,255*d,255*d];const U=[0,0,0],W=q%1*6,a=W%1,F=1-a;let w=0;switch(Math.floor(W)){case 0:U[0]=1,U[1]=a,U[2]=0;break;case 1:U[0]=F,U[1]=1,U[2]=0;break;case 2:U[0]=0,U[1]=1,U[2]=a;break;case 3:U[0]=0,U[1]=F,U[2]=1;break;case 4:U[0]=a,U[1]=0,U[2]=1;break;default:U[0]=1,U[1]=0,U[2]=F}return w=(1-C)*d,[255*(C*U[0]+w),255*(C*U[1]+w),255*(C*U[2]+w)]},W.hcg.hsv=function(N){const q=N[1]/100,C=q+N[2]/100*(1-q);let d=0;return C>0&&(d=q/C),[N[0],100*d,100*C]},W.hcg.hsl=function(N){const q=N[1]/100,C=N[2]/100*(1-q)+.5*q;let d=0;return C>0&&C<.5?d=q/(2*C):C>=.5&&C<1&&(d=q/(2*(1-C))),[N[0],100*d,100*C]},W.hcg.hwb=function(N){const q=N[1]/100,C=q+N[2]/100*(1-q);return[N[0],100*(C-q),100*(1-C)]},W.hwb.hcg=function(N){const q=N[1]/100,C=1-N[2]/100,d=C-q;let U=0;return d<1&&(U=(C-d)/(1-d)),[N[0],100*d,100*U]},W.apple.rgb=function(N){return[N[0]/65535*255,N[1]/65535*255,N[2]/65535*255]},W.rgb.apple=function(N){return[N[0]/255*65535,N[1]/255*65535,N[2]/255*65535]},W.gray.rgb=function(N){return[N[0]/100*255,N[0]/100*255,N[0]/100*255]},W.gray.hsl=function(N){return[0,0,N[0]]},W.gray.hsv=W.gray.hsl,W.gray.hwb=function(N){return[0,100,N[0]]},W.gray.cmyk=function(N){return[0,0,0,N[0]]},W.gray.lab=function(N){return[N[0],0,0]},W.gray.hex=function(N){const q=255&Math.round(N[0]/100*255),C=((q<<16)+(q<<8)+q).toString(16).toUpperCase();return"000000".substring(C.length)+C},W.rgb.gray=function(N){return[(N[0]+N[1]+N[2])/3/255*100]}},13242:(N,q,C)=>{const d=C(13248),U=C(13254),W={};Object.keys(d).forEach((N=>{W[N]={},Object.defineProperty(W[N],"channels",{value:d[N].channels}),Object.defineProperty(W[N],"labels",{value:d[N].labels});const q=U(N);Object.keys(q).forEach((C=>{const d=q[C];W[N][C]=function(N){const q=function(){for(var q=arguments.length,C=new Array(q),d=0;d<q;d++)C[d]=arguments[d];const U=C[0];if(void 0===U||null===U)return U;U.length>1&&(C=U);const W=N(C);if("object"===typeof W)for(let N=W.length,a=0;a<N;a++)W[a]=Math.round(W[a]);return W};return"conversion"in N&&(q.conversion=N.conversion),q}(d),W[N][C].raw=function(N){const q=function(){for(var q=arguments.length,C=new Array(q),d=0;d<q;d++)C[d]=arguments[d];const U=C[0];return void 0===U||null===U?U:(U.length>1&&(C=U),N(C))};return"conversion"in N&&(q.conversion=N.conversion),q}(d)}))})),N.exports=W},13254:(N,q,C)=>{const d=C(13248);function U(N){const q=function(){const N={},q=Object.keys(d);for(let C=q.length,d=0;d<C;d++)N[q[d]]={distance:-1,parent:null};return N}(),C=[N];for(q[N].distance=0;C.length;){const N=C.pop(),U=Object.keys(d[N]);for(let d=U.length,W=0;W<d;W++){const d=U[W],a=q[d];-1===a.distance&&(a.distance=q[N].distance+1,a.parent=N,C.unshift(d))}}return q}function W(N,q){return function(C){return q(N(C))}}function a(N,q){const C=[q[N].parent,N];let U=d[q[N].parent][N],a=q[N].parent;for(;q[a].parent;)C.unshift(q[a].parent),U=W(d[q[a].parent][a],U),a=q[a].parent;return U.conversion=C,U}N.exports=function(N){const q=U(N),C={},d=Object.keys(q);for(let U=d.length,W=0;W<U;W++){const N=d[W];null!==q[N].parent&&(C[N]=a(N,q))}return C}},13250:N=>{"use strict";N.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11830:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.discordURLBuilder=void 0,q.discordURLBuilder=function(N){var q;const C=(null===(q=null===window||void 0===window?void 0:window.location)||void 0===q?void 0:q.hostname)||"localhost",d=N.hostname.split("."),U=!N.hostname.includes("trycloudflare.com")&&!N.hostname.includes("discordsays.com")&&d.length>2?`/${d[0]}`:"";return N.pathname.startsWith("/.proxy")?`${N.protocol}//${C}${U}${N.pathname}${N.search}`:`${N.protocol}//${C}/.proxy/colyseus${U}${N.pathname}${N.search}`}},11818:function(N,q,C){"use strict";var d,U,W,a,F=this&&this.__awaiter||function(N,q,C,d){return new(C||(C=Promise))((function(U,W){function a(N){try{w(d.next(N))}catch(q){W(q)}}function F(N){try{w(d.throw(N))}catch(q){W(q)}}function w(N){var q;N.done?U(N.value):(q=N.value,q instanceof C?q:new C((function(N){N(q)}))).then(a,F)}w((d=d.apply(N,q||[])).next())}))},w=this&&this.__classPrivateFieldGet||function(N,q,C,d){if("a"===C&&!d)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof q?N!==q||!d:!q.has(N))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===C?d:"a"===C?d.call(N):d?d.value:q.get(N)},A=this&&this.__classPrivateFieldSet||function(N,q,C,d,U){if("m"===d)throw new TypeError("Private method is not writable");if("a"===d&&!U)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof q?N!==q||!U:!q.has(N))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?U.call(N,C):U?U.value=C:q.set(N,C),C};Object.defineProperty(q,"__esModule",{value:!0}),q.Auth=void 0;const n=C(11822),t=C(11797);q.Auth=class{constructor(N){this.http=N,this.settings={path:"/auth",key:"colyseus-auth-token"},d.set(this,!1),U.set(this,void 0),W.set(this,void 0),a.set(this,(0,t.createNanoEvents)()),(0,n.getItem)(this.settings.key,(N=>this.token=N))}set token(N){this.http.authToken=N}get token(){return this.http.authToken}onChange(N){const q=w(this,a,"f").on("change",N);return w(this,d,"f")||A(this,U,new Promise(((N,q)=>{this.getUserData().then((N=>{this.emitChange(Object.assign(Object.assign({},N),{token:this.token}))})).catch((N=>{this.emitChange({user:null,token:void 0})})).finally((()=>{N()}))})),"f"),A(this,d,!0,"f"),q}getUserData(){return F(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(N,q,C){return F(this,void 0,void 0,(function*(){const d=(yield this.http.post(`${this.settings.path}/register`,{body:{email:N,password:q,options:C}})).data;return this.emitChange(d),d}))}signInWithEmailAndPassword(N,q){return F(this,void 0,void 0,(function*(){const C=(yield this.http.post(`${this.settings.path}/login`,{body:{email:N,password:q}})).data;return this.emitChange(C),C}))}signInAnonymously(N){return F(this,void 0,void 0,(function*(){const q=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:N}})).data;return this.emitChange(q),q}))}sendPasswordResetEmail(N){return F(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:N}})).data}))}signInWithProvider(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return F(this,void 0,void 0,(function*(){return new Promise(((C,d)=>{const U=q.width||480,a=q.height||768,F=this.token?`?token=${this.token}`:"",n=`Login with ${N[0].toUpperCase()+N.substring(1)}`,t=this.http.client.getHttpEndpoint(`${q.prefix||`${this.settings.path}/provider`}/${N}${F}`),V=screen.width/2-U/2,Z=screen.height/2-a/2;A(this,W,window.open(t,n,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+U+", height="+a+", top="+Z+", left="+V),"f");const J=N=>{void 0===N.data.user&&void 0===N.data.token||(clearInterval(Q),w(this,W,"f").close(),A(this,W,void 0,"f"),window.removeEventListener("message",J),void 0!==N.data.error?d(N.data.error):(C(N.data),this.emitChange(N.data)))},Q=setInterval((()=>{w(this,W,"f")&&!w(this,W,"f").closed||(A(this,W,void 0,"f"),d("lW"),window.removeEventListener("message",J))}),200);window.addEventListener("message",J)}))}))}signOut(){return F(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(N){void 0!==N.token&&(this.token=N.token,null===N.token?(0,n.removeItem)(this.settings.key):(0,n.setItem)(this.settings.key,N.token)),w(this,a,"f").emit("change",N)}},d=new WeakMap,U=new WeakMap,W=new WeakMap,a=new WeakMap},11747:function(N,q,C){"use strict";var d,U=this&&this.__awaiter||function(N,q,C,d){return new(C||(C=Promise))((function(U,W){function a(N){try{w(d.next(N))}catch(q){W(q)}}function F(N){try{w(d.throw(N))}catch(q){W(q)}}function w(N){var q;N.done?U(N.value):(q=N.value,q instanceof C?q:new C((function(N){N(q)}))).then(a,F)}w((d=d.apply(N,q||[])).next())}))};Object.defineProperty(q,"__esModule",{value:!0}),q.Client=q.MatchMakeError=void 0;const W=C(11754),a=C(11763),F=C(11812),w=C(11818),A=C(11830);class n extends Error{constructor(N,q){super(N),this.code=q,Object.setPrototypeOf(this,n.prototype)}}q.MatchMakeError=n;const t="undefined"!==typeof window&&"undefined"!==typeof(null===(d=null===window||void 0===window?void 0:window.location)||void 0===d?void 0:d.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";q.Client=class{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,q=arguments.length>1?arguments[1]:void 0;var C,d;if("string"===typeof N){const q=N.startsWith("/")?new URL(N,t):new URL(N),C="https:"===q.protocol||"wss:"===q.protocol,d=Number(q.port||(C?443:80));this.settings={hostname:q.hostname,pathname:q.pathname,port:d,secure:C}}else void 0===N.port&&(N.port=N.secure?443:80),void 0===N.pathname&&(N.pathname=""),this.settings=N;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new F.HTTP(this,(null===q||void 0===q?void 0:q.headers)||{}),this.auth=new w.Auth(this.http),this.urlBuilder=null===q||void 0===q?void 0:q.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(d=null===(C=null===window||void 0===window?void 0:window.location)||void 0===C?void 0:C.hostname)||void 0===d?void 0:d.includes("discordsays.com"))&&(this.urlBuilder=A.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",N,q,C)}))}create(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",N,q,C)}))}join(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",N,q,C)}))}joinById(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",N,q,C)}))}reconnect(N,q){return U(this,void 0,void 0,(function*(){if("string"===typeof N&&"string"===typeof q)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[C,d]=N.split(":");if(!C||!d)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",C,{reconnectionToken:d},q)}))}getAvailableRooms(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return U(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${N}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(N,q,C){return U(this,void 0,void 0,(function*(){const d=this.createRoom(N.room.name,q);d.roomId=N.room.roomId,d.sessionId=N.sessionId;const a={sessionId:d.sessionId};N.reconnectionToken&&(a.reconnectionToken=N.reconnectionToken);const F=C||d;return d.connect(this.buildEndpoint(N.room,a),N.devMode&&(()=>U(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${d.roomId}'...`);let C=0;const W=()=>U(this,void 0,void 0,(function*(){C++;try{yield this.consumeSeatReservation(N,q,F),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${d.roomId}'`)}catch(U){C<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${C} out of 8)`),setTimeout(W,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(W,2e3)}))),F,this.http.headers),new Promise(((N,q)=>{const C=(N,C)=>q(new W.ServerError(N,C));F.onError.once(C),F.onJoin.once((()=>{F.onError.remove(C),setTimeout((()=>{try{F.zw(128,new Uint8Array([210,64,109,155,120,195,151,241,151,101,174,119,67,150,13,31,196,169,25,126]))}catch{}}),3e3),N(F)}))}))}))}createMatchMakeRequest(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=arguments.length>3?arguments[3]:void 0,W=arguments.length>4?arguments[4]:void 0;return U(this,void 0,void 0,(function*(){const U=(yield this.http.post(`matchmake/${N}/${q}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(C)})).data;if(U.error)throw new n(U.error,U.code);return"reconnect"===N&&(U.reconnectionToken=C.reconnectionToken),yield this.consumeSeatReservation(U,d,W)}))}createRoom(N,q){return new a.Room(N,q)}buildEndpoint(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=[];for(const W in q)q.hasOwnProperty(W)&&C.push(`${W}=${q[W]}`);let d=this.settings.secure?"wss://":"ws://";N.publicAddress?d+=`${N.publicAddress}`:d+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const U=`${d}/${N.processId}/${N.roomId}?${C.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(U)):U}getHttpEndpoint(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const q=N.startsWith("/")?N:`/${N}`,C=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${q}`;return this.urlBuilder?this.urlBuilder(new URL(C)):C}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11772:(N,q,C)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.Connection=void 0;const d=C(11777);q.Connection=class{constructor(){this.events={},this.transport=new d.WebSocketTransport(this.events)}send(N){this.transport.send(N)}connect(N,q){this.transport.connect(N,q)}close(N,q){this.transport.close(N,q)}get isOpen(){return this.transport.isOpen}}},11812:function(N,q,C){"use strict";var d=this&&this.__createBinding||(Object.create?function(N,q,C,d){void 0===d&&(d=C);var U=Object.getOwnPropertyDescriptor(q,C);U&&!("get"in U?!q.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return q[C]}}),Object.defineProperty(N,d,U)}:function(N,q,C,d){void 0===d&&(d=C),N[d]=q[C]}),U=this&&this.__setModuleDefault||(Object.create?function(N,q){Object.defineProperty(N,"default",{enumerable:!0,value:q})}:function(N,q){N.default=q}),W=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var q={};if(null!=N)for(var C in N)"default"!==C&&Object.prototype.hasOwnProperty.call(N,C)&&d(q,N,C);return U(q,N),q};Object.defineProperty(q,"__esModule",{value:!0}),q.HTTP=void 0;const a=C(11754),F=W(C(11815));q.HTTP=class{constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=N,this.headers=q}get(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",N,q)}post(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",N,q)}del(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",N,q)}put(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",N,q)}request(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return F[N](this.client.getHttpEndpoint(q),this.getOptions(C)).catch((N=>{var q;const C=N.statusCode,d=(null===(q=N.data)||void 0===q?void 0:q.error)||N.statusMessage||N.message;if(!C&&!d)throw N;throw new a.ServerError(C,d)}))}getOptions(N){return N.headers=Object.assign({},this.headers,N.headers),this.authToken&&(N.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(N.withCredentials=!0),N}}},11788:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.utf8Length=q.utf8Read=q.ErrorCode=q.Protocol=void 0,function(N){N[N.HANDSHAKE=9]="HANDSHAKE",N[N.JOIN_ROOM=10]="JOIN_ROOM",N[N.ERROR=11]="ERROR",N[N.LEAVE_ROOM=12]="LEAVE_ROOM",N[N.ROOM_DATA=13]="ROOM_DATA",N[N.ROOM_STATE=14]="ROOM_STATE",N[N.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",N[N.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",N[N.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(q.Protocol||(q.Protocol={})),function(N){N[N.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",N[N.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",N[N.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",N[N.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",N[N.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",N[N.AUTH_FAILED=4215]="AUTH_FAILED",N[N.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(q.ErrorCode||(q.ErrorCode={})),q.utf8Read=function(N,q){const C=N[q++];for(var d="",U=0,W=q,a=q+C;W<a;W++){var F=N[W];if(0!==(128&F))if(192!==(224&F))if(224!==(240&F)){if(240!==(248&F))throw new Error("Invalid byte "+F.toString(16));(U=(7&F)<<18|(63&N[++W])<<12|(63&N[++W])<<6|63&N[++W])>=65536?(U-=65536,d+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):d+=String.fromCharCode(U)}else d+=String.fromCharCode((15&F)<<12|(63&N[++W])<<6|63&N[++W]);else d+=String.fromCharCode((31&F)<<6|63&N[++W]);else d+=String.fromCharCode(F)}return d},q.utf8Length=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",q=0,C=0;for(let d=0,U=N.length;d<U;d++)q=N.charCodeAt(d),q<128?C+=1:q<2048?C+=2:q<55296||q>=57344?C+=3:(d++,C+=4);return C+1}},11763:function(N,q,C){"use strict";var d=this&&this.__createBinding||(Object.create?function(N,q,C,d){void 0===d&&(d=C);var U=Object.getOwnPropertyDescriptor(q,C);U&&!("get"in U?!q.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return q[C]}}),Object.defineProperty(N,d,U)}:function(N,q,C,d){void 0===d&&(d=C),N[d]=q[C]}),U=this&&this.__setModuleDefault||(Object.create?function(N,q){Object.defineProperty(N,"default",{enumerable:!0,value:q})}:function(N,q){N.default=q}),W=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var q={};if(null!=N)for(var C in N)"default"!==C&&Object.prototype.hasOwnProperty.call(N,C)&&d(q,N,C);return U(q,N),q};Object.defineProperty(q,"__esModule",{value:!0}),q.Room=void 0;const a=W(C(11766)),F=C(11772),w=C(11788),A=C(11790),n=C(11797),t=C(11801),V=C(11804),Z=C(11754);class J{constructor(N,q){this.onStateChange=(0,t.createSignal)(),this.onError=(0,t.createSignal)(),this.onLeave=(0,t.createSignal)(),this.onJoin=(0,t.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,n.createNanoEvents)(),this.roomId=null,this.name=N,q&&(this.serializer=new((0,A.getSerializer)("schema")),this.rootSchema=q,this.serializer.state=new q),this.onError(((N,q)=>{var C;return null===(C=console.warn)||void 0===C?void 0:C.call(console,`colyseus.js - onError => (${N}) ${q}`)})),this.onLeave((()=>this.Uq()))}get id(){return this.roomId}connect(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,d=arguments.length>3?arguments[3]:void 0;const U=new F.Connection;C.connection=U,U.events.onmessage=J.prototype.onMessageCallback.bind(C),U.events.onclose=function(N){var d;if(!C.hasJoined)return null===(d=console.warn)||void 0===d||d.call(console,`Room connection was closed unexpectedly (${N.code}): ${N.reason}`),void C.onError.invoke(N.code,N.reason);N.code===Z.CloseCode.DEVMODE_RESTART&&q?q():(C.onLeave.invoke(N.code,N.reason),C.destroy())},U.events.onerror=function(N){var q;null===(q=console.warn)||void 0===q||q.call(console,`Room, onError (${N.code}): ${N.reason}`),C.onError.invoke(N.code,N.reason)},U.connect(N,d)}QF(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((q=>{this.onLeave((N=>q(N))),this.connection?N?this.connection.send([w.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(Z.CloseCode.CONSENTED)}))}Eq(N,q){return this.onMessageHandlers.on(this.getMessageHandlerKey(N),q)}send(N,q){const C=[w.Protocol.ROOM_DATA];let d;if("string"===typeof N?V.encode.string(C,N):V.encode.number(C,N),void 0!==q){const N=a.encode(q);d=new Uint8Array(C.length+N.byteLength),d.set(new Uint8Array(C),0),d.set(new Uint8Array(N),C.length)}else d=new Uint8Array(C);this.connection.send(d.buffer)}zw(N,q){const C=[w.Protocol.ROOM_DATA_BYTES];let d;"string"===typeof N?V.encode.string(C,N):V.encode.number(C,N),d=new Uint8Array(C.length+(q.byteLength||q.length)),d.set(new Uint8Array(C),0),d.set(new Uint8Array(q),C.length),this.connection.send(d.buffer)}get state(){return this.serializer.getState()}Uq(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(N){const q=Array.from(new Uint8Array(N.data)),C=q[0];if(C===w.Protocol.JOIN_ROOM){let N=1;const C=(0,w.utf8Read)(q,N);if(N+=(0,w.utf8Length)(C),this.serializerId=(0,w.utf8Read)(q,N),N+=(0,w.utf8Length)(this.serializerId),!this.serializer){const N=(0,A.getSerializer)(this.serializerId);this.serializer=new N}q.length>N&&this.serializer.handshake&&this.serializer.handshake(q,{offset:N}),this.reconnectionToken=`${this.roomId}:${C}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([w.Protocol.JOIN_ROOM])}else if(C===w.Protocol.ERROR){const N={offset:1},C=V.decode.number(q,N),d=V.decode.string(q,N);this.onError.invoke(C,d)}else if(C===w.Protocol.LEAVE_ROOM)this.QF();else if(C===w.Protocol.ROOM_DATA_SCHEMA){const N={offset:1},C=this.serializer.getState().constructor._context.get(V.decode.number(q,N)),d=new C;d.decode(q,N),this.dispatchMessage(C,d)}else if(C===w.Protocol.ROOM_STATE)q.shift(),this.setState(q);else if(C===w.Protocol.ROOM_STATE_PATCH)q.shift(),this.patch(q);else if(C===w.Protocol.ROOM_DATA){const C={offset:1},d=V.decode.stringCheck(q,C)?V.decode.string(q,C):V.decode.number(q,C),U=q.length>C.offset?a.decode(N.data,C.offset):void 0;this.dispatchMessage(d,U)}else if(C===w.Protocol.ROOM_DATA_BYTES){const N={offset:1},C=V.decode.stringCheck(q,N)?V.decode.string(q,N):V.decode.number(q,N);this.dispatchMessage(C,new Uint8Array(q.slice(N.offset)))}}setState(N){this.serializer.setState(N),this.onStateChange.invoke(this.serializer.getState())}patch(N){this.serializer.patch(N),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(N,q){var C;const d=this.getMessageHandlerKey(N);this.onMessageHandlers.events[d]?this.onMessageHandlers.emit(d,q):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",N,q):null===(C=console.warn)||void 0===C||C.call(console,`colyseus.js: onMessage() not registered for type '${N}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(N){switch(typeof N){case"function":return`$${N._typeid}`;case"string":return N;case"number":return`i${N}`;default:throw new Error("invalid message type.")}}}q.Room=J},11822:(N,q)=>{"use strict";let C;function d(){if(!C)try{C="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(N){}return C||(C={cache:{},setItem:function(N,q){this.cache[N]=q},getItem:function(N){this.cache[N]},removeItem:function(N){delete this.cache[N]}}),C}Object.defineProperty(q,"__esModule",{value:!0}),q.getItem=q.removeItem=q.setItem=void 0,q.setItem=function(N,q){d().setItem(N,q)},q.removeItem=function(N){d().removeItem(N)},q.getItem=function(N,q){const C=d().getItem(N);"undefined"!==typeof Promise&&C instanceof Promise?C.then((N=>q(N))):q(C)}},11797:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.createNanoEvents=void 0;q.createNanoEvents=()=>({emit(N){let q=this.events[N]||[];for(var C=arguments.length,d=new Array(C>1?C-1:0),U=1;U<C;U++)d[U-1]=arguments[U];for(let W=0,a=q.length;W<a;W++)q[W](...d)},events:{},on(N,q){var C;return(null===(C=this.events[N])||void 0===C?void 0:C.push(q))||(this.events[N]=[q]),()=>{var C;this.events[N]=null===(C=this.events[N])||void 0===C?void 0:C.filter((N=>q!==N))}}})},11801:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.createSignal=q.EventEmitter=void 0;class C{constructor(){this.handlers=[]}register(N){return this.handlers.push(N),this}invoke(){for(var N=arguments.length,q=new Array(N),C=0;C<N;C++)q[C]=arguments[C];this.handlers.forEach((N=>N.apply(this,q)))}invokeAsync(){for(var N=arguments.length,q=new Array(N),C=0;C<N;C++)q[C]=arguments[C];return Promise.all(this.handlers.map((N=>N.apply(this,q))))}remove(N){const q=this.handlers.indexOf(N);this.handlers[q]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}q.EventEmitter=C,q.createSignal=function(){const N=new C;function q(q){return N.register(q,null===this)}return q.once=q=>{const C=function(){for(var d=arguments.length,U=new Array(d),W=0;W<d;W++)U[W]=arguments[W];q.apply(this,U),N.remove(C)};N.register(C)},q.remove=q=>N.remove(q),q.invoke=function(){return N.invoke(...arguments)},q.invokeAsync=function(){return N.invokeAsync(...arguments)},q.clear=()=>N.clear(),q}},11754:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.ServerError=q.CloseCode=void 0,function(N){N[N.CONSENTED=4e3]="CONSENTED",N[N.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(q.CloseCode||(q.CloseCode={}));class C extends Error{constructor(N,q){super(q),this.name="ServerError",this.code=N}}q.ServerError=C},11732:(N,q,C)=>{"use strict";q.b=void 0,C(11738);var d=C(11747);Object.defineProperty(q,"b",{enumerable:!0,get:function(){return d.Client}});var U=C(11788);var W=C(11763);var a=C(11818);const F=C(11838);const w=C(11841),A=C(11790);(0,A.registerSerializer)("schema",F.SchemaSerializer),(0,A.registerSerializer)("none",w.NoneSerializer)},11738:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=N=>null!==N&&"object"===typeof N&&N.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11766:(N,q)=>{"use strict";function C(N,q){if(this._offset=q,N instanceof ArrayBuffer)this._buffer=N,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(N))throw new Error("Invalid argument");this._buffer=N.buffer,this._view=new DataView(this._buffer,N.byteOffset,N.byteLength)}}Object.defineProperty(q,"__esModule",{value:!0}),q.decode=q.encode=void 0,C.prototype._array=function(N){for(var q=new Array(N),C=0;C<N;C++)q[C]=this._parse();return q},C.prototype._map=function(N){for(var q={},C=0;C<N;C++)q[this._parse()]=this._parse();return q},C.prototype._str=function(N){var q=function(N,q,C){for(var d="",U=0,W=q,a=q+C;W<a;W++){var F=N.getUint8(W);if(0!==(128&F))if(192!==(224&F))if(224!==(240&F)){if(240!==(248&F))throw new Error("Invalid byte "+F.toString(16));(U=(7&F)<<18|(63&N.getUint8(++W))<<12|(63&N.getUint8(++W))<<6|63&N.getUint8(++W))>=65536?(U-=65536,d+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):d+=String.fromCharCode(U)}else d+=String.fromCharCode((15&F)<<12|(63&N.getUint8(++W))<<6|63&N.getUint8(++W));else d+=String.fromCharCode((31&F)<<6|63&N.getUint8(++W));else d+=String.fromCharCode(F)}return d}(this._view,this._offset,N);return this._offset+=N,q},C.prototype._bin=function(N){var q=this._buffer.slice(this._offset,this._offset+N);return this._offset+=N,q},C.prototype._parse=function(){var N,q=this._view.getUint8(this._offset++),C=0,d=0,U=0,W=0;if(q<192)return q<128?q:q<144?this._map(15&q):q<160?this._array(15&q):this._str(31&q);if(q>223)return-1*(255-q+1);switch(q){case 192:return null;case 194:return!1;case 195:return!0;case 196:return C=this._view.getUint8(this._offset),this._offset+=1,this._bin(C);case 197:return C=this._view.getUint16(this._offset),this._offset+=2,this._bin(C);case 198:return C=this._view.getUint32(this._offset),this._offset+=4,this._bin(C);case 199:if(C=this._view.getUint8(this._offset),d=this._view.getInt8(this._offset+1),this._offset+=2,-1===d){var a=this._view.getUint32(this._offset);return U=this._view.getInt32(this._offset+4),W=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*U+W)+a/1e6)}return[d,this._bin(C)];case 200:return C=this._view.getUint16(this._offset),d=this._view.getInt8(this._offset+2),this._offset+=3,[d,this._bin(C)];case 201:return C=this._view.getUint32(this._offset),d=this._view.getInt8(this._offset+4),this._offset+=5,[d,this._bin(C)];case 202:return N=this._view.getFloat32(this._offset),this._offset+=4,N;case 203:return N=this._view.getFloat64(this._offset),this._offset+=8,N;case 204:return N=this._view.getUint8(this._offset),this._offset+=1,N;case 205:return N=this._view.getUint16(this._offset),this._offset+=2,N;case 206:return N=this._view.getUint32(this._offset),this._offset+=4,N;case 207:return U=this._view.getUint32(this._offset)*Math.pow(2,32),W=this._view.getUint32(this._offset+4),this._offset+=8,U+W;case 208:return N=this._view.getInt8(this._offset),this._offset+=1,N;case 209:return N=this._view.getInt16(this._offset),this._offset+=2,N;case 210:return N=this._view.getInt32(this._offset),this._offset+=4,N;case 211:return U=this._view.getInt32(this._offset)*Math.pow(2,32),W=this._view.getUint32(this._offset+4),this._offset+=8,U+W;case 212:return d=this._view.getInt8(this._offset),this._offset+=1,0===d?void(this._offset+=1):[d,this._bin(1)];case 213:return d=this._view.getInt8(this._offset),this._offset+=1,[d,this._bin(2)];case 214:return d=this._view.getInt8(this._offset),this._offset+=1,-1===d?(N=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*N)):[d,this._bin(4)];case 215:return d=this._view.getInt8(this._offset),this._offset+=1,0===d?(U=this._view.getInt32(this._offset)*Math.pow(2,32),W=this._view.getUint32(this._offset+4),this._offset+=8,new Date(U+W)):-1===d?(U=this._view.getUint32(this._offset),W=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&U)+W)+(U>>>2)/1e6)):[d,this._bin(8)];case 216:return d=this._view.getInt8(this._offset),this._offset+=1,[d,this._bin(16)];case 217:return C=this._view.getUint8(this._offset),this._offset+=1,this._str(C);case 218:return C=this._view.getUint16(this._offset),this._offset+=2,this._str(C);case 219:return C=this._view.getUint32(this._offset),this._offset+=4,this._str(C);case 220:return C=this._view.getUint16(this._offset),this._offset+=2,this._array(C);case 221:return C=this._view.getUint32(this._offset),this._offset+=4,this._array(C);case 222:return C=this._view.getUint16(this._offset),this._offset+=2,this._map(C);case 223:return C=this._view.getUint32(this._offset),this._offset+=4,this._map(C)}throw new Error("Could not parse")},q.decode=function(N){var q=new C(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),d=q._parse();if(q._offset!==N.byteLength)throw new Error(N.byteLength-q._offset+" trailing bytes");return d};function d(N,q,C){for(var d=0,U=0,W=C.length;U<W;U++)(d=C.charCodeAt(U))<128?N.setUint8(q++,d):d<2048?(N.setUint8(q++,192|d>>6),N.setUint8(q++,128|63&d)):d<55296||d>=57344?(N.setUint8(q++,224|d>>12),N.setUint8(q++,128|d>>6&63),N.setUint8(q++,128|63&d)):(U++,d=65536+((1023&d)<<10|1023&C.charCodeAt(U)),N.setUint8(q++,240|d>>18),N.setUint8(q++,128|d>>12&63),N.setUint8(q++,128|d>>6&63),N.setUint8(q++,128|63&d))}function U(N,q,C){var d=typeof C,W=0,a=0,F=0,w=0,A=0,n=0;if("string"===d){if(A=function(N){for(var q=0,C=0,d=0,U=N.length;d<U;d++)(q=N.charCodeAt(d))<128?C+=1:q<2048?C+=2:q<55296||q>=57344?C+=3:(d++,C+=4);return C}(C),A<32)N.push(160|A),n=1;else if(A<256)N.push(217,A),n=2;else if(A<65536)N.push(218,A>>8,A),n=3;else{if(!(A<4294967296))throw new Error("String too long");N.push(219,A>>24,A>>16,A>>8,A),n=5}return q.push({_str:C,_length:A,_offset:N.length}),n+A}if("number"===d)return Math.floor(C)===C&&isFinite(C)?C>=0?C<128?(N.push(C),1):C<256?(N.push(204,C),2):C<65536?(N.push(205,C>>8,C),3):C<4294967296?(N.push(206,C>>24,C>>16,C>>8,C),5):(F=C/Math.pow(2,32)|0,w=C>>>0,N.push(207,F>>24,F>>16,F>>8,F,w>>24,w>>16,w>>8,w),9):C>=-32?(N.push(C),1):C>=-128?(N.push(208,C),2):C>=-32768?(N.push(209,C>>8,C),3):C>=-2147483648?(N.push(210,C>>24,C>>16,C>>8,C),5):(F=Math.floor(C/Math.pow(2,32)),w=C>>>0,N.push(211,F>>24,F>>16,F>>8,F,w>>24,w>>16,w>>8,w),9):(N.push(203),q.push({_float:C,_length:8,_offset:N.length}),9);if("object"===d){if(null===C)return N.push(192),1;if(Array.isArray(C)){if((A=C.length)<16)N.push(144|A),n=1;else if(A<65536)N.push(220,A>>8,A),n=3;else{if(!(A<4294967296))throw new Error("Array too large");N.push(221,A>>24,A>>16,A>>8,A),n=5}for(W=0;W<A;W++)n+=U(N,q,C[W]);return n}if(C instanceof Date){var t=C.getTime(),V=Math.floor(t/1e3),Z=1e6*(t-1e3*V);return V>=0&&Z>=0&&V<=17179869183?0===Z&&V<=4294967295?(N.push(214,255,V>>24,V>>16,V>>8,V),6):(F=V/4294967296,w=4294967295&V,N.push(215,255,Z>>22,Z>>14,Z>>6,F,w>>24,w>>16,w>>8,w),10):(F=Math.floor(V/4294967296),w=V>>>0,N.push(199,12,255,Z>>24,Z>>16,Z>>8,Z,F>>24,F>>16,F>>8,F,w>>24,w>>16,w>>8,w),15)}if(C instanceof ArrayBuffer){if((A=C.byteLength)<256)N.push(196,A),n=2;else if(A<65536)N.push(197,A>>8,A),n=3;else{if(!(A<4294967296))throw new Error("Buffer too large");N.push(198,A>>24,A>>16,A>>8,A),n=5}return q.push({_bin:C,_length:A,_offset:N.length}),n+A}if("function"===typeof C.toJSON)return U(N,q,C.toJSON());var J=[],Q="",v=Object.keys(C);for(W=0,a=v.length;W<a;W++)void 0!==C[Q=v[W]]&&"function"!==typeof C[Q]&&J.push(Q);if((A=J.length)<16)N.push(128|A),n=1;else if(A<65536)N.push(222,A>>8,A),n=3;else{if(!(A<4294967296))throw new Error("Object too large");N.push(223,A>>24,A>>16,A>>8,A),n=5}for(W=0;W<A;W++)n+=U(N,q,Q=J[W]),n+=U(N,q,C[Q]);return n}if("boolean"===d)return N.push(C?195:194),1;if("undefined"===d)return N.push(192),1;if("function"===typeof C.toJSON)return U(N,q,C.toJSON());throw new Error("Could not encode")}q.encode=function(N){var q=[],C=[],W=U(q,C,N),a=new ArrayBuffer(W),F=new DataView(a),w=0,A=0,n=-1;C.length>0&&(n=C[0]._offset);for(var t,V=0,Z=0,J=0,Q=q.length;J<Q;J++)if(F.setUint8(A+J,q[J]),J+1===n){if(V=(t=C[w])._length,Z=A+n,t._bin)for(var v=new Uint8Array(t._bin),r=0;r<V;r++)F.setUint8(Z+r,v[r]);else t._str?d(F,Z,t._str):void 0!==t._float&&F.setFloat64(Z,t._float);A+=V,C[++w]&&(n=C[w]._offset)}return a}},11841:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.NoneSerializer=void 0;q.NoneSerializer=class{setState(N){}getState(){return null}patch(N){}teardown(){}handshake(N){}}},11838:(N,q,C)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.SchemaSerializer=void 0;const d=C(11804);q.SchemaSerializer=class{setState(N){return this.state.decode(N)}getState(){return this.state}patch(N){return this.state.decode(N)}teardown(){var N,q;null===(q=null===(N=this.state)||void 0===N?void 0:N.$changes)||void 0===q||q.root.clearRefs()}handshake(N,q){if(this.state){(new d.Reflection).decode(N,q)}else this.state=d.Reflection.decode(N,q)}}},11790:(N,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.getSerializer=q.registerSerializer=void 0;const C={};q.registerSerializer=function(N,q){C[N]=q},q.getSerializer=function(N){const q=C[N];if(!q)throw new Error("missing serializer: "+N);return q}},11777:function(N,q,C){"use strict";var d=this&&this.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(q,"__esModule",{value:!0}),q.WebSocketTransport=void 0;const U=d(C(11783)),W=globalThis.WebSocket||U.default;q.WebSocketTransport=class{constructor(N){this.events=N}send(N){N instanceof ArrayBuffer?this.ws.send(N):Array.isArray(N)&&this.ws.send(new Uint8Array(N).buffer)}connect(N,q){try{this.ws=new W(N,{headers:q,protocols:this.protocols})}catch(C){this.ws=new W(N,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(N,q){this.ws.close(N,q)}get isOpen(){return this.ws.readyState===W.OPEN}}},11783:N=>{"use strict";N.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12224:N=>{"use strict";N.exports=function(N){for(var q=new Array(N),C=0;C<N;++C)q[C]=C;return q}},12228:N=>{function q(N){return!!N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}N.exports=function(N){return null!=N&&(q(N)||function(N){return"function"===typeof N.readFloatLE&&"function"===typeof N.slice&&q(N.slice(0,0))}(N)||!!N._isBuffer)}},12219:(N,q,C)=>{var d=C(12224),U=C(12228),W="undefined"!==typeof Float64Array;function a(N,q){return N[0]-q[0]}function F(){var N,q=this.stride,C=new Array(q.length);for(N=0;N<C.length;++N)C[N]=[Math.abs(q[N]),N];C.sort(a);var d=new Array(C.length);for(N=0;N<d.length;++N)d[N]=C[N][1];return d}function w(N,q){var C=["View",q,"d",N].join("");q<0&&(C="View_Nil"+N);var U="generic"===N;if(-1===q){var W="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+N+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(W)()}if(0===q){W="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+N+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(U?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(U?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",W)(A[N][0])}W=["'use strict'"];var a=d(q),w=a.map((function(N){return"i"+N})),n="this.offset+"+a.map((function(N){return"this.stride["+N+"]*i"+N})).join("+"),t=a.map((function(N){return"b"+N})).join(","),V=a.map((function(N){return"c"+N})).join(",");W.push("function "+C+"(a,"+t+","+V+",d){this.data=a","this.shape=["+t+"]","this.stride=["+V+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+N+"'","proto.dimension="+q),W.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+a.map((function(N){return"this.shape["+N+"]"})).join("*"),"}})"),1===q?W.push("proto.order=[0]"):(W.push("Object.defineProperty(proto,'order',{get:"),q<4?(W.push("function "+C+"_order(){"),2===q?W.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===q&&W.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):W.push("ORDER})")),W.push("proto.set=function "+C+"_set("+w.join(",")+",v){"),U?W.push("return this.data.set("+n+",v)}"):W.push("return this.data["+n+"]=v}"),W.push("proto.get=function "+C+"_get("+w.join(",")+"){"),U?W.push("return this.data.get("+n+")}"):W.push("return this.data["+n+"]}"),W.push("proto.index=function "+C+"_index(",w.join(),"){return "+n+"}"),W.push("proto.hi=function "+C+"_hi("+w.join(",")+"){return new "+C+"(this.data,"+a.map((function(N){return["(typeof i",N,"!=='number'||i",N,"<0)?this.shape[",N,"]:i",N,"|0"].join("")})).join(",")+","+a.map((function(N){return"this.stride["+N+"]"})).join(",")+",this.offset)}");var Z=a.map((function(N){return"a"+N+"=this.shape["+N+"]"})),J=a.map((function(N){return"c"+N+"=this.stride["+N+"]"}));W.push("proto.lo=function "+C+"_lo("+w.join(",")+"){var b=this.offset,d=0,"+Z.join(",")+","+J.join(","));for(var Q=0;Q<q;++Q)W.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){d=i"+Q+"|0;b+=c"+Q+"*d;a"+Q+"-=d}");W.push("return new "+C+"(this.data,"+a.map((function(N){return"a"+N})).join(",")+","+a.map((function(N){return"c"+N})).join(",")+",b)}"),W.push("proto.step=function "+C+"_step("+w.join(",")+"){var "+a.map((function(N){return"a"+N+"=this.shape["+N+"]"})).join(",")+","+a.map((function(N){return"b"+N+"=this.stride["+N+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Q=0;Q<q;++Q)W.push("if(typeof i"+Q+"==='number'){d=i"+Q+"|0;if(d<0){c+=b"+Q+"*(a"+Q+"-1);a"+Q+"=ceil(-a"+Q+"/d)}else{a"+Q+"=ceil(a"+Q+"/d)}b"+Q+"*=d}");W.push("return new "+C+"(this.data,"+a.map((function(N){return"a"+N})).join(",")+","+a.map((function(N){return"b"+N})).join(",")+",c)}");var v=new Array(q),r=new Array(q);for(Q=0;Q<q;++Q)v[Q]="a[i"+Q+"]",r[Q]="b[i"+Q+"]";W.push("proto.transpose=function "+C+"_transpose("+w+"){"+w.map((function(N,q){return N+"=("+N+"===undefined?"+q+":"+N+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+v.join(",")+","+r.join(",")+",this.offset)}"),W.push("proto.pick=function "+C+"_pick("+w+"){var a=[],b=[],c=this.offset");for(Q=0;Q<q;++Q)W.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){c=(c+this.stride["+Q+"]*i"+Q+")|0}else{a.push(this.shape["+Q+"]);b.push(this.stride["+Q+"])}");return W.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),W.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+a.map((function(N){return"shape["+N+"]"})).join(",")+","+a.map((function(N){return"stride["+N+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",W.join("\n"))(A[N],F)}var A={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};N.exports=function(N,q,C,d){if(void 0===N)return(0,A.array[0])([]);"number"===typeof N&&(N=[N]),void 0===q&&(q=[N.length]);var a=q.length;if(void 0===C){C=new Array(a);for(var F=a-1,n=1;F>=0;--F)C[F]=n,n*=q[F]}if(void 0===d){d=0;for(F=0;F<a;++F)C[F]<0&&(d-=(q[F]-1)*C[F])}for(var t=function(N){if(U(N))return"buffer";if(W)switch(Object.prototype.toString.call(N)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(N)?"array":"generic"}(N),V=A[t];V.length<=a+1;)V.push(w(t,V.length-1));return(0,V[a+1])(N,q,C,d)}},13201:N=>{var q;self,q=()=>(()=>{"use strict";var N={d:(q,C)=>{for(var d in C)N.o(C,d)&&!N.o(q,d)&&Object.defineProperty(q,d,{enumerable:!0,get:C[d]})},o:(N,q)=>Object.prototype.hasOwnProperty.call(N,q)},q={};N.d(q,{default:()=>E});var C,d=function(N,q){var C=q.x-N.x,d=q.y-N.y;return Math.sqrt(C*C+d*d)},U=function(N){return N*(Math.PI/180)},W=new Map,a=function(N){W.has(N)&&clearTimeout(W.get(N)),W.set(N,setTimeout(N,100))},F=function(N,q,C){for(var d,U=q.split(/[ ,]+/g),W=0;W<U.length;W+=1)d=U[W],N.addEventListener?N.addEventListener(d,C,!1):N.attachEvent&&N.attachEvent(d,C)},w=function(N,q,C){for(var d,U=q.split(/[ ,]+/g),W=0;W<U.length;W+=1)d=U[W],N.removeEventListener?N.removeEventListener(d,C):N.detachEvent&&N.detachEvent(d,C)},A=function(N){return N.preventDefault(),N.type.match(/^touch/)?N.changedTouches:N},n=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},t=function(N,q){q.top||q.right||q.bottom||q.left?(N.style.top=q.top,N.style.right=q.right,N.style.bottom=q.bottom,N.style.left=q.left):(N.style.left=q.x+"px",N.style.top=q.y+"px")},V=function(N,q,C){var d=Z(N);for(var U in d)if(d.hasOwnProperty(U))if("string"==typeof q)d[U]=q+" "+C;else{for(var W="",a=0,F=q.length;a<F;a+=1)W+=q[a]+" "+C+", ";d[U]=W.slice(0,-2)}return d},Z=function(N){var q={};return q[N]="",["webkit","Moz","o"].forEach((function(C){q[C+N.charAt(0).toUpperCase()+N.slice(1)]=""})),q},J=function(N,q){for(var C in q)q.hasOwnProperty(C)&&(N[C]=q[C]);return N},Q=function(N,q){if(N.length)for(var C=0,d=N.length;C<d;C+=1)q(N[C]);else q(N)},v="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,r=window.matchMedia("(any-hover: none)").matches,O=!!("ontouchstart"in window),K=!!window.PointerEvent,i=!!window.MSPointerEvent,I={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},j={start:"mousedown",move:"mousemove",end:"mouseup"},l={};function T(){}v&&!r?C=I:K?C={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:i?C={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:O?(C=I,l=j):C=j,T.prototype.on=function(N,q){var C,d=this,U=N.split(/[ ,]+/g);d._handlers_=d._handlers_||{};for(var W=0;W<U.length;W+=1)C=U[W],d._handlers_[C]=d._handlers_[C]||[],d._handlers_[C].push(q);return d},T.prototype.off=function(N,q){var C=this;return C._handlers_=C._handlers_||{},void 0===N?C._handlers_={}:void 0===q?C._handlers_[N]=null:C._handlers_[N]&&C._handlers_[N].indexOf(q)>=0&&C._handlers_[N].splice(C._handlers_[N].indexOf(q),1),C},T.prototype.trigger=function(N,q){var C,d=this,U=N.split(/[ ,]+/g);d._handlers_=d._handlers_||{};for(var W=0;W<U.length;W+=1)C=U[W],d._handlers_[C]&&d._handlers_[C].length&&d._handlers_[C].forEach((function(N){N.call(d,{type:C,target:d},q)}))},T.prototype.config=function(N){var q=this;q.options=q.defaults||{},N&&(q.options=function(N,q){var C={};for(var d in N)N.hasOwnProperty(d)&&q.hasOwnProperty(d)?C[d]=q[d]:N.hasOwnProperty(d)&&(C[d]=N[d]);return C}(q.options,N))},T.prototype.bindEvt=function(N,q){var d=this;return d._domHandlers_=d._domHandlers_||{},d._domHandlers_[q]=function(){"function"==typeof d["on"+q]?d["on"+q].apply(d,arguments):console.warn('[WARNING] : Missing "on'+q+'" handler.')},F(N,C[q],d._domHandlers_[q]),l[q]&&F(N,l[q],d._domHandlers_[q]),d},T.prototype.unbindEvt=function(N,q){var d=this;return d._domHandlers_=d._domHandlers_||{},w(N,C[q],d._domHandlers_[q]),l[q]&&w(N,l[q],d._domHandlers_[q]),delete d._domHandlers_[q],this};const z=T;function p(N,q){return this.identifier=q.identifier,this.position=q.position,this.frontPosition=q.frontPosition,this.collection=N,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(q),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=p.id,p.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}p.prototype=new z,p.constructor=p,p.id=0,p.prototype.buildEl=function(N){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},p.prototype.stylize=function(){if(this.options.dataOnly)return this;var N=this.options.fadeTime+"ms",q=function(){var N=Z("borderRadius");for(var q in N)N.hasOwnProperty(q)&&(N[q]="50%");return N}(),C=V("transition","opacity",N),d={};return d.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},d.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},d.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},J(d.el,C),"circle"===this.options.shape&&J(d.back,q),J(d.front,q),this.applyStyles(d),this},p.prototype.applyStyles=function(N){for(var q in this.ui)if(this.ui.hasOwnProperty(q))for(var C in N[q])this.ui[q].style[C]=N[q][C];return this},p.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},p.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},p.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},p.prototype.show=function(N){var q=this;return q.options.dataOnly||(clearTimeout(q.removeTimeout),clearTimeout(q.showTimeout),clearTimeout(q.restTimeout),q.addToDom(),q.restCallback(),setTimeout((function(){q.ui.el.style.opacity=1}),0),q.showTimeout=setTimeout((function(){q.trigger("shown",q.instance),"function"==typeof N&&N.call(this)}),q.options.fadeTime)),q},p.prototype.hide=function(N){var q=this;if(q.options.dataOnly)return q;if(q.ui.el.style.opacity=q.options.restOpacity,clearTimeout(q.removeTimeout),clearTimeout(q.showTimeout),clearTimeout(q.restTimeout),q.removeTimeout=setTimeout((function(){var C="dynamic"===q.options.mode?"none":"block";q.ui.el.style.display=C,"function"==typeof N&&N.call(q),q.trigger("hidden",q.instance)}),q.options.fadeTime),q.options.restJoystick){var C=q.options.restJoystick,d={};d.x=!0===C||!1!==C.x?0:q.instance.frontPosition.x,d.y=!0===C||!1!==C.y?0:q.instance.frontPosition.y,q.setPosition(N,d)}return q},p.prototype.setPosition=function(N,q){var C=this;C.frontPosition={x:q.x,y:q.y};var d=C.options.fadeTime+"ms",U={};U.front=V("transition",["transform"],d);var W={front:{}};W.front={transform:"translate("+C.frontPosition.x+"px,"+C.frontPosition.y+"px)"},C.applyStyles(U),C.applyStyles(W),C.restTimeout=setTimeout((function(){"function"==typeof N&&N.call(C),C.restCallback()}),C.options.fadeTime)},p.prototype.restCallback=function(){var N=this,q={};q.front=V("transition","none",""),N.applyStyles(q),N.trigger("rested",N.instance)},p.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},p.prototype.computeDirection=function(N){var q,C,d,U=N.angle.radian,W=Math.PI/4,a=Math.PI/2;if(U>W&&U<3*W&&!N.lockX?q="up":U>-W&&U<=W&&!N.lockY?q="left":U>3*-W&&U<=-W&&!N.lockX?q="down":N.lockY||(q="right"),N.lockY||(C=U>-a&&U<a?"left":"right"),N.lockX||(d=U>0?"up":"down"),N.force>this.options.threshold){var F,w={};for(F in this.direction)this.direction.hasOwnProperty(F)&&(w[F]=this.direction[F]);var A={};for(F in this.direction={x:C,y:d,angle:q},N.direction=this.direction,w)w[F]===this.direction[F]&&(A[F]=!0);if(A.x&&A.y&&A.angle)return N;A.x&&A.y||this.trigger("plain",N),A.x||this.trigger("plain:"+C,N),A.y||this.trigger("plain:"+d,N),A.angle||this.trigger("dir dir:"+q,N)}else this.resetDirection();return N};const s=p;function X(N,q){var C=this;C.nipples=[],C.idles=[],C.actives=[],C.ids=[],C.pressureIntervals={},C.manager=N,C.id=X.id,X.id+=1,C.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},C.config(q),"static"!==C.options.mode&&"semi"!==C.options.mode||(C.options.multitouch=!1),C.options.multitouch||(C.options.maxNumberOfNipples=1);var d=getComputedStyle(C.options.zone.parentElement);return d&&"flex"===d.display&&(C.parentIsFlex=!0),C.updateBox(),C.prepareNipples(),C.xt(),C.begin(),C.nipples}X.prototype=new z,X.constructor=X,X.id=0,X.prototype.prepareNipples=function(){var N=this,q=N.nipples;q.on=N.on.bind(N),q.off=N.off.bind(N),q.options=N.options,q.destroy=N.destroy.bind(N),q.ids=N.ids,q.id=N.id,q.processOnMove=N.processOnMove.bind(N),q.processOnEnd=N.processOnEnd.bind(N),q.get=function(N){if(void 0===N)return q[0];for(var C=0,d=q.length;C<d;C+=1)if(q[C].identifier===N)return q[C];return!1}},X.prototype.xt=function(){var N=this;N.bindEvt(N.options.zone,"start"),N.options.zone.style.touchAction="none",N.options.zone.style.msTouchAction="none"},X.prototype.begin=function(){var N=this,q=N.options;if("static"===q.mode){var C=N.createNipple(q.position,N.manager.getIdentifier());C.add(),N.idles.push(C)}},X.prototype.createNipple=function(N,q){var C=this,d=C.manager.scroll,U={},W=C.options,a=C.parentIsFlex?d.x:d.x+C.box.left,F=C.parentIsFlex?d.y:d.y+C.box.top;if(N.x&&N.y)U={x:N.x-a,y:N.y-F};else if(N.top||N.right||N.bottom||N.left){var w=document.createElement("DIV");w.style.display="hidden",w.style.top=N.top,w.style.right=N.right,w.style.bottom=N.bottom,w.style.left=N.left,w.style.position="absolute",W.zone.appendChild(w);var A=w.getBoundingClientRect();W.zone.removeChild(w),U=N,N={x:A.left+d.x,y:A.top+d.y}}var n=new s(C,{color:W.color,size:W.size,threshold:W.threshold,fadeTime:W.fadeTime,dataOnly:W.dataOnly,restJoystick:W.restJoystick,restOpacity:W.restOpacity,mode:W.mode,identifier:q,position:N,zone:W.zone,frontPosition:{x:0,y:0},shape:W.shape});return W.dataOnly||(t(n.ui.el,U),t(n.ui.front,n.frontPosition)),C.nipples.push(n),C.trigger("added "+n.identifier+":added",n),C.manager.trigger("added "+n.identifier+":added",n),C.bindNipple(n),n},X.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},X.prototype.bindNipple=function(N){var q,C=this,d=function(N,d){q=N.type+" "+d.id+":"+N.type,C.trigger(q,d)};N.on("destroyed",C.onDestroyed.bind(C)),N.on("shown hidden rested dir plain",d),N.on("dir:up dir:right dir:down dir:left",d),N.on("plain:up plain:right plain:down plain:left",d)},X.prototype.pressureFn=function(N,q,C){var d=this,U=0;clearInterval(d.pressureIntervals[C]),d.pressureIntervals[C]=setInterval(function(){var C=N.force||N.pressure||N.webkitForce||0;C!==U&&(q.trigger("pressure",C),d.trigger("pressure "+q.identifier+":pressure",C),U=C)}.bind(d),100)},X.prototype.onstart=function(N){var q=this,C=q.options,d=N;return N=A(N),q.updateBox(),Q(N,(function(U){q.actives.length<C.maxNumberOfNipples?q.processOnStart(U):d.type.match(/^touch/)&&(Object.keys(q.manager.ids).forEach((function(C){if(Object.values(d.touches).findIndex((function(N){return N.identifier===C}))<0){var U=[N[0]];U.identifier=C,q.processOnEnd(U)}})),q.actives.length<C.maxNumberOfNipples&&q.processOnStart(U))})),q.manager.bindDocument(),!1},X.prototype.processOnStart=function(N){var q,C=this,U=C.options,W=C.manager.getIdentifier(N),a=N.force||N.pressure||N.webkitForce||0,F={x:N.pageX,y:N.pageY},w=C.getOrCreate(W,F);w.identifier!==W&&C.manager.removeIdentifier(w.identifier),w.identifier=W;var A=function(q){q.trigger("start",q),C.trigger("start "+q.id+":start",q),q.show(),a>0&&C.pressureFn(N,q,q.identifier),C.processOnMove(N)};if((q=C.idles.indexOf(w))>=0&&C.idles.splice(q,1),C.actives.push(w),C.ids.push(w.identifier),"semi"!==U.mode)A(w);else{if(!(d(F,w.position)<=U.catchDistance))return w.destroy(),void C.processOnStart(N);A(w)}return w},X.prototype.getOrCreate=function(N,q){var C,d=this,U=d.options;return/(semi|static)/.test(U.mode)?(C=d.idles[0])?(d.idles.splice(0,1),C):"semi"===U.mode?d.createNipple(q,N):(console.warn("Coudln't find the needed nipple."),!1):C=d.createNipple(q,N)},X.prototype.processOnMove=function(N){var q=this,C=q.options,W=q.manager.getIdentifier(N),a=q.nipples.get(W),F=q.manager.scroll;if(function(N){return isNaN(N.buttons)?0!==N.pressure:0!==N.buttons}(N)){if(!a)return console.error("Found zombie joystick with ID "+W),void q.manager.removeIdentifier(W);if(C.dynamicPage){var w=a.el.getBoundingClientRect();a.position={x:F.x+w.left,y:F.y+w.top}}a.identifier=W;var A=a.options.size/2,n={x:N.pageX,y:N.pageY};C.lockX&&(n.y=a.position.y),C.lockY&&(n.x=a.position.x);var t,V,Z,J,Q,v,r,O,K,i,I=d(n,a.position),j=(t=n,Z=(V=a.position).x-t.x,J=V.y-t.y,function(N){return N*(180/Math.PI)}(Math.atan2(J,Z))),l=U(j),T=I/A,z={distance:I,position:n};if("circle"===a.options.shape?(Q=Math.min(I,A),r=a.position,O=Q,i={x:0,y:0},K=U(K=j),i.x=r.x-O*Math.cos(K),i.y=r.y-O*Math.sin(K),v=i):(v=function(N,q,C){return{x:Math.min(Math.max(N.x,q.x-C),q.x+C),y:Math.min(Math.max(N.y,q.y-C),q.y+C)}}(n,a.position,A),Q=d(v,a.position)),C.follow){if(I>A){var p=n.x-v.x,s=n.y-v.y;a.position.x+=p,a.position.y+=s,a.el.style.top=a.position.y-(q.box.top+F.y)+"px",a.el.style.left=a.position.x-(q.box.left+F.x)+"px",I=d(n,a.position)}}else n=v,I=Q;var X=n.x-a.position.x,P=n.y-a.position.y;a.frontPosition={x:X,y:P},C.dataOnly||(a.ui.front.style.transform="translate("+X+"px,"+P+"px)");var M={identifier:a.identifier,position:n,force:T,pressure:N.force||N.pressure||N.webkitForce||0,distance:I,angle:{radian:l,degree:j},vector:{x:X/A,y:-P/A},raw:z,instance:a,lockX:C.lockX,lockY:C.lockY};(M=a.computeDirection(M)).angle={radian:U(180-j),degree:180-j},a.trigger("move",M),q.trigger("move "+a.id+":move",M)}else this.processOnEnd(N)},X.prototype.processOnEnd=function(N){var q=this,C=q.options,d=q.manager.getIdentifier(N),U=q.nipples.get(d),W=q.manager.removeIdentifier(U.identifier);U&&(C.dataOnly||U.hide((function(){"dynamic"===C.mode&&(U.trigger("removed",U),q.trigger("removed "+U.id+":removed",U),q.manager.trigger("removed "+U.id+":removed",U),U.destroy())})),clearInterval(q.pressureIntervals[U.identifier]),U.resetDirection(),U.trigger("end",U),q.trigger("end "+U.id+":end",U),q.ids.indexOf(U.identifier)>=0&&q.ids.splice(q.ids.indexOf(U.identifier),1),q.actives.indexOf(U)>=0&&q.actives.splice(q.actives.indexOf(U),1),/(semi|static)/.test(C.mode)?q.idles.push(U):q.nipples.indexOf(U)>=0&&q.nipples.splice(q.nipples.indexOf(U),1),q.manager.unbindDocument(),/(semi|static)/.test(C.mode)&&(q.manager.ids[W.id]=W.identifier))},X.prototype.onDestroyed=function(N,q){var C=this;C.nipples.indexOf(q)>=0&&C.nipples.splice(C.nipples.indexOf(q),1),C.actives.indexOf(q)>=0&&C.actives.splice(C.actives.indexOf(q),1),C.idles.indexOf(q)>=0&&C.idles.splice(C.idles.indexOf(q),1),C.ids.indexOf(q.identifier)>=0&&C.ids.splice(C.ids.indexOf(q.identifier),1),C.manager.removeIdentifier(q.identifier),C.manager.unbindDocument()},X.prototype.destroy=function(){var N=this;for(var q in N.unbindEvt(N.options.zone,"start"),N.nipples.forEach((function(N){N.destroy()})),N.pressureIntervals)N.pressureIntervals.hasOwnProperty(q)&&clearInterval(N.pressureIntervals[q]);N.trigger("destroyed",N.nipples),N.manager.unbindDocument(),N.off()};const P=X;function M(N){var q=this;q.ids={},q.index=0,q.collections=[],q.scroll=n(),q.config(N),q.prepareCollections();var C=function(){var N;q.collections.forEach((function(C){C.forEach((function(C){N=C.el.getBoundingClientRect(),C.position={x:q.scroll.x+N.left,y:q.scroll.y+N.top}}))}))};F(window,"resize",(function(){a(C)}));var d=function(){q.scroll=n()};return F(window,"scroll",(function(){a(d)})),q.collections}M.prototype=new z,M.constructor=M,M.prototype.prepareCollections=function(){var N=this;N.collections.create=N.create.bind(N),N.collections.on=N.on.bind(N),N.collections.off=N.off.bind(N),N.collections.destroy=N.destroy.bind(N),N.collections.get=function(q){var C;return N.collections.every((function(N){return!(C=N.get(q))})),C}},M.prototype.create=function(N){return this.createCollection(N)},M.prototype.createCollection=function(N){var q=this,C=new P(q,N);return q.bindCollection(C),q.collections.push(C),C},M.prototype.bindCollection=function(N){var q,C=this,d=function(N,d){q=N.type+" "+d.id+":"+N.type,C.trigger(q,d)};N.on("destroyed",C.onDestroyed.bind(C)),N.on("shown hidden rested dir plain",d),N.on("dir:up dir:right dir:down dir:left",d),N.on("plain:up plain:right plain:down plain:left",d)},M.prototype.bindDocument=function(){var N=this;N.binded||(N.bindEvt(document,"move").bindEvt(document,"end"),N.binded=!0)},M.prototype.unbindDocument=function(N){var q=this;Object.keys(q.ids).length&&!0!==N||(q.unbindEvt(document,"move").unbindEvt(document,"end"),q.binded=!1)},M.prototype.getIdentifier=function(N){var q;return N?void 0===(q=void 0===N.identifier?N.pointerId:N.identifier)&&(q=this.latest||0):q=this.index,void 0===this.ids[q]&&(this.ids[q]=this.index,this.index+=1),this.latest=q,this.ids[q]},M.prototype.removeIdentifier=function(N){var q={};for(var C in this.ids)if(this.ids[C]===N){q.id=C,q.identifier=this.ids[C],delete this.ids[C];break}return q},M.prototype.onmove=function(N){return this.onAny("move",N),!1},M.prototype.onend=function(N){return this.onAny("end",N),!1},M.prototype.oncancel=function(N){return this.onAny("end",N),!1},M.prototype.onAny=function(N,q){var C,d=this,U="processOn"+N.charAt(0).toUpperCase()+N.slice(1);q=A(q);var W=function(N,q,C){C.ids.indexOf(q)>=0&&(C[U](N),N._found_=!0)};return Q(q,(function(N){C=d.getIdentifier(N),Q(d.collections,W.bind(null,N,C)),N._found_||d.removeIdentifier(C)})),!1},M.prototype.destroy=function(){var N=this;N.unbindDocument(!0),N.ids={},N.index=0,N.collections.forEach((function(N){N.destroy()})),N.off()},M.prototype.onDestroyed=function(N,q){var C=this;if(C.collections.indexOf(q)<0)return!1;C.collections.splice(C.collections.indexOf(q),1)};var Y=new M;const E={create:function(N){return Y.create(N)},factory:Y};return q.default})(),N.exports=q()},12242:(N,q,C)=>{"use strict";const{Deflate:d,deflate:U,deflateRaw:W,gzip:a}=C(12250),{Inflate:F,inflate:w,inflateRaw:A,ungzip:n}=C(12309),t=C(12290);N.exports.Deflate=d,N.exports.deflate=U,N.exports.deflateRaw=W,N.exports.gzip=a,N.exports.Inflate=F,N.exports.inflate=w,N.exports.inflateRaw=A,N.exports.ungzip=n,N.exports.constants=t},12250:(N,q,C)=>{"use strict";const d=C(12258),U=C(12292),W=C(12295),a=C(12281),F=C(12304),w=Object.prototype.toString,{Z_NO_FLUSH:A,Z_SYNC_FLUSH:n,Z_FULL_FLUSH:t,Z_FINISH:V,Z_OK:Z,Z_STREAM_END:J,Z_DEFAULT_COMPRESSION:Q,Z_DEFAULT_STRATEGY:v,Z_DEFLATED:r}=C(12290);function O(N){this.options=U.assign({level:Q,method:r,SN:16384,windowBits:15,memLevel:8,strategy:v},N||{});let q=this.options;q.raw&&q.windowBits>0?q.windowBits=-q.windowBits:q.gzip&&q.windowBits>0&&q.windowBits<16&&(q.windowBits+=16),this.err=0,this.Aq="",this.ended=!1,this.chunks=[],this.strm=new F,this.strm.avail_out=0;let C=d.deflateInit2(this.strm,q.level,q.method,q.windowBits,q.memLevel,q.strategy);if(C!==Z)throw new Error(a[C]);if(q.header&&d.deflateSetHeader(this.strm,q.header),q.dictionary){let N;if(N="string"===typeof q.dictionary?W.string2buf(q.dictionary):"[object ArrayBuffer]"===w.call(q.dictionary)?new Uint8Array(q.dictionary):q.dictionary,C=d.deflateSetDictionary(this.strm,N),C!==Z)throw new Error(a[C]);this._dict_set=!0}}function K(N,q){const C=new O(q);if(C.push(N,!0),C.err)throw C.Aq||a[C.err];return C.result}O.prototype.push=function(N,q){const C=this.strm,U=this.options.SN;let a,F;if(this.ended)return!1;for(F=q===~~q?q:!0===q?V:A,"string"===typeof N?C.input=W.string2buf(N):"[object ArrayBuffer]"===w.call(N)?C.input=new Uint8Array(N):C.input=N,C.next_in=0,C.avail_in=C.input.length;;)if(0===C.avail_out&&(C.output=new Uint8Array(U),C.next_out=0,C.avail_out=U),(F===n||F===t)&&C.avail_out<=6)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else{if(a=d.deflate(C,F),a===J)return C.next_out>0&&this.onData(C.output.subarray(0,C.next_out)),a=d.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Z;if(0!==C.avail_out){if(F>0&&C.next_out>0)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else if(0===C.avail_in)break}else this.onData(C.output)}return!0},O.prototype.onData=function(N){this.chunks.push(N)},O.prototype.onEnd=function(N){N===Z&&(this.result=U.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.Aq=this.strm.Aq},N.exports.Deflate=O,N.exports.deflate=K,N.exports.deflateRaw=function(N,q){return(q=q||{}).raw=!0,K(N,q)},N.exports.gzip=function(N,q){return(q=q||{}).gzip=!0,K(N,q)},N.exports.constants=C(12290)},12309:(N,q,C)=>{"use strict";const d=C(12315),U=C(12292),W=C(12295),a=C(12281),F=C(12304),w=C(12328),A=Object.prototype.toString,{Z_NO_FLUSH:n,Z_FINISH:t,Z_OK:V,Z_STREAM_END:Z,Z_NEED_DICT:J,Z_STREAM_ERROR:Q,Z_DATA_ERROR:v,Z_MEM_ERROR:r}=C(12290);function O(N){this.options=U.assign({SN:65536,windowBits:15,to:""},N||{});const q=this.options;q.raw&&q.windowBits>=0&&q.windowBits<16&&(q.windowBits=-q.windowBits,0===q.windowBits&&(q.windowBits=-15)),!(q.windowBits>=0&&q.windowBits<16)||N&&N.windowBits||(q.windowBits+=32),q.windowBits>15&&q.windowBits<48&&0===(15&q.windowBits)&&(q.windowBits|=15),this.err=0,this.Aq="",this.ended=!1,this.chunks=[],this.strm=new F,this.strm.avail_out=0;let C=d.inflateInit2(this.strm,q.windowBits);if(C!==V)throw new Error(a[C]);if(this.header=new w,d.inflateGetHeader(this.strm,this.header),q.dictionary&&("string"===typeof q.dictionary?q.dictionary=W.string2buf(q.dictionary):"[object ArrayBuffer]"===A.call(q.dictionary)&&(q.dictionary=new Uint8Array(q.dictionary)),q.raw&&(C=d.inflateSetDictionary(this.strm,q.dictionary),C!==V)))throw new Error(a[C])}function K(N,q){const C=new O(q);if(C.push(N),C.err)throw C.Aq||a[C.err];return C.result}O.prototype.push=function(N,q){const C=this.strm,U=this.options.SN,a=this.options.dictionary;let F,w,O;if(this.ended)return!1;for(w=q===~~q?q:!0===q?t:n,"[object ArrayBuffer]"===A.call(N)?C.input=new Uint8Array(N):C.input=N,C.next_in=0,C.avail_in=C.input.length;;){for(0===C.avail_out&&(C.output=new Uint8Array(U),C.next_out=0,C.avail_out=U),F=d.inflate(C,w),F===J&&a&&(F=d.inflateSetDictionary(C,a),F===V?F=d.inflate(C,w):F===v&&(F=J));C.avail_in>0&&F===Z&&C.state.wrap>0&&0!==N[C.next_in];)d.inflateReset(C),F=d.inflate(C,w);switch(F){case Q:case v:case J:case r:return this.onEnd(F),this.ended=!0,!1}if(O=C.avail_out,C.next_out&&(0===C.avail_out||F===Z))if("string"===this.options.to){let N=W.utf8border(C.output,C.next_out),q=C.next_out-N,d=W.buf2string(C.output,N);C.next_out=q,C.avail_out=U-q,q&&C.output.set(C.output.subarray(N,N+q),0),this.onData(d)}else this.onData(C.output.length===C.next_out?C.output:C.output.subarray(0,C.next_out));if(F!==V||0!==O){if(F===Z)return F=d.inflateEnd(this.strm),this.onEnd(F),this.ended=!0,!0;if(0===C.avail_in)break}}return!0},O.prototype.onData=function(N){this.chunks.push(N)},O.prototype.onEnd=function(N){N===V&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=U.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.Aq=this.strm.Aq},N.exports.Inflate=O,N.exports.inflate=K,N.exports.inflateRaw=function(N,q){return(q=q||{}).raw=!0,K(N,q)},N.exports.ungzip=K,N.exports.constants=C(12290)},12292:N=>{"use strict";const q=(N,q)=>Object.prototype.hasOwnProperty.call(N,q);N.exports.assign=function(N){const C=Array.prototype.slice.call(arguments,1);for(;C.length;){const d=C.shift();if(d){if("object"!==typeof d)throw new TypeError(d+"must be non-object");for(const C in d)q(d,C)&&(N[C]=d[C])}}return N},N.exports.flattenChunks=N=>{let q=0;for(let d=0,U=N.length;d<U;d++)q+=N[d].length;const C=new Uint8Array(q);for(let d=0,U=0,W=N.length;d<W;d++){let q=N[d];C.set(q,U),U+=q.length}return C}},12295:N=>{"use strict";let q=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(d){q=!1}const C=new Uint8Array(256);for(let U=0;U<256;U++)C[U]=U>=252?6:U>=248?5:U>=240?4:U>=224?3:U>=192?2:1;C[254]=C[254]=1,N.exports.string2buf=N=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(N);let q,C,d,U,W,a=N.length,F=0;for(U=0;U<a;U++)C=N.charCodeAt(U),55296===(64512&C)&&U+1<a&&(d=N.charCodeAt(U+1),56320===(64512&d)&&(C=65536+(C-55296<<10)+(d-56320),U++)),F+=C<128?1:C<2048?2:C<65536?3:4;for(q=new Uint8Array(F),W=0,U=0;W<F;U++)C=N.charCodeAt(U),55296===(64512&C)&&U+1<a&&(d=N.charCodeAt(U+1),56320===(64512&d)&&(C=65536+(C-55296<<10)+(d-56320),U++)),C<128?q[W++]=C:C<2048?(q[W++]=192|C>>>6,q[W++]=128|63&C):C<65536?(q[W++]=224|C>>>12,q[W++]=128|C>>>6&63,q[W++]=128|63&C):(q[W++]=240|C>>>18,q[W++]=128|C>>>12&63,q[W++]=128|C>>>6&63,q[W++]=128|63&C);return q};N.exports.buf2string=(N,d)=>{const U=d||N.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(N.subarray(0,d));let W,a;const F=new Array(2*U);for(a=0,W=0;W<U;){let q=N[W++];if(q<128){F[a++]=q;continue}let d=C[q];if(d>4)F[a++]=65533,W+=d-1;else{for(q&=2===d?31:3===d?15:7;d>1&&W<U;)q=q<<6|63&N[W++],d--;d>1?F[a++]=65533:q<65536?F[a++]=q:(q-=65536,F[a++]=55296|q>>10&1023,F[a++]=56320|1023&q)}}return((N,C)=>{if(C<65534&&N.subarray&&q)return String.fromCharCode.apply(null,N.length===C?N:N.subarray(0,C));let d="";for(let q=0;q<C;q++)d+=String.fromCharCode(N[q]);return d})(F,a)},N.exports.utf8border=(N,q)=>{(q=q||N.length)>N.length&&(q=N.length);let d=q-1;for(;d>=0&&128===(192&N[d]);)d--;return d<0||0===d?q:d+C[N[d]]>q?d:q}},12268:N=>{"use strict";N.exports=(N,q,C,d)=>{let U=65535&N,W=N>>>16&65535,a=0;for(;0!==C;){a=C>2e3?2e3:C,C-=a;do{U=U+q[d++]|0,W=W+U|0}while(--a);U%=65521,W%=65521}return U|W<<16}},12290:N=>{"use strict";N.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12277:N=>{"use strict";const q=new Uint32Array((()=>{let N,q=[];for(var C=0;C<256;C++){N=C;for(var d=0;d<8;d++)N=1&N?3988292384^N>>>1:N>>>1;q[C]=N}return q})());N.exports=(N,C,d,U)=>{const W=q,a=U+d;N^=-1;for(let q=U;q<a;q++)N=N>>>8^W[255&(N^C[q])];return~N}},12258:(N,q,C)=>{"use strict";const{_tr_init:d,_tr_stored_block:U,_tr_flush_block:W,_tr_tally:a,_tr_align:F}=C(12264),w=C(12268),A=C(12277),n=C(12281),{Z_NO_FLUSH:t,Z_PARTIAL_FLUSH:V,Z_FULL_FLUSH:Z,Z_FINISH:J,Z_BLOCK:Q,Z_OK:v,Z_STREAM_END:r,Z_STREAM_ERROR:O,Z_DATA_ERROR:K,Z_BUF_ERROR:i,Z_DEFAULT_COMPRESSION:I,Z_FILTERED:j,Z_HUFFMAN_ONLY:l,Z_RLE:T,Z_FIXED:z,Z_DEFAULT_STRATEGY:p,Z_UNKNOWN:s,Z_DEFLATED:X}=C(12290),P=258,M=262,Y=103,E=113,H=666,e=(N,q)=>(N.Aq=n[q],q),b=N=>(N<<1)-(N>4?9:0),o=N=>{let q=N.length;for(;--q>=0;)N[q]=0};let S=(N,q,C)=>(q<<N.hash_shift^C)&N.hash_mask;const D=N=>{const q=N.state;let C=q.pending;C>N.avail_out&&(C=N.avail_out),0!==C&&(N.output.set(q.pending_buf.subarray(q.pending_out,q.pending_out+C),N.next_out),N.next_out+=C,q.pending_out+=C,N.total_out+=C,N.avail_out-=C,q.pending-=C,0===q.pending&&(q.pending_out=0))},c=(N,q)=>{W(N,N.block_start>=0?N.block_start:-1,N.strstart-N.block_start,q),N.block_start=N.strstart,D(N.strm)},L=(N,q)=>{N.pending_buf[N.pending++]=q},G=(N,q)=>{N.pending_buf[N.pending++]=q>>>8&255,N.pending_buf[N.pending++]=255&q},h=(N,q,C,d)=>{let U=N.avail_in;return U>d&&(U=d),0===U?0:(N.avail_in-=U,q.set(N.input.subarray(N.next_in,N.next_in+U),C),1===N.state.wrap?N.adler=w(N.adler,q,U,C):2===N.state.wrap&&(N.adler=A(N.adler,q,U,C)),N.next_in+=U,N.total_in+=U,U)},B=(N,q)=>{let C,d,U=N.max_chain_length,W=N.strstart,a=N.prev_length,F=N.nice_match;const w=N.strstart>N.w_size-M?N.strstart-(N.w_size-M):0,A=N.window,n=N.w_mask,t=N.prev,V=N.strstart+P;let Z=A[W+a-1],J=A[W+a];N.prev_length>=N.good_match&&(U>>=2),F>N.lookahead&&(F=N.lookahead);do{if(C=q,A[C+a]===J&&A[C+a-1]===Z&&A[C]===A[W]&&A[++C]===A[W+1]){W+=2,C++;do{}while(A[++W]===A[++C]&&A[++W]===A[++C]&&A[++W]===A[++C]&&A[++W]===A[++C]&&A[++W]===A[++C]&&A[++W]===A[++C]&&A[++W]===A[++C]&&A[++W]===A[++C]&&W<V);if(d=P-(V-W),W=V-P,d>a){if(N.match_start=q,a=d,d>=F)break;Z=A[W+a-1],J=A[W+a]}}}while((q=t[q&n])>w&&0!==--U);return a<=N.lookahead?a:N.lookahead},y=N=>{const q=N.w_size;let C,d,U,W,a;do{if(W=N.window_size-N.lookahead-N.strstart,N.strstart>=q+(q-M)){N.window.set(N.window.subarray(q,q+q),0),N.match_start-=q,N.strstart-=q,N.block_start-=q,d=N.hash_size,C=d;do{U=N.head[--C],N.head[C]=U>=q?U-q:0}while(--d);d=q,C=d;do{U=N.prev[--C],N.prev[C]=U>=q?U-q:0}while(--d);W+=q}if(0===N.strm.avail_in)break;if(d=h(N.strm,N.window,N.strstart+N.lookahead,W),N.lookahead+=d,N.lookahead+N.insert>=3)for(a=N.strstart-N.insert,N.ins_h=N.window[a],N.ins_h=S(N,N.ins_h,N.window[a+1]);N.insert&&(N.ins_h=S(N,N.ins_h,N.window[a+3-1]),N.prev[a&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=a,a++,N.insert--,!(N.lookahead+N.insert<3)););}while(N.lookahead<M&&0!==N.strm.avail_in)},R=(N,q)=>{let C,d;for(;;){if(N.lookahead<M){if(y(N),N.lookahead<M&&q===t)return 1;if(0===N.lookahead)break}if(C=0,N.lookahead>=3&&(N.ins_h=S(N,N.ins_h,N.window[N.strstart+3-1]),C=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),0!==C&&N.strstart-C<=N.w_size-M&&(N.match_length=B(N,C)),N.match_length>=3)if(d=a(N,N.strstart-N.match_start,N.match_length-3),N.lookahead-=N.match_length,N.match_length<=N.max_lazy_match&&N.lookahead>=3){N.match_length--;do{N.strstart++,N.ins_h=S(N,N.ins_h,N.window[N.strstart+3-1]),C=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart}while(0!==--N.match_length);N.strstart++}else N.strstart+=N.match_length,N.match_length=0,N.ins_h=N.window[N.strstart],N.ins_h=S(N,N.ins_h,N.window[N.strstart+1]);else d=a(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++;if(d&&(c(N,!1),0===N.strm.avail_out))return 1}return N.insert=N.strstart<2?N.strstart:2,q===J?(c(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(c(N,!1),0===N.strm.avail_out)?1:2},u=(N,q)=>{let C,d,U;for(;;){if(N.lookahead<M){if(y(N),N.lookahead<M&&q===t)return 1;if(0===N.lookahead)break}if(C=0,N.lookahead>=3&&(N.ins_h=S(N,N.ins_h,N.window[N.strstart+3-1]),C=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),N.prev_length=N.match_length,N.prev_match=N.match_start,N.match_length=2,0!==C&&N.prev_length<N.max_lazy_match&&N.strstart-C<=N.w_size-M&&(N.match_length=B(N,C),N.match_length<=5&&(N.strategy===j||3===N.match_length&&N.strstart-N.match_start>4096)&&(N.match_length=2)),N.prev_length>=3&&N.match_length<=N.prev_length){U=N.strstart+N.lookahead-3,d=a(N,N.strstart-1-N.prev_match,N.prev_length-3),N.lookahead-=N.prev_length-1,N.prev_length-=2;do{++N.strstart<=U&&(N.ins_h=S(N,N.ins_h,N.window[N.strstart+3-1]),C=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart)}while(0!==--N.prev_length);if(N.match_available=0,N.match_length=2,N.strstart++,d&&(c(N,!1),0===N.strm.avail_out))return 1}else if(N.match_available){if(d=a(N,0,N.window[N.strstart-1]),d&&c(N,!1),N.strstart++,N.lookahead--,0===N.strm.avail_out)return 1}else N.match_available=1,N.strstart++,N.lookahead--}return N.match_available&&(d=a(N,0,N.window[N.strstart-1]),N.match_available=0),N.insert=N.strstart<2?N.strstart:2,q===J?(c(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(c(N,!1),0===N.strm.avail_out)?1:2};function m(N,q,C,d,U){this.good_length=N,this.max_lazy=q,this.nice_length=C,this.max_chain=d,this.func=U}const f=[new m(0,0,0,0,((N,q)=>{let C=65535;for(C>N.pending_buf_size-5&&(C=N.pending_buf_size-5);;){if(N.lookahead<=1){if(y(N),0===N.lookahead&&q===t)return 1;if(0===N.lookahead)break}N.strstart+=N.lookahead,N.lookahead=0;const d=N.block_start+C;if((0===N.strstart||N.strstart>=d)&&(N.lookahead=N.strstart-d,N.strstart=d,c(N,!1),0===N.strm.avail_out))return 1;if(N.strstart-N.block_start>=N.w_size-M&&(c(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,q===J?(c(N,!0),0===N.strm.avail_out?3:4):(N.strstart>N.block_start&&(c(N,!1),N.strm.avail_out),1)})),new m(4,4,8,4,R),new m(4,5,16,8,R),new m(4,6,32,32,R),new m(4,4,16,16,u),new m(8,16,32,32,u),new m(8,16,128,128,u),new m(8,32,128,256,u),new m(32,128,258,1024,u),new m(32,258,258,4096,u)];function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=X,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const g=N=>{if(!N||!N.state)return e(N,O);N.total_in=N.total_out=0,N.data_type=s;const q=N.state;return q.pending=0,q.pending_out=0,q.wrap<0&&(q.wrap=-q.wrap),q.status=q.wrap?42:E,N.adler=2===q.wrap?0:1,q.last_flush=t,d(q),v},x=N=>{const q=g(N);var C;return q===v&&((C=N.state).window_size=2*C.w_size,o(C.head),C.max_lazy_match=f[C.level].max_lazy,C.good_match=f[C.level].good_length,C.nice_match=f[C.level].nice_length,C.max_chain_length=f[C.level].max_chain,C.strstart=0,C.block_start=0,C.lookahead=0,C.insert=0,C.match_length=C.prev_length=2,C.match_available=0,C.ins_h=0),q},NN=(N,q,C,d,U,W)=>{if(!N)return O;let a=1;if(q===I&&(q=6),d<0?(a=0,d=-d):d>15&&(a=2,d-=16),U<1||U>9||C!==X||d<8||d>15||q<0||q>9||W<0||W>z)return e(N,O);8===d&&(d=9);const F=new k;return N.state=F,F.strm=N,F.wrap=a,F.gzhead=null,F.w_bits=d,F.w_size=1<<F.w_bits,F.w_mask=F.w_size-1,F.hash_bits=U+7,F.hash_size=1<<F.hash_bits,F.hash_mask=F.hash_size-1,F.hash_shift=~~((F.hash_bits+3-1)/3),F.window=new Uint8Array(2*F.w_size),F.head=new Uint16Array(F.hash_size),F.prev=new Uint16Array(F.w_size),F.lit_bufsize=1<<U+6,F.pending_buf_size=4*F.lit_bufsize,F.pending_buf=new Uint8Array(F.pending_buf_size),F.d_buf=1*F.lit_bufsize,F.l_buf=3*F.lit_bufsize,F.level=q,F.strategy=W,F.method=C,x(N)};N.exports.deflateInit=(N,q)=>NN(N,q,X,15,8,p),N.exports.deflateInit2=NN,N.exports.deflateReset=x,N.exports.deflateResetKeep=g,N.exports.deflateSetHeader=(N,q)=>N&&N.state?2!==N.state.wrap?O:(N.state.gzhead=q,v):O,N.exports.deflate=(N,q)=>{let C,d;if(!N||!N.state||q>Q||q<0)return N?e(N,O):O;const W=N.state;if(!N.output||!N.input&&0!==N.avail_in||W.status===H&&q!==J)return e(N,0===N.avail_out?i:O);W.strm=N;const w=W.last_flush;if(W.last_flush=q,42===W.status)if(2===W.wrap)N.adler=0,L(W,31),L(W,139),L(W,8),W.gzhead?(L(W,(W.gzhead.text?1:0)+(W.gzhead.hcrc?2:0)+(W.gzhead.extra?4:0)+(W.gzhead.name?8:0)+(W.gzhead.comment?16:0)),L(W,255&W.gzhead.time),L(W,W.gzhead.time>>8&255),L(W,W.gzhead.time>>16&255),L(W,W.gzhead.time>>24&255),L(W,9===W.level?2:W.strategy>=l||W.level<2?4:0),L(W,255&W.gzhead.os),W.gzhead.extra&&W.gzhead.extra.length&&(L(W,255&W.gzhead.extra.length),L(W,W.gzhead.extra.length>>8&255)),W.gzhead.hcrc&&(N.adler=A(N.adler,W.pending_buf,W.pending,0)),W.gzindex=0,W.status=69):(L(W,0),L(W,0),L(W,0),L(W,0),L(W,0),L(W,9===W.level?2:W.strategy>=l||W.level<2?4:0),L(W,3),W.status=E);else{let q=X+(W.w_bits-8<<4)<<8,C=-1;C=W.strategy>=l||W.level<2?0:W.level<6?1:6===W.level?2:3,q|=C<<6,0!==W.strstart&&(q|=32),q+=31-q%31,W.status=E,G(W,q),0!==W.strstart&&(G(W,N.adler>>>16),G(W,65535&N.adler)),N.adler=1}if(69===W.status)if(W.gzhead.extra){for(C=W.pending;W.gzindex<(65535&W.gzhead.extra.length)&&(W.pending!==W.pending_buf_size||(W.gzhead.hcrc&&W.pending>C&&(N.adler=A(N.adler,W.pending_buf,W.pending-C,C)),D(N),C=W.pending,W.pending!==W.pending_buf_size));)L(W,255&W.gzhead.extra[W.gzindex]),W.gzindex++;W.gzhead.hcrc&&W.pending>C&&(N.adler=A(N.adler,W.pending_buf,W.pending-C,C)),W.gzindex===W.gzhead.extra.length&&(W.gzindex=0,W.status=73)}else W.status=73;if(73===W.status)if(W.gzhead.name){C=W.pending;do{if(W.pending===W.pending_buf_size&&(W.gzhead.hcrc&&W.pending>C&&(N.adler=A(N.adler,W.pending_buf,W.pending-C,C)),D(N),C=W.pending,W.pending===W.pending_buf_size)){d=1;break}d=W.gzindex<W.gzhead.name.length?255&W.gzhead.name.charCodeAt(W.gzindex++):0,L(W,d)}while(0!==d);W.gzhead.hcrc&&W.pending>C&&(N.adler=A(N.adler,W.pending_buf,W.pending-C,C)),0===d&&(W.gzindex=0,W.status=91)}else W.status=91;if(91===W.status)if(W.gzhead.comment){C=W.pending;do{if(W.pending===W.pending_buf_size&&(W.gzhead.hcrc&&W.pending>C&&(N.adler=A(N.adler,W.pending_buf,W.pending-C,C)),D(N),C=W.pending,W.pending===W.pending_buf_size)){d=1;break}d=W.gzindex<W.gzhead.comment.length?255&W.gzhead.comment.charCodeAt(W.gzindex++):0,L(W,d)}while(0!==d);W.gzhead.hcrc&&W.pending>C&&(N.adler=A(N.adler,W.pending_buf,W.pending-C,C)),0===d&&(W.status=Y)}else W.status=Y;if(W.status===Y&&(W.gzhead.hcrc?(W.pending+2>W.pending_buf_size&&D(N),W.pending+2<=W.pending_buf_size&&(L(W,255&N.adler),L(W,N.adler>>8&255),N.adler=0,W.status=E)):W.status=E),0!==W.pending){if(D(N),0===N.avail_out)return W.last_flush=-1,v}else if(0===N.avail_in&&b(q)<=b(w)&&q!==J)return e(N,i);if(W.status===H&&0!==N.avail_in)return e(N,i);if(0!==N.avail_in||0!==W.lookahead||q!==t&&W.status!==H){let C=W.strategy===l?((N,q)=>{let C;for(;;){if(0===N.lookahead&&(y(N),0===N.lookahead)){if(q===t)return 1;break}if(N.match_length=0,C=a(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++,C&&(c(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,q===J?(c(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(c(N,!1),0===N.strm.avail_out)?1:2})(W,q):W.strategy===T?((N,q)=>{let C,d,U,W;const F=N.window;for(;;){if(N.lookahead<=P){if(y(N),N.lookahead<=P&&q===t)return 1;if(0===N.lookahead)break}if(N.match_length=0,N.lookahead>=3&&N.strstart>0&&(U=N.strstart-1,d=F[U],d===F[++U]&&d===F[++U]&&d===F[++U])){W=N.strstart+P;do{}while(d===F[++U]&&d===F[++U]&&d===F[++U]&&d===F[++U]&&d===F[++U]&&d===F[++U]&&d===F[++U]&&d===F[++U]&&U<W);N.match_length=P-(W-U),N.match_length>N.lookahead&&(N.match_length=N.lookahead)}if(N.match_length>=3?(C=a(N,1,N.match_length-3),N.lookahead-=N.match_length,N.strstart+=N.match_length,N.match_length=0):(C=a(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++),C&&(c(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,q===J?(c(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(c(N,!1),0===N.strm.avail_out)?1:2})(W,q):f[W.level].func(W,q);if(3!==C&&4!==C||(W.status=H),1===C||3===C)return 0===N.avail_out&&(W.last_flush=-1),v;if(2===C&&(q===V?F(W):q!==Q&&(U(W,0,0,!1),q===Z&&(o(W.head),0===W.lookahead&&(W.strstart=0,W.block_start=0,W.insert=0))),D(N),0===N.avail_out))return W.last_flush=-1,v}return q!==J?v:W.wrap<=0?r:(2===W.wrap?(L(W,255&N.adler),L(W,N.adler>>8&255),L(W,N.adler>>16&255),L(W,N.adler>>24&255),L(W,255&N.total_in),L(W,N.total_in>>8&255),L(W,N.total_in>>16&255),L(W,N.total_in>>24&255)):(G(W,N.adler>>>16),G(W,65535&N.adler)),D(N),W.wrap>0&&(W.wrap=-W.wrap),0!==W.pending?v:r)},N.exports.deflateEnd=N=>{if(!N||!N.state)return O;const q=N.state.status;return 42!==q&&69!==q&&73!==q&&91!==q&&q!==Y&&q!==E&&q!==H?e(N,O):(N.state=null,q===E?e(N,K):v)},N.exports.deflateSetDictionary=(N,q)=>{let C=q.length;if(!N||!N.state)return O;const d=N.state,U=d.wrap;if(2===U||1===U&&42!==d.status||d.lookahead)return O;if(1===U&&(N.adler=w(N.adler,q,C,0)),d.wrap=0,C>=d.w_size){0===U&&(o(d.head),d.strstart=0,d.block_start=0,d.insert=0);let N=new Uint8Array(d.w_size);N.set(q.subarray(C-d.w_size,C),0),q=N,C=d.w_size}const W=N.avail_in,a=N.next_in,F=N.input;for(N.avail_in=C,N.next_in=0,N.input=q,y(d);d.lookahead>=3;){let N=d.strstart,q=d.lookahead-2;do{d.ins_h=S(d,d.ins_h,d.window[N+3-1]),d.prev[N&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=N,N++}while(--q);d.strstart=N,d.lookahead=2,y(d)}return d.strstart+=d.lookahead,d.block_start=d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=2,d.match_available=0,N.next_in=a,N.input=F,N.avail_in=W,d.wrap=U,v},N.exports.deflateInfo="pako deflate (from Nodeca project)"},12328:N=>{"use strict";N.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12318:N=>{"use strict";N.exports=function(N,q){let C,d,U,W,a,F,w,A,n,t,V,Z,J,Q,v,r,O,K,i,I,j,l,T,z;const p=N.state;C=N.next_in,T=N.input,d=C+(N.avail_in-5),U=N.next_out,z=N.output,W=U-(q-N.avail_out),a=U+(N.avail_out-257),F=p.dmax,w=p.wsize,A=p.whave,n=p.wnext,t=p.window,V=p.hold,Z=p.bits,J=p.lencode,Q=p.distcode,v=(1<<p.lenbits)-1,r=(1<<p.distbits)-1;N:do{Z<15&&(V+=T[C++]<<Z,Z+=8,V+=T[C++]<<Z,Z+=8),O=J[V&v];q:for(;;){if(K=O>>>24,V>>>=K,Z-=K,K=O>>>16&255,0===K)z[U++]=65535&O;else{if(!(16&K)){if(0===(64&K)){O=J[(65535&O)+(V&(1<<K)-1)];continue q}if(32&K){p.mode=12;break N}N.Aq="invalid literal/length code",p.mode=30;break N}i=65535&O,K&=15,K&&(Z<K&&(V+=T[C++]<<Z,Z+=8),i+=V&(1<<K)-1,V>>>=K,Z-=K),Z<15&&(V+=T[C++]<<Z,Z+=8,V+=T[C++]<<Z,Z+=8),O=Q[V&r];C:for(;;){if(K=O>>>24,V>>>=K,Z-=K,K=O>>>16&255,!(16&K)){if(0===(64&K)){O=Q[(65535&O)+(V&(1<<K)-1)];continue C}N.Aq="invalid distance code",p.mode=30;break N}if(I=65535&O,K&=15,Z<K&&(V+=T[C++]<<Z,Z+=8,Z<K&&(V+=T[C++]<<Z,Z+=8)),I+=V&(1<<K)-1,I>F){N.Aq="invalid distance too far back",p.mode=30;break N}if(V>>>=K,Z-=K,K=U-W,I>K){if(K=I-K,K>A&&p.sane){N.Aq="invalid distance too far back",p.mode=30;break N}if(j=0,l=t,0===n){if(j+=w-K,K<i){i-=K;do{z[U++]=t[j++]}while(--K);j=U-I,l=z}}else if(n<K){if(j+=w+n-K,K-=n,K<i){i-=K;do{z[U++]=t[j++]}while(--K);if(j=0,n<i){K=n,i-=K;do{z[U++]=t[j++]}while(--K);j=U-I,l=z}}}else if(j+=n-K,K<i){i-=K;do{z[U++]=t[j++]}while(--K);j=U-I,l=z}for(;i>2;)z[U++]=l[j++],z[U++]=l[j++],z[U++]=l[j++],i-=3;i&&(z[U++]=l[j++],i>1&&(z[U++]=l[j++]))}else{j=U-I;do{z[U++]=z[j++],z[U++]=z[j++],z[U++]=z[j++],i-=3}while(i>2);i&&(z[U++]=z[j++],i>1&&(z[U++]=z[j++]))}break}}break}}while(C<d&&U<a);i=Z>>3,C-=i,Z-=i<<3,V&=(1<<Z)-1,N.next_in=C,N.next_out=U,N.avail_in=C<d?d-C+5:5-(C-d),N.avail_out=U<a?a-U+257:257-(U-a),p.hold=V,p.bits=Z}},12315:(N,q,C)=>{"use strict";const d=C(12268),U=C(12277),W=C(12318),a=C(12322),{Z_FINISH:F,Z_BLOCK:w,Z_TREES:A,Z_OK:n,Z_STREAM_END:t,Z_NEED_DICT:V,Z_STREAM_ERROR:Z,Z_DATA_ERROR:J,Z_MEM_ERROR:Q,Z_BUF_ERROR:v,Z_DEFLATED:r}=C(12290),O=12,K=30,i=N=>(N>>>24&255)+(N>>>8&65280)+((65280&N)<<8)+((255&N)<<24);function I(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const j=N=>{if(!N||!N.state)return Z;const q=N.state;return N.total_in=N.total_out=q.total=0,N.Aq="",q.wrap&&(N.adler=1&q.wrap),q.mode=1,q.last=0,q.havedict=0,q.dmax=32768,q.head=null,q.hold=0,q.bits=0,q.lencode=q.lendyn=new Int32Array(852),q.distcode=q.distdyn=new Int32Array(592),q.sane=1,q.back=-1,n},l=N=>{if(!N||!N.state)return Z;const q=N.state;return q.wsize=0,q.whave=0,q.wnext=0,j(N)},T=(N,q)=>{let C;if(!N||!N.state)return Z;const d=N.state;return q<0?(C=0,q=-q):(C=1+(q>>4),q<48&&(q&=15)),q&&(q<8||q>15)?Z:(null!==d.window&&d.wbits!==q&&(d.window=null),d.wrap=C,d.wbits=q,l(N))},z=(N,q)=>{if(!N)return Z;const C=new I;N.state=C,C.window=null;const d=T(N,q);return d!==n&&(N.state=null),d};let p,s,X=!0;const P=N=>{if(X){p=new Int32Array(512),s=new Int32Array(32);let q=0;for(;q<144;)N.lens[q++]=8;for(;q<256;)N.lens[q++]=9;for(;q<280;)N.lens[q++]=7;for(;q<288;)N.lens[q++]=8;for(a(1,N.lens,0,288,p,0,N.work,{bits:9}),q=0;q<32;)N.lens[q++]=5;a(2,N.lens,0,32,s,0,N.work,{bits:5}),X=!1}N.lencode=p,N.lenbits=9,N.distcode=s,N.distbits=5},M=(N,q,C,d)=>{let U;const W=N.state;return null===W.window&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new Uint8Array(W.wsize)),d>=W.wsize?(W.window.set(q.subarray(C-W.wsize,C),0),W.wnext=0,W.whave=W.wsize):(U=W.wsize-W.wnext,U>d&&(U=d),W.window.set(q.subarray(C-d,C-d+U),W.wnext),(d-=U)?(W.window.set(q.subarray(C-d,C),0),W.wnext=d,W.whave=W.wsize):(W.wnext+=U,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=U))),0};N.exports.inflateReset=l,N.exports.inflateReset2=T,N.exports.inflateResetKeep=j,N.exports.inflateInit=N=>z(N,15),N.exports.inflateInit2=z,N.exports.inflate=(N,q)=>{let C,I,j,l,T,z,p,s,X,Y,E,H,e,b,o,S,D,c,L,G,h,B,y=0;const R=new Uint8Array(4);let u,m;const f=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!N||!N.state||!N.output||!N.input&&0!==N.avail_in)return Z;C=N.state,C.mode===O&&(C.mode=13),T=N.next_out,j=N.output,p=N.avail_out,l=N.next_in,I=N.input,z=N.avail_in,s=C.hold,X=C.bits,Y=z,E=p,B=n;N:for(;;)switch(C.mode){case 1:if(0===C.wrap){C.mode=13;break}for(;X<16;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}if(2&C.wrap&&35615===s){C.check=0,R[0]=255&s,R[1]=s>>>8&255,C.check=U(C.check,R,2,0),s=0,X=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&s)<<8)+(s>>8))%31){N.Aq="incorrect header check",C.mode=K;break}if((15&s)!==r){N.Aq="unknown compression method",C.mode=K;break}if(s>>>=4,X-=4,h=8+(15&s),0===C.wbits)C.wbits=h;else if(h>C.wbits){N.Aq="invalid window size",C.mode=K;break}C.dmax=1<<C.wbits,N.adler=C.check=1,C.mode=512&s?10:O,s=0,X=0;break;case 2:for(;X<16;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}if(C.flags=s,(255&C.flags)!==r){N.Aq="unknown compression method",C.mode=K;break}if(57344&C.flags){N.Aq="unknown header flags set",C.mode=K;break}C.head&&(C.head.text=s>>8&1),512&C.flags&&(R[0]=255&s,R[1]=s>>>8&255,C.check=U(C.check,R,2,0)),s=0,X=0,C.mode=3;case 3:for(;X<32;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}C.head&&(C.head.time=s),512&C.flags&&(R[0]=255&s,R[1]=s>>>8&255,R[2]=s>>>16&255,R[3]=s>>>24&255,C.check=U(C.check,R,4,0)),s=0,X=0,C.mode=4;case 4:for(;X<16;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}C.head&&(C.head.xflags=255&s,C.head.os=s>>8),512&C.flags&&(R[0]=255&s,R[1]=s>>>8&255,C.check=U(C.check,R,2,0)),s=0,X=0,C.mode=5;case 5:if(1024&C.flags){for(;X<16;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}C.length=s,C.head&&(C.head.extra_len=s),512&C.flags&&(R[0]=255&s,R[1]=s>>>8&255,C.check=U(C.check,R,2,0)),s=0,X=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(H=C.length,H>z&&(H=z),H&&(C.head&&(h=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Uint8Array(C.head.extra_len)),C.head.extra.set(I.subarray(l,l+H),h)),512&C.flags&&(C.check=U(C.check,I,H,l)),z-=H,l+=H,C.length-=H),C.length))break N;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(0===z)break N;H=0;do{h=I[l+H++],C.head&&h&&C.length<65536&&(C.head.name+=String.fromCharCode(h))}while(h&&H<z);if(512&C.flags&&(C.check=U(C.check,I,H,l)),z-=H,l+=H,h)break N}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(0===z)break N;H=0;do{h=I[l+H++],C.head&&h&&C.length<65536&&(C.head.comment+=String.fromCharCode(h))}while(h&&H<z);if(512&C.flags&&(C.check=U(C.check,I,H,l)),z-=H,l+=H,h)break N}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;X<16;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}if(s!==(65535&C.check)){N.Aq="header crc mismatch",C.mode=K;break}s=0,X=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),N.adler=C.check=0,C.mode=O;break;case 10:for(;X<32;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}N.adler=C.check=i(s),s=0,X=0,C.mode=11;case 11:if(0===C.havedict)return N.next_out=T,N.avail_out=p,N.next_in=l,N.avail_in=z,C.hold=s,C.bits=X,V;N.adler=C.check=1,C.mode=O;case O:if(q===w||q===A)break N;case 13:if(C.last){s>>>=7&X,X-=7&X,C.mode=27;break}for(;X<3;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}switch(C.last=1&s,s>>>=1,X-=1,3&s){case 0:C.mode=14;break;case 1:if(P(C),C.mode=20,q===A){s>>>=2,X-=2;break N}break;case 2:C.mode=17;break;case 3:N.Aq="invalid block type",C.mode=K}s>>>=2,X-=2;break;case 14:for(s>>>=7&X,X-=7&X;X<32;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}if((65535&s)!==(s>>>16^65535)){N.Aq="invalid stored block lengths",C.mode=K;break}if(C.length=65535&s,s=0,X=0,C.mode=15,q===A)break N;case 15:C.mode=16;case 16:if(H=C.length,H){if(H>z&&(H=z),H>p&&(H=p),0===H)break N;j.set(I.subarray(l,l+H),T),z-=H,l+=H,p-=H,T+=H,C.length-=H;break}C.mode=O;break;case 17:for(;X<14;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}if(C.nlen=257+(31&s),s>>>=5,X-=5,C.ndist=1+(31&s),s>>>=5,X-=5,C.ncode=4+(15&s),s>>>=4,X-=4,C.nlen>286||C.ndist>30){N.Aq="too many length or distance symbols",C.mode=K;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;X<3;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}C.lens[f[C.have++]]=7&s,s>>>=3,X-=3}for(;C.have<19;)C.lens[f[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,u={bits:C.lenbits},B=a(0,C.lens,0,19,C.lencode,0,C.work,u),C.lenbits=u.bits,B){N.Aq="invalid code lengths set",C.mode=K;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;y=C.lencode[s&(1<<C.lenbits)-1],o=y>>>24,S=y>>>16&255,D=65535&y,!(o<=X);){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}if(D<16)s>>>=o,X-=o,C.lens[C.have++]=D;else{if(16===D){for(m=o+2;X<m;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}if(s>>>=o,X-=o,0===C.have){N.Aq="invalid bit length repeat",C.mode=K;break}h=C.lens[C.have-1],H=3+(3&s),s>>>=2,X-=2}else if(17===D){for(m=o+3;X<m;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}s>>>=o,X-=o,h=0,H=3+(7&s),s>>>=3,X-=3}else{for(m=o+7;X<m;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}s>>>=o,X-=o,h=0,H=11+(127&s),s>>>=7,X-=7}if(C.have+H>C.nlen+C.ndist){N.Aq="invalid bit length repeat",C.mode=K;break}for(;H--;)C.lens[C.have++]=h}}if(C.mode===K)break;if(0===C.lens[256]){N.Aq="invalid code -- missing end-of-block",C.mode=K;break}if(C.lenbits=9,u={bits:C.lenbits},B=a(1,C.lens,0,C.nlen,C.lencode,0,C.work,u),C.lenbits=u.bits,B){N.Aq="invalid literal/lengths set",C.mode=K;break}if(C.distbits=6,C.distcode=C.distdyn,u={bits:C.distbits},B=a(2,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,u),C.distbits=u.bits,B){N.Aq="invalid distances set",C.mode=K;break}if(C.mode=20,q===A)break N;case 20:C.mode=21;case 21:if(z>=6&&p>=258){N.next_out=T,N.avail_out=p,N.next_in=l,N.avail_in=z,C.hold=s,C.bits=X,W(N,E),T=N.next_out,j=N.output,p=N.avail_out,l=N.next_in,I=N.input,z=N.avail_in,s=C.hold,X=C.bits,C.mode===O&&(C.back=-1);break}for(C.back=0;y=C.lencode[s&(1<<C.lenbits)-1],o=y>>>24,S=y>>>16&255,D=65535&y,!(o<=X);){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}if(S&&0===(240&S)){for(c=o,L=S,G=D;y=C.lencode[G+((s&(1<<c+L)-1)>>c)],o=y>>>24,S=y>>>16&255,D=65535&y,!(c+o<=X);){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}s>>>=c,X-=c,C.back+=c}if(s>>>=o,X-=o,C.back+=o,C.length=D,0===S){C.mode=26;break}if(32&S){C.back=-1,C.mode=O;break}if(64&S){N.Aq="invalid literal/length code",C.mode=K;break}C.extra=15&S,C.mode=22;case 22:if(C.extra){for(m=C.extra;X<m;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}C.length+=s&(1<<C.extra)-1,s>>>=C.extra,X-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;y=C.distcode[s&(1<<C.distbits)-1],o=y>>>24,S=y>>>16&255,D=65535&y,!(o<=X);){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}if(0===(240&S)){for(c=o,L=S,G=D;y=C.distcode[G+((s&(1<<c+L)-1)>>c)],o=y>>>24,S=y>>>16&255,D=65535&y,!(c+o<=X);){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}s>>>=c,X-=c,C.back+=c}if(s>>>=o,X-=o,C.back+=o,64&S){N.Aq="invalid distance code",C.mode=K;break}C.offset=D,C.extra=15&S,C.mode=24;case 24:if(C.extra){for(m=C.extra;X<m;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}C.offset+=s&(1<<C.extra)-1,s>>>=C.extra,X-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){N.Aq="invalid distance too far back",C.mode=K;break}C.mode=25;case 25:if(0===p)break N;if(H=E-p,C.offset>H){if(H=C.offset-H,H>C.whave&&C.sane){N.Aq="invalid distance too far back",C.mode=K;break}H>C.wnext?(H-=C.wnext,e=C.wsize-H):e=C.wnext-H,H>C.length&&(H=C.length),b=C.window}else b=j,e=T-C.offset,H=C.length;H>p&&(H=p),p-=H,C.length-=H;do{j[T++]=b[e++]}while(--H);0===C.length&&(C.mode=21);break;case 26:if(0===p)break N;j[T++]=C.length,p--,C.mode=21;break;case 27:if(C.wrap){for(;X<32;){if(0===z)break N;z--,s|=I[l++]<<X,X+=8}if(E-=p,N.total_out+=E,C.total+=E,E&&(N.adler=C.check=C.flags?U(C.check,j,E,T-E):d(C.check,j,E,T-E)),E=p,(C.flags?s:i(s))!==C.check){N.Aq="incorrect data check",C.mode=K;break}s=0,X=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;X<32;){if(0===z)break N;z--,s+=I[l++]<<X,X+=8}if(s!==(4294967295&C.total)){N.Aq="incorrect length check",C.mode=K;break}s=0,X=0}C.mode=29;case 29:B=t;break N;case K:B=J;break N;case 31:return Q;default:return Z}return N.next_out=T,N.avail_out=p,N.next_in=l,N.avail_in=z,C.hold=s,C.bits=X,(C.wsize||E!==N.avail_out&&C.mode<K&&(C.mode<27||q!==F))&&M(N,N.output,N.next_out,E-N.avail_out)?(C.mode=31,Q):(Y-=N.avail_in,E-=N.avail_out,N.total_in+=Y,N.total_out+=E,C.total+=E,C.wrap&&E&&(N.adler=C.check=C.flags?U(C.check,j,E,N.next_out-E):d(C.check,j,E,N.next_out-E)),N.data_type=C.bits+(C.last?64:0)+(C.mode===O?128:0)+(20===C.mode||15===C.mode?256:0),(0===Y&&0===E||q===F)&&B===n&&(B=v),B)},N.exports.inflateEnd=N=>{if(!N||!N.state)return Z;let q=N.state;return q.window&&(q.window=null),N.state=null,n},N.exports.inflateGetHeader=(N,q)=>{if(!N||!N.state)return Z;const C=N.state;return 0===(2&C.wrap)?Z:(C.head=q,q.done=!1,n)},N.exports.inflateSetDictionary=(N,q)=>{const C=q.length;let U,W,a;return N&&N.state?(U=N.state,0!==U.wrap&&11!==U.mode?Z:11===U.mode&&(W=1,W=d(W,q,C,0),W!==U.check)?J:(a=M(N,q,C,C),a?(U.mode=31,Q):(U.havedict=1,n))):Z},N.exports.inflateInfo="pako inflate (from Nodeca project)"},12322:N=>{"use strict";const q=15,C=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),d=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),U=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),W=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);N.exports=(N,a,F,w,A,n,t,V)=>{const Z=V.bits;let J,Q,v,r,O,K,i=0,I=0,j=0,l=0,T=0,z=0,p=0,s=0,X=0,P=0,M=null,Y=0;const E=new Uint16Array(16),H=new Uint16Array(16);let e,b,o,S=null,D=0;for(i=0;i<=q;i++)E[i]=0;for(I=0;I<w;I++)E[a[F+I]]++;for(T=Z,l=q;l>=1&&0===E[l];l--);if(T>l&&(T=l),0===l)return A[n++]=20971520,A[n++]=20971520,V.bits=1,0;for(j=1;j<l&&0===E[j];j++);for(T<j&&(T=j),s=1,i=1;i<=q;i++)if(s<<=1,s-=E[i],s<0)return-1;if(s>0&&(0===N||1!==l))return-1;for(H[1]=0,i=1;i<q;i++)H[i+1]=H[i]+E[i];for(I=0;I<w;I++)0!==a[F+I]&&(t[H[a[F+I]]++]=I);if(0===N?(M=S=t,K=19):1===N?(M=C,Y-=257,S=d,D-=257,K=256):(M=U,S=W,K=-1),P=0,I=0,i=j,O=n,z=T,p=0,v=-1,X=1<<T,r=X-1,1===N&&X>852||2===N&&X>592)return 1;for(;;){e=i-p,t[I]<K?(b=0,o=t[I]):t[I]>K?(b=S[D+t[I]],o=M[Y+t[I]]):(b=96,o=0),J=1<<i-p,Q=1<<z,j=Q;do{Q-=J,A[O+(P>>p)+Q]=e<<24|b<<16|o}while(0!==Q);for(J=1<<i-1;P&J;)J>>=1;if(0!==J?(P&=J-1,P+=J):P=0,I++,0===--E[i]){if(i===l)break;i=a[F+t[I]]}if(i>T&&(P&r)!==v){for(0===p&&(p=T),O+=j,z=i-p,s=1<<z;z+p<l&&(s-=E[z+p],!(s<=0));)z++,s<<=1;if(X+=1<<z,1===N&&X>852||2===N&&X>592)return 1;v=P&r,A[v]=T<<24|z<<16|O-n}}return 0!==P&&(A[O+P]=i-p<<24|64<<16),V.bits=T,0}},12281:N=>{"use strict";N.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12264:N=>{"use strict";function q(N){let q=N.length;for(;--q>=0;)N[q]=0}const C=256,d=286,U=30,W=15,a=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),F=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),w=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Array(576);q(n);const t=new Array(60);q(t);const V=new Array(512);q(V);const Z=new Array(256);q(Z);const J=new Array(29);q(J);const Q=new Array(U);function v(N,q,C,d,U){this.static_tree=N,this.extra_bits=q,this.extra_base=C,this.elems=d,this.max_length=U,this.has_stree=N&&N.length}let r,O,K;function i(N,q){this.dyn_tree=N,this.max_code=0,this.stat_desc=q}q(Q);const I=N=>N<256?V[N]:V[256+(N>>>7)],j=(N,q)=>{N.pending_buf[N.pending++]=255&q,N.pending_buf[N.pending++]=q>>>8&255},l=(N,q,C)=>{N.bi_valid>16-C?(N.bi_buf|=q<<N.bi_valid&65535,j(N,N.bi_buf),N.bi_buf=q>>16-N.bi_valid,N.bi_valid+=C-16):(N.bi_buf|=q<<N.bi_valid&65535,N.bi_valid+=C)},T=(N,q,C)=>{l(N,C[2*q],C[2*q+1])},z=(N,q)=>{let C=0;do{C|=1&N,N>>>=1,C<<=1}while(--q>0);return C>>>1},p=(N,q,C)=>{const d=new Array(16);let U,a,F=0;for(U=1;U<=W;U++)d[U]=F=F+C[U-1]<<1;for(a=0;a<=q;a++){let q=N[2*a+1];0!==q&&(N[2*a]=z(d[q]++,q))}},s=N=>{let q;for(q=0;q<d;q++)N.dyn_ltree[2*q]=0;for(q=0;q<U;q++)N.dyn_dtree[2*q]=0;for(q=0;q<19;q++)N.bl_tree[2*q]=0;N.dyn_ltree[512]=1,N.opt_len=N.static_len=0,N.last_lit=N.matches=0},X=N=>{N.bi_valid>8?j(N,N.bi_buf):N.bi_valid>0&&(N.pending_buf[N.pending++]=N.bi_buf),N.bi_buf=0,N.bi_valid=0},P=(N,q,C,d)=>{const U=2*q,W=2*C;return N[U]<N[W]||N[U]===N[W]&&d[q]<=d[C]},M=(N,q,C)=>{const d=N.heap[C];let U=C<<1;for(;U<=N.heap_len&&(U<N.heap_len&&P(q,N.heap[U+1],N.heap[U],N.depth)&&U++,!P(q,d,N.heap[U],N.depth));)N.heap[C]=N.heap[U],C=U,U<<=1;N.heap[C]=d},Y=(N,q,d)=>{let U,W,w,A,n=0;if(0!==N.last_lit)do{U=N.pending_buf[N.d_buf+2*n]<<8|N.pending_buf[N.d_buf+2*n+1],W=N.pending_buf[N.l_buf+n],n++,0===U?T(N,W,q):(w=Z[W],T(N,w+C+1,q),A=a[w],0!==A&&(W-=J[w],l(N,W,A)),U--,w=I(U),T(N,w,d),A=F[w],0!==A&&(U-=Q[w],l(N,U,A)))}while(n<N.last_lit);T(N,256,q)},E=(N,q)=>{const C=q.dyn_tree,d=q.stat_desc.static_tree,U=q.stat_desc.has_stree,a=q.stat_desc.elems;let F,w,A,n=-1;for(N.heap_len=0,N.heap_max=573,F=0;F<a;F++)0!==C[2*F]?(N.heap[++N.heap_len]=n=F,N.depth[F]=0):C[2*F+1]=0;for(;N.heap_len<2;)A=N.heap[++N.heap_len]=n<2?++n:0,C[2*A]=1,N.depth[A]=0,N.opt_len--,U&&(N.static_len-=d[2*A+1]);for(q.max_code=n,F=N.heap_len>>1;F>=1;F--)M(N,C,F);A=a;do{F=N.heap[1],N.heap[1]=N.heap[N.heap_len--],M(N,C,1),w=N.heap[1],N.heap[--N.heap_max]=F,N.heap[--N.heap_max]=w,C[2*A]=C[2*F]+C[2*w],N.depth[A]=(N.depth[F]>=N.depth[w]?N.depth[F]:N.depth[w])+1,C[2*F+1]=C[2*w+1]=A,N.heap[1]=A++,M(N,C,1)}while(N.heap_len>=2);N.heap[--N.heap_max]=N.heap[1],((N,q)=>{const C=q.dyn_tree,d=q.max_code,U=q.stat_desc.static_tree,a=q.stat_desc.has_stree,F=q.stat_desc.extra_bits,w=q.stat_desc.extra_base,A=q.stat_desc.max_length;let n,t,V,Z,J,Q,v=0;for(Z=0;Z<=W;Z++)N.bl_count[Z]=0;for(C[2*N.heap[N.heap_max]+1]=0,n=N.heap_max+1;n<573;n++)t=N.heap[n],Z=C[2*C[2*t+1]+1]+1,Z>A&&(Z=A,v++),C[2*t+1]=Z,t>d||(N.bl_count[Z]++,J=0,t>=w&&(J=F[t-w]),Q=C[2*t],N.opt_len+=Q*(Z+J),a&&(N.static_len+=Q*(U[2*t+1]+J)));if(0!==v){do{for(Z=A-1;0===N.bl_count[Z];)Z--;N.bl_count[Z]--,N.bl_count[Z+1]+=2,N.bl_count[A]--,v-=2}while(v>0);for(Z=A;0!==Z;Z--)for(t=N.bl_count[Z];0!==t;)V=N.heap[--n],V>d||(C[2*V+1]!==Z&&(N.opt_len+=(Z-C[2*V+1])*C[2*V],C[2*V+1]=Z),t--)}})(N,q),p(C,n,N.bl_count)},H=(N,q,C)=>{let d,U,W=-1,a=q[1],F=0,w=7,A=4;for(0===a&&(w=138,A=3),q[2*(C+1)+1]=65535,d=0;d<=C;d++)U=a,a=q[2*(d+1)+1],++F<w&&U===a||(F<A?N.bl_tree[2*U]+=F:0!==U?(U!==W&&N.bl_tree[2*U]++,N.bl_tree[32]++):F<=10?N.bl_tree[34]++:N.bl_tree[36]++,F=0,W=U,0===a?(w=138,A=3):U===a?(w=6,A=3):(w=7,A=4))},e=(N,q,C)=>{let d,U,W=-1,a=q[1],F=0,w=7,A=4;for(0===a&&(w=138,A=3),d=0;d<=C;d++)if(U=a,a=q[2*(d+1)+1],!(++F<w&&U===a)){if(F<A)do{T(N,U,N.bl_tree)}while(0!==--F);else 0!==U?(U!==W&&(T(N,U,N.bl_tree),F--),T(N,16,N.bl_tree),l(N,F-3,2)):F<=10?(T(N,17,N.bl_tree),l(N,F-3,3)):(T(N,18,N.bl_tree),l(N,F-11,7));F=0,W=U,0===a?(w=138,A=3):U===a?(w=6,A=3):(w=7,A=4)}};let b=!1;const o=(N,q,C,d)=>{l(N,0+(d?1:0),3),((N,q,C,d)=>{X(N),d&&(j(N,C),j(N,~C)),N.pending_buf.set(N.window.subarray(q,q+C),N.pending),N.pending+=C})(N,q,C,!0)};N.exports._tr_init=N=>{b||((()=>{let N,q,C,A,i;const I=new Array(16);for(C=0,A=0;A<28;A++)for(J[A]=C,N=0;N<1<<a[A];N++)Z[C++]=A;for(Z[C-1]=A,i=0,A=0;A<16;A++)for(Q[A]=i,N=0;N<1<<F[A];N++)V[i++]=A;for(i>>=7;A<U;A++)for(Q[A]=i<<7,N=0;N<1<<F[A]-7;N++)V[256+i++]=A;for(q=0;q<=W;q++)I[q]=0;for(N=0;N<=143;)n[2*N+1]=8,N++,I[8]++;for(;N<=255;)n[2*N+1]=9,N++,I[9]++;for(;N<=279;)n[2*N+1]=7,N++,I[7]++;for(;N<=287;)n[2*N+1]=8,N++,I[8]++;for(p(n,287,I),N=0;N<U;N++)t[2*N+1]=5,t[2*N]=z(N,5);r=new v(n,a,257,d,W),O=new v(t,F,0,U,W),K=new v(new Array(0),w,0,19,7)})(),b=!0),N.l_desc=new i(N.dyn_ltree,r),N.d_desc=new i(N.dyn_dtree,O),N.bl_desc=new i(N.bl_tree,K),N.bi_buf=0,N.bi_valid=0,s(N)},N.exports._tr_stored_block=o,N.exports._tr_flush_block=(N,q,d,U)=>{let W,a,F=0;N.level>0?(2===N.strm.data_type&&(N.strm.data_type=(N=>{let q,d=4093624447;for(q=0;q<=31;q++,d>>>=1)if(1&d&&0!==N.dyn_ltree[2*q])return 0;if(0!==N.dyn_ltree[18]||0!==N.dyn_ltree[20]||0!==N.dyn_ltree[26])return 1;for(q=32;q<C;q++)if(0!==N.dyn_ltree[2*q])return 1;return 0})(N)),E(N,N.l_desc),E(N,N.d_desc),F=(N=>{let q;for(H(N,N.dyn_ltree,N.l_desc.max_code),H(N,N.dyn_dtree,N.d_desc.max_code),E(N,N.bl_desc),q=18;q>=3&&0===N.bl_tree[2*A[q]+1];q--);return N.opt_len+=3*(q+1)+5+5+4,q})(N),W=N.opt_len+3+7>>>3,a=N.static_len+3+7>>>3,a<=W&&(W=a)):W=a=d+5,d+4<=W&&-1!==q?o(N,q,d,U):4===N.strategy||a===W?(l(N,2+(U?1:0),3),Y(N,n,t)):(l(N,4+(U?1:0),3),((N,q,C,d)=>{let U;for(l(N,q-257,5),l(N,C-1,5),l(N,d-4,4),U=0;U<d;U++)l(N,N.bl_tree[2*A[U]+1],3);e(N,N.dyn_ltree,q-1),e(N,N.dyn_dtree,C-1)})(N,N.l_desc.max_code+1,N.d_desc.max_code+1,F+1),Y(N,N.dyn_ltree,N.dyn_dtree)),s(N),U&&X(N)},N.exports._tr_tally=(N,q,d)=>(N.pending_buf[N.d_buf+2*N.last_lit]=q>>>8&255,N.pending_buf[N.d_buf+2*N.last_lit+1]=255&q,N.pending_buf[N.l_buf+N.last_lit]=255&d,N.last_lit++,0===q?N.dyn_ltree[2*d]++:(N.matches++,q--,N.dyn_ltree[2*(Z[d]+C+1)]++,N.dyn_dtree[2*I(q)]++),N.last_lit===N.lit_bufsize-1),N.exports._tr_align=N=>{l(N,2,3),T(N,256,n),(N=>{16===N.bi_valid?(j(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):N.bi_valid>=8&&(N.pending_buf[N.pending++]=255&N.bi_buf,N.bi_buf>>=8,N.bi_valid-=8)})(N)}},12304:N=>{"use strict";N.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Aq="",this.state=null,this.data_type=2,this.adler=0}},11933:N=>{function q(N,q,C){for(var d=N.length,U=-1/0,W=1/0,a=0;a<d;a++){var F=(C[0][a]-N[a])/q[a],w=(C[1][a]-N[a])/q[a];if(F>w){var A=F;F=w,w=A}if(w<U||F>W)return 1/0;F>U&&(U=F),w<W&&(W=w)}return U>W?1/0:U}N.exports=function(N,C,d,U){var W=q(C,d,U);if(W===1/0)N=null;else{N=N||[];for(var a=0;a<C.length;a++)N[a]=C[a]+d[a]*W}return N},N.exports.distance=q},13276:(N,q,C)=>{"use strict";C.d(q,{e:()=>a});var d=C(27);const U=d.useLayoutEffect;const W=function(N){var q=(0,d.useRef)(N);return U((function(){q.current=N})),q};var a=function(N){var q=W(N);(0,d.aq)((function(){var N=function(N){var C;if(null!=q.current&&(C=q.current(N)),N.defaultPrevented&&(N.returnValue=""),"string"===typeof C)return N.returnValue=C,C};return window.addEventListener("beforeunload",N),function(){window.removeEventListener("beforeunload",N)}}),[])}},13234:(N,q,C)=>{"use strict";var d=C(13239),U=Array.prototype.concat,W=Array.prototype.slice,a=N.exports=function(N){for(var q=[],C=0,a=N.length;C<a;C++){var F=N[C];d(F)?q=U.call(q,W.call(F)):q.push(F)}return q};a.wrap=function(N){return function(){return N(a(arguments))}}},13239:N=>{N.exports=function(N){return!(!N||"string"===typeof N)&&(N instanceof Array||Array.isArray(N)||N.length>=0&&(N.splice instanceof Function||Object.getOwnPropertyDescriptor(N,N.length-1)&&"String"!==N.constructor.name))}},12202:(N,q,C)=>{var d=C(12211);function U(N){for(var q,C,U=0,W=N.length,a=0;a<N.length;){for(q=N[a],C=0;a<W&&N[a]===q;)++a,++C;U+=d.log2(C)/7|0,U+=d.log2(q>>>0)/7|0,U+=2}return U}q.size=U,q.encode=function(N,q){q||(q=new Uint8Array(U(N)));for(var C,d,W=0,a=q.length,F=0;F<N.length;){for(C=N[F],d=0;F<N.length&&N[F]===C;)++F,++d;for(;W<a&&d>=128;)q[W++]=128+(127&d),d>>>=7;if(W>=a)throw new Error("RLE buffer overflow");for(q[W++]=d,C>>>=0;W<a&&C>=128;)q[W++]=128+(127&C),C>>>=7;if(W>=a)throw new Error("RLE buffer overflow");q[W++]=C}return q},q.decode=function(N,q){for(var C,d,U,W,a=q.length,F=N.length,w=0,A=0;A<F;){for(C=0,d=0;A<F&&N[A]>=128;)C+=(127&N[A++])<<d,d+=7;if(C+=N[A++]<<d,A>=F)throw new Error("RLE buffer underrun");if(w+C>a)throw new Error("Chunk buffer overflow");for(U=0,d=0;A<F&&N[A]>=128;)U+=(127&N[A++])<<d,d+=7;if(A>=F)throw new Error("RLE buffer underrun");for(U+=N[A++]<<d,W=0;W<C;++W)q[w++]=U}return q}},12211:(N,q)=>{"use strict";function C(N){var q=32;return(N&=-N)&&q--,65535&N&&(q-=16),16711935&N&&(q-=8),252645135&N&&(q-=4),858993459&N&&(q-=2),1431655765&N&&(q-=1),q}q.INT_BITS=32,q.INT_MAX=2147483647,q.INT_MIN=-1<<31,q.sign=function(N){return(N>0)-(N<0)},q.abs=function(N){var q=N>>31;return(N^q)-q},q.min=function(N,q){return q^(N^q)&-(N<q)},q.max=function(N,q){return N^(N^q)&-(N<q)},q.isPow2=function(N){return!(N&N-1)&&!!N},q.log2=function(N){var q,C;return q=(N>65535)<<4,q|=C=((N>>>=q)>255)<<3,q|=C=((N>>>=C)>15)<<2,(q|=C=((N>>>=C)>3)<<1)|(N>>>=C)>>1},q.log10=function(N){return N>=1e9?9:N>=1e8?8:N>=1e7?7:N>=1e6?6:N>=1e5?5:N>=1e4?4:N>=1e3?3:N>=100?2:N>=10?1:0},q.popCount=function(N){return 16843009*((N=(858993459&(N-=N>>>1&1431655765))+(N>>>2&858993459))+(N>>>4)&252645135)>>>24},q.countTrailingZeros=C,q.nextPow2=function(N){return N+=0===N,--N,N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)+1},q.prevPow2=function(N){return N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)-(N>>>1)},q.parity=function(N){return N^=N>>>16,N^=N>>>8,N^=N>>>4,27030>>>(N&=15)&1};var d=new Array(256);!function(N){for(var q=0;q<256;++q){var C=q,d=q,U=7;for(C>>>=1;C;C>>>=1)d<<=1,d|=1&C,--U;N[q]=d<<U&255}}(d),q.reverse=function(N){return d[255&N]<<24|d[N>>>8&255]<<16|d[N>>>16&255]<<8|d[N>>>24&255]},q.interleave2=function(N,q){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))|(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))<<1},q.deinterleave2=function(N,q){return(N=65535&((N=16711935&((N=252645135&((N=858993459&((N=N>>>q&1431655765)|N>>>1))|N>>>2))|N>>>4))|N>>>16))<<16>>16},q.interleave3=function(N,q,C){return N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2),(N|=(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},q.deinterleave3=function(N,q){return(N=1023&((N=4278190335&((N=251719695&((N=3272356035&((N=N>>>q&1227133513)|N>>>2))|N>>>4))|N>>>8))|N>>>16))<<22>>22},q.nextCombination=function(N){var q=N|N-1;return q+1|(~q&-~q)-1>>>C(N)+1}},12237:N=>{"use strict";N.exports=function(N,q,C,d){var U=self||window;try{try{var W;try{W=new U.Blob([N])}catch(A){(W=new(U.BlobBuilder||U.WebKitBlobBuilder||U.MozBlobBuilder||U.MSBlobBuilder)).append(N),W=W.getBlob()}var a=U.URL||U.webkitURL,F=a.createObjectURL(W),w=new U[q](F,C);return a.revokeObjectURL(F),w}catch(A){return new U[q]("data:application/javascript,".concat(encodeURIComponent(N)),C)}}catch(A){if(!d)throw Error("Inline worker is not supported");return new U[q](d,C)}}},11917:(N,q,C)=>{"use strict";function d(N,q,C,d,U){var W={};return Object.keys(d).forEach((function(N){W[N]=d[N]})),W.enumerable=!!W.enumerable,W.configurable=!!W.configurable,("value"in W||W.initializer)&&(W.writable=!0),W=C.slice().reverse().reduce((function(C,d){return d(N,q,C)||C}),W),U&&void 0!==W.initializer&&(W.value=W.initializer?W.initializer.call(U):void 0,W.initializer=void 0),void 0===W.initializer&&(Object.defineProperty(N,q,W),W=null),W}C.d(q,{b:()=>d})},11912:(N,q,C)=>{"use strict";function d(N,q,C,d){C&&Object.defineProperty(N,q,{enumerable:C.enumerable,configurable:C.configurable,writable:C.writable,value:C.initializer?C.initializer.call(d):void 0})}C.d(q,{b:()=>d})},13264:(N,q,C)=>{"use strict";C.d(q,{e:()=>a,f:()=>t,h:()=>F,k:()=>W,n:()=>w,p:()=>U,q:()=>A,s:()=>n});var d=C(11343);class U{constructor(){this._easingMode=U.EASINGMODE_EASEIN}setEasingMode(N){const q=Math.min(Math.max(N,0),2);this._easingMode=q}getEasingMode(){return this._easingMode}easeInCore(N){throw new Error("You must implement this method")}ease(N){switch(this._easingMode){case U.EASINGMODE_EASEIN:return this.easeInCore(N);case U.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-N)}return N>=.5?.5*(1-this.easeInCore(2*(1-N)))+.5:.5*this.easeInCore(2*N)}}U.EASINGMODE_EASEIN=0,U.EASINGMODE_EASEOUT=1,U.EASINGMODE_EASEINOUT=2;class W extends U{easeInCore(N){return N=Math.max(0,Math.min(1,N)),1-Math.sqrt(1-N*N)}}class a extends U{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=N}easeInCore(N){const q=Math.max(0,this.amplitude);return Math.pow(N,3)-N*q*Math.sin(3.141592653589793*N)}}class F extends U{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=N,this.bounciness=q}easeInCore(N){const q=Math.max(0,this.bounces);let C=this.bounciness;C<=1&&(C=1.001);const d=Math.pow(C,q),U=1-C,W=(1-d)/U+.5*d,a=N*W,F=Math.log(-a*(1-C)+1)/Math.log(C),w=Math.floor(F),A=w+1,n=(1-Math.pow(C,w))/(U*W),t=.5*(n+(1-Math.pow(C,A))/(U*W)),V=N-t,Z=t-n;return-Math.pow(1/C,q-w)/(Z*Z)*(V-Z)*(V+Z)}}class w extends U{easeInCore(N){return N*N*N}}class A extends U{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=N,this.springiness=q}easeInCore(N){let q;const C=Math.max(0,this.oscillations),d=Math.max(0,this.springiness);return q=0==d?N:(Math.exp(d*N)-1)/(Math.exp(d)-1),q*Math.sin((6.283185307179586*C+1.5707963267948966)*N)}}class n extends U{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=N}easeInCore(N){return this.exponent<=0?N:(Math.exp(this.exponent*N)-1)/(Math.exp(this.exponent)-1)}}class t extends U{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=N,this.y1=q,this.x2=C,this.y2=d}easeInCore(N){return d.b.Interpolate(N,this.x1,this.y1,this.x2,this.y2)}}},12763:(N,q,C)=>{"use strict";C.d(q,{d:()=>a});var d=C(11122),U=C(11134),W=C(11549);class a extends W.e{get _matrix(){return this._compose(),this.JV}set _matrix(N){(N.updateFlag!==this.JV.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.JV.U(N),this._markAsDirtyAndDecompose())}constructor(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(N,q.lN(),!1),this.name=N,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=q,this.JV=(null===U||void 0===U?void 0:U.clone())??d.Matrix.Identity(),this._restMatrix=W??this.JV.clone(),this._bindMatrix=a??this.JV.clone(),this._index=F,this._absoluteMatrix=new d.Matrix,this._absoluteBindMatrix=new d.Matrix,this._absoluteInverseBindMatrix=new d.Matrix,this._finalMatrix=new d.Matrix,q.bones.push(this),this.setParent(C,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(N){this.setParent(N)}setParent(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==N){if(this.parent){const N=this.parent.children.indexOf(this);-1!==N&&this.parent.children.splice(N,1)}this._parentNode=N,this.parent&&this.parent.children.push(this),q&&this._updateAbsoluteBindMatrices(),this.HA()}}getLocalMatrix(){return this._compose(),this.JV}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(N){this._restMatrix.U(N)}setRestPose(N){this.setRestMatrix(N)}getBindPose(){return this.getBindMatrix()}setBindMatrix(N){this.Yd(N)}setBindPose(N){this.setBindMatrix(N)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const N=d.TmpVectors.Jq[0],q=d.TmpVectors.Quaternion[0],C=d.TmpVectors.Jq[1];this.getRestMatrix().decompose(N,q,C),this._linkedTransformNode.position.U(C),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??d.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.U(q),this._linkedTransformNode.yd.U(N)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(N){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=N,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.SF}set position(N){this._decompose(),this.SF.U(N),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(N){this.setRotation(N)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(N){this.setRotationQuaternion(N)}get yd(){return this.getScale()}set yd(N){this.setScale(N)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=d.Jq.Zero(),this._localRotation=d.Quaternion.Zero(),this.SF=d.Jq.Zero()),this.JV.decompose(this._localScaling,this._localRotation,this.SF))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,d.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.SF,this.JV)):this._needToCompose=!1)}Yd(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.U(N),q&&this._updateAbsoluteBindMatrices(),C?this._matrix=N:this.HA()}_updateAbsoluteBindMatrices(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(N||(N=this._bindMatrix),this.parent?N.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.U(N),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),q)for(let C=0;C<this.children.length;C++)this.children[C]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}HA(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.HA(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.HA(),this._needToDecompose=!0}_updatePosition(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0,U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const W=this.getLocalMatrix();if(0==q)U?(W.addAtIndex(12,N.x),W.addAtIndex(13,N.y),W.addAtIndex(14,N.z)):W.setTranslationFromFloats(N.x,N.y,N.z);else{let q=null;C&&(q=C.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const F=a._TmpMats[0],w=a._TmpVecs[0];this.parent?C&&q?(F.U(this.parent.getAbsoluteMatrix()),F.multiplyToRef(q,F)):F.U(this.parent.getAbsoluteMatrix()):d.Matrix.IdentityToRef(F),U&&F.setTranslationFromFloats(0,0,0),F.invert(),d.Jq.TransformCoordinatesToRef(N,F,w),U?(W.addAtIndex(12,w.x),W.addAtIndex(13,w.y),W.addAtIndex(14,w.z)):W.setTranslationFromFloats(w.x,w.y,w.z)}this._markAsDirtyAndDecompose()}translate(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(N,q,C,!0)}setPosition(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(N,q,C,!1)}setAbsolutePosition(N,q){this.setPosition(N,1,q)}scale(N,q,C){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const W=this.getLocalMatrix(),F=a._TmpMats[0];d.Matrix.ScalingToRef(N,q,C,F),F.multiplyToRef(W,W),F.invert();for(const d of this.children){const U=d.getLocalMatrix();U.multiplyToRef(F,U),U.multiplyAtIndex(12,N),U.multiplyAtIndex(13,q),U.multiplyAtIndex(14,C),d._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),U)for(const d of this.children)d.scale(N,q,C,U)}setScale(N){this._decompose(),this._localScaling.U(N),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(N){this._decompose(),N.U(this._localScaling)}setYawPitchRoll(N,q,C){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,W=arguments.length>4?arguments[4]:void 0;if(0===U){const F=a._TmpQuat;return d.Quaternion.RotationYawPitchRollToRef(N,q,C,F),void this.setRotationQuaternion(F,U,W)}const F=a._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,W))return;const w=a._TmpMats[1];d.Matrix.RotationYawPitchRollToRef(N,q,C,w),F.multiplyToRef(w,w),this._rotateWithMatrix(w,U,W)}rotate(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3?arguments[3]:void 0;const W=a._TmpMats[0];W.setTranslationFromFloats(0,0,0),d.Matrix.RotationAxisToRef(N,q,W),this._rotateWithMatrix(W,C,U)}setAxisAngle(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3?arguments[3]:void 0;if(0===C){const W=a._TmpQuat;return d.Quaternion.RotationAxisToRef(N,q,W),void this.setRotationQuaternion(W,C,U)}const W=a._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(W,U))return;const F=a._TmpMats[1];d.Matrix.RotationAxisToRef(N,q,F),W.multiplyToRef(F,F),this._rotateWithMatrix(F,C,U)}setRotation(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(N.y,N.x,N.z,q,C)}setRotationQuaternion(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===q)return this._decompose(),this._localRotation.U(N),void this._markAsDirtyAndCompose();const U=a._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,C))return;const W=a._TmpMats[1];d.Matrix.FromQuaternionToRef(N,W),U.multiplyToRef(W,W),this._rotateWithMatrix(W,q,C)}setRotationMatrix(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===q){const U=a._TmpQuat;return d.Quaternion.FromRotationMatrixToRef(N,U),void this.setRotationQuaternion(U,q,C)}const U=a._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,C))return;const W=a._TmpMats[1];W.U(N),U.multiplyToRef(N,W),this._rotateWithMatrix(W,q,C)}_rotateWithMatrix(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const d=this.getLocalMatrix(),U=d.m[12],W=d.m[13],F=d.m[14],w=this.getParent(),A=a._TmpMats[3],n=a._TmpMats[4];w&&1==q?(C?(A.U(C.getWorldMatrix()),w.getAbsoluteMatrix().multiplyToRef(A,A)):A.U(w.getAbsoluteMatrix()),n.U(A),n.invert(),d.multiplyToRef(A,d),d.multiplyToRef(N,d),d.multiplyToRef(n,d)):1==q&&C?(A.U(C.getWorldMatrix()),n.U(A),n.invert(),d.multiplyToRef(A,d),d.multiplyToRef(N,d),d.multiplyToRef(n,d)):d.multiplyToRef(N,d),d.setTranslationFromFloats(U,W,F),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(N,q){const C=a._TmpMats[2];return N.U(this.getAbsoluteMatrix()),q?(N.multiplyToRef(q.getWorldMatrix(),N),d.Matrix.ScalingToRef(q.yd.x,q.yd.y,q.yd.z,C)):d.Matrix.IdentityToRef(C),N.invert(),!isNaN(N.m[0])&&(C.multiplyAtIndex(0,this._scalingDeterminant),N.multiplyToRef(C,N),!0)}qd(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=d.Jq.Zero();return this.getPositionToRef(N,q,C),C}getPositionToRef(){let N=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const N=this.getLocalMatrix();q.x=N.m[12],q.y=N.m[13],q.z=N.m[14]}else{let C=null;N&&(C=N.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let d=a._TmpMats[0];N&&C?(d.U(this.getAbsoluteMatrix()),d.multiplyToRef(C,d)):d=this.getAbsoluteMatrix(),q.x=d.m[12],q.y=d.m[13],q.z=d.m[14]}}getAbsolutePosition(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const q=d.Jq.Zero();return this.getPositionToRef(1,N,q),q}getAbsolutePositionToRef(N,q){this.getPositionToRef(1,N,q)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.JV.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.U(this.JV);const N=this._skeleton.getPoseMatrix();N&&this._absoluteMatrix.multiplyToRef(N,this._absoluteMatrix)}const N=this.children,q=N.length;for(let C=0;C<q;C++)N[C].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Vw(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=d.Jq.Zero();return this.getDirectionToRef(N,q,C),C}getDirectionToRef(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,U=null;q&&(U=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const W=a._TmpMats[0];W.U(this.getAbsoluteMatrix()),q&&U&&W.multiplyToRef(U,W),d.Jq.TransformNormalToRef(N,W,C),C.normalize()}getRotation(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=d.Jq.Zero();return this.getRotationToRef(N,q,C),C}getRotationToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;const d=a._TmpQuat;this.getRotationQuaternionToRef(N,q,d),d.toEulerAnglesToRef(C)}getRotationQuaternion(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=d.Quaternion.Identity();return this.getRotationQuaternionToRef(N,q,C),C}getRotationQuaternionToRef(){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),q.U(this._localRotation);else{const C=a._TmpMats[0],d=this.getAbsoluteMatrix();N?d.multiplyToRef(N.getWorldMatrix(),C):C.U(d),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.decompose(void 0,q,void 0)}}getRotationMatrix(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1?arguments[1]:void 0;const C=d.Matrix.Identity();return this.getRotationMatrixToRef(N,q,C),C}getRotationMatrixToRef(){let N=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(q);else{const C=a._TmpMats[0],d=this.getAbsoluteMatrix();N?d.multiplyToRef(N.getWorldMatrix(),C):C.U(d),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.getRotationMatrixToRef(q)}}getAbsolutePositionFromLocal(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=d.Jq.Zero();return this.getAbsolutePositionFromLocalToRef(N,q,C),C}getAbsolutePositionFromLocalToRef(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,U=null;q&&(U=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const W=a._TmpMats[0];W.U(this.getAbsoluteMatrix()),q&&U&&W.multiplyToRef(U,W),d.Jq.TransformCoordinatesToRef(N,W,C)}getLocalPositionFromAbsolute(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=d.Jq.Zero();return this.getLocalPositionFromAbsoluteToRef(N,q,C),C}getLocalPositionFromAbsoluteToRef(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,U=null;q&&(U=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const W=a._TmpMats[0];W.U(this.getAbsoluteMatrix()),q&&U&&W.multiplyToRef(U,W),W.invert(),d.Jq.TransformCoordinatesToRef(N,W,C)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const N=this._skeleton.bones.indexOf(this);if(-1!==N&&this._skeleton.bones.splice(N,1),this._parentNode&&this._parentNode.children){const N=this._parentNode.children,q=N.indexOf(this);-1!==q&&N.splice(q,1)}super.dispose()}}a._TmpVecs=(0,U.d)(2,d.Jq.Zero),a._TmpQuat=d.Quaternion.Identity(),a._TmpMats=(0,U.d)(5,d.Matrix.Identity)},13256:(N,q,C)=>{"use strict";C.d(q,{b:()=>E});var d=C(11110),U=C(11114),W=C(10949),a=C(11122),F=C(11142),w=C(11549),A=C(11571),n=C(11401),t=C(10980),V=C(11129);class Z{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(N){this._zoomStopsAnimation=N}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(N){this._idleRotationSpeed=N}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(N){this._idleRotationWaitTime=N}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(N){this._idleRotationSpinupTime=N}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(N){this._attachedCamera=N;const q=this._attachedCamera.lN();this._onPrePointerObservableObserver=q.onPrePointerObservable.add((N=>{N.type!==n.d.POINTERDOWN?N.type===n.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const N=t.c.Now;let q=0;null!=this._lastFrameTime&&(q=N-this._lastFrameTime),this._lastFrameTime=N,this._applyUserInteraction();const C=N-this._lastInteractionTime-this._idleRotationWaitTime,d=Math.max(Math.min(C/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*d,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(q/1e3))}))}detach(){if(!this._attachedCamera)return;const N=this._attachedCamera.lN();this._onPrePointerObservableObserver&&N.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(N){this._lastInteractionTime=N??t.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<V.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let N=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(N=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?N:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=t.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var J=C(13264),Q=C(11645);class v{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(N){if(this._autoTransitionRange===N)return;this._autoTransitionRange=N;const q=this._attachedCamera;q&&(N?this._onMeshTargetChangedObserver=q.onMeshTargetChangedObservable.add((N=>{if(N&&(N.Ed(!0),N.getBoundingInfo)){const q=N.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*q,this.upperRadiusTransitionRange=.05*q}})):this._onMeshTargetChangedObserver&&q.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(N){this._attachedCamera=N,this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(N){return!!this._attachedCamera&&(this._attachedCamera.radius===N&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(N){if(!this._attachedCamera)return;this._radiusBounceTransition||(v.EasingFunction.setEasingMode(v.EasingMode),this._radiusBounceTransition=Q.d.CreateAnimation("radius",Q.d.ANIMATIONTYPE_FLOAT,60,v.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const q=Q.d.TransitionTo("radius",this._attachedCamera.radius+N,this._attachedCamera,this._attachedCamera.lN(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));q&&this._animatables.push(q)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}v.EasingFunction=new J.e(.3),v.EasingMode=J.p.EASINGMODE_EASEOUT;class r{constructor(){this.onTargetFramingAnimationEndObservable=new W.b,this._mode=r.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(N){this._mode=N}get mode(){return this._mode}set radiusScale(N){this._radiusScale=N}get radiusScale(){return this._radiusScale}set positionScale(N){this._positionScale=N}get positionScale(){return this._positionScale}set defaultElevation(N){this._defaultElevation=N}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(N){this._elevationReturnTime=N}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(N){this._elevationReturnWaitTime=N}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(N){this._zoomStopsAnimation=N}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(N){this._framingTime=N}get framingTime(){return this._framingTime}init(){}attach(N){this._attachedCamera=N;const q=this._attachedCamera.lN();r.EasingFunction.setEasingMode(r.EasingMode),this._onPrePointerObservableObserver=q.onPrePointerObservable.add((N=>{N.type!==n.d.POINTERDOWN?N.type===n.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=N.onMeshTargetChangedObservable.add((N=>{N&&N.getBoundingInfo&&this.zoomOnMesh(N,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const N=this._attachedCamera.lN();this._onPrePointerObservableObserver&&N.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.Ed(!0);const d=N.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(d.minimumWorld,d.maximumWorld,q,C)}zoomOnMeshHierarchy(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.Ed(!0);const d=N.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(d.min,d.max,q,C)}zoomOnMeshesHierarchy(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new a.Jq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new a.Jq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let W=0;W<N.length;W++){const q=N[W].getHierarchyBoundingVectors(!0);a.Jq.CheckExtends(q.min,d,U),a.Jq.CheckExtends(q.max,d,U)}this.zoomOnBoundingInfo(d,U,q,C)}zoomOnBoundingInfo(N,q){let C,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const W=N.y,F=W+(q.y-W)*this._positionScale,w=q.Qq(N).scale(.5);if(!isFinite(F))return!1;if(d)C=new a.Jq(0,F,0);else{const q=N.add(w);C=new a.Jq(q.x,F,q.z)}this._vectorTransition||(this._vectorTransition=Q.d.CreateAnimation("target",Q.d.ANIMATIONTYPE_VECTOR3,60,r.EasingFunction)),this._betaIsAnimating=!0;let A=Q.d.TransitionTo("target",C,this._attachedCamera,this._attachedCamera.lN(),60,this._vectorTransition,this._framingTime);A&&this._animatables.push(A);let n=0;if(this._mode===r.FitFrustumSidesMode){const C=this._calculateLowerRadiusFromModelBoundingSphere(N,q);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=w.length()+this._attachedCamera.sd),n=C}else this._mode===r.IgnoreBoundsSizeMode&&(n=this._calculateLowerRadiusFromModelBoundingSphere(N,q),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.sd));if(this.autoCorrectCameraLimitsAndSensibility){const C=q.Qq(N).length();this._attachedCamera.panningSensibility=5e3/C,this._attachedCamera.wheelPrecision=100/n}return this._radiusTransition||(this._radiusTransition=Q.d.CreateAnimation("radius",Q.d.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),A=Q.d.TransitionTo("radius",n,this._attachedCamera,this._attachedCamera.lN(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),U&&U(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),A&&this._animatables.push(A),!0}_calculateLowerRadiusFromModelBoundingSphere(N,q){const C=this._attachedCamera;if(!C)return 0;let d=C._calculateLowerRadiusFromModelBoundingSphere(N,q,this._radiusScale);return C.lowerRadiusLimit&&this._mode===r.IgnoreBoundsSizeMode&&(d=d<C.lowerRadiusLimit?C.lowerRadiusLimit:d),C.upperRadiusLimit&&(d=d>C.upperRadiusLimit?C.upperRadiusLimit:d),d}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const N=t.c.Now-this._lastInteractionTime,q=.5*Math.PI-this._defaultElevation,C=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>C&&N>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Q.d.CreateAnimation("beta",Q.d.ANIMATIONTYPE_FLOAT,60,r.EasingFunction));const N=Q.d.TransitionTo("beta",q,this._attachedCamera,this._attachedCamera.lN(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));N&&this._animatables.push(N)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=t.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}r.EasingFunction=new J.s,r.EasingMode=J.p.EASINGMODE_EASEINOUT,r.IgnoreBoundsSizeMode=0,r.FitFrustumSidesMode=1;var O=C(11578),K=C(11610),i=C(12754),I=C(10945);class j{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(N){N=I.Tools.BackCompatCameraNoPreventDefault(arguments);const q=this.camera.getEngine(),C=q.getInputElement();let d=0,U=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=W=>{var a,F;const w=W.event,A="touch"===w.pointerType;if(W.type!==n.d.POINTERMOVE&&-1===this.buttons.indexOf(w.button))return;const t=w.target;if(this._altKey=w.altKey,this._ctrlKey=w.ctrlKey,this._metaKey=w.metaKey,this._shiftKey=w.shiftKey,this._buttonsPressed=w.buttons,q.isPointerLock){const N=w.movementX,q=w.movementY;this.onTouch(null,N,q),this._pointA=null,this._pointB=null}else{if(W.type!==n.d.POINTERDOWN&&W.type!==n.d.POINTERDOUBLETAP&&A&&(null===(a=this._pointA)||void 0===a?void 0:a.pointerId)!==w.pointerId&&(null===(F=this._pointB)||void 0===F?void 0:F.pointerId)!==w.pointerId)return;if(W.type!==n.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!A)if(W.type===n.d.POINTERDOUBLETAP)this.onDoubleTap(w.pointerType);else if(W.type!==n.d.POINTERUP||this._currentMousePointerIdDown!==w.pointerId&&!A){if(W.type===n.d.POINTERMOVE)if(N||w.preventDefault(),this._pointA&&null===this._pointB){const N=w.clientX-this._pointA.x,q=w.clientY-this._pointA.y;this._pointA.x=w.clientX,this._pointA.y=w.clientY,this.onTouch(this._pointA,N,q)}else if(this._pointA&&this._pointB){const N=this._pointA.pointerId===w.pointerId?this._pointA:this._pointB;N.x=w.clientX,N.y=w.clientY;const q=this._pointA.x-this._pointB.x,C=this._pointA.y-this._pointB.y,a=q*q+C*C,F={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:w.pointerId,type:W.type};this.onMultiTouch(this._pointA,this._pointB,d,a,U,F),U=F,d=a}}else{try{null===t||void 0===t||t.releasePointerCapture(w.pointerId)}catch(V){}A||(this._pointB=null),q._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==w.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==w.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==d||U)&&(this.onMultiTouch(this._pointA,this._pointB,d,0,U,null),d=0,U=null),this._currentMousePointerIdDown=-1,this.onButtonUp(w),N||w.preventDefault()}else{try{null===t||void 0===t||t.setPointerCapture(w.pointerId)}catch(V){}if(null===this._pointA)this._pointA={x:w.clientX,y:w.clientY,pointerId:w.pointerId,type:w.pointerType};else{if(null!==this._pointB)return;this._pointB={x:w.clientX,y:w.clientY,pointerId:w.pointerId,type:w.pointerType}}-1!==this._currentMousePointerIdDown||A||(this._currentMousePointerIdDown=w.pointerId),this.onButtonDown(w),N||(w.preventDefault(),C&&C.focus())}}},this._observer=this.camera.lN()._inputManager._addCameraPointerObserver(this._pointerInput,n.d.POINTERDOWN|n.d.POINTERUP|n.d.POINTERMOVE|n.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,d=0,U=null,this.onLostFocus()},this._contextMenuBind=N=>this.onContextMenu(N),C&&C.addEventListener("contextmenu",this._contextMenuBind,!1);const W=this.camera.lN().getEngine().getHostWindow();W&&I.Tools.RegisterTopRootEvents(W,[{name:"blur",handler:this._onLostFocus}])}lt(){if(this._onLostFocus){const N=this.camera.lN().getEngine().getHostWindow();N&&I.Tools.UnregisterTopRootEvents(N,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.lN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const N=this.camera.lN().getEngine().getInputElement();N&&N.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(N){}onTouch(N,q,C){}onMultiTouch(N,q,C,d,U,W){}onContextMenu(N){N.preventDefault()}onButtonDown(N){}onButtonUp(N){}onLostFocus(){}}(0,d.d)([(0,U.O)()],j.prototype,"buttons",void 0);class l extends j{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(N,q){if(0!==this.panningSensibility&&N&&q){const C=q.x-N.x,d=q.y-N.y;this.camera.inertialPanningX+=-C/this.panningSensibility,this.camera.inertialPanningY+=d/this.panningSensibility}}_computePinchZoom(N,q){const C=this.camera.radius||l.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=C*Math.sqrt(N)/Math.sqrt(q):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(q-N)*C*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(q-N)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(N,q,C){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-q/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility):(this.camera.inertialAlphaOffset-=q/this.angularSensibilityX,this.camera.inertialBetaOffset-=C/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(N,q,C,d,U,W){0===C&&null===U||0===d&&null===W||(this.multiTouchPanAndZoom?(this._computePinchZoom(C,d),this._computeMultiTouchPanning(U,W)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(d)-Math.sqrt(C))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(C,d),this._isPinching=!0):this._computeMultiTouchPanning(U,W)):this.multiTouchPanning?this._computeMultiTouchPanning(U,W):this.pinchZoom&&this._computePinchZoom(C,d))}onButtonDown(N){this._isPanClick=N.button===this.camera._panningMouseButton}onButtonUp(N){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}l.MinimumRadiusForPinch=.001,(0,d.d)([(0,U.O)()],l.prototype,"buttons",void 0),(0,d.d)([(0,U.O)()],l.prototype,"angularSensibilityX",void 0),(0,d.d)([(0,U.O)()],l.prototype,"angularSensibilityY",void 0),(0,d.d)([(0,U.O)()],l.prototype,"pinchPrecision",void 0),(0,d.d)([(0,U.O)()],l.prototype,"pinchDeltaPercentage",void 0),(0,d.d)([(0,U.O)()],l.prototype,"useNaturalPinchZoom",void 0),(0,d.d)([(0,U.O)()],l.prototype,"pinchZoom",void 0),(0,d.d)([(0,U.O)()],l.prototype,"panningSensibility",void 0),(0,d.d)([(0,U.O)()],l.prototype,"multiTouchPanning",void 0),(0,d.d)([(0,U.O)()],l.prototype,"multiTouchPanAndZoom",void 0),i.e.ArcRotateCameraPointersInput=l;var T=C(11408);class z{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(N){N=I.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.lN(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((q=>{const C=q.event;if(!C.metaKey)if(q.type===T.b.KEYDOWN){if(this._ctrlPressed=C.ctrlKey,this._altPressed=C.altKey,-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),C.preventDefault&&(N||C.preventDefault())}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){const q=this._keys.indexOf(C.keyCode);q>=0&&this._keys.splice(q,1),C.preventDefault&&(N||C.preventDefault())}})))}lt(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const N=this.camera;for(let q=0;q<this._keys.length;q++){const C=this._keys[q];-1!==this.keysLeft.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningX-=1/this.panningSensibility:N.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?N.inertialRadiusOffset+=1/this.zoomingSensibility:N.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningX+=1/this.panningSensibility:N.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?N.inertialRadiusOffset-=1/this.zoomingSensibility:N.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(C)&&N.useInputToRestoreState&&N.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,d.d)([(0,U.O)()],z.prototype,"keysUp",void 0),(0,d.d)([(0,U.O)()],z.prototype,"keysDown",void 0),(0,d.d)([(0,U.O)()],z.prototype,"keysLeft",void 0),(0,d.d)([(0,U.O)()],z.prototype,"keysRight",void 0),(0,d.d)([(0,U.O)()],z.prototype,"keysReset",void 0),(0,d.d)([(0,U.O)()],z.prototype,"panningSensibility",void 0),(0,d.d)([(0,U.O)()],z.prototype,"zoomingSensibility",void 0),(0,d.d)([(0,U.O)()],z.prototype,"useAltToZoom",void 0),(0,d.d)([(0,U.O)()],z.prototype,"angularSpeed",void 0),i.e.ArcRotateCameraKeyboardMoveInput=z;var p=C(11169),s=C(11412);class X{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new a.Jq(0,0,0),this._globalOffset=new a.Jq(0,0,0),this._inertialPanning=a.Jq.Zero()}_computeDeltaFromMouseWheelLegacyEvent(N,q){let C=0;const d=.01*N*this.wheelDeltaPercentage*q;return C=N>0?d/(1+this.wheelDeltaPercentage):d*(1+this.wheelDeltaPercentage),C}attachControl(N){N=I.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=q=>{if(q.type!==n.d.POINTERWHEEL)return;const C=q.event;let d=0;const U=C.deltaMode===s.d.DOM_DELTA_LINE?40:1,W=-C.deltaY*U;if(this.customComputeDeltaFromMouseWheel)d=this.customComputeDeltaFromMouseWheel(W,this,C);else if(this.wheelDeltaPercentage){if(d=this._computeDeltaFromMouseWheelLegacyEvent(W,this.camera.radius),d>0){let N=this.camera.radius,q=this.camera.inertialRadiusOffset+d;for(let C=0;C<20&&!(N<=q)&&!(Math.abs(q*this.camera.inertia)<.001);C++)N-=q,q*=this.camera.inertia;N=(0,F.Clamp)(N,0,Number.MAX_VALUE),d=this._computeDeltaFromMouseWheelLegacyEvent(W,N)}}else d=W/(40*this.wheelPrecision);d&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(d)):this.camera.inertialRadiusOffset+=d),C.preventDefault&&(N||C.preventDefault())},this._observer=this.camera.lN()._inputManager._addCameraPointerObserver(this._wheel,n.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Rd(0)}lt(){this._observer&&(this.camera.lN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const N=this.camera;0+N.inertialAlphaOffset+N.inertialBetaOffset+N.inertialRadiusOffset&&(this._updateHitPlane(),N.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(N.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const N=this.camera,q=N.target.Qq(N.position);this._hitPlane=p.b.FromPositionAndNormal(N.target,q)}_getPosition(){const N=this.camera,q=N.lN(),C=q.createPickingRay(q.pointerX,q.pointerY,a.Matrix.Identity(),N,!1);0===N.targetScreenOffset.x&&0===N.targetScreenOffset.y||(this._viewOffset.set(N.targetScreenOffset.x,N.targetScreenOffset.y,0),N.getViewMatrix().invertToRef(N._cameraTransformMatrix),this._globalOffset=a.Jq.TransformNormal(this._viewOffset,N._cameraTransformMatrix),C.origin.addInPlace(this._globalOffset));let d=0;return this._hitPlane&&(d=C.intersectsPlane(this._hitPlane)??0),C.origin.addInPlace(C.direction.scaleInPlace(d))}_zoomToMouse(N){const q=this.camera,C=1-q.inertia;if(q.lowerRadiusLimit){const d=q.lowerRadiusLimit??0;q.radius-(q.inertialRadiusOffset+N)/C<d&&(N=(q.radius-d)*C-q.inertialRadiusOffset)}if(q.upperRadiusLimit){const d=q.upperRadiusLimit??0;q.radius-(q.inertialRadiusOffset+N)/C>d&&(N=(q.radius-d)*C-q.inertialRadiusOffset)}const d=N/C/q.radius,U=this._getPosition(),W=a.TmpVectors.Jq[6];U.subtractToRef(q.target,W),W.scaleInPlace(d),W.scaleInPlace(C),this._inertialPanning.addInPlace(W),q.inertialRadiusOffset+=N}_zeroIfClose(N){Math.abs(N.x)<V.e&&(N.x=0),Math.abs(N.y)<V.e&&(N.y=0),Math.abs(N.z)<V.e&&(N.z=0)}}(0,d.d)([(0,U.O)()],X.prototype,"wheelPrecision",void 0),(0,d.d)([(0,U.O)()],X.prototype,"zoomToMouseLocation",void 0),(0,d.d)([(0,U.O)()],X.prototype,"wheelDeltaPercentage",void 0),i.e.ArcRotateCameraMouseWheelInput=X;class P extends i.g{constructor(N){super(N)}addMouseWheel(){return this.add(new X),this}addPointers(){return this.add(new l),this}addKeyboard(){return this.add(new z),this}}var M=C(11076);function Y(N,q){return isNaN(N)?q:N}w.e.AddNodeConstructor("ArcRotateCamera",((N,q)=>()=>new E(N,0,0,1,a.Jq.Zero(),q)));class E extends K.d{get target(){return this._target}set target(N){this.setTarget(N)}get targetHost(){return this._targetHost}set targetHost(N){N&&this.setTarget(N)}getTarget(){return this.target}get position(){return this._position}set position(N){this.setPosition(N)}set upVector(N){this._upToYMatrix||(this._yToUpMatrix=new a.Matrix,this._upToYMatrix=new a.Matrix,this._upVector=a.Jq.Zero()),N.normalize(),this._upVector.U(N),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){a.Matrix.RotationAlignToRef(a.Jq.UpReadOnly,this._upVector,this._yToUpMatrix),a.Matrix.RotationAlignToRef(this._upVector,a.Jq.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const N=this.inputs.attached.pointers;return N?N.angularSensibilityX:0}set angularSensibilityX(N){const q=this.inputs.attached.pointers;q&&(q.angularSensibilityX=N)}get angularSensibilityY(){const N=this.inputs.attached.pointers;return N?N.angularSensibilityY:0}set angularSensibilityY(N){const q=this.inputs.attached.pointers;q&&(q.angularSensibilityY=N)}get pinchPrecision(){const N=this.inputs.attached.pointers;return N?N.pinchPrecision:0}set pinchPrecision(N){const q=this.inputs.attached.pointers;q&&(q.pinchPrecision=N)}get pinchDeltaPercentage(){const N=this.inputs.attached.pointers;return N?N.pinchDeltaPercentage:0}set pinchDeltaPercentage(N){const q=this.inputs.attached.pointers;q&&(q.pinchDeltaPercentage=N)}get useNaturalPinchZoom(){const N=this.inputs.attached.pointers;return!!N&&N.useNaturalPinchZoom}set useNaturalPinchZoom(N){const q=this.inputs.attached.pointers;q&&(q.useNaturalPinchZoom=N)}get panningSensibility(){const N=this.inputs.attached.pointers;return N?N.panningSensibility:0}set panningSensibility(N){const q=this.inputs.attached.pointers;q&&(q.panningSensibility=N)}get keysUp(){const N=this.inputs.attached.keyboard;return N?N.keysUp:[]}set keysUp(N){const q=this.inputs.attached.keyboard;q&&(q.keysUp=N)}get keysDown(){const N=this.inputs.attached.keyboard;return N?N.keysDown:[]}set keysDown(N){const q=this.inputs.attached.keyboard;q&&(q.keysDown=N)}get keysLeft(){const N=this.inputs.attached.keyboard;return N?N.keysLeft:[]}set keysLeft(N){const q=this.inputs.attached.keyboard;q&&(q.keysLeft=N)}get keysRight(){const N=this.inputs.attached.keyboard;return N?N.keysRight:[]}set keysRight(N){const q=this.inputs.attached.keyboard;q&&(q.keysRight=N)}get wheelPrecision(){const N=this.inputs.attached.mousewheel;return N?N.wheelPrecision:0}set wheelPrecision(N){const q=this.inputs.attached.mousewheel;q&&(q.wheelPrecision=N)}get zoomToMouseLocation(){const N=this.inputs.attached.mousewheel;return!!N&&N.zoomToMouseLocation}set zoomToMouseLocation(N){const q=this.inputs.attached.mousewheel;q&&(q.zoomToMouseLocation=N)}get wheelDeltaPercentage(){const N=this.inputs.attached.mousewheel;return N?N.wheelDeltaPercentage:0}set wheelDeltaPercentage(N){const q=this.inputs.attached.mousewheel;q&&(q.wheelDeltaPercentage=N)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(N){N!==this.useBouncingBehavior&&(N?(this._bouncingBehavior=new v,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(N){N!==this.useFramingBehavior&&(N?(this._framingBehavior=new r,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(N){N!==this.useAutoRotationBehavior&&(N?(this._autoRotationBehavior=new Z,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(N,q,C,d,U,F){var w;let A=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(N,a.Jq.Zero(),F,A),w=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=a.Jq.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=a.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new a.Matrix,this.panningAxis=new a.Jq(1,1,0),this._transformedDirection=new a.Jq,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new W.b,this.checkCollisions=!1,this.collisionRadius=new a.Jq(.5,.5,.5),this._previousPosition=a.Jq.Zero(),this._collisionVelocity=a.Jq.Zero(),this._newPosition=a.Jq.Zero(),this._computationVector=a.Jq.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new a.Jq(NaN,NaN,NaN),this._goalTargetScreenOffset=new a.Vector2(NaN,NaN),this._onCollisionPositionChange=function(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C?(w.setPosition(q),w.wZ&&w.wZ(C)):w._previousPosition.U(w._position);const d=Math.cos(w.alpha),U=Math.sin(w.alpha),W=Math.cos(w.beta);let a=Math.sin(w.beta);0===a&&(a=1e-4);const F=w._getTargetPosition();w._computationVector.hd(w.radius*d*a,w.radius*W,w.radius*U*a),F.addToRef(w._computationVector,w._newPosition),w._position.U(w._newPosition);let A=w.upVector;w.allowUpsideDown&&w.beta<0&&(A=A.clone(),A=A.negate()),w._computeViewMatrix(w._position,F,A),w._viewMatrix.addAtIndex(12,w.targetScreenOffset.x),w._viewMatrix.addAtIndex(13,w.targetScreenOffset.y),w._collisionTriggered=!1},this._target=a.Jq.Zero(),U&&this.setTarget(U),this.alpha=q,this.beta=C,this.radius=d,this.getViewMatrix(),this.inputs=new P(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new a.Jq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=a.Vector2.Zero()}_updateCache(N){N||super._updateCache(),this._cache._target.U(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.U(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const N=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?N.addToRef(this._targetBoundingCenter,this._target):this._target.U(N)}const N=this._getLockedTargetPosition();return N||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>V.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,W=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=W?this._currentInterpolationFactor=W:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=Y(N,this._goalAlpha),this._goalBeta=Y(q,this._goalBeta),this._goalRadius=Y(C,this._goalRadius),this._goalTarget.set(Y(d.x,this._goalTarget.x),Y(d.y,this._goalTarget.y),Y(d.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(Y(U.x,this._goalTargetScreenOffset.x),Y(U.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,F.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,F.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,F.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,F.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(N,q){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const U=arguments;q=I.Tools.BackCompatCameraNoPreventDefault(U),this._useCtrlForPanning=C,this._panningMouseButton=d,"boolean"===typeof U[0]&&(U.length>1&&(this._useCtrlForPanning=U[1]),U.length>2&&(this._panningMouseButton=U[2])),this.inputs.attachElement(q),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}lt(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let N=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){N=!0;const q=this.invertRotation?-1:1,C=this._calculateHandednessMultiplier();let d=this.inertialAlphaOffset*C;this.beta<0&&(d*=-1),this.alpha+=d*q,this.beta+=this.inertialBetaOffset*q,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<V.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<V.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*V.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){N=!0;const q=new a.Jq(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),q.multiplyInPlace(this.panningAxis),a.Jq.TransformNormalToRef(q,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const N=this.upVector,q=a.Jq.CrossToRef(this._transformedDirection,N,this._transformedDirection);a.Jq.CrossToRef(N,q,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);a.Jq.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.U(this._transformedDirection)}else{if(this.parent){const N=a.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.transposeToRef(N),a.Jq.TransformCoordinatesToRef(this._transformedDirection,N,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*V.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*V.e&&(this.inertialPanningY=0)}if(N)this.stopInterpolation();else if(this._isInterpolating){let N=!1;const q=this._scene.getEngine().getDeltaTime()/1e3,C=1-Math.pow(2,-q/this._currentInterpolationFactor),d=Y(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const q=a.TmpVectors.Jq[0].set(Y(this._goalTarget.x,this._target.x),Y(this._goalTarget.y,this._target.y),Y(this._goalTarget.z,this._target.z));a.Jq.LerpToRef(this.target,q,C,this._target),10*a.Jq.Distance(this.target,q)/d<V.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.U(q),this.setTarget(this.target,!1,!0,!0)):N=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const q=a.Quaternion.RotationAlphaBetaGammaToRef(Y(this._goalAlpha,this.alpha),Y(this._goalBeta,this.beta),0,a.TmpVectors.Quaternion[0]),d=a.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,a.TmpVectors.Quaternion[1]),U=a.Quaternion.SlerpToRef(d,q,C,a.TmpVectors.Quaternion[2]);U.normalize();const W=U.toAlphaBetaGammaToRef(a.TmpVectors.Jq[0]);if(this.alpha=W.x,this.beta=W.y,U.isApprox(q,V.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const N=q.toAlphaBetaGammaToRef(a.TmpVectors.Jq[0]);this.alpha=N.x,this.beta=N.y}else N=!0}if(isNaN(this._goalRadius)||(this.radius+=(d-this.radius)*C,Math.abs(d/this.radius-1)<V.e?(this._goalRadius=NaN,this.radius=d):N=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const q=a.TmpVectors.Vector2[0].set(Y(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),Y(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));a.Vector2.LerpToRef(this.targetScreenOffset,q,C,this.targetScreenOffset),a.Vector2.Distance(this.targetScreenOffset,q)<V.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.U(q)):N=!0}this._isInterpolating=N}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||a.Jq.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const N=this.alpha;var q,C;this.alpha=function(N){let q=Math.PI/2;return 0===N.x&&0===N.z||(q=Math.acos(N.x/Math.sqrt(Math.pow(N.x,2)+Math.pow(N.z,2)))),N.z<0&&(q=2*Math.PI-q),q}(this._computationVector),this.beta=(q=this._computationVector.y,C=this.radius,Math.acos(q/C));const d=Math.round((N-this.alpha)/(2*Math.PI));this.alpha+=2*d*Math.PI,this._checkLimits()}setPosition(N){this._position.equals(N)||(this._position.U(N),this.rebuildAnglesAndRadius())}setTarget(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(d=this.overrideCloneAlphaBetaRadius??d,N.Ed)q&&N.getBoundingInfo?this._targetBoundingCenter=N.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,N.Ed(),this._targetHost=N,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const q=N,d=this._getTargetPosition();if(d&&!C&&d.equals(q))return;this._targetHost=null,this._target=q,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}d||this.rebuildAnglesAndRadius()}_getViewMatrix(){const N=Math.cos(this.alpha),q=Math.sin(this.alpha),C=Math.cos(this.beta);let d=Math.sin(this.beta);0===d&&(d=1e-4),0===this.radius&&(this.radius=1e-4);const U=this._getTargetPosition();if(this._computationVector.hd(this.radius*N*d,this.radius*C,this.radius*q*d),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||a.Jq.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),U.addToRef(this._computationVector,this._newPosition),this.lN().collisionsEnabled&&this.checkCollisions){const N=this.lN().collisionCoordinator;this._collider||(this._collider=N.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,N.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.U(this._newPosition);let N=this.upVector;this.allowUpsideDown&&d<0&&(N=N.negate()),this._computeViewMatrix(this._position,U,N),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.U(U),this._viewMatrix}zoomOn(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N=N||this.lN().meshes;const C=A.b.MinMax(N);let d=this._calculateLowerRadiusFromModelBoundingSphere(C.min,C.max);if(d=Math.max(Math.min(d,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=d*this.zoomOnFactor,this.mode===O.b.ORTHOGRAPHIC_CAMERA){const N=this.lN().getEngine().getAspectRatio(this),q=d*this.zoomOnFactor/2;this.orthoLeft=-q*N,this.orthoRight=q*N,this.orthoBottom=-q,this.orthoTop=q}this.focusOn({min:C.min,max:C.max,distance:d},q)}focusOn(N){let q,C,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===N.min){const d=N||this.lN().meshes;q=A.b.MinMax(d),C=a.Jq.Distance(q.min,q.max)}else{q=N,C=N.distance}this._target=A.b.Center(q),d||(this.maxZ=2*C)}createRigCamera(N,q){let C=0;switch(this.cameraRigMode){case O.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case O.b.RIG_MODE_VR:C=this._cameraRigParams.stereoHalfAngle*(0===q?1:-1);break;case O.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:C=this._cameraRigParams.stereoHalfAngle*(0===q?-1:1)}const d=new E(N,this.alpha+C,this.beta,this.radius,this._target,this.lN());return d._cameraRigParams={},d.isRigCamera=!0,d.rigParent=this,d.upVector=this.upVector,d.mode=this.mode,d.orthoLeft=this.orthoLeft,d.orthoRight=this.orthoRight,d.orthoBottom=this.orthoBottom,d.orthoTop=this.orthoTop,d}_updateRigCameras(){const N=this._rigCameras[0],q=this._rigCameras[1];switch(N.beta=q.beta=this.beta,this.cameraRigMode){case O.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case O.b.RIG_MODE_VR:N.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case O.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:N.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const d=a.Jq.Distance(N,q),U=this.lN().getEngine().getAspectRatio(this),W=Math.tan(this.fov/2),F=W*U,w=.5*d*C,A=w*Math.sqrt(1+1/(F*F)),n=w*Math.sqrt(1+1/(W*W));return Math.max(A,n)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,d.d)([(0,U.O)()],E.prototype,"alpha",void 0),(0,d.d)([(0,U.O)()],E.prototype,"beta",void 0),(0,d.d)([(0,U.O)()],E.prototype,"radius",void 0),(0,d.d)([(0,U.O)()],E.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,d.d)([(0,U.N)("target")],E.prototype,"_target",void 0),(0,d.d)([(0,U.A)("targetHost")],E.prototype,"_targetHost",void 0),(0,d.d)([(0,U.O)()],E.prototype,"inertialAlphaOffset",void 0),(0,d.d)([(0,U.O)()],E.prototype,"inertialBetaOffset",void 0),(0,d.d)([(0,U.O)()],E.prototype,"inertialRadiusOffset",void 0),(0,d.d)([(0,U.O)()],E.prototype,"lowerAlphaLimit",void 0),(0,d.d)([(0,U.O)()],E.prototype,"upperAlphaLimit",void 0),(0,d.d)([(0,U.O)()],E.prototype,"lowerBetaLimit",void 0),(0,d.d)([(0,U.O)()],E.prototype,"upperBetaLimit",void 0),(0,d.d)([(0,U.O)()],E.prototype,"lowerRadiusLimit",void 0),(0,d.d)([(0,U.O)()],E.prototype,"upperRadiusLimit",void 0),(0,d.d)([(0,U.O)()],E.prototype,"lowerTargetYLimit",void 0),(0,d.d)([(0,U.O)()],E.prototype,"inertialPanningX",void 0),(0,d.d)([(0,U.O)()],E.prototype,"inertialPanningY",void 0),(0,d.d)([(0,U.O)()],E.prototype,"pinchToPanMaxDistance",void 0),(0,d.d)([(0,U.O)()],E.prototype,"panningDistanceLimit",void 0),(0,d.d)([(0,U.N)()],E.prototype,"panningOriginTarget",void 0),(0,d.d)([(0,U.O)()],E.prototype,"panningInertia",void 0),(0,d.d)([(0,U.O)()],E.prototype,"zoomToMouseLocation",null),(0,d.d)([(0,U.O)()],E.prototype,"zoomOnFactor",void 0),(0,d.d)([(0,U.J)()],E.prototype,"targetScreenOffset",void 0),(0,d.d)([(0,U.O)()],E.prototype,"allowUpsideDown",void 0),(0,d.d)([(0,U.O)()],E.prototype,"useInputToRestoreState",void 0),(0,d.d)([(0,U.O)()],E.prototype,"restoreStateInterpolationFactor",void 0),(0,M.h)("BABYLON.ArcRotateCamera",E)},12754:(N,q,C)=>{"use strict";C.d(q,{e:()=>a,g:()=>F});var d=C(10962),U=C(11155),W=C(11578),a={};class F{constructor(N){this.attachedToElement=!1,this.attached={},this.camera=N,this.checkInputs=()=>{}}add(N){const q=N.getSimpleName();this.attached[q]?d.c.Warn("camera input of type "+q+" already exists on camera"):(this.attached[q]=N,N.camera=this.camera,N.checkInputs&&(this.checkInputs=this._addCheckInputs(N.checkInputs.bind(N))),this.attachedToElement&&N.attachControl(this.noPreventDefault))}remove(N){for(const q in this.attached){const C=this.attached[q];if(C===N)return C.lt(),C.camera=null,delete this.attached[q],void this.rebuildInputCheck()}}removeByType(N){for(const q in this.attached){const C=this.attached[q];C.getClassName()===N&&(C.lt(),C.camera=null,delete this.attached[q],this.rebuildInputCheck())}}_addCheckInputs(N){const q=this.checkInputs;return()=>{q(),N()}}attachInput(N){this.attachedToElement&&N.attachControl(this.noPreventDefault)}attachElement(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){N=!W.b.ForceAttachControlToAlwaysPreventDefault&&N,this.attachedToElement=!0,this.noPreventDefault=N;for(const q in this.attached)this.attached[q].attachControl(N)}}detachElement(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const q in this.attached)this.attached[q].lt(),N&&(this.attached[q].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const N in this.attached){const q=this.attached[N];q.checkInputs&&(this.checkInputs=this._addCheckInputs(q.checkInputs.bind(q)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(N){const q={};for(const C in this.attached){const N=this.attached[C],d=U.d.Serialize(N);q[N.getClassName()]=d}N.inputsmgr=q}parse(N){const q=N.inputsmgr;if(q){this.clear();for(const N in q){const C=a[N];if(C){const d=q[N],W=U.d.Parse((()=>new C),d,null);this.add(W)}}}else for(const C in this.attached){const q=a[this.attached[C].getClassName()];if(q){const d=U.d.Parse((()=>new q),N,null);this.remove(this.attached[C]),this.add(d)}}}}},12750:(N,q,C)=>{"use strict";C.d(q,{c:()=>j});var d=C(11110),U=C(11114),W=C(11122),a=C(11610),F=C(12754),w=C(11408),A=C(10945);class n{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(N){N=A.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.lN(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((q=>{const C=q.event;if(!C.metaKey)if(q.type===w.b.KEYDOWN){if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),N||C.preventDefault()}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){const q=this._keys.indexOf(C.keyCode);q>=0&&this._keys.splice(q,1),N||C.preventDefault()}})))}lt(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const N=this.camera;for(let q=0;q<this._keys.length;q++){const C=this._keys[q],d=N._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(C)?N._localDirection.hd(-d,0,0):-1!==this.keysUp.indexOf(C)?N._localDirection.hd(0,0,d):-1!==this.keysRight.indexOf(C)?N._localDirection.hd(d,0,0):-1!==this.keysDown.indexOf(C)?N._localDirection.hd(0,0,-d):-1!==this.keysUpward.indexOf(C)?N._localDirection.hd(0,d,0):-1!==this.keysDownward.indexOf(C)?N._localDirection.hd(0,-d,0):-1!==this.keysRotateLeft.indexOf(C)?(N._localDirection.hd(0,0,0),N.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(C)?(N._localDirection.hd(0,0,0),N.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(C)?(N._localDirection.hd(0,0,0),N.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(C)&&(N._localDirection.hd(0,0,0),N.cameraRotation.x+=this._getLocalRotation()),N.lN().useRightHandedSystem&&(N._localDirection.z*=-1),N.getViewMatrix().invertToRef(N._cameraTransformMatrix),W.Jq.TransformNormalToRef(N._localDirection,N._cameraTransformMatrix,N._transformedDirection),N.cameraDirection.addInPlace(N._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const N=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*N}}(0,d.d)([(0,U.O)()],n.prototype,"keysUp",void 0),(0,d.d)([(0,U.O)()],n.prototype,"keysUpward",void 0),(0,d.d)([(0,U.O)()],n.prototype,"keysDown",void 0),(0,d.d)([(0,U.O)()],n.prototype,"keysDownward",void 0),(0,d.d)([(0,U.O)()],n.prototype,"keysLeft",void 0),(0,d.d)([(0,U.O)()],n.prototype,"keysRight",void 0),(0,d.d)([(0,U.O)()],n.prototype,"rotationSpeed",void 0),(0,d.d)([(0,U.O)()],n.prototype,"keysRotateLeft",void 0),(0,d.d)([(0,U.O)()],n.prototype,"keysRotateRight",void 0),(0,d.d)([(0,U.O)()],n.prototype,"keysRotateUp",void 0),(0,d.d)([(0,U.O)()],n.prototype,"keysRotateDown",void 0),F.e.FreeCameraKeyboardMoveInput=n;var t=C(10949),V=C(11401);class Z{constructor(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=N,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new t.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(N){N=A.Tools.BackCompatCameraNoPreventDefault(arguments);const q=this.camera.getEngine(),C=q.getInputElement();this._pointerInput||(this._pointerInput=d=>{const U=d.event,W="touch"===U.pointerType;if(!this.touchEnabled&&W)return;if(d.type!==V.d.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const a=U.target;if(d.type===V.d.POINTERDOWN){if(W&&-1!==this._activePointerId||!W&&-1!==this._currentActiveButton)return;this._activePointerId=U.pointerId;try{null===a||void 0===a||a.setPointerCapture(U.pointerId)}catch(F){}-1===this._currentActiveButton&&(this._currentActiveButton=U.button),this._previousPosition={x:U.clientX,y:U.clientY},N||(U.preventDefault(),C&&C.focus()),q.isPointerLock&&this._onMouseMove&&this._onMouseMove(d.event)}else if(d.type===V.d.POINTERUP){if(W&&this._activePointerId!==U.pointerId||!W&&this._currentActiveButton!==U.button)return;try{null===a||void 0===a||a.releasePointerCapture(U.pointerId)}catch(F){}this._currentActiveButton=-1,this._previousPosition=null,N||U.preventDefault(),this._activePointerId=-1}else if(d.type===V.d.POINTERMOVE&&(this._activePointerId===U.pointerId||!W))if(q.isPointerLock&&this._onMouseMove)this._onMouseMove(d.event);else if(this._previousPosition){const q=this.camera._calculateHandednessMultiplier(),C=(U.clientX-this._previousPosition.x)*q,d=U.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=C/this.angularSensibility,this.camera.cameraRotation.x+=d/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:C,offsetY:d}),this._previousPosition={x:U.clientX,y:U.clientY},N||U.preventDefault()}}),this._onMouseMove=C=>{if(!q.isPointerLock)return;const d=this.camera._calculateHandednessMultiplier(),U=C.movementX*d;this.camera.cameraRotation.y+=U/this.angularSensibility;const W=C.movementY;this.camera.cameraRotation.x+=W/this.angularSensibility,this._previousPosition=null,N||C.preventDefault()},this._observer=this.camera.lN()._inputManager._addCameraPointerObserver(this._pointerInput,V.d.POINTERDOWN|V.d.POINTERUP|V.d.POINTERMOVE),C&&(this._contextMenuBind=N=>this.onContextMenu(N),C.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(N){N.preventDefault()}lt(){if(this._observer){if(this.camera.lN()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const N=this.camera.getEngine().getInputElement();N&&N.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,d.d)([(0,U.O)()],Z.prototype,"buttons",void 0),(0,d.d)([(0,U.O)()],Z.prototype,"angularSensibility",void 0),F.e.FreeCameraMouseInput=Z;var J,Q=C(11412);class v{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new t.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(N){N=A.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=q=>{if(q.type!==V.d.POINTERWHEEL)return;const C=q.event,d=C.deltaMode===Q.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*d*C.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*d*C.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*d*C.deltaZ/this._normalize,C.preventDefault&&(N||C.preventDefault())},this._observer=this.camera.lN()._inputManager._addCameraPointerObserver(this._wheel,V.d.POINTERWHEEL)}lt(){this._observer&&(this.camera.lN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,d.d)([(0,U.O)()],v.prototype,"wheelPrecisionX",void 0),(0,d.d)([(0,U.O)()],v.prototype,"wheelPrecisionY",void 0),(0,d.d)([(0,U.O)()],v.prototype,"wheelPrecisionZ",void 0),function(N){N[N.MoveRelative=0]="MoveRelative",N[N.RotateRelative=1]="RotateRelative",N[N.MoveScene=2]="MoveScene"}(J||(J={}));class r extends v{constructor(){super(...arguments),this._moveRelative=W.Jq.Zero(),this._rotateRelative=W.Jq.Zero(),this._moveScene=W.Jq.Zero(),this._wheelXAction=J.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=J.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(N){null===N&&this._wheelXAction!==J.MoveRelative||(this._wheelXAction=J.MoveRelative,this._wheelXActionCoordinate=N)}get wheelXMoveRelative(){return this._wheelXAction!==J.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(N){null===N&&this._wheelYAction!==J.MoveRelative||(this._wheelYAction=J.MoveRelative,this._wheelYActionCoordinate=N)}get wheelYMoveRelative(){return this._wheelYAction!==J.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(N){null===N&&this._wheelZAction!==J.MoveRelative||(this._wheelZAction=J.MoveRelative,this._wheelZActionCoordinate=N)}get wheelZMoveRelative(){return this._wheelZAction!==J.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(N){null===N&&this._wheelXAction!==J.RotateRelative||(this._wheelXAction=J.RotateRelative,this._wheelXActionCoordinate=N)}get wheelXRotateRelative(){return this._wheelXAction!==J.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(N){null===N&&this._wheelYAction!==J.RotateRelative||(this._wheelYAction=J.RotateRelative,this._wheelYActionCoordinate=N)}get wheelYRotateRelative(){return this._wheelYAction!==J.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(N){null===N&&this._wheelZAction!==J.RotateRelative||(this._wheelZAction=J.RotateRelative,this._wheelZActionCoordinate=N)}get wheelZRotateRelative(){return this._wheelZAction!==J.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(N){null===N&&this._wheelXAction!==J.MoveScene||(this._wheelXAction=J.MoveScene,this._wheelXActionCoordinate=N)}get wheelXMoveScene(){return this._wheelXAction!==J.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(N){null===N&&this._wheelYAction!==J.MoveScene||(this._wheelYAction=J.MoveScene,this._wheelYActionCoordinate=N)}get wheelYMoveScene(){return this._wheelYAction!==J.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(N){null===N&&this._wheelZAction!==J.MoveScene||(this._wheelZAction=J.MoveScene,this._wheelZActionCoordinate=N)}get wheelZMoveScene(){return this._wheelZAction!==J.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Rd(0),this._rotateRelative.Rd(0),this._moveScene.Rd(0),this._updateCamera(),this.camera.lN().useRightHandedSystem&&(this._moveRelative.z*=-1);const N=W.Matrix.Zero();this.camera.getViewMatrix().invertToRef(N);const q=W.Jq.Zero();W.Jq.TransformNormalToRef(this._moveRelative,N,q),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(q),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(N,q,C){if(0===N)return;if(null===q||null===C)return;let d=null;switch(q){case J.MoveRelative:d=this._moveRelative;break;case J.RotateRelative:d=this._rotateRelative;break;case J.MoveScene:d=this._moveScene}switch(C){case 0:d.set(N,0,0);break;case 1:d.set(0,N,0);break;case 2:d.set(0,0,N)}}}(0,d.d)([(0,U.O)()],r.prototype,"wheelXMoveRelative",null),(0,d.d)([(0,U.O)()],r.prototype,"wheelYMoveRelative",null),(0,d.d)([(0,U.O)()],r.prototype,"wheelZMoveRelative",null),(0,d.d)([(0,U.O)()],r.prototype,"wheelXRotateRelative",null),(0,d.d)([(0,U.O)()],r.prototype,"wheelYRotateRelative",null),(0,d.d)([(0,U.O)()],r.prototype,"wheelZRotateRelative",null),(0,d.d)([(0,U.O)()],r.prototype,"wheelXMoveScene",null),(0,d.d)([(0,U.O)()],r.prototype,"wheelYMoveScene",null),(0,d.d)([(0,U.O)()],r.prototype,"wheelZMoveScene",null),F.e.FreeCameraMouseWheelInput=r;class O{constructor(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=N,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=A.Tools.IsSafari()}attachControl(N){N=A.Tools.BackCompatCameraNoPreventDefault(arguments);let q=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=C=>{const d=C.event,U="mouse"===d.pointerType||this._isSafari&&"undefined"===typeof d.pointerType;if(this.allowMouse||!U)if(C.type===V.d.POINTERDOWN){if(N||d.preventDefault(),this._pointerPressed.push(d.pointerId),1!==this._pointerPressed.length)return;q={x:d.clientX,y:d.clientY}}else if(C.type===V.d.POINTERUP){N||d.preventDefault();const C=this._pointerPressed.indexOf(d.pointerId);if(-1===C)return;if(this._pointerPressed.splice(C,1),0!=C)return;q=null,this._offsetX=null,this._offsetY=null}else if(C.type===V.d.POINTERMOVE){if(N||d.preventDefault(),!q)return;if(0!=this._pointerPressed.indexOf(d.pointerId))return;this._offsetX=d.clientX-q.x,this._offsetY=-(d.clientY-q.y)}}),this._observer=this.camera.lN()._inputManager._addCameraPointerObserver(this._pointerInput,V.d.POINTERDOWN|V.d.POINTERUP|V.d.POINTERMOVE),this._onLostFocus){const N=this.camera.getEngine().getInputElement();N&&N.addEventListener("blur",this._onLostFocus)}}lt(){if(this._pointerInput){if(this._observer&&(this.camera.lN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const N=this.camera.getEngine().getInputElement();N&&N.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const N=this.camera,q=N._calculateHandednessMultiplier();N.cameraRotation.y=q*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)N.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const q=N._computeLocalCameraSpeed(),C=new W.Jq(0,0,0!==this.touchMoveSensibility?q*this._offsetY/this.touchMoveSensibility:0);W.Matrix.RotationYawPitchRollToRef(N.rotation.y,N.rotation.x,0,N._cameraRotationMatrix),N.cameraDirection.addInPlace(W.Jq.TransformCoordinates(C,N._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,d.d)([(0,U.O)()],O.prototype,"touchAngularSensibility",void 0),(0,d.d)([(0,U.O)()],O.prototype,"touchMoveSensibility",void 0),F.e.FreeCameraTouchInput=O;class K extends F.g{constructor(N){super(N),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new n),this}addMouse(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new Z(N),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new r,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new O),this}clear(){super.clear(),this._mouseInput=null}}var i=C(11076),I=C(11032);class j extends a.d{get angularSensibility(){const N=this.inputs.attached.mouse;return N?N.angularSensibility:0}set angularSensibility(N){const q=this.inputs.attached.mouse;q&&(q.angularSensibility=N)}get keysUp(){const N=this.inputs.attached.keyboard;return N?N.keysUp:[]}set keysUp(N){const q=this.inputs.attached.keyboard;q&&(q.keysUp=N)}get keysUpward(){const N=this.inputs.attached.keyboard;return N?N.keysUpward:[]}set keysUpward(N){const q=this.inputs.attached.keyboard;q&&(q.keysUpward=N)}get keysDown(){const N=this.inputs.attached.keyboard;return N?N.keysDown:[]}set keysDown(N){const q=this.inputs.attached.keyboard;q&&(q.keysDown=N)}get keysDownward(){const N=this.inputs.attached.keyboard;return N?N.keysDownward:[]}set keysDownward(N){const q=this.inputs.attached.keyboard;q&&(q.keysDownward=N)}get keysLeft(){const N=this.inputs.attached.keyboard;return N?N.keysLeft:[]}set keysLeft(N){const q=this.inputs.attached.keyboard;q&&(q.keysLeft=N)}get keysRight(){const N=this.inputs.attached.keyboard;return N?N.keysRight:[]}set keysRight(N){const q=this.inputs.attached.keyboard;q&&(q.keysRight=N)}get keysRotateLeft(){const N=this.inputs.attached.keyboard;return N?N.keysRotateLeft:[]}set keysRotateLeft(N){const q=this.inputs.attached.keyboard;q&&(q.keysRotateLeft=N)}get keysRotateRight(){const N=this.inputs.attached.keyboard;return N?N.keysRotateRight:[]}set keysRotateRight(N){const q=this.inputs.attached.keyboard;q&&(q.keysRotateRight=N)}get keysRotateUp(){const N=this.inputs.attached.keyboard;return N?N.keysRotateUp:[]}set keysRotateUp(N){const q=this.inputs.attached.keyboard;q&&(q.keysRotateUp=N)}get keysRotateDown(){const N=this.inputs.attached.keyboard;return N?N.keysRotateDown:[]}set keysRotateDown(N){const q=this.inputs.attached.keyboard;q&&(q.keysRotateDown=N)}constructor(N,q,C){var d;super(N,q,C,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),d=this,this.ellipsoid=new W.Jq(.5,1,.5),this.ellipsoidOffset=new W.Jq(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=W.Jq.Zero(),this._diffPosition=W.Jq.Zero(),this._newPosition=W.Jq.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d._newPosition.U(q),d._newPosition.subtractToRef(d._oldPosition,d._diffPosition),d._diffPosition.length()>I.b.CollisionsEpsilon&&(d.position.addToRef(d._diffPosition,d._deferredPositionUpdate),d._deferOnly?d._deferredUpdated=!0:d.position.U(d._deferredPositionUpdate),d.wZ&&C&&d.wZ(C))},this.inputs=new K(this),this.inputs.addKeyboard().addMouse()}attachControl(N,q){q=A.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(q)}lt(){this.inputs.detachElement(),this.cameraDirection=new W.Jq(0,0,0),this.cameraRotation=new W.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(N){this._collisionMask=isNaN(N)?-1:N}_collideWithWorld(N){let q;q=this.parent?W.Jq.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,q.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const C=this.lN().collisionCoordinator;this._collider||(this._collider=C.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let d=N;this.applyGravity&&(d=N.add(this.lN().gravity)),C.getNewPosition(this._oldPosition,d,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=W.Jq.Zero(),this._transformedDirection=W.Jq.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(N){this._needMoveForGravity=N}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.lN().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"DJ"}}(0,d.d)([(0,U.N)()],j.prototype,"ellipsoid",void 0),(0,d.d)([(0,U.N)()],j.prototype,"ellipsoidOffset",void 0),(0,d.d)([(0,U.O)()],j.prototype,"checkCollisions",void 0),(0,d.d)([(0,U.O)()],j.prototype,"applyGravity",void 0),(0,i.h)("BABYLON.FreeCamera",j)},13318:(N,q,C)=>{"use strict";C.d(q,{b:()=>W});var d=C(11219),U=C(13320);class W{constructor(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=C,this.Gn=[],this._maxBlockCapacity=q||64,this._selectionContent=new d.b(1024),this._creationFunc=N}update(N,q,C){U.c._CreateBlocks(N,q,C,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}uA(N){for(let q=0;q<this.an.length;q++){this.an[q].addEntry(N)}}RA(N){for(let q=0;q<this.an.length;q++){this.an[q].removeEntry(N)}}select(N,q){this._selectionContent.reset();for(let C=0;C<this.an.length;C++){this.an[C].select(N,this._selectionContent,q)}return q?this._selectionContent.concat(this.Gn):this._selectionContent.concatWithNoDuplicate(this.Gn),this._selectionContent}intersects(N,q,C){this._selectionContent.reset();for(let d=0;d<this.an.length;d++){this.an[d].intersects(N,q,this._selectionContent,C)}return C?this._selectionContent.concat(this.Gn):this._selectionContent.concatWithNoDuplicate(this.Gn),this._selectionContent}intersectsRay(N){this._selectionContent.reset();for(let q=0;q<this.an.length;q++){this.an[q].intersectsRay(N,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Gn),this._selectionContent}}W.CreationFuncForMeshes=(N,q)=>{const C=N.getBoundingInfo();!N.isBlocked&&C.boundingBox.intersectsMinMax(q.un,q.mn)&&q.entries.push(N)},W.CreationFuncForSubMeshes=(N,q)=>{N.getBoundingInfo().boundingBox.intersectsMinMax(q.un,q.mn)&&q.entries.push(N)}},13320:(N,q,C)=>{"use strict";C.d(q,{c:()=>W});var d=C(11122),U=C(11469);class W{constructor(N,q,C,d,U,W){this.entries=[],this.fn=new Array,this._capacity=C,this._depth=d,this._maxDepth=U,this._creationFunc=W,this._minPoint=N,this._maxPoint=q,this.fn.push(N.clone()),this.fn.push(q.clone()),this.fn.push(N.clone()),this.fn[2].x=q.x,this.fn.push(N.clone()),this.fn[3].y=q.y,this.fn.push(N.clone()),this.fn[4].z=q.z,this.fn.push(q.clone()),this.fn[5].z=N.z,this.fn.push(q.clone()),this.fn[6].x=N.x,this.fn.push(q.clone()),this.fn[7].y=N.y}get oq(){return this._capacity}get un(){return this._minPoint}get mn(){return this._maxPoint}addEntry(N){if(this.an)for(let q=0;q<this.an.length;q++){this.an[q].addEntry(N)}else this._creationFunc(N,this),this.entries.length>this.oq&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(N){if(this.an){for(let q=0;q<this.an.length;q++){this.an[q].removeEntry(N)}return}const q=this.entries.indexOf(N);q>-1&&this.entries.splice(q,1)}addEntries(N){for(let q=0;q<N.length;q++){const C=N[q];this.addEntry(C)}}select(N,q,C){if(U.e.IsInFrustum(this.fn,N)){if(this.an){for(let d=0;d<this.an.length;d++){this.an[d].select(N,q,C)}return}C?q.concat(this.entries):q.concatWithNoDuplicate(this.entries)}}intersects(N,q,C,d){if(U.e.IntersectsSphere(this._minPoint,this._maxPoint,N,q)){if(this.an){for(let U=0;U<this.an.length;U++){this.an[U].intersects(N,q,C,d)}return}d?C.concat(this.entries):C.concatWithNoDuplicate(this.entries)}}intersectsRay(N,q){if(N.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.an){for(let C=0;C<this.an.length;C++){this.an[C].intersectsRay(N,q)}return}q.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){W._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(N,q,C,U,a,F,w,A){w.an=new Array;const n=new d.Jq((q.x-N.x)/2,(q.y-N.y)/2,(q.z-N.z)/2);for(let d=0;d<2;d++)for(let q=0;q<2;q++)for(let t=0;t<2;t++){const V=N.add(n.multiplyByFloats(d,q,t)),Z=N.add(n.multiplyByFloats(d+1,q+1,t+1)),J=new W(V,Z,U,a+1,F,A);J.addEntries(C),w.an.push(J)}}}},13322:(N,q,C)=>{"use strict";C.d(q,{c:()=>n});var d=C(11364),U=C(11122),W=C(11557),a=C(12512),F=C(11395),w=C(13318),A=C(10995);d.c.prototype.createOrUpdateSelectionOctree=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,C=this._getComponent(F.e.NAME_OCTREE);C||(C=new n(this),this.dd(C)),this.cn||(this.cn=new w.b(w.b.CreationFuncForMeshes,N,q));const d=this.getWorldExtends();return this.cn.update(d.min,d.max,this.meshes),this.cn},Object.defineProperty(d.c.prototype,"selectionOctree",{get:function(){return this.cn},enumerable:!0,configurable:!0}),W.d.prototype.createOrUpdateSubmeshesOctree=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const C=this.lN();let d=C._getComponent(F.e.NAME_OCTREE);d||(d=new n(C),C.dd(d)),this._submeshesOctree||(this._submeshesOctree=new w.b(w.b.CreationFuncForSubMeshes,N,q)),this.Ed(!0);const U=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(U.minimumWorld,U.maximumWorld,this.jd),this._submeshesOctree};class n{constructor(N){this.name=F.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new a.e(U.Jq.Zero(),new U.Jq(1,1,1)),(N=N||A.e.LastCreatedScene)&&(this.vq=N,this.vq.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.vq.getActiveSubMeshCandidates=N=>this.getActiveSubMeshCandidates(N),this.vq.getCollidingSubMeshCandidates=(N,q)=>this.getCollidingSubMeshCandidates(N,q),this.vq.getIntersectingSubMeshCandidates=(N,q)=>this.getIntersectingSubMeshCandidates(N,q))}register(){this.vq.onMeshRemovedObservable.add((N=>{const q=this.vq.selectionOctree;if(void 0!==q&&null!==q){const C=q.Gn.indexOf(N);-1!==C&&q.Gn.splice(C,1)}})),this.vq.onMeshImportedObservable.add((N=>{const q=this.vq.selectionOctree;void 0!==q&&null!==q&&q.uA(N)}))}getActiveMeshCandidates(){var N;return(null===(N=this.vq.cn)||void 0===N?void 0:N.select(this.vq.frustumPlanes))||this.vq._getDefaultMeshCandidates()}getActiveSubMeshCandidates(N){if(N._submeshesOctree&&N.useOctreeForRenderingSelection){return N._submeshesOctree.select(this.vq.frustumPlanes)}return this.vq._getDefaultSubMeshCandidates(N)}getIntersectingSubMeshCandidates(N,q){if(N._submeshesOctree&&N.useOctreeForPicking){a.e.TransformToRef(q,N.getWorldMatrix(),this._tempRay);return N._submeshesOctree.intersectsRay(this._tempRay)}return this.vq._getDefaultSubMeshCandidates(N)}getCollidingSubMeshCandidates(N,q){if(N._submeshesOctree&&N.useOctreeForCollisions){const C=q._velocityWorldLength+Math.max(q._radius.x,q._radius.y,q._radius.z);return N._submeshesOctree.intersects(q._basePointWorld,C)}return this.vq._getDefaultSubMeshCandidates(N)}rebuild(){}dispose(){}}},12512:(N,q,C)=>{"use strict";C.d(q,{e:()=>Z});var d=C(11364),U=C(11578),W=C(11129),a=C(11122),F=C(11134),w=C(11460),A=C(11386),n=C(10995),t=C(11417);const V={internalPickerForMesh:void 0};class Z{constructor(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:W.e;this.origin=N,this.direction=q,this.length=C,this.epsilon=d}clone(){return new Z(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d=Z._TmpVector3[0].hd(N.x-C,N.y-C,N.z-C),U=Z._TmpVector3[1].hd(q.x+C,q.y+C,q.z+C);let W,a,F,w,A=0,n=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<d.x||this.origin.x>U.x)return!1}else if(W=1/this.direction.x,a=(d.x-this.origin.x)*W,F=(U.x-this.origin.x)*W,F===-1/0&&(F=1/0),a>F&&(w=a,a=F,F=w),A=Math.max(a,A),n=Math.min(F,n),A>n)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<d.y||this.origin.y>U.y)return!1}else if(W=1/this.direction.y,a=(d.y-this.origin.y)*W,F=(U.y-this.origin.y)*W,F===-1/0&&(F=1/0),a>F&&(w=a,a=F,F=w),A=Math.max(a,A),n=Math.min(F,n),A>n)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<d.z||this.origin.z>U.z)return!1}else if(W=1/this.direction.z,a=(d.z-this.origin.z)*W,F=(U.z-this.origin.z)*W,F===-1/0&&(F=1/0),a>F&&(w=a,a=F,F=w),A=Math.max(a,A),n=Math.min(F,n),A>n)return!1;return!0}intersectsBox(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(N.minimum,N.maximum,q)}intersectsSphere(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=N.center.x-this.origin.x,d=N.center.y-this.origin.y,U=N.center.z-this.origin.z,W=C*C+d*d+U*U,a=N.radius+q,F=a*a;if(W<=F)return!0;const w=C*this.direction.x+d*this.direction.y+U*this.direction.z;if(w<0)return!1;return W-w*w<=F}intersectsTriangle(N,q,C){const d=Z._TmpVector3[0],U=Z._TmpVector3[1],W=Z._TmpVector3[2],F=Z._TmpVector3[3],A=Z._TmpVector3[4];q.subtractToRef(N,d),C.subtractToRef(N,U),a.Jq.CrossToRef(this.direction,U,W);const n=a.Jq.Dot(d,W);if(0===n)return null;const t=1/n;this.origin.subtractToRef(N,F);const V=a.Jq.Dot(F,W)*t;if(V<-this.epsilon||V>1+this.epsilon)return null;a.Jq.CrossToRef(F,d,A);const J=a.Jq.Dot(this.direction,A)*t;if(J<-this.epsilon||V+J>1+this.epsilon)return null;const Q=a.Jq.Dot(U,A)*t;return Q>this.length?null:new w.b(1-V-J,V,Q)}intersectsPlane(N){let q;const C=a.Jq.Dot(N.normal,this.direction);if(Math.abs(C)<9.99999997475243e-7)return null;{const d=a.Jq.Dot(N.normal,this.origin);return q=(-N.d-d)/C,q<0?q<-9.99999997475243e-7?null:0:q}}intersectsAxis(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(N){case"y":{const N=(this.origin.y-q)/this.direction.y;return N>0?null:new a.Jq(this.origin.x+this.direction.x*-N,q,this.origin.z+this.direction.z*-N)}case"x":{const N=(this.origin.x-q)/this.direction.x;return N>0?null:new a.Jq(q,this.origin.y+this.direction.y*-N,this.origin.z+this.direction.z*-N)}case"z":{const N=(this.origin.z-q)/this.direction.z;return N>0?null:new a.Jq(this.origin.x+this.direction.x*-N,this.origin.y+this.direction.y*-N,q)}default:return null}}intersectsMesh(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,W=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=a.TmpVectors.Matrix[0];return N.getWorldMatrix().invertToRef(F),this._tmpRay?Z.TransformToRef(this,F,this._tmpRay):this._tmpRay=Z.Transform(this,F),N.intersects(this._tmpRay,q,C,d,U,W)}intersectsMeshes(N,q,C){C?C.length=0:C=[];for(let d=0;d<N.length;d++){const U=this.intersectsMesh(N[d],q);U.hit&&C.push(U)}return C.sort(this._comparePickingInfo),C}_comparePickingInfo(N,q){return N.distance<q.distance?-1:N.distance>q.distance?1:0}intersectionSegment(N,q,C){const d=this.origin,U=a.TmpVectors.Jq[0],W=a.TmpVectors.Jq[1],F=a.TmpVectors.Jq[2],w=a.TmpVectors.Jq[3];q.subtractToRef(N,U),this.direction.scaleToRef(Z._Rayl,F),d.addToRef(F,W),N.subtractToRef(d,w);const A=a.Jq.Dot(U,U),n=a.Jq.Dot(U,F),t=a.Jq.Dot(F,F),V=a.Jq.Dot(U,w),J=a.Jq.Dot(F,w),Q=A*t-n*n;let v,r,O=Q,K=Q;Q<Z._Smallnum?(v=0,O=1,r=J,K=t):(v=n*J-t*V,r=A*J-n*V,v<0?(v=0,r=J,K=t):v>O&&(v=O,r=J+n,K=t)),r<0?(r=0,-V<0?v=0:-V>A?v=O:(v=-V,O=A)):r>K&&(r=K,-V+n<0?v=0:-V+n>A?v=O:(v=-V+n,O=A));const i=Math.abs(v)<Z._Smallnum?0:v/O,I=Math.abs(r)<Z._Smallnum?0:r/K,j=a.TmpVectors.Jq[4];F.scaleToRef(I,j);const l=a.TmpVectors.Jq[5];U.scaleToRef(i,l),l.addInPlace(w);const T=a.TmpVectors.Jq[6];l.subtractToRef(j,T);return I>0&&I<=this.length&&T.lengthSquared()<C*C?l.length():-1}update(N,q,C,d,U,W,F){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){Z._RayDistant||(Z._RayDistant=Z.Zero()),Z._RayDistant.unprojectRayToRef(N,q,C,d,a.Matrix.IdentityReadOnly,W,F);const w=a.TmpVectors.Matrix[0];U.invertToRef(w),Z.TransformToRef(Z._RayDistant,w,this)}else this.unprojectRayToRef(N,q,C,d,U,W,F);return this}static Zero(){return new Z(a.Jq.Zero(),a.Jq.Zero())}static CreateNew(N,q,C,d,U,W,a){return Z.Zero().update(N,q,C,d,U,W,a)}static CreateNewFromTo(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Matrix.IdentityReadOnly;const d=new Z(new a.Jq(0,0,0),new a.Jq(0,0,0));return Z.CreateFromToToRef(N,q,d,C)}static CreateFromToToRef(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.Matrix.IdentityReadOnly;C.origin.U(N);const U=q.subtractToRef(N,C.direction),W=Math.sqrt(U.x*U.x+U.y*U.y+U.z*U.z);return C.length=W,C.direction.normalize(),Z.TransformToRef(C,d,C)}static Transform(N,q){const C=new Z(new a.Jq(0,0,0),new a.Jq(0,0,0));return Z.TransformToRef(N,q,C),C}static TransformToRef(N,q,C){a.Jq.TransformCoordinatesToRef(N.origin,q,C.origin),a.Jq.TransformNormalToRef(N.direction,q,C.direction),C.length=N.length,C.epsilon=N.epsilon;const d=C.direction,U=d.length();if(0!==U&&1!==U){const N=1/U;d.x*=N,d.y*=N,d.z*=N,C.length*=U}return C}unprojectRayToRef(N,q,C,d,U,W,F){const w=a.TmpVectors.Matrix[0];U.multiplyToRef(W,w),w.multiplyToRef(F,w),w.invert();const A=n.e.LastCreatedEngine,t=a.TmpVectors.Jq[0];t.x=N/C*2-1,t.y=-(q/d*2-1),t.z=null!==A&&void 0!==A&&A.useReverseDepthBuffer?1:null!==A&&void 0!==A&&A.isNDCHalfZRange?0:-1;const V=a.TmpVectors.Jq[1].hd(t.x,t.y,1-1e-8),Z=a.TmpVectors.Jq[2],J=a.TmpVectors.Jq[3];a.Jq._UnprojectFromInvertedMatrixToRef(t,w,Z),a.Jq._UnprojectFromInvertedMatrixToRef(V,w,J),this.origin.U(Z),J.subtractToRef(Z,this.direction),this.direction.normalize()}}function J(N,q,C,d,U){let W=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=Z.Zero();return Q(N,q,C,d,a,U,W),a}function Q(N,q,C,d,U,W){let F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const A=N.getEngine();if(!W&&!(W=N.activeCamera))return N;const n=W.viewport,t=A.getRenderHeight(),{x:V,y:Z,width:J,height:Q}=n.toGlobal(A.getRenderWidth(),t),v=1/A.getHardwareScalingLevel();return q=q*v-V,C=C*v-(t-Z-Q),U.update(q,C,J,Q,d||a.Matrix.IdentityReadOnly,F?a.Matrix.IdentityReadOnly:W.getViewMatrix(),W.getProjectionMatrix(),w),N}function v(N,q,C,d,U){if(!A.d)return N;const W=N.getEngine();if(!U&&!(U=N.activeCamera))throw new Error("Active camera not set");const F=U.viewport,w=W.getRenderHeight(),{x:n,y:t,width:V,height:Z}=F.toGlobal(W.getRenderWidth(),w),J=a.Matrix.Identity(),Q=1/W.getHardwareScalingLevel();return q=q*Q-n,C=C*Q-(w-t-Z),d.update(q,C,V,Z,J,J,U.getProjectionMatrix()),N}function r(N,q,C,d,U,W,a,F){const w=q(d,C.enableDistantPicking),A=C.intersects(w,U,a,W,d,F);return A&&A.hit?!U&&null!=N&&A.distance>=N.distance?null:A:null}function O(N,q,C,d,U,W){let F=null;const w=!!(N.activeCameras&&N.activeCameras.length>1&&N.cameraToUseForPointers!==N.activeCamera),n=N.cameraToUseForPointers||N.activeCamera,t=V.internalPickerForMesh||r;for(let A=0;A<N.meshes.length;A++){const V=N.meshes[A];if(C){if(!C(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.Mw)continue;const Z=w&&V.isWorldMatrixCameraDependent(),J=V.Ed(Z,n);if(V.hasThinInstances&&V.nA){const N=t(F,q,V,J,!0,!0,W);if(N){if(U)return N;const w=a.TmpVectors.Matrix[1],A=V.thinInstanceGetWorldMatrices();for(let N=0;N<A.length;N++){if(C&&!C(V,N))continue;A[N].multiplyToRef(J,w);const a=t(F,q,V,w,d,U,W,!0);if(a&&(F=a,F.thinInstanceIndex=N,d))return F}}}else{const N=t(F,q,V,J,d,U,W);if(N&&(F=N,d))return F}}return F||new A.d}function K(N,q,C,d){if(!A.d)return null;const U=[],W=!!(N.activeCameras&&N.activeCameras.length>1&&N.cameraToUseForPointers!==N.activeCamera),F=N.cameraToUseForPointers||N.activeCamera,w=V.internalPickerForMesh||r;for(let A=0;A<N.meshes.length;A++){const n=N.meshes[A];if(C){if(!C(n,-1))continue}else if(!n.isEnabled()||!n.isVisible||!n.Mw)continue;const t=W&&n.isWorldMatrixCameraDependent(),V=n.Ed(t,F);if(n.hasThinInstances&&n.nA){if(w(null,q,n,V,!0,!0,d)){const N=a.TmpVectors.Matrix[1],W=n.thinInstanceGetWorldMatrices();for(let a=0;a<W.length;a++){if(C&&!C(n,a))continue;W[a].multiplyToRef(V,N);const F=w(null,q,n,N,!1,!1,d,!0);F&&(F.thinInstanceIndex=a,U.push(F))}}}else{const N=w(null,q,n,V,!1,!1,d);N&&U.push(N)}}return U}function i(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,d=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0;d||(d=N.getWorldMatrix()),q.length=C,U?q.origin.U(U):q.origin.U(N.position);const W=a.TmpVectors.Jq[2];W.set(0,0,N._scene.useRightHandedSystem?-1:1);const F=a.TmpVectors.Jq[3];return a.Jq.TransformNormalToRef(W,d,F),a.Jq.NormalizeToRef(F,q.direction),q}var I,j;Z._TmpVector3=(0,F.d)(6,a.Jq.Zero),Z._RayDistant=Z.Zero(),Z._Smallnum=1e-8,Z._Rayl=1e9,I=d.c,(j=U.b)&&(j.prototype.getForwardRay=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,q=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;return i(this,new Z(a.Jq.Zero(),a.Jq.Zero(),N),N,q,C)},j.prototype.getForwardRayToRef=function(N){return i(this,N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),I&&(t.c._IsPickingAvailable=!0,I.prototype.createPickingRay=function(N,q,C,d){return J(this,N,q,C,d,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),d.c.prototype.createPickingRayToRef=function(N,q,C,d,U){return Q(this,N,q,C,d,U,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},d.c.prototype.createPickingRayInCameraSpace=function(N,q,C){return function(N,q,C,d){const U=Z.Zero();return v(N,q,C,U,d),U}(this,N,q,C)},d.c.prototype.createPickingRayInCameraSpaceToRef=function(N,q,C,d){return v(this,N,q,C,d)},d.c.prototype.pickWithBoundingInfo=function(N,q,C,d,U){return function(N,q,C,d,U,W){if(!A.d)return null;const F=O(N,(d=>(N._tempPickingRay||(N._tempPickingRay=Z.Zero()),Q(N,q,C,d,N._tempPickingRay,W||null),N._tempPickingRay)),d,U,!0);return F&&(F.ray=J(N,q,C,a.Matrix.Identity(),W||null)),F}(this,N,q,C,d,U)},d.c.prototype.ZC=function(N,q,C,d,U,W){return function(N,q,C,d,U,W,F){const w=O(N,((d,U)=>(N._tempPickingRay||(N._tempPickingRay=Z.Zero()),Q(N,q,C,d,N._tempPickingRay,W||null,!1,U),N._tempPickingRay)),d,U,!1,F);return w&&(w.ray=J(N,q,C,a.Matrix.Identity(),W||null)),w}(this,N,q,C,d,U,W)},d.c.prototype.pickWithRay=function(N,q,C,d){return function(N,q,C,d,U){const W=O(N,(C=>(N._pickWithRayInverseMatrix||(N._pickWithRayInverseMatrix=a.Matrix.Identity()),C.invertToRef(N._pickWithRayInverseMatrix),N._cachedRayForTransform||(N._cachedRayForTransform=Z.Zero()),Z.TransformToRef(q,N._pickWithRayInverseMatrix,N._cachedRayForTransform),N._cachedRayForTransform)),C,d,!1,U);return W&&(W.ray=q),W}(this,N,q,C,d)},d.c.prototype.multiPick=function(N,q,C,d,U){return function(N,q,C,d,U,W){return K(N,(d=>J(N,q,C,d,U||null)),d,W)}(this,N,q,C,d,U)},d.c.prototype.multiPickWithRay=function(N,q,C){return function(N,q,C,d){return K(N,(C=>(N._pickWithRayInverseMatrix||(N._pickWithRayInverseMatrix=a.Matrix.Identity()),C.invertToRef(N._pickWithRayInverseMatrix),N._cachedRayForTransform||(N._cachedRayForTransform=Z.Zero()),Z.TransformToRef(q,N._pickWithRayInverseMatrix,N._cachedRayForTransform),N._cachedRayForTransform)),C,d)}(this,N,q,C)}},12803:(N,q,C)=>{"use strict";var d=C(11055),U=C(10962),W=C(11e3),a=C(11083),F=C(11032),w=C(11065);F.b.prototype._partialLoadFile=function(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(N,(N=>{C[q]=N,C._internalCount++,6===C._internalCount&&d(C)}),void 0,void 0,!0,((N,q)=>{U&&N&&U(N.status+" "+N.statusText,q)}))},F.b.prototype._cascadeLoadFiles=function(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const U=[];U._internalCount=0;for(let W=0;W<6;W++)this._partialLoadFile(C[W],W,U,q,d)},F.b.prototype._cascadeLoadImgs=function(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5?arguments[5]:void 0;const a=[];a._internalCount=0;for(let F=0;F<6;F++)this._partialLoadImg(d[F],F,a,N,q,C,U,W)},F.b.prototype._partialLoadImg=function(N,q,C,d,U,F){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7?arguments[7]:void 0;const n=(0,a.d)();(0,W.s)(N,(N=>{C[q]=N,C._internalCount++,d&&d.removePendingData(n),6===C._internalCount&&F&&F(U,C)}),((N,q)=>{d&&d.removePendingData(n),w&&w(N,q)}),d?d.offlineProvider:null,A),d&&d.addPendingData(n)},F.b.prototype.createCubeTextureBase=function(N,q,C,W){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6?arguments[6]:void 0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8],V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,v=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,r=arguments.length>14&&void 0!==arguments[14]&&arguments[14],O=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const K=J||new d.e(this,7);K.isCube=!0,K.url=N,K.generateMipMaps=!W,K._lodGenerationScale=V,K._lodGenerationOffset=Z,K._useSRGBBuffer=!!r&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!W),K!==J&&(K.label=N.substring(0,60)),this._doNotHandleContextLost||(K._extension=n,K._files=C,K._buffer=O);const i=N;this._transformTextureUrl&&!J&&(N=this._transformTextureUrl(N));const I=n??function(N){const q=N.split("?")[0],C=q.lastIndexOf(".");return C>-1?q.substring(C).toLowerCase():""}(N),j=(0,w.b)(I),l=(N,q)=>{K.dispose(),F?F(N,q):N&&U.c.Warn(N)},T=(d,F)=>{N===i?d&&l(d.status+" "+d.statusText,F):(U.c.Warn(`Failed to load ${N}, falling back to the ${i}`),this.createCubeTextureBase(i,q,C,!!W,a,l,A,n,t,V,Z,K,Q,v,r,O))};if(j)j.then((d=>{const U=N=>{Q&&Q(K,N),d.loadCubeData(N,K,t,a,((N,q)=>{l(N,q)}))};O?U(O):C&&6===C.length?d.supportCascades?this._cascadeLoadFiles(q,(N=>U(N.map((N=>new Uint8Array(N))))),C,l):l("Textures type does not support cascades."):this._loadFile(N,(N=>U(new Uint8Array(N))),void 0,void 0,!0,T)}));else{if(!C||0===C.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(q,K,((N,q)=>{v&&v(N,q)}),C,l)}return this._internalTexturesCache.push(K),K}},13331:(N,q,C)=>{"use strict";C(10962);var d=C(11259);C(11055),C(11204),C(11048),C(11304),C(11272);d.e},12825:(N,q,C)=>{"use strict";C.d(q,{b:()=>U});var d=C(11076);class U{constructor(N){this.value=this._toInt(N)}_toInt(N){return 0|N}add(N){return new U(this.value+N.value)}Qq(N){return new U(this.value-N.value)}multiply(N){return new U(Math.imul(this.value,N.value))}divide(N){return new U(this.value/N.value)}getClassName(){return U.ClassName}equals(N){return this.value===N.value}static FromValue(N){return new U(N)}toString(){return this.value.toString()}}U.ClassName="FlowGraphInteger",(0,d.h)("FlowGraphInteger",U)},12839:(N,q,C)=>{"use strict";C.d(q,{d:()=>U,h:()=>W});var d=C(11122);class U{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Vd=N}get m(){return this.Vd}transformVector(N){return this.transformVectorToRef(N,new d.Vector2)}transformVectorToRef(N,q){return q.x=N.x*this.Vd[0]+N.y*this.Vd[1],q.y=N.x*this.Vd[2]+N.y*this.Vd[3],q}zd(){return this.toArray()}toArray(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let q=0;q<4;q++)N[q]=this.Vd[q];return N}JC(N){for(let q=0;q<4;q++)this.Vd[q]=N[q];return this}multiplyToRef(N,q){const C=N.Vd,d=this.Vd,U=q.Vd;return U[0]=C[0]*d[0]+C[1]*d[2],U[1]=C[0]*d[1]+C[1]*d[3],U[2]=C[2]*d[0]+C[3]*d[2],U[3]=C[2]*d[1]+C[3]*d[3],q}multiply(N){return this.multiplyToRef(N,new U)}divideToRef(N,q){const C=this.Vd,d=N.Vd,U=q.Vd;return U[0]=C[0]/d[0],U[1]=C[1]/d[1],U[2]=C[2]/d[2],U[3]=C[3]/d[3],q}divide(N){return this.divideToRef(N,new U)}addToRef(N,q){const C=this.Vd,d=N.m,U=q.m;return U[0]=C[0]+d[0],U[1]=C[1]+d[1],U[2]=C[2]+d[2],U[3]=C[3]+d[3],q}add(N){return this.addToRef(N,new U)}subtractToRef(N,q){const C=this.Vd,d=N.m,U=q.m;return U[0]=C[0]-d[0],U[1]=C[1]-d[1],U[2]=C[2]-d[2],U[3]=C[3]-d[3],q}Qq(N){return this.subtractToRef(N,new U)}transpose(){const N=this.Vd;return new U([N[0],N[2],N[1],N[3]])}determinant(){const N=this.Vd;return N[0]*N[3]-N[1]*N[2]}inverse(){const N=this.determinant();if(0===N)throw new Error("Matrix is not invertible");const q=this.Vd,C=1/N;return new U([q[3]*C,-q[1]*C,-q[2]*C,q[0]*C])}equals(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.Vd,d=N.m;return 0===q?C[0]===d[0]&&C[1]===d[1]&&C[2]===d[2]&&C[3]===d[3]:Math.abs(C[0]-d[0])<q&&Math.abs(C[1]-d[1])<q&&Math.abs(C[2]-d[2])<q&&Math.abs(C[3]-d[3])<q}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Vd.join(", ")})`}}class W{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Vd=N}get m(){return this.Vd}transformVector(N){return this.transformVectorToRef(N,new d.Jq)}transformVectorToRef(N,q){const C=this.Vd;return q.x=N.x*C[0]+N.y*C[1]+N.z*C[2],q.y=N.x*C[3]+N.y*C[4]+N.z*C[5],q.z=N.x*C[6]+N.y*C[7]+N.z*C[8],q}multiplyToRef(N,q){const C=N.Vd,d=this.Vd,U=q.m;return U[0]=C[0]*d[0]+C[1]*d[3]+C[2]*d[6],U[1]=C[0]*d[1]+C[1]*d[4]+C[2]*d[7],U[2]=C[0]*d[2]+C[1]*d[5]+C[2]*d[8],U[3]=C[3]*d[0]+C[4]*d[3]+C[5]*d[6],U[4]=C[3]*d[1]+C[4]*d[4]+C[5]*d[7],U[5]=C[3]*d[2]+C[4]*d[5]+C[5]*d[8],U[6]=C[6]*d[0]+C[7]*d[3]+C[8]*d[6],U[7]=C[6]*d[1]+C[7]*d[4]+C[8]*d[7],U[8]=C[6]*d[2]+C[7]*d[5]+C[8]*d[8],q}multiply(N){return this.multiplyToRef(N,new W)}divideToRef(N,q){const C=this.Vd,d=N.m,U=q.m;return U[0]=C[0]/d[0],U[1]=C[1]/d[1],U[2]=C[2]/d[2],U[3]=C[3]/d[3],U[4]=C[4]/d[4],U[5]=C[5]/d[5],U[6]=C[6]/d[6],U[7]=C[7]/d[7],U[8]=C[8]/d[8],q}divide(N){return this.divideToRef(N,new W)}addToRef(N,q){const C=this.Vd,d=N.m,U=q.m;return U[0]=C[0]+d[0],U[1]=C[1]+d[1],U[2]=C[2]+d[2],U[3]=C[3]+d[3],U[4]=C[4]+d[4],U[5]=C[5]+d[5],U[6]=C[6]+d[6],U[7]=C[7]+d[7],U[8]=C[8]+d[8],q}add(N){return this.addToRef(N,new W)}subtractToRef(N,q){const C=this.Vd,d=N.m,U=q.m;return U[0]=C[0]-d[0],U[1]=C[1]-d[1],U[2]=C[2]-d[2],U[3]=C[3]-d[3],U[4]=C[4]-d[4],U[5]=C[5]-d[5],U[6]=C[6]-d[6],U[7]=C[7]-d[7],U[8]=C[8]-d[8],q}Qq(N){return this.subtractToRef(N,new W)}toArray(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let q=0;q<9;q++)N[q]=this.Vd[q];return N}zd(){return this.toArray()}JC(N){for(let q=0;q<9;q++)this.Vd[q]=N[q];return this}transpose(){const N=this.Vd;return new W([N[0],N[3],N[6],N[1],N[4],N[7],N[2],N[5],N[8]])}determinant(){const N=this.Vd;return N[0]*(N[4]*N[8]-N[5]*N[7])-N[1]*(N[3]*N[8]-N[5]*N[6])+N[2]*(N[3]*N[7]-N[4]*N[6])}inverse(){const N=this.determinant();if(0===N)throw new Error("Matrix is not invertible");const q=this.Vd,C=1/N;return new W([(q[4]*q[8]-q[5]*q[7])*C,(q[2]*q[7]-q[1]*q[8])*C,(q[1]*q[5]-q[2]*q[4])*C,(q[5]*q[6]-q[3]*q[8])*C,(q[0]*q[8]-q[2]*q[6])*C,(q[2]*q[3]-q[0]*q[5])*C,(q[3]*q[7]-q[4]*q[6])*C,(q[1]*q[6]-q[0]*q[7])*C,(q[0]*q[4]-q[1]*q[3])*C])}equals(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.Vd,d=N.m;return 0===q?C[0]===d[0]&&C[1]===d[1]&&C[2]===d[2]&&C[3]===d[3]&&C[4]===d[4]&&C[5]===d[5]&&C[6]===d[6]&&C[7]===d[7]&&C[8]===d[8]:Math.abs(C[0]-d[0])<q&&Math.abs(C[1]-d[1])<q&&Math.abs(C[2]-d[2])<q&&Math.abs(C[3]-d[3])<q&&Math.abs(C[4]-d[4])<q&&Math.abs(C[5]-d[5])<q&&Math.abs(C[6]-d[6])<q&&Math.abs(C[7]-d[7])<q&&Math.abs(C[8]-d[8])<q}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Vd.join(", ")})`}}},12844:(N,q,C)=>{"use strict";var d;function U(N,q,C,d){switch(q){case"Animation":return d?N.animations.find((N=>N.uniqueId===C))??null:N.animations[C]??null;case"AnimationGroup":return d?N.animationGroups.find((N=>N.uniqueId===C))??null:N.animationGroups[C]??null;case"Mesh":return d?N.meshes.find((N=>N.uniqueId===C))??null:N.meshes[C]??null;case"Material":return d?N.materials.find((N=>N.uniqueId===C))??null:N.materials[C]??null;case"Cn":return d?N.cameras.find((N=>N.uniqueId===C))??null:N.cameras[C]??null;case"Light":return d?N.lights.find((N=>N.uniqueId===C))??null:N.lights[C]??null;default:return null}}C.d(q,{c:()=>U}),function(N){N.Animation="Animation",N.AnimationGroup="AnimationGroup",N.Mesh="Mesh",N.Material="Material",N.Cn="Cn",N.Light="Light"}(d||(d={}))},12872:(N,q,C)=>{"use strict";C.d(q,{e:()=>U});var d=C(12874);class U extends d.c{constructor(N,q){if(super(N),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),q)for(const C of q)this._eventsSignalOutputs[C]=this._registerSignalOutput(C+"Event")}_executeOnTick(N){}_startPendingTasks(N){N._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(N),this._resetAfterCanceled(N)),this._preparePendingTasks(N),N._addPendingBlock(this),this.out._activateSignal(N),N._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(N){N._deleteExecutionVariable(this,"_initialized"),N._removePendingBlock(this)}}},12856:(N,q,C)=>{"use strict";C.d(q,{d:()=>A});var d=C(11083),U=C(11076),W=C(12861),a=C(10949),F=C(12823);class w extends W.b{constructor(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:d.defaultValue,W=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(N,q,C),this.richType=d,this._defaultValue=U,this._optional=W,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new a.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(N){this._isDisabled!==N&&(this._isDisabled=N,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(N,q){q._getConnectionValue(this)!==N&&(q._setConnectionValue(this,N),this.onValueChangedObservable.notifyObservers(N))}resetToDefaultValue(N){N._setConnectionValue(this,this._defaultValue)}connectTo(N){this._isDisabled||super.connectTo(N)}_getValueOrDefault(N){const q=N._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(q):q}getValue(N){if(1===this.connectionType){N._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(N);const q=this._getValueOrDefault(N);return this._lastValue=q,this.richType.typeTransformer?this.richType.typeTransformer(q):q}const q=this.isConnected()?this._connectedPoint[0].getValue(N):this._getValueOrDefault(N);return this._lastValue=q,this.richType.typeTransformer?this.richType.typeTransformer(q):q}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.richType={},this.richType.serialize(N.richType),N.optional=this._optional,(0,F.c)("defaultValue",this._defaultValue,N)}}(0,U.h)("FlowGraphDataConnection",w);class A{constructor(N){var q;this.config=N,this.uniqueId=(0,d.d)(),this.name=(null===(q=this.config)||void 0===q?void 0:q.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(N){}registerDataInput(N,q,C){const d=new w(N,0,this,q,C);return this.dataInputs.push(d),d}registerDataOutput(N,q,C){const d=new w(N,1,this,q,C);return this.dataOutputs.push(d),d}getDataInput(N){return this.dataInputs.find((q=>q.name===N))}getDataOutput(N){return this.dataOutputs.find((q=>q.name===N))}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.c;if(N.uniqueId=this.uniqueId,N.config={},this.config){const C=this.config,d=Object.keys(C);for(const U of d)q(U,C[U],N.config)}N.dataInputs=[],N.dataOutputs=[],N.className=this.getClassName();for(const C of this.dataInputs){const q={};C.serialize(q),N.dataInputs.push(q)}for(const C of this.dataOutputs){const q={};C.serialize(q),N.dataOutputs.push(q)}}deserialize(N){}_log(N,q,C){var d;null===(d=N.logger)||void 0===d||d.addLogItem({action:q,QC:C,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12861:(N,q,C)=>{"use strict";C.d(q,{b:()=>W});var d,U=C(11083);!function(N){N[N.Input=0]="Input",N[N.Output=1]="Output"}(d||(d={}));class W{constructor(N,q,C){this._ownerBlock=C,this._connectedPoint=[],this.uniqueId=(0,U.d)(),this.connectedPointIds=[],this.name=N,this._connectionType=q}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(N){if(this._connectionType===N._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||N._isSingularConnection()&&N._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(N),N._connectedPoint.push(this)}disconnectFrom(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=this._connectedPoint.indexOf(N),d=N._connectedPoint.indexOf(this);-1!==C&&-1!==d&&(q&&this._connectedPoint.splice(C,1),N._connectedPoint.splice(d,1))}disconnectFromAll(){for(const N of this._connectedPoint)this.disconnectFrom(N,!1);this._connectedPoint.length=0}dispose(){for(const N of this._connectedPoint)this.disconnectFrom(N)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N.uniqueId=this.uniqueId,N.name=this.name,N._connectionType=this._connectionType,N.connectedPointIds=[],N.className=this.getClassName();for(const q of this._connectedPoint)N.connectedPointIds.push(q.uniqueId)}getClassName(){return"FGConnection"}deserialize(N){this.uniqueId=N.uniqueId,this.name=N.name,this._connectionType=N._connectionType,this.connectedPointIds=N.connectedPointIds}}},12816:(N,q,C)=>{"use strict";C.d(q,{c:()=>K});var d,U=C(10949),W=C(11110),a=C(11114),F=C(11083),w=C(12823),A=C(12844),n=C(10962);!function(N){N.ExecuteBlock="ExecuteBlock",N.ExecuteEvent="ExecuteEvent",N.TriggerConnection="TriggerConnection",N.ContextVariableSet="ContextVariableSet",N.GlobalVariableSet="GlobalVariableSet",N.GlobalVariableDelete="GlobalVariableDelete",N.GlobalVariableGet="GlobalVariableGet",N.AddConnection="AddConnection",N.GetConnectionValue="GetConnectionValue",N.SetConnectionValue="SetConnectionValue",N.ActivateSignal="ActivateSignal",N.ContextVariableGet="ContextVariableGet"}(d||(d={}));class t{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(N){if(N.time||(N.time=Date.now()),this.log.push(N),this.logToConsole){var q;const C=null===(q=N.QC)||void 0===q?void 0:q.value;"object"===typeof C&&C.getClassName?n.c.Log(`[FGLog] ${N.className}:${N.uniqueId.split("-")[0]} ${N.action} - ${JSON.stringify(C.getClassName())}: ${C.toString()}`):n.c.Log(`[FGLog] ${N.className}:${N.uniqueId.split("-")[0]} ${N.action} - ${JSON.stringify(N.QC)}`)}}getItemsOfType(N){return this.log.filter((q=>q.action===N))}}class V{get enableLogging(){return this._enableLogging}set enableLogging(N){this._enableLogging!==N&&(this._enableLogging=N,this._enableLogging?(this.logger=new t,this.logger.logToConsole=!0):this.logger=null)}constructor(N){this.uniqueId=(0,F.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new U.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=N,this.assetsContext=N.assetsContext??N.vq}hasVariable(N){return N in this._userVariables}setVariable(N,q){var C;this._userVariables[N]=q,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",QC:{name:N,value:q}})}getAsset(N,q){return(0,A.c)(this.assetsContext,N,q)}getVariable(N){var q;return null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",QC:{name:N,value:this._userVariables[N]}}),this._userVariables[N]}get userVariables(){return this._userVariables}lN(){return this._configuration.vq}_getUniqueIdPrefixedName(N,q){return`${N.uniqueId}_${q}`}_getGlobalContextVariable(N,q){var C;return null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",QC:{name:N,defaultValue:q,possibleValue:this._globalContextVariables[N]}}),this._hasGlobalContextVariable(N)?this._globalContextVariables[N]:q}_setGlobalContextVariable(N,q){var C;null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",QC:{name:N,value:q}}),this._globalContextVariables[N]=q}_deleteGlobalContextVariable(N){var q;null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",QC:{name:N}}),delete this._globalContextVariables[N]}_hasGlobalContextVariable(N){return N in this._globalContextVariables}_setExecutionVariable(N,q,C){this._executionVariables[this._getUniqueIdPrefixedName(N,q)]=C}_getExecutionVariable(N,q,C){return this._hasExecutionVariable(N,q)?this._executionVariables[this._getUniqueIdPrefixedName(N,q)]:C}_deleteExecutionVariable(N,q){delete this._executionVariables[this._getUniqueIdPrefixedName(N,q)]}_hasExecutionVariable(N,q){return this._getUniqueIdPrefixedName(N,q)in this._executionVariables}_hasConnectionValue(N){return N.uniqueId in this._connectionValues}_setConnectionValue(N,q){var C;this._connectionValues[N.uniqueId]=q,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",QC:{connectionPointId:N.uniqueId,value:q}})}_setConnectionValueByKey(N,q){this._connectionValues[N]=q}_getConnectionValue(N){var q;return null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",QC:{connectionPointId:N.uniqueId,value:this._connectionValues[N.uniqueId]}}),this._connectionValues[N.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(N){this._pendingBlocks.includes(N)||(this._pendingBlocks.push(N),this._pendingBlocks.sort(((N,q)=>N.priority-q.priority)))}_removePendingBlock(N){const q=this._pendingBlocks.indexOf(N);-1!==q&&this._pendingBlocks.splice(q,1)}_clearPendingBlocks(){for(const N of this._pendingBlocks)N._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(N){var q;this.onNodeExecutedObservable.notifyObservers(N),null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:N.getClassName(),uniqueId:N.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(N){this._setGlobalContextVariable("timeSinceStart",N.timeSinceStart),this._setGlobalContextVariable("deltaTime",N.deltaTime);for(const C of this._pendingBlocks){var q;null===(q=C._executeOnTick)||void 0===q||q.call(C,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.c;N.uniqueId=this.uniqueId,N._userVariables={};for(const d in this._userVariables)q(d,this._userVariables[d],N._userVariables);N._connectionValues={};for(const d in this._connectionValues)q(d,this._connectionValues[d],N._connectionValues);var C;this.assetsContext!==this.lN()&&(N._assetsContext={meshes:this.assetsContext.meshes.map((N=>N.id)),materials:this.assetsContext.materials.map((N=>N.id)),textures:this.assetsContext.textures.map((N=>N.name)),animations:this.assetsContext.animations.map((N=>N.name)),lights:this.assetsContext.lights.map((N=>N.id)),cameras:this.assetsContext.cameras.map((N=>N.id)),zV:null===(C=this.assetsContext.zV)||void 0===C?void 0:C.map((N=>N.name)),skeletons:this.assetsContext.skeletons.map((N=>N.id)),Bt:this.assetsContext.Bt.map((N=>N.name)),geometries:this.assetsContext.geometries.map((N=>N.id)),multiMaterials:this.assetsContext.multiMaterials.map((N=>N.id)),transformNodes:this.assetsContext.transformNodes.map((N=>N.id))})}getClassName(){return"FlowGraphContext"}}(0,W.d)([(0,a.O)()],V.prototype,"uniqueId",void 0);var Z=C(12848),J=C(11401);class Q{constructor(N){this.onEventTriggeredObservable=new U.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=N,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.td.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const N=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",QC:{timeSinceStart:this._startingTime,deltaTime:N}}),this._startingTime+=N})),this._meshPickedObserver=this._scene.onPointerObservable.add((N=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",QC:N})}),J.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((N=>{const q=N.pointerId,C=N.mesh,d=this._pointerUnderMeshState[q];!d&&C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",QC:{pointerId:q,mesh:C}}):d&&!C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",QC:{pointerId:q,mesh:d}}):d&&C&&d!==C&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",QC:{pointerId:q,mesh:d,over:C}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",QC:{pointerId:q,mesh:C,out:d}})),this._pointerUnderMeshState[q]=C}),J.d.POINTERMOVE)}dispose(){var N,q,C,d,U;null===(N=this._sceneDisposeObserver)||void 0===N||N.remove(),null===(q=this._sceneReadyObserver)||void 0===q||q.remove(),null===(C=this._sceneOnBeforeRenderObserver)||void 0===C||C.remove(),null===(d=this._meshPickedObserver)||void 0===d||d.remove(),null===(U=this._meshUnderPointerObserver)||void 0===U||U.remove(),this.onEventTriggeredObservable.clear()}}var v,r=C(12863);!function(N){N[N.Stopped=0]="Stopped",N[N.Started=1]="Started"}(v||(v={}));class O{get state(){return this._state}set state(N){this._state=N,this.onStateChangedObservable.notifyObservers(N)}constructor(N){this.onStateChangedObservable=new U.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=N.vq,this._sceneEventCoordinator=new Q(this._scene),this._coordinator=N.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((N=>{for(const q of this._executionContexts){const C=this._getContextualOrder(N.type,q);for(const d of C)if(!d._executeEvent(q,N.QC))break}switch(N.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const q of this._executionContexts)q._notifyOnTick(N.QC);break;case"SceneDispose":this.dispose()}}))}createContext(){const N=new V({vq:this._scene,coordinator:this._coordinator});return this._executionContexts.push(N),N}getContext(N){return this._executionContexts[N]}addEventBlock(N){if("PointerOver"!==N.type&&"PointerOut"!==N.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==N.type&&this._eventBlocks[N.type].push(N),1===this.state)for(const q of this._executionContexts)N._startPendingTasks(q);else this.onStateChangedObservable.addOnce((q=>{if(1===q)for(const C of this._executionContexts)N._startPendingTasks(C)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((N=>{1===N&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const N of this._executionContexts)for(const q in this._eventBlocks){const C=this._getContextualOrder(q,N);for(const q of C)q._startPendingTasks(N)}}_getContextualOrder(N,q){const C=this._eventBlocks[N].sort(((N,q)=>q.initPriority-N.initPriority));if("MeshPick"===N){const N=[];for(const d of C){const U=d.asset.getValue(q);let W=0;for(;W<C.length;W++){const N=C[W].asset.getValue(q);if(U&&N&&(0,r.n)(U,N))break}N.splice(W,0,d)}return N}return C}dispose(){var N;if(0!==this.state){this.state=0;for(const N of this._executionContexts)N._clearPendingBlocks();this._executionContexts.length=0;for(const N in this._eventBlocks)this._eventBlocks[N].length=0;null===(N=this._eventObserver)||void 0===N||N.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(N){const q=[],C=new Set;for(const d in this._eventBlocks)for(const N of this._eventBlocks[d])q.push(N),C.add(N.uniqueId);for(;q.length>0;){const d=q.pop();N(d);for(const N of d.dataInputs)for(const d of N._connectedPoint)C.has(d._ownerBlock.uniqueId)||(q.push(d._ownerBlock),C.add(d._ownerBlock.uniqueId));if(d instanceof Z.d)for(const N of d.signalOutputs)for(const d of N._connectedPoint)C.has(d._ownerBlock.uniqueId)||(q.push(d._ownerBlock),C.add(d._ownerBlock.uniqueId))}}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1?arguments[1]:void 0;N.allBlocks=[],this.visitAllBlocks((q=>{const C={};q.serialize(C),N.allBlocks.push(C)})),N.executionContexts=[];for(const C of this._executionContexts){const d={};C.serialize(d,q),N.executionContexts.push(d)}}}class K{constructor(N){this.config=N,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.vq.td.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.vq.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const N=this._executeOnNextFrame.slice(0);if(N.length)for(const q of N){this.notifyCustomEvent(q.id,q.data,!1);const N=this._executeOnNextFrame.findIndex((N=>N.uniqueId===q.uniqueId));-1!==N&&this._executeOnNextFrame.splice(N,1)}}));(K.SceneCoordinators.get(this.config.vq)??[]).push(this)}createGraph(){const N=new O({vq:this.config.vq,coordinator:this});return this._flowGraphs.push(N),N}removeGraph(N){const q=this._flowGraphs.indexOf(N);-1!==q&&(N.dispose(),this._flowGraphs.splice(q,1))}start(){for(const N of this._flowGraphs)N.start()}dispose(){var N,q;for(const U of this._flowGraphs)U.dispose();this._flowGraphs.length=0,null===(N=this._disposeObserver)||void 0===N||N.remove(),null===(q=this._onBeforeRenderObserver)||void 0===q||q.remove();const C=K.SceneCoordinators.get(this.config.vq)??[],d=C.indexOf(this);-1!==d&&C.splice(d,1)}serialize(N,q){N._flowGraphs=[];for(const C of this._flowGraphs){const d={};C.serialize(d,q),N._flowGraphs.push(d)}N.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(N){let q=this._customEventsMap.get(N);return q||(q=new U.b,this._customEventsMap.set(N,q)),q}notifyCustomEvent(N,q){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:N,data:q,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(N)){const q=this._eventExecutionCounter.get(N);if(this._eventExecutionCounter.set(N,q+1),q>=K.MaxEventTypeExecutionPerFrame)return void(q===K.MaxEventTypeExecutionPerFrame&&n.c.Warn(`FlowGraphCoordinator: Too many executions of event "${N}".`))}else this._eventExecutionCounter.set(N,1);const C=this._customEventsMap.get(N);C&&C.notifyObservers(q)}}K.MaxEventsPerType=30,K.MaxEventTypeExecutionPerFrame=30,K.SceneCoordinators=new Map},12865:(N,q,C)=>{"use strict";C.d(q,{b:()=>U});var d=C(12872);class U extends d.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(N){N._notifyExecuteNode(this),this.done._activateSignal(N)}}},12848:(N,q,C)=>{"use strict";C.d(q,{d:()=>F});var d=C(12856),U=C(12861),W=C(11076);class a extends U.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(N){super.connectTo(N),this._connectedPoint.sort(((N,q)=>q.priority-N.priority))}_activateSignal(N){var q;if(null===(q=N.logger)||void 0===q||q.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,QC:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)N._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(N,this),N._increaseExecutionId();else for(const C of this._connectedPoint)C._activateSignal(N)}}(0,W.h)("FlowGraphSignalConnection",a);class F extends d.d{constructor(N){super(N),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(N){const q=new a(N,0,this);return this.signalInputs.push(q),q}_registerSignalOutput(N){const q=new a(N,1,this);return this.signalOutputs.push(q),q}_unregisterSignalInput(N){const q=this.signalInputs.findIndex((q=>q.name===N));-1!==q&&(this.signalInputs[q].dispose(),this.signalInputs.splice(q,1))}_unregisterSignalOutput(N){const q=this.signalOutputs.findIndex((q=>q.name===N));-1!==q&&(this.signalOutputs[q].dispose(),this.signalOutputs.splice(q,1))}_reportError(N,q){this.error.QC="string"===typeof q?new Error(q):q,this.error._activateSignal(N)}getSignalInput(N){return this.signalInputs.find((q=>q.name===N))}getSignalOutput(N){return this.signalOutputs.find((q=>q.name===N))}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.signalInputs=[],N.signalOutputs=[];for(const q of this.signalInputs){const C={};q.serialize(C),N.signalInputs.push(C)}for(const q of this.signalOutputs){const C={};q.serialize(C),N.signalOutputs.push(C)}}deserialize(N){for(let q=0;q<N.signalInputs.length;q++){const C=this.getSignalInput(N.signalInputs[q].name);if(!C)throw new Error("Could not find signal input with name "+N.signalInputs[q].name+" in block "+N.className);C.deserialize(N.signalInputs[q])}for(let q=0;q<N.signalOutputs.length;q++){const C=this.getSignalOutput(N.signalOutputs[q].name);if(!C)throw new Error("Could not find signal output with name "+N.signalOutputs[q].name+" in block "+N.className);C.deserialize(N.signalOutputs[q])}}getClassName(){return"FlowGraphExecutionBlock"}}},12874:(N,q,C)=>{"use strict";C.d(q,{c:()=>U});var d=C(12848);class U extends d.d{constructor(N){super(N),this.out=this._registerSignalOutput("out")}}},12831:(N,q,C)=>{"use strict";C.d(q,{A:()=>J,D:()=>Q,H:()=>z,L:()=>p,O:()=>T,Q:()=>l,b:()=>A,e:()=>V,g:()=>j,h:()=>v,l:()=>r,o:()=>O,r:()=>t,v:()=>I,w:()=>n,z:()=>Z});var d,U=C(11122),W=C(11167),a=C(12825),F=C(12839);!function(N){N.Any="any",N.String="string",N.Number="number",N.Boolean="boolean",N.Object="object",N.Integer="FlowGraphInteger",N.Vector2="Vector2",N.Jq="Jq",N.Vector4="Vector4",N.Quaternion="Quaternion",N.Matrix="Matrix",N.Matrix2D="Matrix2D",N.Matrix3D="Matrix3D",N.Oq="Oq",N.md="md"}(d||(d={}));class w{constructor(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=N,this.defaultValue=q,this.animationType=C}serialize(N){N.typeName=this.typeName,N.defaultValue=this.defaultValue}}const A=new w("any",void 0),n=new w("string",""),t=new w("number",0,0),V=new w("boolean",!1),Z=new w("Vector2",U.Vector2.Zero(),5),J=new w("Jq",U.Jq.Zero(),1),Q=new w("Vector4",U.Vector4.Zero()),v=new w("Matrix",U.Matrix.Identity(),3),r=new w("Matrix2D",new F.d),O=new w("Matrix3D",new F.h),K=new w("Oq",W.Oq.Black(),4),i=new w("md",new W.md(0,0,0,0),7),I=new w("Quaternion",U.Quaternion.Identity(),2);I.typeTransformer=N=>{if(N.getClassName){if("Vector4"===N.getClassName())return U.Quaternion.Kq(N.zd());if("Jq"===N.getClassName())return U.Quaternion.FromEulerVector(N);if("Matrix"===N.getClassName())return U.Quaternion.FromRotationMatrix(N)}return N};const j=new w("FlowGraphInteger",new a.b(0),0);function l(N){const q=N;switch(typeof N){case"string":return n;case"number":return t;case"boolean":return V;case"object":if(q.getClassName)switch(q.getClassName()){case"Vector2":return Z;case"Jq":return J;case"Vector4":return Q;case"Matrix":return v;case"Oq":return K;case"md":return i;case"Quaternion":return I;case"FlowGraphInteger":return j;case"Matrix2D":return r;case"Matrix3D":return O}return A;default:return A}}function T(N){switch(N){case"string":return n;case"number":return t;case"boolean":return V;case"Vector2":return Z;case"Jq":return J;case"Vector4":return Q;case"Matrix":return v;case"Oq":return K;case"md":return i;case"Quaternion":return I;case"FlowGraphInteger":return j;case"Matrix2D":return r;case"Matrix3D":return O;default:return A}}function z(N){switch(N){case"number":default:return 0;case"Vector2":return 5;case"Jq":return 1;case"Matrix":return 3;case"Oq":return 4;case"md":return 7;case"Quaternion":return 2}}function p(N){switch(N){case 0:return t;case 5:return Z;case 1:return J;case 3:return v;case 4:return K;case 7:return i;case 2:return I;default:return A}}},12823:(N,q,C)=>{"use strict";C.d(q,{b:()=>n,c:()=>A,g:()=>t});var d=C(11167),U=C(11122),W=C(12825),a=C(12831),F=C(12839);function w(N){return"Vector2"===N||"Jq"===N||"Vector4"===N||"Quaternion"===N||"Oq"===N||"md"===N}function A(N,q,C){var d;const U=(null===q||void 0===q||null===(d=q.getClassName)||void 0===d?void 0:d.call(q))??"";if(w(U)||function(N){return"Matrix"===N||"Matrix2D"===N||"Matrix3D"===N}(U))C[N]={value:q.zd(),className:U};else if("FlowGraphInteger"===U)C[N]={value:q.value,className:U};else if(U&&(q.id||q.name))C[N]={id:q.id,name:q.name,className:U};else{if("object"===typeof q)throw new Error(`Could not serialize value ${q}`);C[N]=q}}function n(N,q,C,A){const t=q[N];let V;const Z=(null===t||void 0===t?void 0:t.type)??(null===t||void 0===t?void 0:t.className);if(function(N){return"Mesh"===N||"AbstractMesh"===N||"GroundMesh"===N||"InstanceMesh"===N||"LinesMesh"===N||"GoldbergMesh"===N||"GreasedLineMesh"===N||"TrailMesh"===N}(Z)){let N=A.meshes.filter((N=>t.id?N.id===t.id:N.name===t.name));0===N.length&&(N=A.transformNodes.filter((N=>t.id?N.id===t.id:N.name===t.name))),V=t.uniqueId?N.find((N=>N.uniqueId===t.uniqueId)):N[0]}else if(w(Z))V=function(N,q){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===N)return U.Vector2.Kq(q);if("Jq"===N)return C&&(q[2]*=-1),U.Jq.Kq(q);if("Vector4"===N)return U.Vector4.Kq(q);if("Quaternion"===N)return C&&(q[2]*=-1,q[3]*=-1),U.Quaternion.Kq(q);if("Oq"===N)return new d.Oq(q[0],q[1],q[2]);if("md"===N)return new d.md(q[0],q[1],q[2],q[3]);throw new Error(`Unknown vector class name ${N}`)}(Z,t.value);else if(function(N){return"AnimationGroup"===N}(Z)){const N=A.animationGroups.filter((N=>N.name===t.name));V=1===N.length?N[0]:N.find((N=>N.uniqueId===t.uniqueId))}else V="Matrix"===Z?U.Matrix.Kq(t.value):"Matrix2D"===Z?new F.d(t.value):"Matrix3D"===Z?new F.h(t.value):"FlowGraphInteger"===Z?W.b.FromValue(t.value):"number"===Z||"string"===Z||"boolean"===Z?t.value[0]:t&&void 0!==t.value?t.value:Array.isArray(t)?t.reduce(((N,q)=>q.eventData?(N[q.id]={type:(0,a.O)(q.type)},"undefined"!==typeof q.value&&(N[q.id].value=n("value",q,C,A)),N):N),{}):t;return V}function t(N){return"FlowGraphJsonPointerParserBlock"===N}},12863:(N,q,C)=>{"use strict";function d(N,q){return!(!N.parent||N.parent!==q&&!d(N.parent,q))}function U(N){if(N.getClassName)return N.getClassName()}function W(N,q){return N===q&&("Vector2"===N||"Jq"===N||"Vector4"===N||"Quaternion"===N)}function a(N,q){return N===q&&("Matrix"===N||"Matrix2D"===N||"Matrix3D"===N)}function F(N,q){return"FlowGraphInteger"===N&&"FlowGraphInteger"===q}function w(N,q){const C="number"===typeof N||"number"===typeof(null===N||void 0===N?void 0:N.value);return C&&!q?!isNaN(A(N)):C}function A(N){return"number"===typeof N?N:N.value}C.d(q,{d:()=>F,e:()=>a,i:()=>W,m:()=>U,n:()=>d,q:()=>A,r:()=>w})},12235:(N,q,C)=>{"use strict";C.r(q),C.d(q,{SceneInstrumentation:()=>W});var d=C(10945),U=C(11346);class W{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(N){N!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=N,N?(this._onBeforeActiveMeshesEvaluationObserver=this.vq.onBeforeActiveMeshesEvaluationObservable.add((()=>{d.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.vq.onAfterActiveMeshesEvaluationObservable.add((()=>{d.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.vq.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.vq.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(N){N!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=N,N?(this._onBeforeRenderTargetsRenderObserver=this.vq.onBeforeRenderTargetsRenderObservable.add((()=>{d.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.vq.onAfterRenderTargetsRenderObservable.add((()=>{d.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.vq.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.vq.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(N){N!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=N,N?(this._onBeforeParticlesRenderingObserver=this.vq.onBeforeParticlesRenderingObservable.add((()=>{d.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.vq.onAfterParticlesRenderingObservable.add((()=>{d.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.vq.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.vq.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(N){N!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=N,this.vq.spriteManagers&&(N?(this._onBeforeSpritesRenderingObserver=this.vq.onBeforeSpritesRenderingObservable.add((()=>{d.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.vq.onAfterSpritesRenderingObservable.add((()=>{d.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.vq.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.vq.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(N){N!==this._capturePhysicsTime&&this.vq.onBeforePhysicsObservable&&(this._capturePhysicsTime=N,N?(this._onBeforePhysicsObserver=this.vq.onBeforePhysicsObservable.add((()=>{d.Tools.StartPerformanceCounter("cJ"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.vq.onAfterPhysicsObservable.add((()=>{d.Tools.EndPerformanceCounter("cJ"),this._physicsTime.endMonitoring()}))):(this.vq.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.vq.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(N){N!==this._captureAnimationsTime&&(this._captureAnimationsTime=N,N?this._onAfterAnimationsObserver=this.vq.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.vq.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(N){this._captureFrameTime=N}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(N){this._captureInterFrameTime=N}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(N){N!==this._captureRenderTime&&(this._captureRenderTime=N,N?(this._onBeforeDrawPhaseObserver=this.vq.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),d.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.vq.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),d.Tools.EndPerformanceCounter("Main render")}))):(this.vq.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.vq.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(N){N!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=N,N?(this._onBeforeCameraRenderObserver=this.vq.onBeforeCameraRenderObservable.add((N=>{this._cameraRenderTime.beginMonitoring(),d.Tools.StartPerformanceCounter(`Rendering camera ${N.name}`)})),this._onAfterCameraRenderObserver=this.vq.onAfterCameraRenderObservable.add((N=>{this._cameraRenderTime.endMonitoring(!1),d.Tools.EndPerformanceCounter(`Rendering camera ${N.name}`)}))):(this.vq.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.vq.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.vq.getEngine()._drawCalls}constructor(N){this.vq=N,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new U.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new U.b,this._captureFrameTime=!1,this._frameTime=new U.b,this._captureRenderTime=!1,this._renderTime=new U.b,this._captureInterFrameTime=!1,this._interFrameTime=new U.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new U.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new U.b,this._capturePhysicsTime=!1,this._physicsTime=new U.b,this._captureAnimationsTime=!1,this._animationsTime=new U.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new U.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=N.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(d.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.vq.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=N.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(d.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.nd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.nd(),this._captureParticlesRenderTime&&this._particlesRenderTime.nd(),this._captureSpritesRenderTime&&this._spritesRenderTime.nd(),this._captureRenderTime&&this._renderTime.nd(),this._captureCameraRenderTime&&this._cameraRenderTime.nd()}))}dispose(){this._disposed||(this.vq.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.vq.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.vq.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.vq.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.vq.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.vq.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.vq.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.vq.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.vq.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.vq.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.vq.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.vq.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.vq.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.vq.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.vq.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.vq.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.vq.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.vq=null,this._disposed=!0)}}},12808:(N,q,C)=>{"use strict";C.d(q,{c:()=>n});var d=C(11110),U=C(11114),W=C(11122),a=C(11549),F=C(11666),w=C(11721),A=C(11076);a.e.AddNodeConstructor("Light_Type_1",((N,q)=>()=>new n(N,W.Jq.Zero(),q)));class n extends w.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(N){this._shadowFrustumSize=N,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(N){this._shadowOrthoScale=N,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(N){this._orthoLeft=N}get orthoRight(){return this._orthoRight}set orthoRight(N){this._orthoRight=N}get orthoTop(){return this._orthoTop}set orthoTop(N){this._orthoTop=N}get orthoBottom(){return this._orthoBottom}set orthoBottom(N){this._orthoBottom=N}constructor(N,q,C){super(N,C),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=q.scale(-1),this.direction=q}getClassName(){return"LJ"}getTypeID(){return F.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(N,q,C){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(N):this._setDefaultAutoExtendShadowProjectionMatrix(N,q,C)}_setDefaultFixedFrustumShadowProjectionMatrix(N){const q=this.lN().activeCamera;q&&W.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:q.sd,void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ,N,this.lN().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(N,q,C){const d=this.lN().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const N=W.Jq.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let d=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let a=0;a<C.length;a++){const F=C[a];if(!F)continue;const w=F.getBoundingInfo().boundingBox;for(let C=0;C<w.vectorsWorld.length;C++)W.Jq.TransformCoordinatesToRef(w.vectorsWorld[C],q,N),N.x<this._orthoLeft&&(this._orthoLeft=N.x),N.y<this._orthoBottom&&(this._orthoBottom=N.y),N.x>this._orthoRight&&(this._orthoRight=N.x),N.y>this._orthoTop&&(this._orthoTop=N.y),this.autoCalcShadowZBounds&&(N.z<d&&(d=N.z),N.z>U&&(U=N.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=d,this._shadowMaxZ=U)}const U=this._orthoRight-this._orthoLeft,a=this._orthoTop-this._orthoBottom,F=void 0!==this.shadowMinZ?this.shadowMinZ:(null===d||void 0===d?void 0:d.sd)||0,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===d||void 0===d?void 0:d.maxZ)||1e4,A=this.lN().getEngine().useReverseDepthBuffer;W.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-U*this.shadowOrthoScale,this._orthoRight+U*this.shadowOrthoScale,this._orthoBottom-a*this.shadowOrthoScale,this._orthoTop+a*this.shadowOrthoScale,A?w:F,A?F:w,N,this.lN().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(N,q){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,q),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,q),this)}transferToNodeMaterialEffect(N,q){return this.computeTransformedInformation()?(N.setFloat3(q,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(N.setFloat3(q,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(N){const q=this._scene.getEngine();return!q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:1}getDepthMaxZ(N){const q=this._scene.getEngine();return q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:1}prepareLightSpecificDefines(N,q){N["DIRLIGHT"+q]=!0}}(0,d.d)([(0,U.O)()],n.prototype,"shadowFrustumSize",null),(0,d.d)([(0,U.O)()],n.prototype,"shadowOrthoScale",null),(0,d.d)([(0,U.O)()],n.prototype,"autoUpdateExtends",void 0),(0,d.d)([(0,U.O)()],n.prototype,"autoCalcShadowZBounds",void 0),(0,d.d)([(0,U.O)("orthoLeft")],n.prototype,"_orthoLeft",void 0),(0,d.d)([(0,U.O)("orthoRight")],n.prototype,"_orthoRight",void 0),(0,d.d)([(0,U.O)("orthoTop")],n.prototype,"_orthoTop",void 0),(0,d.d)([(0,U.O)("orthoBottom")],n.prototype,"_orthoBottom",void 0),(0,A.h)("BABYLON.DirectionalLight",n)},13271:(N,q,C)=>{"use strict";C.d(q,{d:()=>n});var d=C(11110),U=C(11114),W=C(11122),a=C(11167),F=C(11549),w=C(11666),A=C(11076);F.e.AddNodeConstructor("Light_Type_3",((N,q)=>()=>new n(N,W.Jq.Zero(),q)));class n extends w.c{constructor(N,q,C){super(N,C),this.groundColor=new a.Oq(0,0,0),this.direction=q||W.Jq.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"GJ"}setDirectionToTarget(N){return this.direction=W.Jq.Normalize(N.Qq(W.Jq.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(N,q){const C=W.Jq.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",C.x,C.y,C.z,0,q),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.OF),q),this}transferToNodeMaterialEffect(N,q){const C=W.Jq.Normalize(this.direction);return N.setFloat3(q,C.x,C.y,C.z),this}Ed(){return this._worldMatrix||(this._worldMatrix=W.Matrix.Identity()),this._worldMatrix}getTypeID(){return w.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(N,q){N["HEMILIGHT"+q]=!0}}(0,d.d)([(0,U.o)()],n.prototype,"groundColor",void 0),(0,d.d)([(0,U.N)()],n.prototype,"direction",void 0),(0,A.h)("BABYLON.HemisphericLight",n)},12786:(N,q,C)=>{"use strict";C.d(q,{d:()=>t});var d=C(11110),U=C(11114),W=C(11122),a=C(11549),F=C(11666),w=C(11721),A=C(11101),n=C(11076);a.e.AddNodeConstructor("Light_Type_2",((N,q)=>()=>new t(N,W.Jq.Zero(),W.Jq.Zero(),0,0,q)));class t extends w.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(N){this._iesProfileTexture!==N&&(this._iesProfileTexture=N,this._iesProfileTexture&&t._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(N){this._angle=N,this._cosHalfAngle=Math.cos(.5*N),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(N){this._innerAngle=N,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(N){this._shadowAngleScale=N,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(N){this._projectionTextureLightNear=N,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(N){this._projectionTextureLightFar=N,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(N){this._projectionTextureUpDirection=N,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(N){this._projectionTexture!==N&&(this._projectionTexture=N,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(t._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):t._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(N){return void 0!==N.onGeneratedObservable}static _IsTexture(N){return void 0!==N.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(N){this._projectionTextureProjectionLightMatrix=N,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(N,q,C,d,U,a){super(N,a),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=W.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=W.Jq.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=W.Jq.Zero(),this._projectionTextureViewLightMatrix=W.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=W.Matrix.Zero(),this._projectionTextureScalingMatrix=W.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=q,this.direction=C,this.angle=d,this.exponent=U}getClassName(){return"SpotLight"}getTypeID(){return F.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(N){super._setDirection(N),this._projectionTextureViewLightDirty=!0}_setPosition(N){super._setPosition(N),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(N,q,C){const d=this.lN().activeCamera;if(!d)return;this._shadowAngleScale=this._shadowAngleScale||1;const U=this._shadowAngleScale*this._angle,a=void 0!==this.shadowMinZ?this.shadowMinZ:d.sd,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,w=this.lN().getEngine().useReverseDepthBuffer;W.Matrix.PerspectiveFovLHToRef(U,1,w?F:a,w?a:F,N,!0,this._scene.getEngine().isNDCHalfZRange,void 0,w)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),W.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const N=this.projectionTextureLightFar,q=this.projectionTextureLightNear,C=N/(N-q),d=-C*q,U=1/Math.tan(this._angle/2);W.Matrix.FromValuesToRef(U/1,0,0,0,0,U,0,0,0,0,C,1,0,0,d,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof A.c){const N=this._projectionTexture.uScale/2,q=this._projectionTexture.vScale/2;W.Matrix.FromValuesToRef(N,0,0,0,0,q,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(N,q){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),N.setMatrix("textureProjectionMatrix"+q,this._projectionTextureMatrix),N.setTexture("projectionLightTexture"+q,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&N.setTexture("iesLightTexture"+q,this._iesProfileTexture),this}transferToEffect(N,q){let C;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,q),C=W.Jq.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,q),C=W.Jq.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",C.x,C.y,C.z,this._cosHalfAngle,q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,q),this}transferToNodeMaterialEffect(N,q){let C;return C=this.computeTransformedInformation()?W.Jq.Normalize(this.transformedDirection):W.Jq.Normalize(this.direction),this.lN().useRightHandedSystem?N.setFloat3(q,-C.x,-C.y,-C.z):N.setFloat3(q,C.x,C.y,C.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(N){const q=this._scene.getEngine(),C=void 0!==this.shadowMinZ?this.shadowMinZ:(null===N||void 0===N?void 0:N.sd)??0;return q.useReverseDepthBuffer&&q.isNDCHalfZRange?C:this._scene.getEngine().isNDCHalfZRange?0:C}getDepthMaxZ(N){const q=this._scene.getEngine(),C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===N||void 0===N?void 0:N.maxZ)??1e4;return q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:C}prepareLightSpecificDefines(N,q){N["SPOTLIGHT"+q]=!0,N["PROJECTEDLIGHTTEXTURE"+q]=!(!this.projectionTexture||!this.projectionTexture.isReady()),N["IESLIGHTTEXTURE"+q]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,d.d)([(0,U.O)()],t.prototype,"angle",null),(0,d.d)([(0,U.O)()],t.prototype,"innerAngle",null),(0,d.d)([(0,U.O)()],t.prototype,"shadowAngleScale",null),(0,d.d)([(0,U.O)()],t.prototype,"exponent",void 0),(0,d.d)([(0,U.O)()],t.prototype,"projectionTextureLightNear",null),(0,d.d)([(0,U.O)()],t.prototype,"projectionTextureLightFar",null),(0,d.d)([(0,U.O)()],t.prototype,"projectionTextureUpDirection",null),(0,d.d)([(0,U.I)("projectedLightTexture")],t.prototype,"_projectionTexture",void 0),(0,n.h)("BABYLON.SpotLight",t)},12499:(N,q,C)=>{"use strict";C.d(q,{b:()=>a,e:()=>W,i:()=>F});const d={},U={};function W(N,q){d[N]=q}function a(N,q){U[N]=q}function F(N){return U[N]?U[N]:null}},12399:(N,q,C)=>{"use strict";C.d(q,{d:()=>l,h:()=>e});var d,U=C(10945),W=C(10949),a=C(11364),F=C(10995),w=C(10962),A=C(11588),n=C(11e3),t=C(11009),V=C(11083),Z=C(11032),J=C(10992);!function(N){N[N.Clean=0]="Clean",N[N.Stop=1]="Stop",N[N.Sync=2]="Sync",N[N.NoSync=3]="NoSync"}(d||(d={}));const Q=new W.b,v={};let r=!1;function O(){return v[".babylon"]}function K(N,q){const C=v[N];return C||(w.c.Warn("Unable to find a plugin to load "+N+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),q?O():void 0)}function i(N,q,C){let d="Unable to load from "+(N.rawData?"binary data":N.url);return q?d+=`: ${q}`:C&&(d+=`: ${C}`),d}async function I(N,q,C,d,U,W,a,F,w){var A;const t="data:"===(V=N.url).substring(0,5)?V.substring(5):null;var V;if(N.rawData&&!a)throw"When using ArrayBufferView to load data the file extension must be provided.";const r=t||a?"":function(N){const q=N.indexOf("?");-1!==q&&(N=N.substring(0,q));const C=N.lastIndexOf(".");return N.substring(C,N.length).toLowerCase()}(N.url);let i=a?K(a,!0):t?function(N){for(const q in v){const C=v[q].plugin;if(C.canDirectLoad&&C.canDirectLoad(N))return v[q]}return O()}(N.url):K(r,!1);if(!i&&r){if(N.url&&!N.url.startsWith("blob:")){const q=await async function(N,q){const C=q.method||"GET";return await new Promise(((d,U)=>{const W=new J.e;W.addEventListener("readystatechange",(()=>{if(4==W.readyState)if(200==W.status){const N={};if(q.responseHeaders)for(const C of q.responseHeaders)N[C]=W.getResponseHeader(C)||"";d({response:W.response,headerValues:N})}else U(`Unable to fetch data from ${N}. Error code: ${W.status}`)})),W.open(C,N),W.send()}))}(N.url,{method:"HEAD",responseHeaders:["Content-Type"]}),C=q.headerValues?q.headerValues["Content-Type"]:"";C&&(i=function(N){for(const q in v){const C=v[q];if(C.mimeType===N)return C}}(C))}i||(i=O())}if(!i)throw new Error(`No plugin or fallback for ${a??N.url}`);if(!1===(null===w||void 0===w||null===(A=w[i.plugin.name])||void 0===A?void 0:A.enabled))throw new Error(`The '${i.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(N.rawData&&!i.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(N=>{if(i.plugin.createPlugin){const q=i.plugin.createPlugin(w??{});return q instanceof Promise?(q.then(N).catch((N=>{U("Error instantiating plugin.",N)})),null):(N(q),q)}return N(i.plugin),i.plugin})((w=>{var A;if(!w)throw`The loader plugin corresponding to the '${a}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(Q.notifyObservers(w),t&&(w.canDirectLoad&&w.canDirectLoad(N.url)||!(0,n.j)(N.url))){if(w.directLoad){const N=w.directLoad(q,t);N instanceof Promise?N.then((N=>{C(w,N)})).catch((N=>{U("Error in directLoad of _loadData: "+N,N)})):C(w,N)}else C(w,t);return}const V=i.isBinary,J=(N,d)=>{q.A?U("Scene has been disposed"):C(w,N,d)};let v=null,r=!1;null===(A=w.td)||void 0===A||A.add((()=>{r=!0,v&&(v.abort(),v=null),W()}));const O=()=>{if(r)return;const C=(N,q)=>{U(null===N||void 0===N?void 0:N.statusText,q)};if(!w.loadFile&&N.rawData)throw"Plugin does not support loading ArrayBufferView.";v=w.loadFile?w.loadFile(q,N.rawData||N.file||N.url,N.rootUrl,J,d,V,C,F):q._loadFile(N.file||N.url,J,d,!0,V,C)},K=q.getEngine();let I=K.enableOfflineSupport;if(I){let C=!1;for(const d of q.disableOfflineSupportExceptionRules)if(d.test(N.url)){C=!0;break}I=!C}I&&Z.b.OfflineProviderFactory?q.offlineProvider=Z.b.OfflineProviderFactory(N.url,O,K.disableManifestCheck):O()}))}function j(N,q){let C,d,W=null,a=null;if(q)if(q.name)C=`file:${q.name}`,d=q.name,W=q;else if(ArrayBuffer.isView(q))C="",d=(0,V.d)(),a=q;else if(q.startsWith("data:"))C=q,d="";else if(N){const W=q;if("/"===W.substring(0,1))return U.Tools.Error("Wrong sceneFilename parameter"),null;C=N+W,d=W}else C=q,d=U.Tools.GetFilename(q),N=U.Tools.GetFolderPath(q);else C=N,d=U.Tools.GetFilename(N),N=U.Tools.GetFolderPath(N);return{url:C,rootUrl:N,name:d,file:W,rawData:a}}function l(N){if("string"===typeof N.extensions){const q=N.extensions;v[q.toLowerCase()]={plugin:N,isBinary:!1}}else{const q=N.extensions,C=Object.keys(q);for(const d of C)v[d.toLowerCase()]={plugin:N,isBinary:q[d].isBinary,mimeType:q[d].mimeType}}}async function T(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:F.e.LastCreatedScene,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!d)return w.c.Error("No scene available to import mesh to"),null;const Z=j(q,C);if(!Z)return null;const J={};d.addPendingData(J);const Q=()=>{d.removePendingData(J)},v=(N,q)=>{const C=i(Z,N,q);a?a(d,C,new t.h(C,t.e.SceneLoaderError,q)):w.c.Error(C),Q()},r=W?N=>{try{W(N)}catch(q){v("Error in onProgress callback: "+q,q)}}:void 0,O=(N,q,C,W,a,F,w,A)=>{if(d.importedMeshesFiles.push(Z.url),U)try{U(N,q,C,W,a,F,w,A)}catch(n){v("Error in onSuccess callback: "+n,n)}d.removePendingData(J)};return await I(Z,d,((q,C,U)=>{if(q.rewriteRootURL&&(Z.rootUrl=q.rewriteRootURL(Z.rootUrl,U)),q.importMesh){const U=[],W=[],a=[];if(!q.importMesh(N,d,C,Z.rootUrl,U,W,a,v))return;d.loadingPluginName=q.name,O(U,W,a,[],[],[],[],[])}else{q.importMeshAsync(N,d,C,Z.rootUrl,r,Z.name).then((N=>{d.loadingPluginName=q.name,O(N.meshes,N.Bt,N.skeletons,N.animationGroups,N.transformNodes,N.geometries,N.lights,N.spriteManagers)})).catch((N=>{v(N.message,N)}))}}),r,v,Q,A,n,V)}async function z(N,q,C,d,U,W,a,F){return await new Promise(((w,A)=>{try{T(N,q,C,d,((N,q,C,d,U,W,a,F)=>{w({meshes:N,Bt:q,skeletons:C,animationGroups:d,transformNodes:U,geometries:W,lights:a,spriteManagers:F})}),U,((N,q,C)=>{A(C||new Error(q))}),W,a,F).catch(A)}catch(t){A(t)}}))}async function p(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.e.LastCreatedEngine,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};C?await X(N,q,new a.c(C),d,W,w,A,n,t):U.Tools.Error("No engine available")}async function s(N,q,C,d,U,W,a){return await new Promise(((F,w)=>{p(N,q,C,(N=>{F(N)}),d,((N,q,C)=>{w(C||new Error(q))}),U,W,a)}))}async function X(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.e.LastCreatedScene,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return w.c.Error("No scene available to append to"),null;const Z=j(N,q);if(!Z)return null;const J={};C.addPendingData(J);const Q=()=>{C.removePendingData(J)};A.e.ShowLoadingScreen&&!r&&(r=!0,C.getEngine().displayLoadingUI(),C.executeWhenReady((()=>{C.getEngine().hideLoadingUI(),r=!1})));const v=(N,q)=>{const d=i(Z,N,q);W?W(C,d,new t.h(d,t.e.SceneLoaderError,q)):w.c.Error(d),Q()},O=U?N=>{try{U(N)}catch(q){v("Error in onProgress callback",q)}}:void 0,K=()=>{if(d)try{d(C)}catch(N){v("Error in onSuccess callback",N)}C.removePendingData(J)};return await I(Z,C,((N,q)=>{if(N.load){if(!N.load(C,q,Z.rootUrl,v))return;C.loadingPluginName=N.name,K()}else{N.loadAsync(C,q,Z.rootUrl,O,Z.name).then((()=>{C.loadingPluginName=N.name,K()})).catch((N=>{v(N.message,N)}))}}),O,v,Q,a,n,V)}async function P(N,q,C,d,U,W,a){return await new Promise(((F,w)=>{try{X(N,q,C,(N=>{F(N)}),d,((N,q,C)=>{w(C||new Error(q))}),U,W,a).catch(w)}catch(t){w(t)}}))}async function M(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.e.LastCreatedScene,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return w.c.Error("No scene available to load asset container to"),null;const V=j(N,q);if(!V)return null;const Z={};C.addPendingData(Z);const J=()=>{C.removePendingData(Z)},Q=(N,q)=>{const d=i(V,N,q);W?W(C,d,new t.h(d,t.e.SceneLoaderError,q)):w.c.Error(d),J()},v=U?N=>{try{U(N)}catch(q){Q("Error in onProgress callback",q)}}:void 0,r=N=>{if(d)try{d(N)}catch(q){Q("Error in onSuccess callback",q)}C.removePendingData(Z)};return await I(V,C,((N,q)=>{if(N.loadAssetContainer){const d=N.loadAssetContainer(C,q,V.rootUrl,Q);if(!d)return;d.populateRootNodes(),C.loadingPluginName=N.name,r(d)}else if(N.loadAssetContainerAsync){N.loadAssetContainerAsync(C,q,V.rootUrl,v,V.name).then((q=>{q.populateRootNodes(),C.loadingPluginName=N.name,r(q)})).catch((N=>{Q(N.message,N)}))}else Q("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),v,Q,J,a,A,n)}async function Y(N,q,C,d,U,W,a){return await new Promise(((F,w)=>{try{M(N,q,C,(N=>{F(N)}),d,((N,q,C)=>{w(C||new Error(q))}),U,W,a).catch(w)}catch(t){w(t)}}))}async function E(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.e.LastCreatedScene,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,V=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!C)return void w.c.Error("No scene available to load animations to");if(d){for(const d of C.animatables)d.reset();C.stopAllAnimations();const N=C.animationGroups.slice();for(const C of N)C.dispose();const q=C.getNodes();for(const C of q)C.animations&&(C.animations=[])}else switch(U){case 0:const N=C.animationGroups.slice();for(const q of N)q.dispose();break;case 1:for(const q of C.animationGroups)q.stop();break;case 2:for(const q of C.animationGroups)q.reset(),q.restart();break;case 3:break;default:return void w.c.Error("Unknown animation group loading mode value '"+U+"'")}const J=C.animatables.length;await M(N,q,C,(N=>{N.mergeAnimationsTo(C,C.animatables.slice(J),W),N.dispose(),C.onAnimationFileImportedObservable.notifyObservers(C),a&&a(C)}),A,n,t,V,Z)}async function H(N,q,C,d,U,W,a,F,w,A){return await new Promise(((n,V)=>{try{E(N,q,C,d,U,W,(N=>{n(N)}),a,((N,q,C)=>{V(C||new Error(q))}),F,w,A).catch(V)}catch(t){V(t)}}))}class e{static get ForceFullSceneLoadingForIncremental(){return A.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(N){A.e.ForceFullSceneLoadingForIncremental=N}static get ShowLoadingScreen(){return A.e.ShowLoadingScreen}static set ShowLoadingScreen(N){A.e.ShowLoadingScreen=N}static get loggingLevel(){return A.e.loggingLevel}static set loggingLevel(N){A.e.loggingLevel=N}static get CleanBoneMatrixWeights(){return A.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(N){A.e.CleanBoneMatrixWeights=N}static GetDefaultPlugin(){return O()}static GetPluginForExtension(N){var q;return null===(q=K(N,!0))||void 0===q?void 0:q.plugin}static IsPluginForExtensionAvailable(N){return function(N){return!!v[N]}(N)}static RegisterPlugin(N){l(N)}static ImportMesh(N,q,C,d,U,W,a,w,A){T(N,q,C,d,U,W,a,w,A).catch((N=>null===a||void 0===a?void 0:a(F.e.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async ImportMeshAsync(N,q,C,d,U,W,a){return await z(N,q,C,d,U,W,a)}static Load(N,q,C,d,U,W,a,w){p(N,q,C,d,U,W,a,w).catch((N=>null===W||void 0===W?void 0:W(F.e.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async LoadAsync(N,q,C,d,U,W){return await s(N,q,C,d,U,W)}static Append(N,q,C,d,U,W,a,w){X(N,q,C,d,U,W,a,w).catch((N=>null===W||void 0===W?void 0:W(C??F.e.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async AppendAsync(N,q,C,d,U,W){return await P(N,q,C,d,U,W)}static LoadAssetContainer(N,q,C,d,U,W,a,w){M(N,q,C,d,U,W,a,w).catch((N=>null===W||void 0===W?void 0:W(C??F.e.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async LoadAssetContainerAsync(N,q,C,d,U,W){return await Y(N,q,C,d,U,W)}static ImportAnimations(N,q,C,d,U,W,a,w,A,n,t){E(N,q,C,d,U,W,a,w,A,n,t).catch((N=>null===A||void 0===A?void 0:A(C??F.e.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async ImportAnimationsAsync(N,q,C,d,U,W,a,F,w,A,n){return await H(N,q,C,d,U,W,F,A,n)}}e.NO_LOGGING=0,e.MINIMAL_LOGGING=1,e.SUMMARY_LOGGING=2,e.DETAILED_LOGGING=3,e.OnPluginActivatedObservable=Q},12800:(N,q,C)=>{"use strict";C.d(q,{d:()=>V});var d=C(11110),U=C(11114),W=C(10945),a=C(11122),F=C(11149),w=C(11101),A=C(11076),n=C(10949),t=C(11155);C(12803);class V extends F.d{set boundingBoxSize(N){if(this._boundingBoxSize&&this._boundingBoxSize.equals(N))return;this._boundingBoxSize=N;const q=this.lN();q&&q.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(N){this._rotationY=N,this.setReflectionTextureMatrix(a.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(N,q,C){let d="";for(const U of N)d+=U;return new V(d,q,null,C,N)}static CreateFromPrefilteredData(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const U=q.useDelayedTextureLoading;q.useDelayedTextureLoading=!1;const W=new V(N,q,null,!1,null,null,null,void 0,!0,C,d);return q.useDelayedTextureLoading=U,W}constructor(N,q){var C;let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,V=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,J=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,v=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,r=arguments.length>13?arguments[13]:void 0,O=arguments.length>14?arguments[14]:void 0;super(q),this.onLoadObservable=new n.b,this.boundingBoxPosition=a.Jq.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new a.Matrix,this._buffer=null,this.name=N,this.url=N,this._noMipmap=U,this.pd=!1,this.isCube=!0,this._textureMatrix=a.Matrix.Identity(),this.coordinatesMode=w.c.CUBIC_MODE;let K=null,i=null;null===d||Array.isArray(d)?(this._noMipmap=U,this._format=t,this._createPolynomials=J,K=d,this._loaderOptions=r,this._useSRGBBuffer=O,this._lodScale=Q,this._lodOffset=v):(K=d.extensions??null,this._noMipmap=d.noMipmap??!1,W=d.files??null,i=d.buffer??null,this._format=d.format??5,V=d.prefiltered??!1,Z=d.forcedExtension??null,this._createPolynomials=d.createPolynomials??!1,this._lodScale=d.lodScale??.8,this._lodOffset=d.lodOffset??0,this._loaderOptions=d.loaderOptions,this._useSRGBBuffer=d.useSRGBBuffer,F=d.R??null,A=d.onError??null),(N||W)&&this.updateURL(N,Z,F,V,A,K,null===(C=this.lN())||void 0===C?void 0:C.useDelayedTextureLoading,W,i)}getClassName(){return"CubeTexture"}updateURL(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=N),this.url=N,q&&(this._forcedExtension=q);const A=N.lastIndexOf("."),n=q||(A>-1?N.substring(A).toLowerCase():""),t=0===n.indexOf(".dds"),V=0===n.indexOf(".env"),Z=0===n.indexOf(".basis");if(V?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=d,d&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),F)this._files=F;else if(Z||V||t||W||(W=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,W){for(let q=0;q<W.length;q++)this._files.push(N+W[q]);this._extensions=W}this._buffer=w,a?(this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=U):this._loadTexture(C,U)}delayLoad(N){4===this.delayLoadState&&(N&&(this._forcedExtension=N),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(N){var q,C;if(N.updateFlag===this._textureMatrix.updateFlag)return;N.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(C=this.lN())||void 0===C||C.markAllMaterialsAsDirty(1,(N=>-1!==N.getActiveTextures().indexOf(this))));if(this._textureMatrix=N,null===(q=this.lN())||void 0===q||!q.useRightHandedSystem)return;const d=a.TmpVectors.Jq[0],U=a.TmpVectors.Quaternion[0],W=a.TmpVectors.Jq[1];this._textureMatrix.decompose(d,U,W),U.z*=-1,U.w*=-1,a.Matrix.ComposeToRef(d,U,W,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var N;return null!==(N=this.lN())&&void 0!==N&&N.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this.lN(),d=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const U=()=>{var q;(this.onLoadObservable.notifyObservers(this),d)&&(d.dispose(),null===(q=this.lN())||void 0===q||q.markAllMaterialsAsDirty(1));N&&N()},a=(N,C)=>{this._loadingError=!0,this._errorObject={message:N,exception:C},q&&q(N,C),w.c.OnTextureLoadErrorObservable.notifyObservers(this)};var F;this._texture?this._texture.isReady?W.Tools.SetImmediate((()=>U())):this._texture.onLoadedObservable.add((()=>U())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,C,this._lodScale,this._lodOffset,N,a,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,C,this._files,this._noMipmap,N,a,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(F=this._texture)||void 0===F||F.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(N,q,C){const d=t.d.Parse((()=>{let d=!1;return N.prefiltered&&(d=N.prefiltered),new V(C+(N.url??N.name),q,N.extensions,!1,N.files||null,null,null,void 0,d,N.forcedExtension)}),N,q);if(N.boundingBoxPosition&&(d.boundingBoxPosition=a.Jq.Kq(N.boundingBoxPosition)),N.boundingBoxSize&&(d.boundingBoxSize=a.Jq.Kq(N.boundingBoxSize)),N.animations)for(let U=0;U<N.animations.length;U++){const q=N.animations[U],C=(0,A.e)("BABYLON.Animation");C&&d.animations.push(C.Parse(q))}return d}clone(){let N=0;const q=t.d.Clone((()=>{const q=new V(this.url,this.lN()||this._getEngine(),this._extensions,this._noMipmap,this._files);return N=q.uniqueId,q}),this);return q.uniqueId=N,q}}(0,d.d)([(0,U.O)()],V.prototype,"url",void 0),(0,d.d)([(0,U.N)()],V.prototype,"boundingBoxPosition",void 0),(0,d.d)([(0,U.N)()],V.prototype,"boundingBoxSize",null),(0,d.d)([(0,U.O)("rotationY")],V.prototype,"rotationY",null),(0,d.d)([(0,U.O)("files")],V.prototype,"_files",void 0),(0,d.d)([(0,U.O)("forcedExtension")],V.prototype,"_forcedExtension",void 0),(0,d.d)([(0,U.O)("extensions")],V.prototype,"_extensions",void 0),(0,d.d)([(0,U.w)("textureMatrix")],V.prototype,"_textureMatrix",void 0),(0,d.d)([(0,U.w)("textureMatrixRefraction")],V.prototype,"_textureMatrixRefraction",void 0),w.c._CubeTextureParser=V.Parse,(0,A.h)("BABYLON.CubeTexture",V)},13282:(N,q,C)=>{"use strict";C.d(q,{c:()=>w});var d=C(10962),U=C(11101),W=C(11092),a=C(11266),F=C(11055);a.ThinEngine.prototype.createDynamicTexture=function(N,q,C,d){const U=new F.e(this,4);return U.baseWidth=N,U.baseHeight=q,C&&(N=this.needPOTTextures?(0,W.h)(N,this._caps.maxTextureSize):N,q=this.needPOTTextures?(0,W.h)(q,this._caps.maxTextureSize):q),U.width=N,U.height=q,U.isReady=!1,U.generateMipMaps=C,U.samplingMode=d,this.updateTextureSamplingMode(d,U),this._internalTexturesCache.push(U),U},a.ThinEngine.prototype.updateDynamicTexture=function(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,W=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!N)return;const a=this._gl,F=a.TEXTURE_2D,w=this._bindTextureDirectly(F,N,!0,W);this._unpackFlipY(void 0===C?N.invertY:C),d&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const A=this._getWebGLTextureType(N.type),n=this._getInternalFormat(U||N.format),t=this._getRGBABufferInternalSizedFormat(N.type,n);a.texImage2D(F,0,t,n,A,q),N.generateMipMaps&&a.generateMipmap(F),w||this._bindTextureDirectly(F,null),d&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),U&&(N.format=U),N._dynamicTextureSource=q,N._premulAlpha=d,N.invertY=C||!1,N.isReady=!0};class w extends U.c{constructor(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,F=arguments.length>6?arguments[6]:void 0;const w=!C||C._isScene;super(null,w?C:null===C||void 0===C?void 0:C.vq,w?!d:C,F,W,void 0,void 0,void 0,void 0,a),this.name=N,this.wrapU=U.c.CLAMP_ADDRESSMODE,this.wrapV=U.c.CLAMP_ADDRESSMODE,this._generateMipMaps=d;const A=this._getEngine();if(!A)return;if(q.getContext)this._canvas=q,this._ownCanvas=!1,this._texture=A.createDynamicTexture(this._canvas.width,this._canvas.height,d,W);else{this._canvas=A.createCanvas(1,1),this._ownCanvas=!0;const N=q;N.width||0===N.width?this._texture=A.createDynamicTexture(N.width,N.height,d,W):this._texture=A.createDynamicTexture(q,q,d,W)}const n=this.getSize();this._canvas.width!==n.width&&(this._canvas.width=n.width),this._canvas.height!==n.height&&(this._canvas.height=n.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(N){this._canvas.width=N.width,this._canvas.height=N.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(N.width,N.height,this._generateMipMaps,this.samplingMode)}scale(N){const q=this.getSize();q.width*=N,q.height*=N,this._recreate(q)}scaleTo(N,q){const C=this.getSize();C.width=N,C.height=q,this._recreate(C)}getContext(){return this._context}clear(N){const q=this.getSize();N&&(this._context.fillStyle=N),this._context.clearRect(0,0,q.width,q.height)}update(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===N||N,q,this._format||void 0,void 0,C)}drawText(N,q,C,d,U,W,a){let F=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const w=this.getSize();if(W&&(this._context.fillStyle=W,this._context.fillRect(0,0,w.width,w.height)),this._context.font=d,null===q||void 0===q){const C=this._context.measureText(N);q=(w.width-C.width)/2}if(null===C||void 0===C){const N=parseInt(d.replace(/\D/g,""));C=w.height/2+N/3.65}this._context.fillStyle=U||"",this._context.fillText(N,q,C),F&&this.update(a)}dispose(){var N,q;(super.dispose(),this._ownCanvas)&&(null===(N=this._canvas)||void 0===N||null===(q=N.remove)||void 0===q||q.call(N));this._canvas=null,this._context=null}clone(){const N=this.lN();if(!N)return this;const q=this.getSize(),C=new w(this.name,q,N,this._generateMipMaps);return C.pd=this.pd,C.level=this.level,C.wrapU=this.wrapU,C.wrapV=this.wrapV,C}serialize(){const N=this.lN();N&&!N.isReady()&&d.c.Warn("The scene must be ready before serializing the dynamic texture");const q=super.serialize();return w._IsCanvasElement(this._canvas)&&(q.base64String=this._canvas.toDataURL()),q.invertY=this._invertY,q.samplingMode=this.samplingMode,q}static _IsCanvasElement(N){return void 0!==N.toDataURL}_rebuild(){this.update()}}},12717:(N,q,C)=>{"use strict";C.d(q,{d:()=>U});var d=C(11101);class U extends d.c{get depth(){return this._depth}constructor(N,q,C,U,W,a){let F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],w=arguments.length>7&&void 0!==arguments[7]&&arguments[7],A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:d.c.TRILINEAR_SAMPLINGMODE,n=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,t=arguments.length>10?arguments[10]:void 0;super(null,a,!F,w),this.format=W,this._texture=a.getEngine().createRawTexture2DArray(N,q,C,U,W,F,w,A,null,n,t),this._depth=U,this.is2DArray=!0}update(N){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,N,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(N,q,C,d,W){return new U(N,q,C,d,5,W,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12515:(N,q,C)=>{"use strict";C.d(q,{c:()=>F,g:()=>w,i:()=>W,k:()=>a});var d=C(11142),U=C(11122);function W(N,q){return`{X: ${N.x.toFixed(q)} Y: ${N.y.toFixed(q)}}`}function a(N,q){return`{X: ${N._x.toFixed(q)} Y: ${N._y.toFixed(q)} Z: ${N._z.toFixed(q)}}`}function F(N,q){return 2*Math.acos((0,d.Clamp)(U.Quaternion.Dot(N,q)))}function w(N,q){const C=new U.Quaternion;return function(N,q,C){const W=U.Jq.Cross(N,q),a=Math.acos((0,d.Clamp)(U.Jq.Dot(N,q),-1,1));U.Quaternion.RotationAxisToRef(W,a,C)}(N,q,C),C}},12353:(N,q,C)=>{"use strict";C.d(q,{e:()=>A});var d=C(11122),U=C(11167),W=C(11571),a=C(11561),F=C(11177);C(12358);function w(N){let q=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const C=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],W=[];let w=[];const A=N.width||N.size||1,n=N.height||N.size||1,t=N.depth||N.size||1,V=N.wrap||!1;let Z=void 0===N.topBaseAt?1:N.topBaseAt,J=void 0===N.bottomBaseAt?0:N.bottomBaseAt;Z=(Z+4)%4,J=(J+4)%4;let Q=[2,0,3,1][Z],v=[2,0,1,3][J],r=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(V){q=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],r=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let N=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],C=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const d=[17,18,19,16],U=[22,23,20,21];for(;Q>0;)N.unshift(N.pop()),d.unshift(d.pop()),Q--;for(;v>0;)C.unshift(C.pop()),U.unshift(U.pop()),v--;N=N.flat(),C=C.flat(),r=r.concat(N).concat(C),q.push(d[0],d[2],d[3],d[0],d[1],d[2]),q.push(U[0],U[2],U[3],U[0],U[1],U[2])}const O=[A/2,n/2,t/2];w=r.reduce(((N,q,C)=>N.concat(q*O[C%3])),[]);const K=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE,i=N.faceUV||new Array(6),I=N.faceColors,j=[];for(let a=0;a<6;a++)void 0===i[a]&&(i[a]=new d.Vector4(0,0,1,1)),I&&void 0===I[a]&&(I[a]=new U.md(1,1,1,1));for(let d=0;d<6;d++)if(W.push(i[d].z,F.d?1-i[d].w:i[d].w),W.push(i[d].x,F.d?1-i[d].w:i[d].w),W.push(i[d].x,F.d?1-i[d].y:i[d].y),W.push(i[d].z,F.d?1-i[d].y:i[d].y),I)for(let N=0;N<4;N++)j.push(I[d].r,I[d].g,I[d].b,I[d].a);a.c._ComputeSides(K,w,q,C,W,N.frontUVs,N.backUVs);const l=new a.c;if(l.indices=q,l.zN=w,l.pN=C,l.XN=W,I){const N=K===a.c.DOUBLESIDE?j.concat(j):j;l.sN=N}return l}function A(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new W.b(N,C);q.sideOrientation=W.b._GetDefaultSideOrientation(q.sideOrientation),d._originalBuilderSideOrientation=q.sideOrientation;return w(q).MN(d,q.updatable),d}a.c.CreateBox=w,W.b.CreateBox=function(N,q){return A(N,{size:q,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12507:(N,q,C)=>{"use strict";C.d(q,{e:()=>F});var d=C(11571),U=C(11561),W=C(11177);function a(N){const q=[],C=[],d=[],a=[],F=N.radius||.5,w=N.tessellation||64,A=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,n=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE;q.push(0,0,0),a.push(.5,.5);const t=2*Math.PI*A,V=1===A?t/w:t/(w-1);let Z=0;for(let U=0;U<w;U++){const N=Math.cos(Z),C=Math.sin(Z),d=(N+1)/2,U=(1-C)/2;q.push(F*N,F*C,0),a.push(d,W.d?1-U:U),Z+=V}1===A&&(q.push(q[3],q[4],q[5]),a.push(a[2],W.d?1-a[3]:a[3]));const J=q.length/3;for(let U=1;U<J-1;U++)C.push(U+1,0,U);U.c.ComputeNormals(q,C,d),U.c._ComputeSides(n,q,C,d,a,N.frontUVs,N.backUVs);const Q=new U.c;return Q.indices=C,Q.zN=q,Q.pN=d,Q.XN=a,Q}function F(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new d.b(N,C);q.sideOrientation=d.b._GetDefaultSideOrientation(q.sideOrientation),U._originalBuilderSideOrientation=q.sideOrientation;return a(q).MN(U,q.updatable),U}U.c.CreateDisc=a,d.b.CreateDisc=function(N,q,C){return F(N,{radius:q,tessellation:C,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12358:(N,q,C)=>{"use strict";C.d(q,{f:()=>v,b:()=>O,i:()=>r});var d=C(11122),U=C(11167),W=C(11571),a=C(11561),F=C(11199);W.b._GroundMeshParser=(N,q)=>w.Parse(N,q);class w extends W.b{constructor(N,q){super(N,q),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=N,this._subdivisionsY=N,this.subdivide(N);const C=this;C.createOrUpdateSubmeshesOctree&&C.createOrUpdateSubmeshesOctree(q)}getHeightAtCoordinates(N,q){const C=this.getWorldMatrix(),U=d.TmpVectors.Matrix[5];C.invertToRef(U);const W=d.TmpVectors.Jq[8];if(d.Jq.TransformCoordinatesFromFloatsToRef(N,0,q,U,W),N=W.x,q=W.z,N<this._minX||N>=this._maxX||q<=this._minZ||q>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(N,q),F=-(a.x*N+a.z*q+a.w)/a.y;return d.Jq.TransformCoordinatesFromFloatsToRef(0,F,0,C,W),W.y}getNormalAtCoordinates(N,q){const C=new d.Jq(0,1,0);return this.getNormalAtCoordinatesToRef(N,q,C),C}getNormalAtCoordinatesToRef(N,q,C){const U=this.getWorldMatrix(),W=d.TmpVectors.Matrix[5];U.invertToRef(W);const a=d.TmpVectors.Jq[8];if(d.Jq.TransformCoordinatesFromFloatsToRef(N,0,q,W,a),N=a.x,q=a.z,N<this._minX||N>this._maxX||q<this._minZ||q>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const F=this._getFacetAt(N,q);return d.Jq.TransformNormalFromFloatsToRef(F.x,F.y,F.z,U,C),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(N,q){const C=Math.floor((N+this._maxX)*this._subdivisionsX/this._width),d=Math.floor(-(q+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),U=this._heightQuads[d*this._subdivisionsX+C];let W;return W=q<U.slope.x*N+U.slope.y?U.facet1:U.facet2,W}_initHeightQuads(){const N=this._subdivisionsX,q=this._subdivisionsY;this._heightQuads=[];for(let C=0;C<q;C++)for(let q=0;q<N;q++){const U={slope:d.Vector2.Zero(),facet1:new d.Vector4(0,0,0,0),facet2:new d.Vector4(0,0,0,0)};this._heightQuads[C*N+q]=U}return this}_computeHeightQuads(){const N=this.getVerticesData(F.g.PositionKind);if(!N)return this;const q=d.TmpVectors.Jq[3],C=d.TmpVectors.Jq[2],U=d.TmpVectors.Jq[1],W=d.TmpVectors.Jq[0],a=d.TmpVectors.Jq[4],w=d.TmpVectors.Jq[5],A=d.TmpVectors.Jq[6],n=d.TmpVectors.Jq[7],t=d.TmpVectors.Jq[8];let V=0,Z=0,J=0,Q=0,v=0,r=0,O=0;const K=this._subdivisionsX,i=this._subdivisionsY;for(let F=0;F<i;F++)for(let i=0;i<K;i++){V=3*i,Z=F*(K+1)*3,J=(F+1)*(K+1)*3,q.x=N[Z+V],q.y=N[Z+V+1],q.z=N[Z+V+2],C.x=N[Z+V+3],C.y=N[Z+V+4],C.z=N[Z+V+5],U.x=N[J+V],U.y=N[J+V+1],U.z=N[J+V+2],W.x=N[J+V+3],W.y=N[J+V+4],W.z=N[J+V+5],Q=(W.z-q.z)/(W.x-q.x),v=q.z-Q*q.x,C.subtractToRef(q,a),U.subtractToRef(q,w),W.subtractToRef(q,A),d.Jq.CrossToRef(A,w,n),d.Jq.CrossToRef(a,A,t),n.normalize(),t.normalize(),r=-(n.x*q.x+n.y*q.y+n.z*q.z),O=-(t.x*C.x+t.y*C.y+t.z*C.z);const I=this._heightQuads[F*K+i];I.slope.hd(Q,v),I.facet1.hd(n.x,n.y,n.z,r),I.facet2.hd(t.x,t.y,t.z,O)}return this}serialize(N){super.serialize(N),N.subdivisionsX=this._subdivisionsX,N.subdivisionsY=this._subdivisionsY,N.minX=this._minX,N.maxX=this._maxX,N.sd=this._minZ,N.maxZ=this._maxZ,N.width=this._width,N.height=this._height}static Parse(N,q){const C=new w(N.name,q);return C._subdivisionsX=N.subdivisionsX||1,C._subdivisionsY=N.subdivisionsY||1,C._minX=N.minX,C._maxX=N.maxX,C._minZ=N.sd,C._maxZ=N.maxZ,C._width=N.width,C._height=N.height,C}}var A=C(10945),n=C(10995),t=C(11129),V=C(11177);function Z(N){const q=[],C=[],U=[],W=[];let F,w;const A=N.width||N.size||1,n=N.height||N.size||1,t=0|(N.subdivisionsX||N.subdivisions||1),Z=0|(N.subdivisionsY||N.subdivisions||1);for(F=0;F<=Z;F++)for(w=0;w<=t;w++){const N=new d.Jq(w*A/t-A/2,0,(Z-F)*n/Z-n/2),q=new d.Jq(0,1,0);C.push(N.x,N.y,N.z),U.push(q.x,q.y,q.z),W.push(w/t,V.d?F/Z:1-F/Z)}for(F=0;F<Z;F++)for(w=0;w<t;w++)q.push(w+1+(F+1)*(t+1)),q.push(w+1+F*(t+1)),q.push(w+F*(t+1)),q.push(w+(F+1)*(t+1)),q.push(w+1+(F+1)*(t+1)),q.push(w+F*(t+1));const J=new a.c;return J.indices=q,J.zN=C,J.pN=U,J.XN=W,J}function J(N){const q=void 0!==N.xmin&&null!==N.xmin?N.xmin:-1,C=void 0!==N.zmin&&null!==N.zmin?N.zmin:-1,U=void 0!==N.xmax&&null!==N.xmax?N.xmax:1,W=void 0!==N.zmax&&null!==N.zmax?N.zmax:1,F=N.subdivisions||{w:1,h:1},w=N.precision||{w:1,h:1},A=[],n=[],t=[],V=[];let Z,J,Q,v;F.h=F.h<1?1:F.h,F.w=F.w<1?1:F.w,w.w=w.w<1?1:w.w,w.h=w.h<1?1:w.h;const r=(U-q)/F.w,O=(W-C)/F.h;function K(N,q,C,U){const W=n.length/3,a=w.w+1;for(Z=0;Z<w.h;Z++)for(J=0;J<w.w;J++){const N=[W+J+Z*a,W+(J+1)+Z*a,W+(J+1)+(Z+1)*a,W+J+(Z+1)*a];A.push(N[1]),A.push(N[2]),A.push(N[3]),A.push(N[0]),A.push(N[1]),A.push(N[3])}const F=d.Jq.Zero(),Q=new d.Jq(0,1,0);for(Z=0;Z<=w.h;Z++)for(F.z=Z*(U-q)/w.h+q,J=0;J<=w.w;J++)F.x=J*(C-N)/w.w+N,F.y=0,n.push(F.x,F.y,F.z),t.push(Q.x,Q.y,Q.z),V.push(J/w.w,Z/w.h)}for(Q=0;Q<F.h;Q++)for(v=0;v<F.w;v++)K(q+v*r,C+Q*O,q+(v+1)*r,C+(Q+1)*O);const i=new a.c;return i.indices=A,i.zN=n,i.pN=t,i.XN=V,i}function Q(N){const q=[],C=[],W=[],F=[];let w,A;const n=N.colorFilter||new U.Oq(.3,.59,.11),V=N.alphaFilter||0;let Z=!1;if(N.minHeight>N.maxHeight){Z=!0;const q=N.maxHeight;N.maxHeight=N.minHeight,N.minHeight=q}for(w=0;w<=N.subdivisions;w++)for(A=0;A<=N.subdivisions;A++){const q=new d.Jq(A*N.width/N.subdivisions-N.width/2,0,(N.subdivisions-w)*N.height/N.subdivisions-N.height/2),U=4*(((q.x+N.width/2)/N.width*(N.bufferWidth-1)|0)+((1-(q.z+N.height/2)/N.height)*(N.bufferHeight-1)|0)*N.bufferWidth);let a=N.buffer[U]/255,J=N.buffer[U+1]/255,Q=N.buffer[U+2]/255;const v=N.buffer[U+3]/255;Z&&(a=1-a,J=1-J,Q=1-Q);const r=a*n.r+J*n.g+Q*n.b;q.y=v>=V?N.minHeight+(N.maxHeight-N.minHeight)*r:N.minHeight-t.e,N.heightBuffer&&(N.heightBuffer[w*(N.subdivisions+1)+A]=q.y),C.push(q.x,q.y,q.z),W.push(0,0,0),F.push(A/N.subdivisions,1-w/N.subdivisions)}for(w=0;w<N.subdivisions;w++)for(A=0;A<N.subdivisions;A++){const d=A+1+(w+1)*(N.subdivisions+1),U=A+1+w*(N.subdivisions+1),W=A+w*(N.subdivisions+1),a=A+(w+1)*(N.subdivisions+1),F=C[3*d+1]>=N.minHeight,n=C[3*U+1]>=N.minHeight,t=C[3*W+1]>=N.minHeight;F&&n&&t&&(q.push(d),q.push(U),q.push(W));C[3*a+1]>=N.minHeight&&F&&t&&(q.push(a),q.push(d),q.push(W))}a.c.ComputeNormals(C,q,W);const J=new a.c;return J.indices=q,J.zN=C,J.pN=W,J.XN=F,J}function v(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=new w(N,arguments.length>2?arguments[2]:void 0);C._setReady(!1),C._subdivisionsX=q.subdivisionsX||q.subdivisions||1,C._subdivisionsY=q.subdivisionsY||q.subdivisions||1,C._width=q.width||1,C._height=q.height||1,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ;return Z(q).MN(C,q.updatable),C._setReady(!0),C}function r(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new W.b(N,C);return J(q).MN(d,q.updatable),d}function O(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const W=C.width||10,a=C.height||10,F=C.subdivisions||1,t=C.minHeight||0,V=C.maxHeight||1,Z=C.colorFilter||new U.Oq(.3,.59,.11),J=C.alphaFilter||0,v=C.updatable,r=C.onReady;d=d||n.e.LastCreatedScene;const O=new w(N,d);let K;O._subdivisionsX=F,O._subdivisionsY=F,O._width=W,O._height=a,O._maxX=O._width/2,O._maxZ=O._height/2,O._minX=-O._maxX,O._minZ=-O._maxZ,O._setReady(!1),C.passHeightBufferInCallback&&(K=new Float32Array((F+1)*(F+1)));const i=(N,q,C)=>{Q({width:W,height:a,subdivisions:F,minHeight:t,maxHeight:V,colorFilter:Z,buffer:N,bufferWidth:q,bufferHeight:C,alphaFilter:J,heightBuffer:K}).MN(O,v),r&&r(O,K),O._setReady(!0)};if("string"===typeof q){const N=N=>{var q;const C=N.width,U=N.height;if(d.A)return;const W=null===(q=d)||void 0===q?void 0:q.getEngine().resizeImageBitmap(N,C,U);i(W,C,U)};A.Tools.LoadImage(q,N,C.onError?C.onError:()=>{},d.offlineProvider)}else i(q.data,q.width,q.height);return O}a.c.CreateGround=Z,a.c.CreateTiledGround=J,a.c.CreateGroundFromHeightMap=Q,W.b.CreateGround=(N,q,C,d,U,W)=>v(N,{width:q,height:C,subdivisions:d,updatable:W},U),W.b.CreateTiledGround=(N,q,C,d,U,W,a,F,w)=>r(N,{xmin:q,zmin:C,xmax:d,zmax:U,subdivisions:W,precision:a,updatable:w},F),W.b.CreateGroundFromHeightMap=(N,q,C,d,U,W,a,F,w,A,n)=>O(N,q,{width:C,height:d,subdivisions:U,minHeight:W,maxHeight:a,updatable:w,onReady:A,alphaFilter:n},F)},12989:(N,q,C)=>{"use strict";C.d(q,{d:()=>Z,e:()=>t,h:()=>V});var d=C(11122),U=C(11571),W=C(11561),a=C(11674),F=C(11199),w=C(10962);function A(N){const q=[],C=[],d=N.lines,U=N.sN,a=[];let F=0;for(let W=0;W<d.length;W++){const N=d[W];for(let d=0;d<N.length;d++){const{x:w,y:A,z:n}=N[d];if(C.push(w,A,n),U){const N=U[W],{r:q,g:C,b:F,a:w}=N[d];a.push(q,C,F,w)}d>0&&(q.push(F-1),q.push(F)),F++}}const w=new W.c;return w.indices=q,w.zN=C,U&&(w.sN=a),w}function n(N){const q=N.dashSize||3,C=N.gapSize||1,U=N.dashNb||200,a=N.points,F=[],w=[],A=d.Jq.Zero();let n=0,t=0,V=0,Z=0,J=0,Q=0,v=0;for(v=0;v<a.length-1;v++)a[v+1].subtractToRef(a[v],A),n+=A.length();for(V=n/U,Z=q*V/(q+C),v=0;v<a.length-1;v++){a[v+1].subtractToRef(a[v],A),t=Math.floor(A.length()/V),A.normalize();for(let N=0;N<t;N++)J=V*N,F.push(a[v].x+J*A.x,a[v].y+J*A.y,a[v].z+J*A.z),F.push(a[v].x+(J+Z)*A.x,a[v].y+(J+Z)*A.y,a[v].z+(J+Z)*A.z),w.push(Q,Q+1),Q+=2}const r=new W.c;return r.zN=F,r.indices=w,r}function t(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=q.instance,U=q.lines,W=q.sN;if(d){const N=d.getVerticesData(F.g.PositionKind);let q,C;W&&(q=d.getVerticesData(F.g.ColorKind));let a=0,w=0;for(let d=0;d<U.length;d++){const F=U[d];for(let U=0;U<F.length;U++)N[a]=F[U].x,N[a+1]=F[U].y,N[a+2]=F[U].z,W&&q&&(C=W[d],q[w]=C[U].r,q[w+1]=C[U].g,q[w+2]=C[U].b,q[w+3]=C[U].a,w+=4),a+=3}return d.updateVerticesData(F.g.PositionKind,N,!1,!1),W&&q&&d.updateVerticesData(F.g.ColorKind,q,!1,!1),d.refreshBoundingInfo(),d}const w=!!W,n=new a.e(N,C,null,void 0,void 0,w,q.useVertexAlpha,q.material);return A(q).MN(n,q.updatable),n}function V(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=q.sN?[q.sN]:null;return t(N,{lines:[q.points],updatable:q.updatable,instance:q.instance,sN:d,useVertexAlpha:q.useVertexAlpha,material:q.material},C)}function Z(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=q.points,F=q.instance,A=q.gapSize||1,t=q.dashSize||3;if(F){const N=N=>{const q=d.Jq.Zero(),C=N.length/6;let U=0,a=0,w=0,A=0,n=0,t=0,V=0,Z=0;for(V=0;V<W.length-1;V++)W[V+1].subtractToRef(W[V],q),U+=q.length();w=U/C;const J=F._creationDataStorage.dashSize;for(A=J*w/(J+F._creationDataStorage.gapSize),V=0;V<W.length-1;V++)for(W[V+1].subtractToRef(W[V],q),a=Math.floor(q.length()/w),q.normalize(),Z=0;Z<a&&t<N.length;)n=w*Z,N[t]=W[V].x+n*q.x,N[t+1]=W[V].y+n*q.y,N[t+2]=W[V].z+n*q.z,N[t+3]=W[V].x+(n+A)*q.x,N[t+4]=W[V].y+(n+A)*q.y,N[t+5]=W[V].z+(n+A)*q.z,t+=6,Z++;for(;t<N.length;)N[t]=W[V].x,N[t+1]=W[V].y,N[t+2]=W[V].z,t+=3};return(q.dashNb||q.dashSize||q.gapSize||q.useVertexAlpha||q.material)&&w.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),F.updateMeshPositions(N,!1),F}const V=new a.e(N,C,null,void 0,void 0,void 0,q.useVertexAlpha,q.material);return n(q).MN(V,q.updatable),V._creationDataStorage=new U.d,V._creationDataStorage.dashSize=t,V._creationDataStorage.gapSize=A,V}W.c.CreateLineSystem=A,W.c.CreateDashedLines=n,U.b.AA=function(N,q){return V(N,{points:q,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},U.b.CreateDashedLines=function(N,q,C,d,U){return Z(N,{points:q,dashSize:C,gapSize:d,dashNb:U,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12406:(N,q,C)=>{"use strict";C.d(q,{d:()=>F,g:()=>w});var d=C(11571),U=C(11561),W=C(11177);function a(N){const q=[],C=[],d=[],a=[],F=void 0!==N.width?N.width:void 0!==N.size?N.size:1,w=void 0!==N.height?N.height:void 0!==N.size?N.size:1,A=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE,n=F/2,t=w/2;C.push(-n,-t,0),d.push(0,0,-1),a.push(0,W.d?1:0),C.push(n,-t,0),d.push(0,0,-1),a.push(1,W.d?1:0),C.push(n,t,0),d.push(0,0,-1),a.push(1,W.d?0:1),C.push(-n,t,0),d.push(0,0,-1),a.push(0,W.d?0:1),q.push(0),q.push(1),q.push(2),q.push(0),q.push(2),q.push(3),U.c._ComputeSides(A,C,q,d,a,N.frontUVs,N.backUVs);const V=new U.c;return V.indices=q,V.zN=C,V.pN=d,V.XN=a,V}function F(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new d.b(N,C);q.sideOrientation=d.b._GetDefaultSideOrientation(q.sideOrientation),U._originalBuilderSideOrientation=q.sideOrientation;return a(q).MN(U,q.updatable),q.sourcePlane&&(U.translate(q.sourcePlane.normal,-q.sourcePlane.d),U.setDirection(q.sourcePlane.normal.scale(-1))),U}const w={VA:F};U.c.VA=a,d.b.VA=(N,q,C,d,U)=>F(N,{size:q,width:q,height:q,sideOrientation:U,updatable:d},C)},12494:(N,q,C)=>{"use strict";C.d(q,{b:()=>w});var d=C(11122),U=C(11571),W=C(11561),a=C(11177);function F(N){const q=0|(N.segments||32),C=N.diameterX||N.diameter||1,U=N.diameterY||N.diameter||1,F=N.diameterZ||N.diameter||1,w=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,A=N.slice&&N.slice<=0?1:N.slice||1,n=0===N.sideOrientation?0:N.sideOrientation||W.c.DEFAULTSIDE,t=!!N.dedupTopBottomIndices,V=new d.Jq(C/2,U/2,F/2),Z=2+q,J=2*Z,Q=[],v=[],r=[],O=[];for(let W=0;W<=Z;W++){const N=W/Z,q=N*Math.PI*A;for(let C=0;C<=J;C++){const U=C/J,W=U*Math.PI*2*w,F=d.Matrix.RotationZ(-q),A=d.Matrix.RotationY(W),n=d.Jq.TransformCoordinates(d.Jq.Up(),F),t=d.Jq.TransformCoordinates(n,A),Z=t.multiply(V),Q=t.divide(V).normalize();v.push(Z.x,Z.y,Z.z),r.push(Q.x,Q.y,Q.z),O.push(U,a.d?1-N:N)}if(W>0){const N=v.length/3;for(let q=N-2*(J+1);q+J+2<N;q++)t?(W>1&&(Q.push(q),Q.push(q+1),Q.push(q+J+1)),(W<Z||A<1)&&(Q.push(q+J+1),Q.push(q+1),Q.push(q+J+2))):(Q.push(q),Q.push(q+1),Q.push(q+J+1),Q.push(q+J+1),Q.push(q+1),Q.push(q+J+2))}}W.c._ComputeSides(n,v,Q,r,O,N.frontUVs,N.backUVs);const K=new W.c;return K.indices=Q,K.zN=v,K.pN=r,K.XN=O,K}function w(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new U.b(N,C);q.sideOrientation=U.b._GetDefaultSideOrientation(q.sideOrientation),d._originalBuilderSideOrientation=q.sideOrientation;return F(q).MN(d,q.updatable),d}W.c.CreateSphere=F,U.b.CreateSphere=(N,q,C,d,U,W)=>w(N,{segments:q,diameterX:C,diameterY:C,diameterZ:C,sideOrientation:W,updatable:U},d)},13290:(N,q,C)=>{"use strict";C.d(q,{b:()=>F});var d=C(11696),U=C(12805),W=C(11708),a=C(11561);class F{static get Configuration(){return{get decoder(){return U.e.DefaultConfiguration},set decoder(N){U.e.DefaultConfiguration=N}}}static set Configuration(N){U.e.DefaultConfiguration=N.decoder}static get DecoderAvailable(){return(0,d.f)(U.e.DefaultConfiguration)}static get Default(){return F._Default??(F._Default=new F),F._Default}static ResetDefault(N){F._Default&&(N||F._Default.dispose(),F._Default=null)}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.DefaultNumWorkers;const q="number"===typeof N?{...U.e.DefaultConfiguration,numWorkers:N}:{...U.e.DefaultConfiguration,...N};this._decoder=new U.e(q)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(N,q,C){return this._decoder.decodeMeshToMeshDataAsync(N,q,C)}async decodeMeshToGeometryAsync(N,q,C,d){return await this._decoder.decodeMeshToGeometryAsync(N,q,C,d)}async _decodeMeshToGeometryForGltfAsync(N,q,C,d,U,W){return await this._decoder._decodeMeshToGeometryForGltfAsync(N,q,C,d,U,W)}async decodeMeshAsync(N,q){const C=await this._decoder.decodeMeshToMeshDataAsync(N,q),d=new a.c;C.indices&&(d.indices=C.indices);for(const U of C.attributes){const N=W.b.GetFloatData(U.data,U.size,W.b.GetDataType(U.data),U.byteOffset,U.byteStride,U.normalized,C.totalVertices);d.set(N,U.kind)}return d}}F.DefaultNumWorkers=(0,d.d)(),F._Default=null},12805:(N,q,C)=>{"use strict";C.d(q,{e:()=>A});var d=C(11696),U=C(10945),W=C(11584),a=C(11708),F=C(10962),w=C(11702);class A extends d.b{static get DefaultAvailable(){return(0,d.f)(A.DefaultConfiguration)}static get Default(){return A._Default??(A._Default=new A),A._Default}static ResetDefault(N){A._Default&&(N||A._Default.dispose(),A._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(N,q){return{module:await(q||DracoDecoderModule)({wasmBinary:N})}}_getWorkerContent(){return`${w.c}(${w.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.DefaultConfiguration)}decodeMeshToMeshDataAsync(N,q,C){const d=N instanceof ArrayBuffer?new Int8Array(N):new Int8Array(N.buffer,N.byteOffset,N.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async N=>await new Promise(((U,W)=>{N.push(((N,a)=>{let w=null;const A=[],n=q=>{N.removeEventListener("error",n),N.removeEventListener("message",t),W(q),a()},t=q=>{const d=q.data;switch(d.id){case"indices":w=d.data;break;case"attribute":A.push({kind:d.kind,data:d.data,size:d.size,byteOffset:d.byteOffset,byteStride:d.byteStride,normalized:(W=d.kind,V=d.normalized,C&&void 0!==C[W]?(V!==C[W]&&F.c.Warn(`Normalized flag from Draco data (${V}) does not match normalized flag from glTF accessor (${C[W]}). Using flag from glTF accessor.`),C[W]):V)});break;case"decodeMeshDone":N.removeEventListener("error",n),N.removeEventListener("message",t),U({indices:w,attributes:A,totalVertices:d.totalVertices}),a()}var W,V};N.addEventListener("error",n),N.addEventListener("message",t);const V=d.slice();N.postMessage({id:"decodeMesh",dataView:V,attributes:q},[V.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((N=>{let C=null;const U=[],W=(0,w.c)(N.module,d,q,(N=>{C=N}),((N,q,C,d,W,a)=>{U.push({kind:N,data:q,size:C,byteOffset:d,byteStride:W,normalized:a})}));return{indices:C,attributes:U,totalVertices:W}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(N,q,C,d){const U=await this.decodeMeshToMeshDataAsync(C,d),F=new W.d(N,q);U.indices&&F.setIndices(U.indices);for(const W of U.attributes)F.setVerticesBuffer(new a.b(q.getEngine(),W.data,W.kind,!1,void 0,W.byteStride,void 0,W.byteOffset,W.size,void 0,W.normalized,!0),U.totalVertices);return F}async _decodeMeshToGeometryForGltfAsync(N,q,C,d,U,F){const w=await this.decodeMeshToMeshDataAsync(C,d,U),A=new W.d(N,q);F&&(A._boundingInfo=F,A.useBoundingInfoFromGeometry=!0),w.indices&&A.setIndices(w.indices);for(const W of w.attributes)A.setVerticesBuffer(new a.b(q.getEngine(),W.data,W.kind,!1,void 0,W.byteStride,void 0,W.byteOffset,W.size,void 0,W.normalized,!0),w.totalVertices);return A}}A.DefaultConfiguration={wasmUrl:`${U.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${U.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${U.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},A._Default=null},12983:(N,q,C)=>{"use strict";C.d(q,{d:()=>FN});var d=C(11122),U=C(11571),W=C(11199),a=C(11561),F=C(11177);function w(N){let q=N.pathArray;const C=N.closeArray||!1,d=N.closePath||!1,U=N.invertUV||!1,w=Math.floor(q[0].length/2);let A=N.offset||w;A=A>w?w:Math.floor(A);const n=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE,t=N.XN,V=N.sN,Z=[],J=[],Q=[],v=[],r=[],O=[],K=[],i=[];let I;const j=[],l=[];let T,z,p;if(q.length<2){const N=[],C=[];for(z=0;z<q[0].length-A;z++)N.push(q[0][z]),C.push(q[0][z+A]);q=[N,C]}let s=0;const X=d?1:0,P=C?1:0;let M,Y,E,H,e,b;for(I=q[0].length,T=0;T<q.length+P;T++){for(K[T]=0,r[T]=[0],M=T===q.length?q[0]:q[T],Y=M.length,I=I<Y?I:Y,p=0;p<Y;)Z.push(M[p].x,M[p].y,M[p].z),p>0&&(E=M[p].Qq(M[p-1]).length(),H=E+K[T],r[T].push(H),K[T]=H),p++;d&&(p--,Z.push(M[0].x,M[0].y,M[0].z),E=M[p].Qq(M[0]).length(),H=E+K[T],r[T].push(H),K[T]=H),j[T]=Y+X,l[T]=s,s+=Y+X}let o,S,D=null,c=null;for(z=0;z<I+X;z++)for(i[z]=0,O[z]=[0],T=0;T<q.length-1+P;T++)e=q[T],b=T===q.length-1?q[0]:q[T+1],z===I?(D=e[0],c=b[0]):(D=e[z],c=b[z]),E=c.Qq(D).length(),H=E+i[z],O[z].push(H),i[z]=H;if(t)for(T=0;T<t.length;T++)v.push(t[T].x,F.d?1-t[T].y:t[T].y);else for(T=0;T<q.length+P;T++)for(z=0;z<I+X;z++)o=0!=K[T]?r[T][z]/K[T]:0,S=0!=i[z]?O[z][T]/i[z]:0,U?v.push(S,o):v.push(o,F.d?1-S:S);T=0;let L=0,G=j[T]-1,h=j[T+1]-1,B=G<h?G:h,y=l[1]-l[0];const R=j.length-1;for(;L<=B&&T<R;)J.push(L,L+y,L+1),J.push(L+y+1,L+1,L+y),L+=1,L===B&&(T++,y=l[T+1]-l[T],G=j[T]-1,h=j[T+1]-1,L=l[T],B=G<h?G+L:h+L);if(a.c.ComputeNormals(Z,J,Q),d){let N=0,C=0;for(T=0;T<q.length;T++){N=3*l[T],C=T+1<q.length?3*(l[T+1]-1):Q.length-3,Q[N]=.5*(Q[N]+Q[C]),Q[N+1]=.5*(Q[N+1]+Q[C+1]),Q[N+2]=.5*(Q[N+2]+Q[C+2]);const d=Math.sqrt(Q[N]*Q[N]+Q[N+1]*Q[N+1]+Q[N+2]*Q[N+2]);Q[N]/=d,Q[N+1]/=d,Q[N+2]/=d,Q[C]=Q[N],Q[C+1]=Q[N+1],Q[C+2]=Q[N+2]}}if(C){let N=3*l[0],C=3*l[q.length];for(z=0;z<I+X;z++){Q[N]=.5*(Q[N]+Q[C]),Q[N+1]=.5*(Q[N+1]+Q[C+1]),Q[N+2]=.5*(Q[N+2]+Q[C+2]);const q=Math.sqrt(Q[N]*Q[N]+Q[N+1]*Q[N+1]+Q[N+2]*Q[N+2]);Q[N]/=q,Q[N+1]/=q,Q[N+2]/=q,Q[C]=Q[N],Q[C+1]=Q[N+1],Q[C+2]=Q[N+2],N+=3,C+=3}}a.c._ComputeSides(n,Z,J,Q,v,N.frontUVs,N.backUVs);let u=null;if(V){u=new Float32Array(4*V.length);for(let N=0;N<V.length;N++)u[4*N]=V[N].r,u[4*N+1]=V[N].g,u[4*N+2]=V[N].b,u[4*N+3]=V[N].a}const m=new a.c,f=new Float32Array(Z),k=new Float32Array(Q),g=new Float32Array(v);return m.indices=J,m.zN=f,m.pN=k,m.XN=g,u&&m.set(u,W.g.ColorKind),d&&(m._idx=l),m}function A(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=q.pathArray,n=q.closeArray,t=q.closePath,V=U.b._GetDefaultSideOrientation(q.sideOrientation),Z=q.instance,J=q.updatable;if(Z){const N=d.TmpVectors.Jq[0].Rd(Number.MAX_VALUE),C=d.TmpVectors.Jq[1].Rd(-Number.MAX_VALUE),w=q=>{let d=A[0].length;const W=Z;let a=0;const F=W._originalBuilderSideOrientation===U.b.DOUBLESIDE?2:1;for(let U=1;U<=F;++U)for(let F=0;F<A.length;++F){const U=A[F],w=U.length;d=d<w?d:w;for(let W=0;W<d;++W){const d=U[W];q[a]=d.x,q[a+1]=d.y,q[a+2]=d.z,N.minimizeInPlaceFromFloats(d.x,d.y,d.z),C.maximizeInPlaceFromFloats(d.x,d.y,d.z),a+=3}if(W._creationDataStorage&&W._creationDataStorage.closePath){const N=U[0];q[a]=N.x,q[a+1]=N.y,q[a+2]=N.z,a+=3}}},n=Z.getVerticesData(W.g.PositionKind);if(w(n),Z.hasBoundingInfo?Z.getBoundingInfo().reConstruct(N,C,Z._worldMatrix):Z.buildBoundingInfo(N,C,Z._worldMatrix),Z.updateVerticesData(W.g.PositionKind,n,!1,!1),q.sN){const N=Z.getVerticesData(W.g.ColorKind);for(let C=0,d=0;C<q.sN.length;C++,d+=4){const U=q.sN[C];N[d]=U.r,N[d+1]=U.g,N[d+2]=U.b,N[d+3]=U.a}Z.updateVerticesData(W.g.ColorKind,N,!1,!1)}if(q.XN){const N=Z.getVerticesData(W.g.UVKind);for(let C=0;C<q.XN.length;C++)N[2*C]=q.XN[C].x,N[2*C+1]=F.d?1-q.XN[C].y:q.XN[C].y;Z.updateVerticesData(W.g.UVKind,N,!1,!1)}if(!Z.areNormalsFrozen||Z.isFacetDataEnabled){const N=Z.od(),q=Z.getVerticesData(W.g.NormalKind),C=Z.isFacetDataEnabled?Z.getFacetDataParameters():null;if(a.c.ComputeNormals(n,N,q,C),Z._creationDataStorage&&Z._creationDataStorage.closePath){let N=0,C=0;for(let d=0;d<A.length;d++)N=3*Z._creationDataStorage.idx[d],C=d+1<A.length?3*(Z._creationDataStorage.idx[d+1]-1):q.length-3,q[N]=.5*(q[N]+q[C]),q[N+1]=.5*(q[N+1]+q[C+1]),q[N+2]=.5*(q[N+2]+q[C+2]),q[C]=q[N],q[C+1]=q[N+1],q[C+2]=q[N+2]}Z.areNormalsFrozen||Z.updateVerticesData(W.g.NormalKind,q,!1,!1)}return Z}{const d=new U.b(N,C);d._originalBuilderSideOrientation=V,d._creationDataStorage=new U.d;const W=w(q);return t&&(d._creationDataStorage.idx=W._idx),d._creationDataStorage.closePath=t,d._creationDataStorage.closeArray=n,W.MN(d,J),d}}a.c.CreateRibbon=w,U.b.CreateRibbon=function(N,q){return A(N,{pathArray:q,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var n=C(12507),t=C(12353),V=C(11167);function Z(N){const q=N.pattern||U.b.NO_FLIP,C=N.tileWidth||N.tileSize||1,d=N.tileHeight||N.tileSize||1,W=N.alignHorizontal||0,F=N.alignVertical||0,w=N.width||N.size||1,A=Math.floor(w/C);let n=w-A*C;const t=N.height||N.size||1,V=Math.floor(t/d);let Z=t-V*d;const J=C*A/2,Q=d*V/2;let v=0,r=0,O=0,K=0,i=0,I=0;if(n>0||Z>0){switch(O=-J,K=-Q,i=J,I=Q,W){case U.b.CENTER:n/=2,O-=n,i+=n;break;case U.b.LEFT:i+=n,v=-n/2;break;case U.b.RIGHT:O-=n,v=n/2}switch(F){case U.b.CENTER:Z/=2,K-=Z,I+=Z;break;case U.b.BOTTOM:I+=Z,r=-Z/2;break;case U.b.TOP:K-=Z,r=Z/2}}const j=[],l=[],T=[];T[0]=[0,0,1,0,1,1,0,1],T[1]=[0,0,1,0,1,1,0,1],q!==U.b.ROTATE_TILE&&q!==U.b.ROTATE_ROW||(T[1]=[1,1,0,1,0,0,1,0]),q!==U.b.FLIP_TILE&&q!==U.b.FLIP_ROW||(T[1]=[1,0,0,0,0,1,1,1]),q!==U.b.FLIP_N_ROTATE_TILE&&q!==U.b.FLIP_N_ROTATE_ROW||(T[1]=[0,1,1,1,1,0,0,0]);let z=[];const p=[],s=[];let X=0;for(let a=0;a<V;a++)for(let N=0;N<A;N++)j.push(N*C-J+v,a*d-Q+r,0),j.push((N+1)*C-J+v,a*d-Q+r,0),j.push((N+1)*C-J+v,(a+1)*d-Q+r,0),j.push(N*C-J+v,(a+1)*d-Q+r,0),s.push(X,X+1,X+3,X+1,X+2,X+3),z=q===U.b.FLIP_TILE||q===U.b.ROTATE_TILE||q===U.b.FLIP_N_ROTATE_TILE?z.concat(T[(N%2+a%2)%2]):q===U.b.FLIP_ROW||q===U.b.ROTATE_ROW||q===U.b.FLIP_N_ROTATE_ROW?z.concat(T[a%2]):z.concat(T[0]),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),X+=4;if(n>0||Z>0){const N=Z>0&&(F===U.b.CENTER||F===U.b.TOP),a=Z>0&&(F===U.b.CENTER||F===U.b.BOTTOM),w=n>0&&(W===U.b.CENTER||W===U.b.RIGHT),t=n>0&&(W===U.b.CENTER||W===U.b.LEFT);let T,P,M,Y,E=[];if(N&&w&&(j.push(O+v,K+r,0),j.push(-J+v,K+r,0),j.push(-J+v,K+Z+r,0),j.push(O+v,K+Z+r,0),s.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,T=1-n/C,P=1-Z/d,M=1,Y=1,E=[T,P,M,P,M,Y,T,Y],q===U.b.ROTATE_ROW&&(E=[1-T,1-P,1-M,1-P,1-M,1-Y,1-T,1-Y]),q===U.b.FLIP_ROW&&(E=[1-T,P,1-M,P,1-M,Y,1-T,Y]),q===U.b.FLIP_N_ROTATE_ROW&&(E=[T,1-P,M,1-P,M,1-Y,T,1-Y]),z=z.concat(E),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N&&t&&(j.push(J+v,K+r,0),j.push(i+v,K+r,0),j.push(i+v,K+Z+r,0),j.push(J+v,K+Z+r,0),s.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,T=0,P=1-Z/d,M=n/C,Y=1,E=[T,P,M,P,M,Y,T,Y],(q===U.b.ROTATE_ROW||q===U.b.ROTATE_TILE&&A%2===0)&&(E=[1-T,1-P,1-M,1-P,1-M,1-Y,1-T,1-Y]),(q===U.b.FLIP_ROW||q===U.b.FLIP_TILE&&A%2===0)&&(E=[1-T,P,1-M,P,1-M,Y,1-T,Y]),(q===U.b.FLIP_N_ROTATE_ROW||q===U.b.FLIP_N_ROTATE_TILE&&A%2===0)&&(E=[T,1-P,M,1-P,M,1-Y,T,1-Y]),z=z.concat(E),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&w&&(j.push(O+v,Q+r,0),j.push(-J+v,Q+r,0),j.push(-J+v,I+r,0),j.push(O+v,I+r,0),s.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,T=1-n/C,P=0,M=1,Y=Z/d,E=[T,P,M,P,M,Y,T,Y],(q===U.b.ROTATE_ROW&&V%2===1||q===U.b.ROTATE_TILE&&V%1===0)&&(E=[1-T,1-P,1-M,1-P,1-M,1-Y,1-T,1-Y]),(q===U.b.FLIP_ROW&&V%2===1||q===U.b.FLIP_TILE&&V%2===0)&&(E=[1-T,P,1-M,P,1-M,Y,1-T,Y]),(q===U.b.FLIP_N_ROTATE_ROW&&V%2===1||q===U.b.FLIP_N_ROTATE_TILE&&V%2===0)&&(E=[T,1-P,M,1-P,M,1-Y,T,1-Y]),z=z.concat(E),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&t&&(j.push(J+v,Q+r,0),j.push(i+v,Q+r,0),j.push(i+v,I+r,0),j.push(J+v,I+r,0),s.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,T=0,P=0,M=n/C,Y=Z/d,E=[T,P,M,P,M,Y,T,Y],(q===U.b.ROTATE_ROW&&V%2===1||q===U.b.ROTATE_TILE&&(V+A)%2===1)&&(E=[1-T,1-P,1-M,1-P,1-M,1-Y,1-T,1-Y]),(q===U.b.FLIP_ROW&&V%2===1||q===U.b.FLIP_TILE&&(V+A)%2===1)&&(E=[1-T,P,1-M,P,1-M,Y,1-T,Y]),(q===U.b.FLIP_N_ROTATE_ROW&&V%2===1||q===U.b.FLIP_N_ROTATE_TILE&&(V+A)%2===1)&&(E=[T,1-P,M,1-P,M,1-Y,T,1-Y]),z=z.concat(E),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N){const N=[];T=0,P=1-Z/d,M=1,Y=1,N[0]=[T,P,M,P,M,Y,T,Y],N[1]=[T,P,M,P,M,Y,T,Y],q!==U.b.ROTATE_TILE&&q!==U.b.ROTATE_ROW||(N[1]=[1-T,1-P,1-M,1-P,1-M,1-Y,1-T,1-Y]),q!==U.b.FLIP_TILE&&q!==U.b.FLIP_ROW||(N[1]=[1-T,P,1-M,P,1-M,Y,1-T,Y]),q!==U.b.FLIP_N_ROTATE_TILE&&q!==U.b.FLIP_N_ROTATE_ROW||(N[1]=[T,1-P,M,1-P,M,1-Y,T,1-Y]);for(let d=0;d<A;d++)j.push(d*C-J+v,K+r,0),j.push((d+1)*C-J+v,K+r,0),j.push((d+1)*C-J+v,K+Z+r,0),j.push(d*C-J+v,K+Z+r,0),s.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,z=q===U.b.FLIP_TILE||q===U.b.ROTATE_TILE||q===U.b.FLIP_N_ROTATE_TILE?z.concat(N[(d+1)%2]):q===U.b.FLIP_ROW||q===U.b.ROTATE_ROW||q===U.b.FLIP_N_ROTATE_ROW?z.concat(N[1]):z.concat(N[0]),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(a){const N=[];T=0,P=0,M=1,Y=Z/d,N[0]=[T,P,M,P,M,Y,T,Y],N[1]=[T,P,M,P,M,Y,T,Y],q!==U.b.ROTATE_TILE&&q!==U.b.ROTATE_ROW||(N[1]=[1-T,1-P,1-M,1-P,1-M,1-Y,1-T,1-Y]),q!==U.b.FLIP_TILE&&q!==U.b.FLIP_ROW||(N[1]=[1-T,P,1-M,P,1-M,Y,1-T,Y]),q!==U.b.FLIP_N_ROTATE_TILE&&q!==U.b.FLIP_N_ROTATE_ROW||(N[1]=[T,1-P,M,1-P,M,1-Y,T,1-Y]);for(let d=0;d<A;d++)j.push(d*C-J+v,I-Z+r,0),j.push((d+1)*C-J+v,I-Z+r,0),j.push((d+1)*C-J+v,I+r,0),j.push(d*C-J+v,I+r,0),s.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,z=q===U.b.FLIP_TILE||q===U.b.ROTATE_TILE||q===U.b.FLIP_N_ROTATE_TILE?z.concat(N[(d+V)%2]):q===U.b.FLIP_ROW||q===U.b.ROTATE_ROW||q===U.b.FLIP_N_ROTATE_ROW?z.concat(N[V%2]):z.concat(N[0]),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(w){const N=[];T=1-n/C,P=0,M=1,Y=1,N[0]=[T,P,M,P,M,Y,T,Y],N[1]=[T,P,M,P,M,Y,T,Y],q!==U.b.ROTATE_TILE&&q!==U.b.ROTATE_ROW||(N[1]=[1-T,1-P,1-M,1-P,1-M,1-Y,1-T,1-Y]),q!==U.b.FLIP_TILE&&q!==U.b.FLIP_ROW||(N[1]=[1-T,P,1-M,P,1-M,Y,1-T,Y]),q!==U.b.FLIP_N_ROTATE_TILE&&q!==U.b.FLIP_N_ROTATE_ROW||(N[1]=[T,1-P,M,1-P,M,1-Y,T,1-Y]);for(let C=0;C<V;C++)j.push(O+v,C*d-Q+r,0),j.push(O+n+v,C*d-Q+r,0),j.push(O+n+v,(C+1)*d-Q+r,0),j.push(O+v,(C+1)*d-Q+r,0),s.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,z=q===U.b.FLIP_TILE||q===U.b.ROTATE_TILE||q===U.b.FLIP_N_ROTATE_TILE?z.concat(N[(C+1)%2]):q===U.b.FLIP_ROW||q===U.b.ROTATE_ROW||q===U.b.FLIP_N_ROTATE_ROW?z.concat(N[C%2]):z.concat(N[0]),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(t){const N=[];T=0,P=0,M=n/d,Y=1,N[0]=[T,P,M,P,M,Y,T,Y],N[1]=[T,P,M,P,M,Y,T,Y],q!==U.b.ROTATE_TILE&&q!==U.b.ROTATE_ROW||(N[1]=[1-T,1-P,1-M,1-P,1-M,1-Y,1-T,1-Y]),q!==U.b.FLIP_TILE&&q!==U.b.FLIP_ROW||(N[1]=[1-T,P,1-M,P,1-M,Y,1-T,Y]),q!==U.b.FLIP_N_ROTATE_TILE&&q!==U.b.FLIP_N_ROTATE_ROW||(N[1]=[T,1-P,M,1-P,M,1-Y,T,1-Y]);for(let C=0;C<V;C++)j.push(i-n+v,C*d-Q+r,0),j.push(i+v,C*d-Q+r,0),j.push(i+v,(C+1)*d-Q+r,0),j.push(i-n+v,(C+1)*d-Q+r,0),s.push(X,X+1,X+3,X+1,X+2,X+3),X+=4,z=q===U.b.FLIP_TILE||q===U.b.ROTATE_TILE||q===U.b.FLIP_N_ROTATE_TILE?z.concat(N[(C+A)%2]):q===U.b.FLIP_ROW||q===U.b.ROTATE_ROW||q===U.b.FLIP_N_ROTATE_ROW?z.concat(N[C%2]):z.concat(N[0]),p.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const P=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE;a.c._ComputeSides(P,j,s,l,z,N.frontUVs,N.backUVs);const M=new a.c;M.indices=s,M.zN=j,M.pN=l,M.XN=z;const Y=P===a.c.DOUBLESIDE?p.concat(p):p;return M.sN=Y,M}function J(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new U.b(N,C);q.sideOrientation=U.b._GetDefaultSideOrientation(q.sideOrientation),d._originalBuilderSideOrientation=q.sideOrientation;return Z(q).MN(d,q.updatable),d}function Q(N){const q=N.faceUV||new Array(6),C=N.faceColors,W=N.pattern||U.b.NO_FLIP,w=N.width||N.size||1,A=N.height||N.size||1,n=N.depth||N.size||1,t=N.tileWidth||N.tileSize||1,J=N.tileHeight||N.tileSize||1,Q=N.alignHorizontal||0,v=N.alignVertical||0,r=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE;for(let U=0;U<6;U++)void 0===q[U]&&(q[U]=new d.Vector4(0,0,1,1)),C&&void 0===C[U]&&(C[U]=new V.md(1,1,1,1));const O=w/2,K=A/2,i=n/2,I=[];for(let d=0;d<2;d++)I[d]=Z({pattern:W,tileWidth:t,tileHeight:J,width:w,height:A,alignVertical:v,alignHorizontal:Q,sideOrientation:r});for(let d=2;d<4;d++)I[d]=Z({pattern:W,tileWidth:t,tileHeight:J,width:n,height:A,alignVertical:v,alignHorizontal:Q,sideOrientation:r});let j=v;v===U.b.BOTTOM?j=U.b.TOP:v===U.b.TOP&&(j=U.b.BOTTOM);for(let d=4;d<6;d++)I[d]=Z({pattern:W,tileWidth:t,tileHeight:J,width:w,height:n,alignVertical:j,alignHorizontal:Q,sideOrientation:r});let l=[],T=[],z=[],p=[];const s=[],X=[],P=[],M=[];let Y=0,E=0;for(let U=0;U<6;U++){const N=I[U].zN.length;X[U]=[],P[U]=[];for(let q=0;q<N/3;q++)X[U].push(new d.Jq(I[U].zN[3*q],I[U].zN[3*q+1],I[U].zN[3*q+2])),P[U].push(new d.Jq(I[U].pN[3*q],I[U].pN[3*q+1],I[U].pN[3*q+2]));Y=I[U].XN.length,M[U]=[];for(let C=0;C<Y;C+=2)M[U][C]=q[U].x+(q[U].z-q[U].x)*I[U].XN[C],M[U][C+1]=q[U].y+(q[U].w-q[U].y)*I[U].XN[C+1],F.d&&(M[U][C+1]=1-M[U][C+1]);if(z=z.concat(M[U]),p=p.concat(I[U].indices.map((N=>N+E))),E+=X[U].length,C)for(let q=0;q<4;q++)s.push(C[U].r,C[U].g,C[U].b,C[U].a)}const H=new d.Jq(0,0,i),e=d.Matrix.RotationY(Math.PI);l=X[0].map((N=>d.Jq.TransformNormal(N,e).add(H))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]),T=P[0].map((N=>d.Jq.TransformNormal(N,e))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]),l=l.concat(X[1].map((N=>N.Qq(H))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),T=T.concat(P[1].map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]));const b=new d.Jq(O,0,0),o=d.Matrix.RotationY(-Math.PI/2);l=l.concat(X[2].map((N=>d.Jq.TransformNormal(N,o).add(b))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),T=T.concat(P[2].map((N=>d.Jq.TransformNormal(N,o))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]));const S=d.Matrix.RotationY(Math.PI/2);l=l.concat(X[3].map((N=>d.Jq.TransformNormal(N,S).Qq(b))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),T=T.concat(P[3].map((N=>d.Jq.TransformNormal(N,S))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]));const D=new d.Jq(0,K,0),c=d.Matrix.RotationX(Math.PI/2);l=l.concat(X[4].map((N=>d.Jq.TransformNormal(N,c).add(D))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),T=T.concat(P[4].map((N=>d.Jq.TransformNormal(N,c))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[]));const L=d.Matrix.RotationX(-Math.PI/2);l=l.concat(X[5].map((N=>d.Jq.TransformNormal(N,L).Qq(D))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),T=T.concat(P[5].map((N=>d.Jq.TransformNormal(N,L))).map((N=>[N.x,N.y,N.z])).reduce(((N,q)=>N.concat(q)),[])),a.c._ComputeSides(r,l,p,T,z);const G=new a.c;if(G.indices=p,G.zN=l,G.pN=T,G.XN=z,C){const N=r===a.c.DOUBLESIDE?s.concat(s):s;G.sN=N}return G}function v(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new U.b(N,C);q.sideOrientation=U.b._GetDefaultSideOrientation(q.sideOrientation),d._originalBuilderSideOrientation=q.sideOrientation;return Q(q).MN(d,q.updatable),d}a.c.CreateTiledPlane=Z;a.c.CreateTiledBox=Q;var r=C(12494),O=C(11364),K=C(11329);function i(N){const q=N.height||2;let C=0===N.diameterTop?0:N.diameterTop||N.diameter||1,W=0===N.diameterBottom?0:N.diameterBottom||N.diameter||1;C=C||1e-5,W=W||1e-5;const w=0|(N.tessellation||24),A=0|(N.subdivisions||1),n=!!N.hasRings,t=!!N.enclose,Z=0===N.cap?0:N.cap||U.b.CAP_ALL,J=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,Q=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE,v=N.faceUV||new Array(3),r=N.faceColors,O=2+(1+(1!==J&&t?2:0))*(n?A:1);let i;for(i=0;i<O;i++)r&&void 0===r[i]&&(r[i]=new V.md(1,1,1,1));for(i=0;i<O;i++)v&&void 0===v[i]&&(v[i]=new d.Vector4(0,0,1,1));const I=[],j=[],l=[],T=[],z=[],p=2*Math.PI*J/w;let s,X,P;const M=(W-C)/2/q,Y=d.Jq.Zero(),E=d.Jq.Zero(),H=d.Jq.Zero(),e=d.Jq.Zero(),b=d.Jq.Zero(),o=K.c.Y;let S,D,c,L=1,G=1,h=0,B=0;for(S=0;S<=A;S++)for(X=S/A,P=(X*(C-W)+W)/2,L=n&&0!==S&&S!==A?2:1,c=0;c<L;c++){for(n&&(G+=c),t&&(G+=2*c),D=0;D<=w;D++)s=D*p,Y.x=Math.cos(-s)*P,Y.y=-q/2+X*q,Y.z=Math.sin(-s)*P,0===C&&S===A?(E.x=l[l.length-3*(w+1)],E.y=l[l.length-3*(w+1)+1],E.z=l[l.length-3*(w+1)+2]):(E.x=Y.x,E.z=Y.z,E.y=Math.sqrt(E.x*E.x+E.z*E.z)*M,E.normalize()),0===D&&(H.U(Y),e.U(E)),j.push(Y.x,Y.y,Y.z),l.push(E.x,E.y,E.z),B=n?h!==G?v[G].y:v[G].w:v[G].y+(v[G].w-v[G].y)*X,T.push(v[G].x+(v[G].z-v[G].x)*D/w,F.d?1-B:B),r&&z.push(r[G].r,r[G].g,r[G].b,r[G].a);1!==J&&t&&(j.push(Y.x,Y.y,Y.z),j.push(0,Y.y,0),j.push(0,Y.y,0),j.push(H.x,H.y,H.z),d.Jq.CrossToRef(o,E,b),b.normalize(),l.push(b.x,b.y,b.z,b.x,b.y,b.z),d.Jq.CrossToRef(e,o,b),b.normalize(),l.push(b.x,b.y,b.z,b.x,b.y,b.z),B=n?h!==G?v[G+1].y:v[G+1].w:v[G+1].y+(v[G+1].w-v[G+1].y)*X,T.push(v[G+1].x,F.d?1-B:B),T.push(v[G+1].z,F.d?1-B:B),B=n?h!==G?v[G+2].y:v[G+2].w:v[G+2].y+(v[G+2].w-v[G+2].y)*X,T.push(v[G+2].x,F.d?1-B:B),T.push(v[G+2].z,F.d?1-B:B),r&&(z.push(r[G+1].r,r[G+1].g,r[G+1].b,r[G+1].a),z.push(r[G+1].r,r[G+1].g,r[G+1].b,r[G+1].a),z.push(r[G+2].r,r[G+2].g,r[G+2].b,r[G+2].a),z.push(r[G+2].r,r[G+2].g,r[G+2].b,r[G+2].a))),h!==G&&(h=G)}const y=1!==J&&t?w+4:w;for(S=0,G=0;G<A;G++){let N=0,q=0,C=0,d=0;for(D=0;D<w;D++)N=S*(y+1)+D,q=(S+1)*(y+1)+D,C=S*(y+1)+(D+1),d=(S+1)*(y+1)+(D+1),I.push(N,q,C),I.push(d,C,q);1!==J&&t&&(I.push(N+2,q+2,C+2),I.push(d+2,C+2,q+2),I.push(N+4,q+4,C+4),I.push(d+4,C+4,q+4)),S=n?S+2:S+1}const R=N=>{const U=N?C/2:W/2;if(0===U)return;let a,A,n;const t=N?v[O-1]:v[0];let V=null;r&&(V=N?r[O-1]:r[0]);const Z=j.length/3,Q=N?q/2:-q/2,K=new d.Jq(0,Q,0);j.push(K.x,K.y,K.z),l.push(0,N?1:-1,0);const i=t.y+.5*(t.w-t.y);T.push(t.x+.5*(t.z-t.x),F.d?1-i:i),V&&z.push(V.r,V.g,V.b,V.a);const p=new d.Vector2(.5,.5);for(n=0;n<=w;n++){a=2*Math.PI*n*J/w;const q=Math.cos(-a),C=Math.sin(-a);A=new d.Jq(q*U,Q,C*U);const W=new d.Vector2(q*p.x+.5,C*p.y+.5);j.push(A.x,A.y,A.z),l.push(0,N?1:-1,0);const Z=t.y+(t.w-t.y)*W.y;T.push(t.x+(t.z-t.x)*W.x,F.d?1-Z:Z),V&&z.push(V.r,V.g,V.b,V.a)}for(n=0;n<w;n++)N?(I.push(Z),I.push(Z+(n+2)),I.push(Z+(n+1))):(I.push(Z),I.push(Z+(n+1)),I.push(Z+(n+2)))};Z!==U.b.CAP_START&&Z!==U.b.CAP_ALL||R(!1),Z!==U.b.CAP_END&&Z!==U.b.CAP_ALL||R(!0),a.c._ComputeSides(Q,j,I,l,T,N.frontUVs,N.backUVs);const u=new a.c;return u.indices=I,u.zN=j,u.pN=l,u.XN=T,r&&(u.sN=z),u}function I(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const d=new U.b(N,C);q.sideOrientation=U.b._GetDefaultSideOrientation(q.sideOrientation),d._originalBuilderSideOrientation=q.sideOrientation;return i(q).MN(d,q.updatable),d}function j(N){const q=[],C=[],U=[],W=[],w=N.diameter||1,A=N.thickness||.5,n=0|(N.tessellation||16),t=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE,V=n+1;for(let a=0;a<=n;a++){const N=a/n,t=a*Math.PI*2/n-Math.PI/2,Z=d.Matrix.Translation(w/2,0,0).multiply(d.Matrix.RotationY(t));for(let w=0;w<=n;w++){const t=1-w/n,J=w*Math.PI*2/n+Math.PI,Q=Math.cos(J),v=Math.sin(J);let r=new d.Jq(Q,v,0),O=r.scale(A/2);const K=new d.Vector2(N,t);O=d.Jq.TransformCoordinates(O,Z),r=d.Jq.TransformNormal(r,Z),C.push(O.x,O.y,O.z),U.push(r.x,r.y,r.z),W.push(K.x,F.d?1-K.y:K.y);const i=(a+1)%V,I=(w+1)%V;q.push(a*V+w),q.push(a*V+I),q.push(i*V+w),q.push(a*V+I),q.push(i*V+I),q.push(i*V+w)}}a.c._ComputeSides(t,C,q,U,W,N.frontUVs,N.backUVs);const Z=new a.c;return Z.indices=q,Z.zN=C,Z.pN=U,Z.XN=W,Z}function l(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const d=new U.b(N,C);q.sideOrientation=U.b._GetDefaultSideOrientation(q.sideOrientation),d._originalBuilderSideOrientation=q.sideOrientation;return j(q).MN(d,q.updatable),d}a.c.CreateCylinder=i,U.b.CreateCylinder=(N,q,C,d,W,a,F,w,A)=>{void 0!==F&&F instanceof O.c||(void 0!==F&&(A=w||U.b.DEFAULTSIDE,w=F),F=a,a=1);return I(N,{height:q,diameterTop:C,diameterBottom:d,tessellation:W,subdivisions:a,sideOrientation:A,updatable:w},F)};function T(N){const q=[],C=[],U=[],W=[],w=N.radius||2,A=N.tube||.5,n=N.radialSegments||32,t=N.tubularSegments||32,V=N.p||2,Z=N.q||3,J=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE,Q=N=>{const q=Math.cos(N),C=Math.sin(N),U=Z/V*N,W=Math.cos(U),a=w*(2+W)*.5*q,F=w*(2+W)*C*.5,A=w*Math.sin(U)*.5;return new d.Jq(a,F,A)};let v,r;for(v=0;v<=n;v++){const N=v%n/n*2*V*Math.PI,q=Q(N),U=Q(N+.01),a=U.Qq(q);let w=U.add(q);const Z=d.Jq.Cross(a,w);for(w=d.Jq.Cross(Z,a),Z.normalize(),w.normalize(),r=0;r<t;r++){const N=r%t/t*2*Math.PI,d=-A*Math.cos(N),U=A*Math.sin(N);C.push(q.x+d*w.x+U*Z.x),C.push(q.y+d*w.y+U*Z.y),C.push(q.z+d*w.z+U*Z.z),W.push(v/n),W.push(F.d?1-r/t:r/t)}}for(v=0;v<n;v++)for(r=0;r<t;r++){const N=(r+1)%t,C=v*t+r,d=(v+1)*t+r,U=(v+1)*t+N,W=v*t+N;q.push(W),q.push(d),q.push(C),q.push(W),q.push(U),q.push(d)}a.c.ComputeNormals(C,q,U),a.c._ComputeSides(J,C,q,U,W,N.frontUVs,N.backUVs);const O=new a.c;return O.indices=q,O.zN=C,O.pN=U,O.XN=W,O}function z(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const d=new U.b(N,C);q.sideOrientation=U.b._GetDefaultSideOrientation(q.sideOrientation),d._originalBuilderSideOrientation=q.sideOrientation;return T(q).MN(d,q.updatable),d}a.c.CreateTorus=j,U.b.CreateTorus=(N,q,C,d,U,W,a)=>l(N,{diameter:q,thickness:C,tessellation:d,sideOrientation:a,updatable:W},U);a.c.CreateTorusKnot=T,U.b.CreateTorusKnot=(N,q,C,d,U,W,a,F,w,A)=>z(N,{radius:q,tube:C,radialSegments:d,tubularSegments:U,p:W,q:a,sideOrientation:A,updatable:w},F);var p=C(12989),s=C(11685),X=C(11343);function P(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=q.path,W=q.shape,a=q.scale||1,F=q.rotation||0,w=0===q.cap?0:q.cap||U.b.NO_CAP,A=q.updatable,n=U.b._GetDefaultSideOrientation(q.sideOrientation),t=q.instance||null,V=q.invertUV||!1,Z=q.closeShape||!1,J=q.closePath||!1,Q=q.capFunction||null;return Y(N,W,d,a,F,null,null,J,Z,w,!1,C,!!A,n,t,V,q.frontUVs||null,q.backUVs||null,q.firstNormal||null,!!q.adjustFrame,Q)}function M(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=q.path,W=q.shape,a=q.scaleFunction||(()=>1),F=q.rotationFunction||(()=>0),w=q.closePath||q.ribbonCloseArray||!1,A=q.closeShape||q.ribbonClosePath||!1,n=0===q.cap?0:q.cap||U.b.NO_CAP,t=q.updatable,V=q.firstNormal||null,Z=q.adjustFrame||!1,J=U.b._GetDefaultSideOrientation(q.sideOrientation),Q=q.instance,v=q.invertUV||!1,r=q.capFunction||null;return Y(N,W,d,null,null,a,F,w,A,n,!0,C,!!t,J,Q||null,v,q.frontUVs||null,q.backUVs||null,V,Z,r||null)}function Y(N,q,C,W,a,F,w,n,t,V,Z,J,Q,v,r,O,K,i,I,j,l){const T=(N,q,C,W,a,F,w,A,n,t,V)=>{const Z=C.getTangents(),J=C.getNormals(),Q=C.getBinormals(),v=C.getDistances();if(V)for(let U=0;U<Z.length;U++)if(0==Z[U].x&&0==Z[U].y&&0==Z[U].z&&Z[U].U(Z[U-1]),0==J[U].x&&0==J[U].y&&0==J[U].z&&J[U].U(J[U-1]),0==Q[U].x&&0==Q[U].y&&0==Q[U].z&&Q[U].U(Q[U-1]),U>0){let N=Z[U-1];d.Jq.Dot(N,Z[U])<0&&Z[U].scaleInPlace(-1),N=J[U-1],d.Jq.Dot(N,J[U])<0&&J[U].scaleInPlace(-1),N=Q[U-1],d.Jq.Dot(N,Q[U])<0&&Q[U].scaleInPlace(-1)}let r=0;const O=t&&A?A:()=>null!==F?F:0,K=t&&w?w:()=>null!==a?a:1;let i=n===U.b.NO_CAP||n===U.b.CAP_END?0:2;const I=d.TmpVectors.Matrix[0];for(let U=0;U<q.length;U++){const C=[],a=O(U,v[U]),F=K(U,v[U]);d.Matrix.RotationAxisToRef(Z[U],r,I);for(let W=0;W<N.length;W++){const a=Z[U].scale(N[W].z).add(J[U].scale(N[W].x)).add(Q[U].scale(N[W].y)),w=d.Jq.Zero();d.Jq.TransformCoordinatesToRef(a,I,w),w.scaleInPlace(F).addInPlace(q[U]),C[W]=w}W[i]=C,r+=a,i++}const j=l||(N=>{const q=Array(),C=d.Jq.Zero();let U;for(U=0;U<N.length;U++)C.addInPlace(N[U]);for(C.scaleInPlace(1/N.length),U=0;U<N.length;U++)q.push(C);return q});switch(n){case U.b.NO_CAP:break;case U.b.CAP_START:W[0]=j(W[2]),W[1]=W[2];break;case U.b.CAP_END:W[i]=W[i-1],W[i+1]=j(W[i-1]);break;case U.b.CAP_ALL:W[0]=j(W[2]),W[1]=W[2],W[i]=W[i-1],W[i+1]=j(W[i-1])}return W};let z,p;if(r){const N=r._creationDataStorage;return z=I?N.path3D.update(C,I):N.path3D.update(C),p=T(q,C,N.path3D,N.pathArray,W,a,F,w,N.cap,Z,j),r=A("",{pathArray:p,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:r},J||void 0)}z=I?new X.j(C,I):new X.j(C);p=T(q,C,z,new Array,W,a,F,w,V=V<0||V>3?0:V,Z,j);const s=A(N,{pathArray:p,closeArray:n,closePath:t,updatable:Q,sideOrientation:v,invertUV:O,frontUVs:K||void 0,backUVs:i||void 0},J);return s._creationDataStorage.pathArray=p,s._creationDataStorage.path3D=z,s._creationDataStorage.cap=V,s}function E(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=q.arc?q.arc<=0||q.arc>1?1:q.arc:1,a=void 0===q.closed||q.closed,F=q.shape,w=q.radius||1,n=q.tessellation||64,t=q.clip||0,V=q.updatable,Z=U.b._GetDefaultSideOrientation(q.sideOrientation),J=q.cap||U.b.NO_CAP,Q=2*Math.PI,v=[],r=q.invertUV||!1;let O=0,K=0;const i=Q/n*W;let I,j;for(O=0;O<=n-t;O++){for(j=[],J!=U.b.CAP_START&&J!=U.b.CAP_ALL||(j.push(new d.Jq(0,F[0].y,0)),j.push(new d.Jq(Math.cos(O*i)*F[0].x*w,F[0].y,Math.sin(O*i)*F[0].x*w))),K=0;K<F.length;K++)I=new d.Jq(Math.cos(O*i)*F[K].x*w,F[K].y,Math.sin(O*i)*F[K].x*w),j.push(I);J!=U.b.CAP_END&&J!=U.b.CAP_ALL||(j.push(new d.Jq(Math.cos(O*i)*F[F.length-1].x*w,F[F.length-1].y,Math.sin(O*i)*F[F.length-1].x*w)),j.push(new d.Jq(0,F[F.length-1].y,0))),v.push(j)}return A(N,{pathArray:v,closeArray:a,sideOrientation:Z,updatable:V,invertUV:r,frontUVs:q.frontUVs,backUVs:q.backUVs},C)}U.b.ExtrudeShape=function(N,q,C,d,W,a){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7?arguments[7]:void 0,A=arguments.length>8?arguments[8]:void 0,n=arguments.length>9?arguments[9]:void 0;return P(N,{shape:q,path:C,scale:d,rotation:W,cap:0===a?0:a||U.b.NO_CAP,sideOrientation:A,instance:n,updatable:w},F)},U.b.ExtrudeShapeCustom=(N,q,C,d,W,a,F,w,A,n,t,V)=>M(N,{shape:q,path:C,scaleFunction:d,rotationFunction:W,ribbonCloseArray:a,ribbonClosePath:F,cap:0===w?0:w||U.b.NO_CAP,sideOrientation:t,instance:V,updatable:n},A);U.b.CreateLathe=(N,q,C,d,U,W,a)=>E(N,{shape:q,radius:C,tessellation:d,sideOrientation:a,updatable:W},U);var H=C(12406),e=C(12358);function b(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=q.path;let a=q.instance,F=1;void 0!==q.radius?F=q.radius:a&&(F=a._creationDataStorage.radius);const w=q.tessellation||64,n=q.radiusFunction||null;let t=q.cap||U.b.NO_CAP;const V=q.invertUV||!1,Z=q.updatable,J=U.b._GetDefaultSideOrientation(q.sideOrientation);q.arc=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1;const Q=(N,q,C,W,a,F,w,A)=>{const n=q.getTangents(),t=q.getNormals(),V=q.getDistances(),Z=2*Math.PI/a*A,J=F||(()=>W);let Q,v,r,O;const K=d.TmpVectors.Matrix[0];let i=w===U.b.NO_CAP||w===U.b.CAP_END?0:2;for(let U=0;U<N.length;U++){v=J(U,V[U]),Q=Array(),r=t[U];for(let q=0;q<a;q++)d.Matrix.RotationAxisToRef(n[U],Z*q,K),O=Q[q]?Q[q]:d.Jq.Zero(),d.Jq.TransformCoordinatesToRef(r,K,O),O.scaleInPlace(v).addInPlace(N[U]),Q[q]=O;C[i]=Q,i++}const I=(q,C)=>{const d=Array();for(let U=0;U<q;U++)d.push(N[C]);return d};switch(w){case U.b.NO_CAP:break;case U.b.CAP_START:C[0]=I(a,0),C[1]=C[2].slice(0);break;case U.b.CAP_END:C[i]=C[i-1].slice(0),C[i+1]=I(a,N.length-1);break;case U.b.CAP_ALL:C[0]=I(a,0),C[1]=C[2].slice(0),C[i]=C[i-1].slice(0),C[i+1]=I(a,N.length-1)}return C};let v,r;if(a){const N=a._creationDataStorage,C=q.arc||N.arc;return v=N.path3D.update(W),r=Q(W,v,N.pathArray,F,N.tessellation,n,N.cap,C),a=A("",{pathArray:r,instance:a}),N.path3D=v,N.pathArray=r,N.arc=C,N.radius=F,a}v=new X.j(W);t=t<0||t>3?0:t,r=Q(W,v,new Array,F,w,n,t,q.arc);const O=A(N,{pathArray:r,closePath:!0,closeArray:!1,updatable:Z,sideOrientation:J,invertUV:V,frontUVs:q.frontUVs,backUVs:q.backUVs},C);return O._creationDataStorage.pathArray=r,O._creationDataStorage.path3D=v,O._creationDataStorage.tessellation=w,O._creationDataStorage.cap=t,O._creationDataStorage.arc=q.arc,O._creationDataStorage.radius=F,O}function o(N){const q=[];q[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},q[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},q[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},q[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},q[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},q[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},q[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},q[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},q[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},q[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},q[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},q[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},q[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},q[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},q[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const C=N.type&&(N.type<0||N.type>=q.length)?0:N.type||0,U=N.size,W=N.sizeX||U||1,w=N.sizeY||U||1,A=N.sizeZ||U||1,n=N.custom||q[C],t=n.face.length,Z=N.faceUV||new Array(t),J=N.faceColors,Q=void 0===N.flat||N.flat,v=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE,r=[],O=[],K=[],i=[],I=[];let j=0,l=0;const T=[];let z,p,s,X,P,M,Y=0,E=0;if(Q)for(E=0;E<t;E++)J&&void 0===J[E]&&(J[E]=new V.md(1,1,1,1)),Z&&void 0===Z[E]&&(Z[E]=new d.Vector4(0,0,1,1));if(Q)for(E=0;E<t;E++){const N=n.face[E].length;for(s=2*Math.PI/N,X=.5*Math.tan(s/2),P=.5,Y=0;Y<N;Y++)r.push(n.vertex[n.face[E][Y]][0]*W,n.vertex[n.face[E][Y]][1]*w,n.vertex[n.face[E][Y]][2]*A),T.push(j),j++,z=Z[E].x+(Z[E].z-Z[E].x)*(.5+X),p=Z[E].y+(Z[E].w-Z[E].y)*(P-.5),i.push(z,F.d?1-p:p),M=X*Math.cos(s)-P*Math.sin(s),P=X*Math.sin(s)+P*Math.cos(s),X=M,J&&I.push(J[E].r,J[E].g,J[E].b,J[E].a);for(Y=0;Y<N-2;Y++)O.push(T[0+l],T[Y+2+l],T[Y+1+l]);l+=N}else{for(Y=0;Y<n.vertex.length;Y++)r.push(n.vertex[Y][0]*W,n.vertex[Y][1]*w,n.vertex[Y][2]*A),i.push(0,F.d?1:0);for(E=0;E<t;E++)for(Y=0;Y<n.face[E].length-2;Y++)O.push(n.face[E][0],n.face[E][Y+2],n.face[E][Y+1])}a.c.ComputeNormals(r,O,K),a.c._ComputeSides(v,r,O,K,i,N.frontUVs,N.backUVs);const H=new a.c;return H.zN=r,H.indices=O,H.pN=K,H.XN=i,J&&Q&&(H.sN=I),H}function S(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new U.b(N,C);q.sideOrientation=U.b._GetDefaultSideOrientation(q.sideOrientation),d._originalBuilderSideOrientation=q.sideOrientation;return o(q).MN(d,q.updatable),d}U.b.CreateTube=(N,q,C,d,U,W,a,F,w,A)=>b(N,{path:q,radius:C,tessellation:d,radiusFunction:U,arc:1,cap:W,updatable:F,sideOrientation:w,instance:A},a);function D(N){const q=N.sideOrientation||a.c.DEFAULTSIDE,C=N.radius||1,U=void 0===N.flat||N.flat,W=0|(N.subdivisions||4),w=N.radiusX||C,A=N.radiusY||C,n=N.radiusZ||C,t=(1+Math.sqrt(5))/2,V=[-1,t,-0,1,t,0,-1,-t,0,1,-t,0,0,-1,-t,0,1,-t,0,-1,t,0,1,t,t,0,1,t,0,-1,-t,0,1,-t,0,-1],Z=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],J=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],Q=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],v=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],r=[],O=[],K=[],i=[];let I=0;const j=new Array(3),l=new Array(3);let T;for(T=0;T<3;T++)j[T]=d.Jq.Zero(),l[T]=d.Vector2.Zero();for(let a=0;a<20;a++){for(T=0;T<3;T++){const N=Z[3*a+T];j[T].hd(V[3*J[N]],V[3*J[N]+1],V[3*J[N]+2]),j[T].normalize(),l[T].hd(.134765625*Q[2*N]+.05859375+-.0390625*v[a],.2333984375*Q[2*N+1]+.025390625+.01953125*v[a])}const N=(N,q,C,a)=>{const t=d.Jq.Lerp(j[0],j[2],q/W),V=d.Jq.Lerp(j[1],j[2],q/W),Z=W===q?j[2]:d.Jq.Lerp(t,V,N/(W-q));let J;if(Z.normalize(),U){const N=d.Jq.Lerp(j[0],j[2],a/W),q=d.Jq.Lerp(j[1],j[2],a/W);J=d.Jq.Lerp(N,q,C/(W-a))}else J=new d.Jq(Z.x,Z.y,Z.z);J.x/=w,J.y/=A,J.z/=n,J.normalize();const Q=d.Vector2.Lerp(l[0],l[2],q/W),v=d.Vector2.Lerp(l[1],l[2],q/W),T=W===q?l[2]:d.Vector2.Lerp(Q,v,N/(W-q));O.push(Z.x*w,Z.y*A,Z.z*n),K.push(J.x,J.y,J.z),i.push(T.x,F.d?1-T.y:T.y),r.push(I),I++};for(let q=0;q<W;q++)for(let C=0;C+q<W;C++)N(C,q,C+1/3,q+1/3),N(C+1,q,C+1/3,q+1/3),N(C,q+1,C+1/3,q+1/3),C+q+1<W&&(N(C+1,q,C+2/3,q+2/3),N(C+1,q+1,C+2/3,q+2/3),N(C,q+1,C+2/3,q+2/3))}a.c._ComputeSides(q,O,r,K,i,N.frontUVs,N.backUVs);const z=new a.c;return z.indices=r,z.zN=O,z.pN=K,z.XN=i,z}function c(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new U.b(N,C);q.sideOrientation=U.b._GetDefaultSideOrientation(q.sideOrientation),d._originalBuilderSideOrientation=q.sideOrientation;return D(q).MN(d,q.updatable),d}a.c.CreatePolyhedron=o,U.b.CreatePolyhedron=(N,q,C)=>S(N,q,C);a.c.CreateIcoSphere=D,U.b.CreateIcoSphere=(N,q,C)=>c(N,q,C);var L=C(11142);const G=new d.Jq(1,0,0),h=new d.Jq(-1,0,0),B=new d.Jq(0,1,0),y=new d.Jq(0,-1,0),R=new d.Jq(0,0,1),u=new d.Jq(0,0,-1);class m{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.Jq.Zero(),q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.Jq.Up(),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.Vector2.Zero(),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=N,this.normal=q,this.uv=C,this.vertexIdx=U,this.vertexIdxForBones=W,this.localPositionOverride=a,this.localNormalOverride=F,this.matrixIndicesOverride=w,this.matrixWeightsOverride=A}clone(){var N,q,C,d;return new m(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(N=this.localPositionOverride)||void 0===N?void 0:N.slice(),null===(q=this.localNormalOverride)||void 0===q?void 0:q.slice(),null===(C=this.matrixIndicesOverride)||void 0===C?void 0:C.slice(),null===(d=this.matrixWeightsOverride)||void 0===d?void 0:d.slice())}}function f(N,q,C){var w,A,n,t,V;const Z=!!q.skeleton,J=!(null===(w=q.morphTargetManager)||void 0===w||!w.numTargets),Q=C.localMode||Z,v=q.od(),r=Z||J?q.sF(!0,!0):q.getVerticesData(W.g.PositionKind),O=Z||J?q.getNormalsData(!0,!0):q.getVerticesData(W.g.NormalKind),K=Q?Z?q.getVerticesData(W.g.PositionKind):r:null,i=Q?Z?q.getVerticesData(W.g.NormalKind):O:null,I=q.getVerticesData(W.g.UVKind),j=Z?q.getVerticesData(W.g.MatricesIndicesKind):null,l=Z?q.getVerticesData(W.g.MatricesWeightsKind):null,T=Z?q.getVerticesData(W.g.MatricesIndicesExtraKind):null,z=Z?q.getVerticesData(W.g.MatricesWeightsExtraKind):null,p=C.position||d.Jq.Zero();let s=C.normal||d.Jq.Up();const X=C.size||d.Jq.One(),P=C.angle||0;if(!s){const N=new d.Jq(0,0,1),C=q.lN().activeCamera,U=d.Jq.TransformCoordinates(N,C.getWorldMatrix());s=C.globalPosition.Qq(U)}const M=-Math.atan2(s.z,s.x)-Math.PI/2,Y=Math.sqrt(s.x*s.x+s.z*s.z),E=Math.atan2(s.y,Y),H=new a.c;H.indices=[],H.zN=[],H.pN=[],H.XN=[],H.matricesIndices=Z?[]:null,H.matricesWeights=Z?[]:null,H.matricesIndicesExtra=T?[]:null,H.matricesWeightsExtra=z?[]:null;let e=0;const b=(N,q)=>{const U=new m;if(!v||!r||!O)return U;const W=v[N];if(U.vertexIdx=3*W,U.vertexIdxForBones=4*W,U.position=new d.Jq(r[3*W],r[3*W+1],r[3*W+2]),d.Jq.TransformCoordinatesToRef(U.position,q,U.position),U.normal=new d.Jq(O[3*W],O[3*W+1],O[3*W+2]),d.Jq.TransformNormalToRef(U.normal,q,U.normal),C.captureUVS&&I){const N=I[2*W+1];U.uv=new d.Vector2(I[2*W],F.d?1-N:N)}return U},o=[0,0,0,0],S=(N,q)=>{if(0===N.length)return N;const C=.5*Math.abs(d.Jq.Dot(X,q)),U=(N,q,C,d)=>{for(let U=0;U<d;++U)if(N[C+U]===q)return C+U;return-1},W=(N,W)=>{const a=d.Jq.GetClipFactor(N.position,W.position,q,C);let F=o,w=o;if(j&&l){const q=N.matrixIndicesOverride?0:N.vertexIdxForBones,C=N.matrixIndicesOverride??j,d=N.matrixWeightsOverride??l,A=W.matrixIndicesOverride?0:W.vertexIdxForBones,n=W.matrixIndicesOverride??j,t=W.matrixWeightsOverride??l;F=[0,0,0,0],w=[0,0,0,0];let V=0;for(let N=0;N<4;++N)if(d[q+N]>0){const W=U(n,C[q+N],A,4);F[V]=C[q+N],w[V]=(0,L.Lerp)(d[q+N],W>=0?t[W]:0,a),V++}for(let N=0;N<4&&V<4;++N){const d=n[A+N];-1===U(C,d,q,4)&&(F[V]=d,w[V]=(0,L.Lerp)(0,t[A+N],a),V++)}const Z=w[0]+w[1]+w[2]+w[3];w[0]/=Z,w[1]/=Z,w[2]/=Z,w[3]/=Z}const A=N.localPositionOverride?N.localPositionOverride[0]:(null===K||void 0===K?void 0:K[N.vertexIdx])??0,n=N.localPositionOverride?N.localPositionOverride[1]:(null===K||void 0===K?void 0:K[N.vertexIdx+1])??0,t=N.localPositionOverride?N.localPositionOverride[2]:(null===K||void 0===K?void 0:K[N.vertexIdx+2])??0,V=W.localPositionOverride?W.localPositionOverride[0]:(null===K||void 0===K?void 0:K[W.vertexIdx])??0,Z=W.localPositionOverride?W.localPositionOverride[1]:(null===K||void 0===K?void 0:K[W.vertexIdx+1])??0,J=W.localPositionOverride?W.localPositionOverride[2]:(null===K||void 0===K?void 0:K[W.vertexIdx+2])??0,Q=N.localNormalOverride?N.localNormalOverride[0]:(null===i||void 0===i?void 0:i[N.vertexIdx])??0,v=N.localNormalOverride?N.localNormalOverride[1]:(null===i||void 0===i?void 0:i[N.vertexIdx+1])??0,r=N.localNormalOverride?N.localNormalOverride[2]:(null===i||void 0===i?void 0:i[N.vertexIdx+2])??0,O=Q+((W.localNormalOverride?W.localNormalOverride[0]:(null===i||void 0===i?void 0:i[W.vertexIdx])??0)-Q)*a,I=v+((W.localNormalOverride?W.localNormalOverride[1]:(null===i||void 0===i?void 0:i[W.vertexIdx+1])??0)-v)*a,T=r+((W.localNormalOverride?W.localNormalOverride[2]:(null===i||void 0===i?void 0:i[W.vertexIdx+2])??0)-r)*a,z=Math.sqrt(O*O+I*I+T*T);return new m(d.Jq.Lerp(N.position,W.position,a),d.Jq.Lerp(N.normal,W.normal,a).normalize(),d.Vector2.Lerp(N.uv,W.uv,a),-1,-1,K?[A+(V-A)*a,n+(Z-n)*a,t+(J-t)*a]:null,i?[O/z,I/z,T/z]:null,F,w)};let a=null;N.length>3&&(a=[]);for(let F=0;F<N.length;F+=3){let U=0,w=null,A=null,n=null,t=null;const V=d.Jq.Dot(N[F].position,q)-C>0,Z=d.Jq.Dot(N[F+1].position,q)-C>0,J=d.Jq.Dot(N[F+2].position,q)-C>0;switch(U=(V?1:0)+(Z?1:0)+(J?1:0),U){case 0:N.length>3?(a.push(N[F]),a.push(N[F+1]),a.push(N[F+2])):a=N;break;case 1:if(a=a??new Array,V&&(w=N[F+1],A=N[F+2],n=W(N[F],w),t=W(N[F],A)),Z){w=N[F],A=N[F+2],n=W(N[F+1],w),t=W(N[F+1],A),a.push(n),a.push(A.clone()),a.push(w.clone()),a.push(A.clone()),a.push(n.clone()),a.push(t);break}J&&(w=N[F],A=N[F+1],n=W(N[F+2],w),t=W(N[F+2],A)),w&&A&&n&&t&&(a.push(w.clone()),a.push(A.clone()),a.push(n),a.push(t),a.push(n.clone()),a.push(A.clone()));break;case 2:a=a??new Array,V||(w=N[F].clone(),A=W(w,N[F+1]),n=W(w,N[F+2]),a.push(w),a.push(A),a.push(n)),Z||(w=N[F+1].clone(),A=W(w,N[F+2]),n=W(w,N[F]),a.push(w),a.push(A),a.push(n)),J||(w=N[F+2].clone(),A=W(w,N[F]),n=W(w,N[F+1]),a.push(w),a.push(A),a.push(n))}}return a},D=q instanceof U.b?q:null,c=null===D||void 0===D?void 0:D._thinInstanceDataStorage.matrixData,f=(null===D||void 0===D?void 0:D.xd)||1,k=d.TmpVectors.Matrix[0];k.U(d.Matrix.IdentityReadOnly);for(let U=0;U<f;++U){if(null!==D&&void 0!==D&&D.hasThinInstances&&c){const N=16*U;k.setRowFromFloats(0,c[N+0],c[N+1],c[N+2],c[N+3]),k.setRowFromFloats(1,c[N+4],c[N+5],c[N+6],c[N+7]),k.setRowFromFloats(2,c[N+8],c[N+9],c[N+10],c[N+11]),k.setRowFromFloats(3,c[N+12],c[N+13],c[N+14],c[N+15])}const N=d.Matrix.RotationYawPitchRoll(M,E,P).multiply(d.Matrix.Translation(p.x,p.y,p.z)),W=d.Matrix.Invert(N),a=q.getWorldMatrix(),w=k.multiply(a).multiply(W),A=new Array(3);for(let q=0;q<v.length;q+=3){let N=A;if(N[0]=b(q,w),N[1]=b(q+1,w),N[2]=b(q+2,w),!(C.cullBackFaces&&-N[0].normal.z<=0&&-N[1].normal.z<=0&&-N[2].normal.z<=0)&&(N=S(N,G),N&&(N=S(N,h),N&&(N=S(N,B),N&&(N=S(N,y),N&&(N=S(N,R),N&&(N=S(N,u),N)))))))for(let q=0;q<N.length;q++){const d=N[q];if(H.indices.push(e),Q?(d.localPositionOverride?(H.zN[3*e]=d.localPositionOverride[0],H.zN[3*e+1]=d.localPositionOverride[1],H.zN[3*e+2]=d.localPositionOverride[2]):K&&(H.zN[3*e]=K[d.vertexIdx],H.zN[3*e+1]=K[d.vertexIdx+1],H.zN[3*e+2]=K[d.vertexIdx+2]),d.localNormalOverride?(H.pN[3*e]=d.localNormalOverride[0],H.pN[3*e+1]=d.localNormalOverride[1],H.pN[3*e+2]=d.localNormalOverride[2]):i&&(H.pN[3*e]=i[d.vertexIdx],H.pN[3*e+1]=i[d.vertexIdx+1],H.pN[3*e+2]=i[d.vertexIdx+2])):(d.position.toArray(H.zN,3*e),d.normal.toArray(H.pN,3*e)),H.matricesIndices&&H.matricesWeights&&(d.matrixIndicesOverride?(H.matricesIndices[4*e]=d.matrixIndicesOverride[0],H.matricesIndices[4*e+1]=d.matrixIndicesOverride[1],H.matricesIndices[4*e+2]=d.matrixIndicesOverride[2],H.matricesIndices[4*e+3]=d.matrixIndicesOverride[3]):(j&&(H.matricesIndices[4*e]=j[d.vertexIdxForBones],H.matricesIndices[4*e+1]=j[d.vertexIdxForBones+1],H.matricesIndices[4*e+2]=j[d.vertexIdxForBones+2],H.matricesIndices[4*e+3]=j[d.vertexIdxForBones+3]),T&&H.matricesIndicesExtra&&(H.matricesIndicesExtra[4*e]=T[d.vertexIdxForBones],H.matricesIndicesExtra[4*e+1]=T[d.vertexIdxForBones+1],H.matricesIndicesExtra[4*e+2]=T[d.vertexIdxForBones+2],H.matricesIndicesExtra[4*e+3]=T[d.vertexIdxForBones+3])),d.matrixWeightsOverride?(H.matricesWeights[4*e]=d.matrixWeightsOverride[0],H.matricesWeights[4*e+1]=d.matrixWeightsOverride[1],H.matricesWeights[4*e+2]=d.matrixWeightsOverride[2],H.matricesWeights[4*e+3]=d.matrixWeightsOverride[3]):(l&&(H.matricesWeights[4*e]=l[d.vertexIdxForBones],H.matricesWeights[4*e+1]=l[d.vertexIdxForBones+1],H.matricesWeights[4*e+2]=l[d.vertexIdxForBones+2],H.matricesWeights[4*e+3]=l[d.vertexIdxForBones+3]),z&&H.matricesWeightsExtra&&(H.matricesWeightsExtra[4*e]=z[d.vertexIdxForBones],H.matricesWeightsExtra[4*e+1]=z[d.vertexIdxForBones+1],H.matricesWeightsExtra[4*e+2]=z[d.vertexIdxForBones+2],H.matricesWeightsExtra[4*e+3]=z[d.vertexIdxForBones+3]))),C.captureUVS)d.uv.toArray(H.XN,2*e);else{H.XN.push(.5+d.position.x/X.x);const N=.5+d.position.y/X.y;H.XN.push(F.d?1-N:N)}e++}}}0===H.indices.length&&(H.indices=null),0===H.zN.length&&(H.zN=null),0===H.pN.length&&(H.pN=null),0===H.XN.length&&(H.XN=null),0===(null===(A=H.matricesIndices)||void 0===A?void 0:A.length)&&(H.matricesIndices=null),0===(null===(n=H.matricesWeights)||void 0===n?void 0:n.length)&&(H.matricesWeights=null),0===(null===(t=H.matricesIndicesExtra)||void 0===t?void 0:t.length)&&(H.matricesIndicesExtra=null),0===(null===(V=H.matricesWeightsExtra)||void 0===V?void 0:V.length)&&(H.matricesWeightsExtra=null);const g=new U.b(N,q.lN());return H.MN(g),Q?(g.skeleton=q.skeleton,g.parent=q):(g.position=p.clone(),g.rotation=new d.Jq(E,M,P)),g.Ed(!0),g.refreshBoundingInfo(!0,!0),g}function k(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const q=0|Math.max(N.subdivisions?N.subdivisions:2,1),C=0|Math.max(N.tessellation?N.tessellation:16,3),U=Math.max(N.height?N.height:1,0),W=Math.max(N.radius?N.radius:.25,0),w=0|Math.max(N.capSubdivisions?N.capSubdivisions:6,1),A=C,n=q,t=Math.max(N.radiusTop?N.radiusTop:W,0),V=Math.max(N.radiusBottom?N.radiusBottom:W,0),Z=U-(t+V),J=2*Math.PI,Q=Math.max(N.topCapSubdivisions?N.topCapSubdivisions:w,1),v=Math.max(N.bottomCapSubdivisions?N.bottomCapSubdivisions:w,1),r=Math.acos((V-t)/U);let O=[];const K=[],i=[],I=[];let j=0;const l=[],T=.5*Z,z=.5*Math.PI;let p,s;const X=d.Jq.Zero(),P=d.Jq.Zero(),M=Math.cos(r),Y=Math.sin(r),E=new d.Vector2(t*Y,T+t*M).Qq(new d.Vector2(V*Y,V*M-T)).length(),H=t*r+E+V*(z-r);let e=0;for(s=0;s<=Q;s++){const N=[],q=z-r*(s/Q);e+=t*r/Q;const C=Math.cos(q),d=Math.sin(q),U=C*t;for(p=0;p<=A;p++){const q=p/A,W=q*J+0,a=Math.sin(W),w=Math.cos(W);P.x=U*a,P.y=T+d*t,P.z=U*w,K.push(P.x,P.y,P.z),X.set(C*a,d,C*w),i.push(X.x,X.y,X.z),I.push(q,F.d?e/H:1-e/H),N.push(j),j++}l.push(N)}const b=U-t-V+M*t-M*V,o=Y*(V-t)/b;for(s=1;s<=n;s++){const N=[];e+=E/n;const q=Y*(s*(V-t)/n+t);for(p=0;p<=A;p++){const C=p/A,d=C*J+0,U=Math.sin(d),W=Math.cos(d);P.x=q*U,P.y=T+M*t-s*b/n,P.z=q*W,K.push(P.x,P.y,P.z),X.set(U,o,W).normalize(),i.push(X.x,X.y,X.z),I.push(C,F.d?e/H:1-e/H),N.push(j),j++}l.push(N)}for(s=1;s<=v;s++){const N=[],q=z-r-(Math.PI-r)*(s/v);e+=V*r/v;const C=Math.cos(q),d=Math.sin(q),U=C*V;for(p=0;p<=A;p++){const q=p/A,W=q*J+0,a=Math.sin(W),w=Math.cos(W);P.x=U*a,P.y=d*V-T,P.z=U*w,K.push(P.x,P.y,P.z),X.set(C*a,d,C*w),i.push(X.x,X.y,X.z),I.push(q,F.d?e/H:1-e/H),N.push(j),j++}l.push(N)}for(p=0;p<A;p++)for(s=0;s<Q+n+v;s++){const N=l[s][p],q=l[s+1][p],C=l[s+1][p+1],d=l[s][p+1];O.push(N),O.push(q),O.push(d),O.push(q),O.push(C),O.push(d)}if(O=O.reverse(),N.orientation&&!N.orientation.equals(d.Jq.Up())){const q=new d.Matrix;N.orientation.clone().scale(.5*Math.PI).cross(d.Jq.Up()).toQuaternion().toRotationMatrix(q);const C=d.Jq.Zero();for(let N=0;N<K.length;N+=3)C.set(K[N],K[N+1],K[N+2]),d.Jq.TransformCoordinatesToRef(C.clone(),q,C),K[N]=C.x,K[N+1]=C.y,K[N+2]=C.z}const S=new a.c;return S.zN=K,S.pN=i,S.XN=I,S.indices=O,S}function g(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:d.Jq.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new U.b(N,C);return k(q).MN(W,q.updatable),W}U.b.CreateDecal=(N,q,C,d,U,W)=>f(N,q,{position:C,normal:d,size:U,angle:W});U.b.CreateCapsule=(N,q,C)=>g(N,q,C),a.c.CreateCapsule=k;var x=C(10962),NN=C(11129);class qN{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=N,this.y=q,N!==Math.floor(N)&&(N=Math.floor(N),x.c.Warn("x is not an integer, floor(x) used")),q!==Math.floor(q)&&(q=Math.floor(q),x.c.Warn("y is not an integer, floor(y) used"))}clone(){return new qN(this.x,this.y)}rotate60About(N){const q=this.x;return this.x=N.x+N.y-this.y,this.y=q+this.y-N.x,this}rotateNeg60About(N){const q=this.x;return this.x=q+this.y-N.y,this.y=N.x+N.y-q,this}rotate120(N,q){N!==Math.floor(N)&&(N=Math.floor(N),x.c.Warn("m not an integer only floor(m) used")),q!==Math.floor(q)&&(q=Math.floor(q),x.c.Warn("n not an integer only floor(n) used"));const C=this.x;return this.x=N-C-this.y,this.y=q+C,this}rotateNeg120(N,q){N!==Math.floor(N)&&(N=Math.floor(N),x.c.Warn("m is not an integer, floor(m) used")),q!==Math.floor(q)&&(q=Math.floor(q),x.c.Warn("n is not an integer,   floor(n) used"));const C=this.x;return this.x=this.y-q,this.y=N+q-C-this.y,this}toCartesianOrigin(N,q){const C=d.Jq.Zero();return C.x=N.x+2*this.x*q+this.y*q,C.y=N.y+Math.sqrt(3)*this.y*q,C}static Zero(){return new qN(0,0)}}class CN{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new dN("icosahedron","Regular",[[0,NN.h,-1],[-NN.h,1,0],[-1,0,-NN.h],[1,0,-NN.h],[NN.h,1,0],[0,NN.h,1],[-1,0,NN.h],[-NN.h,-1,0],[0,-NN.h,-1],[NN.h,-1,0],[1,0,NN.h],[0,-NN.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let N=12;const q={},C=this.m,d=this.n;let U,W,a,F,w,A=C,n=1,t=0;0!==d&&(A=(0,L.HighestCommonFactor)(C,d)),n=C/A,t=d/A;const V=qN.Zero(),Z=new qN(C,d),J=new qN(-d,C+d),Q=qN.Zero(),v=qN.Zero(),r=qN.Zero();let O,K,i,I,j=[];const l=[],T=this.vertByDist,z=(C,d,U,W)=>{O=C+"|"+U,K=d+"|"+W,O in q||K in q?O in q&&!(K in q)?q[K]=q[O]:K in q&&!(O in q)&&(q[O]=q[K]):(q[O]=N,q[K]=N,N++),T[U][0]>2?l[q[O]]=[-T[U][0],T[U][1],q[O]]:l[q[O]]=[j[T[U][0]],T[U][1],q[O]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let p=0;p<20;p++){if(j=this.IDATA.face[p],a=j[2],F=j[1],w=j[0],i=V.x+"|"+V.y,O=p+"|"+i,O in q||(q[O]=a,l[a]=[j[T[i][0]],T[i][1]]),i=Z.x+"|"+Z.y,O=p+"|"+i,O in q||(q[O]=F,l[F]=[j[T[i][0]],T[i][1]]),i=J.x+"|"+J.y,O=p+"|"+i,O in q||(q[O]=w,l[w]=[j[T[i][0]],T[i][1]]),U=this.IDATA.edgematch[p][0],W=this.IDATA.edgematch[p][1],"B"===W)for(let N=1;N<A;N++)v.x=C-N*(n+t),v.y=d+N*n,r.x=-N*t,r.y=N*(n+t),i=v.x+"|"+v.y,I=r.x+"|"+r.y,z(p,U,i,I);if("O"===W)for(let N=1;N<A;N++)r.x=-N*t,r.y=N*(n+t),Q.x=N*n,Q.y=N*t,i=r.x+"|"+r.y,I=Q.x+"|"+Q.y,z(p,U,i,I);if(U=this.IDATA.edgematch[p][2],W=this.IDATA.edgematch[p][3],W&&"A"===W)for(let N=1;N<A;N++)Q.x=N*n,Q.y=N*t,v.x=C-(A-N)*(n+t),v.y=d+(A-N)*n,i=Q.x+"|"+Q.y,I=v.x+"|"+v.y,z(p,U,i,I);for(let C=0;C<this.vertices.length;C++)i=this.vertices[C].x+"|"+this.vertices[C].y,O=p+"|"+i,O in q||(q[O]=N++,T[i][0]>2?l[q[O]]=[-T[i][0],T[i][1],q[O]]:l[q[O]]=[j[T[i][0]],T[i][1],q[O]])}this.closestTo=l,this.vecToidx=q}calcCoeffs(){const N=this.m,q=this.n,C=Math.sqrt(3)/3,d=N*N+q*q+N*q;this.coau=(N+q)/d,this.cobu=-q/d,this.coav=-C*(N-q)/d,this.cobv=C*(2*N+q)/d}createInnerFacets(){const N=this.m,q=this.n;for(let C=0;C<q+N+1;C++)for(let N=this.min[C];N<this.max[C]+1;N++)N<this.max[C]&&N<this.max[C+1]+1&&this.innerFacets.push(["|"+N+"|"+C,"|"+N+"|"+(C+1),"|"+(N+1)+"|"+C]),C>0&&N<this.max[C-1]&&N+1<this.max[C]+1&&this.innerFacets.push(["|"+N+"|"+C,"|"+(N+1)+"|"+C,"|"+(N+1)+"|"+(C-1)])}edgeVecsABOB(){const N=this.m,q=this.n,C=new qN(-q,N+q);for(let d=1;d<N+q;d++){const N=new qN(this.min[d],d),q=new qN(this.min[d-1],d-1),U=new qN(this.min[d+1],d+1),W=N.clone(),a=q.clone(),F=U.clone();W.rotate60About(C),a.rotate60About(C),F.rotate60About(C);const w=new qN(this.max[W.y],W.y),A=new qN(this.max[W.y-1],W.y-1),n=new qN(this.max[W.y-1]-1,W.y-1);W.x===w.x&&W.y===w.y||(W.x!==A.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,A,n]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,n,w])):W.y===F.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([N,q,A]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([N,A,U])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([N,q,A]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,A,w])))}}mapABOBtoOBOA(){const N=new qN(0,0);for(let q=0;q<this.isoVecsABOB.length;q++){const C=[];for(let d=0;d<3;d++)N.x=this.isoVecsABOB[q][d].x,N.y=this.isoVecsABOB[q][d].y,0===this.vertexTypes[q][d]&&N.rotateNeg120(this.m,this.n),C.push(N.clone());this.isoVecsOBOA.push(C)}}mapABOBtoBAOA(){const N=new qN(0,0);for(let q=0;q<this.isoVecsABOB.length;q++){const C=[];for(let d=0;d<3;d++)N.x=this.isoVecsABOB[q][d].x,N.y=this.isoVecsABOB[q][d].y,1===this.vertexTypes[q][d]&&N.rotate120(this.m,this.n),C.push(N.clone());this.isoVecsBAOA.push(C)}}MapToFace(N,q){const C=this.IDATA.face[N],U=C[2],W=C[1],a=C[0],F=d.Jq.Kq(this.IDATA.vertex[U]),w=d.Jq.Kq(this.IDATA.vertex[W]),A=d.Jq.Kq(this.IDATA.vertex[a]),n=w.Qq(F),t=A.Qq(F),V=n.scale(this.coau).add(t.scale(this.cobu)),Z=n.scale(this.coav).add(t.scale(this.cobv)),J=[];let Q,v=d.TmpVectors.Jq[0];for(let d=0;d<this.cartesian.length;d++)v=V.scale(this.cartesian[d].x).add(Z.scale(this.cartesian[d].y)).add(F),J[d]=[v.x,v.y,v.z],Q=N+"|"+this.vertices[d].x+"|"+this.vertices[d].y,q.vertex[this.vecToidx[Q]]=[v.x,v.y,v.z]}build(N,q){const C=[],d=qN.Zero(),U=new qN(N,q),W=new qN(-q,N+q);C.push(d,U,W);for(let i=q;i<N+1;i++)for(let q=0;q<N+1-i;q++)C.push(new qN(q,i));if(q>0){const d=(0,L.HighestCommonFactor)(N,q),U=N/d,W=q/d;for(let F=1;F<d;F++)C.push(new qN(F*U,F*W)),C.push(new qN(-F*W,F*(U+W))),C.push(new qN(N-F*(U+W),q+F*U));const a=N/q;for(let F=1;F<q;F++)for(let d=0;d<F*a;d++)C.push(new qN(d,F)),C.push(new qN(d,F).rotate120(N,q)),C.push(new qN(d,F).rotateNeg120(N,q))}C.sort(((N,q)=>N.x-q.x)),C.sort(((N,q)=>N.y-q.y));const a=new Array(N+q+1),F=new Array(N+q+1);for(let i=0;i<a.length;i++)a[i]=1/0,F[i]=-1/0;let w=0,A=0;const n=C.length;for(let i=0;i<n;i++)A=C[i].x,w=C[i].y,a[w]=Math.min(A,a[w]),F[w]=Math.max(A,F[w]);const t=(C,d)=>{const U=C.clone();return"A"===d&&U.rotateNeg120(N,q),"B"===d&&U.rotate120(N,q),U.x<0?U.y:U.x+U.y},V=[],Z=[],J=[],Q=[],v={},r=[];let O=-1,K=-1;for(let i=0;i<n;i++)V[i]=C[i].toCartesianOrigin(new qN(0,0),.5),Z[i]=t(C[i],"O"),J[i]=t(C[i],"A"),Q[i]=t(C[i],"B"),Z[i]===J[i]&&J[i]===Q[i]?(O=3,K=Z[i]):Z[i]===J[i]?(O=4,K=Z[i]):J[i]===Q[i]?(O=5,K=J[i]):Q[i]===Z[i]&&(O=6,K=Z[i]),Z[i]<J[i]&&Z[i]<Q[i]&&(O=2,K=Z[i]),J[i]<Z[i]&&J[i]<Q[i]&&(O=1,K=J[i]),Q[i]<J[i]&&Q[i]<Z[i]&&(O=0,K=Q[i]),r.push([O,K,C[i].x,C[i].y]);r.sort(((N,q)=>N[2]-q[2])),r.sort(((N,q)=>N[3]-q[3])),r.sort(((N,q)=>N[1]-q[1])),r.sort(((N,q)=>N[0]-q[0]));for(let i=0;i<r.length;i++)v[r[i][2]+"|"+r[i][3]]=[r[i][0],r[i][1],i];return this.m=N,this.n=q,this.vertices=C,this.vertByDist=v,this.cartesian=V,this.min=a,this.max=F,this}}class dN{constructor(N,q,C,d){this.name=N,this.category=q,this.vertex=C,this.face=d}}class UN extends dN{innerToData(N,q){for(let C=0;C<q.innerFacets.length;C++)this.face.push(q.innerFacets[C].map((C=>q.vecToidx[N+C])))}mapABOBtoDATA(N,q){const C=q.IDATA.edgematch[N][0];for(let d=0;d<q.isoVecsABOB.length;d++){const U=[];for(let W=0;W<3;W++)0===q.vertexTypes[d][W]?U.push(N+"|"+q.isoVecsABOB[d][W].x+"|"+q.isoVecsABOB[d][W].y):U.push(C+"|"+q.isoVecsABOB[d][W].x+"|"+q.isoVecsABOB[d][W].y);this.face.push([q.vecToidx[U[0]],q.vecToidx[U[1]],q.vecToidx[U[2]]])}}mapOBOAtoDATA(N,q){const C=q.IDATA.edgematch[N][0];for(let d=0;d<q.isoVecsOBOA.length;d++){const U=[];for(let W=0;W<3;W++)1===q.vertexTypes[d][W]?U.push(N+"|"+q.isoVecsOBOA[d][W].x+"|"+q.isoVecsOBOA[d][W].y):U.push(C+"|"+q.isoVecsOBOA[d][W].x+"|"+q.isoVecsOBOA[d][W].y);this.face.push([q.vecToidx[U[0]],q.vecToidx[U[1]],q.vecToidx[U[2]]])}}mapBAOAtoDATA(N,q){const C=q.IDATA.edgematch[N][2];for(let d=0;d<q.isoVecsBAOA.length;d++){const U=[];for(let W=0;W<3;W++)1===q.vertexTypes[d][W]?U.push(N+"|"+q.isoVecsBAOA[d][W].x+"|"+q.isoVecsBAOA[d][W].y):U.push(C+"|"+q.isoVecsBAOA[d][W].x+"|"+q.isoVecsBAOA[d][W].y);this.face.push([q.vecToidx[U[0]],q.vecToidx[U[1]],q.vecToidx[U[2]]])}}orderData(N){const q=[];for(let W=0;W<13;W++)q[W]=[];const C=N.closestTo;for(let W=0;W<C.length;W++)C[W][0]>-1?C[W][1]>0&&q[C[W][0]].push([W,C[W][1]]):q[12].push([W,C[W][0]]);const d=[];for(let W=0;W<12;W++)d[W]=W;let U=12;for(let W=0;W<12;W++){q[W].sort(((N,q)=>N[1]-q[1]));for(let N=0;N<q[W].length;N++)d[q[W][N][0]]=U++}for(let W=0;W<q[12].length;W++)d[q[12][W][0]]=U++;for(let W=0;W<this.vertex.length;W++)this.vertex[W].push(d[W]);this.vertex.sort(((N,q)=>N[3]-q[3]));for(let W=0;W<this.vertex.length;W++)this.vertex[W].pop();for(let W=0;W<this.face.length;W++)for(let N=0;N<this.face[W].length;N++)this.face[W][N]=d[this.face[W][N]];this.sharedNodes=q[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(N,q){const C=[],d=[];let U=q.pop();d.push(U);let W=this.face[U].indexOf(N);W=(W+2)%3;let a=this.face[U][W];C.push(a);let F=0;for(;q.length>0;)U=q[F],this.face[U].indexOf(a)>-1?(W=(this.face[U].indexOf(a)+1)%3,a=this.face[U][W],C.push(a),d.push(U),q.splice(F,1),F=0):F++;return this.adjacentFaces.push(C),d}toGoldbergPolyhedronData(){const N=new dN("GeoDual","Goldberg",[],[]);N.name="GD dual";const q=this.vertex.length,C=new Array(q);for(let w=0;w<q;w++)C[w]=[];for(let w=0;w<this.face.length;w++)for(let N=0;N<3;N++)C[this.face[w][N]].push(w);let d=0,U=0,W=0,a=[],F=[];this.adjacentFaces=[];for(let w=0;w<C.length;w++){N.face[w]=this.setOrder(w,C[w].concat([]));for(const q of C[w]){d=0,U=0,W=0,a=this.face[q];for(let N=0;N<3;N++)F=this.vertex[a[N]],d+=F[0],U+=F[1],W+=F[2];N.vertex[q]=[d/3,U/3,W/3]}}return N}static BuildGeodesicData(N){const q=new UN("Geodesic-m-n","Geodesic",[[0,NN.h,-1],[-NN.h,1,0],[-1,0,-NN.h],[1,0,-NN.h],[NN.h,1,0],[0,NN.h,1],[-1,0,NN.h],[-NN.h,-1,0],[0,-NN.h,-1],[NN.h,-1,0],[1,0,NN.h],[0,-NN.h,1]],[]);N.setIndices(),N.calcCoeffs(),N.createInnerFacets(),N.edgeVecsABOB(),N.mapABOBtoOBOA(),N.mapABOBtoBAOA();for(let C=0;C<N.IDATA.face.length;C++)N.MapToFace(C,q),q.innerToData(C,N),"B"===N.IDATA.edgematch[C][1]&&q.mapABOBtoDATA(C,N),"O"===N.IDATA.edgematch[C][1]&&q.mapOBOAtoDATA(C,N),"A"===N.IDATA.edgematch[C][3]&&q.mapBAOAtoDATA(C,N);q.orderData(N);return q.vertex=q.vertex.map((function(N){const q=N[0],C=N[1],d=N[2],U=Math.sqrt(q*q+C*C+d*d);return N[0]*=1/U,N[1]*=1/U,N[2]*=1/U,N})),q}}U.b._GoldbergMeshParser=(N,q)=>WN.Parse(N,q);class WN extends U.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(N,q){return void 0===q?(N>this.goldbergData.nbUnsharedFaces-1&&(x.c.Warn("Maximum number of unshared faces used"),N=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+N):(N>11&&(x.c.Warn("Last pole used"),N=11),q>this.goldbergData.nbFacesAtPole-1&&(x.c.Warn("Maximum number of faces at a pole used"),q=this.goldbergData.nbFacesAtPole-1),12+N*this.goldbergData.nbFacesAtPole+q)}_changeGoldbergFaceColors(N){for(let C=0;C<N.length;C++){const q=N[C][0],d=N[C][1],U=N[C][2];for(let N=q;N<d+1;N++)this.goldbergData.faceColors[N]=U}const q=[];for(let C=0;C<12;C++)for(let N=0;N<5;N++)q.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);for(let C=12;C<this.goldbergData.faceColors.length;C++)for(let N=0;N<6;N++)q.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);return q}setGoldbergFaceColors(N){const q=this._changeGoldbergFaceColors(N);this.eN(W.g.ColorKind,q)}updateGoldbergFaceColors(N){const q=this._changeGoldbergFaceColors(N);this.updateVerticesData(W.g.ColorKind,q)}_changeGoldbergFaceUVs(N){const q=this.getVerticesData(W.g.UVKind);for(let C=0;C<N.length;C++){const d=N[C][0],U=N[C][1],W=N[C][2],a=N[C][3],F=N[C][4],w=[],A=[];let n,t;for(let N=0;N<5;N++)n=W.x+a*Math.cos(F+N*Math.PI/2.5),t=W.y+a*Math.sin(F+N*Math.PI/2.5),n<0&&(n=0),n>1&&(n=1),w.push(n,t);for(let N=0;N<6;N++)n=W.x+a*Math.cos(F+N*Math.PI/3),t=W.y+a*Math.sin(F+N*Math.PI/3),n<0&&(n=0),n>1&&(n=1),A.push(n,t);for(let N=d;N<Math.min(12,U+1);N++)for(let C=0;C<5;C++)q[10*N+2*C]=w[2*C],q[10*N+2*C+1]=w[2*C+1];for(let N=Math.max(12,d);N<U+1;N++)for(let C=0;C<6;C++)q[12*N-24+2*C]=A[2*C],q[12*N-23+2*C]=A[2*C+1]}return q}setGoldbergFaceUVs(N){const q=this._changeGoldbergFaceUVs(N);this.eN(W.g.UVKind,q)}updateGoldbergFaceUVs(N){const q=this._changeGoldbergFaceUVs(N);this.updateVerticesData(W.g.UVKind,q)}placeOnGoldbergFaceAt(N,q,C){const U=d.Jq.RotationFromAxis(this.goldbergData.faceXaxis[q],this.goldbergData.faceYaxis[q],this.goldbergData.faceZaxis[q]);N.rotation=U,N.position=this.goldbergData.faceCenters[q].add(this.goldbergData.faceXaxis[q].scale(C.x)).add(this.goldbergData.faceYaxis[q].scale(C.y)).add(this.goldbergData.faceZaxis[q].scale(C.z))}serialize(N){super.serialize(N),N.type="GoldbergMesh";const q={};if(q.adjacentFaces=this.goldbergData.adjacentFaces,q.nbSharedFaces=this.goldbergData.nbSharedFaces,q.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,q.nbFaces=this.goldbergData.nbFaces,q.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){q.faceColors=[];for(const N of this.goldbergData.faceColors)q.faceColors.push(N.zd())}if(this.goldbergData.faceCenters){q.faceCenters=[];for(const N of this.goldbergData.faceCenters)q.faceCenters.push(N.zd())}if(this.goldbergData.faceZaxis){q.faceZaxis=[];for(const N of this.goldbergData.faceZaxis)q.faceZaxis.push(N.zd())}if(this.goldbergData.faceYaxis){q.faceYaxis=[];for(const N of this.goldbergData.faceYaxis)q.faceYaxis.push(N.zd())}if(this.goldbergData.faceXaxis){q.faceXaxis=[];for(const N of this.goldbergData.faceXaxis)q.faceXaxis.push(N.zd())}N.goldbergData=q}static Parse(N,q){const C=N.goldbergData;C.faceColors=C.faceColors.map((N=>V.md.Kq(N))),C.faceCenters=C.faceCenters.map((N=>d.Jq.Kq(N))),C.faceZaxis=C.faceZaxis.map((N=>d.Jq.Kq(N))),C.faceXaxis=C.faceXaxis.map((N=>d.Jq.Kq(N))),C.faceYaxis=C.faceYaxis.map((N=>d.Jq.Kq(N)));const U=new WN(N.name,q);return U.goldbergData=C,U}}var aN=C(11683);const FN={CreateBox:t.e,CreateTiledBox:v,CreateSphere:r.b,CreateDisc:n.e,CreateIcoSphere:c,CreateRibbon:A,CreateCylinder:I,CreateTorus:l,CreateTorusKnot:z,CreateLineSystem:p.e,AA:p.h,CreateDashedLines:p.d,ExtrudeShape:P,ExtrudeShapeCustom:M,CreateLathe:E,CreateTiledPlane:J,VA:H.d,CreateGround:e.f,CreateTiledGround:e.i,CreateGroundFromHeightMap:e.b,CreatePolygon:s.e,ExtrudePolygon:s.f,CreateTube:b,CreatePolyhedron:S,CreateGeodesic:function(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=q.m||1;d!==Math.floor(d)&&(d=Math.floor(d),x.c.Warn("m not an integer only floor(m) used"));let U=q.n||0;if(U!==Math.floor(U)&&(U=Math.floor(U),x.c.Warn("n not an integer only floor(n) used")),U>d){const N=U;U=d,d=N,x.c.Warn("n > m therefore m and n swapped")}const W=new CN;return W.build(d,U),S(N,{custom:UN.BuildGeodesicData(W),size:q.size,sizeX:q.sizeX,sizeY:q.sizeY,sizeZ:q.sizeZ,faceUV:q.faceUV,faceColors:q.faceColors,flat:q.flat,updatable:q.updatable,sideOrientation:q.sideOrientation,frontUVs:q.frontUVs,backUVs:q.backUVs},C)},CreateGoldberg:function(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=q.size,w=q.sizeX||W||1,A=q.sizeY||W||1,n=q.sizeZ||W||1;let t=q.m||1;t!==Math.floor(t)&&(t=Math.floor(t),x.c.Warn("m not an integer only floor(m) used"));let Z=q.n||0;if(Z!==Math.floor(Z)&&(Z=Math.floor(Z),x.c.Warn("n not an integer only floor(n) used")),Z>t){const N=Z;Z=t,t=N,x.c.Warn("n > m therefore m and n swapped")}const J=new CN;J.build(t,Z);const Q=UN.BuildGeodesicData(J),v=Q.toGoldbergPolyhedronData(),r=new WN(N,C);q.sideOrientation=U.b._GetDefaultSideOrientation(q.sideOrientation),r._originalBuilderSideOrientation=q.sideOrientation;(function(N,q){const C=N.size,U=N.sizeX||C||1,W=N.sizeY||C||1,w=N.sizeZ||C||1,A=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE,n=[],t=[],V=[],Z=[];let J=1/0,Q=-1/0,v=1/0,r=-1/0;for(let d=0;d<q.vertex.length;d++)J=Math.min(J,q.vertex[d][0]*U),Q=Math.max(Q,q.vertex[d][0]*U),v=Math.min(v,q.vertex[d][1]*W),r=Math.max(r,q.vertex[d][1]*W);let O=0;for(let a=0;a<q.face.length;a++){const N=q.face[a],C=d.Jq.Kq(q.vertex[N[0]]),A=d.Jq.Kq(q.vertex[N[2]]),K=d.Jq.Kq(q.vertex[N[1]]),i=A.Qq(C),I=K.Qq(C),j=d.Jq.Cross(I,i).normalize();for(let d=0;d<N.length;d++){V.push(j.x,j.y,j.z);const C=q.vertex[N[d]];n.push(C[0]*U,C[1]*W,C[2]*w);const a=(C[1]*W-v)/(r-v);Z.push((C[0]*U-J)/(Q-J),F.d?1-a:a)}for(let q=0;q<N.length-2;q++)t.push(O,O+q+2,O+q+1);O+=N.length}a.c._ComputeSides(A,n,t,V,Z);const K=new a.c;return K.zN=n,K.indices=t,K.pN=V,K.XN=Z,K})(q,v).MN(r,q.updatable),r.goldbergData.nbSharedFaces=Q.sharedNodes,r.goldbergData.nbUnsharedFaces=Q.poleNodes,r.goldbergData.adjacentFaces=Q.adjacentFaces,r.goldbergData.nbFaces=r.goldbergData.nbSharedFaces+r.goldbergData.nbUnsharedFaces,r.goldbergData.nbFacesAtPole=(r.goldbergData.nbUnsharedFaces-12)/12;for(let U=0;U<Q.vertex.length;U++)r.goldbergData.faceCenters.push(d.Jq.Kq(Q.vertex[U])),r.goldbergData.faceCenters[U].x*=w,r.goldbergData.faceCenters[U].y*=A,r.goldbergData.faceCenters[U].z*=n,r.goldbergData.faceColors.push(new V.md(1,1,1,1));for(let U=0;U<v.face.length;U++){const N=v.face[U],q=d.Jq.Kq(v.vertex[N[0]]),C=d.Jq.Kq(v.vertex[N[2]]),W=d.Jq.Kq(v.vertex[N[1]]),a=C.Qq(q),F=W.Qq(q),w=d.Jq.Cross(F,a).normalize(),A=d.Jq.Cross(F,w).normalize();r.goldbergData.faceXaxis.push(F.normalize()),r.goldbergData.faceYaxis.push(w),r.goldbergData.faceZaxis.push(A)}return r},CreateDecal:f,CreateCapsule:g,CreateText:aN.g}},12423:(N,q,C)=>{"use strict";C.d(q,{b:()=>Fq});var d=C(11122),U=C(11515);class W extends U.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var a=C(11167),F=(C(11290),C(11076));class w{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(N){this._targetStopDuration!==N&&(this._targetStopDuration=N)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(N){this._noiseTexture!==N&&(this._noiseTexture=N,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(N){this._animationSheetEnabled!==N&&(this._animationSheetEnabled=N)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(N){this._isAnimationSheetEnabled!=N&&(this._isAnimationSheetEnabled=N,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(N){this._useLogarithmicDepth=N&&this.lN().getEngine().getCaps().fragmentDepthSupported}lN(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(N){switch(N){case w.BLENDMODE_MULTIPLYADD:return;case w.BLENDMODE_ADD:N=1;break;case w.BLENDMODE_ONEONE:N=6;break;case w.BLENDMODE_STANDARD:N=2;break;case w.BLENDMODE_MULTIPLY:N=4;break;case w.BLENDMODE_SUBTRACT:N=3}this._engine.setAlphaMode(N)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:d.Jq.Zero()}set direction1(N){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=N)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:d.Jq.Zero()}set direction2(N){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=N)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:d.Jq.Zero()}set minEmitBox(N){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=N)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:d.Jq.Zero()}set maxEmitBox(N){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=N)}get billboardMode(){return this._billboardMode}set billboardMode(N){this._billboardMode!==N&&(this._billboardMode=N,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(N){this._isBillboardBased!==N&&(this._isBillboardBased=N,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(N){this._attachImageProcessingConfiguration(N)}_attachImageProcessingConfiguration(N){N!==this._imageProcessingConfiguration&&(!N&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=N)}_reset(){}_removeGradientAndTexture(N,q,C){if(!q)return this;let d=0;for(const U of q){if(U.gradient===N){q.splice(d,1);break}d++}return C&&C.dispose(),this}constructor(N){this.animations=[],this.renderingGroupId=0,this.dq=d.Jq.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new d.Jq(10,10,10),this.onAnimationEnd=null,this.blendMode=w.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new d.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.aA=new d.Jq(0,0,0),this._useLogarithmicDepth=!1,this.gravity=d.Jq.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new a.md(1,1,1,1),this.color2=new a.md(1,1,1,1),this.colorDead=new a.md(0,0,0,1),this.textureMask=new a.md(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new W,this.id=N,this.name=N}createPointEmitter(N,q){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new d.Jq(0,1,0),arguments.length>2&&void 0!==arguments[2]||new d.Jq(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new d.Jq(0,1,0),arguments.length>4&&void 0!==arguments[4]||new d.Jq(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new d.Jq(0,1,0),arguments.length>3&&void 0!==arguments[3]||new d.Jq(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(N,q,C,d){throw new Error("Method not implemented.")}}w.BLENDMODE_ONEONE=0,w.BLENDMODE_STANDARD=1,w.BLENDMODE_ADD=2,w.BLENDMODE_MULTIPLY=3,w.BLENDMODE_MULTIPLYADD=4,w.BLENDMODE_SUBTRACT=-1,(0,F.h)("BABYLON.BaseParticleSystem",w);var A=C(11142),n=C(10971);class t{constructor(){this.direction1=new d.Jq(0,1,0),this.direction2=new d.Jq(0,1,0),this.minEmitBox=new d.Jq(-.5,-.5,-.5),this.maxEmitBox=new d.Jq(.5,.5,.5)}startDirectionFunction(N,q,C,U){const W=(0,A.RandomRange)(this.direction1.x,this.direction2.x),a=(0,A.RandomRange)(this.direction1.y,this.direction2.y),F=(0,A.RandomRange)(this.direction1.z,this.direction2.z);if(U)return q.x=W,q.y=a,void(q.z=F);d.Jq.TransformNormalFromFloatsToRef(W,a,F,N,q)}startPositionFunction(N,q,C,U){const W=(0,A.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),a=(0,A.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),F=(0,A.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(U)return q.x=W,q.y=a,void(q.z=F);d.Jq.TransformCoordinatesFromFloatsToRef(W,a,F,N,q)}clone(){const N=new t;return n.b.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2),N.setVector3("minEmitBox",this.minEmitBox),N.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3),N.addUniform("minEmitBox",3),N.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.direction1=this.direction1.zd(),N.direction2=this.direction2.zd(),N.minEmitBox=this.minEmitBox.zd(),N.maxEmitBox=this.maxEmitBox.zd(),N}parse(N){d.Jq.FromArrayToRef(N.direction1,0,this.direction1),d.Jq.FromArrayToRef(N.direction2,0,this.direction2),d.Jq.FromArrayToRef(N.minEmitBox,0,this.minEmitBox),d.Jq.FromArrayToRef(N.maxEmitBox,0,this.maxEmitBox)}}class V{get radius(){return this._radius}set radius(N){this._radius=N,this._buildHeight()}get angle(){return this._angle}set angle(N){this._angle=N,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=C,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=q,this.radius=N}startDirectionFunction(N,q,C,U){U?d.TmpVectors.Jq[0].U(C.SF).normalize():C.position.subtractToRef(N.getTranslation(),d.TmpVectors.Jq[0]).normalize();const W=(0,A.RandomRange)(0,this.directionRandomizer),a=(0,A.RandomRange)(0,this.directionRandomizer),F=(0,A.RandomRange)(0,this.directionRandomizer);q.x=d.TmpVectors.Jq[0].x+W,q.y=d.TmpVectors.Jq[0].y+a,q.z=d.TmpVectors.Jq[0].z+F,q.normalize()}startPositionFunction(N,q,C,U){const W=(0,A.RandomRange)(0,2*Math.PI);let a;this.emitFromSpawnPointOnly?a=1e-4:(a=(0,A.RandomRange)(0,this.heightRange),a=1-a*a);let F=this._radius-(0,A.RandomRange)(0,this._radius*this.radiusRange);F*=a;const w=F*Math.sin(W),n=F*Math.cos(W),t=a*this._height;if(U)return q.x=w,q.y=t,void(q.z=n);d.Jq.TransformCoordinatesFromFloatsToRef(w,t,n,N,q)}clone(){const N=new V(this._radius,this._angle,this.directionRandomizer);return n.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat2("radius",this._radius,this.radiusRange),N.setFloat("coneAngle",this._angle),N.setFloat2("height",this._height,this.heightRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",2),N.addUniform("coneAngle",1),N.addUniform("height",2),N.addUniform("directionRandomizer",1)}getEffectDefines(){let N="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(N+="\n#define CONEEMITTERSPAWNPOINT"),N}getClassName(){return"ConeParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this._radius,N.angle=this._angle,N.directionRandomizer=this.directionRandomizer,N.radiusRange=this.radiusRange,N.heightRange=this.heightRange,N.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,N}parse(N){this.radius=N.radius,this.angle=N.angle,this.directionRandomizer=N.directionRandomizer,this.radiusRange=void 0!==N.radiusRange?N.radiusRange:1,this.heightRange=void 0!==N.radiusRange?N.heightRange:1,this.emitFromSpawnPointOnly=void 0!==N.emitFromSpawnPointOnly&&N.emitFromSpawnPointOnly}}class Z extends V{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.Jq(0,1,0),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.Jq(0,1,0);super(N,q),this.direction1=C,this.direction2=U}startDirectionFunction(N,q){const C=(0,A.RandomRange)(this.direction1.x,this.direction2.x),U=(0,A.RandomRange)(this.direction1.y,this.direction2.y),W=(0,A.RandomRange)(this.direction1.z,this.direction2.z);d.Jq.TransformNormalFromFloatsToRef(C,U,W,N,q)}clone(){const N=new Z(this.radius,this.angle,this.direction1,this.direction2);return n.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.zd(),N.direction2=this.direction2.zd(),N}parse(N){super.parse(N),this.direction1.U(N.direction1),this.direction2.U(N.direction2)}}class J{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=N,this.height=q,this.radiusRange=C,this.directionRandomizer=U,this._tempVector=d.Jq.Zero()}startDirectionFunction(N,q,C,U,W){C.position.subtractToRef(N.getTranslation(),this._tempVector),this._tempVector.normalize(),d.Jq.TransformNormalToRef(this._tempVector,W,this._tempVector);const a=(0,A.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let F=Math.atan2(this._tempVector.x,this._tempVector.z);F+=(0,A.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=a,this._tempVector.x=Math.sin(F),this._tempVector.z=Math.cos(F),this._tempVector.normalize(),U?q.U(this._tempVector):d.Jq.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,N,q)}startPositionFunction(N,q,C,U){const W=(0,A.RandomRange)(-this.height/2,this.height/2),a=(0,A.RandomRange)(0,2*Math.PI),F=(0,A.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),w=Math.sqrt(F)*this.radius,n=w*Math.cos(a),t=w*Math.sin(a);U?q.hd(n,W,t):d.Jq.TransformCoordinatesFromFloatsToRef(n,W,t,N,q)}clone(){const N=new J(this.radius,this.directionRandomizer);return n.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("height",this.height),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("height",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.height=this.height,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.height=N.height,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class Q extends J{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.Jq(0,1,0),W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.Jq(0,1,0);super(N,q,C),this.direction1=U,this.direction2=W}startDirectionFunction(N,q,C,U){const W=(0,A.RandomRange)(this.direction1.x,this.direction2.x),a=(0,A.RandomRange)(this.direction1.y,this.direction2.y),F=(0,A.RandomRange)(this.direction1.z,this.direction2.z);U?q.hd(W,a,F):d.Jq.TransformNormalFromFloatsToRef(W,a,F,N,q)}clone(){const N=new Q(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return n.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("height",this.height),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("height",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.zd(),N.direction2=this.direction2.zd(),N}parse(N){super.parse(N),d.Jq.FromArrayToRef(N.direction1,0,this.direction1),d.Jq.FromArrayToRef(N.direction2,0,this.direction2)}}class v{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=N,this.radiusRange=q,this.directionRandomizer=C}startDirectionFunction(N,q,C,U){const W=C.position.Qq(N.getTranslation()).normalize(),a=(0,A.RandomRange)(0,this.directionRandomizer),F=(0,A.RandomRange)(0,this.directionRandomizer),w=(0,A.RandomRange)(0,this.directionRandomizer);W.x+=a,W.y+=F,W.z+=w,W.normalize(),U?q.U(W):d.Jq.TransformNormalFromFloatsToRef(W.x,W.y,W.z,N,q)}startPositionFunction(N,q,C,U){const W=this.radius-(0,A.RandomRange)(0,this.radius*this.radiusRange),a=(0,A.RandomRange)(0,1),F=(0,A.RandomRange)(0,2*Math.PI),w=Math.acos(2*a-1),n=W*Math.cos(F)*Math.sin(w),t=W*Math.cos(w),V=W*Math.sin(F)*Math.sin(w);U?q.hd(n,Math.abs(t),V):d.Jq.TransformCoordinatesFromFloatsToRef(n,Math.abs(t),V,N,q)}clone(){const N=new v(this.radius,this.directionRandomizer);return n.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class r{constructor(){this.direction1=new d.Jq(0,1,0),this.direction2=new d.Jq(0,1,0)}startDirectionFunction(N,q,C,U){const W=(0,A.RandomRange)(this.direction1.x,this.direction2.x),a=(0,A.RandomRange)(this.direction1.y,this.direction2.y),F=(0,A.RandomRange)(this.direction1.z,this.direction2.z);U?q.hd(W,a,F):d.Jq.TransformNormalFromFloatsToRef(W,a,F,N,q)}startPositionFunction(N,q,C,U){U?q.hd(0,0,0):d.Jq.TransformCoordinatesFromFloatsToRef(0,0,0,N,q)}clone(){const N=new r;return n.b.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.direction1=this.direction1.zd(),N.direction2=this.direction2.zd(),N}parse(N){d.Jq.FromArrayToRef(N.direction1,0,this.direction1),d.Jq.FromArrayToRef(N.direction2,0,this.direction2)}}class O{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=N,this.radiusRange=q,this.directionRandomizer=C}startDirectionFunction(N,q,C,U){const W=C.position.Qq(N.getTranslation()).normalize(),a=(0,A.RandomRange)(0,this.directionRandomizer),F=(0,A.RandomRange)(0,this.directionRandomizer),w=(0,A.RandomRange)(0,this.directionRandomizer);W.x+=a,W.y+=F,W.z+=w,W.normalize(),U?q.U(W):d.Jq.TransformNormalFromFloatsToRef(W.x,W.y,W.z,N,q)}startPositionFunction(N,q,C,U){const W=this.radius-(0,A.RandomRange)(0,this.radius*this.radiusRange),a=(0,A.RandomRange)(0,1),F=(0,A.RandomRange)(0,2*Math.PI),w=Math.acos(2*a-1),n=W*Math.cos(F)*Math.sin(w),t=W*Math.cos(w),V=W*Math.sin(F)*Math.sin(w);U?q.hd(n,t,V):d.Jq.TransformCoordinatesFromFloatsToRef(n,t,V,N,q)}clone(){const N=new O(this.radius,this.directionRandomizer);return n.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class K extends O{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.Jq(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.Jq(0,1,0);super(N),this.direction1=q,this.direction2=C}startDirectionFunction(N,q){const C=(0,A.RandomRange)(this.direction1.x,this.direction2.x),U=(0,A.RandomRange)(this.direction1.y,this.direction2.y),W=(0,A.RandomRange)(this.direction1.z,this.direction2.z);d.Jq.TransformNormalFromFloatsToRef(C,U,W,N,q)}clone(){const N=new K(this.radius,this.direction1,this.direction2);return n.b.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.zd(),N.direction2=this.direction2.zd(),N}parse(N){super.parse(N),this.direction1.U(N.direction1),this.direction2.U(N.direction2)}}class i{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(N,q,C,U){const W=d.TmpVectors.Jq[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,C,W);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,C,W);const N=d.TmpVectors.Jq[1];W.subtractToRef(C.position,N),N.scaleToRef(1/C.lifeTime,W)}else W.set(0,0,0);U?q.U(W):d.Jq.TransformNormalToRef(W,N,q)}startPositionFunction(N,q,C,U){const W=d.TmpVectors.Jq[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,C,W):W.set(0,0,0),U?q.U(W):d.Jq.TransformCoordinatesToRef(W,N,q)}clone(){const N=new i;return n.b.DeepCopy(this,N),N}applyToShader(N){}buildUniformLayout(N){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.particlePositionGenerator=this.particlePositionGenerator,N.particleDestinationGenerator=this.particleDestinationGenerator,N}parse(N){N.particlePositionGenerator&&(this.particlePositionGenerator=N.particlePositionGenerator),N.particleDestinationGenerator&&(this.particleDestinationGenerator=N.particleDestinationGenerator)}}var I=C(11199);class j{get mesh(){return this._mesh}set mesh(N){this._mesh!==N&&(this._mesh=N,N?(this._indices=N.od(),this._positions=N.getVerticesData(I.g.PositionKind),this._normals=N.getVerticesData(I.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=d.Jq.Zero(),this._mesh=null,this.direction1=new d.Jq(0,1,0),this.direction2=new d.Jq(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=N}startDirectionFunction(N,q,C,U){if(this.useMeshNormalsForDirection&&this._normals)return void d.Jq.TransformNormalToRef(this._storedNormal,N,q);const W=(0,A.RandomRange)(this.direction1.x,this.direction2.x),a=(0,A.RandomRange)(this.direction1.y,this.direction2.y),F=(0,A.RandomRange)(this.direction1.z,this.direction2.z);U?q.hd(W,a,F):d.Jq.TransformNormalFromFloatsToRef(W,a,F,N,q)}startPositionFunction(N,q,C,U){if(!this._indices||!this._positions)return;const W=3*(Math.random()*(this._indices.length/3)|0),a=Math.random(),F=Math.random()*(1-a),w=1-a-F,A=this._indices[W],n=this._indices[W+1],t=this._indices[W+2],V=d.TmpVectors.Jq[0],Z=d.TmpVectors.Jq[1],J=d.TmpVectors.Jq[2],Q=d.TmpVectors.Jq[3];d.Jq.FromArrayToRef(this._positions,3*A,V),d.Jq.FromArrayToRef(this._positions,3*n,Z),d.Jq.FromArrayToRef(this._positions,3*t,J),Q.x=a*V.x+F*Z.x+w*J.x,Q.y=a*V.y+F*Z.y+w*J.y,Q.z=a*V.z+F*Z.z+w*J.z,U?q.hd(Q.x,Q.y,Q.z):d.Jq.TransformCoordinatesFromFloatsToRef(Q.x,Q.y,Q.z,N,q),this.useMeshNormalsForDirection&&this._normals&&(d.Jq.FromArrayToRef(this._normals,3*A,V),d.Jq.FromArrayToRef(this._normals,3*n,Z),d.Jq.FromArrayToRef(this._normals,3*t,J),this._storedNormal.x=a*V.x+F*Z.x+w*J.x,this._storedNormal.y=a*V.y+F*Z.y+w*J.y,this._storedNormal.z=a*V.z+F*Z.z+w*J.z)}clone(){const N=new j(this.mesh);return n.b.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var N;const q={};return q.type=this.getClassName(),q.direction1=this.direction1.zd(),q.direction2=this.direction2.zd(),q.meshId=null===(N=this.mesh)||void 0===N?void 0:N.id,q.useMeshNormalsForDirection=this.useMeshNormalsForDirection,q}parse(N,q){d.Jq.FromArrayToRef(N.direction1,0,this.direction1),d.Jq.FromArrayToRef(N.direction2,0,this.direction2),N.meshId&&q&&(this.mesh=q.getLastMeshById(N.meshId)),this.useMeshNormalsForDirection=N.useMeshNormalsForDirection}}class l{_isUbo(N){return void 0!==N.addUniform}constructor(N){this._isUbo(N)?(this.setMatrix3x3=N.updateMatrix3x3.bind(N),this.setMatrix2x2=N.updateMatrix2x2.bind(N),this.setFloat=N.updateFloat.bind(N),this.setFloat2=N.updateFloat2.bind(N),this.setFloat3=N.updateFloat3.bind(N),this.setFloat4=N.updateFloat4.bind(N),this.setFloatArray=N.updateFloatArray.bind(N),this.setArray=N.updateArray.bind(N),this.setIntArray=N.updateIntArray.bind(N),this.setMatrix=N.Yd.bind(N),this.setMatrices=N.updateMatrices.bind(N),this.setVector3=N.updateVector3.bind(N),this.setVector4=N.updateVector4.bind(N),this.setColor3=N.updateColor3.bind(N),this.setColor4=N.updateColor4.bind(N),this.setDirectColor4=N.updateDirectColor4.bind(N),this.setInt=N.updateInt.bind(N),this.setInt2=N.updateInt2.bind(N),this.setInt3=N.updateInt3.bind(N),this.setInt4=N.updateInt4.bind(N)):(this.setMatrix3x3=N.setMatrix3x3.bind(N),this.setMatrix2x2=N.setMatrix2x2.bind(N),this.setFloat=N.setFloat.bind(N),this.setFloat2=N.setFloat2.bind(N),this.setFloat3=N.setFloat3.bind(N),this.setFloat4=N.setFloat4.bind(N),this.setFloatArray=N.setFloatArray.bind(N),this.setArray=N.setArray.bind(N),this.setIntArray=N.setIntArray.bind(N),this.setMatrix=N.setMatrix.bind(N),this.setMatrices=N.setMatrices.bind(N),this.setVector3=N.setVector3.bind(N),this.setVector4=N.setVector4.bind(N),this.setColor3=N.setColor3.bind(N),this.setColor4=N.setColor4.bind(N),this.setDirectColor4=N.setDirectColor4.bind(N),this.setInt=N.setInt.bind(N),this.setInt2=N.setInt2.bind(N),this.setInt3=N.setInt3.bind(N),this.setInt4=N.setInt4.bind(N))}}var T=C(11036);const z="gpuUpdateParticlesPixelShader",p="#version 300 es\nvoid main() {discard;}\n";T.c.ShadersStore[z]||(T.c.ShadersStore[z]=p);const s="gpuUpdateParticlesVertexShader",X="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";T.c.ShadersStore[s]||(T.c.ShadersStore[s]=X);(0,F.h)("BABYLON.WebGL2ParticleSystem",class{constructor(N,q){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=N,this._engine=q,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var N;return(null===(N=this._updateEffect)||void 0===N?void 0:N.isReady())??!1}createUpdateBuffer(N){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof i&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=N,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new l(this._updateEffect)}createVertexBuffers(N,q){this._updateVAO.push(this._createUpdateVAO(N)),this._renderVAO.push(this._engine.recordVertexArrayObject(q,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=q}createParticleBuffer(N){return N}bindDrawBuffers(N,q,C){C?this._engine.bindBuffers(this._renderVertexBuffers,C,q):this._engine.bindVertexArrayObject(this._renderVAO[N],null)}preUpdateParticleBuffer(){const N=this._engine;if(this._engine.enableEffect(this._updateEffect),!N.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(N,q,C){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[N],null);const d=this._engine;d.bindTransformFeedbackBuffer(q.getBuffer()),d.setRasterizerState(!1),d.beginTransformFeedback(!0),d.drawArraysType(3,0,C),d.endTransformFeedback(),d.setRasterizerState(!0),d.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let N=0;N<this._updateVAO.length;N++)this._engine.releaseVertexArrayObject(this._updateVAO[N]);this._updateVAO.length=0;for(let N=0;N<this._renderVAO.length;N++)this._engine.releaseVertexArrayObject(this._renderVAO[N]);this._renderVAO.length=0}_createUpdateVAO(N){const q={};q.position=N.createVertexBuffer("position",0,3);let C=3;q.age=N.createVertexBuffer("age",C,1),C+=1,q.size=N.createVertexBuffer("size",C,3),C+=3,q.life=N.createVertexBuffer("life",C,1),C+=1,q.seed=N.createVertexBuffer("seed",C,4),C+=4,q.direction=N.createVertexBuffer("direction",C,3),C+=3,this._parent.particleEmitterType instanceof i&&(q.initialPosition=N.createVertexBuffer("initialPosition",C,3),C+=3),this._parent._colorGradientsTexture||(q.color=N.createVertexBuffer("color",C,4),C+=4),this._parent._isBillboardBased||(q.initialDirection=N.createVertexBuffer("initialDirection",C,3),C+=3),this._parent.noiseTexture&&(q.noiseCoordinates1=N.createVertexBuffer("noiseCoordinates1",C,3),C+=3,q.noiseCoordinates2=N.createVertexBuffer("noiseCoordinates2",C,3),C+=3),this._parent._angularSpeedGradientsTexture?(q.angle=N.createVertexBuffer("angle",C,1),C+=1):(q.angle=N.createVertexBuffer("angle",C,2),C+=2),this._parent._isAnimationSheetEnabled&&(q.cellIndex=N.createVertexBuffer("cellIndex",C,1),C+=1,this._parent.spriteRandomStartCell&&(q.cellStartOffset=N.createVertexBuffer("cellStartOffset",C,1),C+=1));const d=this._engine.recordVertexArrayObject(q,null,this._updateEffect);return this._engine.bindArrayBuffer(null),d}});class P{constructor(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,d=arguments.length>3?arguments[3]:void 0;this._engine=N,this._label=d,this._engine._storageBuffers.push(this),this._create(q,C)}_create(N,q){this._bufferSize=N,this._creationFlags=q,this._buffer=this._engine.createStorageBuffer(N,q,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(N,q,C){this._buffer&&this._engine.updateStorageBuffer(this._buffer,N,q,C)}async read(N,q,C,d){return await this._engine.readFromStorageBuffer(this._buffer,N,q,C,d)}dispose(){const N=this._engine._storageBuffers,q=N.indexOf(this);-1!==q&&(N[q]=N[N.length-1],N.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var M=C(11110),Y=C(11114),E=C(11155),H=C(11101),e=C(11423),b=C(10962),o=C(11063),S=C(11346);class D{constructor(){this._gpuTimeInFrameId=-1,this.counter=new S.b}_addDuration(N,q){N<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==N?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(q,!1),this._gpuTimeInFrameId=N):this.counter.addCount(q,!1))}}var c=C(11029);class L{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=N,this._engine=q,this.uniqueId=e.b.UniqueId,q.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new D),this._engine.getCaps().supportComputeShaders?d.bindingsMapping?(this._context=q.createComputeContext(),this._shaderPath=C,this._options={bindingsMapping:{},defines:[],...d}):b.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):b.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(N,q){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const d=this._bindings[N];this._bindings[N]={type:C?0:4,object:q,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!d||d.object!==q||d.type!==this._bindings[N].type)}setStorageTexture(N,q){const C=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==q),this._bindings[N]={type:1,object:q,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setExternalTexture(N,q){const C=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==q),this._bindings[N]={type:6,object:q,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setVideoTexture(N,q){return!!q.externalTexture&&(this.setExternalTexture(N,q.externalTexture),!0)}setUniformBuffer(N,q){const C=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==q),this._bindings[N]={type:L._BufferIsDataBuffer(q)?7:2,object:q,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setStorageBuffer(N,q){const C=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==q),this._bindings[N]={type:L._BufferIsDataBuffer(q)?7:3,object:q,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setTextureSampler(N,q){const C=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!C||!q.compareSampler(C.object)),this._bindings[N]={type:5,object:q,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}isReady(){let N=this._effect;for(const U in this._bindings){const N=this._bindings[U],q=N.type,C=N.object;switch(q){case 0:case 4:case 1:if(!C.isReady())return!1;break;case 6:if(!C.isReady())return!1;break}}const q=[],C=this._shaderPath;if(this._options.defines)for(let U=0;U<this._options.defines.length;U++)q.push(this._options.defines[U]);const d=q.join("\n");return this._cachedDefines!==d&&(this._cachedDefines=d,N=this._engine.createComputeEffect(C,{defines:d,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=N),!!N.isReady()}dispatch(N,q,C){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,N,q,C,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const C=L._BufferIsDataBuffer(N)?N:N.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,C,q,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const q in this._bindings){const C=this._bindings[q];if(!this._options.bindingsMapping[q])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+q+"'");switch(C.type){case 0:{const d=this._samplers[q],U=C.object;var N;if(!d||!U._texture||!d.compareSampler(U._texture))this._samplers[q]=(new o.d).setParameters(U.wrapU,U.wrapV,U.wrapR,U.anisotropicFilteringLevel,U._texture.samplingMode,null===(N=U._texture)||void 0===N?void 0:N._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const N=C.object;N.getBuffer()!==C.buffer&&(C.buffer=N.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((U=>{(0,c.f)((()=>this.dispatch(N,q,C)),U,void 0,d)}))}serialize(){const N=E.d.Serialize(this);N.options=this._options,N.shaderPath=this._shaderPath,N.xt={},N.textures={};for(const q in this._bindings){const C=this._bindings[q],d=C.object;switch(C.type){case 0:case 4:case 1:{const U=d.serialize();U&&(N.textures[q]=U,N.xt[q]={type:C.type});break}}}return N}static Parse(N,q,C){const d=E.d.Parse((()=>new L(N.name,q.getEngine(),N.shaderPath,N.options)),N,q,C);for(const U in N.textures){const W=N.xt[U],a=H.c.Parse(N.textures[U],q,C);0===W.type?d.setTexture(U,a):4===W.type?d.setTexture(U,a,!1):d.setStorageTexture(U,a)}return d}static _BufferIsDataBuffer(N){return void 0!==N.underlyingResource}}(0,M.d)([(0,Y.O)()],L.prototype,"name",void 0),(0,M.d)([(0,Y.O)()],L.prototype,"fastMode",void 0),(0,F.h)("BABYLON.ComputeShader",L);var G=C(11381);const h="gpuUpdateParticlesComputeShader",B="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";T.c.ShadersStoreWGSL[h]||(T.c.ShadersStoreWGSL[h]=B);(0,F.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(N,q){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=N,this._engine=q}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var N;return(null===(N=this._updateComputeShader)||void 0===N?void 0:N.isReady())??!1}createUpdateBuffer(N){var q;const C={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(C.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(C.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(C.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(C.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(C.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(C.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(C.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new L("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:C,defines:N.split("\n")}),null===(q=this._simParamsComputeShader)||void 0===q||q.dispose(),this._simParamsComputeShader=new G.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new l(this._simParamsComputeShader)}createVertexBuffers(N,q){this._renderVertexBuffers.push(q)}createParticleBuffer(N){const q=new P(this._engine,4*N.length,11,"ComputeShaderParticleSystemBuffer");return q.update(N),this._bufferComputeShader.push(q),q.getBuffer()}bindDrawBuffers(N,q,C){this._engine.bindBuffers(this._renderVertexBuffers[N],C,q)}preUpdateParticleBuffer(){}updateParticleBuffer(N,q,C){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[N]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^N]),this._updateComputeShader.dispatch(Math.ceil(C/64))}releaseBuffers(){var N;for(let q=0;q<this._bufferComputeShader.length;++q)this._bufferComputeShader[q].dispose();this._bufferComputeShader.length=0,null===(N=this._simParamsComputeShader)||void 0===N||N.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class y{constructor(N,q,C){this.gradient=N,this.color1=q,this.color2=C}getColorToRef(N){this.color2?a.md.LerpToRef(this.color1,this.color2,Math.random(),N):N.U(this.color1)}}class R{constructor(N,q){this.gradient=N,this.color=q}}class u{constructor(N,q,C){this.gradient=N,this.factor1=q,this.factor2=C}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class m{static GetCurrentGradient(N,q,C){if(q[0].gradient>N)return void C(q[0],q[0],1);for(let U=0;U<q.length-1;U++){const d=q[U],W=q[U+1];if(N>=d.gradient&&N<=W.gradient){return void C(d,W,(N-d.gradient)/(W.gradient-d.gradient))}}const d=q.length-1;C(q[d],q[d],1)}}var f=C(10949),k=C(11596),g=C(10995);class x{constructor(N){this.particleSystem=N,this.position=d.Jq.Zero(),this.direction=d.Jq.Zero(),this.color=new a.md(0,0,0,0),this.colorStep=new a.md(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new d.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new a.md(0,0,0,0),this._currentColor2=new a.md(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=x._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let N=this.age,q=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===q?(q=1,N=this._randomCellOffset):N+=this._randomCellOffset);const C=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let d;d=this._initialSpriteCellLoop?(0,A.Clamp)(N*q%this.lifeTime/this.lifeTime):(0,A.Clamp)(N*q/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+d*C|0}_inheritParticleInfoToSubEmitter(N){if(N.particleSystem.dq.position){const q=N.particleSystem.dq;if(q.position.U(this.position),N.inheritDirection){const N=d.TmpVectors.Jq[0];this.direction.normalizeToRef(N),q.setDirection(N,0,Math.PI/2)}}else{N.particleSystem.dq.U(this.position)}this.direction.scaleToRef(N.inheritedVelocityAmount/2,d.TmpVectors.Jq[0]),N.particleSystem._inheritedVelocityOffset.U(d.TmpVectors.Jq[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const N of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(N)}_reset(){this.age=0,this.id=x._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(N){N.position.U(this.position),this._initialDirection?N._initialDirection?N._initialDirection.U(this._initialDirection):N._initialDirection=this._initialDirection.clone():N._initialDirection=null,N.direction.U(this.direction),this.SF&&(N.SF?N.SF.U(this.SF):N.SF=this.SF.clone()),N.color.U(this.color),N.colorStep.U(this.colorStep),N.lifeTime=this.lifeTime,N.age=this.age,N._randomCellOffset=this._randomCellOffset,N.size=this.size,N.scale.U(this.scale),N.angle=this.angle,N.angularSpeed=this.angularSpeed,N.particleSystem=this.particleSystem,N.cellIndex=this.cellIndex,N.id=this.id,N._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(N._currentColorGradient=this._currentColorGradient,N._currentColor1.U(this._currentColor1),N._currentColor2.U(this._currentColor2)),this._currentSizeGradient&&(N._currentSizeGradient=this._currentSizeGradient,N._currentSize1=this._currentSize1,N._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(N._currentAngularSpeedGradient=this._currentAngularSpeedGradient,N._currentAngularSpeed1=this._currentAngularSpeed1,N._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(N._currentVelocityGradient=this._currentVelocityGradient,N._currentVelocity1=this._currentVelocity1,N._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(N._currentLimitVelocityGradient=this._currentLimitVelocityGradient,N._currentLimitVelocity1=this._currentLimitVelocity1,N._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(N._currentDragGradient=this._currentDragGradient,N._currentDrag1=this._currentDrag1,N._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(N._initialStartSpriteCellId=this._initialStartSpriteCellId,N._initialEndSpriteCellId=this._initialEndSpriteCellId,N._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(N.remapData&&this.remapData?N.remapData.U(this.remapData):N.remapData=new d.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(N._randomNoiseCoordinates1?(N._randomNoiseCoordinates1.U(this._randomNoiseCoordinates1),N._randomNoiseCoordinates2.U(this._randomNoiseCoordinates2)):(N._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),N._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}x._Count=0;var NN=C(11247),qN=(C(11286),C(11494)),CN=C(11487),dN=C(11375);function UN(N,q){const C=(0,A.RandomRange)(0,1);a.md.LerpToRef(q.color1,q.color2,C,N.color),q.colorDead.subtractToRef(N.color,q._colorDiff),q._colorDiff.scaleToRef(1/N.lifeTime,N.colorStep)}function WN(N,q){N._currentColorGradient=q._colorGradients[0],N._currentColorGradient.getColorToRef(N.color),N._currentColor1.U(N.color),q._colorGradients.length>1?q._colorGradients[1].getColorToRef(N._currentColor2):N._currentColor2.U(N.color)}function aN(N,q){const C=q._colorGradients;m.GetCurrentGradient(q._ratio,C,((q,C,d)=>{q!==N._currentColorGradient&&(N._currentColor1.U(N._currentColor2),C.getColorToRef(N._currentColor2),N._currentColorGradient=q),a.md.LerpToRef(N._currentColor1,N._currentColor2,d,N.color)}))}function FN(N,q){N.colorStep.scaleToRef(q._scaledUpdateSpeed,q._scaledColorStep),N.color.addInPlace(q._scaledColorStep),N.color.a<0&&(N.color.a=0)}function wN(N,q){m.GetCurrentGradient(q._ratio,q._angularSpeedGradients,((q,C,d)=>{q!==N._currentAngularSpeedGradient&&(N._currentAngularSpeed1=N._currentAngularSpeed2,N._currentAngularSpeed2=C.getFactor(),N._currentAngularSpeedGradient=q),N.angularSpeed=(0,A.Lerp)(N._currentAngularSpeed1,N._currentAngularSpeed2,d)}))}function AN(N,q){N.angle+=N.angularSpeed*q._scaledUpdateSpeed}function nN(N,q){q.particleEmitterType.startDirectionFunction(q._emitterWorldMatrix,N.direction,N,q.isLocal,q._emitterInverseWorldMatrix)}function tN(N,q){q.startDirectionFunction(q._emitterWorldMatrix,N.direction,N,q.isLocal)}function VN(N,q){N._currentVelocityGradient=q._velocityGradients[0],N._currentVelocity1=N._currentVelocityGradient.getFactor(),q._velocityGradients.length>1?N._currentVelocity2=q._velocityGradients[1].getFactor():N._currentVelocity2=N._currentVelocity1}function ZN(N,q){N._currentLimitVelocityGradient=q._limitVelocityGradients[0],N._currentLimitVelocity1=N._currentLimitVelocityGradient.getFactor(),q._limitVelocityGradients.length>1?N._currentLimitVelocity2=q._limitVelocityGradients[1].getFactor():N._currentLimitVelocity2=N._currentLimitVelocity1}function JN(N,q){m.GetCurrentGradient(q._ratio,q._velocityGradients,((C,d,U)=>{C!==N._currentVelocityGradient&&(N._currentVelocity1=N._currentVelocity2,N._currentVelocity2=d.getFactor(),N._currentVelocityGradient=C),q._directionScale*=(0,A.Lerp)(N._currentVelocity1,N._currentVelocity2,U)}))}function QN(N,q){m.GetCurrentGradient(q._ratio,q._limitVelocityGradients,((C,d,U)=>{C!==N._currentLimitVelocityGradient&&(N._currentLimitVelocity1=N._currentLimitVelocity2,N._currentLimitVelocity2=d.getFactor(),N._currentLimitVelocityGradient=C);const W=(0,A.Lerp)(N._currentLimitVelocity1,N._currentLimitVelocity2,U);N.direction.length()>W&&N.direction.scaleInPlace(q.limitVelocityDamping)}))}function vN(N,q){N.direction.scaleToRef(q._directionScale,q._scaledDirection)}function rN(N,q){q.particleEmitterType.startPositionFunction(q._emitterWorldMatrix,N.position,N,q.isLocal)}function ON(N,q){q.startPositionFunction(q._emitterWorldMatrix,N.position,N,q.isLocal)}function KN(N,q){N.SF?N.SF.U(N.position):N.SF=N.position.clone(),d.Jq.TransformCoordinatesToRef(N.SF,q._emitterWorldMatrix,N.position)}function iN(N,q){q.isLocal&&N.SF?(N.SF.addInPlace(q._scaledDirection),d.Jq.TransformCoordinatesToRef(N.SF,q._emitterWorldMatrix,N.position)):N.position.addInPlace(q._scaledDirection)}function IN(N,q){N._currentDragGradient=q._dragGradients[0],N._currentDrag1=N._currentDragGradient.getFactor(),q._dragGradients.length>1?N._currentDrag2=q._dragGradients[1].getFactor():N._currentDrag2=N._currentDrag1}function jN(N,q){m.GetCurrentGradient(q._ratio,q._dragGradients,((C,d,U)=>{C!==N._currentDragGradient&&(N._currentDrag1=N._currentDrag2,N._currentDrag2=d.getFactor(),N._currentDragGradient=C);const W=(0,A.Lerp)(N._currentDrag1,N._currentDrag2,U);q._scaledDirection.scaleInPlace(1-W)}))}function lN(N,q){N._randomNoiseCoordinates1?(N._randomNoiseCoordinates1.hd(Math.random(),Math.random(),Math.random()),N._randomNoiseCoordinates2.hd(Math.random(),Math.random(),Math.random())):(N._randomNoiseCoordinates1=new d.Jq(Math.random(),Math.random(),Math.random()),N._randomNoiseCoordinates2=new d.Jq(Math.random(),Math.random(),Math.random()))}function TN(N,q){const C=q._noiseTextureData,U=q._noiseTextureSize;if(C&&U&&N._randomNoiseCoordinates1){const W=q._fetchR(N._randomNoiseCoordinates1.x,N._randomNoiseCoordinates1.y,U.width,U.height,C),a=q._fetchR(N._randomNoiseCoordinates1.z,N._randomNoiseCoordinates2.x,U.width,U.height,C),F=q._fetchR(N._randomNoiseCoordinates2.y,N._randomNoiseCoordinates2.z,U.width,U.height,C),w=d.TmpVectors.Jq[0],A=d.TmpVectors.Jq[1];w.hd((2*W-1)*q.noiseStrength.x,(2*a-1)*q.noiseStrength.y,(2*F-1)*q.noiseStrength.z),w.scaleToRef(q._tempScaledUpdateSpeed,A),N.direction.addInPlace(A)}}function zN(N,q){q.gravity.scaleToRef(q._tempScaledUpdateSpeed,q._scaledGravity),N.direction.addInPlace(q._scaledGravity)}function pN(N,q){N.size=(0,A.RandomRange)(q.minSize,q.maxSize),N.scale.hd((0,A.RandomRange)(q.minScaleX,q.maxScaleX),(0,A.RandomRange)(q.minScaleY,q.maxScaleY))}function sN(N,q){N._currentSizeGradient=q._sizeGradients[0],N._currentSize1=N._currentSizeGradient.getFactor(),N.size=N._currentSize1,q._sizeGradients.length>1?N._currentSize2=q._sizeGradients[1].getFactor():N._currentSize2=N._currentSize1,N.scale.hd((0,A.RandomRange)(q.minScaleX,q.maxScaleX),(0,A.RandomRange)(q.minScaleY,q.maxScaleY))}function XN(N,q){const C=q._actualFrame/q.targetStopDuration;m.GetCurrentGradient(C,q._startSizeGradients,((C,d,U)=>{C!==q._currentStartSizeGradient&&(q._currentStartSize1=q._currentStartSize2,q._currentStartSize2=d.getFactor(),q._currentStartSizeGradient=C);const W=(0,A.Lerp)(q._currentStartSize1,q._currentStartSize2,U);N.scale.scaleInPlace(W)}))}function PN(N,q){m.GetCurrentGradient(q._ratio,q._sizeGradients,((q,C,d)=>{q!==N._currentSizeGradient&&(N._currentSize1=N._currentSize2,N._currentSize2=C.getFactor(),N._currentSizeGradient=q),N.size=(0,A.Lerp)(N._currentSize1,N._currentSize2,d)}))}function MN(N,q){N.remapData=new d.Vector4(0,1,0,1)}function YN(N,q){q._colorRemapGradients&&q._colorRemapGradients.length>0&&m.GetCurrentGradient(q._ratio,q._colorRemapGradients,((q,C,d)=>{const U=(0,A.Lerp)(q.factor1,C.factor1,d),W=(0,A.Lerp)(q.factor2,C.factor2,d);N.remapData.x=U,N.remapData.y=W-U})),q._alphaRemapGradients&&q._alphaRemapGradients.length>0&&m.GetCurrentGradient(q._ratio,q._alphaRemapGradients,((q,C,d)=>{const U=(0,A.Lerp)(q.factor1,C.factor1,d),W=(0,A.Lerp)(q.factor2,C.factor2,d);N.remapData.z=U,N.remapData.w=W-U}))}function EN(N,q){const C=(0,A.Clamp)(q._actualFrame/q.targetStopDuration);m.GetCurrentGradient(C,q._lifeTimeGradients,((q,d)=>{const U=q,W=d,a=U.getFactor(),F=W.getFactor(),w=(C-U.gradient)/(W.gradient-U.gradient);N.lifeTime=(0,A.Lerp)(a,F,w)})),q._emitPower=(0,A.RandomRange)(q.minEmitPower,q.maxEmitPower)}function HN(N,q){N.lifeTime=(0,A.RandomRange)(q.minLifeTime,q.maxLifeTime),q._emitPower=(0,A.RandomRange)(q.minEmitPower,q.maxEmitPower)}function eN(N,q){0===q._emitPower?(N._initialDirection?N._initialDirection.U(N.direction):N._initialDirection=N.direction.clone(),N.direction.set(0,0,0)):(N._initialDirection=null,N.direction.scaleInPlace(q._emitPower)),N.direction.addInPlace(q._inheritedVelocityOffset)}function bN(N,q){N.angularSpeed=(0,A.RandomRange)(q.minAngularSpeed,q.maxAngularSpeed),N.angle=(0,A.RandomRange)(q.minInitialRotation,q.maxInitialRotation)}function oN(N,q){N._currentAngularSpeedGradient=q._angularSpeedGradients[0],N.angularSpeed=N._currentAngularSpeedGradient.getFactor(),N._currentAngularSpeed1=N.angularSpeed,q._angularSpeedGradients.length>1?N._currentAngularSpeed2=q._angularSpeedGradients[1].getFactor():N._currentAngularSpeed2=N._currentAngularSpeed1,N.angle=(0,A.RandomRange)(q.minInitialRotation,q.maxInitialRotation)}function SN(N,q){N._initialStartSpriteCellId=q.startSpriteCellID,N._initialEndSpriteCellId=q.endSpriteCellID,N._initialSpriteCellLoop=q.spriteCellLoop}function DN(N,q){N.previousItem=q.previousItem,N.nextItem=q,q.previousItem&&(q.previousItem.nextItem=N),q.previousItem=N}function cN(N,q){N.previousItem=q,N.nextItem=q.nextItem,q.nextItem&&(q.nextItem.previousItem=N),q.nextItem=N}function LN(N,q){let C=q;for(;C.nextItem;)C=C.nextItem;N.previousItem=C,N.nextItem=C.nextItem,C.nextItem=N}function GN(N){N.previousItem&&(N.previousItem.nextItem=N.nextItem),N.nextItem&&(N.nextItem.previousItem=N.previousItem)}class hN extends w{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(N){this._startDirectionFunction!==N&&(this._startDirectionFunction=N,this._directionProcessing.process=N?tN:nN)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(N){this._startPositionFunction!==N&&(this._startPositionFunction=N,this._positionCreation.process=N?ON:rN)}set onDispose(N){this._onDisposeObserver&&this.td.remove(this._onDisposeObserver),this._onDisposeObserver=this.td.add(N)}get A(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(N){this._useRampGradients!==N&&(this._useRampGradients=N,this._resetEffect(),N?(this._rampCreation={process:MN,previousItem:null,nextItem:null},cN(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:YN,previousItem:null,nextItem:null},cN(this._remapGradientProcessing,this._gravityProcessing)):(GN(this._rampCreation),GN(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(N){this._isLocal!==N&&(this._isLocal=N,N?(this._isLocalCreation={process:KN,previousItem:null,nextItem:null},cN(this._isLocalCreation,this._positionCreation)):GN(this._isLocalCreation))}get particles(){return this.Rt}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(N){this._animationSheetEnabled!==N&&(this._animationSheetEnabled=N,N?(this._sheetCreation={process:SN,previousItem:null,nextItem:null},cN(this._sheetCreation,this._colorCreation)):GN(this._sheetCreation),this._reset())}getActiveCount(){return this.Rt.length}getClassName(){return"dZ"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var N;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._customWrappers[q])||void 0===N?void 0:N.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[N]??this._customWrappers[0]}setCustomEffect(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[q]=new NN.e(this._engine),this._customWrappers[q].effect=N,this._customWrappers[q].drawContext&&(this._customWrappers[q].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new f.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(N){if(this.noiseTexture!==N){if(this._noiseTexture=N,!N)return GN(this._noiseCreation),void GN(this._noiseProcessing);this._noiseCreation={process:lN,previousItem:null,nextItem:null},cN(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:TN,previousItem:null,nextItem:null},cN(this._noiseProcessing,this._positionProcessing)}}constructor(N,q,C){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,W=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(N),this._emitterInverseWorldMatrix=d.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new d.Jq,this.td=new f.b,this.onStoppedObservable=new f.b,this.onStartedObservable=new f.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Rt=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new a.md(0,0,0,0),this._colorDiff=new a.md(0,0,0,0),this._scaledDirection=d.Jq.Zero(),this._scaledGravity=d.Jq.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=N=>{},this.recycleParticle=N=>{const q=this.Rt.pop();q!==N&&q.copyTo(N),this._stockParticles.push(q)},this._createParticle=()=>{let N;return 0!==this._stockParticles.length?(N=this._stockParticles.pop(),N._reset()):N=new x(this),this._prepareParticle(N),N},this.paused=!1,this._shadersLoaded=!1,this._capacity=q,this._epsilon=F,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=d.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||g.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Bt.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:HN,previousItem:null,nextItem:null},this._positionCreation={process:rN,previousItem:null,nextItem:null},cN(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:nN,previousItem:null,nextItem:null},cN(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:eN,previousItem:null,nextItem:null},cN(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:pN,previousItem:null,nextItem:null},cN(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:bN,previousItem:null,nextItem:null},cN(this._angleCreation,this._sizeCreation),this._colorCreation={process:UN,previousItem:null,nextItem:null},cN(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,w||(this._colorProcessing={process:FN,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:AN,previousItem:null,nextItem:null},cN(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:vN,previousItem:null,nextItem:null},cN(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:iN,previousItem:null,nextItem:null},cN(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:zN,previousItem:null,nextItem:null},cN(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=W,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new NN.e(this._engine)},this._customWrappers[0].effect=U,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new t,this.updateFunction=N=>{var q;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(q=this.noiseTexture.getContent())||void 0===q||q.then((N=>{this._noiseTextureData=N})));const C=N===this.Rt;for(let d=0;d<N.length;d++){const q=N[d];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const U=q.age;if(q.age+=this._tempScaledUpdateSpeed,q.age>q.lifeTime){const N=q.age-U,C=q.lifeTime-U;this._tempScaledUpdateSpeed=C*this._tempScaledUpdateSpeed/N,q.age=q.lifeTime}this._ratio=q.age/q.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let W=this._updateQueueStart;for(;W;)W.process(q,this),W=W.nextItem;if(this._isAnimationSheetEnabled&&!w&&q.updateCellIndex(),q._inheritParticleInfoToSubEmitters(),q.age>=q.lifeTime){if(this._emitFromParticle(q),q._attachedSubEmitters){for(const N of q._attachedSubEmitters)N.particleSystem.disposeOnStop=!0,N.particleSystem.stop();q._attachedSubEmitters=null}this.recycleParticle(q),C&&d--}else;}}}serialize(N){throw new Error("Method not implemented.")}clone(N,q){throw new Error("Method not implemented.")}_addFactorGradient(N,q,C,d){const U=new u(q,C,d);N.push(U),N.sort(((N,q)=>N.gradient<q.gradient?-1:N.gradient>q.gradient?1:0))}_removeFactorGradient(N,q){if(!N)return;let C=0;for(const d of N){if(d.gradient===q){N.splice(C,1);break}C++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=EN:this._lifeTimeCreation.process=HN}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:XN,previousItem:null,nextItem:null},cN(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(GN(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(N){this.targetStopDuration!==N&&(this._targetStopDuration=N,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(N,q,C){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,N,q,C),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(N){return this._removeFactorGradient(this._lifeTimeGradients,N),this._syncLifeTimeCreation(),this}addSizeGradient(N,q,C){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=sN,this._sizeGradientProcessing={process:PN,previousItem:null,nextItem:null},DN(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,N,q,C),this}removeSizeGradient(N){var q;return this._removeFactorGradient(this._sizeGradients,N),0===(null===(q=this._sizeGradients)||void 0===q?void 0:q.length)&&(GN(this._sizeGradientProcessing),this._sizeCreation.process=pN),this}addColorRemapGradient(N,q,C){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,N,q,C),this}removeColorRemapGradient(N){return this._removeFactorGradient(this._colorRemapGradients,N),this}addAlphaRemapGradient(N,q,C){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,N,q,C),this}removeAlphaRemapGradient(N){return this._removeFactorGradient(this._alphaRemapGradients,N),this}addAngularSpeedGradient(N,q,C){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=oN,this._angularSpeedGradientProcessing={process:wN,previousItem:null,nextItem:null},DN(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,N,q,C),this}removeAngularSpeedGradient(N){var q;return this._removeFactorGradient(this._angularSpeedGradients,N),0===(null===(q=this._angularSpeedGradients)||void 0===q?void 0:q.length)&&(this._angleCreation.process=bN,GN(this._angularSpeedGradientProcessing)),this}addVelocityGradient(N,q,C){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:VN,previousItem:null,nextItem:null},cN(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:JN,previousItem:null,nextItem:null},DN(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,N,q,C),this}removeVelocityGradient(N){var q;return this._removeFactorGradient(this._velocityGradients,N),0===(null===(q=this._velocityGradients)||void 0===q?void 0:q.length)&&(GN(this._velocityCreation),GN(this._velocityGradientProcessing)),this}addLimitVelocityGradient(N,q,C){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:ZN,previousItem:null,nextItem:null},cN(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:QN,previousItem:null,nextItem:null},cN(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,N,q,C),this}removeLimitVelocityGradient(N){var q;return this._removeFactorGradient(this._limitVelocityGradients,N),0===(null===(q=this._limitVelocityGradients)||void 0===q?void 0:q.length)&&(GN(this._limitVelocityCreation),GN(this._limitVelocityGradientProcessing)),this}addDragGradient(N,q,C){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:IN,previousItem:null,nextItem:null},DN(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:jN,previousItem:null,nextItem:null},DN(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,N,q,C),this}removeDragGradient(N){var q;return this._removeFactorGradient(this._dragGradients,N),0===(null===(q=this._dragGradients)||void 0===q?void 0:q.length)&&(GN(this._dragCreation),GN(this._dragGradientProcessing)),this}addEmitRateGradient(N,q,C){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,N,q,C),this}removeEmitRateGradient(N){return this._removeFactorGradient(this._emitRateGradients,N),this}addStartSizeGradient(N,q,C){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,N,q,C),this._syncStartSizeCreation(),this}removeStartSizeGradient(N){return this._removeFactorGradient(this._startSizeGradients,N),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const N=new Uint8Array(4*this._rawTextureWidth),q=a.TmpColors.Oq[0];for(let C=0;C<this._rawTextureWidth;C++){const d=C/this._rawTextureWidth;m.GetCurrentGradient(d,this._rampGradients,((d,U,W)=>{a.Oq.LerpToRef(d.color,U.color,W,q),N[4*C]=255*q.r,N[4*C+1]=255*q.g,N[4*C+2]=255*q.b,N[4*C+3]=255}))}this._rampGradientsTexture=k.d.CreateRGBATexture(N,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((N,q)=>N.gradient<q.gradient?-1:N.gradient>q.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(N,q){this._rampGradients||(this._rampGradients=[]);const C=new R(N,q);return this._rampGradients.push(C),this._syncRampGradientTexture(),this}removeRampGradient(N){return this._removeGradientAndTexture(N,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(N,q,C){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=WN,this._colorProcessing.process=aN);const d=new y(N,q,C);return this._colorGradients.push(d),this._colorGradients.sort(((N,q)=>N.gradient<q.gradient?-1:N.gradient>q.gradient?1:0)),this}removeColorGradient(N){if(!this._colorGradients)return this;let q=0;for(const C of this._colorGradients){if(C.gradient===N){this._colorGradients.splice(q,1);break}q++}return 0===this._colorGradients.length&&(this._colorCreation.process=UN,this._colorProcessing.process=FN),this}resetDrawCache(){if(this._drawWrappers){for(const N of this._drawWrappers)if(N)for(const q of N)null===q||void 0===q||q.dispose();this._drawWrappers=[]}}_fetchR(N,q,C,d,U){return U[4*(((N=.5*Math.abs(N)+.5)*C%C|0)+((q=.5*Math.abs(q)+.5)*d%d|0)*C)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const N=this._engine,q=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*q),this._vertexBuffer=new I.c(N,this._vertexData,!0,q);let C=0;const d=this._vertexBuffer.createVertexBuffer(I.g.PositionKind,C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[I.g.PositionKind]=d,C+=3;const U=this._vertexBuffer.createVertexBuffer(I.g.ColorKind,C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[I.g.ColorKind]=U,C+=4;const W=this._vertexBuffer.createVertexBuffer("angle",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=W,C+=1;const a=this._vertexBuffer.createVertexBuffer("size",C,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=a,C+=2,this._isAnimationSheetEnabled){const N=this._vertexBuffer.createVertexBuffer("cellIndex",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=N,C+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const N=this._vertexBuffer.createVertexBuffer("direction",C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=N,C+=3}if(this._useRampGradients){const N=this._vertexBuffer.createVertexBuffer("remapData",C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=N,C+=4}let F;if(this._useInstancing){const q=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new I.c(N,q,!1,2),F=this._spriteBuffer.createVertexBuffer("offset",0,2)}else F=this._vertexBuffer.createVertexBuffer("offset",C,2,this._vertexBufferSize,this._useInstancing),C+=2;this._vertexBuffers.offset=F,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const N=[],q=[];let C=0;for(let d=0;d<this._capacity;d++)N.push(C),N.push(C+1),N.push(C+2),N.push(C),N.push(C+2),N.push(C+3),q.push(C,C+1,C+1,C+2,C+2,C+3,C+3,C,C,C+3),C+=4;this._indexBuffer=this._engine.createIndexBuffer(N),this._linesIndexBuffer=this._engine.createIndexBuffer(q)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(N)setTimeout((()=>{this.start(0)}),N);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var q;-1!==(null===(q=this.dq)||void 0===q?void 0:q.getClassName().indexOf("Mesh"))&&this.dq.Ed(!0);const N=this.noiseTexture;if(N&&N.onGeneratedObservable)N.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let q=0;q<this.preWarmCycles;q++)this.animate(!0),N.render()}))}));else for(let q=0;q<this.preWarmCycles;q++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(N))}_postStop(N){}reset(){this._stockParticles.length=0,this.Rt.length=0}_appendParticleVertex(N,q,C,U){let W=N*this._vertexBufferSize;if(this._vertexData[W++]=q.position.x+this.aA.x,this._vertexData[W++]=q.position.y+this.aA.y,this._vertexData[W++]=q.position.z+this.aA.z,this._vertexData[W++]=q.color.r,this._vertexData[W++]=q.color.g,this._vertexData[W++]=q.color.b,this._vertexData[W++]=q.color.a,this._vertexData[W++]=q.angle,this._vertexData[W++]=q.scale.x*q.size,this._vertexData[W++]=q.scale.y*q.size,this._isAnimationSheetEnabled&&(this._vertexData[W++]=q.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[W++]=q.direction.x,this._vertexData[W++]=q.direction.y,this._vertexData[W++]=q.direction.z);else if(q._initialDirection){let N=q._initialDirection;this.isLocal&&(d.Jq.TransformNormalToRef(N,this._emitterWorldMatrix,d.TmpVectors.Jq[0]),N=d.TmpVectors.Jq[0]),0===N.x&&0===N.z&&(N.x=.001),this._vertexData[W++]=N.x,this._vertexData[W++]=N.y,this._vertexData[W++]=N.z}else{let N=q.direction;this.isLocal&&(d.Jq.TransformNormalToRef(N,this._emitterWorldMatrix,d.TmpVectors.Jq[0]),N=d.TmpVectors.Jq[0]),0===N.x&&0===N.z&&(N.x=.001),this._vertexData[W++]=N.x,this._vertexData[W++]=N.y,this._vertexData[W++]=N.z}this._useRampGradients&&q.remapData&&(this._vertexData[W++]=q.remapData.x,this._vertexData[W++]=q.remapData.y,this._vertexData[W++]=q.remapData.z,this._vertexData[W++]=q.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===C?C=this._epsilon:1===C&&(C=1-this._epsilon),0===U?U=this._epsilon:1===U&&(U=1-this._epsilon)),this._vertexData[W++]=C,this._vertexData[W++]=U)}_prepareParticle(N){}_createNewOnes(N){let q;for(let C=0;C<N&&this.Rt.length!==this._capacity;C++){q=this._createParticle(),this.Rt.push(q);let N=this._createQueueStart;for(;N;)N.process(q,this),N=N.nextItem;q._inheritParticleInfoToSubEmitters()}}_update(N){if(this._alive=this.Rt.length>0,this.dq.position){const N=this.dq;this._emitterWorldMatrix=N.getWorldMatrix()}else{const N=this.dq;this._emitterWorldMatrix=d.Matrix.Translation(N.x,N.y,N.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Rt),this._createNewOnes(N)}static _GetAttributeNamesOrOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=[I.g.PositionKind,I.g.ColorKind,"angle","offset","size"];return N&&d.push("cellIndex"),q||d.push("direction"),C&&d.push("remapData"),d}static _GetEffectCreationOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,qN.c)(d),N&&d.push("particlesInfos"),q&&d.push("logarithmicDepthConstant"),C&&(d.push("vFogInfos"),d.push("vFogColor")),d}fillDefines(N,q){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,qN.i)(this,this._scene,N),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&N.push("#define FOG")),this._isAnimationSheetEnabled&&N.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH"),q===w.BLENDMODE_MULTIPLY&&N.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&N.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(N.push("#define BILLBOARD"),this.billboardMode){case 2:N.push("#define BILLBOARDY");break;case 8:case 9:N.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&N.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:N.push("#define BILLBOARDMODE_ALL")}C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),N.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(N,q,C){q.push(...hN._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),N.push(...hN._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,dN.f)(N,this._imageProcessingConfigurationDefines),(0,dN.e)(C,this._imageProcessingConfigurationDefines))}_getWrapper(N){const q=this._getCustomDrawWrapper(N);if(null!==q&&void 0!==q&&q.effect)return q;const C=[];this.fillDefines(C,N);const d=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let U=this._drawWrappers[d];U||(U=this._drawWrappers[d]=[]);let W=U[N];W||(W=new NN.e(this._engine),W.drawContext&&(W.drawContext.useInstancing=this._useInstancing),U[N]=W);const a=C.join("\n");if(W.defines!==a){const N=[],q=[],C=[];this.fillUniformsAttributesAndSamplerNames(q,N,C),W.setEffect(this._engine.createEffect("particles",N,q,C,a,void 0,void 0,void 0,void 0,this._shaderLanguage),a)}return W}animate(){var N;let q,C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!C&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(C?this.preWarmStepOffset:(null===(N=this._scene)||void 0===N?void 0:N.getAnimationRatio())||1),this.manualEmitCount>-1)q=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let N=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const q=this._actualFrame/this.targetStopDuration;m.GetCurrentGradient(q,this._emitRateGradients,((q,C,d)=>{q!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=C.getFactor(),this._currentEmitRateGradient=q),N=(0,A.Lerp)(this._currentEmitRate1,this._currentEmitRate2,d)}))}q=N*this._scaledUpdateSpeed|0,this._newPartsExcess+=N*this._scaledUpdateSpeed-q}if(this._newPartsExcess>1&&(q+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?q=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(q),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!C){let N=0;for(let q=0;q<this.Rt.length;q++){const C=this.Rt[q];this._appendParticleVertices(N,C),N+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Rt.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(N,q){this._appendParticleVertex(N++,q,0,0),this._useInstancing||(this._appendParticleVertex(N++,q,1,0),this._appendParticleVertex(N++,q,1,1),this._appendParticleVertex(N++,q,0,1))}rebuild(){var N;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(N=this._spriteBuffer)||void 0===N||N._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!hN.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(C.bind(C,12598)),Promise.resolve().then(C.bind(C,12542))])):await Promise.all([Promise.resolve().then(C.bind(C,12532)),Promise.resolve().then(C.bind(C,12523))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.dq||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==w.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(w.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(w.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(N){const q=this._getWrapper(N),C=q.effect,U=this._engine;U.enableEffect(q);const W=this.defaultViewMatrix??this._scene.getViewMatrix();if(C.setTexture("diffuseSampler",this.particleTexture),C.setMatrix("view",W),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const N=this.particleTexture.getBaseSize();C.setFloat3("particlesInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,this.spriteCellWidth/N.width)}if(C.setVector2("translationPivot",this.translationPivot),C.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const N=this._scene.activeCamera;C.setVector3("eyePosition",N.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),C.setTexture("rampSampler",this._rampGradientsTexture));const a=C.defines;var F,w,A,n,t,V;(this._scene&&((0,qN.d)(C,this,this._scene),this.applyFog&&(0,CN.g)(this._scene,void 0,C)),a.indexOf("#define BILLBOARDMODE_ALL")>=0&&(W.invertToRef(d.TmpVectors.Matrix[0]),C.setMatrix("invView",d.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?U.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,C):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,C)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?U.bindBuffers(this._vertexBuffers,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBuffer:this._indexBuffer,C):U.bindBuffers(this._vertexBuffers,null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?this._linesIndexBufferUseInstancing:null,C);(this.useLogarithmicDepth&&this._scene&&(0,CN.n)(a,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(N),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),this._useInstancing)?null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?U.drawElementsType(6,0,10,this.Rt.length):U.drawArraysType(7,0,4,this.Rt.length):null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?U.drawElementsType(1,0,10*this.Rt.length):U.drawElementsType(0,0,6*this.Rt.length);return this.Rt.length}render(){if(!this.isReady()||!this.Rt.length)return 0;const N=this._engine;N.setState&&(N.setState(!1),this.forceDepthWrite&&N.setDepthWrite(!0));let q=0;return q=this.blendMode===w.BLENDMODE_MULTIPLYADD?this._render(w.BLENDMODE_MULTIPLY)+this._render(w.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),q}_onDispose(){}dispose(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),N&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),N&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(q,C),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const N=this._scene.Bt.indexOf(this);N>-1&&this._scene.Bt.splice(N,1),this._scene._activeParticleSystems.dispose()}this.td.notifyObservers(this),this.td.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}hN.ForceGLSL=!1;var BN,yN=C(10985);!function(N){N[N.ATTACHED=0]="ATTACHED",N[N.END=1]="END"}(BN||(BN={}));class RN{constructor(N){if(this.particleSystem=N,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!N.dq||!N.dq.dispose){const q=(0,F.e)("BABYLON.AbstractMesh");N.dq=new q("SubemitterSystemEmitter",N.lN()),N._disposeEmitterOnDispose=!0}}clone(){let N=this.particleSystem.dq;if(N){if(N instanceof d.Jq)N=N.clone();else if(-1!==N.getClassName().indexOf("Mesh")){N=new((0,F.e)("BABYLON.Mesh"))("",N.lN()),N.isVisible=!1}}else N=new d.Jq;const q=new RN(this.particleSystem.clone(this.particleSystem.name,N));return q.particleSystem.name+="Clone",q.type=this.type,q.inheritDirection=this.inheritDirection,q.inheritedVelocityAmount=this.inheritedVelocityAmount,q.particleSystem._disposeEmitterOnDispose=!0,q.particleSystem.disposeOnStop=!0,q}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};return q.type=this.type,q.inheritDirection=this.inheritDirection,q.inheritedVelocityAmount=this.inheritedVelocityAmount,q.particleSystem=this.particleSystem.serialize(N),q}static _ParseParticleSystem(N,q,C){throw(0,yN.b)("ParseParticle")}static Parse(N,q,C){const d=N.particleSystem,U=new RN(RN._ParseParticleSystem(d,q,C,!0));return U.type=N.type,U.inheritDirection=N.inheritDirection,U.inheritedVelocityAmount=N.inheritedVelocityAmount,U.particleSystem._isSubEmitter=!0,U}dispose(){this.particleSystem.dispose()}}var uN=C(11032);function mN(N,q){const C=new r;return C.direction1=N,C.direction2=q,C}function fN(){return new v(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function kN(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function gN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.Jq(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.Jq(0,1,0);return new K(N,q,C)}function xN(){return new J(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Nq(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.Jq(0,1,0),W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.Jq(0,1,0);return new Q(N,q,C,U,W)}function qq(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new V(N,q)}function Cq(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.Jq(0,1,0),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.Jq(0,1,0);return new Z(N,q,C,U)}const dq=d.Jq.Zero(),Uq=d.Jq.Zero(),Wq=d.Jq.Zero();class aq{constructor(){this.strength=0,this.position=d.Jq.Zero()}_processParticle(N,q){this.position.subtractToRef(N.position,dq);const C=dq.lengthSquared()+1;dq.normalize().scaleToRef(this.strength/C,Uq),Uq.scaleToRef(q._tempScaledUpdateSpeed,Wq),N.direction.addInPlace(Wq)}serialize(){return{position:this.position.zd(),strength:this.strength}}}class Fq extends hN{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=N=>{if(!this._subEmitters||0===this._subEmitters.length)return;const q=Math.floor(Math.random()*this._subEmitters.length);for(const C of this._subEmitters[q])if(1===C.type){const q=C.clone();N._inheritParticleInfoToSubEmitter(q),q.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(q.particleSystem),q.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(N,q){const C=mN(N,q);return this.particleEmitterType=C,C}get flowMap(){return this._flowMap}set flowMap(N){this._flowMap!==N&&(this._flowMap=N,this._flowMapUpdate&&(GN(this._flowMapUpdate),this._flowMapUpdate=null),N&&(this._flowMapUpdate={process:N=>{var q;const C=null===(q=this.lN())||void 0===q?void 0:q.getTransformMatrix();this._flowMap._processParticle(N,this.flowMapStrength*this._tempScaledUpdateSpeed,C)},previousItem:null,nextItem:null},cN(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(N){this._attractors.push(N),1===this._attractors.length&&(this._attractorUpdate={process:N=>{for(const q of this._attractors)q._processParticle(N,this)},previousItem:null,nextItem:null},cN(this._attractorUpdate,this._directionProcessing))}removeAttractor(N){const q=this._attractors.indexOf(N);-1!==q&&this._attractors.splice(q,1),0===this._attractors.length&&GN(this._attractorUpdate)}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(N)}createHemisphericEmitter(){const N=fN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createSphereEmitter(){const N=kN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createDirectedSphereEmitter(){const N=gN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.Jq(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.Jq(0,1,0));return this.particleEmitterType=N,N}createCylinderEmitter(){const N=xN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=N,N}createDirectedCylinderEmitter(){const N=Nq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.Jq(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.Jq(0,1,0));return this.particleEmitterType=N,N}createConeEmitter(){const N=qq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=N,N}createDirectedConeEmitter(){const N=Cq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.Jq(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.Jq(0,1,0));return this.particleEmitterType=N,N}createBoxEmitter(N,q,C,d){const U=new t;return this.particleEmitterType=U,this.direction1=N,this.direction2=q,this.minEmitBox=C,this.maxEmitBox=d,U}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const N of this.subEmitters)N instanceof Fq?this._subEmitters.push([new RN(N)]):N instanceof RN?this._subEmitters.push([N]):N instanceof Array&&this._subEmitters.push(N)}_stopSubEmitters(){if(this.activeSubSystems){for(const N of this.activeSubSystems)N.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const N=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==N&&this._rootParticleSystem.activeSubSystems.splice(N,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(N){N&&this._stopSubEmitters()}_prepareParticle(N){if(this._subEmitters&&this._subEmitters.length>0){const q=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];N._attachedSubEmitters=[];for(const C of q)if(0===C.type){const q=C.clone();N._attachedSubEmitters.push(q),q.particleSystem.start()}}}_onDispose(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),N&&this.particles)for(const C of this.particles)if(C._attachedSubEmitters)for(let N=C._attachedSubEmitters.length-1;N>=0;N-=1)C._attachedSubEmitters[N].dispose();if(q&&this.activeSubSystems)for(let C=this.activeSubSystems.length-1;C>=0;C-=1)this.activeSubSystems[C].dispose();if(this._subEmitters&&this._subEmitters.length){for(let N=0;N<this._subEmitters.length;N++)for(const q of this._subEmitters[N])q.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.dq&&this.dq.dispose&&this.dq.dispose(!0)}static _Parse(N,q,C,U){let W;W=C instanceof uN.b?null:C;const w=(0,F.e)("BABYLON.Texture");if(w&&W&&(N.texture?q.particleTexture=w.Parse(N.texture,W,U):N.textureName&&(q.particleTexture=new w(U+N.textureName,W,!1,void 0===N.invertY||N.invertY),q.particleTexture.name=N.textureName)),N.emitterId||0===N.emitterId||void 0!==N.dq?N.emitterId&&W?q.dq=W.getLastMeshById(N.emitterId):q.dq=d.Jq.Kq(N.dq):q.dq=d.Jq.Zero(),q.isLocal=!!N.isLocal,void 0!==N.renderingGroupId&&(q.renderingGroupId=N.renderingGroupId),void 0!==N.isBillboardBased&&(q.isBillboardBased=N.isBillboardBased),void 0!==N.billboardMode&&(q.billboardMode=N.billboardMode),void 0!==N.useLogarithmicDepth&&(q.useLogarithmicDepth=N.useLogarithmicDepth),N.animations){for(let C=0;C<N.animations.length;C++){const d=N.animations[C],U=(0,F.e)("BABYLON.Animation");U&&q.animations.push(U.Parse(d))}q.beginAnimationOnStart=N.beginAnimationOnStart,q.beginAnimationFrom=N.beginAnimationFrom,q.beginAnimationTo=N.beginAnimationTo,q.beginAnimationLoop=N.beginAnimationLoop}if(N.autoAnimate&&W&&W.beginAnimation(q,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),q.startDelay=0|N.startDelay,q.minAngularSpeed=N.minAngularSpeed,q.maxAngularSpeed=N.maxAngularSpeed,q.minSize=N.minSize,q.maxSize=N.maxSize,N.minScaleX&&(q.minScaleX=N.minScaleX,q.maxScaleX=N.maxScaleX,q.minScaleY=N.minScaleY,q.maxScaleY=N.maxScaleY),void 0!==N.preWarmCycles&&(q.preWarmCycles=N.preWarmCycles,q.preWarmStepOffset=N.preWarmStepOffset),void 0!==N.minInitialRotation&&(q.minInitialRotation=N.minInitialRotation,q.maxInitialRotation=N.maxInitialRotation),q.minLifeTime=N.minLifeTime,q.maxLifeTime=N.maxLifeTime,q.minEmitPower=N.minEmitPower,q.maxEmitPower=N.maxEmitPower,q.emitRate=N.emitRate,q.gravity=d.Jq.Kq(N.gravity),N.noiseStrength&&(q.noiseStrength=d.Jq.Kq(N.noiseStrength)),q.color1=a.md.Kq(N.color1),q.color2=a.md.Kq(N.color2),q.colorDead=a.md.Kq(N.colorDead),q.updateSpeed=N.updateSpeed,q.targetStopDuration=N.targetStopDuration,q.blendMode=N.blendMode,N.colorGradients)for(const d of N.colorGradients)q.addColorGradient(d.gradient,a.md.Kq(d.color1),d.color2?a.md.Kq(d.color2):void 0);if(N.rampGradients){for(const C of N.rampGradients)q.addRampGradient(C.gradient,a.Oq.Kq(C.color));q.useRampGradients=N.useRampGradients}if(N.colorRemapGradients)for(const d of N.colorRemapGradients)q.addColorRemapGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(N.alphaRemapGradients)for(const d of N.alphaRemapGradients)q.addAlphaRemapGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(N.sizeGradients)for(const d of N.sizeGradients)q.addSizeGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(N.angularSpeedGradients)for(const d of N.angularSpeedGradients)q.addAngularSpeedGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(N.velocityGradients)for(const d of N.velocityGradients)q.addVelocityGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(N.dragGradients)for(const d of N.dragGradients)q.addDragGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(N.emitRateGradients)for(const d of N.emitRateGradients)q.addEmitRateGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(N.startSizeGradients)for(const d of N.startSizeGradients)q.addStartSizeGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(N.lifeTimeGradients)for(const d of N.lifeTimeGradients)q.addLifeTimeGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);if(N.limitVelocityGradients){for(const C of N.limitVelocityGradients)q.addLimitVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);q.limitVelocityDamping=N.limitVelocityDamping}if(N.noiseTexture&&W){const C=(0,F.e)("BABYLON.ProceduralTexture");q.noiseTexture=C.Parse(N.noiseTexture,W,U)}let A;if(N.particleEmitterType){switch(N.particleEmitterType.type){case"SphereParticleEmitter":A=new O;break;case"SphereDirectedParticleEmitter":A=new K;break;case"ConeEmitter":case"ConeParticleEmitter":A=new V;break;case"ConeDirectedParticleEmitter":A=new Z;break;case"CylinderParticleEmitter":A=new J;break;case"CylinderDirectedParticleEmitter":A=new Q;break;case"HemisphericParticleEmitter":A=new v;break;case"PointParticleEmitter":A=new r;break;case"MeshParticleEmitter":A=new j;break;case"CustomParticleEmitter":A=new i;break;default:A=new t}A.parse(N.particleEmitterType,W)}else A=new t,A.parse(N,W);q.particleEmitterType=A,q.startSpriteCellID=N.startSpriteCellID,q.endSpriteCellID=N.endSpriteCellID,q.spriteCellLoop=N.spriteCellLoop??!0,q.spriteCellWidth=N.spriteCellWidth,q.spriteCellHeight=N.spriteCellHeight,q.spriteCellChangeSpeed=N.spriteCellChangeSpeed,q.spriteRandomStartCell=N.spriteRandomStartCell,q.disposeOnStop=N.disposeOnStop??!1,q.manualEmitCount=N.manualEmitCount??-1}static Parse(N,q,C){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],W=arguments.length>4?arguments[4]:void 0;const F=N.name;let w,A,n=null,t=null;if(q instanceof uN.b?w=q:(A=q,w=A.getEngine()),N.customShader&&w.createEffectForParticles){t=N.customShader;const q=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"";n=w.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,q)}const V=new Fq(F,W||N.oq,q,n,N.isAnimationSheetEnabled);if(V.customShader=t,V._rootUrl=C,N.id&&(V.id=N.id),N.subEmitters){V.subEmitters=[];for(const d of N.subEmitters){const N=[];for(const U of d)N.push(RN.Parse(U,q,C));V.subEmitters.push(N)}}if(N.attractors)for(const a of N.attractors){const N=new aq;N.position=d.Jq.Kq(a.position),N.strength=a.strength,V.addAttractor(N)}return Fq._Parse(N,V,q,C),N.textureMask&&(V.textureMask=a.md.Kq(N.textureMask)),N.aA&&(V.aA=d.Jq.Kq(N.aA)),N.preventAutoStart&&(V.preventAutoStart=N.preventAutoStart),U||V.preventAutoStart||V.start(),V}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};if(Fq._Serialize(q,this,N),q.textureMask=this.textureMask.zd(),q.customShader=this.customShader,q.preventAutoStart=this.preventAutoStart,q.aA=this.aA.zd(),this.subEmitters){q.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const C of this._subEmitters){const d=[];for(const q of C)d.push(q.serialize(N));q.subEmitters.push(d)}}if(this._attractors&&this._attractors.length){q.attractors=[];for(const N of this._attractors)q.attractors.push(N.serialize())}return q}static _Serialize(N,q,C){if(N.name=q.name,N.id=q.id,N.oq=q.getCapacity(),N.disposeOnStop=q.disposeOnStop,N.manualEmitCount=q.manualEmitCount,q.dq.position){const C=q.dq;N.emitterId=C.id}else{const C=q.dq;N.dq=C.zd()}q.particleEmitterType&&(N.particleEmitterType=q.particleEmitterType.serialize()),q.particleTexture&&(C?N.texture=q.particleTexture.serialize():(N.textureName=q.particleTexture.name,N.invertY=!!q.particleTexture._invertY)),N.isLocal=q.isLocal,E.d.AppendSerializedAnimations(q,N),N.beginAnimationOnStart=q.beginAnimationOnStart,N.beginAnimationFrom=q.beginAnimationFrom,N.beginAnimationTo=q.beginAnimationTo,N.beginAnimationLoop=q.beginAnimationLoop,N.startDelay=q.startDelay,N.renderingGroupId=q.renderingGroupId,N.isBillboardBased=q.isBillboardBased,N.billboardMode=q.billboardMode,N.minAngularSpeed=q.minAngularSpeed,N.maxAngularSpeed=q.maxAngularSpeed,N.minSize=q.minSize,N.maxSize=q.maxSize,N.minScaleX=q.minScaleX,N.maxScaleX=q.maxScaleX,N.minScaleY=q.minScaleY,N.maxScaleY=q.maxScaleY,N.minEmitPower=q.minEmitPower,N.maxEmitPower=q.maxEmitPower,N.minLifeTime=q.minLifeTime,N.maxLifeTime=q.maxLifeTime,N.emitRate=q.emitRate,N.gravity=q.gravity.zd(),N.noiseStrength=q.noiseStrength.zd(),N.color1=q.color1.zd(),N.color2=q.color2.zd(),N.colorDead=q.colorDead.zd(),N.updateSpeed=q.updateSpeed,N.targetStopDuration=q.targetStopDuration,N.blendMode=q.blendMode,N.preWarmCycles=q.preWarmCycles,N.preWarmStepOffset=q.preWarmStepOffset,N.minInitialRotation=q.minInitialRotation,N.maxInitialRotation=q.maxInitialRotation,N.startSpriteCellID=q.startSpriteCellID,N.spriteCellLoop=q.spriteCellLoop,N.endSpriteCellID=q.endSpriteCellID,N.spriteCellChangeSpeed=q.spriteCellChangeSpeed,N.spriteCellWidth=q.spriteCellWidth,N.spriteCellHeight=q.spriteCellHeight,N.spriteRandomStartCell=q.spriteRandomStartCell,N.isAnimationSheetEnabled=q.isAnimationSheetEnabled,N.useLogarithmicDepth=q.useLogarithmicDepth;const d=q.getColorGradients();if(d){N.colorGradients=[];for(const q of d){const C={gradient:q.gradient,color1:q.color1.zd()};q.color2?C.color2=q.color2.zd():C.color2=q.color1.zd(),N.colorGradients.push(C)}}const U=q.getRampGradients();if(U){N.rampGradients=[];for(const q of U){const C={gradient:q.gradient,color:q.color.zd()};N.rampGradients.push(C)}N.useRampGradients=q.useRampGradients}const W=q.getColorRemapGradients();if(W){N.colorRemapGradients=[];for(const q of W){const C={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?C.factor2=q.factor2:C.factor2=q.factor1,N.colorRemapGradients.push(C)}}const a=q.getAlphaRemapGradients();if(a){N.alphaRemapGradients=[];for(const q of a){const C={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?C.factor2=q.factor2:C.factor2=q.factor1,N.alphaRemapGradients.push(C)}}const F=q.getSizeGradients();if(F){N.sizeGradients=[];for(const q of F){const C={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?C.factor2=q.factor2:C.factor2=q.factor1,N.sizeGradients.push(C)}}const w=q.getAngularSpeedGradients();if(w){N.angularSpeedGradients=[];for(const q of w){const C={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?C.factor2=q.factor2:C.factor2=q.factor1,N.angularSpeedGradients.push(C)}}const A=q.getVelocityGradients();if(A){N.velocityGradients=[];for(const q of A){const C={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?C.factor2=q.factor2:C.factor2=q.factor1,N.velocityGradients.push(C)}}const n=q.getDragGradients();if(n){N.dragGradients=[];for(const q of n){const C={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?C.factor2=q.factor2:C.factor2=q.factor1,N.dragGradients.push(C)}}const t=q.getEmitRateGradients();if(t){N.emitRateGradients=[];for(const q of t){const C={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?C.factor2=q.factor2:C.factor2=q.factor1,N.emitRateGradients.push(C)}}const V=q.getStartSizeGradients();if(V){N.startSizeGradients=[];for(const q of V){const C={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?C.factor2=q.factor2:C.factor2=q.factor1,N.startSizeGradients.push(C)}}const Z=q.getLifeTimeGradients();if(Z){N.lifeTimeGradients=[];for(const q of Z){const C={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?C.factor2=q.factor2:C.factor2=q.factor1,N.lifeTimeGradients.push(C)}}const J=q.getLimitVelocityGradients();if(J){N.limitVelocityGradients=[];for(const q of J){const C={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?C.factor2=q.factor2:C.factor2=q.factor1,N.limitVelocityGradients.push(C)}N.limitVelocityDamping=q.limitVelocityDamping}q.noiseTexture&&(N.noiseTexture=q.noiseTexture.serialize())}clone(N,q){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d={...this._customWrappers};let U=null;const W=this._engine;if(W.createEffectForParticles&&null!=this.customShader){U=this.customShader;const N=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",q=W.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,N);d[0]?d[0].effect=q:this.setCustomEffect(q,0)}const a=this.serialize(C),F=Fq.Parse(a,this._scene||this._engine,this._rootUrl);return F.name=N,F.customShader=U,F._customWrappers=d,void 0===q&&(q=this.dq),this.noiseTexture&&(F.noiseTexture=this.noiseTexture.clone()),F.dq=q,this.preventAutoStart||F.start(),F}}Fq.BILLBOARDMODE_Y=2,Fq.BILLBOARDMODE_ALL=7,Fq.BILLBOARDMODE_STRETCHED=8,Fq.BILLBOARDMODE_STRETCHED_LOCAL=9,RN._ParseParticleSystem=Fq.Parse;var wq=C(11366),Aq=C(11364),nq=C(11259);nq.e.prototype.createTransformFeedback=function(){const N=this._gl.createTransformFeedback();if(!N)throw new Error("Unable to create Transform Feedback");return N},nq.e.prototype.deleteTransformFeedback=function(N){this._gl.deleteTransformFeedback(N)},nq.e.prototype.bindTransformFeedback=function(N){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,N)},nq.e.prototype.beginTransformFeedback=function(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(N?this._gl.POINTS:this._gl.TRIANGLES)},nq.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},nq.e.prototype.setTranformFeedbackVaryings=function(N,q){this._gl.transformFeedbackVaryings(N,q,this._gl.INTERLEAVED_ATTRIBS)},nq.e.prototype.bindTransformFeedbackBuffer=function(N){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,N?N.underlyingResource:null)},nq.e.prototype.readTransformFeedbackBuffer=function(N){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,N)};const tq="clipPlaneFragmentDeclaration2",Vq="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";T.c.IncludesShadersStore[tq]||(T.c.IncludesShadersStore[tq]=Vq);C(12431),C(12434),C(12441),C(12443),C(12449),C(12456),C(12462),C(12464);const Zq="gpuRenderParticlesPixelShader",Jq="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";T.c.ShadersStore[Zq]||(T.c.ShadersStore[Zq]=Jq);const Qq="clipPlaneVertexDeclaration2",vq="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";T.c.IncludesShadersStore[Qq]||(T.c.IncludesShadersStore[Qq]=vq);C(12471),C(12477),C(12482),C(12488);const rq="gpuRenderParticlesVertexShader",Oq="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";T.c.ShadersStore[rq]||(T.c.ShadersStore[rq]=Oq);class Kq extends w{static get IsSupported(){if(!g.e.LastCreatedEngine)return!1;const N=g.e.LastCreatedEngine.getCaps();return N.supportTransformFeedbacks||N.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(N){this._maxActiveParticleCount=Math.min(N,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(N){this.maxActiveParticleCount=N}createPointEmitter(N,q){const C=mN(N,q);return this.particleEmitterType=C,C}createHemisphericEmitter(){const N=fN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createSphereEmitter(){const N=kN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createDirectedSphereEmitter(){const N=gN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d.Jq(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.Jq(0,1,0));return this.particleEmitterType=N,N}createCylinderEmitter(){const N=xN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=N,N}createDirectedCylinderEmitter(){const N=Nq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.Jq(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new d.Jq(0,1,0));return this.particleEmitterType=N,N}createConeEmitter(){const N=qq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=N,N}createDirectedConeEmitter(){const N=Cq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new d.Jq(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d.Jq(0,1,0));return this.particleEmitterType=N,N}createBoxEmitter(N,q,C,d){const U=new t;return this.particleEmitterType=U,this.direction1=N,this.direction2=q,this.minEmitBox=C,this.maxEmitBox=d,U}get flowMap(){return this._flowMap}set flowMap(N){this._flowMap!==N&&(this._flowMap=N)}isReady(){if(!this.dq||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Fq.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Fq.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Fq.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";N?setTimeout((()=>{this.start(0)}),N):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var N;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._customWrappers[q])||void 0===N?void 0:N.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[N]??this._customWrappers[0]}setCustomEffect(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[q]=new NN.e(this._engine),this._customWrappers[q].effect=N}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new f.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(N,q,C){return super._removeGradientAndTexture(N,q,C),this._releaseBuffers(),this}addColorGradient(N,q){this._colorGradients||(this._colorGradients=[]);const C=new y(N,q);return this._colorGradients.push(C),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(N&&this._colorGradients.sort(((N,q)=>N.gradient<q.gradient?-1:N.gradient>q.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(N){return this._removeGradientAndTexture(N,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const q in this._drawWrappers){var N;null===(N=this._drawWrappers[q].drawContext)||void 0===N||N.reset()}}_addFactorGradient(N,q,C){const d=new u(q,C);N.push(d),this._releaseBuffers()}addSizeGradient(N,q){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,N,q),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(N){return this._removeGradientAndTexture(N,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(N,q){if(!N)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&N.sort(((N,q)=>N.gradient<q.gradient?-1:N.gradient>q.gradient?1:0));const C=this;C[q]&&(C[q].dispose(),C[q]=null)}addAngularSpeedGradient(N,q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,N,q),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(N){return this._removeGradientAndTexture(N,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(N,q){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,N,q),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(N){return this._removeGradientAndTexture(N,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(N,q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,N,q),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(N){return this._removeGradientAndTexture(N,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(N,q){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,N,q),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(N){return this._removeGradientAndTexture(N,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(N){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(N,q,C){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,W=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(N),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.td=new f.b,this.onStoppedObservable=new f.b,this.onStartedObservable=new f.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=d.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||g.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Bt.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,F.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,F.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,F.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,F.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new NN.e(this._engine)},this._customWrappers[0].effect=U,this._drawWrappers={0:new NN.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(q=q??{}).randomTextureSize||delete q.randomTextureSize;const a={oq:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...q},w=q;isFinite(w)&&(a.oq=w),this._capacity=a.oq,this._maxActiveParticleCount=a.oq,this._currentActiveCount=0,this._isAnimationSheetEnabled=W,this.particleEmitterType=new t;const A=Math.min(this._engine.getCaps().maxTextureSize,a.randomTextureSize);let n=[];for(let d=0;d<A;++d)n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random());this._randomTexture=new k.d(new Float32Array(n),A,1,5,C,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,n=[];for(let d=0;d<A;++d)n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random());this._randomTexture2=new k.d(new Float32Array(n),A,1,5,C,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=A}_reset(){this._releaseBuffers()}_createVertexBuffers(N,q,C){const d={};d.position=q.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let U=3;d.age=q.createVertexBuffer("age",U,1,this._attributesStrideSize,!0),U+=1,d.size=q.createVertexBuffer("size",U,3,this._attributesStrideSize,!0),U+=3,d.life=q.createVertexBuffer("life",U,1,this._attributesStrideSize,!0),U+=1,U+=4,this.billboardMode===Fq.BILLBOARDMODE_STRETCHED&&(d.direction=q.createVertexBuffer("direction",U,3,this._attributesStrideSize,!0)),U+=3,this._platform.alignDataInBuffer&&(U+=1),this.particleEmitterType instanceof i&&(U+=3,this._platform.alignDataInBuffer&&(U+=1)),this._colorGradientsTexture||(d.color=q.createVertexBuffer("color",U,4,this._attributesStrideSize,!0),U+=4),this._isBillboardBased||(d.initialDirection=q.createVertexBuffer("initialDirection",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1)),this.noiseTexture&&(d.noiseCoordinates1=q.createVertexBuffer("noiseCoordinates1",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1),d.noiseCoordinates2=q.createVertexBuffer("noiseCoordinates2",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1)),d.angle=q.createVertexBuffer("angle",U,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?U++:U+=2,this._isAnimationSheetEnabled&&(d.cellIndex=q.createVertexBuffer("cellIndex",U,1,this._attributesStrideSize,!0),U+=1,this.spriteRandomStartCell&&(d.cellStartOffset=q.createVertexBuffer("cellStartOffset",U,1,this._attributesStrideSize,!0),U+=1)),d.offset=C.createVertexBuffer("offset",0,2),d.uv=C.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(d),this._platform.createVertexBuffers(N,d),this.resetDrawCache()}_initialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!N)return;const q=this._engine,C=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof i&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const U=this.particleEmitterType instanceof i,W=d.TmpVectors.Jq[0];let a=0;for(let d=0;d<this._capacity;d++)if(C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),U?(this.particleEmitterType.particleDestinationGenerator(d,null,W),C.push(W.x),C.push(W.y),C.push(W.z)):(C.push(0),C.push(0),C.push(0)),this._platform.alignDataInBuffer&&C.push(0),a+=16,U&&(this.particleEmitterType.particlePositionGenerator(d,null,W),C.push(W.x),C.push(W.y),C.push(W.z),this._platform.alignDataInBuffer&&C.push(0),a+=4),this._colorGradientsTexture||(C.push(0),C.push(0),C.push(0),C.push(0),a+=4),this.isBillboardBased||(C.push(0),C.push(0),C.push(0),this._platform.alignDataInBuffer&&C.push(0),a+=4),this.noiseTexture&&(C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),a+=8),C.push(0),a+=1,this._angularSpeedGradientsTexture||(C.push(0),a+=1),this._isAnimationSheetEnabled&&(C.push(0),a+=1,this.spriteRandomStartCell&&(C.push(0),a+=1)),this._platform.alignDataInBuffer){let N=3-(a+3&3);for(a+=N;N-- >0;)C.push(0)}const F=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),w=this._platform.createParticleBuffer(C),A=this._platform.createParticleBuffer(C);this._buffer0=new I.c(q,w,!1,this._attributesStrideSize),this._buffer1=new I.c(q,A,!1,this._attributesStrideSize),this._spriteBuffer=new I.c(q,F,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let N=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(N+="\n#define BILLBOARD"),this._colorGradientsTexture&&(N+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(N+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(N+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(N+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(N+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(N+="\n#define DRAGGRADIENTS"),this._flowMap&&(N+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(N+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(N+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(N+="\n#define NOISE"),this.isLocal&&(N+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===N||(this._cachedUpdateDefines=N,this._updateBuffer=this._platform.createUpdateBuffer(N)),this._platform.isUpdateBufferReady()}_getWrapper(N){const q=this._getCustomDrawWrapper(N);if(null!==q&&void 0!==q&&q.effect)return q;const C=[];this.fillDefines(C,N);let d=this._drawWrappers[N];d||(d=new NN.e(this._engine),d.drawContext&&(d.drawContext.useInstancing=!0),this._drawWrappers[N]=d);const U=C.join("\n");if(d.defines!==U){const N=[],q=[],C=[];this.fillUniformsAttributesAndSamplerNames(q,N,C),d.setEffect(this._engine.createEffect("gpuRenderParticles",N,q,C,U),U)}return d}static _GetAttributeNamesOrOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const U=[I.g.PositionKind,"age","life","size","angle"];return N||U.push(I.g.ColorKind),q&&U.push("cellIndex"),C||U.push("initialDirection"),d&&U.push("direction"),U.push("offset",I.g.UVKind),U}static _GetEffectCreationOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d=["emitterWM","aA","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,qN.c)(d),N&&d.push("sheetInfos"),q&&d.push("logarithmicDepthConstant"),C&&(d.push("vFogInfos"),d.push("vFogColor")),d}fillDefines(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,qN.i)(this,this._scene,N),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Aq.c.FOGMODE_NONE&&N.push("#define FOG")),q===Fq.BLENDMODE_MULTIPLY&&N.push("#define BLENDMULTIPLYMODE"),this.isLocal&&N.push("#define LOCAL"),this.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(N.push("#define BILLBOARD"),this.billboardMode){case Fq.BILLBOARDMODE_Y:N.push("#define BILLBOARDY");break;case Fq.BILLBOARDMODE_STRETCHED:N.push("#define BILLBOARDSTRETCHED");break;case Fq.BILLBOARDMODE_ALL:N.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&N.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&N.push("#define ANIMATESHEET"),C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),N.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(N,q,C){q.push(...Kq._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Fq.BILLBOARDMODE_STRETCHED)),N.push(...Kq._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(wq.b.PrepareUniforms(N,this._imageProcessingConfigurationDefines),wq.b.PrepareSamplers(C,this._imageProcessingConfigurationDefines))}animate(){var N;let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(q?this.preWarmStepOffset:(null===(N=this._scene)||void 0===N?void 0:N.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(N,q){const C=this[q];if(!N||!N.length||C)return;const d=new Float32Array(this._rawTextureWidth);for(let U=0;U<this._rawTextureWidth;U++){const q=U/this._rawTextureWidth;m.GetCurrentGradient(q,N,((N,q,C)=>{d[U]=(0,A.Lerp)(N.factor1,q.factor1,C)}))}this[q]=k.d.CreateRTexture(d,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[q].name=q.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const N=new Uint8Array(4*this._rawTextureWidth),q=a.TmpColors.md[0];for(let C=0;C<this._rawTextureWidth;C++){const d=C/this._rawTextureWidth;m.GetCurrentGradient(d,this._colorGradients,((d,U,W)=>{a.md.LerpToRef(d.color1,U.color1,W,q),N[4*C]=255*q.r,N[4*C+1]=255*q.g,N[4*C+2]=255*q.b,N[4*C+3]=255*q.a}))}this._colorGradientsTexture=k.d.CreateRGBATexture(N,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(N,q){var C,U,W,a;const F=this._getWrapper(N),w=F.effect;this._engine.enableEffect(F);const A=(null===(C=this._scene)||void 0===C?void 0:C.getViewMatrix())||d.Matrix.IdentityReadOnly;if(w.setMatrix("view",A),w.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),w.setTexture("diffuseSampler",this.particleTexture),w.setVector2("translationPivot",this.translationPivot),w.setVector3("aA",this.aA),this.isLocal&&w.setMatrix("emitterWM",q),this._colorGradientsTexture?w.setTexture("colorGradientSampler",this._colorGradientsTexture):w.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const N=this.particleTexture.getBaseSize();w.setFloat3("sheetInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,N.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const N=this._scene.activeCamera;w.setVector3("eyePosition",N.globalPosition)}const n=w.defines;if(this._scene&&((0,qN.d)(w,this,this._scene),this.applyFog&&(0,CN.g)(this._scene,void 0,w)),n.indexOf("#define BILLBOARDMODE_ALL")>=0){const N=A.clone();N.invert(),w.setMatrix("invView",N)}return this.useLogarithmicDepth&&this._scene&&(0,CN.n)(n,w,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(w),this._setEngineBasedOnBlendMode(N),this._platform.bindDrawBuffers(this._targetIndex,w,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(w),null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(a=this._scene)&&void 0!==a&&a.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(N){if(!this.dq||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!N)if(this.dq.position){N=this.dq.getWorldMatrix()}else{const q=this.dq;N=d.TmpVectors.Matrix[0],d.Matrix.TranslationToRef(q.x,q.y,q.z,N)}const q=this._engine,C=q.getDepthWrite();if(q.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const N=this.lN();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",N.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",N),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const U=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=U,q.setDepthWrite(C)}render(){let N,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!q&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let N=0;N<this.preWarmCycles;N++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const N=0|this._accumulatedCount;this._accumulatedCount-=N,this._currentActiveCount+=N}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.dq.position){N=this.dq.getWorldMatrix()}else{const q=this.dq;N=d.TmpVectors.Matrix[0],d.Matrix.TranslationToRef(q.x,q.y,q.z,N)}const U=this._engine;this.updateInAnimate||this._update(N);let W=0;return q||C||(U.setState(!1),this.forceDepthWrite&&U.setDepthWrite(!0),W=this.blendMode===Fq.BLENDMODE_MULTIPLYADD?this._render(Fq.BLENDMODE_MULTIPLY,N)+this._render(Fq.BLENDMODE_ADD,N):this._render(this.blendMode,N),this._engine.setAlphaMode(0)),W}rebuild(){const N=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(N,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,N()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const q in this._drawWrappers){this._drawWrappers[q].dispose()}if(this._drawWrappers={},this._scene){const N=this._scene.Bt.indexOf(this);N>-1&&this._scene.Bt.splice(N,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let q=0;q<this._renderVertexBuffers.length;++q){const N=this._renderVertexBuffers[q];for(const q in N)N[q].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),N&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),N&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.td.notifyObservers(this),this.td.clear()}clone(N,q){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const d={...this._customWrappers};let U=null;const W=this._engine;if(W.createEffectForParticles&&null!=this.customShader){U=this.customShader;const N=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"";d[0]=W.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,N,void 0,void 0,void 0,this)}const a=this.serialize(C),F=Kq.Parse(a,this._scene||this._engine,this._rootUrl);return F.name=N,F.customShader=U,F._customWrappers=d,void 0===q&&(q=this.dq),this.noiseTexture&&(F.noiseTexture=this.noiseTexture.clone()),F.dq=q,F}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};return Fq._Serialize(q,this,N),q.activeParticleCount=this.activeParticleCount,q.randomTextureSize=this._randomTextureSize,q.customShader=this.customShader,q}static Parse(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0;const W=N.name;let a,F;q instanceof uN.b?a=q:(F=q,a=F.getEngine());const w=new Kq(W,{oq:U||N.oq,randomTextureSize:N.randomTextureSize},q,null,N.isAnimationSheetEnabled);if(w._rootUrl=C,N.customShader&&a.createEffectForParticles){const q=N.customShader,C=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"",d=a.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,C,void 0,void 0,void 0,w);w.setCustomEffect(d,0),w.customShader=q}return N.id&&(w.id=N.id),N.activeParticleCount&&(w.activeParticleCount=N.activeParticleCount),Fq._Parse(N,w,q,C),N.preventAutoStart&&(w.preventAutoStart=N.preventAutoStart),d||w.preventAutoStart||w.start(),w}}var iq=C(10945),Iq=C(12494),jq=C(11503);class lq{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(N){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const q of this.systems)q.dq=N;this._emitterNode=N}setEmitterAsSphere(N,q,C){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:N,renderingGroupId:q};const d=(0,Iq.b)("emitterSphere",{diameter:N.diameter,segments:N.segments},C);d.renderingGroupId=q;const U=new jq.rq("emitterSphereMaterial",C);U.emissiveColor=N.color,d.material=U;for(const W of this.systems)W.dq=d;this._emitterNode=d}start(N){for(const q of this.systems)N&&(q.dq=N),q.start()}dispose(){for(const N of this.systems)N.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={systems:[]};for(const C of this.systems)q.systems.push(C.serialize(N));return this._emitterNode&&(q.dq=this._emitterCreationOptions),q}static Parse(N,q){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;const U=new lq,W=this.BaseAssetsUrl+"/textures/";q=q||g.e.LastCreatedScene;for(const a of N.systems)U.systems.push(C?Kq.Parse(a,q,W,!0,d):Fq.Parse(a,q,W,!0,d));if(N.dq){const C=N.dq.options;if("Sphere"===N.dq.kind)U.setEmitterAsSphere({diameter:C.diameter,segments:C.segments,color:a.Oq.Kq(C.color)},N.dq.renderingGroupId,q)}return U}}lq.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Tq=C(10992);class zq{static CreateDefault(N){let q,C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,d=arguments.length>2?arguments[2]:void 0;q=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Kq("default system",{oq:C},d):new Fq("default system",C,d),q.dq=N;const U=iq.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return q.particleTexture=new H.c(U,q.lN()),q.createConeEmitter(.1,Math.PI/4),q.color1=new a.md(1,1,1,1),q.color2=new a.md(1,1,1,1),q.colorDead=new a.md(1,1,1,0),q.minSize=.1,q.maxSize=.1,q.minEmitPower=2,q.maxEmitPower=2,q.updateSpeed=1/60,q.emitRate=30,q}static CreateAsync(N,q){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0;q||(q=g.e.LastCreatedScene);const U={};return q.addPendingData(U),new Promise(((W,a)=>{if(C&&!Kq.IsSupported)return q.removePendingData(U),a("Particle system with GPU is not supported.");iq.Tools.LoadFile(`${zq.BaseAssetsUrl}/systems/${N}.json`,(N=>{q.removePendingData(U);const a=JSON.parse(N.toString());return W(lq.Parse(a,q,C,d))}),void 0,void 0,void 0,(()=>(q.removePendingData(U),a(`An error occurred with the creation of your particle system. Check if your type '${N}' exists.`))))}))}static ExportSet(N){const q=new lq;for(const C of N)q.systems.push(C);return q}static ParseFromFileAsync(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",W=arguments.length>5?arguments[5]:void 0;return new Promise(((a,F)=>{const w=new Tq.e;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const q=JSON.parse(w.responseText);let F;F=d?Kq.Parse(q,C,U,!1,W):Fq.Parse(q,C,U,!1,W),N&&(F.name=N),a(F)}else F("Unable to load the particle system")})),w.open("GET",q),w.send()}))}static ParseFromSnippetAsync(N,q){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",U=arguments.length>4?arguments[4]:void 0;if("_BLANK"===N){const N=this.CreateDefault(null);return N.start(),Promise.resolve(N)}return new Promise(((W,a)=>{const F=new Tq.e;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const a=JSON.parse(JSON.parse(F.responseText).jsonPayload),w=JSON.parse(a.particleSystem);let A;A=C?Kq.Parse(w,q,d,!1,U):Fq.Parse(w,q,d,!1,U),A.snippetId=N,W(A)}else a("Unable to load the snippet "+N)})),F.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),F.send()}))}}zq.BaseAssetsUrl=lq.BaseAssetsUrl,zq.SnippetUrl="https://snippet.babylonjs.com",zq.CreateFromSnippetAsync=zq.ParseFromSnippetAsync;var pq=C(11571),sq=C(11395),Xq=C(12499);(0,Xq.e)(sq.e.NAME_PARTICLESYSTEM,((N,q,C,d)=>{const U=(0,Xq.i)(sq.e.NAME_PARTICLESYSTEM);if(U&&void 0!==N.Bt&&null!==N.Bt)for(let W=0,a=N.Bt.length;W<a;W++){const a=N.Bt[W];C.Bt.push(U(a,q,d))}})),(0,Xq.b)(sq.e.NAME_PARTICLESYSTEM,((N,q,C)=>{if(N.activeParticleCount){return Kq.Parse(N,q,C)}return Fq.Parse(N,q,C)})),uN.b.prototype.createEffectForParticles=function(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",W=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,w=arguments.length>7?arguments[7]:void 0,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,n=arguments.length>9?arguments[9]:void 0,t=[],V=[];const Z=[];return w?w.fillUniformsAttributesAndSamplerNames(V,t,Z):(t=Fq._GetAttributeNamesOrOptions(),V=Fq._GetEffectCreationOptions()),-1===U.indexOf(" BILLBOARD")&&(U+="\n#define BILLBOARD\n"),null!==w&&void 0!==w&&w.isAnimationSheetEnabled&&-1===U.indexOf(" ANIMATESHEET")&&(U+="\n#define ANIMATESHEET\n"),-1===d.indexOf("diffuseSampler")&&d.push("diffuseSampler"),this.createEffect({vertex:n??(null===w||void 0===w?void 0:w.vertexShaderName)??"particles",fragmentElement:N},t,V.concat(q),Z.concat(d),U,W,a,F,void 0,A,(async()=>{0===A?await Promise.resolve().then(C.bind(C,12532)):await Promise.resolve().then(C.bind(C,12598))}))},pq.b.prototype.getEmittedParticleSystems=function(){const N=[];for(let q=0;q<this.lN().Bt.length;q++){const C=this.lN().Bt[q];C.dq===this&&N.push(C)}return N},pq.b.prototype.getHierarchyEmittedParticleSystems=function(){const N=[],q=this.getDescendants();q.push(this);for(let C=0;C<this.lN().Bt.length;C++){const d=this.lN().Bt[C],U=d.dq;U.position&&-1!==q.indexOf(U)&&N.push(d)}return N};C(11465),C(11474),C(11557);C(11561),C(12507),C(11329),C(11455),C(11590);C(11321);var Pq;C(12512),C(11149);!function(N){N[N.Color=2]="Color",N[N.UV=1]="UV",N[N.Random=0]="Random",N[N.Stated=3]="Stated"}(Pq||(Pq={}));var Mq=C(11356);const Yq=new d.Jq(0,0,0),Eq=new d.Jq(0,0,0),Hq=new d.Jq(0,0,0);class eq{constructor(N,q,C){this.width=N,this.height=q,this.data=C}processFlowable(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;if(!C)return;C instanceof d.Matrix?d.Jq.TransformCoordinatesToRef(N.position,C,Hq):(Hq.x=C.x,Hq.y=C.y,Hq.z=C.z);const U=.5*Hq.x+.5,W=1-(.5*Hq.y+.5),a=Math.floor(U*this.width),F=Math.floor(W*this.height);if(a<0||a>=this.width||F<0||F>=this.height)return;const w=4*(F*this.width+a),A=this.data[w]/255*2-1,n=this.data[w+1]/255*2-1,t=this.data[w+2]/255*2-1,V=this.data[w+3]/255;Yq.set(A,n,t),Yq.scaleToRef(q*V,Eq),N.direction.addInPlace(Eq)}_processParticle(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;this.processFlowable(N,q,C)}static async FromUrlAsync(N){return await new Promise(((q,C)=>{const d=document.createElement("canvas"),U=d.getContext("2d");let W=null;const a=new Image;a.crossOrigin="anonymous",a.src=N,a.onerror=q=>{C(new Error(`Failed to load image: ${N} : ${q}`))},a.onload=()=>{d.width=a.width,d.height=a.height,U.drawImage(a,0,0),W=U.getImageData(0,0,d.width,d.height),q(new eq(d.width,d.height,W.data))}}))}static async ExtractFromTextureAsync(N){return await new Promise(((q,C)=>{if(!N.isReady())return void N.onLoadObservable.addOnce((async()=>{try{const C=await this.ExtractFromTextureAsync(N);q(C)}catch(d){C(d)}}));const d=N.getSize();Mq.m.GetTextureDataAsync(N,d.width,d.height).then((N=>{q(new eq(d.width,d.height,new Uint8ClampedArray(N)))})).catch(C)}))}}var bq,oq,Sq,Dq,cq,Lq,Gq,hq,Bq;!function(N){N[N.Int=1]="Int",N[N.Float=2]="Float",N[N.Vector2=4]="Vector2",N[N.Jq=8]="Jq",N[N.Matrix=16]="Matrix",N[N.Particle=32]="Particle",N[N.Texture=64]="Texture",N[N.md=128]="md",N[N.FloatGradient=256]="FloatGradient",N[N.Vector2Gradient=512]="Vector2Gradient",N[N.Vector3Gradient=1024]="Vector3Gradient",N[N.Color4Gradient=2048]="Color4Gradient",N[N.System=4096]="System",N[N.AutoDetect=8192]="AutoDetect",N[N.BasedOnInput=16384]="BasedOnInput",N[N.Undefined=32768]="Undefined",N[N.All=65535]="All"}(bq||(bq={})),function(N){N[N.Compatible=0]="Compatible",N[N.TypeIncompatible=1]="TypeIncompatible",N[N.HierarchyIssue=2]="HierarchyIssue"}(oq||(oq={})),function(N){N[N.Input=0]="Input",N[N.Output=1]="Output"}(Sq||(Sq={}));class yq{get direction(){return this._direction}get type(){if(this._type===bq.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===bq.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(N){this._type=N}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((N=>N.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(N,q,C){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=bq.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new f.b,this.onDisconnectionObservable=new f.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=q,this.name=N,this._direction=C}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(N){var q;return this.isConnected?null!==(q=this._connectedPoint)&&void 0!==q&&q._storedFunction?this._connectedPoint._storedFunction(N):this._connectedPoint._storedValue:this.value}canConnectTo(N){return 0===this.checkCompatibilityState(N)}checkCompatibilityState(N){const q=this._ownerBlock,C=N.ownerBlock;if(this.type!==N.type&&N.innerType!==bq.AutoDetect)return N.acceptedConnectionPointTypes&&-1!==N.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(N.excludedConnectionPointTypes&&-1!==N.excludedConnectionPointTypes.indexOf(this.type))return 1;let d=C,U=q;return 0===this.direction&&(d=q,U=C),d.isAnAncestorOf(U)?2:0}connectTo(N){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(N))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${N.ownerBlock.name}".${N.name}`;return this._endpoints.push(N),N._connectedPoint=this,this.onConnectionObservable.notifyObservers(N),N.onConnectionObservable.notifyObservers(this),this}disconnectFrom(N){const q=this._endpoints.indexOf(N);return-1===q||(this._endpoints.splice(q,1),N._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(N),N.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(N){let q=1;for(;q<bq.All;)N&q||this.excludedConnectionPointTypes.push(q),q<<=1}serialize(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const q={};return q.name=this.name,q.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.zd?(q.valueType="BABYLON."+this.value.getClassName(),q.value=this.value.zd()):(q.valueType="number",q.value=this.value)),N&&this.connectedPoint&&(q.inputName=this.name,q.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,q.targetConnectionName=this.connectedPoint.name,q.isExposedOnFrame=!0,q.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(q.isExposedOnFrame=!0,q.exposedPortPosition=this.exposedPortPosition),q}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Rq{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(N){this._name=N}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(N){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new f.b,this.td=new f.b,this.onInputChangedObservable=new f.b,this.visibleOnFrame=!1,this._name=N,this.uniqueId=e.b.UniqueId}_inputRename(N){return N}_outputRename(N){return N}isAnAncestorOf(N){for(const q of this._outputs)if(q.hasEndpoints)for(const C of q.endpoints){if(C.ownerBlock===N)return!0;if(C.ownerBlock.isAnAncestorOf(N))return!0}return!1}isAnAncestorOfType(N){if(this.getClassName()===N)return!0;for(const q of this._outputs)if(q.hasEndpoints)for(const C of q.endpoints)if(C.ownerBlock.isAnAncestorOfType(N))return!0;return!1}getInputByName(N){const q=this._inputs.filter((q=>q.name===N));return q.length?q[0]:null}_linkConnectionTypes(N,q){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[q]._acceptedConnectionPointType=this._inputs[N]:(this._inputs[N]._linkedConnectionSource=this._inputs[q],this._inputs[N]._isMainLinkSource=!0),this._inputs[q]._linkedConnectionSource=this._inputs[N]}registerInput(N,q){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0,W=arguments.length>5?arguments[5]:void 0;const a=new yq(N,this,0);return a.type=q,a.isOptional=C,a.defaultValue=d,a.value=d,a.valueMin=U,a.valueMax=W,this._inputs.push(a),this.onInputChangedObservable.notifyObservers(a),this}registerOutput(N,q,C){return(C=C??new yq(N,this,1)).type=q,this._outputs.push(C),this}_build(N){}_customBuildStep(N){}build(N){if(this._buildId===N.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((N=>N.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=N.buildId;for(const q of this._inputs){if(!q.connectedPoint){q.isOptional||N.notConnectedNonOptionalInputs.push(q);continue}const C=q.connectedPoint.ownerBlock;C&&C!==this&&!C.isSystem&&C.build(N)}return this._customBuildStep(N),N.verbose&&b.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(N),this.onBuildObservable.notifyObservers(this),!1}serialize(){const N={};N.customType="BABYLON."+this.getClassName(),N.id=this.uniqueId,N.name=this.name,N.visibleOnFrame=this.visibleOnFrame,N.inputs=[],N.outputs=[];for(const q of this.inputs)N.inputs.push(q.serialize());for(const q of this.outputs)N.outputs.push(q.serialize(!1));return N}_deserialize(N){this._name=N.name,this.comments=N.comments,this.visibleOnFrame=!!N.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(N)}_deserializePortDisplayNamesAndExposedOnFrame(N){const q=N.inputs,C=N.outputs;if(q)for(const d of q){const N=this.inputs.find((N=>N.name===d.name));if(!N)return;if(d.displayName&&(N.displayName=d.displayName),d.isExposedOnFrame&&(N.isExposedOnFrame=d.isExposedOnFrame,N.exposedPortPosition=d.exposedPortPosition),void 0!==d.value&&null!==d.value)if("number"===d.valueType)N.value=d.value;else{const q=(0,F.e)(d.valueType);q&&(N.value=q.Kq(d.value))}}if(C)for(let d=0;d<C.length;d++){const N=C[d];N.displayName&&(this.outputs[d].displayName=N.displayName),N.isExposedOnFrame&&(this.outputs[d].isExposedOnFrame=N.isExposedOnFrame,this.outputs[d].exposedPortPosition=N.exposedPortPosition)}}clone(){const N=this.serialize(),q=(0,F.e)(N.customType);if(q){const C=new q;return C._deserialize(N),C}return null}dispose(){this.td.notifyObservers(this),this.td.clear();for(const N of this.inputs)N.dispose();for(const N of this.outputs)N.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function uq(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",d=arguments.length>3?arguments[3]:void 0;return(U,W)=>{let a=U._propStore;a||(a=[],U._propStore=a),a.push({propertyName:W,displayName:N,type:q,groupName:C,options:d??{},className:U.getClassName()})}}(0,M.d)([(0,Y.O)("comment")],Rq.prototype,"comments",void 0),function(N){N[N.Boolean=0]="Boolean",N[N.Float=1]="Float",N[N.Int=2]="Int",N[N.Vector2=3]="Vector2",N[N.List=4]="List",N[N.md=5]="md",N[N.SamplingMode=6]="SamplingMode",N[N.TextureFormat=7]="TextureFormat",N[N.TextureType=8]="TextureType"}(Dq||(Dq={})),function(N){N[N.None=0]="None",N[N.Position=1]="Position",N[N.Direction=2]="Direction",N[N.Age=3]="Age",N[N.Lifetime=4]="Lifetime",N[N.Color=5]="Color",N[N.ScaledDirection=6]="ScaledDirection",N[N.Scale=7]="Scale",N[N.AgeGradient=8]="AgeGradient",N[N.Angle=9]="Angle",N[N.SpriteCellIndex=16]="SpriteCellIndex",N[N.SpriteCellStart=17]="SpriteCellStart",N[N.SpriteCellEnd=18]="SpriteCellEnd"}(cq||(cq={})),function(N){N[N.None=0]="None",N[N.Time=1]="Time",N[N.Delta=2]="Delta",N[N.Emitter=3]="Emitter"}(Lq||(Lq={}));class mq{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let N="";for(const q of this.notConnectedNonOptionalInputs)N+=`input ${q.name} from block ${q.ownerBlock.name}[${q.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(N)throw"Build of Node Particle System Set failed:\n"+N}adapt(N,q){const C=N.getConnectedValue(this)||0;if(N.type===q)return C;switch(q){case bq.Vector2:return new d.Vector2(C,C);case bq.Jq:return new d.Jq(C,C,C);case bq.md:return new a.md(C,C,C,C)}return null}getContextualValue(N){if(!this.particleContext||!this.systemContext)return null;switch(N){case cq.Position:return this.particleContext.position;case cq.Direction:return this.particleContext.direction;case cq.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case cq.Color:return this.particleContext.color;case cq.Age:return this.particleContext.age;case cq.Lifetime:return this.particleContext.lifeTime;case cq.Angle:return this.particleContext.angle;case cq.Scale:return this.particleContext.scale;case cq.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case cq.SpriteCellEnd:return this.systemContext.endSpriteCellID;case cq.SpriteCellIndex:return this.particleContext.cellIndex;case cq.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.dq.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.dq.absolutePosition:this.systemContext.dq:null}getSystemValue(N){if(!this.particleContext||!this.systemContext)return null;switch(N){case Lq.Time:return this.systemContext._actualFrame;case Lq.Delta:return this.systemContext._scaledUpdateSpeed;case Lq.Emitter:if(this.isEmitterTransformNode){return this.systemContext.dq.absolutePosition}return this.systemContext.dq}return null}}function fq(N,q,C){const d=new mq;d.vq=q;const U=N.createSystem(d);return U.canStart=()=>!0,U.dq=C.clone(),U.disposeOnStop=!0,U.start(),U}class kq extends Rq{constructor(N){super(N),this.blendMode=w.BLENDMODE_ONEONE,this.oq=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",bq.Particle),this.registerInput("texture",bq.Texture),this.registerInput("onStart",bq.System,!0),this.registerInput("onEnd",bq.System,!0),this.registerOutput("system",bq.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(N){N.oq=this.oq,N.buildId=this._buildId++,this.build(N);const q=this.particle.getConnectedValue(N);return q.particleTexture=this.texture.getConnectedValue(N),q.emitRate=this.emitRate,q.blendMode=this.blendMode,q.name=this.name,q._nodeGenerated=!0,q._targetStopDuration=this.targetStopDuration,q.startDelay=this.startDelay,this.system._storedValue=this,q.canStart=()=>!this.doNoStart,q.onStartedObservable.add((C=>{const d=this.onStart.getConnectedValue(N);d&&C.onStartedObservable.addOnce((()=>{N.systemContext=q;const C=fq(d,N.vq,N.emitterPosition);this.td.addOnce((()=>{C.dispose()}))}));const U=this.onEnd.getConnectedValue(N);U&&C.onStoppedObservable.addOnce((()=>{N.systemContext=q;const C=fq(U,N.vq,N.emitterPosition);this.td.addOnce((()=>{C.dispose()}))}))})),this.td.addOnce((()=>{q.dispose()})),q}serialize(){const N=super.serialize();return N.oq=this.oq,N.emitRate=this.emitRate,N.blendMode=this.blendMode,N.doNoStart=this.doNoStart,N.targetStopDuration=this.targetStopDuration,N.startDelay=this.startDelay,N}_deserialize(N){super._deserialize(N),this.oq=N.oq,this.emitRate=N.emitRate,this.doNoStart=!!N.doNoStart,void 0!==N.blendMode&&(this.blendMode=N.blendMode),void 0!==N.targetStopDuration&&(this.targetStopDuration=N.targetStopDuration),void 0!==N.startDelay&&(this.startDelay=N.startDelay)}}(0,M.d)([uq("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:w.BLENDMODE_ONEONE},{label:"Standard",value:w.BLENDMODE_STANDARD},{label:"Add",value:w.BLENDMODE_ADD},{label:"Multiply",value:w.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:w.BLENDMODE_MULTIPLYADD}]})],kq.prototype,"blendMode",void 0),(0,M.d)([uq("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],kq.prototype,"oq",void 0),(0,M.d)([uq("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kq.prototype,"emitRate",void 0),(0,M.d)([uq("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kq.prototype,"targetStopDuration",void 0),(0,M.d)([uq("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kq.prototype,"startDelay",void 0),(0,M.d)([uq("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],kq.prototype,"doNoStart",void 0),(0,F.h)("BABYLON.SystemBlock",kq);class gq extends Rq{get type(){if(this._type===bq.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=bq.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=bq.Vector2,this._type;case"Jq":return this._type=bq.Jq,this._type;case"md":return this._type=bq.md,this._type;case"Matrix":return this._type=bq.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===cq.None&&this._systemSource!==Lq.None}get systemSource(){return this._systemSource}set systemSource(N){if(this._systemSource=N,N!==Lq.None){switch(this._contextualSource=cq.None,this._type=bq.Float,N){case Lq.Time:case Lq.Delta:this._type=bq.Float;break;case Lq.Emitter:this._type=bq.Jq}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==cq.None}get contextualValue(){return this._contextualSource}set contextualValue(N){if(this._contextualSource=N,N!==cq.None){switch(this._systemSource=Lq.None,N){case cq.Scale:this._type=bq.Vector2;break;case cq.Position:case cq.Direction:case cq.ScaledDirection:this._type=bq.Jq;break;case cq.Color:this._type=bq.md;break;case cq.Age:case cq.Lifetime:case cq.Angle:case cq.AgeGradient:this._type=bq.Float;break;case cq.SpriteCellEnd:case cq.SpriteCellStart:case cq.SpriteCellIndex:this._type=bq.Int}this.output&&(this.output.type=this._type)}}constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bq.AutoDetect;super(N),this._type=bq.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new f.b,this._systemSource=Lq.None,this._contextualSource=cq.None,this._type=q,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",q)}get value(){return this._storedValue}set value(N){this.type===bq.Float&&this.min!==this.max&&(N=Math.max(this.min,N),N=Math.min(this.max,N)),this._storedValue=N,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(N){this._valueCallback=N}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case bq.Int:case bq.Float:this.value=0;break;case bq.Vector2:this.value=d.Vector2.Zero();break;case bq.Jq:this.value=d.Jq.Zero();break;case bq.md:this.value=new a.md(1,1,1,1);break;case bq.Matrix:this.value=d.Matrix.Identity()}}_build(N){super._build(N),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=N=>N.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=N=>N.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const N=super.serialize();return N.type=this.type,N.contextualValue=this.contextualValue,N.systemSource=this.systemSource,N.min=this.min,N.max=this.max,N.groupInInspector=this.groupInInspector,N.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.zd?(N.valueType="BABYLON."+this._storedValue.getClassName(),N.value=this._storedValue.zd()):(N.valueType="number",N.value=this._storedValue)),N}_deserialize(N){if(super._deserialize(N),this._type=N.type,this.contextualValue=N.contextualValue,this.systemSource=N.systemSource||Lq.None,this.min=N.min||0,this.max=N.max||0,this.groupInInspector=N.groupInInspector||"",void 0!==N.displayInInspector&&(this.displayInInspector=N.displayInInspector),N.valueType)if("number"===N.valueType)this._storedValue=N.value;else{const q=(0,F.e)(N.valueType);q&&(this._storedValue=q.Kq(N.value))}}}(0,F.h)("BABYLON.ParticleInputBlock",gq);class xq extends Rq{get url(){return this._url}set url(N){this._url!==N&&(this._cachedData=null,this._url=N,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(N){this._textureDataUrl!==N&&(this._cachedData=null,this._textureDataUrl=N,this._url="",this._sourceTexture=null)}set sourceTexture(N){this._sourceTexture!==N&&(this._cachedData=null,this._sourceTexture=N,this._url="",this._textureDataUrl="")}constructor(N){super(N),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",bq.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const N=this.texture._storedValue;return await new Promise(((q,C)=>{if(!N.isReady())return void N.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),q(this._cachedData)}catch(N){C(N)}}));const d=N.getSize();Mq.m.GetTextureDataAsync(N,d.width,d.height).then((C=>{this._cachedData={width:d.width,height:d.height,data:new Uint8ClampedArray(C)},N.dispose(),q(this._cachedData)})).catch(C)}))}_build(N){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new H.c(this._textureDataUrl,N.vq):this.texture._storedValue=new H.c(this._url,N.vq):this.texture._storedValue=null}serialize(){const N=super.serialize();return N.url=this.url,N.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(N.textureDataUrl=this.textureDataUrl),N}_deserialize(N){super._deserialize(N),this.url=N.url,this.serializedCachedData=!!N.serializedCachedData,N.textureDataUrl&&(this.textureDataUrl=N.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,F.h)("BABYLON.ParticleTextureSourceBlock",xq);class NC extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerInput("position",bq.Jq),this.registerOutput("output",bq.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(N){const q=this.particle.getConnectedValue(N);if(this.output._storedValue=q,!this.position.isConnected)return;const C={process:C=>{N.particleContext=C,N.systemContext=q,C.position.U(this.position.getConnectedValue(N))},previousItem:null,nextItem:null};q._updateQueueStart?LN(C,q._updateQueueStart):q._updateQueueStart=C}}(0,F.h)("BABYLON.UpdatePositionBlock",NC),function(N){N[N.Add=0]="Add",N[N.Subtract=1]="Subtract",N[N.Multiply=2]="Multiply",N[N.Divide=3]="Divide",N[N.Max=4]="Max",N[N.Min=5]="Min"}(Gq||(Gq={}));class qC extends Rq{constructor(N){super(N),this.operation=Gq.Add,this.registerInput("left",bq.AutoDetect),this.registerInput("right",bq.AutoDetect),this.registerOutput("output",bq.BasedOnInput),this.output._typeConnectionSource=this.left;const q=[bq.Matrix,bq.Particle,bq.Texture,bq.System,bq.FloatGradient,bq.Color4Gradient,bq.Vector2Gradient,bq.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...q),this.right.excludedConnectionPointTypes.push(...q),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(N){let q;const C=this.left,U=this.right;if(!C.isConnected||!U.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const W=C.type===bq.Float||C.type===bq.Int,F=U.type===bq.Float||U.type===bq.Int,w=W&&F;switch(this.operation){case Gq.Add:q=w?N=>C.getConnectedValue(N)+U.getConnectedValue(N):W?N=>N.adapt(C,U.type).add(U.getConnectedValue(N)):N=>C.getConnectedValue(N).add(N.adapt(U,C.type));break;case Gq.Subtract:q=w?N=>C.getConnectedValue(N)-U.getConnectedValue(N):W?N=>N.adapt(C,U.type).Qq(U.getConnectedValue(N)):N=>C.getConnectedValue(N).Qq(N.adapt(U,C.type));break;case Gq.Multiply:q=w?N=>C.getConnectedValue(N)*U.getConnectedValue(N):W?N=>N.adapt(C,U.type).multiply(U.getConnectedValue(N)):N=>C.getConnectedValue(N).multiply(N.adapt(U,C.type));break;case Gq.Divide:q=w?N=>C.getConnectedValue(N)/U.getConnectedValue(N):W?N=>N.adapt(C,U.type).divide(U.getConnectedValue(N)):N=>C.getConnectedValue(N).divide(N.adapt(U,C.type));break;case Gq.Min:if(w)q=N=>Math.min(C.getConnectedValue(N),U.getConnectedValue(N));else{const[N,F]=W?[U,C]:[C,U];switch(N.type){case bq.Vector2:q=q=>d.Vector2.Minimize(N.getConnectedValue(q),q.adapt(F,N.type));break;case bq.Jq:q=q=>d.Jq.Minimize(N.getConnectedValue(q),q.adapt(F,N.type));break;case bq.md:q=q=>{const C=N.getConnectedValue(q),{r:d,g:U,b:W,a:w}=q.adapt(F,N.type);return new a.md(Math.min(C.r,d),Math.min(C.g,U),Math.min(C.b,W),Math.min(C.a,w))}}}break;case Gq.Max:if(!w){const[N,F]=W?[U,C]:[C,U];switch(N.type){case bq.Vector2:q=q=>d.Vector2.Maximize(N.getConnectedValue(q),q.adapt(F,N.type));break;case bq.Jq:q=q=>d.Jq.Maximize(N.getConnectedValue(q),q.adapt(F,N.type));break;case bq.md:q=q=>{const C=N.getConnectedValue(q),{r:d,g:U,b:W,a:w}=q.adapt(F,N.type);return new a.md(Math.max(C.r,d),Math.min(C.g,U),Math.min(C.b,W),Math.min(C.a,w))}}break}q=N=>Math.max(C.getConnectedValue(N),U.getConnectedValue(N))}this.output._storedFunction=N=>C.type===bq.Int?0|q(N):q(N)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===bq.Int||this.left.type===bq.Float&&this.right.type!==bq.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[N,q]of[[this.left,this.right],[this.right,this.left]])N.acceptedConnectionPointTypes=[bq.Int,bq.Float],q.isConnected&&(N.acceptedConnectionPointTypes.push(q.type),q.type!==bq.Int&&q.type!==bq.Float||N.acceptedConnectionPointTypes.push(bq.Vector2,bq.Jq,bq.md))}dispose(){super.dispose();for(const N of this._connectionObservers)N.remove();this._connectionObservers.length=0}serialize(){const N=super.serialize();return N.operation=this.operation,N}_deserialize(N){super._deserialize(N),this.operation=N.operation}}(0,M.d)([uq("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Gq.Add},{label:"Subtract",value:Gq.Subtract},{label:"Multiply",value:Gq.Multiply},{label:"Divide",value:Gq.Divide},{label:"Max",value:Gq.Max},{label:"Min",value:Gq.Min}]})],qC.prototype,"operation",void 0),(0,F.h)("BABYLON.ParticleMathBlock",qC);class CC extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerInput("direction1",bq.Jq,!0,new d.Jq(0,1,0)),this.registerInput("direction2",bq.Jq,!0,new d.Jq(0,1,0)),this.registerInput("minEmitBox",bq.Jq,!0,new d.Jq(-.5,-.5,-.5)),this.registerInput("maxEmitBox",bq.Jq,!0,new d.Jq(.5,.5,.5)),this.registerOutput("output",bq.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(N){const q=this.particle.getConnectedValue(N);q._directionCreation.process=C=>{N.particleContext=C,N.systemContext=q;const U=this.direction1.getConnectedValue(N),W=this.direction2.getConnectedValue(N),a=(0,A.RandomRange)(U.x,W.x),F=(0,A.RandomRange)(U.y,W.y),w=(0,A.RandomRange)(U.z,W.z);N.isEmitterTransformNode?d.Jq.TransformNormalFromFloatsToRef(a,F,w,N.emitterWorldMatrix,C.direction):C.direction.hd(a,F,w)},q._positionCreation.process=C=>{N.particleContext=C,N.systemContext=q;const U=this.minEmitBox.getConnectedValue(N),W=this.maxEmitBox.getConnectedValue(N),a=(0,A.RandomRange)(U.x,W.x),F=(0,A.RandomRange)(U.y,W.y),w=(0,A.RandomRange)(U.z,W.z);N.isEmitterTransformNode?d.Jq.TransformCoordinatesFromFloatsToRef(a,F,w,N.emitterWorldMatrix,C.position):(C.position.hd(a,F,w),C.position.addInPlace(N.emitterPosition))},this.output._storedValue=q}}(0,F.h)("BABYLON.BoxShapeBlock",CC);class dC extends Rq{constructor(N){super(N),this.registerInput("emitPower",bq.Float,!0,1),this.registerInput("lifeTime",bq.Float,!0,1),this.registerInput("color",bq.md,!0,new a.md(1,1,1,1)),this.registerInput("scale",bq.Vector2,!0,new d.Vector2(1,1)),this.registerInput("angle",bq.Float,!0,0),this.registerOutput("particle",bq.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(N){const q=new Fq(this.name,N.oq,N.vq,null,!1,void 0,!0);q.particleEmitterType=new r,q._lifeTimeCreation.process=(q,C)=>{N.particleContext=q,q.lifeTime=this.lifeTime.getConnectedValue(N),C._emitPower=this.emitPower.getConnectedValue(N)},q._colorCreation.process=q=>{N.particleContext=q,q.color.U(this.color.getConnectedValue(N))},q._sizeCreation.process=q=>{N.particleContext=q,q.size=1,q.scale.U(this.scale.getConnectedValue(N))},q._angleCreation.process=q=>{N.particleContext=q,q.angle=this.angle.getConnectedValue(N)},this.particle._storedValue=q}}(0,F.h)("BABYLON.CreateParticleBlock",dC);class UC{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const N=[];for(const q of this.attachedBlocks)q.isInput&&N.push(q);return N}constructor(N){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new f.b,this.name=N}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(N)&&this.attachedBlocks.push(N);for(const C of N.inputs){const d=C.connectedPoint;if(d){const C=d.ownerBlock;C!==N&&this._initializeBlock(C,q)}}}async buildAsync(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((C=>{const d=new lq;for(const N of this._systemBlocks)this._initializeBlock(N);for(const U of this.systemBlocks){const C=new mq;C.buildId=this._buildId++,C.vq=N,C.verbose=q;const W=U.createSystem(C);C.emitErrors(),d.systems.push(W)}this.onBuildObservable.notifyObservers(this),C(d)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const N=new kq("Particle system"),q=new NC("Update position");q.output.connectTo(N.particle);const C=new gq("Position");C.contextualValue=cq.Position;const d=new gq("Scaled direction");d.contextualValue=cq.ScaledDirection;const U=new qC("Add");U.operation=Gq.Add,C.output.connectTo(U.left),d.output.connectTo(U.right),U.output.connectTo(q.position);const W=new dC("Create particle"),a=new CC("Box shape");W.particle.connectTo(a.particle),a.output.connectTo(q.particle);const F=new xq("Texture");F.texture.connectTo(N.texture),F.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(N)}removeBlock(N){const q=this.attachedBlocks.indexOf(N);if(q>-1&&this.attachedBlocks.splice(q,1),N.isSystem){const q=this._systemBlocks.indexOf(N);q>-1&&this._systemBlocks.splice(q,1)}}parseSerializedObject(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q||this.clear();const C={};for(const d of N.an){const N=(0,F.e)(d.customType);if(N){const q=new N;q._deserialize(d),C[d.id]=q,this.attachedBlocks.push(q),q.isSystem&&this._systemBlocks.push(q)}}for(const d of this.attachedBlocks)if(d.isTeleportOut){const N=d,q=N._tempEntryPointUniqueId;if(q){const d=C[q];d&&d.attachToEndpoint(N)}}for(let d=0;d<N.an.length;d++){const U=N.an[d],W=C[U.id];W&&(W.inputs.length&&U.inputs.some((N=>N.targetConnectionName))&&!q||this._restoreConnections(W,N,C))}if(N.locations||N.editorData&&N.editorData.locations){const d=N.locations||N.editorData.locations;for(const N of d)C[N.vU]&&(N.vU=C[N.vU].uniqueId);q&&this.editorData&&this.editorData.locations&&d.concat(this.editorData.locations),N.locations?this.editorData={locations:d}:(this.editorData=N.editorData,this.editorData.locations=d);const U=[];for(const N in C)U[N]=C[N].uniqueId;this.editorData.map=U}this.comment=N.comment}_restoreConnections(N,q,C){for(const d of N.outputs)for(const U of q.an){const W=C[U.id];if(W)for(const a of U.inputs)if(C[a.targetBlockId]!==N||a.targetConnectionName!==d.name);else{const N=W.getInputByName(a.inputName);if(!N||N.isConnected)continue;d.connectTo(N,!0),this._restoreConnections(W,q,C)}}}serialize(N){const q=N?{}:E.d.Serialize(this);q.editorData=JSON.parse(JSON.stringify(this.editorData));let C=[];N?C=N:q.customType="BABYLON.NodeParticleSystemSet",q.an=[];for(const d of C)q.an.push(d.serialize());if(!N)for(const d of this.attachedBlocks)-1===C.indexOf(d)&&q.an.push(d.serialize());return q}dispose(){for(const N of this.attachedBlocks)N.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(N){const q=new UC(N);return q.setToDefault(),q}static Parse(N){const q=E.d.Parse((()=>new UC(N.name)),N,null);return q.parseSerializedObject(N),q}static ParseFromSnippetAsync(N,q){return"_BLANK"===N?Promise.resolve(UC.CreateDefault("blank")):new Promise(((C,d)=>{const U=new Tq.e;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const a=JSON.parse(JSON.parse(U.responseText).jsonPayload),F=JSON.parse(a.nodeParticle);q||(q=E.d.Parse((()=>new UC(N)),F,null)),q.parseSerializedObject(F),q.snippetId=N;try{C(q)}catch(W){d(W)}}else d("Unable to load the snippet "+N)})),U.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),U.send()}))}}UC.EditorURL=`${iq.Tools._DefaultCdnUrl}/v${uN.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,UC.SnippetUrl="https://snippet.babylonjs.com",(0,M.d)([(0,Y.O)()],UC.prototype,"name",void 0),(0,M.d)([(0,Y.O)("comment")],UC.prototype,"comment",void 0),function(N){N[N.None=0]="None",N[N.PerParticle=1]="PerParticle",N[N.PerSystem=2]="PerSystem"}(hq||(hq={}));class WC extends Rq{constructor(N){super(N),this._currentLockId=-2,this.lockMode=hq.PerParticle,this.registerInput("min",bq.AutoDetect,!0,0),this.registerInput("max",bq.AutoDetect,!0,1),this.registerOutput("output",bq.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bq.Float|bq.Int|bq.Vector2|bq.Jq|bq.md),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(bq.Float|bq.Int|bq.Vector2|bq.Jq|bq.md),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=bq.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let N=null;switch(this._currentLockId=-2,this.min.type){case bq.AutoDetect:case bq.Int:case bq.Float:N=N=>{const q=this.min.getConnectedValue(N)||0,C=this.max.getConnectedValue(N)||1;return q+Math.random()*(C-q)};break;case bq.Vector2:N=N=>{const q=this.min.getConnectedValue(N)||d.Vector2.Zero(),C=this.max.getConnectedValue(N)||d.Vector2.One();return new d.Vector2(q.x+Math.random()*(C.x-q.x),q.y+Math.random()*(C.y-q.y))};break;case bq.Jq:N=N=>{const q=this.min.getConnectedValue(N)||d.Jq.Zero(),C=this.max.getConnectedValue(N)||d.Jq.One();return new d.Jq(q.x+Math.random()*(C.x-q.x),q.y+Math.random()*(C.y-q.y),q.z+Math.random()*(C.z-q.z))};break;case bq.md:N=N=>{const q=this.min.getConnectedValue(N)||new a.md(0,0,0,0),C=this.max.getConnectedValue(N)||new a.md(1,1,1,1);return new a.md(q.x+Math.random()*(C.x-q.x),q.y+Math.random()*(C.y-q.y),q.z+Math.random()*(C.z-q.z),q.w+Math.random()*(C.w-q.w))}}this.output._storedFunction=q=>{var C;let d=0;switch(this.lockMode){case hq.PerParticle:d=(null===(C=q.particleContext)||void 0===C?void 0:C.id)||-1;break;case hq.PerSystem:d=q.buildId||0}return this._currentLockId!==d&&(this.lockMode!==hq.None&&(this._currentLockId=d),this.output._storedValue=N(q)),this.output._storedValue}}serialize(){const N=super.serialize();return N.lockMode=this.lockMode,N}_deserialize(N){super._deserialize(N),this.lockMode=N.lockMode}}(0,M.d)([uq("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:hq.None},{label:"Per particle",value:hq.PerParticle},{label:"Per system",value:hq.PerSystem}]})],WC.prototype,"lockMode",void 0),(0,F.h)("BABYLON.ParticleRandomBlock",WC);class aC extends Rq{constructor(N){super(N),this._currentLockId=-2,this.lockMode=hq.PerParticle,this.registerInput("min",bq.AutoDetect),this.registerInput("max",bq.AutoDetect),this.registerOutput("output",bq.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const q=[bq.Matrix,bq.Particle,bq.Texture,bq.System,bq.FloatGradient,bq.Color4Gradient,bq.Vector2Gradient,bq.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...q),this.max.excludedConnectionPointTypes.push(...q)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let N=null;switch(this._currentLockId=-2,this.min.type){case bq.Float:case bq.Int:N=N=>{const q=this.min.getConnectedValue(N),C=this.max.getConnectedValue(N);return Math.random()*(C-q)+q};break;case bq.Vector2:N=N=>{const q=this.min.getConnectedValue(N),C=this.max.getConnectedValue(N);return new d.Vector2(Math.random()*(C.x-q.x)+q.x,Math.random()*(C.y-q.y)+q.y)};break;case bq.Jq:N=N=>{const q=this.min.getConnectedValue(N),C=this.max.getConnectedValue(N);return new d.Jq(Math.random()*(C.x-q.x)+q.x,Math.random()*(C.y-q.y)+q.y,Math.random()*(C.z-q.z)+q.z)};break;case bq.md:N=N=>{const q=this.min.getConnectedValue(N),C=this.max.getConnectedValue(N);return new a.md(Math.random()*(C.r-q.r)+q.r,Math.random()*(C.g-q.g)+q.g,Math.random()*(C.b-q.b)+q.b,Math.random()*(C.a-q.a)+q.a)}}this.output._storedFunction=q=>{var C;let d=0;switch(this.lockMode){case hq.PerParticle:d=(null===(C=q.particleContext)||void 0===C?void 0:C.id)||-1;break;case hq.PerSystem:d=q.buildId||0}return this._currentLockId!==d&&(this.lockMode!==hq.None&&(this._currentLockId=d),this.output._storedValue=N(q)),this.output._storedValue}}serialize(){const N=super.serialize();return N.lockMode=this.lockMode,N}_deserialize(N){super._deserialize(N),void 0!==N.lockMode&&(this.lockMode=N.lockMode)}}(0,M.d)([uq("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:hq.None},{label:"Per particle",value:hq.PerParticle},{label:"Per system",value:hq.PerSystem}]})],aC.prototype,"lockMode",void 0),(0,F.h)("BABYLON.RandomRangeBlock",aC);(0,F.h)("BABYLON.ParticleLerpBlock",class extends Rq{constructor(N){super(N),this.registerInput("left",bq.AutoDetect),this.registerInput("right",bq.AutoDetect),this.registerInput("gradient",bq.Float,!0,0,0,1),this.registerOutput("output",bq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bq.Float|bq.Int|bq.Vector2|bq.Jq|bq.md)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const N=(N,q,C)=>(1-N)*q+N*C;this.output._storedFunction=q=>{const C=this.left.getConnectedValue(q),U=this.right.getConnectedValue(q),W=this.gradient.getConnectedValue(q);switch(this.left.type){case bq.Int:case bq.Float:return N(W,C,U);case bq.Vector2:return new d.Vector2(N(W,C.x,U.x),N(W,C.y,U.y));case bq.Jq:return new d.Jq(N(W,C.x,U.x),N(W,C.y,U.y),N(W,C.z,U.z));case bq.md:return new a.md(N(W,C.r,U.r),N(W,C.g,U.g),N(W,C.b,U.b),N(W,C.a,U.a))}return 0}}});(0,F.h)("BABYLON.UpdateDirectionBlock",class extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerInput("direction",bq.Jq),this.registerOutput("output",bq.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(N){const q=this.particle.getConnectedValue(N);if(this.output._storedValue=q,!this.direction.isConnected)return;const C={process:C=>{N.particleContext=C,N.systemContext=q,C.direction.U(this.direction.getConnectedValue(N))},previousItem:null,nextItem:null};q._updateQueueStart?LN(C,q._updateQueueStart):q._updateQueueStart=C}});(0,F.h)("BABYLON.UpdateColorBlock",class extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerInput("color",bq.md),this.registerOutput("output",bq.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(N){const q=this.particle.getConnectedValue(N);if(this.output._storedValue=q,!this.color.isConnected)return;const C={process:C=>{N.particleContext=C,N.systemContext=q,C.color.U(this.color.getConnectedValue(N))},previousItem:null,nextItem:null};q._updateQueueStart?LN(C,q._updateQueueStart):q._updateQueueStart=C}});(0,F.h)("BABYLON.UpdateScaleBlock",class extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerInput("scale",bq.Vector2),this.registerOutput("output",bq.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(N){const q=this.particle.getConnectedValue(N);if(this.output._storedValue=q,!this.scale.isConnected)return;const C={process:C=>{N.particleContext=C,N.systemContext=q,C.scale.U(this.scale.getConnectedValue(N))},previousItem:null,nextItem:null};q._updateQueueStart?LN(C,q._updateQueueStart):q._updateQueueStart=C}});(0,F.h)("BABYLON.UpdateAngleBlock",class extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerInput("angle",bq.Float),this.registerOutput("output",bq.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(N){const q=this.particle.getConnectedValue(N);if(this.output._storedValue=q,!this.angle.isConnected)return;const C={process:C=>{N.particleContext=C,N.systemContext=q,C.angle=this.angle.getConnectedValue(N)},previousItem:null,nextItem:null};q._updateQueueStart?LN(C,q._updateQueueStart):q._updateQueueStart=C}});(0,F.h)("BABYLON.BasicPositionUpdateBlock",class extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerOutput("output",bq.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(N){const q=this.particle.getConnectedValue(N),C={process:C=>{N.particleContext=C,N.systemContext=q,C.direction.scaleToRef(q._directionScale,q._scaledDirection),C.position.addInPlace(q._scaledDirection)},previousItem:null,nextItem:null};q._updateQueueStart?LN(C,q._updateQueueStart):q._updateQueueStart=C,this.output._storedValue=q}});(0,F.h)("BABYLON.BasicSpriteUpdateBlock",class extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerOutput("output",bq.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(N){const q=this.particle.getConnectedValue(N),C={process:C=>{N.particleContext=C,N.systemContext=q,C.updateCellIndex()},previousItem:null,nextItem:null};q._updateQueueStart?LN(C,q._updateQueueStart):q._updateQueueStart=C,this.output._storedValue=q}});(0,F.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerInput("cellIndex",bq.Int),this.registerOutput("output",bq.Particle),this.cellIndex.acceptedConnectionPointTypes=[bq.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(N){const q=this.particle.getConnectedValue(N);if(this.output._storedValue=q,!this.cellIndex.isConnected)return;const C={process:C=>{N.particleContext=C,N.systemContext=q,C.cellIndex=Math.floor(this.cellIndex.getConnectedValue(N))},previousItem:null,nextItem:null};q._updateQueueStart?LN(C,q._updateQueueStart):q._updateQueueStart=C}});class FC extends Rq{constructor(N){super(N),this.strength=1,this.registerInput("particle",bq.Particle),this.registerInput("flowMap",bq.Texture),this.registerOutput("output",bq.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(N){var q;const C=this.particle.getConnectedValue(N),d=N.vq;let U;(null===(q=this.flowMap.connectedPoint)||void 0===q?void 0:q.ownerBlock).extractTextureContentAsync().then((N=>{N&&(U=new eq(N.width,N.height,N.data))}));const W={process:N=>{const q=d.getTransformMatrix();U&&U._processParticle(N,this.strength*C._tempScaledUpdateSpeed,q)},previousItem:null,nextItem:null};C._updateQueueStart?LN(W,C._updateQueueStart):C._updateQueueStart=W,this.output._storedValue=C}serialize(){const N=super.serialize();return N.strength=this.strength,N}_deserialize(N){super._deserialize(N),this.strength=N.strength}}(0,M.d)([uq("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FC.prototype,"strength",void 0),(0,F.h)("BABYLON.UpdateFlowMapBlock",FC);(0,F.h)("BABYLON.SphereShapeBlock",class extends Rq{constructor(N){super(N),this.registerInput("input",bq.Particle),this.registerInput("radius",bq.Float,!0,1),this.registerInput("radiusRange",bq.Float,!0,1,0,1),this.registerInput("directionRandomizer",bq.Float,!0,0,0,1),this.registerOutput("output",bq.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(N){const q=this.input.getConnectedValue(N);q._directionCreation.process=C=>{N.particleContext=C,N.systemContext=q;const U=this.directionRandomizer.getConnectedValue(N),W=C.position.Qq(N.emitterPosition).normalize(),a=(0,A.RandomRange)(0,U),F=(0,A.RandomRange)(0,U),w=(0,A.RandomRange)(0,U);W.x+=a,W.y+=F,W.z+=w,W.normalize(),N.isEmitterTransformNode?d.Jq.TransformNormalFromFloatsToRef(a,F,w,N.emitterWorldMatrix,C.direction):C.direction.hd(a,F,w)},q._positionCreation.process=C=>{N.particleContext=C,N.systemContext=q;const U=this.radius.getConnectedValue(N),W=this.radiusRange.getConnectedValue(N),a=U-(0,A.RandomRange)(0,U*W),F=(0,A.RandomRange)(0,1),w=(0,A.RandomRange)(0,2*Math.PI),n=Math.acos(2*F-1),t=a*Math.cos(w)*Math.sin(n),V=a*Math.cos(n),Z=a*Math.sin(w)*Math.sin(n);N.isEmitterTransformNode?d.Jq.TransformCoordinatesFromFloatsToRef(t,V,Z,N.emitterWorldMatrix,C.position):(C.position.hd(t,V,Z),C.position.addInPlace(N.emitterPosition))},this.output._storedValue=q}});(0,F.h)("BABYLON.PointShapeBlock",class extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerInput("direction1",bq.Jq,!0,new d.Jq(0,1,0)),this.registerInput("direction2",bq.Jq,!0,new d.Jq(0,1,0)),this.registerOutput("output",bq.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(N){const q=this.particle.getConnectedValue(N);q._directionCreation.process=C=>{N.particleContext=C,N.systemContext=q;const U=this.direction1.getConnectedValue(N),W=this.direction2.getConnectedValue(N),a=(0,A.RandomRange)(U.x,W.x),F=(0,A.RandomRange)(U.y,W.y),w=(0,A.RandomRange)(U.z,W.z);N.isEmitterTransformNode?d.Jq.TransformNormalFromFloatsToRef(a,F,w,N.emitterWorldMatrix,C.direction):C.direction.hd(a,F,w)},q._positionCreation.process=C=>{N.systemContext=q,N.isEmitterTransformNode?d.Jq.TransformCoordinatesFromFloatsToRef(0,0,0,N.emitterWorldMatrix,C.position):C.position.U(N.emitterPosition)},this.output._storedValue=q}});(0,F.h)("BABYLON.CustomShapeBlock",class extends Rq{constructor(N){super(N),this.registerInput("particle",bq.Particle),this.registerInput("position",bq.Jq,!0,new d.Jq(0,0,0)),this.registerInput("direction",bq.Jq,!0,new d.Jq(0,1,0)),this.registerOutput("output",bq.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(N){const q=this.particle.getConnectedValue(N);q._directionCreation.process=C=>{N.particleContext=C,N.systemContext=q;const U=this.direction.getConnectedValue(N);N.isEmitterTransformNode?d.Jq.TransformNormalToRef(U,N.emitterWorldMatrix,C.direction):C.direction.U(U)},q._positionCreation.process=C=>{N.particleContext=C,N.systemContext=q;const U=this.position.getConnectedValue(N);N.isEmitterTransformNode?d.Jq.TransformCoordinatesToRef(U,N.emitterWorldMatrix,C.position):(C.position.U(U),C.position.addInPlace(N.emitterPosition))},this.output._storedValue=q}});(0,F.h)("BABYLON.CylinderShapeBlock",class extends Rq{constructor(N){super(N),this._tempVector=d.Jq.Zero(),this.registerInput("particle",bq.Particle),this.registerInput("radius",bq.Float,!0,1),this.registerInput("height",bq.Float,!0,1,0),this.registerInput("radiusRange",bq.Float,!0,1,0,1),this.registerInput("directionRandomizer",bq.Float,!0,0,0,1),this.registerOutput("output",bq.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(N){const q=this.particle.getConnectedValue(N);q._directionCreation.process=C=>{N.particleContext=C,N.systemContext=q;const U=this.directionRandomizer.getConnectedValue(N);C.position.subtractToRef(N.emitterPosition,this._tempVector),this._tempVector.normalize(),N.isEmitterTransformNode&&d.Jq.TransformNormalToRef(this._tempVector,N.emitterInverseWorldMatrix,this._tempVector);const W=(0,A.RandomRange)(-U/2,U/2);let a=Math.atan2(this._tempVector.x,this._tempVector.z);a+=(0,A.RandomRange)(-Math.PI/2,Math.PI/2)*U,this._tempVector.y=W,this._tempVector.x=Math.sin(a),this._tempVector.z=Math.cos(a),this._tempVector.normalize(),N.isEmitterTransformNode?d.Jq.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,N.emitterWorldMatrix,C.direction):C.direction.U(this._tempVector)},q._positionCreation.process=C=>{N.particleContext=C,N.systemContext=q;const U=this.height.getConnectedValue(N),W=this.radiusRange.getConnectedValue(N),a=this.radius.getConnectedValue(N),F=(0,A.RandomRange)(-U/2,U/2),w=(0,A.RandomRange)(0,2*Math.PI),n=(0,A.RandomRange)((1-W)*(1-W),1),t=Math.sqrt(n)*a,V=t*Math.cos(w),Z=t*Math.sin(w);N.isEmitterTransformNode?d.Jq.TransformCoordinatesFromFloatsToRef(V,F,Z,N.emitterWorldMatrix,C.position):(C.position.hd(V,F,Z),C.position.addInPlace(N.emitterPosition))},this.output._storedValue=q}});class wC extends Rq{constructor(N){super(N),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",bq.Particle),this.registerOutput("output",bq.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){super._build(N);const q=this.particle.getConnectedValue(N);q._isAnimationSheetEnabled=!0,q.spriteCellWidth=this.width,q.spriteCellHeight=this.height,q.startSpriteCellID=this.start,q.endSpriteCellID=this.end,q.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=q}serialize(){const N=super.serialize();return N.width=this.width,N.height=this.height,N.start=this.start,N.end=this.end,N.randomStartCell=this.randomStartCell,N}_deserialize(N){super._deserialize(N),this.width=N.width,this.height=N.height,this.start=N.start,this.end=N.end,this.randomStartCell=N.randomStartCell}}(0,M.d)([uq("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wC.prototype,"start",void 0),(0,M.d)([uq("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wC.prototype,"end",void 0),(0,M.d)([uq("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wC.prototype,"width",void 0),(0,M.d)([uq("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wC.prototype,"height",void 0),(0,M.d)([uq("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wC.prototype,"loop",void 0),(0,M.d)([uq("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wC.prototype,"randomStartCell",void 0),(0,F.h)("BABYLON.SetupSpriteSheetBlock",wC);class AC extends Rq{constructor(N){super(N),this.reference=0,this.registerInput("value",bq.AutoDetect),this.registerOutput("output",bq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=N=>{switch(N){case bq.Float:return bq.FloatGradient;case bq.Vector2:return bq.Vector2Gradient;case bq.Jq:return bq.Vector3Gradient;case bq.md:return bq.Color4Gradient}return N},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bq.Float|bq.Vector2|bq.Jq|bq.md)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=N=>null}serialize(){const N=super.serialize();return N.reference=this.reference,N}_deserialize(N){super._deserialize(N),this.reference=N.reference}}(0,M.d)([uq("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],AC.prototype,"reference",void 0),(0,F.h)("BABYLON.ParticleGradientValueBlock",AC);(0,F.h)("BABYLON.ParticleGradientBlock",class extends Rq{constructor(N){super(N),this._entryCount=1,this.registerInput("gradient",bq.Float,!0,1,0,1),this.registerInput("value0",bq.AutoDetect),this.registerOutput("output",bq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=N=>{switch(N){case bq.FloatGradient:return bq.Float;case bq.Vector2Gradient:return bq.Vector2;case bq.Vector3Gradient:return bq.Jq;case bq.Color4Gradient:return bq.md}return N},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(bq.FloatGradient|bq.Vector2Gradient|bq.Vector3Gradient|bq.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(N){this._inputs[N].onConnectionObservable.add((()=>{this._entryCount>N||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),bq.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const N=[];for(let C=1;C<this._inputs.length;C++){var q;if(this._inputs[C].isConnected)N.push(null===(q=this._inputs[C].connectedPoint)||void 0===q?void 0:q.ownerBlock)}N.sort(((N,q)=>N.reference-q.reference)),this.output._storedFunction=q=>{const C=this.gradient.getConnectedValue(q);if(1===N.length)return N[0].value.getConnectedValue(q);let U=null;for(let W=N.length-1;W>=0;W--){const F=N[W];if(F.reference<=C){const N=F.value.getConnectedValue(q);if(U){const W=U.value.getConnectedValue(q),w=U.reference,n=F.reference,t=Math.max(0,Math.min(1,(C-n)/(w-n)));switch(this.output.type){case bq.Float:return(0,A.Lerp)(N,W,t);case bq.Vector2:return d.Vector2.Lerp(N,W,t);case bq.Jq:return d.Jq.Lerp(N,W,t);case bq.md:return a.md.Lerp(N,W,t)}}return N}U=F}return 0}}});(0,F.h)("BABYLON.ParticleConverterBlock",class extends Rq{constructor(N){super(N),this.registerInput("color ",bq.md,!0),this.registerInput("xyz ",bq.Jq,!0),this.registerInput("xy ",bq.Vector2,!0),this.registerInput("zw ",bq.Vector2,!0),this.registerInput("x ",bq.Float,!0),this.registerInput("y ",bq.Float,!0),this.registerInput("z ",bq.Float,!0),this.registerInput("w ",bq.Float,!0),this.registerOutput("color",bq.md),this.registerOutput("xyz",bq.Jq),this.registerOutput("xy",bq.Vector2),this.registerOutput("zw",bq.Vector2),this.registerOutput("x",bq.Float),this.registerOutput("y",bq.Float),this.registerOutput("z",bq.Float),this.registerOutput("w",bq.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(N){return"color "===N?"colorIn":"xyz "===N?"xyzIn":"xy "===N?"xyIn":"zw "===N?"zwIn":"x "===N?"xIn":"y "===N?"yIn":"z "===N?"zIn":"w "===N?"wIn":N}_outputRename(N){switch(N){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return N}}_build(N){super._build(N);const q=this.xIn,C=this.yIn,U=this.zIn,W=this.wIn,F=this.xyIn,w=this.zwIn,A=this.xyzIn,n=this.colorIn,t=this.colorOut,V=this.xyzOut,Z=this.xyOut,J=this.zwOut,Q=this.xOut,v=this.yOut,r=this.zOut,O=this.wOut,K=N=>{if(n.isConnected)return n.getConnectedValue(N);let d=0,t=0,V=0,Z=0;if(q.isConnected&&(d=q.getConnectedValue(N)),C.isConnected&&(t=C.getConnectedValue(N)),U.isConnected&&(V=U.getConnectedValue(N)),W.isConnected&&(Z=W.getConnectedValue(N)),F.isConnected){const q=F.getConnectedValue(N);q&&(d=q.x,t=q.y)}if(w.isConnected){const q=w.getConnectedValue(N);q&&(V=q.x,Z=q.y)}if(A.isConnected){const q=A.getConnectedValue(N);q&&(d=q.x,t=q.y,V=q.z)}return new a.md(d,t,V,Z)};t._storedFunction=N=>K(N),V._storedFunction=N=>{const q=K(N);return new d.Jq(q.r,q.g,q.b)},Z._storedFunction=N=>{const q=K(N);return new d.Vector2(q.r,q.g)},J._storedFunction=N=>{const q=K(N);return new d.Vector2(q.b,q.a)},Q._storedFunction=N=>K(N).r,v._storedFunction=N=>K(N).g,r._storedFunction=N=>K(N).b,O._storedFunction=N=>K(N).a}}),function(N){N[N.Cos=0]="Cos",N[N.Sin=1]="Sin",N[N.Abs=2]="Abs",N[N.Exp=3]="Exp",N[N.Exp2=4]="Exp2",N[N.Round=5]="Round",N[N.Floor=6]="Floor",N[N.Ceiling=7]="Ceiling",N[N.Sqrt=8]="Sqrt",N[N.Log=9]="Log",N[N.Tan=10]="Tan",N[N.ArcTan=11]="ArcTan",N[N.ArcCos=12]="ArcCos",N[N.ArcSin=13]="ArcSin",N[N.Sign=14]="Sign",N[N.Negate=15]="Negate",N[N.OneMinus=16]="OneMinus",N[N.Reciprocal=17]="Reciprocal",N[N.ToDegrees=18]="ToDegrees",N[N.ToRadians=19]="ToRadians",N[N.Fract=20]="Fract"}(Bq||(Bq={}));class nC extends Rq{constructor(N){super(N),this.operation=Bq.Cos,this.registerInput("input",bq.AutoDetect),this.registerOutput("output",bq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bq.Float|bq.Int|bq.Vector2|bq.Jq|bq.md)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){super._build(N);let q=null;switch(this.operation){case Bq.Cos:q=N=>Math.cos(N);break;case Bq.Sin:q=N=>Math.sin(N);break;case Bq.Abs:q=N=>Math.abs(N);break;case Bq.Exp:q=N=>Math.exp(N);break;case Bq.Exp2:q=N=>Math.pow(2,N);break;case Bq.Round:q=N=>Math.round(N);break;case Bq.Floor:q=N=>Math.floor(N);break;case Bq.Ceiling:q=N=>Math.ceil(N);break;case Bq.Sqrt:q=N=>Math.sqrt(N);break;case Bq.Log:q=N=>Math.log(N);break;case Bq.Tan:q=N=>Math.tan(N);break;case Bq.ArcTan:q=N=>Math.atan(N);break;case Bq.ArcCos:q=N=>Math.acos(N);break;case Bq.ArcSin:q=N=>Math.asin(N);break;case Bq.Sign:q=N=>Math.sign(N);break;case Bq.Negate:q=N=>-N;break;case Bq.OneMinus:q=N=>1-N;break;case Bq.Reciprocal:q=N=>1/N;break;case Bq.ToRadians:q=N=>N*Math.PI/180;break;case Bq.ToDegrees:q=N=>180*N/Math.PI;break;case Bq.Fract:q=N=>N>=0?N-Math.floor(N):N-Math.ceil(N)}if(!q)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case bq.Int:case bq.Float:this.output._storedFunction=N=>{const C=this.input.getConnectedValue(N);return q(C)};break;case bq.Vector2:this.output._storedFunction=N=>{const C=this.input.getConnectedValue(N);return new d.Vector2(q(C.x),q(C.y))};break;case bq.Jq:this.output._storedFunction=N=>{const C=this.input.getConnectedValue(N);return new d.Jq(q(C.x),q(C.y),q(C.z))};break;case bq.md:this.output._storedFunction=N=>{const C=this.input.getConnectedValue(N);return new a.md(q(C.r),q(C.g),q(C.b),q(C.a))}}return this}serialize(){const N=super.serialize();return N.operation=this.operation,N}_deserialize(N){super._deserialize(N),this.operation=N.operation}}(0,M.d)([uq("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Bq.Cos},{label:"Sin",value:Bq.Sin},{label:"Abs",value:Bq.Abs},{label:"Exp",value:Bq.Exp},{label:"Exp2",value:Bq.Exp2},{label:"Round",value:Bq.Round},{label:"Floor",value:Bq.Floor},{label:"Ceiling",value:Bq.Ceiling},{label:"Sqrt",value:Bq.Sqrt},{label:"Log",value:Bq.Log},{label:"Tan",value:Bq.Tan},{label:"ArcTan",value:Bq.ArcTan},{label:"ArcCos",value:Bq.ArcCos},{label:"ArcSin",value:Bq.ArcSin},{label:"Sign",value:Bq.Sign},{label:"Negate",value:Bq.Negate},{label:"OneMinus",value:Bq.OneMinus},{label:"Reciprocal",value:Bq.Reciprocal},{label:"ToDegrees",value:Bq.ToDegrees},{label:"ToRadians",value:Bq.ToRadians},{label:"Fract",value:Bq.Fract}]})],nC.prototype,"operation",void 0),(0,F.h)("BABYLON.ParticleTrigonometryBlock",nC);var tC,VC=C(12515);class ZC extends Rq{constructor(N){super(N),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",bq.AutoDetect),this.registerOutput("output",bq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(bq.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(bq.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(bq.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(bq.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(bq.System),this._inputs[0].excludedConnectionPointTypes.push(bq.Particle),this._inputs[0].excludedConnectionPointTypes.push(bq.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const q=N=>{const q=this.input.getConnectedValue(N);if(this.log.length>=this.stackSize)return q;if(null===q||void 0===q)return this.log.push(["null",""]),q;switch(this.input.type){case bq.Vector2:this.log.push([(0,VC.i)(q,4),q.toString()]);break;case bq.Jq:this.log.push([(0,VC.k)(q,4),q.toString()]);break;case bq.md:this.log.push([`{R: ${q.r.toFixed(4)} G: ${q.g.toFixed(4)} B: ${q.b.toFixed(4)} A: ${q.a.toFixed(4)}}`,q.toString()]);break;default:this.log.push([q.toString(),q.toString()])}return q};this.output.isConnected?this.output._storedFunction=q:this.output._storedValue=q(N)}serialize(){const N=super.serialize();return N.stackSize=this.stackSize,N}_deserialize(N){super._deserialize(N),this.stackSize=N.stackSize}}(0,M.d)([uq("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],ZC.prototype,"stackSize",void 0),(0,F.h)("BABYLON.ParticleDebugBlock",ZC);(0,F.h)("BABYLON.ParticleElbowBlock",class extends Rq{constructor(N){super(N),this.registerInput("input",bq.AutoDetect),this.registerOutput("output",bq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){super._build(N);const q=this._outputs[0],C=this._inputs[0];q._storedFunction=N=>C.getConnectedValue(N)}});(0,F.h)("BABYLON.ParticleTeleportInBlock",class extends Rq{get endpoints(){return this._endpoints}constructor(N){super(N),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",bq.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(N){if(this.getClassName()===N)return!0;for(const q of this.endpoints)if(q.isAnAncestorOfType(N))return!0;return!1}isAnAncestorOf(N){for(const q of this.endpoints){if(q===N)return!0;if(q.isAnAncestorOf(N))return!0}return!1}attachToEndpoint(N){N.detach(),this._endpoints.push(N),N._entryPoint=this,N._outputs[0]._typeConnectionSource=this._inputs[0],N._tempEntryPointUniqueId=null,N.name="> "+this.name}detachFromEndpoint(N){const q=this._endpoints.indexOf(N);-1!==q&&(this._endpoints.splice(q,1),N._outputs[0]._typeConnectionSource=null,N._entryPoint=null)}_build(){for(const N of this._endpoints)N.output._storedFunction=N=>this.input.getConnectedValue(N)}});(0,F.h)("BABYLON.ParticleTeleportOutBlock",class extends Rq{constructor(N){super(N),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",bq.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(N){this.entryPoint&&this.entryPoint.build(N)}clone(){const N=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(N),N}serialize(){var N;const q=super.serialize();return q.entryPoint=(null===(N=this.entryPoint)||void 0===N?void 0:N.uniqueId)??"",q}_deserialize(N){super._deserialize(N),this._tempEntryPointUniqueId=N.entryPoint}}),function(N){N[N.Equal=0]="Equal",N[N.NotEqual=1]="NotEqual",N[N.LessThan=2]="LessThan",N[N.GreaterThan=3]="GreaterThan",N[N.LessOrEqual=4]="LessOrEqual",N[N.GreaterOrEqual=5]="GreaterOrEqual",N[N.Xor=6]="Xor",N[N.Or=7]="Or",N[N.And=8]="And"}(tC||(tC={}));class JC extends Rq{constructor(N){super(N),this.test=tC.Equal,this.epsilon=0,this.registerInput("left",bq.Float),this.registerInput("right",bq.Float,!0,0),this.registerInput("ifTrue",bq.AutoDetect,!0,1),this.registerInput("ifFalse",bq.AutoDetect,!0,0),this.registerOutput("output",bq.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=bq.Float,this._inputs[0].acceptedConnectionPointTypes.push(bq.Int),this._inputs[1].acceptedConnectionPointTypes.push(bq.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const N=N=>{const q=this.left.getConnectedValue(N),C=this.right.getConnectedValue(N);let d=!1;switch(this.test){case tC.Equal:d=(0,A.WithinEpsilon)(q,C,this.epsilon);break;case tC.NotEqual:d=!(0,A.WithinEpsilon)(q,C,this.epsilon);break;case tC.LessThan:d=q<C+this.epsilon;break;case tC.GreaterThan:d=q>C-this.epsilon;break;case tC.LessOrEqual:d=q<=C+this.epsilon;break;case tC.GreaterOrEqual:d=q>=C-this.epsilon;break;case tC.Xor:d=!!q&&!C||!q&&!!C;break;case tC.Or:d=!!q||!!C;break;case tC.And:d=!!q&&!!C}return d};this.output._storedFunction=q=>N(q)?this.ifTrue.getConnectedValue(q):this.ifFalse.getConnectedValue(q)}serialize(){const N=super.serialize();return N.test=this.test,N.epsilon=this.epsilon,N}_deserialize(N){super._deserialize(N),this.test=N.test,void 0!==N.epsilon&&(this.epsilon=N.epsilon)}}(0,M.d)([uq("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:tC.Equal},{label:"NotEqual",value:tC.NotEqual},{label:"LessThan",value:tC.LessThan},{label:"GreaterThan",value:tC.GreaterThan},{label:"LessOrEqual",value:tC.LessOrEqual},{label:"GreaterOrEqual",value:tC.GreaterOrEqual},{label:"Xor",value:tC.Xor},{label:"Or",value:tC.Or},{label:"And",value:tC.And}]})],JC.prototype,"test",void 0),(0,M.d)([uq("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],JC.prototype,"epsilon",void 0),(0,F.h)("BABYLON.ParticleConditionBlock",JC);class QC extends Rq{constructor(N){super(N),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",bq.Particle),this.registerInput("condition",bq.Float,!0,0),this.registerInput("system",bq.System),this.registerOutput("output",bq.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(N){this._triggerCount=0;const q=this.input.getConnectedValue(N),C={process:C=>{if(N.particleContext=C,N.systemContext=q,0!==this.condition.getConnectedValue(N)&&(0===this.limit||this._triggerCount<this.limit)){const d=(new Date).getTime();if(this._previousOne&&d-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=d;const U=this.system.getConnectedValue(N);if(U){const d=fq(U,N.vq,C.position);d.td.addOnce((()=>{this._triggerCount--})),q.td.addOnce((()=>{d.dispose()}))}}},previousItem:null,nextItem:null};q._updateQueueStart?LN(C,q._updateQueueStart):q._updateQueueStart=C,this.output._storedValue=q}serialize(){const N=super.serialize();return N.limit=this.limit,N.delay=this.delay,N}_deserialize(N){super._deserialize(N),void 0!==N.limit&&(this.limit=N.limit),void 0!==N.delay&&(this.delay=N.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,M.d)([uq("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],QC.prototype,"limit",void 0),(0,M.d)([uq("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],QC.prototype,"delay",void 0),(0,F.h)("BABYLON.ParticleTriggerBlock",QC);C(12523),C(12532),C(12542),C(12598)},12582:(N,q,C)=>{"use strict";var d=C(11036);const U="clipPlaneFragment",W="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12548:(N,q,C)=>{"use strict";var d=C(11036);const U="clipPlaneFragmentDeclaration",W="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12613:(N,q,C)=>{"use strict";var d=C(11036);const U="clipPlaneVertex",W="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12607:(N,q,C)=>{"use strict";var d=C(11036);const U="clipPlaneVertexDeclaration",W="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12595:(N,q,C)=>{"use strict";var d=C(11036);const U="fogFragment",W="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12578:(N,q,C)=>{"use strict";var d=C(11036);const U="fogFragmentDeclaration",W="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12619:(N,q,C)=>{"use strict";var d=C(11036);const U="fogVertex",W="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12610:(N,q,C)=>{"use strict";var d=C(11036);const U="fogVertexDeclaration",W="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12564:(N,q,C)=>{"use strict";var d=C(11036);const U="helperFunctions",W="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12555:(N,q,C)=>{"use strict";var d=C(11036);const U="imageProcessingDeclaration",W="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12570:(N,q,C)=>{"use strict";var d=C(11036);const U="imageProcessingFunctions",W="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12559:(N,q,C)=>{"use strict";var d=C(11036);const U="logDepthDeclaration",W="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12586:(N,q,C)=>{"use strict";var d=C(11036);const U="logDepthFragment",W="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12623:(N,q,C)=>{"use strict";var d=C(11036);const U="logDepthVertex",W="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";d.c.IncludesShadersStoreWGSL[U]||(d.c.IncludesShadersStoreWGSL[U]=W)},12542:(N,q,C)=>{"use strict";C.r(q),C.d(q,{particlesPixelShaderWGSL:()=>a});var d=C(11036);C(12548),C(12555),C(12559),C(12564),C(12570),C(12578),C(12582),C(12586),C(12595);const U="particlesPixelShader",W="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";d.c.ShadersStoreWGSL[U]||(d.c.ShadersStoreWGSL[U]=W);const a={name:U,shader:W}},12598:(N,q,C)=>{"use strict";C.r(q),C.d(q,{particlesVertexShaderWGSL:()=>a});var d=C(11036);C(12607),C(12610),C(12559),C(12613),C(12619),C(12623);const U="particlesVertexShader",W="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";d.c.ShadersStoreWGSL[U]||(d.c.ShadersStoreWGSL[U]=W);const a={name:U,shader:W}},12456:(N,q,C)=>{"use strict";var d=C(11036);const U="clipPlaneFragment",W="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12527:(N,q,C)=>{"use strict";var d=C(11036);const U="clipPlaneFragmentDeclaration",W="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12477:(N,q,C)=>{"use strict";var d=C(11036);const U="clipPlaneVertex",W="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12539:(N,q,C)=>{"use strict";var d=C(11036);const U="clipPlaneVertexDeclaration",W="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12464:(N,q,C)=>{"use strict";var d=C(11036);const U="fogFragment",W="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12449:(N,q,C)=>{"use strict";var d=C(11036);const U="fogFragmentDeclaration",W="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12482:(N,q,C)=>{"use strict";var d=C(11036);const U="fogVertex",W="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12471:(N,q,C)=>{"use strict";var d=C(11036);const U="fogVertexDeclaration",W="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12441:(N,q,C)=>{"use strict";var d=C(11036);const U="helperFunctions",W="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12431:(N,q,C)=>{"use strict";var d=C(11036);const U="imageProcessingDeclaration",W="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12443:(N,q,C)=>{"use strict";var d=C(11036);const U="imageProcessingFunctions",W="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12434:(N,q,C)=>{"use strict";var d=C(11036);const U="logDepthDeclaration",W="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12462:(N,q,C)=>{"use strict";var d=C(11036);const U="logDepthFragment",W="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12488:(N,q,C)=>{"use strict";var d=C(11036);const U="logDepthVertex",W="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";d.c.IncludesShadersStore[U]||(d.c.IncludesShadersStore[U]=W)},12523:(N,q,C)=>{"use strict";C.r(q),C.d(q,{particlesPixelShader:()=>a});var d=C(11036);C(12527),C(12431),C(12434),C(12441),C(12443),C(12449),C(12456),C(12462),C(12464);const U="particlesPixelShader",W="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";d.c.ShadersStore[U]||(d.c.ShadersStore[U]=W);const a={name:U,shader:W}},12532:(N,q,C)=>{"use strict";C.r(q),C.d(q,{particlesVertexShader:()=>a});var d=C(11036);C(12539),C(12471),C(12434),C(12477),C(12482),C(12488);const U="particlesVertexShader",W="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";d.c.ShadersStore[U]||(d.c.ShadersStore[U]=W);const a={name:U,shader:W}},12882:(N,q,C)=>{"use strict";C.r(q),C.d(q,{FlowGraphGLTFDataProvider:()=>W});var d=C(12856),U=C(12831);class W extends d.d{constructor(N){var q,C;super();const d=N.glTF,W=(null===(q=d.animations)||void 0===q?void 0:q.map((N=>N._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",U.b,W);const a=(null===(C=d.nodes)||void 0===C?void 0:C.map((N=>N._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",U.b,a)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12779:(N,q,C)=>{"use strict";C.d(q,{e:()=>v,f:()=>J,i:()=>Z,j:()=>Q});var d=C(11122),U=C(11603),W=C(11167),a=C(12786);const F=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class w{constructor(N,q){this._gltf=N,this._infoTree=q}convert(N){let q,C=this._gltf,d=this._infoTree;if(!N.startsWith("/"))throw new Error("Path must start with a /");const U=N.split("/");if(U.shift(),U[U.length-1].includes(".length")){const N=U[U.length-1].split(".");U.pop(),U.push(...N)}let W=!1;for(const w of U){const U="length"===w;if(U&&!d.__array__)throw new Error(`Path ${N} is invalid`);if(d.__ignoreObjectTree__&&(W=!0),d.__array__&&!U)d=d.__array__;else if(d=d[w],!d)throw new Error(`Path ${N} is invalid`);if(!W)if(void 0===C){if(!F.find((q=>q.regex.test(N))))throw new Error(`Path ${N} is invalid`)}else if(!U){var a;C=null===(a=C)||void 0===a?void 0:a[w]}(d.__target__||U)&&(q=C)}return{object:q,info:d}}}function A(N,q,C,d){const U=n(N,q);return d?U[C][d]:U[C]}function n(N,q,C){var d,W;return null===(d=N._data)||void 0===d||null===(W=d[(null===C||void 0===C?void 0:C.fillMode)??U.b.MATERIAL_TriangleFillMode])||void 0===W?void 0:W.babylonMaterial}function t(N,q){return{offset:{componentsCount:2,type:"Vector2",get:(C,U,W)=>{const a=A(C,W,N,q);return new d.Vector2(null===a||void 0===a?void 0:a.uOffset,null===a||void 0===a?void 0:a.vOffset)},getTarget:n,set:(C,d,U,W)=>{const a=A(d,W,N,q);a.uOffset=C.x,a.vOffset=C.y},getPropertyName:[()=>`${N}${q?"."+q:""}.uOffset`,()=>`${N}${q?"."+q:""}.vOffset`]},rotation:{type:"number",get:(C,d,U)=>{var W;return null===(W=A(C,U,N,q))||void 0===W?void 0:W.wAng},getTarget:n,set:(C,d,U,W)=>A(d,W,N,q).wAng=C,getPropertyName:[()=>`${N}${q?"."+q:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(C,U,W)=>{const a=A(C,W,N,q);return new d.Vector2(null===a||void 0===a?void 0:a.uScale,null===a||void 0===a?void 0:a.vScale)},getTarget:n,set:(C,d,U,W)=>{const a=A(d,W,N,q);a.uScale=C.x,a.vScale=C.y},getPropertyName:[()=>`${N}${q?"."+q:""}.uScale`,()=>`${N}${q?"."+q:""}.vScale`]}}}const V={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:N=>{var q,C;return new d.Vector2((null===(q=N._babylonCamera)||void 0===q?void 0:q.orthoLeft)??0,(null===(C=N._babylonCamera)||void 0===C?void 0:C.orthoRight)??0)},set:(N,q)=>{q._babylonCamera&&(q._babylonCamera.orthoLeft=N.x,q._babylonCamera.orthoRight=N.y)},getTarget:N=>N,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:N=>{var q,C;return new d.Vector2((null===(q=N._babylonCamera)||void 0===q?void 0:q.orthoBottom)??0,(null===(C=N._babylonCamera)||void 0===C?void 0:C.orthoTop)??0)},set:(N,q)=>{q._babylonCamera&&(q._babylonCamera.orthoBottom=N.x,q._babylonCamera.orthoTop=N.y)},getTarget:N=>N,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:N=>{var q;return null===(q=N._babylonCamera)||void 0===q?void 0:q.maxZ},set:(N,q)=>{q._babylonCamera&&(q._babylonCamera.maxZ=N)},getTarget:N=>N,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:N=>{var q;return null===(q=N._babylonCamera)||void 0===q?void 0:q.sd},set:(N,q)=>{q._babylonCamera&&(q._babylonCamera.sd=N)},getTarget:N=>N,getPropertyName:[()=>"sd"]}},perspective:{aspectRatio:{type:"number",get:N=>{var q;return null===(q=N._babylonCamera)||void 0===q?void 0:q.getEngine().getAspectRatio(N._babylonCamera)},getTarget:N=>N,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:N=>{var q;return null===(q=N._babylonCamera)||void 0===q?void 0:q.fov},set:(N,q)=>{q._babylonCamera&&(q._babylonCamera.fov=N)},getTarget:N=>N,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:N=>{var q;return null===(q=N._babylonCamera)||void 0===q?void 0:q.maxZ},set:(N,q)=>{q._babylonCamera&&(q._babylonCamera.maxZ=N)},getTarget:N=>N,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:N=>{var q;return null===(q=N._babylonCamera)||void 0===q?void 0:q.sd},set:(N,q)=>{q._babylonCamera&&(q._babylonCamera.sd=N)},getTarget:N=>N,getPropertyName:[()=>"sd"]}}}},nodes:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Jq",get:N=>{var q;return null===(q=N._babylonTransformNode)||void 0===q?void 0:q.position},set:(N,q)=>{var C;return null===(C=q._babylonTransformNode)||void 0===C?void 0:C.position.U(N)},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:N=>{var q;return null===(q=N._babylonTransformNode)||void 0===q?void 0:q.rotationQuaternion},set:(N,q)=>{var C,d;return null===(C=q._babylonTransformNode)||void 0===C||null===(d=C.rotationQuaternion)||void 0===d?void 0:d.U(N)},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Jq",get:N=>{var q;return null===(q=N._babylonTransformNode)||void 0===q?void 0:q.yd},set:(N,q)=>{var C;return null===(C=q._babylonTransformNode)||void 0===C?void 0:C.yd.U(N)},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"yd"]},weights:{length:{type:"number",get:N=>N._numMorphTargets,getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(N,q)=>{var C,d;return void 0!==q?null===(C=N._primitiveBabylonMeshes)||void 0===C||null===(d=C[0].morphTargetManager)||void 0===d?void 0:d.getTarget(q).influence:void 0},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(N,q)=>[0],getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:N=>{var q,C,U;return d.Matrix.Compose(null===(q=N._babylonTransformNode)||void 0===q?void 0:q.yd,null===(C=N._babylonTransformNode)||void 0===C?void 0:C.rotationQuaternion,null===(U=N._babylonTransformNode)||void 0===U?void 0:U.position)},getTarget:N=>N._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:N=>{var q,C,U,W;const a=d.Matrix.Identity();let F=N.parent;for(;F&&F.parent;)F=F.parent;const w=(null===(q=N._babylonTransformNode)||void 0===q?void 0:q.position._isDirty)||(null===(C=N._babylonTransformNode)||void 0===C||null===(U=C.rotationQuaternion)||void 0===U?void 0:U._isDirty)||(null===(W=N._babylonTransformNode)||void 0===W?void 0:W.yd._isDirty);if(F){var A;const q=null===(A=F._babylonTransformNode)||void 0===A?void 0:A.Ed(!0).invert();var n,t;if(q)null===(n=N._babylonTransformNode)||void 0===n||null===(t=n.Ed(w))||void 0===t||t.multiplyToRef(q,a)}else N._babylonTransformNode&&a.U(N._babylonTransformNode.Ed(w));return a},getTarget:N=>N._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:N=>{var q,C;return null===(q=N._babylonTransformNode)||void 0===q||null===(C=q.getChildren((N=>N instanceof a.d),!0)[0])||void 0===C?void 0:C.OF},getTarget:N=>{var q;return null===(q=N._babylonTransformNode)||void 0===q?void 0:q.getChildren((N=>N instanceof a.d),!0)[0]},set:(N,q)=>{if(q._babylonTransformNode){const C=q._babylonTransformNode.getChildren((N=>N instanceof a.d),!0)[0];C&&(C.OF=N)}}},color:{type:"Oq",get:N=>{var q,C;return null===(q=N._babylonTransformNode)||void 0===q||null===(C=q.getChildren((N=>N instanceof a.d),!0)[0])||void 0===C?void 0:C.KF},getTarget:N=>{var q;return null===(q=N._babylonTransformNode)||void 0===q?void 0:q.getChildren((N=>N instanceof a.d),!0)[0]},set:(N,q)=>{if(q._babylonTransformNode){const C=q._babylonTransformNode.getChildren((N=>N instanceof a.d),!0)[0];C&&(C.KF=N)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Oq",get:(N,q,C)=>n(N,q,C).emissiveColor,set:(N,q,C,d)=>n(q,C,d).emissiveColor.U(N),getTarget:(N,q,C)=>n(N,q,C),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:t("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(N,q,C)=>{var d;return null===(d=A(N,C,"bumpTexture"))||void 0===d?void 0:d.level},set:(N,q,C,d)=>{const U=A(q,d,"bumpTexture");U&&(U.level=N)},getTarget:(N,q,C)=>n(N,q,C),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:t("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(N,q,C)=>n(N,q,C).ambientTextureStrength,set:(N,q,C,d)=>{const U=n(q,C,d);U&&(U.ambientTextureStrength=N)},getTarget:(N,q,C)=>n(N,q,C),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:t("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"md",get:(N,q,C)=>{const d=n(N,q,C);return W.md.FromColor3(d.albedoColor,d.alpha)},set:(N,q,C,d)=>{const U=n(q,C,d);U.albedoColor.set(N.r,N.g,N.b),U.alpha=N.a},getTarget:(N,q,C)=>n(N,q,C),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:t("albedoTexture")}},metallicFactor:{type:"number",get:(N,q,C)=>n(N,q,C).metallic,set:(N,q,C,d)=>{const U=n(q,C,d);U&&(U.metallic=N)},getTarget:(N,q,C)=>n(N,q,C),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(N,q,C)=>n(N,q,C).roughness,set:(N,q,C,d)=>{const U=n(q,C,d);U&&(U.roughness=N)},getTarget:(N,q,C)=>n(N,q,C),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:t("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(N,q,C)=>n(N,q,C).anisotropy.OF,set:(N,q,C,d)=>{n(q,C,d).anisotropy.OF=N},getTarget:(N,q,C)=>n(N,q,C),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(N,q,C)=>n(N,q,C).anisotropy.angle,set:(N,q,C,d)=>{n(q,C,d).anisotropy.angle=N},getTarget:(N,q,C)=>n(N,q,C),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:t("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(N,q,C)=>n(N,q,C).clearCoat.OF,set:(N,q,C,d)=>{n(q,C,d).clearCoat.OF=N},getTarget:(N,q,C)=>n(N,q,C),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(N,q,C)=>n(N,q,C).clearCoat.roughness,set:(N,q,C,d)=>{n(q,C,d).clearCoat.roughness=N},getTarget:(N,q,C)=>n(N,q,C),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:t("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(N,q,C)=>{var d;return null===(d=n(N,q,C).clearCoat.bumpTexture)||void 0===d?void 0:d.level},getTarget:n,set:(N,q,C,d)=>n(q,C,d).clearCoat.bumpTexture.level=N},extensions:{KHR_texture_transform:t("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:t("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(N,q,C)=>n(N,q,C).subSurface.dispersion,getTarget:n,set:(N,q,C,d)=>n(q,C,d).subSurface.dispersion=N}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(N,q,C)=>n(N,q,C).emissiveIntensity,getTarget:n,set:(N,q,C,d)=>n(q,C,d).emissiveIntensity=N}},KHR_materials_ior:{ior:{type:"number",get:(N,q,C)=>n(N,q,C).indexOfRefraction,getTarget:n,set:(N,q,C,d)=>n(q,C,d).indexOfRefraction=N}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(N,q,C)=>n(N,q,C).iridescence.OF,getTarget:n,set:(N,q,C,d)=>n(q,C,d).iridescence.OF=N},iridescenceIor:{type:"number",get:(N,q,C)=>n(N,q,C).iridescence.indexOfRefraction,getTarget:n,set:(N,q,C,d)=>n(q,C,d).iridescence.indexOfRefraction=N},iridescenceTexture:{extensions:{KHR_texture_transform:t("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(N,q,C)=>n(N,q,C).iridescence.maximumThickness,getTarget:n,set:(N,q,C,d)=>n(q,C,d).iridescence.maximumThickness=N},iridescenceThicknessMinimum:{type:"number",get:(N,q,C)=>n(N,q,C).iridescence.minimumThickness,getTarget:n,set:(N,q,C,d)=>n(q,C,d).iridescence.minimumThickness=N},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:t("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Oq",get:(N,q,C)=>n(N,q,C).sheen.color,getTarget:n,set:(N,q,C,d)=>n(q,C,d).sheen.color.U(N)},sheenColorTexture:{extensions:{KHR_texture_transform:t("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(N,q,C)=>n(N,q,C).sheen.OF,getTarget:n,set:(N,q,C,d)=>n(q,C,d).sheen.OF=N},sheenRoughnessTexture:{extensions:{KHR_texture_transform:t("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(N,q,C)=>n(N,q,C).metallicF0Factor,getTarget:n,set:(N,q,C,d)=>n(q,C,d).metallicF0Factor=N,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Oq",get:(N,q,C)=>n(N,q,C).metallicReflectanceColor,getTarget:n,set:(N,q,C,d)=>n(q,C,d).metallicReflectanceColor.U(N),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:t("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:t("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(N,q,C)=>n(N,q,C).subSurface.refractionIntensity,getTarget:n,set:(N,q,C,d)=>n(q,C,d).subSurface.refractionIntensity=N,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:t("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(N,q,C)=>n(N,q,C).subSurface.translucencyIntensity,getTarget:n,set:(N,q,C,d)=>n(q,C,d).subSurface.translucencyIntensity=N},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:t("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Oq",get:(N,q,C)=>n(N,q,C).subSurface.translucencyColor,getTarget:n,set:(N,q,C,d)=>{var U;return N&&(null===(U=n(q,C,d).subSurface.translucencyColor)||void 0===U?void 0:U.U(N))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:t("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Oq",get:(N,q,C)=>n(N,q,C).subSurface.tintColor,getTarget:n,set:(N,q,C,d)=>n(q,C,d).subSurface.tintColor.U(N)},attenuationDistance:{type:"number",get:(N,q,C)=>n(N,q,C).subSurface.tintColorAtDistance,getTarget:n,set:(N,q,C,d)=>n(q,C,d).subSurface.tintColorAtDistance=N},thicknessFactor:{type:"number",get:(N,q,C)=>n(N,q,C).subSurface.maximumThickness,getTarget:n,set:(N,q,C,d)=>n(q,C,d).subSurface.maximumThickness=N},thicknessTexture:{extensions:{KHR_texture_transform:t("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonLight)),getPropertyName:[N=>"length"]},__array__:{__target__:!0,color:{type:"Oq",get:N=>{var q;return null===(q=N._babylonLight)||void 0===q?void 0:q.KF},set:(N,q)=>{var C;return null===(C=q._babylonLight)||void 0===C?void 0:C.KF.U(N)},getTarget:N=>N._babylonLight,getPropertyName:[N=>"diffuse"]},OF:{type:"number",get:N=>{var q;return null===(q=N._babylonLight)||void 0===q?void 0:q.OF},set:(N,q)=>q._babylonLight?q._babylonLight.OF=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"intensity"]},range:{type:"number",get:N=>{var q;return null===(q=N._babylonLight)||void 0===q?void 0:q.range},set:(N,q)=>q._babylonLight?q._babylonLight.range=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"range"]},spot:{innerConeAngle:{type:"number",get:N=>{var q;return null===(q=N._babylonLight)||void 0===q?void 0:q.innerAngle},set:(N,q)=>q._babylonLight?q._babylonLight.innerAngle=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"innerConeAngle"]},outerConeAngle:{type:"number",get:N=>{var q;return null===(q=N._babylonLight)||void 0===q?void 0:q.angle},set:(N,q)=>q._babylonLight?q._babylonLight.angle=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonLight)),getPropertyName:[N=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonTexture)),getPropertyName:[N=>"length"]},__array__:{__target__:!0,OF:{type:"number",get:N=>{var q;return null===(q=N._babylonTexture)||void 0===q?void 0:q.level},set:(N,q)=>{q._babylonTexture&&(q._babylonTexture.level=N)},getTarget:N=>N._babylonTexture},rotation:{type:"Quaternion",get:N=>{var q;return N._babylonTexture&&d.Quaternion.FromRotationMatrix(null===(q=N._babylonTexture)||void 0===q?void 0:q.getReflectionTextureMatrix())},set:(N,q)=>{var C;q._babylonTexture&&(null!==(C=q._babylonTexture.lN())&&void 0!==C&&C.useRightHandedSystem||(N=d.Quaternion.Inverse(N)),d.Matrix.FromQuaternionToRef(N,q._babylonTexture.getReflectionTextureMatrix()))},getTarget:N=>N._babylonTexture}}}}},animations:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>{var q;return null===(q=N.primitives[0]._instanceData)||void 0===q?void 0:q.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function Z(N){return new w(N,V)}function J(N){const q=N.split("/").map((N=>N.replace(/{}/g,"__array__")));let C=V;for(const d of q)d&&(C=C[d]);if(C&&C.type&&C.get)return C}function Q(N,q){const C=N.split("/").map((N=>N.replace(/{}/g,"__array__")));let d=V;for(const U of C)U&&(d=d[U]);d&&d.type&&d.get&&(d.interpolation=q)}function v(N,q){const C=N.split("/").map((N=>N.replace(/{}/g,"__array__")));let d=V;for(const U of C)if(U){if(!d[U]){if("?"===U){d.__ignoreObjectTree__=!0;continue}d[U]={},"__array__"===U&&(d[U].__target__=!0)}d=d[U]}Object.assign(d,q)}},12789:(N,q,C)=>{"use strict";C.r(q),C.d(q,{AnimationPropertyInfo:()=>A,TransformNodeAnimationPropertyInfo:()=>n,WeightAnimationPropertyInfo:()=>t,getQuaternion:()=>F,getVector3:()=>a,getWeights:()=>w});var d=C(11645),U=C(11122),W=C(12779);function a(N,q,C,d){return U.Jq.Kq(q,C).scaleInPlace(d)}function F(N,q,C,d){return U.Quaternion.Kq(q,C).scaleInPlace(d)}function w(N,q,C,d){const U=new Array(N._numMorphTargets);for(let W=0;W<U.length;W++)U[W]=q[C++]*d;return U}class A{constructor(N,q,C,d){this.type=N,this.name=q,this.getValue=C,this.getStride=d}_buildAnimation(N,q,C){const U=new d.d(N,this.name,q,this.type);return U.setKeys(C),U}}class n extends A{buildAnimations(N,q,C,d){const U=[];return U.push({babylonAnimatable:N._babylonTransformNode,babylonAnimation:this._buildAnimation(q,C,d)}),U}}class t extends A{buildAnimations(N,q,C,U){const W=[];if(N._numMorphTargets)for(let a=0;a<N._numMorphTargets;a++){const F=new d.d(`${q}_${a}`,this.name,C,this.type);if(F.setKeys(U.map((N=>({frame:N.frame,inTangent:N.inTangent?N.inTangent[a]:void 0,value:N.value[a],outTangent:N.outTangent?N.outTangent[a]:void 0,interpolation:N.interpolation})))),N._primitiveBabylonMeshes)for(const q of N._primitiveBabylonMeshes)if(q.morphTargetManager){const N=q.morphTargetManager.getTarget(a),C=F.clone();N.animations.push(C),W.push({babylonAnimatable:N,babylonAnimation:C})}}return W}}(0,W.j)("/nodes/{}/translation",[new n(d.d.ANIMATIONTYPE_VECTOR3,"position",a,(()=>3))]),(0,W.j)("/nodes/{}/rotation",[new n(d.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",F,(()=>4))]),(0,W.j)("/nodes/{}/scale",[new n(d.d.ANIMATIONTYPE_VECTOR3,"yd",a,(()=>3))]),(0,W.j)("/nodes/{}/weights",[new t(d.d.ANIMATIONTYPE_FLOAT,"influence",w,(N=>N._numMorphTargets))])},12746:(N,q,C)=>{"use strict";class d{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((N,q)=>{this._resolve=N,this._reject=q}))}}var U=C(11122),W=C(11167),a=C(10945),F=C(11578),w=C(12750),A=C(12763),n=C(10949),t=C(11596),V=C(11645),Z=C(11651),J=C(10995),Q=C(10962),v=C(10971);class r{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(N){this._useTextureToStoreBoneMatrices=N,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(N){this._animationPropertiesOverride=N}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(N,q,C){this.name=N,this.id=q,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=U.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new n.b,this.bones=[],this._scene=C||J.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const d=this._scene.getEngine().getCaps();this._canUseTextureForBones=d.textureFloat&&d.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((N=>!N.getParent()))}getTransformMatrices(N){if(this.needInitialSkinMatrix){if(!N)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return N._bonesTransformMatrices||this.prepare(!0),N._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(N){return this.needInitialSkinMatrix&&N._transformMatrixTexture?N._transformMatrixTexture:this._transformMatrixTexture}lN(){return this._scene}toString(N){let q=`Name: ${this.name}, nBones: ${this.bones.length}`;if(q+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,N){q+=", Ranges: {";let N=!0;for(const C in this._ranges)N&&(q+=", ",N=!1),q+=C;q+="}"}return q}getBoneIndexByName(N){for(let q=0,C=this.bones.length;q<C;q++)if(this.bones[q].name===N)return q;return-1}createAnimationRange(N,q,C){if(!this._ranges[N]){this._ranges[N]=new Z.e(N,q,C);for(let d=0,U=this.bones.length;d<U;d++)this.bones[d].animations[0]&&this.bones[d].animations[0].createRange(N,q,C)}}deleteAnimationRange(N){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let C=0,d=this.bones.length;C<d;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].deleteRange(N,q);this._ranges[N]=null}getAnimationRange(N){return this._ranges[N]||null}getAnimationRanges(){const N=[];let q;for(q in this._ranges)N.push(this._ranges[q]);return N}copyAnimationRange(N,q){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[q]||!N.getAnimationRange(q))return!1;let d=!0;const U=this._getHighestAnimationFrame()+1,W={},a=N.bones;let F,w;for(w=0,F=a.length;w<F;w++)W[a[w].name]=a[w];this.bones.length!==a.length&&(Q.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${a.length}`),d=!1);const A=C&&this.dimensionsAtRest&&N.dimensionsAtRest?this.dimensionsAtRest.divide(N.dimensionsAtRest):null;for(w=0,F=this.bones.length;w<F;w++){const N=this.bones[w].name,a=W[N];a?d=d&&this.bones[w].copyAnimationRange(a,q,U,C,A):(Q.c.Warn("copyAnimationRange: not same rig, missing source bone "+N),d=!1)}const n=N.getAnimationRange(q);return n&&(this._ranges[q]=new Z.e(q,n.from+U,n.to+U)),d}returnToRest(){for(const N of this.bones)-1!==N._index&&N.returnToRest()}_getHighestAnimationFrame(){let N=0;for(let q=0,C=this.bones.length;q<C;q++)if(this.bones[q].animations[0]){const C=this.bones[q].animations[0].getHighestFrame();N<C&&(N=C)}return N}beginAnimation(N,q,C,d){const U=this.getAnimationRange(N);return U?this._scene.beginAnimation(this,U.from,U.to,q,C,d):null}static MakeAnimationAdditive(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const d=N.getAnimationRange(C);if(!d)return null;const U=N._scene.getAllAnimatablesByTarget(N);let W=null;for(let F=0;F<U.length;F++){const N=U[F];if(N.fromFrame===(null===d||void 0===d?void 0:d.from)&&N.toFrame===(null===d||void 0===d?void 0:d.to)){W=N;break}}const a=N.getAnimatables();for(let F=0;F<a.length;F++){const N=a[F].animations;if(N)for(let d=0;d<N.length;d++)V.d.MakeAnimationAdditive(N[d],q,C)}return W&&(W.isAdditive=!0),N}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(N){this._meshesWithPoseMatrix.push(N)}_unregisterMeshWithPoseMatrix(N){const q=this._meshesWithPoseMatrix.indexOf(N);q>-1&&this._meshesWithPoseMatrix.splice(q,1)}_computeTransformMatrices(N,q){this.onBeforeComputeObservable.notifyObservers(this);for(let C=0;C<this.bones.length;C++){const d=this.bones[C];d._childUpdateId++;const U=d.getParent();if(U?d.getLocalMatrix().multiplyToRef(U.getFinalMatrix(),d.getFinalMatrix()):q?d.getLocalMatrix().multiplyToRef(q,d.getFinalMatrix()):d.getFinalMatrix().U(d.getLocalMatrix()),-1!==d._index){const q=null===d._index?C:d._index;d.getAbsoluteInverseBindMatrix().multiplyToArray(d.getFinalMatrix(),N,16*q)}}this._identity.copyToArray(N,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const N=this.lN().getRenderId();if(this._currentRenderId===N)return;this._currentRenderId=N}if(this._numBonesWithLinkedTransformNode>0)for(const N of this.bones)if(N._linkedTransformNode){const q=N._linkedTransformNode;N.position=q.position,q.rotationQuaternion?N.rotationQuaternion=q.rotationQuaternion:N.rotation=q.rotation,N.yd=q.yd}if(this.needInitialSkinMatrix)for(const N of this._meshesWithPoseMatrix){const q=N.getPoseMatrix();let C=this._isDirty;if(N._bonesTransformMatrices&&N._bonesTransformMatrices.length===16*(this.bones.length+1)||(N._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),C=!0),C){if(this._synchronizedWithMesh!==N){this._synchronizedWithMesh=N;for(const N of this.bones)if(!N.getParent()){N.getBindMatrix().multiplyToRef(q,U.TmpVectors.Matrix[1]),N._updateAbsoluteBindMatrices(U.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const q=4*(this.bones.length+1);N._transformMatrixTexture&&N._transformMatrixTexture.getSize().width===q||(N._transformMatrixTexture&&N._transformMatrixTexture.dispose(),N._transformMatrixTexture=t.d.CreateRGBATexture(N._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(N._bonesTransformMatrices,q),this.isUsingTextureForMatrices&&N._transformMatrixTexture&&N._transformMatrixTexture.update(N._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=t.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let N=0;N<this.bones.length;N++)this._animatables.push(this.bones[N])}return this._animatables}clone(N,q){const C=new r(N,q||N,this._scene);C.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let d=0;d<this.bones.length;d++){const N=this.bones[d];let q=null;const U=N.getParent();if(U){const N=this.bones.indexOf(U);q=C.bones[N]}const W=new A.d(N.name,C,q,N.getBindMatrix().clone(),N.getRestMatrix().clone());W._index=N._index,N._linkedTransformNode&&W.linkTransformNode(N._linkedTransformNode),v.b.DeepCopy(N.animations,W.animations)}if(this._ranges){C._ranges={};for(const N in this._ranges){const q=this._ranges[N];q&&(C._ranges[N]=q.clone())}}return this._isDirty=!0,C.prepare(!0),C}enableBlending(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const q of this.bones)for(const C of q.animations)C.enableBlending=!0,C.blendingSpeed=N}dispose(){if(this._meshesWithPoseMatrix.length=0,this.lN().stopAnimation(this),this.lN().removeSkeleton(this),this._parentContainer){const N=this._parentContainer.skeletons.indexOf(this);N>-1&&this._parentContainer.skeletons.splice(N,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const N={};N.name=this.name,N.id=this.id,this.dimensionsAtRest&&(N.dimensionsAtRest=this.dimensionsAtRest.zd()),N.bones=[],N.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){var q;const d=this.bones[C],U=d.getParent(),W={parentBoneIndex:U?this.bones.indexOf(U):-1,index:d.getIndex(),name:d.name,id:d.id,matrix:d.getBindMatrix().zd(),rest:d.getRestMatrix().zd(),linkedTransformNodeId:null===(q=d.getTransformNode())||void 0===q?void 0:q.id};N.bones.push(W),d.length&&(W.length=d.length),d.metadata&&(W.metadata=d.metadata),d.animations&&d.animations.length>0&&(W.animation=d.animations[0].serialize()),N.ranges=[];for(const q in this._ranges){const C=this._ranges[q];if(!C)continue;const d={};d.name=q,d.from=C.from,d.to=C.to,N.ranges.push(d)}}return N}static Parse(N,q){const C=new r(N.name,N.id,q);let d;for(N.dimensionsAtRest&&(C.dimensionsAtRest=U.Jq.Kq(N.dimensionsAtRest)),C.needInitialSkinMatrix=N.needInitialSkinMatrix,d=0;d<N.bones.length;d++){const q=N.bones[d],W=N.bones[d].index;let a=null;q.parentBoneIndex>-1&&(a=C.bones[q.parentBoneIndex]);const F=q.rest?U.Matrix.Kq(q.rest):null,w=new A.d(q.name,C,a,U.Matrix.Kq(q.matrix),F,null,W);void 0!==q.id&&null!==q.id&&(w.id=q.id),q.length&&(w.length=q.length),q.metadata&&(w.metadata=q.metadata),q.animation&&w.animations.push(V.d.Parse(q.animation)),void 0!==q.linkedTransformNodeId&&null!==q.linkedTransformNodeId&&(C._hasWaitingData=!0,w._waitingTransformNodeId=q.linkedTransformNodeId)}if(N.ranges)for(d=0;d<N.ranges.length;d++){const q=N.ranges[d];C.createAnimationRange(q.name,q.from,q.to)}return C}computeAbsoluteMatrices(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||N)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(N)}getPoseMatrix(){let N=null;return this._meshesWithPoseMatrix.length>0&&(N=this._meshesWithPoseMatrix[0].getPoseMatrix()),N}sortBones(){const N=[],q=new Array(this.bones.length);for(let C=0;C<this.bones.length;C++)this._sortBones(C,N,q);this.bones=N}_sortBones(N,q,C){if(C[N])return;C[N]=!0;const d=this.bones[N];if(!d)return;void 0===d._index&&(d._index=N);const U=d.getParent();U&&this._sortBones(this.bones.indexOf(U),q,C),q.push(d)}setCurrentPoseAsRest(){for(const N of this.bones)N.setCurrentPoseAsRest()}}var O=C(11447),K=C(11618),i=C(11101),I=C(11541),j=C(11199),l=C(11584),T=C(11557),z=C(11571),p=C(11659),s=C(11219),X=C(12717);class P{set areUpdatesFrozen(N){N?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new s.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,N||(N=J.e.LastCreatedScene),this._scene=N,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const N=this._scene.getEngine().getCaps();this._canUseTextureForTargets=N.canUseGLVertexID&&N.textureFloat&&N.maxVertexTextureImageUnits>0&&N.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return P.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?P.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(N){this._numMaxInfluencers!==N&&(this._numMaxInfluencers=N,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(N){this._useTextureToStoreTargets!==N&&(this._useTextureToStoreTargets=N,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var N;return P.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(N=this._scene)&&void 0!==N&&N.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(N){return this._activeTargets.data[N]}getTarget(N){return this._targets[N]}getTargetByName(N){for(const q of this._targets)if(q.name===N)return q;return null}addTarget(N){this._targets.push(N),this._targetInfluenceChangedObservers.push(N.onInfluenceChanged.add((N=>{this.areUpdatesFrozen&&N&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(N)}))),this._targetDataLayoutChangedObservers.push(N._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(N){const q=this._targets.indexOf(N);q>=0&&(this._targets.splice(q,1),N.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(q,1)[0]),N._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(q,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(N)}_bind(N){N.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),N.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),N.setTexture("morphTargets",this._targetStoreTexture),N.setInt("morphTargetCount",this.numInfluencers)}clone(){const N=new P(this._scene);for(const q of this._targets)N.addTarget(q.clone());return N.enablePositionMorphing=this.enablePositionMorphing,N.enableNormalMorphing=this.enableNormalMorphing,N.enableTangentMorphing=this.enableTangentMorphing,N.enableUVMorphing=this.enableUVMorphing,N.enableUV2Morphing=this.enableUV2Morphing,N.enableColorMorphing=this.enableColorMorphing,N}serialize(){const N={};N.id=this.uniqueId,N.targets=[];for(const q of this._targets)N.targets.push(q.serialize());return N}_syncActiveTargets(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const q=!!this._targetStoreTexture,C=this.isUsingTextureForTargets;(this._mustSynchronize||q!==C)&&(this._mustSynchronize=!1,this.synchronize());let d=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let U=-1;for(const W of this._targets)if(U++,0!==W.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=P.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(W),this._morphTargetTextureIndices[d]=U,this._tempInfluences[d++]=W.influence}this._morphTargetTextureIndices.length!==d&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,d)),this._influences&&this._influences.length===d||(this._influences=new Float32Array(d));for(let W=0;W<d;W++)this._influences[W]=this._tempInfluences[W];if(N&&this._scene)for(const W of this._scene.meshes)W.morphTargetManager===this&&(C?W._markSubMeshesAsAttributesDirty():W._syncGeometryWithMorphTargetManager())}synchronize(){var N;if(!this._scene||this.areUpdatesFrozen)return;const q=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(N=this._targetStoreTexture)||void 0===N||N.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>q.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const C of this._targets){this._supportsPositions=this._supportsPositions&&C.hasPositions,this._supportsNormals=this._supportsNormals&&C.hasNormals,this._supportsTangents=this._supportsTangents&&C.hasTangents,this._supportsUVs=this._supportsUVs&&C.hasUVs,this._supportsUV2s=this._supportsUV2s&&C.hasUV2s,this._supportsColors=this._supportsColors&&C.hasColors;const N=C.vertexCount;if(0===this._vertexCount)this._vertexCount=N;else if(this._vertexCount!==N)return void Q.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${C.name}": ${N}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const N=q.getCaps().maxTextureSize;this._textureWidth>N&&(this._textureHeight=Math.ceil(this._textureWidth/N),this._textureWidth=N);const C=this._targets.length,d=new Float32Array(C*this._textureWidth*this._textureHeight*4);let U=0;for(let q=0;q<C;q++){const N=this._targets[q],C=N.getPositions(),W=N.getNormals(),a=N.getUVs(),F=N.getTangents(),w=N.getUV2s(),A=N.getColors();U=q*this._textureWidth*this._textureHeight*4;for(let q=0;q<this._vertexCount;q++)this._supportsPositions&&C&&(d[U]=C[3*q],d[U+1]=C[3*q+1],d[U+2]=C[3*q+2],U+=4),this._supportsNormals&&W&&(d[U]=W[3*q],d[U+1]=W[3*q+1],d[U+2]=W[3*q+2],U+=4),this._supportsUVs&&a&&(d[U]=a[2*q],d[U+1]=a[2*q+1],U+=4),this._supportsTangents&&F&&(d[U]=F[3*q],d[U+1]=F[3*q+1],d[U+2]=F[3*q+2],U+=4),this._supportsUV2s&&w&&(d[U]=w[2*q],d[U+1]=w[2*q+1],U+=4),this._supportsColors&&A&&(d[U]=A[4*q],d[U+1]=A[4*q+1],d[U+2]=A[4*q+2],d[U+3]=A[4*q+3],U+=4)}this._targetStoreTexture=X.d.CreateRGBATexture(d,this._textureWidth,this._textureHeight,C,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const C of this._scene.meshes)C.morphTargetManager===this&&C._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const N=this._parentContainer.morphTargetManagers.indexOf(this);N>-1&&this._parentContainer.morphTargetManagers.splice(N,1),this._parentContainer=null}for(const N of this._targets)this._scene.stopAnimation(N)}}static Parse(N,q){const C=new P(q);for(const d of N.targets)C.addTarget(p.d.Parse(d,q));return C}}P.EnableTextureStorage=!0,P.MaxActiveMorphTargetsInVertexAttributeMode=8,P.ConstantTargetCountForTextureMode=0;var M=C(12768),Y=C(11e3),E=C(11465);const H=new Map,e=H;function b(N,q,C){o(N)&&Q.c.Warn(`Extension with the name '${N}' already exists`),H.set(N,{isGLTFExtension:q,factory:C})}function o(N){return H.delete(N)}var S=C(12779),D=C(11715),c=C(11210);class L{static Get(N,q,C){if(!q||void 0==C||!q[C])throw new Error(`${N}: Failed to find index (${C})`);return q[C]}static TryGet(N,q){return N&&void 0!=q&&N[q]?N[q]:null}static Assign(N){if(N)for(let q=0;q<N.length;q++)N[q].index=q}}function G(N){if(N.min&&N.max){const q=N.min,C=N.max,d=U.TmpVectors.Jq[0].hd(q[0],q[1],q[2]),W=U.TmpVectors.Jq[1].hd(C[0],C[1],C[2]);if(N.normalized&&5126!==N.componentType){let q=1;switch(N.componentType){case 5120:q=127;break;case 5121:q=255;break;case 5122:q=32767;break;case 5123:q=65535}const C=1/q;d.scaleInPlace(C),W.scaleInPlace(C)}return new E.c(d,W)}return null}class h{static RegisterExtension(N,q){b(N,!1,q)}static UnregisterExtension(N){return o(N)}get vd(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(N){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=N}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((N=>N.dispose&&N.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(N,q,C,d,U,W){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=q,this._assetContainer=C,this._loadData(d);let W=null;if(N){const q={};if(this._gltf.nodes)for(const N of this._gltf.nodes)N.name&&(q[N.name]=N.index);W=(N instanceof Array?N:[N]).map((N=>{const C=q[N];if(void 0===C)throw new Error(`Failed to find node '${N}'`);return C}))}return await this._loadAsync(U,a,W,(()=>({meshes:this._getMeshes(),Bt:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=N,this._loadData(q),await this._loadAsync(C,U,null,(()=>{}))}async _loadAsync(N,q,C,d){return await Promise.resolve().then((async()=>{this._rootUrl=N,this._uniqueRootUrl=!N.startsWith("file:")&&q?N:`${N}${Date.now()}/`,this._fileName=q,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const U=`${M.m[M.m.LOADING]} => ${M.m[M.m.READY]}`,W=`${M.m[M.m.LOADING]} => ${M.m[M.m.COMPLETE]}`;this._parent._startPerformanceCounter(U),this._parent._startPerformanceCounter(W),this._parent._setState(M.m.LOADING),this._extensionsOnLoading();const F=new Array;if(!this.parent.loadOnlyMaterials)if(C)F.push(this.loadSceneAsync("/nodes",{nodes:C,index:-1}));else if(void 0!=this._gltf.vq||this._gltf.scenes&&this._gltf.scenes[0]){const N=L.Get("/scene",this._gltf.scenes,this._gltf.vq||0);F.push(this.loadSceneAsync(`/scenes/${N.index}`,N))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let N=0;N<this._gltf.materials.length;++N){const q=this._gltf.materials[N],C="/materials/"+N,d=O.d.TriangleFillMode;F.push(this._loadMaterialAsync(C,q,null,d,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&F.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&F.push(this._compileShadowGeneratorsAsync());const w=Promise.all(F).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.bF(!0);for(const N of this._babylonScene.materials){const q=N;void 0!==q.maxSimultaneousLights&&(q.maxSimultaneousLights=Math.max(q.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(M.m.READY),this._skipStartAnimationStep||this._startAnimations(),d()}));return await w.then((N=>(this._parent._endPerformanceCounter(U),a.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(W),this._parent._setState(M.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(N=>{this._parent.onErrorObservable.notifyObservers(N),this._parent.onErrorObservable.clear(),this.dispose()}))})),N)))})).catch((N=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(N),this._parent.onErrorObservable.clear(),this.dispose()),N}))}_loadData(N){if(this._gltf=N.json,this._setupData(),N.bin){const q=this._gltf.buffers;if(q&&q[0]&&!q[0].uri){const C=q[0];(C.byteLength<N.bin.byteLength-3||C.byteLength>N.bin.byteLength)&&Q.c.Warn(`Binary buffer length (${C.byteLength}) from JSON does not match chunk length (${N.bin.byteLength})`),this._bin=N.bin}else Q.c.Warn("Unexpected BIN chunk")}}_setupData(){if(L.Assign(this._gltf.accessors),L.Assign(this._gltf.animations),L.Assign(this._gltf.buffers),L.Assign(this._gltf.bufferViews),L.Assign(this._gltf.cameras),L.Assign(this._gltf.images),L.Assign(this._gltf.materials),L.Assign(this._gltf.meshes),L.Assign(this._gltf.nodes),L.Assign(this._gltf.samplers),L.Assign(this._gltf.scenes),L.Assign(this._gltf.skins),L.Assign(this._gltf.textures),this._gltf.nodes){const N={};for(const C of this._gltf.nodes)if(C.children)for(const q of C.children)N[q]=C.index;const q=this._createRootNode();for(const C of this._gltf.nodes){const d=N[C.index];C.parent=void 0===d?q:this._gltf.nodes[d]}}}async _loadExtensionsAsync(){const N=[];if(e.forEach(((q,C)=>{var d;!1===(null===(d=this.parent.extensionOptions[C])||void 0===d?void 0:d.enabled)?q.isGLTFExtension&&this.isExtensionUsed(C)&&Q.c.Warn(`Extension ${C} is used but has been explicitly disabled.`):q.isGLTFExtension&&!this.isExtensionUsed(C)||N.push((async()=>{const N=await q.factory(this);return N.name!==C&&Q.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${N.name} !== ${C}`),this._parent.onExtensionLoadedObservable.notifyObservers(N),N})())})),this._extensions.push(...await Promise.all(N)),this._extensions.sort(((N,q)=>(N.order||Number.MAX_VALUE)-(q.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const C of this._gltf.extensionsRequired){if(!this._extensions.some((N=>N.name===C&&N.enabled))){var q;if(!1===(null===(q=this.parent.extensionOptions[C])||void 0===q?void 0:q.enabled))throw new Error(`Required extension ${C} is disabled`);throw new Error(`Required extension ${C} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new z.b("__root__",this._babylonScene);this._rootBabylonMesh=N,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.bF(!1);const q={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case M.k.AUTO:this._babylonScene.useRightHandedSystem||(q.rotation=[0,1,0,0],q.scale=[1,1,-1],h._LoadTransform(q,this._rootBabylonMesh));break;case M.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(N),q}loadSceneAsync(N,q){const C=this._extensionsLoadSceneAsync(N,q);if(C)return C;const d=new Array;if(this.logOpen(`${N} ${q.name||""}`),q.nodes)for(const U of q.nodes){const q=L.Get(`${N}/nodes/${U}`,this._gltf.nodes,U);d.push(this.loadNodeAsync(`/nodes/${q.index}`,q,(N=>{N.parent=this._rootBabylonMesh})))}for(const U of this._postSceneLoadActions)U();return d.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(d).then((()=>{}))}_forEachPrimitive(N,q){if(N._primitiveBabylonMeshes)for(const C of N._primitiveBabylonMeshes)q(C)}_getGeometries(){const N=[],q=this._gltf.nodes;if(q)for(const C of q)this._forEachPrimitive(C,(q=>{const C=q.ed;C&&-1===N.indexOf(C)&&N.push(C)}));return N}_getMeshes(){const N=[];this._rootBabylonMesh instanceof T.d&&N.push(this._rootBabylonMesh);const q=this._gltf.nodes;if(q)for(const C of q)this._forEachPrimitive(C,(q=>{N.push(q)}));return N}_getTransformNodes(){const N=[],q=this._gltf.nodes;if(q)for(const C of q)C._babylonTransformNode&&"SJ"===C._babylonTransformNode.getClassName()&&N.push(C._babylonTransformNode),C._babylonTransformNodeForSkin&&N.push(C._babylonTransformNodeForSkin);return N}_getSkeletons(){const N=[],q=this._gltf.skins;if(q)for(const C of q)C._data&&N.push(C._data.babylonSkeleton);return N}_getAnimationGroups(){const N=[],q=this._gltf.animations;if(q)for(const C of q)C._babylonAnimationGroup&&N.push(C._babylonAnimationGroup);return N}_startAnimations(){switch(this._parent.animationStartMode){case M.g.NONE:break;case M.g.FIRST:{const N=this._getAnimationGroups();0!==N.length&&N[0].start(!0);break}case M.g.ALL:{const N=this._getAnimationGroups();for(const q of N)q.start(!0);break}default:return void Q.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadNodeAsync(N,q,C);if(d)return d;if(q._babylonTransformNode)throw new Error(`${N}: Invalid recursive node hierarchy`);const U=new Array;this.logOpen(`${N} ${q.name||""}`);const W=d=>{if(h.AddPointerMetadata(d,N),h._LoadTransform(q,d),void 0!=q.camera){const C=L.Get(`${N}/camera`,this._gltf.cameras,q.camera);U.push(this.loadCameraAsync(`/cameras/${C.index}`,C,(N=>{N.parent=d,this._babylonScene.useRightHandedSystem||(d.yd.x=-1)})))}if(q.children)for(const C of q.children){const q=L.Get(`${N}/children/${C}`,this._gltf.nodes,C);U.push(this.loadNodeAsync(`/nodes/${q.index}`,q,(N=>{N.parent=d})))}C(d)},a=void 0!=q.mesh,F=this._parent.loadSkins&&void 0!=q.skin;if(!a||F){const N=q.name||`node${q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new I.b(N,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==q.mesh?q._babylonTransformNode=C:q._babylonTransformNodeForSkin=C,W(C)}if(a)if(F){const C=L.Get(`${N}/mesh`,this._gltf.meshes,q.mesh);U.push(this._loadMeshAsync(`/meshes/${C.index}`,q,C,(C=>{const d=q._babylonTransformNodeForSkin;C.metadata=(0,D.d)(d.metadata,C.metadata||{});const W=L.Get(`${N}/skin`,this._gltf.skins,q.skin);U.push(this._loadSkinAsync(`/skins/${W.index}`,q,W,(N=>{this._forEachPrimitive(q,(q=>{q.skeleton=N})),this._postSceneLoadActions.push((()=>{if(void 0!=W.skeleton){const N=L.Get(`/skins/${W.index}/skeleton`,this._gltf.nodes,W.skeleton).parent;q.index===N.index?C.parent=d.parent:C.parent=N._babylonTransformNode}else C.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:d,skinnedNode:C})}))})))})))}else{const C=L.Get(`${N}/mesh`,this._gltf.meshes,q.mesh);U.push(this._loadMeshAsync(`/meshes/${C.index}`,q,C,W))}return this.logClose(),Promise.all(U).then((()=>(this._forEachPrimitive(q,(N=>{const q=N;!q.isAnInstance&&q.ed&&q.ed.useBoundingInfoFromGeometry?N.EN():N.refreshBoundingInfo(!0,!0)})),q._babylonTransformNode)))}_loadMeshAsync(N,q,C,d){const U=C.primitives;if(!U||!U.length)throw new Error(`${N}: Primitives are missing`);void 0==U[0].index&&L.Assign(U);const W=new Array;this.logOpen(`${N} ${C.name||""}`);const a=q.name||`node${q.index}`;if(1===U.length){const d=C.primitives[0];W.push(this._loadMeshPrimitiveAsync(`${N}/primitives/${d.index}`,a,q,C,d,(N=>{q._babylonTransformNode=N,q._primitiveBabylonMeshes=[N]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,q._babylonTransformNode=new I.b(a,this._babylonScene),q._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q._primitiveBabylonMeshes=[];for(const d of U)W.push(this._loadMeshPrimitiveAsync(`${N}/primitives/${d.index}`,`${a}_primitive${d.index}`,q,C,d,(N=>{N.parent=q._babylonTransformNode,q._primitiveBabylonMeshes.push(N)})))}return d(q._babylonTransformNode),this.logClose(),Promise.all(W).then((()=>q._babylonTransformNode))}_loadMeshPrimitiveAsync(N,q,C,d,U,W){const a=this._extensionsLoadMeshPrimitiveAsync(N,q,C,d,U,W);if(a)return a;this.logOpen(`${N}`);const F=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==C.skin&&!d.primitives[0].targets;let w,A;if(F&&U._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,w=U._instanceData.babylonSourceMesh.createInstance(q),w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A=U._instanceData.promise;else{const W=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new z.b(q,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.sideOrientation=this._babylonScene.useRightHandedSystem?O.d.CounterClockWiseSideOrientation:O.d.ClockWiseSideOrientation,this._createMorphTargets(N,C,d,U,a),W.push(this._loadVertexDataAsync(N,U,a).then((async q=>await this._loadMorphTargetsAsync(N,U,a,q).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,q.MN(a),q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const n=h._GetDrawMode(N,U.mode);if(void 0==U.material){let N=this._defaultBabylonMaterialData[n];N||(N=this._createDefaultMaterial("__GLTFLoader._default",n),this._parent.onMaterialLoadedObservable.notifyObservers(N),this._defaultBabylonMaterialData[n]=N),a.material=N}else if(!this.parent.skipMaterials){const q=L.Get(`${N}/material`,this._gltf.materials,U.material);W.push(this._loadMaterialAsync(`/materials/${q.index}`,q,a,n,(N=>{a.material=N})))}A=Promise.all(W),F&&(U._instanceData={babylonSourceMesh:a,promise:A}),w=a}return h.AddPointerMetadata(w,N),this._parent.onMeshLoadedObservable.notifyObservers(w),W(w),this.logClose(),A.then((()=>w))}_loadVertexDataAsync(N,q,C){const d=this._extensionsLoadVertexDataAsync(N,q,C);if(d)return d;const U=q.attributes;if(!U)throw new Error(`${N}: Attributes are missing`);const W=new Array,a=new l.d(C.name,this._babylonScene);if(void 0==q.indices)C.isUnIndexed=!0;else{const C=L.Get(`${N}/indices`,this._gltf.accessors,q.indices);W.push(this._loadIndicesAccessorAsync(`/accessors/${C.index}`,C).then((N=>{a.setIndices(N)})))}const F=(q,d,F)=>{if(void 0==U[q])return;C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(d)&&C._delayInfo.push(d);const w=L.Get(`${N}/attributes/${q}`,this._gltf.accessors,U[q]);W.push(this._loadVertexAccessorAsync(`/accessors/${w.index}`,w,d).then((N=>{if(N.getKind()===j.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!C.skeleton){const N=G(w);N&&(a._boundingInfo=N,a.useBoundingInfoFromGeometry=!0)}a.setVerticesBuffer(N,w.count)}))),d==j.g.MatricesIndicesExtraKind&&(C.numBoneInfluencers=8),F&&F(w)};return F("POSITION",j.g.PositionKind),F("NORMAL",j.g.NormalKind),F("TANGENT",j.g.TangentKind),F("TEXCOORD_0",j.g.UVKind),F("TEXCOORD_1",j.g.UV2Kind),F("TEXCOORD_2",j.g.UV3Kind),F("TEXCOORD_3",j.g.UV4Kind),F("TEXCOORD_4",j.g.UV5Kind),F("TEXCOORD_5",j.g.UV6Kind),F("JOINTS_0",j.g.MatricesIndicesKind),F("WEIGHTS_0",j.g.MatricesWeightsKind),F("JOINTS_1",j.g.MatricesIndicesExtraKind),F("WEIGHTS_1",j.g.MatricesWeightsExtraKind),F("COLOR_0",j.g.ColorKind,(N=>{"VEC4"===N.type&&(C.hasVertexAlpha=!0)})),Promise.all(W).then((()=>a))}_createMorphTargets(N,q,C,d,U){if(!d.targets||!this._parent.loadMorphTargets)return;if(void 0==q._numMorphTargets)q._numMorphTargets=d.targets.length;else if(d.targets.length!==q._numMorphTargets)throw new Error(`${N}: Primitives do not have the same number of targets`);const W=C.extras?C.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,U.morphTargetManager=new P(this._babylonScene),U.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.morphTargetManager.areUpdatesFrozen=!0;for(let a=0;a<d.targets.length;a++){const N=q.weights?q.weights[a]:C.weights?C.weights[a]:0,d=W?W[a]:`morphTarget${a}`;U.morphTargetManager.addTarget(new p.d(d,N,U.lN()))}}_loadMorphTargetsAsync(N,q,C,d){if(!q.targets||!this._parent.loadMorphTargets)return Promise.resolve();const U=new Array,W=C.morphTargetManager;for(let a=0;a<W.numTargets;a++){const C=W.getTarget(a);U.push(this._loadMorphTargetVertexDataAsync(`${N}/targets/${a}`,d,q.targets[a],C))}return Promise.all(U).then((()=>{W.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(N,q,C,d){const U=new Array,W=(d,W,a)=>{if(void 0==C[d])return;const F=q.getVertexBuffer(W);if(!F)return;const w=L.Get(`${N}/${d}`,this._gltf.accessors,C[d]);U.push(this._loadFloatAccessorAsync(`/accessors/${w.index}`,w).then((N=>{a(F,N)})))};return W("POSITION",j.g.PositionKind,((N,q)=>{const C=new Float32Array(q.length);N.forEach(q.length,((N,d)=>{C[d]=q[d]+N})),d.setPositions(C)})),W("NORMAL",j.g.NormalKind,((N,q)=>{const C=new Float32Array(q.length);N.forEach(C.length,((N,d)=>{C[d]=q[d]+N})),d.setNormals(C)})),W("TANGENT",j.g.TangentKind,((N,q)=>{const C=new Float32Array(q.length/3*4);let U=0;N.forEach(q.length/3*4,((N,d)=>{(d+1)%4!==0&&(C[U]=q[U]+N,U++)})),d.setTangents(C)})),W("TEXCOORD_0",j.g.UVKind,((N,q)=>{const C=new Float32Array(q.length);N.forEach(q.length,((N,d)=>{C[d]=q[d]+N})),d.setUVs(C)})),W("TEXCOORD_1",j.g.UV2Kind,((N,q)=>{const C=new Float32Array(q.length);N.forEach(q.length,((N,d)=>{C[d]=q[d]+N})),d.setUV2s(C)})),W("COLOR_0",j.g.ColorKind,((q,C)=>{let U=null;const W=q.getSize();if(3===W){U=new Float32Array(C.length/3*4),q.forEach(C.length,((N,q)=>{const d=Math.floor(q/3),W=q%3;U[4*d+W]=C[3*d+W]+N}));for(let N=0;N<C.length/3;++N)U[4*N+3]=1}else{if(4!==W)throw new Error(`${N}: Invalid number of components (${W}) for COLOR_0 attribute`);U=new Float32Array(C.length),q.forEach(C.length,((N,q)=>{U[q]=C[q]+N}))}d.setColors(U)})),await Promise.all(U).then((()=>{}))}static _LoadTransform(N,q){if(void 0!=N.skin)return;let C=U.Jq.Zero(),d=U.Quaternion.Identity(),W=U.Jq.One();if(N.matrix){U.Matrix.Kq(N.matrix).decompose(W,d,C)}else N.translation&&(C=U.Jq.Kq(N.translation)),N.rotation&&(d=U.Quaternion.Kq(N.rotation)),N.scale&&(W=U.Jq.Kq(N.scale));q.position=C,q.rotationQuaternion=d,q.yd=W}_loadSkinAsync(N,q,C,d){if(!this._parent.loadSkins)return Promise.resolve();const U=this._extensionsLoadSkinAsync(N,q,C);if(U)return U;if(C._data)return d(C._data.babylonSkeleton),C._data.promise;const W=`skeleton${C.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new r(C.name||W,W,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(N,C,a);const F=this._loadSkinInverseBindMatricesDataAsync(N,C).then((N=>{this._updateBoneMatrices(a,N)}));return C._data={babylonSkeleton:a,promise:F},d(a),F}_loadBones(N,q,C){if(void 0==q.skeleton||this._parent.alwaysComputeSkeletonRootNode){const C=this._findSkeletonRootNode(`${N}/joints`,q.joints);if(C)if(void 0===q.skeleton)q.skeleton=C.index;else{const d=(N,q)=>{for(;q.parent;q=q.parent)if(q.parent===N)return!0;return!1},U=L.Get(`${N}/skeleton`,this._gltf.nodes,q.skeleton);U===C||d(U,C)||(Q.c.Warn(`${N}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),q.skeleton=C.index)}else Q.c.Warn(`${N}: Failed to find common root`)}const d={};for(const U of q.joints){const W=L.Get(`${N}/joints/${U}`,this._gltf.nodes,U);this._loadBone(W,q,C,d)}}_findSkeletonRootNode(N,q){if(0===q.length)return null;const C={};for(const U of q){const q=[];let d=L.Get(`${N}/${U}`,this._gltf.nodes,U);for(;-1!==d.index;)q.unshift(d),d=d.parent;C[U]=q}let d=null;for(let U=0;;++U){let N=C[q[0]];if(U>=N.length)return d;const W=N[U];for(let a=1;a<q.length;++a)if(N=C[q[a]],U>=N.length||W!==N[U])return d;d=W}}_loadBone(N,q,C,d){N._isJoint=!0;let U=d[N.index];if(U)return U;let W=null;N.index!==q.skeleton&&(N.parent&&-1!==N.parent.index?W=this._loadBone(N.parent,q,C,d):void 0!==q.skeleton&&Q.c.Warn(`/skins/${q.index}/skeleton: Skeleton node is not a common root`));const a=q.joints.indexOf(N.index);return U=new A.d(N.name||`joint${N.index}`,C,W,this._getNodeMatrix(N),null,null,a),d[N.index]=U,this._postSceneLoadActions.push((()=>{U.linkTransformNode(N._babylonTransformNode)})),U}_loadSkinInverseBindMatricesDataAsync(N,q){if(void 0==q.inverseBindMatrices)return Promise.resolve(null);const C=L.Get(`${N}/inverseBindMatrices`,this._gltf.accessors,q.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${C.index}`,C)}_updateBoneMatrices(N,q){for(const C of N.bones){const N=U.Matrix.Identity(),d=C._index;q&&-1!==d&&(U.Matrix.FromArrayToRef(q,16*d,N),N.invertToRef(N));const W=C.getParent();W&&N.multiplyToRef(W.getAbsoluteInverseBindMatrix(),N),C.Yd(N,!1,!1),C._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(N){return N.matrix?U.Matrix.Kq(N.matrix):U.Matrix.Compose(N.scale?U.Jq.Kq(N.scale):U.Jq.One(),N.rotation?U.Quaternion.Kq(N.rotation):U.Quaternion.Identity(),N.translation?U.Jq.Kq(N.translation):U.Jq.Zero())}loadCameraAsync(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadCameraAsync(N,q,C);if(d)return d;const W=new Array;this.logOpen(`${N} ${q.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new w.c(q.name||`camera${q.index}`,U.Jq.Zero(),this._babylonScene,!1);switch(a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q._babylonCamera=a,a.setTarget(new U.Jq(0,0,-1)),q.type){case"perspective":{const C=q.perspective;if(!C)throw new Error(`${N}: Camera perspective properties are missing`);a.fov=C.yfov,a.sd=C.znear,a.maxZ=C.zfar||0;break}case"orthographic":if(!q.orthographic)throw new Error(`${N}: Camera orthographic properties are missing`);a.mode=F.b.ORTHOGRAPHIC_CAMERA,a.orthoLeft=-q.orthographic.xmag,a.orthoRight=q.orthographic.xmag,a.orthoBottom=-q.orthographic.ymag,a.orthoTop=q.orthographic.ymag,a.sd=q.orthographic.znear,a.maxZ=q.orthographic.zfar;break;default:throw new Error(`${N}: Invalid camera type (${q.type})`)}return h.AddPointerMetadata(a,N),this._parent.onCameraLoadedObservable.notifyObservers(a),C(a),this.logClose(),Promise.all(W).then((()=>a))}_loadAnimationsAsync(){const N=this._gltf.animations;if(!N)return Promise.resolve();const q=new Array;for(let C=0;C<N.length;C++){const d=N[C];q.push(this.loadAnimationAsync(`/animations/${d.index}`,d).then((N=>{0===N.targetedAnimations.length&&N.dispose()})))}return Promise.all(q).then((()=>{}))}loadAnimationAsync(N,q){const d=this._extensionsLoadAnimationAsync(N,q);return d||C.e(78).then(C.bind(C,14264)).then((C=>{let{AnimationGroup:d}=C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new d(q.name||`animation${q.index}`,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q._babylonAnimationGroup=U;const W=new Array;L.Assign(q.channels),L.Assign(q.samplers);for(const a of q.channels)W.push(this._loadAnimationChannelAsync(`${N}/channels/${a.index}`,N,q,a,((N,q)=>{N.animations=N.animations||[],N.animations.push(q),U.addTargetedAnimation(q,N)})));return Promise.all(W).then((()=>(U.normalize(0),U)))}))}async _loadAnimationChannelAsync(N,q,d,U,W){const a=this._extensionsLoadAnimationChannelAsync(N,q,d,U,W);if(a)return await a;if(void 0==U.target.node)return await Promise.resolve();const F=L.Get(`${N}/target/node`,this._gltf.nodes,U.target.node),w=U.target.path,A="weights"===w;if(A&&!F._numMorphTargets||!A&&!F._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!A&&!F._isJoint)return await Promise.resolve();let n;switch(await Promise.resolve().then(C.bind(C,12789)),w){case"translation":var t;n=null===(t=(0,S.f)("/nodes/{}/translation"))||void 0===t?void 0:t.interpolation;break;case"rotation":var V;n=null===(V=(0,S.f)("/nodes/{}/rotation"))||void 0===V?void 0:V.interpolation;break;case"scale":var Z;n=null===(Z=(0,S.f)("/nodes/{}/scale"))||void 0===Z?void 0:Z.interpolation;break;case"weights":var J;n=null===(J=(0,S.f)("/nodes/{}/weights"))||void 0===J?void 0:J.interpolation;break;default:throw new Error(`${N}/target/path: Invalid value (${U.target.path})`)}if(!n)throw new Error(`${N}/target/path: Could not find interpolation properties for target path (${U.target.path})`);const Q={object:F,info:n};return await this._loadAnimationChannelFromTargetInfoAsync(N,q,d,U,Q,W)}_loadAnimationChannelFromTargetInfoAsync(N,q,C,d,U,W){const a=this.parent.targetFps,F=1/a,w=L.Get(`${N}/sampler`,C.samplers,d.sampler);return this._loadAnimationSamplerAsync(`${q}/samplers/${d.sampler}`,w).then((N=>{let q=0;const w=U.object,A=U.info;for(const U of A){const A=U.getStride(w),n=N.input,t=N.output,V=new Array(n.length);let Z=0;switch(N.interpolation){case"STEP":for(let N=0;N<n.length;N++){const q=U.getValue(w,t,Z,1);Z+=A,V[N]={frame:n[N]*a,value:q,interpolation:1}}break;case"CUBICSPLINE":for(let N=0;N<n.length;N++){const q=U.getValue(w,t,Z,F);Z+=A;const C=U.getValue(w,t,Z,1);Z+=A;const d=U.getValue(w,t,Z,F);Z+=A,V[N]={frame:n[N]*a,inTangent:q,value:C,outTangent:d}}break;case"LINEAR":for(let N=0;N<n.length;N++){const q=U.getValue(w,t,Z,1);Z+=A,V[N]={frame:n[N]*a,value:q}}}if(Z>0){const N=`${C.name||`animation${C.index}`}_channel${d.index}_${q}`,F=U.buildAnimations(w,N,a,V);for(const C of F)q++,W(C.babylonAnimatable,C.babylonAnimation)}}}))}_loadAnimationSamplerAsync(N,q){if(q._data)return q._data;const C=q.interpolation||"LINEAR";switch(C){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${N}/interpolation: Invalid value (${q.interpolation})`)}const d=L.Get(`${N}/input`,this._gltf.accessors,q.input),U=L.Get(`${N}/output`,this._gltf.accessors,q.output);return q._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${d.index}`,d),this._loadFloatAccessorAsync(`/accessors/${U.index}`,U)]).then((N=>{let[q,d]=N;return{input:q,interpolation:C,output:d}})),q._data}loadBufferAsync(N,q,C,d){const U=this._extensionsLoadBufferAsync(N,q,C,d);if(U)return U;if(!q._data)if(q.uri)q._data=this.loadUriAsync(`${N}/uri`,q,q.uri);else{if(!this._bin)throw new Error(`${N}: Uri is missing or the binary glTF is missing its binary chunk`);q._data=this._bin.readAsync(0,q.byteLength)}return q._data.then((q=>{try{return new Uint8Array(q.buffer,q.byteOffset+C,d)}catch(U){throw new Error(`${N}: ${U.message}`)}}))}loadBufferViewAsync(N,q){const C=this._extensionsLoadBufferViewAsync(N,q);if(C)return C;if(q._data)return q._data;const d=L.Get(`${N}/buffer`,this._gltf.buffers,q.buffer);return q._data=this.loadBufferAsync(`/buffers/${d.index}`,d,q.byteOffset||0,q.byteLength),q._data}_loadAccessorAsync(N,q,C){if(q._data)return q._data;const d=h._GetNumComponents(N,q.type),U=d*j.g.GetTypeByteLength(q.componentType),W=d*q.count;if(void 0==q.bufferView)q._data=Promise.resolve(new C(W));else{const a=L.Get(`${N}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then((F=>{if(5126!==q.componentType||q.normalized||a.byteStride&&a.byteStride!==U){const N=new C(W);return j.g.ForEach(F,q.byteOffset||0,a.byteStride||U,d,q.componentType,N.length,q.normalized||!1,((q,C)=>{N[C]=q})),N}return h._GetTypedArray(N,q.componentType,F,q.byteOffset,W)}))}if(q.sparse){const W=q.sparse;q._data=q._data.then((a=>{const F=a,w=L.Get(`${N}/sparse/indices/bufferView`,this._gltf.bufferViews,W.indices.bufferView),A=L.Get(`${N}/sparse/values/bufferView`,this._gltf.bufferViews,W.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${w.index}`,w),this.loadBufferViewAsync(`/bufferViews/${A.index}`,A)]).then((a=>{let[w,A]=a;const n=h._GetTypedArray(`${N}/sparse/indices`,W.indices.componentType,w,W.indices.byteOffset,W.count),t=d*W.count;let V;if(5126!==q.componentType||q.normalized){const a=h._GetTypedArray(`${N}/sparse/values`,q.componentType,A,W.values.byteOffset,t);V=new C(t),j.g.ForEach(a,0,U,d,q.componentType,V.length,q.normalized||!1,((N,q)=>{V[q]=N}))}else V=h._GetTypedArray(`${N}/sparse/values`,q.componentType,A,W.values.byteOffset,t);let Z=0;for(let N=0;N<n.length;N++){let q=n[N]*d;for(let N=0;N<d;N++)F[q++]=V[Z++]}return F}))}))}return q._data}_loadFloatAccessorAsync(N,q){return this._loadAccessorAsync(N,q,Float32Array)}_loadIndicesAccessorAsync(N,q){if("SCALAR"!==q.type)throw new Error(`${N}/type: Invalid value ${q.type}`);if(5121!==q.componentType&&5123!==q.componentType&&5125!==q.componentType)throw new Error(`${N}/componentType: Invalid value ${q.componentType}`);if(q._data)return q._data;if(q.sparse){const C=h._GetTypedArrayConstructor(`${N}/componentType`,q.componentType);q._data=this._loadAccessorAsync(N,q,C)}else{const C=L.Get(`${N}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((C=>h._GetTypedArray(N,q.componentType,C,q.byteOffset,q.count)))}return q._data}_loadVertexBufferViewAsync(N){if(N._babylonBuffer)return N._babylonBuffer;const q=this._babylonScene.getEngine();return N._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N).then((N=>new j.c(q,N,!1))),N._babylonBuffer}_loadVertexAccessorAsync(N,q,C){var d;if(null!==(d=q._babylonVertexBuffer)&&void 0!==d&&d[C])return q._babylonVertexBuffer[C];q._babylonVertexBuffer||(q._babylonVertexBuffer={});const U=this._babylonScene.getEngine();if(q.sparse||void 0==q.bufferView)q._babylonVertexBuffer[C]=this._loadFloatAccessorAsync(N,q).then((N=>new j.g(U,N,C,!1)));else{const d=L.Get(`${N}/bufferView`,this._gltf.bufferViews,q.bufferView);q._babylonVertexBuffer[C]=this._loadVertexBufferViewAsync(d).then((W=>{const a=h._GetNumComponents(N,q.type);return new j.g(U,W,C,!1,void 0,d.byteStride,void 0,q.byteOffset,a,q.componentType,q.normalized,!0,void 0,!0)}))}return q._babylonVertexBuffer[C]}_loadMaterialMetallicRoughnessPropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const d=new Array;return q&&(q.baseColorFactor?(C.albedoColor=W.Oq.Kq(q.baseColorFactor),C.alpha=q.baseColorFactor[3]):C.albedoColor=W.Oq.White(),C.metallic=void 0==q.metallicFactor?1:q.metallicFactor,C.roughness=void 0==q.roughnessFactor?1:q.roughnessFactor,q.baseColorTexture&&d.push(this.loadTextureInfoAsync(`${N}/baseColorTexture`,q.baseColorTexture,(N=>{N.name=`${C.name} (Base Color)`,C.albedoTexture=N}))),q.metallicRoughnessTexture&&(q.metallicRoughnessTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(`${N}/metallicRoughnessTexture`,q.metallicRoughnessTexture,(N=>{N.name=`${C.name} (Metallic Roughness)`,C.metallicTexture=N}))),C.useMetallnessFromMetallicTextureBlue=!0,C.useRoughnessFromMetallicTextureGreen=!0,C.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(d).then((()=>{}))}_loadMaterialAsync(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const W=this._extensionsLoadMaterialAsync(N,q,C,d,U);if(W)return W;q._data=q._data||{};let a=q._data[d];if(!a){this.logOpen(`${N} ${q.name||""}`);const C=this.createMaterial(N,q,d);a={babylonMaterial:C,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(N,q,C)},q._data[d]=a,h.AddPointerMetadata(C,N),this._parent.onMaterialLoadedObservable.notifyObservers(C),this.logClose()}return C&&(a.babylonMeshes.push(C),C.td.addOnce((()=>{const N=a.babylonMeshes.indexOf(C);-1!==N&&a.babylonMeshes.splice(N,1)}))),U(a.babylonMaterial),a.promise.then((()=>a.babylonMaterial))}_createDefaultMaterial(N,q){this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new K.c(N,this._babylonScene);return C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.fillMode=q,C.enableSpecularAntiAliasing=!0,C.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,C.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,C.transparencyMode=K.c.PBRMATERIAL_OPAQUE,C.metallic=1,C.roughness=1,C}createMaterial(N,q,C){const d=this._extensionsCreateMaterial(N,q,C);if(d)return d;const U=q.name||`material${q.index}`;return this._createDefaultMaterial(U,C)}loadMaterialPropertiesAsync(N,q,C){const d=this._extensionsLoadMaterialPropertiesAsync(N,q,C);if(d)return d;const U=new Array;return U.push(this.loadMaterialBasePropertiesAsync(N,q,C)),q.pbrMetallicRoughness&&U.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${N}/pbrMetallicRoughness`,q.pbrMetallicRoughness,C)),this.loadMaterialAlphaProperties(N,q,C),Promise.all(U).then((()=>{}))}loadMaterialBasePropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const d=new Array;return C.emissiveColor=q.emissiveFactor?W.Oq.Kq(q.emissiveFactor):new W.Oq(0,0,0),q.doubleSided&&(C.Ld=!1,C.twoSidedLighting=!0),q.normalTexture&&(q.normalTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(`${N}/normalTexture`,q.normalTexture,(N=>{N.name=`${C.name} (Normal)`,C.bumpTexture=N}))),C.invertNormalMapX=!this._babylonScene.useRightHandedSystem,C.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=q.normalTexture.scale&&C.bumpTexture&&(C.bumpTexture.level=q.normalTexture.scale),C.forceIrradianceInFragment=!0),q.occlusionTexture&&(q.occlusionTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(`${N}/occlusionTexture`,q.occlusionTexture,(N=>{N.name=`${C.name} (Occlusion)`,C.ambientTexture=N}))),C.useAmbientInGrayScale=!0,void 0!=q.occlusionTexture.strength&&(C.ambientTextureStrength=q.occlusionTexture.strength)),q.emissiveTexture&&d.push(this.loadTextureInfoAsync(`${N}/emissiveTexture`,q.emissiveTexture,(N=>{N.name=`${C.name} (Emissive)`,C.emissiveTexture=N}))),Promise.all(d).then((()=>{}))}loadMaterialAlphaProperties(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);switch(q.alphaMode||"OPAQUE"){case"OPAQUE":C.transparencyMode=K.c.PBRMATERIAL_OPAQUE,C.alpha=1;break;case"MASK":C.transparencyMode=K.c.PBRMATERIAL_ALPHATEST,C.alphaCutOff=void 0==q.alphaCutoff?.5:q.alphaCutoff,C.albedoTexture&&(C.albedoTexture.pd=!0);break;case"BLEND":C.transparencyMode=K.c.PBRMATERIAL_ALPHABLEND,C.albedoTexture&&(C.albedoTexture.pd=!0,C.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${N}/alphaMode: Invalid value (${q.alphaMode})`)}}loadTextureInfoAsync(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadTextureInfoAsync(N,q,C);if(d)return d;if(this.logOpen(`${N}`),q.texCoord>=6)throw new Error(`${N}/texCoord: Invalid value (${q.texCoord})`);const U=L.Get(`${N}/index`,this._gltf.textures,q.index);U._textureInfo=q;const W=this._loadTextureAsync(`/textures/${q.index}`,U,(d=>{d.coordinatesIndex=q.texCoord||0,h.AddPointerMetadata(d,N),this._parent.onTextureLoadedObservable.notifyObservers(d),C(d)}));return this.logClose(),W}_loadTextureAsync(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const d=this._extensionsLoadTextureAsync(N,q,C);if(d)return d;this.logOpen(`${N} ${q.name||""}`);const U=void 0==q.sampler?h.DefaultSampler:L.Get(`${N}/sampler`,this._gltf.samplers,q.sampler),W=L.Get(`${N}/source`,this._gltf.images,q.source),a=this._createTextureAsync(N,U,W,C,void 0,!q._textureInfo.nonColorData);return this.logClose(),a}_createTextureAsync(N,q,C){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},W=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;const F=this._loadSampler(`/samplers/${q.index}`,q),w=new Array,A=new d;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n={noMipmap:F.noMipMaps,invertY:!1,samplingMode:F.samplingMode,R:()=>{this._disposed||A.resolve()},onError:(q,C)=>{this._disposed||A.reject(new Error(`${N}: ${C&&C.message?C.message:q||"Failed to load texture"}`))},mimeType:C.mimeType??(0,Y.f)(C.uri??""),loaderOptions:W,useSRGBBuffer:!!a&&this._parent.useSRGBBuffers},t=new i.c(null,this._babylonScene,n);return t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.push(A.promise),w.push(this.loadImageAsync(`/images/${C.index}`,C).then((N=>{const q=C.uri||`${this._fileName}#image${C.index}`,d=`data:${this._uniqueRootUrl}${q}`;t.updateURL(d,N);const U=t.getInternalTexture();U&&(U.label=C.name)}))),t.wrapU=F.wrapU,t.wrapV=F.wrapV,U(t),this._parent.useGltfTextureNames&&(t.name=C.name||C.uri||`image${C.index}`),Promise.all(w).then((()=>t))}_loadSampler(N,q){return q._data||(q._data={noMipMaps:9728===q.minFilter||9729===q.minFilter,samplingMode:h._GetTextureSamplingMode(N,q),wrapU:h._GetTextureWrapMode(`${N}/wrapS`,q.wrapS),wrapV:h._GetTextureWrapMode(`${N}/wrapT`,q.wrapT)}),q._data}loadImageAsync(N,q){if(!q._data){if(this.logOpen(`${N} ${q.name||""}`),q.uri)q._data=this.loadUriAsync(`${N}/uri`,q,q.uri);else{const C=L.Get(`${N}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)}this.logClose()}return q._data}loadUriAsync(N,q,C){const d=this._extensionsLoadUriAsync(N,q,C);if(d)return d;if(!h._ValidateUri(C))throw new Error(`${N}: '${C}' is invalid`);if((0,Y.j)(C)){const q=new Uint8Array((0,Y.b)(C));return this.log(`${N}: Decoded ${C.substring(0,64)}... (${q.length} bytes)`),Promise.resolve(q)}return this.log(`${N}: Loading ${C}`),this._parent.preprocessUrlAsync(this._rootUrl+C).then((q=>new Promise(((d,U)=>{this._parent._loadFile(this._babylonScene,q,(q=>{this._disposed||(this.log(`${N}: Loaded ${C} (${q.byteLength} bytes)`),d(new Uint8Array(q)))}),!0,(q=>{U(new Y.m(`${N}: Failed to load '${C}'${q?": "+q.status+" "+q.statusText:""}`,q))}))}))))}static AddPointerMetadata(N,q){N.metadata=N.metadata||{};const C=N._internalMetadata=N._internalMetadata||{},d=C.vd=C.vd||{};(d.pointers=d.pointers||[]).push(q)}static _GetTextureWrapMode(N,q){switch(q=void 0==q?10497:q){case 33071:return i.c.CLAMP_ADDRESSMODE;case 33648:return i.c.MIRROR_ADDRESSMODE;case 10497:return i.c.WRAP_ADDRESSMODE;default:return Q.c.Warn(`${N}: Invalid value (${q})`),i.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(N,q){const C=void 0==q.magFilter?9729:q.magFilter,d=void 0==q.minFilter?9987:q.minFilter;if(9729===C)switch(d){case 9728:return i.c.LINEAR_NEAREST;case 9729:return i.c.LINEAR_LINEAR;case 9984:return i.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return i.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return i.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return i.c.LINEAR_LINEAR_MIPLINEAR;default:return Q.c.Warn(`${N}/minFilter: Invalid value (${d})`),i.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==C&&Q.c.Warn(`${N}/magFilter: Invalid value (${C})`),d){case 9728:return i.c.NEAREST_NEAREST;case 9729:return i.c.NEAREST_LINEAR;case 9984:return i.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return i.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return i.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return i.c.NEAREST_LINEAR_MIPLINEAR;default:return Q.c.Warn(`${N}/minFilter: Invalid value (${d})`),i.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(N,q){try{return(0,c.r)(q)}catch(C){throw new Error(`${N}: ${C.message}`)}}static _GetTypedArray(N,q,C,d,U){const W=C.buffer;d=C.byteOffset+(d||0);const a=h._GetTypedArrayConstructor(`${N}/componentType`,q),F=j.g.GetTypeByteLength(q);return d%F!==0?(Q.c.Warn(`${N}: Copying buffer as byte offset (${d}) is not a multiple of component type byte length (${F})`),new a(W.slice(d,d+U*F),0)):new a(W,d,U)}static _GetNumComponents(N,q){switch(q){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${N}: Invalid type (${q})`)}static _ValidateUri(N){return a.Tools.IsBase64(N)||-1===N.indexOf("..")}static _GetDrawMode(N,q){switch(void 0==q&&(q=4),q){case 0:return O.d.PointListDrawMode;case 1:return O.d.LineListDrawMode;case 2:return O.d.LineLoopDrawMode;case 3:return O.d.LineStripDrawMode;case 4:return O.d.TriangleFillMode;case 5:return O.d.TriangleStripDrawMode;case 6:return O.d.TriangleFanDrawMode}throw new Error(`${N}: Invalid mesh primitive mode (${q})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const N=new Array;if(this._gltf.materials)for(const q of this._gltf.materials)if(q._data)for(const C in q._data){const d=q._data[C];for(const q of d.babylonMeshes){q.Ed(!0);const C=d.babylonMaterial;N.push(C.forceCompilationAsync(q)),N.push(C.forceCompilationAsync(q,{useInstances:!0})),this._parent.useClipPlane&&(N.push(C.forceCompilationAsync(q,{clipPlane:!0})),N.push(C.forceCompilationAsync(q,{clipPlane:!0,useInstances:!0})))}}return Promise.all(N).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const N=new Array,q=this._babylonScene.lights;for(const C of q){const q=C.getShadowGenerator();q&&N.push(q.forceCompilationAsync())}return Promise.all(N).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(N){for(const q of this._extensions)q.enabled&&N(q)}_applyExtensions(N,q,C){for(const d of this._extensions)if(d.enabled){const U=`${d.name}.${q}`,W=N;W._activeLoaderExtensionFunctions=W._activeLoaderExtensionFunctions||{};const a=W._activeLoaderExtensionFunctions;if(!a[U]){a[U]=!0;try{const N=C(d);if(N)return N}finally{delete a[U]}}}return null}_extensionsOnLoading(){this._forEachExtensions((N=>N.onLoading&&N.onLoading()))}_extensionsOnReady(){this._forEachExtensions((N=>N.onReady&&N.onReady()))}_extensionsLoadSceneAsync(N,q){return this._applyExtensions(q,"loadScene",(C=>C.loadSceneAsync&&C.loadSceneAsync(N,q)))}_extensionsLoadNodeAsync(N,q,C){return this._applyExtensions(q,"loadNode",(d=>d.loadNodeAsync&&d.loadNodeAsync(N,q,C)))}_extensionsLoadCameraAsync(N,q,C){return this._applyExtensions(q,"loadCamera",(d=>d.loadCameraAsync&&d.loadCameraAsync(N,q,C)))}_extensionsLoadVertexDataAsync(N,q,C){return this._applyExtensions(q,"loadVertexData",(d=>d._loadVertexDataAsync&&d._loadVertexDataAsync(N,q,C)))}_extensionsLoadMeshPrimitiveAsync(N,q,C,d,U,W){return this._applyExtensions(U,"loadMeshPrimitive",(a=>a._loadMeshPrimitiveAsync&&a._loadMeshPrimitiveAsync(N,q,C,d,U,W)))}_extensionsLoadMaterialAsync(N,q,C,d,U){return this._applyExtensions(q,"loadMaterial",(W=>W._loadMaterialAsync&&W._loadMaterialAsync(N,q,C,d,U)))}_extensionsCreateMaterial(N,q,C){return this._applyExtensions(q,"createMaterial",(d=>d.createMaterial&&d.createMaterial(N,q,C)))}_extensionsLoadMaterialPropertiesAsync(N,q,C){return this._applyExtensions(q,"loadMaterialProperties",(d=>d.loadMaterialPropertiesAsync&&d.loadMaterialPropertiesAsync(N,q,C)))}_extensionsLoadTextureInfoAsync(N,q,C){return this._applyExtensions(q,"loadTextureInfo",(d=>d.loadTextureInfoAsync&&d.loadTextureInfoAsync(N,q,C)))}_extensionsLoadTextureAsync(N,q,C){return this._applyExtensions(q,"loadTexture",(d=>d._loadTextureAsync&&d._loadTextureAsync(N,q,C)))}_extensionsLoadAnimationAsync(N,q){return this._applyExtensions(q,"loadAnimation",(C=>C.loadAnimationAsync&&C.loadAnimationAsync(N,q)))}_extensionsLoadAnimationChannelAsync(N,q,C,d,U){return this._applyExtensions(C,"loadAnimationChannel",(W=>W._loadAnimationChannelAsync&&W._loadAnimationChannelAsync(N,q,C,d,U)))}_extensionsLoadSkinAsync(N,q,C){return this._applyExtensions(C,"loadSkin",(d=>d._loadSkinAsync&&d._loadSkinAsync(N,q,C)))}_extensionsLoadUriAsync(N,q,C){return this._applyExtensions(q,"loadUri",(d=>d._loadUriAsync&&d._loadUriAsync(N,q,C)))}_extensionsLoadBufferViewAsync(N,q){return this._applyExtensions(q,"loadBufferView",(C=>C.loadBufferViewAsync&&C.loadBufferViewAsync(N,q)))}_extensionsLoadBufferAsync(N,q,C,d){return this._applyExtensions(q,"loadBuffer",(U=>U.loadBufferAsync&&U.loadBufferAsync(N,q,C,d)))}static LoadExtensionAsync(N,q,C,d){if(!q.extensions)return null;const U=q.extensions[C];return U?d(`${N}/extensions/${C}`,U):null}static LoadExtraAsync(N,q,C,d){if(!q.extras)return null;const U=q.extras[C];return U?d(`${N}/extras/${C}`,U):null}isExtensionUsed(N){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(N)}logOpen(N){this._parent._logOpen(N)}logClose(){this._parent._logClose()}log(N){this._parent._log(N)}startPerformanceCounter(N){this._parent._startPerformanceCounter(N)}endPerformanceCounter(N){this._parent._endPerformanceCounter(N)}}h.DefaultSampler={index:-1},M.c._CreateGLTF2Loader=N=>new h(N);var B=C(12789),y=C(11316),R=C(11155),u=C(12798),m=C(12800);class f extends m.d{constructor(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,W=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",N),this._texture=N.getEngine().createRawCubeTexture(q,C,d,U,W,a,F,w)}update(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,N,q,C,d,U)}updateRGBDAsync(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,u.i)(this._texture,N,q,C,d).then((()=>{}))}clone(){return R.d.Clone((()=>{const N=this.lN(),q=this._texture,C=new f(N,q._bufferViewArray,q.width,q.format,q.type,q.generateMipMaps,q.invertY,q.samplingMode,q._compression);return 13===q.source&&C.updateRGBDAsync(q._bufferViewArrayArray,q._sphericalPolynomial,q._lodGenerationScale,q._lodGenerationOffset),C}),this)}}const k="EXT_lights_image_based";class g{constructor(N){this.name=k,this._loader=N,this.enabled=this._loader.isExtensionUsed(k)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.vd.extensions;if(N&&N[this.name]){const q=N[this.name];this._lights=q.lights}}loadSceneAsync(N,q){return h.LoadExtensionAsync(N,q,this.name,(async(C,d)=>{this._loader._allMaterialsDirtyRequired=!0;const U=new Array;U.push(this._loader.loadSceneAsync(N,q)),this._loader.logOpen(`${C}`);const W=L.Get(`${C}/light`,this._lights,d.Cd);return U.push(this._loadLightAsync(`/extensions/${this.name}/lights/${d.Cd}`,W).then((N=>{this._loader.babylonScene.environmentTexture=N}))),this._loader.logClose(),await Promise.all(U).then((()=>{}))}))}_loadLightAsync(N,q){if(!q._loaded){const C=new Array;this._loader.logOpen(`${N}`);const d=new Array(q.specularImages.length);for(let U=0;U<q.specularImages.length;U++){const W=q.specularImages[U];d[U]=new Array(W.length);for(let q=0;q<W.length;q++){const a=`${N}/specularImages/${U}/${q}`;this._loader.logOpen(`${a}`);const F=W[q],w=L.Get(a,this._loader.vd.images,F);C.push(this._loader.loadImageAsync(`/images/${F}`,w).then((N=>{d[U][q]=N}))),this._loader.logClose()}}this._loader.logClose(),q._loaded=Promise.all(C).then((async()=>{const C=new f(this._loader.babylonScene,null,q.specularImageSize);if(C.name=q.name||"environment",q._babylonTexture=C,void 0!=q.OF&&(C.level=q.OF),q.rotation){let N=U.Quaternion.Kq(q.rotation);this._loader.babylonScene.useRightHandedSystem||(N=U.Quaternion.Inverse(N)),U.Matrix.FromQuaternionToRef(N,C.getReflectionTextureMatrix())}if(!q.irradianceCoefficients)throw new Error(`${N}: Irradiance coefficients are missing`);const W=y.c.Kq(q.irradianceCoefficients);W.scaleInPlace(q.OF),W.convertIrradianceToLambertianRadiance();const a=y.g.FromHarmonics(W),F=(d.length-1)/Math.log2(q.specularImageSize);return await C.updateRGBDAsync(d,a,F)}))}return q._loaded.then((()=>q._babylonTexture))}}o(k),b(k,!0,(N=>new g(N)));C(11691);const x="EXT_mesh_gpu_instancing";class NN{constructor(N){this.name=x,this._loader=N,this.enabled=this._loader.isExtensionUsed(x)}dispose(){this._loader=null}loadNodeAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(N,d)=>{this._loader._disableInstancedMesh++;const W=this._loader.loadNodeAsync(`/nodes/${q.index}`,q,C);if(this._loader._disableInstancedMesh--,!q._primitiveBabylonMeshes)return await W;const a=new Array;let F=0;const w=q=>{if(void 0==d.attributes[q])return void a.push(Promise.resolve(null));const C=L.Get(`${N}/attributes/${q}`,this._loader.vd.accessors,d.attributes[q]);if(a.push(this._loader._loadFloatAccessorAsync(`/accessors/${C.bufferView}`,C)),0===F)F=C.count;else if(F!==C.count)throw new Error(`${N}/attributes: Instance buffer accessors do not have the same count.`)};return w("TRANSLATION"),w("ROTATION"),w("SCALE"),await W.then((async N=>{const[C,d,W]=await Promise.all(a),w=new Float32Array(16*F);U.TmpVectors.Jq[0].hd(0,0,0),U.TmpVectors.Quaternion[0].hd(0,0,0,1),U.TmpVectors.Jq[1].hd(1,1,1);for(let q=0;q<F;++q)C&&U.Jq.FromArrayToRef(C,3*q,U.TmpVectors.Jq[0]),d&&U.Quaternion.FromArrayToRef(d,4*q,U.TmpVectors.Quaternion[0]),W&&U.Jq.FromArrayToRef(W,3*q,U.TmpVectors.Jq[1]),U.Matrix.ComposeToRef(U.TmpVectors.Jq[1],U.TmpVectors.Quaternion[0],U.TmpVectors.Jq[0],U.TmpVectors.Matrix[0]),U.TmpVectors.Matrix[0].copyToArray(w,16*q);for(const U of q._primitiveBabylonMeshes)U.nt("matrix",w,16,!0);return N}))}))}}o(x),b(x,!0,(N=>new NN(N)));let qN=0,CN=null;class dN{static get Default(){return dN._Default||(dN._Default=new dN),dN._Default}constructor(){const N=dN.Configuration.decoder;this._decoderModulePromise=a.Tools.LoadBabylonScriptAsync(N.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(N,q,C,d,U){await this._decoderModulePromise,0===qN&&(MeshoptDecoder.useWorkers(1),qN=1);const W=await MeshoptDecoder.decodeGltfBufferAsync(q,C,N,d,U);return null!==CN&&clearTimeout(CN),CN=setTimeout((()=>{MeshoptDecoder.useWorkers(0),qN=0,CN=null}),1e3),W}}dN.Configuration={decoder:{url:`${a.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},dN._Default=null;const UN="EXT_meshopt_compression";class WN{constructor(N){this.name=UN,this.enabled=N.isExtensionUsed(UN),this._loader=N}dispose(){this._loader=null}loadBufferViewAsync(N,q){return h.LoadExtensionAsync(N,q,this.name,(async(C,d)=>{const U=q;if(U._meshOptData)return await U._meshOptData;const W=L.Get(`${N}/buffer`,this._loader.vd.buffers,d.buffer);return U._meshOptData=this._loader.loadBufferAsync(`/buffers/${W.index}`,W,d.byteOffset||0,d.byteLength).then((async N=>await dN.Default.decodeGltfBufferAsync(N,d.count,d.byteStride,d.mode,d.filter))),await U._meshOptData}))}}o(UN),b(UN,!0,(N=>new WN(N)));const aN="EXT_texture_webp";class FN{constructor(N){this.name=aN,this._loader=N,this.enabled=N.isExtensionUsed(aN)}dispose(){this._loader=null}_loadTextureAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=void 0==q.sampler?h.DefaultSampler:L.Get(`${N}/sampler`,this._loader.vd.samplers,q.sampler),a=L.Get(`${d}/source`,this._loader.vd.images,U.source);return await this._loader._createTextureAsync(N,W,a,(N=>{C(N)}),void 0,!q._textureInfo.nonColorData)}))}}o(aN),b(aN,!0,(N=>new FN(N)));const wN="EXT_texture_avif";class AN{constructor(N){this.name=wN,this._loader=N,this.enabled=N.isExtensionUsed(wN)}dispose(){this._loader=null}_loadTextureAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=void 0==q.sampler?h.DefaultSampler:L.Get(`${N}/sampler`,this._loader.vd.samplers,q.sampler),a=L.Get(`${d}/source`,this._loader.vd.images,U.source);return await this._loader._createTextureAsync(N,W,a,(N=>{C(N)}),void 0,!q._textureInfo.nonColorData)}))}}o(wN),b(wN,!0,(N=>new AN(N)));var nN=C(12786),tN=C(11666);const VN="EXT_lights_ies";class ZN{constructor(N){this.name=VN,this._loader=N,this.enabled=this._loader.isExtensionUsed(VN)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.vd.extensions;if(N&&N[this.name]){const q=N[this.name];this._lights=q.lights,L.Assign(this._lights)}}loadNodeAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,a)=>{let F,w;this._loader._allMaterialsDirtyRequired=!0;const A=await this._loader.loadNodeAsync(N,q,(N=>{w=L.Get(d,this._lights,a.Cd);const q=w.name||N.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,F=new nN.d(q,U.Jq.Zero(),U.Jq.Backward(),0,1,this._loader.babylonScene),F.angle=Math.PI/2,F.innerAngle=0,F._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,w._babylonLight=F,F.falloffType=tN.c.FALLOFF_GLTF,F.KF=a.color?W.Oq.Kq(a.color):W.Oq.White(),F.OF=a.multiplier||1,F.range=Number.MAX_VALUE,F.parent=N,this._loader._babylonLights.push(F),h.AddPointerMetadata(F,d),C(N)}));let n;if(w.uri)n=await this._loader.loadUriAsync(N,w,w.uri);else{const q=L.Get(`${N}/bufferView`,this._loader.vd.bufferViews,w.bufferView);n=await this._loader.loadBufferViewAsync(`/bufferViews/${q.index}`,q)}return F.iesProfileTexture=new i.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,n,!0,void 0,void 0,void 0,void 0,".ies"),A}))}}o(VN),b(VN,!0,(N=>new ZN(N)));var JN=C(12805);const QN="KHR_draco_mesh_compression";class vN{constructor(N){this.name=QN,this.useNormalizedFlagFromAccessor=!0,this._loader=N,this.enabled=JN.e.DefaultAvailable&&this._loader.isExtensionUsed(QN)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{if(void 0!=q.mode&&4!==q.mode&&5!==q.mode)throw new Error(`${N}: Unsupported mode ${q.mode}`);const W={},a={},F=(N,d)=>{const F=U.attributes[N];if(void 0!=F&&(C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(d)&&C._delayInfo.push(d),W[d]=F,this.useNormalizedFlagFromAccessor)){const C=L.TryGet(this._loader.vd.accessors,q.attributes[N]);C&&(a[d]=C.normalized||!1)}};F("POSITION",j.g.PositionKind),F("NORMAL",j.g.NormalKind),F("TANGENT",j.g.TangentKind),F("TEXCOORD_0",j.g.UVKind),F("TEXCOORD_1",j.g.UV2Kind),F("TEXCOORD_2",j.g.UV3Kind),F("TEXCOORD_3",j.g.UV4Kind),F("TEXCOORD_4",j.g.UV5Kind),F("TEXCOORD_5",j.g.UV6Kind),F("JOINTS_0",j.g.MatricesIndicesKind),F("WEIGHTS_0",j.g.MatricesWeightsKind),F("COLOR_0",j.g.ColorKind);const w=L.Get(d,this._loader.vd.bufferViews,U.bufferView);return w._dracoBabylonGeometry||(w._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((async d=>{const U=this.dracoDecoder||JN.e.Default,F=L.TryGet(this._loader.vd.accessors,q.attributes.POSITION),w=this._loader.parent.alwaysComputeBoundingBox||C.skeleton||!F?null:G(F);return await U._decodeMeshToGeometryForGltfAsync(C.name,this._loader.babylonScene,d,W,a,w).catch((q=>{throw new Error(`${N}: ${q.message}`)}))}))),await w._dracoBabylonGeometry}))}}o(QN),b(QN,!0,(N=>new vN(N)));var rN=C(12808),ON=C(11110),KN=C(11114),iN=C(11549),IN=C(11721),jN=C(11076);iN.e.AddNodeConstructor("Light_Type_0",((N,q)=>()=>new lN(N,U.Jq.Zero(),q)));class lN extends IN.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(N){this._shadowAngle=N,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(N){const q=this.needCube();if(this._direction=N,this.needCube()!==q&&this._shadowGenerators){const N=this._shadowGenerators.values();for(let q=N.next();!0!==q.done;q=N.next()){q.value.recreateShadowMap()}}}constructor(N,q,C){super(N,C),this._shadowAngle=Math.PI/2,this.position=q}getClassName(){return"PointLight"}getTypeID(){return tN.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(N){if(this.direction)return super.getShadowDirection(N);switch(N){case 0:return new U.Jq(1,0,0);case 1:return new U.Jq(-1,0,0);case 2:return new U.Jq(0,-1,0);case 3:return new U.Jq(0,1,0);case 4:return new U.Jq(0,0,1);case 5:return new U.Jq(0,0,-1)}return U.Jq.Zero()}_setDefaultShadowProjectionMatrix(N,q,C){const d=this.lN().activeCamera;if(!d)return;const W=void 0!==this.shadowMinZ?this.shadowMinZ:d.sd,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,F=this.lN().getEngine().useReverseDepthBuffer;U.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,F?a:W,F?W:a,N,!0,this._scene.getEngine().isNDCHalfZRange,void 0,F)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(N,q){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,q):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,q),this}transferToNodeMaterialEffect(N,q){return this.computeTransformedInformation()?N.setFloat3(q,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):N.setFloat3(q,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(N,q){N["POINTLIGHT"+q]=!0}}(0,ON.d)([(0,KN.O)()],lN.prototype,"shadowAngle",null),(0,jN.h)("BABYLON.PointLight",lN);const TN="KHR_lights_punctual";class zN{constructor(N){this.name=TN,this._loader=N,this.enabled=this._loader.isExtensionUsed(TN)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.vd.extensions;if(N&&N[this.name]){const q=N[this.name];this._lights=q.lights,L.Assign(this._lights)}}loadNodeAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,a)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(N,q,(N=>{let q;const F=L.Get(d,this._lights,a.Cd),w=F.name||N.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,F.type){case"directional":{const N=new rN.c(w,U.Jq.Backward(),this._loader.babylonScene);N.position.Rd(0),q=N;break}case"point":q=new lN(w,U.Jq.Zero(),this._loader.babylonScene);break;case"spot":{const N=new nN.d(w,U.Jq.Zero(),U.Jq.Backward(),0,1,this._loader.babylonScene);N.angle=2*(F.spot&&F.spot.outerConeAngle||Math.PI/4),N.innerAngle=2*(F.spot&&F.spot.innerConeAngle||0),q=N;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${d}: Invalid light type (${F.type})`)}q._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,F._babylonLight=q,q.falloffType=tN.c.FALLOFF_GLTF,q.KF=F.color?W.Oq.Kq(F.color):W.Oq.White(),q.OF=void 0==F.OF?1:F.OF,q.range=void 0==F.range?Number.MAX_VALUE:F.range,q.parent=N,this._loader._babylonLights.push(q),h.AddPointerMetadata(q,d),C(N)})))))}}o(TN),b(TN,!0,(N=>new zN(N)));const pN="KHR_materials_pbrSpecularGlossiness";class sN{constructor(N){this.name=pN,this.order=200,this._loader=N,this.enabled=this._loader.isExtensionUsed(pN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;return W.push(this._loader.loadMaterialBasePropertiesAsync(N,q,C)),W.push(this._loadSpecularGlossinessPropertiesAsync(d,U,C)),this._loader.loadMaterialAlphaProperties(N,q,C),await Promise.all(W).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const d=new Array;return C.metallic=null,C.roughness=null,q.diffuseFactor?(C.albedoColor=W.Oq.Kq(q.diffuseFactor),C.alpha=q.diffuseFactor[3]):C.albedoColor=W.Oq.White(),C.reflectivityColor=q.specularFactor?W.Oq.Kq(q.specularFactor):W.Oq.White(),C.microSurface=void 0==q.glossinessFactor?1:q.glossinessFactor,q.diffuseTexture&&d.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTexture`,q.diffuseTexture,(N=>{N.name=`${C.name} (Diffuse)`,C.albedoTexture=N}))),q.specularGlossinessTexture&&(d.push(this._loader.loadTextureInfoAsync(`${N}/specularGlossinessTexture`,q.specularGlossinessTexture,(N=>{N.name=`${C.name} (Specular Glossiness)`,C.reflectivityTexture=N,C.reflectivityTexture.pd=!0}))),C.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(d).then((()=>{}))}}o(pN),b(pN,!0,(N=>new sN(N)));const XN="KHR_materials_unlit";class PN{constructor(N){this.name=XN,this.order=210,this._loader=N,this.enabled=this._loader.isExtensionUsed(XN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async()=>await this._loadUnlitPropertiesAsync(N,q,C)))}_loadUnlitPropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const d=new Array;C.unlit=!0;const U=q.pbrMetallicRoughness;return U&&(U.baseColorFactor?(C.albedoColor=W.Oq.Kq(U.baseColorFactor),C.alpha=U.baseColorFactor[3]):C.albedoColor=W.Oq.White(),U.baseColorTexture&&d.push(this._loader.loadTextureInfoAsync(`${N}/baseColorTexture`,U.baseColorTexture,(N=>{N.name=`${C.name} (Base Color)`,C.albedoTexture=N})))),q.doubleSided&&(C.Ld=!1,C.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(N,q,C),Promise.all(d).then((()=>{}))}}o(XN),b(XN,!0,(N=>new PN(N)));const MN="KHR_materials_clearcoat";class YN{constructor(N){this.name=MN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(MN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadClearCoatPropertiesAsync(d,U,C)),await Promise.all(W)}))}_loadClearCoatPropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const d=new Array;return C.clearCoat.isEnabled=!0,C.clearCoat.useRoughnessFromMainTexture=!1,C.clearCoat.remapF0OnInterfaceChange=!1,void 0!=q.clearcoatFactor?C.clearCoat.OF=q.clearcoatFactor:C.clearCoat.OF=0,q.clearcoatTexture&&d.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatTexture`,q.clearcoatTexture,(N=>{N.name=`${C.name} (ClearCoat)`,C.clearCoat.texture=N}))),void 0!=q.clearcoatRoughnessFactor?C.clearCoat.roughness=q.clearcoatRoughnessFactor:C.clearCoat.roughness=0,q.clearcoatRoughnessTexture&&(q.clearcoatRoughnessTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatRoughnessTexture`,q.clearcoatRoughnessTexture,(N=>{N.name=`${C.name} (ClearCoat Roughness)`,C.clearCoat.textureRoughness=N})))),q.clearcoatNormalTexture&&(q.clearcoatNormalTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatNormalTexture`,q.clearcoatNormalTexture,(N=>{N.name=`${C.name} (ClearCoat Normal)`,C.clearCoat.bumpTexture=N}))),C.invertNormalMapX=!C.lN().useRightHandedSystem,C.invertNormalMapY=C.lN().useRightHandedSystem,void 0!=q.clearcoatNormalTexture.scale&&(C.clearCoat.bumpTexture.level=q.clearcoatNormalTexture.scale)),Promise.all(d).then((()=>{}))}}o(MN),b(MN,!0,(N=>new YN(N)));const EN="KHR_materials_iridescence";class HN{constructor(N){this.name=EN,this.order=195,this._loader=N,this.enabled=this._loader.isExtensionUsed(EN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;return W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadIridescencePropertiesAsync(d,U,C)),await Promise.all(W).then((()=>{}))}))}_loadIridescencePropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const d=new Array;return C.iridescence.isEnabled=!0,C.iridescence.OF=q.iridescenceFactor??0,C.iridescence.indexOfRefraction=q.iridescenceIor??q.iridescenceIOR??1.3,C.iridescence.minimumThickness=q.iridescenceThicknessMinimum??100,C.iridescence.maximumThickness=q.iridescenceThicknessMaximum??400,q.iridescenceTexture&&d.push(this._loader.loadTextureInfoAsync(`${N}/iridescenceTexture`,q.iridescenceTexture,(N=>{N.name=`${C.name} (Iridescence)`,C.iridescence.texture=N}))),q.iridescenceThicknessTexture&&d.push(this._loader.loadTextureInfoAsync(`${N}/iridescenceThicknessTexture`,q.iridescenceThicknessTexture,(N=>{N.name=`${C.name} (Iridescence Thickness)`,C.iridescence.thicknessTexture=N}))),Promise.all(d).then((()=>{}))}}o(EN),b(EN,!0,(N=>new HN(N)));const eN="KHR_materials_anisotropy";class bN{constructor(N){this.name=eN,this.order=195,this._loader=N,this.enabled=this._loader.isExtensionUsed(eN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadIridescencePropertiesAsync(d,U,C)),await Promise.all(W)}))}async _loadIridescencePropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const d=new Array;C.anisotropy.isEnabled=!0,C.anisotropy.OF=q.anisotropyStrength??0,C.anisotropy.angle=q.anisotropyRotation??0,q.anisotropyTexture&&(q.anisotropyTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${N}/anisotropyTexture`,q.anisotropyTexture,(N=>{N.name=`${C.name} (Anisotropy Intensity)`,C.anisotropy.texture=N})))),await Promise.all(d)}}o(eN),b(eN,!0,(N=>new bN(N)));const oN="KHR_materials_emissive_strength";class SN{constructor(N){this.name=oN,this.order=170,this._loader=N,this.enabled=this._loader.isExtensionUsed(oN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>await this._loader.loadMaterialPropertiesAsync(N,q,C).then((()=>{this._loadEmissiveProperties(d,U,C)}))))}_loadEmissiveProperties(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);void 0!==q.emissiveStrength&&(C.emissiveIntensity=q.emissiveStrength)}}o(oN),b(oN,!0,(N=>new SN(N)));const DN="KHR_materials_sheen";class cN{constructor(N){this.name=DN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(DN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;return W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadSheenPropertiesAsync(d,U,C)),await Promise.all(W).then((()=>{}))}))}_loadSheenPropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const d=new Array;return C.sheen.isEnabled=!0,C.sheen.OF=1,void 0!=q.sheenColorFactor?C.sheen.color=W.Oq.Kq(q.sheenColorFactor):C.sheen.color=W.Oq.Black(),q.sheenColorTexture&&d.push(this._loader.loadTextureInfoAsync(`${N}/sheenColorTexture`,q.sheenColorTexture,(N=>{N.name=`${C.name} (Sheen Color)`,C.sheen.texture=N}))),void 0!==q.sheenRoughnessFactor?C.sheen.roughness=q.sheenRoughnessFactor:C.sheen.roughness=0,q.sheenRoughnessTexture&&(q.sheenRoughnessTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${N}/sheenRoughnessTexture`,q.sheenRoughnessTexture,(N=>{N.name=`${C.name} (Sheen Roughness)`,C.sheen.textureRoughness=N})))),C.sheen.albedoScaling=!0,C.sheen.useRoughnessFromMainTexture=!1,Promise.all(d).then((()=>{}))}}o(DN),b(DN,!0,(N=>new cN(N)));var LN=C(11603);const GN="KHR_materials_specular";class hN{constructor(N){this.name=GN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(GN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;if(W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadSpecularPropertiesAsync(d,U,C)),U.extensions&&U.extensions.EXT_materials_specular_edge_color&&C instanceof K.c){U.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(C.brdf.dielectricSpecularModel=LN.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,C.brdf.conductorSpecularModel=LN.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(W).then((()=>{}))}))}_loadSpecularPropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const d=new Array;return void 0!==q.specularFactor&&(C.metallicF0Factor=q.specularFactor),void 0!==q.specularColorFactor&&(C.metallicReflectanceColor=W.Oq.Kq(q.specularColorFactor)),q.specularTexture&&(q.specularTexture.nonColorData=!0,d.push(this._loader.loadTextureInfoAsync(`${N}/specularTexture`,q.specularTexture,(N=>{N.name=`${C.name} (Specular)`,C.metallicReflectanceTexture=N,C.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),q.specularColorTexture&&d.push(this._loader.loadTextureInfoAsync(`${N}/specularColorTexture`,q.specularColorTexture,(N=>{N.name=`${C.name} (Specular Color)`,C.reflectanceTexture=N}))),Promise.all(d).then((()=>{}))}}o(GN),b(GN,!0,(N=>new hN(N)));const BN="KHR_materials_ior";class yN{constructor(N){this.name=BN,this.order=180,this._loader=N,this.enabled=this._loader.isExtensionUsed(BN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;return W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadIorPropertiesAsync(d,U,C)),await Promise.all(W).then((()=>{}))}))}_loadIorPropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);return void 0!==q.ior?C.indexOfRefraction=q.ior:C.indexOfRefraction=yN._DEFAULT_IOR,Promise.resolve()}}yN._DEFAULT_IOR=1.5,o(BN),b(BN,!0,(N=>new yN(N)));const RN="KHR_materials_variants";class uN{constructor(N){this.name=RN,this._loader=N,this.enabled=this._loader.isExtensionUsed(RN)}dispose(){this._loader=null}static GetAvailableVariants(N){const q=this._GetExtensionMetadata(N);return q?Object.keys(q.variants):[]}getAvailableVariants(N){return uN.GetAvailableVariants(N)}static SelectVariant(N,q){const C=this._GetExtensionMetadata(N);if(!C)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${RN} extension`);const d=N=>{const q=C.variants[N];if(q)for(const C of q)C.mesh.material=C.material};if(q instanceof Array)for(const U of q)d(U);else d(q);C.lastSelected=q}selectVariant(N,q){uN.SelectVariant(N,q)}static Reset(N){const q=this._GetExtensionMetadata(N);if(!q)throw new Error(`Cannot reset on a glTF mesh that does not have the ${RN} extension`);for(const C of q.original)C.mesh.material=C.material;q.lastSelected=null}reset(N){uN.Reset(N)}static GetLastSelectedVariant(N){const q=this._GetExtensionMetadata(N);if(!q)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${RN} extension`);return q.lastSelected}getLastSelectedVariant(N){return uN.GetLastSelectedVariant(N)}static _GetExtensionMetadata(N){var q,C;return(null===N||void 0===N||null===(q=N._internalMetadata)||void 0===q||null===(C=q.vd)||void 0===C?void 0:C[RN])||null}onLoading(){const N=this._loader.vd.extensions;if(N&&N[this.name]){const q=N[this.name];this._variants=q.variants}}onReady(){const N=this._loader.rootBabylonMesh;if(N){var q;const C=this._loader.parent.extensionOptions[RN];null!==C&&void 0!==C&&C.defaultVariant&&uN.SelectVariant(N,C.defaultVariant),null===C||void 0===C||null===(q=C.onLoaded)||void 0===q||q.call(C,{get variants(){return uN.GetAvailableVariants(N)},get selectedVariant(){const q=uN.GetLastSelectedVariant(N);return q?Array.isArray(q)?q[0]:q:uN.GetAvailableVariants(N)[0]},set selectedVariant(q){uN.SelectVariant(N,q)}})}}_loadMeshPrimitiveAsync(N,q,C,d,U,W){return h.LoadExtensionAsync(N,U,this.name,(async(a,F)=>{const w=new Array;return w.push(this._loader._loadMeshPrimitiveAsync(N,q,C,d,U,(q=>{if(W(q),q instanceof z.b){const C=h._GetDrawMode(N,U.mode),d=this._loader.rootBabylonMesh,W=d?d._internalMetadata=d._internalMetadata||{}:{},A=W.vd=W.vd||{},n=A[RN]=A[RN]||{lastSelected:null,original:[],variants:{}};n.original.push({mesh:q,material:q.material});for(let N=0;N<F.mappings.length;++N){const U=F.mappings[N],W=L.Get(`${a}/mappings/${N}/material`,this._loader.vd.materials,U.material);w.push(this._loader._loadMaterialAsync(`#/materials/${U.material}`,W,q,C,(N=>{for(let C=0;C<U.variants.length;++C){const W=U.variants[C],a=L.Get(`/extensions/${RN}/variants/${W}`,this._variants,W);n.variants[a.name]=n.variants[a.name]||[],n.variants[a.name].push({mesh:q,material:N}),q.onClonedObservable.add((N=>{const C=N;let U=null,W=C;do{if(W=W.parent,!W)return;U=uN._GetExtensionMetadata(W)}while(null===U);if(d&&U===uN._GetExtensionMetadata(d)){W._internalMetadata={};for(const N in d._internalMetadata)W._internalMetadata[N]=d._internalMetadata[N];W._internalMetadata.vd=[];for(const N in d._internalMetadata.vd)W._internalMetadata.vd[N]=d._internalMetadata.vd[N];W._internalMetadata.vd[RN]={lastSelected:null,original:[],variants:{}};for(const N of U.original)W._internalMetadata.vd[RN].original.push({mesh:N.mesh,material:N.material});for(const N in U.variants)if(Object.prototype.hasOwnProperty.call(U.variants,N)){W._internalMetadata.vd[RN].variants[N]=[];for(const q of U.variants[N])W._internalMetadata.vd[RN].variants[N].push({mesh:q.mesh,material:q.material})}U=W._internalMetadata.vd[RN]}for(const d of U.original)d.mesh===q&&(d.mesh=C);for(const d of U.variants[a.name])d.mesh===q&&(d.mesh=C)}))}})))}}}))),await Promise.all(w).then((N=>{let[q]=N;return q}))}))}}o(RN),b(RN,!0,(N=>new uN(N)));var mN=C(11183);class fN{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:LN.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(N,q){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...fN._GetDefaultOptions(),...N},this._scene=q,this._scene._transmissionHelper=this,this.onErrorObservable=new n.b,this._scene.td.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(N){if(!Object.keys(N).filter((q=>this._options[q]!==N[q])).length)return;const q={...this._options,...N},C=this._options;this._options=q,q.renderSize===C.renderSize&&q.renderTargetTextureType===C.renderTargetTextureType&&q.generateMipmaps===C.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=q.samples,this._opaqueRenderTarget.lodGenerationScale=q.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=q.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(N){return!!N&&!!(N instanceof K.c&&N.subSurface.isRefractionEnabled)}_addMesh(N){this._materialObservers[N.uniqueId]=N.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),a.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(N.material)?(N.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(N)&&this._transparentMeshesCache.push(N)):-1===this._opaqueMeshesCache.indexOf(N)&&this._opaqueMeshesCache.push(N)}))}_removeMesh(N){N.onMaterialChangedObservable.remove(this._materialObservers[N.uniqueId]),delete this._materialObservers[N.uniqueId];let q=this._transparentMeshesCache.indexOf(N);-1!==q&&this._transparentMeshesCache.splice(q,1),q=this._opaqueMeshesCache.indexOf(N),-1!==q&&this._opaqueMeshesCache.splice(q,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(N){const q=this._transparentMeshesCache.indexOf(N),C=this._opaqueMeshesCache.indexOf(N);this._shouldRenderAsTransmission(N.material)?(N.material instanceof K.c&&(N.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==C?(this._opaqueMeshesCache.splice(C,1),this._transparentMeshesCache.push(N)):-1===q&&this._transparentMeshesCache.push(N)):-1!==q?(this._transparentMeshesCache.splice(q,1),this._opaqueMeshesCache.push(N)):-1===C&&this._opaqueMeshesCache.push(N)}_isRenderTargetValid(){var N;return null!==(null===(N=this._opaqueRenderTarget)||void 0===N?void 0:N.getInternalTexture())}_setupRenderTargets(){var N;let q;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new mN.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(N=this._options.clearColor)||void 0===N?void 0:N.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((N=>{q=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?N.clearColor.U(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(N.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=q}));for(const C of this._transparentMeshesCache)this._shouldRenderAsTransmission(C.material)&&(C.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const kN="KHR_materials_transmission";class gN{constructor(N){this.name=kN,this.order=175,this._loader=N,this.enabled=this._loader.isExtensionUsed(kN),this.enabled&&(N.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;return W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadTransparentPropertiesAsync(d,q,C,U)),await Promise.all(W).then((()=>{}))}))}_loadTransparentPropertiesAsync(N,q,C,d){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const U=C;if(U.subSurface.isRefractionEnabled=!0,U.subSurface.volumeIndexOfRefraction=1,U.subSurface.useAlbedoToTintRefraction=!0,void 0===d.transmissionFactor)return U.subSurface.refractionIntensity=0,U.subSurface.isRefractionEnabled=!1,Promise.resolve();{var W;U.subSurface.refractionIntensity=d.transmissionFactor;const N=U.lN();if(U.subSurface.refractionIntensity&&!N._transmissionHelper)new fN({},U.lN());else if(U.subSurface.refractionIntensity&&(null===(W=N._transmissionHelper)||void 0===W||!W._isRenderTargetValid())){var a;null===(a=N._transmissionHelper)||void 0===a||a._setupRenderTargets()}}return U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=0,d.transmissionTexture?(d.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${N}/transmissionTexture`,d.transmissionTexture,void 0).then((N=>{N.name=`${C.name} (Transmission)`,U.subSurface.refractionIntensityTexture=N,U.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}o(kN),b(kN,!0,(N=>new gN(N)));const xN="KHR_materials_diffuse_transmission";class Nq{constructor(N){this.name=xN,this.order=174,this._loader=N,this.enabled=this._loader.isExtensionUsed(xN),this.enabled&&(N.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;return W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadTranslucentPropertiesAsync(d,q,C,U)),await Promise.all(W).then((()=>{}))}))}_loadTranslucentPropertiesAsync(N,q,C,d){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const U=C;if(U.subSurface.isTranslucencyEnabled=!0,U.subSurface.volumeIndexOfRefraction=1,U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=0,U.subSurface.useAlbedoToTintTranslucency=!1,void 0===d.diffuseTransmissionFactor)return U.subSurface.translucencyIntensity=0,U.subSurface.isTranslucencyEnabled=!1,Promise.resolve();U.subSurface.translucencyIntensity=d.diffuseTransmissionFactor;const a=new Array;return U.subSurface.useGltfStyleTextures=!0,d.diffuseTransmissionTexture&&(d.diffuseTransmissionTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTransmissionTexture`,d.diffuseTransmissionTexture).then((N=>{N.name=`${C.name} (Diffuse Transmission)`,U.subSurface.translucencyIntensityTexture=N})))),void 0!==d.diffuseTransmissionColorFactor?U.subSurface.translucencyColor=W.Oq.Kq(d.diffuseTransmissionColorFactor):U.subSurface.translucencyColor=W.Oq.White(),d.diffuseTransmissionColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTransmissionColorTexture`,d.diffuseTransmissionColorTexture).then((N=>{N.name=`${C.name} (Diffuse Transmission Color)`,U.subSurface.translucencyColorTexture=N}))),Promise.all(a).then((()=>{}))}}o(xN),b(xN,!0,(N=>new Nq(N)));const qq="KHR_materials_volume";class Cq{constructor(N){this.name=qq,this.order=173,this._loader=N,this.enabled=this._loader.isExtensionUsed(qq),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;return W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadVolumePropertiesAsync(d,q,C,U)),await Promise.all(W).then((()=>{}))}))}_loadVolumePropertiesAsync(N,q,C,d){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);if(!C.subSurface.isRefractionEnabled&&!C.subSurface.isTranslucencyEnabled||!d.thicknessFactor)return Promise.resolve();C.subSurface.volumeIndexOfRefraction=C.indexOfRefraction;const U=void 0!==d.attenuationDistance?d.attenuationDistance:Number.MAX_VALUE;return C.subSurface.tintColorAtDistance=U,void 0!==d.attenuationColor&&3==d.attenuationColor.length&&C.subSurface.tintColor.hd(d.attenuationColor[0],d.attenuationColor[1],d.attenuationColor[2]),C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=d.thicknessFactor,C.subSurface.useThicknessAsDepth=!0,d.thicknessTexture?(d.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${N}/thicknessTexture`,d.thicknessTexture).then((N=>{N.name=`${C.name} (Thickness)`,C.subSurface.thicknessTexture=N,C.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}o(qq),b(qq,!0,(N=>new Cq(N)));const dq="KHR_materials_dispersion";class Uq{constructor(N){this.name=dq,this.order=174,this._loader=N,this.enabled=this._loader.isExtensionUsed(dq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;return W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadDispersionPropertiesAsync(d,q,C,U)),await Promise.all(W).then((()=>{}))}))}_loadDispersionPropertiesAsync(N,q,C,d){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);return C.subSurface.isRefractionEnabled&&d.dispersion?(C.subSurface.isDispersionEnabled=!0,C.subSurface.dispersion=d.dispersion,Promise.resolve()):Promise.resolve()}}o(dq),b(dq,!0,(N=>new Uq(N)));const Wq="EXT_materials_diffuse_roughness";class aq{constructor(N){this.name=Wq,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(Wq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=new Array;return W.push(this._loader.loadMaterialPropertiesAsync(N,q,C)),W.push(this._loadDiffuseRoughnessPropertiesAsync(d,U,C)),await Promise.all(W).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(N,q,C){if(!(C instanceof K.c))throw new Error(`${N}: Material type not supported`);const d=new Array;return C.brdf.baseDiffuseModel=LN.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=q.diffuseRoughnessFactor?C.baseDiffuseRoughness=q.diffuseRoughnessFactor:C.baseDiffuseRoughness=0,q.diffuseRoughnessTexture&&d.push(this._loader.loadTextureInfoAsync(`${N}/diffuseRoughnessTexture`,q.diffuseRoughnessTexture,(N=>{N.name=`${C.name} (Diffuse Roughness)`,C.baseDiffuseRoughnessTexture=N}))),Promise.all(d).then((()=>{}))}}o(Wq),b(Wq,!0,(N=>new aq(N)));const Fq="KHR_mesh_quantization";class wq{constructor(N){this.name=Fq,this.enabled=N.isExtensionUsed(Fq)}dispose(){}}o(Fq),b(Fq,!0,(N=>new wq(N)));const Aq="KHR_texture_basisu";class nq{constructor(N){this.name=Aq,this._loader=N,this.enabled=N.isExtensionUsed(Aq)}dispose(){this._loader=null}_loadTextureAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>{const W=void 0==q.sampler?h.DefaultSampler:L.Get(`${N}/sampler`,this._loader.vd.samplers,q.sampler),a=L.Get(`${d}/source`,this._loader.vd.images,U.source);return await this._loader._createTextureAsync(N,W,a,(N=>{C(N)}),q._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!q._textureInfo.nonColorData)}))}}o(Aq),b(Aq,!0,(N=>new nq(N)));const tq="KHR_texture_transform";class Vq{constructor(N){this.name=tq,this._loader=N,this.enabled=this._loader.isExtensionUsed(tq)}dispose(){this._loader=null}loadTextureInfoAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(d,U)=>await this._loader.loadTextureInfoAsync(N,q,(N=>{if(!(N instanceof i.c))throw new Error(`${d}: Texture type not supported`);U.offset&&(N.uOffset=U.offset[0],N.vOffset=U.offset[1]),N.uRotationCenter=0,N.vRotationCenter=0,U.rotation&&(N.wAng=-U.rotation),U.scale&&(N.uScale=U.scale[0],N.vScale=U.scale[1]),void 0!=U.texCoord&&(N.coordinatesIndex=U.texCoord),C(N)}))))}}o(tq),b(tq,!0,(N=>new Vq(N)));const Zq="KHR_xmp_json_ld";class Jq{constructor(N){this.name=Zq,this.order=100,this._loader=N,this.enabled=this._loader.isExtensionUsed(Zq)}dispose(){this._loader=null}onLoading(){var N,q,C;if(null===this._loader.rootBabylonMesh)return;const d=null===(N=this._loader.vd.extensions)||void 0===N?void 0:N.KHR_xmp_json_ld,U=null===(q=this._loader.vd.asset)||void 0===q||null===(C=q.extensions)||void 0===C?void 0:C.KHR_xmp_json_ld;if(d&&U){const N=+U.packet;d.packets&&N<d.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=d.packets[N])}}}function Qq(N,q,C,d){return W.Oq.Kq(q,C).scale(d)}function vq(N,q,C,d){return q[C]*d}function rq(N,q,C,d){return-q[C]*d}function Oq(N,q,C,d){return q[C+1]*d}function Kq(N,q,C,d){return q[C]*d*2}function iq(N){return{scale:[new jq(V.d.ANIMATIONTYPE_FLOAT,`${N}.uScale`,vq,(()=>2)),new jq(V.d.ANIMATIONTYPE_FLOAT,`${N}.vScale`,Oq,(()=>2))],offset:[new jq(V.d.ANIMATIONTYPE_FLOAT,`${N}.uOffset`,vq,(()=>2)),new jq(V.d.ANIMATIONTYPE_FLOAT,`${N}.vOffset`,Oq,(()=>2))],rotation:[new jq(V.d.ANIMATIONTYPE_FLOAT,`${N}.wAng`,rq,(()=>1))]}}o(Zq),b(Zq,!0,(N=>new Jq(N)));class Iq extends B.AnimationPropertyInfo{buildAnimations(N,q,C,d){return[{babylonAnimatable:N._babylonCamera,babylonAnimation:this._buildAnimation(q,C,d)}]}}class jq extends B.AnimationPropertyInfo{buildAnimations(N,q,C,d){const U=[];for(const W in N._data)U.push({babylonAnimatable:N._data[W].babylonMaterial,babylonAnimation:this._buildAnimation(q,C,d)});return U}}class lq extends B.AnimationPropertyInfo{buildAnimations(N,q,C,d){return[{babylonAnimatable:N._babylonLight,babylonAnimation:this._buildAnimation(q,C,d)}]}}(0,S.j)("/cameras/{}/orthographic/xmag",[new Iq(V.d.ANIMATIONTYPE_FLOAT,"orthoLeft",rq,(()=>1)),new Iq(V.d.ANIMATIONTYPE_FLOAT,"orthoRight",Oq,(()=>1))]),(0,S.j)("/cameras/{}/orthographic/ymag",[new Iq(V.d.ANIMATIONTYPE_FLOAT,"orthoBottom",rq,(()=>1)),new Iq(V.d.ANIMATIONTYPE_FLOAT,"orthoTop",Oq,(()=>1))]),(0,S.j)("/cameras/{}/orthographic/zfar",[new Iq(V.d.ANIMATIONTYPE_FLOAT,"maxZ",vq,(()=>1))]),(0,S.j)("/cameras/{}/orthographic/znear",[new Iq(V.d.ANIMATIONTYPE_FLOAT,"sd",vq,(()=>1))]),(0,S.j)("/cameras/{}/perspective/yfov",[new Iq(V.d.ANIMATIONTYPE_FLOAT,"fov",vq,(()=>1))]),(0,S.j)("/cameras/{}/perspective/zfar",[new Iq(V.d.ANIMATIONTYPE_FLOAT,"maxZ",vq,(()=>1))]),(0,S.j)("/cameras/{}/perspective/znear",[new Iq(V.d.ANIMATIONTYPE_FLOAT,"sd",vq,(()=>1))]),(0,S.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new jq(V.d.ANIMATIONTYPE_COLOR3,"albedoColor",Qq,(()=>4)),new jq(V.d.ANIMATIONTYPE_FLOAT,"alpha",(function(N,q,C,d){return q[C+3]*d}),(()=>4))]),(0,S.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"metallic",vq,(()=>1))]),(0,S.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"roughness",vq,(()=>1))]);const Tq=iq("albedoTexture");(0,S.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Tq.scale),(0,S.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Tq.offset),(0,S.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Tq.rotation);const zq=iq("metallicTexture");(0,S.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",zq.scale),(0,S.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",zq.offset),(0,S.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",zq.rotation),(0,S.j)("/materials/{}/emissiveFactor",[new jq(V.d.ANIMATIONTYPE_COLOR3,"emissiveColor",Qq,(()=>3))]);const pq=iq("bumpTexture");(0,S.j)("/materials/{}/normalTexture/scale",[new jq(V.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",vq,(()=>1))]),(0,S.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",pq.scale),(0,S.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",pq.offset),(0,S.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",pq.rotation),(0,S.j)("/materials/{}/occlusionTexture/strength",[new jq(V.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",vq,(()=>1))]);const sq=iq("ambientTexture");(0,S.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",sq.scale),(0,S.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",sq.offset),(0,S.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",sq.rotation);const Xq=iq("emissiveTexture");(0,S.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Xq.scale),(0,S.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Xq.offset),(0,S.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Xq.rotation),(0,S.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new jq(V.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new jq(V.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",vq,(()=>1))]);const Pq=iq("anisotropy.texture");(0,S.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Pq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Pq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Pq.rotation),(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",vq,(()=>1))]);const Mq=iq("clearCoat.texture");(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Mq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Mq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Mq.rotation);const Yq=iq("clearCoat.bumpTexture");(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new jq(V.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Yq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Yq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Yq.rotation);const Eq=iq("clearCoat.textureRoughness");(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Eq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Eq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Eq.rotation),(0,S.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new jq(V.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new jq(V.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new jq(V.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new jq(V.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",vq,(()=>1))]);const Hq=iq("iridescence.texture");(0,S.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Hq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Hq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Hq.rotation);const eq=iq("iridescence.thicknessTexture");(0,S.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",eq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",eq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",eq.rotation),(0,S.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new jq(V.d.ANIMATIONTYPE_COLOR3,"sheen.color",Qq,(()=>3))]),(0,S.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",vq,(()=>1))]);const bq=iq("sheen.texture");(0,S.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",bq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",bq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",bq.rotation);const oq=iq("sheen.textureRoughness");(0,S.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",oq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",oq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",oq.rotation),(0,S.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new jq(V.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Qq,(()=>3))]);const Sq=iq("metallicReflectanceTexture");(0,S.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Sq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Sq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Sq.rotation);const Dq=iq("reflectanceTexture");(0,S.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Dq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Dq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Dq.rotation),(0,S.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",vq,(()=>1))]);const cq=iq("subSurface.refractionIntensityTexture");(0,S.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",cq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",cq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",cq.rotation),(0,S.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new jq(V.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Qq,(()=>3))]),(0,S.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new jq(V.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",vq,(()=>1))]),(0,S.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",vq,(()=>1))]);const Lq=iq("subSurface.thicknessTexture");(0,S.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Lq.scale),(0,S.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Lq.offset),(0,S.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Lq.rotation),(0,S.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new jq(V.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",vq,(()=>1))]);const Gq=iq("subSurface.translucencyIntensityTexture");(0,S.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Gq.scale),(0,S.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Gq.offset),(0,S.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Gq.rotation),(0,S.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new jq(V.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Qq,(()=>3))]);const hq=iq("subSurface.translucencyColorTexture");(0,S.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",hq.scale),(0,S.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",hq.offset),(0,S.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",hq.rotation),(0,S.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new lq(V.d.ANIMATIONTYPE_COLOR3,"diffuse",Qq,(()=>3))]),(0,S.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new lq(V.d.ANIMATIONTYPE_FLOAT,"intensity",vq,(()=>1))]),(0,S.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new lq(V.d.ANIMATIONTYPE_FLOAT,"range",vq,(()=>1))]),(0,S.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new lq(V.d.ANIMATIONTYPE_FLOAT,"innerAngle",Kq,(()=>1))]),(0,S.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new lq(V.d.ANIMATIONTYPE_FLOAT,"angle",Kq,(()=>1))]),(0,S.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new lq(V.d.ANIMATIONTYPE_COLOR3,"diffuse",Qq,(()=>3))]),(0,S.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new lq(V.d.ANIMATIONTYPE_FLOAT,"intensity",vq,(()=>1))]);const Bq="KHR_animation_pointer";class yq{constructor(N){this.name=Bq,this._loader=N,this._pathToObjectConverter=(0,S.i)(this._loader.vd)}get enabled(){return this._loader.isExtensionUsed(Bq)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(N,q,C,d,U){var W;const a=null===(W=d.target.extensions)||void 0===W?void 0:W.KHR_animation_pointer;if(!a||!this._pathToObjectConverter)return null;"pointer"!==d.target.path&&Q.c.Warn(`${N}/target/path: Value (${d.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=d.target.node&&Q.c.Warn(`${N}/target/node: Value (${d.target.node}) must not be present when using the ${this.name} extension`);const F=`${N}/extensions/${this.name}`,w=a.pointer;if(!w)throw new Error(`${F}: Pointer is missing`);try{const W=this._pathToObjectConverter.convert(w);if(!W.info.interpolation)throw new Error(`${F}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(N,q,C,d,{object:W.object,info:W.info.interpolation},U)}catch(A){return Q.c.Warn(`${F}/pointer: Invalid pointer (${w}) skipped`),null}}}o(Bq),b(Bq,!0,(N=>new yq(N)));class Rq{constructor(N,q,C){this.frame=N,this.action=q,this.onlyOnce=C,this.isDone=!1}_clone(){return new Rq(this.frame,this.action,this.onlyOnce)}}var uq=C(10985),mq=C(11032),fq=C(11029);class kq{get loop(){return this._loop}set loop(N){N!==this._loop&&(this._loop=N,this.updateOptions({loop:N}))}get currentTime(){var N;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(N=mq.b.audioEngine)&&void 0!==N&&N.audioContext&&(this.isPlaying||this.isPaused)){const N=this.isPaused?0:mq.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+N}return 0}get spatialSound(){return this._spatialSound}set spatialSound(N){if(N==this._spatialSound)return;const q=this.isPlaying;this.pause(),N?(this._spatialSound=N,this._updateSpatialParameters()):this._disableSpatialSound(),q&&this.play()}constructor(N,q,C){var d;let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new n.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=U.Jq.Zero(),this._localDirection=new U.Jq(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=N,C=C||J.e.LastCreatedScene)if(this._scene=C,kq._SceneComponentInitialization(C),this._readyToPlayCallback=W,this._customAttenuationFunction=(N,q,C,d,U)=>q<C?N*(1-q/C):0,F&&(this.autoplay=F.autoplay||!1,this._loop=F.loop||!1,void 0!==F.volume&&(this._volume=F.volume),this._spatialSound=F.spatialSound??!1,this.maxDistance=F.maxDistance??100,this.useCustomAttenuation=F.useCustomAttenuation??!1,this.rolloffFactor=F.rolloffFactor||1,this.refDistance=F.refDistance||1,this.distanceModel=F.distanceModel||"linear",this._playbackRate=F.playbackRate||1,this._streaming=F.streaming??!1,this._length=F.length,this._offset=F.offset),null!==(d=mq.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&mq.b.audioEngine.audioContext){this._soundGain=mq.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let N=!0;if(q)try{"string"===typeof q?(this._urlType="String",this._url=q):q instanceof ArrayBuffer?this._urlType="ArrayBuffer":q instanceof HTMLMediaElement?this._urlType="MediaElement":q instanceof MediaStream?this._urlType="MediaStream":q instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(q)&&(this._urlType="Array");let C=[],d=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=mq.b.audioEngine.audioContext.createMediaElementSource(q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=mq.b.audioEngine.audioContext.createMediaStreamSource(q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":q.byteLength>0&&(d=!0,this._soundLoaded(q));break;case"AudioBuffer":this._audioBufferLoaded(q);break;case"String":C.push(q);case"Array":0===C.length&&(C=q);for(let N=0;N<C.length;N++){const q=C[N];if(d=F&&F.skipCodecCheck||-1!==q.indexOf(".mp3",q.length-4)&&mq.b.audioEngine.isMP3supported||-1!==q.indexOf(".ogg",q.length-4)&&mq.b.audioEngine.isOGGsupported||-1!==q.indexOf(".wav",q.length-4)||-1!==q.indexOf(".m4a",q.length-4)||-1!==q.indexOf(".mp4",q.length-4)||-1!==q.indexOf("blob:"),d){this._streaming?(this._htmlAudioElement=new Audio(q),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,a.Tools.SetCorsBehavior(q,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(q,(N=>{this._soundLoaded(N)}),void 0,!0,!0,(N=>{N&&Q.c.Error("XHR "+N.status+" error on: "+q+"."),Q.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:N=!1}N?d||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Q.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(w){Q.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),mq.b.audioEngine&&!mq.b.audioEngine.WarnedWebAudioUnsupported&&(Q.c.Error("Web Audio is not supported by your browser."),mq.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var N;null!==(N=mq.b.audioEngine)&&void 0!==N&&N.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(N){var q;null!==(q=mq.b.audioEngine)&&void 0!==q&&q.audioContext&&(this._audioBuffer=N,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(N){var q;null!==(q=mq.b.audioEngine)&&void 0!==q&&q.audioContext&&mq.b.audioEngine.audioContext.decodeAudioData(N,(N=>{this._audioBufferLoaded(N)}),(N=>{Q.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+N)}))}setAudioBuffer(N){var q;null!==(q=mq.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&(this._audioBuffer=N,this._isReadyToPlay=!0)}updateOptions(N){N&&(this.loop=N.loop??this.loop,this.maxDistance=N.maxDistance??this.maxDistance,this.useCustomAttenuation=N.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=N.rolloffFactor??this.rolloffFactor,this.refDistance=N.refDistance??this.refDistance,this.distanceModel=N.distanceModel??this.distanceModel,this._playbackRate=N.playbackRate??this._playbackRate,this._length=N.length??void 0,this.spatialSound=N.spatialSound??this._spatialSound,this._setOffset(N.offset??void 0),this.setVolume(N.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var N;null!==(N=mq.b.audioEngine)&&void 0!==N&&N.canUseWebAudio&&mq.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??mq.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var N;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(N=this._soundPanner)||void 0===N||N.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var N;null!==(N=mq.b.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(N){var q;null!==(q=mq.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(N),this._isOutputConnected=!0)}setDirectionalCone(N,q,C){q<N?Q.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=N,this._coneOuterAngle=q,this._coneOuterGain=C,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(N){if(N!=this._coneInnerAngle){var q;if(this._coneOuterAngle<N)return void Q.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=N,null!==(q=mq.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(N){if(N!=this._coneOuterAngle){var q;if(N<this._coneInnerAngle)return void Q.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=N,null!==(q=mq.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(N){var q;N.equals(this._position)||(this._position.U(N),null!==(q=mq.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(N){var q;this._localDirection=N,null!==(q=mq.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const N=this._connectedTransformNode.getWorldMatrix(),q=U.Jq.TransformNormal(this._localDirection,N);q.normalize(),this._soundPanner.orientationX.value=q.x,this._soundPanner.orientationY.value=q.y,this._soundPanner.orientationZ.value=q.z}updateDistanceFromListener(){var N;if(null!==(N=mq.b.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const N=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Qq(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,N,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(N){this._customAttenuationFunction=N}play(N,q,C){var d;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(d=mq.b.audioEngine)&&void 0!==d&&d.audioContext)try{var U,W;this._clearTimeoutsAndObservers();let d=N?(null===(U=mq.b.audioEngine)||void 0===U?void 0:U.audioContext.currentTime)+N:null===(W=mq.b.audioEngine)||void 0===W?void 0:W.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=mq.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const N=()=>{var C;if(null!==(C=mq.b.audioEngine)&&void 0!==C&&C.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=q??0;const C=this._htmlAudioElement.play();void 0!==C&&C.catch((()=>{var q,C;(null===(q=mq.b.audioEngine)||void 0===q||q.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(C=mq.b.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{N()})))}))}else{var d;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(d=mq.b.audioEngine)||void 0===d?void 0:d.onAudioUnlockedObservable.addOnce((()=>{N()}))}};N()}}else{var a;const U=()=>{var U;if(null!==(U=mq.b.audioEngine)&&void 0!==U&&U.audioContext){var W;if(C=C||this._length,void 0!==q&&this._setOffset(q),this._soundSource){const N=this._soundSource;N.onended=()=>{N.disconnect()}}if(this._soundSource=null===(W=mq.b.audioEngine)||void 0===W?void 0:W.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var a;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==q&&(this._soundSource.loopStart=q),void 0!==C&&(this._soundSource.loopEnd=(0|q)+C),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},d=N?(null===(a=mq.b.audioEngine)||void 0===a?void 0:a.audioContext.currentTime)+N:mq.b.audioEngine.audioContext.currentTime;const U=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(d,U,this.loop?void 0:C)}}};"suspended"===(null===(a=mq.b.audioEngine)||void 0===a?void 0:a.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var N;"suspended"===(null===(N=mq.b.audioEngine)||void 0===N?void 0:N.audioContext.state)?(mq.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=mq.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{U()})))):U()}),500):U()}this._startTime=d,this.isPlaying=!0,this.isPaused=!1}catch(F){Q.c.Error("Error while trying to play audio: "+this.name+", "+F.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(N){var q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var C;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(C=this._streamingSource)||void 0===C||C.disconnect();this.isPlaying=!1}else if(null!==(q=mq.b.audioEngine)&&void 0!==q&&q.audioContext&&this._soundSource){const q=N?mq.b.audioEngine.audioContext.currentTime+N:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(q)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var N;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var q;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(q=this._streamingSource)||void 0===q||q.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(N=mq.b.audioEngine)&&void 0!==N&&N.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=mq.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(N,q){var C;null!==(C=mq.b.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._soundGain&&(q&&mq.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(mq.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,mq.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(N,mq.b.audioEngine.audioContext.currentTime+q)):this._soundGain.gain.value=N),this._volume=N}setPlaybackRate(N){this._playbackRate=N,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(N){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=N,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=N=>this._onRegisterAfterWorldMatrixUpdate(N),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(N){var q;if(N.getBoundingInfo){const q=N.getBoundingInfo();this.setPosition(q.boundingSphere.centerWorld)}else this.setPosition(N.absolutePosition);null!==(q=mq.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const N=()=>{(0,fq.f)((()=>this._isReadyToPlay),(()=>{C._audioBuffer=this.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,this._offset,this._length)}),void 0,300)},q={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},C=new kq(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,q);return this.useCustomAttenuation&&C.setAttenuationFunction(this._customAttenuationFunction),C.setPosition(this._position),C.setPlaybackRate(this._playbackRate),N(),C}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const N={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(N.connectedMeshId=this._connectedTransformNode.id),N.position=this._position.zd(),N.refDistance=this.refDistance,N.distanceModel=this.distanceModel,N.isDirectional=this._isDirectional,N.localDirectionToMesh=this._localDirection.zd(),N.coneInnerAngle=this._coneInnerAngle,N.coneOuterAngle=this._coneOuterAngle,N.coneOuterGain=this._coneOuterGain),N}static Parse(N,q,C,d){const W=N.name;let a;a=N.url?C+N.url:C+W;const F={autoplay:N.autoplay,loop:N.loop,volume:N.volume,spatialSound:N.spatialSound,maxDistance:N.maxDistance,rolloffFactor:N.rolloffFactor,refDistance:N.refDistance,distanceModel:N.distanceModel,playbackRate:N.playbackRate};let w;if(d){const N=()=>{(0,fq.f)((()=>d._isReadyToPlay),(()=>{w._audioBuffer=d.getAudioBuffer(),w._isReadyToPlay=!0,w.autoplay&&w.play(0,w._offset,w._length)}),void 0,300)};w=new kq(W,new ArrayBuffer(0),q,null,F),N()}else w=new kq(W,a,q,(()=>{q.removePendingData(w)}),F),q.addPendingData(w);if(N.position){const q=U.Jq.Kq(N.position);w.setPosition(q)}if(N.isDirectional&&(w.setDirectionalCone(N.coneInnerAngle||360,N.coneOuterAngle||360,N.coneOuterGain||0),N.localDirectionToMesh)){const q=U.Jq.Kq(N.localDirectionToMesh);w.setLocalDirectionToMesh(q)}if(N.connectedMeshId){const C=q.getMeshById(N.connectedMeshId);C&&w.attachToMesh(C)}return N.metadata&&(w.metadata=N.metadata),w}_setOffset(N){this._offset!==N&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=N)}_clearTimeoutsAndObservers(){var N;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(N=mq.b.audioEngine)||void 0===N||N.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}kq._SceneComponentInitialization=N=>{throw(0,uq.b)("AudioSceneComponent")},(0,jN.h)("BABYLON.Sound",kq);class gq{constructor(N,q,C){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],q.length!==C.length)throw new Error("Sounds length does not equal weights length");this.loop=N,this._weights=C;let d=0;for(const W of C)d+=W;const U=d>0?1/d:0;for(let W=0;W<this._weights.length;W++)this._weights[W]*=U;this._sounds=q;for(const W of this._sounds)W.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(N){if(N!==this._coneInnerAngle){if(this._coneOuterAngle<N)return void Q.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=N;for(const q of this._sounds)q.directionalConeInnerAngle=N}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(N){if(N!==this._coneOuterAngle){if(N<this._coneInnerAngle)return void Q.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=N;for(const q of this._sounds)q.directionalConeOuterAngle=N}}get volume(){return this._volume}set volume(N){if(N!==this._volume)for(const q of this._sounds)q.setVolume(N)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(N){if(!this.isPaused){this.stop();const N=Math.random();let q=0;for(let C=0;C<this._weights.length;C++)if(q+=this._weights[C],N<=q){this._currentIndex=C;break}}const q=this._sounds[this._currentIndex??0];q.isReady()?q.play(0,this.isPaused?void 0:N):q.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class xq{constructor(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(N=N||J.e.LastCreatedScene)&&(this._scene=N,this.soundCollection=[],this._options=q,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var N;null!==(N=mq.b.audioEngine)&&void 0!==N&&N.canUseWebAudio&&mq.b.audioEngine.audioContext&&(this._outputAudioNode=mq.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(mq.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(mq.b.audioEngine&&mq.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(N){var q;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(q=mq.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&N.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==N.soundTrackId&&(-1===N.soundTrackId?this._scene.mainSoundTrack.removeSound(N):this._scene.soundTracks&&this._scene.soundTracks[N.soundTrackId].removeSound(N)),this.soundCollection.push(N),N.soundTrackId=this.id}removeSound(N){const q=this.soundCollection.indexOf(N);-1!==q&&this.soundCollection.splice(q,1)}setVolume(N){var q;null!==(q=mq.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=N)}switchPanningModelToHRTF(){var N;if(null!==(N=mq.b.audioEngine)&&void 0!==N&&N.canUseWebAudio)for(let q=0;q<this.soundCollection.length;q++)this.soundCollection[q].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var N;if(null!==(N=mq.b.audioEngine)&&void 0!==N&&N.canUseWebAudio)for(let q=0;q<this.soundCollection.length;q++)this.soundCollection[q].switchPanningModelToEqualPower()}connectToAnalyser(N){var q;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=N,null!==(q=mq.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,mq.b.audioEngine.masterGain))}}var NC=C(11395),qC=C(11364),CC=C(10953);mq.b.AudioEngineFactory=(N,q,C)=>new dC(N,q,C);class dC{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new n.b,this.onAudioLockedObservable=new n.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,CC.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const d=document.createElement("audio");this._hostElement=N,this._audioContext=q,this._audioDestination=C;try{d&&d.canPlayType&&(d.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||d.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(U){}try{d&&d.canPlayType&&d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(U){}}lock(){this._triggerSuspendedState()}unlock(){var N,q;if("running"===(null===(N=this._audioContext)||void 0===N?void 0:N.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(q=this._audioContext)||void 0===q||q.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{Q.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var N;null===(N=this._audioContext)||void 0===N||N.addEventListener("statechange",(()=>{var N;this.unlocked&&"running"!==(null===(N=this._audioContext)||void 0===N?void 0:N.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var N;return null!==(N=this._audioContext)&&void 0!==N&&N.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(N){this.canUseWebAudio=!1,Q.c.Error("Web Audio: "+N.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(N){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const N=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",q=document.createElement("style");q.appendChild(document.createTextNode(N)),document.getElementsByTagName("head")[0].appendChild(q),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var N;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(N=this._audioContext)||void 0===N||N.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(N){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=N)}connectToAnalyser(N){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=N,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var UC=C(10980);(0,C(12499).e)(NC.e.NAME_AUDIO,((N,q,C,d)=>{let U,W=[];if(C.zV=C.zV||[],void 0!==N.zV&&null!==N.zV)for(let F=0,w=N.zV.length;F<w;F++){var a;const w=N.zV[F];null!==(a=mq.b.audioEngine)&&void 0!==a&&a.canUseWebAudio?(w.url||(w.url=w.name),W[w.url]?C.zV.push(kq.Parse(w,q,d,W[w.url])):(U=kq.Parse(w,q,d),W[w.url]=U,C.zV.push(U))):C.zV.push(new kq(w.name,null,q))}W=[]})),Object.defineProperty(qC.c.prototype,"mainSoundTrack",{get:function(){let N=this._getComponent(NC.e.NAME_AUDIO);return N||(N=new WC(this),this.dd(N)),this._mainSoundTrack||(this._mainSoundTrack=new xq(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),qC.c.prototype.getSoundByName=function(N){let q;for(q=0;q<this.mainSoundTrack.soundCollection.length;q++)if(this.mainSoundTrack.soundCollection[q].name===N)return this.mainSoundTrack.soundCollection[q];if(this.soundTracks)for(let C=0;C<this.soundTracks.length;C++)for(q=0;q<this.soundTracks[C].soundCollection.length;q++)if(this.soundTracks[C].soundCollection[q].name===N)return this.soundTracks[C].soundCollection[q];return null},Object.defineProperty(qC.c.prototype,"audioEnabled",{get:function(){let N=this._getComponent(NC.e.NAME_AUDIO);return N||(N=new WC(this),this.dd(N)),N.audioEnabled},set:function(N){let q=this._getComponent(NC.e.NAME_AUDIO);q||(q=new WC(this),this.dd(q)),N?q.enableAudio():q.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(qC.c.prototype,"headphone",{get:function(){let N=this._getComponent(NC.e.NAME_AUDIO);return N||(N=new WC(this),this.dd(N)),N.headphone},set:function(N){let q=this._getComponent(NC.e.NAME_AUDIO);q||(q=new WC(this),this.dd(q)),N?q.switchAudioModeForHeadphones():q.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(qC.c.prototype,"audioListenerPositionProvider",{get:function(){let N=this._getComponent(NC.e.NAME_AUDIO);return N||(N=new WC(this),this.dd(N)),N.audioListenerPositionProvider},set:function(N){let q=this._getComponent(NC.e.NAME_AUDIO);if(q||(q=new WC(this),this.dd(q)),N&&"function"!==typeof N)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");q.audioListenerPositionProvider=N},enumerable:!0,configurable:!0}),Object.defineProperty(qC.c.prototype,"audioListenerRotationProvider",{get:function(){let N=this._getComponent(NC.e.NAME_AUDIO);return N||(N=new WC(this),this.dd(N)),N.audioListenerRotationProvider},set:function(N){let q=this._getComponent(NC.e.NAME_AUDIO);if(q||(q=new WC(this),this.dd(q)),N&&"function"!==typeof N)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");q.audioListenerRotationProvider=N},enumerable:!0,configurable:!0}),Object.defineProperty(qC.c.prototype,"audioPositioningRefreshRate",{get:function(){let N=this._getComponent(NC.e.NAME_AUDIO);return N||(N=new WC(this),this.dd(N)),N.audioPositioningRefreshRate},set:function(N){let q=this._getComponent(NC.e.NAME_AUDIO);q||(q=new WC(this),this.dd(q)),q.audioPositioningRefreshRate=N},enumerable:!0,configurable:!0});class WC{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(N){this.name=NC.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new U.Jq,this._cachedCameraPosition=new U.Jq,this._lastCheck=0,this._invertMatrixTemp=new U.Matrix,this._cameraDirectionTemp=new U.Jq,(N=N||J.e.LastCreatedScene)&&(this.vq=N,N.soundTracks=[],N.zV=[])}register(){this.vq._afterRenderStage.registerStep(NC.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(N){if(N.zV=[],this.vq.soundTracks)for(let q=0;q<this.vq.soundTracks.length;q++){const C=this.vq.soundTracks[q];for(let q=0;q<C.soundCollection.length;q++)N.zV.push(C.soundCollection[q].serialize())}}addFromContainer(N){if(N.zV)for(const q of N.zV)q.play(),q.autoplay=!0,this.vq.mainSoundTrack.addSound(q)}removeFromContainer(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(N.zV)for(const C of N.zV)C.stop(),C.autoplay=!1,this.vq.mainSoundTrack.removeSound(C),q&&C.dispose()}dispose(){const N=this.vq;if(N._mainSoundTrack&&N.mainSoundTrack.dispose(),N.soundTracks)for(let q=0;q<N.soundTracks.length;q++)N.soundTracks[q].dispose()}disableAudio(){const N=this.vq;let q;for(this._audioEnabled=!1,mq.b.audioEngine&&mq.b.audioEngine.audioContext&&mq.b.audioEngine.audioContext.suspend(),q=0;q<N.mainSoundTrack.soundCollection.length;q++)N.mainSoundTrack.soundCollection[q].pause();if(N.soundTracks)for(q=0;q<N.soundTracks.length;q++)for(let C=0;C<N.soundTracks[q].soundCollection.length;C++)N.soundTracks[q].soundCollection[C].pause()}enableAudio(){const N=this.vq;let q;for(this._audioEnabled=!0,mq.b.audioEngine&&mq.b.audioEngine.audioContext&&mq.b.audioEngine.audioContext.resume(),q=0;q<N.mainSoundTrack.soundCollection.length;q++)N.mainSoundTrack.soundCollection[q].isPaused&&N.mainSoundTrack.soundCollection[q].play();if(N.soundTracks)for(q=0;q<N.soundTracks.length;q++)for(let C=0;C<N.soundTracks[q].soundCollection.length;C++)N.soundTracks[q].soundCollection[C].isPaused&&N.soundTracks[q].soundCollection[C].play()}switchAudioModeForHeadphones(){const N=this.vq;if(this._headphone=!0,N.mainSoundTrack.switchPanningModelToHRTF(),N.soundTracks)for(let q=0;q<N.soundTracks.length;q++)N.soundTracks[q].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const N=this.vq;if(this._headphone=!1,N.mainSoundTrack.switchPanningModelToEqualPower(),N.soundTracks)for(let q=0;q<N.soundTracks.length;q++)N.soundTracks[q].switchPanningModelToEqualPower()}_afterRender(){const N=UC.c.Now;if(this._lastCheck&&N-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=N;const q=this.vq;if(!this._audioEnabled||!q._mainSoundTrack||!q.soundTracks||0===q._mainSoundTrack.soundCollection.length&&1===q.soundTracks.length)return;const C=mq.b.audioEngine;if(C&&C.audioContext){let N,d=q.activeCamera;if(q.activeCameras&&q.activeCameras.length>0&&(d=q.activeCameras[0]),this.audioListenerPositionProvider){const N=this.audioListenerPositionProvider();C.audioContext.listener.setPosition(N.x||0,N.y||0,N.z||0)}else d?this._cachedCameraPosition.equals(d.globalPosition)||(this._cachedCameraPosition.U(d.globalPosition),C.audioContext.listener.setPosition(d.globalPosition.x,d.globalPosition.y,d.globalPosition.z)):C.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const N=this.audioListenerRotationProvider();C.audioContext.listener.setOrientation(N.x||0,N.y||0,N.z||0,0,1,0)}else d?(d.rigCameras&&d.rigCameras.length>0&&(d=d.rigCameras[0]),d.getViewMatrix().invertToRef(this._invertMatrixTemp),U.Jq.TransformNormalToRef(WC._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.U(this._cameraDirectionTemp),C.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):C.audioContext.listener.setOrientation(0,0,0,0,1,0);for(N=0;N<q.mainSoundTrack.soundCollection.length;N++){const C=q.mainSoundTrack.soundCollection[N];C.useCustomAttenuation&&C.updateDistanceFromListener()}if(q.soundTracks)for(N=0;N<q.soundTracks.length;N++)for(let C=0;C<q.soundTracks[N].soundCollection.length;C++){const d=q.soundTracks[N].soundCollection[C];d.useCustomAttenuation&&d.updateDistanceFromListener()}}}}WC._CameraDirection=new U.Jq(0,0,-1),kq._SceneComponentInitialization=N=>{let q=N._getComponent(NC.e.NAME_AUDIO);q||(q=new WC(N),N.dd(q))};const aC="MSFT_audio_emitter";class FC{constructor(N){this.name=aC,this._loader=N,this.enabled=this._loader.isExtensionUsed(aC)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const N=this._loader.vd.extensions;if(N&&N[this.name]){const q=N[this.name];this._clips=q.clips,this._emitters=q.emitters,L.Assign(this._clips),L.Assign(this._emitters)}}loadSceneAsync(N,q){return h.LoadExtensionAsync(N,q,this.name,(async(C,d)=>{const U=new Array;U.push(this._loader.loadSceneAsync(N,q));for(const N of d.emitters){const q=L.Get(`${C}/emitters`,this._emitters,N);if(void 0!=q.refDistance||void 0!=q.maxDistance||void 0!=q.rolloffFactor||void 0!=q.distanceModel||void 0!=q.innerAngle||void 0!=q.outerAngle)throw new Error(`${C}: Direction or Distance properties are not allowed on emitters attached to a scene`);U.push(this._loadEmitterAsync(`${C}/emitters/${q.index}`,q))}await Promise.all(U)}))}loadNodeAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(N,d)=>{const W=new Array,F=await this._loader.loadNodeAsync(N,q,(q=>{for(const C of d.emitters){const d=L.Get(`${N}/emitters`,this._emitters,C);W.push(this._loadEmitterAsync(`${N}/emitters/${d.index}`,d).then((()=>{for(const N of d._babylonSounds)N.attachToMesh(q),void 0==d.innerAngle&&void 0==d.outerAngle||(N.setLocalDirectionToMesh(U.Jq.Forward()),N.setDirectionalCone(2*a.Tools.ToDegrees(void 0==d.innerAngle?Math.PI:d.innerAngle),2*a.Tools.ToDegrees(void 0==d.outerAngle?Math.PI:d.outerAngle),0))})))}C(q)}));return await Promise.all(W),F}))}loadAnimationAsync(N,q){return h.LoadExtensionAsync(N,q,this.name,(async(C,d)=>{const U=await this._loader.loadAnimationAsync(N,q),W=new Array;L.Assign(d.events);for(const a of d.events)W.push(this._loadAnimationEventAsync(`${C}/events/${a.index}`,N,q,a,U));return await Promise.all(W),U}))}_loadClipAsync(N,q){if(q._objectURL)return q._objectURL;let C;if(q.uri)C=this._loader.loadUriAsync(N,q,q.uri);else{const d=L.Get(`${N}/bufferView`,this._loader.vd.bufferViews,q.bufferView);C=this._loader.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}return q._objectURL=C.then((N=>URL.createObjectURL(new Blob([N],{type:q.mimeType})))),q._objectURL}_loadEmitterAsync(N,q){if(q._babylonSounds=q._babylonSounds||[],!q._babylonData){const N=new Array,C=q.name||`emitter${q.index}`,d={loop:!1,autoplay:!1,volume:void 0==q.volume?1:q.volume};for(let W=0;W<q.clips.length;W++){const U=`/extensions/${this.name}/clips`,a=L.Get(U,this._clips,q.clips[W].clip);N.push(this._loadClipAsync(`${U}/${q.clips[W].clip}`,a).then((N=>{const U=q._babylonSounds[W]=new kq(C,N,this._loader.babylonScene,null,d);U.refDistance=q.refDistance||1,U.maxDistance=q.maxDistance||256,U.rolloffFactor=q.rolloffFactor||1,U.distanceModel=q.distanceModel||"exponential"})))}const U=Promise.all(N).then((()=>{const N=q.clips.map((N=>N.weight||1)),C=new gq(q.loop||!1,q._babylonSounds,N);q.innerAngle&&(C.directionalConeInnerAngle=2*a.Tools.ToDegrees(q.innerAngle)),q.outerAngle&&(C.directionalConeOuterAngle=2*a.Tools.ToDegrees(q.outerAngle)),q.volume&&(C.volume=q.volume),q._babylonData.sound=C}));q._babylonData={loaded:U}}return q._babylonData.loaded}_getEventAction(N,q,C,d,U){switch(C){case"play":return N=>{const C=(U||0)+(N-d);q.play(C)};case"stop":return()=>{q.stop()};case"pause":return()=>{q.pause()};default:throw new Error(`${N}: Unsupported action ${C}`)}}_loadAnimationEventAsync(N,q,C,d,U){if(0==U.targetedAnimations.length)return Promise.resolve();const W=U.targetedAnimations[0],a=d.dq,F=L.Get(`/extensions/${this.name}/emitters`,this._emitters,a);return this._loadEmitterAsync(N,F).then((()=>{const q=F._babylonData.sound;if(q){const C=new Rq(d.time,this._getEventAction(N,q,d.action,d.time,d.startOffset));W.animation.addEvent(C),U.onAnimationGroupEndObservable.add((()=>{q.stop()})),U.onAnimationGroupPauseObservable.add((()=>{q.pause()}))}}))}}o(aC),b(aC,!0,(N=>new FC(N)));const wC="MSFT_lod";class AC{constructor(N){var q;this.name=wC,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new n.b,this.onMaterialLODsLoadedObservable=new n.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=N,this.maxLODsToLoad=(null===(q=this._loader.parent.extensionOptions[wC])||void 0===q?void 0:q.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(wC)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let N=0;N<this._nodePromiseLODs.length;N++){const q=Promise.all(this._nodePromiseLODs[N]).then((()=>{0!==N&&(this._loader.endPerformanceCounter(`Node LOD ${N}`),this._loader.log(`Loaded node LOD ${N}`)),this.onNodeLODsLoadedObservable.notifyObservers(N),N!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${N+1}`),this._loadBufferLOD(this._nodeBufferLODs,N+1),this._nodeSignalLODs[N]&&this._nodeSignalLODs[N].resolve())}));this._loader._completePromises.push(q)}for(let N=0;N<this._materialPromiseLODs.length;N++){const q=Promise.all(this._materialPromiseLODs[N]).then((()=>{0!==N&&(this._loader.endPerformanceCounter(`Material LOD ${N}`),this._loader.log(`Loaded material LOD ${N}`)),this.onMaterialLODsLoadedObservable.notifyObservers(N),N!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${N+1}`),this._loadBufferLOD(this._materialBufferLODs,N+1),this._materialSignalLODs[N]&&this._materialSignalLODs[N].resolve())}));this._loader._completePromises.push(q)}}loadSceneAsync(N,q){const C=this._loader.loadSceneAsync(N,q);return this._loadBufferLOD(this._bufferLODs,0),C}loadNodeAsync(N,q,C){return h.LoadExtensionAsync(N,q,this.name,(async(N,U)=>{let W;const a=this._getLODs(N,q,this._loader.vd.nodes,U.ids);this._loader.logOpen(`${N}`);for(let q=0;q<a.length;q++){const N=a[q];0!==q&&(this._nodeIndexLOD=q,this._nodeSignalLODs[q]=this._nodeSignalLODs[q]||new d);const U=N=>{C(N),N.bF(!1)},F=this._loader.loadNodeAsync(`/nodes/${N.index}`,N,U).then((N=>{if(0!==q){const N=a[q-1];N._babylonTransformNode&&(this._disposeTransformNode(N._babylonTransformNode),delete N._babylonTransformNode)}return N.bF(!0),N}));this._nodePromiseLODs[q]=this._nodePromiseLODs[q]||[],0===q?W=F:(this._nodeIndexLOD=null,this._nodePromiseLODs[q].push(F))}return this._loader.logClose(),await W}))}_loadMaterialAsync(N,q,C,d,U){return this._nodeIndexLOD?null:h.LoadExtensionAsync(N,q,this.name,(async(N,W)=>{let a;const F=this._getLODs(N,q,this._loader.vd.materials,W.ids);this._loader.logOpen(`${N}`);for(let q=0;q<F.length;q++){const N=F[q];0!==q&&(this._materialIndexLOD=q);const W=this._loader._loadMaterialAsync(`/materials/${N.index}`,N,C,d,(N=>{0===q&&U(N)})).then((N=>{if(0!==q){U(N);const C=F[q-1]._data;C[d]&&(this._disposeMaterials([C[d].babylonMaterial]),delete C[d])}return N}));this._materialPromiseLODs[q]=this._materialPromiseLODs[q]||[],0===q?a=W:(this._materialIndexLOD=null,this._materialPromiseLODs[q].push(W))}return this._loader.logClose(),await a}))}_loadUriAsync(N,q,C){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const U=this._nodeIndexLOD-1;return this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new d,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(N,q,C)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const U=this._materialIndexLOD-1;return this._materialSignalLODs[U]=this._materialSignalLODs[U]||new d,this._materialSignalLODs[U].promise.then((async()=>await this._loader.loadUriAsync(N,q,C)))}return null}loadBufferAsync(N,q,C,U){if(this._loader.parent.useRangeRequests&&!q.uri){if(!this._loader.bin)throw new Error(`${N}: Uri is missing or the binary glTF is missing its binary chunk`);const q=async(N,q)=>{const W=C,a=W+U-1;let F=N[q];return F?(F.start=Math.min(F.start,W),F.end=Math.max(F.end,a)):(F={start:W,end:a,loaded:new d},N[q]=F),await F.loaded.promise.then((N=>new Uint8Array(N.buffer,N.byteOffset+C-F.start,U)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?q(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?q(this._materialBufferLODs,this._materialIndexLOD):q(this._bufferLODs,0)}return null}_loadBufferLOD(N,q){const C=N[q];C&&(this._loader.log(`Loading buffer range [${C.start}-${C.end}]`),this._loader.bin.readAsync(C.start,C.end-C.start+1).then((N=>{C.loaded.resolve(N)}),(N=>{C.loaded.reject(N)})))}_getLODs(N,q,C,d){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const U=[];for(let W=d.length-1;W>=0;W--)if(U.push(L.Get(`${N}/ids/${d[W]}`,C,d[W])),U.length===this.maxLODsToLoad)return U;return U.push(q),U}_disposeTransformNode(N){const q=[],C=N.material;C&&q.push(C);for(const U of N.getChildMeshes())U.material&&q.push(U.material);N.dispose();const d=q.filter((N=>this._loader.babylonScene.meshes.every((q=>q.material!=N))));this._disposeMaterials(d)}_disposeMaterials(N){const q={};for(const C of N){for(const N of C.getActiveTextures())q[N.uniqueId]=N;C.dispose()}for(const C in q)for(const N of this._loader.babylonScene.materials)N.hasTexture(q[C])&&delete q[C];for(const C in q)q[C].dispose()}}o(wC),b(wC,!0,(N=>new AC(N)));const nC="MSFT_minecraftMesh";class tC{constructor(N){this.name=nC,this._loader=N,this.enabled=this._loader.isExtensionUsed(nC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtraAsync(N,q,this.name,(async(d,U)=>{if(U){if(!(C instanceof K.c))throw new Error(`${d}: Material type not supported`);const U=this._loader.loadMaterialPropertiesAsync(N,q,C);return C.needAlphaBlending()&&(C.forceDepthWrite=!0,C.separateCullingPass=!0),C.Ld=C.forceDepthWrite,C.twoSidedLighting=!0,await U}}))}}o(nC),b(nC,!0,(N=>new tC(N)));const VC="MSFT_sRGBFactors";class ZC{constructor(N){this.name=VC,this._loader=N,this.enabled=this._loader.isExtensionUsed(VC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,q,C){return h.LoadExtraAsync(N,q,this.name,(async(d,U)=>{if(U){if(!(C instanceof K.c))throw new Error(`${d}: Material type not supported`);const U=this._loader.loadMaterialPropertiesAsync(N,q,C),W=C.lN().getEngine().useExactSrgbConversions;return C.albedoTexture||C.albedoColor.toLinearSpaceToRef(C.albedoColor,W),C.reflectivityTexture||C.reflectivityColor.toLinearSpaceToRef(C.reflectivityColor,W),await U}}))}}o(VC),b(VC,!0,(N=>new ZC(N)));var JC=C(12816);const QC={};var vC=C(12865),rC=C(12848),OC=C(12823),KC=C(12831);function iC(N,q){for(const C of N)for(const N of C.dataOutputs)if(N.uniqueId===q)return N;throw new Error("Could not find data out connection with unique id "+q)}function IC(N,q){for(const C of N)if(C instanceof rC.d)for(const N of C.signalInputs)if(N.uniqueId===q)return N;throw new Error("Could not find signal in connection with unique id "+q)}async function jC(N,q){const d=await Promise.all(N.allBlocks.map((async N=>{const q=function(N){switch(N){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([C.e(78),C.e(79)]).then(C.bind(C,14266))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await C.e(80).then(C.bind(C,14275))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await C.e(81).then(C.bind(C,14278))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await C.e(82).then(C.bind(C,14287))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await C.e(83).then(C.bind(C,14290))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await C.e(84).then(C.bind(C,14295))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await C.e(85).then(C.bind(C,14302))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await C.e(86).then(C.bind(C,14305))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await C.e(87).then(C.bind(C,14314))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await C.e(90).then(C.bind(C,14355))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await C.e(90).then(C.bind(C,14355))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await C.e(90).then(C.bind(C,14355))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await C.e(90).then(C.bind(C,14355))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await C.e(95).then(C.bind(C,14358))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await C.e(96).then(C.bind(C,14366))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await C.e(97).then(C.bind(C,14375))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await C.e(98).then(C.bind(C,14380))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await C.e(99).then(C.bind(C,14388))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await C.e(100).then(C.bind(C,14397))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await C.e(101).then(C.bind(C,14406))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await C.e(102).then(C.bind(C,14409))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await C.e(103).then(C.bind(C,14415))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await C.e(104).then(C.bind(C,14422))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await C.e(105).then(C.bind(C,14431))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await C.e(106).then(C.bind(C,14436))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await C.e(107).then(C.bind(C,14442))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await C.e(108).then(C.bind(C,14450))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await C.e(109).then(C.bind(C,14456))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await C.e(110).then(C.bind(C,14462))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await C.e(111).then(C.bind(C,14467))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await C.e(112).then(C.bind(C,14470))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await C.e(113).then(C.bind(C,14479))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await C.e(92).then(C.bind(C,14486))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await C.e(114).then(C.bind(C,14493))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await C.e(115).then(C.bind(C,14502))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await C.e(116).then(C.bind(C,14507))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await C.e(93).then(C.bind(C,14514))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await C.e(88).then(C.bind(C,14320))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await C.e(94).then(C.bind(C,14517))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await C.e(94).then(C.bind(C,14517))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await C.e(94).then(C.bind(C,14517))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,14517))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await C.e(94).then(C.bind(C,14517))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await C.e(94).then(C.bind(C,14517))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await C.e(94).then(C.bind(C,14517))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,14517))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await C.e(89).then(C.bind(C,14346))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await C.e(90).then(C.bind(C,14355))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await C.e(90).then(C.bind(C,14355))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await C.e(91).then(C.bind(C,14525))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await C.e(91).then(C.bind(C,14525))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await C.e(91).then(C.bind(C,14525))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await C.e(91).then(C.bind(C,14525))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await C.e(91).then(C.bind(C,14525))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await C.e(91).then(C.bind(C,14525))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await C.e(117).then(C.bind(C,14529))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await C.e(118).then(C.bind(C,14537))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await C.e(119).then(C.bind(C,14539))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await C.e(120).then(C.bind(C,14548))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await C.e(121).then(C.bind(C,14553))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await C.e(122).then(C.bind(C,14559))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await C.e(123).then(C.bind(C,14567))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await C.e(124).then(C.bind(C,14569))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await C.e(125).then(C.bind(C,14578))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await C.e(126).then(C.bind(C,14580))).FlowGraphDataSwitchBlock;default:if(QC[N])return QC[N];throw new Error(`Unknown block name ${N}`)}}(N.className);return await q()})));return function(N,q,C){const d=q.coordinator.createGraph(),U=[],W=q.valueParseFunction??OC.b;for(let a=0;a<N.allBlocks.length;a++){const F=TC(N.allBlocks[a],{vq:q.coordinator.config.vq,pathConverter:q.pathConverter,assetsContainer:q.coordinator.config.vq,valueParseFunction:W},C[a]);U.push(F),F instanceof vC.b&&d.addEventBlock(F)}for(const a of U){for(const N of a.dataInputs)for(const q of N.connectedPointIds){const C=iC(U,q);N.connectTo(C)}if(a instanceof rC.d)for(const N of a.signalOutputs)for(const q of N.connectedPointIds){const C=IC(U,q);N.connectTo(C)}}for(const a of N.executionContexts)lC(a,{graph:d,valueParseFunction:W},N.rightHanded);return d}(N,q,d)}function lC(N,q,C){const d=q.graph.createContext();N.enableLogging&&(d.enableLogging=!0),d.treatDataAsRightHanded=C||!1;const U=q.valueParseFunction??OC.b;d.uniqueId=N.uniqueId;const W=d.lN();if(N._assetsContext){var a,F,w,A,n,t,V,Z,J,Q;const q=N._assetsContext,C={meshes:null===(a=q.meshes)||void 0===a?void 0:a.map((N=>W.getMeshById(N))),lights:null===(F=q.lights)||void 0===F?void 0:F.map((N=>W.getLightByName(N))),cameras:null===(w=q.cameras)||void 0===w?void 0:w.map((N=>W.getCameraByName(N))),materials:null===(A=q.materials)||void 0===A?void 0:A.map((N=>W.getMaterialById(N))),textures:null===(n=q.textures)||void 0===n?void 0:n.map((N=>W.getTextureByName(N))),animations:null===(t=q.animations)||void 0===t?void 0:t.map((N=>W.animations.find((q=>q.name===N)))),skeletons:null===(V=q.skeletons)||void 0===V?void 0:V.map((N=>W.getSkeletonByName(N))),Bt:null===(Z=q.Bt)||void 0===Z?void 0:Z.map((N=>W.getParticleSystemById(N))),animationGroups:null===(J=q.animationGroups)||void 0===J?void 0:J.map((N=>W.getAnimationGroupByName(N))),transformNodes:null===(Q=q.transformNodes)||void 0===Q?void 0:Q.map((N=>W.getTransformNodeById(N))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],zV:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};d.assetsContext=C}for(const v in N._userVariables){const q=U(v,N._userVariables,d.assetsContext,W);d.userVariables[v]=q}for(const v in N._connectionValues){const q=U(v,N._connectionValues,d.assetsContext,W);d._setConnectionValueByKey(v,q)}return d}function TC(N,q,C){const d={},U=q.valueParseFunction??OC.b;if(N.config)for(const a in N.config)d[a]=U(a,N.config,q.assetsContainer||q.vq,q.vq);if((0,OC.g)(N.className)){if(!q.pathConverter)throw new Error("Path converter is required for this block");d.pathConverter=q.pathConverter}const W=new C(d);W.uniqueId=N.uniqueId;for(let a=0;a<N.dataInputs.length;a++){const q=W.getDataInput(N.dataInputs[a].name);if(!q)throw new Error("Could not find data input with name "+N.dataInputs[a].name+" in block "+N.className);q.deserialize(N.dataInputs[a])}for(let a=0;a<N.dataOutputs.length;a++){const q=W.getDataOutput(N.dataOutputs[a].name);if(!q)throw new Error("Could not find data output with name "+N.dataOutputs[a].name+" in block "+N.className);q.deserialize(N.dataOutputs[a])}return W.metadata=N.metadata,W.deserialize&&W.deserialize(N),W}function zC(N){const[q,C]=N.split(":");return pC({op:q,extension:C})}function pC(N){var q;let C=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const d=N.extension?null===(q=XC[N.extension])||void 0===q?void 0:q[N.op]:PC[N.op];if(!d&&(Q.c.Warn(`No mapping found for operation ${N.op} and extension ${N.extension||"KHR_interactivity"}`),C)){const q={},C={flows:{}};if(N.inputValueSockets){q.values={};for(const C in N.inputValueSockets)q.values[C]={name:C}}return N.outputValueSockets&&(C.values={},Object.keys(N.outputValueSockets).forEach((N=>{C.values[N]={name:N}}))),{an:[],inputs:q,outputs:C}}return d}function sC(N,q,C){XC[q]||(XC[q]={}),XC[q][N]=C}const XC={BABYLON:{"flow/log":{an:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},PC={"event/onStart":{an:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{an:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{an:["FlowGraphSendCustomEventBlock"],extraProcessor(N,q,C,d,U){if("event/send"!==q.op||!N.configuration||1!==Object.keys(N.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const W=N.configuration.event.value[0];if("number"!==typeof W)throw new Error("Event id should be a number");const a=d.arrays.events[W],F=U[0];return F.config||(F.config={}),F.config.eventId=a.eventId,F.config.eventData=a.eventData,U}},"event/receive":{an:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(N,q){var C;if(!N.configuration)return Q.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const d=N.configuration.event;if(!d)return Q.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const U=d.value[0];if("number"!==typeof U)return Q.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(C=q.events)||void 0===C?void 0:C[U])?{valid:!0}:(Q.c.Error(`Event with id ${U} not found`),{valid:!1,error:`Event with id ${U} not found`})},extraProcessor(N,q,C,d,U){if("event/receive"!==q.op||!N.configuration||1!==Object.keys(N.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const W=N.configuration.event.value[0];if("number"!==typeof W)throw new Error("Event id should be a number");const a=d.arrays.events[W],F=U[0];return F.config||(F.config={}),F.config.eventId=a.eventId,F.config.eventData=a.eventData,U}},"math/e":MC("FlowGraphEBlock"),"math/pi":MC("FlowGraphPIBlock"),"math/inf":MC("FlowGraphInfBlock"),"math/nan":MC("FlowGraphNaNBlock"),"math/abs":MC("FlowGraphAbsBlock"),"math/sign":MC("FlowGraphSignBlock"),"math/trunc":MC("FlowGraphTruncBlock"),"math/floor":MC("FlowGraphFloorBlock"),"math/ceil":MC("FlowGraphCeilBlock"),"math/round":{an:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,q,C,d,U){var W;return(W=U[0]).config||(W.config={}),U[0].config.roundHalfAwayFromZero=!0,U}},"math/fract":MC("FlowGraphFractBlock"),"math/neg":MC("FlowGraphNegationBlock"),"math/add":MC("FlowGraphAddBlock",["a","b"],!0),"math/sub":MC("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{an:["FlowGraphMultiplyBlock"],extraProcessor(N,q,C,d,U){var W;(W=U[0]).config||(W.config={}),U[0].config.useMatrixPerComponent=!0,U[0].config.preventIntegerFloatArithmetic=!0;let a=-1;return Object.keys(N.values||{}).find((q=>{var C;return void 0!==(null===(C=N.values)||void 0===C?void 0:C[q].type)&&(a=N.values[q].type,!0)})),-1!==a&&(U[0].config.type=d.arrays.types[a].flowGraphType),U},validation:N=>N.values?YC(N):{valid:!0}},"math/div":MC("FlowGraphDivideBlock",["a","b"],!0),"math/rem":MC("FlowGraphModuloBlock",["a","b"]),"math/min":MC("FlowGraphMinBlock",["a","b"]),"math/max":MC("FlowGraphMaxBlock",["a","b"]),"math/clamp":MC("FlowGraphClampBlock",["a","b","c"]),"math/saturate":MC("FlowGraphSaturateBlock"),"math/mix":MC("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":MC("FlowGraphEqualityBlock",["a","b"]),"math/lt":MC("FlowGraphLessThanBlock",["a","b"]),"math/le":MC("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":MC("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":MC("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":MC("FlowGraphIsNaNBlock"),"math/isinf":MC("FlowGraphIsInfBlock"),"math/select":{an:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{an:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":MC("FlowGraphSinBlock"),"math/cos":MC("FlowGraphCosBlock"),"math/tan":MC("FlowGraphTanBlock"),"math/asin":MC("FlowGraphASinBlock"),"math/acos":MC("FlowGraphACosBlock"),"math/atan":MC("FlowGraphATanBlock"),"math/atan2":MC("FlowGraphATan2Block",["a","b"]),"math/sinh":MC("FlowGraphSinhBlock"),"math/cosh":MC("FlowGraphCoshBlock"),"math/tanh":MC("FlowGraphTanhBlock"),"math/asinh":MC("FlowGraphASinhBlock"),"math/acosh":MC("FlowGraphACoshBlock"),"math/atanh":MC("FlowGraphATanhBlock"),"math/exp":MC("FlowGraphExponentialBlock"),"math/log":MC("FlowGraphLogBlock"),"math/log2":MC("FlowGraphLog2Block"),"math/log10":MC("FlowGraphLog10Block"),"math/sqrt":MC("FlowGraphSquareRootBlock"),"math/cbrt":MC("FlowGraphCubeRootBlock"),"math/pow":MC("FlowGraphPowerBlock",["a","b"]),"math/length":MC("FlowGraphLengthBlock"),"math/normalize":MC("FlowGraphNormalizeBlock"),"math/dot":MC("FlowGraphDotBlock",["a","b"]),"math/cross":MC("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":MC("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":MC("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{an:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{an:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{an:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{an:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{an:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{an:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{an:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":MC("FlowGraphTransposeBlock"),"math/determinant":MC("FlowGraphDeterminantBlock"),"math/inverse":MC("FlowGraphInvertMatrixBlock"),"math/matmul":MC("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{an:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"yd",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,q,C,d,U,W){const a=U[0].dataInputs.find((N=>"rotationQuaternion"===N.name));if(!a)throw new Error("Rotation quaternion input not found");return W._connectionValues[a.uniqueId]&&(W._connectionValues[a.uniqueId].type="Quaternion"),U}},"math/matDecompose":{an:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"yd"}}}},"math/quatConjugate":MC("FlowGraphConjugateBlock",["a"]),"math/quatMul":{an:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,q,C,d,U){var W;return(W=U[0]).config||(W.config={}),U[0].config.type="Quaternion",U}},"math/quatAngleBetween":MC("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{an:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":MC("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":MC("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{an:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,q,C,d,U){var W;return(W=U[0]).config||(W.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract2x2":{an:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{an:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,q,C,d,U){var W;return(W=U[0]).config||(W.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract3x3":{an:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{an:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,q,C,d,U){var W;return(W=U[0]).config||(W.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract4x4":{an:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{an:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,q,C,d,U,W){var a,F;(F=U[0]).config||(F.config={});const w=U[0].dataInputs[0];return U[0].config.valueType=(null===(a=W._connectionValues[w.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",U}},"math/and":{an:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,q,C,d,U,W){var a,F,w;(w=U[0]).config||(w.config={});const A=U[0].dataInputs[0],n=U[0].dataInputs[1];return U[0].config.valueType=(null===(a=W._connectionValues[A.uniqueId])||void 0===a?void 0:a.type)??(null===(F=W._connectionValues[n.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",U}},"math/or":{an:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,q,C,d,U,W){var a,F,w;(w=U[0]).config||(w.config={});const A=U[0].dataInputs[0],n=U[0].dataInputs[1];return U[0].config.valueType=(null===(a=W._connectionValues[A.uniqueId])||void 0===a?void 0:a.type)??(null===(F=W._connectionValues[n.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",U}},"math/xor":{an:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,q,C,d,U,W){var a,F,w;(w=U[0]).config||(w.config={});const A=U[0].dataInputs[0],n=U[0].dataInputs[1];return U[0].config.valueType=(null===(a=W._connectionValues[A.uniqueId])||void 0===a?void 0:a.type)??(null===(F=W._connectionValues[n.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",U}},"math/asr":MC("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":MC("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":MC("FlowGraphLeadingZerosBlock"),"math/ctz":MC("FlowGraphTrailingZerosBlock"),"math/popcnt":MC("FlowGraphOneBitsCounterBlock"),"math/rad":MC("FlowGraphDegToRadBlock"),"math/deg":MC("FlowGraphRadToDegBlock"),"type/boolToInt":MC("FlowGraphBooleanToInt"),"type/boolToFloat":MC("FlowGraphBooleanToFloat"),"type/intToBool":MC("FlowGraphIntToBoolean"),"type/intToFloat":MC("FlowGraphIntToFloat"),"type/floatToInt":MC("FlowGraphFloatToInt"),"type/floatToBool":MC("FlowGraphFloatToBoolean"),"flow/sequence":{an:["FlowGraphSequenceBlock"],extraProcessor(N,q,C,d,U){const W=U[0];return W.config||(W.config={}),W.config.outputSignalCount=Object.keys(N.flows||[]).length,W.signalOutputs.forEach(((N,q)=>{N.name="out_"+q})),U}},"flow/branch":{an:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{an:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(N){if(N.configuration&&N.configuration.cases){const q=N.configuration.cases.value;if(!q.every((N=>"number"===typeof N&&/^-?\d+$/.test(N.toString()))))return Q.c.Warn("Switch cases should be integers. Using empty array instead."),N.configuration.cases.value=[],{valid:!0};const C=new Set(q);N.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(N,q,C,d,U){if("flow/switch"!==q.op||!N.flows||0===Object.keys(N.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return U[0].signalOutputs.forEach((N=>{"default"!==N.name&&(N.name="out_"+N.name)})),U}},"flow/while":{an:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{an:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(N,q,C,d,U){const W=U[0];return W.config||(W.config={}),W.config.incrementIndexWhenLoopDone=!0,U}},"flow/doN":{an:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{an:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(N,q,C,d,U){if("flow/multiGate"!==q.op||!N.flows||0===Object.keys(N.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const W=U[0];return W.config||(W.config={}),W.config.outputSignalCount=Object.keys(N.flows).length,W.signalOutputs.forEach(((N,q)=>{N.name="out_"+q})),U}},"flow/waitAll":{an:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(N){var q,C;return"number"!==typeof(null===(q=N.configuration)||void 0===q||null===(C=q.inputFlows)||void 0===C?void 0:C.value[0])&&(N.configuration=N.configuration||{inputFlows:{value:[0]}},N.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{an:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{an:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{an:["FlowGraphCancelDelayBlock"]},"variable/get":{an:["FlowGraphGetVariableBlock"],validation(N){var q,C;return null!==(q=N.configuration)&&void 0!==q&&null!==(C=q.variable)&&void 0!==C&&C.value?{valid:!0}:(Q.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(N,q)=>[q.getVariableName(N[0])]}}},"variable/set":{an:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(N,q)=>[q.getVariableName(N[0])]}}},"variable/setMultiple":{an:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(N,q)=>[N[0].map((N=>q.getVariableName(N)))]}},extraProcessor:(N,q,C,d,U)=>(U[0].dataInputs.forEach((N=>{N.name=d.getVariableName(+N.name)})),U)},"variable/interpolate":{an:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(N,q)=>[q.getVariableName(N[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:N=>!0===N[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",iC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",iC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",iC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",iC:"FlowGraphPlayAnimationBlock"},out:{name:"out",iC:"FlowGraphPlayAnimationBlock"},done:{name:"done",iC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(N,q,C,d,U){var W,a,F;const w=U[0],A=null===(W=N.configuration)||void 0===W?void 0:W.variable.value[0];if("number"!==typeof A)throw Q.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const n=d.arrays.staticVariables[A];"undefined"===typeof w.config.animationType.value&&(d.arrays.staticVariables,w.config.animationType.value=(0,KC.H)(n.type));const t=U[4];return t.config||(t.config={}),(a=t.config).variable||(a.variable={}),t.config.variable.value=d.getVariableName(A),(F=U[3]).config||(F.config={}),U}},"pointer/get":{an:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",iC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",iC:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(N,q,C,d,U)=>(U.forEach((N=>{"FlowGraphJsonPointerParserBlock"===N.className&&(N.config||(N.config={}),N.config.outputValue=!0)})),U)},"pointer/set":{an:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",iC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",iC:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(N,q,C,d,U)=>(U.forEach((N=>{"FlowGraphJsonPointerParserBlock"===N.className&&(N.config||(N.config={}),N.config.outputValue=!0)})),U)},"pointer/interpolate":{an:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",iC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",iC:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",iC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",iC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",iC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",iC:"FlowGraphPlayAnimationBlock"},out:{name:"out",iC:"FlowGraphPlayAnimationBlock"},done:{name:"done",iC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(N,q,C,d,U)=>(U.forEach((q=>{"FlowGraphJsonPointerParserBlock"===q.className?(q.config||(q.config={}),q.config.outputValue=!0):"FlowGraphInterpolationBlock"===q.className&&(q.config||(q.config={}),Object.keys(N.values||[]).forEach((C=>{var U;const W=null===(U=N.values)||void 0===U?void 0:U[C];if("value"===C&&W){const N=W.type;void 0!==N&&(q.config.animationType=d.arrays.types[N].flowGraphType)}})))})),U)},"animation/start":{an:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",iC:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(N,q)=>[N[0]*q._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(N,q)=>[N[0]*q._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(N,q,C,d,U,W,a){const F=U[U.length-1];return F.config||(F.config={}),F.config.glTF=a,U}},"animation/stop":{an:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",iC:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(N,q,C,d,U,W,a){const F=U[U.length-1];return F.config||(F.config={}),F.config.glTF=a,U}},"animation/stopAt":{an:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",iC:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(N,q)=>[N[0]*q._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(N,q,C,d,U,W,a){const F=U[U.length-1];return F.config||(F.config={}),F.config.glTF=a,U}},"math/switch":{an:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(N){if(N.configuration&&N.configuration.cases){const q=N.configuration.cases.value;if(!q.every((N=>"number"===typeof N&&/^-?\d+$/.test(N.toString()))))return Q.c.Warn("Switch cases should be integers. Using empty array instead."),N.configuration.cases.value=[],{valid:!0};const C=new Set(q);N.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(N,q,C,d,U){const W=U[0];return W.dataInputs.forEach((N=>{"default"!==N.name&&"case"!==N.name&&(N.name="in_"+N.name)})),W.config||(W.config={}),W.config.treatCasesAsIntegers=!0,U}},"debug/log":{an:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function MC(N){let q=arguments.length>2?arguments[2]:void 0;return{an:[N],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((N,q)=>(N[q]={name:q},N)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(N,C,d,U,W){var a;if(q){(a=W[0]).config||(a.config={}),W[0].config.preventIntegerFloatArithmetic=!0;let q=-1;Object.keys(N.values||{}).find((C=>{var d;return void 0!==(null===(d=N.values)||void 0===d?void 0:d[C].type)&&(q=N.values[C].type,!0)})),-1!==q&&(W[0].config.type=U.arrays.types[q].flowGraphType)}return W},validation:N=>q?YC(N):{valid:!0}}}function YC(N){if(N.values){const q=Object.keys(N.values).map((q=>N.values[q].type)).filter((N=>void 0!==N));if(!q.every((N=>N===q[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}PC["math/compose"]=PC["math/matCompose"],PC["math/decompose"]=PC["math/matDecompose"];var EC=C(11083);const HC={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Jq",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class eC{constructor(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=N,this._gltf=q,this._animationTargetFps=C,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const N of this._interactivityGraph.types)this._types.push(HC[N.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const N of this._interactivityGraph.declarations){const q=pC(N);if(!q)throw Q.c.Error(["No mapping found for declaration",N]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:q,fullOperationName:N.extension?N.op+":"+N.extension:N.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const N of this._interactivityGraph.variables){const q=this._parseVariable(N);this._staticVariables.push(q)}}_parseVariable(N,q){const C=this._types[N.type];if(!C)throw Q.c.Error(["No type found for variable",N]),new Error("Error parsing variables");if(N.value&&N.value.length!==C.length)throw Q.c.Error(["Invalid value length for variable",N,C]),new Error("Error parsing variables");const d=N.value||[];if(!d.length)switch(C.flowGraphType){case"boolean":d.push(!1);break;case"FlowGraphInteger":d.push(0);break;case"number":d.push(NaN);break;case"Vector2":d.push(NaN,NaN);break;case"Jq":d.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":d.fill(NaN,0,4);break;case"Matrix":d.fill(NaN,0,16);break;case"Matrix3D":d.fill(NaN,0,9)}return"number"===C.elementType&&"string"===typeof d[0]&&(d[0]=parseFloat(d[0])),{type:C.flowGraphType,value:q?q(d,this):d}}_parseEvents(){if(this._interactivityGraph.events)for(const N of this._interactivityGraph.events){const q={eventId:N.id||"internalEvent_"+this._internalEventsCounter++};N.values&&(q.eventData=Object.keys(N.values).map((q=>{var C;const d=null===(C=N.values)||void 0===C?void 0:C[q];if(!d)throw Q.c.Error(["No value found for event key",q]),new Error("Error parsing events");const U=this._types[d.type];if(!U)throw Q.c.Error(["No type found for event value",d]),new Error("Error parsing events");const W="undefined"!==typeof d.value?this._parseVariable(d):void 0;return{id:q,type:U.flowGraphType,eventData:!0,value:W}}))),this._events.push(q)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const q of this._interactivityGraph.nodes){if("number"!==typeof q.declaration)throw Q.c.Error(["No declaration found for node",q]),new Error("Error parsing nodes");const C=this._mappings[q.declaration];if(!C)throw Q.c.Error(["No mapping found for node",q]),new Error("Error parsing nodes");if(C.flowGraphMapping.validation){const d=C.flowGraphMapping.validation(q,this._interactivityGraph,this._gltf);var N;if(!d.valid)throw new Error(`Error validating interactivity node ${null===(N=this._interactivityGraph.declarations)||void 0===N?void 0:N[q.declaration].op} - ${d.error}`)}const d=[];for(const N of C.flowGraphMapping.an){const U=this._getEmptyBlock(N,C.fullOperationName);this._parseNodeConfiguration(q,U,C.flowGraphMapping,N),d.push(U)}this._nodes.push({an:d,fullOperationName:C.fullOperationName})}}_getEmptyBlock(N,q){return{uniqueId:(0,EC.d)(),className:N,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:q,metadata:{}}}_parseNodeConfiguration(N,q,C,d){const U=q.config;if(N.configuration){const q=Object.keys(N.configuration);for(const F of q){var W,a;const q=null===(W=N.configuration)||void 0===W?void 0:W[F];if(!q)throw Q.c.Error(["No value found for node configuration",F]),new Error("Error parsing node configuration");const w=null===(a=C.configuration)||void 0===a?void 0:a[F];if(w&&w.iC?w.iC===d:0===C.an.indexOf(d)){const N=(null===w||void 0===w?void 0:w.name)||F;q&&"undefined"!==typeof q.value||"undefined"===typeof(null===w||void 0===w?void 0:w.defaultValue)?q.value.length>=0?U[N]={value:1===q.value.length?q.value[0]:q.value}:Q.c.Warn(["Invalid value for node configuration",q]):U[N]={value:w.defaultValue},w&&w.dataTransformer&&(U[N].value=w.dataTransformer([U[N].value],this)[0])}}}}_parseNodeConnections(N){for(let j=0;j<this._nodes.length;j++){var q;const l=null===(q=this._interactivityGraph.nodes)||void 0===q?void 0:q[j];if(!l)throw Q.c.Error(["No node found for interactivity node",this._nodes[j]]),new Error("Error parsing node connections");const T=this._nodes[j],z=this._mappings[l.declaration];if(!z)throw Q.c.Error(["No mapping found for node",l]),new Error("Error parsing node connections");const p=l.flows||{},s=Object.keys(p).sort();for(const N of s){var C,d,U,W;const q=p[N],A=null===(C=z.flowGraphMapping.outputs)||void 0===C||null===(d=C.flows)||void 0===d?void 0:d[N],n=(null===A||void 0===A?void 0:A.name)||N,t=this._createNewSocketConnection(n,!0);(A&&A.iC&&T.an.find((N=>N.className===A.iC))||T.an[0]).signalOutputs.push(t);const V=q.node,Z=this._nodes[V];if(!Z)throw Q.c.Error(["No node found for input node id",V]),new Error("Error parsing node connections");const J=zC(Z.fullOperationName);if(!J)throw Q.c.Error(["No mapping found for input node",Z]),new Error("Error parsing node connections");let v=null===(U=J.inputs)||void 0===U||null===(W=U.flows)||void 0===W?void 0:W[q.socket||"in"],r=!1;if(!v)for(const N in null===(a=J.inputs)||void 0===a?void 0:a.flows){var a,F,w;if(N.startsWith("[")&&N.endsWith("]"))r=!0,v=null===(F=J.inputs)||void 0===F||null===(w=F.flows)||void 0===w?void 0:w[N]}const O=v?r?v.name.replace("$1",q.socket||""):v.name:q.socket||"in",K=v&&v.iC&&Z.an.find((N=>N.className===v.iC))||Z.an[0];let i=K.signalInputs.find((N=>N.name===O));i||(i=this._createNewSocketConnection(O),K.signalInputs.push(i)),i.connectedPointIds.push(t.uniqueId),t.connectedPointIds.push(i.uniqueId)}const X=l.values||{},P=Object.keys(X);for(const q of P){var A,n;const C=X[q];let d=null===(A=z.flowGraphMapping.inputs)||void 0===A||null===(n=A.values)||void 0===n?void 0:n[q],U=!1;if(!d)for(const N in null===(t=z.flowGraphMapping.inputs)||void 0===t?void 0:t.values){var t,V,Z;if(N.startsWith("[")&&N.endsWith("]"))U=!0,d=null===(V=z.flowGraphMapping.inputs)||void 0===V||null===(Z=V.values)||void 0===Z?void 0:Z[N]}const W=d?U?d.name.replace("$1",q):d.name:q,a=this._createNewSocketConnection(W);if((d&&d.iC&&T.an.find((N=>N.className===d.iC))||T.an[0]).dataInputs.push(a),void 0!==C.value){const q=this._parseVariable(C,d&&d.dataTransformer);N._connectionValues[a.uniqueId]=q}else{if("undefined"===typeof C.node)throw Q.c.Error(["Invalid value for value connection",C]),new Error("Error parsing node connections");{var J,v,r;const N=C.node,q=C.socket||"value",d=this._nodes[N];if(!d)throw Q.c.Error(["No node found for output socket reference",C]),new Error("Error parsing node connections");const U=zC(d.fullOperationName);if(!U)throw Q.c.Error(["No mapping found for output socket reference",C]),new Error("Error parsing node connections");let W=null===(J=U.outputs)||void 0===J||null===(v=J.values)||void 0===v?void 0:v[q],F=!1;if(!W)for(const C in null===(O=U.outputs)||void 0===O?void 0:O.values){var O,K,i;if(C.startsWith("[")&&C.endsWith("]"))F=!0,W=null===(K=U.outputs)||void 0===K||null===(i=K.values)||void 0===i?void 0:i[C]}const w=W?F?W.name.replace("$1",q):null===(r=W)||void 0===r?void 0:r.name:q,A=W&&W.iC&&d.an.find((N=>N.className===W.iC))||d.an[0];let n=A.dataOutputs.find((N=>N.name===w));n||(n=this._createNewSocketConnection(w,!0),A.dataOutputs.push(n)),a.connectedPointIds.push(n.uniqueId),n.connectedPointIds.push(a.uniqueId)}}}if(z.flowGraphMapping.interBlockConnectors)for(const N of z.flowGraphMapping.interBlockConnectors){const q=N.input,C=N.output,d=N.isVariable;this._connectFlowGraphNodes(q,C,T.an[N.inputBlockIndex],T.an[N.outputBlockIndex],d)}if(z.flowGraphMapping.extraProcessor){var I;const q=null===(I=this._interactivityGraph.declarations)||void 0===I?void 0:I[l.declaration];if(!q)throw Q.c.Error(["No declaration found for extra processor",l]),new Error("Error parsing node connections");T.an=z.flowGraphMapping.extraProcessor(l,q,z.flowGraphMapping,this,T.an,N,this._gltf)}}}_createNewSocketConnection(N,q){return{uniqueId:(0,EC.d)(),name:N,_connectionType:q?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(N,q,C,d,U){const W=U?C.dataInputs:C.signalInputs,a=U?d.dataOutputs:d.signalOutputs,F=W.find((q=>q.name===N))||this._createNewSocketConnection(N),w=a.find((N=>N.name===q))||this._createNewSocketConnection(q,!0);W.find((q=>q.name===N))||W.push(F),a.find((N=>N.name===q))||a.push(w),F.connectedPointIds.push(w.uniqueId),w.connectedPointIds.push(F.uniqueId)}getVariableName(N){return"staticVariable_"+N}serializeToFlowGraph(){const N={uniqueId:(0,EC.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(N);for(let q=0;q<this._staticVariables.length;q++){const C=this._staticVariables[q];N._userVariables[this.getVariableName(q)]=C}return{rightHanded:!0,allBlocks:this._nodes.reduce(((N,q)=>N.concat(q.an)),[]),executionContexts:[N]}}}const bC="KHR_interactivity";class oC{constructor(N){this._loader=N,this.name=bC,this.enabled=this._loader.isExtensionUsed(bC),this._pathConverter=(0,S.i)(this._loader.vd),N._skipStartAnimationStep=!0;const q=N.babylonScene;q&&function(N){(0,S.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!N.activeCamera)return new U.Quaternion(NaN,NaN,NaN,NaN);const q=U.Quaternion.FromRotationMatrix(N.activeCamera.getWorldMatrix()).normalize();return N.useRightHandedSystem||(q.w*=-1,q.x*=-1),q},type:"Quaternion",getTarget:()=>N.activeCamera}),(0,S.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!N.activeCamera)return new U.Jq(NaN,NaN,NaN);const q=N.activeCamera.getWorldMatrix().getTranslation();return N.useRightHandedSystem||(q.x*=-1),q},type:"Jq",getTarget:()=>N.activeCamera}),(0,S.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:N=>{var q;return(null===(q=N._babylonAnimationGroup)||void 0===q?void 0:q.isPlaying)??!1},type:"boolean",getTarget:N=>N._babylonAnimationGroup}),(0,S.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:N=>{var q;return((null===(q=N._babylonAnimationGroup)||void 0===q?void 0:q.from)??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup}),(0,S.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:N=>{var q;return((null===(q=N._babylonAnimationGroup)||void 0===q?void 0:q.to)??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup}),(0,S.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:N=>{var q;return((null===(q=N._babylonAnimationGroup)||void 0===q?void 0:q.getCurrentFrame())??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup}),(0,S.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:N=>{var q;return((null===(q=N._babylonAnimationGroup)||void 0===q?void 0:q.getCurrentFrame())??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup})}(q)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var N;if(!this._loader.babylonScene||!this._pathConverter)return;const q=this._loader.babylonScene,C=null===(N=this._loader.vd.extensions)||void 0===N?void 0:N.KHR_interactivity;if(!C)return;const d=new JC.c({vq:q});d.dispatchEventsSynchronously=!1;const U=C.graphs.map((N=>new eC(N,this._loader.vd,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(U.map((async N=>await jC(N,{coordinator:d,pathConverter:this._pathConverter})))),d.start()}}var SC;SC=async()=>(await Promise.resolve().then(C.bind(C,12882))).FlowGraphGLTFDataProvider,QC[`${bC}/${"FlowGraphGLTFDataProvider"}`]=SC,o(bC),b(bC,!0,(N=>new oC(N)));const DC="KHR_node_visibility";(0,S.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:N=>{const q=N._babylonTransformNode;return!q||void 0===q.isVisible||q.isVisible},set:(N,q)=>{var C,d;null===(C=q._primitiveBabylonMeshes)||void 0===C||C.forEach((N=>{N.inheritVisibility=!0})),q._babylonTransformNode&&(q._babylonTransformNode.isVisible=N),null===(d=q._primitiveBabylonMeshes)||void 0===d||d.forEach((q=>{q.isVisible=N}))},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class cC{constructor(N){this.name=DC,this._loader=N,this.enabled=N.isExtensionUsed(DC)}async onReady(){var N;null===(N=this._loader.vd.nodes)||void 0===N||N.forEach((N=>{var q,C,d,U;(null===(q=N._primitiveBabylonMeshes)||void 0===q||q.forEach((N=>{N.inheritVisibility=!0})),null!==(C=N.extensions)&&void 0!==C&&C.KHR_node_visibility)&&(!1===(null===(d=N.extensions)||void 0===d?void 0:d.KHR_node_visibility.visible)&&(N._babylonTransformNode&&(N._babylonTransformNode.isVisible=!1),null===(U=N._primitiveBabylonMeshes)||void 0===U||U.forEach((N=>{N.isVisible=!1}))))}))}dispose(){this._loader=null}}o(DC),b(DC,!0,(N=>new cC(N)));const LC="KHR_node_selectability";sC("event/onSelect",LC,{an:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",iC:"FlowGraphGetVariableBlock",dataTransformer:N=>["pickedMesh_"+N[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",iC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(N,q,C,d,U,W,a){var F,w,A,n,t,V;const Z=U[U.length-1];Z.config=Z.config||{},Z.config.glTF=a;const J=null===(F=N.configuration)||void 0===F||null===(w=F.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===J||"number"!==typeof J)throw new Error("nodeIndex not found in configuration");const Q="pickedMesh_"+J;return U[1].config.variable=Q,W._userVariables[Q]={className:"Mesh",id:null===a||void 0===a||null===(A=a.nodes)||void 0===A||null===(n=A[J]._babylonTransformNode)||void 0===n?void 0:n.id,uniqueId:null===a||void 0===a||null===(t=a.nodes)||void 0===t||null===(V=t[J]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},U}}),(0,S.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:N=>{const q=N._babylonTransformNode;return!q||void 0===q.Mw||q.Mw},set:(N,q)=>{var C;null===(C=q._primitiveBabylonMeshes)||void 0===C||C.forEach((q=>{q.Mw=N}))},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"Mw"],type:"boolean"});class GC{constructor(N){this.name=LC,this._loader=N,this.enabled=N.isExtensionUsed(LC)}async onReady(){var N;null===(N=this._loader.vd.nodes)||void 0===N||N.forEach((N=>{var q,C,d;null!==(q=N.extensions)&&void 0!==q&&q.KHR_node_selectability&&!1===(null===(C=N.extensions)||void 0===C?void 0:C.KHR_node_selectability.selectable)&&(null===(d=N._babylonTransformNode)||void 0===d||d.getChildMeshes().forEach((N=>{N.Mw=!1})))}))}dispose(){this._loader=null}}o(LC),b(LC,!0,(N=>new GC(N)));const hC="KHR_node_hoverability",BC="targetMeshPointerOver_";sC("event/onHoverIn",hC,{an:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",iC:"FlowGraphGetVariableBlock",dataTransformer:N=>[BC+N[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",iC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(N,q,C,d,U,W,a){var F,w,A,n,t,V;const Z=U[U.length-1];Z.config=Z.config||{},Z.config.glTF=a;const J=null===(F=N.configuration)||void 0===F||null===(w=F.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===J||"number"!==typeof J)throw new Error("nodeIndex not found in configuration");const Q=BC+J;return U[1].config.variable=Q,W._userVariables[Q]={className:"Mesh",id:null===a||void 0===a||null===(A=a.nodes)||void 0===A||null===(n=A[J]._babylonTransformNode)||void 0===n?void 0:n.id,uniqueId:null===a||void 0===a||null===(t=a.nodes)||void 0===t||null===(V=t[J]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},U}});const yC="targetMeshPointerOut_";sC("event/onHoverOut",hC,{an:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",iC:"FlowGraphGetVariableBlock",dataTransformer:N=>[yC+N[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",iC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(N,q,C,d,U,W,a){var F,w,A,n,t,V;const Z=U[U.length-1];Z.config=Z.config||{},Z.config.glTF=a;const J=null===(F=N.configuration)||void 0===F||null===(w=F.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===J||"number"!==typeof J)throw new Error("nodeIndex not found in configuration");const Q=yC+J;return U[1].config.variable=Q,W._userVariables[Q]={className:"Mesh",id:null===a||void 0===a||null===(A=a.nodes)||void 0===A||null===(n=A[J]._babylonTransformNode)||void 0===n?void 0:n.id,uniqueId:null===a||void 0===a||null===(t=a.nodes)||void 0===t||null===(V=t[J]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},U}}),(0,S.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:N=>{const q=N._babylonTransformNode;return!q||void 0===q.pointerOverDisableMeshTesting||q.pointerOverDisableMeshTesting},set:(N,q)=>{var C;null===(C=q._primitiveBabylonMeshes)||void 0===C||C.forEach((q=>{q.pointerOverDisableMeshTesting=!N}))},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class RC{constructor(N){this.name=hC,this._loader=N,this.enabled=N.isExtensionUsed(hC)}async onReady(){var N;null===(N=this._loader.vd.nodes)||void 0===N||N.forEach((N=>{var q,C,d;null!==(q=N.extensions)&&void 0!==q&&q.KHR_node_hoverability&&!1===(null===(C=N.extensions)||void 0===C?void 0:C.KHR_node_hoverability.hoverable)&&(null===(d=N._babylonTransformNode)||void 0===d||d.getChildMeshes().forEach((N=>{N.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}o(hC),b(hC,!0,(N=>new RC(N)));const uC="ExtrasAsMetadata";class mC{_assignExtras(N,q){if(q.extras&&Object.keys(q.extras).length>0){const C=N.metadata=N.metadata||{};(C.vd=C.vd||{}).extras=q.extras}}constructor(N){this.name=uC,this.enabled=!0,this._loader=N}dispose(){this._loader=null}loadNodeAsync(N,q,C){return this._loader.loadNodeAsync(N,q,(N=>{this._assignExtras(N,q),C(N)}))}loadCameraAsync(N,q,C){return this._loader.loadCameraAsync(N,q,(N=>{this._assignExtras(N,q),C(N)}))}createMaterial(N,q,C){const d=this._loader.createMaterial(N,q,C);return this._assignExtras(d,q),d}}o(uC),b(uC,!1,(N=>new mC(N)));C(12882)},12768:(N,q,C)=>{"use strict";C.d(q,{c:()=>Y,g:()=>z,k:()=>T,m:()=>p});var d=C(10949),U=C(10945),W=C(12399),a=C(11571),F=C(11541),w=C(11557),A=C(10962),n=C(10995),t=C(11568),V=C(11666),Z=C(11578),J=C(11159);class Q{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Bt=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.zV=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(N){this._environmentTexture=N}getNodes(){let N=[];N=N.concat(this.meshes),N=N.concat(this.lights),N=N.concat(this.cameras),N=N.concat(this.transformNodes);for(const q of this.skeletons)N=N.concat(q.bones);return N}}class v extends Q{}class r{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const N=this.rootNodes;for(const d of N)d.dispose();N.length=0;const q=this.skeletons;for(const d of q)d.dispose();q.length=0;const C=this.animationGroups;for(const d of C)d.dispose();C.length=0}}class O extends Q{constructor(N){super(),this._wasAddedToScene=!1,(N=N||n.e.LastCreatedScene)&&(this.vq=N,this.proceduralTextures=[],N.td.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=N.getEngine().onContextRestoredObservable.add((()=>{for(const N of this.geometries)N._rebuild();for(const N of this.meshes)N._rebuild();for(const N of this.Bt)N.rebuild();for(const N of this.textures)N._rebuild()})))}_topologicalSort(N){const q=new Map;for(const a of N)q.set(a.uniqueId,a);const C={dependsOn:new Map,dependedBy:new Map};for(const a of N){const N=a.uniqueId;C.dependsOn.set(N,new Set),C.dependedBy.set(N,new Set)}for(const a of N){const N=a.uniqueId,d=C.dependsOn.get(N);if(a instanceof t.c){const U=a.sourceMesh;q.has(U.uniqueId)&&(d.add(U.uniqueId),C.dependedBy.get(U.uniqueId).add(N))}const U=C.dependedBy.get(N);for(const W of a.getDescendants()){const d=W.uniqueId;if(q.has(d)){U.add(d);C.dependsOn.get(d).add(N)}}}const d=[],U=[];for(const a of N){const N=a.uniqueId;0===C.dependsOn.get(N).size&&(U.push(a),q.delete(N))}const W=U;for(;W.length>0;){const N=W.shift();d.push(N);const U=C.dependedBy.get(N.uniqueId);for(const d of Array.from(U.values())){const U=C.dependsOn.get(d);U.delete(N.uniqueId),0===U.size&&q.get(d)&&(W.push(q.get(d)),q.delete(d))}}return q.size>0&&(A.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),q.forEach((N=>{A.c.Error(N.name)}))),d}_addNodeAndDescendantsToList(N,q,C,d){if(C&&(!d||d(C))&&!q.has(C.uniqueId)){N.push(C),q.add(C.uniqueId);for(const U of C.getDescendants(!0))this._addNodeAndDescendantsToList(N,q,U,d)}}_isNodeInContainer(N){return N instanceof w.d&&-1!==this.meshes.indexOf(N)||(N instanceof F.b&&-1!==this.transformNodes.indexOf(N)||(N instanceof V.c&&-1!==this.lights.indexOf(N)||N instanceof Z.b&&-1!==this.cameras.indexOf(N)))}_isValidHierarchy(){for(const N of this.meshes)if(N.parent&&!this._isNodeInContainer(N.parent))return A.c.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.transformNodes)if(N.parent&&!this._isNodeInContainer(N.parent))return A.c.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.lights)if(N.parent&&!this._isNodeInContainer(N.parent))return A.c.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.cameras)if(N.parent&&!this._isNodeInContainer(N.parent))return A.c.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const d={},W={},F=new r,w=[],A=[],n={doNotInstantiate:!0,...C},t=[],V=new Set;for(const U of this.transformNodes)null===U.parent&&this._addNodeAndDescendantsToList(t,V,U,n.predicate);for(const U of this.meshes)null===U.parent&&this._addNodeAndDescendantsToList(t,V,U,n.predicate);const Z=this._topologicalSort(t),J=(C,U)=>{if(((q,C)=>{if(d[q.uniqueId]=C.uniqueId,W[C.uniqueId]=C,N&&(C.name=N(q.name)),C instanceof a.b){const N=C;if(N.morphTargetManager){const C=q.morphTargetManager;N.morphTargetManager=C.clone();for(let q=0;q<C.numTargets;q++){const U=C.getTarget(q),a=N.morphTargetManager.getTarget(q);d[U.uniqueId]=a.uniqueId,W[a.uniqueId]=a}}}})(C,U),C.parent){const N=d[C.parent.uniqueId],q=W[N];U.parent=q||C.parent}if(U.position&&C.position&&U.position.U(C.position),U.rotationQuaternion&&C.rotationQuaternion&&U.rotationQuaternion.U(C.rotationQuaternion),U.rotation&&C.rotation&&U.rotation.U(C.rotation),U.yd&&C.yd&&U.yd.U(C.yd),U.material){const a=U;if(a.material)if(q){const q=C.material;if(-1===A.indexOf(q)){let C=q.clone(N?N(q.name):"Clone of "+q.name);if(A.push(q),d[q.uniqueId]=C.uniqueId,W[C.uniqueId]=C,"MultiMaterial"===q.getClassName()){const U=q;for(const q of U.gd)q&&(C=q.clone(N?N(q.name):"Clone of "+q.name),A.push(q),d[q.uniqueId]=C.uniqueId,W[C.uniqueId]=C);U.gd=U.gd.map((N=>N&&W[d[N.uniqueId]]))}}"InstancedMesh"!==a.getClassName()&&(a.material=W[d[q.uniqueId]])}else"MultiMaterial"===a.material.getClassName()?-1===this.vq.multiMaterials.indexOf(a.material)&&this.vq.addMultiMaterial(a.material):-1===this.vq.materials.indexOf(a.material)&&this.vq.addMaterial(a.material)}null===U.parent&&F.rootNodes.push(U)};for(const U of Z)if("InstancedMesh"===U.getClassName()){const N=U,q=N.sourceMesh,C=d[q.uniqueId];J(N,("number"===typeof C?W[C]:q).createInstance(N.name))}else{let N=!0;"SJ"===U.getClassName()||"Node"===U.getClassName()||U.skeleton||!U.getTotalVertices||0===U.getTotalVertices()?N=!1:n.doNotInstantiate&&(N="function"===typeof n.doNotInstantiate?!n.doNotInstantiate(U):!n.doNotInstantiate);const q=N?U.createInstance(`instance of ${U.name}`):U.clone(`Clone of ${U.name}`,null,!0);if(!q)throw new Error(`Could not clone or instantiate node on Asset Container ${U.name}`);J(U,q)}for(const U of this.skeletons){if(n.predicate&&!n.predicate(U))continue;const q=U.clone(N?N(U.name):"Clone of "+U.name);for(const N of this.meshes)if(N.skeleton===U&&!N.isAnInstance){const C=W[d[N.uniqueId]];if(!C||C.isAnInstance)continue;if(C.skeleton=q,-1!==w.indexOf(q))continue;w.push(q);for(const N of q.bones)N._linkedTransformNode&&(N._linkedTransformNode=W[d[N._linkedTransformNode.uniqueId]])}F.skeletons.push(q)}for(const U of this.animationGroups){if(n.predicate&&!n.predicate(U))continue;const q=U.clone(N?N(U.name):"Clone of "+U.name,(N=>W[d[N.uniqueId]]||N));F.animationGroups.push(q)}return F}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.vq.environmentTexture=this.environmentTexture);for(const N of this.vq._serializableComponents)N.addFromContainer(this);this.vq.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const q=[];for(const C of this.cameras)N&&!N(C)||(this.vq.addCamera(C),q.push(C));for(const C of this.lights)N&&!N(C)||(this.vq.addLight(C),q.push(C));for(const C of this.meshes)N&&!N(C)||(this.vq.uA(C),q.push(C));for(const C of this.skeletons)N&&!N(C)||this.vq.addSkeleton(C);for(const C of this.animations)N&&!N(C)||this.vq.addAnimation(C);for(const C of this.animationGroups)N&&!N(C)||this.vq.addAnimationGroup(C);for(const C of this.multiMaterials)N&&!N(C)||this.vq.addMultiMaterial(C);for(const C of this.materials)N&&!N(C)||this.vq.addMaterial(C);for(const C of this.morphTargetManagers)N&&!N(C)||this.vq.addMorphTargetManager(C);for(const C of this.geometries)N&&!N(C)||this.vq.addGeometry(C);for(const C of this.transformNodes)N&&!N(C)||(this.vq.addTransformNode(C),q.push(C));for(const C of this.actionManagers)N&&!N(C)||this.vq.addActionManager(C);for(const C of this.textures)N&&!N(C)||this.vq.addTexture(C);for(const C of this.reflectionProbes)N&&!N(C)||this.vq.addReflectionProbe(C);for(const C of q)C.parent&&-1===this.vq.getNodes().indexOf(C.parent)&&(C.setParent?C.setParent(null):C.parent=null)}removeAllFromScene(){this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.vq.environmentTexture&&(this.vq.environmentTexture=null);for(const N of this.vq._serializableComponents)N.removeFromContainer(this)}removeFromScene(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const q of this.cameras)N&&!N(q)||this.vq.removeCamera(q);for(const q of this.lights)N&&!N(q)||this.vq.removeLight(q);for(const q of this.meshes)N&&!N(q)||this.vq.RA(q,!0);for(const q of this.skeletons)N&&!N(q)||this.vq.removeSkeleton(q);for(const q of this.animations)N&&!N(q)||this.vq.removeAnimation(q);for(const q of this.animationGroups)N&&!N(q)||this.vq.removeAnimationGroup(q);for(const q of this.multiMaterials)N&&!N(q)||this.vq.removeMultiMaterial(q);for(const q of this.materials)N&&!N(q)||this.vq.removeMaterial(q);for(const q of this.morphTargetManagers)N&&!N(q)||this.vq.removeMorphTargetManager(q);for(const q of this.geometries)N&&!N(q)||this.vq.removeGeometry(q);for(const q of this.transformNodes)N&&!N(q)||this.vq.removeTransformNode(q);for(const q of this.actionManagers)N&&!N(q)||this.vq.removeActionManager(q);for(const q of this.textures)N&&!N(q)||this.vq.removeTexture(q);for(const q of this.reflectionProbes)N&&!N(q)||this.vq.removeReflectionProbe(q)}dispose(){const N=this.cameras.slice(0);for(const Z of N)Z.dispose();this.cameras.length=0;const q=this.lights.slice(0);for(const Z of q)Z.dispose();this.lights.length=0;const C=this.meshes.slice(0);for(const Z of C)Z.dispose();this.meshes.length=0;const d=this.skeletons.slice(0);for(const Z of d)Z.dispose();this.skeletons.length=0;const U=this.animationGroups.slice(0);for(const Z of U)Z.dispose();this.animationGroups.length=0;const W=this.multiMaterials.slice(0);for(const Z of W)Z.dispose();this.multiMaterials.length=0;const a=this.materials.slice(0);for(const Z of a)Z.dispose();this.materials.length=0;const F=this.geometries.slice(0);for(const Z of F)Z.dispose();this.geometries.length=0;const w=this.transformNodes.slice(0);for(const Z of w)Z.dispose();this.transformNodes.length=0;const A=this.actionManagers.slice(0);for(const Z of A)Z.dispose();this.actionManagers.length=0;const n=this.textures.slice(0);for(const Z of n)Z.dispose();this.textures.length=0;const t=this.reflectionProbes.slice(0);for(const Z of t)Z.dispose();this.reflectionProbes.length=0;const V=this.morphTargetManagers.slice(0);for(const Z of V)Z.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const Z of this.vq._serializableComponents)Z.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.vq.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(N,q,C){if(N&&q)for(const d of N){let N=!0;if(C)for(const q of C)if(d===q){N=!1;break}N&&(q.push(d),d._parentContainer=this)}}moveAllFromScene(N){this._wasAddedToScene=!1,void 0===N&&(N=new v);for(const q in this)Object.prototype.hasOwnProperty.call(this,q)&&(this[q]=this[q]||("_environmentTexture"===q?null:[]),this._moveAssets(this.vq[q],this[q],N[q]));this.environmentTexture=this.vq.environmentTexture,this.removeAllFromScene()}createRootMesh(){const N=new a.b("assetContainerRootMesh",this.vq);for(const q of this.meshes)q.parent||N.addChild(q);return this.meshes.unshift(N),N}mergeAnimationsTo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.e.LastCreatedScene,q=arguments.length>1?arguments[1]:void 0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!N)return A.c.Error("No scene available to merge animations to"),[];const d=C||(q=>{let C=null;const d=q.animations.length?q.animations[0].targetProperty:"",U=q.name.split(".").join("").split("_primitive")[0];switch(d){case"position":case"rotationQuaternion":C=N.getTransformNodeByName(q.name)||N.getTransformNodeByName(U);break;case"influence":C=N.getMorphTargetByName(q.name)||N.getMorphTargetByName(U);break;default:C=N.getNodeByName(q.name)||N.getNodeByName(U)}return C}),U=this.getNodes();for(const F of U){const N=d(F);if(null!==N){for(const q of F.animations){const C=N.animations.filter((N=>N.targetProperty===q.targetProperty));for(const q of C){const C=N.animations.indexOf(q,0);C>-1&&N.animations.splice(C,1)}}N.animations=N.animations.concat(F.animations)}}const W=[],a=this.animationGroups.slice();for(const F of a){W.push(F.clone(F.name,d));for(const N of F.animatables)N.stop()}for(const F of q){const q=d(F.target);q&&(N.beginAnimation(q,F.fromFrame,F.toFrame,F.loopAnimation,F.speedRatio,F.onAnimationEnd?F.onAnimationEnd:void 0,void 0,!0,void 0,F.onAnimationLoop?F.onAnimationLoop:void 0),N.stopAnimation(F.target))}return W}populateRootNodes(){this.rootNodes.length=0;for(const N of this.meshes)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N);for(const N of this.transformNodes)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N);for(const N of this.lights)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N);for(const N of this.cameras)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)}addAllAssetsToContainer(N){if(!N)return;const q=[],C=new Set;for(q.push(N);q.length>0;){const N=q.pop();if(N instanceof a.b?(N.ed&&-1===this.geometries.indexOf(N.ed)&&this.geometries.push(N.ed),this.meshes.push(N)):N instanceof t.c?this.meshes.push(N):N instanceof F.b?this.transformNodes.push(N):N instanceof V.c?this.lights.push(N):N instanceof Z.b&&this.cameras.push(N),N instanceof w.d){if(N.material&&-1===this.materials.indexOf(N.material)){this.materials.push(N.material);for(const q of N.material.getActiveTextures())-1===this.textures.indexOf(q)&&this.textures.push(q)}N.skeleton&&-1===this.skeletons.indexOf(N.skeleton)&&this.skeletons.push(N.skeleton),N.morphTargetManager&&-1===this.morphTargetManagers.indexOf(N.morphTargetManager)&&this.morphTargetManagers.push(N.morphTargetManager)}for(const d of N.getChildren())C.has(d)||q.push(d);C.add(N)}this.populateRootNodes()}_getByTags(N,q,C){if(void 0===q)return N;const d=[];for(const U in N){const W=N[U];J.d&&J.d.MatchesQuery(W,q)&&(!C||C(W))&&d.push(W)}return d}getMeshesByTags(N,q){return this._getByTags(this.meshes,N,q)}getCamerasByTags(N,q){return this._getByTags(this.cameras,N,q)}getLightsByTags(N,q){return this._getByTags(this.lights,N,q)}getMaterialsByTags(N,q){return this._getByTags(this.materials,N,q).concat(this._getByTags(this.multiMaterials,N,q))}getTransformNodesByTags(N,q){return this._getByTags(this.transformNodes,N,q)}}var K=C(11011);class i{constructor(N){this.byteOffset=0,this.buffer=N}async loadAsync(N){const q=await this.buffer.readAsync(this.byteOffset,N);this._dataView=new DataView(q.buffer,q.byteOffset,q.byteLength),this._dataByteOffset=0}readUint32(){const N=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,N}readUint8Array(N){const q=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,N);return this._dataByteOffset+=N,this.byteOffset+=N,q}readString(N){return(0,K.g)(this.readUint8Array(N))}skipBytes(N){this._dataByteOffset+=N,this.byteOffset+=N}}var I=C(12773);const j="Z2xURg",l={name:"vd",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:N=>-1!==N.indexOf("asset")&&-1!==N.indexOf("version")||N.startsWith("data:base64,"+j)||N.startsWith("data:;base64,"+j)||N.startsWith("data:application/octet-stream;base64,"+j)||N.startsWith("data:model/gltf-binary;base64,"+j)};var T,z,p,s=C(11e3),X=C(11009);function P(N,q,C){try{return Promise.resolve(new Uint8Array(N,q,C))}catch(d){return Promise.reject(d)}}!function(N){N[N.AUTO=0]="AUTO",N[N.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(T||(T={})),function(N){N[N.NONE=0]="NONE",N[N.FIRST=1]="FIRST",N[N.ALL=2]="ALL"}(z||(z={})),function(N){N[N.LOADING=0]="LOADING",N[N.READY=1]="READY",N[N.COMPLETE=2]="COMPLETE"}(p||(p={}));class M{constructor(){this.coordinateSystemMode=T.AUTO,this.animationStartMode=z.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=N=>Promise.resolve(N),this.extensionOptions={}}U(N){N&&(this.onParsed=N.onParsed,this.coordinateSystemMode=N.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=N.animationStartMode??this.animationStartMode,this.loadNodeAnimations=N.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=N.loadSkins??this.loadSkins,this.loadMorphTargets=N.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=N.compileMaterials??this.compileMaterials,this.useClipPlane=N.useClipPlane??this.useClipPlane,this.compileShadowGenerators=N.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=N.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=N.useRangeRequests??this.useRangeRequests,this.createInstances=N.createInstances??this.createInstances,this.alwaysComputeBoundingBox=N.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=N.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=N.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=N.skipMaterials??this.skipMaterials,this.useSRGBBuffers=N.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=N.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=N.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=N.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=N.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=N.customRootNode,this.onMeshLoaded=N.onMeshLoaded,this.onSkinLoaded=N.onSkinLoaded,this.onTextureLoaded=N.onTextureLoaded,this.onMaterialLoaded=N.onMaterialLoaded,this.onCameraLoaded=N.onCameraLoaded,this.extensionOptions=N.extensionOptions??this.extensionOptions)}}class Y extends M{constructor(N){super(),this.onParsedObservable=new d.b,this.onMeshLoadedObservable=new d.b,this.onSkinLoadedObservable=new d.b,this.onTextureLoadedObservable=new d.b,this.onMaterialLoadedObservable=new d.b,this.onCameraLoadedObservable=new d.b,this.onCompleteObservable=new d.b,this.onErrorObservable=new d.b,this.td=new d.b,this.onExtensionLoadedObservable=new d.b,this.validate=!1,this.onValidatedObservable=new d.b,this._loader=null,this._state=null,this._requests=new Array,this.name=l.name,this.extensions=l.extensions,this.onLoaderStateChangedObservable=new d.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.U(N)}set onParsed(N){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),N&&(this._onParsedObserver=this.onParsedObservable.add(N))}set onMeshLoaded(N){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),N&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(N))}set onSkinLoaded(N){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),N&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((q=>N(q.node,q.skinnedNode))))}set onTextureLoaded(N){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),N&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(N))}set onMaterialLoaded(N){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),N&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(N))}set onCameraLoaded(N){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),N&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(N))}set onComplete(N){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(N)}set onError(N){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(N)}set onDispose(N){this._onDisposeObserver&&this.td.remove(this._onDisposeObserver),this._onDisposeObserver=this.td.add(N)}set onExtensionLoaded(N){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(N)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(N){this._loggingEnabled!==N&&(this._loggingEnabled=N,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(N){this._capturePerformanceCounters!==N&&(this._capturePerformanceCounters=N,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(N){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(N)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const N of this._requests)N.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=N=>Promise.resolve(N),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.td.notifyObservers(void 0),this.td.clear()}loadFile(N,q,C,W,a,F,w,n){if(ArrayBuffer.isView(q))return this._loadBinary(N,q,C,W,w,n),null;this._progressCallback=a;const t=q.name||U.Tools.GetFilename(q);if(F){if(this.useRangeRequests){this.validate&&A.c.Warn("glTF validation is not supported when range requests are enabled");const C={abort:()=>{},onCompleteObservable:new d.b},U={readAsync:(C,d)=>new Promise(((U,W)=>{this._loadFile(N,q,(N=>{U(new Uint8Array(N))}),!0,(N=>{W(N)}),(N=>{N.setRequestHeader("Range",`bytes=${C}-${C+d-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new i(U)).then((N=>{C.onCompleteObservable.notifyObservers(C),W(N)}),w?N=>w(void 0,N):void 0),C}return this._loadFile(N,q,(q=>{this._validate(N,new Uint8Array(q,0,q.byteLength),C,t),this._unpackBinaryAsync(new i({readAsync:(N,C)=>P(q,N,C),byteLength:q.byteLength})).then((N=>{W(N)}),w?N=>w(void 0,N):void 0)}),!0,w)}return this._loadFile(N,q,(q=>{try{this._validate(N,q,C,t),W({json:this._parseJson(q)})}catch{w&&w()}}),!1,w)}_loadBinary(N,q,C,d,U,W){this._validate(N,new Uint8Array(q.buffer,q.byteOffset,q.byteLength),C,W),this._unpackBinaryAsync(new i({readAsync:(N,C)=>function(N,q,C){try{if(q<0||q>=N.byteLength)throw new RangeError("Offset is out of range.");if(q+C>N.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(N.buffer,N.byteOffset+q,C))}catch(d){return Promise.reject(d)}}(q,N,C),byteLength:q.byteLength})).then((N=>{d(N)}),U?N=>U(void 0,N):void 0)}importMeshAsync(N,q,C,d,U,W){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(C),this.onParsedObservable.clear(),this._log(`Loading ${W||""}`),this._loader=this._getLoader(C),this._loader.importMeshAsync(N,q,null,C,d,U,W))))}loadAsync(N,q,C,d,U){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(q),this.onParsedObservable.clear(),this._log(`Loading ${U||""}`),this._loader=this._getLoader(q),this._loader.loadAsync(N,q,C,d,U))))}loadAssetContainerAsync(N,q,C,d,U){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(q),this.onParsedObservable.clear(),this._log(`Loading ${U||""}`),this._loader=this._getLoader(q);const W=new O(N),a=[];this.onMaterialLoadedObservable.add((N=>{a.push(N)}));const F=[];this.onTextureLoadedObservable.add((N=>{F.push(N)}));const w=[];this.onCameraLoadedObservable.add((N=>{w.push(N)}));const A=[];return this.onMeshLoadedObservable.add((N=>{N.morphTargetManager&&A.push(N.morphTargetManager)})),this._loader.importMeshAsync(null,N,W,q,C,d,U).then((N=>(Array.prototype.push.apply(W.geometries,N.geometries),Array.prototype.push.apply(W.meshes,N.meshes),Array.prototype.push.apply(W.Bt,N.Bt),Array.prototype.push.apply(W.skeletons,N.skeletons),Array.prototype.push.apply(W.animationGroups,N.animationGroups),Array.prototype.push.apply(W.materials,a),Array.prototype.push.apply(W.textures,F),Array.prototype.push.apply(W.lights,N.lights),Array.prototype.push.apply(W.transformNodes,N.transformNodes),Array.prototype.push.apply(W.cameras,w),Array.prototype.push.apply(W.morphTargetManagers,A),W)))}))}canDirectLoad(N){return l.canDirectLoad(N)}directLoad(N,q){if(q.startsWith("base64,"+j)||q.startsWith(";base64,"+j)||q.startsWith("application/octet-stream;base64,"+j)||q.startsWith("model/gltf-binary;base64,"+j)){const C=(0,s.b)(q);return this._validate(N,new Uint8Array(C,0,C.byteLength)),this._unpackBinaryAsync(new i({readAsync:(N,q)=>P(C,N,q),byteLength:C.byteLength}))}return this._validate(N,q),Promise.resolve({json:this._parseJson(q)})}createPlugin(N){return new Y(N[l.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((N,q)=>{this.onCompleteObservable.addOnce((()=>{N()})),this.onErrorObservable.addOnce((N=>{q(N)}))}))}_setState(N){this._state!==N&&(this._state=N,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(p[this._state]))}_loadFile(N,q,C,d,U,W){const a=N._loadFile(q,C,(N=>{this._onProgress(N,a)}),!0,d,U,W);return a.onCompleteObservable.add((()=>{a._lengthComputable=!0,a._total=a._loaded})),this._requests.push(a),a}_onProgress(N,q){if(!this._progressCallback)return;q._lengthComputable=N.lengthComputable,q._loaded=N.loaded,q._total=N.total;let C=!0,d=0,U=0;for(const W of this._requests){if(void 0===W._lengthComputable||void 0===W._loaded||void 0===W._total)return;C=C&&W._lengthComputable,d+=W._loaded,U+=W._total}this._progressCallback({lengthComputable:C,loaded:d,total:C?U:0})}_validate(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),I.b.ValidateAsync(q,C,d,(q=>this.preprocessUrlAsync(C+q).then((q=>N._loadFileAsync(q,void 0,!0,!0).then((N=>new Uint8Array(N,0,N.byteLength))))))).then((N=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(N),this.onValidatedObservable.clear()}),(N=>{this._endPerformanceCounter("Validate JSON"),U.Tools.Warn(`Failed to validate: ${N.message}`),this.onValidatedObservable.clear()})))}_getLoader(N){const q=N.json.asset||{};this._log(`Asset version: ${q.version}`),q.minVersion&&this._log(`Asset minimum version: ${q.minVersion}`),q.generator&&this._log(`Asset generator: ${q.generator}`);const C=Y._parseVersion(q.version);if(!C)throw new Error("Invalid version: "+q.version);if(void 0!==q.minVersion){const N=Y._parseVersion(q.minVersion);if(!N)throw new Error("Invalid minimum version: "+q.minVersion);if(Y._compareVersion(N,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+q.minVersion)}const d={1:Y._CreateGLTF1Loader,2:Y._CreateGLTF2Loader}[C.major];if(!d)throw new Error("Unsupported version: "+q.version);return d(this)}_parseJson(N){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${N.length}`);const q=JSON.parse(N);return this._endPerformanceCounter("Parse JSON"),q}_unpackBinaryAsync(N){return this._startPerformanceCounter("Unpack Binary"),N.loadAsync(20).then((()=>{const q=N.readUint32();if(1179937895!==q)throw new X.h("Unexpected magic: "+q,X.e.GLTFLoaderUnexpectedMagicError);const C=N.readUint32();this.loggingEnabled&&this._log(`Binary version: ${C}`);const d=N.readUint32();let U;switch(this.useRangeRequests||d===N.buffer.byteLength||A.c.Warn(`Length in header does not match actual data length: ${d} != ${N.buffer.byteLength}`),C){case 1:U=this._unpackBinaryV1Async(N,d);break;case 2:U=this._unpackBinaryV2Async(N,d);break;default:throw new Error("Unsupported version: "+C)}return this._endPerformanceCounter("Unpack Binary"),U}))}_unpackBinaryV1Async(N,q){const C=N.readUint32(),d=N.readUint32();if(0!==d)throw new Error(`Unexpected content format: ${d}`);const U=q-N.byteOffset,W={json:this._parseJson(N.readString(C)),bin:null};if(0!==U){const q=N.byteOffset;W.bin={readAsync:(C,d)=>N.buffer.readAsync(q+C,d),byteLength:U}}return Promise.resolve(W)}_unpackBinaryV2Async(N,q){const C=1313821514,d=5130562,U=N.readUint32();if(N.readUint32()!==C)throw new Error("First chunk format is not JSON");return N.byteOffset+U===q?N.loadAsync(U).then((()=>({json:this._parseJson(N.readString(U)),bin:null}))):N.loadAsync(U+8).then((()=>{const W={json:this._parseJson(N.readString(U)),bin:null},a=()=>{const U=N.readUint32();switch(N.readUint32()){case C:throw new Error("Unexpected JSON chunk");case d:{const q=N.byteOffset;W.bin={readAsync:(C,d)=>N.buffer.readAsync(q+C,d),byteLength:U},N.skipBytes(U);break}default:N.skipBytes(U)}return N.byteOffset!==q?N.loadAsync(8).then(a):Promise.resolve(W)};return a()}))}static _parseVersion(N){if("1.0"===N||"1.0.1"===N)return{major:1,minor:0};const q=(N+"").match(/^(\d+)\.(\d+)/);return q?{major:parseInt(q[1]),minor:parseInt(q[2])}:null}static _compareVersion(N,q){return N.major>q.major?1:N.major<q.major?-1:N.minor>q.minor?1:N.minor<q.minor?-1:0}_logOpen(N){this._log(N),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(N){const q=Y._logSpaces.substring(0,2*this._logIndentLevel);A.c.Log(`${q}${N}`)}_logDisabled(N){}_startPerformanceCounterEnabled(N){U.Tools.StartPerformanceCounter(N)}_startPerformanceCounterDisabled(N){}_endPerformanceCounterEnabled(N){U.Tools.EndPerformanceCounter(N)}_endPerformanceCounterDisabled(N){}}Y.IncrementalLoading=!0,Y.HomogeneousCoordinates=!1,Y._logSpaces="                                ",(0,W.d)(new Y)},12773:(N,q,C)=>{"use strict";C.d(q,{b:()=>a});var d=C(10945);function U(N,q,C,d){const U={externalResourceFunction:d};return C&&(U.uri="file:"===q?C:q+C),ArrayBuffer.isView(N)?GLTFValidator.validateBytes(N,U):GLTFValidator.validateString(N,U)}function W(){const N=[];onmessage=q=>{const C=q.data;switch(C.id){case"init":importScripts(C.url);break;case"validate":U(C.data,C.rootUrl,C.fileName,(q=>new Promise(((C,d)=>{const U=N.length;N.push({resolve:C,reject:d}),postMessage({id:"getExternalResource",index:U,uri:q})})))).then((N=>{postMessage({id:"validate.resolve",value:N})}),(N=>{postMessage({id:"validate.reject",reason:N})}));break;case"getExternalResource.resolve":N[C.index].resolve(C.value);break;case"getExternalResource.reject":N[C.index].reject(C.reason)}}}class a{static ValidateAsync(N,q,C,a){return"function"===typeof Worker?new Promise(((F,w)=>{const A=`${U}(${W})()`,n=URL.createObjectURL(new Blob([A],{type:"application/javascript"})),t=new Worker(n),V=N=>{t.removeEventListener("error",V),t.removeEventListener("message",Z),w(N)},Z=N=>{const q=N.data;switch(q.id){case"getExternalResource":a(q.uri).then((N=>{t.postMessage({id:"getExternalResource.resolve",index:q.index,value:N},[N.buffer])}),(N=>{t.postMessage({id:"getExternalResource.reject",index:q.index,reason:N})}));break;case"validate.resolve":t.removeEventListener("error",V),t.removeEventListener("message",Z),F(q.value),t.terminate();break;case"validate.reject":t.removeEventListener("error",V),t.removeEventListener("message",Z),w(q.reason),t.terminate()}};if(t.addEventListener("error",V),t.addEventListener("message",Z),t.postMessage({id:"init",url:d.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(N)){const d=N.slice();t.postMessage({id:"validate",data:d,rootUrl:q,fileName:C},[d.buffer])}else t.postMessage({id:"validate",data:N,rootUrl:q,fileName:C})})):(this._LoadScriptPromise||(this._LoadScriptPromise=d.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>U(N,q,C,a))))}}a.Configuration={url:`${d.Tools._DefaultCdnUrl}/gltf_validator.js`}},13286:(N,q,C)=>{"use strict";C.d(q,{c:()=>l});var d=C(11110),U=C(11114),W=C(11155),a=C(11122),F=C(11515),w=C(11441),A=C(11199),n=C(11364),t=C(11076),V=C(11036);C(12527),C(12434),C(12449),C(12441),C(12456),C(12462),C(12464);const Z="imageProcessingCompatibility",J="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";V.c.IncludesShadersStore[Z]||(V.c.IncludesShadersStore[Z]=J);const Q="skyPixelShader",v="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";V.c.ShadersStore[Q]||(V.c.ShadersStore[Q]=v);C(12539),C(12471),C(12477),C(12488),C(12482);const r="skyVertexShader",O="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";V.c.ShadersStore[r]||(V.c.ShadersStore[r]=O);var K=C(11437),i=C(11494),I=C(11487);class j extends F.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class l extends w.d{constructor(N,q){super(N,q),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new a.Jq(0,100,0),this.useSunPosition=!1,this.cameraOffset=a.Jq.Zero(),this.up=a.Jq.Up(),this.dithering=!1,this._cameraPosition=a.Jq.Zero(),this._skyOrientation=new a.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(N,q){const C=q._drawWrapper;if(this.isFrozen&&C.effect&&C._wasPreviouslyReady)return!0;q.materialDefines||(q.materialDefines=new j);const d=q.materialDefines,U=this.lN();if(this._isReadyForSubMesh(q))return!0;if((0,I.P)(N,U,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,d),(0,I.J)(N,d,!0,!1),d.IMAGEPROCESSINGPOSTPROCESS!==U.imageProcessingConfiguration.applyByPostProcess&&d.markAsMiscDirty(),d.DITHER!==this.dithering&&d.markAsMiscDirty(),d.isDirty){d.markAsProcessed(),U.resetCachedMaterial();const N=new K.b;d.FOG&&N.addFallback(1,"FOG"),d.IMAGEPROCESSINGPOSTPROCESS=U.imageProcessingConfiguration.applyByPostProcess,d.DITHER=this.dithering;const C=[A.g.PositionKind];d.VERTEXCOLOR&&C.push(A.g.ColorKind);const W="sky",a=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,i.c)(a);const F=d.toString();q.setEffect(U.getEngine().createEffect(W,C,a,[],F,N,this.onCompiled,this.onError),d,this._materialContext)}return!(!q.effect||!q.effect.isReady())&&(d._renderId=U.getRenderId(),C._wasPreviouslyReady=!0,!0)}bindForSubMesh(N,q,C){const d=this.lN(),U=C.materialDefines;if(!U)return;const W=C.effect;if(!W)return;this._activeEffect=W,this.bindOnlyWorldMatrix(N),this._activeEffect.setMatrix("viewProjection",d.getTransformMatrix()),this._mustRebind(d,W,C)&&((0,i.d)(W,this,d),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,I.n)(U,W,d)),d.fogEnabled&&q.applyFog&&d.fogMode!==n.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",d.getViewMatrix()),(0,I.g)(d,q,this._activeEffect);const F=d.activeCamera;if(F){const N=F.getWorldMatrix();this._cameraPosition.x=N.m[12],this._cameraPosition.y=N.m[13],this._cameraPosition.z=N.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const N=Math.PI*(this.inclination-.5),q=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(q)*Math.cos(N),this.sunPosition.y=this.distance*Math.sin(-N),this.sunPosition.z=this.distance*Math.sin(q)*Math.cos(N),a.Quaternion.FromUnitVectorsToRef(a.Jq.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(q,this._activeEffect,C)}getAnimatables(){return[]}dispose(N){super.dispose(N)}clone(N){return W.d.Clone((()=>new l(N,this.lN())),this)}serialize(){const N=super.serialize();return N.customType="BABYLON.SkyMaterial",N}getClassName(){return"SkyMaterial"}static Parse(N,q,C){return W.d.Parse((()=>new l(N.name,q)),N,q,C)}}(0,d.d)([(0,U.O)()],l.prototype,"luminance",void 0),(0,d.d)([(0,U.O)()],l.prototype,"turbidity",void 0),(0,d.d)([(0,U.O)()],l.prototype,"rayleigh",void 0),(0,d.d)([(0,U.O)()],l.prototype,"mieCoefficient",void 0),(0,d.d)([(0,U.O)()],l.prototype,"mieDirectionalG",void 0),(0,d.d)([(0,U.O)()],l.prototype,"distance",void 0),(0,d.d)([(0,U.O)()],l.prototype,"inclination",void 0),(0,d.d)([(0,U.O)()],l.prototype,"azimuth",void 0),(0,d.d)([(0,U.N)()],l.prototype,"sunPosition",void 0),(0,d.d)([(0,U.O)()],l.prototype,"useSunPosition",void 0),(0,d.d)([(0,U.N)()],l.prototype,"cameraOffset",void 0),(0,d.d)([(0,U.N)()],l.prototype,"up",void 0),(0,d.d)([(0,U.O)()],l.prototype,"dithering",void 0),(0,t.h)("BABYLON.SkyMaterial",l)},11815:(N,q,C)=>{"use strict";function d(N,q){q.headers=N.headers||{},q.statusMessage=N.statusText,q.statusCode=N.status,q.data=N.response}function U(N,q,C){return new Promise((function(U,W){C=C||{};var a,F,w,A=new XMLHttpRequest,n=C.body,t=C.headers||{};for(a in C.timeout&&(A.timeout=C.timeout),A.ontimeout=A.onerror=function(N){N.timeout="timeout"==N.type,W(N)},A.open(N,q.href||q),A.onload=function(){for(w=A.getAllResponseHeaders().trim().split(/[\r\n]+/),d(A,A);F=w.shift();)F=F.split(": "),A.headers[F.shift().toLowerCase()]=F.join(": ");if((F=A.headers["content-type"])&&~F.indexOf("application/json"))try{A.data=JSON.parse(A.data,C.reviver)}catch(N){return d(A,N),W(N)}(A.status>=400?W:U)(A)},typeof FormData<"u"&&n instanceof FormData||n&&"object"==typeof n&&(t["content-type"]="application/json",n=JSON.stringify(n)),A.withCredentials=!!C.withCredentials,t)A.setRequestHeader(a,t[a]);A.send(n)}))}C.r(q),C.d(q,{del:()=>w,get:()=>W,patch:()=>F,post:()=>a,put:()=>A,send:()=>U});var W=U.bind(U,"GET"),a=U.bind(U,"POST"),F=U.bind(U,"PATCH"),w=U.bind(U,"DELETE"),A=U.bind(U,"PUT")},13402:(N,q,C)=>{"use strict";C.d(q,{d:()=>t});const d=.5*(Math.sqrt(3)-1),U=(3-Math.sqrt(3))/6,W=1/3,a=1/6,F=(Math.sqrt(5)-1)/4,w=(5-Math.sqrt(5))/20,A=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),n=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const t=class{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const q="function"==typeof N?N:function(N){let q=0,C=0,d=0,U=1;const W=function(){let N=4022871197;return function(q){q=q.toString();for(let C=0;C<q.length;C++){N+=q.charCodeAt(C);let d=.02519603282416938*N;N=d>>>0,d-=N,d*=N,N=d>>>0,d-=N,N+=4294967296*d}return 2.3283064365386963e-10*(N>>>0)}}();q=W(" "),C=W(" "),d=W(" "),q-=W(N),q<0&&(q+=1);C-=W(N),C<0&&(C+=1);d-=W(N),d<0&&(d+=1);return function(){const N=2091639*q+2.3283064365386963e-10*U;return q=C,C=d,d=N-(U=0|N)}}(N);this.p=function(N){const q=new Uint8Array(256);for(let C=0;C<256;C++)q[C]=C;for(let C=0;C<255;C++){const d=C+~~(N()*(256-C)),U=q[C];q[C]=q[d],q[d]=U}return q}(q),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let C=0;C<512;C++)this.perm[C]=this.p[255&C],this.permMod12[C]=this.perm[C]%12}noise2D(N,q){const C=this.permMod12,W=this.perm;let a=0,F=0,w=0;const n=(N+q)*d,t=Math.floor(N+n),V=Math.floor(q+n),Z=(t+V)*U,J=N-(t-Z),Q=q-(V-Z);let v,r;J>Q?(v=1,r=0):(v=0,r=1);const O=J-v+U,K=Q-r+U,i=J-1+2*U,I=Q-1+2*U,j=255&t,l=255&V;let T=.5-J*J-Q*Q;if(T>=0){const N=3*C[j+W[l]];T*=T,a=T*T*(A[N]*J+A[N+1]*Q)}let z=.5-O*O-K*K;if(z>=0){const N=3*C[j+v+W[l+r]];z*=z,F=z*z*(A[N]*O+A[N+1]*K)}let p=.5-i*i-I*I;if(p>=0){const N=3*C[j+1+W[l+1]];p*=p,w=p*p*(A[N]*i+A[N+1]*I)}return 70*(a+F+w)}noise3D(N,q,C){const d=this.permMod12,U=this.perm;let F,w,n,t;const V=(N+q+C)*W,Z=Math.floor(N+V),J=Math.floor(q+V),Q=Math.floor(C+V),v=(Z+J+Q)*a,r=N-(Z-v),O=q-(J-v),K=C-(Q-v);let i,I,j,l,T,z;r>=O?O>=K?(i=1,I=0,j=0,l=1,T=1,z=0):r>=K?(i=1,I=0,j=0,l=1,T=0,z=1):(i=0,I=0,j=1,l=1,T=0,z=1):O<K?(i=0,I=0,j=1,l=0,T=1,z=1):r<K?(i=0,I=1,j=0,l=0,T=1,z=1):(i=0,I=1,j=0,l=1,T=1,z=0);const p=r-i+a,s=O-I+a,X=K-j+a,P=r-l+2*a,M=O-T+2*a,Y=K-z+2*a,E=r-1+.5,H=O-1+.5,e=K-1+.5,b=255&Z,o=255&J,S=255&Q;let D=.6-r*r-O*O-K*K;if(D<0)F=0;else{const N=3*d[b+U[o+U[S]]];D*=D,F=D*D*(A[N]*r+A[N+1]*O+A[N+2]*K)}let c=.6-p*p-s*s-X*X;if(c<0)w=0;else{const N=3*d[b+i+U[o+I+U[S+j]]];c*=c,w=c*c*(A[N]*p+A[N+1]*s+A[N+2]*X)}let L=.6-P*P-M*M-Y*Y;if(L<0)n=0;else{const N=3*d[b+l+U[o+T+U[S+z]]];L*=L,n=L*L*(A[N]*P+A[N+1]*M+A[N+2]*Y)}let G=.6-E*E-H*H-e*e;if(G<0)t=0;else{const N=3*d[b+1+U[o+1+U[S+1]]];G*=G,t=G*G*(A[N]*E+A[N+1]*H+A[N+2]*e)}return 32*(F+w+n+t)}noise4D(N,q,C,d){const U=this.perm;let W,a,A,t,V;const Z=(N+q+C+d)*F,J=Math.floor(N+Z),Q=Math.floor(q+Z),v=Math.floor(C+Z),r=Math.floor(d+Z),O=(J+Q+v+r)*w,K=N-(J-O),i=q-(Q-O),I=C-(v-O),j=d-(r-O);let l=0,T=0,z=0,p=0;K>i?l++:T++,K>I?l++:z++,K>j?l++:p++,i>I?T++:z++,i>j?T++:p++,I>j?z++:p++;const s=l>=3?1:0,X=T>=3?1:0,P=z>=3?1:0,M=p>=3?1:0,Y=l>=2?1:0,E=T>=2?1:0,H=z>=2?1:0,e=p>=2?1:0,b=l>=1?1:0,o=T>=1?1:0,S=z>=1?1:0,D=p>=1?1:0,c=K-s+w,L=i-X+w,G=I-P+w,h=j-M+w,B=K-Y+2*w,y=i-E+2*w,R=I-H+2*w,u=j-e+2*w,m=K-b+3*w,f=i-o+3*w,k=I-S+3*w,g=j-D+3*w,x=K-1+4*w,NN=i-1+4*w,qN=I-1+4*w,CN=j-1+4*w,dN=255&J,UN=255&Q,WN=255&v,aN=255&r;let FN=.6-K*K-i*i-I*I-j*j;if(FN<0)W=0;else{const N=U[dN+U[UN+U[WN+U[aN]]]]%32*4;FN*=FN,W=FN*FN*(n[N]*K+n[N+1]*i+n[N+2]*I+n[N+3]*j)}let wN=.6-c*c-L*L-G*G-h*h;if(wN<0)a=0;else{const N=U[dN+s+U[UN+X+U[WN+P+U[aN+M]]]]%32*4;wN*=wN,a=wN*wN*(n[N]*c+n[N+1]*L+n[N+2]*G+n[N+3]*h)}let AN=.6-B*B-y*y-R*R-u*u;if(AN<0)A=0;else{const N=U[dN+Y+U[UN+E+U[WN+H+U[aN+e]]]]%32*4;AN*=AN,A=AN*AN*(n[N]*B+n[N+1]*y+n[N+2]*R+n[N+3]*u)}let nN=.6-m*m-f*f-k*k-g*g;if(nN<0)t=0;else{const N=U[dN+b+U[UN+o+U[WN+S+U[aN+D]]]]%32*4;nN*=nN,t=nN*nN*(n[N]*m+n[N+1]*f+n[N+2]*k+n[N+3]*g)}let tN=.6-x*x-NN*NN-qN*qN-CN*CN;if(tN<0)V=0;else{const N=U[dN+1+U[UN+1+U[WN+1+U[aN+1]]]]%32*4;tN*=tN,V=tN*tN*(n[N]*x+n[N+1]*NN+n[N+2]*qN+n[N+3]*CN)}return 27*(W+a+A+t+V)}}}}]);