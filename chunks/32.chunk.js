/*! For license information please see 30xjib.32.a2888c74.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[32],{13101:(g,w,q)=>{"use strict";var R=q(13106),o=q(13109),r=q(13117);q.g.__TYPEDARRAY_POOL||(q.g.__TYPEDARRAY_POOL={UINT8:o([32,0]),UINT16:o([32,0]),UINT32:o([32,0]),INT8:o([32,0]),INT16:o([32,0]),INT32:o([32,0]),FLOAT:o([32,0]),DOUBLE:o([32,0]),DATA:o([32,0]),UINT8C:o([32,0]),BUFFER:o([32,0])});var S="undefined"!==typeof Uint8ClampedArray,i=q.g.__TYPEDARRAY_POOL;i.UINT8C||(i.UINT8C=o([32,0])),i.BUFFER||(i.BUFFER=o([32,0]));var T=i.DATA,z=i.BUFFER;function t(g){if(g){var w=g.length||g.byteLength,q=R.log2(w);T[q].push(g)}}function m(g){g=R.nextPow2(g);var w=R.log2(g),q=T[w];return q.length>0?q.pop():new ArrayBuffer(g)}function e(g){return new Uint8Array(m(g),0,g)}function y(g){return new Uint16Array(m(2*g),0,g)}function L(g){return new Uint32Array(m(4*g),0,g)}function A(g){return new Int8Array(m(g),0,g)}function l(g){return new Int16Array(m(2*g),0,g)}function J(g){return new Int32Array(m(4*g),0,g)}function x(g){return new Float32Array(m(4*g),0,g)}function G(g){return new Float64Array(m(8*g),0,g)}function d(g){return S?new Uint8ClampedArray(m(g),0,g):e(g)}function D(g){return new DataView(m(g),0,g)}w.free=function(g){if(r(g))z[R.log2(g.length)].push(g);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(g)&&(g=g.buffer),!g)return;var w=g.length||g.byteLength,q=0|R.log2(w);T[q].push(g)}},w.freeUint8=w.freeUint16=w.freeUint32=w.freeInt8=w.freeInt16=w.freeInt32=w.freeFloat32=w.freeFloat=w.freeFloat64=w.freeDouble=w.freeUint8Clamped=w.freeDataView=function(g){t(g.buffer)},w.freeArrayBuffer=t,w.freeBuffer=function(g){z[R.log2(g.length)].push(g)},w.malloc=function(g,w){if(void 0===w||"arraybuffer"===w)return m(g);switch(w){case"uint8":return e(g);case"uint16":return y(g);case"uint32":return L(g);case"int8":return A(g);case"int16":return l(g);case"int32":return J(g);case"float":case"float32":return x(g);case"double":case"float64":return G(g);case"uint8_clamped":return d(g);case"buffer":throw"Buffer not supported";case"data":case"dataview":return D(g);default:return null}return null},w.mallocArrayBuffer=m,w.mallocUint8=e,w.mallocUint16=y,w.mallocUint32=L,w.mallocInt8=A,w.mallocInt16=l,w.mallocInt32=J,w.mallocFloat32=w.mallocFloat=x,w.mallocFloat64=w.mallocDouble=G,w.mallocUint8Clamped=d,w.mallocDataView=D,w.clearCache=function(){for(var g=0;g<32;++g)i.UINT8[g].length=0,i.UINT16[g].length=0,i.UINT32[g].length=0,i.INT8[g].length=0,i.INT16[g].length=0,i.INT32[g].length=0,i.FLOAT[g].length=0,i.DOUBLE[g].length=0,i.UINT8C[g].length=0,T[g].length=0,z[g].length=0}},13200:(g,w,q)=>{g.exports=o;var R=q(11922);function o(g,w){if(!(this instanceof o))return new o(g,w);var q=R.create();R.add(q,g,w),this.base=R.min(R.create(),g,q),this.fz=R.clone(w),this.max=R.max(R.create(),g,q),this.mag=R.length(this.fz)}var r=o.prototype;r.width=function(){return this.fz[0]},r.height=function(){return this.fz[1]},r.depth=function(){return this.fz[2]},r.x0=function(){return this.base[0]},r.y0=function(){return this.base[1]},r.z0=function(){return this.base[2]},r.x1=function(){return this.max[0]},r.y1=function(){return this.max[1]},r.z1=function(){return this.max[2]},r.translate=function(g){return R.add(this.max,this.max,g),R.add(this.base,this.base,g),this},r.setPosition=function(g){return R.add(this.max,g,this.fz),R.j(this.base,g),this},r.expand=function(g){var w=R.create(),q=R.create();return R.max(w,g.max,this.max),R.min(q,g.base,this.base),R.yw(w,w,q),new o(q,w)},r.intersects=function(g){return!(g.base[0]>this.max[0])&&(!(g.base[1]>this.max[1])&&(!(g.base[2]>this.max[2])&&(!(g.max[0]<this.base[0])&&(!(g.max[1]<this.base[1])&&!(g.max[2]<this.base[2])))))},r.touches=function(g){var w=this.union(g);return null!==w&&(0==w.width()||0==w.height()||0==w.depth())},r.union=function(g){if(!this.intersects(g))return null;var w=Math.max(g.base[0],this.base[0]),q=Math.max(g.base[1],this.base[1]),R=Math.max(g.base[2],this.base[2]);return new o([w,q,R],[Math.min(g.max[0],this.max[0])-w,Math.min(g.max[1],this.max[1])-q,Math.min(g.max[2],this.max[2])-R])}},13106:(g,w)=>{"use strict";function q(g){var w=32;return(g&=-g)&&w--,65535&g&&(w-=16),16711935&g&&(w-=8),252645135&g&&(w-=4),858993459&g&&(w-=2),1431655765&g&&(w-=1),w}w.INT_BITS=32,w.INT_MAX=2147483647,w.INT_MIN=-1<<31,w.sign=function(g){return(g>0)-(g<0)},w.abs=function(g){var w=g>>31;return(g^w)-w},w.min=function(g,w){return w^(g^w)&-(g<w)},w.max=function(g,w){return g^(g^w)&-(g<w)},w.isPow2=function(g){return!(g&g-1)&&!!g},w.log2=function(g){var w,q;return w=(g>65535)<<4,w|=q=((g>>>=w)>255)<<3,w|=q=((g>>>=q)>15)<<2,(w|=q=((g>>>=q)>3)<<1)|(g>>>=q)>>1},w.log10=function(g){return g>=1e9?9:g>=1e8?8:g>=1e7?7:g>=1e6?6:g>=1e5?5:g>=1e4?4:g>=1e3?3:g>=100?2:g>=10?1:0},w.popCount=function(g){return 16843009*((g=(858993459&(g-=g>>>1&1431655765))+(g>>>2&858993459))+(g>>>4)&252645135)>>>24},w.countTrailingZeros=q,w.nextPow2=function(g){return g+=0===g,--g,g|=g>>>1,g|=g>>>2,g|=g>>>4,g|=g>>>8,(g|=g>>>16)+1},w.prevPow2=function(g){return g|=g>>>1,g|=g>>>2,g|=g>>>4,g|=g>>>8,(g|=g>>>16)-(g>>>1)},w.parity=function(g){return g^=g>>>16,g^=g>>>8,g^=g>>>4,27030>>>(g&=15)&1};var R=new Array(256);!function(g){for(var w=0;w<256;++w){var q=w,R=w,o=7;for(q>>>=1;q;q>>>=1)R<<=1,R|=1&q,--o;g[w]=R<<o&255}}(R),w.reverse=function(g){return R[255&g]<<24|R[g>>>8&255]<<16|R[g>>>16&255]<<8|R[g>>>24&255]},w.interleave2=function(g,w){return(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g&=65535)|g<<8))|g<<4))|g<<2))|g<<1))|(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w&=65535)|w<<8))|w<<4))|w<<2))|w<<1))<<1},w.deinterleave2=function(g,w){return(g=65535&((g=16711935&((g=252645135&((g=858993459&((g=g>>>w&1431655765)|g>>>1))|g>>>2))|g>>>4))|g>>>16))<<16>>16},w.interleave3=function(g,w,q){return g=1227133513&((g=3272356035&((g=251719695&((g=4278190335&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2),(g|=(w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2))<<1)|(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<2},w.deinterleave3=function(g,w){return(g=1023&((g=4278190335&((g=251719695&((g=3272356035&((g=g>>>w&1227133513)|g>>>2))|g>>>4))|g>>>8))|g>>>16))<<22>>22},w.nextCombination=function(g){var w=g|g-1;return w+1|(~w&-~w)-1>>>q(g)+1}},13099:(g,w,q)=>{"use strict";g.exports=function(g,w,q){switch(arguments.length){case 1:return R=[],z(o=g,o,t,!0),R;case 2:return"function"===typeof w?z(g,g,w,!0):function(g,w){return R=[],z(g,w,t,!1),R}(g,w);case 3:return z(g,w,q,!1);default:throw new Error("box-intersect: Invalid arguments")}var o};var R,o=q(13101),r=q(13120),S=q(13132);function i(g,w){for(var q=0;q<g;++q)if(!(w[q]<=w[q+g]))return!0;return!1}function T(g,w,q,R){for(var o=0,r=0,S=0,T=g.length;S<T;++S){var z=g[S];if(!i(w,z)){for(var t=0;t<2*w;++t)q[o++]=z[t];R[r++]=S}}return r}function z(g,w,q,R){var i=g.length,z=w.length;if(!(i<=0||z<=0)){var t=g[0].length>>>1;if(!(t<=0)){var m,e=o.mallocDouble(2*t*i),y=o.mallocInt32(i);if((i=T(g,t,e,y))>0){if(1===t&&R)r.init(i),m=r.sweepComplete(t,q,0,i,e,y,0,i,e,y);else{var L=o.mallocDouble(2*t*z),A=o.mallocInt32(z);(z=T(w,t,L,A))>0&&(r.init(i+z),m=1===t?r.sweepBipartite(t,q,0,i,e,y,0,z,L,A):S(t,q,R,i,e,y,z,L,A),o.free(L),o.free(A))}o.free(e),o.free(y)}return m}}}function t(g,w){R.push([g,w])}},13135:(g,w)=>{"use strict";var q="d",R="ax",o="fp",r="es",S="rs",i="re",T="rb",z="bs",t="be",m="bb",e=[q,R,"vv",S,i,T,"ri",z,t,m,"bi"];function y(g){var w="bruteForce"+(g?"Full":"Partial"),R=[],S=e.slice();g||S.splice(3,0,o);var i=["function "+w+"("+S.join()+"){"];function T(w,o){var S=function(g,w,R){var o="bruteForce"+(g?"Red":"Blue")+(w?"Flip":"")+(R?"Full":""),S=["function ",o,"(",e.join(),"){","var ",r,"=2*",q,";"],i="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",T="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(R?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return g?S.push(i,"Q",":",T):S.push(T,"Q",":",i),R?S.push("if(y1<x0||x1<y0)continue;"):w?S.push("if(y0<=x0||x1<y0)continue;"):S.push("if(y0<x0||x1<y0)continue;"),S.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),w?S.push("yi,xi"):S.push("xi,yi"),S.push(");if(rv!==void 0)return rv;}}}"),{name:o,code:S.join("")}}(w,o,g);R.push(S.code),i.push("return "+S.name+"("+e.join()+");")}i.push("if(re-rs>be-bs){"),g?(T(!0,!1),i.push("}else{"),T(!1,!1)):(i.push("if(fp){"),T(!0,!0),i.push("}else{"),T(!0,!1),i.push("}}else{if(fp){"),T(!1,!0),i.push("}else{"),T(!1,!1),i.push("}")),i.push("}}return "+w);var z=R.join("")+i.join("");return new Function(z)()}w.partial=y(!1),w.full=y(!0)},13132:(g,w,q)=>{"use strict";g.exports=function(g,w,q,r,t,c,P,j,M){!function(g,w){var q=8*o.log2(w+1)*(g+1)|0,r=o.nextPow2(d*q);U.length<r&&(R.free(U),U=R.mallocInt32(r));var S=o.nextPow2(D*q);N.length<S&&(R.free(N),N=R.mallocDouble(S))}(g,r+P);var V,s=0,h=2*g;a(s++,0,0,r,0,P,q?16:0,-1/0,1/0),q||a(s++,0,0,P,0,r,1,-1/0,1/0);for(;s>0;){var v=(s-=1)*d,b=U[v],B=U[v+1],f=U[v+2],O=U[v+3],E=U[v+4],Q=U[v+5],X=s*D,K=N[X],Y=N[X+1],F=1&Q,u=!!(16&Q),n=t,W=c,p=j,Z=M;if(F&&(n=j,W=M,p=t,Z=c),!(2&Q&&B>=(f=l(g,b,B,f,n,W,Y)))&&!(4&Q&&(B=J(g,b,B,f,n,W,K))>=f)){var I=f-B,k=E-O;if(u){if(g*I*(I+k)<y){if(void 0!==(V=T.scanComplete(g,b,w,B,f,n,W,O,E,p,Z)))return V;continue}}else{if(g*Math.min(I,k)<m){if(void 0!==(V=S(g,b,w,F,B,f,n,W,O,E,p,Z)))return V;continue}if(g*I*k<e){if(void 0!==(V=T.scanBipartite(g,b,w,F,B,f,n,W,O,E,p,Z)))return V;continue}}var gg=L(g,b,B,f,n,W,K,Y);if(B<gg)if(g*(gg-B)<m){if(void 0!==(V=i(g,b+1,w,B,gg,n,W,O,E,p,Z)))return V}else if(b===g-2){if(void 0!==(V=F?T.sweepBipartite(g,w,O,E,p,Z,B,gg,n,W):T.sweepBipartite(g,w,B,gg,n,W,O,E,p,Z)))return V}else a(s++,b+1,B,gg,O,E,F,-1/0,1/0),a(s++,b+1,O,E,B,gg,1^F,-1/0,1/0);if(gg<f){var wg=z(g,b,O,E,p,Z),qg=p[h*wg+b],Rg=A(g,b,wg,E,p,Z,qg);if(Rg<E&&a(s++,b,gg,f,Rg,E,(4|F)+(u?16:0),qg,Y),O<wg&&a(s++,b,gg,f,O,wg,(2|F)+(u?16:0),K,qg),wg+1===Rg){if(void 0!==(V=u?C(g,b,w,gg,f,n,W,wg,p,Z[wg]):H(g,b,w,F,gg,f,n,W,wg,p,Z[wg])))return V}else if(wg<Rg){var og;if(u){if(gg<(og=x(g,b,gg,f,n,W,qg))){var rg=A(g,b,gg,og,n,W,qg);if(b===g-2){if(gg<rg&&void 0!==(V=T.sweepComplete(g,w,gg,rg,n,W,wg,Rg,p,Z)))return V;if(rg<og&&void 0!==(V=T.sweepBipartite(g,w,rg,og,n,W,wg,Rg,p,Z)))return V}else gg<rg&&a(s++,b+1,gg,rg,wg,Rg,16,-1/0,1/0),rg<og&&(a(s++,b+1,rg,og,wg,Rg,0,-1/0,1/0),a(s++,b+1,wg,Rg,rg,og,1,-1/0,1/0))}}else gg<(og=F?G(g,b,gg,f,n,W,qg):x(g,b,gg,f,n,W,qg))&&(b===g-2?V=F?T.sweepBipartite(g,w,wg,Rg,p,Z,gg,og,n,W):T.sweepBipartite(g,w,gg,og,n,W,wg,Rg,p,Z):(a(s++,b+1,gg,og,wg,Rg,F,-1/0,1/0),a(s++,b+1,wg,Rg,gg,og,1^F,-1/0,1/0)))}}}}};var R=q(13101),o=q(13106),r=q(13135),S=r.partial,i=r.full,T=q(13120),z=q(13139),t=q(13144),m=128,e=1<<22,y=1<<22,L=t("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),A=t("lo===p0",["p0"]),l=t("lo<p0",["p0"]),J=t("hi<=p0",["p0"]),x=t("lo<=p0&&p0<=hi",["p0"]),G=t("lo<p0&&p0<=hi",["p0"]),d=6,D=2,U=R.mallocInt32(1024),N=R.mallocDouble(1024);function a(g,w,q,R,o,r,S,i,T){var z=d*g;U[z]=w,U[z+1]=q,U[z+2]=R,U[z+3]=o,U[z+4]=r,U[z+5]=S;var t=D*g;N[t]=i,N[t+1]=T}function H(g,w,q,R,o,r,S,i,T,z,t){var m=2*g,e=T*m,y=z[e+w];g:for(var L=o,A=o*m;L<r;++L,A+=m){var l=S[A+w],J=S[A+w+g];if(!(y<l||J<y)&&(!R||y!==l)){for(var x,G=i[L],d=w+1;d<g;++d){l=S[A+d],J=S[A+d+g];var D=z[e+d],U=z[e+d+g];if(J<D||U<l)continue g}if(void 0!==(x=R?q(t,G):q(G,t)))return x}}}function C(g,w,q,R,o,r,S,i,T,z){var t=2*g,m=i*t,e=T[m+w];g:for(var y=R,L=R*t;y<o;++y,L+=t){var A=S[y];if(A!==z){var l=r[L+w],J=r[L+w+g];if(!(e<l||J<e)){for(var x=w+1;x<g;++x){l=r[L+x],J=r[L+x+g];var G=T[m+x],d=T[m+x+g];if(J<G||d<l)continue g}var D=q(A,z);if(void 0!==D)return D}}}}},13139:(g,w,q)=>{"use strict";g.exports=function(g,w,q,S,i,T){if(S<=q+1)return q;var z=q,t=S,m=S+q>>>1,e=2*g,y=m,L=i[e*m+w];for(;z<t;){if(t-z<o){r(g,w,z,t,i,T),L=i[e*m+w];break}var A=t-z,l=Math.random()*A+z|0,J=i[e*l+w],x=Math.random()*A+z|0,G=i[e*x+w],d=Math.random()*A+z|0,D=i[e*d+w];J<=G?D>=G?(y=x,L=G):J>=D?(y=l,L=J):(y=d,L=D):G>=D?(y=x,L=G):D>=J?(y=l,L=J):(y=d,L=D);for(var U=e*(t-1),N=e*y,a=0;a<e;++a,++U,++N){var H=i[U];i[U]=i[N],i[N]=H}var C=T[t-1];T[t-1]=T[y],T[y]=C;for(U=e*(t-1),N=e*(y=R(g,w,z,t-1,i,T,L)),a=0;a<e;++a,++U,++N){H=i[U];i[U]=i[N],i[N]=H}C=T[t-1];if(T[t-1]=T[y],T[y]=C,m<y){for(t=y-1;z<t&&i[e*(t-1)+w]===L;)t-=1;t+=1}else{if(!(y<m))break;for(z=y+1;z<t&&i[e*z+w]===L;)z+=1}}return R(g,w,q,m,i,T,i[e*m+w])};var R=q(13144)("lo<p0",["p0"]),o=8;function r(g,w,q,R,o,r){for(var S=2*g,i=S*(q+1)+w,T=q+1;T<R;++T,i+=S)for(var z=o[i],t=T,m=S*(T-1);t>q&&o[m+w]>z;--t,m-=S){for(var e=m,y=m+S,L=0;L<S;++L,++e,++y){var A=o[e];o[e]=o[y],o[y]=A}var l=r[t];r[t]=r[t-1],r[t-1]=l}}},13144:g=>{"use strict";g.exports=function(g,q){var R="abcdef".split("").concat(q),o=[];g.indexOf("lo")>=0&&o.push("lo=e[k+n]");g.indexOf("hi")>=0&&o.push("hi=e[k+o]");return R.push(w.replace("_",o.join()).replace("$",g)),Function.apply(void 0,R)};var w="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13123:g=>{"use strict";g.exports=function(g,R){R<=4*w?q(0,R-1,g):z(0,R-1,g)};var w=32;function q(g,w,q){for(var R=2*(g+1),o=g+1;o<=w;++o){for(var r=q[R++],S=q[R++],i=o,T=R-2;i-- >g;){var z=q[T-2],t=q[T-1];if(z<r)break;if(z===r&&t<S)break;q[T]=z,q[T+1]=t,T-=2}q[T]=r,q[T+1]=S}}function R(g,w,q){w*=2;var R=q[g*=2],o=q[g+1];q[g]=q[w],q[g+1]=q[w+1],q[w]=R,q[w+1]=o}function o(g,w,q){w*=2,q[g*=2]=q[w],q[g+1]=q[w+1]}function r(g,w,q,R){w*=2,q*=2;var o=R[g*=2],r=R[g+1];R[g]=R[w],R[g+1]=R[w+1],R[w]=R[q],R[w+1]=R[q+1],R[q]=o,R[q+1]=r}function S(g,w,q,R,o){w*=2,o[g*=2]=o[w],o[w]=q,o[g+1]=o[w+1],o[w+1]=R}function i(g,w,q){w*=2;var R=q[g*=2],o=q[w];return!(R<o)&&(R!==o||q[g+1]>q[w+1])}function T(g,w,q,R){var o=R[g*=2];return o<w||o===w&&R[g+1]<q}function z(g,t,m){var e=(t-g+1)/6|0,y=g+e,L=t-e,A=g+t>>1,l=A-e,J=A+e,x=y,G=l,d=A,D=J,U=L,N=g+1,a=t-1,H=0;i(x,G,m)&&(H=x,x=G,G=H),i(D,U,m)&&(H=D,D=U,U=H),i(x,d,m)&&(H=x,x=d,d=H),i(G,d,m)&&(H=G,G=d,d=H),i(x,D,m)&&(H=x,x=D,D=H),i(d,D,m)&&(H=d,d=D,D=H),i(G,U,m)&&(H=G,G=U,U=H),i(G,d,m)&&(H=G,G=d,d=H),i(D,U,m)&&(H=D,D=U,U=H);for(var C=m[2*G],c=m[2*G+1],P=m[2*D],j=m[2*D+1],M=2*x,V=2*d,s=2*U,h=2*y,v=2*A,b=2*L,B=0;B<2;++B){var f=m[M+B],O=m[V+B],E=m[s+B];m[h+B]=f,m[v+B]=O,m[b+B]=E}o(l,g,m),o(J,t,m);for(var Q=N;Q<=a;++Q)if(T(Q,C,c,m))Q!==N&&R(Q,N,m),++N;else if(!T(Q,P,j,m))for(;;){if(T(a,P,j,m)){T(a,C,c,m)?(r(Q,N,a,m),++N,--a):(R(Q,a,m),--a);break}if(--a<Q)break}S(g,N-1,C,c,m),S(t,a+1,P,j,m),N-2-g<=w?q(g,N-2,m):z(g,N-2,m),t-(a+2)<=w?q(a+2,t,m):z(a+2,t,m),a-N<=w?q(N,a,m):z(N,a,m)}},13120:(g,w,q)=>{"use strict";g.exports={init:function(g){var w=o.nextPow2(g);T.length<w&&(R.free(T),T=R.mallocInt32(w));z.length<w&&(R.free(z),z=R.mallocInt32(w));t.length<w&&(R.free(t),t=R.mallocInt32(w));m.length<w&&(R.free(m),m=R.mallocInt32(w));e.length<w&&(R.free(e),e=R.mallocInt32(w));y.length<w&&(R.free(y),y=R.mallocInt32(w));var q=8*w;L.length<q&&(R.free(L),L=R.mallocDouble(q))},sweepBipartite:function(g,w,q,R,o,i,e,y,J,x){for(var G=0,d=2*g,D=g-1,U=d-1,N=q;N<R;++N){var a=i[N],H=d*N;L[G++]=o[H+D],L[G++]=-(a+1),L[G++]=o[H+U],L[G++]=a}for(N=e;N<y;++N){a=x[N]+S;var C=d*N;L[G++]=J[C+D],L[G++]=-a,L[G++]=J[C+U],L[G++]=a}var c=G>>>1;r(L,c);var P=0,j=0;for(N=0;N<c;++N){var M=0|L[2*N+1];if(M>=S)A(t,m,j--,M=M-S|0);else if(M>=0)A(T,z,P--,M);else if(M<=-S){M=-M-S|0;for(var V=0;V<P;++V){if(void 0!==(s=w(T[V],M)))return s}l(t,m,j++,M)}else{M=-M-1|0;for(V=0;V<j;++V){var s;if(void 0!==(s=w(M,t[V])))return s}l(T,z,P++,M)}}},sweepComplete:function(g,w,q,R,o,S,i,J,x,G){for(var d=0,D=2*g,U=g-1,N=D-1,a=q;a<R;++a){var H=S[a]+1<<1,C=D*a;L[d++]=o[C+U],L[d++]=-H,L[d++]=o[C+N],L[d++]=H}for(a=i;a<J;++a){H=G[a]+1<<1;var c=D*a;L[d++]=x[c+U],L[d++]=1|-H,L[d++]=x[c+N],L[d++]=1|H}var P=d>>>1;r(L,P);var j=0,M=0,V=0;for(a=0;a<P;++a){var s=0|L[2*a+1],h=1&s;if(a<P-1&&s>>1===L[2*a+3]>>1&&(h=2,a+=1),s<0){for(var v=-(s>>1)-1,b=0;b<V;++b){if(void 0!==(B=w(e[b],v)))return B}if(0!==h)for(b=0;b<j;++b){if(void 0!==(B=w(T[b],v)))return B}if(1!==h)for(b=0;b<M;++b){var B;if(void 0!==(B=w(t[b],v)))return B}0===h?l(T,z,j++,v):1===h?l(t,m,M++,v):2===h&&l(e,y,V++,v)}else{v=(s>>1)-1;0===h?A(T,z,j--,v):1===h?A(t,m,M--,v):2===h&&A(e,y,V--,v)}}},scanBipartite:function(g,w,q,R,o,i,t,m,e,y,J,x){var G=0,d=2*g,D=w,U=w+g,N=1,a=1;R?a=S:N=S;for(var H=o;H<i;++H){var C=H+N,c=d*H;L[G++]=t[c+D],L[G++]=-C,L[G++]=t[c+U],L[G++]=C}for(H=e;H<y;++H){C=H+a;var P=d*H;L[G++]=J[P+D],L[G++]=-C}var j=G>>>1;r(L,j);var M=0;for(H=0;H<j;++H){var V=0|L[2*H+1];if(V<0){var s=!1;if((C=-V)>=S?(s=!R,C-=S):(s=!!R,C-=1),s)l(T,z,M++,C);else{var h=x[C],v=d*C,b=J[v+w+1],B=J[v+w+1+g];g:for(var f=0;f<M;++f){var O=T[f],E=d*O;if(!(B<t[E+w+1]||t[E+w+1+g]<b)){for(var Q=w+2;Q<g;++Q)if(J[v+Q+g]<t[E+Q]||t[E+Q+g]<J[v+Q])continue g;var X,K=m[O];if(void 0!==(X=R?q(h,K):q(K,h)))return X}}}}else A(T,z,M--,V-N)}},scanComplete:function(g,w,q,R,o,i,z,t,m,e,y){for(var A=0,l=2*g,J=w,x=w+g,G=R;G<o;++G){var d=G+S,D=l*G;L[A++]=i[D+J],L[A++]=-d,L[A++]=i[D+x],L[A++]=d}for(G=t;G<m;++G){d=G+1;var U=l*G;L[A++]=e[U+J],L[A++]=-d}var N=A>>>1;r(L,N);var a=0;for(G=0;G<N;++G){var H=0|L[2*G+1];if(H<0){if((d=-H)>=S)T[a++]=d-S;else{var C=y[d-=1],c=l*d,P=e[c+w+1],j=e[c+w+1+g];g:for(var M=0;M<a;++M){var V=T[M],s=z[V];if(s===C)break;var h=l*V;if(!(j<i[h+w+1]||i[h+w+1+g]<P)){for(var v=w+2;v<g;++v)if(e[c+v+g]<i[h+v]||i[h+v+g]<e[c+v])continue g;var b=q(s,C);if(void 0!==b)return b}}}}else{for(d=H-S,M=a-1;M>=0;--M)if(T[M]===d){for(v=M+1;v<a;++v)T[v-1]=T[v];break}--a}}}};var R=q(13101),o=q(13106),r=q(13123),S=1<<28,i=1024,T=R.mallocInt32(i),z=R.mallocInt32(i),t=R.mallocInt32(i),m=R.mallocInt32(i),e=R.mallocInt32(i),y=R.mallocInt32(i),L=R.mallocDouble(8192);function A(g,w,q,R){var o=w[R],r=g[q-1];g[o]=r,w[r]=o}function l(g,w,q,R){g[q]=R,w[R]=q}},13109:g=>{"use strict";function w(g,q,R){var o=0|g[R];if(o<=0)return[];var r,S=new Array(o);if(R===g.length-1)for(r=0;r<o;++r)S[r]=q;else for(r=0;r<o;++r)S[r]=w(g,q,R+1);return S}g.exports=function(g,q){switch("undefined"===typeof q&&(q=0),typeof g){case"number":if(g>0)return function(g,w){var q,R;for(q=new Array(g),R=0;R<g;++R)q[R]=w;return q}(0|g,q);break;case"object":if("number"===typeof g.length)return w(g,q,0)}return[]}},13066:(g,w,q)=>{g.exports=function(){var g=this;this.components={},this.comps=this.components;var w=this.components,q=1,o={},r=[],S=[],i={timeout:!1,removals:[],multiComps:[]};function T(g,q){var R=w[q],r=o[q],S=r.hash[g];S&&(r.remove(g),R.qq&&(R.multi?(S.forEach((w=>{w&&R.qq(g,w)})),S.length=0):R.qq(g,S)),i.removals.push(r),z())}function z(){i.timeout||(i.timeout=!0,setTimeout(t,1))}function t(){i.timeout=!1,m()}function m(){i.multiComps.length&&function(g){for(var w=0;w<g.length;w++){var{entID:q,data:R}=g[w],o=R.hash[q];if(o){for(var r=0;r<o.length;r++)o[r]||(o.splice(r,1),r--);0===o.length&&(R.remove(q),i.removals.push(R))}}g.length=0}(i.multiComps),i.removals.length&&function(g){for(var w=0;w<g.length;w++){g[w].flush()}g.length=0}(i.removals)}this.om=o,this._systems=r,this._renderSystems=S,this.Qz=function(w){var R=q++;return Array.isArray(w)&&w.forEach((w=>g.cT(R,w))),R},this.deleteEntity=function(w){return Object.keys(o).forEach((g=>{o[g].hash[w]&&T(w,g)})),g},this.rt=function(g){if(!g)throw new Error("Missing component definition");var q=g.name;if(!q)throw new Error("Component definition must have a name property.");if("string"!==typeof q)throw new Error("Component name must be a string.");if(""===q)throw new Error("Component name must be a non-empty string.");if(o[q])throw new Error(`Component ${q} already exists.`);var i={};return i.name=q,i.multi=!!g.multi,i.order=isNaN(g.order)?99:g.order,i.stateConstructor=g.stateConstructor||null,i.state=g.state||{},i.Ci=g.Ci||null,i.qq=g.qq||null,i.system=g.system||null,i.Oi=g.Oi||null,w[q]=i,o[q]=new R,o[q]._pendingMultiCleanup=!1,o[q]._multiCleanupIDs=i.multi?[]:null,i.system&&(r.push(q),r.sort(((g,q)=>w[g].order-w[q].order))),i.Oi&&(S.push(q),S.sort(((g,q)=>w[g].order-w[q].order))),q},this.overwriteComponent=function(g,q){var R=w[g];if(!R)throw new Error(`Unknown component: ${g}`);if(!q)throw new Error("Missing component definition");if(R.name!==q.name)throw new Error("Overwriting component must use the same name property.");var i={};i.name=g,i.multi=!!q.multi,i.order=isNaN(q.order)?99:q.order,i.state=q.state||{},i.Ci=q.Ci||null,i.qq=q.qq||null,i.system=q.system||null,i.Oi=q.Oi||null,w[g]=i,o[g]._pendingMultiCleanup=!1,o[g]._multiCleanupIDs=i.multi?[]:null;var T=r.indexOf(g);i.system&&T<0&&r.push(g),!i.system&&T>=0&&r.splice(T,1),r.sort(((g,q)=>w[g].order-w[q].order));var z=S.indexOf(g);i.Oi&&z<0&&S.push(g),!i.Oi&&z>=0&&S.splice(z,1),S.sort(((g,q)=>w[g].order-w[q].order));var t=i.state;return this.Nz(g).forEach((g=>{for(var w in t)w in g||(g[w]=t[w]);i.Ci&&i.Ci(g.bi,g)})),g},this.deleteComponent=function(q){var R=o[q];if(!R)throw new Error(`Unknown component: ${q}`);R.flush(),R.list.forEach((g=>{g&&T(g.bi||g[0].bi,q)}));var i=r.indexOf(q),z=S.indexOf(q);return i>-1&&r.splice(i,1),z>-1&&S.splice(z,1),o[q].dispose(),delete o[q],delete w[q],g},this.cT=function(g,q,R){var r,S=w[q],i=o[q];if(!i)throw new Error(`Unknown component: ${q}.`);if(i.hash[g]&&!S.multi)throw new Error(`Entity ${g} already has component: ${q}.`);if(S.stateConstructor){if(!(r=new S.stateConstructor).hasOwnProperty("bi"))throw new Error(`Component ${S.name} stateConstructor type does not have property __id`)}else r=Object.assign({},{bi:g},S.state,R);if(r.bi=g,S.multi){var T=i.hash[g];T||(T=[],i.add(g,T)),T.push(r)}else i.add(g,r);return S.Ci&&S.Ci(g,r),this},this.fT=function(g,w){var q=o[w];if(!q)throw new Error(`Unknown component: ${w}.`);return!!q.hash[g]},this.VT=function(w,q){if(!o[q])throw new Error(`Unknown component: ${q}.`);return T(w,q),g},this.getState=function(g,w){var q=o[w];if(!q)throw new Error(`Unknown component: ${w}.`);return q.hash[g]},this.Nz=function(g){var w=o[g];if(!w)throw new Error(`Unknown component: ${g}.`);return m(),w.list},this.ly=function(g){if(!o[g])throw new Error(`Unknown component: ${g}.`);var w=o[g].hash;return g=>w[g]},this.Gy=function(g){if(!o[g])throw new Error(`Unknown component: ${g}.`);var w=o[g].hash;return g=>!!w[g]},this.FS=function(q){m();for(var R=0;R<r.length;R++){var S=r[R],i=w[S],T=o[S];i.system(q,T.list),m()}return g},this.render=function(q){m();for(var R=0;R<S.length;R++){var r=S[R],i=w[r],T=o[r];i.Oi(q,T.list),m()}return g},this.removeMultiComponent=function(q,R,r){var S=w[R],T=o[R];if(!T)throw new Error(`Unknown component: ${R}.`);if(!S.multi)throw new Error("removeMultiComponent called on non-multi component");return function(g,w,q,R){var o=q.hash[g];if(o){var r=o[R];r&&(o[R]=null,w.qq&&w.qq(g,r),i.multiComps.push({entID:g,data:q}),z())}}(q,S,T,r),g}};var R=q(13075)},13075:g=>{function w(g,w){var q=g._map[w];if(delete g.hash[w],delete g._map[w],q===g.list.length-1)g.list.pop();else{var R=g.list.pop();if(g.list[q]=R,null===R||null===R[0]){var o=g.list.length;for(var r in g._map)if(g._map[r]===o)return void(g._map[r]=q)}else{var S=R.bi||R[0].bi;g._map[S]=q}}}g.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(g,w){if("number"===typeof this._map[g]){var q=this._map[g];this.hash[g]=w,this.list[q]=w}else this._map[g]=this.list.length,this.hash[g]=w,this.list.push(w)}remove(g){var w=this._map[g];this.hash[g]=null,this.list[w]=null,this._pendingRemovals.push(g)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var g=0;g<this._pendingRemovals.length;g++){var q=this._pendingRemovals[g];null===this.hash[q]&&w(this,q)}this._pendingRemovals.length=0}}},13030:g=>{"use strict";var w,q="object"===typeof Reflect?Reflect:null,R=function(g,w,q){return Function.prototype.apply.call(g,w,q)};w=q&&"function"===typeof q.ownKeys?q.ownKeys:Object.getOwnPropertySymbols?function(g){return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))}:function(g){return Object.getOwnPropertyNames(g)};var o=Number.isNaN||function(g){return g!==g};function r(){r.init.call(this)}g.exports=r,g.exports.once=function(g,w){return new Promise((function(q,R){function o(q){g.removeListener(w,r),R(q)}function r(){"function"===typeof g.removeListener&&g.removeListener("error",o),q([].slice.call(arguments))}A(g,w,r,{once:!0}),"error"!==w&&function(g,w,q){"function"===typeof g.on&&A(g,"error",w,q)}(g,o,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var S=10;function i(g){if("function"!==typeof g)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof g)}function T(g){return void 0===g._maxListeners?r.defaultMaxListeners:g._maxListeners}function z(g,w,q,R){var o,r,S,z;if(i(q),void 0===(r=g._events)?(r=g._events=Object.create(null),g._eventsCount=0):(void 0!==r.newListener&&(g.emit("newListener",w,q.listener?q.listener:q),r=g._events),S=r[w]),void 0===S)S=r[w]=q,++g._eventsCount;else if("function"===typeof S?S=r[w]=R?[q,S]:[S,q]:R?S.unshift(q):S.push(q),(o=T(g))>0&&S.length>o&&!S.warned){S.warned=!0;var t=new Error("Possible EventEmitter memory leak detected. "+S.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");t.name="MaxListenersExceededWarning",t.k=g,t.type=w,t.count=S.length,z=t,console&&console.warn&&console.warn(z)}return g}function t(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(g,w,q){var R={fired:!1,wrapFn:void 0,target:g,type:w,listener:q},o=t.bind(R);return o.listener=q,R.wrapFn=o,o}function e(g,w,q){var R=g._events;if(void 0===R)return[];var o=R[w];return void 0===o?[]:"function"===typeof o?q?[o.listener||o]:[o]:q?function(g){for(var w=new Array(g.length),q=0;q<w.length;++q)w[q]=g[q].listener||g[q];return w}(o):L(o,o.length)}function y(g){var w=this._events;if(void 0!==w){var q=w[g];if("function"===typeof q)return 1;if(void 0!==q)return q.length}return 0}function L(g,w){for(var q=new Array(w),R=0;R<w;++R)q[R]=g[R];return q}function A(g,w,q,R){if("function"===typeof g.on)R.once?g.once(w,q):g.on(w,q);else{if("function"!==typeof g.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof g);g.addEventListener(w,(function o(r){R.once&&g.removeEventListener(w,o),q(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return S},set:function(g){if("number"!==typeof g||g<0||o(g))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+g+".");S=g}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(g){if("number"!==typeof g||g<0||o(g))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+g+".");return this._maxListeners=g,this},r.prototype.getMaxListeners=function(){return T(this)},r.prototype.emit=function(g){for(var w=[],q=1;q<arguments.length;q++)w.push(arguments[q]);var o="error"===g,r=this._events;if(void 0!==r)o=o&&void 0===r.error;else if(!o)return!1;if(o){var S;if(w.length>0&&(S=w[0]),S instanceof Error)throw S;var i=new Error("Unhandled error."+(S?" ("+S.message+")":""));throw i.context=S,i}var T=r[g];if(void 0===T)return!1;if("function"===typeof T)R(T,this,w);else{var z=T.length,t=L(T,z);for(q=0;q<z;++q)R(t[q],this,w)}return!0},r.prototype.addListener=function(g,w){return z(this,g,w,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(g,w){return z(this,g,w,!0)},r.prototype.once=function(g,w){return i(w),this.on(g,m(this,g,w)),this},r.prototype.prependOnceListener=function(g,w){return i(w),this.prependListener(g,m(this,g,w)),this},r.prototype.removeListener=function(g,w){var q,R,o,r,S;if(i(w),void 0===(R=this._events))return this;if(void 0===(q=R[g]))return this;if(q===w||q.listener===w)0===--this._eventsCount?this._events=Object.create(null):(delete R[g],R.removeListener&&this.emit("removeListener",g,q.listener||w));else if("function"!==typeof q){for(o=-1,r=q.length-1;r>=0;r--)if(q[r]===w||q[r].listener===w){S=q[r].listener,o=r;break}if(o<0)return this;0===o?q.shift():function(g,w){for(;w+1<g.length;w++)g[w]=g[w+1];g.pop()}(q,o),1===q.length&&(R[g]=q[0]),void 0!==R.removeListener&&this.emit("removeListener",g,S||w)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(g){var w,q,R;if(void 0===(q=this._events))return this;if(void 0===q.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==q[g]&&(0===--this._eventsCount?this._events=Object.create(null):delete q[g]),this;if(0===arguments.length){var o,r=Object.keys(q);for(R=0;R<r.length;++R)"removeListener"!==(o=r[R])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(w=q[g]))this.removeListener(g,w);else if(void 0!==w)for(R=w.length-1;R>=0;R--)this.removeListener(g,w[R]);return this},r.prototype.listeners=function(g){return e(this,g,!0)},r.prototype.rawListeners=function(g){return e(this,g,!1)},r.listenerCount=function(g,w){return"function"===typeof g.listenerCount?g.listenerCount(w):y.call(g,w)},r.prototype.listenerCount=y,r.prototype.eventNames=function(){return this._eventsCount>0?w(this._events):[]}},13316:g=>{"use strict";g.exports=function(g,w,q,R,o,r){var S=+w[0],i=+w[1],T=+w[2],z=+q[0],t=+q[1],m=+q[2],e=Math.sqrt(z*z+t*t+m*m);if(0===e)throw new Error("Can't raycast along a zero vector");return function(g,w,q,R,o,r,S,i,T,z){for(var t=0,m=Math.floor,e=0|m(w),y=0|m(q),L=0|m(R),A=o>0?1:-1,l=r>0?1:-1,J=S>0?1:-1,x=Math.abs(1/o),G=Math.abs(1/r),d=Math.abs(1/S),D=x<1/0?x*(A>0?e+1-w:w-e):1/0,U=G<1/0?G*(l>0?y+1-q:q-y):1/0,N=d<1/0?d*(J>0?L+1-R:R-L):1/0,a=-1;t<=i;){var H=g(e,y,L);if(H)return T&&(T[0]=w+t*o,T[1]=q+t*r,T[2]=R+t*S),z&&(z[0]=z[1]=z[2]=0,0===a&&(z[0]=-A),1===a&&(z[1]=-l),2===a&&(z[2]=-J)),H;D<U?D<N?(e+=A,t=D,D+=x,a=0):(L+=J,t=N,N+=d,a=2):U<N?(y+=l,t=U,U+=G,a=1):(L+=J,t=N,N+=d,a=2)}return T&&(T[0]=w+t*o,T[1]=q+t*r,T[2]=R+t*S),z&&(z[0]=z[1]=z[2]=0),0}(g,S,i,T,z/=e,t/=e,m/=e,R="undefined"===typeof R?64:+R,o,r)}},13341:(g,w,q)=>{"use strict";q.d(w,{c:()=>r});var R=q(13030);function o(){this.pm=!1,this.stopPropagation=!1,this.Zm=!1,this.disabled=!1}class r{constructor(g,w){this.version="0.7.0";var q=Object.assign({},new o,w||{});this.element=g||document,this.pm=!!q.pm,this.stopPropagation=!!q.stopPropagation,this.Zm=!!q.Zm,this.disabled=!!q.disabled,this.filterEvents=(g,w)=>!0,this.down=new R.EventEmitter,this.up=new R.EventEmitter,this.state={},this.Jz={dx:0,dy:0,iy:0,lz:0,Ty:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?i(this):document.addEventListener("DOMContentLoaded",(g=>{i(this)}),{once:!0})}bind(g){for(var w=arguments.length,q=new Array(w>1?w-1:0),R=1;R<w;R++)q[R-1]=arguments[R];q.forEach((w=>{var q=this._keyBindmap[w]||[];q.includes(g)||(q.push(g),this._keyBindmap[w]=q)})),this.state[g]=!!this.state[g],this.pressCount[g]=this.pressCount[g]||0,this.releaseCount[g]=this.releaseCount[g]||0}unbind(g){for(var w in this._keyBindmap){var q=this._keyBindmap[w],R=q.indexOf(g);R>-1&&q.splice(R,1)}}getBindings(){var g={};for(var w in this._keyBindmap){this._keyBindmap[w].forEach((q=>{g[q]=g[q]||[],g[q].push(w)}))}return g}FS(){S(this.Jz),S(this.pressCount),S(this.releaseCount)}}function S(g){for(var w in g)g[w]=0}function i(g){window.addEventListener("keydown",L.bind(null,g,!0),!1),window.addEventListener("keyup",L.bind(null,g,!1),!1);var w={passive:!0};g.element.addEventListener("touchstart",m.bind(void 0,g),{passive:!1}),g.element.addEventListener("touchend",y.bind(void 0,g),w),g.element.addEventListener("mousedown",A.bind(null,g,!0),w),window.document.addEventListener("mouseup",A.bind(null,g,!1),w),g.element.addEventListener("touchmove",l.bind(null,g),w),g.element.addEventListener("mousemove",l.bind(null,g),w),window.PointerEvent,g.element.addEventListener("wheel",J.bind(null,g),w),g.element.addEventListener("contextmenu",x.bind(null,g),!1),window.addEventListener("blur",G.bind(null,g),!1)}var T=0,z=0,t=null;function m(g,w){w.preventDefault(),e(w)}function e(g){let w=!1;for(let q=0;q<g.touches.length;++q)if(g.touches[q].identifier===t){w=!0;break}if(!w){const w=g.changedTouches[0];T=w.clientX,z=w.clientY,t=w.identifier}}function y(g,w){for(var q=w.changedTouches,R=0;R<q.length;++R)q[R].identifier===t&&(t=null)}function L(g,w,q){d(q.code,w,g,q)}function A(g,w,q){if("pointerId"in q)if(w){if(null!==g._touches.currID)return;g._touches.currID=q.pointerId}else{if(g._touches.currID!==q.pointerId)return;g._touches.currID=null}return d("Mouse"+("button"in q?q.button+1:1),w,g,q),!1}function l(g,w){var q=w.movementX||w.mozMovementX||0,R=w.movementY||w.mozMovementY||0;if(w.touches&&0===(q|R)){var o=function(g){e(g);for(let w=0;w<g.changedTouches.length;++w)if(g.changedTouches[w].identifier==t){const q=g.changedTouches[w],R=[q.clientX-T,q.clientY-z];return T=q.clientX,z=q.clientY,R}return console.error(`Did not find touch id ${t}`),[0,0]}(w);q=o[0],R=o[1]}g.Jz.dx+=q,g.Jz.dy+=R}function J(g,w){var q=1;switch(w.deltaMode){case 0:q=1;break;case 1:q=12;break;case 2:q=g.element.clientHeight||window.innerHeight}g.Jz.iy+=(w.deltaX||0)*q,g.Jz.lz+=(w.deltaY||0)*q,g.Jz.Ty+=(w.deltaZ||0)*q}function x(g,w){if(!g.Zm)return w.preventDefault(),!1}function G(g){for(var w in g._keyStates)g._keyStates[w]&&(/^Mouse\d/.test(w)||d(w,!1,g,{code:w,note:"yuoq47clp98",preventDefault:()=>{},stopPropagation:()=>{}}))}function d(g,w,q,R){var o=q._keyBindmap[g];o&&(D(q._keyStates[g],w)&&(q._keyStates[g]=w,o.forEach((g=>{(!q.filterEvents||q.filterEvents(R,g))&&function(g,w,q,R){var o=w?q.pressCount:q.releaseCount;o[g]=(o[g]||0)+1;var r=q._bindPressCount[g]||0;(r+=w?1:-1)<0&&(r=0);q._bindPressCount[g]=r;var S=q.state[g];if(D(S,r)){q.state[g]=r>0;var i=w?q.down:q.up;q.disabled||i.emit(g,R)}}(g,w,q,R)}))),"button"in R||(q.pm&&!R.defaultPrevented&&R.preventDefault(),q.stopPropagation&&R.stopPropagation()))}function D(g,w){return g?!w:w}},11979:g=>{g.exports=function(g,w,q){return g[0]=w[0]+q[0],g[1]=w[1]+q[1],g[2]=w[2]+q[2],g}},11943:(g,w,q)=>{g.exports=function(g,w){var q=R(g[0],g[1],g[2]),S=R(w[0],w[1],w[2]);o(q,q),o(S,S);var i=r(q,S);return i>1?0:Math.acos(i)};var R=q(11950),o=q(11952),r=q(11958)},12031:g=>{g.exports=function(g,w){return g[0]=Math.ceil(w[0]),g[1]=Math.ceil(w[1]),g[2]=Math.ceil(w[2]),g}},11941:g=>{g.exports=function(g){var w=new Float32Array(3);return w[0]=g[0],w[1]=g[1],w[2]=g[2],w}},11964:g=>{g.exports=function(g,w){return g[0]=w[0],g[1]=w[1],g[2]=w[2],g}},11932:g=>{g.exports=function(){var g=new Float32Array(3);return g[0]=0,g[1]=0,g[2]=0,g}},12114:g=>{g.exports=function(g,w,q){var R=w[0],o=w[1],r=w[2],S=q[0],i=q[1],T=q[2];return g[0]=o*T-r*i,g[1]=r*S-R*T,g[2]=R*i-o*S,g}},12062:(g,w,q)=>{g.exports=q(12056)},12056:g=>{g.exports=function(g,w){var q=w[0]-g[0],R=w[1]-g[1],o=w[2]-g[2];return Math.sqrt(q*q+R*R+o*o)}},12009:(g,w,q)=>{g.exports=q(12006)},12006:g=>{g.exports=function(g,w,q){return g[0]=w[0]/q[0],g[1]=w[1]/q[1],g[2]=w[2]/q[2],g}},11958:g=>{g.exports=function(g,w){return g[0]*w[0]+g[1]*w[1]+g[2]*w[2]}},11930:g=>{g.exports=1e-6},11972:(g,w,q)=>{g.exports=function(g,w){var q=g[0],o=g[1],r=g[2],S=w[0],i=w[1],T=w[2];return Math.abs(q-S)<=R*Math.max(1,Math.abs(q),Math.abs(S))&&Math.abs(o-i)<=R*Math.max(1,Math.abs(o),Math.abs(i))&&Math.abs(r-T)<=R*Math.max(1,Math.abs(r),Math.abs(T))};var R=q(11930)},11976:g=>{g.exports=function(g,w){return g[0]===w[0]&&g[1]===w[1]&&g[2]===w[2]}},12025:g=>{g.exports=function(g,w){return g[0]=Math.floor(w[0]),g[1]=Math.floor(w[1]),g[2]=Math.floor(w[2]),g}},12167:(g,w,q)=>{g.exports=function(g,w,q,o,r,S){var i,T;w||(w=3);q||(q=0);T=o?Math.min(o*w+q,g.length):g.length;for(i=q;i<T;i+=w)R[0]=g[i],R[1]=g[i+1],R[2]=g[i+2],r(R,R,S),g[i]=R[0],g[i+1]=R[1],g[i+2]=R[2];return g};var R=q(11932)()},11950:g=>{g.exports=function(g,w,q){var R=new Float32Array(3);return R[0]=g,R[1]=w,R[2]=q,R}},11922:(g,w,q)=>{g.exports={EPSILON:q(11930),create:q(11932),clone:q(11941),angle:q(11943),BS:q(11950),j:q(11964),set:q(11969),equals:q(11972),exactEquals:q(11976),add:q(11979),yw:q(11981),sub:q(11987),multiply:q(11994),mul:q(11999),divide:q(12006),div:q(12009),min:q(12012),max:q(12017),floor:q(12025),ceil:q(12031),round:q(12040),scale:q(12043),fS:q(12051),distance:q(12056),i:q(12062),squaredDistance:q(12065),sqrDist:q(12070),length:q(12077),len:q(12080),squaredLength:q(12088),OS:q(12097),negate:q(12104),inverse:q(12110),normalize:q(11952),dot:q(11958),cross:q(12114),hS:q(12117),random:q(12125),transformMat4:q(12131),transformMat3:q(12138),transformQuat:q(12146),ES:q(12149),QS:q(12155),XS:q(12161),forEach:q(12167)}},12110:g=>{g.exports=function(g,w){return g[0]=1/w[0],g[1]=1/w[1],g[2]=1/w[2],g}},12080:(g,w,q)=>{g.exports=q(12077)},12077:g=>{g.exports=function(g){var w=g[0],q=g[1],R=g[2];return Math.sqrt(w*w+q*q+R*R)}},12117:g=>{g.exports=function(g,w,q,R){var o=w[0],r=w[1],S=w[2];return g[0]=o+R*(q[0]-o),g[1]=r+R*(q[1]-r),g[2]=S+R*(q[2]-S),g}},12017:g=>{g.exports=function(g,w,q){return g[0]=Math.max(w[0],q[0]),g[1]=Math.max(w[1],q[1]),g[2]=Math.max(w[2],q[2]),g}},12012:g=>{g.exports=function(g,w,q){return g[0]=Math.min(w[0],q[0]),g[1]=Math.min(w[1],q[1]),g[2]=Math.min(w[2],q[2]),g}},11999:(g,w,q)=>{g.exports=q(11994)},11994:g=>{g.exports=function(g,w,q){return g[0]=w[0]*q[0],g[1]=w[1]*q[1],g[2]=w[2]*q[2],g}},12104:g=>{g.exports=function(g,w){return g[0]=-w[0],g[1]=-w[1],g[2]=-w[2],g}},11952:g=>{g.exports=function(g,w){var q=w[0],R=w[1],o=w[2],r=q*q+R*R+o*o;r>0&&(r=1/Math.sqrt(r),g[0]=w[0]*r,g[1]=w[1]*r,g[2]=w[2]*r);return g}},12125:g=>{g.exports=function(g,w){w=w||1;var q=2*Math.random()*Math.PI,R=2*Math.random()-1,o=Math.sqrt(1-R*R)*w;return g[0]=Math.cos(q)*o,g[1]=Math.sin(q)*o,g[2]=R*w,g}},12149:g=>{g.exports=function(g,w,q,R){var o=q[1],r=q[2],S=w[1]-o,i=w[2]-r,T=Math.sin(R),z=Math.cos(R);return g[0]=w[0],g[1]=o+S*z-i*T,g[2]=r+S*T+i*z,g}},12155:g=>{g.exports=function(g,w,q,R){var o=q[0],r=q[2],S=w[0]-o,i=w[2]-r,T=Math.sin(R),z=Math.cos(R);return g[0]=o+i*T+S*z,g[1]=w[1],g[2]=r+i*z-S*T,g}},12161:g=>{g.exports=function(g,w,q,R){var o=q[0],r=q[1],S=w[0]-o,i=w[1]-r,T=Math.sin(R),z=Math.cos(R);return g[0]=o+S*z-i*T,g[1]=r+S*T+i*z,g[2]=w[2],g}},12040:g=>{g.exports=function(g,w){return g[0]=Math.round(w[0]),g[1]=Math.round(w[1]),g[2]=Math.round(w[2]),g}},12043:g=>{g.exports=function(g,w,q){return g[0]=w[0]*q,g[1]=w[1]*q,g[2]=w[2]*q,g}},12051:g=>{g.exports=function(g,w,q,R){return g[0]=w[0]+q[0]*R,g[1]=w[1]+q[1]*R,g[2]=w[2]+q[2]*R,g}},11969:g=>{g.exports=function(g,w,q,R){return g[0]=w,g[1]=q,g[2]=R,g}},12070:(g,w,q)=>{g.exports=q(12065)},12097:(g,w,q)=>{g.exports=q(12088)},12065:g=>{g.exports=function(g,w){var q=w[0]-g[0],R=w[1]-g[1],o=w[2]-g[2];return q*q+R*R+o*o}},12088:g=>{g.exports=function(g){var w=g[0],q=g[1],R=g[2];return w*w+q*q+R*R}},11987:(g,w,q)=>{g.exports=q(11981)},11981:g=>{g.exports=function(g,w,q){return g[0]=w[0]-q[0],g[1]=w[1]-q[1],g[2]=w[2]-q[2],g}},12138:g=>{g.exports=function(g,w,q){var R=w[0],o=w[1],r=w[2];return g[0]=R*q[0]+o*q[3]+r*q[6],g[1]=R*q[1]+o*q[4]+r*q[7],g[2]=R*q[2]+o*q[5]+r*q[8],g}},12131:g=>{g.exports=function(g,w,q){var R=w[0],o=w[1],r=w[2],S=q[3]*R+q[7]*o+q[11]*r+q[15];return S=S||1,g[0]=(q[0]*R+q[4]*o+q[8]*r+q[12])/S,g[1]=(q[1]*R+q[5]*o+q[9]*r+q[13])/S,g[2]=(q[2]*R+q[6]*o+q[10]*r+q[14])/S,g}},12146:g=>{g.exports=function(g,w,q){var R=w[0],o=w[1],r=w[2],S=q[0],i=q[1],T=q[2],z=q[3],t=z*R+i*r-T*o,m=z*o+T*R-S*r,e=z*r+S*o-i*R,y=-S*R-i*o-T*r;return g[0]=t*z+y*-S+m*-T-e*-i,g[1]=m*z+y*-i+e*-S-t*-T,g[2]=e*z+y*-T+t*-i-m*-S,g}},13047:g=>{"use strict";g.exports=function(g){for(var w=new Array(g),q=0;q<g;++q)w[q]=q;return w}},13117:g=>{g.exports=function(g){return null!=g&&null!=g.constructor&&"function"===typeof g.constructor.isBuffer&&g.constructor.isBuffer(g)}},13318:(g,w,q)=>{"use strict";q.d(w,{e:()=>R});class R{constructor(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Pt=!1,this.jt=!1,this.Ct=30,this.ct=0,this.ft=!1,this.fullscreen=!1,this.Vt=function(g){},this.st=function(){},this.bt=function(){},this.eq=function(){},this.ht=function(g){},this.onFullscreenChanged=function(g){},z((()=>{!function(g,w){g._nowObject=performance||Date,g._lastTick=0,g._renderAccum=0,g._rt=0,g._frameCB=i.bind(null,g),requestAnimationFrame(g._frameCB),w>0&&(g._intervalCB=S.bind(null,g),g._interval=setInterval(g._intervalCB,Math.max(w,1e3/g.Ct/2)))}(this,w),function(g,w){if(!w)return;var q=!1,R=!1;document.addEventListener("pointerlockchange",(R=>{q=document.pointerLockElement===w,g.ht(q)})),document.addEventListener("fullscreenchange",(q=>{R=document.fullscreenElement===w,g.onFullscreenChanged(R)})),Object.defineProperty(g,"ft",{get:()=>q,set:g=>{g&&!q?T(w):q&&!g&&function(g){g.exitPointerLock&&g.exitPointerLock()}(document)}}),Object.defineProperty(g,"fullscreen",{get:()=>R,set:g=>{g&&!R?w.requestFullscreen():R&&!g&&document.exitFullscreen()}}),w.addEventListener("click",(o=>{g.Pt&&!q&&T(w),g.jt&&!R&&w.requestFullscreen()}));var o=()=>g.eq();if(window.ResizeObserver){new ResizeObserver(o).observe(w)}else window.addEventListener("resize",o)}(this,g),this.bt()}))}}var o=3,r=20;function S(g){for(var w=1e3/g.Ct,q=g._nowObject.now()+r,R=0;g._nowObject.now()>=g._lastTick+w&&g._nowObject.now()<q&&++R<=o;)g.Vt(w),g._lastTick+=w;var S=5*(w+5),i=g._nowObject.now();if(i-g._lastTick>S)for(;i>=g._lastTick+w;)g._lastTick+=w}function i(g){requestAnimationFrame(g._frameCB),S(g);var w=g._nowObject.now(),q=w-g._rt;if(g._rt=w,g.ct>0){g._renderAccum+=q;var R=1e3/g.ct;if(g._renderAccum<R)return;g._renderAccum=Math.min(g._renderAccum-R,R)}var o=1e3/g.Ct,r=(w-g._lastTick)/o;g.st(q,r,o)}function T(g){g.requestPointerLock&&g.requestPointerLock()}var z=g=>{if("loading"===document.readyState){var w=()=>{document.removeEventListener("readystatechange",w),g()};document.addEventListener("readystatechange",w)}else setTimeout(g,1)}},13044:(g,w,q)=>{var R=q(13047),o=q(13052),r="undefined"!==typeof Float64Array;function S(g,w){return g[0]-w[0]}function i(){var g,w=this.stride,q=new Array(w.length);for(g=0;g<q.length;++g)q[g]=[Math.abs(w[g]),g];q.sort(S);var R=new Array(q.length);for(g=0;g<R.length;++g)R[g]=q[g][1];return R}function T(g,w){var q=["View",w,"d",g].join("");w<0&&(q="View_Nil"+g);var o="generic"===g;if(-1===w){var r="function "+q+"(a){this.data=a;};var proto="+q+".prototype;proto.dtype='"+g+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+q+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+q+"(a){return new "+q+"(a);}";return new Function(r)()}if(0===w){r="function "+q+"(a,d) {this.data = a;this.offset = d};var proto="+q+".prototype;proto.dtype='"+g+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+q+"_copy() {return new "+q+"(this.data,this.offset)};proto.pick=function "+q+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+q+"_get(){return "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+q+"_set(v){return "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+q+"(a,b,c,d){return new "+q+"(a,d)}";return new Function("TrivialArray",r)(z[g][0])}r=["'use strict'"];var S=R(w),T=S.map((function(g){return"i"+g})),t="this.offset+"+S.map((function(g){return"this.stride["+g+"]*i"+g})).join("+"),m=S.map((function(g){return"b"+g})).join(","),e=S.map((function(g){return"c"+g})).join(",");r.push("function "+q+"(a,"+m+","+e+",d){this.data=a","this.shape=["+m+"]","this.stride=["+e+"]","this.offset=d|0}","var proto="+q+".prototype","proto.dtype='"+g+"'","proto.dimension="+w),r.push("Object.defineProperty(proto,'size',{get:function "+q+"_size(){return "+S.map((function(g){return"this.shape["+g+"]"})).join("*"),"}})"),1===w?r.push("proto.order=[0]"):(r.push("Object.defineProperty(proto,'order',{get:"),w<4?(r.push("function "+q+"_order(){"),2===w?r.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===w&&r.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):r.push("ORDER})")),r.push("proto.set=function "+q+"_set("+T.join(",")+",v){"),o?r.push("return this.data.set("+t+",v)}"):r.push("return this.data["+t+"]=v}"),r.push("proto.get=function "+q+"_get("+T.join(",")+"){"),o?r.push("return this.data.get("+t+")}"):r.push("return this.data["+t+"]}"),r.push("proto.index=function "+q+"_index(",T.join(),"){return "+t+"}"),r.push("proto.hi=function "+q+"_hi("+T.join(",")+"){return new "+q+"(this.data,"+S.map((function(g){return["(typeof i",g,"!=='number'||i",g,"<0)?this.shape[",g,"]:i",g,"|0"].join("")})).join(",")+","+S.map((function(g){return"this.stride["+g+"]"})).join(",")+",this.offset)}");var y=S.map((function(g){return"a"+g+"=this.shape["+g+"]"})),L=S.map((function(g){return"c"+g+"=this.stride["+g+"]"}));r.push("proto.lo=function "+q+"_lo("+T.join(",")+"){var b=this.offset,d=0,"+y.join(",")+","+L.join(","));for(var A=0;A<w;++A)r.push("if(typeof i"+A+"==='number'&&i"+A+">=0){d=i"+A+"|0;b+=c"+A+"*d;a"+A+"-=d}");r.push("return new "+q+"(this.data,"+S.map((function(g){return"a"+g})).join(",")+","+S.map((function(g){return"c"+g})).join(",")+",b)}"),r.push("proto.step=function "+q+"_step("+T.join(",")+"){var "+S.map((function(g){return"a"+g+"=this.shape["+g+"]"})).join(",")+","+S.map((function(g){return"b"+g+"=this.stride["+g+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(A=0;A<w;++A)r.push("if(typeof i"+A+"==='number'){d=i"+A+"|0;if(d<0){c+=b"+A+"*(a"+A+"-1);a"+A+"=ceil(-a"+A+"/d)}else{a"+A+"=ceil(a"+A+"/d)}b"+A+"*=d}");r.push("return new "+q+"(this.data,"+S.map((function(g){return"a"+g})).join(",")+","+S.map((function(g){return"b"+g})).join(",")+",c)}");var l=new Array(w),J=new Array(w);for(A=0;A<w;++A)l[A]="a[i"+A+"]",J[A]="b[i"+A+"]";r.push("proto.transpose=function "+q+"_transpose("+T+"){"+T.map((function(g,w){return g+"=("+g+"===undefined?"+w+":"+g+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+q+"(this.data,"+l.join(",")+","+J.join(",")+",this.offset)}"),r.push("proto.pick=function "+q+"_pick("+T+"){var a=[],b=[],c=this.offset");for(A=0;A<w;++A)r.push("if(typeof i"+A+"==='number'&&i"+A+">=0){c=(c+this.stride["+A+"]*i"+A+")|0}else{a.push(this.shape["+A+"]);b.push(this.stride["+A+"])}");return r.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),r.push("return function construct_"+q+"(data,shape,stride,offset){return new "+q+"(data,"+S.map((function(g){return"shape["+g+"]"})).join(",")+","+S.map((function(g){return"stride["+g+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",r.join("\n"))(z[g],i)}var z={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};g.exports=function(g,w,q,R){if(void 0===g)return(0,z.array[0])([]);"number"===typeof g&&(g=[g]),void 0===w&&(w=[g.length]);var S=w.length;if(void 0===q){q=new Array(S);for(var i=S-1,t=1;i>=0;--i)q[i]=t,t*=w[i]}if(void 0===R){R=0;for(i=0;i<S;++i)q[i]<0&&(R-=(w[i]-1)*q[i])}for(var m=function(g){if(o(g))return"buffer";if(r)switch(Object.prototype.toString.call(g)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(g)?"array":"generic"}(g),e=z[m];e.length<=S+1;)e.push(T(m,e.length-1));return(0,e[S+1])(g,w,q,R)}},13052:g=>{function w(g){return!!g.constructor&&"function"===typeof g.constructor.isBuffer&&g.constructor.isBuffer(g)}g.exports=function(g){return null!=g&&(w(g)||function(g){return"function"===typeof g.readFloatLE&&"function"===typeof g.slice&&w(g.slice(0,0))}(g)||!!g._isBuffer)}},13209:g=>{"use strict";var w=[],q=[],R=[],o=[],r=[],S=[],i=[],T=[],z=[],t=[],m=[],e=[];g.exports=function(g,y,L,A,l,J){for(var x=i,G=z,d=t,D=e,U=0;U<3;U++)x[U]=+L[U],d[U]=+y.max[U],G[U]=+y.base[U];J||(J=1e-10);var N=function(g,i,z,t,e,y){var L=w,A=q,l=R,J=o,x=r,G=S,d=T,D=Math.floor,U=0,N=0,a=0,H=0,C=0;if(c(),0===a)return 0;for(H=M();N<=a;){if(P(H)&&j())return U;H=M()}for(U+=a,C=0;C<3;C++)t[C]+=z[C],e[C]+=z[C];return U;function c(){if(N=0,0!==(a=Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2])))for(var g=0;g<3;g++){var w=z[g]>=0;J[g]=w?1:-1;var q=w?e[g]:t[g];L[g]=w?t[g]:e[g],A[g]=V(q,J[g]),l[g]=s(L[g],J[g]),d[g]=z[g]/a,x[g]=Math.abs(1/d[g]);var R=w?A[g]+1-q:q-A[g];G[g]=x[g]<1/0?x[g]*R:1/0}}function P(w){for(var q=J[0],R=0===w?A[0]:l[0],o=A[0]+q,r=J[1],S=1===w?A[1]:l[1],i=A[1]+r,T=J[2],z=2===w?A[2]:l[2],t=A[2]+T,m=R;m!=o;m+=q)for(var e=S;e!=i;e+=r)for(var y=z;y!=t;y+=T)if(g(m,e,y))return!0;return!1}function j(){U+=N;var g=J[H],w=N/a,q=m;for(C=0;C<3;C++){var R=z[C]*w;t[C]+=R,e[C]+=R,q[C]=z[C]-R}if(g>0?e[H]=Math.round(e[H]):t[H]=Math.round(t[H]),i(U,H,g,q))return!0;for(C=0;C<3;C++)z[C]=q[C];return c(),0===a}function M(){var g=G[0]<G[1]?G[0]<G[2]?0:2:G[1]<G[2]?1:2,w=G[g]-N;for(N=G[g],A[g]+=J[g],G[g]+=x[g],C=0;C<3;C++)L[C]+=w*d[C],l[C]=s(L[C],J[C]);return g}function V(g,w){return D(g-w*y)}function s(g,w){return D(g+w*y)}}(g,A,x,G,d,J);if(!l){for(U=0;U<3;U++)D[U]=L[U]>0?d[U]-y.max[U]:G[U]-y.base[U];y.translate(D)}return N}},13348:(g,w,q)=>{"use strict";q.d(w,{b:()=>m});var R=q(13200),o=q(11922);class r{constructor(g,w,q,r,S,i,T){this.Uz=new R(g.base,g.fz),this.LR=w,this.friction=q,this.restitution=r,this.CS=S,this.My=i,this.cS=!!T,this.Bz=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.dL=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.gz=o.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=o.create(),this._impulses=o.create(),this._sleepFrameCount=10}loadFromCopy(g){o.j(this.Uz.base,g.Uz.base),o.j(this.Uz.fz,g.Uz.fz),o.j(this.Uz.max,g.Uz.max),this.Uz.mag=g.Uz.mag,this.LR=g.LR,this.friction=g.friction,this.restitution=g.restitution,this.CS=g.CS,this.My=g.My,this.cS=g.cS,this.Bz=g.Bz,this.fluidDrag=g.fluidDrag,this.dL=g.dL,this.preventFallOffEdge=g.preventFallOffEdge,this.rolledBackLastTick=g.rolledBackLastTick,o.j(this.gz,g.gz),o.j(this.resting,g.resting),this.inFluid=g.inFluid,this._ratioInFluid=g._ratioInFluid,o.j(this._forces,g._forces),o.j(this._impulses,g._impulses),this._sleepFrameCount=g._sleepFrameCount}setPosition(g){S(g),o.yw(g,g,this.Uz.base),this.Uz.translate(g),this.Rz()}hr(){return o.clone(this.Uz.base)}applyForce(g){S(g),o.add(this._forces,this._forces,g),this.Rz()}applyImpulse(g){S(g),o.add(this._impulses,this._impulses,g),this.Rz()}Rz(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var S=g=>{};var i=q(13200),T=q(11922),z=q(13209);function t(){this.Bz=.1,this.fluidDrag=.4,this.sS=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function m(g,w,q){g=Object.assign(new t,g),this.gravity=g.gravity||[0,-10,0],this.Bz=g.Bz||.1,this.sS=g.sS||2,this.fluidDrag=g.fluidDrag||.4,this.minBounceImpulse=g.minBounceImpulse,this.bodies=[],this.We=g.We,this.testSolid=w,this.testFluid=q}m.prototype.Oy=function(g,w,q,R,o,S){g=g||new i([0,0,0],[1,1,1]),"undefined"==typeof w&&(w=1),"undefined"==typeof q&&(q=1),"undefined"==typeof R&&(R=0),"undefined"==typeof o&&(o=1);var T=new r(g,w,q,R,o,S);return this.bodies.push(T),T},m.prototype.Ey=function(g){var w=this.bodies.indexOf(g);w<0||(this.bodies.splice(w,1),g.Uz=g.My=null)};var e=T.create(),y=T.create(),L=T.create(),A=T.create(),l=T.create(),J=T.create(),x=T.create(),G=new i([0,0,0],[1,1,1]),d=new r(G,1,1,0,1,(()=>{}),!1);function D(g,w,q){return w=q,w*=1-(1-g.ratioInFluid)**2}m.prototype.FS=function(g){g/=1e3;var w=f(0,T.squaredLength(this.gravity));this.bodies.forEach((q=>function(g,w,q,R){T.j(l,w.resting),g.We&&d.loadFromCopy(w);if(w.LR<=0)return T.set(w.gz,0,0,0),T.set(w._forces,0,0,0),void T.set(w._impulses,0,0,0);var o=R||0===w.CS;if(function(g,w,q,R){if(w._sleepFrameCount>0)return!1;if(R)return!0;var o=!1,r=.5*q*q*w.CS;return T.scale(B,g.gravity,r),z(g.testSolid,w.Uz,B,(function(){return o=!0,!0}),!0),o}(g,w,q,o))return;w._sleepFrameCount--,function(g,w){var q=w.Uz,R=Math.floor(q.base[0]),o=Math.floor(q.base[2]),r=Math.floor(q.base[1]),S=Math.floor(q.max[1]);if(!g.testFluid(R,r,o))return w.inFluid=!1,void(w.ratioInFluid=0);var i=1,z=r+1;for(;z<=S&&g.testFluid(R,z,o);)i++,z++;var t=(r+i-q.base[1])/q.fz[1];t>1&&(t=1);var m=q.fz[0]*q.fz[1]*q.fz[2]*t,e=N;T.scale(e,g.gravity,-g.sS*m*w.CS),w.applyForce(e),w.inFluid=!0,w.ratioInFluid=t}(g,w),E(w._forces),E(w._impulses),E(w.gz),E(w.resting),T.scale(e,w._forces,1/w.LR),T.fS(e,e,g.gravity,w.CS),T.scale(y,w._impulses,1/w.LR),T.fS(y,y,e,q),T.add(w.gz,w.gz,y),w.friction&&(a(g,0,w,y,q),a(g,1,w,y,q),a(g,2,w,y,q));var r=w.fluidDrag>=0?w.fluidDrag:g.fluidDrag,S=w.Bz>=0?w.Bz:g.Bz,i=S,t=S;w.inFluid&&(i=D(w,i,w.fluidDragHoriz>=0?w.fluidDragHoriz:r),t=D(w,t,w.fluidDragVert>=0?w.fluidDragVert:r));i=Math.max(1-i*q/w.LR,0),t=Math.max(1-t*q/w.LR,0),T.set(U,i,t,i),T.multiply(w.gz,w.gz,U),T.scale(L,w.gz,q),T.set(w._forces,0,0,0),T.set(w._impulses,0,0,0),w.cS&&O(c,w.Uz);T.j(J,L),T.set(x,0,0,0),w.preventFallOffEdge&&function(g,w,q,R){if(!w.resting[1]||q[1]>0)return;var o=h;O(o,w.Uz);for(var r=0;r<3;r+=2){T.set(s,0,0,0),s[r]=q[r];var S=!0;(S=(S=(S=(S=S&&!b(g,o.base[0]+s[0]+1e-5,o.base[1],o.base[2]+s[2]+1e-5))&&!b(g,o.max[0]+s[0]-1e-5,o.base[1],o.base[2]+s[2]+1e-5))&&!b(g,o.base[0]+s[0]+1e-5,o.base[1],o.max[2]+s[2]-1e-5))&&!b(g,o.max[0]+s[0]-1e-5,o.base[1],o.max[2]+s[2]-1e-5))?(R[r]=q[r]>0?1:-1,q[r]=0):0===r&&(T.set(v,q[0],0,0),C(g,o,v,R,w.slideOnCollision))}}(g,w,L,x);C(g,w.Uz,L,w.resting,w.slideOnCollision),w.cS&&function(g,w,q,R){if(w.resting[1]>=0&&!w.inFluid)return;var o=0!==w.resting[0],r=0!==w.resting[2];if(!o&&!r)return;var S=Math.abs(R[0]/R[2]),i=4;if(!o&&S>i)return;if(!r&&S<1/i)return;T.add(j,q.base,R);var t=g.testSolid;z(t,q,R,(function(g,w,q,R){if(1!==w)return!0;R[w]=0}));var m=q.base[1],e=w.inFluid?1.951:1.001,y=Math.floor(m+e)-m;T.set(M,0,y,0);var L=!1;if(z(t,q,M,(function(g,w,q,R){return L=!0,!0})),L)return;T.yw(V,j,q.base),V[1]=0,C(g,q,V,P,!0);var A=f(q.base[0],j[0]),l=f(q.base[2],j[2]);if(o&&!A&&(!l||!r))return;if(r&&(!A||!o)&&!l)return;var J=!0;if(J=J&&!b(g,q.base[0]+1e-5,q.base[1],q.base[2]+1e-5),J=J&&!b(g,q.max[0]-1e-5,q.base[1],q.base[2]+1e-5),J=J&&!b(g,q.base[0]+1e-5,q.base[1],q.max[2]-1e-5),J=J&&!b(g,q.max[0]-1e-5,q.base[1],q.max[2]-1e-5),J)return;O(w.Uz,q),w.resting[0]=P[0],w.resting[2]=P[2],w.dL&&w.dL()}(g,w,c,J);for(var m=0;m<3;++m)w.resting[m]=w.resting[m]||x[m],A[m]=0,w.resting[m]&&(l[m]||(A[m]=-w.gz[m]),w.gz[m]=0);var G=T.length(A);G>.001&&(T.scale(A,A,w.LR),w.My&&w.My(A),w.restitution>0&&G>g.minBounceImpulse&&(T.scale(A,A,w.restitution),w.applyImpulse(A)));var H=T.squaredLength(w.gz);H>1e-5&&w.Rz();g.We&&g.We(w)?(w.loadFromCopy(d),w.rolledBackLastTick=!0):w.rolledBackLastTick=!1}(this,q,g,w)))};var U=T.create([0,0,0]);var N=T.create();function a(g,w,q,R,o){var r=q.resting[w],S=R[w];if(!q.alwaysApplyHorizFriction||1!==w){if(0===r)return;if(r*S<=0)return}T.j(H,q.gz),H[w]=0;var i=T.length(H);if(!f(i,0)){var z=Math.abs(q.friction*g.gravity[w]*o),t=i>z?(i-z)/i:0;q.gz[(w+1)%3]*=t,q.gz[(w+2)%3]*=t}}var H=T.create();function C(g,w,q,R,o){return T.set(R,0,0,0),z(g.testSolid,w,q,(function(g,w,q,r){R[w]=q,r[w]=0,o||(r[0]=0,r[1]=0,r[2]=0)}))}var c=new i([],[]),P=T.create(),j=T.create(),M=T.create(),V=T.create();var s=T.create(),h=new i([],[]),v=T.create();function b(g,w,q,R){return g.testSolid(Math.floor(w),Math.floor(q-1),Math.floor(R))}var B=T.create();function f(g,w){return Math.abs(g-w)<1e-5}function O(g,w){for(var q=0;q<3;q++)g.base[q]=w.base[q],g.max[q]=w.max[q],g.fz[q]=w.fz[q]}var E=function(g){}},11818:function(g,w){!function(g){"use strict";var w=function(g,q){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,w){g.__proto__=w}||function(g,w){for(var q in w)Object.prototype.hasOwnProperty.call(w,q)&&(g[q]=w[q])},w(g,q)};function q(g,q){if("function"!==typeof q&&null!==q)throw new TypeError("Class extends value "+String(q)+" is not a constructor or null");function R(){this.constructor=g}w(g,q),g.prototype=null===q?Object.create(q):(R.prototype=q.prototype,new R)}function R(g,w,q,R){var o,r=arguments.length,S=r<3?w:null===R?R=Object.getOwnPropertyDescriptor(w,q):R;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)S=Reflect.decorate(g,w,q,R);else for(var i=g.length-1;i>=0;i--)(o=g[i])&&(S=(r<3?o(S):r>3?o(w,q,S):o(w,q))||S);return r>3&&S&&Object.defineProperty(w,q,S),S}function o(g,w,q){if(q||2===arguments.length)for(var R,o=0,r=w.length;o<r;o++)!R&&o in w||(R||(R=Array.prototype.slice.call(w,0,o)),R[o]=w[o]);return g.concat(R||Array.prototype.slice.call(w))}var r,S=255,i=213;g.OPERATION=void 0,(r=g.OPERATION||(g.OPERATION={}))[r.ADD=128]="ADD",r[r.REPLACE=0]="REPLACE",r[r.DELETE=64]="DELETE",r[r.DELETE_AND_ADD=192]="DELETE_AND_ADD",r[r.TOUCH=1]="TOUCH",r[r.CLEAR=10]="CLEAR";var T=function(){function w(g,w,q){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=g,this.setParent(w,q)}return w.prototype.setParent=function(g,w,q){var R=this;if(this.indexes||(this.indexes=this.ref instanceof Vg?this.ref._definition.indexes:{}),this.parent=g,this.parentIndex=q,w)if(this.root=w,this.ref instanceof Vg){var o=this.ref._definition;for(var r in o.schema){var S=this.ref[r];if(S&&S.$changes){var i=o.indexes[r];S.$changes.setParent(this.ref,w,i)}}}else"object"===typeof this.ref&&this.ref.forEach((function(g,w){if(g instanceof Vg){var q=g.$changes,o=R.ref.$changes.indexes[w];q.setParent(R.ref,R.root,o)}}))},w.prototype.operation=function(g){this.changes.set(--this.currentCustomOperation,g)},w.prototype.change=function(w,q){void 0===q&&(q=g.OPERATION.ADD);var R="number"===typeof w?w:this.indexes[w];this.assertValidIndex(R,w);var o=this.changes.get(R);o&&o.op!==g.OPERATION.DELETE&&o.op!==g.OPERATION.TOUCH||this.changes.set(R,{op:o&&o.op===g.OPERATION.DELETE?g.OPERATION.DELETE_AND_ADD:q,index:R}),this.allChanges.add(R),this.changed=!0,this.touchParents()},w.prototype.touch=function(w){var q="number"===typeof w?w:this.indexes[w];this.assertValidIndex(q,w),this.changes.has(q)||this.changes.set(q,{op:g.OPERATION.TOUCH,index:q}),this.allChanges.add(q),this.touchParents()},w.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},w.prototype.getType=function(g){if(this.ref._definition)return(w=this.ref._definition).schema[w.fieldsByIndex[g]];var w,q=(w=this.parent._definition).schema[w.fieldsByIndex[this.parentIndex]];return Object.values(q)[0]},w.prototype.getChildrenFilter=function(){var g=this.parent._definition.childFilters;return g&&g[this.parentIndex]},w.prototype.getValue=function(g){return this.ref.getByIndex(g)},w.prototype.delete=function(w){var q="number"===typeof w?w:this.indexes[w];if(void 0!==q){var R=this.getValue(q);this.changes.set(q,{op:g.OPERATION.DELETE,index:q}),this.allChanges.delete(q),delete this.caches[q],R&&R.$changes&&(R.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(w," (").concat(q,")"))},w.prototype.discard=function(w,q){var R=this;void 0===w&&(w=!1),void 0===q&&(q=!1),this.ref instanceof Vg||this.changes.forEach((function(w){if(w.op===g.OPERATION.DELETE){var q=R.ref.getIndex(w.index);delete R.indexes[q]}})),this.changes.clear(),this.changed=w,q&&this.allChanges.clear(),this.currentCustomOperation=0},w.prototype.discardAll=function(){var g=this;this.changes.forEach((function(w){var q=g.getValue(w.index);q&&q.$changes&&q.$changes.discardAll()})),this.discard()},w.prototype.cache=function(g,w){this.caches[g]=w},w.prototype.clone=function(){return new w(this.ref,this.parent,this.root)},w.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},w.prototype.assertValidIndex=function(g,w){if(void 0===g)throw new Error('ChangeTree: missing index for field "'.concat(w,'"'))},w}();function z(g,w,q,R){return g[w]||(g[w]=[]),g[w].push(q),null===R||void 0===R||R.forEach((function(g,w){return q(g,w)})),function(){return m(g[w],g[w].indexOf(q))}}function t(w){var q=this,R="string"!==typeof this.$changes.getType();this.$items.forEach((function(o,r){w.push({refId:q.$changes.refId,op:g.OPERATION.DELETE,field:r,value:void 0,previousValue:o}),R&&q.$changes.root.removeRef(o.$changes.refId)}))}function m(g,w){if(-1===w||w>=g.length)return!1;for(var q=g.length-1,R=w;R<q;R++)g[R]=g[R+1];return g.length=q,!0}var e=function(g,w){var q=g.toString(),R=w.toString();return q<R?-1:q>R?1:0};function y(g){return g.$proxy=!0,g=new Proxy(g,{get:function(g,w){return"symbol"===typeof w||isNaN(w)?g[w]:g.at(w)},set:function(g,w,q){if("symbol"===typeof w||isNaN(w))g[w]=q;else{var R=Array.from(g.$items.keys()),o=parseInt(R[w]||w);void 0===q||null===q?g.deleteAt(o):g.setAt(o,q)}return!0},deleteProperty:function(g,w){return"number"===typeof w?g.deleteAt(w):delete g[w],!0}})}var L=function(){function w(){for(var g=[],w=0;w<arguments.length;w++)g[w]=arguments[w];this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,g)}return w.prototype.Ci=function(w,q){return void 0===q&&(q=!0),z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.ADD,w,q?this.$items:void 0)},w.prototype.qq=function(w){return z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.DELETE,w)},w.prototype.onChange=function(w){return z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.REPLACE,w)},w.is=function(g){return Array.isArray(g)||void 0!==g.array},Object.defineProperty(w.prototype,"length",{get:function(){return this.$items.size},set:function(g){0===g?this.clear():this.splice(g,this.length-g)},enumerable:!1,configurable:!0}),w.prototype.push=function(){for(var g,w=this,q=[],R=0;R<arguments.length;R++)q[R]=arguments[R];return q.forEach((function(q){g=w.$refId++,w.setAt(g,q)})),g},w.prototype.pop=function(){var g=Array.from(this.$indexes.values()).pop();if(void 0!==g){this.$changes.delete(g),this.$indexes.delete(g);var w=this.$items.get(g);return this.$items.delete(g),w}},w.prototype.at=function(g){var w=Array.from(this.$items.keys())[g];return this.$items.get(w)},w.prototype.setAt=function(w,q){var R,o;if(void 0!==q&&null!==q){if(this.$items.get(w)!==q){void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,w);var r=null!==(o=null===(R=this.$changes.indexes[w])||void 0===R?void 0:R.op)&&void 0!==o?o:g.OPERATION.ADD;this.$changes.indexes[w]=w,this.$indexes.set(w,w),this.$items.set(w,q),this.$changes.change(w,r)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},w.prototype.deleteAt=function(g){var w=Array.from(this.$items.keys())[g];return void 0!==w&&this.$deleteAt(w)},w.prototype.$deleteAt=function(g){return this.$changes.delete(g),this.$indexes.delete(g),this.$items.delete(g)},w.prototype.clear=function(w){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),w&&t.call(this,w),this.$items.clear(),this.$changes.operation({index:0,op:g.OPERATION.CLEAR}),this.$changes.touchParents()},w.prototype.concat=function(){for(var g,q=[],R=0;R<arguments.length;R++)q[R]=arguments[R];return new(w.bind.apply(w,o([void 0],(g=Array.from(this.$items.values())).concat.apply(g,q),!1)))},w.prototype.join=function(g){return Array.from(this.$items.values()).join(g)},w.prototype.reverse=function(){var g=this,w=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(q,R){g.setAt(w[R],q)})),this},w.prototype.shift=function(){var g=Array.from(this.$items.keys()).shift();if(void 0!==g){var w=this.$items.get(g);return this.$deleteAt(g),w}},w.prototype.slice=function(g,q){var R=new w;return R.push.apply(R,Array.from(this.$items.values()).slice(g,q)),R},w.prototype.sort=function(g){var w=this;void 0===g&&(g=e);var q=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(g).forEach((function(g,R){w.setAt(q[R],g)})),this},w.prototype.splice=function(g,w){void 0===w&&(w=this.length-g);for(var q=Array.from(this.$items.keys()),R=[],o=g;o<g+w;o++)R.push(this.$items.get(q[o])),this.$deleteAt(q[o]);return R},w.prototype.unshift=function(){for(var g=this,w=[],q=0;q<arguments.length;q++)w[q]=arguments[q];var R=this.length,o=w.length,r=Array.from(this.$items.values());return w.forEach((function(w,q){g.setAt(q,w)})),r.forEach((function(w,q){g.setAt(o+q,w)})),R+o},w.prototype.indexOf=function(g,w){return Array.from(this.$items.values()).indexOf(g,w)},w.prototype.lastIndexOf=function(g,w){return void 0===w&&(w=this.length-1),Array.from(this.$items.values()).lastIndexOf(g,w)},w.prototype.every=function(g,w){return Array.from(this.$items.values()).every(g,w)},w.prototype.some=function(g,w){return Array.from(this.$items.values()).some(g,w)},w.prototype.forEach=function(g,w){Array.from(this.$items.values()).forEach(g,w)},w.prototype.map=function(g,w){return Array.from(this.$items.values()).map(g,w)},w.prototype.filter=function(g,w){return Array.from(this.$items.values()).filter(g,w)},w.prototype.reduce=function(g,w){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},w.prototype.reduceRight=function(g,w){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},w.prototype.find=function(g,w){return Array.from(this.$items.values()).find(g,w)},w.prototype.findIndex=function(g,w){return Array.from(this.$items.values()).findIndex(g,w)},w.prototype.fill=function(g,w,q){throw new Error("ArraySchema#fill() not implemented")},w.prototype.copyWithin=function(g,w,q){throw new Error("ArraySchema#copyWithin() not implemented")},w.prototype.toString=function(){return this.$items.toString()},w.prototype.toLocaleString=function(){return this.$items.toLocaleString()},w.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(w,Symbol.species,{get:function(){return w},enumerable:!1,configurable:!0}),w.prototype.entries=function(){return this.$items.entries()},w.prototype.keys=function(){return this.$items.keys()},w.prototype.values=function(){return this.$items.values()},w.prototype.includes=function(g,w){return Array.from(this.$items.values()).includes(g,w)},w.prototype.flatMap=function(g,w){throw new Error("ArraySchema#flatMap() is not supported.")},w.prototype.flat=function(g){throw new Error("ArraySchema#flat() is not supported.")},w.prototype.findLast=function(){var g=Array.from(this.$items.values());return g.findLast.apply(g,arguments)},w.prototype.findLastIndex=function(){var g=Array.from(this.$items.values());return g.findLastIndex.apply(g,arguments)},w.prototype.setIndex=function(g,w){this.$indexes.set(g,w)},w.prototype.getIndex=function(g){return this.$indexes.get(g)},w.prototype.getByIndex=function(g){return this.$items.get(this.$indexes.get(g))},w.prototype.deleteByIndex=function(g){var w=this.$indexes.get(g);this.$items.delete(w),this.$indexes.delete(g)},w.prototype.toArray=function(){return Array.from(this.$items.values())},w.prototype.toJSON=function(){return this.toArray().map((function(g){return"function"===typeof g.toJSON?g.toJSON():g}))},w.prototype.clone=function(g){return g?new(w.bind.apply(w,o([void 0],Array.from(this.$items.values()),!1))):new(w.bind.apply(w,o([void 0],this.map((function(g){return g.$changes?g.clone():g})),!1)))},w}();function A(g){return g.$proxy=!0,g=new Proxy(g,{get:function(g,w){return"symbol"!==typeof w&&"undefined"===typeof g[w]?g.get(w):g[w]},set:function(g,w,q){return"symbol"!==typeof w&&-1===w.indexOf("$")&&"Ci"!==w&&"qq"!==w&&"onChange"!==w?g.set(w,q):g[w]=q,!0},deleteProperty:function(g,w){return g.delete(w),!0}})}var l=function(){function w(g){var q=this;if(this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,g)if(g instanceof Map||g instanceof w)g.forEach((function(g,w){return q.set(w,g)}));else for(var R in g)this.set(R,g[R])}return w.prototype.Ci=function(w,q){return void 0===q&&(q=!0),z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.ADD,w,q?this.$items:void 0)},w.prototype.qq=function(w){return z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.DELETE,w)},w.prototype.onChange=function(w){return z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.REPLACE,w)},w.is=function(g){return void 0!==g.map},w.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(w.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(w,Symbol.species,{get:function(){return w},enumerable:!1,configurable:!0}),w.prototype.set=function(w,q){if(void 0===q||null===q)throw new Error("MapSchema#set('".concat(w,"', ").concat(q,"): trying to set ").concat(q," value on '").concat(w,"'."));w=w.toString();var R="undefined"!==typeof this.$changes.indexes[w],o=R?this.$changes.indexes[w]:this.$refId++,r=R?g.OPERATION.REPLACE:g.OPERATION.ADD,S=void 0!==q.$changes;if(S&&q.$changes.setParent(this,this.$changes.root,o),R){if(!S&&this.$items.get(w)===q)return;S&&this.$items.get(w)!==q&&(r=g.OPERATION.ADD)}else this.$changes.indexes[w]=o,this.$indexes.set(o,w);return this.$items.set(w,q),this.$changes.change(w,r),this},w.prototype.get=function(g){return this.$items.get(g)},w.prototype.delete=function(g){return this.$changes.delete(g),this.$items.delete(g)},w.prototype.clear=function(w){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),w&&t.call(this,w),this.$items.clear(),this.$changes.operation({index:0,op:g.OPERATION.CLEAR}),this.$changes.touchParents()},w.prototype.has=function(g){return this.$items.has(g)},w.prototype.forEach=function(g){this.$items.forEach(g)},w.prototype.entries=function(){return this.$items.entries()},w.prototype.keys=function(){return this.$items.keys()},w.prototype.values=function(){return this.$items.values()},Object.defineProperty(w.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),w.prototype.setIndex=function(g,w){this.$indexes.set(g,w)},w.prototype.getIndex=function(g){return this.$indexes.get(g)},w.prototype.getByIndex=function(g){return this.$items.get(this.$indexes.get(g))},w.prototype.deleteByIndex=function(g){var w=this.$indexes.get(g);this.$items.delete(w),this.$indexes.delete(g)},w.prototype.toJSON=function(){var g={};return this.forEach((function(w,q){g[q]="function"===typeof w.toJSON?w.toJSON():w})),g},w.prototype.clone=function(g){var q;return g?q=Object.assign(new w,this):(q=new w,this.forEach((function(g,w){g.$changes?q.set(w,g.clone()):q.set(w,g)}))),q},w}(),J={};function x(g,w){J[g]=w}function G(g){return J[g]}var d=function(){function g(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return g.create=function(w){var q=new g;return q.schema=Object.assign({},w&&w.schema||{}),q.indexes=Object.assign({},w&&w.indexes||{}),q.fieldsByIndex=Object.assign({},w&&w.fieldsByIndex||{}),q.descriptors=Object.assign({},w&&w.descriptors||{}),q.deprecated=Object.assign({},w&&w.deprecated||{}),q},g.prototype.addField=function(g,w){var q=this.getNextFieldIndex();this.fieldsByIndex[q]=g,this.indexes[g]=q,this.schema[g]=Array.isArray(w)?{array:w[0]}:w},g.prototype.hasField=function(g){return void 0!==this.indexes[g]},g.prototype.addFilter=function(g,w){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[g]]=w,this.indexesWithFilters.push(this.indexes[g]),!0},g.prototype.addChildrenFilter=function(g,w){var q=this.indexes[g],R=this.schema[g];if(G(Object.keys(R)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[q]=w,!0;console.warn("@filterChildren: field '".concat(g,"' can't have children. Ignoring filter."))},g.prototype.getChildrenFilter=function(g){return this.childFilters&&this.childFilters[this.indexes[g]]},g.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},g}();function D(g){return g._context&&g._context.useFilters}var U=function(){function g(){this.types={},this.schemas=new Map,this.useFilters=!1}return g.prototype.has=function(g){return this.schemas.has(g)},g.prototype.get=function(g){return this.types[g]},g.prototype.add=function(g,w){void 0===w&&(w=this.schemas.size),g._definition=d.create(g._definition),g._typeid=w,this.types[w]=g,this.schemas.set(g,w)},g.create=function(w){return void 0===w&&(w={}),function(q){return w.context||(w.context=new g),a(q,w)}},g}(),N=new U;function a(g,w){return void 0===w&&(w={}),function(q,R){var r=w.context||N,S=q.constructor;if(S._context=r,!g)throw new Error("".concat(S.name,': @type() reference provided for "').concat(R,"\" is undefined. Make sure you don't have any circular dependencies."));r.has(S)||r.add(S);var i=S._definition;if(i.addField(R,g),i.descriptors[R]){if(i.deprecated[R])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(R,"' definition on '").concat(S.name,"'.\nCheck @type() annotation"))}catch(J){var T=J.stack.split("\n")[4].trim();throw new Error("".concat(J.message," ").concat(T))}}var z=L.is(g),t=!z&&l.is(g);if("string"!==typeof g&&!Vg.is(g)){var m=Object.values(g)[0];"string"===typeof m||r.has(m)||r.add(m)}if(w.manual)i.descriptors[R]={enumerable:!0,configurable:!0,writable:!0};else{var e="_".concat(R);i.descriptors[e]={enumerable:!1,configurable:!1,writable:!0},i.descriptors[R]={get:function(){return this[e]},set:function(g){g!==this[e]&&(void 0!==g&&null!==g?(!z||g instanceof L||(g=new(L.bind.apply(L,o([void 0],g,!1)))),!t||g instanceof l||(g=new l(g)),void 0===g.$proxy&&(t?g=A(g):z&&(g=y(g))),this.$changes.change(R),g.$changes&&g.$changes.setParent(this,this.$changes.root,this._definition.indexes[R])):this[e]&&this.$changes.delete(R),this[e]=g)},enumerable:!0,configurable:!0}}}}function H(g){return function(w,q){var R=w.constructor;R._definition.addFilter(q,g)&&(R._context.useFilters=!0)}}function C(g){return function(w,q){var R=w.constructor;R._definition.addChildrenFilter(q,g)&&(R._context.useFilters=!0)}}function c(g){return void 0===g&&(g=!0),function(w,q){var R=w.constructor._definition;R.deprecated[q]=!0,g&&(R.descriptors[q]={get:function(){throw new Error("".concat(q," is deprecated."))},set:function(g){},enumerable:!1,configurable:!0})}}function P(g,w,q){for(var R in void 0===q&&(q={}),q.context||(q.context=g._context||q.context||N),w)a(w[R],q)(g.prototype,R);return g}function j(g){for(var w=0,q=0,R=0,o=g.length;R<o;R++)(w=g.charCodeAt(R))<128?q+=1:w<2048?q+=2:w<55296||w>=57344?q+=3:(R++,q+=4);return q}function M(g,w,q){for(var R=0,o=0,r=q.length;o<r;o++)(R=q.charCodeAt(o))<128?g[w++]=R:R<2048?(g[w++]=192|R>>6,g[w++]=128|63&R):R<55296||R>=57344?(g[w++]=224|R>>12,g[w++]=128|R>>6&63,g[w++]=128|63&R):(o++,R=65536+((1023&R)<<10|1023&q.charCodeAt(o)),g[w++]=240|R>>18,g[w++]=128|R>>12&63,g[w++]=128|R>>6&63,g[w++]=128|63&R)}function V(g,w){g.push(255&w)}function s(g,w){g.push(255&w)}function h(g,w){g.push(255&w),g.push(w>>8&255)}function v(g,w){g.push(255&w),g.push(w>>8&255)}function b(g,w){g.push(255&w),g.push(w>>8&255),g.push(w>>16&255),g.push(w>>24&255)}function B(g,w){var q=w>>24,R=w>>16,o=w>>8,r=w;g.push(255&r),g.push(255&o),g.push(255&R),g.push(255&q)}function f(g,w){var q=Math.floor(w/Math.pow(2,32));B(g,w>>>0),B(g,q)}function O(g,w){var q=w/Math.pow(2,32)|0;B(g,w>>>0),B(g,q)}function E(g,w){F(g,w)}function Q(g,w){u(g,w)}var X=new Int32Array(2),K=new Float32Array(X.buffer),Y=new Float64Array(X.buffer);function F(g,w){K[0]=w,b(g,X[0])}function u(g,w){Y[0]=w,b(g,X[0]),b(g,X[1])}function n(g,w){return s(g,w?1:0)}function W(g,w){w||(w="");var q=j(w),R=0;if(q<32)g.push(160|q),R=1;else if(q<256)g.push(217),s(g,q),R=2;else if(q<65536)g.push(218),v(g,q),R=3;else{if(!(q<4294967296))throw new Error("String too long");g.push(219),B(g,q),R=5}return M(g,g.length,w),R+q}function p(g,w){return isNaN(w)?p(g,0):isFinite(w)?w!==(0|w)?(g.push(203),u(g,w),9):w>=0?w<128?(s(g,w),1):w<256?(g.push(204),s(g,w),2):w<65536?(g.push(205),v(g,w),3):w<4294967296?(g.push(206),B(g,w),5):(g.push(207),O(g,w),9):w>=-32?(g.push(224|w+32),1):w>=-128?(g.push(208),V(g,w),2):w>=-32768?(g.push(209),h(g,w),3):w>=-2147483648?(g.push(210),b(g,w),5):(g.push(211),f(g,w),9):p(g,w>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var Z=Object.freeze({__proto__:null,utf8Write:M,int8:V,uint8:s,int16:h,uint16:v,int32:b,uint32:B,int64:f,uint64:O,float32:E,float64:Q,writeFloat32:F,writeFloat64:u,boolean:n,string:W,number:p});function I(g,w,q){for(var R="",o=0,r=w,S=w+q;r<S;r++){var i=g[r];0!==(128&i)?192!==(224&i)?224!==(240&i)?240!==(248&i)?console.error("Invalid byte "+i.toString(16)):(o=(7&i)<<18|(63&g[++r])<<12|(63&g[++r])<<6|63&g[++r])>=65536?(o-=65536,R+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):R+=String.fromCharCode(o):R+=String.fromCharCode((15&i)<<12|(63&g[++r])<<6|63&g[++r]):R+=String.fromCharCode((31&i)<<6|63&g[++r]):R+=String.fromCharCode(i)}return R}function k(g,w){return gg(g,w)<<24>>24}function gg(g,w){return g[w.offset++]}function wg(g,w){return qg(g,w)<<16>>16}function qg(g,w){return g[w.offset++]|g[w.offset++]<<8}function Rg(g,w){return g[w.offset++]|g[w.offset++]<<8|g[w.offset++]<<16|g[w.offset++]<<24}function og(g,w){return Rg(g,w)>>>0}function rg(g,w){return eg(g,w)}function Sg(g,w){return yg(g,w)}function ig(g,w){var q=og(g,w);return Rg(g,w)*Math.pow(2,32)+q}function Tg(g,w){var q=og(g,w);return og(g,w)*Math.pow(2,32)+q}var zg=new Int32Array(2),tg=new Float32Array(zg.buffer),mg=new Float64Array(zg.buffer);function eg(g,w){return zg[0]=Rg(g,w),tg[0]}function yg(g,w){return zg[0]=Rg(g,w),zg[1]=Rg(g,w),mg[0]}function Lg(g,w){return gg(g,w)>0}function Ag(g,w){var q,R=g[w.offset++];R<192?q=31&R:217===R?q=gg(g,w):218===R?q=qg(g,w):219===R&&(q=og(g,w));var o=I(g,w.offset,q);return w.offset+=q,o}function lg(g,w){var q=g[w.offset];return q<192&&q>160||217===q||218===q||219===q}function Jg(g,w){var q=g[w.offset++];return q<128?q:202===q?eg(g,w):203===q?yg(g,w):204===q?gg(g,w):205===q?qg(g,w):206===q?og(g,w):207===q?Tg(g,w):208===q?k(g,w):209===q?wg(g,w):210===q?Rg(g,w):211===q?ig(g,w):q>223?-1*(255-q+1):void 0}function xg(g,w){var q=g[w.offset];return q<128||q>=202&&q<=211}function Gg(g,w){return g[w.offset]<160}function dg(g,w){return g[w.offset-1]===S&&(g[w.offset]<128||g[w.offset]>=202&&g[w.offset]<=211)}var Dg=Object.freeze({__proto__:null,int8:k,uint8:gg,int16:wg,uint16:qg,int32:Rg,uint32:og,float32:rg,float64:Sg,int64:ig,uint64:Tg,readFloat32:eg,readFloat64:yg,boolean:Lg,string:Ag,stringCheck:lg,number:Jg,numberCheck:xg,arrayCheck:Gg,switchStructureCheck:dg}),Ug=function(){function w(g){var w=this;this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,g&&g.forEach((function(g){return w.add(g)}))}return w.prototype.Ci=function(w,q){return void 0===q&&(q=!0),z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.ADD,w,q?this.$items:void 0)},w.prototype.qq=function(w){return z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.DELETE,w)},w.prototype.onChange=function(w){return z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.REPLACE,w)},w.is=function(g){return void 0!==g.collection},w.prototype.add=function(g){var w=this.$refId++;return void 0!==g.$changes&&g.$changes.setParent(this,this.$changes.root,w),this.$changes.indexes[w]=w,this.$indexes.set(w,w),this.$items.set(w,g),this.$changes.change(w),w},w.prototype.at=function(g){var w=Array.from(this.$items.keys())[g];return this.$items.get(w)},w.prototype.entries=function(){return this.$items.entries()},w.prototype.delete=function(g){for(var w,q,R=this.$items.entries();(q=R.next())&&!q.done;)if(g===q.value[1]){w=q.value[0];break}return void 0!==w&&(this.$changes.delete(w),this.$indexes.delete(w),this.$items.delete(w))},w.prototype.clear=function(w){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),w&&t.call(this,w),this.$items.clear(),this.$changes.operation({index:0,op:g.OPERATION.CLEAR}),this.$changes.touchParents()},w.prototype.has=function(g){return Array.from(this.$items.values()).some((function(w){return w===g}))},w.prototype.forEach=function(g){var w=this;this.$items.forEach((function(q,R,o){return g(q,R,w)}))},w.prototype.values=function(){return this.$items.values()},Object.defineProperty(w.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),w.prototype.setIndex=function(g,w){this.$indexes.set(g,w)},w.prototype.getIndex=function(g){return this.$indexes.get(g)},w.prototype.getByIndex=function(g){return this.$items.get(this.$indexes.get(g))},w.prototype.deleteByIndex=function(g){var w=this.$indexes.get(g);this.$items.delete(w),this.$indexes.delete(g)},w.prototype.toArray=function(){return Array.from(this.$items.values())},w.prototype.toJSON=function(){var g=[];return this.forEach((function(w,q){g.push("function"===typeof w.toJSON?w.toJSON():w)})),g},w.prototype.clone=function(g){var q;return g?q=Object.assign(new w,this):(q=new w,this.forEach((function(g){g.$changes?q.add(g.clone()):q.add(g)}))),q},w}(),Ng=function(){function w(g){var w=this;this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,g&&g.forEach((function(g){return w.add(g)}))}return w.prototype.Ci=function(w,q){return void 0===q&&(q=!0),z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.ADD,w,q?this.$items:void 0)},w.prototype.qq=function(w){return z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.DELETE,w)},w.prototype.onChange=function(w){return z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.REPLACE,w)},w.is=function(g){return void 0!==g.set},w.prototype.add=function(w){var q,R;if(this.has(w))return!1;var o=this.$refId++;void 0!==w.$changes&&w.$changes.setParent(this,this.$changes.root,o);var r=null!==(R=null===(q=this.$changes.indexes[o])||void 0===q?void 0:q.op)&&void 0!==R?R:g.OPERATION.ADD;return this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,w),this.$changes.change(o,r),o},w.prototype.entries=function(){return this.$items.entries()},w.prototype.delete=function(g){for(var w,q,R=this.$items.entries();(q=R.next())&&!q.done;)if(g===q.value[1]){w=q.value[0];break}return void 0!==w&&(this.$changes.delete(w),this.$indexes.delete(w),this.$items.delete(w))},w.prototype.clear=function(w){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),w&&t.call(this,w),this.$items.clear(),this.$changes.operation({index:0,op:g.OPERATION.CLEAR}),this.$changes.touchParents()},w.prototype.has=function(g){for(var w,q=this.$items.values(),R=!1;(w=q.next())&&!w.done;)if(g===w.value){R=!0;break}return R},w.prototype.forEach=function(g){var w=this;this.$items.forEach((function(q,R,o){return g(q,R,w)}))},w.prototype.values=function(){return this.$items.values()},Object.defineProperty(w.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),w.prototype.setIndex=function(g,w){this.$indexes.set(g,w)},w.prototype.getIndex=function(g){return this.$indexes.get(g)},w.prototype.getByIndex=function(g){return this.$items.get(this.$indexes.get(g))},w.prototype.deleteByIndex=function(g){var w=this.$indexes.get(g);this.$items.delete(w),this.$indexes.delete(g)},w.prototype.toArray=function(){return Array.from(this.$items.values())},w.prototype.toJSON=function(){var g=[];return this.forEach((function(w,q){g.push("function"===typeof w.toJSON?w.toJSON():w)})),g},w.prototype.clone=function(g){var q;return g?q=Object.assign(new w,this):(q=new w,this.forEach((function(g){g.$changes?q.add(g.clone()):q.add(g)}))),q},w}(),ag=function(){function g(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return g.prototype.addRefId=function(g){this.refIds.has(g)||(this.refIds.add(g),this.containerIndexes.set(g,new Set))},g.get=function(w){return void 0===w.$filterState&&(w.$filterState=new g),w.$filterState},g}(),Hg=function(){function g(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return g.prototype.getNextUniqueId=function(){return this.nextUniqueId++},g.prototype.addRef=function(g,w,q){void 0===q&&(q=!0),this.refs.set(g,w),q&&(this.refCounts[g]=(this.refCounts[g]||0)+1)},g.prototype.removeRef=function(g){this.refCounts[g]=this.refCounts[g]-1,this.deletedRefs.add(g)},g.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},g.prototype.garbageCollectDeletedRefs=function(){var g=this;this.deletedRefs.forEach((function(w){if(!(g.refCounts[w]>0)){var q=g.refs.get(w);if(q instanceof Vg)for(var R in q._definition.schema)"string"!==typeof q._definition.schema[R]&&q[R]&&q[R].$changes&&g.removeRef(q[R].$changes.refId);else{var o=q.$changes.parent._definition,r=o.schema[o.fieldsByIndex[q.$changes.parentIndex]];"function"===typeof Object.values(r)[0]&&Array.from(q.values()).forEach((function(w){return g.removeRef(w.$changes.refId)}))}g.refs.delete(w),delete g.refCounts[w]}})),this.deletedRefs.clear()},g}(),Cg=function(g){function w(){return null!==g&&g.apply(this,arguments)||this}return q(w,g),w}(Error);function cg(g,w,q,R){var o,r=!1;switch(w){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":o="number",isNaN(g)&&console.log('trying to encode "NaN" in '.concat(q.constructor.name,"#").concat(R));break;case"string":o="string",r=!0;break;case"boolean":return}if(typeof g!==o&&(!r||r&&null!==g)){var S="'".concat(JSON.stringify(g),"'").concat(g&&g.constructor&&" (".concat(g.constructor.name,")")||"");throw new Cg("a '".concat(o,"' was expected, but ").concat(S," was provided in ").concat(q.constructor.name,"#").concat(R))}}function Pg(g,w,q,R){if(!(g instanceof w))throw new Cg("a '".concat(w.name,"' was expected, but '").concat(g.constructor.name,"' was provided in ").concat(q.constructor.name,"#").concat(R))}function jg(g,w,q,R,o){cg(q,g,R,o);var r=Z[g];if(!r)throw new Cg("a '".concat(g,"' was expected, but ").concat(q," was provided in ").concat(R.constructor.name,"#").concat(o));r(w,q)}function Mg(g,w,q){return Dg[g](w,q)}var Vg=function(){function w(){for(var g=[],w=0;w<arguments.length;w++)g[w]=arguments[w];Object.defineProperties(this,{$changes:{value:new T(this,void 0,new Hg),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var q=this._definition.descriptors;q&&Object.defineProperties(this,q),g[0]&&this.assign(g[0])}return w.onError=function(g){console.error(g)},w.is=function(g){return g._definition&&void 0!==g._definition.schema},w.prototype.onChange=function(w){return z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.REPLACE,w)},w.prototype.qq=function(w){return z(this.$callbacks||(this.$callbacks=[]),g.OPERATION.DELETE,w)},w.prototype.assign=function(g){return Object.assign(this,g),this},Object.defineProperty(w.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),w.prototype.setDirty=function(g,w){this.$changes.change(g,w)},w.prototype.listen=function(g,w,q){var R=this;return void 0===q&&(q=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[g]||(this.$callbacks[g]=[]),this.$callbacks[g].push(w),q&&void 0!==this[g]&&w(this[g],void 0),function(){return m(R.$callbacks[g],R.$callbacks[g].indexOf(w))}},w.prototype.decode=function(q,R,o){var r;void 0===R&&(R={offset:0}),void 0===o&&(o=this);var i=[],T=this.$changes.root,z=q.length,t=0;for(T.refs.set(t,this);R.offset<z;){var m=q[R.offset++];if(m!=S){var e=o.$changes,y=void 0!==o._definition,A=y?m>>6<<6:m;if(A!==g.OPERATION.CLEAR){var J=y?m%(A||255):Jg(q,R),x=y?o._definition.fieldsByIndex[J]:"",d=e.getType(J),D=void 0,U=void 0,N=void 0;if(y?U=o["_".concat(x)]:(U=o.getByIndex(J),(A&g.OPERATION.ADD)===g.OPERATION.ADD?(N=o instanceof l?Ag(q,R):J,o.setIndex(J,N)):N=o.getIndex(J)),(A&g.OPERATION.DELETE)===g.OPERATION.DELETE&&(A!==g.OPERATION.DELETE_AND_ADD&&o.deleteByIndex(J),U&&U.$changes&&T.removeRef(U.$changes.refId),D=null),void 0!==x){if(A===g.OPERATION.DELETE);else if(w.is(d)){var a=Jg(q,R);if(D=T.refs.get(a),A!==g.OPERATION.REPLACE){var H=this.getSchemaType(q,R,d);D||((D=this.createTypeInstance(H)).$changes.refId=a,U&&(D.$callbacks=U.$callbacks,U.$changes.refId&&a!==U.$changes.refId&&T.removeRef(U.$changes.refId))),T.addRef(a,D,D!==U)}}else if("string"===typeof d)D=Mg(d,q,R);else{var C=G(Object.keys(d)[0]),c=Jg(q,R),P=T.refs.has(c)?U||T.refs.get(c):new C.constructor;if((D=P.clone(!0)).$changes.refId=c,U&&(D.$callbacks=U.$callbacks,U.$changes.refId&&c!==U.$changes.refId)){T.removeRef(U.$changes.refId);for(var j=U.entries(),M=void 0;(M=j.next())&&!M.done;){var V=(r=M.value)[0],s=r[1];i.push({refId:c,op:g.OPERATION.DELETE,field:V,value:void 0,previousValue:s})}}T.addRef(c,D,P!==U)}if(null!==D&&void 0!==D)if(D.$changes&&D.$changes.setParent(e.ref,e.root,J),o instanceof w)o[x]=D;else if(o instanceof l)V=N,o.$items.set(V,D),o.$changes.allChanges.add(J);else if(o instanceof L)o.setAt(J,D);else if(o instanceof Ug){var h=o.add(D);o.setIndex(J,h)}else o instanceof Ng&&!1!==(h=o.add(D))&&o.setIndex(J,h);U!==D&&i.push({refId:t,op:A,field:x,dynamicIndex:N,value:D,previousValue:U})}else{console.warn("@colyseus/schema: definition mismatch");for(var v={offset:R.offset};R.offset<z&&(!dg(q,R)||(v.offset=R.offset+1,!T.refs.has(Jg(q,v))));)R.offset++}}else o.clear(i)}else{t=Jg(q,R);var b=T.refs.get(t);if(!b)throw new Error('"refId" not found: '.concat(t));o=b}}return this._triggerChanges(i),T.garbageCollectDeletedRefs(),i},w.prototype.encode=function(q,R,o){void 0===q&&(q=!1),void 0===R&&(R=[]),void 0===o&&(o=!1);for(var r=this.$changes,i=new WeakSet,T=[r],z=1,t=0;t<z;t++){var m=T[t],e=m.ref,y=e instanceof w;m.ensureRefId(),i.add(m),m!==r&&(m.changed||q)&&(s(R,S),p(R,m.refId));for(var L=q?Array.from(m.allChanges):Array.from(m.changes.values()),A=0,J=L.length;A<J;A++){var x=q?{op:g.OPERATION.ADD,index:L[A]}:L[A],d=x.index,D=y?e._definition.fieldsByIndex&&e._definition.fieldsByIndex[d]:d,U=R.length;if(x.op!==g.OPERATION.TOUCH)if(y)s(R,d|x.op);else{if(s(R,x.op),x.op===g.OPERATION.CLEAR)continue;p(R,d)}if(y||(x.op&g.OPERATION.ADD)!=g.OPERATION.ADD||e instanceof l&&W(R,m.ref.$indexes.get(d)),x.op!==g.OPERATION.DELETE){var N=m.getType(d),a=m.getValue(d);if(a&&a.$changes&&!i.has(a.$changes)&&(T.push(a.$changes),a.$changes.ensureRefId(),z++),x.op!==g.OPERATION.TOUCH){if(w.is(N))Pg(a,N,e,D),p(R,a.$changes.refId),(x.op&g.OPERATION.ADD)===g.OPERATION.ADD&&this.tryEncodeTypeId(R,N,a.constructor);else if("string"===typeof N)jg(N,R,a,e,D);else{var H=G(Object.keys(N)[0]);Pg(e["_".concat(D)],H.constructor,e,D),p(R,a.$changes.refId)}o&&m.cache(d,R.slice(U))}}}q||o||m.discard()}return R},w.prototype.encodeAll=function(g){return this.encode(!0,[],g)},w.prototype.applyFilters=function(q,R){var o,r;void 0===R&&(R=!1);for(var i=this,T=new Set,z=ag.get(q),t=[this.$changes],m=1,e=[],y=function(y){var L=t[y];if(T.has(L.refId))return"continue";var A=L.ref,J=A instanceof w;s(e,S),p(e,L.refId);var x=z.refIds.has(L),G=R||!x;z.addRefId(L);var d=z.containerIndexes.get(L),D=G?Array.from(L.allChanges):Array.from(L.changes.values());!R&&J&&A._definition.indexesWithFilters&&A._definition.indexesWithFilters.forEach((function(w){!d.has(w)&&L.allChanges.has(w)&&(G?D.push(w):D.push({op:g.OPERATION.ADD,index:w}))}));for(var U=0,N=D.length;U<N;U++){var a=G?{op:g.OPERATION.ADD,index:D[U]}:D[U];if(a.op!==g.OPERATION.CLEAR){var H=a.index;if(a.op!==g.OPERATION.DELETE){var C=L.getValue(H),c=L.getType(H);if(J){if((P=A._definition.filters&&A._definition.filters[H])&&!P.call(A,q,C,i)){C&&C.$changes&&T.add(C.$changes.refId);continue}}else{var P,j=L.parent;if((P=L.getChildrenFilter())&&!P.call(j,q,A.$indexes.get(H),C,i)){C&&C.$changes&&T.add(C.$changes.refId);continue}}if(C.$changes&&(t.push(C.$changes),m++),a.op!==g.OPERATION.TOUCH)if(a.op===g.OPERATION.ADD||J)e.push.apply(e,null!==(o=L.caches[H])&&void 0!==o?o:[]),d.add(H);else if(d.has(H))e.push.apply(e,null!==(r=L.caches[H])&&void 0!==r?r:[]);else{if(d.add(H),s(e,g.OPERATION.ADD),p(e,H),A instanceof l){var M=L.ref.$indexes.get(H);W(e,M)}C.$changes?p(e,C.$changes.refId):Z[c](e,C)}else C.$changes&&!J&&(s(e,g.OPERATION.ADD),p(e,H),A instanceof l&&(M=L.ref.$indexes.get(H),W(e,M)),p(e,C.$changes.refId))}else J?s(e,a.op|H):(s(e,a.op),p(e,H))}else s(e,a.op)}},L=0;L<m;L++)y(L);return e},w.prototype.clone=function(){var g,w=new this.constructor,q=this._definition.schema;for(var R in q)"object"===typeof this[R]&&"function"===typeof(null===(g=this[R])||void 0===g?void 0:g.clone)?w[R]=this[R].clone():w[R]=this[R];return w},w.prototype.toJSON=function(){var g=this._definition.schema,w=this._definition.deprecated,q={};for(var R in g)w[R]||null===this[R]||"undefined"===typeof this[R]||(q[R]="function"===typeof this[R].toJSON?this[R].toJSON():this["_".concat(R)]);return q},w.prototype.discardAllChanges=function(){this.$changes.discardAll()},w.prototype.getByIndex=function(g){return this[this._definition.fieldsByIndex[g]]},w.prototype.deleteByIndex=function(g){this[this._definition.fieldsByIndex[g]]=void 0},w.prototype.tryEncodeTypeId=function(g,w,q){w._typeid!==q._typeid&&(s(g,i),p(g,q._typeid))},w.prototype.getSchemaType=function(g,w,q){var R;return g[w.offset]===i&&(w.offset++,R=this.constructor._context.get(Jg(g,w))),R||q},w.prototype.createTypeInstance=function(g){var w=new g;return w.$changes.root=this.$changes.root,w},w.prototype._triggerChanges=function(q){for(var R,o,r,S,i,T,z,t,m,e=new Set,y=this.$changes.root.refs,L=function(L){var A=q[L],l=A.refId,J=y.get(l),x=J.$callbacks;if((A.op&g.OPERATION.DELETE)===g.OPERATION.DELETE&&A.previousValue instanceof w&&(null===(o=null===(R=A.previousValue.$callbacks)||void 0===R?void 0:R[g.OPERATION.DELETE])||void 0===o||o.forEach((function(g){return g()}))),!x)return"continue";if(J instanceof w){if(!e.has(l))try{null===(r=null===x||void 0===x?void 0:x[g.OPERATION.REPLACE])||void 0===r||r.forEach((function(g){return g()}))}catch(G){w.onError(G)}try{x.hasOwnProperty(A.field)&&(null===(S=x[A.field])||void 0===S||S.forEach((function(g){return g(A.value,A.previousValue)})))}catch(G){w.onError(G)}}else A.op===g.OPERATION.ADD&&void 0===A.previousValue?null===(i=x[g.OPERATION.ADD])||void 0===i||i.forEach((function(g){var w;return g(A.value,null!==(w=A.dynamicIndex)&&void 0!==w?w:A.field)})):A.op===g.OPERATION.DELETE?void 0!==A.previousValue&&(null===(T=x[g.OPERATION.DELETE])||void 0===T||T.forEach((function(g){var w;return g(A.previousValue,null!==(w=A.dynamicIndex)&&void 0!==w?w:A.field)}))):A.op===g.OPERATION.DELETE_AND_ADD&&(void 0!==A.previousValue&&(null===(z=x[g.OPERATION.DELETE])||void 0===z||z.forEach((function(g){var w;return g(A.previousValue,null!==(w=A.dynamicIndex)&&void 0!==w?w:A.field)}))),null===(t=x[g.OPERATION.ADD])||void 0===t||t.forEach((function(g){var w;return g(A.value,null!==(w=A.dynamicIndex)&&void 0!==w?w:A.field)}))),A.value!==A.previousValue&&(null===(m=x[g.OPERATION.REPLACE])||void 0===m||m.forEach((function(g){var w;return g(A.value,null!==(w=A.dynamicIndex)&&void 0!==w?w:A.field)})));e.add(l)},A=0;A<q.length;A++)L(A)},w._definition=d.create(),w}();function sg(g){for(var w=[g.$changes],q=1,R={},o=R,r=function(g){var q=w[g];q.changes.forEach((function(g){var w=q.ref,R=g.index,r=w._definition?w._definition.fieldsByIndex[R]:w.$indexes.get(R);o[r]=q.getValue(R)}))},S=0;S<q;S++)r(S);return R}var hg={context:new U},vg=function(g){function w(){return null!==g&&g.apply(this,arguments)||this}return q(w,g),R([a("string",hg)],w.prototype,"name",void 0),R([a("string",hg)],w.prototype,"type",void 0),R([a("number",hg)],w.prototype,"referencedType",void 0),w}(Vg),bg=function(g){function w(){var w=null!==g&&g.apply(this,arguments)||this;return w.fields=new L,w}return q(w,g),R([a("number",hg)],w.prototype,"id",void 0),R([a([vg],hg)],w.prototype,"fields",void 0),w}(Vg),Bg=function(g){function w(){var w=null!==g&&g.apply(this,arguments)||this;return w.types=new L,w}return q(w,g),w.encode=function(g){var q=g.constructor,R=new w;R.rootType=q._typeid;var o=function(g,w){for(var q in w){var o=new vg;o.name=q;var r=void 0;if("string"===typeof w[q])r=w[q];else{var S=w[q],i=void 0;Vg.is(S)?(r="ref",i=w[q]):"string"===typeof S[r=Object.keys(S)[0]]?r+=":"+S[r]:i=S[r],o.referencedType=i?i._typeid:-1}o.type=r,g.fields.push(o)}R.types.push(g)},r=q._context.types;for(var S in r){var i=new bg;i.id=Number(S),o(i,r[S]._definition.schema)}return R.encodeAll()},w.decode=function(g,R){var o=new U,r=new w;r.decode(g,R);var S=r.types.reduce((function(g,w){var R=function(g){function w(){return null!==g&&g.apply(this,arguments)||this}return q(w,g),w}(Vg),r=w.id;return g[r]=R,o.add(R,r),g}),{});r.types.forEach((function(g){var w=S[g.id];g.fields.forEach((function(g){var q;if(void 0!==g.referencedType){var R=g.type,r=S[g.referencedType];if(!r){var i=g.type.split(":");R=i[0],r=i[1]}"ref"===R?a(r,{context:o})(w.prototype,g.name):a(((q={})[R]=r,q),{context:o})(w.prototype,g.name)}else a(g.type,{context:o})(w.prototype,g.name)}))}));var i=S[r.rootType],T=new i;for(var z in i._definition.schema){var t=i._definition.schema[z];"string"!==typeof t&&(T[z]="function"===typeof t?new t:new(G(Object.keys(t)[0]).constructor))}return T},R([a([bg],hg)],w.prototype,"types",void 0),R([a("number",hg)],w.prototype,"rootType",void 0),w}(Vg);x("map",{constructor:l}),x("array",{constructor:L}),x("set",{constructor:Ng}),x("collection",{constructor:Ug}),g.ArraySchema=L,g.CollectionSchema=Ug,g.Context=U,g.MapSchema=l,g.Reflection=Bg,g.ReflectionField=vg,g.ReflectionType=bg,g.Schema=Vg,g.SchemaDefinition=d,g.SetSchema=Ng,g.decode=Dg,g.defineTypes=P,g.deprecated=c,g.dumpChanges=sg,g.encode=Z,g.filter=H,g.filterChildren=C,g.hasFilter=D,g.registerType=x,g.type=a,Object.defineProperty(g,"__esModule",{value:!0})}(w)},13242:g=>{"use strict";g.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13236:(g,w,q)=>{var R=q(13242),o=q(13244),r=Object.hasOwnProperty,S=Object.create(null);for(var i in R)r.call(R,i)&&(S[R[i]]=i);var T=g.exports={to:{},get:{}};function z(g,w,q){return Math.min(Math.max(w,g),q)}function t(g){var w=Math.round(g).toString(16).toUpperCase();return w.length<2?"0"+w:w}T.get=function(g){var w,q;switch(g.substring(0,3).toLowerCase()){case"hsl":w=T.get.hsl(g),q="hsl";break;case"hwb":w=T.get.hwb(g),q="hwb";break;default:w=T.get.rgb(g),q="rgb"}return w?{model:q,value:w}:null},T.get.rgb=function(g){if(!g)return null;var w,q,o,S=[0,0,0,1];if(w=g.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(o=w[2],w=w[1],q=0;q<3;q++){var i=2*q;S[q]=parseInt(w.slice(i,i+2),16)}o&&(S[3]=parseInt(o,16)/255)}else if(w=g.match(/^#([a-f0-9]{3,4})$/i)){for(o=(w=w[1])[3],q=0;q<3;q++)S[q]=parseInt(w[q]+w[q],16);o&&(S[3]=parseInt(o+o,16)/255)}else if(w=g.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(q=0;q<3;q++)S[q]=parseInt(w[q+1],0);w[4]&&(w[5]?S[3]=.01*parseFloat(w[4]):S[3]=parseFloat(w[4]))}else{if(!(w=g.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(w=g.match(/^(\w+)$/))?"transparent"===w[1]?[0,0,0,0]:r.call(R,w[1])?((S=R[w[1]])[3]=1,S):null:null;for(q=0;q<3;q++)S[q]=Math.round(2.55*parseFloat(w[q+1]));w[4]&&(w[5]?S[3]=.01*parseFloat(w[4]):S[3]=parseFloat(w[4]))}for(q=0;q<3;q++)S[q]=z(S[q],0,255);return S[3]=z(S[3],0,1),S},T.get.hsl=function(g){if(!g)return null;var w=g.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(w){var q=parseFloat(w[4]);return[(parseFloat(w[1])%360+360)%360,z(parseFloat(w[2]),0,100),z(parseFloat(w[3]),0,100),z(isNaN(q)?1:q,0,1)]}return null},T.get.hwb=function(g){if(!g)return null;var w=g.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(w){var q=parseFloat(w[4]);return[(parseFloat(w[1])%360+360)%360,z(parseFloat(w[2]),0,100),z(parseFloat(w[3]),0,100),z(isNaN(q)?1:q,0,1)]}return null},T.to.hex=function(){var g=o(arguments);return"#"+t(g[0])+t(g[1])+t(g[2])+(g[3]<1?t(Math.round(255*g[3])):"")},T.to.rgb=function(){var g=o(arguments);return g.length<4||1===g[3]?"rgb("+Math.round(g[0])+", "+Math.round(g[1])+", "+Math.round(g[2])+")":"rgba("+Math.round(g[0])+", "+Math.round(g[1])+", "+Math.round(g[2])+", "+g[3]+")"},T.to.rgb.percent=function(){var g=o(arguments),w=Math.round(g[0]/255*100),q=Math.round(g[1]/255*100),R=Math.round(g[2]/255*100);return g.length<4||1===g[3]?"rgb("+w+"%, "+q+"%, "+R+"%)":"rgba("+w+"%, "+q+"%, "+R+"%, "+g[3]+")"},T.to.hsl=function(){var g=o(arguments);return g.length<4||1===g[3]?"hsl("+g[0]+", "+g[1]+"%, "+g[2]+"%)":"hsla("+g[0]+", "+g[1]+"%, "+g[2]+"%, "+g[3]+")"},T.to.hwb=function(){var g=o(arguments),w="";return g.length>=4&&1!==g[3]&&(w=", "+g[3]),"hwb("+g[0]+", "+g[1]+"%, "+g[2]+"%"+w+")"},T.to.keyword=function(g){return S[g.slice(0,3)]}},13228:(g,w,q)=>{const R=q(13236),o=q(13248),r=["keyword","gray","hex"],S={};for(const y of Object.keys(o))S[[...o[y].labels].sort().join("")]=y;const i={};function T(g,w){if(!(this instanceof T))return new T(g,w);if(w&&w in r&&(w=null),w&&!(w in o))throw new Error("Unknown model: "+w);let q,z;if(null==g)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(g instanceof T)this.model=g.model,this.color=[...g.color],this.valpha=g.valpha;else if("string"===typeof g){const w=R.get(g);if(null===w)throw new Error("Unable to parse color from string: "+g);this.model=w.model,z=o[this.model].channels,this.color=w.value.slice(0,z),this.valpha="number"===typeof w.value[z]?w.value[z]:1}else if(g.length>0){this.model=w||"rgb",z=o[this.model].channels;const q=Array.prototype.slice.call(g,0,z);this.color=e(q,z),this.valpha="number"===typeof g[z]?g[z]:1}else if("number"===typeof g)this.model="rgb",this.color=[g>>16&255,g>>8&255,255&g],this.valpha=1;else{this.valpha=1;const w=Object.keys(g);"alpha"in g&&(w.splice(w.indexOf("alpha"),1),this.valpha="number"===typeof g.alpha?g.alpha:0);const R=w.sort().join("");if(!(R in S))throw new Error("Unable to parse color from object: "+JSON.stringify(g));this.model=S[R];const{labels:r}=o[this.model],i=[];for(q=0;q<r.length;q++)i.push(g[r[q]]);this.color=e(i)}if(i[this.model])for(z=o[this.model].channels,q=0;q<z;q++){const g=i[this.model][q];g&&(this.color[q]=g(this.color[q]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}T.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(g){let w=this.model in R.to?this:this.rgb();w=w.round("number"===typeof g?g:1);const q=1===w.valpha?w.color:[...w.color,this.valpha];return R.to[w.model](q)},percentString(g){const w=this.rgb().round("number"===typeof g?g:1),q=1===w.valpha?w.color:[...w.color,this.valpha];return R.to.rgb.percent(q)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const g={},{channels:w}=o[this.model],{labels:q}=o[this.model];for(let R=0;R<w;R++)g[q[R]]=this.color[R];return 1!==this.valpha&&(g.alpha=this.valpha),g},unitArray(){const g=this.rgb().color;return g[0]/=255,g[1]/=255,g[2]/=255,1!==this.valpha&&g.push(this.valpha),g},unitObject(){const g=this.rgb().object();return g.r/=255,g.g/=255,g.b/=255,1!==this.valpha&&(g.alpha=this.valpha),g},round(g){return g=Math.max(g||0,0),new T([...this.color.map(z(g)),this.valpha],this.model)},alpha(g){return void 0!==g?new T([...this.color,Math.max(0,Math.min(1,g))],this.model):this.valpha},red:t("rgb",0,m(255)),green:t("rgb",1,m(255)),blue:t("rgb",2,m(255)),hue:t(["hsl","hsv","hsl","hwb","hcg"],0,(g=>(g%360+360)%360)),saturationl:t("hsl",1,m(100)),lightness:t("hsl",2,m(100)),saturationv:t("hsv",1,m(100)),value:t("hsv",2,m(100)),chroma:t("hcg",1,m(100)),gray:t("hcg",2,m(100)),white:t("hwb",1,m(100)),wblack:t("hwb",2,m(100)),cyan:t("cmyk",0,m(100)),magenta:t("cmyk",1,m(100)),yellow:t("cmyk",2,m(100)),black:t("cmyk",3,m(100)),x:t("xyz",0,m(95.047)),y:t("xyz",1,m(100)),z:t("xyz",2,m(108.833)),l:t("lab",0,m(100)),a:t("lab",1),b:t("lab",2),keyword(g){return void 0!==g?new T(g):o[this.model].keyword(this.color)},hex(g){return void 0!==g?new T(g):R.to.hex(this.rgb().round().color)},hexa(g){if(void 0!==g)return new T(g);const w=this.rgb().round().color;let q=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===q.length&&(q="0"+q),R.to.hex(w)+q},rgbNumber(){const g=this.rgb().color;return(255&g[0])<<16|(255&g[1])<<8|255&g[2]},luminosity(){const g=this.rgb().color,w=[];for(const[q,R]of g.entries()){const g=R/255;w[q]=g<=.04045?g/12.92:((g+.055)/1.055)**2.4}return.2126*w[0]+.7152*w[1]+.0722*w[2]},contrast(g){const w=this.luminosity(),q=g.luminosity();return w>q?(w+.05)/(q+.05):(q+.05)/(w+.05)},level(g){const w=this.contrast(g);return w>=7?"AAA":w>=4.5?"AA":""},isDark(){const g=this.rgb().color;return(2126*g[0]+7152*g[1]+722*g[2])/1e4<128},isLight(){return!this.isDark()},negate(){const g=this.rgb();for(let w=0;w<3;w++)g.color[w]=255-g.color[w];return g},lighten(g){const w=this.hsl();return w.color[2]+=w.color[2]*g,w},darken(g){const w=this.hsl();return w.color[2]-=w.color[2]*g,w},saturate(g){const w=this.hsl();return w.color[1]+=w.color[1]*g,w},desaturate(g){const w=this.hsl();return w.color[1]-=w.color[1]*g,w},whiten(g){const w=this.hwb();return w.color[1]+=w.color[1]*g,w},blacken(g){const w=this.hwb();return w.color[2]+=w.color[2]*g,w},grayscale(){const g=this.rgb().color,w=.3*g[0]+.59*g[1]+.11*g[2];return T.rgb(w,w,w)},fade(g){return this.alpha(this.valpha-this.valpha*g)},opaquer(g){return this.alpha(this.valpha+this.valpha*g)},rotate(g){const w=this.hsl();let q=w.color[0];return q=(q+g)%360,q=q<0?360+q:q,w.color[0]=q,w},mix(g,w){if(!g||!g.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof g);const q=g.rgb(),R=this.rgb(),o=void 0===w?.5:w,r=2*o-1,S=q.alpha()-R.alpha(),i=((r*S===-1?r:(r+S)/(1+r*S))+1)/2,z=1-i;return T.rgb(i*q.red()+z*R.red(),i*q.green()+z*R.green(),i*q.blue()+z*R.blue(),q.alpha()*o+R.alpha()*(1-o))}};for(const y of Object.keys(o)){if(r.includes(y))continue;const{channels:g}=o[y];T.prototype[y]=function(){if(this.model===y)return new T(this);for(var g=arguments.length,w=new Array(g),q=0;q<g;q++)w[q]=arguments[q];return w.length>0?new T(w,y):new T([...(R=o[this.model][y].raw(this.color),Array.isArray(R)?R:[R]),this.valpha],y);var R},T[y]=function(){for(var w=arguments.length,q=new Array(w),R=0;R<w;R++)q[R]=arguments[R];let o=q[0];return"number"===typeof o&&(o=e(q,g)),new T(o,y)}}function z(g){return function(w){return function(g,w){return Number(g.toFixed(w))}(w,g)}}function t(g,w,q){g=Array.isArray(g)?g:[g];for(const R of g)(i[R]||(i[R]=[]))[w]=q;return g=g[0],function(R){let o;return void 0!==R?(q&&(R=q(R)),o=this[g](),o.color[w]=R,o):(o=this[g]().color[w],q&&(o=q(o)),o)}}function m(g){return function(w){return Math.max(0,Math.min(g,w))}}function e(g,w){for(let q=0;q<w;q++)"number"!==typeof g[q]&&(g[q]=0);return g}g.exports=T},13253:(g,w,q)=>{const R=q(13259),o={};for(const S of Object.keys(R))o[R[S]]=S;const r={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};g.exports=r;for(const S of Object.keys(r)){if(!("channels"in r[S]))throw new Error("missing channels property: "+S);if(!("labels"in r[S]))throw new Error("missing channel labels property: "+S);if(r[S].labels.length!==r[S].channels)throw new Error("channel and label counts mismatch: "+S);const{channels:g,labels:w}=r[S];delete r[S].channels,delete r[S].labels,Object.defineProperty(r[S],"channels",{value:g}),Object.defineProperty(r[S],"labels",{value:w})}r.rgb.hsl=function(g){const w=g[0]/255,q=g[1]/255,R=g[2]/255,o=Math.min(w,q,R),r=Math.max(w,q,R),S=r-o;let i,T;r===o?i=0:w===r?i=(q-R)/S:q===r?i=2+(R-w)/S:R===r&&(i=4+(w-q)/S),i=Math.min(60*i,360),i<0&&(i+=360);const z=(o+r)/2;return T=r===o?0:z<=.5?S/(r+o):S/(2-r-o),[i,100*T,100*z]},r.rgb.hsv=function(g){let w,q,R,o,r;const S=g[0]/255,i=g[1]/255,T=g[2]/255,z=Math.max(S,i,T),t=z-Math.min(S,i,T),m=function(g){return(z-g)/6/t+.5};return 0===t?(o=0,r=0):(r=t/z,w=m(S),q=m(i),R=m(T),S===z?o=R-q:i===z?o=1/3+w-R:T===z&&(o=2/3+q-w),o<0?o+=1:o>1&&(o-=1)),[360*o,100*r,100*z]},r.rgb.hwb=function(g){const w=g[0],q=g[1];let R=g[2];const o=r.rgb.hsl(g)[0],S=1/255*Math.min(w,Math.min(q,R));return R=1-1/255*Math.max(w,Math.max(q,R)),[o,100*S,100*R]},r.rgb.cmyk=function(g){const w=g[0]/255,q=g[1]/255,R=g[2]/255,o=Math.min(1-w,1-q,1-R);return[100*((1-w-o)/(1-o)||0),100*((1-q-o)/(1-o)||0),100*((1-R-o)/(1-o)||0),100*o]},r.rgb.keyword=function(g){const w=o[g];if(w)return w;let q,r=1/0;for(const o of Object.keys(R)){const w=R[o],T=(i=w,((S=g)[0]-i[0])**2+(S[1]-i[1])**2+(S[2]-i[2])**2);T<r&&(r=T,q=o)}var S,i;return q},r.keyword.rgb=function(g){return R[g]},r.rgb.xyz=function(g){let w=g[0]/255,q=g[1]/255,R=g[2]/255;w=w>.04045?((w+.055)/1.055)**2.4:w/12.92,q=q>.04045?((q+.055)/1.055)**2.4:q/12.92,R=R>.04045?((R+.055)/1.055)**2.4:R/12.92;return[100*(.4124*w+.3576*q+.1805*R),100*(.2126*w+.7152*q+.0722*R),100*(.0193*w+.1192*q+.9505*R)]},r.rgb.lab=function(g){const w=r.rgb.xyz(g);let q=w[0],R=w[1],o=w[2];q/=95.047,R/=100,o/=108.883,q=q>.008856?q**(1/3):7.787*q+16/116,R=R>.008856?R**(1/3):7.787*R+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;return[116*R-16,500*(q-R),200*(R-o)]},r.hsl.rgb=function(g){const w=g[0]/360,q=g[1]/100,R=g[2]/100;let o,r,S;if(0===q)return S=255*R,[S,S,S];o=R<.5?R*(1+q):R+q-R*q;const i=2*R-o,T=[0,0,0];for(let z=0;z<3;z++)r=w+1/3*-(z-1),r<0&&r++,r>1&&r--,S=6*r<1?i+6*(o-i)*r:2*r<1?o:3*r<2?i+(o-i)*(2/3-r)*6:i,T[z]=255*S;return T},r.hsl.hsv=function(g){const w=g[0];let q=g[1]/100,R=g[2]/100,o=q;const r=Math.max(R,.01);R*=2,q*=R<=1?R:2-R,o*=r<=1?r:2-r;return[w,100*(0===R?2*o/(r+o):2*q/(R+q)),100*((R+q)/2)]},r.hsv.rgb=function(g){const w=g[0]/60,q=g[1]/100;let R=g[2]/100;const o=Math.floor(w)%6,r=w-Math.floor(w),S=255*R*(1-q),i=255*R*(1-q*r),T=255*R*(1-q*(1-r));switch(R*=255,o){case 0:return[R,T,S];case 1:return[i,R,S];case 2:return[S,R,T];case 3:return[S,i,R];case 4:return[T,S,R];case 5:return[R,S,i]}},r.hsv.hsl=function(g){const w=g[0],q=g[1]/100,R=g[2]/100,o=Math.max(R,.01);let r,S;S=(2-q)*R;const i=(2-q)*o;return r=q*o,r/=i<=1?i:2-i,r=r||0,S/=2,[w,100*r,100*S]},r.hwb.rgb=function(g){const w=g[0]/360;let q=g[1]/100,R=g[2]/100;const o=q+R;let r;o>1&&(q/=o,R/=o);const S=Math.floor(6*w),i=1-R;r=6*w-S,0!==(1&S)&&(r=1-r);const T=q+r*(i-q);let z,t,m;switch(S){default:case 6:case 0:z=i,t=T,m=q;break;case 1:z=T,t=i,m=q;break;case 2:z=q,t=i,m=T;break;case 3:z=q,t=T,m=i;break;case 4:z=T,t=q,m=i;break;case 5:z=i,t=q,m=T}return[255*z,255*t,255*m]},r.cmyk.rgb=function(g){const w=g[0]/100,q=g[1]/100,R=g[2]/100,o=g[3]/100;return[255*(1-Math.min(1,w*(1-o)+o)),255*(1-Math.min(1,q*(1-o)+o)),255*(1-Math.min(1,R*(1-o)+o))]},r.xyz.rgb=function(g){const w=g[0]/100,q=g[1]/100,R=g[2]/100;let o,r,S;return o=3.2406*w+-1.5372*q+-.4986*R,r=-.9689*w+1.8758*q+.0415*R,S=.0557*w+-.204*q+1.057*R,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,S=S>.0031308?1.055*S**(1/2.4)-.055:12.92*S,o=Math.min(Math.max(0,o),1),r=Math.min(Math.max(0,r),1),S=Math.min(Math.max(0,S),1),[255*o,255*r,255*S]},r.xyz.lab=function(g){let w=g[0],q=g[1],R=g[2];w/=95.047,q/=100,R/=108.883,w=w>.008856?w**(1/3):7.787*w+16/116,q=q>.008856?q**(1/3):7.787*q+16/116,R=R>.008856?R**(1/3):7.787*R+16/116;return[116*q-16,500*(w-q),200*(q-R)]},r.lab.xyz=function(g){let w,q,R;q=(g[0]+16)/116,w=g[1]/500+q,R=q-g[2]/200;const o=q**3,r=w**3,S=R**3;return q=o>.008856?o:(q-16/116)/7.787,w=r>.008856?r:(w-16/116)/7.787,R=S>.008856?S:(R-16/116)/7.787,w*=95.047,q*=100,R*=108.883,[w,q,R]},r.lab.lch=function(g){const w=g[0],q=g[1],R=g[2];let o;o=360*Math.atan2(R,q)/2/Math.PI,o<0&&(o+=360);return[w,Math.sqrt(q*q+R*R),o]},r.lch.lab=function(g){const w=g[0],q=g[1],R=g[2]/360*2*Math.PI;return[w,q*Math.cos(R),q*Math.sin(R)]},r.rgb.ansi16=function(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[q,R,o]=g;let S=null===w?r.rgb.hsv(g)[2]:w;if(S=Math.round(S/50),0===S)return 30;let i=30+(Math.round(o/255)<<2|Math.round(R/255)<<1|Math.round(q/255));return 2===S&&(i+=60),i},r.hsv.ansi16=function(g){return r.rgb.ansi16(r.hsv.rgb(g),g[2])},r.rgb.ansi256=function(g){const w=g[0],q=g[1],R=g[2];if(w===q&&q===R)return w<8?16:w>248?231:Math.round((w-8)/247*24)+232;return 16+36*Math.round(w/255*5)+6*Math.round(q/255*5)+Math.round(R/255*5)},r.ansi16.rgb=function(g){let w=g%10;if(0===w||7===w)return g>50&&(w+=3.5),w=w/10.5*255,[w,w,w];const q=.5*(1+~~(g>50));return[(1&w)*q*255,(w>>1&1)*q*255,(w>>2&1)*q*255]},r.ansi256.rgb=function(g){if(g>=232){const w=10*(g-232)+8;return[w,w,w]}let w;g-=16;return[Math.floor(g/36)/5*255,Math.floor((w=g%36)/6)/5*255,w%6/5*255]},r.rgb.hex=function(g){const w=(((255&Math.round(g[0]))<<16)+((255&Math.round(g[1]))<<8)+(255&Math.round(g[2]))).toString(16).toUpperCase();return"000000".substring(w.length)+w},r.hex.rgb=function(g){const w=g.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!w)return[0,0,0];let q=w[0];3===w[0].length&&(q=q.split("").map((g=>g+g)).join(""));const R=parseInt(q,16);return[R>>16&255,R>>8&255,255&R]},r.rgb.hcg=function(g){const w=g[0]/255,q=g[1]/255,R=g[2]/255,o=Math.max(Math.max(w,q),R),r=Math.min(Math.min(w,q),R),S=o-r;let i,T;return i=S<1?r/(1-S):0,T=S<=0?0:o===w?(q-R)/S%6:o===q?2+(R-w)/S:4+(w-q)/S,T/=6,T%=1,[360*T,100*S,100*i]},r.hsl.hcg=function(g){const w=g[1]/100,q=g[2]/100,R=q<.5?2*w*q:2*w*(1-q);let o=0;return R<1&&(o=(q-.5*R)/(1-R)),[g[0],100*R,100*o]},r.hsv.hcg=function(g){const w=g[1]/100,q=g[2]/100,R=w*q;let o=0;return R<1&&(o=(q-R)/(1-R)),[g[0],100*R,100*o]},r.hcg.rgb=function(g){const w=g[0]/360,q=g[1]/100,R=g[2]/100;if(0===q)return[255*R,255*R,255*R];const o=[0,0,0],r=w%1*6,S=r%1,i=1-S;let T=0;switch(Math.floor(r)){case 0:o[0]=1,o[1]=S,o[2]=0;break;case 1:o[0]=i,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=S;break;case 3:o[0]=0,o[1]=i,o[2]=1;break;case 4:o[0]=S,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=i}return T=(1-q)*R,[255*(q*o[0]+T),255*(q*o[1]+T),255*(q*o[2]+T)]},r.hcg.hsv=function(g){const w=g[1]/100,q=w+g[2]/100*(1-w);let R=0;return q>0&&(R=w/q),[g[0],100*R,100*q]},r.hcg.hsl=function(g){const w=g[1]/100,q=g[2]/100*(1-w)+.5*w;let R=0;return q>0&&q<.5?R=w/(2*q):q>=.5&&q<1&&(R=w/(2*(1-q))),[g[0],100*R,100*q]},r.hcg.hwb=function(g){const w=g[1]/100,q=w+g[2]/100*(1-w);return[g[0],100*(q-w),100*(1-q)]},r.hwb.hcg=function(g){const w=g[1]/100,q=1-g[2]/100,R=q-w;let o=0;return R<1&&(o=(q-R)/(1-R)),[g[0],100*R,100*o]},r.apple.rgb=function(g){return[g[0]/65535*255,g[1]/65535*255,g[2]/65535*255]},r.rgb.apple=function(g){return[g[0]/255*65535,g[1]/255*65535,g[2]/255*65535]},r.gray.rgb=function(g){return[g[0]/100*255,g[0]/100*255,g[0]/100*255]},r.gray.hsl=function(g){return[0,0,g[0]]},r.gray.hsv=r.gray.hsl,r.gray.hwb=function(g){return[0,100,g[0]]},r.gray.cmyk=function(g){return[0,0,0,g[0]]},r.gray.lab=function(g){return[g[0],0,0]},r.gray.hex=function(g){const w=255&Math.round(g[0]/100*255),q=((w<<16)+(w<<8)+w).toString(16).toUpperCase();return"000000".substring(q.length)+q},r.rgb.gray=function(g){return[(g[0]+g[1]+g[2])/3/255*100]}},13248:(g,w,q)=>{const R=q(13253),o=q(13267),r={};Object.keys(R).forEach((g=>{r[g]={},Object.defineProperty(r[g],"channels",{value:R[g].channels}),Object.defineProperty(r[g],"labels",{value:R[g].labels});const w=o(g);Object.keys(w).forEach((q=>{const R=w[q];r[g][q]=function(g){const w=function(){for(var w=arguments.length,q=new Array(w),R=0;R<w;R++)q[R]=arguments[R];const o=q[0];if(void 0===o||null===o)return o;o.length>1&&(q=o);const r=g(q);if("object"===typeof r)for(let g=r.length,S=0;S<g;S++)r[S]=Math.round(r[S]);return r};return"conversion"in g&&(w.conversion=g.conversion),w}(R),r[g][q].raw=function(g){const w=function(){for(var w=arguments.length,q=new Array(w),R=0;R<w;R++)q[R]=arguments[R];const o=q[0];return void 0===o||null===o?o:(o.length>1&&(q=o),g(q))};return"conversion"in g&&(w.conversion=g.conversion),w}(R)}))})),g.exports=r},13267:(g,w,q)=>{const R=q(13253);function o(g){const w=function(){const g={},w=Object.keys(R);for(let q=w.length,R=0;R<q;R++)g[w[R]]={distance:-1,parent:null};return g}(),q=[g];for(w[g].distance=0;q.length;){const g=q.pop(),o=Object.keys(R[g]);for(let R=o.length,r=0;r<R;r++){const R=o[r],S=w[R];-1===S.distance&&(S.distance=w[g].distance+1,S.parent=g,q.unshift(R))}}return w}function r(g,w){return function(q){return w(g(q))}}function S(g,w){const q=[w[g].parent,g];let o=R[w[g].parent][g],S=w[g].parent;for(;w[S].parent;)q.unshift(w[S].parent),o=r(R[w[S].parent][S],o),S=w[S].parent;return o.conversion=q,o}g.exports=function(g){const w=o(g),q={},R=Object.keys(w);for(let o=R.length,r=0;r<o;r++){const g=R[r];null!==w[g].parent&&(q[g]=S(g,w))}return q}},13259:g=>{"use strict";g.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11824:function(g,w,q){"use strict";var R=this&&this.__createBinding||(Object.create?function(g,w,q,R){void 0===R&&(R=q);var o=Object.getOwnPropertyDescriptor(w,q);o&&!("get"in o?!w.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return w[q]}}),Object.defineProperty(g,R,o)}:function(g,w,q,R){void 0===R&&(R=q),g[R]=w[q]}),o=this&&this.__setModuleDefault||(Object.create?function(g,w){Object.defineProperty(g,"default",{enumerable:!0,value:w})}:function(g,w){g.default=w}),r=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var w={};if(null!=g)for(var q in g)"default"!==q&&Object.prototype.hasOwnProperty.call(g,q)&&R(w,g,q);return o(w,g),w},S=this&&this.__awaiter||function(g,w,q,R){return new(q||(q=Promise))((function(o,r){function S(g){try{T(R.next(g))}catch(w){r(w)}}function i(g){try{T(R.throw(g))}catch(w){r(w)}}function T(g){var w;g.done?o(g.value):(w=g.value,w instanceof q?w:new q((function(g){g(w)}))).then(S,i)}T((R=R.apply(g,w||[])).next())}))};Object.defineProperty(w,"__esModule",{value:!0}),w.Auth=w.Platform=void 0;const i=r(q(11754)),T=q(11829),z="colyseus-auth-token";!function(g){g.ios="ios",g.android="android"}(w.Platform||(w.Platform={}));w.Auth=class{constructor(g){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=g.replace("ws","http"),(0,T.getItem)(z,(g=>this.token=g))}get hasToken(){return!!this.token}login(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return S(this,void 0,void 0,(function*(){const w=Object.assign({},g);this.hasToken&&(w.token=this.token);const q=yield this.request("post","/auth",w);this.token=q.token,(0,T.setItem)(z,this.token);for(let g in q)this.hasOwnProperty(g)&&(this[g]=q[g]);return this.registerPingService(),this}))}save(){return S(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return S(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return S(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return S(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(g){return S(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:g})}))}acceptFriendRequest(g){return S(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:g})}))}declineFriendRequest(g){return S(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:g})}))}blockUser(g){return S(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:g})}))}unblockUser(g){return S(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:g})}))}request(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},R=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return S(this,void 0,void 0,(function*(){o.Accept="application/json",this.hasToken&&(o.Authorization="Bearer "+this.token);const r=[];for(const g in q)r.push(`${g}=${q[g]}`);const S=r.length>0?`?${r.join("&")}`:"",T={headers:o};return R&&(T.body=R),(yield i[g](`${this.endpoint}${w}${S}`,T)).data}))}logout(){this.token=void 0,(0,T.removeItem)(z),this.unregisterPingService()}registerPingService(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),g)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11752:function(g,w,q){"use strict";var R,o=this&&this.__awaiter||function(g,w,q,R){return new(q||(q=Promise))((function(o,r){function S(g){try{T(R.next(g))}catch(w){r(w)}}function i(g){try{T(R.throw(g))}catch(w){r(w)}}function T(g){var w;g.done?o(g.value):(w=g.value,w instanceof q?w:new q((function(g){g(w)}))).then(S,i)}T((R=R.apply(g,w||[])).next())}))};Object.defineProperty(w,"__esModule",{value:!0}),w.Client=w.MatchMakeError=void 0;const r=q(11754),S=q(11758),i=q(11763);class T extends Error{constructor(g,w){super(g),this.code=w,Object.setPrototypeOf(this,T.prototype)}}w.MatchMakeError=T;const z="undefined"!==typeof window&&"undefined"!==typeof(null===(R=null===window||void 0===window?void 0:window.location)||void 0===R?void 0:R.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";w.Client=class{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z;if("string"===typeof g){const w=new URL(g),q="https:"===w.protocol||"wss:"===w.protocol,R=Number(w.port||(q?443:80));this.settings={hostname:w.hostname,pathname:"/"!==w.pathname?w.pathname:"",port:R,secure:q}}else void 0===g.port&&(g.port=g.secure?443:80),void 0===g.pathname&&(g.pathname=""),this.settings=g}joinOrCreate(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",g,w,q)}))}create(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",g,w,q)}))}join(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",g,w,q)}))}joinById(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",g,w,q)}))}reconnect(g,w){return o(this,void 0,void 0,(function*(){if("string"===typeof g&&"string"===typeof w)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[q,R]=g.split(":");return yield this.createMatchMakeRequest("reconnect",q,{reconnectionToken:R},w)}))}getAvailableRooms(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return o(this,void 0,void 0,(function*(){return(yield(0,r.get)(this.getHttpEndpoint(`${g}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(g,w,q){return o(this,void 0,void 0,(function*(){const R=this.createRoom(g.room.name,w);R.roomId=g.room.roomId,R.sessionId=g.sessionId;const r={sessionId:R.sessionId};g.reconnectionToken&&(r.reconnectionToken=g.reconnectionToken);const i=q||R;return R.connect(this.buildEndpoint(g.room,r),g.devMode&&(()=>o(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${R.roomId}'...`);let q=0;const r=()=>o(this,void 0,void 0,(function*(){q++;try{yield this.consumeSeatReservation(g,w,i),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${R.roomId}'`)}catch(o){q<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${q} out of 8)`),setTimeout(r,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(r,2e3)}))),i),new Promise(((g,w)=>{const q=(g,q)=>w(new S.ServerError(g,q));i.onError.once(q),i.onJoin.once((()=>{i.onError.remove(q),g(i)}))}))}))}createMatchMakeRequest(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},R=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0;return o(this,void 0,void 0,(function*(){const o=(yield(0,r.post)(this.getHttpEndpoint(`${g}/${w}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(q)})).data;if(o.error)throw new T(o.error,o.code);return"reconnect"===g&&(o.reconnectionToken=q.reconnectionToken),yield this.consumeSeatReservation(o,R,S)}))}createRoom(g,w){return new i.Room(g,w)}buildEndpoint(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const q=[];for(const o in w)w.hasOwnProperty(o)&&q.push(`${o}=${w[o]}`);let R=this.settings.secure?"wss://":"ws://";return g.publicAddress?R+=`${g.publicAddress}`:R+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${R}/${g.processId}/${g.roomId}?${q.join("&")}`}getHttpEndpoint(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${g}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11771:(g,w,q)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.Connection=void 0;const R=q(11778);w.Connection=class{constructor(){this.events={},this.transport=new R.WebSocketTransport(this.events)}send(g){this.transport.send(g)}connect(g){this.transport.connect(g)}close(g,w){this.transport.close(g,w)}get isOpen(){return this.transport.isOpen}}},11790:(g,w)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.utf8Length=w.utf8Read=w.ErrorCode=w.Protocol=void 0,function(g){g[g.HANDSHAKE=9]="HANDSHAKE",g[g.JOIN_ROOM=10]="JOIN_ROOM",g[g.ERROR=11]="ERROR",g[g.LEAVE_ROOM=12]="LEAVE_ROOM",g[g.ROOM_DATA=13]="ROOM_DATA",g[g.ROOM_STATE=14]="ROOM_STATE",g[g.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",g[g.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",g[g.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(w.Protocol||(w.Protocol={})),function(g){g[g.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",g[g.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",g[g.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",g[g.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",g[g.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",g[g.AUTH_FAILED=4215]="AUTH_FAILED",g[g.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(w.ErrorCode||(w.ErrorCode={})),w.utf8Read=function(g,w){const q=g[w++];for(var R="",o=0,r=w,S=w+q;r<S;r++){var i=g[r];if(0!==(128&i))if(192!==(224&i))if(224!==(240&i)){if(240!==(248&i))throw new Error("Invalid byte "+i.toString(16));(o=(7&i)<<18|(63&g[++r])<<12|(63&g[++r])<<6|63&g[++r])>=65536?(o-=65536,R+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):R+=String.fromCharCode(o)}else R+=String.fromCharCode((15&i)<<12|(63&g[++r])<<6|63&g[++r]);else R+=String.fromCharCode((31&i)<<6|63&g[++r]);else R+=String.fromCharCode(i)}return R},w.utf8Length=function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",w=0,q=0;for(let R=0,o=g.length;R<o;R++)w=g.charCodeAt(R),w<128?q+=1:w<2048?q+=2:w<55296||w>=57344?q+=3:(R++,q+=4);return q+1}},11763:function(g,w,q){"use strict";var R=this&&this.__createBinding||(Object.create?function(g,w,q,R){void 0===R&&(R=q);var o=Object.getOwnPropertyDescriptor(w,q);o&&!("get"in o?!w.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return w[q]}}),Object.defineProperty(g,R,o)}:function(g,w,q,R){void 0===R&&(R=q),g[R]=w[q]}),o=this&&this.__setModuleDefault||(Object.create?function(g,w){Object.defineProperty(g,"default",{enumerable:!0,value:w})}:function(g,w){g.default=w}),r=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var w={};if(null!=g)for(var q in g)"default"!==q&&Object.prototype.hasOwnProperty.call(g,q)&&R(w,g,q);return o(w,g),w};Object.defineProperty(w,"__esModule",{value:!0}),w.Room=void 0;const S=r(q(11766)),i=q(11771),T=q(11790),z=q(11796),t=q(11803),m=q(11810),e=q(11818),y=q(11758);class L{constructor(g,w){this.onStateChange=(0,m.createSignal)(),this.onError=(0,m.createSignal)(),this.onLeave=(0,m.createSignal)(),this.onJoin=(0,m.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,t.createNanoEvents)(),this.roomId=null,this.name=g,w&&(this.serializer=new((0,z.getSerializer)("schema")),this.rootSchema=w,this.serializer.state=new w),this.onError(((g,w)=>{var q;return null===(q=console.warn)||void 0===q?void 0:q.call(console,`colyseus.js - onError => (${g}) ${w}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const R=new i.Connection;q.connection=R,R.events.onmessage=L.prototype.onMessageCallback.bind(q),R.events.onclose=function(g){var R;if(!q.hasJoined)return null===(R=console.warn)||void 0===R||R.call(console,`Room connection was closed unexpectedly (${g.code}): ${g.reason}`),void q.onError.invoke(g.code,g.reason);g.code===y.CloseCode.DEVMODE_RESTART&&w?w():(q.onLeave.invoke(g.code),q.destroy())},R.events.onerror=function(g){var w;null===(w=console.warn)||void 0===w||w.call(console,`Room, onError (${g.code}): ${g.reason}`),q.onError.invoke(g.code,g.reason)},R.connect(g)}leave(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((w=>{this.onLeave((g=>w(g))),this.connection?g?this.connection.send([T.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(y.CloseCode.CONSENTED)}))}onMessage(g,w){return this.onMessageHandlers.on(this.getMessageHandlerKey(g),w)}send(g,w){const q=[T.Protocol.ROOM_DATA];let R;if("string"===typeof g?e.encode.string(q,g):e.encode.number(q,g),void 0!==w){const g=S.encode(w);R=new Uint8Array(q.length+g.byteLength),R.set(new Uint8Array(q),0),R.set(new Uint8Array(g),q.length)}else R=new Uint8Array(q);this.connection.send(R.buffer)}sendBytes(g,w){const q=[T.Protocol.ROOM_DATA_BYTES];let R;"string"===typeof g?e.encode.string(q,g):e.encode.number(q,g),R=new Uint8Array(q.length+(w.byteLength||w.length)),R.set(new Uint8Array(q),0),R.set(new Uint8Array(w),q.length),this.connection.send(R.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(g){const w=Array.from(new Uint8Array(g.data)),q=w[0];if(q===T.Protocol.JOIN_ROOM){let g=1;const q=(0,T.utf8Read)(w,g);if(g+=(0,T.utf8Length)(q),this.serializerId=(0,T.utf8Read)(w,g),g+=(0,T.utf8Length)(this.serializerId),!this.serializer){const g=(0,z.getSerializer)(this.serializerId);this.serializer=new g}w.length>g&&this.serializer.handshake&&this.serializer.handshake(w,{offset:g}),this.reconnectionToken=`${this.roomId}:${q}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([T.Protocol.JOIN_ROOM])}else if(q===T.Protocol.ERROR){const g={offset:1},q=e.decode.number(w,g),R=e.decode.string(w,g);this.onError.invoke(q,R)}else if(q===T.Protocol.LEAVE_ROOM)this.leave();else if(q===T.Protocol.ROOM_DATA_SCHEMA){const g={offset:1},q=this.serializer.getState().constructor._context.get(e.decode.number(w,g)),R=new q;R.decode(w,g),this.dispatchMessage(q,R)}else if(q===T.Protocol.ROOM_STATE)w.shift(),this.setState(w);else if(q===T.Protocol.ROOM_STATE_PATCH)w.shift(),this.patch(w);else if(q===T.Protocol.ROOM_DATA){const q={offset:1},R=e.decode.stringCheck(w,q)?e.decode.string(w,q):e.decode.number(w,q),o=w.length>q.offset?S.decode(g.data,q.offset):void 0;this.dispatchMessage(R,o)}else if(q===T.Protocol.ROOM_DATA_BYTES){const g={offset:1},q=e.decode.stringCheck(w,g)?e.decode.string(w,g):e.decode.number(w,g);this.dispatchMessage(q,new Uint8Array(w.slice(g.offset)))}}setState(g){this.serializer.setState(g),this.onStateChange.invoke(this.serializer.getState())}patch(g){this.serializer.patch(g),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(g,w){var q;const R=this.getMessageHandlerKey(g);this.onMessageHandlers.events[R]?this.onMessageHandlers.emit(R,w):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",g,w):null===(q=console.warn)||void 0===q||q.call(console,`colyseus.js: onMessage() not registered for type '${g}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(g){switch(typeof g){case"function":return`$${g._typeid}`;case"string":return g;case"number":return`i${g}`;default:throw new Error("invalid message type.")}}}w.Room=L},11829:(g,w)=>{"use strict";let q;function R(){return q||(q="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(g,w){this.cache[g]=w},getItem:function(g){this.cache[g]},removeItem:function(g){delete this.cache[g]}}),q}Object.defineProperty(w,"__esModule",{value:!0}),w.getItem=w.removeItem=w.setItem=void 0,w.setItem=function(g,w){R().setItem(g,w)},w.removeItem=function(g){R().removeItem(g)},w.getItem=function(g,w){const q=R().getItem(g);"undefined"!==typeof Promise&&q instanceof Promise?q.then((g=>w(g))):w(q)}},11803:(g,w)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.createNanoEvents=void 0;w.createNanoEvents=()=>({emit(g){let w=this.events[g]||[];for(var q=arguments.length,R=new Array(q>1?q-1:0),o=1;o<q;o++)R[o-1]=arguments[o];for(let r=0,S=w.length;r<S;r++)w[r](...R)},events:{},on(g,w){var q;return(null===(q=this.events[g])||void 0===q?void 0:q.push(w))||(this.events[g]=[w]),()=>{var q;this.events[g]=null===(q=this.events[g])||void 0===q?void 0:q.filter((g=>w!==g))}}})},11810:(g,w)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.createSignal=w.EventEmitter=void 0;class q{constructor(){this.handlers=[]}register(g){return this.handlers.push(g),this}invoke(){for(var g=arguments.length,w=new Array(g),q=0;q<g;q++)w[q]=arguments[q];this.handlers.forEach((g=>g.apply(this,w)))}invokeAsync(){for(var g=arguments.length,w=new Array(g),q=0;q<g;q++)w[q]=arguments[q];return Promise.all(this.handlers.map((g=>g.apply(this,w))))}remove(g){const w=this.handlers.indexOf(g);this.handlers[w]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}w.EventEmitter=q,w.createSignal=function(){const g=new q;function w(w){return g.register(w,null===this)}return w.once=w=>{const q=function(){for(var R=arguments.length,o=new Array(R),r=0;r<R;r++)o[r]=arguments[r];w.apply(this,o),g.remove(q)};g.register(q)},w.remove=w=>g.remove(w),w.invoke=function(){return g.invoke(...arguments)},w.invokeAsync=function(){return g.invokeAsync(...arguments)},w.clear=()=>g.clear(),w}},11758:(g,w)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.ServerError=w.CloseCode=void 0,function(g){g[g.CONSENTED=4e3]="CONSENTED",g[g.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(w.CloseCode||(w.CloseCode={}));class q extends Error{constructor(g,w){super(w),this.name="ServerError",this.code=g}}w.ServerError=q},11739:(g,w,q)=>{"use strict";w.b=void 0,q(11748);var R=q(11752);Object.defineProperty(w,"b",{enumerable:!0,get:function(){return R.Client}});var o=q(11790);var r=q(11763);var S=q(11824);const i=q(11835);const T=q(11840),z=q(11796);(0,z.registerSerializer)("schema",i.SchemaSerializer),(0,z.registerSerializer)("none",T.NoneSerializer)},11748:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=g=>null!==g&&"object"===typeof g&&g.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11766:(g,w)=>{"use strict";function q(g,w){if(this._offset=w,g instanceof ArrayBuffer)this._buffer=g,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(g))throw new Error("Invalid argument");this._buffer=g.buffer,this._view=new DataView(this._buffer,g.byteOffset,g.byteLength)}}Object.defineProperty(w,"__esModule",{value:!0}),w.decode=w.encode=void 0,q.prototype._array=function(g){for(var w=new Array(g),q=0;q<g;q++)w[q]=this._parse();return w},q.prototype._map=function(g){for(var w={},q=0;q<g;q++)w[this._parse()]=this._parse();return w},q.prototype._str=function(g){var w=function(g,w,q){for(var R="",o=0,r=w,S=w+q;r<S;r++){var i=g.getUint8(r);if(0!==(128&i))if(192!==(224&i))if(224!==(240&i)){if(240!==(248&i))throw new Error("Invalid byte "+i.toString(16));(o=(7&i)<<18|(63&g.getUint8(++r))<<12|(63&g.getUint8(++r))<<6|63&g.getUint8(++r))>=65536?(o-=65536,R+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):R+=String.fromCharCode(o)}else R+=String.fromCharCode((15&i)<<12|(63&g.getUint8(++r))<<6|63&g.getUint8(++r));else R+=String.fromCharCode((31&i)<<6|63&g.getUint8(++r));else R+=String.fromCharCode(i)}return R}(this._view,this._offset,g);return this._offset+=g,w},q.prototype._bin=function(g){var w=this._buffer.slice(this._offset,this._offset+g);return this._offset+=g,w},q.prototype._parse=function(){var g,w=this._view.getUint8(this._offset++),q=0,R=0,o=0,r=0;if(w<192)return w<128?w:w<144?this._map(15&w):w<160?this._array(15&w):this._str(31&w);if(w>223)return-1*(255-w+1);switch(w){case 192:return null;case 194:return!1;case 195:return!0;case 196:return q=this._view.getUint8(this._offset),this._offset+=1,this._bin(q);case 197:return q=this._view.getUint16(this._offset),this._offset+=2,this._bin(q);case 198:return q=this._view.getUint32(this._offset),this._offset+=4,this._bin(q);case 199:if(q=this._view.getUint8(this._offset),R=this._view.getInt8(this._offset+1),this._offset+=2,-1===R){var S=this._view.getUint32(this._offset);return o=this._view.getInt32(this._offset+4),r=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*o+r)+S/1e6)}return[R,this._bin(q)];case 200:return q=this._view.getUint16(this._offset),R=this._view.getInt8(this._offset+2),this._offset+=3,[R,this._bin(q)];case 201:return q=this._view.getUint32(this._offset),R=this._view.getInt8(this._offset+4),this._offset+=5,[R,this._bin(q)];case 202:return g=this._view.getFloat32(this._offset),this._offset+=4,g;case 203:return g=this._view.getFloat64(this._offset),this._offset+=8,g;case 204:return g=this._view.getUint8(this._offset),this._offset+=1,g;case 205:return g=this._view.getUint16(this._offset),this._offset+=2,g;case 206:return g=this._view.getUint32(this._offset),this._offset+=4,g;case 207:return o=this._view.getUint32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,o+r;case 208:return g=this._view.getInt8(this._offset),this._offset+=1,g;case 209:return g=this._view.getInt16(this._offset),this._offset+=2,g;case 210:return g=this._view.getInt32(this._offset),this._offset+=4,g;case 211:return o=this._view.getInt32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,o+r;case 212:return R=this._view.getInt8(this._offset),this._offset+=1,0===R?void(this._offset+=1):[R,this._bin(1)];case 213:return R=this._view.getInt8(this._offset),this._offset+=1,[R,this._bin(2)];case 214:return R=this._view.getInt8(this._offset),this._offset+=1,-1===R?(g=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*g)):[R,this._bin(4)];case 215:return R=this._view.getInt8(this._offset),this._offset+=1,0===R?(o=this._view.getInt32(this._offset)*Math.pow(2,32),r=this._view.getUint32(this._offset+4),this._offset+=8,new Date(o+r)):-1===R?(o=this._view.getUint32(this._offset),r=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&o)+r)+(o>>>2)/1e6)):[R,this._bin(8)];case 216:return R=this._view.getInt8(this._offset),this._offset+=1,[R,this._bin(16)];case 217:return q=this._view.getUint8(this._offset),this._offset+=1,this._str(q);case 218:return q=this._view.getUint16(this._offset),this._offset+=2,this._str(q);case 219:return q=this._view.getUint32(this._offset),this._offset+=4,this._str(q);case 220:return q=this._view.getUint16(this._offset),this._offset+=2,this._array(q);case 221:return q=this._view.getUint32(this._offset),this._offset+=4,this._array(q);case 222:return q=this._view.getUint16(this._offset),this._offset+=2,this._map(q);case 223:return q=this._view.getUint32(this._offset),this._offset+=4,this._map(q)}throw new Error("Could not parse")},w.decode=function(g){var w=new q(g,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),R=w._parse();if(w._offset!==g.byteLength)throw new Error(g.byteLength-w._offset+" trailing bytes");return R};function R(g,w,q){for(var R=0,o=0,r=q.length;o<r;o++)(R=q.charCodeAt(o))<128?g.setUint8(w++,R):R<2048?(g.setUint8(w++,192|R>>6),g.setUint8(w++,128|63&R)):R<55296||R>=57344?(g.setUint8(w++,224|R>>12),g.setUint8(w++,128|R>>6&63),g.setUint8(w++,128|63&R)):(o++,R=65536+((1023&R)<<10|1023&q.charCodeAt(o)),g.setUint8(w++,240|R>>18),g.setUint8(w++,128|R>>12&63),g.setUint8(w++,128|R>>6&63),g.setUint8(w++,128|63&R))}function o(g,w,q){var R=typeof q,r=0,S=0,i=0,T=0,z=0,t=0;if("string"===R){if(z=function(g){for(var w=0,q=0,R=0,o=g.length;R<o;R++)(w=g.charCodeAt(R))<128?q+=1:w<2048?q+=2:w<55296||w>=57344?q+=3:(R++,q+=4);return q}(q),z<32)g.push(160|z),t=1;else if(z<256)g.push(217,z),t=2;else if(z<65536)g.push(218,z>>8,z),t=3;else{if(!(z<4294967296))throw new Error("String too long");g.push(219,z>>24,z>>16,z>>8,z),t=5}return w.push({_str:q,_length:z,_offset:g.length}),t+z}if("number"===R)return Math.floor(q)===q&&isFinite(q)?q>=0?q<128?(g.push(q),1):q<256?(g.push(204,q),2):q<65536?(g.push(205,q>>8,q),3):q<4294967296?(g.push(206,q>>24,q>>16,q>>8,q),5):(i=q/Math.pow(2,32)|0,T=q>>>0,g.push(207,i>>24,i>>16,i>>8,i,T>>24,T>>16,T>>8,T),9):q>=-32?(g.push(q),1):q>=-128?(g.push(208,q),2):q>=-32768?(g.push(209,q>>8,q),3):q>=-2147483648?(g.push(210,q>>24,q>>16,q>>8,q),5):(i=Math.floor(q/Math.pow(2,32)),T=q>>>0,g.push(211,i>>24,i>>16,i>>8,i,T>>24,T>>16,T>>8,T),9):(g.push(203),w.push({_float:q,_length:8,_offset:g.length}),9);if("object"===R){if(null===q)return g.push(192),1;if(Array.isArray(q)){if((z=q.length)<16)g.push(144|z),t=1;else if(z<65536)g.push(220,z>>8,z),t=3;else{if(!(z<4294967296))throw new Error("Array too large");g.push(221,z>>24,z>>16,z>>8,z),t=5}for(r=0;r<z;r++)t+=o(g,w,q[r]);return t}if(q instanceof Date){var m=q.getTime(),e=Math.floor(m/1e3),y=1e6*(m-1e3*e);return e>=0&&y>=0&&e<=17179869183?0===y&&e<=4294967295?(g.push(214,255,e>>24,e>>16,e>>8,e),6):(i=e/4294967296,T=4294967295&e,g.push(215,255,y>>22,y>>14,y>>6,i,T>>24,T>>16,T>>8,T),10):(i=Math.floor(e/4294967296),T=e>>>0,g.push(199,12,255,y>>24,y>>16,y>>8,y,i>>24,i>>16,i>>8,i,T>>24,T>>16,T>>8,T),15)}if(q instanceof ArrayBuffer){if((z=q.byteLength)<256)g.push(196,z),t=2;else if(z<65536)g.push(197,z>>8,z),t=3;else{if(!(z<4294967296))throw new Error("Buffer too large");g.push(198,z>>24,z>>16,z>>8,z),t=5}return w.push({_bin:q,_length:z,_offset:g.length}),t+z}if("function"===typeof q.toJSON)return o(g,w,q.toJSON());var L=[],A="",l=Object.keys(q);for(r=0,S=l.length;r<S;r++)void 0!==q[A=l[r]]&&"function"!==typeof q[A]&&L.push(A);if((z=L.length)<16)g.push(128|z),t=1;else if(z<65536)g.push(222,z>>8,z),t=3;else{if(!(z<4294967296))throw new Error("Object too large");g.push(223,z>>24,z>>16,z>>8,z),t=5}for(r=0;r<z;r++)t+=o(g,w,A=L[r]),t+=o(g,w,q[A]);return t}if("boolean"===R)return g.push(q?195:194),1;if("undefined"===R)return g.push(192),1;if("function"===typeof q.toJSON)return o(g,w,q.toJSON());throw new Error("Could not encode")}w.encode=function(g){var w=[],q=[],r=o(w,q,g),S=new ArrayBuffer(r),i=new DataView(S),T=0,z=0,t=-1;q.length>0&&(t=q[0]._offset);for(var m,e=0,y=0,L=0,A=w.length;L<A;L++)if(i.setUint8(z+L,w[L]),L+1===t){if(e=(m=q[T])._length,y=z+t,m._bin)for(var l=new Uint8Array(m._bin),J=0;J<e;J++)i.setUint8(y+J,l[J]);else m._str?R(i,y,m._str):void 0!==m._float&&i.setFloat64(y,m._float);z+=e,q[++T]&&(t=q[T]._offset)}return S}},11840:(g,w)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.NoneSerializer=void 0;w.NoneSerializer=class{setState(g){}getState(){return null}patch(g){}teardown(){}handshake(g){}}},11835:(g,w,q)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.SchemaSerializer=void 0;const R=q(11818);w.SchemaSerializer=class{setState(g){return this.state.decode(g)}getState(){return this.state}patch(g){return this.state.decode(g)}teardown(){var g,w;null===(w=null===(g=this.state)||void 0===g?void 0:g.$changes)||void 0===w||w.root.clearRefs()}handshake(g,w){if(this.state){(new R.Reflection).decode(g,w)}else this.state=R.Reflection.decode(g,w)}}},11796:(g,w)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.getSerializer=w.registerSerializer=void 0;const q={};w.registerSerializer=function(g,w){q[g]=w},w.getSerializer=function(g){const w=q[g];if(!w)throw new Error("missing serializer: "+g);return w}},11778:function(g,w,q){"use strict";var R=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(w,"__esModule",{value:!0}),w.WebSocketTransport=void 0;const o=R(q(11786)),r=globalThis.WebSocket||o.default;w.WebSocketTransport=class{constructor(g){this.events=g}send(g){g instanceof ArrayBuffer?this.ws.send(g):Array.isArray(g)&&this.ws.send(new Uint8Array(g).buffer)}connect(g){this.ws=new r(g,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(g,w){this.ws.close(g,w)}get isOpen(){return this.ws.readyState===r.OPEN}}},11786:g=>{"use strict";g.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12206:g=>{"use strict";g.exports=function(g){for(var w=new Array(g),q=0;q<g;++q)w[q]=q;return w}},12211:g=>{function w(g){return!!g.constructor&&"function"===typeof g.constructor.isBuffer&&g.constructor.isBuffer(g)}g.exports=function(g){return null!=g&&(w(g)||function(g){return"function"===typeof g.readFloatLE&&"function"===typeof g.slice&&w(g.slice(0,0))}(g)||!!g._isBuffer)}},12202:(g,w,q)=>{var R=q(12206),o=q(12211),r="undefined"!==typeof Float64Array;function S(g,w){return g[0]-w[0]}function i(){var g,w=this.stride,q=new Array(w.length);for(g=0;g<q.length;++g)q[g]=[Math.abs(w[g]),g];q.sort(S);var R=new Array(q.length);for(g=0;g<R.length;++g)R[g]=q[g][1];return R}function T(g,w){var q=["View",w,"d",g].join("");w<0&&(q="View_Nil"+g);var o="generic"===g;if(-1===w){var r="function "+q+"(a){this.data=a;};var proto="+q+".prototype;proto.dtype='"+g+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+q+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+q+"(a){return new "+q+"(a);}";return new Function(r)()}if(0===w){r="function "+q+"(a,d) {this.data = a;this.offset = d};var proto="+q+".prototype;proto.dtype='"+g+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+q+"_copy() {return new "+q+"(this.data,this.offset)};proto.pick=function "+q+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+q+"_get(){return "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+q+"_set(v){return "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+q+"(a,b,c,d){return new "+q+"(a,d)}";return new Function("TrivialArray",r)(z[g][0])}r=["'use strict'"];var S=R(w),T=S.map((function(g){return"i"+g})),t="this.offset+"+S.map((function(g){return"this.stride["+g+"]*i"+g})).join("+"),m=S.map((function(g){return"b"+g})).join(","),e=S.map((function(g){return"c"+g})).join(",");r.push("function "+q+"(a,"+m+","+e+",d){this.data=a","this.shape=["+m+"]","this.stride=["+e+"]","this.offset=d|0}","var proto="+q+".prototype","proto.dtype='"+g+"'","proto.dimension="+w),r.push("Object.defineProperty(proto,'size',{get:function "+q+"_size(){return "+S.map((function(g){return"this.shape["+g+"]"})).join("*"),"}})"),1===w?r.push("proto.order=[0]"):(r.push("Object.defineProperty(proto,'order',{get:"),w<4?(r.push("function "+q+"_order(){"),2===w?r.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===w&&r.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):r.push("ORDER})")),r.push("proto.set=function "+q+"_set("+T.join(",")+",v){"),o?r.push("return this.data.set("+t+",v)}"):r.push("return this.data["+t+"]=v}"),r.push("proto.get=function "+q+"_get("+T.join(",")+"){"),o?r.push("return this.data.get("+t+")}"):r.push("return this.data["+t+"]}"),r.push("proto.index=function "+q+"_index(",T.join(),"){return "+t+"}"),r.push("proto.hi=function "+q+"_hi("+T.join(",")+"){return new "+q+"(this.data,"+S.map((function(g){return["(typeof i",g,"!=='number'||i",g,"<0)?this.shape[",g,"]:i",g,"|0"].join("")})).join(",")+","+S.map((function(g){return"this.stride["+g+"]"})).join(",")+",this.offset)}");var y=S.map((function(g){return"a"+g+"=this.shape["+g+"]"})),L=S.map((function(g){return"c"+g+"=this.stride["+g+"]"}));r.push("proto.lo=function "+q+"_lo("+T.join(",")+"){var b=this.offset,d=0,"+y.join(",")+","+L.join(","));for(var A=0;A<w;++A)r.push("if(typeof i"+A+"==='number'&&i"+A+">=0){d=i"+A+"|0;b+=c"+A+"*d;a"+A+"-=d}");r.push("return new "+q+"(this.data,"+S.map((function(g){return"a"+g})).join(",")+","+S.map((function(g){return"c"+g})).join(",")+",b)}"),r.push("proto.step=function "+q+"_step("+T.join(",")+"){var "+S.map((function(g){return"a"+g+"=this.shape["+g+"]"})).join(",")+","+S.map((function(g){return"b"+g+"=this.stride["+g+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(A=0;A<w;++A)r.push("if(typeof i"+A+"==='number'){d=i"+A+"|0;if(d<0){c+=b"+A+"*(a"+A+"-1);a"+A+"=ceil(-a"+A+"/d)}else{a"+A+"=ceil(a"+A+"/d)}b"+A+"*=d}");r.push("return new "+q+"(this.data,"+S.map((function(g){return"a"+g})).join(",")+","+S.map((function(g){return"b"+g})).join(",")+",c)}");var l=new Array(w),J=new Array(w);for(A=0;A<w;++A)l[A]="a[i"+A+"]",J[A]="b[i"+A+"]";r.push("proto.transpose=function "+q+"_transpose("+T+"){"+T.map((function(g,w){return g+"=("+g+"===undefined?"+w+":"+g+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+q+"(this.data,"+l.join(",")+","+J.join(",")+",this.offset)}"),r.push("proto.pick=function "+q+"_pick("+T+"){var a=[],b=[],c=this.offset");for(A=0;A<w;++A)r.push("if(typeof i"+A+"==='number'&&i"+A+">=0){c=(c+this.stride["+A+"]*i"+A+")|0}else{a.push(this.shape["+A+"]);b.push(this.stride["+A+"])}");return r.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),r.push("return function construct_"+q+"(data,shape,stride,offset){return new "+q+"(data,"+S.map((function(g){return"shape["+g+"]"})).join(",")+","+S.map((function(g){return"stride["+g+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",r.join("\n"))(z[g],i)}var z={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};g.exports=function(g,w,q,R){if(void 0===g)return(0,z.array[0])([]);"number"===typeof g&&(g=[g]),void 0===w&&(w=[g.length]);var S=w.length;if(void 0===q){q=new Array(S);for(var i=S-1,t=1;i>=0;--i)q[i]=t,t*=w[i]}if(void 0===R){R=0;for(i=0;i<S;++i)q[i]<0&&(R-=(w[i]-1)*q[i])}for(var m=function(g){if(o(g))return"buffer";if(r)switch(Object.prototype.toString.call(g)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(g)?"array":"generic"}(g),e=z[m];e.length<=S+1;)e.push(T(m,e.length-1));return(0,e[S+1])(g,w,q,R)}},13214:g=>{var w;self,w=()=>(()=>{"use strict";var g={d:(w,q)=>{for(var R in q)g.o(q,R)&&!g.o(w,R)&&Object.defineProperty(w,R,{enumerable:!0,get:q[R]})},o:(g,w)=>Object.prototype.hasOwnProperty.call(g,w)},w={};g.d(w,{default:()=>s});var q,R=function(g,w){var q=w.x-g.x,R=w.y-g.y;return Math.sqrt(q*q+R*R)},o=function(g){return g*(Math.PI/180)},r=new Map,S=function(g){r.has(g)&&clearTimeout(r.get(g)),r.set(g,setTimeout(g,100))},i=function(g,w,q){for(var R,o=w.split(/[ ,]+/g),r=0;r<o.length;r+=1)R=o[r],g.addEventListener?g.addEventListener(R,q,!1):g.attachEvent&&g.attachEvent(R,q)},T=function(g,w,q){for(var R,o=w.split(/[ ,]+/g),r=0;r<o.length;r+=1)R=o[r],g.removeEventListener?g.removeEventListener(R,q):g.detachEvent&&g.detachEvent(R,q)},z=function(g){return g.preventDefault(),g.type.match(/^touch/)?g.changedTouches:g},t=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},m=function(g,w){w.top||w.right||w.bottom||w.left?(g.style.top=w.top,g.style.right=w.right,g.style.bottom=w.bottom,g.style.left=w.left):(g.style.left=w.x+"px",g.style.top=w.y+"px")},e=function(g,w,q){var R=y(g);for(var o in R)if(R.hasOwnProperty(o))if("string"==typeof w)R[o]=w+" "+q;else{for(var r="",S=0,i=w.length;S<i;S+=1)r+=w[S]+" "+q+", ";R[o]=r.slice(0,-2)}return R},y=function(g){var w={};return w[g]="",["webkit","Moz","o"].forEach((function(q){w[q+g.charAt(0).toUpperCase()+g.slice(1)]=""})),w},L=function(g,w){for(var q in w)w.hasOwnProperty(q)&&(g[q]=w[q]);return g},A=function(g,w){if(g.length)for(var q=0,R=g.length;q<R;q+=1)w(g[q]);else w(g)},l="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,J=window.matchMedia("(any-hover: none)").matches,x=!!("ontouchstart"in window),G=!!window.PointerEvent,d=!!window.MSPointerEvent,D={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},U={start:"mousedown",move:"mousemove",end:"mouseup"},N={};function a(){}l&&!J?q=D:G?q={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:d?q={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:x?(q=D,N=U):q=U,a.prototype.on=function(g,w){var q,R=this,o=g.split(/[ ,]+/g);R._handlers_=R._handlers_||{};for(var r=0;r<o.length;r+=1)q=o[r],R._handlers_[q]=R._handlers_[q]||[],R._handlers_[q].push(w);return R},a.prototype.off=function(g,w){var q=this;return q._handlers_=q._handlers_||{},void 0===g?q._handlers_={}:void 0===w?q._handlers_[g]=null:q._handlers_[g]&&q._handlers_[g].indexOf(w)>=0&&q._handlers_[g].splice(q._handlers_[g].indexOf(w),1),q},a.prototype.trigger=function(g,w){var q,R=this,o=g.split(/[ ,]+/g);R._handlers_=R._handlers_||{};for(var r=0;r<o.length;r+=1)q=o[r],R._handlers_[q]&&R._handlers_[q].length&&R._handlers_[q].forEach((function(g){g.call(R,{type:q,target:R},w)}))},a.prototype.config=function(g){var w=this;w.options=w.defaults||{},g&&(w.options=function(g,w){var q={};for(var R in g)g.hasOwnProperty(R)&&w.hasOwnProperty(R)?q[R]=w[R]:g.hasOwnProperty(R)&&(q[R]=g[R]);return q}(w.options,g))},a.prototype.bindEvt=function(g,w){var R=this;return R._domHandlers_=R._domHandlers_||{},R._domHandlers_[w]=function(){"function"==typeof R["on"+w]?R["on"+w].apply(R,arguments):console.warn('[WARNING] : Missing "on'+w+'" handler.')},i(g,q[w],R._domHandlers_[w]),N[w]&&i(g,N[w],R._domHandlers_[w]),R},a.prototype.unbindEvt=function(g,w){var R=this;return R._domHandlers_=R._domHandlers_||{},T(g,q[w],R._domHandlers_[w]),N[w]&&T(g,N[w],R._domHandlers_[w]),delete R._domHandlers_[w],this};const H=a;function C(g,w){return this.identifier=w.identifier,this.position=w.position,this.frontPosition=w.frontPosition,this.collection=g,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(w),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=C.id,C.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}C.prototype=new H,C.constructor=C,C.id=0,C.prototype.buildEl=function(g){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},C.prototype.stylize=function(){if(this.options.dataOnly)return this;var g=this.options.fadeTime+"ms",w=function(){var g=y("borderRadius");for(var w in g)g.hasOwnProperty(w)&&(g[w]="50%");return g}(),q=e("transition","opacity",g),R={};return R.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},R.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},R.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},L(R.el,q),"circle"===this.options.shape&&L(R.back,w),L(R.front,w),this.applyStyles(R),this},C.prototype.applyStyles=function(g){for(var w in this.ui)if(this.ui.hasOwnProperty(w))for(var q in g[w])this.ui[w].style[q]=g[w][q];return this},C.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},C.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},C.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},C.prototype.show=function(g){var w=this;return w.options.dataOnly||(clearTimeout(w.removeTimeout),clearTimeout(w.showTimeout),clearTimeout(w.restTimeout),w.addToDom(),w.restCallback(),setTimeout((function(){w.ui.el.style.opacity=1}),0),w.showTimeout=setTimeout((function(){w.trigger("shown",w.instance),"function"==typeof g&&g.call(this)}),w.options.fadeTime)),w},C.prototype.hide=function(g){var w=this;if(w.options.dataOnly)return w;if(w.ui.el.style.opacity=w.options.restOpacity,clearTimeout(w.removeTimeout),clearTimeout(w.showTimeout),clearTimeout(w.restTimeout),w.removeTimeout=setTimeout((function(){var q="dynamic"===w.options.mode?"none":"block";w.ui.el.style.display=q,"function"==typeof g&&g.call(w),w.trigger("hidden",w.instance)}),w.options.fadeTime),w.options.restJoystick){var q=w.options.restJoystick,R={};R.x=!0===q||!1!==q.x?0:w.instance.frontPosition.x,R.y=!0===q||!1!==q.y?0:w.instance.frontPosition.y,w.setPosition(g,R)}return w},C.prototype.setPosition=function(g,w){var q=this;q.frontPosition={x:w.x,y:w.y};var R=q.options.fadeTime+"ms",o={};o.front=e("transition",["transform"],R);var r={front:{}};r.front={transform:"translate("+q.frontPosition.x+"px,"+q.frontPosition.y+"px)"},q.applyStyles(o),q.applyStyles(r),q.restTimeout=setTimeout((function(){"function"==typeof g&&g.call(q),q.restCallback()}),q.options.fadeTime)},C.prototype.restCallback=function(){var g=this,w={};w.front=e("transition","none",""),g.applyStyles(w),g.trigger("rested",g.instance)},C.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},C.prototype.computeDirection=function(g){var w,q,R,o=g.angle.radian,r=Math.PI/4,S=Math.PI/2;if(o>r&&o<3*r&&!g.lockX?w="up":o>-r&&o<=r&&!g.lockY?w="left":o>3*-r&&o<=-r&&!g.lockX?w="down":g.lockY||(w="right"),g.lockY||(q=o>-S&&o<S?"left":"right"),g.lockX||(R=o>0?"up":"down"),g.force>this.options.threshold){var i,T={};for(i in this.direction)this.direction.hasOwnProperty(i)&&(T[i]=this.direction[i]);var z={};for(i in this.direction={x:q,y:R,angle:w},g.direction=this.direction,T)T[i]===this.direction[i]&&(z[i]=!0);if(z.x&&z.y&&z.angle)return g;z.x&&z.y||this.trigger("plain",g),z.x||this.trigger("plain:"+q,g),z.y||this.trigger("plain:"+R,g),z.angle||this.trigger("dir dir:"+w,g)}else this.resetDirection();return g};const c=C;function P(g,w){var q=this;q.nipples=[],q.idles=[],q.actives=[],q.ids=[],q.pressureIntervals={},q.manager=g,q.id=P.id,P.id+=1,q.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},q.config(w),"static"!==q.options.mode&&"semi"!==q.options.mode||(q.options.multitouch=!1),q.options.multitouch||(q.options.maxNumberOfNipples=1);var R=getComputedStyle(q.options.zone.parentElement);return R&&"flex"===R.display&&(q.parentIsFlex=!0),q.updateBox(),q.prepareNipples(),q.Im(),q.begin(),q.nipples}P.prototype=new H,P.constructor=P,P.id=0,P.prototype.prepareNipples=function(){var g=this,w=g.nipples;w.on=g.on.bind(g),w.off=g.off.bind(g),w.options=g.options,w.destroy=g.destroy.bind(g),w.ids=g.ids,w.id=g.id,w.processOnMove=g.processOnMove.bind(g),w.processOnEnd=g.processOnEnd.bind(g),w.get=function(g){if(void 0===g)return w[0];for(var q=0,R=w.length;q<R;q+=1)if(w[q].identifier===g)return w[q];return!1}},P.prototype.Im=function(){var g=this;g.bindEvt(g.options.zone,"start"),g.options.zone.style.touchAction="none",g.options.zone.style.msTouchAction="none"},P.prototype.begin=function(){var g=this,w=g.options;if("static"===w.mode){var q=g.createNipple(w.position,g.manager.getIdentifier());q.add(),g.idles.push(q)}},P.prototype.createNipple=function(g,w){var q=this,R=q.manager.scroll,o={},r=q.options,S=q.parentIsFlex?R.x:R.x+q.box.left,i=q.parentIsFlex?R.y:R.y+q.box.top;if(g.x&&g.y)o={x:g.x-S,y:g.y-i};else if(g.top||g.right||g.bottom||g.left){var T=document.createElement("DIV");T.style.display="hidden",T.style.top=g.top,T.style.right=g.right,T.style.bottom=g.bottom,T.style.left=g.left,T.style.position="absolute",r.zone.appendChild(T);var z=T.getBoundingClientRect();r.zone.removeChild(T),o=g,g={x:z.left+R.x,y:z.top+R.y}}var t=new c(q,{color:r.color,size:r.size,threshold:r.threshold,fadeTime:r.fadeTime,dataOnly:r.dataOnly,restJoystick:r.restJoystick,restOpacity:r.restOpacity,mode:r.mode,identifier:w,position:g,zone:r.zone,frontPosition:{x:0,y:0},shape:r.shape});return r.dataOnly||(m(t.ui.el,o),m(t.ui.front,t.frontPosition)),q.nipples.push(t),q.trigger("added "+t.identifier+":added",t),q.manager.trigger("added "+t.identifier+":added",t),q.bindNipple(t),t},P.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},P.prototype.bindNipple=function(g){var w,q=this,R=function(g,R){w=g.type+" "+R.id+":"+g.type,q.trigger(w,R)};g.on("destroyed",q.onDestroyed.bind(q)),g.on("shown hidden rested dir plain",R),g.on("dir:up dir:right dir:down dir:left",R),g.on("plain:up plain:right plain:down plain:left",R)},P.prototype.pressureFn=function(g,w,q){var R=this,o=0;clearInterval(R.pressureIntervals[q]),R.pressureIntervals[q]=setInterval(function(){var q=g.force||g.pressure||g.webkitForce||0;q!==o&&(w.trigger("pressure",q),R.trigger("pressure "+w.identifier+":pressure",q),o=q)}.bind(R),100)},P.prototype.onstart=function(g){var w=this,q=w.options,R=g;return g=z(g),w.updateBox(),A(g,(function(o){w.actives.length<q.maxNumberOfNipples?w.processOnStart(o):R.type.match(/^touch/)&&(Object.keys(w.manager.ids).forEach((function(q){if(Object.values(R.touches).findIndex((function(g){return g.identifier===q}))<0){var o=[g[0]];o.identifier=q,w.processOnEnd(o)}})),w.actives.length<q.maxNumberOfNipples&&w.processOnStart(o))})),w.manager.bindDocument(),!1},P.prototype.processOnStart=function(g){var w,q=this,o=q.options,r=q.manager.getIdentifier(g),S=g.force||g.pressure||g.webkitForce||0,i={x:g.pageX,y:g.pageY},T=q.getOrCreate(r,i);T.identifier!==r&&q.manager.removeIdentifier(T.identifier),T.identifier=r;var z=function(w){w.trigger("start",w),q.trigger("start "+w.id+":start",w),w.show(),S>0&&q.pressureFn(g,w,w.identifier),q.processOnMove(g)};if((w=q.idles.indexOf(T))>=0&&q.idles.splice(w,1),q.actives.push(T),q.ids.push(T.identifier),"semi"!==o.mode)z(T);else{if(!(R(i,T.position)<=o.catchDistance))return T.destroy(),void q.processOnStart(g);z(T)}return T},P.prototype.getOrCreate=function(g,w){var q,R=this,o=R.options;return/(semi|static)/.test(o.mode)?(q=R.idles[0])?(R.idles.splice(0,1),q):"semi"===o.mode?R.createNipple(w,g):(console.warn("Coudln't find the needed nipple."),!1):q=R.createNipple(w,g)},P.prototype.processOnMove=function(g){var w=this,q=w.options,r=w.manager.getIdentifier(g),S=w.nipples.get(r),i=w.manager.scroll;if(function(g){return isNaN(g.buttons)?0!==g.pressure:0!==g.buttons}(g)){if(!S)return console.error("Found zombie joystick with ID "+r),void w.manager.removeIdentifier(r);if(q.dynamicPage){var T=S.el.getBoundingClientRect();S.position={x:i.x+T.left,y:i.y+T.top}}S.identifier=r;var z=S.options.size/2,t={x:g.pageX,y:g.pageY};q.lockX&&(t.y=S.position.y),q.lockY&&(t.x=S.position.x);var m,e,y,L,A,l,J,x,G,d,D=R(t,S.position),U=(m=t,y=(e=S.position).x-m.x,L=e.y-m.y,function(g){return g*(180/Math.PI)}(Math.atan2(L,y))),N=o(U),a=D/z,H={distance:D,position:t};if("circle"===S.options.shape?(A=Math.min(D,z),J=S.position,x=A,d={x:0,y:0},G=o(G=U),d.x=J.x-x*Math.cos(G),d.y=J.y-x*Math.sin(G),l=d):(l=function(g,w,q){return{x:Math.min(Math.max(g.x,w.x-q),w.x+q),y:Math.min(Math.max(g.y,w.y-q),w.y+q)}}(t,S.position,z),A=R(l,S.position)),q.follow){if(D>z){var C=t.x-l.x,c=t.y-l.y;S.position.x+=C,S.position.y+=c,S.el.style.top=S.position.y-(w.box.top+i.y)+"px",S.el.style.left=S.position.x-(w.box.left+i.x)+"px",D=R(t,S.position)}}else t=l,D=A;var P=t.x-S.position.x,j=t.y-S.position.y;S.frontPosition={x:P,y:j},q.dataOnly||(S.ui.front.style.transform="translate("+P+"px,"+j+"px)");var M={identifier:S.identifier,position:t,force:a,pressure:g.force||g.pressure||g.webkitForce||0,distance:D,angle:{radian:N,degree:U},vector:{x:P/z,y:-j/z},raw:H,instance:S,lockX:q.lockX,lockY:q.lockY};(M=S.computeDirection(M)).angle={radian:o(180-U),degree:180-U},S.trigger("move",M),w.trigger("move "+S.id+":move",M)}else this.processOnEnd(g)},P.prototype.processOnEnd=function(g){var w=this,q=w.options,R=w.manager.getIdentifier(g),o=w.nipples.get(R),r=w.manager.removeIdentifier(o.identifier);o&&(q.dataOnly||o.hide((function(){"dynamic"===q.mode&&(o.trigger("removed",o),w.trigger("removed "+o.id+":removed",o),w.manager.trigger("removed "+o.id+":removed",o),o.destroy())})),clearInterval(w.pressureIntervals[o.identifier]),o.resetDirection(),o.trigger("end",o),w.trigger("end "+o.id+":end",o),w.ids.indexOf(o.identifier)>=0&&w.ids.splice(w.ids.indexOf(o.identifier),1),w.actives.indexOf(o)>=0&&w.actives.splice(w.actives.indexOf(o),1),/(semi|static)/.test(q.mode)?w.idles.push(o):w.nipples.indexOf(o)>=0&&w.nipples.splice(w.nipples.indexOf(o),1),w.manager.unbindDocument(),/(semi|static)/.test(q.mode)&&(w.manager.ids[r.id]=r.identifier))},P.prototype.onDestroyed=function(g,w){var q=this;q.nipples.indexOf(w)>=0&&q.nipples.splice(q.nipples.indexOf(w),1),q.actives.indexOf(w)>=0&&q.actives.splice(q.actives.indexOf(w),1),q.idles.indexOf(w)>=0&&q.idles.splice(q.idles.indexOf(w),1),q.ids.indexOf(w.identifier)>=0&&q.ids.splice(q.ids.indexOf(w.identifier),1),q.manager.removeIdentifier(w.identifier),q.manager.unbindDocument()},P.prototype.destroy=function(){var g=this;for(var w in g.unbindEvt(g.options.zone,"start"),g.nipples.forEach((function(g){g.destroy()})),g.pressureIntervals)g.pressureIntervals.hasOwnProperty(w)&&clearInterval(g.pressureIntervals[w]);g.trigger("destroyed",g.nipples),g.manager.unbindDocument(),g.off()};const j=P;function M(g){var w=this;w.ids={},w.index=0,w.collections=[],w.scroll=t(),w.config(g),w.prepareCollections();var q=function(){var g;w.collections.forEach((function(q){q.forEach((function(q){g=q.el.getBoundingClientRect(),q.position={x:w.scroll.x+g.left,y:w.scroll.y+g.top}}))}))};i(window,"resize",(function(){S(q)}));var R=function(){w.scroll=t()};return i(window,"scroll",(function(){S(R)})),w.collections}M.prototype=new H,M.constructor=M,M.prototype.prepareCollections=function(){var g=this;g.collections.create=g.create.bind(g),g.collections.on=g.on.bind(g),g.collections.off=g.off.bind(g),g.collections.destroy=g.destroy.bind(g),g.collections.get=function(w){var q;return g.collections.every((function(g){return!(q=g.get(w))})),q}},M.prototype.create=function(g){return this.createCollection(g)},M.prototype.createCollection=function(g){var w=this,q=new j(w,g);return w.bindCollection(q),w.collections.push(q),q},M.prototype.bindCollection=function(g){var w,q=this,R=function(g,R){w=g.type+" "+R.id+":"+g.type,q.trigger(w,R)};g.on("destroyed",q.onDestroyed.bind(q)),g.on("shown hidden rested dir plain",R),g.on("dir:up dir:right dir:down dir:left",R),g.on("plain:up plain:right plain:down plain:left",R)},M.prototype.bindDocument=function(){var g=this;g.binded||(g.bindEvt(document,"move").bindEvt(document,"end"),g.binded=!0)},M.prototype.unbindDocument=function(g){var w=this;Object.keys(w.ids).length&&!0!==g||(w.unbindEvt(document,"move").unbindEvt(document,"end"),w.binded=!1)},M.prototype.getIdentifier=function(g){var w;return g?void 0===(w=void 0===g.identifier?g.pointerId:g.identifier)&&(w=this.latest||0):w=this.index,void 0===this.ids[w]&&(this.ids[w]=this.index,this.index+=1),this.latest=w,this.ids[w]},M.prototype.removeIdentifier=function(g){var w={};for(var q in this.ids)if(this.ids[q]===g){w.id=q,w.identifier=this.ids[q],delete this.ids[q];break}return w},M.prototype.onmove=function(g){return this.onAny("move",g),!1},M.prototype.onend=function(g){return this.onAny("end",g),!1},M.prototype.oncancel=function(g){return this.onAny("end",g),!1},M.prototype.onAny=function(g,w){var q,R=this,o="processOn"+g.charAt(0).toUpperCase()+g.slice(1);w=z(w);var r=function(g,w,q){q.ids.indexOf(w)>=0&&(q[o](g),g._found_=!0)};return A(w,(function(g){q=R.getIdentifier(g),A(R.collections,r.bind(null,g,q)),g._found_||R.removeIdentifier(q)})),!1},M.prototype.destroy=function(){var g=this;g.unbindDocument(!0),g.ids={},g.index=0,g.collections.forEach((function(g){g.destroy()})),g.off()},M.prototype.onDestroyed=function(g,w){var q=this;if(q.collections.indexOf(w)<0)return!1;q.collections.splice(q.collections.indexOf(w),1)};var V=new M;const s={create:function(g){return V.create(g)},factory:V};return w.default})(),g.exports=w()},12225:(g,w,q)=>{"use strict";const{Deflate:R,deflate:o,deflateRaw:r,gzip:S}=q(12230),{Inflate:i,inflate:T,inflateRaw:z,ungzip:t}=q(12288),m=q(12265);g.exports.Deflate=R,g.exports.deflate=o,g.exports.deflateRaw=r,g.exports.gzip=S,g.exports.Inflate=i,g.exports.inflate=T,g.exports.inflateRaw=z,g.exports.ungzip=t,g.exports.constants=m},12230:(g,w,q)=>{"use strict";const R=q(12233),o=q(12269),r=q(12272),S=q(12259),i=q(12279),T=Object.prototype.toString,{Z_NO_FLUSH:z,Z_SYNC_FLUSH:t,Z_FULL_FLUSH:m,Z_FINISH:e,Z_OK:y,Z_STREAM_END:L,Z_DEFAULT_COMPRESSION:A,Z_DEFAULT_STRATEGY:l,Z_DEFLATED:J}=q(12265);function x(g){this.options=o.assign({level:A,method:J,fg:16384,windowBits:15,memLevel:8,strategy:l},g||{});let w=this.options;w.raw&&w.windowBits>0?w.windowBits=-w.windowBits:w.gzip&&w.windowBits>0&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.iw="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;let q=R.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(q!==y)throw new Error(S[q]);if(w.header&&R.deflateSetHeader(this.strm,w.header),w.dictionary){let g;if(g="string"===typeof w.dictionary?r.string2buf(w.dictionary):"[object ArrayBuffer]"===T.call(w.dictionary)?new Uint8Array(w.dictionary):w.dictionary,q=R.deflateSetDictionary(this.strm,g),q!==y)throw new Error(S[q]);this._dict_set=!0}}function G(g,w){const q=new x(w);if(q.push(g,!0),q.err)throw q.iw||S[q.err];return q.result}x.prototype.push=function(g,w){const q=this.strm,o=this.options.fg;let S,i;if(this.ended)return!1;for(i=w===~~w?w:!0===w?e:z,"string"===typeof g?q.input=r.string2buf(g):"[object ArrayBuffer]"===T.call(g)?q.input=new Uint8Array(g):q.input=g,q.next_in=0,q.avail_in=q.input.length;;)if(0===q.avail_out&&(q.output=new Uint8Array(o),q.next_out=0,q.avail_out=o),(i===t||i===m)&&q.avail_out<=6)this.onData(q.output.subarray(0,q.next_out)),q.avail_out=0;else{if(S=R.deflate(q,i),S===L)return q.next_out>0&&this.onData(q.output.subarray(0,q.next_out)),S=R.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===y;if(0!==q.avail_out){if(i>0&&q.next_out>0)this.onData(q.output.subarray(0,q.next_out)),q.avail_out=0;else if(0===q.avail_in)break}else this.onData(q.output)}return!0},x.prototype.onData=function(g){this.chunks.push(g)},x.prototype.onEnd=function(g){g===y&&(this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.iw=this.strm.iw},g.exports.Deflate=x,g.exports.deflate=G,g.exports.deflateRaw=function(g,w){return(w=w||{}).raw=!0,G(g,w)},g.exports.gzip=function(g,w){return(w=w||{}).gzip=!0,G(g,w)},g.exports.constants=q(12265)},12288:(g,w,q)=>{"use strict";const R=q(12290),o=q(12269),r=q(12272),S=q(12259),i=q(12279),T=q(12307),z=Object.prototype.toString,{Z_NO_FLUSH:t,Z_FINISH:m,Z_OK:e,Z_STREAM_END:y,Z_NEED_DICT:L,Z_STREAM_ERROR:A,Z_DATA_ERROR:l,Z_MEM_ERROR:J}=q(12265);function x(g){this.options=o.assign({fg:65536,windowBits:15,to:""},g||{});const w=this.options;w.raw&&w.windowBits>=0&&w.windowBits<16&&(w.windowBits=-w.windowBits,0===w.windowBits&&(w.windowBits=-15)),!(w.windowBits>=0&&w.windowBits<16)||g&&g.windowBits||(w.windowBits+=32),w.windowBits>15&&w.windowBits<48&&0===(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.iw="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;let q=R.inflateInit2(this.strm,w.windowBits);if(q!==e)throw new Error(S[q]);if(this.header=new T,R.inflateGetHeader(this.strm,this.header),w.dictionary&&("string"===typeof w.dictionary?w.dictionary=r.string2buf(w.dictionary):"[object ArrayBuffer]"===z.call(w.dictionary)&&(w.dictionary=new Uint8Array(w.dictionary)),w.raw&&(q=R.inflateSetDictionary(this.strm,w.dictionary),q!==e)))throw new Error(S[q])}function G(g,w){const q=new x(w);if(q.push(g),q.err)throw q.iw||S[q.err];return q.result}x.prototype.push=function(g,w){const q=this.strm,o=this.options.fg,S=this.options.dictionary;let i,T,x;if(this.ended)return!1;for(T=w===~~w?w:!0===w?m:t,"[object ArrayBuffer]"===z.call(g)?q.input=new Uint8Array(g):q.input=g,q.next_in=0,q.avail_in=q.input.length;;){for(0===q.avail_out&&(q.output=new Uint8Array(o),q.next_out=0,q.avail_out=o),i=R.inflate(q,T),i===L&&S&&(i=R.inflateSetDictionary(q,S),i===e?i=R.inflate(q,T):i===l&&(i=L));q.avail_in>0&&i===y&&q.state.wrap>0&&0!==g[q.next_in];)R.inflateReset(q),i=R.inflate(q,T);switch(i){case A:case l:case L:case J:return this.onEnd(i),this.ended=!0,!1}if(x=q.avail_out,q.next_out&&(0===q.avail_out||i===y))if("string"===this.options.to){let g=r.utf8border(q.output,q.next_out),w=q.next_out-g,R=r.buf2string(q.output,g);q.next_out=w,q.avail_out=o-w,w&&q.output.set(q.output.subarray(g,g+w),0),this.onData(R)}else this.onData(q.output.length===q.next_out?q.output:q.output.subarray(0,q.next_out));if(i!==e||0!==x){if(i===y)return i=R.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===q.avail_in)break}}return!0},x.prototype.onData=function(g){this.chunks.push(g)},x.prototype.onEnd=function(g){g===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.iw=this.strm.iw},g.exports.Inflate=x,g.exports.inflate=G,g.exports.inflateRaw=function(g,w){return(w=w||{}).raw=!0,G(g,w)},g.exports.ungzip=G,g.exports.constants=q(12265)},12269:g=>{"use strict";const w=(g,w)=>Object.prototype.hasOwnProperty.call(g,w);g.exports.assign=function(g){const q=Array.prototype.slice.call(arguments,1);for(;q.length;){const R=q.shift();if(R){if("object"!==typeof R)throw new TypeError(R+"must be non-object");for(const q in R)w(R,q)&&(g[q]=R[q])}}return g},g.exports.flattenChunks=g=>{let w=0;for(let R=0,o=g.length;R<o;R++)w+=g[R].length;const q=new Uint8Array(w);for(let R=0,o=0,r=g.length;R<r;R++){let w=g[R];q.set(w,o),o+=w.length}return q}},12272:g=>{"use strict";let w=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(R){w=!1}const q=new Uint8Array(256);for(let o=0;o<256;o++)q[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;q[254]=q[254]=1,g.exports.string2buf=g=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(g);let w,q,R,o,r,S=g.length,i=0;for(o=0;o<S;o++)q=g.charCodeAt(o),55296===(64512&q)&&o+1<S&&(R=g.charCodeAt(o+1),56320===(64512&R)&&(q=65536+(q-55296<<10)+(R-56320),o++)),i+=q<128?1:q<2048?2:q<65536?3:4;for(w=new Uint8Array(i),r=0,o=0;r<i;o++)q=g.charCodeAt(o),55296===(64512&q)&&o+1<S&&(R=g.charCodeAt(o+1),56320===(64512&R)&&(q=65536+(q-55296<<10)+(R-56320),o++)),q<128?w[r++]=q:q<2048?(w[r++]=192|q>>>6,w[r++]=128|63&q):q<65536?(w[r++]=224|q>>>12,w[r++]=128|q>>>6&63,w[r++]=128|63&q):(w[r++]=240|q>>>18,w[r++]=128|q>>>12&63,w[r++]=128|q>>>6&63,w[r++]=128|63&q);return w};g.exports.buf2string=(g,R)=>{const o=R||g.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(g.subarray(0,R));let r,S;const i=new Array(2*o);for(S=0,r=0;r<o;){let w=g[r++];if(w<128){i[S++]=w;continue}let R=q[w];if(R>4)i[S++]=65533,r+=R-1;else{for(w&=2===R?31:3===R?15:7;R>1&&r<o;)w=w<<6|63&g[r++],R--;R>1?i[S++]=65533:w<65536?i[S++]=w:(w-=65536,i[S++]=55296|w>>10&1023,i[S++]=56320|1023&w)}}return((g,q)=>{if(q<65534&&g.subarray&&w)return String.fromCharCode.apply(null,g.length===q?g:g.subarray(0,q));let R="";for(let w=0;w<q;w++)R+=String.fromCharCode(g[w]);return R})(i,S)},g.exports.utf8border=(g,w)=>{(w=w||g.length)>g.length&&(w=g.length);let R=w-1;for(;R>=0&&128===(192&g[R]);)R--;return R<0||0===R?w:R+q[g[R]]>w?R:w}},12246:g=>{"use strict";g.exports=(g,w,q,R)=>{let o=65535&g,r=g>>>16&65535,S=0;for(;0!==q;){S=q>2e3?2e3:q,q-=S;do{o=o+w[R++]|0,r=r+o|0}while(--S);o%=65521,r%=65521}return o|r<<16}},12265:g=>{"use strict";g.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12255:g=>{"use strict";const w=new Uint32Array((()=>{let g,w=[];for(var q=0;q<256;q++){g=q;for(var R=0;R<8;R++)g=1&g?3988292384^g>>>1:g>>>1;w[q]=g}return w})());g.exports=(g,q,R,o)=>{const r=w,S=o+R;g^=-1;for(let w=o;w<S;w++)g=g>>>8^r[255&(g^q[w])];return~g}},12233:(g,w,q)=>{"use strict";const{_tr_init:R,_tr_stored_block:o,_tr_flush_block:r,_tr_tally:S,_tr_align:i}=q(12239),T=q(12246),z=q(12255),t=q(12259),{Z_NO_FLUSH:m,Z_PARTIAL_FLUSH:e,Z_FULL_FLUSH:y,Z_FINISH:L,Z_BLOCK:A,Z_OK:l,Z_STREAM_END:J,Z_STREAM_ERROR:x,Z_DATA_ERROR:G,Z_BUF_ERROR:d,Z_DEFAULT_COMPRESSION:D,Z_FILTERED:U,Z_HUFFMAN_ONLY:N,Z_RLE:a,Z_FIXED:H,Z_DEFAULT_STRATEGY:C,Z_UNKNOWN:c,Z_DEFLATED:P}=q(12265),j=258,M=262,V=103,s=113,h=666,v=(g,w)=>(g.iw=t[w],w),b=g=>(g<<1)-(g>4?9:0),B=g=>{let w=g.length;for(;--w>=0;)g[w]=0};let f=(g,w,q)=>(w<<g.hash_shift^q)&g.hash_mask;const O=g=>{const w=g.state;let q=w.pending;q>g.avail_out&&(q=g.avail_out),0!==q&&(g.output.set(w.pending_buf.subarray(w.pending_out,w.pending_out+q),g.next_out),g.next_out+=q,w.pending_out+=q,g.total_out+=q,g.avail_out-=q,w.pending-=q,0===w.pending&&(w.pending_out=0))},E=(g,w)=>{r(g,g.block_start>=0?g.block_start:-1,g.strstart-g.block_start,w),g.block_start=g.strstart,O(g.strm)},Q=(g,w)=>{g.pending_buf[g.pending++]=w},X=(g,w)=>{g.pending_buf[g.pending++]=w>>>8&255,g.pending_buf[g.pending++]=255&w},K=(g,w,q,R)=>{let o=g.avail_in;return o>R&&(o=R),0===o?0:(g.avail_in-=o,w.set(g.input.subarray(g.next_in,g.next_in+o),q),1===g.state.wrap?g.adler=T(g.adler,w,o,q):2===g.state.wrap&&(g.adler=z(g.adler,w,o,q)),g.next_in+=o,g.total_in+=o,o)},Y=(g,w)=>{let q,R,o=g.max_chain_length,r=g.strstart,S=g.prev_length,i=g.nice_match;const T=g.strstart>g.w_size-M?g.strstart-(g.w_size-M):0,z=g.window,t=g.w_mask,m=g.prev,e=g.strstart+j;let y=z[r+S-1],L=z[r+S];g.prev_length>=g.good_match&&(o>>=2),i>g.lookahead&&(i=g.lookahead);do{if(q=w,z[q+S]===L&&z[q+S-1]===y&&z[q]===z[r]&&z[++q]===z[r+1]){r+=2,q++;do{}while(z[++r]===z[++q]&&z[++r]===z[++q]&&z[++r]===z[++q]&&z[++r]===z[++q]&&z[++r]===z[++q]&&z[++r]===z[++q]&&z[++r]===z[++q]&&z[++r]===z[++q]&&r<e);if(R=j-(e-r),r=e-j,R>S){if(g.match_start=w,S=R,R>=i)break;y=z[r+S-1],L=z[r+S]}}}while((w=m[w&t])>T&&0!==--o);return S<=g.lookahead?S:g.lookahead},F=g=>{const w=g.w_size;let q,R,o,r,S;do{if(r=g.window_size-g.lookahead-g.strstart,g.strstart>=w+(w-M)){g.window.set(g.window.subarray(w,w+w),0),g.match_start-=w,g.strstart-=w,g.block_start-=w,R=g.hash_size,q=R;do{o=g.head[--q],g.head[q]=o>=w?o-w:0}while(--R);R=w,q=R;do{o=g.prev[--q],g.prev[q]=o>=w?o-w:0}while(--R);r+=w}if(0===g.strm.avail_in)break;if(R=K(g.strm,g.window,g.strstart+g.lookahead,r),g.lookahead+=R,g.lookahead+g.insert>=3)for(S=g.strstart-g.insert,g.ins_h=g.window[S],g.ins_h=f(g,g.ins_h,g.window[S+1]);g.insert&&(g.ins_h=f(g,g.ins_h,g.window[S+3-1]),g.prev[S&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=S,S++,g.insert--,!(g.lookahead+g.insert<3)););}while(g.lookahead<M&&0!==g.strm.avail_in)},u=(g,w)=>{let q,R;for(;;){if(g.lookahead<M){if(F(g),g.lookahead<M&&w===m)return 1;if(0===g.lookahead)break}if(q=0,g.lookahead>=3&&(g.ins_h=f(g,g.ins_h,g.window[g.strstart+3-1]),q=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),0!==q&&g.strstart-q<=g.w_size-M&&(g.match_length=Y(g,q)),g.match_length>=3)if(R=S(g,g.strstart-g.match_start,g.match_length-3),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=3){g.match_length--;do{g.strstart++,g.ins_h=f(g,g.ins_h,g.window[g.strstart+3-1]),q=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart}while(0!==--g.match_length);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=f(g,g.ins_h,g.window[g.strstart+1]);else R=S(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(R&&(E(g,!1),0===g.strm.avail_out))return 1}return g.insert=g.strstart<2?g.strstart:2,w===L?(E(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(E(g,!1),0===g.strm.avail_out)?1:2},n=(g,w)=>{let q,R,o;for(;;){if(g.lookahead<M){if(F(g),g.lookahead<M&&w===m)return 1;if(0===g.lookahead)break}if(q=0,g.lookahead>=3&&(g.ins_h=f(g,g.ins_h,g.window[g.strstart+3-1]),q=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=2,0!==q&&g.prev_length<g.max_lazy_match&&g.strstart-q<=g.w_size-M&&(g.match_length=Y(g,q),g.match_length<=5&&(g.strategy===U||3===g.match_length&&g.strstart-g.match_start>4096)&&(g.match_length=2)),g.prev_length>=3&&g.match_length<=g.prev_length){o=g.strstart+g.lookahead-3,R=S(g,g.strstart-1-g.prev_match,g.prev_length-3),g.lookahead-=g.prev_length-1,g.prev_length-=2;do{++g.strstart<=o&&(g.ins_h=f(g,g.ins_h,g.window[g.strstart+3-1]),q=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart)}while(0!==--g.prev_length);if(g.match_available=0,g.match_length=2,g.strstart++,R&&(E(g,!1),0===g.strm.avail_out))return 1}else if(g.match_available){if(R=S(g,0,g.window[g.strstart-1]),R&&E(g,!1),g.strstart++,g.lookahead--,0===g.strm.avail_out)return 1}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(R=S(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<2?g.strstart:2,w===L?(E(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(E(g,!1),0===g.strm.avail_out)?1:2};function W(g,w,q,R,o){this.good_length=g,this.max_lazy=w,this.nice_length=q,this.max_chain=R,this.func=o}const p=[new W(0,0,0,0,((g,w)=>{let q=65535;for(q>g.pending_buf_size-5&&(q=g.pending_buf_size-5);;){if(g.lookahead<=1){if(F(g),0===g.lookahead&&w===m)return 1;if(0===g.lookahead)break}g.strstart+=g.lookahead,g.lookahead=0;const R=g.block_start+q;if((0===g.strstart||g.strstart>=R)&&(g.lookahead=g.strstart-R,g.strstart=R,E(g,!1),0===g.strm.avail_out))return 1;if(g.strstart-g.block_start>=g.w_size-M&&(E(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,w===L?(E(g,!0),0===g.strm.avail_out?3:4):(g.strstart>g.block_start&&(E(g,!1),g.strm.avail_out),1)})),new W(4,4,8,4,u),new W(4,5,16,8,u),new W(4,6,32,32,u),new W(4,4,16,16,n),new W(8,16,32,32,n),new W(8,16,128,128,n),new W(8,32,128,256,n),new W(32,128,258,1024,n),new W(32,258,258,4096,n)];function Z(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=P,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),B(this.dyn_ltree),B(this.dyn_dtree),B(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),B(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),B(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const I=g=>{if(!g||!g.state)return v(g,x);g.total_in=g.total_out=0,g.data_type=c;const w=g.state;return w.pending=0,w.pending_out=0,w.wrap<0&&(w.wrap=-w.wrap),w.status=w.wrap?42:s,g.adler=2===w.wrap?0:1,w.last_flush=m,R(w),l},k=g=>{const w=I(g);var q;return w===l&&((q=g.state).window_size=2*q.w_size,B(q.head),q.max_lazy_match=p[q.level].max_lazy,q.good_match=p[q.level].good_length,q.nice_match=p[q.level].nice_length,q.max_chain_length=p[q.level].max_chain,q.strstart=0,q.block_start=0,q.lookahead=0,q.insert=0,q.match_length=q.prev_length=2,q.match_available=0,q.ins_h=0),w},gg=(g,w,q,R,o,r)=>{if(!g)return x;let S=1;if(w===D&&(w=6),R<0?(S=0,R=-R):R>15&&(S=2,R-=16),o<1||o>9||q!==P||R<8||R>15||w<0||w>9||r<0||r>H)return v(g,x);8===R&&(R=9);const i=new Z;return g.state=i,i.strm=g,i.wrap=S,i.gzhead=null,i.w_bits=R,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=o+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+3-1)/3),i.window=new Uint8Array(2*i.w_size),i.head=new Uint16Array(i.hash_size),i.prev=new Uint16Array(i.w_size),i.lit_bufsize=1<<o+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new Uint8Array(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=w,i.strategy=r,i.method=q,k(g)};g.exports.deflateInit=(g,w)=>gg(g,w,P,15,8,C),g.exports.deflateInit2=gg,g.exports.deflateReset=k,g.exports.deflateResetKeep=I,g.exports.deflateSetHeader=(g,w)=>g&&g.state?2!==g.state.wrap?x:(g.state.gzhead=w,l):x,g.exports.deflate=(g,w)=>{let q,R;if(!g||!g.state||w>A||w<0)return g?v(g,x):x;const r=g.state;if(!g.output||!g.input&&0!==g.avail_in||r.status===h&&w!==L)return v(g,0===g.avail_out?d:x);r.strm=g;const T=r.last_flush;if(r.last_flush=w,42===r.status)if(2===r.wrap)g.adler=0,Q(r,31),Q(r,139),Q(r,8),r.gzhead?(Q(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Q(r,255&r.gzhead.time),Q(r,r.gzhead.time>>8&255),Q(r,r.gzhead.time>>16&255),Q(r,r.gzhead.time>>24&255),Q(r,9===r.level?2:r.strategy>=N||r.level<2?4:0),Q(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Q(r,255&r.gzhead.extra.length),Q(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(g.adler=z(g.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(Q(r,0),Q(r,0),Q(r,0),Q(r,0),Q(r,0),Q(r,9===r.level?2:r.strategy>=N||r.level<2?4:0),Q(r,3),r.status=s);else{let w=P+(r.w_bits-8<<4)<<8,q=-1;q=r.strategy>=N||r.level<2?0:r.level<6?1:6===r.level?2:3,w|=q<<6,0!==r.strstart&&(w|=32),w+=31-w%31,r.status=s,X(r,w),0!==r.strstart&&(X(r,g.adler>>>16),X(r,65535&g.adler)),g.adler=1}if(69===r.status)if(r.gzhead.extra){for(q=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>q&&(g.adler=z(g.adler,r.pending_buf,r.pending-q,q)),O(g),q=r.pending,r.pending!==r.pending_buf_size));)Q(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>q&&(g.adler=z(g.adler,r.pending_buf,r.pending-q,q)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){q=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>q&&(g.adler=z(g.adler,r.pending_buf,r.pending-q,q)),O(g),q=r.pending,r.pending===r.pending_buf_size)){R=1;break}R=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Q(r,R)}while(0!==R);r.gzhead.hcrc&&r.pending>q&&(g.adler=z(g.adler,r.pending_buf,r.pending-q,q)),0===R&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){q=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>q&&(g.adler=z(g.adler,r.pending_buf,r.pending-q,q)),O(g),q=r.pending,r.pending===r.pending_buf_size)){R=1;break}R=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Q(r,R)}while(0!==R);r.gzhead.hcrc&&r.pending>q&&(g.adler=z(g.adler,r.pending_buf,r.pending-q,q)),0===R&&(r.status=V)}else r.status=V;if(r.status===V&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&O(g),r.pending+2<=r.pending_buf_size&&(Q(r,255&g.adler),Q(r,g.adler>>8&255),g.adler=0,r.status=s)):r.status=s),0!==r.pending){if(O(g),0===g.avail_out)return r.last_flush=-1,l}else if(0===g.avail_in&&b(w)<=b(T)&&w!==L)return v(g,d);if(r.status===h&&0!==g.avail_in)return v(g,d);if(0!==g.avail_in||0!==r.lookahead||w!==m&&r.status!==h){let q=r.strategy===N?((g,w)=>{let q;for(;;){if(0===g.lookahead&&(F(g),0===g.lookahead)){if(w===m)return 1;break}if(g.match_length=0,q=S(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++,q&&(E(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,w===L?(E(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(E(g,!1),0===g.strm.avail_out)?1:2})(r,w):r.strategy===a?((g,w)=>{let q,R,o,r;const i=g.window;for(;;){if(g.lookahead<=j){if(F(g),g.lookahead<=j&&w===m)return 1;if(0===g.lookahead)break}if(g.match_length=0,g.lookahead>=3&&g.strstart>0&&(o=g.strstart-1,R=i[o],R===i[++o]&&R===i[++o]&&R===i[++o])){r=g.strstart+j;do{}while(R===i[++o]&&R===i[++o]&&R===i[++o]&&R===i[++o]&&R===i[++o]&&R===i[++o]&&R===i[++o]&&R===i[++o]&&o<r);g.match_length=j-(r-o),g.match_length>g.lookahead&&(g.match_length=g.lookahead)}if(g.match_length>=3?(q=S(g,1,g.match_length-3),g.lookahead-=g.match_length,g.strstart+=g.match_length,g.match_length=0):(q=S(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++),q&&(E(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,w===L?(E(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(E(g,!1),0===g.strm.avail_out)?1:2})(r,w):p[r.level].func(r,w);if(3!==q&&4!==q||(r.status=h),1===q||3===q)return 0===g.avail_out&&(r.last_flush=-1),l;if(2===q&&(w===e?i(r):w!==A&&(o(r,0,0,!1),w===y&&(B(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),O(g),0===g.avail_out))return r.last_flush=-1,l}return w!==L?l:r.wrap<=0?J:(2===r.wrap?(Q(r,255&g.adler),Q(r,g.adler>>8&255),Q(r,g.adler>>16&255),Q(r,g.adler>>24&255),Q(r,255&g.total_in),Q(r,g.total_in>>8&255),Q(r,g.total_in>>16&255),Q(r,g.total_in>>24&255)):(X(r,g.adler>>>16),X(r,65535&g.adler)),O(g),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?l:J)},g.exports.deflateEnd=g=>{if(!g||!g.state)return x;const w=g.state.status;return 42!==w&&69!==w&&73!==w&&91!==w&&w!==V&&w!==s&&w!==h?v(g,x):(g.state=null,w===s?v(g,G):l)},g.exports.deflateSetDictionary=(g,w)=>{let q=w.length;if(!g||!g.state)return x;const R=g.state,o=R.wrap;if(2===o||1===o&&42!==R.status||R.lookahead)return x;if(1===o&&(g.adler=T(g.adler,w,q,0)),R.wrap=0,q>=R.w_size){0===o&&(B(R.head),R.strstart=0,R.block_start=0,R.insert=0);let g=new Uint8Array(R.w_size);g.set(w.subarray(q-R.w_size,q),0),w=g,q=R.w_size}const r=g.avail_in,S=g.next_in,i=g.input;for(g.avail_in=q,g.next_in=0,g.input=w,F(R);R.lookahead>=3;){let g=R.strstart,w=R.lookahead-2;do{R.ins_h=f(R,R.ins_h,R.window[g+3-1]),R.prev[g&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=g,g++}while(--w);R.strstart=g,R.lookahead=2,F(R)}return R.strstart+=R.lookahead,R.block_start=R.strstart,R.insert=R.lookahead,R.lookahead=0,R.match_length=R.prev_length=2,R.match_available=0,g.next_in=S,g.input=i,g.avail_in=r,R.wrap=o,l},g.exports.deflateInfo="pako deflate (from Nodeca project)"},12307:g=>{"use strict";g.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12297:g=>{"use strict";g.exports=function(g,w){let q,R,o,r,S,i,T,z,t,m,e,y,L,A,l,J,x,G,d,D,U,N,a,H;const C=g.state;q=g.next_in,a=g.input,R=q+(g.avail_in-5),o=g.next_out,H=g.output,r=o-(w-g.avail_out),S=o+(g.avail_out-257),i=C.dmax,T=C.wsize,z=C.whave,t=C.wnext,m=C.window,e=C.hold,y=C.bits,L=C.lencode,A=C.distcode,l=(1<<C.lenbits)-1,J=(1<<C.distbits)-1;g:do{y<15&&(e+=a[q++]<<y,y+=8,e+=a[q++]<<y,y+=8),x=L[e&l];w:for(;;){if(G=x>>>24,e>>>=G,y-=G,G=x>>>16&255,0===G)H[o++]=65535&x;else{if(!(16&G)){if(0===(64&G)){x=L[(65535&x)+(e&(1<<G)-1)];continue w}if(32&G){C.mode=12;break g}g.iw="invalid literal/length code",C.mode=30;break g}d=65535&x,G&=15,G&&(y<G&&(e+=a[q++]<<y,y+=8),d+=e&(1<<G)-1,e>>>=G,y-=G),y<15&&(e+=a[q++]<<y,y+=8,e+=a[q++]<<y,y+=8),x=A[e&J];q:for(;;){if(G=x>>>24,e>>>=G,y-=G,G=x>>>16&255,!(16&G)){if(0===(64&G)){x=A[(65535&x)+(e&(1<<G)-1)];continue q}g.iw="invalid distance code",C.mode=30;break g}if(D=65535&x,G&=15,y<G&&(e+=a[q++]<<y,y+=8,y<G&&(e+=a[q++]<<y,y+=8)),D+=e&(1<<G)-1,D>i){g.iw="invalid distance too far back",C.mode=30;break g}if(e>>>=G,y-=G,G=o-r,D>G){if(G=D-G,G>z&&C.sane){g.iw="invalid distance too far back",C.mode=30;break g}if(U=0,N=m,0===t){if(U+=T-G,G<d){d-=G;do{H[o++]=m[U++]}while(--G);U=o-D,N=H}}else if(t<G){if(U+=T+t-G,G-=t,G<d){d-=G;do{H[o++]=m[U++]}while(--G);if(U=0,t<d){G=t,d-=G;do{H[o++]=m[U++]}while(--G);U=o-D,N=H}}}else if(U+=t-G,G<d){d-=G;do{H[o++]=m[U++]}while(--G);U=o-D,N=H}for(;d>2;)H[o++]=N[U++],H[o++]=N[U++],H[o++]=N[U++],d-=3;d&&(H[o++]=N[U++],d>1&&(H[o++]=N[U++]))}else{U=o-D;do{H[o++]=H[U++],H[o++]=H[U++],H[o++]=H[U++],d-=3}while(d>2);d&&(H[o++]=H[U++],d>1&&(H[o++]=H[U++]))}break}}break}}while(q<R&&o<S);d=y>>3,q-=d,y-=d<<3,e&=(1<<y)-1,g.next_in=q,g.next_out=o,g.avail_in=q<R?R-q+5:5-(q-R),g.avail_out=o<S?S-o+257:257-(o-S),C.hold=e,C.bits=y}},12290:(g,w,q)=>{"use strict";const R=q(12246),o=q(12255),r=q(12297),S=q(12304),{Z_FINISH:i,Z_BLOCK:T,Z_TREES:z,Z_OK:t,Z_STREAM_END:m,Z_NEED_DICT:e,Z_STREAM_ERROR:y,Z_DATA_ERROR:L,Z_MEM_ERROR:A,Z_BUF_ERROR:l,Z_DEFLATED:J}=q(12265),x=12,G=30,d=g=>(g>>>24&255)+(g>>>8&65280)+((65280&g)<<8)+((255&g)<<24);function D(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const U=g=>{if(!g||!g.state)return y;const w=g.state;return g.total_in=g.total_out=w.total=0,g.iw="",w.wrap&&(g.adler=1&w.wrap),w.mode=1,w.last=0,w.havedict=0,w.dmax=32768,w.head=null,w.hold=0,w.bits=0,w.lencode=w.lendyn=new Int32Array(852),w.distcode=w.distdyn=new Int32Array(592),w.sane=1,w.back=-1,t},N=g=>{if(!g||!g.state)return y;const w=g.state;return w.wsize=0,w.whave=0,w.wnext=0,U(g)},a=(g,w)=>{let q;if(!g||!g.state)return y;const R=g.state;return w<0?(q=0,w=-w):(q=1+(w>>4),w<48&&(w&=15)),w&&(w<8||w>15)?y:(null!==R.window&&R.wbits!==w&&(R.window=null),R.wrap=q,R.wbits=w,N(g))},H=(g,w)=>{if(!g)return y;const q=new D;g.state=q,q.window=null;const R=a(g,w);return R!==t&&(g.state=null),R};let C,c,P=!0;const j=g=>{if(P){C=new Int32Array(512),c=new Int32Array(32);let w=0;for(;w<144;)g.lens[w++]=8;for(;w<256;)g.lens[w++]=9;for(;w<280;)g.lens[w++]=7;for(;w<288;)g.lens[w++]=8;for(S(1,g.lens,0,288,C,0,g.work,{bits:9}),w=0;w<32;)g.lens[w++]=5;S(2,g.lens,0,32,c,0,g.work,{bits:5}),P=!1}g.lencode=C,g.lenbits=9,g.distcode=c,g.distbits=5},M=(g,w,q,R)=>{let o;const r=g.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),R>=r.wsize?(r.window.set(w.subarray(q-r.wsize,q),0),r.wnext=0,r.whave=r.wsize):(o=r.wsize-r.wnext,o>R&&(o=R),r.window.set(w.subarray(q-R,q-R+o),r.wnext),(R-=o)?(r.window.set(w.subarray(q-R,q),0),r.wnext=R,r.whave=r.wsize):(r.wnext+=o,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=o))),0};g.exports.inflateReset=N,g.exports.inflateReset2=a,g.exports.inflateResetKeep=U,g.exports.inflateInit=g=>H(g,15),g.exports.inflateInit2=H,g.exports.inflate=(g,w)=>{let q,D,U,N,a,H,C,c,P,V,s,h,v,b,B,f,O,E,Q,X,K,Y,F=0;const u=new Uint8Array(4);let n,W;const p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!g||!g.state||!g.output||!g.input&&0!==g.avail_in)return y;q=g.state,q.mode===x&&(q.mode=13),a=g.next_out,U=g.output,C=g.avail_out,N=g.next_in,D=g.input,H=g.avail_in,c=q.hold,P=q.bits,V=H,s=C,Y=t;g:for(;;)switch(q.mode){case 1:if(0===q.wrap){q.mode=13;break}for(;P<16;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}if(2&q.wrap&&35615===c){q.check=0,u[0]=255&c,u[1]=c>>>8&255,q.check=o(q.check,u,2,0),c=0,P=0,q.mode=2;break}if(q.flags=0,q.head&&(q.head.done=!1),!(1&q.wrap)||(((255&c)<<8)+(c>>8))%31){g.iw="incorrect header check",q.mode=G;break}if((15&c)!==J){g.iw="unknown compression method",q.mode=G;break}if(c>>>=4,P-=4,K=8+(15&c),0===q.wbits)q.wbits=K;else if(K>q.wbits){g.iw="invalid window size",q.mode=G;break}q.dmax=1<<q.wbits,g.adler=q.check=1,q.mode=512&c?10:x,c=0,P=0;break;case 2:for(;P<16;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}if(q.flags=c,(255&q.flags)!==J){g.iw="unknown compression method",q.mode=G;break}if(57344&q.flags){g.iw="unknown header flags set",q.mode=G;break}q.head&&(q.head.text=c>>8&1),512&q.flags&&(u[0]=255&c,u[1]=c>>>8&255,q.check=o(q.check,u,2,0)),c=0,P=0,q.mode=3;case 3:for(;P<32;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}q.head&&(q.head.time=c),512&q.flags&&(u[0]=255&c,u[1]=c>>>8&255,u[2]=c>>>16&255,u[3]=c>>>24&255,q.check=o(q.check,u,4,0)),c=0,P=0,q.mode=4;case 4:for(;P<16;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}q.head&&(q.head.xflags=255&c,q.head.os=c>>8),512&q.flags&&(u[0]=255&c,u[1]=c>>>8&255,q.check=o(q.check,u,2,0)),c=0,P=0,q.mode=5;case 5:if(1024&q.flags){for(;P<16;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}q.length=c,q.head&&(q.head.extra_len=c),512&q.flags&&(u[0]=255&c,u[1]=c>>>8&255,q.check=o(q.check,u,2,0)),c=0,P=0}else q.head&&(q.head.extra=null);q.mode=6;case 6:if(1024&q.flags&&(h=q.length,h>H&&(h=H),h&&(q.head&&(K=q.head.extra_len-q.length,q.head.extra||(q.head.extra=new Uint8Array(q.head.extra_len)),q.head.extra.set(D.subarray(N,N+h),K)),512&q.flags&&(q.check=o(q.check,D,h,N)),H-=h,N+=h,q.length-=h),q.length))break g;q.length=0,q.mode=7;case 7:if(2048&q.flags){if(0===H)break g;h=0;do{K=D[N+h++],q.head&&K&&q.length<65536&&(q.head.name+=String.fromCharCode(K))}while(K&&h<H);if(512&q.flags&&(q.check=o(q.check,D,h,N)),H-=h,N+=h,K)break g}else q.head&&(q.head.name=null);q.length=0,q.mode=8;case 8:if(4096&q.flags){if(0===H)break g;h=0;do{K=D[N+h++],q.head&&K&&q.length<65536&&(q.head.comment+=String.fromCharCode(K))}while(K&&h<H);if(512&q.flags&&(q.check=o(q.check,D,h,N)),H-=h,N+=h,K)break g}else q.head&&(q.head.comment=null);q.mode=9;case 9:if(512&q.flags){for(;P<16;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}if(c!==(65535&q.check)){g.iw="header crc mismatch",q.mode=G;break}c=0,P=0}q.head&&(q.head.hcrc=q.flags>>9&1,q.head.done=!0),g.adler=q.check=0,q.mode=x;break;case 10:for(;P<32;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}g.adler=q.check=d(c),c=0,P=0,q.mode=11;case 11:if(0===q.havedict)return g.next_out=a,g.avail_out=C,g.next_in=N,g.avail_in=H,q.hold=c,q.bits=P,e;g.adler=q.check=1,q.mode=x;case x:if(w===T||w===z)break g;case 13:if(q.last){c>>>=7&P,P-=7&P,q.mode=27;break}for(;P<3;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}switch(q.last=1&c,c>>>=1,P-=1,3&c){case 0:q.mode=14;break;case 1:if(j(q),q.mode=20,w===z){c>>>=2,P-=2;break g}break;case 2:q.mode=17;break;case 3:g.iw="invalid block type",q.mode=G}c>>>=2,P-=2;break;case 14:for(c>>>=7&P,P-=7&P;P<32;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}if((65535&c)!==(c>>>16^65535)){g.iw="invalid stored block lengths",q.mode=G;break}if(q.length=65535&c,c=0,P=0,q.mode=15,w===z)break g;case 15:q.mode=16;case 16:if(h=q.length,h){if(h>H&&(h=H),h>C&&(h=C),0===h)break g;U.set(D.subarray(N,N+h),a),H-=h,N+=h,C-=h,a+=h,q.length-=h;break}q.mode=x;break;case 17:for(;P<14;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}if(q.nlen=257+(31&c),c>>>=5,P-=5,q.ndist=1+(31&c),c>>>=5,P-=5,q.ncode=4+(15&c),c>>>=4,P-=4,q.nlen>286||q.ndist>30){g.iw="too many length or distance symbols",q.mode=G;break}q.have=0,q.mode=18;case 18:for(;q.have<q.ncode;){for(;P<3;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}q.lens[p[q.have++]]=7&c,c>>>=3,P-=3}for(;q.have<19;)q.lens[p[q.have++]]=0;if(q.lencode=q.lendyn,q.lenbits=7,n={bits:q.lenbits},Y=S(0,q.lens,0,19,q.lencode,0,q.work,n),q.lenbits=n.bits,Y){g.iw="invalid code lengths set",q.mode=G;break}q.have=0,q.mode=19;case 19:for(;q.have<q.nlen+q.ndist;){for(;F=q.lencode[c&(1<<q.lenbits)-1],B=F>>>24,f=F>>>16&255,O=65535&F,!(B<=P);){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}if(O<16)c>>>=B,P-=B,q.lens[q.have++]=O;else{if(16===O){for(W=B+2;P<W;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}if(c>>>=B,P-=B,0===q.have){g.iw="invalid bit length repeat",q.mode=G;break}K=q.lens[q.have-1],h=3+(3&c),c>>>=2,P-=2}else if(17===O){for(W=B+3;P<W;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}c>>>=B,P-=B,K=0,h=3+(7&c),c>>>=3,P-=3}else{for(W=B+7;P<W;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}c>>>=B,P-=B,K=0,h=11+(127&c),c>>>=7,P-=7}if(q.have+h>q.nlen+q.ndist){g.iw="invalid bit length repeat",q.mode=G;break}for(;h--;)q.lens[q.have++]=K}}if(q.mode===G)break;if(0===q.lens[256]){g.iw="invalid code -- missing end-of-block",q.mode=G;break}if(q.lenbits=9,n={bits:q.lenbits},Y=S(1,q.lens,0,q.nlen,q.lencode,0,q.work,n),q.lenbits=n.bits,Y){g.iw="invalid literal/lengths set",q.mode=G;break}if(q.distbits=6,q.distcode=q.distdyn,n={bits:q.distbits},Y=S(2,q.lens,q.nlen,q.ndist,q.distcode,0,q.work,n),q.distbits=n.bits,Y){g.iw="invalid distances set",q.mode=G;break}if(q.mode=20,w===z)break g;case 20:q.mode=21;case 21:if(H>=6&&C>=258){g.next_out=a,g.avail_out=C,g.next_in=N,g.avail_in=H,q.hold=c,q.bits=P,r(g,s),a=g.next_out,U=g.output,C=g.avail_out,N=g.next_in,D=g.input,H=g.avail_in,c=q.hold,P=q.bits,q.mode===x&&(q.back=-1);break}for(q.back=0;F=q.lencode[c&(1<<q.lenbits)-1],B=F>>>24,f=F>>>16&255,O=65535&F,!(B<=P);){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}if(f&&0===(240&f)){for(E=B,Q=f,X=O;F=q.lencode[X+((c&(1<<E+Q)-1)>>E)],B=F>>>24,f=F>>>16&255,O=65535&F,!(E+B<=P);){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}c>>>=E,P-=E,q.back+=E}if(c>>>=B,P-=B,q.back+=B,q.length=O,0===f){q.mode=26;break}if(32&f){q.back=-1,q.mode=x;break}if(64&f){g.iw="invalid literal/length code",q.mode=G;break}q.extra=15&f,q.mode=22;case 22:if(q.extra){for(W=q.extra;P<W;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}q.length+=c&(1<<q.extra)-1,c>>>=q.extra,P-=q.extra,q.back+=q.extra}q.was=q.length,q.mode=23;case 23:for(;F=q.distcode[c&(1<<q.distbits)-1],B=F>>>24,f=F>>>16&255,O=65535&F,!(B<=P);){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}if(0===(240&f)){for(E=B,Q=f,X=O;F=q.distcode[X+((c&(1<<E+Q)-1)>>E)],B=F>>>24,f=F>>>16&255,O=65535&F,!(E+B<=P);){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}c>>>=E,P-=E,q.back+=E}if(c>>>=B,P-=B,q.back+=B,64&f){g.iw="invalid distance code",q.mode=G;break}q.offset=O,q.extra=15&f,q.mode=24;case 24:if(q.extra){for(W=q.extra;P<W;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}q.offset+=c&(1<<q.extra)-1,c>>>=q.extra,P-=q.extra,q.back+=q.extra}if(q.offset>q.dmax){g.iw="invalid distance too far back",q.mode=G;break}q.mode=25;case 25:if(0===C)break g;if(h=s-C,q.offset>h){if(h=q.offset-h,h>q.whave&&q.sane){g.iw="invalid distance too far back",q.mode=G;break}h>q.wnext?(h-=q.wnext,v=q.wsize-h):v=q.wnext-h,h>q.length&&(h=q.length),b=q.window}else b=U,v=a-q.offset,h=q.length;h>C&&(h=C),C-=h,q.length-=h;do{U[a++]=b[v++]}while(--h);0===q.length&&(q.mode=21);break;case 26:if(0===C)break g;U[a++]=q.length,C--,q.mode=21;break;case 27:if(q.wrap){for(;P<32;){if(0===H)break g;H--,c|=D[N++]<<P,P+=8}if(s-=C,g.total_out+=s,q.total+=s,s&&(g.adler=q.check=q.flags?o(q.check,U,s,a-s):R(q.check,U,s,a-s)),s=C,(q.flags?c:d(c))!==q.check){g.iw="incorrect data check",q.mode=G;break}c=0,P=0}q.mode=28;case 28:if(q.wrap&&q.flags){for(;P<32;){if(0===H)break g;H--,c+=D[N++]<<P,P+=8}if(c!==(4294967295&q.total)){g.iw="incorrect length check",q.mode=G;break}c=0,P=0}q.mode=29;case 29:Y=m;break g;case G:Y=L;break g;case 31:return A;default:return y}return g.next_out=a,g.avail_out=C,g.next_in=N,g.avail_in=H,q.hold=c,q.bits=P,(q.wsize||s!==g.avail_out&&q.mode<G&&(q.mode<27||w!==i))&&M(g,g.output,g.next_out,s-g.avail_out)?(q.mode=31,A):(V-=g.avail_in,s-=g.avail_out,g.total_in+=V,g.total_out+=s,q.total+=s,q.wrap&&s&&(g.adler=q.check=q.flags?o(q.check,U,s,g.next_out-s):R(q.check,U,s,g.next_out-s)),g.data_type=q.bits+(q.last?64:0)+(q.mode===x?128:0)+(20===q.mode||15===q.mode?256:0),(0===V&&0===s||w===i)&&Y===t&&(Y=l),Y)},g.exports.inflateEnd=g=>{if(!g||!g.state)return y;let w=g.state;return w.window&&(w.window=null),g.state=null,t},g.exports.inflateGetHeader=(g,w)=>{if(!g||!g.state)return y;const q=g.state;return 0===(2&q.wrap)?y:(q.head=w,w.done=!1,t)},g.exports.inflateSetDictionary=(g,w)=>{const q=w.length;let o,r,S;return g&&g.state?(o=g.state,0!==o.wrap&&11!==o.mode?y:11===o.mode&&(r=1,r=R(r,w,q,0),r!==o.check)?L:(S=M(g,w,q,q),S?(o.mode=31,A):(o.havedict=1,t))):y},g.exports.inflateInfo="pako inflate (from Nodeca project)"},12304:g=>{"use strict";const w=15,q=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),R=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),o=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),r=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);g.exports=(g,S,i,T,z,t,m,e)=>{const y=e.bits;let L,A,l,J,x,G,d=0,D=0,U=0,N=0,a=0,H=0,C=0,c=0,P=0,j=0,M=null,V=0;const s=new Uint16Array(16),h=new Uint16Array(16);let v,b,B,f=null,O=0;for(d=0;d<=w;d++)s[d]=0;for(D=0;D<T;D++)s[S[i+D]]++;for(a=y,N=w;N>=1&&0===s[N];N--);if(a>N&&(a=N),0===N)return z[t++]=20971520,z[t++]=20971520,e.bits=1,0;for(U=1;U<N&&0===s[U];U++);for(a<U&&(a=U),c=1,d=1;d<=w;d++)if(c<<=1,c-=s[d],c<0)return-1;if(c>0&&(0===g||1!==N))return-1;for(h[1]=0,d=1;d<w;d++)h[d+1]=h[d]+s[d];for(D=0;D<T;D++)0!==S[i+D]&&(m[h[S[i+D]]++]=D);if(0===g?(M=f=m,G=19):1===g?(M=q,V-=257,f=R,O-=257,G=256):(M=o,f=r,G=-1),j=0,D=0,d=U,x=t,H=a,C=0,l=-1,P=1<<a,J=P-1,1===g&&P>852||2===g&&P>592)return 1;for(;;){v=d-C,m[D]<G?(b=0,B=m[D]):m[D]>G?(b=f[O+m[D]],B=M[V+m[D]]):(b=96,B=0),L=1<<d-C,A=1<<H,U=A;do{A-=L,z[x+(j>>C)+A]=v<<24|b<<16|B}while(0!==A);for(L=1<<d-1;j&L;)L>>=1;if(0!==L?(j&=L-1,j+=L):j=0,D++,0===--s[d]){if(d===N)break;d=S[i+m[D]]}if(d>a&&(j&J)!==l){for(0===C&&(C=a),x+=U,H=d-C,c=1<<H;H+C<N&&(c-=s[H+C],!(c<=0));)H++,c<<=1;if(P+=1<<H,1===g&&P>852||2===g&&P>592)return 1;l=j&J,z[l]=a<<24|H<<16|x-t}}return 0!==j&&(z[x+j]=d-C<<24|64<<16),e.bits=a,0}},12259:g=>{"use strict";g.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12239:g=>{"use strict";function w(g){let w=g.length;for(;--w>=0;)g[w]=0}const q=256,R=286,o=30,r=15,S=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),i=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),T=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Array(576);w(t);const m=new Array(60);w(m);const e=new Array(512);w(e);const y=new Array(256);w(y);const L=new Array(29);w(L);const A=new Array(o);function l(g,w,q,R,o){this.static_tree=g,this.extra_bits=w,this.extra_base=q,this.elems=R,this.max_length=o,this.has_stree=g&&g.length}let J,x,G;function d(g,w){this.dyn_tree=g,this.max_code=0,this.stat_desc=w}w(A);const D=g=>g<256?e[g]:e[256+(g>>>7)],U=(g,w)=>{g.pending_buf[g.pending++]=255&w,g.pending_buf[g.pending++]=w>>>8&255},N=(g,w,q)=>{g.bi_valid>16-q?(g.bi_buf|=w<<g.bi_valid&65535,U(g,g.bi_buf),g.bi_buf=w>>16-g.bi_valid,g.bi_valid+=q-16):(g.bi_buf|=w<<g.bi_valid&65535,g.bi_valid+=q)},a=(g,w,q)=>{N(g,q[2*w],q[2*w+1])},H=(g,w)=>{let q=0;do{q|=1&g,g>>>=1,q<<=1}while(--w>0);return q>>>1},C=(g,w,q)=>{const R=new Array(16);let o,S,i=0;for(o=1;o<=r;o++)R[o]=i=i+q[o-1]<<1;for(S=0;S<=w;S++){let w=g[2*S+1];0!==w&&(g[2*S]=H(R[w]++,w))}},c=g=>{let w;for(w=0;w<R;w++)g.dyn_ltree[2*w]=0;for(w=0;w<o;w++)g.dyn_dtree[2*w]=0;for(w=0;w<19;w++)g.bl_tree[2*w]=0;g.dyn_ltree[512]=1,g.opt_len=g.static_len=0,g.last_lit=g.matches=0},P=g=>{g.bi_valid>8?U(g,g.bi_buf):g.bi_valid>0&&(g.pending_buf[g.pending++]=g.bi_buf),g.bi_buf=0,g.bi_valid=0},j=(g,w,q,R)=>{const o=2*w,r=2*q;return g[o]<g[r]||g[o]===g[r]&&R[w]<=R[q]},M=(g,w,q)=>{const R=g.heap[q];let o=q<<1;for(;o<=g.heap_len&&(o<g.heap_len&&j(w,g.heap[o+1],g.heap[o],g.depth)&&o++,!j(w,R,g.heap[o],g.depth));)g.heap[q]=g.heap[o],q=o,o<<=1;g.heap[q]=R},V=(g,w,R)=>{let o,r,T,z,t=0;if(0!==g.last_lit)do{o=g.pending_buf[g.d_buf+2*t]<<8|g.pending_buf[g.d_buf+2*t+1],r=g.pending_buf[g.l_buf+t],t++,0===o?a(g,r,w):(T=y[r],a(g,T+q+1,w),z=S[T],0!==z&&(r-=L[T],N(g,r,z)),o--,T=D(o),a(g,T,R),z=i[T],0!==z&&(o-=A[T],N(g,o,z)))}while(t<g.last_lit);a(g,256,w)},s=(g,w)=>{const q=w.dyn_tree,R=w.stat_desc.static_tree,o=w.stat_desc.has_stree,S=w.stat_desc.elems;let i,T,z,t=-1;for(g.heap_len=0,g.heap_max=573,i=0;i<S;i++)0!==q[2*i]?(g.heap[++g.heap_len]=t=i,g.depth[i]=0):q[2*i+1]=0;for(;g.heap_len<2;)z=g.heap[++g.heap_len]=t<2?++t:0,q[2*z]=1,g.depth[z]=0,g.opt_len--,o&&(g.static_len-=R[2*z+1]);for(w.max_code=t,i=g.heap_len>>1;i>=1;i--)M(g,q,i);z=S;do{i=g.heap[1],g.heap[1]=g.heap[g.heap_len--],M(g,q,1),T=g.heap[1],g.heap[--g.heap_max]=i,g.heap[--g.heap_max]=T,q[2*z]=q[2*i]+q[2*T],g.depth[z]=(g.depth[i]>=g.depth[T]?g.depth[i]:g.depth[T])+1,q[2*i+1]=q[2*T+1]=z,g.heap[1]=z++,M(g,q,1)}while(g.heap_len>=2);g.heap[--g.heap_max]=g.heap[1],((g,w)=>{const q=w.dyn_tree,R=w.max_code,o=w.stat_desc.static_tree,S=w.stat_desc.has_stree,i=w.stat_desc.extra_bits,T=w.stat_desc.extra_base,z=w.stat_desc.max_length;let t,m,e,y,L,A,l=0;for(y=0;y<=r;y++)g.bl_count[y]=0;for(q[2*g.heap[g.heap_max]+1]=0,t=g.heap_max+1;t<573;t++)m=g.heap[t],y=q[2*q[2*m+1]+1]+1,y>z&&(y=z,l++),q[2*m+1]=y,m>R||(g.bl_count[y]++,L=0,m>=T&&(L=i[m-T]),A=q[2*m],g.opt_len+=A*(y+L),S&&(g.static_len+=A*(o[2*m+1]+L)));if(0!==l){do{for(y=z-1;0===g.bl_count[y];)y--;g.bl_count[y]--,g.bl_count[y+1]+=2,g.bl_count[z]--,l-=2}while(l>0);for(y=z;0!==y;y--)for(m=g.bl_count[y];0!==m;)e=g.heap[--t],e>R||(q[2*e+1]!==y&&(g.opt_len+=(y-q[2*e+1])*q[2*e],q[2*e+1]=y),m--)}})(g,w),C(q,t,g.bl_count)},h=(g,w,q)=>{let R,o,r=-1,S=w[1],i=0,T=7,z=4;for(0===S&&(T=138,z=3),w[2*(q+1)+1]=65535,R=0;R<=q;R++)o=S,S=w[2*(R+1)+1],++i<T&&o===S||(i<z?g.bl_tree[2*o]+=i:0!==o?(o!==r&&g.bl_tree[2*o]++,g.bl_tree[32]++):i<=10?g.bl_tree[34]++:g.bl_tree[36]++,i=0,r=o,0===S?(T=138,z=3):o===S?(T=6,z=3):(T=7,z=4))},v=(g,w,q)=>{let R,o,r=-1,S=w[1],i=0,T=7,z=4;for(0===S&&(T=138,z=3),R=0;R<=q;R++)if(o=S,S=w[2*(R+1)+1],!(++i<T&&o===S)){if(i<z)do{a(g,o,g.bl_tree)}while(0!==--i);else 0!==o?(o!==r&&(a(g,o,g.bl_tree),i--),a(g,16,g.bl_tree),N(g,i-3,2)):i<=10?(a(g,17,g.bl_tree),N(g,i-3,3)):(a(g,18,g.bl_tree),N(g,i-11,7));i=0,r=o,0===S?(T=138,z=3):o===S?(T=6,z=3):(T=7,z=4)}};let b=!1;const B=(g,w,q,R)=>{N(g,0+(R?1:0),3),((g,w,q,R)=>{P(g),R&&(U(g,q),U(g,~q)),g.pending_buf.set(g.window.subarray(w,w+q),g.pending),g.pending+=q})(g,w,q,!0)};g.exports._tr_init=g=>{b||((()=>{let g,w,q,z,d;const D=new Array(16);for(q=0,z=0;z<28;z++)for(L[z]=q,g=0;g<1<<S[z];g++)y[q++]=z;for(y[q-1]=z,d=0,z=0;z<16;z++)for(A[z]=d,g=0;g<1<<i[z];g++)e[d++]=z;for(d>>=7;z<o;z++)for(A[z]=d<<7,g=0;g<1<<i[z]-7;g++)e[256+d++]=z;for(w=0;w<=r;w++)D[w]=0;for(g=0;g<=143;)t[2*g+1]=8,g++,D[8]++;for(;g<=255;)t[2*g+1]=9,g++,D[9]++;for(;g<=279;)t[2*g+1]=7,g++,D[7]++;for(;g<=287;)t[2*g+1]=8,g++,D[8]++;for(C(t,287,D),g=0;g<o;g++)m[2*g+1]=5,m[2*g]=H(g,5);J=new l(t,S,257,R,r),x=new l(m,i,0,o,r),G=new l(new Array(0),T,0,19,7)})(),b=!0),g.l_desc=new d(g.dyn_ltree,J),g.d_desc=new d(g.dyn_dtree,x),g.bl_desc=new d(g.bl_tree,G),g.bi_buf=0,g.bi_valid=0,c(g)},g.exports._tr_stored_block=B,g.exports._tr_flush_block=(g,w,R,o)=>{let r,S,i=0;g.level>0?(2===g.strm.data_type&&(g.strm.data_type=(g=>{let w,R=4093624447;for(w=0;w<=31;w++,R>>>=1)if(1&R&&0!==g.dyn_ltree[2*w])return 0;if(0!==g.dyn_ltree[18]||0!==g.dyn_ltree[20]||0!==g.dyn_ltree[26])return 1;for(w=32;w<q;w++)if(0!==g.dyn_ltree[2*w])return 1;return 0})(g)),s(g,g.l_desc),s(g,g.d_desc),i=(g=>{let w;for(h(g,g.dyn_ltree,g.l_desc.max_code),h(g,g.dyn_dtree,g.d_desc.max_code),s(g,g.bl_desc),w=18;w>=3&&0===g.bl_tree[2*z[w]+1];w--);return g.opt_len+=3*(w+1)+5+5+4,w})(g),r=g.opt_len+3+7>>>3,S=g.static_len+3+7>>>3,S<=r&&(r=S)):r=S=R+5,R+4<=r&&-1!==w?B(g,w,R,o):4===g.strategy||S===r?(N(g,2+(o?1:0),3),V(g,t,m)):(N(g,4+(o?1:0),3),((g,w,q,R)=>{let o;for(N(g,w-257,5),N(g,q-1,5),N(g,R-4,4),o=0;o<R;o++)N(g,g.bl_tree[2*z[o]+1],3);v(g,g.dyn_ltree,w-1),v(g,g.dyn_dtree,q-1)})(g,g.l_desc.max_code+1,g.d_desc.max_code+1,i+1),V(g,g.dyn_ltree,g.dyn_dtree)),c(g),o&&P(g)},g.exports._tr_tally=(g,w,R)=>(g.pending_buf[g.d_buf+2*g.last_lit]=w>>>8&255,g.pending_buf[g.d_buf+2*g.last_lit+1]=255&w,g.pending_buf[g.l_buf+g.last_lit]=255&R,g.last_lit++,0===w?g.dyn_ltree[2*R]++:(g.matches++,w--,g.dyn_ltree[2*(y[R]+q+1)]++,g.dyn_dtree[2*D(w)]++),g.last_lit===g.lit_bufsize-1),g.exports._tr_align=g=>{N(g,2,3),a(g,256,t),(g=>{16===g.bi_valid?(U(g,g.bi_buf),g.bi_buf=0,g.bi_valid=0):g.bi_valid>=8&&(g.pending_buf[g.pending++]=255&g.bi_buf,g.bi_buf>>=8,g.bi_valid-=8)})(g)}},12279:g=>{"use strict";g.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.iw="",this.state=null,this.data_type=2,this.adler=0}},11912:g=>{function w(g,w,q){for(var R=g.length,o=-1/0,r=1/0,S=0;S<R;S++){var i=(q[0][S]-g[S])/w[S],T=(q[1][S]-g[S])/w[S];if(i>T){var z=i;i=T,T=z}if(T<o||i>r)return 1/0;i>o&&(o=i),T<r&&(r=T)}return o>r?1/0:o}g.exports=function(g,q,R,o){var r=w(q,R,o);if(r===1/0)g=null;else{g=g||[];for(var S=0;S<q.length;S++)g[S]=q[S]+R[S]*r}return g},g.exports.distance=w},13282:(g,w,q)=>{"use strict";q.d(w,{b:()=>S});var R=q(37);const o=R.useLayoutEffect;const r=function(g){var w=(0,R.useRef)(g);return o((function(){w.current=g})),w};var S=function(g){var w=r(g);(0,R.ow)((function(){var g=function(g){var q;if(null!=w.current&&(q=w.current(g)),g.defaultPrevented&&(g.returnValue=""),"string"===typeof q)return g.returnValue=q,q};return window.addEventListener("beforeunload",g),function(){window.removeEventListener("beforeunload",g)}}),[])}},13244:(g,w,q)=>{"use strict";var R=q(13246),o=Array.prototype.concat,r=Array.prototype.slice,S=g.exports=function(g){for(var w=[],q=0,S=g.length;q<S;q++){var i=g[q];R(i)?w=o.call(w,r.call(i)):w.push(i)}return w};S.wrap=function(g){return function(){return g(S(arguments))}}},13246:g=>{g.exports=function(g){return!(!g||"string"===typeof g)&&(g instanceof Array||Array.isArray(g)||g.length>=0&&(g.splice instanceof Function||Object.getOwnPropertyDescriptor(g,g.length-1)&&"String"!==g.constructor.name))}},12191:(g,w,q)=>{var R=q(12199);function o(g){for(var w,q,o=0,r=g.length,S=0;S<g.length;){for(w=g[S],q=0;S<r&&g[S]===w;)++S,++q;o+=R.log2(q)/7|0,o+=R.log2(w>>>0)/7|0,o+=2}return o}w.size=o,w.encode=function(g,w){w||(w=new Uint8Array(o(g)));for(var q,R,r=0,S=w.length,i=0;i<g.length;){for(q=g[i],R=0;i<g.length&&g[i]===q;)++i,++R;for(;r<S&&R>=128;)w[r++]=128+(127&R),R>>>=7;if(r>=S)throw new Error("RLE buffer overflow");for(w[r++]=R,q>>>=0;r<S&&q>=128;)w[r++]=128+(127&q),q>>>=7;if(r>=S)throw new Error("RLE buffer overflow");w[r++]=q}return w},w.decode=function(g,w){for(var q,R,o,r,S=w.length,i=g.length,T=0,z=0;z<i;){for(q=0,R=0;z<i&&g[z]>=128;)q+=(127&g[z++])<<R,R+=7;if(q+=g[z++]<<R,z>=i)throw new Error("RLE buffer underrun");if(T+q>S)throw new Error("Chunk buffer overflow");for(o=0,R=0;z<i&&g[z]>=128;)o+=(127&g[z++])<<R,R+=7;if(z>=i)throw new Error("RLE buffer underrun");for(o+=g[z++]<<R,r=0;r<q;++r)w[T++]=o}return w}},12199:(g,w)=>{"use strict";function q(g){var w=32;return(g&=-g)&&w--,65535&g&&(w-=16),16711935&g&&(w-=8),252645135&g&&(w-=4),858993459&g&&(w-=2),1431655765&g&&(w-=1),w}w.INT_BITS=32,w.INT_MAX=2147483647,w.INT_MIN=-1<<31,w.sign=function(g){return(g>0)-(g<0)},w.abs=function(g){var w=g>>31;return(g^w)-w},w.min=function(g,w){return w^(g^w)&-(g<w)},w.max=function(g,w){return g^(g^w)&-(g<w)},w.isPow2=function(g){return!(g&g-1)&&!!g},w.log2=function(g){var w,q;return w=(g>65535)<<4,w|=q=((g>>>=w)>255)<<3,w|=q=((g>>>=q)>15)<<2,(w|=q=((g>>>=q)>3)<<1)|(g>>>=q)>>1},w.log10=function(g){return g>=1e9?9:g>=1e8?8:g>=1e7?7:g>=1e6?6:g>=1e5?5:g>=1e4?4:g>=1e3?3:g>=100?2:g>=10?1:0},w.popCount=function(g){return 16843009*((g=(858993459&(g-=g>>>1&1431655765))+(g>>>2&858993459))+(g>>>4)&252645135)>>>24},w.countTrailingZeros=q,w.nextPow2=function(g){return g+=0===g,--g,g|=g>>>1,g|=g>>>2,g|=g>>>4,g|=g>>>8,(g|=g>>>16)+1},w.prevPow2=function(g){return g|=g>>>1,g|=g>>>2,g|=g>>>4,g|=g>>>8,(g|=g>>>16)-(g>>>1)},w.parity=function(g){return g^=g>>>16,g^=g>>>8,g^=g>>>4,27030>>>(g&=15)&1};var R=new Array(256);!function(g){for(var w=0;w<256;++w){var q=w,R=w,o=7;for(q>>>=1;q;q>>>=1)R<<=1,R|=1&q,--o;g[w]=R<<o&255}}(R),w.reverse=function(g){return R[255&g]<<24|R[g>>>8&255]<<16|R[g>>>16&255]<<8|R[g>>>24&255]},w.interleave2=function(g,w){return(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g&=65535)|g<<8))|g<<4))|g<<2))|g<<1))|(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w&=65535)|w<<8))|w<<4))|w<<2))|w<<1))<<1},w.deinterleave2=function(g,w){return(g=65535&((g=16711935&((g=252645135&((g=858993459&((g=g>>>w&1431655765)|g>>>1))|g>>>2))|g>>>4))|g>>>16))<<16>>16},w.interleave3=function(g,w,q){return g=1227133513&((g=3272356035&((g=251719695&((g=4278190335&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2),(g|=(w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2))<<1)|(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<2},w.deinterleave3=function(g,w){return(g=1023&((g=4278190335&((g=251719695&((g=3272356035&((g=g>>>w&1227133513)|g>>>2))|g>>>4))|g>>>8))|g>>>16))<<22>>22},w.nextCombination=function(g){var w=g|g-1;return w+1|(~w&-~w)-1>>>q(g)+1}},12221:g=>{"use strict";g.exports=function(g,w,q,R){var o=self||window;try{try{var r;try{r=new o.Blob([g])}catch(z){(r=new(o.BlobBuilder||o.WebKitBlobBuilder||o.MozBlobBuilder||o.MSBlobBuilder)).append(g),r=r.getBlob()}var S=o.URL||o.webkitURL,i=S.createObjectURL(r),T=new o[w](i,q);return S.revokeObjectURL(i),T}catch(z){return new o[w]("data:application/javascript,".concat(encodeURIComponent(g)),q)}}catch(z){if(!R)throw Error("Inline worker is not supported");return new o[w](R,q)}}},11897:(g,w,q)=>{"use strict";function R(g,w,q,R,o){var r={};return Object.keys(R).forEach((function(g){r[g]=R[g]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=q.slice().reverse().reduce((function(q,R){return R(g,w,q)||q}),r),o&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(o):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(g,w,r),r=null),r}q.d(w,{b:()=>R})},11894:(g,w,q)=>{"use strict";function R(g,w,q,R){q&&Object.defineProperty(g,w,{enumerable:q.enumerable,configurable:q.configurable,writable:q.writable,value:q.initializer?q.initializer.call(R):void 0})}q.d(w,{e:()=>R})},13271:(g,w,q)=>{"use strict";q.d(w,{b:()=>S,f:()=>m,j:()=>i,k:()=>r,n:()=>T,o:()=>o,s:()=>z,t:()=>t});var R=q(11369);class o{constructor(){this._easingMode=o.EASINGMODE_EASEIN}setEasingMode(g){const w=Math.min(Math.max(g,0),2);this._easingMode=w}getEasingMode(){return this._easingMode}easeInCore(g){throw new Error("You must implement this method")}ease(g){switch(this._easingMode){case o.EASINGMODE_EASEIN:return this.easeInCore(g);case o.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-g)}return g>=.5?.5*(1-this.easeInCore(2*(1-g)))+.5:.5*this.easeInCore(2*g)}}o.EASINGMODE_EASEIN=0,o.EASINGMODE_EASEOUT=1,o.EASINGMODE_EASEINOUT=2;class r extends o{easeInCore(g){return g=Math.max(0,Math.min(1,g)),1-Math.sqrt(1-g*g)}}class S extends o{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=g}easeInCore(g){const w=Math.max(0,this.amplitude);return Math.pow(g,3)-g*w*Math.sin(3.141592653589793*g)}}class i extends o{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=g,this.bounciness=w}easeInCore(g){const w=Math.max(0,this.bounces);let q=this.bounciness;q<=1&&(q=1.001);const R=Math.pow(q,w),o=1-q,r=(1-R)/o+.5*R,S=g*r,i=Math.log(-S*(1-q)+1)/Math.log(q),T=Math.floor(i),z=T+1,t=(1-Math.pow(q,T))/(o*r),m=.5*(t+(1-Math.pow(q,z))/(o*r)),e=g-m,y=m-t;return-Math.pow(1/q,w-T)/(y*y)*(e-y)*(e+y)}}class T extends o{easeInCore(g){return g*g*g}}class z extends o{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=g,this.springiness=w}easeInCore(g){let w;const q=Math.max(0,this.oscillations),R=Math.max(0,this.springiness);return w=0==R?g:(Math.exp(R*g)-1)/(Math.exp(R)-1),w*Math.sin((6.283185307179586*q+1.5707963267948966)*g)}}class t extends o{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=g}easeInCore(g){return this.exponent<=0?g:(Math.exp(this.exponent*g)-1)/(Math.exp(this.exponent)-1)}}class m extends o{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=g,this.y1=w,this.x2=q,this.y2=R}easeInCore(g){return R.d.Interpolate(g,this.x1,this.y1,this.x2,this.y2)}}},12757:(g,w,q)=>{"use strict";q.d(w,{e:()=>S});var R=q(11180),o=q(11192),r=q(11559);class S extends r.b{get _matrix(){return this._compose(),this.ae}set _matrix(g){(g.updateFlag!==this.ae.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.ae.T(g),this._markAsDirtyAndDecompose())}constructor(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(g,w.Ng(),!1),this.name=g,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=w,this.ae=(null===o||void 0===o?void 0:o.clone())??R.Matrix.Identity(),this._restMatrix=r??this.ae.clone(),this._bindMatrix=S??this.ae.clone(),this._index=i,this._absoluteMatrix=new R.Matrix,this._absoluteBindMatrix=new R.Matrix,this._absoluteInverseBindMatrix=new R.Matrix,this._finalMatrix=new R.Matrix,w.bones.push(this),this.setParent(q,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(g){this.setParent(g)}setParent(g){let w=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==g){if(this.parent){const g=this.parent.children.indexOf(this);-1!==g&&this.parent.children.splice(g,1)}this._parentNode=g,this.parent&&this.parent.children.push(this),w&&this._updateAbsoluteBindMatrices(),this.jz()}}getLocalMatrix(){return this._compose(),this.ae}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(g){this._restMatrix.T(g)}setRestPose(g){this.setRestMatrix(g)}getBindPose(){return this.getBindMatrix()}setBindMatrix(g){this.Si(g)}setBindPose(g){this.setBindMatrix(g)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const g=R.TmpVectors.ew[0],w=R.TmpVectors.Quaternion[0],q=R.TmpVectors.ew[1];this.getRestMatrix().decompose(g,w,q),this._linkedTransformNode.position.T(q),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??R.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.T(w),this._linkedTransformNode.ei.T(g)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(g){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=g,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Fi}set position(g){this._decompose(),this.Fi.T(g),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(g){this.setRotation(g)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(g){this.setRotationQuaternion(g)}get ei(){return this.getScale()}set ei(g){this.setScale(g)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=R.ew.Zero(),this._localRotation=R.Quaternion.Zero(),this.Fi=R.ew.Zero()),this.ae.decompose(this._localScaling,this._localRotation,this.Fi))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,R.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Fi,this.ae)):this._needToCompose=!1)}Si(g){let w=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.T(g),w&&this._updateAbsoluteBindMatrices(),q?this._matrix=g:this.jz()}_updateAbsoluteBindMatrices(g){let w=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(g||(g=this._bindMatrix),this.parent?g.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.T(g),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),w)for(let q=0;q<this.children.length;q++)this.children[q]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}jz(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.jz(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.jz(),this._needToDecompose=!0}_updatePosition(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=this.getLocalMatrix();if(0==w)o?(r.addAtIndex(12,g.x),r.addAtIndex(13,g.y),r.addAtIndex(14,g.z)):r.setTranslationFromFloats(g.x,g.y,g.z);else{let w=null;q&&(w=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const i=S._TmpMats[0],T=S._TmpVecs[0];this.parent?q&&w?(i.T(this.parent.getAbsoluteMatrix()),i.multiplyToRef(w,i)):i.T(this.parent.getAbsoluteMatrix()):R.Matrix.IdentityToRef(i),o&&i.setTranslationFromFloats(0,0,0),i.invert(),R.ew.TransformCoordinatesToRef(g,i,T),o?(r.addAtIndex(12,T.x),r.addAtIndex(13,T.y),r.addAtIndex(14,T.z)):r.setTranslationFromFloats(T.x,T.y,T.z)}this._markAsDirtyAndDecompose()}translate(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;this._updatePosition(g,w,q,!0)}setPosition(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;this._updatePosition(g,w,q,!1)}setAbsolutePosition(g,w){this.setPosition(g,1,w)}scale(g,w,q){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=this.getLocalMatrix(),i=S._TmpMats[0];R.Matrix.ScalingToRef(g,w,q,i),i.multiplyToRef(r,r),i.invert();for(const R of this.children){const o=R.getLocalMatrix();o.multiplyToRef(i,o),o.multiplyAtIndex(12,g),o.multiplyAtIndex(13,w),o.multiplyAtIndex(14,q),R._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),o)for(const R of this.children)R.scale(g,w,q,o)}setScale(g){this._decompose(),this._localScaling.T(g),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(g){this._decompose(),g.T(this._localScaling)}setYawPitchRoll(g,w,q){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;if(0===o){const i=S._TmpQuat;return R.Quaternion.RotationYawPitchRollToRef(g,w,q,i),void this.setRotationQuaternion(i,o,r)}const i=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,r))return;const T=S._TmpMats[1];R.Matrix.RotationYawPitchRollToRef(g,w,q,T),i.multiplyToRef(T,T),this._rotateWithMatrix(T,o,r)}rotate(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;const r=S._TmpMats[0];r.setTranslationFromFloats(0,0,0),R.Matrix.RotationAxisToRef(g,w,r),this._rotateWithMatrix(r,q,o)}setAxisAngle(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;if(0===q){const r=S._TmpQuat;return R.Quaternion.RotationAxisToRef(g,w,r),void this.setRotationQuaternion(r,q,o)}const r=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,o))return;const i=S._TmpMats[1];R.Matrix.RotationAxisToRef(g,w,i),r.multiplyToRef(i,i),this._rotateWithMatrix(i,q,o)}setRotation(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(g.y,g.x,g.z,w,q)}setRotationQuaternion(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;if(0===w)return this._decompose(),this._localRotation.T(g),void this._markAsDirtyAndCompose();const o=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,q))return;const r=S._TmpMats[1];R.Matrix.FromQuaternionToRef(g,r),o.multiplyToRef(r,r),this._rotateWithMatrix(r,w,q)}setRotationMatrix(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;if(0===w){const o=S._TmpQuat;return R.Quaternion.FromRotationMatrixToRef(g,o),void this.setRotationQuaternion(o,w,q)}const o=S._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,q))return;const r=S._TmpMats[1];r.T(g),o.multiplyToRef(g,r),this._rotateWithMatrix(r,w,q)}_rotateWithMatrix(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;const R=this.getLocalMatrix(),o=R.m[12],r=R.m[13],i=R.m[14],T=this.getParent(),z=S._TmpMats[3],t=S._TmpMats[4];T&&1==w?(q?(z.T(q.getWorldMatrix()),T.getAbsoluteMatrix().multiplyToRef(z,z)):z.T(T.getAbsoluteMatrix()),t.T(z),t.invert(),R.multiplyToRef(z,R),R.multiplyToRef(g,R),R.multiplyToRef(t,R)):1==w&&q?(z.T(q.getWorldMatrix()),t.T(z),t.invert(),R.multiplyToRef(z,R),R.multiplyToRef(g,R),R.multiplyToRef(t,R)):R.multiplyToRef(g,R),R.setTranslationFromFloats(o,r,i),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(g,w){const q=S._TmpMats[2];return g.T(this.getAbsoluteMatrix()),w?(g.multiplyToRef(w.getWorldMatrix(),g),R.Matrix.ScalingToRef(w.ei.x,w.ei.y,w.ei.z,q)):R.Matrix.IdentityToRef(q),g.invert(),!isNaN(g.m[0])&&(q.multiplyAtIndex(0,this._scalingDeterminant),g.multiplyToRef(q,g),!0)}hr(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=R.ew.Zero();return this.getPositionToRef(g,w,q),q}getPositionToRef(){let g=arguments.length>1?arguments[1]:void 0,w=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const g=this.getLocalMatrix();w.x=g.m[12],w.y=g.m[13],w.z=g.m[14]}else{let q=null;g&&(q=g.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let R=S._TmpMats[0];g&&q?(R.T(this.getAbsoluteMatrix()),R.multiplyToRef(q,R)):R=this.getAbsoluteMatrix(),w.x=R.m[12],w.y=R.m[13],w.z=R.m[14]}}getAbsolutePosition(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const w=R.ew.Zero();return this.getPositionToRef(1,g,w),w}getAbsolutePositionToRef(g,w){this.getPositionToRef(1,g,w)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.ae.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.T(this.ae);const g=this._skeleton.getPoseMatrix();g&&this._absoluteMatrix.multiplyToRef(g,this._absoluteMatrix)}const g=this.children,w=g.length;for(let q=0;q<w;q++)g[q].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}dT(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=R.ew.Zero();return this.getDirectionToRef(g,w,q),q}getDirectionToRef(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0,o=null;w&&(o=w.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const r=S._TmpMats[0];r.T(this.getAbsoluteMatrix()),w&&o&&r.multiplyToRef(o,r),R.ew.TransformNormalToRef(g,r,q),q.normalize()}getRotation(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=R.ew.Zero();return this.getRotationToRef(g,w,q),q}getRotationToRef(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0;const R=S._TmpQuat;this.getRotationQuaternionToRef(g,w,R),R.toEulerAnglesToRef(q)}getRotationQuaternion(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=R.Quaternion.Identity();return this.getRotationQuaternionToRef(g,w,q),q}getRotationQuaternionToRef(){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),w.T(this._localRotation);else{const q=S._TmpMats[0],R=this.getAbsoluteMatrix();g?R.multiplyToRef(g.getWorldMatrix(),q):q.T(R),q.multiplyAtIndex(0,this._scalingDeterminant),q.multiplyAtIndex(1,this._scalingDeterminant),q.multiplyAtIndex(2,this._scalingDeterminant),q.decompose(void 0,w,void 0)}}getRotationMatrix(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,w=arguments.length>1?arguments[1]:void 0;const q=R.Matrix.Identity();return this.getRotationMatrixToRef(g,w,q),q}getRotationMatrixToRef(){let g=arguments.length>1?arguments[1]:void 0,w=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(w);else{const q=S._TmpMats[0],R=this.getAbsoluteMatrix();g?R.multiplyToRef(g.getWorldMatrix(),q):q.T(R),q.multiplyAtIndex(0,this._scalingDeterminant),q.multiplyAtIndex(1,this._scalingDeterminant),q.multiplyAtIndex(2,this._scalingDeterminant),q.getRotationMatrixToRef(w)}}getAbsolutePositionFromLocal(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=R.ew.Zero();return this.getAbsolutePositionFromLocalToRef(g,w,q),q}getAbsolutePositionFromLocalToRef(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0,o=null;w&&(o=w.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const r=S._TmpMats[0];r.T(this.getAbsoluteMatrix()),w&&o&&r.multiplyToRef(o,r),R.ew.TransformCoordinatesToRef(g,r,q)}getLocalPositionFromAbsolute(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=R.ew.Zero();return this.getLocalPositionFromAbsoluteToRef(g,w,q),q}getLocalPositionFromAbsoluteToRef(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0,o=null;w&&(o=w.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const r=S._TmpMats[0];r.T(this.getAbsoluteMatrix()),w&&o&&r.multiplyToRef(o,r),r.invert(),R.ew.TransformCoordinatesToRef(g,r,q)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const g=this._skeleton.bones.indexOf(this);if(-1!==g&&this._skeleton.bones.splice(g,1),this._parentNode&&this._parentNode.children){const g=this._parentNode.children,w=g.indexOf(this);-1!==w&&g.splice(w,1)}super.dispose()}}S._TmpVecs=(0,o.e)(2,R.ew.Zero),S._TmpQuat=R.Quaternion.Identity(),S._TmpMats=(0,o.e)(5,R.Matrix.Identity)},13269:(g,w,q)=>{"use strict";q.d(w,{d:()=>s});var R=q(11161),o=q(11170),r=q(10998),S=q(11180),i=q(11195),T=q(11559),z=q(11586),t=q(11424),m=q(11023),e=q(11188);class y{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(g){this._zoomStopsAnimation=g}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(g){this._idleRotationSpeed=g}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(g){this._idleRotationWaitTime=g}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(g){this._idleRotationSpinupTime=g}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(g){this._attachedCamera=g;const w=this._attachedCamera.Ng();this._onPrePointerObservableObserver=w.onPrePointerObservable.add((g=>{g.type!==t.e.POINTERDOWN?g.type===t.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=g.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const g=m.e.Now;let w=0;null!=this._lastFrameTime&&(w=g-this._lastFrameTime),this._lastFrameTime=g,this._applyUserInteraction();const q=g-this._lastInteractionTime-this._idleRotationWaitTime,R=Math.max(Math.min(q/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*R,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(w/1e3))}))}detach(){if(!this._attachedCamera)return;const g=this._attachedCamera.Ng();this._onPrePointerObservableObserver&&g.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(g){this._lastInteractionTime=g??m.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<e.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let g=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(g=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?g:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=m.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var L=q(13271),A=q(11659);class l{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(g){if(this._autoTransitionRange===g)return;this._autoTransitionRange=g;const w=this._attachedCamera;w&&(g?this._onMeshTargetChangedObserver=w.onMeshTargetChangedObservable.add((g=>{if(g&&(g.ii(!0),g.getBoundingInfo)){const w=g.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*w,this.upperRadiusTransitionRange=.05*w}})):this._onMeshTargetChangedObserver&&w.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(g){this._attachedCamera=g,this._onAfterCheckInputsObserver=g.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(g){return!!this._attachedCamera&&(this._attachedCamera.radius===g&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(g){if(!this._attachedCamera)return;this._radiusBounceTransition||(l.EasingFunction.setEasingMode(l.EasingMode),this._radiusBounceTransition=A.c.CreateAnimation("radius",A.c.ANIMATIONTYPE_FLOAT,60,l.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const w=A.c.TransitionTo("radius",this._attachedCamera.radius+g,this._attachedCamera,this._attachedCamera.Ng(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));w&&this._animatables.push(w)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}l.EasingFunction=new L.b(.3),l.EasingMode=L.o.EASINGMODE_EASEOUT;class J{constructor(){this.onTargetFramingAnimationEndObservable=new r.b,this._mode=J.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(g){this._mode=g}get mode(){return this._mode}set radiusScale(g){this._radiusScale=g}get radiusScale(){return this._radiusScale}set positionScale(g){this._positionScale=g}get positionScale(){return this._positionScale}set defaultElevation(g){this._defaultElevation=g}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(g){this._elevationReturnTime=g}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(g){this._elevationReturnWaitTime=g}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(g){this._zoomStopsAnimation=g}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(g){this._framingTime=g}get framingTime(){return this._framingTime}init(){}attach(g){this._attachedCamera=g;const w=this._attachedCamera.Ng();J.EasingFunction.setEasingMode(J.EasingMode),this._onPrePointerObservableObserver=w.onPrePointerObservable.add((g=>{g.type!==t.e.POINTERDOWN?g.type===t.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=g.onMeshTargetChangedObservable.add((g=>{g&&g.getBoundingInfo&&this.zoomOnMesh(g,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=g.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const g=this._attachedCamera.Ng();this._onPrePointerObservableObserver&&g.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(g){let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;g.ii(!0);const R=g.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(R.minimumWorld,R.maximumWorld,w,q)}zoomOnMeshHierarchy(g){let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;g.ii(!0);const R=g.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(R.min,R.max,w,q)}zoomOnMeshesHierarchy(g){let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new S.ew(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new S.ew(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let r=0;r<g.length;r++){const w=g[r].getHierarchyBoundingVectors(!0);S.ew.CheckExtends(w.min,R,o),S.ew.CheckExtends(w.max,R,o)}this.zoomOnBoundingInfo(R,o,w,q)}zoomOnBoundingInfo(g,w){let q,R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const r=g.y,i=r+(w.y-r)*this._positionScale,T=w.yw(g).scale(.5);if(!isFinite(i))return!1;if(R)q=new S.ew(0,i,0);else{const w=g.add(T);q=new S.ew(w.x,i,w.z)}this._vectorTransition||(this._vectorTransition=A.c.CreateAnimation("target",A.c.ANIMATIONTYPE_VECTOR3,60,J.EasingFunction)),this._betaIsAnimating=!0;let z=A.c.TransitionTo("target",q,this._attachedCamera,this._attachedCamera.Ng(),60,this._vectorTransition,this._framingTime);z&&this._animatables.push(z);let t=0;if(this._mode===J.FitFrustumSidesMode){const q=this._calculateLowerRadiusFromModelBoundingSphere(g,w);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=T.length()+this._attachedCamera.ri),t=q}else this._mode===J.IgnoreBoundsSizeMode&&(t=this._calculateLowerRadiusFromModelBoundingSphere(g,w),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ri));if(this.autoCorrectCameraLimitsAndSensibility){const q=w.yw(g).length();this._attachedCamera.panningSensibility=5e3/q,this._attachedCamera.wheelPrecision=100/t}return this._radiusTransition||(this._radiusTransition=A.c.CreateAnimation("radius",A.c.ANIMATIONTYPE_FLOAT,60,J.EasingFunction)),z=A.c.TransitionTo("radius",t,this._attachedCamera,this._attachedCamera.Ng(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),o&&o(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),z&&this._animatables.push(z),!0}_calculateLowerRadiusFromModelBoundingSphere(g,w){const q=this._attachedCamera;if(!q)return 0;let R=q._calculateLowerRadiusFromModelBoundingSphere(g,w,this._radiusScale);return q.lowerRadiusLimit&&this._mode===J.IgnoreBoundsSizeMode&&(R=R<q.lowerRadiusLimit?q.lowerRadiusLimit:R),q.upperRadiusLimit&&(R=R>q.upperRadiusLimit?q.upperRadiusLimit:R),R}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const g=m.e.Now-this._lastInteractionTime,w=.5*Math.PI-this._defaultElevation,q=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>q&&g>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=A.c.CreateAnimation("beta",A.c.ANIMATIONTYPE_FLOAT,60,J.EasingFunction));const g=A.c.TransitionTo("beta",w,this._attachedCamera,this._attachedCamera.Ng(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));g&&this._animatables.push(g)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=m.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}J.EasingFunction=new L.t,J.EasingMode=L.o.EASINGMODE_EASEINOUT,J.IgnoreBoundsSizeMode=0,J.FitFrustumSidesMode=1;var x=q(11593),G=q(11620),d=q(12752),D=q(10991);class U{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(g){g=D.Tools.BackCompatCameraNoPreventDefault(arguments);const w=this.camera.getEngine(),q=w.getInputElement();let R=0,o=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=r=>{var S,i;const T=r.event,z="touch"===T.pointerType;if(r.type!==t.e.POINTERMOVE&&-1===this.buttons.indexOf(T.button))return;const m=T.target;if(this._altKey=T.altKey,this._ctrlKey=T.ctrlKey,this._metaKey=T.metaKey,this._shiftKey=T.shiftKey,this._buttonsPressed=T.buttons,w.isPointerLock){const g=T.movementX,w=T.movementY;this.onTouch(null,g,w),this._pointA=null,this._pointB=null}else{if(r.type!==t.e.POINTERDOWN&&r.type!==t.e.POINTERDOUBLETAP&&z&&(null===(S=this._pointA)||void 0===S?void 0:S.pointerId)!==T.pointerId&&(null===(i=this._pointB)||void 0===i?void 0:i.pointerId)!==T.pointerId)return;if(r.type!==t.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!z)if(r.type===t.e.POINTERDOUBLETAP)this.onDoubleTap(T.pointerType);else if(r.type!==t.e.POINTERUP||this._currentMousePointerIdDown!==T.pointerId&&!z){if(r.type===t.e.POINTERMOVE)if(g||T.preventDefault(),this._pointA&&null===this._pointB){const g=T.clientX-this._pointA.x,w=T.clientY-this._pointA.y;this._pointA.x=T.clientX,this._pointA.y=T.clientY,this.onTouch(this._pointA,g,w)}else if(this._pointA&&this._pointB){const g=this._pointA.pointerId===T.pointerId?this._pointA:this._pointB;g.x=T.clientX,g.y=T.clientY;const w=this._pointA.x-this._pointB.x,q=this._pointA.y-this._pointB.y,S=w*w+q*q,i={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:T.pointerId,type:r.type};this.onMultiTouch(this._pointA,this._pointB,R,S,o,i),o=i,R=S}}else{try{null===m||void 0===m||m.releasePointerCapture(T.pointerId)}catch(e){}z||(this._pointB=null),w._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==T.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==T.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==R||o)&&(this.onMultiTouch(this._pointA,this._pointB,R,0,o,null),R=0,o=null),this._currentMousePointerIdDown=-1,this.onButtonUp(T),g||T.preventDefault()}else{try{null===m||void 0===m||m.setPointerCapture(T.pointerId)}catch(e){}if(null===this._pointA)this._pointA={x:T.clientX,y:T.clientY,pointerId:T.pointerId,type:T.pointerType};else{if(null!==this._pointB)return;this._pointB={x:T.clientX,y:T.clientY,pointerId:T.pointerId,type:T.pointerType}}-1!==this._currentMousePointerIdDown||z||(this._currentMousePointerIdDown=T.pointerId),this.onButtonDown(T),g||(T.preventDefault(),q&&q.focus())}}},this._observer=this.camera.Ng()._inputManager._addCameraPointerObserver(this._pointerInput,t.e.POINTERDOWN|t.e.POINTERUP|t.e.POINTERMOVE|t.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,R=0,o=null,this.onLostFocus()},this._contextMenuBind=g=>this.onContextMenu(g),q&&q.addEventListener("contextmenu",this._contextMenuBind,!1);const r=this.camera.Ng().getEngine().getHostWindow();r&&D.Tools.RegisterTopRootEvents(r,[{name:"blur",handler:this._onLostFocus}])}Nm(){if(this._onLostFocus){const g=this.camera.Ng().getEngine().getHostWindow();g&&D.Tools.UnregisterTopRootEvents(g,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Ng()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const g=this.camera.Ng().getEngine().getInputElement();g&&g.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(g){}onTouch(g,w,q){}onMultiTouch(g,w,q,R,o,r){}onContextMenu(g){g.preventDefault()}onButtonDown(g){}onButtonUp(g){}onLostFocus(){}}(0,R.e)([(0,o.K)()],U.prototype,"buttons",void 0);class N extends U{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(g,w){if(0!==this.panningSensibility&&g&&w){const q=w.x-g.x,R=w.y-g.y;this.camera.inertialPanningX+=-q/this.panningSensibility,this.camera.inertialPanningY+=R/this.panningSensibility}}_computePinchZoom(g,w){const q=this.camera.radius||N.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=q*Math.sqrt(g)/Math.sqrt(w):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(w-g)*q*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(w-g)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(g,w,q){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-w/this.panningSensibility,this.camera.inertialPanningY+=q/this.panningSensibility):(this.camera.inertialAlphaOffset-=w/this.angularSensibilityX,this.camera.inertialBetaOffset-=q/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(g,w,q,R,o,r){0===q&&null===o||0===R&&null===r||(this.multiTouchPanAndZoom?(this._computePinchZoom(q,R),this._computeMultiTouchPanning(o,r)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(R)-Math.sqrt(q))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(q,R),this._isPinching=!0):this._computeMultiTouchPanning(o,r)):this.multiTouchPanning?this._computeMultiTouchPanning(o,r):this.pinchZoom&&this._computePinchZoom(q,R))}onButtonDown(g){this._isPanClick=g.button===this.camera._panningMouseButton}onButtonUp(g){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}N.MinimumRadiusForPinch=.001,(0,R.e)([(0,o.K)()],N.prototype,"buttons",void 0),(0,R.e)([(0,o.K)()],N.prototype,"angularSensibilityX",void 0),(0,R.e)([(0,o.K)()],N.prototype,"angularSensibilityY",void 0),(0,R.e)([(0,o.K)()],N.prototype,"pinchPrecision",void 0),(0,R.e)([(0,o.K)()],N.prototype,"pinchDeltaPercentage",void 0),(0,R.e)([(0,o.K)()],N.prototype,"useNaturalPinchZoom",void 0),(0,R.e)([(0,o.K)()],N.prototype,"pinchZoom",void 0),(0,R.e)([(0,o.K)()],N.prototype,"panningSensibility",void 0),(0,R.e)([(0,o.K)()],N.prototype,"multiTouchPanning",void 0),(0,R.e)([(0,o.K)()],N.prototype,"multiTouchPanAndZoom",void 0),d.e.ArcRotateCameraPointersInput=N;var a=q(11430);class H{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(g){g=D.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ng(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((w=>{const q=w.event;if(!q.metaKey)if(w.type===a.b.KEYDOWN){if(this._ctrlPressed=q.ctrlKey,this._altPressed=q.altKey,-1!==this.keysUp.indexOf(q.keyCode)||-1!==this.keysDown.indexOf(q.keyCode)||-1!==this.keysLeft.indexOf(q.keyCode)||-1!==this.keysRight.indexOf(q.keyCode)||-1!==this.keysReset.indexOf(q.keyCode)){-1===this._keys.indexOf(q.keyCode)&&this._keys.push(q.keyCode),q.preventDefault&&(g||q.preventDefault())}}else if(-1!==this.keysUp.indexOf(q.keyCode)||-1!==this.keysDown.indexOf(q.keyCode)||-1!==this.keysLeft.indexOf(q.keyCode)||-1!==this.keysRight.indexOf(q.keyCode)||-1!==this.keysReset.indexOf(q.keyCode)){const w=this._keys.indexOf(q.keyCode);w>=0&&this._keys.splice(w,1),q.preventDefault&&(g||q.preventDefault())}})))}Nm(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const g=this.camera;for(let w=0;w<this._keys.length;w++){const q=this._keys[w];-1!==this.keysLeft.indexOf(q)?this._ctrlPressed&&this.camera._useCtrlForPanning?g.inertialPanningX-=1/this.panningSensibility:g.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(q)?this._ctrlPressed&&this.camera._useCtrlForPanning?g.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?g.inertialRadiusOffset+=1/this.zoomingSensibility:g.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(q)?this._ctrlPressed&&this.camera._useCtrlForPanning?g.inertialPanningX+=1/this.panningSensibility:g.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(q)?this._ctrlPressed&&this.camera._useCtrlForPanning?g.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?g.inertialRadiusOffset-=1/this.zoomingSensibility:g.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(q)&&g.useInputToRestoreState&&g.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,R.e)([(0,o.K)()],H.prototype,"keysUp",void 0),(0,R.e)([(0,o.K)()],H.prototype,"keysDown",void 0),(0,R.e)([(0,o.K)()],H.prototype,"keysLeft",void 0),(0,R.e)([(0,o.K)()],H.prototype,"keysRight",void 0),(0,R.e)([(0,o.K)()],H.prototype,"keysReset",void 0),(0,R.e)([(0,o.K)()],H.prototype,"panningSensibility",void 0),(0,R.e)([(0,o.K)()],H.prototype,"zoomingSensibility",void 0),(0,R.e)([(0,o.K)()],H.prototype,"useAltToZoom",void 0),(0,R.e)([(0,o.K)()],H.prototype,"angularSpeed",void 0),d.e.ArcRotateCameraKeyboardMoveInput=H;var C=q(11238),c=q(11432);class P{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new S.ew(0,0,0),this._globalOffset=new S.ew(0,0,0),this._inertialPanning=S.ew.Zero()}_computeDeltaFromMouseWheelLegacyEvent(g,w){let q=0;const R=.01*g*this.wheelDeltaPercentage*w;return q=g>0?R/(1+this.wheelDeltaPercentage):R*(1+this.wheelDeltaPercentage),q}attachControl(g){g=D.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=w=>{if(w.type!==t.e.POINTERWHEEL)return;const q=w.event;let R=0;const o=q.deltaMode===c.c.DOM_DELTA_LINE?40:1,r=-q.deltaY*o;if(this.customComputeDeltaFromMouseWheel)R=this.customComputeDeltaFromMouseWheel(r,this,q);else if(this.wheelDeltaPercentage){if(R=this._computeDeltaFromMouseWheelLegacyEvent(r,this.camera.radius),R>0){let g=this.camera.radius,w=this.camera.inertialRadiusOffset+R;for(let q=0;q<20&&!(g<=w)&&!(Math.abs(w*this.camera.inertia)<.001);q++)g-=w,w*=this.camera.inertia;g=(0,i.Clamp)(g,0,Number.MAX_VALUE),R=this._computeDeltaFromMouseWheelLegacyEvent(r,g)}}else R=r/(40*this.wheelPrecision);R&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(R)):this.camera.inertialRadiusOffset+=R),q.preventDefault&&(g||q.preventDefault())},this._observer=this.camera.Ng()._inputManager._addCameraPointerObserver(this._wheel,t.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.yi(0)}Nm(){this._observer&&(this.camera.Ng()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const g=this.camera;0+g.inertialAlphaOffset+g.inertialBetaOffset+g.inertialRadiusOffset&&(this._updateHitPlane(),g.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(g.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const g=this.camera,w=g.target.yw(g.position);this._hitPlane=C.d.FromPositionAndNormal(g.target,w)}_getPosition(){const g=this.camera,w=g.Ng(),q=w.createPickingRay(w.pointerX,w.pointerY,S.Matrix.Identity(),g,!1);0===g.targetScreenOffset.x&&0===g.targetScreenOffset.y||(this._viewOffset.set(g.targetScreenOffset.x,g.targetScreenOffset.y,0),g.getViewMatrix().invertToRef(g._cameraTransformMatrix),this._globalOffset=S.ew.TransformNormal(this._viewOffset,g._cameraTransformMatrix),q.origin.addInPlace(this._globalOffset));let R=0;return this._hitPlane&&(R=q.intersectsPlane(this._hitPlane)??0),q.origin.addInPlace(q.direction.scaleInPlace(R))}_zoomToMouse(g){const w=this.camera,q=1-w.inertia;if(w.lowerRadiusLimit){const R=w.lowerRadiusLimit??0;w.radius-(w.inertialRadiusOffset+g)/q<R&&(g=(w.radius-R)*q-w.inertialRadiusOffset)}if(w.upperRadiusLimit){const R=w.upperRadiusLimit??0;w.radius-(w.inertialRadiusOffset+g)/q>R&&(g=(w.radius-R)*q-w.inertialRadiusOffset)}const R=g/q/w.radius,o=this._getPosition(),r=S.TmpVectors.ew[6];o.subtractToRef(w.target,r),r.scaleInPlace(R),r.scaleInPlace(q),this._inertialPanning.addInPlace(r),w.inertialRadiusOffset+=g}_zeroIfClose(g){Math.abs(g.x)<e.c&&(g.x=0),Math.abs(g.y)<e.c&&(g.y=0),Math.abs(g.z)<e.c&&(g.z=0)}}(0,R.e)([(0,o.K)()],P.prototype,"wheelPrecision",void 0),(0,R.e)([(0,o.K)()],P.prototype,"zoomToMouseLocation",void 0),(0,R.e)([(0,o.K)()],P.prototype,"wheelDeltaPercentage",void 0),d.e.ArcRotateCameraMouseWheelInput=P;class j extends d.f{constructor(g){super(g)}addMouseWheel(){return this.add(new P),this}addPointers(){return this.add(new N),this}addKeyboard(){return this.add(new H),this}}var M=q(11128);function V(g,w){return isNaN(g)?w:g}T.b.AddNodeConstructor("ArcRotateCamera",((g,w)=>()=>new s(g,0,0,1,S.ew.Zero(),w)));class s extends G.c{get target(){return this._target}set target(g){this.setTarget(g)}get targetHost(){return this._targetHost}set targetHost(g){g&&this.setTarget(g)}getTarget(){return this.target}get position(){return this._position}set position(g){this.setPosition(g)}set upVector(g){this._upToYMatrix||(this._yToUpMatrix=new S.Matrix,this._upToYMatrix=new S.Matrix,this._upVector=S.ew.Zero()),g.normalize(),this._upVector.T(g),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){S.Matrix.RotationAlignToRef(S.ew.UpReadOnly,this._upVector,this._yToUpMatrix),S.Matrix.RotationAlignToRef(this._upVector,S.ew.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const g=this.inputs.attached.pointers;return g?g.angularSensibilityX:0}set angularSensibilityX(g){const w=this.inputs.attached.pointers;w&&(w.angularSensibilityX=g)}get angularSensibilityY(){const g=this.inputs.attached.pointers;return g?g.angularSensibilityY:0}set angularSensibilityY(g){const w=this.inputs.attached.pointers;w&&(w.angularSensibilityY=g)}get pinchPrecision(){const g=this.inputs.attached.pointers;return g?g.pinchPrecision:0}set pinchPrecision(g){const w=this.inputs.attached.pointers;w&&(w.pinchPrecision=g)}get pinchDeltaPercentage(){const g=this.inputs.attached.pointers;return g?g.pinchDeltaPercentage:0}set pinchDeltaPercentage(g){const w=this.inputs.attached.pointers;w&&(w.pinchDeltaPercentage=g)}get useNaturalPinchZoom(){const g=this.inputs.attached.pointers;return!!g&&g.useNaturalPinchZoom}set useNaturalPinchZoom(g){const w=this.inputs.attached.pointers;w&&(w.useNaturalPinchZoom=g)}get panningSensibility(){const g=this.inputs.attached.pointers;return g?g.panningSensibility:0}set panningSensibility(g){const w=this.inputs.attached.pointers;w&&(w.panningSensibility=g)}get keysUp(){const g=this.inputs.attached.keyboard;return g?g.keysUp:[]}set keysUp(g){const w=this.inputs.attached.keyboard;w&&(w.keysUp=g)}get keysDown(){const g=this.inputs.attached.keyboard;return g?g.keysDown:[]}set keysDown(g){const w=this.inputs.attached.keyboard;w&&(w.keysDown=g)}get keysLeft(){const g=this.inputs.attached.keyboard;return g?g.keysLeft:[]}set keysLeft(g){const w=this.inputs.attached.keyboard;w&&(w.keysLeft=g)}get keysRight(){const g=this.inputs.attached.keyboard;return g?g.keysRight:[]}set keysRight(g){const w=this.inputs.attached.keyboard;w&&(w.keysRight=g)}get wheelPrecision(){const g=this.inputs.attached.mousewheel;return g?g.wheelPrecision:0}set wheelPrecision(g){const w=this.inputs.attached.mousewheel;w&&(w.wheelPrecision=g)}get zoomToMouseLocation(){const g=this.inputs.attached.mousewheel;return!!g&&g.zoomToMouseLocation}set zoomToMouseLocation(g){const w=this.inputs.attached.mousewheel;w&&(w.zoomToMouseLocation=g)}get wheelDeltaPercentage(){const g=this.inputs.attached.mousewheel;return g?g.wheelDeltaPercentage:0}set wheelDeltaPercentage(g){const w=this.inputs.attached.mousewheel;w&&(w.wheelDeltaPercentage=g)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(g){g!==this.useBouncingBehavior&&(g?(this._bouncingBehavior=new l,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(g){g!==this.useFramingBehavior&&(g?(this._framingBehavior=new J,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(g){g!==this.useAutoRotationBehavior&&(g?(this._autoRotationBehavior=new y,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(g,w,q,R,o,i){var T;let z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(g,S.ew.Zero(),i,z),T=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=S.ew.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=S.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new S.Matrix,this.panningAxis=new S.ew(1,1,0),this._transformedDirection=new S.ew,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new r.b,this.checkCollisions=!1,this.collisionRadius=new S.ew(.5,.5,.5),this._previousPosition=S.ew.Zero(),this._collisionVelocity=S.ew.Zero(),this._newPosition=S.ew.Zero(),this._computationVector=S.ew.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new S.ew(NaN,NaN,NaN),this._goalTargetScreenOffset=new S.Vector2(NaN,NaN),this._onCollisionPositionChange=function(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q?(T.setPosition(w),T.My&&T.My(q)):T._previousPosition.T(T._position);const R=Math.cos(T.alpha),o=Math.sin(T.alpha),r=Math.cos(T.beta);let S=Math.sin(T.beta);0===S&&(S=1e-4);const i=T._getTargetPosition();T._computationVector.mi(T.radius*R*S,T.radius*r,T.radius*o*S),i.addToRef(T._computationVector,T._newPosition),T._position.T(T._newPosition);let z=T.upVector;T.allowUpsideDown&&T.beta<0&&(z=z.clone(),z=z.negate()),T._computeViewMatrix(T._position,i,z),T._viewMatrix.addAtIndex(12,T.targetScreenOffset.x),T._viewMatrix.addAtIndex(13,T.targetScreenOffset.y),T._collisionTriggered=!1},this._target=S.ew.Zero(),o&&this.setTarget(o),this.alpha=w,this.beta=q,this.radius=R,this.getViewMatrix(),this.inputs=new j(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new S.ew(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=S.Vector2.Zero()}_updateCache(g){g||super._updateCache(),this._cache._target.T(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.T(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const g=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?g.addToRef(this._targetBoundingCenter,this._target):this._target.T(g)}const g=this._getLockedTargetPosition();return g||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>e.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,r=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=r?this._currentInterpolationFactor=r:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=V(g,this._goalAlpha),this._goalBeta=V(w,this._goalBeta),this._goalRadius=V(q,this._goalRadius),this._goalTarget.set(V(R.x,this._goalTarget.x),V(R.y,this._goalTarget.y),V(R.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(V(o.x,this._goalTargetScreenOffset.x),V(o.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,i.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,i.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,i.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,i.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(g,w){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const o=arguments;w=D.Tools.BackCompatCameraNoPreventDefault(o),this._useCtrlForPanning=q,this._panningMouseButton=R,"boolean"===typeof o[0]&&(o.length>1&&(this._useCtrlForPanning=o[1]),o.length>2&&(this._panningMouseButton=o[2])),this.inputs.attachElement(w),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Nm(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let g=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){g=!0;const w=this.invertRotation?-1:1,q=this._calculateHandednessMultiplier();let R=this.inertialAlphaOffset*q;this.beta<0&&(R*=-1),this.alpha+=R*w,this.beta+=this.inertialBetaOffset*w,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*e.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){g=!0;const w=new S.ew(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),w.multiplyInPlace(this.panningAxis),S.ew.TransformNormalToRef(w,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const g=this.upVector,w=S.ew.CrossToRef(this._transformedDirection,g,this._transformedDirection);S.ew.CrossToRef(g,w,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);S.ew.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.T(this._transformedDirection)}else{if(this.parent){const g=S.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(g),g.transposeToRef(g),S.ew.TransformCoordinatesToRef(this._transformedDirection,g,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*e.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*e.c&&(this.inertialPanningY=0)}if(g)this.stopInterpolation();else if(this._isInterpolating){let g=!1;const w=this._scene.getEngine().getDeltaTime()/1e3,q=1-Math.pow(2,-w/this._currentInterpolationFactor),R=V(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const w=S.TmpVectors.ew[0].set(V(this._goalTarget.x,this._target.x),V(this._goalTarget.y,this._target.y),V(this._goalTarget.z,this._target.z));S.ew.LerpToRef(this.target,w,q,this._target),10*S.ew.Distance(this.target,w)/R<e.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.T(w),this.setTarget(this.target,!1,!0,!0)):g=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const w=S.Quaternion.RotationAlphaBetaGammaToRef(V(this._goalAlpha,this.alpha),V(this._goalBeta,this.beta),0,S.TmpVectors.Quaternion[0]),R=S.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,S.TmpVectors.Quaternion[1]),o=S.Quaternion.SlerpToRef(R,w,q,S.TmpVectors.Quaternion[2]);o.normalize();const r=o.toAlphaBetaGammaToRef(S.TmpVectors.ew[0]);if(this.alpha=r.x,this.beta=r.y,o.isApprox(w,e.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const g=w.toAlphaBetaGammaToRef(S.TmpVectors.ew[0]);this.alpha=g.x,this.beta=g.y}else g=!0}if(isNaN(this._goalRadius)||(this.radius+=(R-this.radius)*q,Math.abs(R/this.radius-1)<e.c?(this._goalRadius=NaN,this.radius=R):g=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const w=S.TmpVectors.Vector2[0].set(V(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),V(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));S.Vector2.LerpToRef(this.targetScreenOffset,w,q,this.targetScreenOffset),S.Vector2.Distance(this.targetScreenOffset,w)<e.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.T(w)):g=!0}this._isInterpolating=g}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||S.ew.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const g=this.alpha;var w,q;this.alpha=function(g){let w=Math.PI/2;return 0===g.x&&0===g.z||(w=Math.acos(g.x/Math.sqrt(Math.pow(g.x,2)+Math.pow(g.z,2)))),g.z<0&&(w=2*Math.PI-w),w}(this._computationVector),this.beta=(w=this._computationVector.y,q=this.radius,Math.acos(w/q));const R=Math.round((g-this.alpha)/(2*Math.PI));this.alpha+=2*R*Math.PI,this._checkLimits()}setPosition(g){this._position.equals(g)||(this._position.T(g),this.rebuildAnglesAndRadius())}setTarget(g){let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(R=this.overrideCloneAlphaBetaRadius??R,g.ii)w&&g.getBoundingInfo?this._targetBoundingCenter=g.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,g.ii(),this._targetHost=g,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const w=g,R=this._getTargetPosition();if(R&&!q&&R.equals(w))return;this._targetHost=null,this._target=w,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}R||this.rebuildAnglesAndRadius()}_getViewMatrix(){const g=Math.cos(this.alpha),w=Math.sin(this.alpha),q=Math.cos(this.beta);let R=Math.sin(this.beta);0===R&&(R=1e-4),0===this.radius&&(this.radius=1e-4);const o=this._getTargetPosition();if(this._computationVector.mi(this.radius*g*R,this.radius*q,this.radius*w*R),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||S.ew.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),o.addToRef(this._computationVector,this._newPosition),this.Ng().collisionsEnabled&&this.checkCollisions){const g=this.Ng().collisionCoordinator;this._collider||(this._collider=g.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,g.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.T(this._newPosition);let g=this.upVector;this.allowUpsideDown&&R<0&&(g=g.negate()),this._computeViewMatrix(this._position,o,g),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.T(o),this._viewMatrix}zoomOn(g){let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1];g=g||this.Ng().meshes;const q=z.d.MinMax(g);let R=this._calculateLowerRadiusFromModelBoundingSphere(q.min,q.max);if(R=Math.max(Math.min(R,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=R*this.zoomOnFactor,this.mode===x.b.ORTHOGRAPHIC_CAMERA){const g=this.Ng().getEngine().getAspectRatio(this),w=R*this.zoomOnFactor/2;this.orthoLeft=-w*g,this.orthoRight=w*g,this.orthoBottom=-w,this.orthoTop=w}this.focusOn({min:q.min,max:q.max,distance:R},w)}focusOn(g){let w,q,R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===g.min){const R=g||this.Ng().meshes;w=z.d.MinMax(R),q=S.ew.Distance(w.min,w.max)}else{w=g,q=g.distance}this._target=z.d.Center(w),R||(this.maxZ=2*q)}createRigCamera(g,w){let q=0;switch(this.cameraRigMode){case x.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case x.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case x.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case x.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case x.b.RIG_MODE_VR:q=this._cameraRigParams.stereoHalfAngle*(0===w?1:-1);break;case x.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:q=this._cameraRigParams.stereoHalfAngle*(0===w?-1:1)}const R=new s(g,this.alpha+q,this.beta,this.radius,this._target,this.Ng());return R._cameraRigParams={},R.isRigCamera=!0,R.rigParent=this,R.upVector=this.upVector,R.mode=this.mode,R.orthoLeft=this.orthoLeft,R.orthoRight=this.orthoRight,R.orthoBottom=this.orthoBottom,R.orthoTop=this.orthoTop,R}_updateRigCameras(){const g=this._rigCameras[0],w=this._rigCameras[1];switch(g.beta=w.beta=this.beta,this.cameraRigMode){case x.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case x.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case x.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case x.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case x.b.RIG_MODE_VR:g.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,w.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case x.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:g.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,w.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const R=S.ew.Distance(g,w),o=this.Ng().getEngine().getAspectRatio(this),r=Math.tan(this.fov/2),i=r*o,T=.5*R*q,z=T*Math.sqrt(1+1/(i*i)),t=T*Math.sqrt(1+1/(r*r));return Math.max(z,t)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,R.e)([(0,o.K)()],s.prototype,"alpha",void 0),(0,R.e)([(0,o.K)()],s.prototype,"beta",void 0),(0,R.e)([(0,o.K)()],s.prototype,"radius",void 0),(0,R.e)([(0,o.K)()],s.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,R.e)([(0,o.H)("target")],s.prototype,"_target",void 0),(0,R.e)([(0,o.x)("targetHost")],s.prototype,"_targetHost",void 0),(0,R.e)([(0,o.K)()],s.prototype,"inertialAlphaOffset",void 0),(0,R.e)([(0,o.K)()],s.prototype,"inertialBetaOffset",void 0),(0,R.e)([(0,o.K)()],s.prototype,"inertialRadiusOffset",void 0),(0,R.e)([(0,o.K)()],s.prototype,"lowerAlphaLimit",void 0),(0,R.e)([(0,o.K)()],s.prototype,"upperAlphaLimit",void 0),(0,R.e)([(0,o.K)()],s.prototype,"lowerBetaLimit",void 0),(0,R.e)([(0,o.K)()],s.prototype,"upperBetaLimit",void 0),(0,R.e)([(0,o.K)()],s.prototype,"lowerRadiusLimit",void 0),(0,R.e)([(0,o.K)()],s.prototype,"upperRadiusLimit",void 0),(0,R.e)([(0,o.K)()],s.prototype,"lowerTargetYLimit",void 0),(0,R.e)([(0,o.K)()],s.prototype,"inertialPanningX",void 0),(0,R.e)([(0,o.K)()],s.prototype,"inertialPanningY",void 0),(0,R.e)([(0,o.K)()],s.prototype,"pinchToPanMaxDistance",void 0),(0,R.e)([(0,o.K)()],s.prototype,"panningDistanceLimit",void 0),(0,R.e)([(0,o.H)()],s.prototype,"panningOriginTarget",void 0),(0,R.e)([(0,o.K)()],s.prototype,"panningInertia",void 0),(0,R.e)([(0,o.K)()],s.prototype,"zoomToMouseLocation",null),(0,R.e)([(0,o.K)()],s.prototype,"zoomOnFactor",void 0),(0,R.e)([(0,o.G)()],s.prototype,"targetScreenOffset",void 0),(0,R.e)([(0,o.K)()],s.prototype,"allowUpsideDown",void 0),(0,R.e)([(0,o.K)()],s.prototype,"useInputToRestoreState",void 0),(0,R.e)([(0,o.K)()],s.prototype,"restoreStateInterpolationFactor",void 0),(0,M.g)("BABYLON.ArcRotateCamera",s)},12752:(g,w,q)=>{"use strict";q.d(w,{e:()=>S,f:()=>i});var R=q(11011),o=q(11218),r=q(11593),S={};class i{constructor(g){this.attachedToElement=!1,this.attached={},this.camera=g,this.checkInputs=()=>{}}add(g){const w=g.getSimpleName();this.attached[w]?R.d.Warn("camera input of type "+w+" already exists on camera"):(this.attached[w]=g,g.camera=this.camera,g.checkInputs&&(this.checkInputs=this._addCheckInputs(g.checkInputs.bind(g))),this.attachedToElement&&g.attachControl(this.noPreventDefault))}remove(g){for(const w in this.attached){const q=this.attached[w];if(q===g)return q.Nm(),q.camera=null,delete this.attached[w],void this.rebuildInputCheck()}}removeByType(g){for(const w in this.attached){const q=this.attached[w];q.getClassName()===g&&(q.Nm(),q.camera=null,delete this.attached[w],this.rebuildInputCheck())}}_addCheckInputs(g){const w=this.checkInputs;return()=>{w(),g()}}attachInput(g){this.attachedToElement&&g.attachControl(this.noPreventDefault)}attachElement(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){g=!r.b.ForceAttachControlToAlwaysPreventDefault&&g,this.attachedToElement=!0,this.noPreventDefault=g;for(const w in this.attached)this.attached[w].attachControl(g)}}detachElement(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const w in this.attached)this.attached[w].Nm(),g&&(this.attached[w].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const g in this.attached){const w=this.attached[g];w.checkInputs&&(this.checkInputs=this._addCheckInputs(w.checkInputs.bind(w)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(g){const w={};for(const q in this.attached){const g=this.attached[q],R=o.c.Serialize(g);w[g.getClassName()]=R}g.inputsmgr=w}parse(g){const w=g.inputsmgr;if(w){this.clear();for(const g in w){const q=S[g];if(q){const R=w[g],r=o.c.Parse((()=>new q),R,null);this.add(r)}}}else for(const q in this.attached){const w=S[this.attached[q].getClassName()];if(w){const R=o.c.Parse((()=>new w),g,null);this.remove(this.attached[q]),this.add(R)}}}}},12745:(g,w,q)=>{"use strict";q.d(w,{e:()=>U});var R=q(11161),o=q(11170),r=q(11180),S=q(11620),i=q(12752),T=q(11430),z=q(10991);class t{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(g){g=z.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ng(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((w=>{const q=w.event;if(!q.metaKey)if(w.type===T.b.KEYDOWN){if(-1!==this.keysUp.indexOf(q.keyCode)||-1!==this.keysDown.indexOf(q.keyCode)||-1!==this.keysLeft.indexOf(q.keyCode)||-1!==this.keysRight.indexOf(q.keyCode)||-1!==this.keysUpward.indexOf(q.keyCode)||-1!==this.keysDownward.indexOf(q.keyCode)||-1!==this.keysRotateLeft.indexOf(q.keyCode)||-1!==this.keysRotateRight.indexOf(q.keyCode)||-1!==this.keysRotateUp.indexOf(q.keyCode)||-1!==this.keysRotateDown.indexOf(q.keyCode)){-1===this._keys.indexOf(q.keyCode)&&this._keys.push(q.keyCode),g||q.preventDefault()}}else if(-1!==this.keysUp.indexOf(q.keyCode)||-1!==this.keysDown.indexOf(q.keyCode)||-1!==this.keysLeft.indexOf(q.keyCode)||-1!==this.keysRight.indexOf(q.keyCode)||-1!==this.keysUpward.indexOf(q.keyCode)||-1!==this.keysDownward.indexOf(q.keyCode)||-1!==this.keysRotateLeft.indexOf(q.keyCode)||-1!==this.keysRotateRight.indexOf(q.keyCode)||-1!==this.keysRotateUp.indexOf(q.keyCode)||-1!==this.keysRotateDown.indexOf(q.keyCode)){const w=this._keys.indexOf(q.keyCode);w>=0&&this._keys.splice(w,1),g||q.preventDefault()}})))}Nm(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const g=this.camera;for(let w=0;w<this._keys.length;w++){const q=this._keys[w],R=g._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(q)?g._localDirection.mi(-R,0,0):-1!==this.keysUp.indexOf(q)?g._localDirection.mi(0,0,R):-1!==this.keysRight.indexOf(q)?g._localDirection.mi(R,0,0):-1!==this.keysDown.indexOf(q)?g._localDirection.mi(0,0,-R):-1!==this.keysUpward.indexOf(q)?g._localDirection.mi(0,R,0):-1!==this.keysDownward.indexOf(q)?g._localDirection.mi(0,-R,0):-1!==this.keysRotateLeft.indexOf(q)?(g._localDirection.mi(0,0,0),g.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(q)?(g._localDirection.mi(0,0,0),g.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(q)?(g._localDirection.mi(0,0,0),g.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(q)&&(g._localDirection.mi(0,0,0),g.cameraRotation.x+=this._getLocalRotation()),g.Ng().useRightHandedSystem&&(g._localDirection.z*=-1),g.getViewMatrix().invertToRef(g._cameraTransformMatrix),r.ew.TransformNormalToRef(g._localDirection,g._cameraTransformMatrix,g._transformedDirection),g.cameraDirection.addInPlace(g._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const g=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*g}}(0,R.e)([(0,o.K)()],t.prototype,"keysUp",void 0),(0,R.e)([(0,o.K)()],t.prototype,"keysUpward",void 0),(0,R.e)([(0,o.K)()],t.prototype,"keysDown",void 0),(0,R.e)([(0,o.K)()],t.prototype,"keysDownward",void 0),(0,R.e)([(0,o.K)()],t.prototype,"keysLeft",void 0),(0,R.e)([(0,o.K)()],t.prototype,"keysRight",void 0),(0,R.e)([(0,o.K)()],t.prototype,"rotationSpeed",void 0),(0,R.e)([(0,o.K)()],t.prototype,"keysRotateLeft",void 0),(0,R.e)([(0,o.K)()],t.prototype,"keysRotateRight",void 0),(0,R.e)([(0,o.K)()],t.prototype,"keysRotateUp",void 0),(0,R.e)([(0,o.K)()],t.prototype,"keysRotateDown",void 0),i.e.FreeCameraKeyboardMoveInput=t;var m=q(10998),e=q(11424);class y{constructor(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=g,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new m.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(g){g=z.Tools.BackCompatCameraNoPreventDefault(arguments);const w=this.camera.getEngine(),q=w.getInputElement();this._pointerInput||(this._pointerInput=R=>{const o=R.event,r="touch"===o.pointerType;if(!this.touchEnabled&&r)return;if(R.type!==e.e.POINTERMOVE&&-1===this.buttons.indexOf(o.button))return;const S=o.target;if(R.type===e.e.POINTERDOWN){if(r&&-1!==this._activePointerId||!r&&-1!==this._currentActiveButton)return;this._activePointerId=o.pointerId;try{null===S||void 0===S||S.setPointerCapture(o.pointerId)}catch(i){}-1===this._currentActiveButton&&(this._currentActiveButton=o.button),this._previousPosition={x:o.clientX,y:o.clientY},g||(o.preventDefault(),q&&q.focus()),w.isPointerLock&&this._onMouseMove&&this._onMouseMove(R.event)}else if(R.type===e.e.POINTERUP){if(r&&this._activePointerId!==o.pointerId||!r&&this._currentActiveButton!==o.button)return;try{null===S||void 0===S||S.releasePointerCapture(o.pointerId)}catch(i){}this._currentActiveButton=-1,this._previousPosition=null,g||o.preventDefault(),this._activePointerId=-1}else if(R.type===e.e.POINTERMOVE&&(this._activePointerId===o.pointerId||!r))if(w.isPointerLock&&this._onMouseMove)this._onMouseMove(R.event);else if(this._previousPosition){const w=this.camera._calculateHandednessMultiplier(),q=(o.clientX-this._previousPosition.x)*w,R=o.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=q/this.angularSensibility,this.camera.cameraRotation.x+=R/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:q,offsetY:R}),this._previousPosition={x:o.clientX,y:o.clientY},g||o.preventDefault()}}),this._onMouseMove=q=>{if(!w.isPointerLock)return;const R=this.camera._calculateHandednessMultiplier(),o=q.movementX*R;this.camera.cameraRotation.y+=o/this.angularSensibility;const r=q.movementY;this.camera.cameraRotation.x+=r/this.angularSensibility,this._previousPosition=null,g||q.preventDefault()},this._observer=this.camera.Ng()._inputManager._addCameraPointerObserver(this._pointerInput,e.e.POINTERDOWN|e.e.POINTERUP|e.e.POINTERMOVE),q&&(this._contextMenuBind=g=>this.onContextMenu(g),q.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(g){g.preventDefault()}Nm(){if(this._observer){if(this.camera.Ng()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const g=this.camera.getEngine().getInputElement();g&&g.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,R.e)([(0,o.K)()],y.prototype,"buttons",void 0),(0,R.e)([(0,o.K)()],y.prototype,"angularSensibility",void 0),i.e.FreeCameraMouseInput=y;var L,A=q(11432);class l{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new m.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(g){g=z.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=w=>{if(w.type!==e.e.POINTERWHEEL)return;const q=w.event,R=q.deltaMode===A.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*R*q.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*R*q.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*R*q.deltaZ/this._normalize,q.preventDefault&&(g||q.preventDefault())},this._observer=this.camera.Ng()._inputManager._addCameraPointerObserver(this._wheel,e.e.POINTERWHEEL)}Nm(){this._observer&&(this.camera.Ng()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,R.e)([(0,o.K)()],l.prototype,"wheelPrecisionX",void 0),(0,R.e)([(0,o.K)()],l.prototype,"wheelPrecisionY",void 0),(0,R.e)([(0,o.K)()],l.prototype,"wheelPrecisionZ",void 0),function(g){g[g.MoveRelative=0]="MoveRelative",g[g.RotateRelative=1]="RotateRelative",g[g.MoveScene=2]="MoveScene"}(L||(L={}));class J extends l{constructor(){super(...arguments),this._moveRelative=r.ew.Zero(),this._rotateRelative=r.ew.Zero(),this._moveScene=r.ew.Zero(),this._wheelXAction=L.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=L.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(g){null===g&&this._wheelXAction!==L.MoveRelative||(this._wheelXAction=L.MoveRelative,this._wheelXActionCoordinate=g)}get wheelXMoveRelative(){return this._wheelXAction!==L.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(g){null===g&&this._wheelYAction!==L.MoveRelative||(this._wheelYAction=L.MoveRelative,this._wheelYActionCoordinate=g)}get wheelYMoveRelative(){return this._wheelYAction!==L.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(g){null===g&&this._wheelZAction!==L.MoveRelative||(this._wheelZAction=L.MoveRelative,this._wheelZActionCoordinate=g)}get wheelZMoveRelative(){return this._wheelZAction!==L.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(g){null===g&&this._wheelXAction!==L.RotateRelative||(this._wheelXAction=L.RotateRelative,this._wheelXActionCoordinate=g)}get wheelXRotateRelative(){return this._wheelXAction!==L.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(g){null===g&&this._wheelYAction!==L.RotateRelative||(this._wheelYAction=L.RotateRelative,this._wheelYActionCoordinate=g)}get wheelYRotateRelative(){return this._wheelYAction!==L.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(g){null===g&&this._wheelZAction!==L.RotateRelative||(this._wheelZAction=L.RotateRelative,this._wheelZActionCoordinate=g)}get wheelZRotateRelative(){return this._wheelZAction!==L.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(g){null===g&&this._wheelXAction!==L.MoveScene||(this._wheelXAction=L.MoveScene,this._wheelXActionCoordinate=g)}get wheelXMoveScene(){return this._wheelXAction!==L.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(g){null===g&&this._wheelYAction!==L.MoveScene||(this._wheelYAction=L.MoveScene,this._wheelYActionCoordinate=g)}get wheelYMoveScene(){return this._wheelYAction!==L.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(g){null===g&&this._wheelZAction!==L.MoveScene||(this._wheelZAction=L.MoveScene,this._wheelZActionCoordinate=g)}get wheelZMoveScene(){return this._wheelZAction!==L.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.yi(0),this._rotateRelative.yi(0),this._moveScene.yi(0),this._updateCamera(),this.camera.Ng().useRightHandedSystem&&(this._moveRelative.z*=-1);const g=r.Matrix.Zero();this.camera.getViewMatrix().invertToRef(g);const w=r.ew.Zero();r.ew.TransformNormalToRef(this._moveRelative,g,w),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(w),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(g,w,q){if(0===g)return;if(null===w||null===q)return;let R=null;switch(w){case L.MoveRelative:R=this._moveRelative;break;case L.RotateRelative:R=this._rotateRelative;break;case L.MoveScene:R=this._moveScene}switch(q){case 0:R.set(g,0,0);break;case 1:R.set(0,g,0);break;case 2:R.set(0,0,g)}}}(0,R.e)([(0,o.K)()],J.prototype,"wheelXMoveRelative",null),(0,R.e)([(0,o.K)()],J.prototype,"wheelYMoveRelative",null),(0,R.e)([(0,o.K)()],J.prototype,"wheelZMoveRelative",null),(0,R.e)([(0,o.K)()],J.prototype,"wheelXRotateRelative",null),(0,R.e)([(0,o.K)()],J.prototype,"wheelYRotateRelative",null),(0,R.e)([(0,o.K)()],J.prototype,"wheelZRotateRelative",null),(0,R.e)([(0,o.K)()],J.prototype,"wheelXMoveScene",null),(0,R.e)([(0,o.K)()],J.prototype,"wheelYMoveScene",null),(0,R.e)([(0,o.K)()],J.prototype,"wheelZMoveScene",null),i.e.FreeCameraMouseWheelInput=J;class x{constructor(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=g,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=z.Tools.IsSafari()}attachControl(g){g=z.Tools.BackCompatCameraNoPreventDefault(arguments);let w=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=q=>{const R=q.event,o="mouse"===R.pointerType||this._isSafari&&"undefined"===typeof R.pointerType;if(this.allowMouse||!o)if(q.type===e.e.POINTERDOWN){if(g||R.preventDefault(),this._pointerPressed.push(R.pointerId),1!==this._pointerPressed.length)return;w={x:R.clientX,y:R.clientY}}else if(q.type===e.e.POINTERUP){g||R.preventDefault();const q=this._pointerPressed.indexOf(R.pointerId);if(-1===q)return;if(this._pointerPressed.splice(q,1),0!=q)return;w=null,this._offsetX=null,this._offsetY=null}else if(q.type===e.e.POINTERMOVE){if(g||R.preventDefault(),!w)return;if(0!=this._pointerPressed.indexOf(R.pointerId))return;this._offsetX=R.clientX-w.x,this._offsetY=-(R.clientY-w.y)}}),this._observer=this.camera.Ng()._inputManager._addCameraPointerObserver(this._pointerInput,e.e.POINTERDOWN|e.e.POINTERUP|e.e.POINTERMOVE),this._onLostFocus){const g=this.camera.getEngine().getInputElement();g&&g.addEventListener("blur",this._onLostFocus)}}Nm(){if(this._pointerInput){if(this._observer&&(this.camera.Ng()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const g=this.camera.getEngine().getInputElement();g&&g.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const g=this.camera,w=g._calculateHandednessMultiplier();g.cameraRotation.y=w*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)g.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const w=g._computeLocalCameraSpeed(),q=new r.ew(0,0,0!==this.touchMoveSensibility?w*this._offsetY/this.touchMoveSensibility:0);r.Matrix.RotationYawPitchRollToRef(g.rotation.y,g.rotation.x,0,g._cameraRotationMatrix),g.cameraDirection.addInPlace(r.ew.TransformCoordinates(q,g._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,R.e)([(0,o.K)()],x.prototype,"touchAngularSensibility",void 0),(0,R.e)([(0,o.K)()],x.prototype,"touchMoveSensibility",void 0),i.e.FreeCameraTouchInput=x;class G extends i.f{constructor(g){super(g),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new t),this}addMouse(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new y(g),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new J,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new x),this}clear(){super.clear(),this._mouseInput=null}}var d=q(11128),D=q(11074);class U extends S.c{get angularSensibility(){const g=this.inputs.attached.mouse;return g?g.angularSensibility:0}set angularSensibility(g){const w=this.inputs.attached.mouse;w&&(w.angularSensibility=g)}get keysUp(){const g=this.inputs.attached.keyboard;return g?g.keysUp:[]}set keysUp(g){const w=this.inputs.attached.keyboard;w&&(w.keysUp=g)}get keysUpward(){const g=this.inputs.attached.keyboard;return g?g.keysUpward:[]}set keysUpward(g){const w=this.inputs.attached.keyboard;w&&(w.keysUpward=g)}get keysDown(){const g=this.inputs.attached.keyboard;return g?g.keysDown:[]}set keysDown(g){const w=this.inputs.attached.keyboard;w&&(w.keysDown=g)}get keysDownward(){const g=this.inputs.attached.keyboard;return g?g.keysDownward:[]}set keysDownward(g){const w=this.inputs.attached.keyboard;w&&(w.keysDownward=g)}get keysLeft(){const g=this.inputs.attached.keyboard;return g?g.keysLeft:[]}set keysLeft(g){const w=this.inputs.attached.keyboard;w&&(w.keysLeft=g)}get keysRight(){const g=this.inputs.attached.keyboard;return g?g.keysRight:[]}set keysRight(g){const w=this.inputs.attached.keyboard;w&&(w.keysRight=g)}get keysRotateLeft(){const g=this.inputs.attached.keyboard;return g?g.keysRotateLeft:[]}set keysRotateLeft(g){const w=this.inputs.attached.keyboard;w&&(w.keysRotateLeft=g)}get keysRotateRight(){const g=this.inputs.attached.keyboard;return g?g.keysRotateRight:[]}set keysRotateRight(g){const w=this.inputs.attached.keyboard;w&&(w.keysRotateRight=g)}get keysRotateUp(){const g=this.inputs.attached.keyboard;return g?g.keysRotateUp:[]}set keysRotateUp(g){const w=this.inputs.attached.keyboard;w&&(w.keysRotateUp=g)}get keysRotateDown(){const g=this.inputs.attached.keyboard;return g?g.keysRotateDown:[]}set keysRotateDown(g){const w=this.inputs.attached.keyboard;w&&(w.keysRotateDown=g)}constructor(g,w,q){var R;super(g,w,q,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),R=this,this.ellipsoid=new r.ew(.5,1,.5),this.ellipsoidOffset=new r.ew(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=r.ew.Zero(),this._diffPosition=r.ew.Zero(),this._newPosition=r.ew.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R._newPosition.T(w),R._newPosition.subtractToRef(R._oldPosition,R._diffPosition),R._diffPosition.length()>D.b.CollisionsEpsilon&&(R.position.addToRef(R._diffPosition,R._deferredPositionUpdate),R._deferOnly?R._deferredUpdated=!0:R.position.T(R._deferredPositionUpdate),R.My&&q&&R.My(q))},this.inputs=new G(this),this.inputs.addKeyboard().addMouse()}attachControl(g,w){w=z.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(w)}Nm(){this.inputs.detachElement(),this.cameraDirection=new r.ew(0,0,0),this.cameraRotation=new r.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(g){this._collisionMask=isNaN(g)?-1:g}_collideWithWorld(g){let w;w=this.parent?r.ew.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,w.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const q=this.Ng().collisionCoordinator;this._collider||(this._collider=q.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let R=g;this.applyGravity&&(R=g.add(this.Ng().gravity)),q.getNewPosition(this._oldPosition,R,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=r.ew.Zero(),this._transformedDirection=r.ew.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(g){this._needMoveForGravity=g}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Ng().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"nz"}}(0,R.e)([(0,o.H)()],U.prototype,"ellipsoid",void 0),(0,R.e)([(0,o.H)()],U.prototype,"ellipsoidOffset",void 0),(0,R.e)([(0,o.K)()],U.prototype,"checkCollisions",void 0),(0,R.e)([(0,o.K)()],U.prototype,"applyGravity",void 0),(0,d.g)("BABYLON.FreeCamera",U)},13321:(g,w,q)=>{"use strict";q.d(w,{e:()=>r});var R=q(11270),o=q(13325);class r{constructor(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=q,this.Qt=[],this._maxBlockCapacity=w||64,this._selectionContent=new R.c(1024),this._creationFunc=g}update(g,w,q){o.b._CreateBlocks(g,w,q,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Kz(g){for(let w=0;w<this.ot.length;w++){this.ot[w].addEntry(g)}}Xz(g){for(let w=0;w<this.ot.length;w++){this.ot[w].removeEntry(g)}}select(g,w){this._selectionContent.reset();for(let q=0;q<this.ot.length;q++){this.ot[q].select(g,this._selectionContent,w)}return w?this._selectionContent.concat(this.Qt):this._selectionContent.concatWithNoDuplicate(this.Qt),this._selectionContent}intersects(g,w,q){this._selectionContent.reset();for(let R=0;R<this.ot.length;R++){this.ot[R].intersects(g,w,this._selectionContent,q)}return q?this._selectionContent.concat(this.Qt):this._selectionContent.concatWithNoDuplicate(this.Qt),this._selectionContent}intersectsRay(g){this._selectionContent.reset();for(let w=0;w<this.ot.length;w++){this.ot[w].intersectsRay(g,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Qt),this._selectionContent}}r.CreationFuncForMeshes=(g,w)=>{const q=g.getBoundingInfo();!g.isBlocked&&q.boundingBox.intersectsMinMax(w.Ft,w.ut)&&w.entries.push(g)},r.CreationFuncForSubMeshes=(g,w)=>{g.getBoundingInfo().boundingBox.intersectsMinMax(w.Ft,w.ut)&&w.entries.push(g)}},13325:(g,w,q)=>{"use strict";q.d(w,{b:()=>r});var R=q(11180),o=q(11483);class r{constructor(g,w,q,R,o,r){this.entries=[],this.nt=new Array,this._capacity=q,this._depth=R,this._maxDepth=o,this._creationFunc=r,this._minPoint=g,this._maxPoint=w,this.nt.push(g.clone()),this.nt.push(w.clone()),this.nt.push(g.clone()),this.nt[2].x=w.x,this.nt.push(g.clone()),this.nt[3].y=w.y,this.nt.push(g.clone()),this.nt[4].z=w.z,this.nt.push(w.clone()),this.nt[5].z=g.z,this.nt.push(w.clone()),this.nt[6].x=g.x,this.nt.push(w.clone()),this.nt[7].y=g.y}get Di(){return this._capacity}get Ft(){return this._minPoint}get ut(){return this._maxPoint}addEntry(g){if(this.ot)for(let w=0;w<this.ot.length;w++){this.ot[w].addEntry(g)}else this._creationFunc(g,this),this.entries.length>this.Di&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(g){if(this.ot){for(let w=0;w<this.ot.length;w++){this.ot[w].removeEntry(g)}return}const w=this.entries.indexOf(g);w>-1&&this.entries.splice(w,1)}addEntries(g){for(let w=0;w<g.length;w++){const q=g[w];this.addEntry(q)}}select(g,w,q){if(o.d.IsInFrustum(this.nt,g)){if(this.ot){for(let R=0;R<this.ot.length;R++){this.ot[R].select(g,w,q)}return}q?w.concat(this.entries):w.concatWithNoDuplicate(this.entries)}}intersects(g,w,q,R){if(o.d.IntersectsSphere(this._minPoint,this._maxPoint,g,w)){if(this.ot){for(let o=0;o<this.ot.length;o++){this.ot[o].intersects(g,w,q,R)}return}R?q.concat(this.entries):q.concatWithNoDuplicate(this.entries)}}intersectsRay(g,w){if(g.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.ot){for(let q=0;q<this.ot.length;q++){this.ot[q].intersectsRay(g,w)}return}w.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){r._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(g,w,q,o,S,i,T,z){T.ot=new Array;const t=new R.ew((w.x-g.x)/2,(w.y-g.y)/2,(w.z-g.z)/2);for(let R=0;R<2;R++)for(let w=0;w<2;w++)for(let m=0;m<2;m++){const e=g.add(t.multiplyByFloats(R,w,m)),y=g.add(t.multiplyByFloats(R+1,w+1,m+1)),L=new r(e,y,o,S+1,i,z);L.addEntries(q),T.ot.push(L)}}}},13330:(g,w,q)=>{"use strict";q.d(w,{b:()=>t});var R=q(11395),o=q(11180),r=q(11567),S=q(12510),i=q(11420),T=q(13321),z=q(11034);R.c.prototype.createOrUpdateSelectionOctree=function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,q=this._getComponent(i.e.NAME_OCTREE);q||(q=new t(this),this.o(q)),this.Ot||(this.Ot=new T.e(T.e.CreationFuncForMeshes,g,w));const R=this.getWorldExtends();return this.Ot.update(R.min,R.max,this.meshes),this.Ot},Object.defineProperty(R.c.prototype,"selectionOctree",{get:function(){return this.Ot},enumerable:!0,configurable:!0}),r.c.prototype.createOrUpdateSubmeshesOctree=function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const q=this.Ng();let R=q._getComponent(i.e.NAME_OCTREE);R||(R=new t(q),q.o(R)),this._submeshesOctree||(this._submeshesOctree=new T.e(T.e.CreationFuncForSubMeshes,g,w)),this.ii(!0);const o=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(o.minimumWorld,o.maximumWorld,this.wi),this._submeshesOctree};class t{constructor(g){this.name=i.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new S.d(o.ew.Zero(),new o.ew(1,1,1)),(g=g||z.c.LastCreatedScene)&&(this.Aw=g,this.Aw.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Aw.getActiveSubMeshCandidates=g=>this.getActiveSubMeshCandidates(g),this.Aw.getCollidingSubMeshCandidates=(g,w)=>this.getCollidingSubMeshCandidates(g,w),this.Aw.getIntersectingSubMeshCandidates=(g,w)=>this.getIntersectingSubMeshCandidates(g,w))}register(){this.Aw.onMeshRemovedObservable.add((g=>{const w=this.Aw.selectionOctree;if(void 0!==w&&null!==w){const q=w.Qt.indexOf(g);-1!==q&&w.Qt.splice(q,1)}})),this.Aw.onMeshImportedObservable.add((g=>{const w=this.Aw.selectionOctree;void 0!==w&&null!==w&&w.Kz(g)}))}getActiveMeshCandidates(){var g;return(null===(g=this.Aw.Ot)||void 0===g?void 0:g.select(this.Aw.frustumPlanes))||this.Aw._getDefaultMeshCandidates()}getActiveSubMeshCandidates(g){if(g._submeshesOctree&&g.useOctreeForRenderingSelection){return g._submeshesOctree.select(this.Aw.frustumPlanes)}return this.Aw._getDefaultSubMeshCandidates(g)}getIntersectingSubMeshCandidates(g,w){if(g._submeshesOctree&&g.useOctreeForPicking){S.d.TransformToRef(w,g.getWorldMatrix(),this._tempRay);return g._submeshesOctree.intersectsRay(this._tempRay)}return this.Aw._getDefaultSubMeshCandidates(g)}getCollidingSubMeshCandidates(g,w){if(g._submeshesOctree&&g.useOctreeForCollisions){const q=w._velocityWorldLength+Math.max(w._radius.x,w._radius.y,w._radius.z);return g._submeshesOctree.intersects(w._basePointWorld,q)}return this.Aw._getDefaultSubMeshCandidates(g)}rebuild(){}dispose(){}}},12510:(g,w,q)=>{"use strict";q.d(w,{d:()=>y});var R=q(11395),o=q(11593),r=q(11188),S=q(11180),i=q(11192),T=q(11474),z=q(11414),t=q(11034),m=q(11441);const e={internalPickerForMesh:void 0};class y{constructor(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.c;this.origin=g,this.direction=w,this.length=q,this.epsilon=R}clone(){return new y(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const R=y._TmpVector3[0].mi(g.x-q,g.y-q,g.z-q),o=y._TmpVector3[1].mi(w.x+q,w.y+q,w.z+q);let r,S,i,T,z=0,t=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<R.x||this.origin.x>o.x)return!1}else if(r=1/this.direction.x,S=(R.x-this.origin.x)*r,i=(o.x-this.origin.x)*r,i===-1/0&&(i=1/0),S>i&&(T=S,S=i,i=T),z=Math.max(S,z),t=Math.min(i,t),z>t)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<R.y||this.origin.y>o.y)return!1}else if(r=1/this.direction.y,S=(R.y-this.origin.y)*r,i=(o.y-this.origin.y)*r,i===-1/0&&(i=1/0),S>i&&(T=S,S=i,i=T),z=Math.max(S,z),t=Math.min(i,t),z>t)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<R.z||this.origin.z>o.z)return!1}else if(r=1/this.direction.z,S=(R.z-this.origin.z)*r,i=(o.z-this.origin.z)*r,i===-1/0&&(i=1/0),S>i&&(T=S,S=i,i=T),z=Math.max(S,z),t=Math.min(i,t),z>t)return!1;return!0}intersectsBox(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(g.minimum,g.maximum,w)}intersectsSphere(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const q=g.center.x-this.origin.x,R=g.center.y-this.origin.y,o=g.center.z-this.origin.z,r=q*q+R*R+o*o,S=g.radius+w,i=S*S;if(r<=i)return!0;const T=q*this.direction.x+R*this.direction.y+o*this.direction.z;if(T<0)return!1;return r-T*T<=i}intersectsTriangle(g,w,q){const R=y._TmpVector3[0],o=y._TmpVector3[1],r=y._TmpVector3[2],i=y._TmpVector3[3],z=y._TmpVector3[4];w.subtractToRef(g,R),q.subtractToRef(g,o),S.ew.CrossToRef(this.direction,o,r);const t=S.ew.Dot(R,r);if(0===t)return null;const m=1/t;this.origin.subtractToRef(g,i);const e=S.ew.Dot(i,r)*m;if(e<-this.epsilon||e>1+this.epsilon)return null;S.ew.CrossToRef(i,R,z);const L=S.ew.Dot(this.direction,z)*m;if(L<-this.epsilon||e+L>1+this.epsilon)return null;const A=S.ew.Dot(o,z)*m;return A>this.length?null:new T.e(1-e-L,e,A)}intersectsPlane(g){let w;const q=S.ew.Dot(g.Lw,this.direction);if(Math.abs(q)<9.99999997475243e-7)return null;{const R=S.ew.Dot(g.Lw,this.origin);return w=(-g.d-R)/q,w<0?w<-9.99999997475243e-7?null:0:w}}intersectsAxis(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(g){case"y":{const g=(this.origin.y-w)/this.direction.y;return g>0?null:new S.ew(this.origin.x+this.direction.x*-g,w,this.origin.z+this.direction.z*-g)}case"x":{const g=(this.origin.x-w)/this.direction.x;return g>0?null:new S.ew(w,this.origin.y+this.direction.y*-g,this.origin.z+this.direction.z*-g)}case"z":{const g=(this.origin.z-w)/this.direction.z;return g>0?null:new S.ew(this.origin.x+this.direction.x*-g,this.origin.y+this.direction.y*-g,w)}default:return null}}intersectsMesh(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=S.TmpVectors.Matrix[0];return g.getWorldMatrix().invertToRef(i),this._tmpRay?y.TransformToRef(this,i,this._tmpRay):this._tmpRay=y.Transform(this,i),g.intersects(this._tmpRay,w,q,R,o,r)}intersectsMeshes(g,w,q){q?q.length=0:q=[];for(let R=0;R<g.length;R++){const o=this.intersectsMesh(g[R],w);o.hit&&q.push(o)}return q.sort(this._comparePickingInfo),q}_comparePickingInfo(g,w){return g.distance<w.distance?-1:g.distance>w.distance?1:0}intersectionSegment(g,w,q){const R=this.origin,o=S.TmpVectors.ew[0],r=S.TmpVectors.ew[1],i=S.TmpVectors.ew[2],T=S.TmpVectors.ew[3];w.subtractToRef(g,o),this.direction.scaleToRef(y._Rayl,i),R.addToRef(i,r),g.subtractToRef(R,T);const z=S.ew.Dot(o,o),t=S.ew.Dot(o,i),m=S.ew.Dot(i,i),e=S.ew.Dot(o,T),L=S.ew.Dot(i,T),A=z*m-t*t;let l,J,x=A,G=A;A<y._Smallnum?(l=0,x=1,J=L,G=m):(l=t*L-m*e,J=z*L-t*e,l<0?(l=0,J=L,G=m):l>x&&(l=x,J=L+t,G=m)),J<0?(J=0,-e<0?l=0:-e>z?l=x:(l=-e,x=z)):J>G&&(J=G,-e+t<0?l=0:-e+t>z?l=x:(l=-e+t,x=z));const d=Math.abs(l)<y._Smallnum?0:l/x,D=Math.abs(J)<y._Smallnum?0:J/G,U=S.TmpVectors.ew[4];i.scaleToRef(D,U);const N=S.TmpVectors.ew[5];o.scaleToRef(d,N),N.addInPlace(T);const a=S.TmpVectors.ew[6];N.subtractToRef(U,a);return D>0&&D<=this.length&&a.lengthSquared()<q*q?N.length():-1}update(g,w,q,R,o,r,i){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){y._RayDistant||(y._RayDistant=y.Zero()),y._RayDistant.unprojectRayToRef(g,w,q,R,S.Matrix.IdentityReadOnly,r,i);const T=S.TmpVectors.Matrix[0];o.invertToRef(T),y.TransformToRef(y._RayDistant,T,this)}else this.unprojectRayToRef(g,w,q,R,o,r,i);return this}static Zero(){return new y(S.ew.Zero(),S.ew.Zero())}static CreateNew(g,w,q,R,o,r,S){return y.Zero().update(g,w,q,R,o,r,S)}static CreateNewFromTo(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.Matrix.IdentityReadOnly;const R=new y(new S.ew(0,0,0),new S.ew(0,0,0));return y.CreateFromToToRef(g,w,R,q)}static CreateFromToToRef(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.Matrix.IdentityReadOnly;q.origin.T(g);const o=w.subtractToRef(g,q.direction),r=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z);return q.length=r,q.direction.normalize(),y.TransformToRef(q,R,q)}static Transform(g,w){const q=new y(new S.ew(0,0,0),new S.ew(0,0,0));return y.TransformToRef(g,w,q),q}static TransformToRef(g,w,q){S.ew.TransformCoordinatesToRef(g.origin,w,q.origin),S.ew.TransformNormalToRef(g.direction,w,q.direction),q.length=g.length,q.epsilon=g.epsilon;const R=q.direction,o=R.length();if(0!==o&&1!==o){const g=1/o;R.x*=g,R.y*=g,R.z*=g,q.length*=o}return q}unprojectRayToRef(g,w,q,R,o,r,i){const T=S.TmpVectors.Matrix[0];o.multiplyToRef(r,T),T.multiplyToRef(i,T),T.invert();const z=t.c.LastCreatedEngine,m=S.TmpVectors.ew[0];m.x=g/q*2-1,m.y=-(w/R*2-1),m.z=null!==z&&void 0!==z&&z.useReverseDepthBuffer?1:null!==z&&void 0!==z&&z.isNDCHalfZRange?0:-1;const e=S.TmpVectors.ew[1].mi(m.x,m.y,1-1e-8),y=S.TmpVectors.ew[2],L=S.TmpVectors.ew[3];S.ew._UnprojectFromInvertedMatrixToRef(m,T,y),S.ew._UnprojectFromInvertedMatrixToRef(e,T,L),this.origin.T(y),L.subtractToRef(y,this.direction),this.direction.normalize()}}function L(g,w,q,R,o){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=y.Zero();return A(g,w,q,R,S,o,r),S}function A(g,w,q,R,o,r){let i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const z=g.getEngine();if(!r&&!(r=g.activeCamera))return g;const t=r.viewport,m=z.getRenderHeight(),{x:e,y:y,width:L,height:A}=t.toGlobal(z.getRenderWidth(),m),l=1/z.getHardwareScalingLevel();return w=w*l-e,q=q*l-(m-y-A),o.update(w,q,L,A,R||S.Matrix.IdentityReadOnly,i?S.Matrix.IdentityReadOnly:r.getViewMatrix(),r.getProjectionMatrix(),T),g}function l(g,w,q,R,o){if(!z.b)return g;const r=g.getEngine();if(!o&&!(o=g.activeCamera))throw new Error("Active camera not set");const i=o.viewport,T=r.getRenderHeight(),{x:t,y:m,width:e,height:y}=i.toGlobal(r.getRenderWidth(),T),L=S.Matrix.Identity(),A=1/r.getHardwareScalingLevel();return w=w*A-t,q=q*A-(T-m-y),R.update(w,q,e,y,L,L,o.getProjectionMatrix()),g}function J(g,w,q,R,o,r,S,i){const T=w(R,q.enableDistantPicking),z=q.intersects(T,o,S,r,R,i);return z&&z.hit?!o&&null!=g&&z.distance>=g.distance?null:z:null}function x(g,w,q,R,o,r){let i=null;const T=!!(g.activeCameras&&g.activeCameras.length>1&&g.cameraToUseForPointers!==g.activeCamera),t=g.cameraToUseForPointers||g.activeCamera,m=e.internalPickerForMesh||J;for(let z=0;z<g.meshes.length;z++){const e=g.meshes[z];if(q){if(!q(e,-1))continue}else if(!e.isEnabled()||!e.isVisible||!e.jT)continue;const y=T&&e.isWorldMatrixCameraDependent(),L=e.ii(y,t);if(e.hasThinInstances&&e.thinInstanceEnablePicking){const g=m(i,w,e,L,!0,!0,r);if(g){if(o)return g;const T=S.TmpVectors.Matrix[1],z=e.thinInstanceGetWorldMatrices();for(let g=0;g<z.length;g++){if(q&&!q(e,g))continue;z[g].multiplyToRef(L,T);const S=m(i,w,e,T,R,o,r,!0);if(S&&(i=S,i.thinInstanceIndex=g,R))return i}}}else{const g=m(i,w,e,L,R,o,r);if(g&&(i=g,R))return i}}return i||new z.b}function G(g,w,q,R){if(!z.b)return null;const o=[],r=!!(g.activeCameras&&g.activeCameras.length>1&&g.cameraToUseForPointers!==g.activeCamera),i=g.cameraToUseForPointers||g.activeCamera,T=e.internalPickerForMesh||J;for(let z=0;z<g.meshes.length;z++){const t=g.meshes[z];if(q){if(!q(t,-1))continue}else if(!t.isEnabled()||!t.isVisible||!t.jT)continue;const m=r&&t.isWorldMatrixCameraDependent(),e=t.ii(m,i);if(t.hasThinInstances&&t.thinInstanceEnablePicking){if(T(null,w,t,e,!0,!0,R)){const g=S.TmpVectors.Matrix[1],r=t.thinInstanceGetWorldMatrices();for(let S=0;S<r.length;S++){if(q&&!q(t,S))continue;r[S].multiplyToRef(e,g);const i=T(null,w,t,g,!1,!1,R,!0);i&&(i.thinInstanceIndex=S,o.push(i))}}}else{const g=T(null,w,t,e,!1,!1,R);g&&o.push(g)}}return o}function d(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,R=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;R||(R=g.getWorldMatrix()),w.length=q,o?w.origin.T(o):w.origin.T(g.position);const r=S.TmpVectors.ew[2];r.set(0,0,g._scene.useRightHandedSystem?-1:1);const i=S.TmpVectors.ew[3];return S.ew.TransformNormalToRef(r,R,i),S.ew.NormalizeToRef(i,w.direction),w}var D,U;y._TmpVector3=(0,i.e)(6,S.ew.Zero),y._RayDistant=y.Zero(),y._Smallnum=1e-8,y._Rayl=1e9,D=R.c,(U=o.b)&&(U.prototype.getForwardRay=function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,w=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;return d(this,new y(S.ew.Zero(),S.ew.Zero(),g),g,w,q)},U.prototype.getForwardRayToRef=function(g){return d(this,g,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),D&&(m.b._IsPickingAvailable=!0,D.prototype.createPickingRay=function(g,w,q,R){return L(this,g,w,q,R,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),R.c.prototype.createPickingRayToRef=function(g,w,q,R,o){return A(this,g,w,q,R,o,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},R.c.prototype.createPickingRayInCameraSpace=function(g,w,q){return function(g,w,q,R){const o=y.Zero();return l(g,w,q,o,R),o}(this,g,w,q)},R.c.prototype.createPickingRayInCameraSpaceToRef=function(g,w,q,R){return l(this,g,w,q,R)},R.c.prototype.pickWithBoundingInfo=function(g,w,q,R,o){return function(g,w,q,R,o,r){if(!z.b)return null;const i=x(g,(R=>(g._tempPickingRay||(g._tempPickingRay=y.Zero()),A(g,w,q,R,g._tempPickingRay,r||null),g._tempPickingRay)),R,o,!0);return i&&(i.ray=L(g,w,q,S.Matrix.Identity(),r||null)),i}(this,g,w,q,R,o)},R.c.prototype.mq=function(g,w,q,R,o,r){return function(g,w,q,R,o,r,i){const T=x(g,((R,o)=>(g._tempPickingRay||(g._tempPickingRay=y.Zero()),A(g,w,q,R,g._tempPickingRay,r||null,!1,o),g._tempPickingRay)),R,o,!1,i);return T&&(T.ray=L(g,w,q,S.Matrix.Identity(),r||null)),T}(this,g,w,q,R,o,r)},R.c.prototype.pickWithRay=function(g,w,q,R){return function(g,w,q,R,o){const r=x(g,(q=>(g._pickWithRayInverseMatrix||(g._pickWithRayInverseMatrix=S.Matrix.Identity()),q.invertToRef(g._pickWithRayInverseMatrix),g._cachedRayForTransform||(g._cachedRayForTransform=y.Zero()),y.TransformToRef(w,g._pickWithRayInverseMatrix,g._cachedRayForTransform),g._cachedRayForTransform)),q,R,!1,o);return r&&(r.ray=w),r}(this,g,w,q,R)},R.c.prototype.multiPick=function(g,w,q,R,o){return function(g,w,q,R,o,r){return G(g,(R=>L(g,w,q,R,o||null)),R,r)}(this,g,w,q,R,o)},R.c.prototype.multiPickWithRay=function(g,w,q){return function(g,w,q,R){return G(g,(q=>(g._pickWithRayInverseMatrix||(g._pickWithRayInverseMatrix=S.Matrix.Identity()),q.invertToRef(g._pickWithRayInverseMatrix),g._cachedRayForTransform||(g._cachedRayForTransform=y.Zero()),y.TransformToRef(w,g._pickWithRayInverseMatrix,g._cachedRayForTransform),g._cachedRayForTransform)),q,R)}(this,g,w,q)}},12792:(g,w,q)=>{"use strict";var R=q(11103),o=q(11011),r=q(11043),S=q(11136),i=q(11074),T=q(11118);i.b.prototype._partialLoadFile=function(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(g,(g=>{q[w]=g,q._internalCount++,6===q._internalCount&&R(q)}),void 0,void 0,!0,((g,w)=>{o&&g&&o(g.status+" "+g.statusText,w)}))},i.b.prototype._cascadeLoadFiles=function(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const o=[];o._internalCount=0;for(let r=0;r<6;r++)this._partialLoadFile(q[r],r,o,w,R)},i.b.prototype._cascadeLoadImgs=function(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5?arguments[5]:void 0;const S=[];S._internalCount=0;for(let i=0;i<6;i++)this._partialLoadImg(R[i],i,S,g,w,q,o,r)},i.b.prototype._partialLoadImg=function(g,w,q,R,o,i){let T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7?arguments[7]:void 0;const t=(0,S.c)();(0,r.n)(g,(g=>{q[w]=g,q._internalCount++,R&&R.removePendingData(t),6===q._internalCount&&i&&i(o,q)}),((g,w)=>{R&&R.removePendingData(t),T&&T(g,w)}),R?R.offlineProvider:null,z),R&&R.addPendingData(t)},i.b.prototype.createCubeTextureBase=function(g,w,q,r){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6?arguments[6]:void 0,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,m=arguments.length>8&&void 0!==arguments[8]&&arguments[8],e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,L=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,A=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,l=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,J=arguments.length>14&&void 0!==arguments[14]&&arguments[14],x=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const G=L||new R.d(this,7);G.isCube=!0,G.url=g,G.generateMipMaps=!r,G._lodGenerationScale=e,G._lodGenerationOffset=y,G._useSRGBBuffer=!!J&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!r),G!==L&&(G.label=g.substring(0,60)),this._doNotHandleContextLost||(G._extension=t,G._files=q,G._buffer=x);const d=g;this._transformTextureUrl&&!L&&(g=this._transformTextureUrl(g));const D=t??function(g){const w=g.split("?")[0],q=w.lastIndexOf(".");return q>-1?w.substring(q).toLowerCase():""}(g),U=(0,T.b)(D),N=(g,w)=>{G.dispose(),i?i(g,w):g&&o.d.Warn(g)},a=(R,i)=>{g===d?R&&N(R.status+" "+R.statusText,i):(o.d.Warn(`Failed to load ${g}, falling back to the ${d}`),this.createCubeTextureBase(d,w,q,!!r,S,N,z,t,m,e,y,G,A,l,J,x))};if(U)U.then((R=>{const o=g=>{A&&A(G,g),R.loadCubeData(g,G,m,S,((g,w)=>{N(g,w)}))};x?o(x):q&&6===q.length?R.supportCascades?this._cascadeLoadFiles(w,(g=>o(g.map((g=>new Uint8Array(g))))),q,N):N("Textures type does not support cascades."):this._loadFile(g,(g=>o(new Uint8Array(g))),void 0,void 0,!0,a)}));else{if(!q||0===q.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(w,G,((g,w)=>{l&&l(g,w)}),q,N)}return this._internalTexturesCache.push(G),G}},13333:(g,w,q)=>{"use strict";q(11011);var R=q(11291);q(11103),q(11256),q(11101),q(11330),q(11297);R.c},12828:(g,w,q)=>{"use strict";q.d(w,{b:()=>o});var R=q(11128);class o{constructor(g){this.value=this._toInt(g)}_toInt(g){return 0|g}add(g){return new o(this.value+g.value)}yw(g){return new o(this.value-g.value)}multiply(g){return new o(Math.imul(this.value,g.value))}divide(g){return new o(this.value/g.value)}getClassName(){return o.ClassName}equals(g){return this.value===g.value}static FromValue(g){return new o(g)}toString(){return this.value.toString()}}o.ClassName="FlowGraphInteger",(0,R.g)("FlowGraphInteger",o)},12842:(g,w,q)=>{"use strict";q.d(w,{d:()=>o,e:()=>r});var R=q(11180);class o{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.pS=g}get m(){return this.pS}transformVector(g){return this.transformVectorToRef(g,new R.Vector2)}transformVectorToRef(g,w){return w.x=g.x*this.pS[0]+g.y*this.pS[1],w.y=g.x*this.pS[2]+g.y*this.pS[3],w}qi(){return this.toArray()}toArray(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let w=0;w<4;w++)g[w]=this.pS[w];return g}yq(g){for(let w=0;w<4;w++)this.pS[w]=g[w];return this}multiplyToRef(g,w){const q=g.pS,R=this.pS,o=w.pS;return o[0]=q[0]*R[0]+q[1]*R[2],o[1]=q[0]*R[1]+q[1]*R[3],o[2]=q[2]*R[0]+q[3]*R[2],o[3]=q[2]*R[1]+q[3]*R[3],w}multiply(g){return this.multiplyToRef(g,new o)}divideToRef(g,w){const q=this.pS,R=g.pS,o=w.pS;return o[0]=q[0]/R[0],o[1]=q[1]/R[1],o[2]=q[2]/R[2],o[3]=q[3]/R[3],w}divide(g){return this.divideToRef(g,new o)}addToRef(g,w){const q=this.pS,R=g.m,o=w.m;return o[0]=q[0]+R[0],o[1]=q[1]+R[1],o[2]=q[2]+R[2],o[3]=q[3]+R[3],w}add(g){return this.addToRef(g,new o)}subtractToRef(g,w){const q=this.pS,R=g.m,o=w.m;return o[0]=q[0]-R[0],o[1]=q[1]-R[1],o[2]=q[2]-R[2],o[3]=q[3]-R[3],w}yw(g){return this.subtractToRef(g,new o)}transpose(){const g=this.pS;return new o([g[0],g[2],g[1],g[3]])}determinant(){const g=this.pS;return g[0]*g[3]-g[1]*g[2]}inverse(){const g=this.determinant();if(0===g)throw new Error("Matrix is not invertible");const w=this.pS,q=1/g;return new o([w[3]*q,-w[1]*q,-w[2]*q,w[0]*q])}equals(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const q=this.pS,R=g.m;return 0===w?q[0]===R[0]&&q[1]===R[1]&&q[2]===R[2]&&q[3]===R[3]:Math.abs(q[0]-R[0])<w&&Math.abs(q[1]-R[1])<w&&Math.abs(q[2]-R[2])<w&&Math.abs(q[3]-R[3])<w}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.pS.join(", ")})`}}class r{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.pS=g}get m(){return this.pS}transformVector(g){return this.transformVectorToRef(g,new R.ew)}transformVectorToRef(g,w){const q=this.pS;return w.x=g.x*q[0]+g.y*q[1]+g.z*q[2],w.y=g.x*q[3]+g.y*q[4]+g.z*q[5],w.z=g.x*q[6]+g.y*q[7]+g.z*q[8],w}multiplyToRef(g,w){const q=g.pS,R=this.pS,o=w.m;return o[0]=q[0]*R[0]+q[1]*R[3]+q[2]*R[6],o[1]=q[0]*R[1]+q[1]*R[4]+q[2]*R[7],o[2]=q[0]*R[2]+q[1]*R[5]+q[2]*R[8],o[3]=q[3]*R[0]+q[4]*R[3]+q[5]*R[6],o[4]=q[3]*R[1]+q[4]*R[4]+q[5]*R[7],o[5]=q[3]*R[2]+q[4]*R[5]+q[5]*R[8],o[6]=q[6]*R[0]+q[7]*R[3]+q[8]*R[6],o[7]=q[6]*R[1]+q[7]*R[4]+q[8]*R[7],o[8]=q[6]*R[2]+q[7]*R[5]+q[8]*R[8],w}multiply(g){return this.multiplyToRef(g,new r)}divideToRef(g,w){const q=this.pS,R=g.m,o=w.m;return o[0]=q[0]/R[0],o[1]=q[1]/R[1],o[2]=q[2]/R[2],o[3]=q[3]/R[3],o[4]=q[4]/R[4],o[5]=q[5]/R[5],o[6]=q[6]/R[6],o[7]=q[7]/R[7],o[8]=q[8]/R[8],w}divide(g){return this.divideToRef(g,new r)}addToRef(g,w){const q=this.pS,R=g.m,o=w.m;return o[0]=q[0]+R[0],o[1]=q[1]+R[1],o[2]=q[2]+R[2],o[3]=q[3]+R[3],o[4]=q[4]+R[4],o[5]=q[5]+R[5],o[6]=q[6]+R[6],o[7]=q[7]+R[7],o[8]=q[8]+R[8],w}add(g){return this.addToRef(g,new r)}subtractToRef(g,w){const q=this.pS,R=g.m,o=w.m;return o[0]=q[0]-R[0],o[1]=q[1]-R[1],o[2]=q[2]-R[2],o[3]=q[3]-R[3],o[4]=q[4]-R[4],o[5]=q[5]-R[5],o[6]=q[6]-R[6],o[7]=q[7]-R[7],o[8]=q[8]-R[8],w}yw(g){return this.subtractToRef(g,new r)}toArray(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let w=0;w<9;w++)g[w]=this.pS[w];return g}qi(){return this.toArray()}yq(g){for(let w=0;w<9;w++)this.pS[w]=g[w];return this}transpose(){const g=this.pS;return new r([g[0],g[3],g[6],g[1],g[4],g[7],g[2],g[5],g[8]])}determinant(){const g=this.pS;return g[0]*(g[4]*g[8]-g[5]*g[7])-g[1]*(g[3]*g[8]-g[5]*g[6])+g[2]*(g[3]*g[7]-g[4]*g[6])}inverse(){const g=this.determinant();if(0===g)throw new Error("Matrix is not invertible");const w=this.pS,q=1/g;return new r([(w[4]*w[8]-w[5]*w[7])*q,(w[2]*w[7]-w[1]*w[8])*q,(w[1]*w[5]-w[2]*w[4])*q,(w[5]*w[6]-w[3]*w[8])*q,(w[0]*w[8]-w[2]*w[6])*q,(w[2]*w[3]-w[0]*w[5])*q,(w[3]*w[7]-w[4]*w[6])*q,(w[1]*w[6]-w[0]*w[7])*q,(w[0]*w[4]-w[1]*w[3])*q])}equals(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const q=this.pS,R=g.m;return 0===w?q[0]===R[0]&&q[1]===R[1]&&q[2]===R[2]&&q[3]===R[3]&&q[4]===R[4]&&q[5]===R[5]&&q[6]===R[6]&&q[7]===R[7]&&q[8]===R[8]:Math.abs(q[0]-R[0])<w&&Math.abs(q[1]-R[1])<w&&Math.abs(q[2]-R[2])<w&&Math.abs(q[3]-R[3])<w&&Math.abs(q[4]-R[4])<w&&Math.abs(q[5]-R[5])<w&&Math.abs(q[6]-R[6])<w&&Math.abs(q[7]-R[7])<w&&Math.abs(q[8]-R[8])<w}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.pS.join(", ")})`}}},12846:(g,w,q)=>{"use strict";var R;function o(g,w,q,R){switch(w){case"Animation":return R?g.animations.find((g=>g.uniqueId===q))??null:g.animations[q]??null;case"AnimationGroup":return R?g.animationGroups.find((g=>g.uniqueId===q))??null:g.animationGroups[q]??null;case"Mesh":return R?g.meshes.find((g=>g.uniqueId===q))??null:g.meshes[q]??null;case"Material":return R?g.materials.find((g=>g.uniqueId===q))??null:g.materials[q]??null;case"gt":return R?g.cameras.find((g=>g.uniqueId===q))??null:g.cameras[q]??null;case"Light":return R?g.lights.find((g=>g.uniqueId===q))??null:g.lights[q]??null;default:return null}}q.d(w,{c:()=>o}),function(g){g.Animation="Animation",g.AnimationGroup="AnimationGroup",g.Mesh="Mesh",g.Material="Material",g.gt="gt",g.Light="Light"}(R||(R={}))},12877:(g,w,q)=>{"use strict";q.d(w,{b:()=>o});var R=q(12879);class o extends R.c{constructor(g,w){if(super(g),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),w)for(const q of w)this._eventsSignalOutputs[q]=this._registerSignalOutput(q+"Event")}_executeOnTick(g){}_startPendingTasks(g){g._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(g),this._resetAfterCanceled(g)),this._preparePendingTasks(g),g._addPendingBlock(this),this.out._activateSignal(g),g._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(g){g._deleteExecutionVariable(this,"_initialized"),g._removePendingBlock(this)}}},12863:(g,w,q)=>{"use strict";q.d(w,{e:()=>z});var R=q(11136),o=q(11128),r=q(12870),S=q(10998),i=q(12820);class T extends r.e{constructor(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:R.defaultValue,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(g,w,q),this.richType=R,this._defaultValue=o,this._optional=r,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new S.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(g){this._isDisabled!==g&&(this._isDisabled=g,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(g,w){w._getConnectionValue(this)!==g&&(w._setConnectionValue(this,g),this.onValueChangedObservable.notifyObservers(g))}resetToDefaultValue(g){g._setConnectionValue(this,this._defaultValue)}connectTo(g){this._isDisabled||super.connectTo(g)}_getValueOrDefault(g){const w=g._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(w):w}getValue(g){if(1===this.connectionType){g._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(g);const w=this._getValueOrDefault(g);return this._lastValue=w,this.richType.typeTransformer?this.richType.typeTransformer(w):w}const w=this.isConnected()?this._connectedPoint[0].getValue(g):this._getValueOrDefault(g);return this._lastValue=w,this.richType.typeTransformer?this.richType.typeTransformer(w):w}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(g),g.richType={},this.richType.serialize(g.richType),g.optional=this._optional,(0,i.h)("defaultValue",this._defaultValue,g)}}(0,o.g)("FlowGraphDataConnection",T);class z{constructor(g){var w;this.config=g,this.uniqueId=(0,R.c)(),this.name=(null===(w=this.config)||void 0===w?void 0:w.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(g){}registerDataInput(g,w,q){const R=new T(g,0,this,w,q);return this.dataInputs.push(R),R}registerDataOutput(g,w,q){const R=new T(g,1,this,w,q);return this.dataOutputs.push(R),R}getDataInput(g){return this.dataInputs.find((w=>w.name===g))}getDataOutput(g){return this.dataOutputs.find((w=>w.name===g))}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.h;if(g.uniqueId=this.uniqueId,g.config={},this.config){const q=this.config,R=Object.keys(q);for(const o of R)w(o,q[o],g.config)}g.dataInputs=[],g.dataOutputs=[],g.className=this.getClassName();for(const q of this.dataInputs){const w={};q.serialize(w),g.dataInputs.push(w)}for(const q of this.dataOutputs){const w={};q.serialize(w),g.dataOutputs.push(w)}}deserialize(g){}_log(g,w,q){var R;null===(R=g.logger)||void 0===R||R.addLogItem({action:w,payload:q,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12870:(g,w,q)=>{"use strict";q.d(w,{e:()=>r});var R,o=q(11136);!function(g){g[g.Input=0]="Input",g[g.Output=1]="Output"}(R||(R={}));class r{constructor(g,w,q){this._ownerBlock=q,this._connectedPoint=[],this.uniqueId=(0,o.c)(),this.connectedPointIds=[],this.name=g,this._connectionType=w}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(g){if(this._connectionType===g._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||g._isSingularConnection()&&g._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(g),g._connectedPoint.push(this)}disconnectFrom(g){let w=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const q=this._connectedPoint.indexOf(g),R=g._connectedPoint.indexOf(this);-1!==q&&-1!==R&&(w&&this._connectedPoint.splice(q,1),g._connectedPoint.splice(R,1))}disconnectFromAll(){for(const g of this._connectedPoint)this.disconnectFrom(g,!1);this._connectedPoint.length=0}dispose(){for(const g of this._connectedPoint)this.disconnectFrom(g)}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};g.uniqueId=this.uniqueId,g.name=this.name,g._connectionType=this._connectionType,g.connectedPointIds=[],g.className=this.getClassName();for(const w of this._connectedPoint)g.connectedPointIds.push(w.uniqueId)}getClassName(){return"FGConnection"}deserialize(g){this.uniqueId=g.uniqueId,this.name=g.name,this._connectionType=g._connectionType,this.connectedPointIds=g.connectedPointIds}}},12814:(g,w,q)=>{"use strict";q.d(w,{b:()=>G});var R,o=q(10998),r=q(11161),S=q(11170),i=q(11136),T=q(12820),z=q(12846),t=q(11011);!function(g){g.ExecuteBlock="ExecuteBlock",g.ExecuteEvent="ExecuteEvent",g.TriggerConnection="TriggerConnection",g.ContextVariableSet="ContextVariableSet",g.GlobalVariableSet="GlobalVariableSet",g.GlobalVariableDelete="GlobalVariableDelete",g.GlobalVariableGet="GlobalVariableGet",g.AddConnection="AddConnection",g.GetConnectionValue="GetConnectionValue",g.SetConnectionValue="SetConnectionValue",g.ActivateSignal="ActivateSignal",g.ContextVariableGet="ContextVariableGet"}(R||(R={}));class m{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(g){if(g.time||(g.time=Date.now()),this.log.push(g),this.logToConsole){var w;const q=null===(w=g.payload)||void 0===w?void 0:w.value;"object"===typeof q&&q.getClassName?t.d.Log(`[FGLog] ${g.className}:${g.uniqueId.split("-")[0]} ${g.action} - ${JSON.stringify(q.getClassName())}: ${q.toString()}`):t.d.Log(`[FGLog] ${g.className}:${g.uniqueId.split("-")[0]} ${g.action} - ${JSON.stringify(g.payload)}`)}}getItemsOfType(g){return this.log.filter((w=>w.action===g))}}class e{get enableLogging(){return this._enableLogging}set enableLogging(g){this._enableLogging!==g&&(this._enableLogging=g,this._enableLogging?(this.logger=new m,this.logger.logToConsole=!0):this.logger=null)}constructor(g){this.uniqueId=(0,i.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new o.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=g,this.assetsContext=g.assetsContext??g.Aw}hasVariable(g){return g in this._userVariables}setVariable(g,w){var q;this._userVariables[g]=w,null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:g,value:w}})}getAsset(g,w){return(0,z.c)(this.assetsContext,g,w)}getVariable(g){var w;return null===(w=this.logger)||void 0===w||w.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:g,value:this._userVariables[g]}}),this._userVariables[g]}get userVariables(){return this._userVariables}Ng(){return this._configuration.Aw}_getUniqueIdPrefixedName(g,w){return`${g.uniqueId}_${w}`}_getGlobalContextVariable(g,w){var q;return null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:g,defaultValue:w,possibleValue:this._globalContextVariables[g]}}),this._hasGlobalContextVariable(g)?this._globalContextVariables[g]:w}_setGlobalContextVariable(g,w){var q;null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:g,value:w}}),this._globalContextVariables[g]=w}_deleteGlobalContextVariable(g){var w;null===(w=this.logger)||void 0===w||w.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:g}}),delete this._globalContextVariables[g]}_hasGlobalContextVariable(g){return g in this._globalContextVariables}_setExecutionVariable(g,w,q){this._executionVariables[this._getUniqueIdPrefixedName(g,w)]=q}_getExecutionVariable(g,w,q){return this._hasExecutionVariable(g,w)?this._executionVariables[this._getUniqueIdPrefixedName(g,w)]:q}_deleteExecutionVariable(g,w){delete this._executionVariables[this._getUniqueIdPrefixedName(g,w)]}_hasExecutionVariable(g,w){return this._getUniqueIdPrefixedName(g,w)in this._executionVariables}_hasConnectionValue(g){return g.uniqueId in this._connectionValues}_setConnectionValue(g,w){var q;this._connectionValues[g.uniqueId]=w,null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:g.uniqueId,value:w}})}_setConnectionValueByKey(g,w){this._connectionValues[g]=w}_getConnectionValue(g){var w;return null===(w=this.logger)||void 0===w||w.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:g.uniqueId,value:this._connectionValues[g.uniqueId]}}),this._connectionValues[g.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(g){this._pendingBlocks.includes(g)||(this._pendingBlocks.push(g),this._pendingBlocks.sort(((g,w)=>g.priority-w.priority)))}_removePendingBlock(g){const w=this._pendingBlocks.indexOf(g);-1!==w&&this._pendingBlocks.splice(w,1)}_clearPendingBlocks(){for(const g of this._pendingBlocks)g._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(g){var w;this.onNodeExecutedObservable.notifyObservers(g),null===(w=this.logger)||void 0===w||w.addLogItem({time:Date.now(),className:g.getClassName(),uniqueId:g.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(g){this._setGlobalContextVariable("timeSinceStart",g.timeSinceStart),this._setGlobalContextVariable("deltaTime",g.deltaTime);for(const q of this._pendingBlocks){var w;null===(w=q._executeOnTick)||void 0===w||w.call(q,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.h;g.uniqueId=this.uniqueId,g._userVariables={};for(const R in this._userVariables)w(R,this._userVariables[R],g._userVariables);g._connectionValues={};for(const R in this._connectionValues)w(R,this._connectionValues[R],g._connectionValues);var q;this.assetsContext!==this.Ng()&&(g._assetsContext={meshes:this.assetsContext.meshes.map((g=>g.id)),materials:this.assetsContext.materials.map((g=>g.id)),textures:this.assetsContext.textures.map((g=>g.name)),animations:this.assetsContext.animations.map((g=>g.name)),lights:this.assetsContext.lights.map((g=>g.id)),cameras:this.assetsContext.cameras.map((g=>g.id)),Ke:null===(q=this.assetsContext.Ke)||void 0===q?void 0:q.map((g=>g.name)),skeletons:this.assetsContext.skeletons.map((g=>g.id)),Ym:this.assetsContext.Ym.map((g=>g.name)),geometries:this.assetsContext.geometries.map((g=>g.id)),multiMaterials:this.assetsContext.multiMaterials.map((g=>g.id)),transformNodes:this.assetsContext.transformNodes.map((g=>g.id))})}getClassName(){return"FlowGraphContext"}}(0,r.e)([(0,S.K)()],e.prototype,"uniqueId",void 0);var y=q(12855),L=q(11424);class A{constructor(g){this.onEventTriggeredObservable=new o.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=g,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.WS.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const g=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:g}}),this._startingTime+=g})),this._meshPickedObserver=this._scene.onPointerObservable.add((g=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:g})}),L.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((g=>{const w=g.pointerId,q=g.mesh,R=this._pointerUnderMeshState[w];!R&&q?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:w,mesh:q}}):R&&!q?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:w,mesh:R}}):R&&q&&R!==q&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:w,mesh:R,over:q}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:w,mesh:q,out:R}})),this._pointerUnderMeshState[w]=q}),L.e.POINTERMOVE)}dispose(){var g,w,q,R,o;null===(g=this._sceneDisposeObserver)||void 0===g||g.remove(),null===(w=this._sceneReadyObserver)||void 0===w||w.remove(),null===(q=this._sceneOnBeforeRenderObserver)||void 0===q||q.remove(),null===(R=this._meshPickedObserver)||void 0===R||R.remove(),null===(o=this._meshUnderPointerObserver)||void 0===o||o.remove(),this.onEventTriggeredObservable.clear()}}var l,J=q(12872);!function(g){g[g.Stopped=0]="Stopped",g[g.Started=1]="Started"}(l||(l={}));class x{get state(){return this._state}set state(g){this._state=g,this.onStateChangedObservable.notifyObservers(g)}constructor(g){this.onStateChangedObservable=new o.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=g.Aw,this._sceneEventCoordinator=new A(this._scene),this._coordinator=g.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((g=>{for(const w of this._executionContexts){const q=this._getContextualOrder(g.type,w);for(const R of q)if(!R._executeEvent(w,g.payload))break}switch(g.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const w of this._executionContexts)w._notifyOnTick(g.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const g=new e({Aw:this._scene,coordinator:this._coordinator});return this._executionContexts.push(g),g}getContext(g){return this._executionContexts[g]}addEventBlock(g){if("PointerOver"!==g.type&&"PointerOut"!==g.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==g.type&&this._eventBlocks[g.type].push(g),1===this.state)for(const w of this._executionContexts)g._startPendingTasks(w);else this.onStateChangedObservable.addOnce((w=>{if(1===w)for(const q of this._executionContexts)g._startPendingTasks(q)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((g=>{1===g&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const g of this._executionContexts)for(const w in this._eventBlocks){const q=this._getContextualOrder(w,g);for(const w of q)w._startPendingTasks(g)}}_getContextualOrder(g,w){const q=this._eventBlocks[g].sort(((g,w)=>w.initPriority-g.initPriority));if("MeshPick"===g){const g=[];for(const R of q){const o=R.asset.getValue(w);let r=0;for(;r<q.length;r++){const g=q[r].asset.getValue(w);if(o&&g&&(0,J.k)(o,g))break}g.splice(r,0,R)}return g}return q}dispose(){var g;if(0!==this.state){this.state=0;for(const g of this._executionContexts)g._clearPendingBlocks();this._executionContexts.length=0;for(const g in this._eventBlocks)this._eventBlocks[g].length=0;null===(g=this._eventObserver)||void 0===g||g.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(g){const w=[],q=new Set;for(const R in this._eventBlocks)for(const g of this._eventBlocks[R])w.push(g),q.add(g.uniqueId);for(;w.length>0;){const R=w.pop();g(R);for(const g of R.dataInputs)for(const R of g._connectedPoint)q.has(R._ownerBlock.uniqueId)||(w.push(R._ownerBlock),q.add(R._ownerBlock.uniqueId));if(R instanceof y.d)for(const g of R.signalOutputs)for(const R of g._connectedPoint)q.has(R._ownerBlock.uniqueId)||(w.push(R._ownerBlock),q.add(R._ownerBlock.uniqueId))}}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},w=arguments.length>1?arguments[1]:void 0;g.allBlocks=[],this.visitAllBlocks((w=>{const q={};w.serialize(q),g.allBlocks.push(q)})),g.executionContexts=[];for(const q of this._executionContexts){const R={};q.serialize(R,w),g.executionContexts.push(R)}}}class G{constructor(g){this.config=g,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Aw.WS.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Aw.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const g=this._executeOnNextFrame.slice(0);if(g.length)for(const w of g){this.notifyCustomEvent(w.id,w.data,!1);const g=this._executeOnNextFrame.findIndex((g=>g.uniqueId===w.uniqueId));-1!==g&&this._executeOnNextFrame.splice(g,1)}}));(G.SceneCoordinators.get(this.config.Aw)??[]).push(this)}createGraph(){const g=new x({Aw:this.config.Aw,coordinator:this});return this._flowGraphs.push(g),g}removeGraph(g){const w=this._flowGraphs.indexOf(g);-1!==w&&(g.dispose(),this._flowGraphs.splice(w,1))}start(){for(const g of this._flowGraphs)g.start()}dispose(){var g,w;for(const o of this._flowGraphs)o.dispose();this._flowGraphs.length=0,null===(g=this._disposeObserver)||void 0===g||g.remove(),null===(w=this._onBeforeRenderObserver)||void 0===w||w.remove();const q=G.SceneCoordinators.get(this.config.Aw)??[],R=q.indexOf(this);-1!==R&&q.splice(R,1)}serialize(g,w){g._flowGraphs=[];for(const q of this._flowGraphs){const R={};q.serialize(R,w),g._flowGraphs.push(R)}g.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(g){let w=this._customEventsMap.get(g);return w||(w=new o.b,this._customEventsMap.set(g,w)),w}notifyCustomEvent(g,w){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:g,data:w,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(g)){const w=this._eventExecutionCounter.get(g);if(this._eventExecutionCounter.set(g,w+1),w>=G.MaxEventTypeExecutionPerFrame)return void(w===G.MaxEventTypeExecutionPerFrame&&t.d.Warn(`FlowGraphCoordinator: Too many executions of event "${g}".`))}else this._eventExecutionCounter.set(g,1);const q=this._customEventsMap.get(g);q&&q.notifyObservers(w)}}G.MaxEventsPerType=30,G.MaxEventTypeExecutionPerFrame=30,G.SceneCoordinators=new Map},12875:(g,w,q)=>{"use strict";q.d(w,{c:()=>o});var R=q(12877);class o extends R.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(g){g._notifyExecuteNode(this),this.done._activateSignal(g)}}},12855:(g,w,q)=>{"use strict";q.d(w,{d:()=>i});var R=q(12863),o=q(12870),r=q(11128);class S extends o.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(g){super.connectTo(g),this._connectedPoint.sort(((g,w)=>w.priority-g.priority))}_activateSignal(g){var w;if(null===(w=g.logger)||void 0===w||w.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)g._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(g,this),g._increaseExecutionId();else for(const q of this._connectedPoint)q._activateSignal(g)}}(0,r.g)("FlowGraphSignalConnection",S);class i extends R.e{constructor(g){super(g),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(g){const w=new S(g,0,this);return this.signalInputs.push(w),w}_registerSignalOutput(g){const w=new S(g,1,this);return this.signalOutputs.push(w),w}_unregisterSignalInput(g){const w=this.signalInputs.findIndex((w=>w.name===g));-1!==w&&(this.signalInputs[w].dispose(),this.signalInputs.splice(w,1))}_unregisterSignalOutput(g){const w=this.signalOutputs.findIndex((w=>w.name===g));-1!==w&&(this.signalOutputs[w].dispose(),this.signalOutputs.splice(w,1))}_reportError(g,w){this.error.payload="string"===typeof w?new Error(w):w,this.error._activateSignal(g)}getSignalInput(g){return this.signalInputs.find((w=>w.name===g))}getSignalOutput(g){return this.signalOutputs.find((w=>w.name===g))}serialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(g),g.signalInputs=[],g.signalOutputs=[];for(const w of this.signalInputs){const q={};w.serialize(q),g.signalInputs.push(q)}for(const w of this.signalOutputs){const q={};w.serialize(q),g.signalOutputs.push(q)}}deserialize(g){for(let w=0;w<g.signalInputs.length;w++){const q=this.getSignalInput(g.signalInputs[w].name);if(!q)throw new Error("Could not find signal input with name "+g.signalInputs[w].name+" in block "+g.className);q.deserialize(g.signalInputs[w])}for(let w=0;w<g.signalOutputs.length;w++){const q=this.getSignalOutput(g.signalOutputs[w].name);if(!q)throw new Error("Could not find signal output with name "+g.signalOutputs[w].name+" in block "+g.className);q.deserialize(g.signalOutputs[w])}}getClassName(){return"FlowGraphExecutionBlock"}}},12879:(g,w,q)=>{"use strict";q.d(w,{c:()=>o});var R=q(12855);class o extends R.d{constructor(g){super(g),this.out=this._registerSignalOutput("out")}}},12836:(g,w,q)=>{"use strict";q.d(w,{C:()=>t,G:()=>y,H:()=>L,J:()=>A,M:()=>H,Q:()=>C,S:()=>a,U:()=>N,d:()=>z,h:()=>e,l:()=>U,o:()=>l,q:()=>J,t:()=>x,w:()=>m,z:()=>D});var R,o=q(11180),r=q(11235),S=q(12828),i=q(12842);!function(g){g.Any="any",g.String="string",g.Number="number",g.Boolean="boolean",g.Object="object",g.Integer="FlowGraphInteger",g.Vector2="Vector2",g.ew="ew",g.Vector4="Vector4",g.Quaternion="Quaternion",g.Matrix="Matrix",g.Matrix2D="Matrix2D",g.Matrix3D="Matrix3D",g.Jw="Jw",g.ci="ci"}(R||(R={}));class T{constructor(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=g,this.defaultValue=w,this.animationType=q}serialize(g){g.typeName=this.typeName,g.defaultValue=this.defaultValue}}const z=new T("any",void 0),t=new T("string",""),m=new T("number",0,0),e=new T("boolean",!1),y=new T("Vector2",o.Vector2.Zero(),5),L=new T("ew",o.ew.Zero(),1),A=new T("Vector4",o.Vector4.Zero()),l=new T("Matrix",o.Matrix.Identity(),3),J=new T("Matrix2D",new i.d),x=new T("Matrix3D",new i.e),G=new T("Jw",r.Jw.Black(),4),d=new T("ci",new r.d(0,0,0,0),7),D=new T("Quaternion",o.Quaternion.Identity(),2);D.typeTransformer=g=>{if(g.getClassName){if("Vector4"===g.getClassName())return o.Quaternion.Ri(g.qi());if("ew"===g.getClassName())return o.Quaternion.FromEulerVector(g);if("Matrix"===g.getClassName())return o.Quaternion.FromRotationMatrix(g)}return g};const U=new T("FlowGraphInteger",new S.b(0),0);function N(g){const w=g;switch(typeof g){case"string":return t;case"number":return m;case"boolean":return e;case"object":if(w.getClassName)switch(w.getClassName()){case"Vector2":return y;case"ew":return L;case"Vector4":return A;case"Matrix":return l;case"Jw":return G;case"ci":return d;case"Quaternion":return D;case"FlowGraphInteger":return U;case"Matrix2D":return J;case"Matrix3D":return x}return z;default:return z}}function a(g){switch(g){case"string":return t;case"number":return m;case"boolean":return e;case"Vector2":return y;case"ew":return L;case"Vector4":return A;case"Matrix":return l;case"Jw":return G;case"ci":return d;case"Quaternion":return D;case"FlowGraphInteger":return U;case"Matrix2D":return J;case"Matrix3D":return x;default:return z}}function H(g){switch(g){case"number":default:return 0;case"Vector2":return 5;case"ew":return 1;case"Matrix":return 3;case"Jw":return 4;case"ci":return 7;case"Quaternion":return 2}}function C(g){switch(g){case 0:return m;case 5:return y;case 1:return L;case 3:return l;case 4:return G;case 7:return d;case 2:return D;default:return z}}},12820:(g,w,q)=>{"use strict";q.d(w,{d:()=>t,h:()=>z,l:()=>m});var R=q(11235),o=q(11180),r=q(12828),S=q(12836),i=q(12842);function T(g){return"Vector2"===g||"ew"===g||"Vector4"===g||"Quaternion"===g||"Jw"===g||"ci"===g}function z(g,w,q){var R;const o=(null===w||void 0===w||null===(R=w.getClassName)||void 0===R?void 0:R.call(w))??"";if(T(o)||function(g){return"Matrix"===g||"Matrix2D"===g||"Matrix3D"===g}(o))q[g]={value:w.qi(),className:o};else if("FlowGraphInteger"===o)q[g]={value:w.value,className:o};else if(o&&(w.id||w.name))q[g]={id:w.id,name:w.name,className:o};else{if("object"===typeof w)throw new Error(`Could not serialize value ${w}`);q[g]=w}}function t(g,w,q,z){const m=w[g];let e;const y=(null===m||void 0===m?void 0:m.type)??(null===m||void 0===m?void 0:m.className);if(function(g){return"Mesh"===g||"AbstractMesh"===g||"GroundMesh"===g||"InstanceMesh"===g||"LinesMesh"===g||"GoldbergMesh"===g||"GreasedLineMesh"===g||"TrailMesh"===g}(y)){let g=z.meshes.filter((g=>m.id?g.id===m.id:g.name===m.name));0===g.length&&(g=z.transformNodes.filter((g=>m.id?g.id===m.id:g.name===m.name))),e=m.uniqueId?g.find((g=>g.uniqueId===m.uniqueId)):g[0]}else if(T(y))e=function(g,w){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===g)return o.Vector2.Ri(w);if("ew"===g)return q&&(w[2]*=-1),o.ew.Ri(w);if("Vector4"===g)return o.Vector4.Ri(w);if("Quaternion"===g)return q&&(w[2]*=-1,w[3]*=-1),o.Quaternion.Ri(w);if("Jw"===g)return new R.Jw(w[0],w[1],w[2]);if("ci"===g)return new R.d(w[0],w[1],w[2],w[3]);throw new Error(`Unknown vector class name ${g}`)}(y,m.value);else if(function(g){return"AnimationGroup"===g}(y)){const g=z.animationGroups.filter((g=>g.name===m.name));e=1===g.length?g[0]:g.find((g=>g.uniqueId===m.uniqueId))}else e="Matrix"===y?o.Matrix.Ri(m.value):"Matrix2D"===y?new i.d(m.value):"Matrix3D"===y?new i.e(m.value):"FlowGraphInteger"===y?r.b.FromValue(m.value):"number"===y||"string"===y||"boolean"===y?m.value[0]:m&&void 0!==m.value?m.value:Array.isArray(m)?m.reduce(((g,w)=>w.eventData?(g[w.id]={type:(0,S.S)(w.type)},"undefined"!==typeof w.value&&(g[w.id].value=t("value",w,q,z)),g):g),{}):m;return e}function m(g){return"FlowGraphJsonPointerParserBlock"===g}},12872:(g,w,q)=>{"use strict";function R(g,w){return!(!g.parent||g.parent!==w&&!R(g.parent,w))}function o(g){if(g.getClassName)return g.getClassName()}function r(g,w){return g===w&&("Vector2"===g||"ew"===g||"Vector4"===g||"Quaternion"===g)}function S(g,w){return g===w&&("Matrix"===g||"Matrix2D"===g||"Matrix3D"===g)}function i(g,w){return"FlowGraphInteger"===g&&"FlowGraphInteger"===w}function T(g,w){const q="number"===typeof g||"number"===typeof(null===g||void 0===g?void 0:g.value);return q&&!w?!isNaN(z(g)):q}function z(g){return"number"===typeof g?g:g.value}q.d(w,{b:()=>i,d:()=>S,f:()=>r,i:()=>o,k:()=>R,o:()=>z,r:()=>T})},12214:(g,w,q)=>{"use strict";q.r(w),q.d(w,{SceneInstrumentation:()=>r});var R=q(10991),o=q(11374);class r{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(g){g!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=g,g?(this._onBeforeActiveMeshesEvaluationObserver=this.Aw.onBeforeActiveMeshesEvaluationObservable.add((()=>{R.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Aw.onAfterActiveMeshesEvaluationObservable.add((()=>{R.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Aw.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Aw.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(g){g!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=g,g?(this._onBeforeRenderTargetsRenderObserver=this.Aw.onBeforeRenderTargetsRenderObservable.add((()=>{R.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Aw.onAfterRenderTargetsRenderObservable.add((()=>{R.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Aw.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Aw.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(g){g!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=g,g?(this._onBeforeParticlesRenderingObserver=this.Aw.onBeforeParticlesRenderingObservable.add((()=>{R.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Aw.onAfterParticlesRenderingObservable.add((()=>{R.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Aw.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Aw.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(g){g!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=g,this.Aw.spriteManagers&&(g?(this._onBeforeSpritesRenderingObserver=this.Aw.onBeforeSpritesRenderingObservable.add((()=>{R.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Aw.onAfterSpritesRenderingObservable.add((()=>{R.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Aw.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Aw.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(g){g!==this._capturePhysicsTime&&this.Aw.onBeforePhysicsObservable&&(this._capturePhysicsTime=g,g?(this._onBeforePhysicsObserver=this.Aw.onBeforePhysicsObservable.add((()=>{R.Tools.StartPerformanceCounter("pz"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Aw.onAfterPhysicsObservable.add((()=>{R.Tools.EndPerformanceCounter("pz"),this._physicsTime.endMonitoring()}))):(this.Aw.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Aw.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(g){g!==this._captureAnimationsTime&&(this._captureAnimationsTime=g,g?this._onAfterAnimationsObserver=this.Aw.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Aw.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(g){this._captureFrameTime=g}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(g){this._captureInterFrameTime=g}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(g){g!==this._captureRenderTime&&(this._captureRenderTime=g,g?(this._onBeforeDrawPhaseObserver=this.Aw.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),R.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Aw.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),R.Tools.EndPerformanceCounter("Main render")}))):(this.Aw.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Aw.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(g){g!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=g,g?(this._onBeforeCameraRenderObserver=this.Aw.onBeforeCameraRenderObservable.add((g=>{this._cameraRenderTime.beginMonitoring(),R.Tools.StartPerformanceCounter(`Rendering camera ${g.name}`)})),this._onAfterCameraRenderObserver=this.Aw.onAfterCameraRenderObservable.add((g=>{this._cameraRenderTime.endMonitoring(!1),R.Tools.EndPerformanceCounter(`Rendering camera ${g.name}`)}))):(this.Aw.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Aw.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Aw.getEngine()._drawCalls}constructor(g){this.Aw=g,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new o.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new o.c,this._captureFrameTime=!1,this._frameTime=new o.c,this._captureRenderTime=!1,this._renderTime=new o.c,this._captureInterFrameTime=!1,this._interFrameTime=new o.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new o.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new o.c,this._capturePhysicsTime=!1,this._physicsTime=new o.c,this._captureAnimationsTime=!1,this._animationsTime=new o.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new o.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=g.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(R.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Aw.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=g.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(R.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.nS(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.nS(),this._captureParticlesRenderTime&&this._particlesRenderTime.nS(),this._captureSpritesRenderTime&&this._spritesRenderTime.nS(),this._captureRenderTime&&this._renderTime.nS(),this._captureCameraRenderTime&&this._cameraRenderTime.nS()}))}dispose(){this._disposed||(this.Aw.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Aw.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Aw.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Aw.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Aw.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Aw.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Aw.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Aw.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Aw.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Aw.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Aw.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Aw.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Aw.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Aw.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Aw.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Aw.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Aw.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Aw=null,this._disposed=!0)}}},12808:(g,w,q)=>{"use strict";q.d(w,{d:()=>t});var R=q(11161),o=q(11170),r=q(11180),S=q(11559),i=q(11670),T=q(11728),z=q(11128);S.b.AddNodeConstructor("Light_Type_1",((g,w)=>()=>new t(g,r.ew.Zero(),w)));class t extends T.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(g){this._shadowFrustumSize=g,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(g){this._shadowOrthoScale=g,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(g){this._orthoLeft=g}get orthoRight(){return this._orthoRight}set orthoRight(g){this._orthoRight=g}get orthoTop(){return this._orthoTop}set orthoTop(g){this._orthoTop=g}get orthoBottom(){return this._orthoBottom}set orthoBottom(g){this._orthoBottom=g}constructor(g,w,q){super(g,q),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=w.scale(-1),this.direction=w}getClassName(){return"tt"}getTypeID(){return i.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(g,w,q){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(g):this._setDefaultAutoExtendShadowProjectionMatrix(g,w,q)}_setDefaultFixedFrustumShadowProjectionMatrix(g){const w=this.Ng().activeCamera;w&&r.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:w.ri,void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ,g,this.Ng().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(g,w,q){const R=this.Ng().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const g=r.ew.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let R=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let S=0;S<q.length;S++){const i=q[S];if(!i)continue;const T=i.getBoundingInfo().boundingBox;for(let q=0;q<T.vectorsWorld.length;q++)r.ew.TransformCoordinatesToRef(T.vectorsWorld[q],w,g),g.x<this._orthoLeft&&(this._orthoLeft=g.x),g.y<this._orthoBottom&&(this._orthoBottom=g.y),g.x>this._orthoRight&&(this._orthoRight=g.x),g.y>this._orthoTop&&(this._orthoTop=g.y),this.autoCalcShadowZBounds&&(g.z<R&&(R=g.z),g.z>o&&(o=g.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=R,this._shadowMaxZ=o)}const o=this._orthoRight-this._orthoLeft,S=this._orthoTop-this._orthoBottom,i=void 0!==this.shadowMinZ?this.shadowMinZ:(null===R||void 0===R?void 0:R.ri)||0,T=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===R||void 0===R?void 0:R.maxZ)||1e4,z=this.Ng().getEngine().useReverseDepthBuffer;r.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-o*this.shadowOrthoScale,this._orthoRight+o*this.shadowOrthoScale,this._orthoBottom-S*this.shadowOrthoScale,this._orthoTop+S*this.shadowOrthoScale,z?T:i,z?i:T,g,this.Ng().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(g,w){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,w),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,w),this)}transferToNodeMaterialEffect(g,w){return this.computeTransformedInformation()?(g.setFloat3(w,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(g.setFloat3(w,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(g){const w=this._scene.getEngine();return!w.useReverseDepthBuffer&&w.isNDCHalfZRange?0:1}getDepthMaxZ(g){const w=this._scene.getEngine();return w.useReverseDepthBuffer&&w.isNDCHalfZRange?0:1}prepareLightSpecificDefines(g,w){g["DIRLIGHT"+w]=!0}}(0,R.e)([(0,o.K)()],t.prototype,"shadowFrustumSize",null),(0,R.e)([(0,o.K)()],t.prototype,"shadowOrthoScale",null),(0,R.e)([(0,o.K)()],t.prototype,"autoUpdateExtends",void 0),(0,R.e)([(0,o.K)()],t.prototype,"autoCalcShadowZBounds",void 0),(0,R.e)([(0,o.K)("orthoLeft")],t.prototype,"_orthoLeft",void 0),(0,R.e)([(0,o.K)("orthoRight")],t.prototype,"_orthoRight",void 0),(0,R.e)([(0,o.K)("orthoTop")],t.prototype,"_orthoTop",void 0),(0,R.e)([(0,o.K)("orthoBottom")],t.prototype,"_orthoBottom",void 0),(0,z.g)("BABYLON.DirectionalLight",t)},13275:(g,w,q)=>{"use strict";q.d(w,{b:()=>t});var R=q(11161),o=q(11170),r=q(11180),S=q(11235),i=q(11559),T=q(11670),z=q(11128);i.b.AddNodeConstructor("Light_Type_3",((g,w)=>()=>new t(g,r.ew.Zero(),w)));class t extends T.d{constructor(g,w,q){super(g,q),this.groundColor=new S.Jw(0,0,0),this.direction=w||r.ew.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ge"}setDirectionToTarget(g){return this.direction=r.ew.Normalize(g.yw(r.ew.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(g,w){const q=r.ew.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",q.x,q.y,q.z,0,w),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.li),w),this}transferToNodeMaterialEffect(g,w){const q=r.ew.Normalize(this.direction);return g.setFloat3(w,q.x,q.y,q.z),this}ii(){return this._worldMatrix||(this._worldMatrix=r.Matrix.Identity()),this._worldMatrix}getTypeID(){return T.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(g,w){g["HEMILIGHT"+w]=!0}}(0,R.e)([(0,o.j)()],t.prototype,"groundColor",void 0),(0,R.e)([(0,o.H)()],t.prototype,"direction",void 0),(0,z.g)("BABYLON.HemisphericLight",t)},12774:(g,w,q)=>{"use strict";q.d(w,{b:()=>m});var R=q(11161),o=q(11170),r=q(11180),S=q(11559),i=q(11670),T=q(11728),z=q(11152),t=q(11128);S.b.AddNodeConstructor("Light_Type_2",((g,w)=>()=>new m(g,r.ew.Zero(),r.ew.Zero(),0,0,w)));class m extends T.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(g){this._iesProfileTexture!==g&&(this._iesProfileTexture=g,this._iesProfileTexture&&m._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(g){this._angle=g,this._cosHalfAngle=Math.cos(.5*g),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(g){this._innerAngle=g,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(g){this._shadowAngleScale=g,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(g){this._projectionTextureLightNear=g,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(g){this._projectionTextureLightFar=g,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(g){this._projectionTextureUpDirection=g,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(g){this._projectionTexture!==g&&(this._projectionTexture=g,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(m._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):m._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(g){return void 0!==g.onGeneratedObservable}static _IsTexture(g){return void 0!==g.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(g){this._projectionTextureProjectionLightMatrix=g,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(g,w,q,R,o,S){super(g,S),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=r.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=r.ew.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=r.ew.Zero(),this._projectionTextureViewLightMatrix=r.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=r.Matrix.Zero(),this._projectionTextureScalingMatrix=r.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=w,this.direction=q,this.angle=R,this.exponent=o}getClassName(){return"SpotLight"}getTypeID(){return i.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(g){super._setDirection(g),this._projectionTextureViewLightDirty=!0}_setPosition(g){super._setPosition(g),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(g,w,q){const R=this.Ng().activeCamera;if(!R)return;this._shadowAngleScale=this._shadowAngleScale||1;const o=this._shadowAngleScale*this._angle,S=void 0!==this.shadowMinZ?this.shadowMinZ:R.ri,i=void 0!==this.shadowMaxZ?this.shadowMaxZ:R.maxZ,T=this.Ng().getEngine().useReverseDepthBuffer;r.Matrix.PerspectiveFovLHToRef(o,1,T?i:S,T?S:i,g,!0,this._scene.getEngine().isNDCHalfZRange,void 0,T)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),r.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const g=this.projectionTextureLightFar,w=this.projectionTextureLightNear,q=g/(g-w),R=-q*w,o=1/Math.tan(this._angle/2);r.Matrix.FromValuesToRef(o/1,0,0,0,0,o,0,0,0,0,q,1,0,0,R,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof z.e){const g=this._projectionTexture.uScale/2,w=this._projectionTexture.vScale/2;r.Matrix.FromValuesToRef(g,0,0,0,0,w,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(g,w){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),g.setMatrix("textureProjectionMatrix"+w,this._projectionTextureMatrix),g.setTexture("projectionLightTexture"+w,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&g.setTexture("iesLightTexture"+w,this._iesProfileTexture),this}transferToEffect(g,w){let q;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,w),q=r.ew.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,w),q=r.ew.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",q.x,q.y,q.z,this._cosHalfAngle,w),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,w),this}transferToNodeMaterialEffect(g,w){let q;return q=this.computeTransformedInformation()?r.ew.Normalize(this.transformedDirection):r.ew.Normalize(this.direction),this.Ng().useRightHandedSystem?g.setFloat3(w,-q.x,-q.y,-q.z):g.setFloat3(w,q.x,q.y,q.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(g){const w=this._scene.getEngine(),q=void 0!==this.shadowMinZ?this.shadowMinZ:(null===g||void 0===g?void 0:g.ri)??0;return w.useReverseDepthBuffer&&w.isNDCHalfZRange?q:this._scene.getEngine().isNDCHalfZRange?0:q}getDepthMaxZ(g){const w=this._scene.getEngine(),q=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===g||void 0===g?void 0:g.maxZ)??1e4;return w.useReverseDepthBuffer&&w.isNDCHalfZRange?0:q}prepareLightSpecificDefines(g,w){g["SPOTLIGHT"+w]=!0,g["PROJECTEDLIGHTTEXTURE"+w]=!(!this.projectionTexture||!this.projectionTexture.isReady()),g["IESLIGHTTEXTURE"+w]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,R.e)([(0,o.K)()],m.prototype,"angle",null),(0,R.e)([(0,o.K)()],m.prototype,"innerAngle",null),(0,R.e)([(0,o.K)()],m.prototype,"shadowAngleScale",null),(0,R.e)([(0,o.K)()],m.prototype,"exponent",void 0),(0,R.e)([(0,o.K)()],m.prototype,"projectionTextureLightNear",null),(0,R.e)([(0,o.K)()],m.prototype,"projectionTextureLightFar",null),(0,R.e)([(0,o.K)()],m.prototype,"projectionTextureUpDirection",null),(0,R.e)([(0,o.C)("projectedLightTexture")],m.prototype,"_projectionTexture",void 0),(0,t.g)("BABYLON.SpotLight",m)},12501:(g,w,q)=>{"use strict";q.d(w,{b:()=>S,c:()=>r,d:()=>i});const R={},o={};function r(g,w){R[g]=w}function S(g,w){o[g]=w}function i(g){return o[g]?o[g]:null}},12385:(g,w,q)=>{"use strict";q.d(w,{e:()=>N,i:()=>v});var R,o=q(10991),r=q(10998),S=q(11395),i=q(11034),T=q(11011),z=q(11602),t=q(11043),m=q(11049),e=q(11136),y=q(11074),L=q(11032);!function(g){g[g.Clean=0]="Clean",g[g.Stop=1]="Stop",g[g.Sync=2]="Sync",g[g.NoSync=3]="NoSync"}(R||(R={}));const A=new r.b,l={};let J=!1;function x(){return l[".babylon"]}function G(g,w){const q=l[g];return q||(T.d.Warn("Unable to find a plugin to load "+g+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),w?x():void 0)}function d(g,w,q){let R="Unable to load from "+(g.rawData?"binary data":g.url);return w?R+=`: ${w}`:q&&(R+=`: ${q}`),R}async function D(g,w,q,R,o,r,S,i,T){var z;const m="data:"===(e=g.url).substring(0,5)?e.substring(5):null;var e;if(g.rawData&&!S)throw"When using ArrayBufferView to load data the file extension must be provided.";const J=m||S?"":function(g){const w=g.indexOf("?");-1!==w&&(g=g.substring(0,w));const q=g.lastIndexOf(".");return g.substring(q,g.length).toLowerCase()}(g.url);let d=S?G(S,!0):m?function(g){for(const w in l){const q=l[w].plugin;if(q.canDirectLoad&&q.canDirectLoad(g))return l[w]}return x()}(g.url):G(J,!1);if(!d&&J){if(g.url&&!g.url.startsWith("blob:")){const w=await async function(g,w){const q=w.method||"GET";return await new Promise(((R,o)=>{const r=new L.e;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const g={};if(w.responseHeaders)for(const q of w.responseHeaders)g[q]=r.getResponseHeader(q)||"";R({response:r.response,headerValues:g})}else o(`Unable to fetch data from ${g}. Error code: ${r.status}`)})),r.open(q,g),r.send()}))}(g.url,{method:"HEAD",responseHeaders:["Content-Type"]}),q=w.headerValues?w.headerValues["Content-Type"]:"";q&&(d=function(g){for(const w in l){const q=l[w];if(q.mimeType===g)return q}}(q))}d||(d=x())}if(!d)throw new Error(`No plugin or fallback for ${S??g.url}`);if(!1===(null===T||void 0===T||null===(z=T[d.plugin.name])||void 0===z?void 0:z.enabled))throw new Error(`The '${d.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(g.rawData&&!d.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(g=>{if(d.plugin.createPlugin){const w=d.plugin.createPlugin(T??{});return w instanceof Promise?(w.then(g).catch((g=>{o("Error instantiating plugin.",g)})),null):(g(w),w)}return g(d.plugin),d.plugin})((T=>{var z;if(!T)throw`The loader plugin corresponding to the '${S}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(A.notifyObservers(T),m&&(T.canDirectLoad&&T.canDirectLoad(g.url)||!(0,t.h)(g.url))){if(T.directLoad){const g=T.directLoad(w,m);g instanceof Promise?g.then((g=>{q(T,g)})).catch((g=>{o("Error in directLoad of _loadData: "+g,g)})):q(T,g)}else q(T,m);return}const e=d.isBinary,L=(g,R)=>{w.L?o("Scene has been disposed"):q(T,g,R)};let l=null,J=!1;null===(z=T.WS)||void 0===z||z.add((()=>{J=!0,l&&(l.abort(),l=null),r()}));const x=()=>{if(J)return;const q=(g,w)=>{o(null===g||void 0===g?void 0:g.statusText,w)};if(!T.loadFile&&g.rawData)throw"Plugin does not support loading ArrayBufferView.";l=T.loadFile?T.loadFile(w,g.rawData||g.file||g.url,g.rootUrl,L,R,e,q,i):w._loadFile(g.file||g.url,L,R,!0,e,q)},G=w.getEngine();let D=G.enableOfflineSupport;if(D){let q=!1;for(const R of w.disableOfflineSupportExceptionRules)if(R.test(g.url)){q=!0;break}D=!q}D&&y.b.OfflineProviderFactory?w.offlineProvider=y.b.OfflineProviderFactory(g.url,x,G.disableManifestCheck):x()}))}function U(g,w){let q,R,r=null,S=null;if(w)if(w.name)q=`file:${w.name}`,R=w.name,r=w;else if(ArrayBuffer.isView(w))q="",R=(0,e.c)(),S=w;else if(w.startsWith("data:"))q=w,R="";else if(g){const r=w;if("/"===r.substring(0,1))return o.Tools.Error("Wrong sceneFilename parameter"),null;q=g+r,R=r}else q=w,R=o.Tools.GetFilename(w),g=o.Tools.GetFolderPath(w);else q=g,R=o.Tools.GetFilename(g),g=o.Tools.GetFolderPath(g);return{url:q,rootUrl:g,name:R,file:r,rawData:S}}function N(g){if("string"===typeof g.extensions){const w=g.extensions;l[w.toLowerCase()]={plugin:g,isBinary:!1}}else{const w=g.extensions,q=Object.keys(w);for(const R of q)l[R.toLowerCase()]={plugin:g,isBinary:w[R].isBinary,mimeType:w[R].mimeType}}}async function a(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.c.LastCreatedScene,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!R)return T.d.Error("No scene available to import mesh to"),null;const y=U(w,q);if(!y)return null;const L={};R.addPendingData(L);const A=()=>{R.removePendingData(L)},l=(g,w)=>{const q=d(y,g,w);S?S(R,q,new m.f(q,m.c.SceneLoaderError,w)):T.d.Error(q),A()},J=r?g=>{try{r(g)}catch(w){l("Error in onProgress callback: "+w,w)}}:void 0,x=(g,w,q,r,S,i,T,z)=>{if(R.importedMeshesFiles.push(y.url),o)try{o(g,w,q,r,S,i,T,z)}catch(t){l("Error in onSuccess callback: "+t,t)}R.removePendingData(L)};return await D(y,R,((w,q,o)=>{if(w.rewriteRootURL&&(y.rootUrl=w.rewriteRootURL(y.rootUrl,o)),w.importMesh){const o=[],r=[],S=[];if(!w.importMesh(g,R,q,y.rootUrl,o,r,S,l))return;R.loadingPluginName=w.name,x(o,r,S,[],[],[],[],[])}else{w.importMeshAsync(g,R,q,y.rootUrl,J,y.name).then((g=>{R.loadingPluginName=w.name,x(g.meshes,g.Ym,g.skeletons,g.animationGroups,g.transformNodes,g.geometries,g.lights,g.spriteManagers)})).catch((g=>{l(g.message,g)}))}}),J,l,A,z,t,e)}async function H(g,w,q,R,o,r,S,i){return await new Promise(((T,z)=>{try{a(g,w,q,R,((g,w,q,R,o,r,S,i)=>{T({meshes:g,Ym:w,skeletons:q,animationGroups:R,transformNodes:o,geometries:r,lights:S,spriteManagers:i})}),o,((g,w,q)=>{z(q||new Error(w))}),r,S,i).catch(z)}catch(m){z(m)}}))}async function C(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.c.LastCreatedEngine,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};q?await P(g,w,new S.c(q),R,r,T,z,t,m):o.Tools.Error("No engine available")}async function c(g,w,q,R,o,r,S){return await new Promise(((i,T)=>{C(g,w,q,(g=>{i(g)}),R,((g,w,q)=>{T(q||new Error(w))}),o,r,S)}))}async function P(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.c.LastCreatedScene,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!q)return T.d.Error("No scene available to append to"),null;const y=U(g,w);if(!y)return null;const L={};q.addPendingData(L);const A=()=>{q.removePendingData(L)};z.e.ShowLoadingScreen&&!J&&(J=!0,q.getEngine().displayLoadingUI(),q.executeWhenReady((()=>{q.getEngine().hideLoadingUI(),J=!1})));const l=(g,w)=>{const R=d(y,g,w);r?r(q,R,new m.f(R,m.c.SceneLoaderError,w)):T.d.Error(R),A()},x=o?g=>{try{o(g)}catch(w){l("Error in onProgress callback",w)}}:void 0,G=()=>{if(R)try{R(q)}catch(g){l("Error in onSuccess callback",g)}q.removePendingData(L)};return await D(y,q,((g,w)=>{if(g.load){if(!g.load(q,w,y.rootUrl,l))return;q.loadingPluginName=g.name,G()}else{g.loadAsync(q,w,y.rootUrl,x,y.name).then((()=>{q.loadingPluginName=g.name,G()})).catch((g=>{l(g.message,g)}))}}),x,l,A,S,t,e)}async function j(g,w,q,R,o,r,S){return await new Promise(((i,T)=>{try{P(g,w,q,(g=>{i(g)}),R,((g,w,q)=>{T(q||new Error(w))}),o,r,S).catch(T)}catch(m){T(m)}}))}async function M(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.c.LastCreatedScene,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!q)return T.d.Error("No scene available to load asset container to"),null;const e=U(g,w);if(!e)return null;const y={};q.addPendingData(y);const L=()=>{q.removePendingData(y)},A=(g,w)=>{const R=d(e,g,w);r?r(q,R,new m.f(R,m.c.SceneLoaderError,w)):T.d.Error(R),L()},l=o?g=>{try{o(g)}catch(w){A("Error in onProgress callback",w)}}:void 0,J=g=>{if(R)try{R(g)}catch(w){A("Error in onSuccess callback",w)}q.removePendingData(y)};return await D(e,q,((g,w)=>{if(g.loadAssetContainer){const R=g.loadAssetContainer(q,w,e.rootUrl,A);if(!R)return;R.populateRootNodes(),q.loadingPluginName=g.name,J(R)}else if(g.loadAssetContainerAsync){g.loadAssetContainerAsync(q,w,e.rootUrl,l,e.name).then((w=>{w.populateRootNodes(),q.loadingPluginName=g.name,J(w)})).catch((g=>{A(g.message,g)}))}else A("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),l,A,L,S,z,t)}async function V(g,w,q,R,o,r,S){return await new Promise(((i,T)=>{try{M(g,w,q,(g=>{i(g)}),R,((g,w,q)=>{T(q||new Error(w))}),o,r,S).catch(T)}catch(m){T(m)}}))}async function s(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.c.LastCreatedScene,R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!q)return void T.d.Error("No scene available to load animations to");if(R){for(const R of q.animatables)R.reset();q.stopAllAnimations();const g=q.animationGroups.slice();for(const q of g)q.dispose();const w=q.getNodes();for(const q of w)q.animations&&(q.animations=[])}else switch(o){case 0:const g=q.animationGroups.slice();for(const w of g)w.dispose();break;case 1:for(const w of q.animationGroups)w.stop();break;case 2:for(const w of q.animationGroups)w.reset(),w.restart();break;case 3:break;default:return void T.d.Error("Unknown animation group loading mode value '"+o+"'")}const L=q.animatables.length;await M(g,w,q,(g=>{g.mergeAnimationsTo(q,q.animatables.slice(L),r),g.dispose(),q.onAnimationFileImportedObservable.notifyObservers(q),S&&S(q)}),z,t,m,e,y)}async function h(g,w,q,R,o,r,S,i,T,z){return await new Promise(((t,e)=>{try{s(g,w,q,R,o,r,(g=>{t(g)}),S,((g,w,q)=>{e(q||new Error(w))}),i,T,z).catch(e)}catch(m){e(m)}}))}class v{static get ForceFullSceneLoadingForIncremental(){return z.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(g){z.e.ForceFullSceneLoadingForIncremental=g}static get ShowLoadingScreen(){return z.e.ShowLoadingScreen}static set ShowLoadingScreen(g){z.e.ShowLoadingScreen=g}static get loggingLevel(){return z.e.loggingLevel}static set loggingLevel(g){z.e.loggingLevel=g}static get CleanBoneMatrixWeights(){return z.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(g){z.e.CleanBoneMatrixWeights=g}static GetDefaultPlugin(){return x()}static GetPluginForExtension(g){var w;return null===(w=G(g,!0))||void 0===w?void 0:w.plugin}static IsPluginForExtensionAvailable(g){return function(g){return!!l[g]}(g)}static RegisterPlugin(g){N(g)}static ImportMesh(g,w,q,R,o,r,S,T,z){a(g,w,q,R,o,r,S,T,z).catch((g=>null===S||void 0===S?void 0:S(i.c.LastCreatedScene,null===g||void 0===g?void 0:g.message,g)))}static async ImportMeshAsync(g,w,q,R,o,r,S){return await H(g,w,q,R,o,r,S)}static Load(g,w,q,R,o,r,S,T){C(g,w,q,R,o,r,S,T).catch((g=>null===r||void 0===r?void 0:r(i.c.LastCreatedScene,null===g||void 0===g?void 0:g.message,g)))}static async LoadAsync(g,w,q,R,o,r){return await c(g,w,q,R,o,r)}static Append(g,w,q,R,o,r,S,T){P(g,w,q,R,o,r,S,T).catch((g=>null===r||void 0===r?void 0:r(q??i.c.LastCreatedScene,null===g||void 0===g?void 0:g.message,g)))}static async AppendAsync(g,w,q,R,o,r){return await j(g,w,q,R,o,r)}static LoadAssetContainer(g,w,q,R,o,r,S,T){M(g,w,q,R,o,r,S,T).catch((g=>null===r||void 0===r?void 0:r(q??i.c.LastCreatedScene,null===g||void 0===g?void 0:g.message,g)))}static async LoadAssetContainerAsync(g,w,q,R,o,r){return await V(g,w,q,R,o,r)}static ImportAnimations(g,w,q,R,o,r,S,T,z,t,m){s(g,w,q,R,o,r,S,T,z,t,m).catch((g=>null===z||void 0===z?void 0:z(q??i.c.LastCreatedScene,null===g||void 0===g?void 0:g.message,g)))}static async ImportAnimationsAsync(g,w,q,R,o,r,S,i,T,z,t){return await h(g,w,q,R,o,r,i,z,t)}}v.NO_LOGGING=0,v.MINIMAL_LOGGING=1,v.SUMMARY_LOGGING=2,v.DETAILED_LOGGING=3,v.OnPluginActivatedObservable=A},12784:(g,w,q)=>{"use strict";q.d(w,{d:()=>e});var R=q(11161),o=q(11170),r=q(10991),S=q(11180),i=q(11204),T=q(11152),z=q(11128),t=q(10998),m=q(11218);q(12792);class e extends i.d{set boundingBoxSize(g){if(this._boundingBoxSize&&this._boundingBoxSize.equals(g))return;this._boundingBoxSize=g;const w=this.Ng();w&&w.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(g){this._rotationY=g,this.setReflectionTextureMatrix(S.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(g,w,q){let R="";for(const o of g)R+=o;return new e(R,w,null,q,g)}static CreateFromPrefilteredData(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=w.useDelayedTextureLoading;w.useDelayedTextureLoading=!1;const r=new e(g,w,null,!1,null,null,null,void 0,!0,q,R);return w.useDelayedTextureLoading=o,r}constructor(g,w){var q;let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,L=arguments.length>10&&void 0!==arguments[10]&&arguments[10],A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,l=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,J=arguments.length>13?arguments[13]:void 0,x=arguments.length>14?arguments[14]:void 0;super(w),this.onLoadObservable=new t.b,this.boundingBoxPosition=S.ew.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new S.Matrix,this._buffer=null,this.name=g,this.url=g,this._noMipmap=o,this.oi=!1,this.isCube=!0,this._textureMatrix=S.Matrix.Identity(),this.coordinatesMode=T.e.CUBIC_MODE;let G=null,d=null;null===R||Array.isArray(R)?(this._noMipmap=o,this._format=m,this._createPolynomials=L,G=R,this._loaderOptions=J,this._useSRGBBuffer=x,this._lodScale=A,this._lodOffset=l):(G=R.extensions??null,this._noMipmap=R.noMipmap??!1,r=R.files??null,d=R.buffer??null,this._format=R.format??5,e=R.prefiltered??!1,y=R.forcedExtension??null,this._createPolynomials=R.createPolynomials??!1,this._lodScale=R.lodScale??.8,this._lodOffset=R.lodOffset??0,this._loaderOptions=R.loaderOptions,this._useSRGBBuffer=R.useSRGBBuffer,i=R.p??null,z=R.onError??null),(g||r)&&this.updateURL(g,y,i,e,z,G,null===(q=this.Ng())||void 0===q?void 0:q.useDelayedTextureLoading,r,d)}getClassName(){return"CubeTexture"}updateURL(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=g),this.url=g,w&&(this._forcedExtension=w);const z=g.lastIndexOf("."),t=w||(z>-1?g.substring(z).toLowerCase():""),m=0===t.indexOf(".dds"),e=0===t.indexOf(".env"),y=0===t.indexOf(".basis");if(e?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=R,R&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),i)this._files=i;else if(y||e||m||r||(r=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,r){for(let w=0;w<r.length;w++)this._files.push(g+r[w]);this._extensions=r}this._buffer=T,S?(this.delayLoadState=4,this._delayedOnLoad=q,this._delayedOnError=o):this._loadTexture(q,o)}delayLoad(g){4===this.delayLoadState&&(g&&(this._forcedExtension=g),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(g){var w,q;if(g.updateFlag===this._textureMatrix.updateFlag)return;g.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(q=this.Ng())||void 0===q||q.markAllMaterialsAsDirty(1,(g=>-1!==g.getActiveTextures().indexOf(this))));if(this._textureMatrix=g,null===(w=this.Ng())||void 0===w||!w.useRightHandedSystem)return;const R=S.TmpVectors.ew[0],o=S.TmpVectors.Quaternion[0],r=S.TmpVectors.ew[1];this._textureMatrix.decompose(R,o,r),o.z*=-1,o.w*=-1,S.Matrix.ComposeToRef(R,o,r,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var g;return null!==(g=this.Ng())&&void 0!==g&&g.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=this.Ng(),R=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const o=()=>{var w;(this.onLoadObservable.notifyObservers(this),R)&&(R.dispose(),null===(w=this.Ng())||void 0===w||w.markAllMaterialsAsDirty(1));g&&g()},S=(g,q)=>{this._loadingError=!0,this._errorObject={message:g,exception:q},w&&w(g,q),T.e.OnTextureLoadErrorObservable.notifyObservers(this)};var i;this._texture?this._texture.isReady?r.Tools.SetImmediate((()=>o())):this._texture.onLoadedObservable.add((()=>o())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,q,this._lodScale,this._lodOffset,g,S,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,q,this._files,this._noMipmap,g,S,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(i=this._texture)||void 0===i||i.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(g,w,q){const R=m.c.Parse((()=>{let R=!1;return g.prefiltered&&(R=g.prefiltered),new e(q+(g.url??g.name),w,g.extensions,!1,g.files||null,null,null,void 0,R,g.forcedExtension)}),g,w);if(g.boundingBoxPosition&&(R.boundingBoxPosition=S.ew.Ri(g.boundingBoxPosition)),g.boundingBoxSize&&(R.boundingBoxSize=S.ew.Ri(g.boundingBoxSize)),g.animations)for(let o=0;o<g.animations.length;o++){const w=g.animations[o],q=(0,z.e)("BABYLON.Animation");q&&R.animations.push(q.Parse(w))}return R}clone(){let g=0;const w=m.c.Clone((()=>{const w=new e(this.url,this.Ng()||this._getEngine(),this._extensions,this._noMipmap,this._files);return g=w.uniqueId,w}),this);return w.uniqueId=g,w}}(0,R.e)([(0,o.K)()],e.prototype,"url",void 0),(0,R.e)([(0,o.H)()],e.prototype,"boundingBoxPosition",void 0),(0,R.e)([(0,o.H)()],e.prototype,"boundingBoxSize",null),(0,R.e)([(0,o.K)("rotationY")],e.prototype,"rotationY",null),(0,R.e)([(0,o.K)("files")],e.prototype,"_files",void 0),(0,R.e)([(0,o.K)("forcedExtension")],e.prototype,"_forcedExtension",void 0),(0,R.e)([(0,o.K)("extensions")],e.prototype,"_extensions",void 0),(0,R.e)([(0,o.v)("textureMatrix")],e.prototype,"_textureMatrix",void 0),(0,R.e)([(0,o.v)("textureMatrixRefraction")],e.prototype,"_textureMatrixRefraction",void 0),T.e._CubeTextureParser=e.Parse,(0,z.g)("BABYLON.CubeTexture",e)},13284:(g,w,q)=>{"use strict";q.d(w,{b:()=>T});var R=q(11011),o=q(11152),r=q(11139),S=q(11294),i=q(11103);S.ThinEngine.prototype.createDynamicTexture=function(g,w,q,R){const o=new i.d(this,4);return o.baseWidth=g,o.baseHeight=w,q&&(g=this.needPOTTextures?(0,r.h)(g,this._caps.maxTextureSize):g,w=this.needPOTTextures?(0,r.h)(w,this._caps.maxTextureSize):w),o.width=g,o.height=w,o.isReady=!1,o.generateMipMaps=q,o.samplingMode=R,this.updateTextureSamplingMode(R,o),this._internalTexturesCache.push(o),o},S.ThinEngine.prototype.updateDynamicTexture=function(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!g)return;const S=this._gl,i=S.TEXTURE_2D,T=this._bindTextureDirectly(i,g,!0,r);this._unpackFlipY(void 0===q?g.invertY:q),R&&S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const z=this._getWebGLTextureType(g.type),t=this._getInternalFormat(o||g.format),m=this._getRGBABufferInternalSizedFormat(g.type,t);S.texImage2D(i,0,m,t,z,w),g.generateMipMaps&&S.generateMipmap(i),T||this._bindTextureDirectly(i,null),R&&S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),o&&(g.format=o),g._dynamicTextureSource=w,g._premulAlpha=R,g.invertY=q||!1,g.isReady=!0};class T extends o.e{constructor(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,i=arguments.length>6?arguments[6]:void 0;const T=!q||q._isScene;super(null,T?q:null===q||void 0===q?void 0:q.Aw,T?!R:q,i,r,void 0,void 0,void 0,void 0,S),this.name=g,this.wrapU=o.e.CLAMP_ADDRESSMODE,this.wrapV=o.e.CLAMP_ADDRESSMODE,this._generateMipMaps=R;const z=this._getEngine();if(!z)return;if(w.getContext)this._canvas=w,this._ownCanvas=!1,this._texture=z.createDynamicTexture(this._canvas.width,this._canvas.height,R,r);else{this._canvas=z.createCanvas(1,1),this._ownCanvas=!0;const g=w;g.width||0===g.width?this._texture=z.createDynamicTexture(g.width,g.height,R,r):this._texture=z.createDynamicTexture(w,w,R,r)}const t=this.getSize();this._canvas.width!==t.width&&(this._canvas.width=t.width),this._canvas.height!==t.height&&(this._canvas.height=t.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(g){this._canvas.width=g.width,this._canvas.height=g.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(g.width,g.height,this._generateMipMaps,this.samplingMode)}scale(g){const w=this.getSize();w.width*=g,w.height*=g,this._recreate(w)}scaleTo(g,w){const q=this.getSize();q.width=g,q.height=w,this._recreate(q)}getContext(){return this._context}clear(g){const w=this.getSize();g&&(this._context.fillStyle=g),this._context.clearRect(0,0,w.width,w.height)}update(g){let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===g||g,w,this._format||void 0,void 0,q)}drawText(g,w,q,R,o,r,S){let i=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const T=this.getSize();if(r&&(this._context.fillStyle=r,this._context.fillRect(0,0,T.width,T.height)),this._context.font=R,null===w||void 0===w){const q=this._context.measureText(g);w=(T.width-q.width)/2}if(null===q||void 0===q){const g=parseInt(R.replace(/\D/g,""));q=T.height/2+g/3.65}this._context.fillStyle=o||"",this._context.fillText(g,w,q),i&&this.update(S)}dispose(){var g,w;(super.dispose(),this._ownCanvas)&&(null===(g=this._canvas)||void 0===g||null===(w=g.remove)||void 0===w||w.call(g));this._canvas=null,this._context=null}clone(){const g=this.Ng();if(!g)return this;const w=this.getSize(),q=new T(this.name,w,g,this._generateMipMaps);return q.oi=this.oi,q.level=this.level,q.wrapU=this.wrapU,q.wrapV=this.wrapV,q}serialize(){const g=this.Ng();g&&!g.isReady()&&R.d.Warn("The scene must be ready before serializing the dynamic texture");const w=super.serialize();return T._IsCanvasElement(this._canvas)&&(w.base64String=this._canvas.toDataURL()),w.invertY=this._invertY,w.samplingMode=this.samplingMode,w}static _IsCanvasElement(g){return void 0!==g.toDataURL}_rebuild(){this.update()}}},12704:(g,w,q)=>{"use strict";q.d(w,{e:()=>o});var R=q(11152);class o extends R.e{get depth(){return this._depth}constructor(g,w,q,o,r,S){let i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:R.e.TRILINEAR_SAMPLINGMODE,t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,m=arguments.length>10?arguments[10]:void 0;super(null,S,!i,T),this.format=r,this._texture=S.getEngine().createRawTexture2DArray(g,w,q,o,r,i,T,z,null,t,m),this._depth=o,this.is2DArray=!0}update(g){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,g,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(g,w,q,R,r){return new o(g,w,q,R,5,r,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12514:(g,w,q)=>{"use strict";q.d(w,{c:()=>i,e:()=>T,i:()=>r,m:()=>S});var R=q(11195),o=q(11180);function r(g,w){return`{X: ${g.x.toFixed(w)} Y: ${g.y.toFixed(w)}}`}function S(g,w){return`{X: ${g._x.toFixed(w)} Y: ${g._y.toFixed(w)} Z: ${g._z.toFixed(w)}}`}function i(g,w){return 2*Math.acos((0,R.Clamp)(o.Quaternion.Dot(g,w)))}function T(g,w){const q=new o.Quaternion;return function(g,w,q){const r=o.ew.Cross(g,w),S=Math.acos((0,R.Clamp)(o.ew.Dot(g,w),-1,1));o.Quaternion.RotationAxisToRef(r,S,q)}(g,w,q),q}},12331:(g,w,q)=>{"use strict";q.d(w,{b:()=>z});var R=q(11180),o=q(11235),r=q(11586),S=q(11572),i=q(11242);q(12340);function T(g){let w=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const q=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],r=[];let T=[];const z=g.width||g.size||1,t=g.height||g.size||1,m=g.depth||g.size||1,e=g.wrap||!1;let y=void 0===g.topBaseAt?1:g.topBaseAt,L=void 0===g.bottomBaseAt?0:g.bottomBaseAt;y=(y+4)%4,L=(L+4)%4;let A=[2,0,3,1][y],l=[2,0,1,3][L],J=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(e){w=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],J=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let g=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],q=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const R=[17,18,19,16],o=[22,23,20,21];for(;A>0;)g.unshift(g.pop()),R.unshift(R.pop()),A--;for(;l>0;)q.unshift(q.pop()),o.unshift(o.pop()),l--;g=g.flat(),q=q.flat(),J=J.concat(g).concat(q),w.push(R[0],R[2],R[3],R[0],R[1],R[2]),w.push(o[0],o[2],o[3],o[0],o[1],o[2])}const x=[z/2,t/2,m/2];T=J.reduce(((g,w,q)=>g.concat(w*x[q%3])),[]);const G=0===g.sideOrientation?0:g.sideOrientation||S.b.DEFAULTSIDE,d=g.faceUV||new Array(6),D=g.faceColors,U=[];for(let S=0;S<6;S++)void 0===d[S]&&(d[S]=new R.Vector4(0,0,1,1)),D&&void 0===D[S]&&(D[S]=new o.d(1,1,1,1));for(let R=0;R<6;R++)if(r.push(d[R].z,i.b?1-d[R].w:d[R].w),r.push(d[R].x,i.b?1-d[R].w:d[R].w),r.push(d[R].x,i.b?1-d[R].y:d[R].y),r.push(d[R].z,i.b?1-d[R].y:d[R].y),D)for(let g=0;g<4;g++)U.push(D[R].r,D[R].g,D[R].b,D[R].a);S.b._ComputeSides(G,T,w,q,r,g.frontUVs,g.backUVs);const N=new S.b;if(N.indices=w,N.Hg=T,N.Cg=q,N.Pg=r,D){const g=G===S.b.DOUBLESIDE?U.concat(U):U;N.cg=g}return N}function z(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new r.d(g,q);w.sideOrientation=r.d._GetDefaultSideOrientation(w.sideOrientation),R._originalBuilderSideOrientation=w.sideOrientation;return T(w).Mg(R,w.updatable),R}S.b.CreateBox=T,r.d.CreateBox=function(g,w){return z(g,{size:w,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12504:(g,w,q)=>{"use strict";q.d(w,{c:()=>i});var R=q(11586),o=q(11572),r=q(11242);function S(g){const w=[],q=[],R=[],S=[],i=g.radius||.5,T=g.tessellation||64,z=g.arc&&(g.arc<=0||g.arc>1)?1:g.arc||1,t=0===g.sideOrientation?0:g.sideOrientation||o.b.DEFAULTSIDE;w.push(0,0,0),S.push(.5,.5);const m=2*Math.PI*z,e=1===z?m/T:m/(T-1);let y=0;for(let o=0;o<T;o++){const g=Math.cos(y),q=Math.sin(y),R=(g+1)/2,o=(1-q)/2;w.push(i*g,i*q,0),S.push(R,r.b?1-o:o),y+=e}1===z&&(w.push(w[3],w[4],w[5]),S.push(S[2],r.b?1-S[3]:S[3]));const L=w.length/3;for(let o=1;o<L-1;o++)q.push(o+1,0,o);o.b.ComputeNormals(w,q,R),o.b._ComputeSides(t,w,q,R,S,g.frontUVs,g.backUVs);const A=new o.b;return A.indices=q,A.Hg=w,A.Cg=R,A.Pg=S,A}function i(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new R.d(g,q);w.sideOrientation=R.d._GetDefaultSideOrientation(w.sideOrientation),o._originalBuilderSideOrientation=w.sideOrientation;return S(w).Mg(o,w.updatable),o}o.b.CreateDisc=S,R.d.CreateDisc=function(g,w,q){return i(g,{radius:w,tessellation:q,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12340:(g,w,q)=>{"use strict";q.d(w,{h:()=>l,d:()=>x,i:()=>J});var R=q(11180),o=q(11235),r=q(11586),S=q(11572),i=q(11250);r.d._GroundMeshParser=(g,w)=>T.Parse(g,w);class T extends r.d{constructor(g,w){super(g,w),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=g,this._subdivisionsY=g,this.subdivide(g);const q=this;q.createOrUpdateSubmeshesOctree&&q.createOrUpdateSubmeshesOctree(w)}getHeightAtCoordinates(g,w){const q=this.getWorldMatrix(),o=R.TmpVectors.Matrix[5];q.invertToRef(o);const r=R.TmpVectors.ew[8];if(R.ew.TransformCoordinatesFromFloatsToRef(g,0,w,o,r),g=r.x,w=r.z,g<this._minX||g>=this._maxX||w<=this._minZ||w>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const S=this._getFacetAt(g,w),i=-(S.x*g+S.z*w+S.w)/S.y;return R.ew.TransformCoordinatesFromFloatsToRef(0,i,0,q,r),r.y}getNormalAtCoordinates(g,w){const q=new R.ew(0,1,0);return this.getNormalAtCoordinatesToRef(g,w,q),q}getNormalAtCoordinatesToRef(g,w,q){const o=this.getWorldMatrix(),r=R.TmpVectors.Matrix[5];o.invertToRef(r);const S=R.TmpVectors.ew[8];if(R.ew.TransformCoordinatesFromFloatsToRef(g,0,w,r,S),g=S.x,w=S.z,g<this._minX||g>this._maxX||w<this._minZ||w>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const i=this._getFacetAt(g,w);return R.ew.TransformNormalFromFloatsToRef(i.x,i.y,i.z,o,q),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(g,w){const q=Math.floor((g+this._maxX)*this._subdivisionsX/this._width),R=Math.floor(-(w+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),o=this._heightQuads[R*this._subdivisionsX+q];let r;return r=w<o.slope.x*g+o.slope.y?o.facet1:o.facet2,r}_initHeightQuads(){const g=this._subdivisionsX,w=this._subdivisionsY;this._heightQuads=[];for(let q=0;q<w;q++)for(let w=0;w<g;w++){const o={slope:R.Vector2.Zero(),facet1:new R.Vector4(0,0,0,0),facet2:new R.Vector4(0,0,0,0)};this._heightQuads[q*g+w]=o}return this}_computeHeightQuads(){const g=this.getVerticesData(i.h.PositionKind);if(!g)return this;const w=R.TmpVectors.ew[3],q=R.TmpVectors.ew[2],o=R.TmpVectors.ew[1],r=R.TmpVectors.ew[0],S=R.TmpVectors.ew[4],T=R.TmpVectors.ew[5],z=R.TmpVectors.ew[6],t=R.TmpVectors.ew[7],m=R.TmpVectors.ew[8];let e=0,y=0,L=0,A=0,l=0,J=0,x=0;const G=this._subdivisionsX,d=this._subdivisionsY;for(let i=0;i<d;i++)for(let d=0;d<G;d++){e=3*d,y=i*(G+1)*3,L=(i+1)*(G+1)*3,w.x=g[y+e],w.y=g[y+e+1],w.z=g[y+e+2],q.x=g[y+e+3],q.y=g[y+e+4],q.z=g[y+e+5],o.x=g[L+e],o.y=g[L+e+1],o.z=g[L+e+2],r.x=g[L+e+3],r.y=g[L+e+4],r.z=g[L+e+5],A=(r.z-w.z)/(r.x-w.x),l=w.z-A*w.x,q.subtractToRef(w,S),o.subtractToRef(w,T),r.subtractToRef(w,z),R.ew.CrossToRef(z,T,t),R.ew.CrossToRef(S,z,m),t.normalize(),m.normalize(),J=-(t.x*w.x+t.y*w.y+t.z*w.z),x=-(m.x*q.x+m.y*q.y+m.z*q.z);const D=this._heightQuads[i*G+d];D.slope.mi(A,l),D.facet1.mi(t.x,t.y,t.z,J),D.facet2.mi(m.x,m.y,m.z,x)}return this}serialize(g){super.serialize(g),g.subdivisionsX=this._subdivisionsX,g.subdivisionsY=this._subdivisionsY,g.minX=this._minX,g.maxX=this._maxX,g.ri=this._minZ,g.maxZ=this._maxZ,g.width=this._width,g.height=this._height}static Parse(g,w){const q=new T(g.name,w);return q._subdivisionsX=g.subdivisionsX||1,q._subdivisionsY=g.subdivisionsY||1,q._minX=g.minX,q._maxX=g.maxX,q._minZ=g.ri,q._maxZ=g.maxZ,q._width=g.width,q._height=g.height,q}}var z=q(10991),t=q(11034),m=q(11188),e=q(11242);function y(g){const w=[],q=[],o=[],r=[];let i,T;const z=g.width||g.size||1,t=g.height||g.size||1,m=0|(g.subdivisionsX||g.subdivisions||1),y=0|(g.subdivisionsY||g.subdivisions||1);for(i=0;i<=y;i++)for(T=0;T<=m;T++){const g=new R.ew(T*z/m-z/2,0,(y-i)*t/y-t/2),w=new R.ew(0,1,0);q.push(g.x,g.y,g.z),o.push(w.x,w.y,w.z),r.push(T/m,e.b?i/y:1-i/y)}for(i=0;i<y;i++)for(T=0;T<m;T++)w.push(T+1+(i+1)*(m+1)),w.push(T+1+i*(m+1)),w.push(T+i*(m+1)),w.push(T+(i+1)*(m+1)),w.push(T+1+(i+1)*(m+1)),w.push(T+i*(m+1));const L=new S.b;return L.indices=w,L.Hg=q,L.Cg=o,L.Pg=r,L}function L(g){const w=void 0!==g.xmin&&null!==g.xmin?g.xmin:-1,q=void 0!==g.zmin&&null!==g.zmin?g.zmin:-1,o=void 0!==g.xmax&&null!==g.xmax?g.xmax:1,r=void 0!==g.zmax&&null!==g.zmax?g.zmax:1,i=g.subdivisions||{w:1,h:1},T=g.precision||{w:1,h:1},z=[],t=[],m=[],e=[];let y,L,A,l;i.h=i.h<1?1:i.h,i.w=i.w<1?1:i.w,T.w=T.w<1?1:T.w,T.h=T.h<1?1:T.h;const J=(o-w)/i.w,x=(r-q)/i.h;function G(g,w,q,o){const r=t.length/3,S=T.w+1;for(y=0;y<T.h;y++)for(L=0;L<T.w;L++){const g=[r+L+y*S,r+(L+1)+y*S,r+(L+1)+(y+1)*S,r+L+(y+1)*S];z.push(g[1]),z.push(g[2]),z.push(g[3]),z.push(g[0]),z.push(g[1]),z.push(g[3])}const i=R.ew.Zero(),A=new R.ew(0,1,0);for(y=0;y<=T.h;y++)for(i.z=y*(o-w)/T.h+w,L=0;L<=T.w;L++)i.x=L*(q-g)/T.w+g,i.y=0,t.push(i.x,i.y,i.z),m.push(A.x,A.y,A.z),e.push(L/T.w,y/T.h)}for(A=0;A<i.h;A++)for(l=0;l<i.w;l++)G(w+l*J,q+A*x,w+(l+1)*J,q+(A+1)*x);const d=new S.b;return d.indices=z,d.Hg=t,d.Cg=m,d.Pg=e,d}function A(g){const w=[],q=[],r=[],i=[];let T,z;const t=g.colorFilter||new o.Jw(.3,.59,.11),e=g.alphaFilter||0;let y=!1;if(g.minHeight>g.maxHeight){y=!0;const w=g.maxHeight;g.maxHeight=g.minHeight,g.minHeight=w}for(T=0;T<=g.subdivisions;T++)for(z=0;z<=g.subdivisions;z++){const w=new R.ew(z*g.width/g.subdivisions-g.width/2,0,(g.subdivisions-T)*g.height/g.subdivisions-g.height/2),o=4*(((w.x+g.width/2)/g.width*(g.bufferWidth-1)|0)+((1-(w.z+g.height/2)/g.height)*(g.bufferHeight-1)|0)*g.bufferWidth);let S=g.buffer[o]/255,L=g.buffer[o+1]/255,A=g.buffer[o+2]/255;const l=g.buffer[o+3]/255;y&&(S=1-S,L=1-L,A=1-A);const J=S*t.r+L*t.g+A*t.b;w.y=l>=e?g.minHeight+(g.maxHeight-g.minHeight)*J:g.minHeight-m.c,g.heightBuffer&&(g.heightBuffer[T*(g.subdivisions+1)+z]=w.y),q.push(w.x,w.y,w.z),r.push(0,0,0),i.push(z/g.subdivisions,1-T/g.subdivisions)}for(T=0;T<g.subdivisions;T++)for(z=0;z<g.subdivisions;z++){const R=z+1+(T+1)*(g.subdivisions+1),o=z+1+T*(g.subdivisions+1),r=z+T*(g.subdivisions+1),S=z+(T+1)*(g.subdivisions+1),i=q[3*R+1]>=g.minHeight,t=q[3*o+1]>=g.minHeight,m=q[3*r+1]>=g.minHeight;i&&t&&m&&(w.push(R),w.push(o),w.push(r));q[3*S+1]>=g.minHeight&&i&&m&&(w.push(S),w.push(R),w.push(r))}S.b.ComputeNormals(q,w,r);const L=new S.b;return L.indices=w,L.Hg=q,L.Cg=r,L.Pg=i,L}function l(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const q=new T(g,arguments.length>2?arguments[2]:void 0);q._setReady(!1),q._subdivisionsX=w.subdivisionsX||w.subdivisions||1,q._subdivisionsY=w.subdivisionsY||w.subdivisions||1,q._width=w.width||1,q._height=w.height||1,q._maxX=q._width/2,q._maxZ=q._height/2,q._minX=-q._maxX,q._minZ=-q._maxZ;return y(w).Mg(q,w.updatable),q._setReady(!0),q}function J(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new r.d(g,q);return L(w).Mg(R,w.updatable),R}function x(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=q.width||10,S=q.height||10,i=q.subdivisions||1,m=q.minHeight||0,e=q.maxHeight||1,y=q.colorFilter||new o.Jw(.3,.59,.11),L=q.alphaFilter||0,l=q.updatable,J=q.onReady;R=R||t.c.LastCreatedScene;const x=new T(g,R);let G;x._subdivisionsX=i,x._subdivisionsY=i,x._width=r,x._height=S,x._maxX=x._width/2,x._maxZ=x._height/2,x._minX=-x._maxX,x._minZ=-x._maxZ,x._setReady(!1),q.passHeightBufferInCallback&&(G=new Float32Array((i+1)*(i+1)));const d=(g,w,q)=>{A({width:r,height:S,subdivisions:i,minHeight:m,maxHeight:e,colorFilter:y,buffer:g,bufferWidth:w,bufferHeight:q,alphaFilter:L,heightBuffer:G}).Mg(x,l),J&&J(x,G),x._setReady(!0)};if("string"===typeof w){const g=g=>{var w;const q=g.width,o=g.height;if(R.L)return;const r=null===(w=R)||void 0===w?void 0:w.getEngine().resizeImageBitmap(g,q,o);d(r,q,o)};z.Tools.LoadImage(w,g,q.onError?q.onError:()=>{},R.offlineProvider)}else d(w.data,w.width,w.height);return x}S.b.CreateGround=y,S.b.CreateTiledGround=L,S.b.CreateGroundFromHeightMap=A,r.d.CreateGround=(g,w,q,R,o,r)=>l(g,{width:w,height:q,subdivisions:R,updatable:r},o),r.d.CreateTiledGround=(g,w,q,R,o,r,S,i,T)=>J(g,{xmin:w,zmin:q,xmax:R,zmax:o,subdivisions:r,precision:S,updatable:T},i),r.d.CreateGroundFromHeightMap=(g,w,q,R,o,r,S,i,T,z,t)=>x(g,w,{width:q,height:R,subdivisions:o,minHeight:r,maxHeight:S,updatable:T,onReady:z,alphaFilter:t},i)},13010:(g,w,q)=>{"use strict";q.d(w,{d:()=>y,f:()=>m,h:()=>e});var R=q(11180),o=q(11586),r=q(11572),S=q(11678),i=q(11250),T=q(11011);function z(g){const w=[],q=[],R=g.lines,o=g.cg,S=[];let i=0;for(let r=0;r<R.length;r++){const g=R[r];for(let R=0;R<g.length;R++){const{x:T,y:z,z:t}=g[R];if(q.push(T,z,t),o){const g=o[r],{r:w,g:q,b:i,a:T}=g[R];S.push(w,q,i,T)}R>0&&(w.push(i-1),w.push(i)),i++}}const T=new r.b;return T.indices=w,T.Hg=q,o&&(T.cg=S),T}function t(g){const w=g.dashSize||3,q=g.gapSize||1,o=g.dashNb||200,S=g.points,i=[],T=[],z=R.ew.Zero();let t=0,m=0,e=0,y=0,L=0,A=0,l=0;for(l=0;l<S.length-1;l++)S[l+1].subtractToRef(S[l],z),t+=z.length();for(e=t/o,y=w*e/(w+q),l=0;l<S.length-1;l++){S[l+1].subtractToRef(S[l],z),m=Math.floor(z.length()/e),z.normalize();for(let g=0;g<m;g++)L=e*g,i.push(S[l].x+L*z.x,S[l].y+L*z.y,S[l].z+L*z.z),i.push(S[l].x+(L+y)*z.x,S[l].y+(L+y)*z.y,S[l].z+(L+y)*z.z),T.push(A,A+1),A+=2}const J=new r.b;return J.Hg=i,J.indices=T,J}function m(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=w.instance,o=w.lines,r=w.cg;if(R){const g=R.getVerticesData(i.h.PositionKind);let w,q;r&&(w=R.getVerticesData(i.h.ColorKind));let S=0,T=0;for(let R=0;R<o.length;R++){const i=o[R];for(let o=0;o<i.length;o++)g[S]=i[o].x,g[S+1]=i[o].y,g[S+2]=i[o].z,r&&w&&(q=r[R],w[T]=q[o].r,w[T+1]=q[o].g,w[T+2]=q[o].b,w[T+3]=q[o].a,T+=4),S+=3}return R.updateVerticesData(i.h.PositionKind,g,!1,!1),r&&w&&R.updateVerticesData(i.h.ColorKind,w,!1,!1),R.refreshBoundingInfo(),R}const T=!!r,t=new S.e(g,q,null,void 0,void 0,T,w.useVertexAlpha,w.material);return z(w).Mg(t,w.updatable),t}function e(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=w.cg?[w.cg]:null;return m(g,{lines:[w.points],updatable:w.updatable,instance:w.instance,cg:R,useVertexAlpha:w.useVertexAlpha,material:w.material},q)}function y(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=w.points,i=w.instance,z=w.gapSize||1,m=w.dashSize||3;if(i){const g=g=>{const w=R.ew.Zero(),q=g.length/6;let o=0,S=0,T=0,z=0,t=0,m=0,e=0,y=0;for(e=0;e<r.length-1;e++)r[e+1].subtractToRef(r[e],w),o+=w.length();T=o/q;const L=i._creationDataStorage.dashSize;for(z=L*T/(L+i._creationDataStorage.gapSize),e=0;e<r.length-1;e++)for(r[e+1].subtractToRef(r[e],w),S=Math.floor(w.length()/T),w.normalize(),y=0;y<S&&m<g.length;)t=T*y,g[m]=r[e].x+t*w.x,g[m+1]=r[e].y+t*w.y,g[m+2]=r[e].z+t*w.z,g[m+3]=r[e].x+(t+z)*w.x,g[m+4]=r[e].y+(t+z)*w.y,g[m+5]=r[e].z+(t+z)*w.z,m+=6,y++;for(;m<g.length;)g[m]=r[e].x,g[m+1]=r[e].y,g[m+2]=r[e].z,m+=3};return(w.dashNb||w.dashSize||w.gapSize||w.useVertexAlpha||w.material)&&T.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),i.updateMeshPositions(g,!1),i}const e=new S.e(g,q,null,void 0,void 0,void 0,w.useVertexAlpha,w.material);return t(w).Mg(e,w.updatable),e._creationDataStorage=new o.f,e._creationDataStorage.dashSize=m,e._creationDataStorage.gapSize=z,e}r.b.CreateLineSystem=z,r.b.CreateDashedLines=t,o.d.iz=function(g,w){return e(g,{points:w,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},o.d.CreateDashedLines=function(g,w,q,R,o){return y(g,{points:w,dashSize:q,gapSize:R,dashNb:o,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12393:(g,w,q)=>{"use strict";q.d(w,{c:()=>i,e:()=>T});var R=q(11586),o=q(11572),r=q(11242);function S(g){const w=[],q=[],R=[],S=[],i=void 0!==g.width?g.width:void 0!==g.size?g.size:1,T=void 0!==g.height?g.height:void 0!==g.size?g.size:1,z=0===g.sideOrientation?0:g.sideOrientation||o.b.DEFAULTSIDE,t=i/2,m=T/2;q.push(-t,-m,0),R.push(0,0,-1),S.push(0,r.b?1:0),q.push(t,-m,0),R.push(0,0,-1),S.push(1,r.b?1:0),q.push(t,m,0),R.push(0,0,-1),S.push(1,r.b?0:1),q.push(-t,m,0),R.push(0,0,-1),S.push(0,r.b?0:1),w.push(0),w.push(1),w.push(2),w.push(0),w.push(2),w.push(3),o.b._ComputeSides(z,q,w,R,S,g.frontUVs,g.backUVs);const e=new o.b;return e.indices=w,e.Hg=q,e.Cg=R,e.Pg=S,e}function i(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new R.d(g,q);w.sideOrientation=R.d._GetDefaultSideOrientation(w.sideOrientation),o._originalBuilderSideOrientation=w.sideOrientation;return S(w).Mg(o,w.updatable),w.sourcePlane&&(o.translate(w.sourcePlane.Lw,-w.sourcePlane.d),o.setDirection(w.sourcePlane.Lw.scale(-1))),o}const T={zz:i};o.b.zz=S,R.d.zz=(g,w,q,R,o)=>i(g,{size:w,width:w,height:w,sideOrientation:o,updatable:R},q)},12499:(g,w,q)=>{"use strict";q.d(w,{e:()=>T});var R=q(11180),o=q(11586),r=q(11572),S=q(11242);function i(g){const w=0|(g.segments||32),q=g.diameterX||g.diameter||1,o=g.diameterY||g.diameter||1,i=g.diameterZ||g.diameter||1,T=g.arc&&(g.arc<=0||g.arc>1)?1:g.arc||1,z=g.slice&&g.slice<=0?1:g.slice||1,t=0===g.sideOrientation?0:g.sideOrientation||r.b.DEFAULTSIDE,m=!!g.dedupTopBottomIndices,e=new R.ew(q/2,o/2,i/2),y=2+w,L=2*y,A=[],l=[],J=[],x=[];for(let r=0;r<=y;r++){const g=r/y,w=g*Math.PI*z;for(let q=0;q<=L;q++){const o=q/L,r=o*Math.PI*2*T,i=R.Matrix.RotationZ(-w),z=R.Matrix.RotationY(r),t=R.ew.TransformCoordinates(R.ew.Up(),i),m=R.ew.TransformCoordinates(t,z),y=m.multiply(e),A=m.divide(e).normalize();l.push(y.x,y.y,y.z),J.push(A.x,A.y,A.z),x.push(o,S.b?1-g:g)}if(r>0){const g=l.length/3;for(let w=g-2*(L+1);w+L+2<g;w++)m?(r>1&&(A.push(w),A.push(w+1),A.push(w+L+1)),(r<y||z<1)&&(A.push(w+L+1),A.push(w+1),A.push(w+L+2))):(A.push(w),A.push(w+1),A.push(w+L+1),A.push(w+L+1),A.push(w+1),A.push(w+L+2))}}r.b._ComputeSides(t,l,A,J,x,g.frontUVs,g.backUVs);const G=new r.b;return G.indices=A,G.Hg=l,G.Cg=J,G.Pg=x,G}function T(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new o.d(g,q);w.sideOrientation=o.d._GetDefaultSideOrientation(w.sideOrientation),R._originalBuilderSideOrientation=w.sideOrientation;return i(w).Mg(R,w.updatable),R}r.b.CreateSphere=i,o.d.CreateSphere=(g,w,q,R,o,r)=>T(g,{segments:w,diameterX:q,diameterY:q,diameterZ:q,sideOrientation:r,updatable:o},R)},13299:(g,w,q)=>{"use strict";q.d(w,{c:()=>i});var R=q(11702),o=q(12801),r=q(11719),S=q(11572);class i{static get Configuration(){return{get decoder(){return o.b.DefaultConfiguration},set decoder(g){o.b.DefaultConfiguration=g}}}static set Configuration(g){o.b.DefaultConfiguration=g.decoder}static get DecoderAvailable(){return(0,R.j)(o.b.DefaultConfiguration)}static get Default(){return i._Default??(i._Default=new i),i._Default}static ResetDefault(g){i._Default&&(g||i._Default.dispose(),i._Default=null)}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.DefaultNumWorkers;const w="number"===typeof g?{...o.b.DefaultConfiguration,numWorkers:g}:{...o.b.DefaultConfiguration,...g};this._decoder=new o.b(w)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(g,w,q){return this._decoder.decodeMeshToMeshDataAsync(g,w,q)}async decodeMeshToGeometryAsync(g,w,q,R){return await this._decoder.decodeMeshToGeometryAsync(g,w,q,R)}async _decodeMeshToGeometryForGltfAsync(g,w,q,R,o,r){return await this._decoder._decodeMeshToGeometryForGltfAsync(g,w,q,R,o,r)}async decodeMeshAsync(g,w){const q=await this._decoder.decodeMeshToMeshDataAsync(g,w),R=new S.b;q.indices&&(R.indices=q.indices);for(const o of q.attributes){const g=r.b.GetFloatData(o.data,o.size,r.b.GetDataType(o.data),o.byteOffset,o.byteStride,o.normalized,q.totalVertices);R.set(g,o.kind)}return R}}i.DefaultNumWorkers=(0,R.f)(),i._Default=null},12801:(g,w,q)=>{"use strict";q.d(w,{b:()=>z});var R=q(11702),o=q(10991),r=q(11596),S=q(11719),i=q(11011),T=q(11712);class z extends R.d{static get DefaultAvailable(){return(0,R.j)(z.DefaultConfiguration)}static get Default(){return z._Default??(z._Default=new z),z._Default}static ResetDefault(g){z._Default&&(g||z._Default.dispose(),z._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(g,w){return{module:await(w||DracoDecoderModule)({wasmBinary:g})}}_getWorkerContent(){return`${T.c}(${T.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.DefaultConfiguration)}decodeMeshToMeshDataAsync(g,w,q){const R=g instanceof ArrayBuffer?new Int8Array(g):new Int8Array(g.buffer,g.byteOffset,g.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async g=>await new Promise(((o,r)=>{g.push(((g,S)=>{let T=null;const z=[],t=w=>{g.removeEventListener("error",t),g.removeEventListener("message",m),r(w),S()},m=w=>{const R=w.data;switch(R.id){case"indices":T=R.data;break;case"attribute":z.push({kind:R.kind,data:R.data,size:R.size,byteOffset:R.byteOffset,byteStride:R.byteStride,normalized:(r=R.kind,e=R.normalized,q&&void 0!==q[r]?(e!==q[r]&&i.d.Warn(`Normalized flag from Draco data (${e}) does not match normalized flag from glTF accessor (${q[r]}). Using flag from glTF accessor.`),q[r]):e)});break;case"decodeMeshDone":g.removeEventListener("error",t),g.removeEventListener("message",m),o({indices:T,attributes:z,totalVertices:R.totalVertices}),S()}var r,e};g.addEventListener("error",t),g.addEventListener("message",m);const e=R.slice();g.postMessage({id:"decodeMesh",dataView:e,attributes:w},[e.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((g=>{let q=null;const o=[],r=(0,T.c)(g.module,R,w,(g=>{q=g}),((g,w,q,R,r,S)=>{o.push({kind:g,data:w,size:q,byteOffset:R,byteStride:r,normalized:S})}));return{indices:q,attributes:o,totalVertices:r}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(g,w,q,R){const o=await this.decodeMeshToMeshDataAsync(q,R),i=new r.b(g,w);o.indices&&i.setIndices(o.indices);for(const r of o.attributes)i.setVerticesBuffer(new S.b(w.getEngine(),r.data,r.kind,!1,void 0,r.byteStride,void 0,r.byteOffset,r.size,void 0,r.normalized,!0),o.totalVertices);return i}async _decodeMeshToGeometryForGltfAsync(g,w,q,R,o,i){const T=await this.decodeMeshToMeshDataAsync(q,R,o),z=new r.b(g,w);i&&(z._boundingInfo=i,z.useBoundingInfoFromGeometry=!0),T.indices&&z.setIndices(T.indices);for(const r of T.attributes)z.setVerticesBuffer(new S.b(w.getEngine(),r.data,r.kind,!1,void 0,r.byteStride,void 0,r.byteOffset,r.size,void 0,r.normalized,!0),T.totalVertices);return z}}z.DefaultConfiguration={wasmUrl:`${o.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${o.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${o.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},z._Default=null},13007:(g,w,q)=>{"use strict";q.d(w,{b:()=>ig});var R=q(11180),o=q(11586),r=q(11250),S=q(11572),i=q(11242);function T(g){let w=g.pathArray;const q=g.closeArray||!1,R=g.closePath||!1,o=g.invertUV||!1,T=Math.floor(w[0].length/2);let z=g.offset||T;z=z>T?T:Math.floor(z);const t=0===g.sideOrientation?0:g.sideOrientation||S.b.DEFAULTSIDE,m=g.Pg,e=g.cg,y=[],L=[],A=[],l=[],J=[],x=[],G=[],d=[];let D;const U=[],N=[];let a,H,C;if(w.length<2){const g=[],q=[];for(H=0;H<w[0].length-z;H++)g.push(w[0][H]),q.push(w[0][H+z]);w=[g,q]}let c=0;const P=R?1:0,j=q?1:0;let M,V,s,h,v,b;for(D=w[0].length,a=0;a<w.length+j;a++){for(G[a]=0,J[a]=[0],M=a===w.length?w[0]:w[a],V=M.length,D=D<V?D:V,C=0;C<V;)y.push(M[C].x,M[C].y,M[C].z),C>0&&(s=M[C].yw(M[C-1]).length(),h=s+G[a],J[a].push(h),G[a]=h),C++;R&&(C--,y.push(M[0].x,M[0].y,M[0].z),s=M[C].yw(M[0]).length(),h=s+G[a],J[a].push(h),G[a]=h),U[a]=V+P,N[a]=c,c+=V+P}let B,f,O=null,E=null;for(H=0;H<D+P;H++)for(d[H]=0,x[H]=[0],a=0;a<w.length-1+j;a++)v=w[a],b=a===w.length-1?w[0]:w[a+1],H===D?(O=v[0],E=b[0]):(O=v[H],E=b[H]),s=E.yw(O).length(),h=s+d[H],x[H].push(h),d[H]=h;if(m)for(a=0;a<m.length;a++)l.push(m[a].x,i.b?1-m[a].y:m[a].y);else for(a=0;a<w.length+j;a++)for(H=0;H<D+P;H++)B=0!=G[a]?J[a][H]/G[a]:0,f=0!=d[H]?x[H][a]/d[H]:0,o?l.push(f,B):l.push(B,i.b?1-f:f);a=0;let Q=0,X=U[a]-1,K=U[a+1]-1,Y=X<K?X:K,F=N[1]-N[0];const u=U.length-1;for(;Q<=Y&&a<u;)L.push(Q,Q+F,Q+1),L.push(Q+F+1,Q+1,Q+F),Q+=1,Q===Y&&(a++,F=N[a+1]-N[a],X=U[a]-1,K=U[a+1]-1,Q=N[a],Y=X<K?X+Q:K+Q);if(S.b.ComputeNormals(y,L,A),R){let g=0,q=0;for(a=0;a<w.length;a++){g=3*N[a],q=a+1<w.length?3*(N[a+1]-1):A.length-3,A[g]=.5*(A[g]+A[q]),A[g+1]=.5*(A[g+1]+A[q+1]),A[g+2]=.5*(A[g+2]+A[q+2]);const R=Math.sqrt(A[g]*A[g]+A[g+1]*A[g+1]+A[g+2]*A[g+2]);A[g]/=R,A[g+1]/=R,A[g+2]/=R,A[q]=A[g],A[q+1]=A[g+1],A[q+2]=A[g+2]}}if(q){let g=3*N[0],q=3*N[w.length];for(H=0;H<D+P;H++){A[g]=.5*(A[g]+A[q]),A[g+1]=.5*(A[g+1]+A[q+1]),A[g+2]=.5*(A[g+2]+A[q+2]);const w=Math.sqrt(A[g]*A[g]+A[g+1]*A[g+1]+A[g+2]*A[g+2]);A[g]/=w,A[g+1]/=w,A[g+2]/=w,A[q]=A[g],A[q+1]=A[g+1],A[q+2]=A[g+2],g+=3,q+=3}}S.b._ComputeSides(t,y,L,A,l,g.frontUVs,g.backUVs);let n=null;if(e){n=new Float32Array(4*e.length);for(let g=0;g<e.length;g++)n[4*g]=e[g].r,n[4*g+1]=e[g].g,n[4*g+2]=e[g].b,n[4*g+3]=e[g].a}const W=new S.b,p=new Float32Array(y),Z=new Float32Array(A),I=new Float32Array(l);return W.indices=L,W.Hg=p,W.Cg=Z,W.Pg=I,n&&W.set(n,r.h.ColorKind),R&&(W._idx=N),W}function z(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=w.pathArray,t=w.closeArray,m=w.closePath,e=o.d._GetDefaultSideOrientation(w.sideOrientation),y=w.instance,L=w.updatable;if(y){const g=R.TmpVectors.ew[0].yi(Number.MAX_VALUE),q=R.TmpVectors.ew[1].yi(-Number.MAX_VALUE),T=w=>{let R=z[0].length;const r=y;let S=0;const i=r._originalBuilderSideOrientation===o.d.DOUBLESIDE?2:1;for(let o=1;o<=i;++o)for(let i=0;i<z.length;++i){const o=z[i],T=o.length;R=R<T?R:T;for(let r=0;r<R;++r){const R=o[r];w[S]=R.x,w[S+1]=R.y,w[S+2]=R.z,g.minimizeInPlaceFromFloats(R.x,R.y,R.z),q.maximizeInPlaceFromFloats(R.x,R.y,R.z),S+=3}if(r._creationDataStorage&&r._creationDataStorage.closePath){const g=o[0];w[S]=g.x,w[S+1]=g.y,w[S+2]=g.z,S+=3}}},t=y.getVerticesData(r.h.PositionKind);if(T(t),y.hasBoundingInfo?y.getBoundingInfo().reConstruct(g,q,y._worldMatrix):y.buildBoundingInfo(g,q,y._worldMatrix),y.updateVerticesData(r.h.PositionKind,t,!1,!1),w.cg){const g=y.getVerticesData(r.h.ColorKind);for(let q=0,R=0;q<w.cg.length;q++,R+=4){const o=w.cg[q];g[R]=o.r,g[R+1]=o.g,g[R+2]=o.b,g[R+3]=o.a}y.updateVerticesData(r.h.ColorKind,g,!1,!1)}if(w.Pg){const g=y.getVerticesData(r.h.UVKind);for(let q=0;q<w.Pg.length;q++)g[2*q]=w.Pg[q].x,g[2*q+1]=i.b?1-w.Pg[q].y:w.Pg[q].y;y.updateVerticesData(r.h.UVKind,g,!1,!1)}if(!y.areNormalsFrozen||y.isFacetDataEnabled){const g=y.zi(),w=y.getVerticesData(r.h.NormalKind),q=y.isFacetDataEnabled?y.getFacetDataParameters():null;if(S.b.ComputeNormals(t,g,w,q),y._creationDataStorage&&y._creationDataStorage.closePath){let g=0,q=0;for(let R=0;R<z.length;R++)g=3*y._creationDataStorage.idx[R],q=R+1<z.length?3*(y._creationDataStorage.idx[R+1]-1):w.length-3,w[g]=.5*(w[g]+w[q]),w[g+1]=.5*(w[g+1]+w[q+1]),w[g+2]=.5*(w[g+2]+w[q+2]),w[q]=w[g],w[q+1]=w[g+1],w[q+2]=w[g+2]}y.areNormalsFrozen||y.updateVerticesData(r.h.NormalKind,w,!1,!1)}return y}{const R=new o.d(g,q);R._originalBuilderSideOrientation=e,R._creationDataStorage=new o.f;const r=T(w);return m&&(R._creationDataStorage.idx=r._idx),R._creationDataStorage.closePath=m,R._creationDataStorage.closeArray=t,r.Mg(R,L),R}}S.b.CreateRibbon=T,o.d.CreateRibbon=function(g,w){return z(g,{pathArray:w,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var t=q(12504),m=q(12331),e=q(11235);function y(g){const w=g.pattern||o.d.NO_FLIP,q=g.tileWidth||g.tileSize||1,R=g.tileHeight||g.tileSize||1,r=g.alignHorizontal||0,i=g.alignVertical||0,T=g.width||g.size||1,z=Math.floor(T/q);let t=T-z*q;const m=g.height||g.size||1,e=Math.floor(m/R);let y=m-e*R;const L=q*z/2,A=R*e/2;let l=0,J=0,x=0,G=0,d=0,D=0;if(t>0||y>0){switch(x=-L,G=-A,d=L,D=A,r){case o.d.CENTER:t/=2,x-=t,d+=t;break;case o.d.LEFT:d+=t,l=-t/2;break;case o.d.RIGHT:x-=t,l=t/2}switch(i){case o.d.CENTER:y/=2,G-=y,D+=y;break;case o.d.BOTTOM:D+=y,J=-y/2;break;case o.d.TOP:G-=y,J=y/2}}const U=[],N=[],a=[];a[0]=[0,0,1,0,1,1,0,1],a[1]=[0,0,1,0,1,1,0,1],w!==o.d.ROTATE_TILE&&w!==o.d.ROTATE_ROW||(a[1]=[1,1,0,1,0,0,1,0]),w!==o.d.FLIP_TILE&&w!==o.d.FLIP_ROW||(a[1]=[1,0,0,0,0,1,1,1]),w!==o.d.FLIP_N_ROTATE_TILE&&w!==o.d.FLIP_N_ROTATE_ROW||(a[1]=[0,1,1,1,1,0,0,0]);let H=[];const C=[],c=[];let P=0;for(let S=0;S<e;S++)for(let g=0;g<z;g++)U.push(g*q-L+l,S*R-A+J,0),U.push((g+1)*q-L+l,S*R-A+J,0),U.push((g+1)*q-L+l,(S+1)*R-A+J,0),U.push(g*q-L+l,(S+1)*R-A+J,0),c.push(P,P+1,P+3,P+1,P+2,P+3),H=w===o.d.FLIP_TILE||w===o.d.ROTATE_TILE||w===o.d.FLIP_N_ROTATE_TILE?H.concat(a[(g%2+S%2)%2]):w===o.d.FLIP_ROW||w===o.d.ROTATE_ROW||w===o.d.FLIP_N_ROTATE_ROW?H.concat(a[S%2]):H.concat(a[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),P+=4;if(t>0||y>0){const g=y>0&&(i===o.d.CENTER||i===o.d.TOP),S=y>0&&(i===o.d.CENTER||i===o.d.BOTTOM),T=t>0&&(r===o.d.CENTER||r===o.d.RIGHT),m=t>0&&(r===o.d.CENTER||r===o.d.LEFT);let a,j,M,V,s=[];if(g&&T&&(U.push(x+l,G+J,0),U.push(-L+l,G+J,0),U.push(-L+l,G+y+J,0),U.push(x+l,G+y+J,0),c.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,a=1-t/q,j=1-y/R,M=1,V=1,s=[a,j,M,j,M,V,a,V],w===o.d.ROTATE_ROW&&(s=[1-a,1-j,1-M,1-j,1-M,1-V,1-a,1-V]),w===o.d.FLIP_ROW&&(s=[1-a,j,1-M,j,1-M,V,1-a,V]),w===o.d.FLIP_N_ROTATE_ROW&&(s=[a,1-j,M,1-j,M,1-V,a,1-V]),H=H.concat(s),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&m&&(U.push(L+l,G+J,0),U.push(d+l,G+J,0),U.push(d+l,G+y+J,0),U.push(L+l,G+y+J,0),c.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,a=0,j=1-y/R,M=t/q,V=1,s=[a,j,M,j,M,V,a,V],(w===o.d.ROTATE_ROW||w===o.d.ROTATE_TILE&&z%2===0)&&(s=[1-a,1-j,1-M,1-j,1-M,1-V,1-a,1-V]),(w===o.d.FLIP_ROW||w===o.d.FLIP_TILE&&z%2===0)&&(s=[1-a,j,1-M,j,1-M,V,1-a,V]),(w===o.d.FLIP_N_ROTATE_ROW||w===o.d.FLIP_N_ROTATE_TILE&&z%2===0)&&(s=[a,1-j,M,1-j,M,1-V,a,1-V]),H=H.concat(s),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S&&T&&(U.push(x+l,A+J,0),U.push(-L+l,A+J,0),U.push(-L+l,D+J,0),U.push(x+l,D+J,0),c.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,a=1-t/q,j=0,M=1,V=y/R,s=[a,j,M,j,M,V,a,V],(w===o.d.ROTATE_ROW&&e%2===1||w===o.d.ROTATE_TILE&&e%1===0)&&(s=[1-a,1-j,1-M,1-j,1-M,1-V,1-a,1-V]),(w===o.d.FLIP_ROW&&e%2===1||w===o.d.FLIP_TILE&&e%2===0)&&(s=[1-a,j,1-M,j,1-M,V,1-a,V]),(w===o.d.FLIP_N_ROTATE_ROW&&e%2===1||w===o.d.FLIP_N_ROTATE_TILE&&e%2===0)&&(s=[a,1-j,M,1-j,M,1-V,a,1-V]),H=H.concat(s),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S&&m&&(U.push(L+l,A+J,0),U.push(d+l,A+J,0),U.push(d+l,D+J,0),U.push(L+l,D+J,0),c.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,a=0,j=0,M=t/q,V=y/R,s=[a,j,M,j,M,V,a,V],(w===o.d.ROTATE_ROW&&e%2===1||w===o.d.ROTATE_TILE&&(e+z)%2===1)&&(s=[1-a,1-j,1-M,1-j,1-M,1-V,1-a,1-V]),(w===o.d.FLIP_ROW&&e%2===1||w===o.d.FLIP_TILE&&(e+z)%2===1)&&(s=[1-a,j,1-M,j,1-M,V,1-a,V]),(w===o.d.FLIP_N_ROTATE_ROW&&e%2===1||w===o.d.FLIP_N_ROTATE_TILE&&(e+z)%2===1)&&(s=[a,1-j,M,1-j,M,1-V,a,1-V]),H=H.concat(s),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g){const g=[];a=0,j=1-y/R,M=1,V=1,g[0]=[a,j,M,j,M,V,a,V],g[1]=[a,j,M,j,M,V,a,V],w!==o.d.ROTATE_TILE&&w!==o.d.ROTATE_ROW||(g[1]=[1-a,1-j,1-M,1-j,1-M,1-V,1-a,1-V]),w!==o.d.FLIP_TILE&&w!==o.d.FLIP_ROW||(g[1]=[1-a,j,1-M,j,1-M,V,1-a,V]),w!==o.d.FLIP_N_ROTATE_TILE&&w!==o.d.FLIP_N_ROTATE_ROW||(g[1]=[a,1-j,M,1-j,M,1-V,a,1-V]);for(let R=0;R<z;R++)U.push(R*q-L+l,G+J,0),U.push((R+1)*q-L+l,G+J,0),U.push((R+1)*q-L+l,G+y+J,0),U.push(R*q-L+l,G+y+J,0),c.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,H=w===o.d.FLIP_TILE||w===o.d.ROTATE_TILE||w===o.d.FLIP_N_ROTATE_TILE?H.concat(g[(R+1)%2]):w===o.d.FLIP_ROW||w===o.d.ROTATE_ROW||w===o.d.FLIP_N_ROTATE_ROW?H.concat(g[1]):H.concat(g[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(S){const g=[];a=0,j=0,M=1,V=y/R,g[0]=[a,j,M,j,M,V,a,V],g[1]=[a,j,M,j,M,V,a,V],w!==o.d.ROTATE_TILE&&w!==o.d.ROTATE_ROW||(g[1]=[1-a,1-j,1-M,1-j,1-M,1-V,1-a,1-V]),w!==o.d.FLIP_TILE&&w!==o.d.FLIP_ROW||(g[1]=[1-a,j,1-M,j,1-M,V,1-a,V]),w!==o.d.FLIP_N_ROTATE_TILE&&w!==o.d.FLIP_N_ROTATE_ROW||(g[1]=[a,1-j,M,1-j,M,1-V,a,1-V]);for(let R=0;R<z;R++)U.push(R*q-L+l,D-y+J,0),U.push((R+1)*q-L+l,D-y+J,0),U.push((R+1)*q-L+l,D+J,0),U.push(R*q-L+l,D+J,0),c.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,H=w===o.d.FLIP_TILE||w===o.d.ROTATE_TILE||w===o.d.FLIP_N_ROTATE_TILE?H.concat(g[(R+e)%2]):w===o.d.FLIP_ROW||w===o.d.ROTATE_ROW||w===o.d.FLIP_N_ROTATE_ROW?H.concat(g[e%2]):H.concat(g[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(T){const g=[];a=1-t/q,j=0,M=1,V=1,g[0]=[a,j,M,j,M,V,a,V],g[1]=[a,j,M,j,M,V,a,V],w!==o.d.ROTATE_TILE&&w!==o.d.ROTATE_ROW||(g[1]=[1-a,1-j,1-M,1-j,1-M,1-V,1-a,1-V]),w!==o.d.FLIP_TILE&&w!==o.d.FLIP_ROW||(g[1]=[1-a,j,1-M,j,1-M,V,1-a,V]),w!==o.d.FLIP_N_ROTATE_TILE&&w!==o.d.FLIP_N_ROTATE_ROW||(g[1]=[a,1-j,M,1-j,M,1-V,a,1-V]);for(let q=0;q<e;q++)U.push(x+l,q*R-A+J,0),U.push(x+t+l,q*R-A+J,0),U.push(x+t+l,(q+1)*R-A+J,0),U.push(x+l,(q+1)*R-A+J,0),c.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,H=w===o.d.FLIP_TILE||w===o.d.ROTATE_TILE||w===o.d.FLIP_N_ROTATE_TILE?H.concat(g[(q+1)%2]):w===o.d.FLIP_ROW||w===o.d.ROTATE_ROW||w===o.d.FLIP_N_ROTATE_ROW?H.concat(g[q%2]):H.concat(g[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(m){const g=[];a=0,j=0,M=t/R,V=1,g[0]=[a,j,M,j,M,V,a,V],g[1]=[a,j,M,j,M,V,a,V],w!==o.d.ROTATE_TILE&&w!==o.d.ROTATE_ROW||(g[1]=[1-a,1-j,1-M,1-j,1-M,1-V,1-a,1-V]),w!==o.d.FLIP_TILE&&w!==o.d.FLIP_ROW||(g[1]=[1-a,j,1-M,j,1-M,V,1-a,V]),w!==o.d.FLIP_N_ROTATE_TILE&&w!==o.d.FLIP_N_ROTATE_ROW||(g[1]=[a,1-j,M,1-j,M,1-V,a,1-V]);for(let q=0;q<e;q++)U.push(d-t+l,q*R-A+J,0),U.push(d+l,q*R-A+J,0),U.push(d+l,(q+1)*R-A+J,0),U.push(d-t+l,(q+1)*R-A+J,0),c.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,H=w===o.d.FLIP_TILE||w===o.d.ROTATE_TILE||w===o.d.FLIP_N_ROTATE_TILE?H.concat(g[(q+z)%2]):w===o.d.FLIP_ROW||w===o.d.ROTATE_ROW||w===o.d.FLIP_N_ROTATE_ROW?H.concat(g[q%2]):H.concat(g[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),N.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const j=0===g.sideOrientation?0:g.sideOrientation||S.b.DEFAULTSIDE;S.b._ComputeSides(j,U,c,N,H,g.frontUVs,g.backUVs);const M=new S.b;M.indices=c,M.Hg=U,M.Cg=N,M.Pg=H;const V=j===S.b.DOUBLESIDE?C.concat(C):C;return M.cg=V,M}function L(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new o.d(g,q);w.sideOrientation=o.d._GetDefaultSideOrientation(w.sideOrientation),R._originalBuilderSideOrientation=w.sideOrientation;return y(w).Mg(R,w.updatable),R}function A(g){const w=g.faceUV||new Array(6),q=g.faceColors,r=g.pattern||o.d.NO_FLIP,T=g.width||g.size||1,z=g.height||g.size||1,t=g.depth||g.size||1,m=g.tileWidth||g.tileSize||1,L=g.tileHeight||g.tileSize||1,A=g.alignHorizontal||0,l=g.alignVertical||0,J=0===g.sideOrientation?0:g.sideOrientation||S.b.DEFAULTSIDE;for(let o=0;o<6;o++)void 0===w[o]&&(w[o]=new R.Vector4(0,0,1,1)),q&&void 0===q[o]&&(q[o]=new e.d(1,1,1,1));const x=T/2,G=z/2,d=t/2,D=[];for(let R=0;R<2;R++)D[R]=y({pattern:r,tileWidth:m,tileHeight:L,width:T,height:z,alignVertical:l,alignHorizontal:A,sideOrientation:J});for(let R=2;R<4;R++)D[R]=y({pattern:r,tileWidth:m,tileHeight:L,width:t,height:z,alignVertical:l,alignHorizontal:A,sideOrientation:J});let U=l;l===o.d.BOTTOM?U=o.d.TOP:l===o.d.TOP&&(U=o.d.BOTTOM);for(let R=4;R<6;R++)D[R]=y({pattern:r,tileWidth:m,tileHeight:L,width:T,height:t,alignVertical:U,alignHorizontal:A,sideOrientation:J});let N=[],a=[],H=[],C=[];const c=[],P=[],j=[],M=[];let V=0,s=0;for(let o=0;o<6;o++){const g=D[o].Hg.length;P[o]=[],j[o]=[];for(let w=0;w<g/3;w++)P[o].push(new R.ew(D[o].Hg[3*w],D[o].Hg[3*w+1],D[o].Hg[3*w+2])),j[o].push(new R.ew(D[o].Cg[3*w],D[o].Cg[3*w+1],D[o].Cg[3*w+2]));V=D[o].Pg.length,M[o]=[];for(let q=0;q<V;q+=2)M[o][q]=w[o].x+(w[o].z-w[o].x)*D[o].Pg[q],M[o][q+1]=w[o].y+(w[o].w-w[o].y)*D[o].Pg[q+1],i.b&&(M[o][q+1]=1-M[o][q+1]);if(H=H.concat(M[o]),C=C.concat(D[o].indices.map((g=>g+s))),s+=P[o].length,q)for(let w=0;w<4;w++)c.push(q[o].r,q[o].g,q[o].b,q[o].a)}const h=new R.ew(0,0,d),v=R.Matrix.RotationY(Math.PI);N=P[0].map((g=>R.ew.TransformNormal(g,v).add(h))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[]),a=j[0].map((g=>R.ew.TransformNormal(g,v))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[]),N=N.concat(P[1].map((g=>g.yw(h))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[])),a=a.concat(j[1].map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[]));const b=new R.ew(x,0,0),B=R.Matrix.RotationY(-Math.PI/2);N=N.concat(P[2].map((g=>R.ew.TransformNormal(g,B).add(b))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[])),a=a.concat(j[2].map((g=>R.ew.TransformNormal(g,B))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[]));const f=R.Matrix.RotationY(Math.PI/2);N=N.concat(P[3].map((g=>R.ew.TransformNormal(g,f).yw(b))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[])),a=a.concat(j[3].map((g=>R.ew.TransformNormal(g,f))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[]));const O=new R.ew(0,G,0),E=R.Matrix.RotationX(Math.PI/2);N=N.concat(P[4].map((g=>R.ew.TransformNormal(g,E).add(O))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[])),a=a.concat(j[4].map((g=>R.ew.TransformNormal(g,E))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[]));const Q=R.Matrix.RotationX(-Math.PI/2);N=N.concat(P[5].map((g=>R.ew.TransformNormal(g,Q).yw(O))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[])),a=a.concat(j[5].map((g=>R.ew.TransformNormal(g,Q))).map((g=>[g.x,g.y,g.z])).reduce(((g,w)=>g.concat(w)),[])),S.b._ComputeSides(J,N,C,a,H);const X=new S.b;if(X.indices=C,X.Hg=N,X.Cg=a,X.Pg=H,q){const g=J===S.b.DOUBLESIDE?c.concat(c):c;X.cg=g}return X}function l(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new o.d(g,q);w.sideOrientation=o.d._GetDefaultSideOrientation(w.sideOrientation),R._originalBuilderSideOrientation=w.sideOrientation;return A(w).Mg(R,w.updatable),R}S.b.CreateTiledPlane=y;S.b.CreateTiledBox=A;var J=q(12499),x=q(11395),G=q(11360);function d(g){const w=g.height||2;let q=0===g.diameterTop?0:g.diameterTop||g.diameter||1,r=0===g.diameterBottom?0:g.diameterBottom||g.diameter||1;q=q||1e-5,r=r||1e-5;const T=0|(g.tessellation||24),z=0|(g.subdivisions||1),t=!!g.hasRings,m=!!g.enclose,y=0===g.cap?0:g.cap||o.d.CAP_ALL,L=g.arc&&(g.arc<=0||g.arc>1)?1:g.arc||1,A=0===g.sideOrientation?0:g.sideOrientation||S.b.DEFAULTSIDE,l=g.faceUV||new Array(3),J=g.faceColors,x=2+(1+(1!==L&&m?2:0))*(t?z:1);let d;for(d=0;d<x;d++)J&&void 0===J[d]&&(J[d]=new e.d(1,1,1,1));for(d=0;d<x;d++)l&&void 0===l[d]&&(l[d]=new R.Vector4(0,0,1,1));const D=[],U=[],N=[],a=[],H=[],C=2*Math.PI*L/T;let c,P,j;const M=(r-q)/2/w,V=R.ew.Zero(),s=R.ew.Zero(),h=R.ew.Zero(),v=R.ew.Zero(),b=R.ew.Zero(),B=G.b.Y;let f,O,E,Q=1,X=1,K=0,Y=0;for(f=0;f<=z;f++)for(P=f/z,j=(P*(q-r)+r)/2,Q=t&&0!==f&&f!==z?2:1,E=0;E<Q;E++){for(t&&(X+=E),m&&(X+=2*E),O=0;O<=T;O++)c=O*C,V.x=Math.cos(-c)*j,V.y=-w/2+P*w,V.z=Math.sin(-c)*j,0===q&&f===z?(s.x=N[N.length-3*(T+1)],s.y=N[N.length-3*(T+1)+1],s.z=N[N.length-3*(T+1)+2]):(s.x=V.x,s.z=V.z,s.y=Math.sqrt(s.x*s.x+s.z*s.z)*M,s.normalize()),0===O&&(h.T(V),v.T(s)),U.push(V.x,V.y,V.z),N.push(s.x,s.y,s.z),Y=t?K!==X?l[X].y:l[X].w:l[X].y+(l[X].w-l[X].y)*P,a.push(l[X].x+(l[X].z-l[X].x)*O/T,i.b?1-Y:Y),J&&H.push(J[X].r,J[X].g,J[X].b,J[X].a);1!==L&&m&&(U.push(V.x,V.y,V.z),U.push(0,V.y,0),U.push(0,V.y,0),U.push(h.x,h.y,h.z),R.ew.CrossToRef(B,s,b),b.normalize(),N.push(b.x,b.y,b.z,b.x,b.y,b.z),R.ew.CrossToRef(v,B,b),b.normalize(),N.push(b.x,b.y,b.z,b.x,b.y,b.z),Y=t?K!==X?l[X+1].y:l[X+1].w:l[X+1].y+(l[X+1].w-l[X+1].y)*P,a.push(l[X+1].x,i.b?1-Y:Y),a.push(l[X+1].z,i.b?1-Y:Y),Y=t?K!==X?l[X+2].y:l[X+2].w:l[X+2].y+(l[X+2].w-l[X+2].y)*P,a.push(l[X+2].x,i.b?1-Y:Y),a.push(l[X+2].z,i.b?1-Y:Y),J&&(H.push(J[X+1].r,J[X+1].g,J[X+1].b,J[X+1].a),H.push(J[X+1].r,J[X+1].g,J[X+1].b,J[X+1].a),H.push(J[X+2].r,J[X+2].g,J[X+2].b,J[X+2].a),H.push(J[X+2].r,J[X+2].g,J[X+2].b,J[X+2].a))),K!==X&&(K=X)}const F=1!==L&&m?T+4:T;for(f=0,X=0;X<z;X++){let g=0,w=0,q=0,R=0;for(O=0;O<T;O++)g=f*(F+1)+O,w=(f+1)*(F+1)+O,q=f*(F+1)+(O+1),R=(f+1)*(F+1)+(O+1),D.push(g,w,q),D.push(R,q,w);1!==L&&m&&(D.push(g+2,w+2,q+2),D.push(R+2,q+2,w+2),D.push(g+4,w+4,q+4),D.push(R+4,q+4,w+4)),f=t?f+2:f+1}const u=g=>{const o=g?q/2:r/2;if(0===o)return;let S,z,t;const m=g?l[x-1]:l[0];let e=null;J&&(e=g?J[x-1]:J[0]);const y=U.length/3,A=g?w/2:-w/2,G=new R.ew(0,A,0);U.push(G.x,G.y,G.z),N.push(0,g?1:-1,0);const d=m.y+.5*(m.w-m.y);a.push(m.x+.5*(m.z-m.x),i.b?1-d:d),e&&H.push(e.r,e.g,e.b,e.a);const C=new R.Vector2(.5,.5);for(t=0;t<=T;t++){S=2*Math.PI*t*L/T;const w=Math.cos(-S),q=Math.sin(-S);z=new R.ew(w*o,A,q*o);const r=new R.Vector2(w*C.x+.5,q*C.y+.5);U.push(z.x,z.y,z.z),N.push(0,g?1:-1,0);const y=m.y+(m.w-m.y)*r.y;a.push(m.x+(m.z-m.x)*r.x,i.b?1-y:y),e&&H.push(e.r,e.g,e.b,e.a)}for(t=0;t<T;t++)g?(D.push(y),D.push(y+(t+2)),D.push(y+(t+1))):(D.push(y),D.push(y+(t+1)),D.push(y+(t+2)))};y!==o.d.CAP_START&&y!==o.d.CAP_ALL||u(!1),y!==o.d.CAP_END&&y!==o.d.CAP_ALL||u(!0),S.b._ComputeSides(A,U,D,N,a,g.frontUVs,g.backUVs);const n=new S.b;return n.indices=D,n.Hg=U,n.Cg=N,n.Pg=a,J&&(n.cg=H),n}function D(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;const R=new o.d(g,q);w.sideOrientation=o.d._GetDefaultSideOrientation(w.sideOrientation),R._originalBuilderSideOrientation=w.sideOrientation;return d(w).Mg(R,w.updatable),R}function U(g){const w=[],q=[],o=[],r=[],T=g.diameter||1,z=g.thickness||.5,t=0|(g.tessellation||16),m=0===g.sideOrientation?0:g.sideOrientation||S.b.DEFAULTSIDE,e=t+1;for(let S=0;S<=t;S++){const g=S/t,m=S*Math.PI*2/t-Math.PI/2,y=R.Matrix.Translation(T/2,0,0).multiply(R.Matrix.RotationY(m));for(let T=0;T<=t;T++){const m=1-T/t,L=T*Math.PI*2/t+Math.PI,A=Math.cos(L),l=Math.sin(L);let J=new R.ew(A,l,0),x=J.scale(z/2);const G=new R.Vector2(g,m);x=R.ew.TransformCoordinates(x,y),J=R.ew.TransformNormal(J,y),q.push(x.x,x.y,x.z),o.push(J.x,J.y,J.z),r.push(G.x,i.b?1-G.y:G.y);const d=(S+1)%e,D=(T+1)%e;w.push(S*e+T),w.push(S*e+D),w.push(d*e+T),w.push(S*e+D),w.push(d*e+D),w.push(d*e+T)}}S.b._ComputeSides(m,q,w,o,r,g.frontUVs,g.backUVs);const y=new S.b;return y.indices=w,y.Hg=q,y.Cg=o,y.Pg=r,y}function N(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;const R=new o.d(g,q);w.sideOrientation=o.d._GetDefaultSideOrientation(w.sideOrientation),R._originalBuilderSideOrientation=w.sideOrientation;return U(w).Mg(R,w.updatable),R}S.b.CreateCylinder=d,o.d.CreateCylinder=(g,w,q,R,r,S,i,T,z)=>{void 0!==i&&i instanceof x.c||(void 0!==i&&(z=T||o.d.DEFAULTSIDE,T=i),i=S,S=1);return D(g,{height:w,diameterTop:q,diameterBottom:R,tessellation:r,subdivisions:S,sideOrientation:z,updatable:T},i)};function a(g){const w=[],q=[],o=[],r=[],T=g.radius||2,z=g.tube||.5,t=g.radialSegments||32,m=g.tubularSegments||32,e=g.p||2,y=g.q||3,L=0===g.sideOrientation?0:g.sideOrientation||S.b.DEFAULTSIDE,A=g=>{const w=Math.cos(g),q=Math.sin(g),o=y/e*g,r=Math.cos(o),S=T*(2+r)*.5*w,i=T*(2+r)*q*.5,z=T*Math.sin(o)*.5;return new R.ew(S,i,z)};let l,J;for(l=0;l<=t;l++){const g=l%t/t*2*e*Math.PI,w=A(g),o=A(g+.01),S=o.yw(w);let T=o.add(w);const y=R.ew.Cross(S,T);for(T=R.ew.Cross(y,S),y.normalize(),T.normalize(),J=0;J<m;J++){const g=J%m/m*2*Math.PI,R=-z*Math.cos(g),o=z*Math.sin(g);q.push(w.x+R*T.x+o*y.x),q.push(w.y+R*T.y+o*y.y),q.push(w.z+R*T.z+o*y.z),r.push(l/t),r.push(i.b?1-J/m:J/m)}}for(l=0;l<t;l++)for(J=0;J<m;J++){const g=(J+1)%m,q=l*m+J,R=(l+1)*m+J,o=(l+1)*m+g,r=l*m+g;w.push(r),w.push(R),w.push(q),w.push(r),w.push(o),w.push(R)}S.b.ComputeNormals(q,w,o),S.b._ComputeSides(L,q,w,o,r,g.frontUVs,g.backUVs);const x=new S.b;return x.indices=w,x.Hg=q,x.Cg=o,x.Pg=r,x}function H(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;const R=new o.d(g,q);w.sideOrientation=o.d._GetDefaultSideOrientation(w.sideOrientation),R._originalBuilderSideOrientation=w.sideOrientation;return a(w).Mg(R,w.updatable),R}S.b.CreateTorus=U,o.d.CreateTorus=(g,w,q,R,o,r,S)=>N(g,{diameter:w,thickness:q,tessellation:R,sideOrientation:S,updatable:r},o);S.b.CreateTorusKnot=a,o.d.CreateTorusKnot=(g,w,q,R,o,r,S,i,T,z)=>H(g,{radius:w,tube:q,radialSegments:R,tubularSegments:o,p:r,q:S,sideOrientation:z,updatable:T},i);var C=q(13010),c=q(11689),P=q(11369);function j(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=w.path,r=w.shape,S=w.scale||1,i=w.rotation||0,T=0===w.cap?0:w.cap||o.d.NO_CAP,z=w.updatable,t=o.d._GetDefaultSideOrientation(w.sideOrientation),m=w.instance||null,e=w.invertUV||!1,y=w.closeShape||!1,L=w.closePath||!1,A=w.capFunction||null;return V(g,r,R,S,i,null,null,L,y,T,!1,q,!!z,t,m,e,w.frontUVs||null,w.backUVs||null,w.firstNormal||null,!!w.adjustFrame,A)}function M(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=w.path,r=w.shape,S=w.scaleFunction||(()=>1),i=w.rotationFunction||(()=>0),T=w.closePath||w.ribbonCloseArray||!1,z=w.closeShape||w.ribbonClosePath||!1,t=0===w.cap?0:w.cap||o.d.NO_CAP,m=w.updatable,e=w.firstNormal||null,y=w.adjustFrame||!1,L=o.d._GetDefaultSideOrientation(w.sideOrientation),A=w.instance,l=w.invertUV||!1,J=w.capFunction||null;return V(g,r,R,null,null,S,i,T,z,t,!0,q,!!m,L,A||null,l,w.frontUVs||null,w.backUVs||null,e,y,J||null)}function V(g,w,q,r,S,i,T,t,m,e,y,L,A,l,J,x,G,d,D,U,N){const a=(g,w,q,r,S,i,T,z,t,m,e)=>{const y=q.getTangents(),L=q.getNormals(),A=q.getBinormals(),l=q.getDistances();if(e)for(let o=0;o<y.length;o++)if(0==y[o].x&&0==y[o].y&&0==y[o].z&&y[o].T(y[o-1]),0==L[o].x&&0==L[o].y&&0==L[o].z&&L[o].T(L[o-1]),0==A[o].x&&0==A[o].y&&0==A[o].z&&A[o].T(A[o-1]),o>0){let g=y[o-1];R.ew.Dot(g,y[o])<0&&y[o].scaleInPlace(-1),g=L[o-1],R.ew.Dot(g,L[o])<0&&L[o].scaleInPlace(-1),g=A[o-1],R.ew.Dot(g,A[o])<0&&A[o].scaleInPlace(-1)}let J=0;const x=m&&z?z:()=>null!==i?i:0,G=m&&T?T:()=>null!==S?S:1;let d=t===o.d.NO_CAP||t===o.d.CAP_END?0:2;const D=R.TmpVectors.Matrix[0];for(let o=0;o<w.length;o++){const q=[],S=x(o,l[o]),i=G(o,l[o]);R.Matrix.RotationAxisToRef(y[o],J,D);for(let r=0;r<g.length;r++){const S=y[o].scale(g[r].z).add(L[o].scale(g[r].x)).add(A[o].scale(g[r].y)),T=R.ew.Zero();R.ew.TransformCoordinatesToRef(S,D,T),T.scaleInPlace(i).addInPlace(w[o]),q[r]=T}r[d]=q,J+=S,d++}const U=N||(g=>{const w=Array(),q=R.ew.Zero();let o;for(o=0;o<g.length;o++)q.addInPlace(g[o]);for(q.scaleInPlace(1/g.length),o=0;o<g.length;o++)w.push(q);return w});switch(t){case o.d.NO_CAP:break;case o.d.CAP_START:r[0]=U(r[2]),r[1]=r[2];break;case o.d.CAP_END:r[d]=r[d-1],r[d+1]=U(r[d-1]);break;case o.d.CAP_ALL:r[0]=U(r[2]),r[1]=r[2],r[d]=r[d-1],r[d+1]=U(r[d-1])}return r};let H,C;if(J){const g=J._creationDataStorage;return H=D?g.path3D.update(q,D):g.path3D.update(q),C=a(w,q,g.path3D,g.pathArray,r,S,i,T,g.cap,y,U),J=z("",{pathArray:C,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:J},L||void 0)}H=D?new P.i(q,D):new P.i(q);C=a(w,q,H,new Array,r,S,i,T,e=e<0||e>3?0:e,y,U);const c=z(g,{pathArray:C,closeArray:t,closePath:m,updatable:A,sideOrientation:l,invertUV:x,frontUVs:G||void 0,backUVs:d||void 0},L);return c._creationDataStorage.pathArray=C,c._creationDataStorage.path3D=H,c._creationDataStorage.cap=e,c}function s(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=w.arc?w.arc<=0||w.arc>1?1:w.arc:1,S=void 0===w.closed||w.closed,i=w.shape,T=w.radius||1,t=w.tessellation||64,m=w.clip||0,e=w.updatable,y=o.d._GetDefaultSideOrientation(w.sideOrientation),L=w.cap||o.d.NO_CAP,A=2*Math.PI,l=[],J=w.invertUV||!1;let x=0,G=0;const d=A/t*r;let D,U;for(x=0;x<=t-m;x++){for(U=[],L!=o.d.CAP_START&&L!=o.d.CAP_ALL||(U.push(new R.ew(0,i[0].y,0)),U.push(new R.ew(Math.cos(x*d)*i[0].x*T,i[0].y,Math.sin(x*d)*i[0].x*T))),G=0;G<i.length;G++)D=new R.ew(Math.cos(x*d)*i[G].x*T,i[G].y,Math.sin(x*d)*i[G].x*T),U.push(D);L!=o.d.CAP_END&&L!=o.d.CAP_ALL||(U.push(new R.ew(Math.cos(x*d)*i[i.length-1].x*T,i[i.length-1].y,Math.sin(x*d)*i[i.length-1].x*T)),U.push(new R.ew(0,i[i.length-1].y,0))),l.push(U)}return z(g,{pathArray:l,closeArray:S,sideOrientation:y,updatable:e,invertUV:J,frontUVs:w.frontUVs,backUVs:w.backUVs},q)}o.d.ExtrudeShape=function(g,w,q,R,r,S){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7?arguments[7]:void 0,z=arguments.length>8?arguments[8]:void 0,t=arguments.length>9?arguments[9]:void 0;return j(g,{shape:w,path:q,scale:R,rotation:r,cap:0===S?0:S||o.d.NO_CAP,sideOrientation:z,instance:t,updatable:T},i)},o.d.ExtrudeShapeCustom=(g,w,q,R,r,S,i,T,z,t,m,e)=>M(g,{shape:w,path:q,scaleFunction:R,rotationFunction:r,ribbonCloseArray:S,ribbonClosePath:i,cap:0===T?0:T||o.d.NO_CAP,sideOrientation:m,instance:e,updatable:t},z);o.d.CreateLathe=(g,w,q,R,o,r,S)=>s(g,{shape:w,radius:q,tessellation:R,sideOrientation:S,updatable:r},o);var h=q(12393),v=q(12340);function b(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=w.path;let S=w.instance,i=1;void 0!==w.radius?i=w.radius:S&&(i=S._creationDataStorage.radius);const T=w.tessellation||64,t=w.radiusFunction||null;let m=w.cap||o.d.NO_CAP;const e=w.invertUV||!1,y=w.updatable,L=o.d._GetDefaultSideOrientation(w.sideOrientation);w.arc=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1;const A=(g,w,q,r,S,i,T,z)=>{const t=w.getTangents(),m=w.getNormals(),e=w.getDistances(),y=2*Math.PI/S*z,L=i||(()=>r);let A,l,J,x;const G=R.TmpVectors.Matrix[0];let d=T===o.d.NO_CAP||T===o.d.CAP_END?0:2;for(let o=0;o<g.length;o++){l=L(o,e[o]),A=Array(),J=m[o];for(let w=0;w<S;w++)R.Matrix.RotationAxisToRef(t[o],y*w,G),x=A[w]?A[w]:R.ew.Zero(),R.ew.TransformCoordinatesToRef(J,G,x),x.scaleInPlace(l).addInPlace(g[o]),A[w]=x;q[d]=A,d++}const D=(w,q)=>{const R=Array();for(let o=0;o<w;o++)R.push(g[q]);return R};switch(T){case o.d.NO_CAP:break;case o.d.CAP_START:q[0]=D(S,0),q[1]=q[2].slice(0);break;case o.d.CAP_END:q[d]=q[d-1].slice(0),q[d+1]=D(S,g.length-1);break;case o.d.CAP_ALL:q[0]=D(S,0),q[1]=q[2].slice(0),q[d]=q[d-1].slice(0),q[d+1]=D(S,g.length-1)}return q};let l,J;if(S){const g=S._creationDataStorage,q=w.arc||g.arc;return l=g.path3D.update(r),J=A(r,l,g.pathArray,i,g.tessellation,t,g.cap,q),S=z("",{pathArray:J,instance:S}),g.path3D=l,g.pathArray=J,g.arc=q,g.radius=i,S}l=new P.i(r);m=m<0||m>3?0:m,J=A(r,l,new Array,i,T,t,m,w.arc);const x=z(g,{pathArray:J,closePath:!0,closeArray:!1,updatable:y,sideOrientation:L,invertUV:e,frontUVs:w.frontUVs,backUVs:w.backUVs},q);return x._creationDataStorage.pathArray=J,x._creationDataStorage.path3D=l,x._creationDataStorage.tessellation=T,x._creationDataStorage.cap=m,x._creationDataStorage.arc=w.arc,x._creationDataStorage.radius=i,x}function B(g){const w=[];w[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},w[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},w[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},w[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},w[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},w[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},w[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},w[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},w[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},w[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},w[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},w[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},w[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},w[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},w[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const q=g.type&&(g.type<0||g.type>=w.length)?0:g.type||0,o=g.size,r=g.sizeX||o||1,T=g.sizeY||o||1,z=g.sizeZ||o||1,t=g.custom||w[q],m=t.face.length,y=g.faceUV||new Array(m),L=g.faceColors,A=void 0===g.flat||g.flat,l=0===g.sideOrientation?0:g.sideOrientation||S.b.DEFAULTSIDE,J=[],x=[],G=[],d=[],D=[];let U=0,N=0;const a=[];let H,C,c,P,j,M,V=0,s=0;if(A)for(s=0;s<m;s++)L&&void 0===L[s]&&(L[s]=new e.d(1,1,1,1)),y&&void 0===y[s]&&(y[s]=new R.Vector4(0,0,1,1));if(A)for(s=0;s<m;s++){const g=t.face[s].length;for(c=2*Math.PI/g,P=.5*Math.tan(c/2),j=.5,V=0;V<g;V++)J.push(t.vertex[t.face[s][V]][0]*r,t.vertex[t.face[s][V]][1]*T,t.vertex[t.face[s][V]][2]*z),a.push(U),U++,H=y[s].x+(y[s].z-y[s].x)*(.5+P),C=y[s].y+(y[s].w-y[s].y)*(j-.5),d.push(H,i.b?1-C:C),M=P*Math.cos(c)-j*Math.sin(c),j=P*Math.sin(c)+j*Math.cos(c),P=M,L&&D.push(L[s].r,L[s].g,L[s].b,L[s].a);for(V=0;V<g-2;V++)x.push(a[0+N],a[V+2+N],a[V+1+N]);N+=g}else{for(V=0;V<t.vertex.length;V++)J.push(t.vertex[V][0]*r,t.vertex[V][1]*T,t.vertex[V][2]*z),d.push(0,i.b?1:0);for(s=0;s<m;s++)for(V=0;V<t.face[s].length-2;V++)x.push(t.face[s][0],t.face[s][V+2],t.face[s][V+1])}S.b.ComputeNormals(J,x,G),S.b._ComputeSides(l,J,x,G,d,g.frontUVs,g.backUVs);const h=new S.b;return h.Hg=J,h.indices=x,h.Cg=G,h.Pg=d,L&&A&&(h.cg=D),h}function f(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new o.d(g,q);w.sideOrientation=o.d._GetDefaultSideOrientation(w.sideOrientation),R._originalBuilderSideOrientation=w.sideOrientation;return B(w).Mg(R,w.updatable),R}o.d.CreateTube=(g,w,q,R,o,r,S,i,T,z)=>b(g,{path:w,radius:q,tessellation:R,radiusFunction:o,arc:1,cap:r,updatable:i,sideOrientation:T,instance:z},S);function O(g){const w=g.sideOrientation||S.b.DEFAULTSIDE,q=g.radius||1,o=void 0===g.flat||g.flat,r=0|(g.subdivisions||4),T=g.radiusX||q,z=g.radiusY||q,t=g.radiusZ||q,m=(1+Math.sqrt(5))/2,e=[-1,m,-0,1,m,0,-1,-m,0,1,-m,0,0,-1,-m,0,1,-m,0,-1,m,0,1,m,m,0,1,m,0,-1,-m,0,1,-m,0,-1],y=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],L=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],A=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],l=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],J=[],x=[],G=[],d=[];let D=0;const U=new Array(3),N=new Array(3);let a;for(a=0;a<3;a++)U[a]=R.ew.Zero(),N[a]=R.Vector2.Zero();for(let S=0;S<20;S++){for(a=0;a<3;a++){const g=y[3*S+a];U[a].mi(e[3*L[g]],e[3*L[g]+1],e[3*L[g]+2]),U[a].normalize(),N[a].mi(.134765625*A[2*g]+.05859375+-.0390625*l[S],.2333984375*A[2*g+1]+.025390625+.01953125*l[S])}const g=(g,w,q,S)=>{const m=R.ew.Lerp(U[0],U[2],w/r),e=R.ew.Lerp(U[1],U[2],w/r),y=r===w?U[2]:R.ew.Lerp(m,e,g/(r-w));let L;if(y.normalize(),o){const g=R.ew.Lerp(U[0],U[2],S/r),w=R.ew.Lerp(U[1],U[2],S/r);L=R.ew.Lerp(g,w,q/(r-S))}else L=new R.ew(y.x,y.y,y.z);L.x/=T,L.y/=z,L.z/=t,L.normalize();const A=R.Vector2.Lerp(N[0],N[2],w/r),l=R.Vector2.Lerp(N[1],N[2],w/r),a=r===w?N[2]:R.Vector2.Lerp(A,l,g/(r-w));x.push(y.x*T,y.y*z,y.z*t),G.push(L.x,L.y,L.z),d.push(a.x,i.b?1-a.y:a.y),J.push(D),D++};for(let w=0;w<r;w++)for(let q=0;q+w<r;q++)g(q,w,q+1/3,w+1/3),g(q+1,w,q+1/3,w+1/3),g(q,w+1,q+1/3,w+1/3),q+w+1<r&&(g(q+1,w,q+2/3,w+2/3),g(q+1,w+1,q+2/3,w+2/3),g(q,w+1,q+2/3,w+2/3))}S.b._ComputeSides(w,x,J,G,d,g.frontUVs,g.backUVs);const H=new S.b;return H.indices=J,H.Hg=x,H.Cg=G,H.Pg=d,H}function E(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=new o.d(g,q);w.sideOrientation=o.d._GetDefaultSideOrientation(w.sideOrientation),R._originalBuilderSideOrientation=w.sideOrientation;return O(w).Mg(R,w.updatable),R}S.b.CreatePolyhedron=B,o.d.CreatePolyhedron=(g,w,q)=>f(g,w,q);S.b.CreateIcoSphere=O,o.d.CreateIcoSphere=(g,w,q)=>E(g,w,q);var Q=q(11195);const X=new R.ew(1,0,0),K=new R.ew(-1,0,0),Y=new R.ew(0,1,0),F=new R.ew(0,-1,0),u=new R.ew(0,0,1),n=new R.ew(0,0,-1);class W{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.ew.Zero(),w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.ew.Up(),q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.Vector2.Zero(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=g,this.Lw=w,this.uv=q,this.vertexIdx=o,this.vertexIdxForBones=r,this.localPositionOverride=S,this.localNormalOverride=i,this.matrixIndicesOverride=T,this.matrixWeightsOverride=z}clone(){var g,w,q,R;return new W(this.position.clone(),this.Lw.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(g=this.localPositionOverride)||void 0===g?void 0:g.slice(),null===(w=this.localNormalOverride)||void 0===w?void 0:w.slice(),null===(q=this.matrixIndicesOverride)||void 0===q?void 0:q.slice(),null===(R=this.matrixWeightsOverride)||void 0===R?void 0:R.slice())}}function p(g,w,q){var T,z,t,m,e;const y=!!w.skeleton,L=!(null===(T=w.morphTargetManager)||void 0===T||!T.numTargets),A=q.localMode||y,l=w.zi(),J=y||L?w.si(!0,!0):w.getVerticesData(r.h.PositionKind),x=y||L?w.getNormalsData(!0,!0):w.getVerticesData(r.h.NormalKind),G=A?y?w.getVerticesData(r.h.PositionKind):J:null,d=A?y?w.getVerticesData(r.h.NormalKind):x:null,D=w.getVerticesData(r.h.UVKind),U=y?w.getVerticesData(r.h.MatricesIndicesKind):null,N=y?w.getVerticesData(r.h.MatricesWeightsKind):null,a=y?w.getVerticesData(r.h.MatricesIndicesExtraKind):null,H=y?w.getVerticesData(r.h.MatricesWeightsExtraKind):null,C=q.position||R.ew.Zero();let c=q.Lw||R.ew.Up();const P=q.size||R.ew.One(),j=q.angle||0;if(!c){const g=new R.ew(0,0,1),q=w.Ng().activeCamera,o=R.ew.TransformCoordinates(g,q.getWorldMatrix());c=q.globalPosition.yw(o)}const M=-Math.atan2(c.z,c.x)-Math.PI/2,V=Math.sqrt(c.x*c.x+c.z*c.z),s=Math.atan2(c.y,V),h=new S.b;h.indices=[],h.Hg=[],h.Cg=[],h.Pg=[],h.matricesIndices=y?[]:null,h.matricesWeights=y?[]:null,h.matricesIndicesExtra=a?[]:null,h.matricesWeightsExtra=H?[]:null;let v=0;const b=(g,w)=>{const o=new W;if(!l||!J||!x)return o;const r=l[g];if(o.vertexIdx=3*r,o.vertexIdxForBones=4*r,o.position=new R.ew(J[3*r],J[3*r+1],J[3*r+2]),R.ew.TransformCoordinatesToRef(o.position,w,o.position),o.Lw=new R.ew(x[3*r],x[3*r+1],x[3*r+2]),R.ew.TransformNormalToRef(o.Lw,w,o.Lw),q.captureUVS&&D){const g=D[2*r+1];o.uv=new R.Vector2(D[2*r],i.b?1-g:g)}return o},B=[0,0,0,0],f=(g,w)=>{if(0===g.length)return g;const q=.5*Math.abs(R.ew.Dot(P,w)),o=(g,w,q,R)=>{for(let o=0;o<R;++o)if(g[q+o]===w)return q+o;return-1},r=(g,r)=>{const S=R.ew.GetClipFactor(g.position,r.position,w,q);let i=B,T=B;if(U&&N){const w=g.matrixIndicesOverride?0:g.vertexIdxForBones,q=g.matrixIndicesOverride??U,R=g.matrixWeightsOverride??N,z=r.matrixIndicesOverride?0:r.vertexIdxForBones,t=r.matrixIndicesOverride??U,m=r.matrixWeightsOverride??N;i=[0,0,0,0],T=[0,0,0,0];let e=0;for(let g=0;g<4;++g)if(R[w+g]>0){const r=o(t,q[w+g],z,4);i[e]=q[w+g],T[e]=(0,Q.Lerp)(R[w+g],r>=0?m[r]:0,S),e++}for(let g=0;g<4&&e<4;++g){const R=t[z+g];-1===o(q,R,w,4)&&(i[e]=R,T[e]=(0,Q.Lerp)(0,m[z+g],S),e++)}const y=T[0]+T[1]+T[2]+T[3];T[0]/=y,T[1]/=y,T[2]/=y,T[3]/=y}const z=g.localPositionOverride?g.localPositionOverride[0]:(null===G||void 0===G?void 0:G[g.vertexIdx])??0,t=g.localPositionOverride?g.localPositionOverride[1]:(null===G||void 0===G?void 0:G[g.vertexIdx+1])??0,m=g.localPositionOverride?g.localPositionOverride[2]:(null===G||void 0===G?void 0:G[g.vertexIdx+2])??0,e=r.localPositionOverride?r.localPositionOverride[0]:(null===G||void 0===G?void 0:G[r.vertexIdx])??0,y=r.localPositionOverride?r.localPositionOverride[1]:(null===G||void 0===G?void 0:G[r.vertexIdx+1])??0,L=r.localPositionOverride?r.localPositionOverride[2]:(null===G||void 0===G?void 0:G[r.vertexIdx+2])??0,A=g.localNormalOverride?g.localNormalOverride[0]:(null===d||void 0===d?void 0:d[g.vertexIdx])??0,l=g.localNormalOverride?g.localNormalOverride[1]:(null===d||void 0===d?void 0:d[g.vertexIdx+1])??0,J=g.localNormalOverride?g.localNormalOverride[2]:(null===d||void 0===d?void 0:d[g.vertexIdx+2])??0,x=A+((r.localNormalOverride?r.localNormalOverride[0]:(null===d||void 0===d?void 0:d[r.vertexIdx])??0)-A)*S,D=l+((r.localNormalOverride?r.localNormalOverride[1]:(null===d||void 0===d?void 0:d[r.vertexIdx+1])??0)-l)*S,a=J+((r.localNormalOverride?r.localNormalOverride[2]:(null===d||void 0===d?void 0:d[r.vertexIdx+2])??0)-J)*S,H=Math.sqrt(x*x+D*D+a*a);return new W(R.ew.Lerp(g.position,r.position,S),R.ew.Lerp(g.Lw,r.Lw,S).normalize(),R.Vector2.Lerp(g.uv,r.uv,S),-1,-1,G?[z+(e-z)*S,t+(y-t)*S,m+(L-m)*S]:null,d?[x/H,D/H,a/H]:null,i,T)};let S=null;g.length>3&&(S=[]);for(let i=0;i<g.length;i+=3){let o=0,T=null,z=null,t=null,m=null;const e=R.ew.Dot(g[i].position,w)-q>0,y=R.ew.Dot(g[i+1].position,w)-q>0,L=R.ew.Dot(g[i+2].position,w)-q>0;switch(o=(e?1:0)+(y?1:0)+(L?1:0),o){case 0:g.length>3?(S.push(g[i]),S.push(g[i+1]),S.push(g[i+2])):S=g;break;case 1:if(S=S??new Array,e&&(T=g[i+1],z=g[i+2],t=r(g[i],T),m=r(g[i],z)),y){T=g[i],z=g[i+2],t=r(g[i+1],T),m=r(g[i+1],z),S.push(t),S.push(z.clone()),S.push(T.clone()),S.push(z.clone()),S.push(t.clone()),S.push(m);break}L&&(T=g[i],z=g[i+1],t=r(g[i+2],T),m=r(g[i+2],z)),T&&z&&t&&m&&(S.push(T.clone()),S.push(z.clone()),S.push(t),S.push(m),S.push(t.clone()),S.push(z.clone()));break;case 2:S=S??new Array,e||(T=g[i].clone(),z=r(T,g[i+1]),t=r(T,g[i+2]),S.push(T),S.push(z),S.push(t)),y||(T=g[i+1].clone(),z=r(T,g[i+2]),t=r(T,g[i]),S.push(T),S.push(z),S.push(t)),L||(T=g[i+2].clone(),z=r(T,g[i]),t=r(T,g[i+1]),S.push(T),S.push(z),S.push(t))}}return S},O=w instanceof o.d?w:null,E=null===O||void 0===O?void 0:O._thinInstanceDataStorage.matrixData,p=(null===O||void 0===O?void 0:O.Ai)||1,Z=R.TmpVectors.Matrix[0];Z.T(R.Matrix.IdentityReadOnly);for(let o=0;o<p;++o){if(null!==O&&void 0!==O&&O.hasThinInstances&&E){const g=16*o;Z.setRowFromFloats(0,E[g+0],E[g+1],E[g+2],E[g+3]),Z.setRowFromFloats(1,E[g+4],E[g+5],E[g+6],E[g+7]),Z.setRowFromFloats(2,E[g+8],E[g+9],E[g+10],E[g+11]),Z.setRowFromFloats(3,E[g+12],E[g+13],E[g+14],E[g+15])}const g=R.Matrix.RotationYawPitchRoll(M,s,j).multiply(R.Matrix.Translation(C.x,C.y,C.z)),r=R.Matrix.Invert(g),S=w.getWorldMatrix(),T=Z.multiply(S).multiply(r),z=new Array(3);for(let w=0;w<l.length;w+=3){let g=z;if(g[0]=b(w,T),g[1]=b(w+1,T),g[2]=b(w+2,T),!(q.cullBackFaces&&-g[0].Lw.z<=0&&-g[1].Lw.z<=0&&-g[2].Lw.z<=0)&&(g=f(g,X),g&&(g=f(g,K),g&&(g=f(g,Y),g&&(g=f(g,F),g&&(g=f(g,u),g&&(g=f(g,n),g)))))))for(let w=0;w<g.length;w++){const R=g[w];if(h.indices.push(v),A?(R.localPositionOverride?(h.Hg[3*v]=R.localPositionOverride[0],h.Hg[3*v+1]=R.localPositionOverride[1],h.Hg[3*v+2]=R.localPositionOverride[2]):G&&(h.Hg[3*v]=G[R.vertexIdx],h.Hg[3*v+1]=G[R.vertexIdx+1],h.Hg[3*v+2]=G[R.vertexIdx+2]),R.localNormalOverride?(h.Cg[3*v]=R.localNormalOverride[0],h.Cg[3*v+1]=R.localNormalOverride[1],h.Cg[3*v+2]=R.localNormalOverride[2]):d&&(h.Cg[3*v]=d[R.vertexIdx],h.Cg[3*v+1]=d[R.vertexIdx+1],h.Cg[3*v+2]=d[R.vertexIdx+2])):(R.position.toArray(h.Hg,3*v),R.Lw.toArray(h.Cg,3*v)),h.matricesIndices&&h.matricesWeights&&(R.matrixIndicesOverride?(h.matricesIndices[4*v]=R.matrixIndicesOverride[0],h.matricesIndices[4*v+1]=R.matrixIndicesOverride[1],h.matricesIndices[4*v+2]=R.matrixIndicesOverride[2],h.matricesIndices[4*v+3]=R.matrixIndicesOverride[3]):(U&&(h.matricesIndices[4*v]=U[R.vertexIdxForBones],h.matricesIndices[4*v+1]=U[R.vertexIdxForBones+1],h.matricesIndices[4*v+2]=U[R.vertexIdxForBones+2],h.matricesIndices[4*v+3]=U[R.vertexIdxForBones+3]),a&&h.matricesIndicesExtra&&(h.matricesIndicesExtra[4*v]=a[R.vertexIdxForBones],h.matricesIndicesExtra[4*v+1]=a[R.vertexIdxForBones+1],h.matricesIndicesExtra[4*v+2]=a[R.vertexIdxForBones+2],h.matricesIndicesExtra[4*v+3]=a[R.vertexIdxForBones+3])),R.matrixWeightsOverride?(h.matricesWeights[4*v]=R.matrixWeightsOverride[0],h.matricesWeights[4*v+1]=R.matrixWeightsOverride[1],h.matricesWeights[4*v+2]=R.matrixWeightsOverride[2],h.matricesWeights[4*v+3]=R.matrixWeightsOverride[3]):(N&&(h.matricesWeights[4*v]=N[R.vertexIdxForBones],h.matricesWeights[4*v+1]=N[R.vertexIdxForBones+1],h.matricesWeights[4*v+2]=N[R.vertexIdxForBones+2],h.matricesWeights[4*v+3]=N[R.vertexIdxForBones+3]),H&&h.matricesWeightsExtra&&(h.matricesWeightsExtra[4*v]=H[R.vertexIdxForBones],h.matricesWeightsExtra[4*v+1]=H[R.vertexIdxForBones+1],h.matricesWeightsExtra[4*v+2]=H[R.vertexIdxForBones+2],h.matricesWeightsExtra[4*v+3]=H[R.vertexIdxForBones+3]))),q.captureUVS)R.uv.toArray(h.Pg,2*v);else{h.Pg.push(.5+R.position.x/P.x);const g=.5+R.position.y/P.y;h.Pg.push(i.b?1-g:g)}v++}}}0===h.indices.length&&(h.indices=null),0===h.Hg.length&&(h.Hg=null),0===h.Cg.length&&(h.Cg=null),0===h.Pg.length&&(h.Pg=null),0===(null===(z=h.matricesIndices)||void 0===z?void 0:z.length)&&(h.matricesIndices=null),0===(null===(t=h.matricesWeights)||void 0===t?void 0:t.length)&&(h.matricesWeights=null),0===(null===(m=h.matricesIndicesExtra)||void 0===m?void 0:m.length)&&(h.matricesIndicesExtra=null),0===(null===(e=h.matricesWeightsExtra)||void 0===e?void 0:e.length)&&(h.matricesWeightsExtra=null);const I=new o.d(g,w.Ng());return h.Mg(I),A?(I.skeleton=w.skeleton,I.parent=w):(I.position=C.clone(),I.rotation=new R.ew(s,M,j)),I.ii(!0),I.refreshBoundingInfo(!0,!0),I}function Z(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const w=0|Math.max(g.subdivisions?g.subdivisions:2,1),q=0|Math.max(g.tessellation?g.tessellation:16,3),o=Math.max(g.height?g.height:1,0),r=Math.max(g.radius?g.radius:.25,0),T=0|Math.max(g.capSubdivisions?g.capSubdivisions:6,1),z=q,t=w,m=Math.max(g.radiusTop?g.radiusTop:r,0),e=Math.max(g.radiusBottom?g.radiusBottom:r,0),y=o-(m+e),L=2*Math.PI,A=Math.max(g.topCapSubdivisions?g.topCapSubdivisions:T,1),l=Math.max(g.bottomCapSubdivisions?g.bottomCapSubdivisions:T,1),J=Math.acos((e-m)/o);let x=[];const G=[],d=[],D=[];let U=0;const N=[],a=.5*y,H=.5*Math.PI;let C,c;const P=R.ew.Zero(),j=R.ew.Zero(),M=Math.cos(J),V=Math.sin(J),s=new R.Vector2(m*V,a+m*M).yw(new R.Vector2(e*V,e*M-a)).length(),h=m*J+s+e*(H-J);let v=0;for(c=0;c<=A;c++){const g=[],w=H-J*(c/A);v+=m*J/A;const q=Math.cos(w),R=Math.sin(w),o=q*m;for(C=0;C<=z;C++){const w=C/z,r=w*L+0,S=Math.sin(r),T=Math.cos(r);j.x=o*S,j.y=a+R*m,j.z=o*T,G.push(j.x,j.y,j.z),P.set(q*S,R,q*T),d.push(P.x,P.y,P.z),D.push(w,i.b?v/h:1-v/h),g.push(U),U++}N.push(g)}const b=o-m-e+M*m-M*e,B=V*(e-m)/b;for(c=1;c<=t;c++){const g=[];v+=s/t;const w=V*(c*(e-m)/t+m);for(C=0;C<=z;C++){const q=C/z,R=q*L+0,o=Math.sin(R),r=Math.cos(R);j.x=w*o,j.y=a+M*m-c*b/t,j.z=w*r,G.push(j.x,j.y,j.z),P.set(o,B,r).normalize(),d.push(P.x,P.y,P.z),D.push(q,i.b?v/h:1-v/h),g.push(U),U++}N.push(g)}for(c=1;c<=l;c++){const g=[],w=H-J-(Math.PI-J)*(c/l);v+=e*J/l;const q=Math.cos(w),R=Math.sin(w),o=q*e;for(C=0;C<=z;C++){const w=C/z,r=w*L+0,S=Math.sin(r),T=Math.cos(r);j.x=o*S,j.y=R*e-a,j.z=o*T,G.push(j.x,j.y,j.z),P.set(q*S,R,q*T),d.push(P.x,P.y,P.z),D.push(w,i.b?v/h:1-v/h),g.push(U),U++}N.push(g)}for(C=0;C<z;C++)for(c=0;c<A+t+l;c++){const g=N[c][C],w=N[c+1][C],q=N[c+1][C+1],R=N[c][C+1];x.push(g),x.push(w),x.push(R),x.push(w),x.push(q),x.push(R)}if(x=x.reverse(),g.orientation&&!g.orientation.equals(R.ew.Up())){const w=new R.Matrix;g.orientation.clone().scale(.5*Math.PI).cross(R.ew.Up()).toQuaternion().toRotationMatrix(w);const q=R.ew.Zero();for(let g=0;g<G.length;g+=3)q.set(G[g],G[g+1],G[g+2]),R.ew.TransformCoordinatesToRef(q.clone(),w,q),G[g]=q.x,G[g+1]=q.y,G[g+2]=q.z}const f=new S.b;return f.Hg=G,f.Cg=d,f.Pg=D,f.indices=x,f}function I(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:R.ew.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new o.d(g,q);return Z(w).Mg(r,w.updatable),r}o.d.CreateDecal=(g,w,q,R,o,r)=>p(g,w,{position:q,Lw:R,size:o,angle:r});o.d.CreateCapsule=(g,w,q)=>I(g,w,q),S.b.CreateCapsule=Z;var k=q(11011),gg=q(11188);class wg{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=g,this.y=w,g!==Math.floor(g)&&(g=Math.floor(g),k.d.Warn("x is not an integer, floor(x) used")),w!==Math.floor(w)&&(w=Math.floor(w),k.d.Warn("y is not an integer, floor(y) used"))}clone(){return new wg(this.x,this.y)}rotate60About(g){const w=this.x;return this.x=g.x+g.y-this.y,this.y=w+this.y-g.x,this}rotateNeg60About(g){const w=this.x;return this.x=w+this.y-g.y,this.y=g.x+g.y-w,this}rotate120(g,w){g!==Math.floor(g)&&(g=Math.floor(g),k.d.Warn("m not an integer only floor(m) used")),w!==Math.floor(w)&&(w=Math.floor(w),k.d.Warn("n not an integer only floor(n) used"));const q=this.x;return this.x=g-q-this.y,this.y=w+q,this}rotateNeg120(g,w){g!==Math.floor(g)&&(g=Math.floor(g),k.d.Warn("m is not an integer, floor(m) used")),w!==Math.floor(w)&&(w=Math.floor(w),k.d.Warn("n is not an integer,   floor(n) used"));const q=this.x;return this.x=this.y-w,this.y=g+w-q-this.y,this}toCartesianOrigin(g,w){const q=R.ew.Zero();return q.x=g.x+2*this.x*w+this.y*w,q.y=g.y+Math.sqrt(3)*this.y*w,q}static Zero(){return new wg(0,0)}}class qg{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Rg("icosahedron","Regular",[[0,gg.d,-1],[-gg.d,1,0],[-1,0,-gg.d],[1,0,-gg.d],[gg.d,1,0],[0,gg.d,1],[-1,0,gg.d],[-gg.d,-1,0],[0,-gg.d,-1],[gg.d,-1,0],[1,0,gg.d],[0,-gg.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let g=12;const w={},q=this.m,R=this.n;let o,r,S,i,T,z=q,t=1,m=0;0!==R&&(z=(0,Q.HighestCommonFactor)(q,R)),t=q/z,m=R/z;const e=wg.Zero(),y=new wg(q,R),L=new wg(-R,q+R),A=wg.Zero(),l=wg.Zero(),J=wg.Zero();let x,G,d,D,U=[];const N=[],a=this.vertByDist,H=(q,R,o,r)=>{x=q+"|"+o,G=R+"|"+r,x in w||G in w?x in w&&!(G in w)?w[G]=w[x]:G in w&&!(x in w)&&(w[x]=w[G]):(w[x]=g,w[G]=g,g++),a[o][0]>2?N[w[x]]=[-a[o][0],a[o][1],w[x]]:N[w[x]]=[U[a[o][0]],a[o][1],w[x]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let C=0;C<20;C++){if(U=this.IDATA.face[C],S=U[2],i=U[1],T=U[0],d=e.x+"|"+e.y,x=C+"|"+d,x in w||(w[x]=S,N[S]=[U[a[d][0]],a[d][1]]),d=y.x+"|"+y.y,x=C+"|"+d,x in w||(w[x]=i,N[i]=[U[a[d][0]],a[d][1]]),d=L.x+"|"+L.y,x=C+"|"+d,x in w||(w[x]=T,N[T]=[U[a[d][0]],a[d][1]]),o=this.IDATA.edgematch[C][0],r=this.IDATA.edgematch[C][1],"B"===r)for(let g=1;g<z;g++)l.x=q-g*(t+m),l.y=R+g*t,J.x=-g*m,J.y=g*(t+m),d=l.x+"|"+l.y,D=J.x+"|"+J.y,H(C,o,d,D);if("O"===r)for(let g=1;g<z;g++)J.x=-g*m,J.y=g*(t+m),A.x=g*t,A.y=g*m,d=J.x+"|"+J.y,D=A.x+"|"+A.y,H(C,o,d,D);if(o=this.IDATA.edgematch[C][2],r=this.IDATA.edgematch[C][3],r&&"A"===r)for(let g=1;g<z;g++)A.x=g*t,A.y=g*m,l.x=q-(z-g)*(t+m),l.y=R+(z-g)*t,d=A.x+"|"+A.y,D=l.x+"|"+l.y,H(C,o,d,D);for(let q=0;q<this.vertices.length;q++)d=this.vertices[q].x+"|"+this.vertices[q].y,x=C+"|"+d,x in w||(w[x]=g++,a[d][0]>2?N[w[x]]=[-a[d][0],a[d][1],w[x]]:N[w[x]]=[U[a[d][0]],a[d][1],w[x]])}this.closestTo=N,this.vecToidx=w}calcCoeffs(){const g=this.m,w=this.n,q=Math.sqrt(3)/3,R=g*g+w*w+g*w;this.coau=(g+w)/R,this.cobu=-w/R,this.coav=-q*(g-w)/R,this.cobv=q*(2*g+w)/R}createInnerFacets(){const g=this.m,w=this.n;for(let q=0;q<w+g+1;q++)for(let g=this.min[q];g<this.max[q]+1;g++)g<this.max[q]&&g<this.max[q+1]+1&&this.innerFacets.push(["|"+g+"|"+q,"|"+g+"|"+(q+1),"|"+(g+1)+"|"+q]),q>0&&g<this.max[q-1]&&g+1<this.max[q]+1&&this.innerFacets.push(["|"+g+"|"+q,"|"+(g+1)+"|"+q,"|"+(g+1)+"|"+(q-1)])}edgeVecsABOB(){const g=this.m,w=this.n,q=new wg(-w,g+w);for(let R=1;R<g+w;R++){const g=new wg(this.min[R],R),w=new wg(this.min[R-1],R-1),o=new wg(this.min[R+1],R+1),r=g.clone(),S=w.clone(),i=o.clone();r.rotate60About(q),S.rotate60About(q),i.rotate60About(q);const T=new wg(this.max[r.y],r.y),z=new wg(this.max[r.y-1],r.y-1),t=new wg(this.max[r.y-1]-1,r.y-1);r.x===T.x&&r.y===T.y||(r.x!==z.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([g,z,t]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([g,t,T])):r.y===i.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([g,w,z]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([g,z,o])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([g,w,z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([g,z,T])))}}mapABOBtoOBOA(){const g=new wg(0,0);for(let w=0;w<this.isoVecsABOB.length;w++){const q=[];for(let R=0;R<3;R++)g.x=this.isoVecsABOB[w][R].x,g.y=this.isoVecsABOB[w][R].y,0===this.vertexTypes[w][R]&&g.rotateNeg120(this.m,this.n),q.push(g.clone());this.isoVecsOBOA.push(q)}}mapABOBtoBAOA(){const g=new wg(0,0);for(let w=0;w<this.isoVecsABOB.length;w++){const q=[];for(let R=0;R<3;R++)g.x=this.isoVecsABOB[w][R].x,g.y=this.isoVecsABOB[w][R].y,1===this.vertexTypes[w][R]&&g.rotate120(this.m,this.n),q.push(g.clone());this.isoVecsBAOA.push(q)}}MapToFace(g,w){const q=this.IDATA.face[g],o=q[2],r=q[1],S=q[0],i=R.ew.Ri(this.IDATA.vertex[o]),T=R.ew.Ri(this.IDATA.vertex[r]),z=R.ew.Ri(this.IDATA.vertex[S]),t=T.yw(i),m=z.yw(i),e=t.scale(this.coau).add(m.scale(this.cobu)),y=t.scale(this.coav).add(m.scale(this.cobv)),L=[];let A,l=R.TmpVectors.ew[0];for(let R=0;R<this.cartesian.length;R++)l=e.scale(this.cartesian[R].x).add(y.scale(this.cartesian[R].y)).add(i),L[R]=[l.x,l.y,l.z],A=g+"|"+this.vertices[R].x+"|"+this.vertices[R].y,w.vertex[this.vecToidx[A]]=[l.x,l.y,l.z]}build(g,w){const q=[],R=wg.Zero(),o=new wg(g,w),r=new wg(-w,g+w);q.push(R,o,r);for(let d=w;d<g+1;d++)for(let w=0;w<g+1-d;w++)q.push(new wg(w,d));if(w>0){const R=(0,Q.HighestCommonFactor)(g,w),o=g/R,r=w/R;for(let i=1;i<R;i++)q.push(new wg(i*o,i*r)),q.push(new wg(-i*r,i*(o+r))),q.push(new wg(g-i*(o+r),w+i*o));const S=g/w;for(let i=1;i<w;i++)for(let R=0;R<i*S;R++)q.push(new wg(R,i)),q.push(new wg(R,i).rotate120(g,w)),q.push(new wg(R,i).rotateNeg120(g,w))}q.sort(((g,w)=>g.x-w.x)),q.sort(((g,w)=>g.y-w.y));const S=new Array(g+w+1),i=new Array(g+w+1);for(let d=0;d<S.length;d++)S[d]=1/0,i[d]=-1/0;let T=0,z=0;const t=q.length;for(let d=0;d<t;d++)z=q[d].x,T=q[d].y,S[T]=Math.min(z,S[T]),i[T]=Math.max(z,i[T]);const m=(q,R)=>{const o=q.clone();return"A"===R&&o.rotateNeg120(g,w),"B"===R&&o.rotate120(g,w),o.x<0?o.y:o.x+o.y},e=[],y=[],L=[],A=[],l={},J=[];let x=-1,G=-1;for(let d=0;d<t;d++)e[d]=q[d].toCartesianOrigin(new wg(0,0),.5),y[d]=m(q[d],"O"),L[d]=m(q[d],"A"),A[d]=m(q[d],"B"),y[d]===L[d]&&L[d]===A[d]?(x=3,G=y[d]):y[d]===L[d]?(x=4,G=y[d]):L[d]===A[d]?(x=5,G=L[d]):A[d]===y[d]&&(x=6,G=y[d]),y[d]<L[d]&&y[d]<A[d]&&(x=2,G=y[d]),L[d]<y[d]&&L[d]<A[d]&&(x=1,G=L[d]),A[d]<L[d]&&A[d]<y[d]&&(x=0,G=A[d]),J.push([x,G,q[d].x,q[d].y]);J.sort(((g,w)=>g[2]-w[2])),J.sort(((g,w)=>g[3]-w[3])),J.sort(((g,w)=>g[1]-w[1])),J.sort(((g,w)=>g[0]-w[0]));for(let d=0;d<J.length;d++)l[J[d][2]+"|"+J[d][3]]=[J[d][0],J[d][1],d];return this.m=g,this.n=w,this.vertices=q,this.vertByDist=l,this.cartesian=e,this.min=S,this.max=i,this}}class Rg{constructor(g,w,q,R){this.name=g,this.category=w,this.vertex=q,this.face=R}}class og extends Rg{innerToData(g,w){for(let q=0;q<w.innerFacets.length;q++)this.face.push(w.innerFacets[q].map((q=>w.vecToidx[g+q])))}mapABOBtoDATA(g,w){const q=w.IDATA.edgematch[g][0];for(let R=0;R<w.isoVecsABOB.length;R++){const o=[];for(let r=0;r<3;r++)0===w.vertexTypes[R][r]?o.push(g+"|"+w.isoVecsABOB[R][r].x+"|"+w.isoVecsABOB[R][r].y):o.push(q+"|"+w.isoVecsABOB[R][r].x+"|"+w.isoVecsABOB[R][r].y);this.face.push([w.vecToidx[o[0]],w.vecToidx[o[1]],w.vecToidx[o[2]]])}}mapOBOAtoDATA(g,w){const q=w.IDATA.edgematch[g][0];for(let R=0;R<w.isoVecsOBOA.length;R++){const o=[];for(let r=0;r<3;r++)1===w.vertexTypes[R][r]?o.push(g+"|"+w.isoVecsOBOA[R][r].x+"|"+w.isoVecsOBOA[R][r].y):o.push(q+"|"+w.isoVecsOBOA[R][r].x+"|"+w.isoVecsOBOA[R][r].y);this.face.push([w.vecToidx[o[0]],w.vecToidx[o[1]],w.vecToidx[o[2]]])}}mapBAOAtoDATA(g,w){const q=w.IDATA.edgematch[g][2];for(let R=0;R<w.isoVecsBAOA.length;R++){const o=[];for(let r=0;r<3;r++)1===w.vertexTypes[R][r]?o.push(g+"|"+w.isoVecsBAOA[R][r].x+"|"+w.isoVecsBAOA[R][r].y):o.push(q+"|"+w.isoVecsBAOA[R][r].x+"|"+w.isoVecsBAOA[R][r].y);this.face.push([w.vecToidx[o[0]],w.vecToidx[o[1]],w.vecToidx[o[2]]])}}orderData(g){const w=[];for(let r=0;r<13;r++)w[r]=[];const q=g.closestTo;for(let r=0;r<q.length;r++)q[r][0]>-1?q[r][1]>0&&w[q[r][0]].push([r,q[r][1]]):w[12].push([r,q[r][0]]);const R=[];for(let r=0;r<12;r++)R[r]=r;let o=12;for(let r=0;r<12;r++){w[r].sort(((g,w)=>g[1]-w[1]));for(let g=0;g<w[r].length;g++)R[w[r][g][0]]=o++}for(let r=0;r<w[12].length;r++)R[w[12][r][0]]=o++;for(let r=0;r<this.vertex.length;r++)this.vertex[r].push(R[r]);this.vertex.sort(((g,w)=>g[3]-w[3]));for(let r=0;r<this.vertex.length;r++)this.vertex[r].pop();for(let r=0;r<this.face.length;r++)for(let g=0;g<this.face[r].length;g++)this.face[r][g]=R[this.face[r][g]];this.sharedNodes=w[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(g,w){const q=[],R=[];let o=w.pop();R.push(o);let r=this.face[o].indexOf(g);r=(r+2)%3;let S=this.face[o][r];q.push(S);let i=0;for(;w.length>0;)o=w[i],this.face[o].indexOf(S)>-1?(r=(this.face[o].indexOf(S)+1)%3,S=this.face[o][r],q.push(S),R.push(o),w.splice(i,1),i=0):i++;return this.adjacentFaces.push(q),R}toGoldbergPolyhedronData(){const g=new Rg("GeoDual","Goldberg",[],[]);g.name="GD dual";const w=this.vertex.length,q=new Array(w);for(let T=0;T<w;T++)q[T]=[];for(let T=0;T<this.face.length;T++)for(let g=0;g<3;g++)q[this.face[T][g]].push(T);let R=0,o=0,r=0,S=[],i=[];this.adjacentFaces=[];for(let T=0;T<q.length;T++){g.face[T]=this.setOrder(T,q[T].concat([]));for(const w of q[T]){R=0,o=0,r=0,S=this.face[w];for(let g=0;g<3;g++)i=this.vertex[S[g]],R+=i[0],o+=i[1],r+=i[2];g.vertex[w]=[R/3,o/3,r/3]}}return g}static BuildGeodesicData(g){const w=new og("Geodesic-m-n","Geodesic",[[0,gg.d,-1],[-gg.d,1,0],[-1,0,-gg.d],[1,0,-gg.d],[gg.d,1,0],[0,gg.d,1],[-1,0,gg.d],[-gg.d,-1,0],[0,-gg.d,-1],[gg.d,-1,0],[1,0,gg.d],[0,-gg.d,1]],[]);g.setIndices(),g.calcCoeffs(),g.createInnerFacets(),g.edgeVecsABOB(),g.mapABOBtoOBOA(),g.mapABOBtoBAOA();for(let q=0;q<g.IDATA.face.length;q++)g.MapToFace(q,w),w.innerToData(q,g),"B"===g.IDATA.edgematch[q][1]&&w.mapABOBtoDATA(q,g),"O"===g.IDATA.edgematch[q][1]&&w.mapOBOAtoDATA(q,g),"A"===g.IDATA.edgematch[q][3]&&w.mapBAOAtoDATA(q,g);w.orderData(g);return w.vertex=w.vertex.map((function(g){const w=g[0],q=g[1],R=g[2],o=Math.sqrt(w*w+q*q+R*R);return g[0]*=1/o,g[1]*=1/o,g[2]*=1/o,g})),w}}o.d._GoldbergMeshParser=(g,w)=>rg.Parse(g,w);class rg extends o.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(g,w){return void 0===w?(g>this.goldbergData.nbUnsharedFaces-1&&(k.d.Warn("Maximum number of unshared faces used"),g=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+g):(g>11&&(k.d.Warn("Last pole used"),g=11),w>this.goldbergData.nbFacesAtPole-1&&(k.d.Warn("Maximum number of faces at a pole used"),w=this.goldbergData.nbFacesAtPole-1),12+g*this.goldbergData.nbFacesAtPole+w)}_changeGoldbergFaceColors(g){for(let q=0;q<g.length;q++){const w=g[q][0],R=g[q][1],o=g[q][2];for(let g=w;g<R+1;g++)this.goldbergData.faceColors[g]=o}const w=[];for(let q=0;q<12;q++)for(let g=0;g<5;g++)w.push(this.goldbergData.faceColors[q].r,this.goldbergData.faceColors[q].g,this.goldbergData.faceColors[q].b,this.goldbergData.faceColors[q].a);for(let q=12;q<this.goldbergData.faceColors.length;q++)for(let g=0;g<6;g++)w.push(this.goldbergData.faceColors[q].r,this.goldbergData.faceColors[q].g,this.goldbergData.faceColors[q].b,this.goldbergData.faceColors[q].a);return w}setGoldbergFaceColors(g){const w=this._changeGoldbergFaceColors(g);this.vg(r.h.ColorKind,w)}updateGoldbergFaceColors(g){const w=this._changeGoldbergFaceColors(g);this.updateVerticesData(r.h.ColorKind,w)}_changeGoldbergFaceUVs(g){const w=this.getVerticesData(r.h.UVKind);for(let q=0;q<g.length;q++){const R=g[q][0],o=g[q][1],r=g[q][2],S=g[q][3],i=g[q][4],T=[],z=[];let t,m;for(let g=0;g<5;g++)t=r.x+S*Math.cos(i+g*Math.PI/2.5),m=r.y+S*Math.sin(i+g*Math.PI/2.5),t<0&&(t=0),t>1&&(t=1),T.push(t,m);for(let g=0;g<6;g++)t=r.x+S*Math.cos(i+g*Math.PI/3),m=r.y+S*Math.sin(i+g*Math.PI/3),t<0&&(t=0),t>1&&(t=1),z.push(t,m);for(let g=R;g<Math.min(12,o+1);g++)for(let q=0;q<5;q++)w[10*g+2*q]=T[2*q],w[10*g+2*q+1]=T[2*q+1];for(let g=Math.max(12,R);g<o+1;g++)for(let q=0;q<6;q++)w[12*g-24+2*q]=z[2*q],w[12*g-23+2*q]=z[2*q+1]}return w}setGoldbergFaceUVs(g){const w=this._changeGoldbergFaceUVs(g);this.vg(r.h.UVKind,w)}updateGoldbergFaceUVs(g){const w=this._changeGoldbergFaceUVs(g);this.updateVerticesData(r.h.UVKind,w)}placeOnGoldbergFaceAt(g,w,q){const o=R.ew.RotationFromAxis(this.goldbergData.faceXaxis[w],this.goldbergData.faceYaxis[w],this.goldbergData.faceZaxis[w]);g.rotation=o,g.position=this.goldbergData.faceCenters[w].add(this.goldbergData.faceXaxis[w].scale(q.x)).add(this.goldbergData.faceYaxis[w].scale(q.y)).add(this.goldbergData.faceZaxis[w].scale(q.z))}serialize(g){super.serialize(g),g.type="GoldbergMesh";const w={};if(w.adjacentFaces=this.goldbergData.adjacentFaces,w.nbSharedFaces=this.goldbergData.nbSharedFaces,w.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,w.nbFaces=this.goldbergData.nbFaces,w.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){w.faceColors=[];for(const g of this.goldbergData.faceColors)w.faceColors.push(g.qi())}if(this.goldbergData.faceCenters){w.faceCenters=[];for(const g of this.goldbergData.faceCenters)w.faceCenters.push(g.qi())}if(this.goldbergData.faceZaxis){w.faceZaxis=[];for(const g of this.goldbergData.faceZaxis)w.faceZaxis.push(g.qi())}if(this.goldbergData.faceYaxis){w.faceYaxis=[];for(const g of this.goldbergData.faceYaxis)w.faceYaxis.push(g.qi())}if(this.goldbergData.faceXaxis){w.faceXaxis=[];for(const g of this.goldbergData.faceXaxis)w.faceXaxis.push(g.qi())}g.goldbergData=w}static Parse(g,w){const q=g.goldbergData;q.faceColors=q.faceColors.map((g=>e.d.Ri(g))),q.faceCenters=q.faceCenters.map((g=>R.ew.Ri(g))),q.faceZaxis=q.faceZaxis.map((g=>R.ew.Ri(g))),q.faceXaxis=q.faceXaxis.map((g=>R.ew.Ri(g))),q.faceYaxis=q.faceYaxis.map((g=>R.ew.Ri(g)));const o=new rg(g.name,w);return o.goldbergData=q,o}}var Sg=q(11685);const ig={CreateBox:m.b,CreateTiledBox:l,CreateSphere:J.e,CreateDisc:t.c,CreateIcoSphere:E,CreateRibbon:z,CreateCylinder:D,CreateTorus:N,CreateTorusKnot:H,CreateLineSystem:C.f,iz:C.h,CreateDashedLines:C.d,ExtrudeShape:j,ExtrudeShapeCustom:M,CreateLathe:s,CreateTiledPlane:L,zz:h.c,CreateGround:v.h,CreateTiledGround:v.i,CreateGroundFromHeightMap:v.d,CreatePolygon:c.e,ExtrudePolygon:c.h,CreateTube:b,CreatePolyhedron:f,CreateGeodesic:function(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=w.m||1;R!==Math.floor(R)&&(R=Math.floor(R),k.d.Warn("m not an integer only floor(m) used"));let o=w.n||0;if(o!==Math.floor(o)&&(o=Math.floor(o),k.d.Warn("n not an integer only floor(n) used")),o>R){const g=o;o=R,R=g,k.d.Warn("n > m therefore m and n swapped")}const r=new qg;return r.build(R,o),f(g,{custom:og.BuildGeodesicData(r),size:w.size,sizeX:w.sizeX,sizeY:w.sizeY,sizeZ:w.sizeZ,faceUV:w.faceUV,faceColors:w.faceColors,flat:w.flat,updatable:w.updatable,sideOrientation:w.sideOrientation,frontUVs:w.frontUVs,backUVs:w.backUVs},q)},CreateGoldberg:function(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=w.size,T=w.sizeX||r||1,z=w.sizeY||r||1,t=w.sizeZ||r||1;let m=w.m||1;m!==Math.floor(m)&&(m=Math.floor(m),k.d.Warn("m not an integer only floor(m) used"));let y=w.n||0;if(y!==Math.floor(y)&&(y=Math.floor(y),k.d.Warn("n not an integer only floor(n) used")),y>m){const g=y;y=m,m=g,k.d.Warn("n > m therefore m and n swapped")}const L=new qg;L.build(m,y);const A=og.BuildGeodesicData(L),l=A.toGoldbergPolyhedronData(),J=new rg(g,q);w.sideOrientation=o.d._GetDefaultSideOrientation(w.sideOrientation),J._originalBuilderSideOrientation=w.sideOrientation;(function(g,w){const q=g.size,o=g.sizeX||q||1,r=g.sizeY||q||1,T=g.sizeZ||q||1,z=0===g.sideOrientation?0:g.sideOrientation||S.b.DEFAULTSIDE,t=[],m=[],e=[],y=[];let L=1/0,A=-1/0,l=1/0,J=-1/0;for(let R=0;R<w.vertex.length;R++)L=Math.min(L,w.vertex[R][0]*o),A=Math.max(A,w.vertex[R][0]*o),l=Math.min(l,w.vertex[R][1]*r),J=Math.max(J,w.vertex[R][1]*r);let x=0;for(let S=0;S<w.face.length;S++){const g=w.face[S],q=R.ew.Ri(w.vertex[g[0]]),z=R.ew.Ri(w.vertex[g[2]]),G=R.ew.Ri(w.vertex[g[1]]),d=z.yw(q),D=G.yw(q),U=R.ew.Cross(D,d).normalize();for(let R=0;R<g.length;R++){e.push(U.x,U.y,U.z);const q=w.vertex[g[R]];t.push(q[0]*o,q[1]*r,q[2]*T);const S=(q[1]*r-l)/(J-l);y.push((q[0]*o-L)/(A-L),i.b?1-S:S)}for(let w=0;w<g.length-2;w++)m.push(x,x+w+2,x+w+1);x+=g.length}S.b._ComputeSides(z,t,m,e,y);const G=new S.b;return G.Hg=t,G.indices=m,G.Cg=e,G.Pg=y,G})(w,l).Mg(J,w.updatable),J.goldbergData.nbSharedFaces=A.sharedNodes,J.goldbergData.nbUnsharedFaces=A.poleNodes,J.goldbergData.adjacentFaces=A.adjacentFaces,J.goldbergData.nbFaces=J.goldbergData.nbSharedFaces+J.goldbergData.nbUnsharedFaces,J.goldbergData.nbFacesAtPole=(J.goldbergData.nbUnsharedFaces-12)/12;for(let o=0;o<A.vertex.length;o++)J.goldbergData.faceCenters.push(R.ew.Ri(A.vertex[o])),J.goldbergData.faceCenters[o].x*=T,J.goldbergData.faceCenters[o].y*=z,J.goldbergData.faceCenters[o].z*=t,J.goldbergData.faceColors.push(new e.d(1,1,1,1));for(let o=0;o<l.face.length;o++){const g=l.face[o],w=R.ew.Ri(l.vertex[g[0]]),q=R.ew.Ri(l.vertex[g[2]]),r=R.ew.Ri(l.vertex[g[1]]),S=q.yw(w),i=r.yw(w),T=R.ew.Cross(i,S).normalize(),z=R.ew.Cross(i,T).normalize();J.goldbergData.faceXaxis.push(i.normalize()),J.goldbergData.faceYaxis.push(T),J.goldbergData.faceZaxis.push(z)}return J},CreateDecal:p,CreateCapsule:I,CreateText:Sg.g}},12409:(g,w,q)=>{"use strict";q.d(w,{e:()=>iw});var R=q(11180),o=q(11520);class r extends o.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var S=q(11235),i=(q(11321),q(11128));class T{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(g){this._targetStopDuration!==g&&(this._targetStopDuration=g)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(g){this._noiseTexture!==g&&(this._noiseTexture=g,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(g){this._animationSheetEnabled!==g&&(this._animationSheetEnabled=g)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(g){this._isAnimationSheetEnabled!=g&&(this._isAnimationSheetEnabled=g,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(g){this._useLogarithmicDepth=g&&this.Ng().getEngine().getCaps().fragmentDepthSupported}Ng(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(g){switch(g){case T.BLENDMODE_MULTIPLYADD:return;case T.BLENDMODE_ADD:g=1;break;case T.BLENDMODE_ONEONE:g=6;break;case T.BLENDMODE_STANDARD:g=2;break;case T.BLENDMODE_MULTIPLY:g=4;break;case T.BLENDMODE_SUBTRACT:g=3}this._engine.setAlphaMode(g)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:R.ew.Zero()}set direction1(g){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=g)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:R.ew.Zero()}set direction2(g){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=g)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:R.ew.Zero()}set minEmitBox(g){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=g)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:R.ew.Zero()}set maxEmitBox(g){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=g)}get billboardMode(){return this._billboardMode}set billboardMode(g){this._billboardMode!==g&&(this._billboardMode=g,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(g){this._isBillboardBased!==g&&(this._isBillboardBased=g,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(g){this._attachImageProcessingConfiguration(g)}_attachImageProcessingConfiguration(g){g!==this._imageProcessingConfiguration&&(!g&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=g)}_reset(){}_removeGradientAndTexture(g,w,q){if(!w)return this;let R=0;for(const o of w){if(o.gradient===g){w.splice(R,1);break}R++}return q&&q.dispose(),this}constructor(g){this.animations=[],this.renderingGroupId=0,this.k=R.ew.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new R.ew(10,10,10),this.onAnimationEnd=null,this.blendMode=T.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new R.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.oz=new R.ew(0,0,0),this._useLogarithmicDepth=!1,this.gravity=R.ew.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new S.d(1,1,1,1),this.color2=new S.d(1,1,1,1),this.colorDead=new S.d(0,0,0,1),this.textureMask=new S.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new r,this.id=g,this.name=g}createPointEmitter(g,w){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new R.ew(0,1,0),arguments.length>2&&void 0!==arguments[2]||new R.ew(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new R.ew(0,1,0),arguments.length>4&&void 0!==arguments[4]||new R.ew(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new R.ew(0,1,0),arguments.length>3&&void 0!==arguments[3]||new R.ew(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(g,w,q,R){throw new Error("Method not implemented.")}}T.BLENDMODE_ONEONE=0,T.BLENDMODE_STANDARD=1,T.BLENDMODE_ADD=2,T.BLENDMODE_MULTIPLY=3,T.BLENDMODE_MULTIPLYADD=4,T.BLENDMODE_SUBTRACT=-1,(0,i.g)("BABYLON.BaseParticleSystem",T);var z=q(11195),t=q(11017);class m{constructor(){this.direction1=new R.ew(0,1,0),this.direction2=new R.ew(0,1,0),this.minEmitBox=new R.ew(-.5,-.5,-.5),this.maxEmitBox=new R.ew(.5,.5,.5)}startDirectionFunction(g,w,q,o){const r=(0,z.RandomRange)(this.direction1.x,this.direction2.x),S=(0,z.RandomRange)(this.direction1.y,this.direction2.y),i=(0,z.RandomRange)(this.direction1.z,this.direction2.z);if(o)return w.x=r,w.y=S,void(w.z=i);R.ew.TransformNormalFromFloatsToRef(r,S,i,g,w)}startPositionFunction(g,w,q,o){const r=(0,z.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),S=(0,z.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),i=(0,z.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(o)return w.x=r,w.y=S,void(w.z=i);R.ew.TransformCoordinatesFromFloatsToRef(r,S,i,g,w)}clone(){const g=new m;return t.d.DeepCopy(this,g),g}applyToShader(g){g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2),g.setVector3("minEmitBox",this.minEmitBox),g.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(g){g.addUniform("direction1",3),g.addUniform("direction2",3),g.addUniform("minEmitBox",3),g.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.direction1=this.direction1.qi(),g.direction2=this.direction2.qi(),g.minEmitBox=this.minEmitBox.qi(),g.maxEmitBox=this.maxEmitBox.qi(),g}parse(g){R.ew.FromArrayToRef(g.direction1,0,this.direction1),R.ew.FromArrayToRef(g.direction2,0,this.direction2),R.ew.FromArrayToRef(g.minEmitBox,0,this.minEmitBox),R.ew.FromArrayToRef(g.maxEmitBox,0,this.maxEmitBox)}}class e{get radius(){return this._radius}set radius(g){this._radius=g,this._buildHeight()}get angle(){return this._angle}set angle(g){this._angle=g,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=q,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=w,this.radius=g}startDirectionFunction(g,w,q,o){o?R.TmpVectors.ew[0].T(q.Fi).normalize():q.position.subtractToRef(g.getTranslation(),R.TmpVectors.ew[0]).normalize();const r=(0,z.RandomRange)(0,this.directionRandomizer),S=(0,z.RandomRange)(0,this.directionRandomizer),i=(0,z.RandomRange)(0,this.directionRandomizer);w.x=R.TmpVectors.ew[0].x+r,w.y=R.TmpVectors.ew[0].y+S,w.z=R.TmpVectors.ew[0].z+i,w.normalize()}startPositionFunction(g,w,q,o){const r=(0,z.RandomRange)(0,2*Math.PI);let S;this.emitFromSpawnPointOnly?S=1e-4:(S=(0,z.RandomRange)(0,this.heightRange),S=1-S*S);let i=this._radius-(0,z.RandomRange)(0,this._radius*this.radiusRange);i*=S;const T=i*Math.sin(r),t=i*Math.cos(r),m=S*this._height;if(o)return w.x=T,w.y=m,void(w.z=t);R.ew.TransformCoordinatesFromFloatsToRef(T,m,t,g,w)}clone(){const g=new e(this._radius,this._angle,this.directionRandomizer);return t.d.DeepCopy(this,g),g}applyToShader(g){g.setFloat2("radius",this._radius,this.radiusRange),g.setFloat("coneAngle",this._angle),g.setFloat2("height",this._height,this.heightRange),g.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(g){g.addUniform("radius",2),g.addUniform("coneAngle",1),g.addUniform("height",2),g.addUniform("directionRandomizer",1)}getEffectDefines(){let g="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(g+="\n#define CONEEMITTERSPAWNPOINT"),g}getClassName(){return"ConeParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.radius=this._radius,g.angle=this._angle,g.directionRandomizer=this.directionRandomizer,g.radiusRange=this.radiusRange,g.heightRange=this.heightRange,g.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,g}parse(g){this.radius=g.radius,this.angle=g.angle,this.directionRandomizer=g.directionRandomizer,this.radiusRange=void 0!==g.radiusRange?g.radiusRange:1,this.heightRange=void 0!==g.radiusRange?g.heightRange:1,this.emitFromSpawnPointOnly=void 0!==g.emitFromSpawnPointOnly&&g.emitFromSpawnPointOnly}}class y extends e{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.ew(0,1,0),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.ew(0,1,0);super(g,w),this.direction1=q,this.direction2=o}startDirectionFunction(g,w){const q=(0,z.RandomRange)(this.direction1.x,this.direction2.x),o=(0,z.RandomRange)(this.direction1.y,this.direction2.y),r=(0,z.RandomRange)(this.direction1.z,this.direction2.z);R.ew.TransformNormalFromFloatsToRef(q,o,r,g,w)}clone(){const g=new y(this.radius,this.angle,this.direction1,this.direction2);return t.d.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("radiusRange",this.radiusRange),g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("radiusRange",1),g.addUniform("direction1",3),g.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const g=super.serialize();return g.direction1=this.direction1.qi(),g.direction2=this.direction2.qi(),g}parse(g){super.parse(g),this.direction1.T(g.direction1),this.direction2.T(g.direction2)}}class L{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=g,this.height=w,this.radiusRange=q,this.directionRandomizer=o,this._tempVector=R.ew.Zero()}startDirectionFunction(g,w,q,o,r){q.position.subtractToRef(g.getTranslation(),this._tempVector),this._tempVector.normalize(),R.ew.TransformNormalToRef(this._tempVector,r,this._tempVector);const S=(0,z.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let i=Math.atan2(this._tempVector.x,this._tempVector.z);i+=(0,z.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=S,this._tempVector.x=Math.sin(i),this._tempVector.z=Math.cos(i),this._tempVector.normalize(),o?w.T(this._tempVector):R.ew.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,g,w)}startPositionFunction(g,w,q,o){const r=(0,z.RandomRange)(-this.height/2,this.height/2),S=(0,z.RandomRange)(0,2*Math.PI),i=(0,z.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),T=Math.sqrt(i)*this.radius,t=T*Math.cos(S),m=T*Math.sin(S);o?w.mi(t,r,m):R.ew.TransformCoordinatesFromFloatsToRef(t,r,m,g,w)}clone(){const g=new L(this.radius,this.directionRandomizer);return t.d.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("height",this.height),g.setFloat("radiusRange",this.radiusRange),g.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("height",1),g.addUniform("radiusRange",1),g.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.radius=this.radius,g.height=this.height,g.radiusRange=this.radiusRange,g.directionRandomizer=this.directionRandomizer,g}parse(g){this.radius=g.radius,this.height=g.height,this.radiusRange=g.radiusRange,this.directionRandomizer=g.directionRandomizer}}class A extends L{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.ew(0,1,0),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new R.ew(0,1,0);super(g,w,q),this.direction1=o,this.direction2=r}startDirectionFunction(g,w,q,o){const r=(0,z.RandomRange)(this.direction1.x,this.direction2.x),S=(0,z.RandomRange)(this.direction1.y,this.direction2.y),i=(0,z.RandomRange)(this.direction1.z,this.direction2.z);o?w.mi(r,S,i):R.ew.TransformNormalFromFloatsToRef(r,S,i,g,w)}clone(){const g=new A(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return t.d.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("height",this.height),g.setFloat("radiusRange",this.radiusRange),g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("height",1),g.addUniform("radiusRange",1),g.addUniform("direction1",3),g.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const g=super.serialize();return g.direction1=this.direction1.qi(),g.direction2=this.direction2.qi(),g}parse(g){super.parse(g),R.ew.FromArrayToRef(g.direction1,0,this.direction1),R.ew.FromArrayToRef(g.direction2,0,this.direction2)}}class l{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=g,this.radiusRange=w,this.directionRandomizer=q}startDirectionFunction(g,w,q,o){const r=q.position.yw(g.getTranslation()).normalize(),S=(0,z.RandomRange)(0,this.directionRandomizer),i=(0,z.RandomRange)(0,this.directionRandomizer),T=(0,z.RandomRange)(0,this.directionRandomizer);r.x+=S,r.y+=i,r.z+=T,r.normalize(),o?w.T(r):R.ew.TransformNormalFromFloatsToRef(r.x,r.y,r.z,g,w)}startPositionFunction(g,w,q,o){const r=this.radius-(0,z.RandomRange)(0,this.radius*this.radiusRange),S=(0,z.RandomRange)(0,1),i=(0,z.RandomRange)(0,2*Math.PI),T=Math.acos(2*S-1),t=r*Math.cos(i)*Math.sin(T),m=r*Math.cos(T),e=r*Math.sin(i)*Math.sin(T);o?w.mi(t,Math.abs(m),e):R.ew.TransformCoordinatesFromFloatsToRef(t,Math.abs(m),e,g,w)}clone(){const g=new l(this.radius,this.directionRandomizer);return t.d.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("radiusRange",this.radiusRange),g.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("radiusRange",1),g.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.radius=this.radius,g.radiusRange=this.radiusRange,g.directionRandomizer=this.directionRandomizer,g}parse(g){this.radius=g.radius,this.radiusRange=g.radiusRange,this.directionRandomizer=g.directionRandomizer}}class J{constructor(){this.direction1=new R.ew(0,1,0),this.direction2=new R.ew(0,1,0)}startDirectionFunction(g,w,q,o){const r=(0,z.RandomRange)(this.direction1.x,this.direction2.x),S=(0,z.RandomRange)(this.direction1.y,this.direction2.y),i=(0,z.RandomRange)(this.direction1.z,this.direction2.z);o?w.mi(r,S,i):R.ew.TransformNormalFromFloatsToRef(r,S,i,g,w)}startPositionFunction(g,w,q,o){o?w.mi(0,0,0):R.ew.TransformCoordinatesFromFloatsToRef(0,0,0,g,w)}clone(){const g=new J;return t.d.DeepCopy(this,g),g}applyToShader(g){g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2)}buildUniformLayout(g){g.addUniform("direction1",3),g.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.direction1=this.direction1.qi(),g.direction2=this.direction2.qi(),g}parse(g){R.ew.FromArrayToRef(g.direction1,0,this.direction1),R.ew.FromArrayToRef(g.direction2,0,this.direction2)}}class x{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=g,this.radiusRange=w,this.directionRandomizer=q}startDirectionFunction(g,w,q,o){const r=q.position.yw(g.getTranslation()).normalize(),S=(0,z.RandomRange)(0,this.directionRandomizer),i=(0,z.RandomRange)(0,this.directionRandomizer),T=(0,z.RandomRange)(0,this.directionRandomizer);r.x+=S,r.y+=i,r.z+=T,r.normalize(),o?w.T(r):R.ew.TransformNormalFromFloatsToRef(r.x,r.y,r.z,g,w)}startPositionFunction(g,w,q,o){const r=this.radius-(0,z.RandomRange)(0,this.radius*this.radiusRange),S=(0,z.RandomRange)(0,1),i=(0,z.RandomRange)(0,2*Math.PI),T=Math.acos(2*S-1),t=r*Math.cos(i)*Math.sin(T),m=r*Math.cos(T),e=r*Math.sin(i)*Math.sin(T);o?w.mi(t,m,e):R.ew.TransformCoordinatesFromFloatsToRef(t,m,e,g,w)}clone(){const g=new x(this.radius,this.directionRandomizer);return t.d.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("radiusRange",this.radiusRange),g.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("radiusRange",1),g.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.radius=this.radius,g.radiusRange=this.radiusRange,g.directionRandomizer=this.directionRandomizer,g}parse(g){this.radius=g.radius,this.radiusRange=g.radiusRange,this.directionRandomizer=g.directionRandomizer}}class G extends x{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R.ew(0,1,0),q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.ew(0,1,0);super(g),this.direction1=w,this.direction2=q}startDirectionFunction(g,w){const q=(0,z.RandomRange)(this.direction1.x,this.direction2.x),o=(0,z.RandomRange)(this.direction1.y,this.direction2.y),r=(0,z.RandomRange)(this.direction1.z,this.direction2.z);R.ew.TransformNormalFromFloatsToRef(q,o,r,g,w)}clone(){const g=new G(this.radius,this.direction1,this.direction2);return t.d.DeepCopy(this,g),g}applyToShader(g){g.setFloat("radius",this.radius),g.setFloat("radiusRange",this.radiusRange),g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2)}buildUniformLayout(g){g.addUniform("radius",1),g.addUniform("radiusRange",1),g.addUniform("direction1",3),g.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const g=super.serialize();return g.direction1=this.direction1.qi(),g.direction2=this.direction2.qi(),g}parse(g){super.parse(g),this.direction1.T(g.direction1),this.direction2.T(g.direction2)}}class d{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(g,w,q,o){const r=R.TmpVectors.ew[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,q,r);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,q,r);const g=R.TmpVectors.ew[1];r.subtractToRef(q.position,g),g.scaleToRef(1/q.lifeTime,r)}else r.set(0,0,0);o?w.T(r):R.ew.TransformNormalToRef(r,g,w)}startPositionFunction(g,w,q,o){const r=R.TmpVectors.ew[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,q,r):r.set(0,0,0),o?w.T(r):R.ew.TransformCoordinatesToRef(r,g,w)}clone(){const g=new d;return t.d.DeepCopy(this,g),g}applyToShader(g){}buildUniformLayout(g){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const g={};return g.type=this.getClassName(),g.particlePositionGenerator=this.particlePositionGenerator,g.particleDestinationGenerator=this.particleDestinationGenerator,g}parse(g){g.particlePositionGenerator&&(this.particlePositionGenerator=g.particlePositionGenerator),g.particleDestinationGenerator&&(this.particleDestinationGenerator=g.particleDestinationGenerator)}}var D=q(11250);class U{get mesh(){return this._mesh}set mesh(g){this._mesh!==g&&(this._mesh=g,g?(this._indices=g.zi(),this._positions=g.getVerticesData(D.h.PositionKind),this._normals=g.getVerticesData(D.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=R.ew.Zero(),this._mesh=null,this.direction1=new R.ew(0,1,0),this.direction2=new R.ew(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=g}startDirectionFunction(g,w,q,o){if(this.useMeshNormalsForDirection&&this._normals)return void R.ew.TransformNormalToRef(this._storedNormal,g,w);const r=(0,z.RandomRange)(this.direction1.x,this.direction2.x),S=(0,z.RandomRange)(this.direction1.y,this.direction2.y),i=(0,z.RandomRange)(this.direction1.z,this.direction2.z);o?w.mi(r,S,i):R.ew.TransformNormalFromFloatsToRef(r,S,i,g,w)}startPositionFunction(g,w,q,o){if(!this._indices||!this._positions)return;const r=3*(Math.random()*(this._indices.length/3)|0),S=Math.random(),i=Math.random()*(1-S),T=1-S-i,z=this._indices[r],t=this._indices[r+1],m=this._indices[r+2],e=R.TmpVectors.ew[0],y=R.TmpVectors.ew[1],L=R.TmpVectors.ew[2],A=R.TmpVectors.ew[3];R.ew.FromArrayToRef(this._positions,3*z,e),R.ew.FromArrayToRef(this._positions,3*t,y),R.ew.FromArrayToRef(this._positions,3*m,L),A.x=S*e.x+i*y.x+T*L.x,A.y=S*e.y+i*y.y+T*L.y,A.z=S*e.z+i*y.z+T*L.z,o?w.mi(A.x,A.y,A.z):R.ew.TransformCoordinatesFromFloatsToRef(A.x,A.y,A.z,g,w),this.useMeshNormalsForDirection&&this._normals&&(R.ew.FromArrayToRef(this._normals,3*z,e),R.ew.FromArrayToRef(this._normals,3*t,y),R.ew.FromArrayToRef(this._normals,3*m,L),this._storedNormal.x=S*e.x+i*y.x+T*L.x,this._storedNormal.y=S*e.y+i*y.y+T*L.y,this._storedNormal.z=S*e.z+i*y.z+T*L.z)}clone(){const g=new U(this.mesh);return t.d.DeepCopy(this,g),g}applyToShader(g){g.setVector3("direction1",this.direction1),g.setVector3("direction2",this.direction2)}buildUniformLayout(g){g.addUniform("direction1",3),g.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var g;const w={};return w.type=this.getClassName(),w.direction1=this.direction1.qi(),w.direction2=this.direction2.qi(),w.meshId=null===(g=this.mesh)||void 0===g?void 0:g.id,w.useMeshNormalsForDirection=this.useMeshNormalsForDirection,w}parse(g,w){R.ew.FromArrayToRef(g.direction1,0,this.direction1),R.ew.FromArrayToRef(g.direction2,0,this.direction2),g.meshId&&w&&(this.mesh=w.getLastMeshById(g.meshId)),this.useMeshNormalsForDirection=g.useMeshNormalsForDirection}}class N{_isUbo(g){return void 0!==g.addUniform}constructor(g){this._isUbo(g)?(this.setMatrix3x3=g.updateMatrix3x3.bind(g),this.setMatrix2x2=g.updateMatrix2x2.bind(g),this.setFloat=g.updateFloat.bind(g),this.setFloat2=g.updateFloat2.bind(g),this.setFloat3=g.updateFloat3.bind(g),this.setFloat4=g.updateFloat4.bind(g),this.setFloatArray=g.updateFloatArray.bind(g),this.setArray=g.updateArray.bind(g),this.setIntArray=g.updateIntArray.bind(g),this.setMatrix=g.Si.bind(g),this.setMatrices=g.updateMatrices.bind(g),this.setVector3=g.updateVector3.bind(g),this.setVector4=g.updateVector4.bind(g),this.setColor3=g.updateColor3.bind(g),this.setColor4=g.updateColor4.bind(g),this.setDirectColor4=g.updateDirectColor4.bind(g),this.setInt=g.updateInt.bind(g),this.setInt2=g.updateInt2.bind(g),this.setInt3=g.updateInt3.bind(g),this.setInt4=g.updateInt4.bind(g)):(this.setMatrix3x3=g.setMatrix3x3.bind(g),this.setMatrix2x2=g.setMatrix2x2.bind(g),this.setFloat=g.setFloat.bind(g),this.setFloat2=g.setFloat2.bind(g),this.setFloat3=g.setFloat3.bind(g),this.setFloat4=g.setFloat4.bind(g),this.setFloatArray=g.setFloatArray.bind(g),this.setArray=g.setArray.bind(g),this.setIntArray=g.setIntArray.bind(g),this.setMatrix=g.setMatrix.bind(g),this.setMatrices=g.setMatrices.bind(g),this.setVector3=g.setVector3.bind(g),this.setVector4=g.setVector4.bind(g),this.setColor3=g.setColor3.bind(g),this.setColor4=g.setColor4.bind(g),this.setDirectColor4=g.setDirectColor4.bind(g),this.setInt=g.setInt.bind(g),this.setInt2=g.setInt2.bind(g),this.setInt3=g.setInt3.bind(g),this.setInt4=g.setInt4.bind(g))}}var a=q(11081);const H="gpuUpdateParticlesPixelShader",C="#version 300 es\nvoid main() {discard;}\n";a.d.ShadersStore[H]||(a.d.ShadersStore[H]=C);const c="gpuUpdateParticlesVertexShader",P="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";a.d.ShadersStore[c]||(a.d.ShadersStore[c]=P);(0,i.g)("BABYLON.WebGL2ParticleSystem",class{constructor(g,w){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=g,this._engine=w,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var g;return(null===(g=this._updateEffect)||void 0===g?void 0:g.isReady())??!1}createUpdateBuffer(g){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof d&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=g,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new N(this._updateEffect)}createVertexBuffers(g,w){this._updateVAO.push(this._createUpdateVAO(g)),this._renderVAO.push(this._engine.recordVertexArrayObject(w,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=w}createParticleBuffer(g){return g}bindDrawBuffers(g,w,q){q?this._engine.bindBuffers(this._renderVertexBuffers,q,w):this._engine.bindVertexArrayObject(this._renderVAO[g],null)}preUpdateParticleBuffer(){const g=this._engine;if(this._engine.enableEffect(this._updateEffect),!g.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(g,w,q){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[g],null);const R=this._engine;R.bindTransformFeedbackBuffer(w.getBuffer()),R.setRasterizerState(!1),R.beginTransformFeedback(!0),R.drawArraysType(3,0,q),R.endTransformFeedback(),R.setRasterizerState(!0),R.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let g=0;g<this._updateVAO.length;g++)this._engine.releaseVertexArrayObject(this._updateVAO[g]);this._updateVAO.length=0;for(let g=0;g<this._renderVAO.length;g++)this._engine.releaseVertexArrayObject(this._renderVAO[g]);this._renderVAO.length=0}_createUpdateVAO(g){const w={};w.position=g.createVertexBuffer("position",0,3);let q=3;w.age=g.createVertexBuffer("age",q,1),q+=1,w.size=g.createVertexBuffer("size",q,3),q+=3,w.life=g.createVertexBuffer("life",q,1),q+=1,w.seed=g.createVertexBuffer("seed",q,4),q+=4,w.direction=g.createVertexBuffer("direction",q,3),q+=3,this._parent.particleEmitterType instanceof d&&(w.initialPosition=g.createVertexBuffer("initialPosition",q,3),q+=3),this._parent._colorGradientsTexture||(w.color=g.createVertexBuffer("color",q,4),q+=4),this._parent._isBillboardBased||(w.initialDirection=g.createVertexBuffer("initialDirection",q,3),q+=3),this._parent.noiseTexture&&(w.noiseCoordinates1=g.createVertexBuffer("noiseCoordinates1",q,3),q+=3,w.noiseCoordinates2=g.createVertexBuffer("noiseCoordinates2",q,3),q+=3),this._parent._angularSpeedGradientsTexture?(w.angle=g.createVertexBuffer("angle",q,1),q+=1):(w.angle=g.createVertexBuffer("angle",q,2),q+=2),this._parent._isAnimationSheetEnabled&&(w.cellIndex=g.createVertexBuffer("cellIndex",q,1),q+=1,this._parent.spriteRandomStartCell&&(w.cellStartOffset=g.createVertexBuffer("cellStartOffset",q,1),q+=1));const R=this._engine.recordVertexArrayObject(w,null,this._updateEffect);return this._engine.bindArrayBuffer(null),R}});class j{constructor(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,R=arguments.length>3?arguments[3]:void 0;this._engine=g,this._label=R,this._engine._storageBuffers.push(this),this._create(w,q)}_create(g,w){this._bufferSize=g,this._creationFlags=w,this._buffer=this._engine.createStorageBuffer(g,w,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(g,w,q){this._buffer&&this._engine.updateStorageBuffer(this._buffer,g,w,q)}async read(g,w,q,R){return await this._engine.readFromStorageBuffer(this._buffer,g,w,q,R)}dispose(){const g=this._engine._storageBuffers,w=g.indexOf(this);-1!==w&&(g[w]=g[g.length-1],g.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var M=q(11161),V=q(11170),s=q(11218),h=q(11152),v=q(11445),b=q(11011),B=q(11110),f=q(11374);class O{constructor(){this._gpuTimeInFrameId=-1,this.counter=new f.c}_addDuration(g,w){g<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==g?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(w,!1),this._gpuTimeInFrameId=g):this.counter.addCount(w,!1))}}var E=q(11071);class Q{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=g,this._engine=w,this.uniqueId=v.e.UniqueId,w.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new O),this._engine.getCaps().supportComputeShaders?R.bindingsMapping?(this._context=w.createComputeContext(),this._shaderPath=q,this._options={bindingsMapping:{},defines:[],...R}):b.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):b.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(g,w){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const R=this._bindings[g];this._bindings[g]={type:q?0:4,object:w,indexInGroupEntries:null===R||void 0===R?void 0:R.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!R||R.object!==w||R.type!==this._bindings[g].type)}setStorageTexture(g,w){const q=this._bindings[g];this._contextIsDirty||(this._contextIsDirty=!q||q.object!==w),this._bindings[g]={type:1,object:w,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries}}setExternalTexture(g,w){const q=this._bindings[g];this._contextIsDirty||(this._contextIsDirty=!q||q.object!==w),this._bindings[g]={type:6,object:w,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries}}setVideoTexture(g,w){return!!w.externalTexture&&(this.setExternalTexture(g,w.externalTexture),!0)}setUniformBuffer(g,w){const q=this._bindings[g];this._contextIsDirty||(this._contextIsDirty=!q||q.object!==w),this._bindings[g]={type:Q._BufferIsDataBuffer(w)?7:2,object:w,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries}}setStorageBuffer(g,w){const q=this._bindings[g];this._contextIsDirty||(this._contextIsDirty=!q||q.object!==w),this._bindings[g]={type:Q._BufferIsDataBuffer(w)?7:3,object:w,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries}}setTextureSampler(g,w){const q=this._bindings[g];this._contextIsDirty||(this._contextIsDirty=!q||!w.compareSampler(q.object)),this._bindings[g]={type:5,object:w,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries}}isReady(){let g=this._effect;for(const o in this._bindings){const g=this._bindings[o],w=g.type,q=g.object;switch(w){case 0:case 4:case 1:if(!q.isReady())return!1;break;case 6:if(!q.isReady())return!1;break}}const w=[],q=this._shaderPath;if(this._options.defines)for(let o=0;o<this._options.defines.length;o++)w.push(this._options.defines[o]);const R=w.join("\n");return this._cachedDefines!==R&&(this._cachedDefines=R,g=this._engine.createComputeEffect(q,{defines:R,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=g),!!g.isReady()}dispatch(g,w,q){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,g,w,q,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const q=Q._BufferIsDataBuffer(g)?g:g.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,q,w,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const w in this._bindings){const q=this._bindings[w];if(!this._options.bindingsMapping[w])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+w+"'");switch(q.type){case 0:{const R=this._samplers[w],o=q.object;var g;if(!R||!o._texture||!R.compareSampler(o._texture))this._samplers[w]=(new B.b).setParameters(o.wrapU,o.wrapV,o.wrapR,o.anisotropicFilteringLevel,o._texture.samplingMode,null===(g=o._texture)||void 0===g?void 0:g._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const g=q.object;g.getBuffer()!==q.buffer&&(q.buffer=g.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((o=>{(0,E.h)((()=>this.dispatch(g,w,q)),o,void 0,R)}))}serialize(){const g=s.c.Serialize(this);g.options=this._options,g.shaderPath=this._shaderPath,g.Im={},g.textures={};for(const w in this._bindings){const q=this._bindings[w],R=q.object;switch(q.type){case 0:case 4:case 1:{const o=R.serialize();o&&(g.textures[w]=o,g.Im[w]={type:q.type});break}}}return g}static Parse(g,w,q){const R=s.c.Parse((()=>new Q(g.name,w.getEngine(),g.shaderPath,g.options)),g,w,q);for(const o in g.textures){const r=g.Im[o],S=h.e.Parse(g.textures[o],w,q);0===r.type?R.setTexture(o,S):4===r.type?R.setTexture(o,S,!1):R.setStorageTexture(o,S)}return R}static _BufferIsDataBuffer(g){return void 0!==g.underlyingResource}}(0,M.e)([(0,V.K)()],Q.prototype,"name",void 0),(0,M.e)([(0,V.K)()],Q.prototype,"fastMode",void 0),(0,i.g)("BABYLON.ComputeShader",Q);var X=q(11409);const K="gpuUpdateParticlesComputeShader",Y="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";a.d.ShadersStoreWGSL[K]||(a.d.ShadersStoreWGSL[K]=Y);(0,i.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(g,w){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=g,this._engine=w}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var g;return(null===(g=this._updateComputeShader)||void 0===g?void 0:g.isReady())??!1}createUpdateBuffer(g){var w;const q={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(q.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(q.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(q.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(q.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(q.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(q.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(q.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new Q("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:q,defines:g.split("\n")}),null===(w=this._simParamsComputeShader)||void 0===w||w.dispose(),this._simParamsComputeShader=new X.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new N(this._simParamsComputeShader)}createVertexBuffers(g,w){this._renderVertexBuffers.push(w)}createParticleBuffer(g){const w=new j(this._engine,4*g.length,11,"ComputeShaderParticleSystemBuffer");return w.update(g),this._bufferComputeShader.push(w),w.getBuffer()}bindDrawBuffers(g,w,q){this._engine.bindBuffers(this._renderVertexBuffers[g],q,w)}preUpdateParticleBuffer(){}updateParticleBuffer(g,w,q){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[g]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^g]),this._updateComputeShader.dispatch(Math.ceil(q/64))}releaseBuffers(){var g;for(let w=0;w<this._bufferComputeShader.length;++w)this._bufferComputeShader[w].dispose();this._bufferComputeShader.length=0,null===(g=this._simParamsComputeShader)||void 0===g||g.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class F{constructor(g,w,q){this.gradient=g,this.color1=w,this.color2=q}getColorToRef(g){this.color2?S.d.LerpToRef(this.color1,this.color2,Math.random(),g):g.T(this.color1)}}class u{constructor(g,w){this.gradient=g,this.color=w}}class n{constructor(g,w,q){this.gradient=g,this.factor1=w,this.factor2=q}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class W{static GetCurrentGradient(g,w,q){if(w[0].gradient>g)return void q(w[0],w[0],1);for(let o=0;o<w.length-1;o++){const R=w[o],r=w[o+1];if(g>=R.gradient&&g<=r.gradient){return void q(R,r,(g-R.gradient)/(r.gradient-R.gradient))}}const R=w.length-1;q(w[R],w[R],1)}}var p=q(10998),Z=q(11612),I=q(11034);class k{constructor(g){this.particleSystem=g,this.position=R.ew.Zero(),this.direction=R.ew.Zero(),this.color=new S.d(0,0,0,0),this.colorStep=new S.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new R.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new S.d(0,0,0,0),this._currentColor2=new S.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=k._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let g=this.age,w=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===w?(w=1,g=this._randomCellOffset):g+=this._randomCellOffset);const q=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let R;R=this._initialSpriteCellLoop?(0,z.Clamp)(g*w%this.lifeTime/this.lifeTime):(0,z.Clamp)(g*w/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+R*q|0}_inheritParticleInfoToSubEmitter(g){if(g.particleSystem.k.position){const w=g.particleSystem.k;if(w.position.T(this.position),g.inheritDirection){const g=R.TmpVectors.ew[0];this.direction.normalizeToRef(g),w.setDirection(g,0,Math.PI/2)}}else{g.particleSystem.k.T(this.position)}this.direction.scaleToRef(g.inheritedVelocityAmount/2,R.TmpVectors.ew[0]),g.particleSystem._inheritedVelocityOffset.T(R.TmpVectors.ew[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const g of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(g)}_reset(){this.age=0,this.id=k._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(g){g.position.T(this.position),this._initialDirection?g._initialDirection?g._initialDirection.T(this._initialDirection):g._initialDirection=this._initialDirection.clone():g._initialDirection=null,g.direction.T(this.direction),this.Fi&&(g.Fi?g.Fi.T(this.Fi):g.Fi=this.Fi.clone()),g.color.T(this.color),g.colorStep.T(this.colorStep),g.lifeTime=this.lifeTime,g.age=this.age,g._randomCellOffset=this._randomCellOffset,g.size=this.size,g.scale.T(this.scale),g.angle=this.angle,g.angularSpeed=this.angularSpeed,g.particleSystem=this.particleSystem,g.cellIndex=this.cellIndex,g.id=this.id,g._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(g._currentColorGradient=this._currentColorGradient,g._currentColor1.T(this._currentColor1),g._currentColor2.T(this._currentColor2)),this._currentSizeGradient&&(g._currentSizeGradient=this._currentSizeGradient,g._currentSize1=this._currentSize1,g._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(g._currentAngularSpeedGradient=this._currentAngularSpeedGradient,g._currentAngularSpeed1=this._currentAngularSpeed1,g._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(g._currentVelocityGradient=this._currentVelocityGradient,g._currentVelocity1=this._currentVelocity1,g._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(g._currentLimitVelocityGradient=this._currentLimitVelocityGradient,g._currentLimitVelocity1=this._currentLimitVelocity1,g._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(g._currentDragGradient=this._currentDragGradient,g._currentDrag1=this._currentDrag1,g._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(g._initialStartSpriteCellId=this._initialStartSpriteCellId,g._initialEndSpriteCellId=this._initialEndSpriteCellId,g._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(g.remapData&&this.remapData?g.remapData.T(this.remapData):g.remapData=new R.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(g._randomNoiseCoordinates1?(g._randomNoiseCoordinates1.T(this._randomNoiseCoordinates1),g._randomNoiseCoordinates2.T(this._randomNoiseCoordinates2)):(g._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),g._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}k._Count=0;var gg=q(11284),wg=(q(11312),q(11506)),qg=q(11499),Rg=q(11402);function og(g,w){const q=(0,z.RandomRange)(0,1);S.d.LerpToRef(w.color1,w.color2,q,g.color),w.colorDead.subtractToRef(g.color,w._colorDiff),w._colorDiff.scaleToRef(1/g.lifeTime,g.colorStep)}function rg(g,w){g._currentColorGradient=w._colorGradients[0],g._currentColorGradient.getColorToRef(g.color),g._currentColor1.T(g.color),w._colorGradients.length>1?w._colorGradients[1].getColorToRef(g._currentColor2):g._currentColor2.T(g.color)}function Sg(g,w){const q=w._colorGradients;W.GetCurrentGradient(w._ratio,q,((w,q,R)=>{w!==g._currentColorGradient&&(g._currentColor1.T(g._currentColor2),q.getColorToRef(g._currentColor2),g._currentColorGradient=w),S.d.LerpToRef(g._currentColor1,g._currentColor2,R,g.color)}))}function ig(g,w){g.colorStep.scaleToRef(w._scaledUpdateSpeed,w._scaledColorStep),g.color.addInPlace(w._scaledColorStep),g.color.a<0&&(g.color.a=0)}function Tg(g,w){W.GetCurrentGradient(w._ratio,w._angularSpeedGradients,((w,q,R)=>{w!==g._currentAngularSpeedGradient&&(g._currentAngularSpeed1=g._currentAngularSpeed2,g._currentAngularSpeed2=q.getFactor(),g._currentAngularSpeedGradient=w),g.angularSpeed=(0,z.Lerp)(g._currentAngularSpeed1,g._currentAngularSpeed2,R)}))}function zg(g,w){g.angle+=g.angularSpeed*w._scaledUpdateSpeed}function tg(g,w){w.particleEmitterType.startDirectionFunction(w._emitterWorldMatrix,g.direction,g,w.isLocal,w._emitterInverseWorldMatrix)}function mg(g,w){w.startDirectionFunction(w._emitterWorldMatrix,g.direction,g,w.isLocal)}function eg(g,w){g._currentVelocityGradient=w._velocityGradients[0],g._currentVelocity1=g._currentVelocityGradient.getFactor(),w._velocityGradients.length>1?g._currentVelocity2=w._velocityGradients[1].getFactor():g._currentVelocity2=g._currentVelocity1}function yg(g,w){g._currentLimitVelocityGradient=w._limitVelocityGradients[0],g._currentLimitVelocity1=g._currentLimitVelocityGradient.getFactor(),w._limitVelocityGradients.length>1?g._currentLimitVelocity2=w._limitVelocityGradients[1].getFactor():g._currentLimitVelocity2=g._currentLimitVelocity1}function Lg(g,w){W.GetCurrentGradient(w._ratio,w._velocityGradients,((q,R,o)=>{q!==g._currentVelocityGradient&&(g._currentVelocity1=g._currentVelocity2,g._currentVelocity2=R.getFactor(),g._currentVelocityGradient=q),w._directionScale*=(0,z.Lerp)(g._currentVelocity1,g._currentVelocity2,o)}))}function Ag(g,w){W.GetCurrentGradient(w._ratio,w._limitVelocityGradients,((q,R,o)=>{q!==g._currentLimitVelocityGradient&&(g._currentLimitVelocity1=g._currentLimitVelocity2,g._currentLimitVelocity2=R.getFactor(),g._currentLimitVelocityGradient=q);const r=(0,z.Lerp)(g._currentLimitVelocity1,g._currentLimitVelocity2,o);g.direction.length()>r&&g.direction.scaleInPlace(w.limitVelocityDamping)}))}function lg(g,w){g.direction.scaleToRef(w._directionScale,w._scaledDirection)}function Jg(g,w){w.particleEmitterType.startPositionFunction(w._emitterWorldMatrix,g.position,g,w.isLocal)}function xg(g,w){w.startPositionFunction(w._emitterWorldMatrix,g.position,g,w.isLocal)}function Gg(g,w){g.Fi?g.Fi.T(g.position):g.Fi=g.position.clone(),R.ew.TransformCoordinatesToRef(g.Fi,w._emitterWorldMatrix,g.position)}function dg(g,w){w.isLocal&&g.Fi?(g.Fi.addInPlace(w._scaledDirection),R.ew.TransformCoordinatesToRef(g.Fi,w._emitterWorldMatrix,g.position)):g.position.addInPlace(w._scaledDirection)}function Dg(g,w){g._currentDragGradient=w._dragGradients[0],g._currentDrag1=g._currentDragGradient.getFactor(),w._dragGradients.length>1?g._currentDrag2=w._dragGradients[1].getFactor():g._currentDrag2=g._currentDrag1}function Ug(g,w){W.GetCurrentGradient(w._ratio,w._dragGradients,((q,R,o)=>{q!==g._currentDragGradient&&(g._currentDrag1=g._currentDrag2,g._currentDrag2=R.getFactor(),g._currentDragGradient=q);const r=(0,z.Lerp)(g._currentDrag1,g._currentDrag2,o);w._scaledDirection.scaleInPlace(1-r)}))}function Ng(g,w){g._randomNoiseCoordinates1?(g._randomNoiseCoordinates1.mi(Math.random(),Math.random(),Math.random()),g._randomNoiseCoordinates2.mi(Math.random(),Math.random(),Math.random())):(g._randomNoiseCoordinates1=new R.ew(Math.random(),Math.random(),Math.random()),g._randomNoiseCoordinates2=new R.ew(Math.random(),Math.random(),Math.random()))}function ag(g,w){const q=w._noiseTextureData,o=w._noiseTextureSize;if(q&&o&&g._randomNoiseCoordinates1){const r=w._fetchR(g._randomNoiseCoordinates1.x,g._randomNoiseCoordinates1.y,o.width,o.height,q),S=w._fetchR(g._randomNoiseCoordinates1.z,g._randomNoiseCoordinates2.x,o.width,o.height,q),i=w._fetchR(g._randomNoiseCoordinates2.y,g._randomNoiseCoordinates2.z,o.width,o.height,q),T=R.TmpVectors.ew[0],z=R.TmpVectors.ew[1];T.mi((2*r-1)*w.noiseStrength.x,(2*S-1)*w.noiseStrength.y,(2*i-1)*w.noiseStrength.z),T.scaleToRef(w._tempScaledUpdateSpeed,z),g.direction.addInPlace(z)}}function Hg(g,w){w.gravity.scaleToRef(w._tempScaledUpdateSpeed,w._scaledGravity),g.direction.addInPlace(w._scaledGravity)}function Cg(g,w){g.size=(0,z.RandomRange)(w.minSize,w.maxSize),g.scale.mi((0,z.RandomRange)(w.minScaleX,w.maxScaleX),(0,z.RandomRange)(w.minScaleY,w.maxScaleY))}function cg(g,w){g._currentSizeGradient=w._sizeGradients[0],g._currentSize1=g._currentSizeGradient.getFactor(),g.size=g._currentSize1,w._sizeGradients.length>1?g._currentSize2=w._sizeGradients[1].getFactor():g._currentSize2=g._currentSize1,g.scale.mi((0,z.RandomRange)(w.minScaleX,w.maxScaleX),(0,z.RandomRange)(w.minScaleY,w.maxScaleY))}function Pg(g,w){const q=w._actualFrame/w.targetStopDuration;W.GetCurrentGradient(q,w._startSizeGradients,((q,R,o)=>{q!==w._currentStartSizeGradient&&(w._currentStartSize1=w._currentStartSize2,w._currentStartSize2=R.getFactor(),w._currentStartSizeGradient=q);const r=(0,z.Lerp)(w._currentStartSize1,w._currentStartSize2,o);g.scale.scaleInPlace(r)}))}function jg(g,w){W.GetCurrentGradient(w._ratio,w._sizeGradients,((w,q,R)=>{w!==g._currentSizeGradient&&(g._currentSize1=g._currentSize2,g._currentSize2=q.getFactor(),g._currentSizeGradient=w),g.size=(0,z.Lerp)(g._currentSize1,g._currentSize2,R)}))}function Mg(g,w){g.remapData=new R.Vector4(0,1,0,1)}function Vg(g,w){w._colorRemapGradients&&w._colorRemapGradients.length>0&&W.GetCurrentGradient(w._ratio,w._colorRemapGradients,((w,q,R)=>{const o=(0,z.Lerp)(w.factor1,q.factor1,R),r=(0,z.Lerp)(w.factor2,q.factor2,R);g.remapData.x=o,g.remapData.y=r-o})),w._alphaRemapGradients&&w._alphaRemapGradients.length>0&&W.GetCurrentGradient(w._ratio,w._alphaRemapGradients,((w,q,R)=>{const o=(0,z.Lerp)(w.factor1,q.factor1,R),r=(0,z.Lerp)(w.factor2,q.factor2,R);g.remapData.z=o,g.remapData.w=r-o}))}function sg(g,w){const q=(0,z.Clamp)(w._actualFrame/w.targetStopDuration);W.GetCurrentGradient(q,w._lifeTimeGradients,((w,R)=>{const o=w,r=R,S=o.getFactor(),i=r.getFactor(),T=(q-o.gradient)/(r.gradient-o.gradient);g.lifeTime=(0,z.Lerp)(S,i,T)})),w._emitPower=(0,z.RandomRange)(w.minEmitPower,w.maxEmitPower)}function hg(g,w){g.lifeTime=(0,z.RandomRange)(w.minLifeTime,w.maxLifeTime),w._emitPower=(0,z.RandomRange)(w.minEmitPower,w.maxEmitPower)}function vg(g,w){0===w._emitPower?(g._initialDirection?g._initialDirection.T(g.direction):g._initialDirection=g.direction.clone(),g.direction.set(0,0,0)):(g._initialDirection=null,g.direction.scaleInPlace(w._emitPower)),g.direction.addInPlace(w._inheritedVelocityOffset)}function bg(g,w){g.angularSpeed=(0,z.RandomRange)(w.minAngularSpeed,w.maxAngularSpeed),g.angle=(0,z.RandomRange)(w.minInitialRotation,w.maxInitialRotation)}function Bg(g,w){g._currentAngularSpeedGradient=w._angularSpeedGradients[0],g.angularSpeed=g._currentAngularSpeedGradient.getFactor(),g._currentAngularSpeed1=g.angularSpeed,w._angularSpeedGradients.length>1?g._currentAngularSpeed2=w._angularSpeedGradients[1].getFactor():g._currentAngularSpeed2=g._currentAngularSpeed1,g.angle=(0,z.RandomRange)(w.minInitialRotation,w.maxInitialRotation)}function fg(g,w){g._initialStartSpriteCellId=w.startSpriteCellID,g._initialEndSpriteCellId=w.endSpriteCellID,g._initialSpriteCellLoop=w.spriteCellLoop}function Og(g,w){g.previousItem=w.previousItem,g.nextItem=w,w.previousItem&&(w.previousItem.nextItem=g),w.previousItem=g}function Eg(g,w){g.previousItem=w,g.nextItem=w.nextItem,w.nextItem&&(w.nextItem.previousItem=g),w.nextItem=g}function Qg(g,w){let q=w;for(;q.nextItem;)q=q.nextItem;g.previousItem=q,g.nextItem=q.nextItem,q.nextItem=g}function Xg(g){g.previousItem&&(g.previousItem.nextItem=g.nextItem),g.nextItem&&(g.nextItem.previousItem=g.previousItem)}class Kg extends T{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(g){this._startDirectionFunction!==g&&(this._startDirectionFunction=g,this._directionProcessing.process=g?mg:tg)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(g){this._startPositionFunction!==g&&(this._startPositionFunction=g,this._positionCreation.process=g?xg:Jg)}set onDispose(g){this._onDisposeObserver&&this.WS.remove(this._onDisposeObserver),this._onDisposeObserver=this.WS.add(g)}get L(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(g){this._useRampGradients!==g&&(this._useRampGradients=g,this._resetEffect(),g?(this._rampCreation={process:Mg,previousItem:null,nextItem:null},Eg(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Vg,previousItem:null,nextItem:null},Eg(this._remapGradientProcessing,this._gravityProcessing)):(Xg(this._rampCreation),Xg(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(g){this._isLocal!==g&&(this._isLocal=g,g?(this._isLocalCreation={process:Gg,previousItem:null,nextItem:null},Eg(this._isLocalCreation,this._positionCreation)):Xg(this._isLocalCreation))}get particles(){return this.um}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(g){this._animationSheetEnabled!==g&&(this._animationSheetEnabled=g,g?(this._sheetCreation={process:fg,previousItem:null,nextItem:null},Eg(this._sheetCreation,this._colorCreation)):Xg(this._sheetCreation),this._reset())}getActiveCount(){return this.um.length}getClassName(){return"ji"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var g;let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(g=this._customWrappers[w])||void 0===g?void 0:g.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[g]??this._customWrappers[0]}setCustomEffect(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[w]=new gg.e(this._engine),this._customWrappers[w].effect=g,this._customWrappers[w].drawContext&&(this._customWrappers[w].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new p.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(g){if(this.noiseTexture!==g){if(this._noiseTexture=g,!g)return Xg(this._noiseCreation),void Xg(this._noiseProcessing);this._noiseCreation={process:Ng,previousItem:null,nextItem:null},Eg(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:ag,previousItem:null,nextItem:null},Eg(this._noiseProcessing,this._positionProcessing)}}constructor(g,w,q){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(g),this._emitterInverseWorldMatrix=R.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new R.ew,this.WS=new p.b,this.onStoppedObservable=new p.b,this.onStartedObservable=new p.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.um=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new S.d(0,0,0,0),this._colorDiff=new S.d(0,0,0,0),this._scaledDirection=R.ew.Zero(),this._scaledGravity=R.ew.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=g=>{},this.recycleParticle=g=>{const w=this.um.pop();w!==g&&w.copyTo(g),this._stockParticles.push(w)},this._createParticle=()=>{let g;return 0!==this._stockParticles.length?(g=this._stockParticles.pop(),g._reset()):g=new k(this),this._prepareParticle(g),g},this.paused=!1,this._shadersLoaded=!1,this._capacity=w,this._epsilon=i,q&&"Scene"!==q.getClassName()?(this._engine=q,this.defaultProjectionMatrix=R.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=q||I.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ym.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:hg,previousItem:null,nextItem:null},this._positionCreation={process:Jg,previousItem:null,nextItem:null},Eg(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:tg,previousItem:null,nextItem:null},Eg(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:vg,previousItem:null,nextItem:null},Eg(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Cg,previousItem:null,nextItem:null},Eg(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:bg,previousItem:null,nextItem:null},Eg(this._angleCreation,this._sizeCreation),this._colorCreation={process:og,previousItem:null,nextItem:null},Eg(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,T||(this._colorProcessing={process:ig,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:zg,previousItem:null,nextItem:null},Eg(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:lg,previousItem:null,nextItem:null},Eg(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:dg,previousItem:null,nextItem:null},Eg(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Hg,previousItem:null,nextItem:null},Eg(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=r,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new gg.e(this._engine)},this._customWrappers[0].effect=o,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new m,this.updateFunction=g=>{var w;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(w=this.noiseTexture.getContent())||void 0===w||w.then((g=>{this._noiseTextureData=g})));const q=g===this.um;for(let R=0;R<g.length;R++){const w=g[R];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const o=w.age;if(w.age+=this._tempScaledUpdateSpeed,w.age>w.lifeTime){const g=w.age-o,q=w.lifeTime-o;this._tempScaledUpdateSpeed=q*this._tempScaledUpdateSpeed/g,w.age=w.lifeTime}this._ratio=w.age/w.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let r=this._updateQueueStart;for(;r;)r.process(w,this),r=r.nextItem;if(this._isAnimationSheetEnabled&&!T&&w.updateCellIndex(),w._inheritParticleInfoToSubEmitters(),w.age>=w.lifeTime){if(this._emitFromParticle(w),w._attachedSubEmitters){for(const g of w._attachedSubEmitters)g.particleSystem.disposeOnStop=!0,g.particleSystem.stop();w._attachedSubEmitters=null}this.recycleParticle(w),q&&R--}else;}}}serialize(g){throw new Error("Method not implemented.")}clone(g,w){throw new Error("Method not implemented.")}_addFactorGradient(g,w,q,R){const o=new n(w,q,R);g.push(o),g.sort(((g,w)=>g.gradient<w.gradient?-1:g.gradient>w.gradient?1:0))}_removeFactorGradient(g,w){if(!g)return;let q=0;for(const R of g){if(R.gradient===w){g.splice(q,1);break}q++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=sg:this._lifeTimeCreation.process=hg}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Pg,previousItem:null,nextItem:null},Eg(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Xg(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(g){this.targetStopDuration!==g&&(this._targetStopDuration=g,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(g,w,q){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,g,w,q),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(g){return this._removeFactorGradient(this._lifeTimeGradients,g),this._syncLifeTimeCreation(),this}addSizeGradient(g,w,q){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=cg,this._sizeGradientProcessing={process:jg,previousItem:null,nextItem:null},Og(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,g,w,q),this}removeSizeGradient(g){var w;return this._removeFactorGradient(this._sizeGradients,g),0===(null===(w=this._sizeGradients)||void 0===w?void 0:w.length)&&(Xg(this._sizeGradientProcessing),this._sizeCreation.process=Cg),this}addColorRemapGradient(g,w,q){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,g,w,q),this}removeColorRemapGradient(g){return this._removeFactorGradient(this._colorRemapGradients,g),this}addAlphaRemapGradient(g,w,q){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,g,w,q),this}removeAlphaRemapGradient(g){return this._removeFactorGradient(this._alphaRemapGradients,g),this}addAngularSpeedGradient(g,w,q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Bg,this._angularSpeedGradientProcessing={process:Tg,previousItem:null,nextItem:null},Og(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,g,w,q),this}removeAngularSpeedGradient(g){var w;return this._removeFactorGradient(this._angularSpeedGradients,g),0===(null===(w=this._angularSpeedGradients)||void 0===w?void 0:w.length)&&(this._angleCreation.process=bg,Xg(this._angularSpeedGradientProcessing)),this}addVelocityGradient(g,w,q){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:eg,previousItem:null,nextItem:null},Eg(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Lg,previousItem:null,nextItem:null},Og(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,g,w,q),this}removeVelocityGradient(g){var w;return this._removeFactorGradient(this._velocityGradients,g),0===(null===(w=this._velocityGradients)||void 0===w?void 0:w.length)&&(Xg(this._velocityCreation),Xg(this._velocityGradientProcessing)),this}addLimitVelocityGradient(g,w,q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:yg,previousItem:null,nextItem:null},Eg(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Ag,previousItem:null,nextItem:null},Eg(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,g,w,q),this}removeLimitVelocityGradient(g){var w;return this._removeFactorGradient(this._limitVelocityGradients,g),0===(null===(w=this._limitVelocityGradients)||void 0===w?void 0:w.length)&&(Xg(this._limitVelocityCreation),Xg(this._limitVelocityGradientProcessing)),this}addDragGradient(g,w,q){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Dg,previousItem:null,nextItem:null},Og(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Ug,previousItem:null,nextItem:null},Og(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,g,w,q),this}removeDragGradient(g){var w;return this._removeFactorGradient(this._dragGradients,g),0===(null===(w=this._dragGradients)||void 0===w?void 0:w.length)&&(Xg(this._dragCreation),Xg(this._dragGradientProcessing)),this}addEmitRateGradient(g,w,q){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,g,w,q),this}removeEmitRateGradient(g){return this._removeFactorGradient(this._emitRateGradients,g),this}addStartSizeGradient(g,w,q){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,g,w,q),this._syncStartSizeCreation(),this}removeStartSizeGradient(g){return this._removeFactorGradient(this._startSizeGradients,g),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const g=new Uint8Array(4*this._rawTextureWidth),w=S.g.Jw[0];for(let q=0;q<this._rawTextureWidth;q++){const R=q/this._rawTextureWidth;W.GetCurrentGradient(R,this._rampGradients,((R,o,r)=>{S.Jw.LerpToRef(R.color,o.color,r,w),g[4*q]=255*w.r,g[4*q+1]=255*w.g,g[4*q+2]=255*w.b,g[4*q+3]=255}))}this._rampGradientsTexture=Z.d.CreateRGBATexture(g,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((g,w)=>g.gradient<w.gradient?-1:g.gradient>w.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(g,w){this._rampGradients||(this._rampGradients=[]);const q=new u(g,w);return this._rampGradients.push(q),this._syncRampGradientTexture(),this}removeRampGradient(g){return this._removeGradientAndTexture(g,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(g,w,q){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=rg,this._colorProcessing.process=Sg);const R=new F(g,w,q);return this._colorGradients.push(R),this._colorGradients.sort(((g,w)=>g.gradient<w.gradient?-1:g.gradient>w.gradient?1:0)),this}removeColorGradient(g){if(!this._colorGradients)return this;let w=0;for(const q of this._colorGradients){if(q.gradient===g){this._colorGradients.splice(w,1);break}w++}return 0===this._colorGradients.length&&(this._colorCreation.process=og,this._colorProcessing.process=ig),this}resetDrawCache(){if(this._drawWrappers){for(const g of this._drawWrappers)if(g)for(const w of g)null===w||void 0===w||w.dispose();this._drawWrappers=[]}}_fetchR(g,w,q,R,o){return o[4*(((g=.5*Math.abs(g)+.5)*q%q|0)+((w=.5*Math.abs(w)+.5)*R%R|0)*q)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const g=this._engine,w=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*w),this._vertexBuffer=new D.e(g,this._vertexData,!0,w);let q=0;const R=this._vertexBuffer.createVertexBuffer(D.h.PositionKind,q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[D.h.PositionKind]=R,q+=3;const o=this._vertexBuffer.createVertexBuffer(D.h.ColorKind,q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[D.h.ColorKind]=o,q+=4;const r=this._vertexBuffer.createVertexBuffer("angle",q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=r,q+=1;const S=this._vertexBuffer.createVertexBuffer("size",q,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=S,q+=2,this._isAnimationSheetEnabled){const g=this._vertexBuffer.createVertexBuffer("cellIndex",q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=g,q+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const g=this._vertexBuffer.createVertexBuffer("direction",q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=g,q+=3}if(this._useRampGradients){const g=this._vertexBuffer.createVertexBuffer("remapData",q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=g,q+=4}let i;if(this._useInstancing){const w=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new D.e(g,w,!1,2),i=this._spriteBuffer.createVertexBuffer("offset",0,2)}else i=this._vertexBuffer.createVertexBuffer("offset",q,2,this._vertexBufferSize,this._useInstancing),q+=2;this._vertexBuffers.offset=i,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const g=[],w=[];let q=0;for(let R=0;R<this._capacity;R++)g.push(q),g.push(q+1),g.push(q+2),g.push(q),g.push(q+2),g.push(q+3),w.push(q,q+1,q+1,q+2,q+2,q+3,q+3,q,q,q+3),q+=4;this._indexBuffer=this._engine.createIndexBuffer(g),this._linesIndexBuffer=this._engine.createIndexBuffer(w)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(g)setTimeout((()=>{this.start(0)}),g);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var w;-1!==(null===(w=this.k)||void 0===w?void 0:w.getClassName().indexOf("Mesh"))&&this.k.ii(!0);const g=this.noiseTexture;if(g&&g.onGeneratedObservable)g.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let w=0;w<this.preWarmCycles;w++)this.animate(!0),g.render()}))}));else for(let w=0;w<this.preWarmCycles;w++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(g))}_postStop(g){}reset(){this._stockParticles.length=0,this.um.length=0}_appendParticleVertex(g,w,q,o){let r=g*this._vertexBufferSize;if(this._vertexData[r++]=w.position.x+this.oz.x,this._vertexData[r++]=w.position.y+this.oz.y,this._vertexData[r++]=w.position.z+this.oz.z,this._vertexData[r++]=w.color.r,this._vertexData[r++]=w.color.g,this._vertexData[r++]=w.color.b,this._vertexData[r++]=w.color.a,this._vertexData[r++]=w.angle,this._vertexData[r++]=w.scale.x*w.size,this._vertexData[r++]=w.scale.y*w.size,this._isAnimationSheetEnabled&&(this._vertexData[r++]=w.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[r++]=w.direction.x,this._vertexData[r++]=w.direction.y,this._vertexData[r++]=w.direction.z);else if(w._initialDirection){let g=w._initialDirection;this.isLocal&&(R.ew.TransformNormalToRef(g,this._emitterWorldMatrix,R.TmpVectors.ew[0]),g=R.TmpVectors.ew[0]),0===g.x&&0===g.z&&(g.x=.001),this._vertexData[r++]=g.x,this._vertexData[r++]=g.y,this._vertexData[r++]=g.z}else{let g=w.direction;this.isLocal&&(R.ew.TransformNormalToRef(g,this._emitterWorldMatrix,R.TmpVectors.ew[0]),g=R.TmpVectors.ew[0]),0===g.x&&0===g.z&&(g.x=.001),this._vertexData[r++]=g.x,this._vertexData[r++]=g.y,this._vertexData[r++]=g.z}this._useRampGradients&&w.remapData&&(this._vertexData[r++]=w.remapData.x,this._vertexData[r++]=w.remapData.y,this._vertexData[r++]=w.remapData.z,this._vertexData[r++]=w.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===q?q=this._epsilon:1===q&&(q=1-this._epsilon),0===o?o=this._epsilon:1===o&&(o=1-this._epsilon)),this._vertexData[r++]=q,this._vertexData[r++]=o)}_prepareParticle(g){}_createNewOnes(g){let w;for(let q=0;q<g&&this.um.length!==this._capacity;q++){w=this._createParticle(),this.um.push(w);let g=this._createQueueStart;for(;g;)g.process(w,this),g=g.nextItem;w._inheritParticleInfoToSubEmitters()}}_update(g){if(this._alive=this.um.length>0,this.k.position){const g=this.k;this._emitterWorldMatrix=g.getWorldMatrix()}else{const g=this.k;this._emitterWorldMatrix=R.Matrix.Translation(g.x,g.y,g.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.um),this._createNewOnes(g)}static _GetAttributeNamesOrOptions(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R=[D.h.PositionKind,D.h.ColorKind,"angle","offset","size"];return g&&R.push("cellIndex"),w||R.push("direction"),q&&R.push("remapData"),R}static _GetEffectCreationOptions(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,wg.c)(R),g&&R.push("particlesInfos"),w&&R.push("logarithmicDepthConstant"),q&&(R.push("vFogInfos"),R.push("vFogColor")),R}fillDefines(g,w){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,wg.l)(this,this._scene,g),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&g.push("#define FOG")),this._isAnimationSheetEnabled&&g.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&g.push("#define LOGARITHMICDEPTH"),w===T.BLENDMODE_MULTIPLY&&g.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&g.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(g.push("#define BILLBOARD"),this.billboardMode){case 2:g.push("#define BILLBOARDY");break;case 8:case 9:g.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&g.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:g.push("#define BILLBOARDMODE_ALL")}q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),g.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(g,w,q){w.push(...Kg._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),g.push(...Kg._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),q.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Rg.d)(g,this._imageProcessingConfigurationDefines),(0,Rg.b)(q,this._imageProcessingConfigurationDefines))}_getWrapper(g){const w=this._getCustomDrawWrapper(g);if(null!==w&&void 0!==w&&w.effect)return w;const q=[];this.fillDefines(q,g);const R=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let o=this._drawWrappers[R];o||(o=this._drawWrappers[R]=[]);let r=o[g];r||(r=new gg.e(this._engine),r.drawContext&&(r.drawContext.useInstancing=this._useInstancing),o[g]=r);const S=q.join("\n");if(r.defines!==S){const g=[],w=[],q=[];this.fillUniformsAttributesAndSamplerNames(w,g,q),r.setEffect(this._engine.createEffect("particles",g,w,q,S,void 0,void 0,void 0,void 0,this._shaderLanguage),S)}return r}animate(){var g;let w,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!q&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(q?this.preWarmStepOffset:(null===(g=this._scene)||void 0===g?void 0:g.getAnimationRatio())||1),this.manualEmitCount>-1)w=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let g=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const w=this._actualFrame/this.targetStopDuration;W.GetCurrentGradient(w,this._emitRateGradients,((w,q,R)=>{w!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=q.getFactor(),this._currentEmitRateGradient=w),g=(0,z.Lerp)(this._currentEmitRate1,this._currentEmitRate2,R)}))}w=g*this._scaledUpdateSpeed|0,this._newPartsExcess+=g*this._scaledUpdateSpeed-w}if(this._newPartsExcess>1&&(w+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?w=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(w),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!q){let g=0;for(let w=0;w<this.um.length;w++){const q=this.um[w];this._appendParticleVertices(g,q),g+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.um.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(g,w){this._appendParticleVertex(g++,w,0,0),this._useInstancing||(this._appendParticleVertex(g++,w,1,0),this._appendParticleVertex(g++,w,1,1),this._appendParticleVertex(g++,w,0,1))}rebuild(){var g;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(g=this._spriteBuffer)||void 0===g||g._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Kg.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(q.bind(q,12592)),Promise.resolve().then(q.bind(q,12533))])):await Promise.all([Promise.resolve().then(q.bind(q,12523)),Promise.resolve().then(q.bind(q,12518))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==T.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(T.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(T.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(g){const w=this._getWrapper(g),q=w.effect,o=this._engine;o.enableEffect(w);const r=this.defaultViewMatrix??this._scene.getViewMatrix();if(q.setTexture("diffuseSampler",this.particleTexture),q.setMatrix("view",r),q.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const g=this.particleTexture.getBaseSize();q.setFloat3("particlesInfos",this.spriteCellWidth/g.width,this.spriteCellHeight/g.height,this.spriteCellWidth/g.width)}if(q.setVector2("translationPivot",this.translationPivot),q.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const g=this._scene.activeCamera;q.setVector3("eyePosition",g.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),q.setTexture("rampSampler",this._rampGradientsTexture));const S=q.defines;var i,T,z,t,m,e;(this._scene&&((0,wg.d)(q,this,this._scene),this.applyFog&&(0,qg.e)(this._scene,void 0,q)),S.indexOf("#define BILLBOARDMODE_ALL")>=0&&(r.invertToRef(R.TmpVectors.Matrix[0]),q.setMatrix("invView",R.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?o.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,q):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,q)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?o.bindBuffers(this._vertexBuffers,null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._linesIndexBuffer:this._indexBuffer,q):o.bindBuffers(this._vertexBuffers,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:null,q);(this.useLogarithmicDepth&&this._scene&&(0,qg.j)(S,q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(q),this._setEngineBasedOnBlendMode(g),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(q),this._useInstancing)?null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?o.drawElementsType(6,0,10,this.um.length):o.drawArraysType(7,0,4,this.um.length):null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?o.drawElementsType(1,0,10*this.um.length):o.drawElementsType(0,0,6*this.um.length);return this.um.length}render(){if(!this.isReady()||!this.um.length)return 0;const g=this._engine;g.setState&&(g.setState(!1),this.forceDepthWrite&&g.setDepthWrite(!0));let w=0;return w=this.blendMode===T.BLENDMODE_MULTIPLYADD?this._render(T.BLENDMODE_MULTIPLY)+this._render(T.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),w}_onDispose(){}dispose(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),g&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),g&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(w,q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const g=this._scene.Ym.indexOf(this);g>-1&&this._scene.Ym.splice(g,1),this._scene._activeParticleSystems.dispose()}this.WS.notifyObservers(this),this.WS.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Kg.ForceGLSL=!1;var Yg,Fg=q(11029);!function(g){g[g.ATTACHED=0]="ATTACHED",g[g.END=1]="END"}(Yg||(Yg={}));class ug{constructor(g){if(this.particleSystem=g,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!g.k||!g.k.dispose){const w=(0,i.e)("BABYLON.AbstractMesh");g.k=new w("SubemitterSystemEmitter",g.Ng()),g._disposeEmitterOnDispose=!0}}clone(){let g=this.particleSystem.k;if(g){if(g instanceof R.ew)g=g.clone();else if(-1!==g.getClassName().indexOf("Mesh")){g=new((0,i.e)("BABYLON.Mesh"))("",g.Ng()),g.isVisible=!1}}else g=new R.ew;const w=new ug(this.particleSystem.clone(this.particleSystem.name,g));return w.particleSystem.name+="Clone",w.type=this.type,w.inheritDirection=this.inheritDirection,w.inheritedVelocityAmount=this.inheritedVelocityAmount,w.particleSystem._disposeEmitterOnDispose=!0,w.particleSystem.disposeOnStop=!0,w}serialize(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const w={};return w.type=this.type,w.inheritDirection=this.inheritDirection,w.inheritedVelocityAmount=this.inheritedVelocityAmount,w.particleSystem=this.particleSystem.serialize(g),w}static _ParseParticleSystem(g,w,q){throw(0,Fg.b)("ParseParticle")}static Parse(g,w,q){const R=g.particleSystem,o=new ug(ug._ParseParticleSystem(R,w,q,!0));return o.type=g.type,o.inheritDirection=g.inheritDirection,o.inheritedVelocityAmount=g.inheritedVelocityAmount,o.particleSystem._isSubEmitter=!0,o}dispose(){this.particleSystem.dispose()}}var ng=q(11074);function Wg(g,w){const q=new J;return q.direction1=g,q.direction2=w,q}function pg(){return new l(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Zg(){return new x(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Ig(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R.ew(0,1,0),q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.ew(0,1,0);return new G(g,w,q)}function kg(){return new L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function gw(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.ew(0,1,0),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new R.ew(0,1,0);return new A(g,w,q,o,r)}function ww(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new e(g,w)}function qw(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.ew(0,1,0),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.ew(0,1,0);return new y(g,w,q,o)}const Rw=R.ew.Zero(),ow=R.ew.Zero(),rw=R.ew.Zero();class Sw{constructor(){this.strength=0,this.position=R.ew.Zero()}_processParticle(g,w){this.position.subtractToRef(g.position,Rw);const q=Rw.lengthSquared()+1;Rw.normalize().scaleToRef(this.strength/q,ow),ow.scaleToRef(w._tempScaledUpdateSpeed,rw),g.direction.addInPlace(rw)}serialize(){return{position:this.position.qi(),strength:this.strength}}}class iw extends Kg{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=g=>{if(!this._subEmitters||0===this._subEmitters.length)return;const w=Math.floor(Math.random()*this._subEmitters.length);for(const q of this._subEmitters[w])if(1===q.type){const w=q.clone();g._inheritParticleInfoToSubEmitter(w),w.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(w.particleSystem),w.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(g,w){const q=Wg(g,w);return this.particleEmitterType=q,q}get flowMap(){return this._flowMap}set flowMap(g){this._flowMap!==g&&(this._flowMap=g,this._flowMapUpdate&&(Xg(this._flowMapUpdate),this._flowMapUpdate=null),g&&(this._flowMapUpdate={process:g=>{var w;const q=null===(w=this.Ng())||void 0===w?void 0:w.getTransformMatrix();this._flowMap._processParticle(g,this.flowMapStrength*this._tempScaledUpdateSpeed,q)},previousItem:null,nextItem:null},Eg(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(g){this._attractors.push(g),1===this._attractors.length&&(this._attractorUpdate={process:g=>{for(const w of this._attractors)w._processParticle(g,this)},previousItem:null,nextItem:null},Eg(this._attractorUpdate,this._directionProcessing))}removeAttractor(g){const w=this._attractors.indexOf(g);-1!==w&&this._attractors.splice(w,1),0===this._attractors.length&&Xg(this._attractorUpdate)}start(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(g)}createHemisphericEmitter(){const g=pg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=g,g}createSphereEmitter(){const g=Zg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=g,g}createDirectedSphereEmitter(){const g=Ig(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R.ew(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.ew(0,1,0));return this.particleEmitterType=g,g}createCylinderEmitter(){const g=kg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=g,g}createDirectedCylinderEmitter(){const g=gw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.ew(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new R.ew(0,1,0));return this.particleEmitterType=g,g}createConeEmitter(){const g=ww(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=g,g}createDirectedConeEmitter(){const g=qw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.ew(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.ew(0,1,0));return this.particleEmitterType=g,g}createBoxEmitter(g,w,q,R){const o=new m;return this.particleEmitterType=o,this.direction1=g,this.direction2=w,this.minEmitBox=q,this.maxEmitBox=R,o}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const g of this.subEmitters)g instanceof iw?this._subEmitters.push([new ug(g)]):g instanceof ug?this._subEmitters.push([g]):g instanceof Array&&this._subEmitters.push(g)}_stopSubEmitters(){if(this.activeSubSystems){for(const g of this.activeSubSystems)g.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const g=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==g&&this._rootParticleSystem.activeSubSystems.splice(g,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(g){g&&this._stopSubEmitters()}_prepareParticle(g){if(this._subEmitters&&this._subEmitters.length>0){const w=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];g._attachedSubEmitters=[];for(const q of w)if(0===q.type){const w=q.clone();g._attachedSubEmitters.push(w),w.particleSystem.start()}}}_onDispose(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],w=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),g&&this.particles)for(const q of this.particles)if(q._attachedSubEmitters)for(let g=q._attachedSubEmitters.length-1;g>=0;g-=1)q._attachedSubEmitters[g].dispose();if(w&&this.activeSubSystems)for(let q=this.activeSubSystems.length-1;q>=0;q-=1)this.activeSubSystems[q].dispose();if(this._subEmitters&&this._subEmitters.length){for(let g=0;g<this._subEmitters.length;g++)for(const w of this._subEmitters[g])w.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(g,w,q,o){let r;r=q instanceof ng.b?null:q;const T=(0,i.e)("BABYLON.Texture");if(T&&r&&(g.texture?w.particleTexture=T.Parse(g.texture,r,o):g.textureName&&(w.particleTexture=new T(o+g.textureName,r,!1,void 0===g.invertY||g.invertY),w.particleTexture.name=g.textureName)),g.emitterId||0===g.emitterId||void 0!==g.k?g.emitterId&&r?w.k=r.getLastMeshById(g.emitterId):w.k=R.ew.Ri(g.k):w.k=R.ew.Zero(),w.isLocal=!!g.isLocal,void 0!==g.renderingGroupId&&(w.renderingGroupId=g.renderingGroupId),void 0!==g.isBillboardBased&&(w.isBillboardBased=g.isBillboardBased),void 0!==g.billboardMode&&(w.billboardMode=g.billboardMode),void 0!==g.useLogarithmicDepth&&(w.useLogarithmicDepth=g.useLogarithmicDepth),g.animations){for(let q=0;q<g.animations.length;q++){const R=g.animations[q],o=(0,i.e)("BABYLON.Animation");o&&w.animations.push(o.Parse(R))}w.beginAnimationOnStart=g.beginAnimationOnStart,w.beginAnimationFrom=g.beginAnimationFrom,w.beginAnimationTo=g.beginAnimationTo,w.beginAnimationLoop=g.beginAnimationLoop}if(g.autoAnimate&&r&&r.beginAnimation(w,g.autoAnimateFrom,g.autoAnimateTo,g.autoAnimateLoop,g.autoAnimateSpeed||1),w.startDelay=0|g.startDelay,w.minAngularSpeed=g.minAngularSpeed,w.maxAngularSpeed=g.maxAngularSpeed,w.minSize=g.minSize,w.maxSize=g.maxSize,g.minScaleX&&(w.minScaleX=g.minScaleX,w.maxScaleX=g.maxScaleX,w.minScaleY=g.minScaleY,w.maxScaleY=g.maxScaleY),void 0!==g.preWarmCycles&&(w.preWarmCycles=g.preWarmCycles,w.preWarmStepOffset=g.preWarmStepOffset),void 0!==g.minInitialRotation&&(w.minInitialRotation=g.minInitialRotation,w.maxInitialRotation=g.maxInitialRotation),w.minLifeTime=g.minLifeTime,w.maxLifeTime=g.maxLifeTime,w.minEmitPower=g.minEmitPower,w.maxEmitPower=g.maxEmitPower,w.emitRate=g.emitRate,w.gravity=R.ew.Ri(g.gravity),g.noiseStrength&&(w.noiseStrength=R.ew.Ri(g.noiseStrength)),w.color1=S.d.Ri(g.color1),w.color2=S.d.Ri(g.color2),w.colorDead=S.d.Ri(g.colorDead),w.updateSpeed=g.updateSpeed,w.targetStopDuration=g.targetStopDuration,w.blendMode=g.blendMode,g.colorGradients)for(const R of g.colorGradients)w.addColorGradient(R.gradient,S.d.Ri(R.color1),R.color2?S.d.Ri(R.color2):void 0);if(g.rampGradients){for(const q of g.rampGradients)w.addRampGradient(q.gradient,S.Jw.Ri(q.color));w.useRampGradients=g.useRampGradients}if(g.colorRemapGradients)for(const R of g.colorRemapGradients)w.addColorRemapGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(g.alphaRemapGradients)for(const R of g.alphaRemapGradients)w.addAlphaRemapGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(g.sizeGradients)for(const R of g.sizeGradients)w.addSizeGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(g.angularSpeedGradients)for(const R of g.angularSpeedGradients)w.addAngularSpeedGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(g.velocityGradients)for(const R of g.velocityGradients)w.addVelocityGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(g.dragGradients)for(const R of g.dragGradients)w.addDragGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(g.emitRateGradients)for(const R of g.emitRateGradients)w.addEmitRateGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(g.startSizeGradients)for(const R of g.startSizeGradients)w.addStartSizeGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(g.lifeTimeGradients)for(const R of g.lifeTimeGradients)w.addLifeTimeGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2);if(g.limitVelocityGradients){for(const q of g.limitVelocityGradients)w.addLimitVelocityGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);w.limitVelocityDamping=g.limitVelocityDamping}if(g.noiseTexture&&r){const q=(0,i.e)("BABYLON.ProceduralTexture");w.noiseTexture=q.Parse(g.noiseTexture,r,o)}let z;if(g.particleEmitterType){switch(g.particleEmitterType.type){case"SphereParticleEmitter":z=new x;break;case"SphereDirectedParticleEmitter":z=new G;break;case"ConeEmitter":case"ConeParticleEmitter":z=new e;break;case"ConeDirectedParticleEmitter":z=new y;break;case"CylinderParticleEmitter":z=new L;break;case"CylinderDirectedParticleEmitter":z=new A;break;case"HemisphericParticleEmitter":z=new l;break;case"PointParticleEmitter":z=new J;break;case"MeshParticleEmitter":z=new U;break;case"CustomParticleEmitter":z=new d;break;default:z=new m}z.parse(g.particleEmitterType,r)}else z=new m,z.parse(g,r);w.particleEmitterType=z,w.startSpriteCellID=g.startSpriteCellID,w.endSpriteCellID=g.endSpriteCellID,w.spriteCellLoop=g.spriteCellLoop??!0,w.spriteCellWidth=g.spriteCellWidth,w.spriteCellHeight=g.spriteCellHeight,w.spriteCellChangeSpeed=g.spriteCellChangeSpeed,w.spriteRandomStartCell=g.spriteRandomStartCell,w.disposeOnStop=g.disposeOnStop??!1,w.manualEmitCount=g.manualEmitCount??-1}static Parse(g,w,q){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0;const i=g.name;let T,z,t=null,m=null;if(w instanceof ng.b?T=w:(z=w,T=z.getEngine()),g.customShader&&T.createEffectForParticles){m=g.customShader;const w=m.shaderOptions.defines.length>0?m.shaderOptions.defines.join("\n"):"";t=T.createEffectForParticles(m.shaderPath.fragmentElement,m.shaderOptions.uniforms,m.shaderOptions.samplers,w)}const e=new iw(i,r||g.Di,w,t,g.isAnimationSheetEnabled);if(e.customShader=m,e._rootUrl=q,g.id&&(e.id=g.id),g.subEmitters){e.subEmitters=[];for(const R of g.subEmitters){const g=[];for(const o of R)g.push(ug.Parse(o,w,q));e.subEmitters.push(g)}}if(g.attractors)for(const S of g.attractors){const g=new Sw;g.position=R.ew.Ri(S.position),g.strength=S.strength,e.addAttractor(g)}return iw._Parse(g,e,w,q),g.textureMask&&(e.textureMask=S.d.Ri(g.textureMask)),g.oz&&(e.oz=R.ew.Ri(g.oz)),g.preventAutoStart&&(e.preventAutoStart=g.preventAutoStart),o||e.preventAutoStart||e.start(),e}serialize(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const w={};if(iw._Serialize(w,this,g),w.textureMask=this.textureMask.qi(),w.customShader=this.customShader,w.preventAutoStart=this.preventAutoStart,w.oz=this.oz.qi(),this.subEmitters){w.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const q of this._subEmitters){const R=[];for(const w of q)R.push(w.serialize(g));w.subEmitters.push(R)}}if(this._attractors&&this._attractors.length){w.attractors=[];for(const g of this._attractors)w.attractors.push(g.serialize())}return w}static _Serialize(g,w,q){if(g.name=w.name,g.id=w.id,g.Di=w.getCapacity(),g.disposeOnStop=w.disposeOnStop,g.manualEmitCount=w.manualEmitCount,w.k.position){const q=w.k;g.emitterId=q.id}else{const q=w.k;g.k=q.qi()}w.particleEmitterType&&(g.particleEmitterType=w.particleEmitterType.serialize()),w.particleTexture&&(q?g.texture=w.particleTexture.serialize():(g.textureName=w.particleTexture.name,g.invertY=!!w.particleTexture._invertY)),g.isLocal=w.isLocal,s.c.AppendSerializedAnimations(w,g),g.beginAnimationOnStart=w.beginAnimationOnStart,g.beginAnimationFrom=w.beginAnimationFrom,g.beginAnimationTo=w.beginAnimationTo,g.beginAnimationLoop=w.beginAnimationLoop,g.startDelay=w.startDelay,g.renderingGroupId=w.renderingGroupId,g.isBillboardBased=w.isBillboardBased,g.billboardMode=w.billboardMode,g.minAngularSpeed=w.minAngularSpeed,g.maxAngularSpeed=w.maxAngularSpeed,g.minSize=w.minSize,g.maxSize=w.maxSize,g.minScaleX=w.minScaleX,g.maxScaleX=w.maxScaleX,g.minScaleY=w.minScaleY,g.maxScaleY=w.maxScaleY,g.minEmitPower=w.minEmitPower,g.maxEmitPower=w.maxEmitPower,g.minLifeTime=w.minLifeTime,g.maxLifeTime=w.maxLifeTime,g.emitRate=w.emitRate,g.gravity=w.gravity.qi(),g.noiseStrength=w.noiseStrength.qi(),g.color1=w.color1.qi(),g.color2=w.color2.qi(),g.colorDead=w.colorDead.qi(),g.updateSpeed=w.updateSpeed,g.targetStopDuration=w.targetStopDuration,g.blendMode=w.blendMode,g.preWarmCycles=w.preWarmCycles,g.preWarmStepOffset=w.preWarmStepOffset,g.minInitialRotation=w.minInitialRotation,g.maxInitialRotation=w.maxInitialRotation,g.startSpriteCellID=w.startSpriteCellID,g.spriteCellLoop=w.spriteCellLoop,g.endSpriteCellID=w.endSpriteCellID,g.spriteCellChangeSpeed=w.spriteCellChangeSpeed,g.spriteCellWidth=w.spriteCellWidth,g.spriteCellHeight=w.spriteCellHeight,g.spriteRandomStartCell=w.spriteRandomStartCell,g.isAnimationSheetEnabled=w.isAnimationSheetEnabled,g.useLogarithmicDepth=w.useLogarithmicDepth;const R=w.getColorGradients();if(R){g.colorGradients=[];for(const w of R){const q={gradient:w.gradient,color1:w.color1.qi()};w.color2?q.color2=w.color2.qi():q.color2=w.color1.qi(),g.colorGradients.push(q)}}const o=w.getRampGradients();if(o){g.rampGradients=[];for(const w of o){const q={gradient:w.gradient,color:w.color.qi()};g.rampGradients.push(q)}g.useRampGradients=w.useRampGradients}const r=w.getColorRemapGradients();if(r){g.colorRemapGradients=[];for(const w of r){const q={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?q.factor2=w.factor2:q.factor2=w.factor1,g.colorRemapGradients.push(q)}}const S=w.getAlphaRemapGradients();if(S){g.alphaRemapGradients=[];for(const w of S){const q={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?q.factor2=w.factor2:q.factor2=w.factor1,g.alphaRemapGradients.push(q)}}const i=w.getSizeGradients();if(i){g.sizeGradients=[];for(const w of i){const q={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?q.factor2=w.factor2:q.factor2=w.factor1,g.sizeGradients.push(q)}}const T=w.getAngularSpeedGradients();if(T){g.angularSpeedGradients=[];for(const w of T){const q={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?q.factor2=w.factor2:q.factor2=w.factor1,g.angularSpeedGradients.push(q)}}const z=w.getVelocityGradients();if(z){g.velocityGradients=[];for(const w of z){const q={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?q.factor2=w.factor2:q.factor2=w.factor1,g.velocityGradients.push(q)}}const t=w.getDragGradients();if(t){g.dragGradients=[];for(const w of t){const q={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?q.factor2=w.factor2:q.factor2=w.factor1,g.dragGradients.push(q)}}const m=w.getEmitRateGradients();if(m){g.emitRateGradients=[];for(const w of m){const q={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?q.factor2=w.factor2:q.factor2=w.factor1,g.emitRateGradients.push(q)}}const e=w.getStartSizeGradients();if(e){g.startSizeGradients=[];for(const w of e){const q={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?q.factor2=w.factor2:q.factor2=w.factor1,g.startSizeGradients.push(q)}}const y=w.getLifeTimeGradients();if(y){g.lifeTimeGradients=[];for(const w of y){const q={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?q.factor2=w.factor2:q.factor2=w.factor1,g.lifeTimeGradients.push(q)}}const L=w.getLimitVelocityGradients();if(L){g.limitVelocityGradients=[];for(const w of L){const q={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?q.factor2=w.factor2:q.factor2=w.factor1,g.limitVelocityGradients.push(q)}g.limitVelocityDamping=w.limitVelocityDamping}w.noiseTexture&&(g.noiseTexture=w.noiseTexture.serialize())}clone(g,w){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R={...this._customWrappers};let o=null;const r=this._engine;if(r.createEffectForParticles&&null!=this.customShader){o=this.customShader;const g=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"",w=r.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,g);R[0]?R[0].effect=w:this.setCustomEffect(w,0)}const S=this.serialize(q),i=iw.Parse(S,this._scene||this._engine,this._rootUrl);return i.name=g,i.customShader=o,i._customWrappers=R,void 0===w&&(w=this.k),this.noiseTexture&&(i.noiseTexture=this.noiseTexture.clone()),i.k=w,this.preventAutoStart||i.start(),i}}iw.BILLBOARDMODE_Y=2,iw.BILLBOARDMODE_ALL=7,iw.BILLBOARDMODE_STRETCHED=8,iw.BILLBOARDMODE_STRETCHED_LOCAL=9,ug._ParseParticleSystem=iw.Parse;var Tw=q(11397),zw=q(11395),tw=q(11291);tw.c.prototype.createTransformFeedback=function(){const g=this._gl.createTransformFeedback();if(!g)throw new Error("Unable to create Transform Feedback");return g},tw.c.prototype.deleteTransformFeedback=function(g){this._gl.deleteTransformFeedback(g)},tw.c.prototype.bindTransformFeedback=function(g){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,g)},tw.c.prototype.beginTransformFeedback=function(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(g?this._gl.POINTS:this._gl.TRIANGLES)},tw.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},tw.c.prototype.setTranformFeedbackVaryings=function(g,w){this._gl.transformFeedbackVaryings(g,w,this._gl.INTERLEAVED_ATTRIBS)},tw.c.prototype.bindTransformFeedbackBuffer=function(g){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,g?g.underlyingResource:null)},tw.c.prototype.readTransformFeedbackBuffer=function(g){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,g)};const mw="clipPlaneFragmentDeclaration2",ew="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";a.d.IncludesShadersStore[mw]||(a.d.IncludesShadersStore[mw]=ew);q(12418),q(12426),q(12435),q(12440),q(12444),q(12450),q(12458),q(12466);const yw="gpuRenderParticlesPixelShader",Lw="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";a.d.ShadersStore[yw]||(a.d.ShadersStore[yw]=Lw);const Aw="clipPlaneVertexDeclaration2",lw="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";a.d.IncludesShadersStore[Aw]||(a.d.IncludesShadersStore[Aw]=lw);q(12468),q(12473),q(12482),q(12491);const Jw="gpuRenderParticlesVertexShader",xw="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";a.d.ShadersStore[Jw]||(a.d.ShadersStore[Jw]=xw);class Gw extends T{static get IsSupported(){if(!I.c.LastCreatedEngine)return!1;const g=I.c.LastCreatedEngine.getCaps();return g.supportTransformFeedbacks||g.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(g){this._maxActiveParticleCount=Math.min(g,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(g){this.maxActiveParticleCount=g}createPointEmitter(g,w){const q=Wg(g,w);return this.particleEmitterType=q,q}createHemisphericEmitter(){const g=pg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=g,g}createSphereEmitter(){const g=Zg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=g,g}createDirectedSphereEmitter(){const g=Ig(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R.ew(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.ew(0,1,0));return this.particleEmitterType=g,g}createCylinderEmitter(){const g=kg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=g,g}createDirectedCylinderEmitter(){const g=gw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.ew(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new R.ew(0,1,0));return this.particleEmitterType=g,g}createConeEmitter(){const g=ww(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=g,g}createDirectedConeEmitter(){const g=qw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R.ew(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R.ew(0,1,0));return this.particleEmitterType=g,g}createBoxEmitter(g,w,q,R){const o=new m;return this.particleEmitterType=o,this.direction1=g,this.direction2=w,this.minEmitBox=q,this.maxEmitBox=R,o}get flowMap(){return this._flowMap}set flowMap(g){this._flowMap!==g&&(this._flowMap=g)}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==iw.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(iw.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(iw.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";g?setTimeout((()=>{this.start(0)}),g):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var g;let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(g=this._customWrappers[w])||void 0===g?void 0:g.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[g]??this._customWrappers[0]}setCustomEffect(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[w]=new gg.e(this._engine),this._customWrappers[w].effect=g}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new p.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(g,w,q){return super._removeGradientAndTexture(g,w,q),this._releaseBuffers(),this}addColorGradient(g,w){this._colorGradients||(this._colorGradients=[]);const q=new F(g,w);return this._colorGradients.push(q),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(g&&this._colorGradients.sort(((g,w)=>g.gradient<w.gradient?-1:g.gradient>w.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(g){return this._removeGradientAndTexture(g,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const w in this._drawWrappers){var g;null===(g=this._drawWrappers[w].drawContext)||void 0===g||g.reset()}}_addFactorGradient(g,w,q){const R=new n(w,q);g.push(R),this._releaseBuffers()}addSizeGradient(g,w){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,g,w),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(g){return this._removeGradientAndTexture(g,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(g,w){if(!g)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&g.sort(((g,w)=>g.gradient<w.gradient?-1:g.gradient>w.gradient?1:0));const q=this;q[w]&&(q[w].dispose(),q[w]=null)}addAngularSpeedGradient(g,w){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,g,w),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(g){return this._removeGradientAndTexture(g,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(g,w){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,g,w),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(g){return this._removeGradientAndTexture(g,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(g,w){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,g,w),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(g){return this._removeGradientAndTexture(g,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(g,w){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,g,w),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(g){return this._removeGradientAndTexture(g,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(g){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(g,w,q){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(g),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.WS=new p.b,this.onStoppedObservable=new p.b,this.onStartedObservable=new p.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,q&&"Scene"!==q.getClassName()?(this._engine=q,this.defaultProjectionMatrix=R.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=q||I.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ym.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,i.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,i.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,i.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,i.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new gg.e(this._engine)},this._customWrappers[0].effect=o,this._drawWrappers={0:new gg.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(w=w??{}).randomTextureSize||delete w.randomTextureSize;const S={Di:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...w},T=w;isFinite(T)&&(S.Di=T),this._capacity=S.Di,this._maxActiveParticleCount=S.Di,this._currentActiveCount=0,this._isAnimationSheetEnabled=r,this.particleEmitterType=new m;const z=Math.min(this._engine.getCaps().maxTextureSize,S.randomTextureSize);let t=[];for(let R=0;R<z;++R)t.push(Math.random()),t.push(Math.random()),t.push(Math.random()),t.push(Math.random());this._randomTexture=new Z.d(new Float32Array(t),z,1,5,q,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,t=[];for(let R=0;R<z;++R)t.push(Math.random()),t.push(Math.random()),t.push(Math.random()),t.push(Math.random());this._randomTexture2=new Z.d(new Float32Array(t),z,1,5,q,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=z}_reset(){this._releaseBuffers()}_createVertexBuffers(g,w,q){const R={};R.position=w.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let o=3;R.age=w.createVertexBuffer("age",o,1,this._attributesStrideSize,!0),o+=1,R.size=w.createVertexBuffer("size",o,3,this._attributesStrideSize,!0),o+=3,R.life=w.createVertexBuffer("life",o,1,this._attributesStrideSize,!0),o+=1,o+=4,this.billboardMode===iw.BILLBOARDMODE_STRETCHED&&(R.direction=w.createVertexBuffer("direction",o,3,this._attributesStrideSize,!0)),o+=3,this._platform.alignDataInBuffer&&(o+=1),this.particleEmitterType instanceof d&&(o+=3,this._platform.alignDataInBuffer&&(o+=1)),this._colorGradientsTexture||(R.color=w.createVertexBuffer("color",o,4,this._attributesStrideSize,!0),o+=4),this._isBillboardBased||(R.initialDirection=w.createVertexBuffer("initialDirection",o,3,this._attributesStrideSize,!0),o+=3,this._platform.alignDataInBuffer&&(o+=1)),this.noiseTexture&&(R.noiseCoordinates1=w.createVertexBuffer("noiseCoordinates1",o,3,this._attributesStrideSize,!0),o+=3,this._platform.alignDataInBuffer&&(o+=1),R.noiseCoordinates2=w.createVertexBuffer("noiseCoordinates2",o,3,this._attributesStrideSize,!0),o+=3,this._platform.alignDataInBuffer&&(o+=1)),R.angle=w.createVertexBuffer("angle",o,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?o++:o+=2,this._isAnimationSheetEnabled&&(R.cellIndex=w.createVertexBuffer("cellIndex",o,1,this._attributesStrideSize,!0),o+=1,this.spriteRandomStartCell&&(R.cellStartOffset=w.createVertexBuffer("cellStartOffset",o,1,this._attributesStrideSize,!0),o+=1)),R.offset=q.createVertexBuffer("offset",0,2),R.uv=q.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(R),this._platform.createVertexBuffers(g,R),this.resetDrawCache()}_initialize(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!g)return;const w=this._engine,q=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof d&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const o=this.particleEmitterType instanceof d,r=R.TmpVectors.ew[0];let S=0;for(let R=0;R<this._capacity;R++)if(q.push(0),q.push(0),q.push(0),q.push(0),q.push(0),q.push(0),q.push(0),q.push(0),q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),o?(this.particleEmitterType.particleDestinationGenerator(R,null,r),q.push(r.x),q.push(r.y),q.push(r.z)):(q.push(0),q.push(0),q.push(0)),this._platform.alignDataInBuffer&&q.push(0),S+=16,o&&(this.particleEmitterType.particlePositionGenerator(R,null,r),q.push(r.x),q.push(r.y),q.push(r.z),this._platform.alignDataInBuffer&&q.push(0),S+=4),this._colorGradientsTexture||(q.push(0),q.push(0),q.push(0),q.push(0),S+=4),this.isBillboardBased||(q.push(0),q.push(0),q.push(0),this._platform.alignDataInBuffer&&q.push(0),S+=4),this.noiseTexture&&(q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),this._platform.alignDataInBuffer&&q.push(0),q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),this._platform.alignDataInBuffer&&q.push(0),S+=8),q.push(0),S+=1,this._angularSpeedGradientsTexture||(q.push(0),S+=1),this._isAnimationSheetEnabled&&(q.push(0),S+=1,this.spriteRandomStartCell&&(q.push(0),S+=1)),this._platform.alignDataInBuffer){let g=3-(S+3&3);for(S+=g;g-- >0;)q.push(0)}const i=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),T=this._platform.createParticleBuffer(q),z=this._platform.createParticleBuffer(q);this._buffer0=new D.e(w,T,!1,this._attributesStrideSize),this._buffer1=new D.e(w,z,!1,this._attributesStrideSize),this._spriteBuffer=new D.e(w,i,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let g=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(g+="\n#define BILLBOARD"),this._colorGradientsTexture&&(g+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(g+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(g+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(g+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(g+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(g+="\n#define DRAGGRADIENTS"),this._flowMap&&(g+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(g+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(g+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(g+="\n#define NOISE"),this.isLocal&&(g+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===g||(this._cachedUpdateDefines=g,this._updateBuffer=this._platform.createUpdateBuffer(g)),this._platform.isUpdateBufferReady()}_getWrapper(g){const w=this._getCustomDrawWrapper(g);if(null!==w&&void 0!==w&&w.effect)return w;const q=[];this.fillDefines(q,g);let R=this._drawWrappers[g];R||(R=new gg.e(this._engine),R.drawContext&&(R.drawContext.useInstancing=!0),this._drawWrappers[g]=R);const o=q.join("\n");if(R.defines!==o){const g=[],w=[],q=[];this.fillUniformsAttributesAndSamplerNames(w,g,q),R.setEffect(this._engine.createEffect("gpuRenderParticles",g,w,q,o),o)}return R}static _GetAttributeNamesOrOptions(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=[D.h.PositionKind,"age","life","size","angle"];return g||o.push(D.h.ColorKind),w&&o.push("cellIndex"),q||o.push("initialDirection"),R&&o.push("direction"),o.push("offset",D.h.UVKind),o}static _GetEffectCreationOptions(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R=["emitterWM","oz","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,wg.c)(R),g&&R.push("sheetInfos"),w&&R.push("logarithmicDepthConstant"),q&&(R.push("vFogInfos"),R.push("vFogColor")),R}fillDefines(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,wg.l)(this,this._scene,g),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==zw.c.FOGMODE_NONE&&g.push("#define FOG")),w===iw.BLENDMODE_MULTIPLY&&g.push("#define BLENDMULTIPLYMODE"),this.isLocal&&g.push("#define LOCAL"),this.useLogarithmicDepth&&g.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(g.push("#define BILLBOARD"),this.billboardMode){case iw.BILLBOARDMODE_Y:g.push("#define BILLBOARDY");break;case iw.BILLBOARDMODE_STRETCHED:g.push("#define BILLBOARDSTRETCHED");break;case iw.BILLBOARDMODE_ALL:g.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&g.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&g.push("#define ANIMATESHEET"),q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),g.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(g,w,q){w.push(...Gw._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===iw.BILLBOARDMODE_STRETCHED)),g.push(...Gw._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),q.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Tw.c.PrepareUniforms(g,this._imageProcessingConfigurationDefines),Tw.c.PrepareSamplers(q,this._imageProcessingConfigurationDefines))}animate(){var g;let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(w?this.preWarmStepOffset:(null===(g=this._scene)||void 0===g?void 0:g.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(g,w){const q=this[w];if(!g||!g.length||q)return;const R=new Float32Array(this._rawTextureWidth);for(let o=0;o<this._rawTextureWidth;o++){const w=o/this._rawTextureWidth;W.GetCurrentGradient(w,g,((g,w,q)=>{R[o]=(0,z.Lerp)(g.factor1,w.factor1,q)}))}this[w]=Z.d.CreateRTexture(R,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[w].name=w.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const g=new Uint8Array(4*this._rawTextureWidth),w=S.g.ci[0];for(let q=0;q<this._rawTextureWidth;q++){const R=q/this._rawTextureWidth;W.GetCurrentGradient(R,this._colorGradients,((R,o,r)=>{S.d.LerpToRef(R.color1,o.color1,r,w),g[4*q]=255*w.r,g[4*q+1]=255*w.g,g[4*q+2]=255*w.b,g[4*q+3]=255*w.a}))}this._colorGradientsTexture=Z.d.CreateRGBATexture(g,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(g,w){var q,o,r,S;const i=this._getWrapper(g),T=i.effect;this._engine.enableEffect(i);const z=(null===(q=this._scene)||void 0===q?void 0:q.getViewMatrix())||R.Matrix.IdentityReadOnly;if(T.setMatrix("view",z),T.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),T.setTexture("diffuseSampler",this.particleTexture),T.setVector2("translationPivot",this.translationPivot),T.setVector3("oz",this.oz),this.isLocal&&T.setMatrix("emitterWM",w),this._colorGradientsTexture?T.setTexture("colorGradientSampler",this._colorGradientsTexture):T.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const g=this.particleTexture.getBaseSize();T.setFloat3("sheetInfos",this.spriteCellWidth/g.width,this.spriteCellHeight/g.height,g.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const g=this._scene.activeCamera;T.setVector3("eyePosition",g.globalPosition)}const t=T.defines;if(this._scene&&((0,wg.d)(T,this,this._scene),this.applyFog&&(0,qg.e)(this._scene,void 0,T)),t.indexOf("#define BILLBOARDMODE_ALL")>=0){const g=z.clone();g.invert(),T.setMatrix("invView",g)}return this.useLogarithmicDepth&&this._scene&&(0,qg.j)(t,T,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(T),this._setEngineBasedOnBlendMode(g),this._platform.bindDrawBuffers(this._targetIndex,T,null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(T),null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(S=this._scene)&&void 0!==S&&S.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(g){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!g)if(this.k.position){g=this.k.getWorldMatrix()}else{const w=this.k;g=R.TmpVectors.Matrix[0],R.Matrix.TranslationToRef(w.x,w.y,w.z,g)}const w=this._engine,q=w.getDepthWrite();if(w.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const g=this.Ng();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",g.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",g),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const o=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=o,w.setDepthWrite(q)}render(){let g,w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!w&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let g=0;g<this.preWarmCycles;g++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const g=0|this._accumulatedCount;this._accumulatedCount-=g,this._currentActiveCount+=g}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){g=this.k.getWorldMatrix()}else{const w=this.k;g=R.TmpVectors.Matrix[0],R.Matrix.TranslationToRef(w.x,w.y,w.z,g)}const o=this._engine;this.updateInAnimate||this._update(g);let r=0;return w||q||(o.setState(!1),this.forceDepthWrite&&o.setDepthWrite(!0),r=this.blendMode===iw.BLENDMODE_MULTIPLYADD?this._render(iw.BLENDMODE_MULTIPLY,g)+this._render(iw.BLENDMODE_ADD,g):this._render(this.blendMode,g),this._engine.setAlphaMode(0)),r}rebuild(){const g=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(g,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,g()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const w in this._drawWrappers){this._drawWrappers[w].dispose()}if(this._drawWrappers={},this._scene){const g=this._scene.Ym.indexOf(this);g>-1&&this._scene.Ym.splice(g,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let w=0;w<this._renderVertexBuffers.length;++w){const g=this._renderVertexBuffers[w];for(const w in g)g[w].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),g&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),g&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.WS.notifyObservers(this),this.WS.clear()}clone(g,w){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const R={...this._customWrappers};let o=null;const r=this._engine;if(r.createEffectForParticles&&null!=this.customShader){o=this.customShader;const g=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"";R[0]=r.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,g,void 0,void 0,void 0,this)}const S=this.serialize(q),i=Gw.Parse(S,this._scene||this._engine,this._rootUrl);return i.name=g,i.customShader=o,i._customWrappers=R,void 0===w&&(w=this.k),this.noiseTexture&&(i.noiseTexture=this.noiseTexture.clone()),i.k=w,i}serialize(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const w={};return iw._Serialize(w,this,g),w.activeParticleCount=this.activeParticleCount,w.randomTextureSize=this._randomTextureSize,w.customShader=this.customShader,w}static Parse(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0;const r=g.name;let S,i;w instanceof ng.b?S=w:(i=w,S=i.getEngine());const T=new Gw(r,{Di:o||g.Di,randomTextureSize:g.randomTextureSize},w,null,g.isAnimationSheetEnabled);if(T._rootUrl=q,g.customShader&&S.createEffectForParticles){const w=g.customShader,q=w.shaderOptions.defines.length>0?w.shaderOptions.defines.join("\n"):"",R=S.createEffectForParticles(w.shaderPath.fragmentElement,w.shaderOptions.uniforms,w.shaderOptions.samplers,q,void 0,void 0,void 0,T);T.setCustomEffect(R,0),T.customShader=w}return g.id&&(T.id=g.id),g.activeParticleCount&&(T.activeParticleCount=g.activeParticleCount),iw._Parse(g,T,w,q),g.preventAutoStart&&(T.preventAutoStart=g.preventAutoStart),R||T.preventAutoStart||T.start(),T}}var dw=q(10991),Dw=q(12499),Uw=q(11508);class Nw{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(g){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const w of this.systems)w.k=g;this._emitterNode=g}setEmitterAsSphere(g,w,q){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:g,renderingGroupId:w};const R=(0,Dw.e)("emitterSphere",{diameter:g.diameter,segments:g.segments},q);R.renderingGroupId=w;const o=new Uw.lw("emitterSphereMaterial",q);o.emissiveColor=g.color,R.material=o;for(const r of this.systems)r.k=R;this._emitterNode=R}start(g){for(const w of this.systems)g&&(w.k=g),w.start()}dispose(){for(const g of this.systems)g.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const w={systems:[]};for(const q of this.systems)w.systems.push(q.serialize(g));return this._emitterNode&&(w.k=this._emitterCreationOptions),w}static Parse(g,w){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3?arguments[3]:void 0;const o=new Nw,r=this.BaseAssetsUrl+"/textures/";w=w||I.c.LastCreatedScene;for(const S of g.systems)o.systems.push(q?Gw.Parse(S,w,r,!0,R):iw.Parse(S,w,r,!0,R));if(g.k){const q=g.k.options;if("Sphere"===g.k.kind)o.setEmitterAsSphere({diameter:q.diameter,segments:q.segments,color:S.Jw.Ri(q.color)},g.k.renderingGroupId,w)}return o}}Nw.BaseAssetsUrl="https://assets.babylonjs.com/particles";var aw=q(11032);class Hw{static CreateDefault(g){let w,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,R=arguments.length>2?arguments[2]:void 0;w=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Gw("default system",{Di:q},R):new iw("default system",q,R),w.k=g;const o=dw.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return w.particleTexture=new h.e(o,w.Ng()),w.createConeEmitter(.1,Math.PI/4),w.color1=new S.d(1,1,1,1),w.color2=new S.d(1,1,1,1),w.colorDead=new S.d(1,1,1,0),w.minSize=.1,w.maxSize=.1,w.minEmitPower=2,w.maxEmitPower=2,w.updateSpeed=1/60,w.emitRate=30,w}static CreateAsync(g,w){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3?arguments[3]:void 0;w||(w=I.c.LastCreatedScene);const o={};return w.addPendingData(o),new Promise(((r,S)=>{if(q&&!Gw.IsSupported)return w.removePendingData(o),S("Particle system with GPU is not supported.");dw.Tools.LoadFile(`${Hw.BaseAssetsUrl}/systems/${g}.json`,(g=>{w.removePendingData(o);const S=JSON.parse(g.toString());return r(Nw.Parse(S,w,q,R))}),void 0,void 0,void 0,(()=>(w.removePendingData(o),S(`An error occurred with the creation of your particle system. Check if your type '${g}' exists.`))))}))}static ExportSet(g){const w=new Nw;for(const q of g)w.systems.push(q);return w}static ParseFromFileAsync(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=arguments.length>5?arguments[5]:void 0;return new Promise(((S,i)=>{const T=new aw.e;T.addEventListener("readystatechange",(()=>{if(4==T.readyState)if(200==T.status){const w=JSON.parse(T.responseText);let i;i=R?Gw.Parse(w,q,o,!1,r):iw.Parse(w,q,o,!1,r),g&&(i.name=g),S(i)}else i("Unable to load the particle system")})),T.open("GET",w),T.send()}))}static ParseFromSnippetAsync(g,w){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0;if("_BLANK"===g){const g=this.CreateDefault(null);return g.start(),Promise.resolve(g)}return new Promise(((r,S)=>{const i=new aw.e;i.addEventListener("readystatechange",(()=>{if(4==i.readyState)if(200==i.status){const S=JSON.parse(JSON.parse(i.responseText).jsonPayload),T=JSON.parse(S.particleSystem);let z;z=q?Gw.Parse(T,w,R,!1,o):iw.Parse(T,w,R,!1,o),z.snippetId=g,r(z)}else S("Unable to load the snippet "+g)})),i.open("GET",this.SnippetUrl+"/"+g.replace(/#/g,"/")),i.send()}))}}Hw.BaseAssetsUrl=Nw.BaseAssetsUrl,Hw.SnippetUrl="https://snippet.babylonjs.com",Hw.CreateFromSnippetAsync=Hw.ParseFromSnippetAsync;var Cw=q(11586),cw=q(11420),Pw=q(12501);(0,Pw.c)(cw.e.NAME_PARTICLESYSTEM,((g,w,q,R)=>{const o=(0,Pw.d)(cw.e.NAME_PARTICLESYSTEM);if(o&&void 0!==g.Ym&&null!==g.Ym)for(let r=0,S=g.Ym.length;r<S;r++){const S=g.Ym[r];q.Ym.push(o(S,w,R))}})),(0,Pw.b)(cw.e.NAME_PARTICLESYSTEM,((g,w,q)=>{if(g.activeParticleCount){return Gw.Parse(g,w,q)}return iw.Parse(g,w,q)})),ng.b.prototype.createEffectForParticles=function(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,T=arguments.length>7?arguments[7]:void 0,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,t=arguments.length>9?arguments[9]:void 0,m=[],e=[];const y=[];return T?T.fillUniformsAttributesAndSamplerNames(e,m,y):(m=iw._GetAttributeNamesOrOptions(),e=iw._GetEffectCreationOptions()),-1===o.indexOf(" BILLBOARD")&&(o+="\n#define BILLBOARD\n"),null!==T&&void 0!==T&&T.isAnimationSheetEnabled&&-1===o.indexOf(" ANIMATESHEET")&&(o+="\n#define ANIMATESHEET\n"),-1===R.indexOf("diffuseSampler")&&R.push("diffuseSampler"),this.createEffect({vertex:t??(null===T||void 0===T?void 0:T.vertexShaderName)??"particles",fragmentElement:g},m,e.concat(w),y.concat(R),o,r,S,i,void 0,z,(async()=>{0===z?await Promise.resolve().then(q.bind(q,12523)):await Promise.resolve().then(q.bind(q,12592))}))},Cw.d.prototype.getEmittedParticleSystems=function(){const g=[];for(let w=0;w<this.Ng().Ym.length;w++){const q=this.Ng().Ym[w];q.k===this&&g.push(q)}return g},Cw.d.prototype.getHierarchyEmittedParticleSystems=function(){const g=[],w=this.getDescendants();w.push(this);for(let q=0;q<this.Ng().Ym.length;q++){const R=this.Ng().Ym[q],o=R.k;o.position&&-1!==w.indexOf(o)&&g.push(R)}return g};q(11480),q(11489),q(11567);q(11572),q(12504),q(11360),q(11471),q(11610);q(11351);var jw;q(12510),q(11204);!function(g){g[g.Color=2]="Color",g[g.UV=1]="UV",g[g.Random=0]="Random",g[g.Stated=3]="Stated"}(jw||(jw={}));var Mw=q(11383);const Vw=new R.ew(0,0,0),sw=new R.ew(0,0,0),hw=new R.ew(0,0,0);class vw{constructor(g,w,q){this.width=g,this.height=w,this.data=q}processFlowable(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2?arguments[2]:void 0;if(!q)return;q instanceof R.Matrix?R.ew.TransformCoordinatesToRef(g.position,q,hw):(hw.x=q.x,hw.y=q.y,hw.z=q.z);const o=.5*hw.x+.5,r=1-(.5*hw.y+.5),S=Math.floor(o*this.width),i=Math.floor(r*this.height);if(S<0||S>=this.width||i<0||i>=this.height)return;const T=4*(i*this.width+S),z=this.data[T]/255*2-1,t=this.data[T+1]/255*2-1,m=this.data[T+2]/255*2-1,e=this.data[T+3]/255;Vw.set(z,t,m),Vw.scaleToRef(w*e,sw),g.direction.addInPlace(sw)}_processParticle(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2?arguments[2]:void 0;this.processFlowable(g,w,q)}static async FromUrlAsync(g){return await new Promise(((w,q)=>{const R=document.createElement("canvas"),o=R.getContext("2d");let r=null;const S=new Image;S.crossOrigin="anonymous",S.src=g,S.onerror=w=>{q(new Error(`Failed to load image: ${g} : ${w}`))},S.onload=()=>{R.width=S.width,R.height=S.height,o.drawImage(S,0,0),r=o.getImageData(0,0,R.width,R.height),w(new vw(R.width,R.height,r.data))}}))}static async ExtractFromTextureAsync(g){return await new Promise(((w,q)=>{if(!g.isReady())return void g.onLoadObservable.addOnce((async()=>{try{const q=await this.ExtractFromTextureAsync(g);w(q)}catch(R){q(R)}}));const R=g.getSize();Mw.l.GetTextureDataAsync(g,R.width,R.height).then((g=>{w(new vw(R.width,R.height,new Uint8ClampedArray(g)))})).catch(q)}))}}var bw,Bw,fw,Ow,Ew,Qw,Xw,Kw,Yw;!function(g){g[g.Int=1]="Int",g[g.Float=2]="Float",g[g.Vector2=4]="Vector2",g[g.ew=8]="ew",g[g.Matrix=16]="Matrix",g[g.Particle=32]="Particle",g[g.Texture=64]="Texture",g[g.ci=128]="ci",g[g.FloatGradient=256]="FloatGradient",g[g.Vector2Gradient=512]="Vector2Gradient",g[g.Vector3Gradient=1024]="Vector3Gradient",g[g.Color4Gradient=2048]="Color4Gradient",g[g.System=4096]="System",g[g.AutoDetect=8192]="AutoDetect",g[g.BasedOnInput=16384]="BasedOnInput",g[g.Undefined=32768]="Undefined",g[g.All=65535]="All"}(bw||(bw={})),function(g){g[g.Compatible=0]="Compatible",g[g.TypeIncompatible=1]="TypeIncompatible",g[g.HierarchyIssue=2]="HierarchyIssue"}(Bw||(Bw={})),function(g){g[g.Input=0]="Input",g[g.Output=1]="Output"}(fw||(fw={}));class Fw{get direction(){return this._direction}get type(){if(this._type===bw.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===bw.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(g){this._type=g}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((g=>g.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(g,w,q){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=bw.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new p.b,this.onDisconnectionObservable=new p.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=w,this.name=g,this._direction=q}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(g){var w;return this.isConnected?null!==(w=this._connectedPoint)&&void 0!==w&&w._storedFunction?this._connectedPoint._storedFunction(g):this._connectedPoint._storedValue:this.value}canConnectTo(g){return 0===this.checkCompatibilityState(g)}checkCompatibilityState(g){const w=this._ownerBlock,q=g.ownerBlock;if(this.type!==g.type&&g.innerType!==bw.AutoDetect)return g.acceptedConnectionPointTypes&&-1!==g.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(g.excludedConnectionPointTypes&&-1!==g.excludedConnectionPointTypes.indexOf(this.type))return 1;let R=q,o=w;return 0===this.direction&&(R=w,o=q),R.isAnAncestorOf(o)?2:0}connectTo(g){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(g))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${g.ownerBlock.name}".${g.name}`;return this._endpoints.push(g),g._connectedPoint=this,this.onConnectionObservable.notifyObservers(g),g.onConnectionObservable.notifyObservers(this),this}disconnectFrom(g){const w=this._endpoints.indexOf(g);return-1===w||(this._endpoints.splice(w,1),g._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(g),g.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(g){let w=1;for(;w<bw.All;)g&w||this.excludedConnectionPointTypes.push(w),w<<=1}serialize(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const w={};return w.name=this.name,w.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.qi?(w.valueType="BABYLON."+this.value.getClassName(),w.value=this.value.qi()):(w.valueType="number",w.value=this.value)),g&&this.connectedPoint&&(w.inputName=this.name,w.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,w.targetConnectionName=this.connectedPoint.name,w.isExposedOnFrame=!0,w.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(w.isExposedOnFrame=!0,w.exposedPortPosition=this.exposedPortPosition),w}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class uw{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(g){this._name=g}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(g){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new p.b,this.WS=new p.b,this.onInputChangedObservable=new p.b,this.visibleOnFrame=!1,this._name=g,this.uniqueId=v.e.UniqueId}_inputRename(g){return g}_outputRename(g){return g}isAnAncestorOf(g){for(const w of this._outputs)if(w.hasEndpoints)for(const q of w.endpoints){if(q.ownerBlock===g)return!0;if(q.ownerBlock.isAnAncestorOf(g))return!0}return!1}isAnAncestorOfType(g){if(this.getClassName()===g)return!0;for(const w of this._outputs)if(w.hasEndpoints)for(const q of w.endpoints)if(q.ownerBlock.isAnAncestorOfType(g))return!0;return!1}getInputByName(g){const w=this._inputs.filter((w=>w.name===g));return w.length?w[0]:null}_linkConnectionTypes(g,w){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[w]._acceptedConnectionPointType=this._inputs[g]:(this._inputs[g]._linkedConnectionSource=this._inputs[w],this._inputs[g]._isMainLinkSource=!0),this._inputs[w]._linkedConnectionSource=this._inputs[g]}registerInput(g,w){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;const S=new Fw(g,this,0);return S.type=w,S.isOptional=q,S.defaultValue=R,S.value=R,S.valueMin=o,S.valueMax=r,this._inputs.push(S),this.onInputChangedObservable.notifyObservers(S),this}registerOutput(g,w,q){return(q=q??new Fw(g,this,1)).type=w,this._outputs.push(q),this}_build(g){}_customBuildStep(g){}build(g){if(this._buildId===g.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((g=>g.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=g.buildId;for(const w of this._inputs){if(!w.connectedPoint){w.isOptional||g.notConnectedNonOptionalInputs.push(w);continue}const q=w.connectedPoint.ownerBlock;q&&q!==this&&!q.isSystem&&q.build(g)}return this._customBuildStep(g),g.verbose&&b.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(g),this.onBuildObservable.notifyObservers(this),!1}serialize(){const g={};g.customType="BABYLON."+this.getClassName(),g.id=this.uniqueId,g.name=this.name,g.visibleOnFrame=this.visibleOnFrame,g.inputs=[],g.outputs=[];for(const w of this.inputs)g.inputs.push(w.serialize());for(const w of this.outputs)g.outputs.push(w.serialize(!1));return g}_deserialize(g){this._name=g.name,this.comments=g.comments,this.visibleOnFrame=!!g.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(g)}_deserializePortDisplayNamesAndExposedOnFrame(g){const w=g.inputs,q=g.outputs;if(w)for(const R of w){const g=this.inputs.find((g=>g.name===R.name));if(!g)return;if(R.displayName&&(g.displayName=R.displayName),R.isExposedOnFrame&&(g.isExposedOnFrame=R.isExposedOnFrame,g.exposedPortPosition=R.exposedPortPosition),void 0!==R.value&&null!==R.value)if("number"===R.valueType)g.value=R.value;else{const w=(0,i.e)(R.valueType);w&&(g.value=w.Ri(R.value))}}if(q)for(let R=0;R<q.length;R++){const g=q[R];g.displayName&&(this.outputs[R].displayName=g.displayName),g.isExposedOnFrame&&(this.outputs[R].isExposedOnFrame=g.isExposedOnFrame,this.outputs[R].exposedPortPosition=g.exposedPortPosition)}}clone(){const g=this.serialize(),w=(0,i.e)(g.customType);if(w){const q=new w;return q._deserialize(g),q}return null}dispose(){this.WS.notifyObservers(this),this.WS.clear();for(const g of this.inputs)g.dispose();for(const g of this.outputs)g.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function nw(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",R=arguments.length>3?arguments[3]:void 0;return(o,r)=>{let S=o._propStore;S||(S=[],o._propStore=S),S.push({propertyName:r,displayName:g,type:w,groupName:q,options:R??{},className:o.getClassName()})}}(0,M.e)([(0,V.K)("comment")],uw.prototype,"comments",void 0),function(g){g[g.Boolean=0]="Boolean",g[g.Float=1]="Float",g[g.Int=2]="Int",g[g.Vector2=3]="Vector2",g[g.List=4]="List",g[g.ci=5]="ci",g[g.SamplingMode=6]="SamplingMode",g[g.TextureFormat=7]="TextureFormat",g[g.TextureType=8]="TextureType"}(Ow||(Ow={})),function(g){g[g.None=0]="None",g[g.Position=1]="Position",g[g.Direction=2]="Direction",g[g.Age=3]="Age",g[g.Lifetime=4]="Lifetime",g[g.Color=5]="Color",g[g.ScaledDirection=6]="ScaledDirection",g[g.Scale=7]="Scale",g[g.AgeGradient=8]="AgeGradient",g[g.Angle=9]="Angle",g[g.SpriteCellIndex=16]="SpriteCellIndex",g[g.SpriteCellStart=17]="SpriteCellStart",g[g.SpriteCellEnd=18]="SpriteCellEnd"}(Ew||(Ew={})),function(g){g[g.None=0]="None",g[g.Time=1]="Time",g[g.Delta=2]="Delta",g[g.Emitter=3]="Emitter"}(Qw||(Qw={}));class Ww{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let g="";for(const w of this.notConnectedNonOptionalInputs)g+=`input ${w.name} from block ${w.ownerBlock.name}[${w.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(g)throw"Build of Node Particle System Set failed:\n"+g}adapt(g,w){const q=g.getConnectedValue(this)||0;if(g.type===w)return q;switch(w){case bw.Vector2:return new R.Vector2(q,q);case bw.ew:return new R.ew(q,q,q);case bw.ci:return new S.d(q,q,q,q)}return null}getContextualValue(g){if(!this.particleContext||!this.systemContext)return null;switch(g){case Ew.Position:return this.particleContext.position;case Ew.Direction:return this.particleContext.direction;case Ew.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Ew.Color:return this.particleContext.color;case Ew.Age:return this.particleContext.age;case Ew.Lifetime:return this.particleContext.lifeTime;case Ew.Angle:return this.particleContext.angle;case Ew.Scale:return this.particleContext.scale;case Ew.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Ew.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Ew.SpriteCellIndex:return this.particleContext.cellIndex;case Ew.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.k.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.k.absolutePosition:this.systemContext.k:null}getSystemValue(g){if(!this.particleContext||!this.systemContext)return null;switch(g){case Qw.Time:return this.systemContext._actualFrame;case Qw.Delta:return this.systemContext._scaledUpdateSpeed;case Qw.Emitter:if(this.isEmitterTransformNode){return this.systemContext.k.absolutePosition}return this.systemContext.k}return null}}function pw(g,w,q){const R=new Ww;R.Aw=w;const o=g.createSystem(R);return o.canStart=()=>!0,o.k=q.clone(),o.disposeOnStop=!0,o.start(),o}class Zw extends uw{constructor(g){super(g),this.blendMode=T.BLENDMODE_ONEONE,this.Di=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",bw.Particle),this.registerInput("texture",bw.Texture),this.registerInput("onStart",bw.System,!0),this.registerInput("onEnd",bw.System,!0),this.registerOutput("system",bw.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(g){g.Di=this.Di,g.buildId=this._buildId++,this.build(g);const w=this.particle.getConnectedValue(g);return w.particleTexture=this.texture.getConnectedValue(g),w.emitRate=this.emitRate,w.blendMode=this.blendMode,w.name=this.name,w._nodeGenerated=!0,w._targetStopDuration=this.targetStopDuration,w.startDelay=this.startDelay,this.system._storedValue=this,w.canStart=()=>!this.doNoStart,w.onStartedObservable.add((q=>{const R=this.onStart.getConnectedValue(g);R&&q.onStartedObservable.addOnce((()=>{g.systemContext=w;const q=pw(R,g.Aw,g.emitterPosition);this.WS.addOnce((()=>{q.dispose()}))}));const o=this.onEnd.getConnectedValue(g);o&&q.onStoppedObservable.addOnce((()=>{g.systemContext=w;const q=pw(o,g.Aw,g.emitterPosition);this.WS.addOnce((()=>{q.dispose()}))}))})),this.WS.addOnce((()=>{w.dispose()})),w}serialize(){const g=super.serialize();return g.Di=this.Di,g.emitRate=this.emitRate,g.blendMode=this.blendMode,g.doNoStart=this.doNoStart,g.targetStopDuration=this.targetStopDuration,g.startDelay=this.startDelay,g}_deserialize(g){super._deserialize(g),this.Di=g.Di,this.emitRate=g.emitRate,this.doNoStart=!!g.doNoStart,void 0!==g.blendMode&&(this.blendMode=g.blendMode),void 0!==g.targetStopDuration&&(this.targetStopDuration=g.targetStopDuration),void 0!==g.startDelay&&(this.startDelay=g.startDelay)}}(0,M.e)([nw("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:T.BLENDMODE_ONEONE},{label:"Standard",value:T.BLENDMODE_STANDARD},{label:"Add",value:T.BLENDMODE_ADD},{label:"Multiply",value:T.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:T.BLENDMODE_MULTIPLYADD}]})],Zw.prototype,"blendMode",void 0),(0,M.e)([nw("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Zw.prototype,"Di",void 0),(0,M.e)([nw("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Zw.prototype,"emitRate",void 0),(0,M.e)([nw("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Zw.prototype,"targetStopDuration",void 0),(0,M.e)([nw("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Zw.prototype,"startDelay",void 0),(0,M.e)([nw("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Zw.prototype,"doNoStart",void 0),(0,i.g)("BABYLON.SystemBlock",Zw);class Iw extends uw{get type(){if(this._type===bw.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=bw.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=bw.Vector2,this._type;case"ew":return this._type=bw.ew,this._type;case"ci":return this._type=bw.ci,this._type;case"Matrix":return this._type=bw.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Ew.None&&this._systemSource!==Qw.None}get systemSource(){return this._systemSource}set systemSource(g){if(this._systemSource=g,g!==Qw.None){switch(this._contextualSource=Ew.None,this._type=bw.Float,g){case Qw.Time:case Qw.Delta:this._type=bw.Float;break;case Qw.Emitter:this._type=bw.ew}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Ew.None}get contextualValue(){return this._contextualSource}set contextualValue(g){if(this._contextualSource=g,g!==Ew.None){switch(this._systemSource=Qw.None,g){case Ew.Scale:this._type=bw.Vector2;break;case Ew.Position:case Ew.Direction:case Ew.ScaledDirection:this._type=bw.ew;break;case Ew.Color:this._type=bw.ci;break;case Ew.Age:case Ew.Lifetime:case Ew.Angle:case Ew.AgeGradient:this._type=bw.Float;break;case Ew.SpriteCellEnd:case Ew.SpriteCellStart:case Ew.SpriteCellIndex:this._type=bw.Int}this.output&&(this.output.type=this._type)}}constructor(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bw.AutoDetect;super(g),this._type=bw.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new p.b,this._systemSource=Qw.None,this._contextualSource=Ew.None,this._type=w,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",w)}get value(){return this._storedValue}set value(g){this.type===bw.Float&&this.min!==this.max&&(g=Math.max(this.min,g),g=Math.min(this.max,g)),this._storedValue=g,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(g){this._valueCallback=g}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case bw.Int:case bw.Float:this.value=0;break;case bw.Vector2:this.value=R.Vector2.Zero();break;case bw.ew:this.value=R.ew.Zero();break;case bw.ci:this.value=new S.d(1,1,1,1);break;case bw.Matrix:this.value=R.Matrix.Identity()}}_build(g){super._build(g),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=g=>g.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=g=>g.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const g=super.serialize();return g.type=this.type,g.contextualValue=this.contextualValue,g.systemSource=this.systemSource,g.min=this.min,g.max=this.max,g.groupInInspector=this.groupInInspector,g.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.qi?(g.valueType="BABYLON."+this._storedValue.getClassName(),g.value=this._storedValue.qi()):(g.valueType="number",g.value=this._storedValue)),g}_deserialize(g){if(super._deserialize(g),this._type=g.type,this.contextualValue=g.contextualValue,this.systemSource=g.systemSource||Qw.None,this.min=g.min||0,this.max=g.max||0,this.groupInInspector=g.groupInInspector||"",void 0!==g.displayInInspector&&(this.displayInInspector=g.displayInInspector),g.valueType)if("number"===g.valueType)this._storedValue=g.value;else{const w=(0,i.e)(g.valueType);w&&(this._storedValue=w.Ri(g.value))}}}(0,i.g)("BABYLON.ParticleInputBlock",Iw);class kw extends uw{get url(){return this._url}set url(g){this._url!==g&&(this._cachedData=null,this._url=g,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(g){this._textureDataUrl!==g&&(this._cachedData=null,this._textureDataUrl=g,this._url="",this._sourceTexture=null)}set sourceTexture(g){this._sourceTexture!==g&&(this._cachedData=null,this._sourceTexture=g,this._url="",this._textureDataUrl="")}constructor(g){super(g),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",bw.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const g=this.texture._storedValue;return await new Promise(((w,q)=>{if(!g.isReady())return void g.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),w(this._cachedData)}catch(g){q(g)}}));const R=g.getSize();Mw.l.GetTextureDataAsync(g,R.width,R.height).then((q=>{this._cachedData={width:R.width,height:R.height,data:new Uint8ClampedArray(q)},g.dispose(),w(this._cachedData)})).catch(q)}))}_build(g){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new h.e(this._textureDataUrl,g.Aw):this.texture._storedValue=new h.e(this._url,g.Aw):this.texture._storedValue=null}serialize(){const g=super.serialize();return g.url=this.url,g.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(g.textureDataUrl=this.textureDataUrl),g}_deserialize(g){super._deserialize(g),this.url=g.url,this.serializedCachedData=!!g.serializedCachedData,g.textureDataUrl&&(this.textureDataUrl=g.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,i.g)("BABYLON.ParticleTextureSourceBlock",kw);class gq extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerInput("position",bw.ew),this.registerOutput("output",bw.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(g){const w=this.particle.getConnectedValue(g);if(this.output._storedValue=w,!this.position.isConnected)return;const q={process:q=>{g.particleContext=q,g.systemContext=w,q.position.T(this.position.getConnectedValue(g))},previousItem:null,nextItem:null};w._updateQueueStart?Qg(q,w._updateQueueStart):w._updateQueueStart=q}}(0,i.g)("BABYLON.UpdatePositionBlock",gq),function(g){g[g.Add=0]="Add",g[g.Subtract=1]="Subtract",g[g.Multiply=2]="Multiply",g[g.Divide=3]="Divide",g[g.Max=4]="Max",g[g.Min=5]="Min"}(Xw||(Xw={}));class wq extends uw{constructor(g){super(g),this.operation=Xw.Add,this.registerInput("left",bw.AutoDetect),this.registerInput("right",bw.AutoDetect),this.registerOutput("output",bw.BasedOnInput),this.output._typeConnectionSource=this.left;const w=[bw.Matrix,bw.Particle,bw.Texture,bw.System,bw.FloatGradient,bw.Color4Gradient,bw.Vector2Gradient,bw.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...w),this.right.excludedConnectionPointTypes.push(...w),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(g){let w;const q=this.left,o=this.right;if(!q.isConnected||!o.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const r=q.type===bw.Float||q.type===bw.Int,i=o.type===bw.Float||o.type===bw.Int,T=r&&i;switch(this.operation){case Xw.Add:w=T?g=>q.getConnectedValue(g)+o.getConnectedValue(g):r?g=>g.adapt(q,o.type).add(o.getConnectedValue(g)):g=>q.getConnectedValue(g).add(g.adapt(o,q.type));break;case Xw.Subtract:w=T?g=>q.getConnectedValue(g)-o.getConnectedValue(g):r?g=>g.adapt(q,o.type).yw(o.getConnectedValue(g)):g=>q.getConnectedValue(g).yw(g.adapt(o,q.type));break;case Xw.Multiply:w=T?g=>q.getConnectedValue(g)*o.getConnectedValue(g):r?g=>g.adapt(q,o.type).multiply(o.getConnectedValue(g)):g=>q.getConnectedValue(g).multiply(g.adapt(o,q.type));break;case Xw.Divide:w=T?g=>q.getConnectedValue(g)/o.getConnectedValue(g):r?g=>g.adapt(q,o.type).divide(o.getConnectedValue(g)):g=>q.getConnectedValue(g).divide(g.adapt(o,q.type));break;case Xw.Min:if(T)w=g=>Math.min(q.getConnectedValue(g),o.getConnectedValue(g));else{const[g,i]=r?[o,q]:[q,o];switch(g.type){case bw.Vector2:w=w=>R.Vector2.Minimize(g.getConnectedValue(w),w.adapt(i,g.type));break;case bw.ew:w=w=>R.ew.Minimize(g.getConnectedValue(w),w.adapt(i,g.type));break;case bw.ci:w=w=>{const q=g.getConnectedValue(w),{r:R,g:o,b:r,a:T}=w.adapt(i,g.type);return new S.d(Math.min(q.r,R),Math.min(q.g,o),Math.min(q.b,r),Math.min(q.a,T))}}}break;case Xw.Max:if(!T){const[g,i]=r?[o,q]:[q,o];switch(g.type){case bw.Vector2:w=w=>R.Vector2.Maximize(g.getConnectedValue(w),w.adapt(i,g.type));break;case bw.ew:w=w=>R.ew.Maximize(g.getConnectedValue(w),w.adapt(i,g.type));break;case bw.ci:w=w=>{const q=g.getConnectedValue(w),{r:R,g:o,b:r,a:T}=w.adapt(i,g.type);return new S.d(Math.max(q.r,R),Math.min(q.g,o),Math.min(q.b,r),Math.min(q.a,T))}}break}w=g=>Math.max(q.getConnectedValue(g),o.getConnectedValue(g))}this.output._storedFunction=g=>q.type===bw.Int?0|w(g):w(g)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===bw.Int||this.left.type===bw.Float&&this.right.type!==bw.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[g,w]of[[this.left,this.right],[this.right,this.left]])g.acceptedConnectionPointTypes=[bw.Int,bw.Float],w.isConnected&&(g.acceptedConnectionPointTypes.push(w.type),w.type!==bw.Int&&w.type!==bw.Float||g.acceptedConnectionPointTypes.push(bw.Vector2,bw.ew,bw.ci))}dispose(){super.dispose();for(const g of this._connectionObservers)g.remove();this._connectionObservers.length=0}serialize(){const g=super.serialize();return g.operation=this.operation,g}_deserialize(g){super._deserialize(g),this.operation=g.operation}}(0,M.e)([nw("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Xw.Add},{label:"Subtract",value:Xw.Subtract},{label:"Multiply",value:Xw.Multiply},{label:"Divide",value:Xw.Divide},{label:"Max",value:Xw.Max},{label:"Min",value:Xw.Min}]})],wq.prototype,"operation",void 0),(0,i.g)("BABYLON.ParticleMathBlock",wq);class qq extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerInput("direction1",bw.ew,!0,new R.ew(0,1,0)),this.registerInput("direction2",bw.ew,!0,new R.ew(0,1,0)),this.registerInput("minEmitBox",bw.ew,!0,new R.ew(-.5,-.5,-.5)),this.registerInput("maxEmitBox",bw.ew,!0,new R.ew(.5,.5,.5)),this.registerOutput("output",bw.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(g){const w=this.particle.getConnectedValue(g);w._directionCreation.process=q=>{g.particleContext=q,g.systemContext=w;const o=this.direction1.getConnectedValue(g),r=this.direction2.getConnectedValue(g),S=(0,z.RandomRange)(o.x,r.x),i=(0,z.RandomRange)(o.y,r.y),T=(0,z.RandomRange)(o.z,r.z);g.isEmitterTransformNode?R.ew.TransformNormalFromFloatsToRef(S,i,T,g.emitterWorldMatrix,q.direction):q.direction.mi(S,i,T)},w._positionCreation.process=q=>{g.particleContext=q,g.systemContext=w;const o=this.minEmitBox.getConnectedValue(g),r=this.maxEmitBox.getConnectedValue(g),S=(0,z.RandomRange)(o.x,r.x),i=(0,z.RandomRange)(o.y,r.y),T=(0,z.RandomRange)(o.z,r.z);g.isEmitterTransformNode?R.ew.TransformCoordinatesFromFloatsToRef(S,i,T,g.emitterWorldMatrix,q.position):(q.position.mi(S,i,T),q.position.addInPlace(g.emitterPosition))},this.output._storedValue=w}}(0,i.g)("BABYLON.BoxShapeBlock",qq);class Rq extends uw{constructor(g){super(g),this.registerInput("emitPower",bw.Float,!0,1),this.registerInput("lifeTime",bw.Float,!0,1),this.registerInput("color",bw.ci,!0,new S.d(1,1,1,1)),this.registerInput("scale",bw.Vector2,!0,new R.Vector2(1,1)),this.registerInput("angle",bw.Float,!0,0),this.registerOutput("particle",bw.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(g){const w=new iw(this.name,g.Di,g.Aw,null,!1,void 0,!0);w.particleEmitterType=new J,w._lifeTimeCreation.process=(w,q)=>{g.particleContext=w,w.lifeTime=this.lifeTime.getConnectedValue(g),q._emitPower=this.emitPower.getConnectedValue(g)},w._colorCreation.process=w=>{g.particleContext=w,w.color.T(this.color.getConnectedValue(g))},w._sizeCreation.process=w=>{g.particleContext=w,w.size=1,w.scale.T(this.scale.getConnectedValue(g))},w._angleCreation.process=w=>{g.particleContext=w,w.angle=this.angle.getConnectedValue(g)},this.particle._storedValue=w}}(0,i.g)("BABYLON.CreateParticleBlock",Rq);class oq{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const g=[];for(const w of this.attachedBlocks)w.isInput&&g.push(w);return g}constructor(g){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new p.b,this.name=g}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(g){let w=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(g)&&this.attachedBlocks.push(g);for(const q of g.inputs){const R=q.connectedPoint;if(R){const q=R.ownerBlock;q!==g&&this._initializeBlock(q,w)}}}async buildAsync(g){let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((q=>{const R=new Nw;for(const g of this._systemBlocks)this._initializeBlock(g);for(const o of this.systemBlocks){const q=new Ww;q.buildId=this._buildId++,q.Aw=g,q.verbose=w;const r=o.createSystem(q);q.emitErrors(),R.systems.push(r)}this.onBuildObservable.notifyObservers(this),q(R)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const g=new Zw("Particle system"),w=new gq("Update position");w.output.connectTo(g.particle);const q=new Iw("Position");q.contextualValue=Ew.Position;const R=new Iw("Scaled direction");R.contextualValue=Ew.ScaledDirection;const o=new wq("Add");o.operation=Xw.Add,q.output.connectTo(o.left),R.output.connectTo(o.right),o.output.connectTo(w.position);const r=new Rq("Create particle"),S=new qq("Box shape");r.particle.connectTo(S.particle),S.output.connectTo(w.particle);const i=new kw("Texture");i.texture.connectTo(g.texture),i.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(g)}removeBlock(g){const w=this.attachedBlocks.indexOf(g);if(w>-1&&this.attachedBlocks.splice(w,1),g.isSystem){const w=this._systemBlocks.indexOf(g);w>-1&&this._systemBlocks.splice(w,1)}}parseSerializedObject(g){let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w||this.clear();const q={};for(const R of g.ot){const g=(0,i.e)(R.customType);if(g){const w=new g;w._deserialize(R),q[R.id]=w,this.attachedBlocks.push(w),w.isSystem&&this._systemBlocks.push(w)}}for(const R of this.attachedBlocks)if(R.isTeleportOut){const g=R,w=g._tempEntryPointUniqueId;if(w){const R=q[w];R&&R.attachToEndpoint(g)}}for(let R=0;R<g.ot.length;R++){const o=g.ot[R],r=q[o.id];r&&(r.inputs.length&&o.inputs.some((g=>g.targetConnectionName))&&!w||this._restoreConnections(r,g,q))}if(g.locations||g.editorData&&g.editorData.locations){const R=g.locations||g.editorData.locations;for(const g of R)q[g.Po]&&(g.Po=q[g.Po].uniqueId);w&&this.editorData&&this.editorData.locations&&R.concat(this.editorData.locations),g.locations?this.editorData={locations:R}:(this.editorData=g.editorData,this.editorData.locations=R);const o=[];for(const g in q)o[g]=q[g].uniqueId;this.editorData.map=o}this.comment=g.comment}_restoreConnections(g,w,q){for(const R of g.outputs)for(const o of w.ot){const r=q[o.id];if(r)for(const S of o.inputs)if(q[S.targetBlockId]!==g||S.targetConnectionName!==R.name);else{const g=r.getInputByName(S.inputName);if(!g||g.isConnected)continue;R.connectTo(g,!0),this._restoreConnections(r,w,q)}}}serialize(g){const w=g?{}:s.c.Serialize(this);w.editorData=JSON.parse(JSON.stringify(this.editorData));let q=[];g?q=g:w.customType="BABYLON.NodeParticleSystemSet",w.ot=[];for(const R of q)w.ot.push(R.serialize());if(!g)for(const R of this.attachedBlocks)-1===q.indexOf(R)&&w.ot.push(R.serialize());return w}dispose(){for(const g of this.attachedBlocks)g.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(g){const w=new oq(g);return w.setToDefault(),w}static Parse(g){const w=s.c.Parse((()=>new oq(g.name)),g,null);return w.parseSerializedObject(g),w}static ParseFromSnippetAsync(g,w){return"_BLANK"===g?Promise.resolve(oq.CreateDefault("blank")):new Promise(((q,R)=>{const o=new aw.e;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const S=JSON.parse(JSON.parse(o.responseText).jsonPayload),i=JSON.parse(S.nodeParticle);w||(w=s.c.Parse((()=>new oq(g)),i,null)),w.parseSerializedObject(i),w.snippetId=g;try{q(w)}catch(r){R(r)}}else R("Unable to load the snippet "+g)})),o.open("GET",this.SnippetUrl+"/"+g.replace(/#/g,"/")),o.send()}))}}oq.EditorURL=`${dw.Tools._DefaultCdnUrl}/v${ng.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,oq.SnippetUrl="https://snippet.babylonjs.com",(0,M.e)([(0,V.K)()],oq.prototype,"name",void 0),(0,M.e)([(0,V.K)("comment")],oq.prototype,"comment",void 0),function(g){g[g.None=0]="None",g[g.PerParticle=1]="PerParticle",g[g.PerSystem=2]="PerSystem"}(Kw||(Kw={}));class rq extends uw{constructor(g){super(g),this._currentLockId=-2,this.lockMode=Kw.PerParticle,this.registerInput("min",bw.AutoDetect,!0,0),this.registerInput("max",bw.AutoDetect,!0,1),this.registerOutput("output",bw.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bw.Float|bw.Int|bw.Vector2|bw.ew|bw.ci),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(bw.Float|bw.Int|bw.Vector2|bw.ew|bw.ci),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=bw.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let g=null;switch(this._currentLockId=-2,this.min.type){case bw.AutoDetect:case bw.Int:case bw.Float:g=g=>{const w=this.min.getConnectedValue(g)||0,q=this.max.getConnectedValue(g)||1;return w+Math.random()*(q-w)};break;case bw.Vector2:g=g=>{const w=this.min.getConnectedValue(g)||R.Vector2.Zero(),q=this.max.getConnectedValue(g)||R.Vector2.One();return new R.Vector2(w.x+Math.random()*(q.x-w.x),w.y+Math.random()*(q.y-w.y))};break;case bw.ew:g=g=>{const w=this.min.getConnectedValue(g)||R.ew.Zero(),q=this.max.getConnectedValue(g)||R.ew.One();return new R.ew(w.x+Math.random()*(q.x-w.x),w.y+Math.random()*(q.y-w.y),w.z+Math.random()*(q.z-w.z))};break;case bw.ci:g=g=>{const w=this.min.getConnectedValue(g)||new S.d(0,0,0,0),q=this.max.getConnectedValue(g)||new S.d(1,1,1,1);return new S.d(w.x+Math.random()*(q.x-w.x),w.y+Math.random()*(q.y-w.y),w.z+Math.random()*(q.z-w.z),w.w+Math.random()*(q.w-w.w))}}this.output._storedFunction=w=>{var q;let R=0;switch(this.lockMode){case Kw.PerParticle:R=(null===(q=w.particleContext)||void 0===q?void 0:q.id)||-1;break;case Kw.PerSystem:R=w.buildId||0}return this._currentLockId!==R&&(this.lockMode!==Kw.None&&(this._currentLockId=R),this.output._storedValue=g(w)),this.output._storedValue}}serialize(){const g=super.serialize();return g.lockMode=this.lockMode,g}_deserialize(g){super._deserialize(g),this.lockMode=g.lockMode}}(0,M.e)([nw("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Kw.None},{label:"Per particle",value:Kw.PerParticle},{label:"Per system",value:Kw.PerSystem}]})],rq.prototype,"lockMode",void 0),(0,i.g)("BABYLON.ParticleRandomBlock",rq);class Sq extends uw{constructor(g){super(g),this._currentLockId=-2,this.lockMode=Kw.PerParticle,this.registerInput("min",bw.AutoDetect),this.registerInput("max",bw.AutoDetect),this.registerOutput("output",bw.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const w=[bw.Matrix,bw.Particle,bw.Texture,bw.System,bw.FloatGradient,bw.Color4Gradient,bw.Vector2Gradient,bw.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...w),this.max.excludedConnectionPointTypes.push(...w)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let g=null;switch(this._currentLockId=-2,this.min.type){case bw.Float:case bw.Int:g=g=>{const w=this.min.getConnectedValue(g),q=this.max.getConnectedValue(g);return Math.random()*(q-w)+w};break;case bw.Vector2:g=g=>{const w=this.min.getConnectedValue(g),q=this.max.getConnectedValue(g);return new R.Vector2(Math.random()*(q.x-w.x)+w.x,Math.random()*(q.y-w.y)+w.y)};break;case bw.ew:g=g=>{const w=this.min.getConnectedValue(g),q=this.max.getConnectedValue(g);return new R.ew(Math.random()*(q.x-w.x)+w.x,Math.random()*(q.y-w.y)+w.y,Math.random()*(q.z-w.z)+w.z)};break;case bw.ci:g=g=>{const w=this.min.getConnectedValue(g),q=this.max.getConnectedValue(g);return new S.d(Math.random()*(q.r-w.r)+w.r,Math.random()*(q.g-w.g)+w.g,Math.random()*(q.b-w.b)+w.b,Math.random()*(q.a-w.a)+w.a)}}this.output._storedFunction=w=>{var q;let R=0;switch(this.lockMode){case Kw.PerParticle:R=(null===(q=w.particleContext)||void 0===q?void 0:q.id)||-1;break;case Kw.PerSystem:R=w.buildId||0}return this._currentLockId!==R&&(this.lockMode!==Kw.None&&(this._currentLockId=R),this.output._storedValue=g(w)),this.output._storedValue}}serialize(){const g=super.serialize();return g.lockMode=this.lockMode,g}_deserialize(g){super._deserialize(g),void 0!==g.lockMode&&(this.lockMode=g.lockMode)}}(0,M.e)([nw("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Kw.None},{label:"Per particle",value:Kw.PerParticle},{label:"Per system",value:Kw.PerSystem}]})],Sq.prototype,"lockMode",void 0),(0,i.g)("BABYLON.RandomRangeBlock",Sq);(0,i.g)("BABYLON.ParticleLerpBlock",class extends uw{constructor(g){super(g),this.registerInput("left",bw.AutoDetect),this.registerInput("right",bw.AutoDetect),this.registerInput("gradient",bw.Float,!0,0,0,1),this.registerOutput("output",bw.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bw.Float|bw.Int|bw.Vector2|bw.ew|bw.ci)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const g=(g,w,q)=>(1-g)*w+g*q;this.output._storedFunction=w=>{const q=this.left.getConnectedValue(w),o=this.right.getConnectedValue(w),r=this.gradient.getConnectedValue(w);switch(this.left.type){case bw.Int:case bw.Float:return g(r,q,o);case bw.Vector2:return new R.Vector2(g(r,q.x,o.x),g(r,q.y,o.y));case bw.ew:return new R.ew(g(r,q.x,o.x),g(r,q.y,o.y),g(r,q.z,o.z));case bw.ci:return new S.d(g(r,q.r,o.r),g(r,q.g,o.g),g(r,q.b,o.b),g(r,q.a,o.a))}return 0}}});(0,i.g)("BABYLON.UpdateDirectionBlock",class extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerInput("direction",bw.ew),this.registerOutput("output",bw.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(g){const w=this.particle.getConnectedValue(g);if(this.output._storedValue=w,!this.direction.isConnected)return;const q={process:q=>{g.particleContext=q,g.systemContext=w,q.direction.T(this.direction.getConnectedValue(g))},previousItem:null,nextItem:null};w._updateQueueStart?Qg(q,w._updateQueueStart):w._updateQueueStart=q}});(0,i.g)("BABYLON.UpdateColorBlock",class extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerInput("color",bw.ci),this.registerOutput("output",bw.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(g){const w=this.particle.getConnectedValue(g);if(this.output._storedValue=w,!this.color.isConnected)return;const q={process:q=>{g.particleContext=q,g.systemContext=w,q.color.T(this.color.getConnectedValue(g))},previousItem:null,nextItem:null};w._updateQueueStart?Qg(q,w._updateQueueStart):w._updateQueueStart=q}});(0,i.g)("BABYLON.UpdateScaleBlock",class extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerInput("scale",bw.Vector2),this.registerOutput("output",bw.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(g){const w=this.particle.getConnectedValue(g);if(this.output._storedValue=w,!this.scale.isConnected)return;const q={process:q=>{g.particleContext=q,g.systemContext=w,q.scale.T(this.scale.getConnectedValue(g))},previousItem:null,nextItem:null};w._updateQueueStart?Qg(q,w._updateQueueStart):w._updateQueueStart=q}});(0,i.g)("BABYLON.UpdateAngleBlock",class extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerInput("angle",bw.Float),this.registerOutput("output",bw.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(g){const w=this.particle.getConnectedValue(g);if(this.output._storedValue=w,!this.angle.isConnected)return;const q={process:q=>{g.particleContext=q,g.systemContext=w,q.angle=this.angle.getConnectedValue(g)},previousItem:null,nextItem:null};w._updateQueueStart?Qg(q,w._updateQueueStart):w._updateQueueStart=q}});(0,i.g)("BABYLON.BasicPositionUpdateBlock",class extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerOutput("output",bw.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(g){const w=this.particle.getConnectedValue(g),q={process:q=>{g.particleContext=q,g.systemContext=w,q.direction.scaleToRef(w._directionScale,w._scaledDirection),q.position.addInPlace(w._scaledDirection)},previousItem:null,nextItem:null};w._updateQueueStart?Qg(q,w._updateQueueStart):w._updateQueueStart=q,this.output._storedValue=w}});(0,i.g)("BABYLON.BasicSpriteUpdateBlock",class extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerOutput("output",bw.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(g){const w=this.particle.getConnectedValue(g),q={process:q=>{g.particleContext=q,g.systemContext=w,q.updateCellIndex()},previousItem:null,nextItem:null};w._updateQueueStart?Qg(q,w._updateQueueStart):w._updateQueueStart=q,this.output._storedValue=w}});(0,i.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerInput("cellIndex",bw.Int),this.registerOutput("output",bw.Particle),this.cellIndex.acceptedConnectionPointTypes=[bw.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(g){const w=this.particle.getConnectedValue(g);if(this.output._storedValue=w,!this.cellIndex.isConnected)return;const q={process:q=>{g.particleContext=q,g.systemContext=w,q.cellIndex=Math.floor(this.cellIndex.getConnectedValue(g))},previousItem:null,nextItem:null};w._updateQueueStart?Qg(q,w._updateQueueStart):w._updateQueueStart=q}});class iq extends uw{constructor(g){super(g),this.strength=1,this.registerInput("particle",bw.Particle),this.registerInput("flowMap",bw.Texture),this.registerOutput("output",bw.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(g){var w;const q=this.particle.getConnectedValue(g),R=g.Aw;let o;(null===(w=this.flowMap.connectedPoint)||void 0===w?void 0:w.ownerBlock).extractTextureContentAsync().then((g=>{g&&(o=new vw(g.width,g.height,g.data))}));const r={process:g=>{const w=R.getTransformMatrix();o&&o._processParticle(g,this.strength*q._tempScaledUpdateSpeed,w)},previousItem:null,nextItem:null};q._updateQueueStart?Qg(r,q._updateQueueStart):q._updateQueueStart=r,this.output._storedValue=q}serialize(){const g=super.serialize();return g.strength=this.strength,g}_deserialize(g){super._deserialize(g),this.strength=g.strength}}(0,M.e)([nw("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],iq.prototype,"strength",void 0),(0,i.g)("BABYLON.UpdateFlowMapBlock",iq);(0,i.g)("BABYLON.SphereShapeBlock",class extends uw{constructor(g){super(g),this.registerInput("input",bw.Particle),this.registerInput("radius",bw.Float,!0,1),this.registerInput("radiusRange",bw.Float,!0,1,0,1),this.registerInput("directionRandomizer",bw.Float,!0,0,0,1),this.registerOutput("output",bw.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(g){const w=this.input.getConnectedValue(g);w._directionCreation.process=q=>{g.particleContext=q,g.systemContext=w;const o=this.directionRandomizer.getConnectedValue(g),r=q.position.yw(g.emitterPosition).normalize(),S=(0,z.RandomRange)(0,o),i=(0,z.RandomRange)(0,o),T=(0,z.RandomRange)(0,o);r.x+=S,r.y+=i,r.z+=T,r.normalize(),g.isEmitterTransformNode?R.ew.TransformNormalFromFloatsToRef(S,i,T,g.emitterWorldMatrix,q.direction):q.direction.mi(S,i,T)},w._positionCreation.process=q=>{g.particleContext=q,g.systemContext=w;const o=this.radius.getConnectedValue(g),r=this.radiusRange.getConnectedValue(g),S=o-(0,z.RandomRange)(0,o*r),i=(0,z.RandomRange)(0,1),T=(0,z.RandomRange)(0,2*Math.PI),t=Math.acos(2*i-1),m=S*Math.cos(T)*Math.sin(t),e=S*Math.cos(t),y=S*Math.sin(T)*Math.sin(t);g.isEmitterTransformNode?R.ew.TransformCoordinatesFromFloatsToRef(m,e,y,g.emitterWorldMatrix,q.position):(q.position.mi(m,e,y),q.position.addInPlace(g.emitterPosition))},this.output._storedValue=w}});(0,i.g)("BABYLON.PointShapeBlock",class extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerInput("direction1",bw.ew,!0,new R.ew(0,1,0)),this.registerInput("direction2",bw.ew,!0,new R.ew(0,1,0)),this.registerOutput("output",bw.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(g){const w=this.particle.getConnectedValue(g);w._directionCreation.process=q=>{g.particleContext=q,g.systemContext=w;const o=this.direction1.getConnectedValue(g),r=this.direction2.getConnectedValue(g),S=(0,z.RandomRange)(o.x,r.x),i=(0,z.RandomRange)(o.y,r.y),T=(0,z.RandomRange)(o.z,r.z);g.isEmitterTransformNode?R.ew.TransformNormalFromFloatsToRef(S,i,T,g.emitterWorldMatrix,q.direction):q.direction.mi(S,i,T)},w._positionCreation.process=q=>{g.systemContext=w,g.isEmitterTransformNode?R.ew.TransformCoordinatesFromFloatsToRef(0,0,0,g.emitterWorldMatrix,q.position):q.position.T(g.emitterPosition)},this.output._storedValue=w}});(0,i.g)("BABYLON.CustomShapeBlock",class extends uw{constructor(g){super(g),this.registerInput("particle",bw.Particle),this.registerInput("position",bw.ew,!0,new R.ew(0,0,0)),this.registerInput("direction",bw.ew,!0,new R.ew(0,1,0)),this.registerOutput("output",bw.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(g){const w=this.particle.getConnectedValue(g);w._directionCreation.process=q=>{g.particleContext=q,g.systemContext=w;const o=this.direction.getConnectedValue(g);g.isEmitterTransformNode?R.ew.TransformNormalToRef(o,g.emitterWorldMatrix,q.direction):q.direction.T(o)},w._positionCreation.process=q=>{g.particleContext=q,g.systemContext=w;const o=this.position.getConnectedValue(g);g.isEmitterTransformNode?R.ew.TransformCoordinatesToRef(o,g.emitterWorldMatrix,q.position):(q.position.T(o),q.position.addInPlace(g.emitterPosition))},this.output._storedValue=w}});(0,i.g)("BABYLON.CylinderShapeBlock",class extends uw{constructor(g){super(g),this._tempVector=R.ew.Zero(),this.registerInput("particle",bw.Particle),this.registerInput("radius",bw.Float,!0,1),this.registerInput("height",bw.Float,!0,1,0),this.registerInput("radiusRange",bw.Float,!0,1,0,1),this.registerInput("directionRandomizer",bw.Float,!0,0,0,1),this.registerOutput("output",bw.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(g){const w=this.particle.getConnectedValue(g);w._directionCreation.process=q=>{g.particleContext=q,g.systemContext=w;const o=this.directionRandomizer.getConnectedValue(g);q.position.subtractToRef(g.emitterPosition,this._tempVector),this._tempVector.normalize(),g.isEmitterTransformNode&&R.ew.TransformNormalToRef(this._tempVector,g.emitterInverseWorldMatrix,this._tempVector);const r=(0,z.RandomRange)(-o/2,o/2);let S=Math.atan2(this._tempVector.x,this._tempVector.z);S+=(0,z.RandomRange)(-Math.PI/2,Math.PI/2)*o,this._tempVector.y=r,this._tempVector.x=Math.sin(S),this._tempVector.z=Math.cos(S),this._tempVector.normalize(),g.isEmitterTransformNode?R.ew.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,g.emitterWorldMatrix,q.direction):q.direction.T(this._tempVector)},w._positionCreation.process=q=>{g.particleContext=q,g.systemContext=w;const o=this.height.getConnectedValue(g),r=this.radiusRange.getConnectedValue(g),S=this.radius.getConnectedValue(g),i=(0,z.RandomRange)(-o/2,o/2),T=(0,z.RandomRange)(0,2*Math.PI),t=(0,z.RandomRange)((1-r)*(1-r),1),m=Math.sqrt(t)*S,e=m*Math.cos(T),y=m*Math.sin(T);g.isEmitterTransformNode?R.ew.TransformCoordinatesFromFloatsToRef(e,i,y,g.emitterWorldMatrix,q.position):(q.position.mi(e,i,y),q.position.addInPlace(g.emitterPosition))},this.output._storedValue=w}});class Tq extends uw{constructor(g){super(g),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",bw.Particle),this.registerOutput("output",bw.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(g){super._build(g);const w=this.particle.getConnectedValue(g);w._isAnimationSheetEnabled=!0,w.spriteCellWidth=this.width,w.spriteCellHeight=this.height,w.startSpriteCellID=this.start,w.endSpriteCellID=this.end,w.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=w}serialize(){const g=super.serialize();return g.width=this.width,g.height=this.height,g.start=this.start,g.end=this.end,g.randomStartCell=this.randomStartCell,g}_deserialize(g){super._deserialize(g),this.width=g.width,this.height=g.height,this.start=g.start,this.end=g.end,this.randomStartCell=g.randomStartCell}}(0,M.e)([nw("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tq.prototype,"start",void 0),(0,M.e)([nw("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tq.prototype,"end",void 0),(0,M.e)([nw("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tq.prototype,"width",void 0),(0,M.e)([nw("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tq.prototype,"height",void 0),(0,M.e)([nw("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Tq.prototype,"loop",void 0),(0,M.e)([nw("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Tq.prototype,"randomStartCell",void 0),(0,i.g)("BABYLON.SetupSpriteSheetBlock",Tq);class zq extends uw{constructor(g){super(g),this.reference=0,this.registerInput("value",bw.AutoDetect),this.registerOutput("output",bw.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=g=>{switch(g){case bw.Float:return bw.FloatGradient;case bw.Vector2:return bw.Vector2Gradient;case bw.ew:return bw.Vector3Gradient;case bw.ci:return bw.Color4Gradient}return g},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bw.Float|bw.Vector2|bw.ew|bw.ci)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=g=>null}serialize(){const g=super.serialize();return g.reference=this.reference,g}_deserialize(g){super._deserialize(g),this.reference=g.reference}}(0,M.e)([nw("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],zq.prototype,"reference",void 0),(0,i.g)("BABYLON.ParticleGradientValueBlock",zq);(0,i.g)("BABYLON.ParticleGradientBlock",class extends uw{constructor(g){super(g),this._entryCount=1,this.registerInput("gradient",bw.Float,!0,1,0,1),this.registerInput("value0",bw.AutoDetect),this.registerOutput("output",bw.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=g=>{switch(g){case bw.FloatGradient:return bw.Float;case bw.Vector2Gradient:return bw.Vector2;case bw.Vector3Gradient:return bw.ew;case bw.Color4Gradient:return bw.ci}return g},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(bw.FloatGradient|bw.Vector2Gradient|bw.Vector3Gradient|bw.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(g){this._inputs[g].onConnectionObservable.add((()=>{this._entryCount>g||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),bw.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const g=[];for(let q=1;q<this._inputs.length;q++){var w;if(this._inputs[q].isConnected)g.push(null===(w=this._inputs[q].connectedPoint)||void 0===w?void 0:w.ownerBlock)}g.sort(((g,w)=>g.reference-w.reference)),this.output._storedFunction=w=>{const q=this.gradient.getConnectedValue(w);if(1===g.length)return g[0].value.getConnectedValue(w);let o=null;for(let r=g.length-1;r>=0;r--){const i=g[r];if(i.reference<=q){const g=i.value.getConnectedValue(w);if(o){const r=o.value.getConnectedValue(w),T=o.reference,t=i.reference,m=Math.max(0,Math.min(1,(q-t)/(T-t)));switch(this.output.type){case bw.Float:return(0,z.Lerp)(g,r,m);case bw.Vector2:return R.Vector2.Lerp(g,r,m);case bw.ew:return R.ew.Lerp(g,r,m);case bw.ci:return S.d.Lerp(g,r,m)}}return g}o=i}return 0}}});(0,i.g)("BABYLON.ParticleConverterBlock",class extends uw{constructor(g){super(g),this.registerInput("color ",bw.ci,!0),this.registerInput("xyz ",bw.ew,!0),this.registerInput("xy ",bw.Vector2,!0),this.registerInput("zw ",bw.Vector2,!0),this.registerInput("x ",bw.Float,!0),this.registerInput("y ",bw.Float,!0),this.registerInput("z ",bw.Float,!0),this.registerInput("w ",bw.Float,!0),this.registerOutput("color",bw.ci),this.registerOutput("xyz",bw.ew),this.registerOutput("xy",bw.Vector2),this.registerOutput("zw",bw.Vector2),this.registerOutput("x",bw.Float),this.registerOutput("y",bw.Float),this.registerOutput("z",bw.Float),this.registerOutput("w",bw.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(g){return"color "===g?"colorIn":"xyz "===g?"xyzIn":"xy "===g?"xyIn":"zw "===g?"zwIn":"x "===g?"xIn":"y "===g?"yIn":"z "===g?"zIn":"w "===g?"wIn":g}_outputRename(g){switch(g){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return g}}_build(g){super._build(g);const w=this.xIn,q=this.yIn,o=this.zIn,r=this.wIn,i=this.xyIn,T=this.zwIn,z=this.xyzIn,t=this.colorIn,m=this.colorOut,e=this.xyzOut,y=this.xyOut,L=this.zwOut,A=this.xOut,l=this.yOut,J=this.zOut,x=this.wOut,G=g=>{if(t.isConnected)return t.getConnectedValue(g);let R=0,m=0,e=0,y=0;if(w.isConnected&&(R=w.getConnectedValue(g)),q.isConnected&&(m=q.getConnectedValue(g)),o.isConnected&&(e=o.getConnectedValue(g)),r.isConnected&&(y=r.getConnectedValue(g)),i.isConnected){const w=i.getConnectedValue(g);w&&(R=w.x,m=w.y)}if(T.isConnected){const w=T.getConnectedValue(g);w&&(e=w.x,y=w.y)}if(z.isConnected){const w=z.getConnectedValue(g);w&&(R=w.x,m=w.y,e=w.z)}return new S.d(R,m,e,y)};m._storedFunction=g=>G(g),e._storedFunction=g=>{const w=G(g);return new R.ew(w.r,w.g,w.b)},y._storedFunction=g=>{const w=G(g);return new R.Vector2(w.r,w.g)},L._storedFunction=g=>{const w=G(g);return new R.Vector2(w.b,w.a)},A._storedFunction=g=>G(g).r,l._storedFunction=g=>G(g).g,J._storedFunction=g=>G(g).b,x._storedFunction=g=>G(g).a}}),function(g){g[g.Cos=0]="Cos",g[g.Sin=1]="Sin",g[g.Abs=2]="Abs",g[g.Exp=3]="Exp",g[g.Exp2=4]="Exp2",g[g.Round=5]="Round",g[g.Floor=6]="Floor",g[g.Ceiling=7]="Ceiling",g[g.Sqrt=8]="Sqrt",g[g.Log=9]="Log",g[g.Tan=10]="Tan",g[g.ArcTan=11]="ArcTan",g[g.ArcCos=12]="ArcCos",g[g.ArcSin=13]="ArcSin",g[g.Sign=14]="Sign",g[g.Negate=15]="Negate",g[g.OneMinus=16]="OneMinus",g[g.Reciprocal=17]="Reciprocal",g[g.ToDegrees=18]="ToDegrees",g[g.ToRadians=19]="ToRadians",g[g.Fract=20]="Fract"}(Yw||(Yw={}));class tq extends uw{constructor(g){super(g),this.operation=Yw.Cos,this.registerInput("input",bw.AutoDetect),this.registerOutput("output",bw.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(bw.Float|bw.Int|bw.Vector2|bw.ew|bw.ci)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(g){super._build(g);let w=null;switch(this.operation){case Yw.Cos:w=g=>Math.cos(g);break;case Yw.Sin:w=g=>Math.sin(g);break;case Yw.Abs:w=g=>Math.abs(g);break;case Yw.Exp:w=g=>Math.exp(g);break;case Yw.Exp2:w=g=>Math.pow(2,g);break;case Yw.Round:w=g=>Math.round(g);break;case Yw.Floor:w=g=>Math.floor(g);break;case Yw.Ceiling:w=g=>Math.ceil(g);break;case Yw.Sqrt:w=g=>Math.sqrt(g);break;case Yw.Log:w=g=>Math.log(g);break;case Yw.Tan:w=g=>Math.tan(g);break;case Yw.ArcTan:w=g=>Math.atan(g);break;case Yw.ArcCos:w=g=>Math.acos(g);break;case Yw.ArcSin:w=g=>Math.asin(g);break;case Yw.Sign:w=g=>Math.sign(g);break;case Yw.Negate:w=g=>-g;break;case Yw.OneMinus:w=g=>1-g;break;case Yw.Reciprocal:w=g=>1/g;break;case Yw.ToRadians:w=g=>g*Math.PI/180;break;case Yw.ToDegrees:w=g=>180*g/Math.PI;break;case Yw.Fract:w=g=>g>=0?g-Math.floor(g):g-Math.ceil(g)}if(!w)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case bw.Int:case bw.Float:this.output._storedFunction=g=>{const q=this.input.getConnectedValue(g);return w(q)};break;case bw.Vector2:this.output._storedFunction=g=>{const q=this.input.getConnectedValue(g);return new R.Vector2(w(q.x),w(q.y))};break;case bw.ew:this.output._storedFunction=g=>{const q=this.input.getConnectedValue(g);return new R.ew(w(q.x),w(q.y),w(q.z))};break;case bw.ci:this.output._storedFunction=g=>{const q=this.input.getConnectedValue(g);return new S.d(w(q.r),w(q.g),w(q.b),w(q.a))}}return this}serialize(){const g=super.serialize();return g.operation=this.operation,g}_deserialize(g){super._deserialize(g),this.operation=g.operation}}(0,M.e)([nw("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Yw.Cos},{label:"Sin",value:Yw.Sin},{label:"Abs",value:Yw.Abs},{label:"Exp",value:Yw.Exp},{label:"Exp2",value:Yw.Exp2},{label:"Round",value:Yw.Round},{label:"Floor",value:Yw.Floor},{label:"Ceiling",value:Yw.Ceiling},{label:"Sqrt",value:Yw.Sqrt},{label:"Log",value:Yw.Log},{label:"Tan",value:Yw.Tan},{label:"ArcTan",value:Yw.ArcTan},{label:"ArcCos",value:Yw.ArcCos},{label:"ArcSin",value:Yw.ArcSin},{label:"Sign",value:Yw.Sign},{label:"Negate",value:Yw.Negate},{label:"OneMinus",value:Yw.OneMinus},{label:"Reciprocal",value:Yw.Reciprocal},{label:"ToDegrees",value:Yw.ToDegrees},{label:"ToRadians",value:Yw.ToRadians},{label:"Fract",value:Yw.Fract}]})],tq.prototype,"operation",void 0),(0,i.g)("BABYLON.ParticleTrigonometryBlock",tq);var mq,eq=q(12514);class yq extends uw{constructor(g){super(g),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",bw.AutoDetect),this.registerOutput("output",bw.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(bw.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(bw.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(bw.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(bw.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(bw.System),this._inputs[0].excludedConnectionPointTypes.push(bw.Particle),this._inputs[0].excludedConnectionPointTypes.push(bw.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(g){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const w=g=>{const w=this.input.getConnectedValue(g);if(this.log.length>=this.stackSize)return w;if(null===w||void 0===w)return this.log.push(["null",""]),w;switch(this.input.type){case bw.Vector2:this.log.push([(0,eq.i)(w,4),w.toString()]);break;case bw.ew:this.log.push([(0,eq.m)(w,4),w.toString()]);break;case bw.ci:this.log.push([`{R: ${w.r.toFixed(4)} G: ${w.g.toFixed(4)} B: ${w.b.toFixed(4)} A: ${w.a.toFixed(4)}}`,w.toString()]);break;default:this.log.push([w.toString(),w.toString()])}return w};this.output.isConnected?this.output._storedFunction=w:this.output._storedValue=w(g)}serialize(){const g=super.serialize();return g.stackSize=this.stackSize,g}_deserialize(g){super._deserialize(g),this.stackSize=g.stackSize}}(0,M.e)([nw("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],yq.prototype,"stackSize",void 0),(0,i.g)("BABYLON.ParticleDebugBlock",yq);(0,i.g)("BABYLON.ParticleElbowBlock",class extends uw{constructor(g){super(g),this.registerInput("input",bw.AutoDetect),this.registerOutput("output",bw.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(g){super._build(g);const w=this._outputs[0],q=this._inputs[0];w._storedFunction=g=>q.getConnectedValue(g)}});(0,i.g)("BABYLON.ParticleTeleportInBlock",class extends uw{get endpoints(){return this._endpoints}constructor(g){super(g),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",bw.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(g){if(this.getClassName()===g)return!0;for(const w of this.endpoints)if(w.isAnAncestorOfType(g))return!0;return!1}isAnAncestorOf(g){for(const w of this.endpoints){if(w===g)return!0;if(w.isAnAncestorOf(g))return!0}return!1}attachToEndpoint(g){g.detach(),this._endpoints.push(g),g._entryPoint=this,g._outputs[0]._typeConnectionSource=this._inputs[0],g._tempEntryPointUniqueId=null,g.name="> "+this.name}detachFromEndpoint(g){const w=this._endpoints.indexOf(g);-1!==w&&(this._endpoints.splice(w,1),g._outputs[0]._typeConnectionSource=null,g._entryPoint=null)}_build(){for(const g of this._endpoints)g.output._storedFunction=g=>this.input.getConnectedValue(g)}});(0,i.g)("BABYLON.ParticleTeleportOutBlock",class extends uw{constructor(g){super(g),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",bw.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(g){this.entryPoint&&this.entryPoint.build(g)}clone(){const g=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(g),g}serialize(){var g;const w=super.serialize();return w.entryPoint=(null===(g=this.entryPoint)||void 0===g?void 0:g.uniqueId)??"",w}_deserialize(g){super._deserialize(g),this._tempEntryPointUniqueId=g.entryPoint}}),function(g){g[g.Equal=0]="Equal",g[g.NotEqual=1]="NotEqual",g[g.LessThan=2]="LessThan",g[g.GreaterThan=3]="GreaterThan",g[g.LessOrEqual=4]="LessOrEqual",g[g.GreaterOrEqual=5]="GreaterOrEqual",g[g.Xor=6]="Xor",g[g.Or=7]="Or",g[g.And=8]="And"}(mq||(mq={}));class Lq extends uw{constructor(g){super(g),this.test=mq.Equal,this.epsilon=0,this.registerInput("left",bw.Float),this.registerInput("right",bw.Float,!0,0),this.registerInput("ifTrue",bw.AutoDetect,!0,1),this.registerInput("ifFalse",bw.AutoDetect,!0,0),this.registerOutput("output",bw.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=bw.Float,this._inputs[0].acceptedConnectionPointTypes.push(bw.Int),this._inputs[1].acceptedConnectionPointTypes.push(bw.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const g=g=>{const w=this.left.getConnectedValue(g),q=this.right.getConnectedValue(g);let R=!1;switch(this.test){case mq.Equal:R=(0,z.WithinEpsilon)(w,q,this.epsilon);break;case mq.NotEqual:R=!(0,z.WithinEpsilon)(w,q,this.epsilon);break;case mq.LessThan:R=w<q+this.epsilon;break;case mq.GreaterThan:R=w>q-this.epsilon;break;case mq.LessOrEqual:R=w<=q+this.epsilon;break;case mq.GreaterOrEqual:R=w>=q-this.epsilon;break;case mq.Xor:R=!!w&&!q||!w&&!!q;break;case mq.Or:R=!!w||!!q;break;case mq.And:R=!!w&&!!q}return R};this.output._storedFunction=w=>g(w)?this.ifTrue.getConnectedValue(w):this.ifFalse.getConnectedValue(w)}serialize(){const g=super.serialize();return g.test=this.test,g.epsilon=this.epsilon,g}_deserialize(g){super._deserialize(g),this.test=g.test,void 0!==g.epsilon&&(this.epsilon=g.epsilon)}}(0,M.e)([nw("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:mq.Equal},{label:"NotEqual",value:mq.NotEqual},{label:"LessThan",value:mq.LessThan},{label:"GreaterThan",value:mq.GreaterThan},{label:"LessOrEqual",value:mq.LessOrEqual},{label:"GreaterOrEqual",value:mq.GreaterOrEqual},{label:"Xor",value:mq.Xor},{label:"Or",value:mq.Or},{label:"And",value:mq.And}]})],Lq.prototype,"test",void 0),(0,M.e)([nw("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Lq.prototype,"epsilon",void 0),(0,i.g)("BABYLON.ParticleConditionBlock",Lq);class Aq extends uw{constructor(g){super(g),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",bw.Particle),this.registerInput("condition",bw.Float,!0,0),this.registerInput("system",bw.System),this.registerOutput("output",bw.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(g){this._triggerCount=0;const w=this.input.getConnectedValue(g),q={process:q=>{if(g.particleContext=q,g.systemContext=w,0!==this.condition.getConnectedValue(g)&&(0===this.limit||this._triggerCount<this.limit)){const R=(new Date).getTime();if(this._previousOne&&R-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=R;const o=this.system.getConnectedValue(g);if(o){const R=pw(o,g.Aw,q.position);R.WS.addOnce((()=>{this._triggerCount--})),w.WS.addOnce((()=>{R.dispose()}))}}},previousItem:null,nextItem:null};w._updateQueueStart?Qg(q,w._updateQueueStart):w._updateQueueStart=q,this.output._storedValue=w}serialize(){const g=super.serialize();return g.limit=this.limit,g.delay=this.delay,g}_deserialize(g){super._deserialize(g),void 0!==g.limit&&(this.limit=g.limit),void 0!==g.delay&&(this.delay=g.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,M.e)([nw("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Aq.prototype,"limit",void 0),(0,M.e)([nw("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Aq.prototype,"delay",void 0),(0,i.g)("BABYLON.ParticleTriggerBlock",Aq);q(12518),q(12523),q(12533),q(12592)},12570:(g,w,q)=>{"use strict";var R=q(11081);const o="clipPlaneFragment",r="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12538:(g,w,q)=>{"use strict";var R=q(11081);const o="clipPlaneFragmentDeclaration",r="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12618:(g,w,q)=>{"use strict";var R=q(11081);const o="clipPlaneVertex",r="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12601:(g,w,q)=>{"use strict";var R=q(11081);const o="clipPlaneVertexDeclaration",r="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12588:(g,w,q)=>{"use strict";var R=q(11081);const o="fogFragment",r="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12564:(g,w,q)=>{"use strict";var R=q(11081);const o="fogFragmentDeclaration",r="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12624:(g,w,q)=>{"use strict";var R=q(11081);const o="fogVertex",r="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12610:(g,w,q)=>{"use strict";var R=q(11081);const o="fogVertexDeclaration",r="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12555:(g,w,q)=>{"use strict";var R=q(11081);const o="helperFunctions",r="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12545:(g,w,q)=>{"use strict";var R=q(11081);const o="imageProcessingDeclaration",r="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12558:(g,w,q)=>{"use strict";var R=q(11081);const o="imageProcessingFunctions",r="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12551:(g,w,q)=>{"use strict";var R=q(11081);const o="logDepthDeclaration",r="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12579:(g,w,q)=>{"use strict";var R=q(11081);const o="logDepthFragment",r="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12630:(g,w,q)=>{"use strict";var R=q(11081);const o="logDepthVertex",r="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";R.d.IncludesShadersStoreWGSL[o]||(R.d.IncludesShadersStoreWGSL[o]=r)},12533:(g,w,q)=>{"use strict";q.r(w),q.d(w,{particlesPixelShaderWGSL:()=>S});var R=q(11081);q(12538),q(12545),q(12551),q(12555),q(12558),q(12564),q(12570),q(12579),q(12588);const o="particlesPixelShader",r="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";R.d.ShadersStoreWGSL[o]||(R.d.ShadersStoreWGSL[o]=r);const S={name:o,shader:r}},12592:(g,w,q)=>{"use strict";q.r(w),q.d(w,{particlesVertexShaderWGSL:()=>S});var R=q(11081);q(12601),q(12610),q(12551),q(12618),q(12624),q(12630);const o="particlesVertexShader",r="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";R.d.ShadersStoreWGSL[o]||(R.d.ShadersStoreWGSL[o]=r);const S={name:o,shader:r}},12450:(g,w,q)=>{"use strict";var R=q(11081);const o="clipPlaneFragment",r="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12520:(g,w,q)=>{"use strict";var R=q(11081);const o="clipPlaneFragmentDeclaration",r="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12473:(g,w,q)=>{"use strict";var R=q(11081);const o="clipPlaneVertex",r="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12525:(g,w,q)=>{"use strict";var R=q(11081);const o="clipPlaneVertexDeclaration",r="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12466:(g,w,q)=>{"use strict";var R=q(11081);const o="fogFragment",r="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12444:(g,w,q)=>{"use strict";var R=q(11081);const o="fogFragmentDeclaration",r="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12482:(g,w,q)=>{"use strict";var R=q(11081);const o="fogVertex",r="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12468:(g,w,q)=>{"use strict";var R=q(11081);const o="fogVertexDeclaration",r="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12435:(g,w,q)=>{"use strict";var R=q(11081);const o="helperFunctions",r="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12418:(g,w,q)=>{"use strict";var R=q(11081);const o="imageProcessingDeclaration",r="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12440:(g,w,q)=>{"use strict";var R=q(11081);const o="imageProcessingFunctions",r="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12426:(g,w,q)=>{"use strict";var R=q(11081);const o="logDepthDeclaration",r="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12458:(g,w,q)=>{"use strict";var R=q(11081);const o="logDepthFragment",r="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12491:(g,w,q)=>{"use strict";var R=q(11081);const o="logDepthVertex",r="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";R.d.IncludesShadersStore[o]||(R.d.IncludesShadersStore[o]=r)},12518:(g,w,q)=>{"use strict";q.r(w),q.d(w,{particlesPixelShader:()=>S});var R=q(11081);q(12520),q(12418),q(12426),q(12435),q(12440),q(12444),q(12450),q(12458),q(12466);const o="particlesPixelShader",r="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";R.d.ShadersStore[o]||(R.d.ShadersStore[o]=r);const S={name:o,shader:r}},12523:(g,w,q)=>{"use strict";q.r(w),q.d(w,{particlesVertexShader:()=>S});var R=q(11081);q(12525),q(12468),q(12426),q(12473),q(12482),q(12491);const o="particlesVertexShader",r="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";R.d.ShadersStore[o]||(R.d.ShadersStore[o]=r);const S={name:o,shader:r}},12881:(g,w,q)=>{"use strict";q.r(w),q.d(w,{FlowGraphGLTFDataProvider:()=>r});var R=q(12863),o=q(12836);class r extends R.e{constructor(g){var w,q;super();const R=g.glTF,r=(null===(w=R.animations)||void 0===w?void 0:w.map((g=>g._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",o.d,r);const S=(null===(q=R.nodes)||void 0===q?void 0:q.map((g=>g._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",o.d,S)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12769:(g,w,q)=>{"use strict";q.d(w,{c:()=>l,d:()=>L,h:()=>y,k:()=>A});var R=q(11180),o=q(11617),r=q(11235),S=q(12774);const i=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class T{constructor(g,w){this._gltf=g,this._infoTree=w}convert(g){let w,q=this._gltf,R=this._infoTree;if(!g.startsWith("/"))throw new Error("Path must start with a /");const o=g.split("/");if(o.shift(),o[o.length-1].includes(".length")){const g=o[o.length-1].split(".");o.pop(),o.push(...g)}let r=!1;for(const T of o){const o="length"===T;if(o&&!R.__array__)throw new Error(`Path ${g} is invalid`);if(R.__ignoreObjectTree__&&(r=!0),R.__array__&&!o)R=R.__array__;else if(R=R[T],!R)throw new Error(`Path ${g} is invalid`);if(!r)if(void 0===q){if(!i.find((w=>w.regex.test(g))))throw new Error(`Path ${g} is invalid`)}else if(!o){var S;q=null===(S=q)||void 0===S?void 0:S[T]}(R.__target__||o)&&(w=q)}return{object:w,info:R}}}function z(g,w,q,R){const o=t(g,w);return R?o[q][R]:o[q]}function t(g,w,q){var R,r;return null===(R=g._data)||void 0===R||null===(r=R[(null===q||void 0===q?void 0:q.fillMode)??o.c.MATERIAL_TriangleFillMode])||void 0===r?void 0:r.babylonMaterial}function m(g,w){return{offset:{componentsCount:2,type:"Vector2",get:(q,o,r)=>{const S=z(q,r,g,w);return new R.Vector2(null===S||void 0===S?void 0:S.uOffset,null===S||void 0===S?void 0:S.vOffset)},getTarget:t,set:(q,R,o,r)=>{const S=z(R,r,g,w);S.uOffset=q.x,S.vOffset=q.y},getPropertyName:[()=>`${g}${w?"."+w:""}.uOffset`,()=>`${g}${w?"."+w:""}.vOffset`]},rotation:{type:"number",get:(q,R,o)=>{var r;return null===(r=z(q,o,g,w))||void 0===r?void 0:r.wAng},getTarget:t,set:(q,R,o,r)=>z(R,r,g,w).wAng=q,getPropertyName:[()=>`${g}${w?"."+w:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(q,o,r)=>{const S=z(q,r,g,w);return new R.Vector2(null===S||void 0===S?void 0:S.uScale,null===S||void 0===S?void 0:S.vScale)},getTarget:t,set:(q,R,o,r)=>{const S=z(R,r,g,w);S.uScale=q.x,S.vScale=q.y},getPropertyName:[()=>`${g}${w?"."+w:""}.uScale`,()=>`${g}${w?"."+w:""}.vScale`]}}}const e={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:g=>{var w,q;return new R.Vector2((null===(w=g._babylonCamera)||void 0===w?void 0:w.orthoLeft)??0,(null===(q=g._babylonCamera)||void 0===q?void 0:q.orthoRight)??0)},set:(g,w)=>{w._babylonCamera&&(w._babylonCamera.orthoLeft=g.x,w._babylonCamera.orthoRight=g.y)},getTarget:g=>g,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:g=>{var w,q;return new R.Vector2((null===(w=g._babylonCamera)||void 0===w?void 0:w.orthoBottom)??0,(null===(q=g._babylonCamera)||void 0===q?void 0:q.orthoTop)??0)},set:(g,w)=>{w._babylonCamera&&(w._babylonCamera.orthoBottom=g.x,w._babylonCamera.orthoTop=g.y)},getTarget:g=>g,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:g=>{var w;return null===(w=g._babylonCamera)||void 0===w?void 0:w.maxZ},set:(g,w)=>{w._babylonCamera&&(w._babylonCamera.maxZ=g)},getTarget:g=>g,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:g=>{var w;return null===(w=g._babylonCamera)||void 0===w?void 0:w.ri},set:(g,w)=>{w._babylonCamera&&(w._babylonCamera.ri=g)},getTarget:g=>g,getPropertyName:[()=>"ri"]}},perspective:{aspectRatio:{type:"number",get:g=>{var w;return null===(w=g._babylonCamera)||void 0===w?void 0:w.getEngine().getAspectRatio(g._babylonCamera)},getTarget:g=>g,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:g=>{var w;return null===(w=g._babylonCamera)||void 0===w?void 0:w.fov},set:(g,w)=>{w._babylonCamera&&(w._babylonCamera.fov=g)},getTarget:g=>g,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:g=>{var w;return null===(w=g._babylonCamera)||void 0===w?void 0:w.maxZ},set:(g,w)=>{w._babylonCamera&&(w._babylonCamera.maxZ=g)},getTarget:g=>g,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:g=>{var w;return null===(w=g._babylonCamera)||void 0===w?void 0:w.ri},set:(g,w)=>{w._babylonCamera&&(w._babylonCamera.ri=g)},getTarget:g=>g,getPropertyName:[()=>"ri"]}}}},nodes:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>g._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ew",get:g=>{var w;return null===(w=g._babylonTransformNode)||void 0===w?void 0:w.position},set:(g,w)=>{var q;return null===(q=w._babylonTransformNode)||void 0===q?void 0:q.position.T(g)},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:g=>{var w;return null===(w=g._babylonTransformNode)||void 0===w?void 0:w.rotationQuaternion},set:(g,w)=>{var q,R;return null===(q=w._babylonTransformNode)||void 0===q||null===(R=q.rotationQuaternion)||void 0===R?void 0:R.T(g)},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ew",get:g=>{var w;return null===(w=g._babylonTransformNode)||void 0===w?void 0:w.ei},set:(g,w)=>{var q;return null===(q=w._babylonTransformNode)||void 0===q?void 0:q.ei.T(g)},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"ei"]},weights:{length:{type:"number",get:g=>g._numMorphTargets,getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(g,w)=>{var q,R;return void 0!==w?null===(q=g._primitiveBabylonMeshes)||void 0===q||null===(R=q[0].morphTargetManager)||void 0===R?void 0:R.getTarget(w).influence:void 0},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(g,w)=>[0],getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:g=>{var w,q,o;return R.Matrix.Compose(null===(w=g._babylonTransformNode)||void 0===w?void 0:w.ei,null===(q=g._babylonTransformNode)||void 0===q?void 0:q.rotationQuaternion,null===(o=g._babylonTransformNode)||void 0===o?void 0:o.position)},getTarget:g=>g._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:g=>{var w,q,o,r;const S=R.Matrix.Identity();let i=g.parent;for(;i&&i.parent;)i=i.parent;const T=(null===(w=g._babylonTransformNode)||void 0===w?void 0:w.position._isDirty)||(null===(q=g._babylonTransformNode)||void 0===q||null===(o=q.rotationQuaternion)||void 0===o?void 0:o._isDirty)||(null===(r=g._babylonTransformNode)||void 0===r?void 0:r.ei._isDirty);if(i){var z;const w=null===(z=i._babylonTransformNode)||void 0===z?void 0:z.ii(!0).invert();var t,m;if(w)null===(t=g._babylonTransformNode)||void 0===t||null===(m=t.ii(T))||void 0===m||m.multiplyToRef(w,S)}else g._babylonTransformNode&&S.T(g._babylonTransformNode.ii(T));return S},getTarget:g=>g._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:g=>{var w,q;return null===(w=g._babylonTransformNode)||void 0===w||null===(q=w.getChildren((g=>g instanceof S.b),!0)[0])||void 0===q?void 0:q.li},getTarget:g=>{var w;return null===(w=g._babylonTransformNode)||void 0===w?void 0:w.getChildren((g=>g instanceof S.b),!0)[0]},set:(g,w)=>{if(w._babylonTransformNode){const q=w._babylonTransformNode.getChildren((g=>g instanceof S.b),!0)[0];q&&(q.li=g)}}},color:{type:"Jw",get:g=>{var w,q;return null===(w=g._babylonTransformNode)||void 0===w||null===(q=w.getChildren((g=>g instanceof S.b),!0)[0])||void 0===q?void 0:q.Ji},getTarget:g=>{var w;return null===(w=g._babylonTransformNode)||void 0===w?void 0:w.getChildren((g=>g instanceof S.b),!0)[0]},set:(g,w)=>{if(w._babylonTransformNode){const q=w._babylonTransformNode.getChildren((g=>g instanceof S.b),!0)[0];q&&(q.Ji=g)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Jw",get:(g,w,q)=>t(g,w,q).emissiveColor,set:(g,w,q,R)=>t(w,q,R).emissiveColor.T(g),getTarget:(g,w,q)=>t(g,w,q),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:m("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(g,w,q)=>{var R;return null===(R=z(g,q,"bumpTexture"))||void 0===R?void 0:R.level},set:(g,w,q,R)=>{const o=z(w,R,"bumpTexture");o&&(o.level=g)},getTarget:(g,w,q)=>t(g,w,q),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:m("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(g,w,q)=>t(g,w,q).ambientTextureStrength,set:(g,w,q,R)=>{const o=t(w,q,R);o&&(o.ambientTextureStrength=g)},getTarget:(g,w,q)=>t(g,w,q),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:m("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"ci",get:(g,w,q)=>{const R=t(g,w,q);return r.d.FromColor3(R.albedoColor,R.alpha)},set:(g,w,q,R)=>{const o=t(w,q,R);o.albedoColor.set(g.r,g.g,g.b),o.alpha=g.a},getTarget:(g,w,q)=>t(g,w,q),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:m("albedoTexture")}},metallicFactor:{type:"number",get:(g,w,q)=>t(g,w,q).metallic,set:(g,w,q,R)=>{const o=t(w,q,R);o&&(o.metallic=g)},getTarget:(g,w,q)=>t(g,w,q),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(g,w,q)=>t(g,w,q).roughness,set:(g,w,q,R)=>{const o=t(w,q,R);o&&(o.roughness=g)},getTarget:(g,w,q)=>t(g,w,q),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:m("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(g,w,q)=>t(g,w,q).anisotropy.li,set:(g,w,q,R)=>{t(w,q,R).anisotropy.li=g},getTarget:(g,w,q)=>t(g,w,q),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(g,w,q)=>t(g,w,q).anisotropy.angle,set:(g,w,q,R)=>{t(w,q,R).anisotropy.angle=g},getTarget:(g,w,q)=>t(g,w,q),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:m("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(g,w,q)=>t(g,w,q).clearCoat.li,set:(g,w,q,R)=>{t(w,q,R).clearCoat.li=g},getTarget:(g,w,q)=>t(g,w,q),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(g,w,q)=>t(g,w,q).clearCoat.roughness,set:(g,w,q,R)=>{t(w,q,R).clearCoat.roughness=g},getTarget:(g,w,q)=>t(g,w,q),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:m("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(g,w,q)=>{var R;return null===(R=t(g,w,q).clearCoat.bumpTexture)||void 0===R?void 0:R.level},getTarget:t,set:(g,w,q,R)=>t(w,q,R).clearCoat.bumpTexture.level=g},extensions:{KHR_texture_transform:m("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:m("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(g,w,q)=>t(g,w,q).subSurface.dispersion,getTarget:t,set:(g,w,q,R)=>t(w,q,R).subSurface.dispersion=g}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(g,w,q)=>t(g,w,q).emissiveIntensity,getTarget:t,set:(g,w,q,R)=>t(w,q,R).emissiveIntensity=g}},KHR_materials_ior:{ior:{type:"number",get:(g,w,q)=>t(g,w,q).indexOfRefraction,getTarget:t,set:(g,w,q,R)=>t(w,q,R).indexOfRefraction=g}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(g,w,q)=>t(g,w,q).iridescence.li,getTarget:t,set:(g,w,q,R)=>t(w,q,R).iridescence.li=g},iridescenceIor:{type:"number",get:(g,w,q)=>t(g,w,q).iridescence.indexOfRefraction,getTarget:t,set:(g,w,q,R)=>t(w,q,R).iridescence.indexOfRefraction=g},iridescenceTexture:{extensions:{KHR_texture_transform:m("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(g,w,q)=>t(g,w,q).iridescence.maximumThickness,getTarget:t,set:(g,w,q,R)=>t(w,q,R).iridescence.maximumThickness=g},iridescenceThicknessMinimum:{type:"number",get:(g,w,q)=>t(g,w,q).iridescence.minimumThickness,getTarget:t,set:(g,w,q,R)=>t(w,q,R).iridescence.minimumThickness=g},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:m("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Jw",get:(g,w,q)=>t(g,w,q).sheen.color,getTarget:t,set:(g,w,q,R)=>t(w,q,R).sheen.color.T(g)},sheenColorTexture:{extensions:{KHR_texture_transform:m("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(g,w,q)=>t(g,w,q).sheen.li,getTarget:t,set:(g,w,q,R)=>t(w,q,R).sheen.li=g},sheenRoughnessTexture:{extensions:{KHR_texture_transform:m("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(g,w,q)=>t(g,w,q).metallicF0Factor,getTarget:t,set:(g,w,q,R)=>t(w,q,R).metallicF0Factor=g,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Jw",get:(g,w,q)=>t(g,w,q).metallicReflectanceColor,getTarget:t,set:(g,w,q,R)=>t(w,q,R).metallicReflectanceColor.T(g),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:m("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:m("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(g,w,q)=>t(g,w,q).subSurface.refractionIntensity,getTarget:t,set:(g,w,q,R)=>t(w,q,R).subSurface.refractionIntensity=g,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:m("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(g,w,q)=>t(g,w,q).subSurface.translucencyIntensity,getTarget:t,set:(g,w,q,R)=>t(w,q,R).subSurface.translucencyIntensity=g},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:m("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Jw",get:(g,w,q)=>t(g,w,q).subSurface.translucencyColor,getTarget:t,set:(g,w,q,R)=>{var o;return g&&(null===(o=t(w,q,R).subSurface.translucencyColor)||void 0===o?void 0:o.T(g))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:m("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Jw",get:(g,w,q)=>t(g,w,q).subSurface.tintColor,getTarget:t,set:(g,w,q,R)=>t(w,q,R).subSurface.tintColor.T(g)},attenuationDistance:{type:"number",get:(g,w,q)=>t(g,w,q).subSurface.tintColorAtDistance,getTarget:t,set:(g,w,q,R)=>t(w,q,R).subSurface.tintColorAtDistance=g},thicknessFactor:{type:"number",get:(g,w,q)=>t(g,w,q).subSurface.maximumThickness,getTarget:t,set:(g,w,q,R)=>t(w,q,R).subSurface.maximumThickness=g},thicknessTexture:{extensions:{KHR_texture_transform:m("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>g._babylonLight)),getPropertyName:[g=>"length"]},__array__:{__target__:!0,color:{type:"Jw",get:g=>{var w;return null===(w=g._babylonLight)||void 0===w?void 0:w.Ji},set:(g,w)=>{var q;return null===(q=w._babylonLight)||void 0===q?void 0:q.Ji.T(g)},getTarget:g=>g._babylonLight,getPropertyName:[g=>"diffuse"]},li:{type:"number",get:g=>{var w;return null===(w=g._babylonLight)||void 0===w?void 0:w.li},set:(g,w)=>w._babylonLight?w._babylonLight.li=g:void 0,getTarget:g=>g._babylonLight,getPropertyName:[g=>"intensity"]},range:{type:"number",get:g=>{var w;return null===(w=g._babylonLight)||void 0===w?void 0:w.range},set:(g,w)=>w._babylonLight?w._babylonLight.range=g:void 0,getTarget:g=>g._babylonLight,getPropertyName:[g=>"range"]},spot:{innerConeAngle:{type:"number",get:g=>{var w;return null===(w=g._babylonLight)||void 0===w?void 0:w.innerAngle},set:(g,w)=>w._babylonLight?w._babylonLight.innerAngle=g:void 0,getTarget:g=>g._babylonLight,getPropertyName:[g=>"innerConeAngle"]},outerConeAngle:{type:"number",get:g=>{var w;return null===(w=g._babylonLight)||void 0===w?void 0:w.angle},set:(g,w)=>w._babylonLight?w._babylonLight.angle=g:void 0,getTarget:g=>g._babylonLight,getPropertyName:[g=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>g._babylonLight)),getPropertyName:[g=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>g._babylonTexture)),getPropertyName:[g=>"length"]},__array__:{__target__:!0,li:{type:"number",get:g=>{var w;return null===(w=g._babylonTexture)||void 0===w?void 0:w.level},set:(g,w)=>{w._babylonTexture&&(w._babylonTexture.level=g)},getTarget:g=>g._babylonTexture},rotation:{type:"Quaternion",get:g=>{var w;return g._babylonTexture&&R.Quaternion.FromRotationMatrix(null===(w=g._babylonTexture)||void 0===w?void 0:w.getReflectionTextureMatrix())},set:(g,w)=>{var q;w._babylonTexture&&(null!==(q=w._babylonTexture.Ng())&&void 0!==q&&q.useRightHandedSystem||(g=R.Quaternion.Inverse(g)),R.Matrix.FromQuaternionToRef(g,w._babylonTexture.getReflectionTextureMatrix()))},getTarget:g=>g._babylonTexture}}}}},animations:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>g._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:g=>g.length,getTarget:g=>g.map((g=>{var w;return null===(w=g.primitives[0]._instanceData)||void 0===w?void 0:w.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function y(g){return new T(g,e)}function L(g){const w=g.split("/").map((g=>g.replace(/{}/g,"__array__")));let q=e;for(const R of w)R&&(q=q[R]);if(q&&q.type&&q.get)return q}function A(g,w){const q=g.split("/").map((g=>g.replace(/{}/g,"__array__")));let R=e;for(const o of q)o&&(R=R[o]);R&&R.type&&R.get&&(R.interpolation=w)}function l(g,w){const q=g.split("/").map((g=>g.replace(/{}/g,"__array__")));let R=e;for(const o of q)if(o){if(!R[o]){if("?"===o){R.__ignoreObjectTree__=!0;continue}R[o]={},"__array__"===o&&(R[o].__target__=!0)}R=R[o]}Object.assign(R,w)}},12777:(g,w,q)=>{"use strict";q.r(w),q.d(w,{AnimationPropertyInfo:()=>z,TransformNodeAnimationPropertyInfo:()=>t,WeightAnimationPropertyInfo:()=>m,getQuaternion:()=>i,getVector3:()=>S,getWeights:()=>T});var R=q(11659),o=q(11180),r=q(12769);function S(g,w,q,R){return o.ew.Ri(w,q).scaleInPlace(R)}function i(g,w,q,R){return o.Quaternion.Ri(w,q).scaleInPlace(R)}function T(g,w,q,R){const o=new Array(g._numMorphTargets);for(let r=0;r<o.length;r++)o[r]=w[q++]*R;return o}class z{constructor(g,w,q,R){this.type=g,this.name=w,this.getValue=q,this.getStride=R}_buildAnimation(g,w,q){const o=new R.c(g,this.name,w,this.type);return o.setKeys(q),o}}class t extends z{buildAnimations(g,w,q,R){const o=[];return o.push({babylonAnimatable:g._babylonTransformNode,babylonAnimation:this._buildAnimation(w,q,R)}),o}}class m extends z{buildAnimations(g,w,q,o){const r=[];if(g._numMorphTargets)for(let S=0;S<g._numMorphTargets;S++){const i=new R.c(`${w}_${S}`,this.name,q,this.type);if(i.setKeys(o.map((g=>({frame:g.frame,inTangent:g.inTangent?g.inTangent[S]:void 0,value:g.value[S],outTangent:g.outTangent?g.outTangent[S]:void 0,interpolation:g.interpolation})))),g._primitiveBabylonMeshes)for(const w of g._primitiveBabylonMeshes)if(w.morphTargetManager){const g=w.morphTargetManager.getTarget(S),q=i.clone();g.animations.push(q),r.push({babylonAnimatable:g,babylonAnimation:q})}}return r}}(0,r.k)("/nodes/{}/translation",[new t(R.c.ANIMATIONTYPE_VECTOR3,"position",S,(()=>3))]),(0,r.k)("/nodes/{}/rotation",[new t(R.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",i,(()=>4))]),(0,r.k)("/nodes/{}/scale",[new t(R.c.ANIMATIONTYPE_VECTOR3,"ei",S,(()=>3))]),(0,r.k)("/nodes/{}/weights",[new m(R.c.ANIMATIONTYPE_FLOAT,"influence",T,(g=>g._numMorphTargets))])},12737:(g,w,q)=>{"use strict";class R{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((g,w)=>{this._resolve=g,this._reject=w}))}}var o=q(11180),r=q(11235),S=q(10991),i=q(11593),T=q(12745),z=q(12757),t=q(10998),m=q(11612),e=q(11659),y=q(11661),L=q(11034),A=q(11011),l=q(11017);class J{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(g){this._useTextureToStoreBoneMatrices=g,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(g){this._animationPropertiesOverride=g}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(g,w,q){this.name=g,this.id=w,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=o.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new t.b,this.bones=[],this._scene=q||L.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const R=this._scene.getEngine().getCaps();this._canUseTextureForBones=R.textureFloat&&R.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((g=>!g.getParent()))}getTransformMatrices(g){if(this.needInitialSkinMatrix){if(!g)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return g._bonesTransformMatrices||this.prepare(!0),g._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(g){return this.needInitialSkinMatrix&&g._transformMatrixTexture?g._transformMatrixTexture:this._transformMatrixTexture}Ng(){return this._scene}toString(g){let w=`Name: ${this.name}, nBones: ${this.bones.length}`;if(w+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,g){w+=", Ranges: {";let g=!0;for(const q in this._ranges)g&&(w+=", ",g=!1),w+=q;w+="}"}return w}getBoneIndexByName(g){for(let w=0,q=this.bones.length;w<q;w++)if(this.bones[w].name===g)return w;return-1}createAnimationRange(g,w,q){if(!this._ranges[g]){this._ranges[g]=new y.b(g,w,q);for(let R=0,o=this.bones.length;R<o;R++)this.bones[R].animations[0]&&this.bones[R].animations[0].createRange(g,w,q)}}deleteAnimationRange(g){let w=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let q=0,R=this.bones.length;q<R;q++)this.bones[q].animations[0]&&this.bones[q].animations[0].deleteRange(g,w);this._ranges[g]=null}getAnimationRange(g){return this._ranges[g]||null}getAnimationRanges(){const g=[];let w;for(w in this._ranges)g.push(this._ranges[w]);return g}copyAnimationRange(g,w){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[w]||!g.getAnimationRange(w))return!1;let R=!0;const o=this._getHighestAnimationFrame()+1,r={},S=g.bones;let i,T;for(T=0,i=S.length;T<i;T++)r[S[T].name]=S[T];this.bones.length!==S.length&&(A.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${S.length}`),R=!1);const z=q&&this.dimensionsAtRest&&g.dimensionsAtRest?this.dimensionsAtRest.divide(g.dimensionsAtRest):null;for(T=0,i=this.bones.length;T<i;T++){const g=this.bones[T].name,S=r[g];S?R=R&&this.bones[T].copyAnimationRange(S,w,o,q,z):(A.d.Warn("copyAnimationRange: not same rig, missing source bone "+g),R=!1)}const t=g.getAnimationRange(w);return t&&(this._ranges[w]=new y.b(w,t.from+o,t.to+o)),R}returnToRest(){for(const g of this.bones)-1!==g._index&&g.returnToRest()}_getHighestAnimationFrame(){let g=0;for(let w=0,q=this.bones.length;w<q;w++)if(this.bones[w].animations[0]){const q=this.bones[w].animations[0].getHighestFrame();g<q&&(g=q)}return g}beginAnimation(g,w,q,R){const o=this.getAnimationRange(g);return o?this._scene.beginAnimation(this,o.from,o.to,w,q,R):null}static MakeAnimationAdditive(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;const R=g.getAnimationRange(q);if(!R)return null;const o=g._scene.getAllAnimatablesByTarget(g);let r=null;for(let i=0;i<o.length;i++){const g=o[i];if(g.fromFrame===(null===R||void 0===R?void 0:R.from)&&g.toFrame===(null===R||void 0===R?void 0:R.to)){r=g;break}}const S=g.getAnimatables();for(let i=0;i<S.length;i++){const g=S[i].animations;if(g)for(let R=0;R<g.length;R++)e.c.MakeAnimationAdditive(g[R],w,q)}return r&&(r.isAdditive=!0),g}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(g){this._meshesWithPoseMatrix.push(g)}_unregisterMeshWithPoseMatrix(g){const w=this._meshesWithPoseMatrix.indexOf(g);w>-1&&this._meshesWithPoseMatrix.splice(w,1)}_computeTransformMatrices(g,w){this.onBeforeComputeObservable.notifyObservers(this);for(let q=0;q<this.bones.length;q++){const R=this.bones[q];R._childUpdateId++;const o=R.getParent();if(o?R.getLocalMatrix().multiplyToRef(o.getFinalMatrix(),R.getFinalMatrix()):w?R.getLocalMatrix().multiplyToRef(w,R.getFinalMatrix()):R.getFinalMatrix().T(R.getLocalMatrix()),-1!==R._index){const w=null===R._index?q:R._index;R.getAbsoluteInverseBindMatrix().multiplyToArray(R.getFinalMatrix(),g,16*w)}}this._identity.copyToArray(g,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const g=this.Ng().getRenderId();if(this._currentRenderId===g)return;this._currentRenderId=g}if(this._numBonesWithLinkedTransformNode>0)for(const g of this.bones)if(g._linkedTransformNode){const w=g._linkedTransformNode;g.position=w.position,w.rotationQuaternion?g.rotationQuaternion=w.rotationQuaternion:g.rotation=w.rotation,g.ei=w.ei}if(this.needInitialSkinMatrix)for(const g of this._meshesWithPoseMatrix){const w=g.getPoseMatrix();let q=this._isDirty;if(g._bonesTransformMatrices&&g._bonesTransformMatrices.length===16*(this.bones.length+1)||(g._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),q=!0),q){if(this._synchronizedWithMesh!==g){this._synchronizedWithMesh=g;for(const g of this.bones)if(!g.getParent()){g.getBindMatrix().multiplyToRef(w,o.TmpVectors.Matrix[1]),g._updateAbsoluteBindMatrices(o.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const w=4*(this.bones.length+1);g._transformMatrixTexture&&g._transformMatrixTexture.getSize().width===w||(g._transformMatrixTexture&&g._transformMatrixTexture.dispose(),g._transformMatrixTexture=m.d.CreateRGBATexture(g._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(g._bonesTransformMatrices,w),this.isUsingTextureForMatrices&&g._transformMatrixTexture&&g._transformMatrixTexture.update(g._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=m.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let g=0;g<this.bones.length;g++)this._animatables.push(this.bones[g])}return this._animatables}clone(g,w){const q=new J(g,w||g,this._scene);q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let R=0;R<this.bones.length;R++){const g=this.bones[R];let w=null;const o=g.getParent();if(o){const g=this.bones.indexOf(o);w=q.bones[g]}const r=new z.e(g.name,q,w,g.getBindMatrix().clone(),g.getRestMatrix().clone());r._index=g._index,g._linkedTransformNode&&r.linkTransformNode(g._linkedTransformNode),l.d.DeepCopy(g.animations,r.animations)}if(this._ranges){q._ranges={};for(const g in this._ranges){const w=this._ranges[g];w&&(q._ranges[g]=w.clone())}}return this._isDirty=!0,q.prepare(!0),q}enableBlending(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const w of this.bones)for(const q of w.animations)q.enableBlending=!0,q.blendingSpeed=g}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Ng().stopAnimation(this),this.Ng().removeSkeleton(this),this._parentContainer){const g=this._parentContainer.skeletons.indexOf(this);g>-1&&this._parentContainer.skeletons.splice(g,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const g={};g.name=this.name,g.id=this.id,this.dimensionsAtRest&&(g.dimensionsAtRest=this.dimensionsAtRest.qi()),g.bones=[],g.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let q=0;q<this.bones.length;q++){var w;const R=this.bones[q],o=R.getParent(),r={parentBoneIndex:o?this.bones.indexOf(o):-1,index:R.getIndex(),name:R.name,id:R.id,matrix:R.getBindMatrix().qi(),rest:R.getRestMatrix().qi(),linkedTransformNodeId:null===(w=R.getTransformNode())||void 0===w?void 0:w.id};g.bones.push(r),R.length&&(r.length=R.length),R.metadata&&(r.metadata=R.metadata),R.animations&&R.animations.length>0&&(r.animation=R.animations[0].serialize()),g.ranges=[];for(const w in this._ranges){const q=this._ranges[w];if(!q)continue;const R={};R.name=w,R.from=q.from,R.to=q.to,g.ranges.push(R)}}return g}static Parse(g,w){const q=new J(g.name,g.id,w);let R;for(g.dimensionsAtRest&&(q.dimensionsAtRest=o.ew.Ri(g.dimensionsAtRest)),q.needInitialSkinMatrix=g.needInitialSkinMatrix,R=0;R<g.bones.length;R++){const w=g.bones[R],r=g.bones[R].index;let S=null;w.parentBoneIndex>-1&&(S=q.bones[w.parentBoneIndex]);const i=w.rest?o.Matrix.Ri(w.rest):null,T=new z.e(w.name,q,S,o.Matrix.Ri(w.matrix),i,null,r);void 0!==w.id&&null!==w.id&&(T.id=w.id),w.length&&(T.length=w.length),w.metadata&&(T.metadata=w.metadata),w.animation&&T.animations.push(e.c.Parse(w.animation)),void 0!==w.linkedTransformNodeId&&null!==w.linkedTransformNodeId&&(q._hasWaitingData=!0,T._waitingTransformNodeId=w.linkedTransformNodeId)}if(g.ranges)for(R=0;R<g.ranges.length;R++){const w=g.ranges[R];q.createAnimationRange(w.name,w.from,w.to)}return q}computeAbsoluteMatrices(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||g)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(g)}getPoseMatrix(){let g=null;return this._meshesWithPoseMatrix.length>0&&(g=this._meshesWithPoseMatrix[0].getPoseMatrix()),g}sortBones(){const g=[],w=new Array(this.bones.length);for(let q=0;q<this.bones.length;q++)this._sortBones(q,g,w);this.bones=g}_sortBones(g,w,q){if(q[g])return;q[g]=!0;const R=this.bones[g];if(!R)return;void 0===R._index&&(R._index=g);const o=R.getParent();o&&this._sortBones(this.bones.indexOf(o),w,q),w.push(R)}setCurrentPoseAsRest(){for(const g of this.bones)g.setCurrentPoseAsRest()}}var x=q(11469),G=q(11624),d=q(11152),D=q(11552),U=q(11250),N=q(11596),a=q(11567),H=q(11586),C=q(11668),c=q(11270),P=q(12704);class j{set areUpdatesFrozen(g){g?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new c.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,g||(g=L.c.LastCreatedScene),this._scene=g,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const g=this._scene.getEngine().getCaps();this._canUseTextureForTargets=g.canUseGLVertexID&&g.textureFloat&&g.maxVertexTextureImageUnits>0&&g.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return j.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?j.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(g){this._numMaxInfluencers!==g&&(this._numMaxInfluencers=g,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(g){this._useTextureToStoreTargets!==g&&(this._useTextureToStoreTargets=g,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var g;return j.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(g=this._scene)&&void 0!==g&&g.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(g){return this._activeTargets.data[g]}getTarget(g){return this._targets[g]}getTargetByName(g){for(const w of this._targets)if(w.name===g)return w;return null}addTarget(g){this._targets.push(g),this._targetInfluenceChangedObservers.push(g.onInfluenceChanged.add((g=>{this.areUpdatesFrozen&&g&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(g)}))),this._targetDataLayoutChangedObservers.push(g._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(g){const w=this._targets.indexOf(g);w>=0&&(this._targets.splice(w,1),g.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(w,1)[0]),g._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(w,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(g)}_bind(g){g.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),g.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),g.setTexture("morphTargets",this._targetStoreTexture),g.setInt("morphTargetCount",this.numInfluencers)}clone(){const g=new j(this._scene);for(const w of this._targets)g.addTarget(w.clone());return g.enablePositionMorphing=this.enablePositionMorphing,g.enableNormalMorphing=this.enableNormalMorphing,g.enableTangentMorphing=this.enableTangentMorphing,g.enableUVMorphing=this.enableUVMorphing,g.enableUV2Morphing=this.enableUV2Morphing,g.enableColorMorphing=this.enableColorMorphing,g}serialize(){const g={};g.id=this.uniqueId,g.targets=[];for(const w of this._targets)g.targets.push(w.serialize());return g}_syncActiveTargets(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const w=!!this._targetStoreTexture,q=this.isUsingTextureForTargets;(this._mustSynchronize||w!==q)&&(this._mustSynchronize=!1,this.synchronize());let R=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let o=-1;for(const r of this._targets)if(o++,0!==r.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=j.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(r),this._morphTargetTextureIndices[R]=o,this._tempInfluences[R++]=r.influence}this._morphTargetTextureIndices.length!==R&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,R)),this._influences&&this._influences.length===R||(this._influences=new Float32Array(R));for(let r=0;r<R;r++)this._influences[r]=this._tempInfluences[r];if(g&&this._scene)for(const r of this._scene.meshes)r.morphTargetManager===this&&(q?r._markSubMeshesAsAttributesDirty():r._syncGeometryWithMorphTargetManager())}synchronize(){var g;if(!this._scene||this.areUpdatesFrozen)return;const w=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(g=this._targetStoreTexture)||void 0===g||g.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>w.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const q of this._targets){this._supportsPositions=this._supportsPositions&&q.hasPositions,this._supportsNormals=this._supportsNormals&&q.hasNormals,this._supportsTangents=this._supportsTangents&&q.hasTangents,this._supportsUVs=this._supportsUVs&&q.hasUVs,this._supportsUV2s=this._supportsUV2s&&q.hasUV2s,this._supportsColors=this._supportsColors&&q.hasColors;const g=q.vertexCount;if(0===this._vertexCount)this._vertexCount=g;else if(this._vertexCount!==g)return void A.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${q.name}": ${g}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const g=w.getCaps().maxTextureSize;this._textureWidth>g&&(this._textureHeight=Math.ceil(this._textureWidth/g),this._textureWidth=g);const q=this._targets.length,R=new Float32Array(q*this._textureWidth*this._textureHeight*4);let o=0;for(let w=0;w<q;w++){const g=this._targets[w],q=g.getPositions(),r=g.getNormals(),S=g.getUVs(),i=g.getTangents(),T=g.getUV2s(),z=g.getColors();o=w*this._textureWidth*this._textureHeight*4;for(let w=0;w<this._vertexCount;w++)this._supportsPositions&&q&&(R[o]=q[3*w],R[o+1]=q[3*w+1],R[o+2]=q[3*w+2],o+=4),this._supportsNormals&&r&&(R[o]=r[3*w],R[o+1]=r[3*w+1],R[o+2]=r[3*w+2],o+=4),this._supportsUVs&&S&&(R[o]=S[2*w],R[o+1]=S[2*w+1],o+=4),this._supportsTangents&&i&&(R[o]=i[3*w],R[o+1]=i[3*w+1],R[o+2]=i[3*w+2],o+=4),this._supportsUV2s&&T&&(R[o]=T[2*w],R[o+1]=T[2*w+1],o+=4),this._supportsColors&&z&&(R[o]=z[4*w],R[o+1]=z[4*w+1],R[o+2]=z[4*w+2],R[o+3]=z[4*w+3],o+=4)}this._targetStoreTexture=P.e.CreateRGBATexture(R,this._textureWidth,this._textureHeight,q,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const q of this._scene.meshes)q.morphTargetManager===this&&q._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const g=this._parentContainer.morphTargetManagers.indexOf(this);g>-1&&this._parentContainer.morphTargetManagers.splice(g,1),this._parentContainer=null}for(const g of this._targets)this._scene.stopAnimation(g)}}static Parse(g,w){const q=new j(w);for(const R of g.targets)q.addTarget(C.d.Parse(R,w));return q}}j.EnableTextureStorage=!0,j.MaxActiveMorphTargetsInVertexAttributeMode=8,j.ConstantTargetCountForTextureMode=0;var M=q(12762),V=q(11043),s=q(11480);const h=new Map,v=h;function b(g,w,q){B(g)&&A.d.Warn(`Extension with the name '${g}' already exists`),h.set(g,{isGLTFExtension:w,factory:q})}function B(g){return h.delete(g)}var f=q(12769),O=q(11724),E=q(11262);class Q{static Get(g,w,q){if(!w||void 0==q||!w[q])throw new Error(`${g}: Failed to find index (${q})`);return w[q]}static TryGet(g,w){return g&&void 0!=w&&g[w]?g[w]:null}static Assign(g){if(g)for(let w=0;w<g.length;w++)g[w].index=w}}function X(g){if(g.min&&g.max){const w=g.min,q=g.max,R=o.TmpVectors.ew[0].mi(w[0],w[1],w[2]),r=o.TmpVectors.ew[1].mi(q[0],q[1],q[2]);if(g.normalized&&5126!==g.componentType){let w=1;switch(g.componentType){case 5120:w=127;break;case 5121:w=255;break;case 5122:w=32767;break;case 5123:w=65535}const q=1/w;R.scaleInPlace(q),r.scaleInPlace(q)}return new s.d(R,r)}return null}class K{static RegisterExtension(g,w){b(g,!1,w)}static UnregisterExtension(g){return B(g)}get IS(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(g){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=g}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((g=>g.dispose&&g.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(g,w,q,R,o,r){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=w,this._assetContainer=q,this._loadData(R);let r=null;if(g){const w={};if(this._gltf.nodes)for(const g of this._gltf.nodes)g.name&&(w[g.name]=g.index);r=(g instanceof Array?g:[g]).map((g=>{const q=w[g];if(void 0===q)throw new Error(`Failed to find node '${g}'`);return q}))}return await this._loadAsync(o,S,r,(()=>({meshes:this._getMeshes(),Ym:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=g,this._loadData(w),await this._loadAsync(q,o,null,(()=>{}))}async _loadAsync(g,w,q,R){return await Promise.resolve().then((async()=>{this._rootUrl=g,this._uniqueRootUrl=!g.startsWith("file:")&&w?g:`${g}${Date.now()}/`,this._fileName=w,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const o=`${M.j[M.j.LOADING]} => ${M.j[M.j.READY]}`,r=`${M.j[M.j.LOADING]} => ${M.j[M.j.COMPLETE]}`;this._parent._startPerformanceCounter(o),this._parent._startPerformanceCounter(r),this._parent._setState(M.j.LOADING),this._extensionsOnLoading();const i=new Array;if(!this.parent.loadOnlyMaterials)if(q)i.push(this.loadSceneAsync("/nodes",{nodes:q,index:-1}));else if(void 0!=this._gltf.Aw||this._gltf.scenes&&this._gltf.scenes[0]){const g=Q.Get("/scene",this._gltf.scenes,this._gltf.Aw||0);i.push(this.loadSceneAsync(`/scenes/${g.index}`,g))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let g=0;g<this._gltf.materials.length;++g){const w=this._gltf.materials[g],q="/materials/"+g,R=x.e.TriangleFillMode;i.push(this._loadMaterialAsync(q,w,null,R,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&i.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&i.push(this._compileShadowGeneratorsAsync());const T=Promise.all(i).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Mi(!0);for(const g of this._babylonScene.materials){const w=g;void 0!==w.maxSimultaneousLights&&(w.maxSimultaneousLights=Math.max(w.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(M.j.READY),this._skipStartAnimationStep||this._startAnimations(),R()}));return await T.then((g=>(this._parent._endPerformanceCounter(o),S.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(r),this._parent._setState(M.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(g=>{this._parent.onErrorObservable.notifyObservers(g),this._parent.onErrorObservable.clear(),this.dispose()}))})),g)))})).catch((g=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(g),this._parent.onErrorObservable.clear(),this.dispose()),g}))}_loadData(g){if(this._gltf=g.json,this._setupData(),g.bin){const w=this._gltf.buffers;if(w&&w[0]&&!w[0].uri){const q=w[0];(q.byteLength<g.bin.byteLength-3||q.byteLength>g.bin.byteLength)&&A.d.Warn(`Binary buffer length (${q.byteLength}) from JSON does not match chunk length (${g.bin.byteLength})`),this._bin=g.bin}else A.d.Warn("Unexpected BIN chunk")}}_setupData(){if(Q.Assign(this._gltf.accessors),Q.Assign(this._gltf.animations),Q.Assign(this._gltf.buffers),Q.Assign(this._gltf.bufferViews),Q.Assign(this._gltf.cameras),Q.Assign(this._gltf.images),Q.Assign(this._gltf.materials),Q.Assign(this._gltf.meshes),Q.Assign(this._gltf.nodes),Q.Assign(this._gltf.samplers),Q.Assign(this._gltf.scenes),Q.Assign(this._gltf.skins),Q.Assign(this._gltf.textures),this._gltf.nodes){const g={};for(const q of this._gltf.nodes)if(q.children)for(const w of q.children)g[w]=q.index;const w=this._createRootNode();for(const q of this._gltf.nodes){const R=g[q.index];q.parent=void 0===R?w:this._gltf.nodes[R]}}}async _loadExtensionsAsync(){const g=[];if(v.forEach(((w,q)=>{var R;!1===(null===(R=this.parent.extensionOptions[q])||void 0===R?void 0:R.enabled)?w.isGLTFExtension&&this.isExtensionUsed(q)&&A.d.Warn(`Extension ${q} is used but has been explicitly disabled.`):w.isGLTFExtension&&!this.isExtensionUsed(q)||g.push((async()=>{const g=await w.factory(this);return g.name!==q&&A.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${g.name} !== ${q}`),this._parent.onExtensionLoadedObservable.notifyObservers(g),g})())})),this._extensions.push(...await Promise.all(g)),this._extensions.sort(((g,w)=>(g.order||Number.MAX_VALUE)-(w.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const q of this._gltf.extensionsRequired){if(!this._extensions.some((g=>g.name===q&&g.enabled))){var w;if(!1===(null===(w=this.parent.extensionOptions[q])||void 0===w?void 0:w.enabled))throw new Error(`Required extension ${q} is disabled`);throw new Error(`Required extension ${q} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new H.d("__root__",this._babylonScene);this._rootBabylonMesh=g,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Mi(!1);const w={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case M.i.AUTO:this._babylonScene.useRightHandedSystem||(w.rotation=[0,1,0,0],w.scale=[1,1,-1],K._LoadTransform(w,this._rootBabylonMesh));break;case M.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(g),w}loadSceneAsync(g,w){const q=this._extensionsLoadSceneAsync(g,w);if(q)return q;const R=new Array;if(this.logOpen(`${g} ${w.name||""}`),w.nodes)for(const o of w.nodes){const w=Q.Get(`${g}/nodes/${o}`,this._gltf.nodes,o);R.push(this.loadNodeAsync(`/nodes/${w.index}`,w,(g=>{g.parent=this._rootBabylonMesh})))}for(const o of this._postSceneLoadActions)o();return R.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(R).then((()=>{}))}_forEachPrimitive(g,w){if(g._primitiveBabylonMeshes)for(const q of g._primitiveBabylonMeshes)w(q)}_getGeometries(){const g=[],w=this._gltf.nodes;if(w)for(const q of w)this._forEachPrimitive(q,(w=>{const q=w.Ti;q&&-1===g.indexOf(q)&&g.push(q)}));return g}_getMeshes(){const g=[];this._rootBabylonMesh instanceof a.c&&g.push(this._rootBabylonMesh);const w=this._gltf.nodes;if(w)for(const q of w)this._forEachPrimitive(q,(w=>{g.push(w)}));return g}_getTransformNodes(){const g=[],w=this._gltf.nodes;if(w)for(const q of w)q._babylonTransformNode&&"ni"===q._babylonTransformNode.getClassName()&&g.push(q._babylonTransformNode),q._babylonTransformNodeForSkin&&g.push(q._babylonTransformNodeForSkin);return g}_getSkeletons(){const g=[],w=this._gltf.skins;if(w)for(const q of w)q._data&&g.push(q._data.babylonSkeleton);return g}_getAnimationGroups(){const g=[],w=this._gltf.animations;if(w)for(const q of w)q._babylonAnimationGroup&&g.push(q._babylonAnimationGroup);return g}_startAnimations(){switch(this._parent.animationStartMode){case M.h.NONE:break;case M.h.FIRST:{const g=this._getAnimationGroups();0!==g.length&&g[0].start(!0);break}case M.h.ALL:{const g=this._getAnimationGroups();for(const w of g)w.start(!0);break}default:return void A.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const R=this._extensionsLoadNodeAsync(g,w,q);if(R)return R;if(w._babylonTransformNode)throw new Error(`${g}: Invalid recursive node hierarchy`);const o=new Array;this.logOpen(`${g} ${w.name||""}`);const r=R=>{if(K.AddPointerMetadata(R,g),K._LoadTransform(w,R),void 0!=w.camera){const q=Q.Get(`${g}/camera`,this._gltf.cameras,w.camera);o.push(this.loadCameraAsync(`/cameras/${q.index}`,q,(g=>{g.parent=R,this._babylonScene.useRightHandedSystem||(R.ei.x=-1)})))}if(w.children)for(const q of w.children){const w=Q.Get(`${g}/children/${q}`,this._gltf.nodes,q);o.push(this.loadNodeAsync(`/nodes/${w.index}`,w,(g=>{g.parent=R})))}q(R)},S=void 0!=w.mesh,i=this._parent.loadSkins&&void 0!=w.skin;if(!S||i){const g=w.name||`node${w.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new D.d(g,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==w.mesh?w._babylonTransformNode=q:w._babylonTransformNodeForSkin=q,r(q)}if(S)if(i){const q=Q.Get(`${g}/mesh`,this._gltf.meshes,w.mesh);o.push(this._loadMeshAsync(`/meshes/${q.index}`,w,q,(q=>{const R=w._babylonTransformNodeForSkin;q.metadata=(0,O.e)(R.metadata,q.metadata||{});const r=Q.Get(`${g}/skin`,this._gltf.skins,w.skin);o.push(this._loadSkinAsync(`/skins/${r.index}`,w,r,(g=>{this._forEachPrimitive(w,(w=>{w.skeleton=g})),this._postSceneLoadActions.push((()=>{if(void 0!=r.skeleton){const g=Q.Get(`/skins/${r.index}/skeleton`,this._gltf.nodes,r.skeleton).parent;w.index===g.index?q.parent=R.parent:q.parent=g._babylonTransformNode}else q.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:R,skinnedNode:q})}))})))})))}else{const q=Q.Get(`${g}/mesh`,this._gltf.meshes,w.mesh);o.push(this._loadMeshAsync(`/meshes/${q.index}`,w,q,r))}return this.logClose(),Promise.all(o).then((()=>(this._forEachPrimitive(w,(g=>{const w=g;!w.isAnInstance&&w.Ti&&w.Ti.useBoundingInfoFromGeometry?g.sg():g.refreshBoundingInfo(!0,!0)})),w._babylonTransformNode)))}_loadMeshAsync(g,w,q,R){const o=q.primitives;if(!o||!o.length)throw new Error(`${g}: Primitives are missing`);void 0==o[0].index&&Q.Assign(o);const r=new Array;this.logOpen(`${g} ${q.name||""}`);const S=w.name||`node${w.index}`;if(1===o.length){const R=q.primitives[0];r.push(this._loadMeshPrimitiveAsync(`${g}/primitives/${R.index}`,S,w,q,R,(g=>{w._babylonTransformNode=g,w._primitiveBabylonMeshes=[g]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,w._babylonTransformNode=new D.d(S,this._babylonScene),w._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w._primitiveBabylonMeshes=[];for(const R of o)r.push(this._loadMeshPrimitiveAsync(`${g}/primitives/${R.index}`,`${S}_primitive${R.index}`,w,q,R,(g=>{g.parent=w._babylonTransformNode,w._primitiveBabylonMeshes.push(g)})))}return R(w._babylonTransformNode),this.logClose(),Promise.all(r).then((()=>w._babylonTransformNode))}_loadMeshPrimitiveAsync(g,w,q,R,o,r){const S=this._extensionsLoadMeshPrimitiveAsync(g,w,q,R,o,r);if(S)return S;this.logOpen(`${g}`);const i=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==q.skin&&!R.primitives[0].targets;let T,z;if(i&&o._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,T=o._instanceData.babylonSourceMesh.createInstance(w),T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z=o._instanceData.promise;else{const r=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new H.d(w,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.sideOrientation=this._babylonScene.useRightHandedSystem?x.e.CounterClockWiseSideOrientation:x.e.ClockWiseSideOrientation,this._createMorphTargets(g,q,R,o,S),r.push(this._loadVertexDataAsync(g,o,S).then((async w=>await this._loadMorphTargetsAsync(g,o,S,w).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,w.Mg(S),w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const t=K._GetDrawMode(g,o.mode);if(void 0==o.material){let g=this._defaultBabylonMaterialData[t];g||(g=this._createDefaultMaterial("__GLTFLoader._default",t),this._parent.onMaterialLoadedObservable.notifyObservers(g),this._defaultBabylonMaterialData[t]=g),S.material=g}else if(!this.parent.skipMaterials){const w=Q.Get(`${g}/material`,this._gltf.materials,o.material);r.push(this._loadMaterialAsync(`/materials/${w.index}`,w,S,t,(g=>{S.material=g})))}z=Promise.all(r),i&&(o._instanceData={babylonSourceMesh:S,promise:z}),T=S}return K.AddPointerMetadata(T,g),this._parent.onMeshLoadedObservable.notifyObservers(T),r(T),this.logClose(),z.then((()=>T))}_loadVertexDataAsync(g,w,q){const R=this._extensionsLoadVertexDataAsync(g,w,q);if(R)return R;const o=w.attributes;if(!o)throw new Error(`${g}: Attributes are missing`);const r=new Array,S=new N.b(q.name,this._babylonScene);if(void 0==w.indices)q.isUnIndexed=!0;else{const q=Q.Get(`${g}/indices`,this._gltf.accessors,w.indices);r.push(this._loadIndicesAccessorAsync(`/accessors/${q.index}`,q).then((g=>{S.setIndices(g)})))}const i=(w,R,i)=>{if(void 0==o[w])return;q._delayInfo=q._delayInfo||[],-1===q._delayInfo.indexOf(R)&&q._delayInfo.push(R);const T=Q.Get(`${g}/attributes/${w}`,this._gltf.accessors,o[w]);r.push(this._loadVertexAccessorAsync(`/accessors/${T.index}`,T,R).then((g=>{if(g.getKind()===U.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!q.skeleton){const g=X(T);g&&(S._boundingInfo=g,S.useBoundingInfoFromGeometry=!0)}S.setVerticesBuffer(g,T.count)}))),R==U.h.MatricesIndicesExtraKind&&(q.numBoneInfluencers=8),i&&i(T)};return i("POSITION",U.h.PositionKind),i("NORMAL",U.h.NormalKind),i("TANGENT",U.h.TangentKind),i("TEXCOORD_0",U.h.UVKind),i("TEXCOORD_1",U.h.UV2Kind),i("TEXCOORD_2",U.h.UV3Kind),i("TEXCOORD_3",U.h.UV4Kind),i("TEXCOORD_4",U.h.UV5Kind),i("TEXCOORD_5",U.h.UV6Kind),i("JOINTS_0",U.h.MatricesIndicesKind),i("WEIGHTS_0",U.h.MatricesWeightsKind),i("JOINTS_1",U.h.MatricesIndicesExtraKind),i("WEIGHTS_1",U.h.MatricesWeightsExtraKind),i("COLOR_0",U.h.ColorKind,(g=>{"VEC4"===g.type&&(q.hasVertexAlpha=!0)})),Promise.all(r).then((()=>S))}_createMorphTargets(g,w,q,R,o){if(!R.targets||!this._parent.loadMorphTargets)return;if(void 0==w._numMorphTargets)w._numMorphTargets=R.targets.length;else if(R.targets.length!==w._numMorphTargets)throw new Error(`${g}: Primitives do not have the same number of targets`);const r=q.extras?q.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,o.morphTargetManager=new j(this._babylonScene),o.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.morphTargetManager.areUpdatesFrozen=!0;for(let S=0;S<R.targets.length;S++){const g=w.weights?w.weights[S]:q.weights?q.weights[S]:0,R=r?r[S]:`morphTarget${S}`;o.morphTargetManager.addTarget(new C.d(R,g,o.Ng()))}}_loadMorphTargetsAsync(g,w,q,R){if(!w.targets||!this._parent.loadMorphTargets)return Promise.resolve();const o=new Array,r=q.morphTargetManager;for(let S=0;S<r.numTargets;S++){const q=r.getTarget(S);o.push(this._loadMorphTargetVertexDataAsync(`${g}/targets/${S}`,R,w.targets[S],q))}return Promise.all(o).then((()=>{r.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(g,w,q,R){const o=new Array,r=(R,r,S)=>{if(void 0==q[R])return;const i=w.getVertexBuffer(r);if(!i)return;const T=Q.Get(`${g}/${R}`,this._gltf.accessors,q[R]);o.push(this._loadFloatAccessorAsync(`/accessors/${T.index}`,T).then((g=>{S(i,g)})))};return r("POSITION",U.h.PositionKind,((g,w)=>{const q=new Float32Array(w.length);g.forEach(w.length,((g,R)=>{q[R]=w[R]+g})),R.setPositions(q)})),r("NORMAL",U.h.NormalKind,((g,w)=>{const q=new Float32Array(w.length);g.forEach(q.length,((g,R)=>{q[R]=w[R]+g})),R.setNormals(q)})),r("TANGENT",U.h.TangentKind,((g,w)=>{const q=new Float32Array(w.length/3*4);let o=0;g.forEach(w.length/3*4,((g,R)=>{(R+1)%4!==0&&(q[o]=w[o]+g,o++)})),R.setTangents(q)})),r("TEXCOORD_0",U.h.UVKind,((g,w)=>{const q=new Float32Array(w.length);g.forEach(w.length,((g,R)=>{q[R]=w[R]+g})),R.setUVs(q)})),r("TEXCOORD_1",U.h.UV2Kind,((g,w)=>{const q=new Float32Array(w.length);g.forEach(w.length,((g,R)=>{q[R]=w[R]+g})),R.setUV2s(q)})),r("COLOR_0",U.h.ColorKind,((w,q)=>{let o=null;const r=w.getSize();if(3===r){o=new Float32Array(q.length/3*4),w.forEach(q.length,((g,w)=>{const R=Math.floor(w/3),r=w%3;o[4*R+r]=q[3*R+r]+g}));for(let g=0;g<q.length/3;++g)o[4*g+3]=1}else{if(4!==r)throw new Error(`${g}: Invalid number of components (${r}) for COLOR_0 attribute`);o=new Float32Array(q.length),w.forEach(q.length,((g,w)=>{o[w]=q[w]+g}))}R.setColors(o)})),await Promise.all(o).then((()=>{}))}static _LoadTransform(g,w){if(void 0!=g.skin)return;let q=o.ew.Zero(),R=o.Quaternion.Identity(),r=o.ew.One();if(g.matrix){o.Matrix.Ri(g.matrix).decompose(r,R,q)}else g.translation&&(q=o.ew.Ri(g.translation)),g.rotation&&(R=o.Quaternion.Ri(g.rotation)),g.scale&&(r=o.ew.Ri(g.scale));w.position=q,w.rotationQuaternion=R,w.ei=r}_loadSkinAsync(g,w,q,R){if(!this._parent.loadSkins)return Promise.resolve();const o=this._extensionsLoadSkinAsync(g,w,q);if(o)return o;if(q._data)return R(q._data.babylonSkeleton),q._data.promise;const r=`skeleton${q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new J(q.name||r,r,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(g,q,S);const i=this._loadSkinInverseBindMatricesDataAsync(g,q).then((g=>{this._updateBoneMatrices(S,g)}));return q._data={babylonSkeleton:S,promise:i},R(S),i}_loadBones(g,w,q){if(void 0==w.skeleton||this._parent.alwaysComputeSkeletonRootNode){const q=this._findSkeletonRootNode(`${g}/joints`,w.joints);if(q)if(void 0===w.skeleton)w.skeleton=q.index;else{const R=(g,w)=>{for(;w.parent;w=w.parent)if(w.parent===g)return!0;return!1},o=Q.Get(`${g}/skeleton`,this._gltf.nodes,w.skeleton);o===q||R(o,q)||(A.d.Warn(`${g}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),w.skeleton=q.index)}else A.d.Warn(`${g}: Failed to find common root`)}const R={};for(const o of w.joints){const r=Q.Get(`${g}/joints/${o}`,this._gltf.nodes,o);this._loadBone(r,w,q,R)}}_findSkeletonRootNode(g,w){if(0===w.length)return null;const q={};for(const o of w){const w=[];let R=Q.Get(`${g}/${o}`,this._gltf.nodes,o);for(;-1!==R.index;)w.unshift(R),R=R.parent;q[o]=w}let R=null;for(let o=0;;++o){let g=q[w[0]];if(o>=g.length)return R;const r=g[o];for(let S=1;S<w.length;++S)if(g=q[w[S]],o>=g.length||r!==g[o])return R;R=r}}_loadBone(g,w,q,R){g._isJoint=!0;let o=R[g.index];if(o)return o;let r=null;g.index!==w.skeleton&&(g.parent&&-1!==g.parent.index?r=this._loadBone(g.parent,w,q,R):void 0!==w.skeleton&&A.d.Warn(`/skins/${w.index}/skeleton: Skeleton node is not a common root`));const S=w.joints.indexOf(g.index);return o=new z.e(g.name||`joint${g.index}`,q,r,this._getNodeMatrix(g),null,null,S),R[g.index]=o,this._postSceneLoadActions.push((()=>{o.linkTransformNode(g._babylonTransformNode)})),o}_loadSkinInverseBindMatricesDataAsync(g,w){if(void 0==w.inverseBindMatrices)return Promise.resolve(null);const q=Q.Get(`${g}/inverseBindMatrices`,this._gltf.accessors,w.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${q.index}`,q)}_updateBoneMatrices(g,w){for(const q of g.bones){const g=o.Matrix.Identity(),R=q._index;w&&-1!==R&&(o.Matrix.FromArrayToRef(w,16*R,g),g.invertToRef(g));const r=q.getParent();r&&g.multiplyToRef(r.getAbsoluteInverseBindMatrix(),g),q.Si(g,!1,!1),q._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(g){return g.matrix?o.Matrix.Ri(g.matrix):o.Matrix.Compose(g.scale?o.ew.Ri(g.scale):o.ew.One(),g.rotation?o.Quaternion.Ri(g.rotation):o.Quaternion.Identity(),g.translation?o.ew.Ri(g.translation):o.ew.Zero())}loadCameraAsync(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const R=this._extensionsLoadCameraAsync(g,w,q);if(R)return R;const r=new Array;this.logOpen(`${g} ${w.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new T.e(w.name||`camera${w.index}`,o.ew.Zero(),this._babylonScene,!1);switch(S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w._babylonCamera=S,S.setTarget(new o.ew(0,0,-1)),w.type){case"perspective":{const q=w.perspective;if(!q)throw new Error(`${g}: Camera perspective properties are missing`);S.fov=q.yfov,S.ri=q.znear,S.maxZ=q.zfar||0;break}case"orthographic":if(!w.orthographic)throw new Error(`${g}: Camera orthographic properties are missing`);S.mode=i.b.ORTHOGRAPHIC_CAMERA,S.orthoLeft=-w.orthographic.xmag,S.orthoRight=w.orthographic.xmag,S.orthoBottom=-w.orthographic.ymag,S.orthoTop=w.orthographic.ymag,S.ri=w.orthographic.znear,S.maxZ=w.orthographic.zfar;break;default:throw new Error(`${g}: Invalid camera type (${w.type})`)}return K.AddPointerMetadata(S,g),this._parent.onCameraLoadedObservable.notifyObservers(S),q(S),this.logClose(),Promise.all(r).then((()=>S))}_loadAnimationsAsync(){const g=this._gltf.animations;if(!g)return Promise.resolve();const w=new Array;for(let q=0;q<g.length;q++){const R=g[q];w.push(this.loadAnimationAsync(`/animations/${R.index}`,R).then((g=>{0===g.targetedAnimations.length&&g.dispose()})))}return Promise.all(w).then((()=>{}))}loadAnimationAsync(g,w){const R=this._extensionsLoadAnimationAsync(g,w);return R||q.e(78).then(q.bind(q,14265)).then((q=>{let{AnimationGroup:R}=q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new R(w.name||`animation${w.index}`,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w._babylonAnimationGroup=o;const r=new Array;Q.Assign(w.channels),Q.Assign(w.samplers);for(const S of w.channels)r.push(this._loadAnimationChannelAsync(`${g}/channels/${S.index}`,g,w,S,((g,w)=>{g.animations=g.animations||[],g.animations.push(w),o.addTargetedAnimation(w,g)})));return Promise.all(r).then((()=>(o.normalize(0),o)))}))}async _loadAnimationChannelAsync(g,w,R,o,r){const S=this._extensionsLoadAnimationChannelAsync(g,w,R,o,r);if(S)return await S;if(void 0==o.target.node)return await Promise.resolve();const i=Q.Get(`${g}/target/node`,this._gltf.nodes,o.target.node),T=o.target.path,z="weights"===T;if(z&&!i._numMorphTargets||!z&&!i._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!z&&!i._isJoint)return await Promise.resolve();let t;switch(await Promise.resolve().then(q.bind(q,12777)),T){case"translation":var m;t=null===(m=(0,f.d)("/nodes/{}/translation"))||void 0===m?void 0:m.interpolation;break;case"rotation":var e;t=null===(e=(0,f.d)("/nodes/{}/rotation"))||void 0===e?void 0:e.interpolation;break;case"scale":var y;t=null===(y=(0,f.d)("/nodes/{}/scale"))||void 0===y?void 0:y.interpolation;break;case"weights":var L;t=null===(L=(0,f.d)("/nodes/{}/weights"))||void 0===L?void 0:L.interpolation;break;default:throw new Error(`${g}/target/path: Invalid value (${o.target.path})`)}if(!t)throw new Error(`${g}/target/path: Could not find interpolation properties for target path (${o.target.path})`);const A={object:i,info:t};return await this._loadAnimationChannelFromTargetInfoAsync(g,w,R,o,A,r)}_loadAnimationChannelFromTargetInfoAsync(g,w,q,R,o,r){const S=this.parent.targetFps,i=1/S,T=Q.Get(`${g}/sampler`,q.samplers,R.sampler);return this._loadAnimationSamplerAsync(`${w}/samplers/${R.sampler}`,T).then((g=>{let w=0;const T=o.object,z=o.info;for(const o of z){const z=o.getStride(T),t=g.input,m=g.output,e=new Array(t.length);let y=0;switch(g.interpolation){case"STEP":for(let g=0;g<t.length;g++){const w=o.getValue(T,m,y,1);y+=z,e[g]={frame:t[g]*S,value:w,interpolation:1}}break;case"CUBICSPLINE":for(let g=0;g<t.length;g++){const w=o.getValue(T,m,y,i);y+=z;const q=o.getValue(T,m,y,1);y+=z;const R=o.getValue(T,m,y,i);y+=z,e[g]={frame:t[g]*S,inTangent:w,value:q,outTangent:R}}break;case"LINEAR":for(let g=0;g<t.length;g++){const w=o.getValue(T,m,y,1);y+=z,e[g]={frame:t[g]*S,value:w}}}if(y>0){const g=`${q.name||`animation${q.index}`}_channel${R.index}_${w}`,i=o.buildAnimations(T,g,S,e);for(const q of i)w++,r(q.babylonAnimatable,q.babylonAnimation)}}}))}_loadAnimationSamplerAsync(g,w){if(w._data)return w._data;const q=w.interpolation||"LINEAR";switch(q){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${g}/interpolation: Invalid value (${w.interpolation})`)}const R=Q.Get(`${g}/input`,this._gltf.accessors,w.input),o=Q.Get(`${g}/output`,this._gltf.accessors,w.output);return w._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${R.index}`,R),this._loadFloatAccessorAsync(`/accessors/${o.index}`,o)]).then((g=>{let[w,R]=g;return{input:w,interpolation:q,output:R}})),w._data}loadBufferAsync(g,w,q,R){const o=this._extensionsLoadBufferAsync(g,w,q,R);if(o)return o;if(!w._data)if(w.uri)w._data=this.loadUriAsync(`${g}/uri`,w,w.uri);else{if(!this._bin)throw new Error(`${g}: Uri is missing or the binary glTF is missing its binary chunk`);w._data=this._bin.readAsync(0,w.byteLength)}return w._data.then((w=>{try{return new Uint8Array(w.buffer,w.byteOffset+q,R)}catch(o){throw new Error(`${g}: ${o.message}`)}}))}loadBufferViewAsync(g,w){const q=this._extensionsLoadBufferViewAsync(g,w);if(q)return q;if(w._data)return w._data;const R=Q.Get(`${g}/buffer`,this._gltf.buffers,w.buffer);return w._data=this.loadBufferAsync(`/buffers/${R.index}`,R,w.byteOffset||0,w.byteLength),w._data}_loadAccessorAsync(g,w,q){if(w._data)return w._data;const R=K._GetNumComponents(g,w.type),o=R*U.h.GetTypeByteLength(w.componentType),r=R*w.count;if(void 0==w.bufferView)w._data=Promise.resolve(new q(r));else{const S=Q.Get(`${g}/bufferView`,this._gltf.bufferViews,w.bufferView);w._data=this.loadBufferViewAsync(`/bufferViews/${S.index}`,S).then((i=>{if(5126!==w.componentType||w.normalized||S.byteStride&&S.byteStride!==o){const g=new q(r);return U.h.ForEach(i,w.byteOffset||0,S.byteStride||o,R,w.componentType,g.length,w.normalized||!1,((w,q)=>{g[q]=w})),g}return K._GetTypedArray(g,w.componentType,i,w.byteOffset,r)}))}if(w.sparse){const r=w.sparse;w._data=w._data.then((S=>{const i=S,T=Q.Get(`${g}/sparse/indices/bufferView`,this._gltf.bufferViews,r.indices.bufferView),z=Q.Get(`${g}/sparse/values/bufferView`,this._gltf.bufferViews,r.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${T.index}`,T),this.loadBufferViewAsync(`/bufferViews/${z.index}`,z)]).then((S=>{let[T,z]=S;const t=K._GetTypedArray(`${g}/sparse/indices`,r.indices.componentType,T,r.indices.byteOffset,r.count),m=R*r.count;let e;if(5126!==w.componentType||w.normalized){const S=K._GetTypedArray(`${g}/sparse/values`,w.componentType,z,r.values.byteOffset,m);e=new q(m),U.h.ForEach(S,0,o,R,w.componentType,e.length,w.normalized||!1,((g,w)=>{e[w]=g}))}else e=K._GetTypedArray(`${g}/sparse/values`,w.componentType,z,r.values.byteOffset,m);let y=0;for(let g=0;g<t.length;g++){let w=t[g]*R;for(let g=0;g<R;g++)i[w++]=e[y++]}return i}))}))}return w._data}_loadFloatAccessorAsync(g,w){return this._loadAccessorAsync(g,w,Float32Array)}_loadIndicesAccessorAsync(g,w){if("SCALAR"!==w.type)throw new Error(`${g}/type: Invalid value ${w.type}`);if(5121!==w.componentType&&5123!==w.componentType&&5125!==w.componentType)throw new Error(`${g}/componentType: Invalid value ${w.componentType}`);if(w._data)return w._data;if(w.sparse){const q=K._GetTypedArrayConstructor(`${g}/componentType`,w.componentType);w._data=this._loadAccessorAsync(g,w,q)}else{const q=Q.Get(`${g}/bufferView`,this._gltf.bufferViews,w.bufferView);w._data=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((q=>K._GetTypedArray(g,w.componentType,q,w.byteOffset,w.count)))}return w._data}_loadVertexBufferViewAsync(g){if(g._babylonBuffer)return g._babylonBuffer;const w=this._babylonScene.getEngine();return g._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((g=>new U.e(w,g,!1))),g._babylonBuffer}_loadVertexAccessorAsync(g,w,q){var R;if(null!==(R=w._babylonVertexBuffer)&&void 0!==R&&R[q])return w._babylonVertexBuffer[q];w._babylonVertexBuffer||(w._babylonVertexBuffer={});const o=this._babylonScene.getEngine();if(w.sparse||void 0==w.bufferView)w._babylonVertexBuffer[q]=this._loadFloatAccessorAsync(g,w).then((g=>new U.h(o,g,q,!1)));else{const R=Q.Get(`${g}/bufferView`,this._gltf.bufferViews,w.bufferView);w._babylonVertexBuffer[q]=this._loadVertexBufferViewAsync(R).then((r=>{const S=K._GetNumComponents(g,w.type);return new U.h(o,r,q,!1,void 0,R.byteStride,void 0,w.byteOffset,S,w.componentType,w.normalized,!0,void 0,!0)}))}return w._babylonVertexBuffer[q]}_loadMaterialMetallicRoughnessPropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const R=new Array;return w&&(w.baseColorFactor?(q.albedoColor=r.Jw.Ri(w.baseColorFactor),q.alpha=w.baseColorFactor[3]):q.albedoColor=r.Jw.White(),q.metallic=void 0==w.metallicFactor?1:w.metallicFactor,q.roughness=void 0==w.roughnessFactor?1:w.roughnessFactor,w.baseColorTexture&&R.push(this.loadTextureInfoAsync(`${g}/baseColorTexture`,w.baseColorTexture,(g=>{g.name=`${q.name} (Base Color)`,q.albedoTexture=g}))),w.metallicRoughnessTexture&&(w.metallicRoughnessTexture.nonColorData=!0,R.push(this.loadTextureInfoAsync(`${g}/metallicRoughnessTexture`,w.metallicRoughnessTexture,(g=>{g.name=`${q.name} (Metallic Roughness)`,q.metallicTexture=g}))),q.useMetallnessFromMetallicTextureBlue=!0,q.useRoughnessFromMetallicTextureGreen=!0,q.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(R).then((()=>{}))}_loadMaterialAsync(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const r=this._extensionsLoadMaterialAsync(g,w,q,R,o);if(r)return r;w._data=w._data||{};let S=w._data[R];if(!S){this.logOpen(`${g} ${w.name||""}`);const q=this.createMaterial(g,w,R);S={babylonMaterial:q,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(g,w,q)},w._data[R]=S,K.AddPointerMetadata(q,g),this._parent.onMaterialLoadedObservable.notifyObservers(q),this.logClose()}return q&&(S.babylonMeshes.push(q),q.WS.addOnce((()=>{const g=S.babylonMeshes.indexOf(q);-1!==g&&S.babylonMeshes.splice(g,1)}))),o(S.babylonMaterial),S.promise.then((()=>S.babylonMaterial))}_createDefaultMaterial(g,w){this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new G.c(g,this._babylonScene);return q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.fillMode=w,q.enableSpecularAntiAliasing=!0,q.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,q.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,q.transparencyMode=G.c.PBRMATERIAL_OPAQUE,q.metallic=1,q.roughness=1,q}createMaterial(g,w,q){const R=this._extensionsCreateMaterial(g,w,q);if(R)return R;const o=w.name||`material${w.index}`;return this._createDefaultMaterial(o,q)}loadMaterialPropertiesAsync(g,w,q){const R=this._extensionsLoadMaterialPropertiesAsync(g,w,q);if(R)return R;const o=new Array;return o.push(this.loadMaterialBasePropertiesAsync(g,w,q)),w.pbrMetallicRoughness&&o.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${g}/pbrMetallicRoughness`,w.pbrMetallicRoughness,q)),this.loadMaterialAlphaProperties(g,w,q),Promise.all(o).then((()=>{}))}loadMaterialBasePropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const R=new Array;return q.emissiveColor=w.emissiveFactor?r.Jw.Ri(w.emissiveFactor):new r.Jw(0,0,0),w.doubleSided&&(q.ti=!1,q.twoSidedLighting=!0),w.normalTexture&&(w.normalTexture.nonColorData=!0,R.push(this.loadTextureInfoAsync(`${g}/normalTexture`,w.normalTexture,(g=>{g.name=`${q.name} (Normal)`,q.bumpTexture=g}))),q.invertNormalMapX=!this._babylonScene.useRightHandedSystem,q.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=w.normalTexture.scale&&q.bumpTexture&&(q.bumpTexture.level=w.normalTexture.scale),q.forceIrradianceInFragment=!0),w.occlusionTexture&&(w.occlusionTexture.nonColorData=!0,R.push(this.loadTextureInfoAsync(`${g}/occlusionTexture`,w.occlusionTexture,(g=>{g.name=`${q.name} (Occlusion)`,q.ambientTexture=g}))),q.useAmbientInGrayScale=!0,void 0!=w.occlusionTexture.strength&&(q.ambientTextureStrength=w.occlusionTexture.strength)),w.emissiveTexture&&R.push(this.loadTextureInfoAsync(`${g}/emissiveTexture`,w.emissiveTexture,(g=>{g.name=`${q.name} (Emissive)`,q.emissiveTexture=g}))),Promise.all(R).then((()=>{}))}loadMaterialAlphaProperties(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);switch(w.alphaMode||"OPAQUE"){case"OPAQUE":q.transparencyMode=G.c.PBRMATERIAL_OPAQUE,q.alpha=1;break;case"MASK":q.transparencyMode=G.c.PBRMATERIAL_ALPHATEST,q.alphaCutOff=void 0==w.alphaCutoff?.5:w.alphaCutoff,q.albedoTexture&&(q.albedoTexture.oi=!0);break;case"BLEND":q.transparencyMode=G.c.PBRMATERIAL_ALPHABLEND,q.albedoTexture&&(q.albedoTexture.oi=!0,q.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${g}/alphaMode: Invalid value (${w.alphaMode})`)}}loadTextureInfoAsync(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const R=this._extensionsLoadTextureInfoAsync(g,w,q);if(R)return R;if(this.logOpen(`${g}`),w.texCoord>=6)throw new Error(`${g}/texCoord: Invalid value (${w.texCoord})`);const o=Q.Get(`${g}/index`,this._gltf.textures,w.index);o._textureInfo=w;const r=this._loadTextureAsync(`/textures/${w.index}`,o,(R=>{R.coordinatesIndex=w.texCoord||0,K.AddPointerMetadata(R,g),this._parent.onTextureLoadedObservable.notifyObservers(R),q(R)}));return this.logClose(),r}_loadTextureAsync(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const R=this._extensionsLoadTextureAsync(g,w,q);if(R)return R;this.logOpen(`${g} ${w.name||""}`);const o=void 0==w.sampler?K.DefaultSampler:Q.Get(`${g}/sampler`,this._gltf.samplers,w.sampler),r=Q.Get(`${g}/source`,this._gltf.images,w.source),S=this._createTextureAsync(g,o,r,q,void 0,!w._textureInfo.nonColorData);return this.logClose(),S}_createTextureAsync(g,w,q){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},r=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0;const i=this._loadSampler(`/samplers/${w.index}`,w),T=new Array,z=new R;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t={noMipmap:i.noMipMaps,invertY:!1,samplingMode:i.samplingMode,p:()=>{this._disposed||z.resolve()},onError:(w,q)=>{this._disposed||z.reject(new Error(`${g}: ${q&&q.message?q.message:w||"Failed to load texture"}`))},mimeType:q.mimeType??(0,V.g)(q.uri??""),loaderOptions:r,useSRGBBuffer:!!S&&this._parent.useSRGBBuffers},m=new d.e(null,this._babylonScene,t);return m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.push(z.promise),T.push(this.loadImageAsync(`/images/${q.index}`,q).then((g=>{const w=q.uri||`${this._fileName}#image${q.index}`,R=`data:${this._uniqueRootUrl}${w}`;m.updateURL(R,g);const o=m.getInternalTexture();o&&(o.label=q.name)}))),m.wrapU=i.wrapU,m.wrapV=i.wrapV,o(m),this._parent.useGltfTextureNames&&(m.name=q.name||q.uri||`image${q.index}`),Promise.all(T).then((()=>m))}_loadSampler(g,w){return w._data||(w._data={noMipMaps:9728===w.minFilter||9729===w.minFilter,samplingMode:K._GetTextureSamplingMode(g,w),wrapU:K._GetTextureWrapMode(`${g}/wrapS`,w.wrapS),wrapV:K._GetTextureWrapMode(`${g}/wrapT`,w.wrapT)}),w._data}loadImageAsync(g,w){if(!w._data){if(this.logOpen(`${g} ${w.name||""}`),w.uri)w._data=this.loadUriAsync(`${g}/uri`,w,w.uri);else{const q=Q.Get(`${g}/bufferView`,this._gltf.bufferViews,w.bufferView);w._data=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q)}this.logClose()}return w._data}loadUriAsync(g,w,q){const R=this._extensionsLoadUriAsync(g,w,q);if(R)return R;if(!K._ValidateUri(q))throw new Error(`${g}: '${q}' is invalid`);if((0,V.h)(q)){const w=new Uint8Array((0,V.b)(q));return this.log(`${g}: Decoded ${q.substring(0,64)}... (${w.length} bytes)`),Promise.resolve(w)}return this.log(`${g}: Loading ${q}`),this._parent.preprocessUrlAsync(this._rootUrl+q).then((w=>new Promise(((R,o)=>{this._parent._loadFile(this._babylonScene,w,(w=>{this._disposed||(this.log(`${g}: Loaded ${q} (${w.byteLength} bytes)`),R(new Uint8Array(w)))}),!0,(w=>{o(new V.k(`${g}: Failed to load '${q}'${w?": "+w.status+" "+w.statusText:""}`,w))}))}))))}static AddPointerMetadata(g,w){g.metadata=g.metadata||{};const q=g._internalMetadata=g._internalMetadata||{},R=q.IS=q.IS||{};(R.pointers=R.pointers||[]).push(w)}static _GetTextureWrapMode(g,w){switch(w=void 0==w?10497:w){case 33071:return d.e.CLAMP_ADDRESSMODE;case 33648:return d.e.MIRROR_ADDRESSMODE;case 10497:return d.e.WRAP_ADDRESSMODE;default:return A.d.Warn(`${g}: Invalid value (${w})`),d.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(g,w){const q=void 0==w.magFilter?9729:w.magFilter,R=void 0==w.minFilter?9987:w.minFilter;if(9729===q)switch(R){case 9728:return d.e.LINEAR_NEAREST;case 9729:return d.e.LINEAR_LINEAR;case 9984:return d.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return d.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return d.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return d.e.LINEAR_LINEAR_MIPLINEAR;default:return A.d.Warn(`${g}/minFilter: Invalid value (${R})`),d.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==q&&A.d.Warn(`${g}/magFilter: Invalid value (${q})`),R){case 9728:return d.e.NEAREST_NEAREST;case 9729:return d.e.NEAREST_LINEAR;case 9984:return d.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return d.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return d.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return d.e.NEAREST_LINEAR_MIPLINEAR;default:return A.d.Warn(`${g}/minFilter: Invalid value (${R})`),d.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(g,w){try{return(0,E.m)(w)}catch(q){throw new Error(`${g}: ${q.message}`)}}static _GetTypedArray(g,w,q,R,o){const r=q.buffer;R=q.byteOffset+(R||0);const S=K._GetTypedArrayConstructor(`${g}/componentType`,w),i=U.h.GetTypeByteLength(w);return R%i!==0?(A.d.Warn(`${g}: Copying buffer as byte offset (${R}) is not a multiple of component type byte length (${i})`),new S(r.slice(R,R+o*i),0)):new S(r,R,o)}static _GetNumComponents(g,w){switch(w){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${g}: Invalid type (${w})`)}static _ValidateUri(g){return S.Tools.IsBase64(g)||-1===g.indexOf("..")}static _GetDrawMode(g,w){switch(void 0==w&&(w=4),w){case 0:return x.e.PointListDrawMode;case 1:return x.e.LineListDrawMode;case 2:return x.e.LineLoopDrawMode;case 3:return x.e.LineStripDrawMode;case 4:return x.e.TriangleFillMode;case 5:return x.e.TriangleStripDrawMode;case 6:return x.e.TriangleFanDrawMode}throw new Error(`${g}: Invalid mesh primitive mode (${w})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const g=new Array;if(this._gltf.materials)for(const w of this._gltf.materials)if(w._data)for(const q in w._data){const R=w._data[q];for(const w of R.babylonMeshes){w.ii(!0);const q=R.babylonMaterial;g.push(q.forceCompilationAsync(w)),g.push(q.forceCompilationAsync(w,{useInstances:!0})),this._parent.useClipPlane&&(g.push(q.forceCompilationAsync(w,{clipPlane:!0})),g.push(q.forceCompilationAsync(w,{clipPlane:!0,useInstances:!0})))}}return Promise.all(g).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const g=new Array,w=this._babylonScene.lights;for(const q of w){const w=q.getShadowGenerator();w&&g.push(w.forceCompilationAsync())}return Promise.all(g).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(g){for(const w of this._extensions)w.enabled&&g(w)}_applyExtensions(g,w,q){for(const R of this._extensions)if(R.enabled){const o=`${R.name}.${w}`,r=g;r._activeLoaderExtensionFunctions=r._activeLoaderExtensionFunctions||{};const S=r._activeLoaderExtensionFunctions;if(!S[o]){S[o]=!0;try{const g=q(R);if(g)return g}finally{delete S[o]}}}return null}_extensionsOnLoading(){this._forEachExtensions((g=>g.onLoading&&g.onLoading()))}_extensionsOnReady(){this._forEachExtensions((g=>g.onReady&&g.onReady()))}_extensionsLoadSceneAsync(g,w){return this._applyExtensions(w,"loadScene",(q=>q.loadSceneAsync&&q.loadSceneAsync(g,w)))}_extensionsLoadNodeAsync(g,w,q){return this._applyExtensions(w,"loadNode",(R=>R.loadNodeAsync&&R.loadNodeAsync(g,w,q)))}_extensionsLoadCameraAsync(g,w,q){return this._applyExtensions(w,"loadCamera",(R=>R.loadCameraAsync&&R.loadCameraAsync(g,w,q)))}_extensionsLoadVertexDataAsync(g,w,q){return this._applyExtensions(w,"loadVertexData",(R=>R._loadVertexDataAsync&&R._loadVertexDataAsync(g,w,q)))}_extensionsLoadMeshPrimitiveAsync(g,w,q,R,o,r){return this._applyExtensions(o,"loadMeshPrimitive",(S=>S._loadMeshPrimitiveAsync&&S._loadMeshPrimitiveAsync(g,w,q,R,o,r)))}_extensionsLoadMaterialAsync(g,w,q,R,o){return this._applyExtensions(w,"loadMaterial",(r=>r._loadMaterialAsync&&r._loadMaterialAsync(g,w,q,R,o)))}_extensionsCreateMaterial(g,w,q){return this._applyExtensions(w,"createMaterial",(R=>R.createMaterial&&R.createMaterial(g,w,q)))}_extensionsLoadMaterialPropertiesAsync(g,w,q){return this._applyExtensions(w,"loadMaterialProperties",(R=>R.loadMaterialPropertiesAsync&&R.loadMaterialPropertiesAsync(g,w,q)))}_extensionsLoadTextureInfoAsync(g,w,q){return this._applyExtensions(w,"loadTextureInfo",(R=>R.loadTextureInfoAsync&&R.loadTextureInfoAsync(g,w,q)))}_extensionsLoadTextureAsync(g,w,q){return this._applyExtensions(w,"loadTexture",(R=>R._loadTextureAsync&&R._loadTextureAsync(g,w,q)))}_extensionsLoadAnimationAsync(g,w){return this._applyExtensions(w,"loadAnimation",(q=>q.loadAnimationAsync&&q.loadAnimationAsync(g,w)))}_extensionsLoadAnimationChannelAsync(g,w,q,R,o){return this._applyExtensions(q,"loadAnimationChannel",(r=>r._loadAnimationChannelAsync&&r._loadAnimationChannelAsync(g,w,q,R,o)))}_extensionsLoadSkinAsync(g,w,q){return this._applyExtensions(q,"loadSkin",(R=>R._loadSkinAsync&&R._loadSkinAsync(g,w,q)))}_extensionsLoadUriAsync(g,w,q){return this._applyExtensions(w,"loadUri",(R=>R._loadUriAsync&&R._loadUriAsync(g,w,q)))}_extensionsLoadBufferViewAsync(g,w){return this._applyExtensions(w,"loadBufferView",(q=>q.loadBufferViewAsync&&q.loadBufferViewAsync(g,w)))}_extensionsLoadBufferAsync(g,w,q,R){return this._applyExtensions(w,"loadBuffer",(o=>o.loadBufferAsync&&o.loadBufferAsync(g,w,q,R)))}static LoadExtensionAsync(g,w,q,R){if(!w.extensions)return null;const o=w.extensions[q];return o?R(`${g}/extensions/${q}`,o):null}static LoadExtraAsync(g,w,q,R){if(!w.extras)return null;const o=w.extras[q];return o?R(`${g}/extras/${q}`,o):null}isExtensionUsed(g){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(g)}logOpen(g){this._parent._logOpen(g)}logClose(){this._parent._logClose()}log(g){this._parent._log(g)}startPerformanceCounter(g){this._parent._startPerformanceCounter(g)}endPerformanceCounter(g){this._parent._endPerformanceCounter(g)}}K.DefaultSampler={index:-1},M.d._CreateGLTF2Loader=g=>new K(g);var Y=q(12777),F=q(11345),u=q(11218),n=q(12780),W=q(12784);class p extends W.d{constructor(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",g),this._texture=g.getEngine().createRawCubeTexture(w,q,R,o,r,S,i,T)}update(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,g,w,q,R,o)}updateRGBDAsync(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,n.h)(this._texture,g,w,q,R).then((()=>{}))}clone(){return u.c.Clone((()=>{const g=this.Ng(),w=this._texture,q=new p(g,w._bufferViewArray,w.width,w.format,w.type,w.generateMipMaps,w.invertY,w.samplingMode,w._compression);return 13===w.source&&q.updateRGBDAsync(w._bufferViewArrayArray,w._sphericalPolynomial,w._lodGenerationScale,w._lodGenerationOffset),q}),this)}}const Z="EXT_lights_image_based";class I{constructor(g){this.name=Z,this._loader=g,this.enabled=this._loader.isExtensionUsed(Z)}dispose(){this._loader=null,delete this._lights}onLoading(){const g=this._loader.IS.extensions;if(g&&g[this.name]){const w=g[this.name];this._lights=w.lights}}loadSceneAsync(g,w){return K.LoadExtensionAsync(g,w,this.name,(async(q,R)=>{this._loader._allMaterialsDirtyRequired=!0;const o=new Array;o.push(this._loader.loadSceneAsync(g,w)),this._loader.logOpen(`${q}`);const r=Q.Get(`${q}/light`,this._lights,R.br);return o.push(this._loadLightAsync(`/extensions/${this.name}/lights/${R.br}`,r).then((g=>{this._loader.babylonScene.environmentTexture=g}))),this._loader.logClose(),await Promise.all(o).then((()=>{}))}))}_loadLightAsync(g,w){if(!w._loaded){const q=new Array;this._loader.logOpen(`${g}`);const R=new Array(w.specularImages.length);for(let o=0;o<w.specularImages.length;o++){const r=w.specularImages[o];R[o]=new Array(r.length);for(let w=0;w<r.length;w++){const S=`${g}/specularImages/${o}/${w}`;this._loader.logOpen(`${S}`);const i=r[w],T=Q.Get(S,this._loader.IS.images,i);q.push(this._loader.loadImageAsync(`/images/${i}`,T).then((g=>{R[o][w]=g}))),this._loader.logClose()}}this._loader.logClose(),w._loaded=Promise.all(q).then((async()=>{const q=new p(this._loader.babylonScene,null,w.specularImageSize);if(q.name=w.name||"environment",w._babylonTexture=q,void 0!=w.li&&(q.level=w.li),w.rotation){let g=o.Quaternion.Ri(w.rotation);this._loader.babylonScene.useRightHandedSystem||(g=o.Quaternion.Inverse(g)),o.Matrix.FromQuaternionToRef(g,q.getReflectionTextureMatrix())}if(!w.irradianceCoefficients)throw new Error(`${g}: Irradiance coefficients are missing`);const r=F.e.Ri(w.irradianceCoefficients);r.scaleInPlace(w.li),r.convertIrradianceToLambertianRadiance();const S=F.h.FromHarmonics(r),i=(R.length-1)/Math.log2(w.specularImageSize);return await q.updateRGBDAsync(R,S,i)}))}return w._loaded.then((()=>w._babylonTexture))}}B(Z),b(Z,!0,(g=>new I(g)));q(11694);const k="EXT_mesh_gpu_instancing";class gg{constructor(g){this.name=k,this._loader=g,this.enabled=this._loader.isExtensionUsed(k)}dispose(){this._loader=null}loadNodeAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(g,R)=>{this._loader._disableInstancedMesh++;const r=this._loader.loadNodeAsync(`/nodes/${w.index}`,w,q);if(this._loader._disableInstancedMesh--,!w._primitiveBabylonMeshes)return await r;const S=new Array;let i=0;const T=w=>{if(void 0==R.attributes[w])return void S.push(Promise.resolve(null));const q=Q.Get(`${g}/attributes/${w}`,this._loader.IS.accessors,R.attributes[w]);if(S.push(this._loader._loadFloatAccessorAsync(`/accessors/${q.bufferView}`,q)),0===i)i=q.count;else if(i!==q.count)throw new Error(`${g}/attributes: Instance buffer accessors do not have the same count.`)};return T("TRANSLATION"),T("ROTATION"),T("SCALE"),await r.then((async g=>{const[q,R,r]=await Promise.all(S),T=new Float32Array(16*i);o.TmpVectors.ew[0].mi(0,0,0),o.TmpVectors.Quaternion[0].mi(0,0,0,1),o.TmpVectors.ew[1].mi(1,1,1);for(let w=0;w<i;++w)q&&o.ew.FromArrayToRef(q,3*w,o.TmpVectors.ew[0]),R&&o.Quaternion.FromArrayToRef(R,4*w,o.TmpVectors.Quaternion[0]),r&&o.ew.FromArrayToRef(r,3*w,o.TmpVectors.ew[1]),o.Matrix.ComposeToRef(o.TmpVectors.ew[1],o.TmpVectors.Quaternion[0],o.TmpVectors.ew[0],o.TmpVectors.Matrix[0]),o.TmpVectors.Matrix[0].copyToArray(T,16*w);for(const o of w._primitiveBabylonMeshes)o.Tm("matrix",T,16,!0);return g}))}))}}B(k),b(k,!0,(g=>new gg(g)));let wg=0,qg=null;class Rg{static get Default(){return Rg._Default||(Rg._Default=new Rg),Rg._Default}constructor(){const g=Rg.Configuration.decoder;this._decoderModulePromise=S.Tools.LoadBabylonScriptAsync(g.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(g,w,q,R,o){await this._decoderModulePromise,0===wg&&(MeshoptDecoder.useWorkers(1),wg=1);const r=await MeshoptDecoder.decodeGltfBufferAsync(w,q,g,R,o);return null!==qg&&clearTimeout(qg),qg=setTimeout((()=>{MeshoptDecoder.useWorkers(0),wg=0,qg=null}),1e3),r}}Rg.Configuration={decoder:{url:`${S.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Rg._Default=null;const og="EXT_meshopt_compression";class rg{constructor(g){this.name=og,this.enabled=g.isExtensionUsed(og),this._loader=g}dispose(){this._loader=null}loadBufferViewAsync(g,w){return K.LoadExtensionAsync(g,w,this.name,(async(q,R)=>{const o=w;if(o._meshOptData)return await o._meshOptData;const r=Q.Get(`${g}/buffer`,this._loader.IS.buffers,R.buffer);return o._meshOptData=this._loader.loadBufferAsync(`/buffers/${r.index}`,r,R.byteOffset||0,R.byteLength).then((async g=>await Rg.Default.decodeGltfBufferAsync(g,R.count,R.byteStride,R.mode,R.filter))),await o._meshOptData}))}}B(og),b(og,!0,(g=>new rg(g)));const Sg="EXT_texture_webp";class ig{constructor(g){this.name=Sg,this._loader=g,this.enabled=g.isExtensionUsed(Sg)}dispose(){this._loader=null}_loadTextureAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=void 0==w.sampler?K.DefaultSampler:Q.Get(`${g}/sampler`,this._loader.IS.samplers,w.sampler),S=Q.Get(`${R}/source`,this._loader.IS.images,o.source);return await this._loader._createTextureAsync(g,r,S,(g=>{q(g)}),void 0,!w._textureInfo.nonColorData)}))}}B(Sg),b(Sg,!0,(g=>new ig(g)));const Tg="EXT_texture_avif";class zg{constructor(g){this.name=Tg,this._loader=g,this.enabled=g.isExtensionUsed(Tg)}dispose(){this._loader=null}_loadTextureAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=void 0==w.sampler?K.DefaultSampler:Q.Get(`${g}/sampler`,this._loader.IS.samplers,w.sampler),S=Q.Get(`${R}/source`,this._loader.IS.images,o.source);return await this._loader._createTextureAsync(g,r,S,(g=>{q(g)}),void 0,!w._textureInfo.nonColorData)}))}}B(Tg),b(Tg,!0,(g=>new zg(g)));var tg=q(12774),mg=q(11670);const eg="EXT_lights_ies";class yg{constructor(g){this.name=eg,this._loader=g,this.enabled=this._loader.isExtensionUsed(eg)}dispose(){this._loader=null,delete this._lights}onLoading(){const g=this._loader.IS.extensions;if(g&&g[this.name]){const w=g[this.name];this._lights=w.lights,Q.Assign(this._lights)}}loadNodeAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,S)=>{let i,T;this._loader._allMaterialsDirtyRequired=!0;const z=await this._loader.loadNodeAsync(g,w,(g=>{T=Q.Get(R,this._lights,S.br);const w=T.name||g.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,i=new tg.b(w,o.ew.Zero(),o.ew.Backward(),0,1,this._loader.babylonScene),i.angle=Math.PI/2,i.innerAngle=0,i._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,T._babylonLight=i,i.falloffType=mg.d.FALLOFF_GLTF,i.Ji=S.color?r.Jw.Ri(S.color):r.Jw.White(),i.li=S.multiplier||1,i.range=Number.MAX_VALUE,i.parent=g,this._loader._babylonLights.push(i),K.AddPointerMetadata(i,R),q(g)}));let t;if(T.uri)t=await this._loader.loadUriAsync(g,T,T.uri);else{const w=Q.Get(`${g}/bufferView`,this._loader.IS.bufferViews,T.bufferView);t=await this._loader.loadBufferViewAsync(`/bufferViews/${w.index}`,w)}return i.iesProfileTexture=new d.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,t,!0,void 0,void 0,void 0,void 0,".ies"),z}))}}B(eg),b(eg,!0,(g=>new yg(g)));var Lg=q(12801);const Ag="KHR_draco_mesh_compression";class lg{constructor(g){this.name=Ag,this.useNormalizedFlagFromAccessor=!0,this._loader=g,this.enabled=Lg.b.DefaultAvailable&&this._loader.isExtensionUsed(Ag)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{if(void 0!=w.mode&&4!==w.mode&&5!==w.mode)throw new Error(`${g}: Unsupported mode ${w.mode}`);const r={},S={},i=(g,R)=>{const i=o.attributes[g];if(void 0!=i&&(q._delayInfo=q._delayInfo||[],-1===q._delayInfo.indexOf(R)&&q._delayInfo.push(R),r[R]=i,this.useNormalizedFlagFromAccessor)){const q=Q.TryGet(this._loader.IS.accessors,w.attributes[g]);q&&(S[R]=q.normalized||!1)}};i("POSITION",U.h.PositionKind),i("NORMAL",U.h.NormalKind),i("TANGENT",U.h.TangentKind),i("TEXCOORD_0",U.h.UVKind),i("TEXCOORD_1",U.h.UV2Kind),i("TEXCOORD_2",U.h.UV3Kind),i("TEXCOORD_3",U.h.UV4Kind),i("TEXCOORD_4",U.h.UV5Kind),i("TEXCOORD_5",U.h.UV6Kind),i("JOINTS_0",U.h.MatricesIndicesKind),i("WEIGHTS_0",U.h.MatricesWeightsKind),i("COLOR_0",U.h.ColorKind);const T=Q.Get(R,this._loader.IS.bufferViews,o.bufferView);return T._dracoBabylonGeometry||(T._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${T.index}`,T).then((async R=>{const o=this.dracoDecoder||Lg.b.Default,i=Q.TryGet(this._loader.IS.accessors,w.attributes.POSITION),T=this._loader.parent.alwaysComputeBoundingBox||q.skeleton||!i?null:X(i);return await o._decodeMeshToGeometryForGltfAsync(q.name,this._loader.babylonScene,R,r,S,T).catch((w=>{throw new Error(`${g}: ${w.message}`)}))}))),await T._dracoBabylonGeometry}))}}B(Ag),b(Ag,!0,(g=>new lg(g)));var Jg=q(12808),xg=q(11161),Gg=q(11170),dg=q(11559),Dg=q(11728),Ug=q(11128);dg.b.AddNodeConstructor("Light_Type_0",((g,w)=>()=>new Ng(g,o.ew.Zero(),w)));class Ng extends Dg.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(g){this._shadowAngle=g,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(g){const w=this.needCube();if(this._direction=g,this.needCube()!==w&&this._shadowGenerators){const g=this._shadowGenerators.values();for(let w=g.next();!0!==w.done;w=g.next()){w.value.recreateShadowMap()}}}constructor(g,w,q){super(g,q),this._shadowAngle=Math.PI/2,this.position=w}getClassName(){return"PointLight"}getTypeID(){return mg.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(g){if(this.direction)return super.getShadowDirection(g);switch(g){case 0:return new o.ew(1,0,0);case 1:return new o.ew(-1,0,0);case 2:return new o.ew(0,-1,0);case 3:return new o.ew(0,1,0);case 4:return new o.ew(0,0,1);case 5:return new o.ew(0,0,-1)}return o.ew.Zero()}_setDefaultShadowProjectionMatrix(g,w,q){const R=this.Ng().activeCamera;if(!R)return;const r=void 0!==this.shadowMinZ?this.shadowMinZ:R.ri,S=void 0!==this.shadowMaxZ?this.shadowMaxZ:R.maxZ,i=this.Ng().getEngine().useReverseDepthBuffer;o.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,i?S:r,i?r:S,g,!0,this._scene.getEngine().isNDCHalfZRange,void 0,i)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(g,w){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,w):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,w),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,w),this}transferToNodeMaterialEffect(g,w){return this.computeTransformedInformation()?g.setFloat3(w,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):g.setFloat3(w,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(g,w){g["POINTLIGHT"+w]=!0}}(0,xg.e)([(0,Gg.K)()],Ng.prototype,"shadowAngle",null),(0,Ug.g)("BABYLON.PointLight",Ng);const ag="KHR_lights_punctual";class Hg{constructor(g){this.name=ag,this._loader=g,this.enabled=this._loader.isExtensionUsed(ag)}dispose(){this._loader=null,delete this._lights}onLoading(){const g=this._loader.IS.extensions;if(g&&g[this.name]){const w=g[this.name];this._lights=w.lights,Q.Assign(this._lights)}}loadNodeAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,S)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(g,w,(g=>{let w;const i=Q.Get(R,this._lights,S.br),T=i.name||g.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,i.type){case"directional":{const g=new Jg.d(T,o.ew.Backward(),this._loader.babylonScene);g.position.yi(0),w=g;break}case"point":w=new Ng(T,o.ew.Zero(),this._loader.babylonScene);break;case"spot":{const g=new tg.b(T,o.ew.Zero(),o.ew.Backward(),0,1,this._loader.babylonScene);g.angle=2*(i.spot&&i.spot.outerConeAngle||Math.PI/4),g.innerAngle=2*(i.spot&&i.spot.innerConeAngle||0),w=g;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${R}: Invalid light type (${i.type})`)}w._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,i._babylonLight=w,w.falloffType=mg.d.FALLOFF_GLTF,w.Ji=i.color?r.Jw.Ri(i.color):r.Jw.White(),w.li=void 0==i.li?1:i.li,w.range=void 0==i.range?Number.MAX_VALUE:i.range,w.parent=g,this._loader._babylonLights.push(w),K.AddPointerMetadata(w,R),q(g)})))))}}B(ag),b(ag,!0,(g=>new Hg(g)));const Cg="KHR_materials_pbrSpecularGlossiness";class cg{constructor(g){this.name=Cg,this.order=200,this._loader=g,this.enabled=this._loader.isExtensionUsed(Cg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;return r.push(this._loader.loadMaterialBasePropertiesAsync(g,w,q)),r.push(this._loadSpecularGlossinessPropertiesAsync(R,o,q)),this._loader.loadMaterialAlphaProperties(g,w,q),await Promise.all(r).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const R=new Array;return q.metallic=null,q.roughness=null,w.diffuseFactor?(q.albedoColor=r.Jw.Ri(w.diffuseFactor),q.alpha=w.diffuseFactor[3]):q.albedoColor=r.Jw.White(),q.reflectivityColor=w.specularFactor?r.Jw.Ri(w.specularFactor):r.Jw.White(),q.microSurface=void 0==w.glossinessFactor?1:w.glossinessFactor,w.diffuseTexture&&R.push(this._loader.loadTextureInfoAsync(`${g}/diffuseTexture`,w.diffuseTexture,(g=>{g.name=`${q.name} (Diffuse)`,q.albedoTexture=g}))),w.specularGlossinessTexture&&(R.push(this._loader.loadTextureInfoAsync(`${g}/specularGlossinessTexture`,w.specularGlossinessTexture,(g=>{g.name=`${q.name} (Specular Glossiness)`,q.reflectivityTexture=g,q.reflectivityTexture.oi=!0}))),q.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(R).then((()=>{}))}}B(Cg),b(Cg,!0,(g=>new cg(g)));const Pg="KHR_materials_unlit";class jg{constructor(g){this.name=Pg,this.order=210,this._loader=g,this.enabled=this._loader.isExtensionUsed(Pg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async()=>await this._loadUnlitPropertiesAsync(g,w,q)))}_loadUnlitPropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const R=new Array;q.unlit=!0;const o=w.pbrMetallicRoughness;return o&&(o.baseColorFactor?(q.albedoColor=r.Jw.Ri(o.baseColorFactor),q.alpha=o.baseColorFactor[3]):q.albedoColor=r.Jw.White(),o.baseColorTexture&&R.push(this._loader.loadTextureInfoAsync(`${g}/baseColorTexture`,o.baseColorTexture,(g=>{g.name=`${q.name} (Base Color)`,q.albedoTexture=g})))),w.doubleSided&&(q.ti=!1,q.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(g,w,q),Promise.all(R).then((()=>{}))}}B(Pg),b(Pg,!0,(g=>new jg(g)));const Mg="KHR_materials_clearcoat";class Vg{constructor(g){this.name=Mg,this.order=190,this._loader=g,this.enabled=this._loader.isExtensionUsed(Mg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadClearCoatPropertiesAsync(R,o,q)),await Promise.all(r)}))}_loadClearCoatPropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const R=new Array;return q.clearCoat.isEnabled=!0,q.clearCoat.useRoughnessFromMainTexture=!1,q.clearCoat.remapF0OnInterfaceChange=!1,void 0!=w.clearcoatFactor?q.clearCoat.li=w.clearcoatFactor:q.clearCoat.li=0,w.clearcoatTexture&&R.push(this._loader.loadTextureInfoAsync(`${g}/clearcoatTexture`,w.clearcoatTexture,(g=>{g.name=`${q.name} (ClearCoat)`,q.clearCoat.texture=g}))),void 0!=w.clearcoatRoughnessFactor?q.clearCoat.roughness=w.clearcoatRoughnessFactor:q.clearCoat.roughness=0,w.clearcoatRoughnessTexture&&(w.clearcoatRoughnessTexture.nonColorData=!0,R.push(this._loader.loadTextureInfoAsync(`${g}/clearcoatRoughnessTexture`,w.clearcoatRoughnessTexture,(g=>{g.name=`${q.name} (ClearCoat Roughness)`,q.clearCoat.textureRoughness=g})))),w.clearcoatNormalTexture&&(w.clearcoatNormalTexture.nonColorData=!0,R.push(this._loader.loadTextureInfoAsync(`${g}/clearcoatNormalTexture`,w.clearcoatNormalTexture,(g=>{g.name=`${q.name} (ClearCoat Normal)`,q.clearCoat.bumpTexture=g}))),q.invertNormalMapX=!q.Ng().useRightHandedSystem,q.invertNormalMapY=q.Ng().useRightHandedSystem,void 0!=w.clearcoatNormalTexture.scale&&(q.clearCoat.bumpTexture.level=w.clearcoatNormalTexture.scale)),Promise.all(R).then((()=>{}))}}B(Mg),b(Mg,!0,(g=>new Vg(g)));const sg="KHR_materials_iridescence";class hg{constructor(g){this.name=sg,this.order=195,this._loader=g,this.enabled=this._loader.isExtensionUsed(sg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadIridescencePropertiesAsync(R,o,q)),await Promise.all(r).then((()=>{}))}))}_loadIridescencePropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const R=new Array;return q.iridescence.isEnabled=!0,q.iridescence.li=w.iridescenceFactor??0,q.iridescence.indexOfRefraction=w.iridescenceIor??w.iridescenceIOR??1.3,q.iridescence.minimumThickness=w.iridescenceThicknessMinimum??100,q.iridescence.maximumThickness=w.iridescenceThicknessMaximum??400,w.iridescenceTexture&&R.push(this._loader.loadTextureInfoAsync(`${g}/iridescenceTexture`,w.iridescenceTexture,(g=>{g.name=`${q.name} (Iridescence)`,q.iridescence.texture=g}))),w.iridescenceThicknessTexture&&R.push(this._loader.loadTextureInfoAsync(`${g}/iridescenceThicknessTexture`,w.iridescenceThicknessTexture,(g=>{g.name=`${q.name} (Iridescence Thickness)`,q.iridescence.thicknessTexture=g}))),Promise.all(R).then((()=>{}))}}B(sg),b(sg,!0,(g=>new hg(g)));const vg="KHR_materials_anisotropy";class bg{constructor(g){this.name=vg,this.order=195,this._loader=g,this.enabled=this._loader.isExtensionUsed(vg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadIridescencePropertiesAsync(R,o,q)),await Promise.all(r)}))}async _loadIridescencePropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const R=new Array;q.anisotropy.isEnabled=!0,q.anisotropy.li=w.anisotropyStrength??0,q.anisotropy.angle=w.anisotropyRotation??0,w.anisotropyTexture&&(w.anisotropyTexture.nonColorData=!0,R.push(this._loader.loadTextureInfoAsync(`${g}/anisotropyTexture`,w.anisotropyTexture,(g=>{g.name=`${q.name} (Anisotropy Intensity)`,q.anisotropy.texture=g})))),await Promise.all(R)}}B(vg),b(vg,!0,(g=>new bg(g)));const Bg="KHR_materials_emissive_strength";class fg{constructor(g){this.name=Bg,this.order=170,this._loader=g,this.enabled=this._loader.isExtensionUsed(Bg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>await this._loader.loadMaterialPropertiesAsync(g,w,q).then((()=>{this._loadEmissiveProperties(R,o,q)}))))}_loadEmissiveProperties(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);void 0!==w.emissiveStrength&&(q.emissiveIntensity=w.emissiveStrength)}}B(Bg),b(Bg,!0,(g=>new fg(g)));const Og="KHR_materials_sheen";class Eg{constructor(g){this.name=Og,this.order=190,this._loader=g,this.enabled=this._loader.isExtensionUsed(Og)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadSheenPropertiesAsync(R,o,q)),await Promise.all(r).then((()=>{}))}))}_loadSheenPropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const R=new Array;return q.sheen.isEnabled=!0,q.sheen.li=1,void 0!=w.sheenColorFactor?q.sheen.color=r.Jw.Ri(w.sheenColorFactor):q.sheen.color=r.Jw.Black(),w.sheenColorTexture&&R.push(this._loader.loadTextureInfoAsync(`${g}/sheenColorTexture`,w.sheenColorTexture,(g=>{g.name=`${q.name} (Sheen Color)`,q.sheen.texture=g}))),void 0!==w.sheenRoughnessFactor?q.sheen.roughness=w.sheenRoughnessFactor:q.sheen.roughness=0,w.sheenRoughnessTexture&&(w.sheenRoughnessTexture.nonColorData=!0,R.push(this._loader.loadTextureInfoAsync(`${g}/sheenRoughnessTexture`,w.sheenRoughnessTexture,(g=>{g.name=`${q.name} (Sheen Roughness)`,q.sheen.textureRoughness=g})))),q.sheen.albedoScaling=!0,q.sheen.useRoughnessFromMainTexture=!1,Promise.all(R).then((()=>{}))}}B(Og),b(Og,!0,(g=>new Eg(g)));var Qg=q(11617);const Xg="KHR_materials_specular";class Kg{constructor(g){this.name=Xg,this.order=190,this._loader=g,this.enabled=this._loader.isExtensionUsed(Xg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;if(r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadSpecularPropertiesAsync(R,o,q)),o.extensions&&o.extensions.EXT_materials_specular_edge_color&&q instanceof G.c){o.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(q.brdf.dielectricSpecularModel=Qg.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,q.brdf.conductorSpecularModel=Qg.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(r).then((()=>{}))}))}_loadSpecularPropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const R=new Array;return void 0!==w.specularFactor&&(q.metallicF0Factor=w.specularFactor),void 0!==w.specularColorFactor&&(q.metallicReflectanceColor=r.Jw.Ri(w.specularColorFactor)),w.specularTexture&&(w.specularTexture.nonColorData=!0,R.push(this._loader.loadTextureInfoAsync(`${g}/specularTexture`,w.specularTexture,(g=>{g.name=`${q.name} (Specular)`,q.metallicReflectanceTexture=g,q.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),w.specularColorTexture&&R.push(this._loader.loadTextureInfoAsync(`${g}/specularColorTexture`,w.specularColorTexture,(g=>{g.name=`${q.name} (Specular Color)`,q.reflectanceTexture=g}))),Promise.all(R).then((()=>{}))}}B(Xg),b(Xg,!0,(g=>new Kg(g)));const Yg="KHR_materials_ior";class Fg{constructor(g){this.name=Yg,this.order=180,this._loader=g,this.enabled=this._loader.isExtensionUsed(Yg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadIorPropertiesAsync(R,o,q)),await Promise.all(r).then((()=>{}))}))}_loadIorPropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);return void 0!==w.ior?q.indexOfRefraction=w.ior:q.indexOfRefraction=Fg._DEFAULT_IOR,Promise.resolve()}}Fg._DEFAULT_IOR=1.5,B(Yg),b(Yg,!0,(g=>new Fg(g)));const ug="KHR_materials_variants";class ng{constructor(g){this.name=ug,this._loader=g,this.enabled=this._loader.isExtensionUsed(ug)}dispose(){this._loader=null}static GetAvailableVariants(g){const w=this._GetExtensionMetadata(g);return w?Object.keys(w.variants):[]}getAvailableVariants(g){return ng.GetAvailableVariants(g)}static SelectVariant(g,w){const q=this._GetExtensionMetadata(g);if(!q)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${ug} extension`);const R=g=>{const w=q.variants[g];if(w)for(const q of w)q.mesh.material=q.material};if(w instanceof Array)for(const o of w)R(o);else R(w);q.lastSelected=w}selectVariant(g,w){ng.SelectVariant(g,w)}static Reset(g){const w=this._GetExtensionMetadata(g);if(!w)throw new Error(`Cannot reset on a glTF mesh that does not have the ${ug} extension`);for(const q of w.original)q.mesh.material=q.material;w.lastSelected=null}reset(g){ng.Reset(g)}static GetLastSelectedVariant(g){const w=this._GetExtensionMetadata(g);if(!w)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${ug} extension`);return w.lastSelected}getLastSelectedVariant(g){return ng.GetLastSelectedVariant(g)}static _GetExtensionMetadata(g){var w,q;return(null===g||void 0===g||null===(w=g._internalMetadata)||void 0===w||null===(q=w.IS)||void 0===q?void 0:q[ug])||null}onLoading(){const g=this._loader.IS.extensions;if(g&&g[this.name]){const w=g[this.name];this._variants=w.variants}}onReady(){const g=this._loader.rootBabylonMesh;if(g){var w;const q=this._loader.parent.extensionOptions[ug];null!==q&&void 0!==q&&q.defaultVariant&&ng.SelectVariant(g,q.defaultVariant),null===q||void 0===q||null===(w=q.onLoaded)||void 0===w||w.call(q,{get variants(){return ng.GetAvailableVariants(g)},get selectedVariant(){const w=ng.GetLastSelectedVariant(g);return w?Array.isArray(w)?w[0]:w:ng.GetAvailableVariants(g)[0]},set selectedVariant(w){ng.SelectVariant(g,w)}})}}_loadMeshPrimitiveAsync(g,w,q,R,o,r){return K.LoadExtensionAsync(g,o,this.name,(async(S,i)=>{const T=new Array;return T.push(this._loader._loadMeshPrimitiveAsync(g,w,q,R,o,(w=>{if(r(w),w instanceof H.d){const q=K._GetDrawMode(g,o.mode),R=this._loader.rootBabylonMesh,r=R?R._internalMetadata=R._internalMetadata||{}:{},z=r.IS=r.IS||{},t=z[ug]=z[ug]||{lastSelected:null,original:[],variants:{}};t.original.push({mesh:w,material:w.material});for(let g=0;g<i.mappings.length;++g){const o=i.mappings[g],r=Q.Get(`${S}/mappings/${g}/material`,this._loader.IS.materials,o.material);T.push(this._loader._loadMaterialAsync(`#/materials/${o.material}`,r,w,q,(g=>{for(let q=0;q<o.variants.length;++q){const r=o.variants[q],S=Q.Get(`/extensions/${ug}/variants/${r}`,this._variants,r);t.variants[S.name]=t.variants[S.name]||[],t.variants[S.name].push({mesh:w,material:g}),w.onClonedObservable.add((g=>{const q=g;let o=null,r=q;do{if(r=r.parent,!r)return;o=ng._GetExtensionMetadata(r)}while(null===o);if(R&&o===ng._GetExtensionMetadata(R)){r._internalMetadata={};for(const g in R._internalMetadata)r._internalMetadata[g]=R._internalMetadata[g];r._internalMetadata.IS=[];for(const g in R._internalMetadata.IS)r._internalMetadata.IS[g]=R._internalMetadata.IS[g];r._internalMetadata.IS[ug]={lastSelected:null,original:[],variants:{}};for(const g of o.original)r._internalMetadata.IS[ug].original.push({mesh:g.mesh,material:g.material});for(const g in o.variants)if(Object.prototype.hasOwnProperty.call(o.variants,g)){r._internalMetadata.IS[ug].variants[g]=[];for(const w of o.variants[g])r._internalMetadata.IS[ug].variants[g].push({mesh:w.mesh,material:w.material})}o=r._internalMetadata.IS[ug]}for(const R of o.original)R.mesh===w&&(R.mesh=q);for(const R of o.variants[S.name])R.mesh===w&&(R.mesh=q)}))}})))}}}))),await Promise.all(T).then((g=>{let[w]=g;return w}))}))}}B(ug),b(ug,!0,(g=>new ng(g)));var Wg=q(11244);class pg{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Qg.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(g,w){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...pg._GetDefaultOptions(),...g},this._scene=w,this._scene._transmissionHelper=this,this.onErrorObservable=new t.b,this._scene.WS.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(g){if(!Object.keys(g).filter((w=>this._options[w]!==g[w])).length)return;const w={...this._options,...g},q=this._options;this._options=w,w.renderSize===q.renderSize&&w.renderTargetTextureType===q.renderTargetTextureType&&w.generateMipmaps===q.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=w.samples,this._opaqueRenderTarget.lodGenerationScale=w.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=w.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(g){return!!g&&!!(g instanceof G.c&&g.subSurface.isRefractionEnabled)}_addMesh(g){this._materialObservers[g.uniqueId]=g.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),S.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(g.material)?(g.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(g)&&this._transparentMeshesCache.push(g)):-1===this._opaqueMeshesCache.indexOf(g)&&this._opaqueMeshesCache.push(g)}))}_removeMesh(g){g.onMaterialChangedObservable.remove(this._materialObservers[g.uniqueId]),delete this._materialObservers[g.uniqueId];let w=this._transparentMeshesCache.indexOf(g);-1!==w&&this._transparentMeshesCache.splice(w,1),w=this._opaqueMeshesCache.indexOf(g),-1!==w&&this._opaqueMeshesCache.splice(w,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(g){const w=this._transparentMeshesCache.indexOf(g),q=this._opaqueMeshesCache.indexOf(g);this._shouldRenderAsTransmission(g.material)?(g.material instanceof G.c&&(g.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==q?(this._opaqueMeshesCache.splice(q,1),this._transparentMeshesCache.push(g)):-1===w&&this._transparentMeshesCache.push(g)):-1!==w?(this._transparentMeshesCache.splice(w,1),this._opaqueMeshesCache.push(g)):-1===q&&this._opaqueMeshesCache.push(g)}_isRenderTargetValid(){var g;return null!==(null===(g=this._opaqueRenderTarget)||void 0===g?void 0:g.getInternalTexture())}_setupRenderTargets(){var g;let w;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Wg.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(g=this._options.clearColor)||void 0===g?void 0:g.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((g=>{w=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?g.clearColor.T(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(g.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=w}));for(const q of this._transparentMeshesCache)this._shouldRenderAsTransmission(q.material)&&(q.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Zg="KHR_materials_transmission";class Ig{constructor(g){this.name=Zg,this.order=175,this._loader=g,this.enabled=this._loader.isExtensionUsed(Zg),this.enabled&&(g.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadTransparentPropertiesAsync(R,w,q,o)),await Promise.all(r).then((()=>{}))}))}_loadTransparentPropertiesAsync(g,w,q,R){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const o=q;if(o.subSurface.isRefractionEnabled=!0,o.subSurface.volumeIndexOfRefraction=1,o.subSurface.useAlbedoToTintRefraction=!0,void 0===R.transmissionFactor)return o.subSurface.refractionIntensity=0,o.subSurface.isRefractionEnabled=!1,Promise.resolve();{var r;o.subSurface.refractionIntensity=R.transmissionFactor;const g=o.Ng();if(o.subSurface.refractionIntensity&&!g._transmissionHelper)new pg({},o.Ng());else if(o.subSurface.refractionIntensity&&(null===(r=g._transmissionHelper)||void 0===r||!r._isRenderTargetValid())){var S;null===(S=g._transmissionHelper)||void 0===S||S._setupRenderTargets()}}return o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=0,R.transmissionTexture?(R.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${g}/transmissionTexture`,R.transmissionTexture,void 0).then((g=>{g.name=`${q.name} (Transmission)`,o.subSurface.refractionIntensityTexture=g,o.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}B(Zg),b(Zg,!0,(g=>new Ig(g)));const kg="KHR_materials_diffuse_transmission";class gw{constructor(g){this.name=kg,this.order=174,this._loader=g,this.enabled=this._loader.isExtensionUsed(kg),this.enabled&&(g.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadTranslucentPropertiesAsync(R,w,q,o)),await Promise.all(r).then((()=>{}))}))}_loadTranslucentPropertiesAsync(g,w,q,R){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const o=q;if(o.subSurface.isTranslucencyEnabled=!0,o.subSurface.volumeIndexOfRefraction=1,o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=0,o.subSurface.useAlbedoToTintTranslucency=!1,void 0===R.diffuseTransmissionFactor)return o.subSurface.translucencyIntensity=0,o.subSurface.isTranslucencyEnabled=!1,Promise.resolve();o.subSurface.translucencyIntensity=R.diffuseTransmissionFactor;const S=new Array;return o.subSurface.useGltfStyleTextures=!0,R.diffuseTransmissionTexture&&(R.diffuseTransmissionTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${g}/diffuseTransmissionTexture`,R.diffuseTransmissionTexture).then((g=>{g.name=`${q.name} (Diffuse Transmission)`,o.subSurface.translucencyIntensityTexture=g})))),void 0!==R.diffuseTransmissionColorFactor?o.subSurface.translucencyColor=r.Jw.Ri(R.diffuseTransmissionColorFactor):o.subSurface.translucencyColor=r.Jw.White(),R.diffuseTransmissionColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${g}/diffuseTransmissionColorTexture`,R.diffuseTransmissionColorTexture).then((g=>{g.name=`${q.name} (Diffuse Transmission Color)`,o.subSurface.translucencyColorTexture=g}))),Promise.all(S).then((()=>{}))}}B(kg),b(kg,!0,(g=>new gw(g)));const ww="KHR_materials_volume";class qw{constructor(g){this.name=ww,this.order=173,this._loader=g,this.enabled=this._loader.isExtensionUsed(ww),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadVolumePropertiesAsync(R,w,q,o)),await Promise.all(r).then((()=>{}))}))}_loadVolumePropertiesAsync(g,w,q,R){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);if(!q.subSurface.isRefractionEnabled&&!q.subSurface.isTranslucencyEnabled||!R.thicknessFactor)return Promise.resolve();q.subSurface.volumeIndexOfRefraction=q.indexOfRefraction;const o=void 0!==R.attenuationDistance?R.attenuationDistance:Number.MAX_VALUE;return q.subSurface.tintColorAtDistance=o,void 0!==R.attenuationColor&&3==R.attenuationColor.length&&q.subSurface.tintColor.mi(R.attenuationColor[0],R.attenuationColor[1],R.attenuationColor[2]),q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=R.thicknessFactor,q.subSurface.useThicknessAsDepth=!0,R.thicknessTexture?(R.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${g}/thicknessTexture`,R.thicknessTexture).then((g=>{g.name=`${q.name} (Thickness)`,q.subSurface.thicknessTexture=g,q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}B(ww),b(ww,!0,(g=>new qw(g)));const Rw="KHR_materials_dispersion";class ow{constructor(g){this.name=Rw,this.order=174,this._loader=g,this.enabled=this._loader.isExtensionUsed(Rw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadDispersionPropertiesAsync(R,w,q,o)),await Promise.all(r).then((()=>{}))}))}_loadDispersionPropertiesAsync(g,w,q,R){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);return q.subSurface.isRefractionEnabled&&R.dispersion?(q.subSurface.isDispersionEnabled=!0,q.subSurface.dispersion=R.dispersion,Promise.resolve()):Promise.resolve()}}B(Rw),b(Rw,!0,(g=>new ow(g)));const rw="EXT_materials_diffuse_roughness";class Sw{constructor(g){this.name=rw,this.order=190,this._loader=g,this.enabled=this._loader.isExtensionUsed(rw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(g,w,q)),r.push(this._loadDiffuseRoughnessPropertiesAsync(R,o,q)),await Promise.all(r).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(g,w,q){if(!(q instanceof G.c))throw new Error(`${g}: Material type not supported`);const R=new Array;return q.brdf.baseDiffuseModel=Qg.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=w.diffuseRoughnessFactor?q.baseDiffuseRoughness=w.diffuseRoughnessFactor:q.baseDiffuseRoughness=0,w.diffuseRoughnessTexture&&R.push(this._loader.loadTextureInfoAsync(`${g}/diffuseRoughnessTexture`,w.diffuseRoughnessTexture,(g=>{g.name=`${q.name} (Diffuse Roughness)`,q.baseDiffuseRoughnessTexture=g}))),Promise.all(R).then((()=>{}))}}B(rw),b(rw,!0,(g=>new Sw(g)));const iw="KHR_mesh_quantization";class Tw{constructor(g){this.name=iw,this.enabled=g.isExtensionUsed(iw)}dispose(){}}B(iw),b(iw,!0,(g=>new Tw(g)));const zw="KHR_texture_basisu";class tw{constructor(g){this.name=zw,this._loader=g,this.enabled=g.isExtensionUsed(zw)}dispose(){this._loader=null}_loadTextureAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>{const r=void 0==w.sampler?K.DefaultSampler:Q.Get(`${g}/sampler`,this._loader.IS.samplers,w.sampler),S=Q.Get(`${R}/source`,this._loader.IS.images,o.source);return await this._loader._createTextureAsync(g,r,S,(g=>{q(g)}),w._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!w._textureInfo.nonColorData)}))}}B(zw),b(zw,!0,(g=>new tw(g)));const mw="KHR_texture_transform";class ew{constructor(g){this.name=mw,this._loader=g,this.enabled=this._loader.isExtensionUsed(mw)}dispose(){this._loader=null}loadTextureInfoAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(R,o)=>await this._loader.loadTextureInfoAsync(g,w,(g=>{if(!(g instanceof d.e))throw new Error(`${R}: Texture type not supported`);o.offset&&(g.uOffset=o.offset[0],g.vOffset=o.offset[1]),g.uRotationCenter=0,g.vRotationCenter=0,o.rotation&&(g.wAng=-o.rotation),o.scale&&(g.uScale=o.scale[0],g.vScale=o.scale[1]),void 0!=o.texCoord&&(g.coordinatesIndex=o.texCoord),q(g)}))))}}B(mw),b(mw,!0,(g=>new ew(g)));const yw="KHR_xmp_json_ld";class Lw{constructor(g){this.name=yw,this.order=100,this._loader=g,this.enabled=this._loader.isExtensionUsed(yw)}dispose(){this._loader=null}onLoading(){var g,w,q;if(null===this._loader.rootBabylonMesh)return;const R=null===(g=this._loader.IS.extensions)||void 0===g?void 0:g.KHR_xmp_json_ld,o=null===(w=this._loader.IS.asset)||void 0===w||null===(q=w.extensions)||void 0===q?void 0:q.KHR_xmp_json_ld;if(R&&o){const g=+o.packet;R.packets&&g<R.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=R.packets[g])}}}function Aw(g,w,q,R){return r.Jw.Ri(w,q).scale(R)}function lw(g,w,q,R){return w[q]*R}function Jw(g,w,q,R){return-w[q]*R}function xw(g,w,q,R){return w[q+1]*R}function Gw(g,w,q,R){return w[q]*R*2}function dw(g){return{scale:[new Uw(e.c.ANIMATIONTYPE_FLOAT,`${g}.uScale`,lw,(()=>2)),new Uw(e.c.ANIMATIONTYPE_FLOAT,`${g}.vScale`,xw,(()=>2))],offset:[new Uw(e.c.ANIMATIONTYPE_FLOAT,`${g}.uOffset`,lw,(()=>2)),new Uw(e.c.ANIMATIONTYPE_FLOAT,`${g}.vOffset`,xw,(()=>2))],rotation:[new Uw(e.c.ANIMATIONTYPE_FLOAT,`${g}.wAng`,Jw,(()=>1))]}}B(yw),b(yw,!0,(g=>new Lw(g)));class Dw extends Y.AnimationPropertyInfo{buildAnimations(g,w,q,R){return[{babylonAnimatable:g._babylonCamera,babylonAnimation:this._buildAnimation(w,q,R)}]}}class Uw extends Y.AnimationPropertyInfo{buildAnimations(g,w,q,R){const o=[];for(const r in g._data)o.push({babylonAnimatable:g._data[r].babylonMaterial,babylonAnimation:this._buildAnimation(w,q,R)});return o}}class Nw extends Y.AnimationPropertyInfo{buildAnimations(g,w,q,R){return[{babylonAnimatable:g._babylonLight,babylonAnimation:this._buildAnimation(w,q,R)}]}}(0,f.k)("/cameras/{}/orthographic/xmag",[new Dw(e.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Jw,(()=>1)),new Dw(e.c.ANIMATIONTYPE_FLOAT,"orthoRight",xw,(()=>1))]),(0,f.k)("/cameras/{}/orthographic/ymag",[new Dw(e.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Jw,(()=>1)),new Dw(e.c.ANIMATIONTYPE_FLOAT,"orthoTop",xw,(()=>1))]),(0,f.k)("/cameras/{}/orthographic/zfar",[new Dw(e.c.ANIMATIONTYPE_FLOAT,"maxZ",lw,(()=>1))]),(0,f.k)("/cameras/{}/orthographic/znear",[new Dw(e.c.ANIMATIONTYPE_FLOAT,"ri",lw,(()=>1))]),(0,f.k)("/cameras/{}/perspective/yfov",[new Dw(e.c.ANIMATIONTYPE_FLOAT,"fov",lw,(()=>1))]),(0,f.k)("/cameras/{}/perspective/zfar",[new Dw(e.c.ANIMATIONTYPE_FLOAT,"maxZ",lw,(()=>1))]),(0,f.k)("/cameras/{}/perspective/znear",[new Dw(e.c.ANIMATIONTYPE_FLOAT,"ri",lw,(()=>1))]),(0,f.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Uw(e.c.ANIMATIONTYPE_COLOR3,"albedoColor",Aw,(()=>4)),new Uw(e.c.ANIMATIONTYPE_FLOAT,"alpha",(function(g,w,q,R){return w[q+3]*R}),(()=>4))]),(0,f.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"metallic",lw,(()=>1))]),(0,f.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"roughness",lw,(()=>1))]);const aw=dw("albedoTexture");(0,f.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",aw.scale),(0,f.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",aw.offset),(0,f.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",aw.rotation);const Hw=dw("metallicTexture");(0,f.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Hw.scale),(0,f.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Hw.offset),(0,f.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Hw.rotation),(0,f.k)("/materials/{}/emissiveFactor",[new Uw(e.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Aw,(()=>3))]);const Cw=dw("bumpTexture");(0,f.k)("/materials/{}/normalTexture/scale",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",lw,(()=>1))]),(0,f.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Cw.scale),(0,f.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Cw.offset),(0,f.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Cw.rotation),(0,f.k)("/materials/{}/occlusionTexture/strength",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",lw,(()=>1))]);const cw=dw("ambientTexture");(0,f.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",cw.scale),(0,f.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",cw.offset),(0,f.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",cw.rotation);const Pw=dw("emissiveTexture");(0,f.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Pw.scale),(0,f.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Pw.offset),(0,f.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Pw.rotation),(0,f.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",lw,(()=>1))]);const jw=dw("anisotropy.texture");(0,f.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",jw.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",jw.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",jw.rotation),(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",lw,(()=>1))]);const Mw=dw("clearCoat.texture");(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Mw.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Mw.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Mw.rotation);const Vw=dw("clearCoat.bumpTexture");(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Vw.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Vw.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Vw.rotation);const sw=dw("clearCoat.textureRoughness");(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",sw.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",sw.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",sw.rotation),(0,f.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",lw,(()=>1))]);const hw=dw("iridescence.texture");(0,f.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",hw.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",hw.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",hw.rotation);const vw=dw("iridescence.thicknessTexture");(0,f.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",vw.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",vw.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",vw.rotation),(0,f.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Uw(e.c.ANIMATIONTYPE_COLOR3,"sheen.color",Aw,(()=>3))]),(0,f.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",lw,(()=>1))]);const bw=dw("sheen.texture");(0,f.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",bw.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",bw.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",bw.rotation);const Bw=dw("sheen.textureRoughness");(0,f.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Bw.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Bw.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Bw.rotation),(0,f.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Uw(e.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Aw,(()=>3))]);const fw=dw("metallicReflectanceTexture");(0,f.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",fw.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",fw.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",fw.rotation);const Ow=dw("reflectanceTexture");(0,f.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Ow.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Ow.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Ow.rotation),(0,f.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",lw,(()=>1))]);const Ew=dw("subSurface.refractionIntensityTexture");(0,f.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Ew.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Ew.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Ew.rotation),(0,f.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Uw(e.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Aw,(()=>3))]),(0,f.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",lw,(()=>1))]),(0,f.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",lw,(()=>1))]);const Qw=dw("subSurface.thicknessTexture");(0,f.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Qw.scale),(0,f.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Qw.offset),(0,f.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Qw.rotation),(0,f.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Uw(e.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",lw,(()=>1))]);const Xw=dw("subSurface.translucencyIntensityTexture");(0,f.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Xw.scale),(0,f.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Xw.offset),(0,f.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Xw.rotation),(0,f.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Uw(e.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Aw,(()=>3))]);const Kw=dw("subSurface.translucencyColorTexture");(0,f.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Kw.scale),(0,f.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Kw.offset),(0,f.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Kw.rotation),(0,f.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new Nw(e.c.ANIMATIONTYPE_COLOR3,"diffuse",Aw,(()=>3))]),(0,f.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Nw(e.c.ANIMATIONTYPE_FLOAT,"intensity",lw,(()=>1))]),(0,f.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new Nw(e.c.ANIMATIONTYPE_FLOAT,"range",lw,(()=>1))]),(0,f.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Nw(e.c.ANIMATIONTYPE_FLOAT,"innerAngle",Gw,(()=>1))]),(0,f.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Nw(e.c.ANIMATIONTYPE_FLOAT,"angle",Gw,(()=>1))]),(0,f.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new Nw(e.c.ANIMATIONTYPE_COLOR3,"diffuse",Aw,(()=>3))]),(0,f.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Nw(e.c.ANIMATIONTYPE_FLOAT,"intensity",lw,(()=>1))]);const Yw="KHR_animation_pointer";class Fw{constructor(g){this.name=Yw,this._loader=g,this._pathToObjectConverter=(0,f.h)(this._loader.IS)}get enabled(){return this._loader.isExtensionUsed(Yw)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(g,w,q,R,o){var r;const S=null===(r=R.target.extensions)||void 0===r?void 0:r.KHR_animation_pointer;if(!S||!this._pathToObjectConverter)return null;"pointer"!==R.target.path&&A.d.Warn(`${g}/target/path: Value (${R.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=R.target.node&&A.d.Warn(`${g}/target/node: Value (${R.target.node}) must not be present when using the ${this.name} extension`);const i=`${g}/extensions/${this.name}`,T=S.pointer;if(!T)throw new Error(`${i}: Pointer is missing`);try{const r=this._pathToObjectConverter.convert(T);if(!r.info.interpolation)throw new Error(`${i}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(g,w,q,R,{object:r.object,info:r.info.interpolation},o)}catch(z){return A.d.Warn(`${i}/pointer: Invalid pointer (${T}) skipped`),null}}}B(Yw),b(Yw,!0,(g=>new Fw(g)));class uw{constructor(g,w,q){this.frame=g,this.action=w,this.onlyOnce=q,this.isDone=!1}_clone(){return new uw(this.frame,this.action,this.onlyOnce)}}var nw=q(11029),Ww=q(11074),pw=q(11071);class Zw{get loop(){return this._loop}set loop(g){g!==this._loop&&(this._loop=g,this.updateOptions({loop:g}))}get currentTime(){var g;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(g=Ww.b.audioEngine)&&void 0!==g&&g.audioContext&&(this.isPlaying||this.isPaused)){const g=this.isPaused?0:Ww.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+g}return 0}get spatialSound(){return this._spatialSound}set spatialSound(g){if(g==this._spatialSound)return;const w=this.isPlaying;this.pause(),g?(this._spatialSound=g,this._updateSpatialParameters()):this._disableSpatialSound(),w&&this.play()}constructor(g,w,q){var R;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new t.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=o.ew.Zero(),this._localDirection=new o.ew(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=g,q=q||L.c.LastCreatedScene)if(this._scene=q,Zw._SceneComponentInitialization(q),this._readyToPlayCallback=r,this._customAttenuationFunction=(g,w,q,R,o)=>w<q?g*(1-w/q):0,i&&(this.autoplay=i.autoplay||!1,this._loop=i.loop||!1,void 0!==i.volume&&(this._volume=i.volume),this._spatialSound=i.spatialSound??!1,this.maxDistance=i.maxDistance??100,this.useCustomAttenuation=i.useCustomAttenuation??!1,this.rolloffFactor=i.rolloffFactor||1,this.refDistance=i.refDistance||1,this.distanceModel=i.distanceModel||"linear",this._playbackRate=i.playbackRate||1,this._streaming=i.streaming??!1,this._length=i.length,this._offset=i.offset),null!==(R=Ww.b.audioEngine)&&void 0!==R&&R.canUseWebAudio&&Ww.b.audioEngine.audioContext){this._soundGain=Ww.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let g=!0;if(w)try{"string"===typeof w?(this._urlType="String",this._url=w):w instanceof ArrayBuffer?this._urlType="ArrayBuffer":w instanceof HTMLMediaElement?this._urlType="MediaElement":w instanceof MediaStream?this._urlType="MediaStream":w instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(w)&&(this._urlType="Array");let q=[],R=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ww.b.audioEngine.audioContext.createMediaElementSource(w),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ww.b.audioEngine.audioContext.createMediaStreamSource(w),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":w.byteLength>0&&(R=!0,this._soundLoaded(w));break;case"AudioBuffer":this._audioBufferLoaded(w);break;case"String":q.push(w);case"Array":0===q.length&&(q=w);for(let g=0;g<q.length;g++){const w=q[g];if(R=i&&i.skipCodecCheck||-1!==w.indexOf(".mp3",w.length-4)&&Ww.b.audioEngine.isMP3supported||-1!==w.indexOf(".ogg",w.length-4)&&Ww.b.audioEngine.isOGGsupported||-1!==w.indexOf(".wav",w.length-4)||-1!==w.indexOf(".m4a",w.length-4)||-1!==w.indexOf(".mp4",w.length-4)||-1!==w.indexOf("blob:"),R){this._streaming?(this._htmlAudioElement=new Audio(w),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,S.Tools.SetCorsBehavior(w,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(w,(g=>{this._soundLoaded(g)}),void 0,!0,!0,(g=>{g&&A.d.Error("XHR "+g.status+" error on: "+w+"."),A.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:g=!1}g?R||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):A.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(T){A.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Ww.b.audioEngine&&!Ww.b.audioEngine.WarnedWebAudioUnsupported&&(A.d.Error("Web Audio is not supported by your browser."),Ww.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var g;null!==(g=Ww.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(g){var w;null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.audioContext&&(this._audioBuffer=g,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(g){var w;null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.audioContext&&Ww.b.audioEngine.audioContext.decodeAudioData(g,(g=>{this._audioBufferLoaded(g)}),(g=>{A.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+g)}))}setAudioBuffer(g){var w;null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&(this._audioBuffer=g,this._isReadyToPlay=!0)}updateOptions(g){g&&(this.loop=g.loop??this.loop,this.maxDistance=g.maxDistance??this.maxDistance,this.useCustomAttenuation=g.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=g.rolloffFactor??this.rolloffFactor,this.refDistance=g.refDistance??this.refDistance,this.distanceModel=g.distanceModel??this.distanceModel,this._playbackRate=g.playbackRate??this._playbackRate,this._length=g.length??void 0,this.spatialSound=g.spatialSound??this._spatialSound,this._setOffset(g.offset??void 0),this.setVolume(g.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var g;null!==(g=Ww.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&Ww.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Ww.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var g;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(g=this._soundPanner)||void 0===g||g.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var g;null!==(g=Ww.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(g){var w;null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(g),this._isOutputConnected=!0)}setDirectionalCone(g,w,q){w<g?A.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=g,this._coneOuterAngle=w,this._coneOuterGain=q,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(g){if(g!=this._coneInnerAngle){var w;if(this._coneOuterAngle<g)return void A.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=g,null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(g){if(g!=this._coneOuterAngle){var w;if(g<this._coneInnerAngle)return void A.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=g,null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(g){var w;g.equals(this._position)||(this._position.T(g),null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(g){var w;this._localDirection=g,null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const g=this._connectedTransformNode.getWorldMatrix(),w=o.ew.TransformNormal(this._localDirection,g);w.normalize(),this._soundPanner.orientationX.value=w.x,this._soundPanner.orientationY.value=w.y,this._soundPanner.orientationZ.value=w.z}updateDistanceFromListener(){var g;if(null!==(g=Ww.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const g=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.yw(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,g,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(g){this._customAttenuationFunction=g}play(g,w,q){var R;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(R=Ww.b.audioEngine)&&void 0!==R&&R.audioContext)try{var o,r;this._clearTimeoutsAndObservers();let R=g?(null===(o=Ww.b.audioEngine)||void 0===o?void 0:o.audioContext.currentTime)+g:null===(r=Ww.b.audioEngine)||void 0===r?void 0:r.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Ww.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const g=()=>{var q;if(null!==(q=Ww.b.audioEngine)&&void 0!==q&&q.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=w??0;const q=this._htmlAudioElement.play();void 0!==q&&q.catch((()=>{var w,q;(null===(w=Ww.b.audioEngine)||void 0===w||w.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(q=Ww.b.audioEngine)||void 0===q?void 0:q.onAudioUnlockedObservable.addOnce((()=>{g()})))}))}else{var R;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(R=Ww.b.audioEngine)||void 0===R?void 0:R.onAudioUnlockedObservable.addOnce((()=>{g()}))}};g()}}else{var S;const o=()=>{var o;if(null!==(o=Ww.b.audioEngine)&&void 0!==o&&o.audioContext){var r;if(q=q||this._length,void 0!==w&&this._setOffset(w),this._soundSource){const g=this._soundSource;g.onended=()=>{g.disconnect()}}if(this._soundSource=null===(r=Ww.b.audioEngine)||void 0===r?void 0:r.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var S;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==w&&(this._soundSource.loopStart=w),void 0!==q&&(this._soundSource.loopEnd=(0|w)+q),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},R=g?(null===(S=Ww.b.audioEngine)||void 0===S?void 0:S.audioContext.currentTime)+g:Ww.b.audioEngine.audioContext.currentTime;const o=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(R,o,this.loop?void 0:q)}}};"suspended"===(null===(S=Ww.b.audioEngine)||void 0===S?void 0:S.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var g;"suspended"===(null===(g=Ww.b.audioEngine)||void 0===g?void 0:g.audioContext.state)?(Ww.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Ww.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{o()})))):o()}),500):o()}this._startTime=R,this.isPlaying=!0,this.isPaused=!1}catch(i){A.d.Error("Error while trying to play audio: "+this.name+", "+i.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(g){var w;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var q;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(q=this._streamingSource)||void 0===q||q.disconnect();this.isPlaying=!1}else if(null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.audioContext&&this._soundSource){const w=g?Ww.b.audioEngine.audioContext.currentTime+g:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(w)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var g;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var w;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(w=this._streamingSource)||void 0===w||w.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(g=Ww.b.audioEngine)&&void 0!==g&&g.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Ww.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(g,w){var q;null!==(q=Ww.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._soundGain&&(w&&Ww.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Ww.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Ww.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(g,Ww.b.audioEngine.audioContext.currentTime+w)):this._soundGain.gain.value=g),this._volume=g}setPlaybackRate(g){this._playbackRate=g,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(g){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=g,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=g=>this._onRegisterAfterWorldMatrixUpdate(g),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(g){var w;if(g.getBoundingInfo){const w=g.getBoundingInfo();this.setPosition(w.boundingSphere.centerWorld)}else this.setPosition(g.absolutePosition);null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const g=()=>{(0,pw.h)((()=>this._isReadyToPlay),(()=>{q._audioBuffer=this.getAudioBuffer(),q._isReadyToPlay=!0,q.autoplay&&q.play(0,this._offset,this._length)}),void 0,300)},w={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},q=new Zw(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,w);return this.useCustomAttenuation&&q.setAttenuationFunction(this._customAttenuationFunction),q.setPosition(this._position),q.setPlaybackRate(this._playbackRate),g(),q}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const g={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(g.connectedMeshId=this._connectedTransformNode.id),g.position=this._position.qi(),g.refDistance=this.refDistance,g.distanceModel=this.distanceModel,g.isDirectional=this._isDirectional,g.localDirectionToMesh=this._localDirection.qi(),g.coneInnerAngle=this._coneInnerAngle,g.coneOuterAngle=this._coneOuterAngle,g.coneOuterGain=this._coneOuterGain),g}static Parse(g,w,q,R){const r=g.name;let S;S=g.url?q+g.url:q+r;const i={autoplay:g.autoplay,loop:g.loop,volume:g.volume,spatialSound:g.spatialSound,maxDistance:g.maxDistance,rolloffFactor:g.rolloffFactor,refDistance:g.refDistance,distanceModel:g.distanceModel,playbackRate:g.playbackRate};let T;if(R){const g=()=>{(0,pw.h)((()=>R._isReadyToPlay),(()=>{T._audioBuffer=R.getAudioBuffer(),T._isReadyToPlay=!0,T.autoplay&&T.play(0,T._offset,T._length)}),void 0,300)};T=new Zw(r,new ArrayBuffer(0),w,null,i),g()}else T=new Zw(r,S,w,(()=>{w.removePendingData(T)}),i),w.addPendingData(T);if(g.position){const w=o.ew.Ri(g.position);T.setPosition(w)}if(g.isDirectional&&(T.setDirectionalCone(g.coneInnerAngle||360,g.coneOuterAngle||360,g.coneOuterGain||0),g.localDirectionToMesh)){const w=o.ew.Ri(g.localDirectionToMesh);T.setLocalDirectionToMesh(w)}if(g.connectedMeshId){const q=w.getMeshById(g.connectedMeshId);q&&T.attachToMesh(q)}return g.metadata&&(T.metadata=g.metadata),T}_setOffset(g){this._offset!==g&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=g)}_clearTimeoutsAndObservers(){var g;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(g=Ww.b.audioEngine)||void 0===g||g.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Zw._SceneComponentInitialization=g=>{throw(0,nw.b)("AudioSceneComponent")},(0,Ug.g)("BABYLON.Sound",Zw);class Iw{constructor(g,w,q){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],w.length!==q.length)throw new Error("Sounds length does not equal weights length");this.loop=g,this._weights=q;let R=0;for(const r of q)R+=r;const o=R>0?1/R:0;for(let r=0;r<this._weights.length;r++)this._weights[r]*=o;this._sounds=w;for(const r of this._sounds)r.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(g){if(g!==this._coneInnerAngle){if(this._coneOuterAngle<g)return void A.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=g;for(const w of this._sounds)w.directionalConeInnerAngle=g}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(g){if(g!==this._coneOuterAngle){if(g<this._coneInnerAngle)return void A.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=g;for(const w of this._sounds)w.directionalConeOuterAngle=g}}get volume(){return this._volume}set volume(g){if(g!==this._volume)for(const w of this._sounds)w.setVolume(g)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(g){if(!this.isPaused){this.stop();const g=Math.random();let w=0;for(let q=0;q<this._weights.length;q++)if(w+=this._weights[q],g<=w){this._currentIndex=q;break}}const w=this._sounds[this._currentIndex??0];w.isReady()?w.play(0,this.isPaused?void 0:g):w.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class kw{constructor(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(g=g||L.c.LastCreatedScene)&&(this._scene=g,this.soundCollection=[],this._options=w,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var g;null!==(g=Ww.b.audioEngine)&&void 0!==g&&g.canUseWebAudio&&Ww.b.audioEngine.audioContext&&(this._outputAudioNode=Ww.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Ww.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Ww.b.audioEngine&&Ww.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(g){var w;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._outputAudioNode&&g.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==g.soundTrackId&&(-1===g.soundTrackId?this._scene.mainSoundTrack.removeSound(g):this._scene.soundTracks&&this._scene.soundTracks[g.soundTrackId].removeSound(g)),this.soundCollection.push(g),g.soundTrackId=this.id}removeSound(g){const w=this.soundCollection.indexOf(g);-1!==w&&this.soundCollection.splice(w,1)}setVolume(g){var w;null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=g)}switchPanningModelToHRTF(){var g;if(null!==(g=Ww.b.audioEngine)&&void 0!==g&&g.canUseWebAudio)for(let w=0;w<this.soundCollection.length;w++)this.soundCollection[w].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var g;if(null!==(g=Ww.b.audioEngine)&&void 0!==g&&g.canUseWebAudio)for(let w=0;w<this.soundCollection.length;w++)this.soundCollection[w].switchPanningModelToEqualPower()}connectToAnalyser(g){var w;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=g,null!==(w=Ww.b.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Ww.b.audioEngine.masterGain))}}var gq=q(11420),wq=q(11395),qq=q(11007);Ww.b.AudioEngineFactory=(g,w,q)=>new Rq(g,w,q);class Rq{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new t.b,this.onAudioLockedObservable=new t.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,qq.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const R=document.createElement("audio");this._hostElement=g,this._audioContext=w,this._audioDestination=q;try{R&&R.canPlayType&&(R.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||R.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(o){}try{R&&R.canPlayType&&R.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(o){}}lock(){this._triggerSuspendedState()}unlock(){var g,w;if("running"===(null===(g=this._audioContext)||void 0===g?void 0:g.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(w=this._audioContext)||void 0===w||w.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{A.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var g;null===(g=this._audioContext)||void 0===g||g.addEventListener("statechange",(()=>{var g;this.unlocked&&"running"!==(null===(g=this._audioContext)||void 0===g?void 0:g.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var g;return null!==(g=this._audioContext)&&void 0!==g&&g.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(g){this.canUseWebAudio=!1,A.d.Error("Web Audio: "+g.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(g){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const g=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",w=document.createElement("style");w.appendChild(document.createTextNode(g)),document.getElementsByTagName("head")[0].appendChild(w),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var g;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(g=this._audioContext)||void 0===g||g.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(g){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=g)}connectToAnalyser(g){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=g,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var oq=q(11023);(0,q(12501).c)(gq.e.NAME_AUDIO,((g,w,q,R)=>{let o,r=[];if(q.Ke=q.Ke||[],void 0!==g.Ke&&null!==g.Ke)for(let i=0,T=g.Ke.length;i<T;i++){var S;const T=g.Ke[i];null!==(S=Ww.b.audioEngine)&&void 0!==S&&S.canUseWebAudio?(T.url||(T.url=T.name),r[T.url]?q.Ke.push(Zw.Parse(T,w,R,r[T.url])):(o=Zw.Parse(T,w,R),r[T.url]=o,q.Ke.push(o))):q.Ke.push(new Zw(T.name,null,w))}r=[]})),Object.defineProperty(wq.c.prototype,"mainSoundTrack",{get:function(){let g=this._getComponent(gq.e.NAME_AUDIO);return g||(g=new rq(this),this.o(g)),this._mainSoundTrack||(this._mainSoundTrack=new kw(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),wq.c.prototype.getSoundByName=function(g){let w;for(w=0;w<this.mainSoundTrack.soundCollection.length;w++)if(this.mainSoundTrack.soundCollection[w].name===g)return this.mainSoundTrack.soundCollection[w];if(this.soundTracks)for(let q=0;q<this.soundTracks.length;q++)for(w=0;w<this.soundTracks[q].soundCollection.length;w++)if(this.soundTracks[q].soundCollection[w].name===g)return this.soundTracks[q].soundCollection[w];return null},Object.defineProperty(wq.c.prototype,"audioEnabled",{get:function(){let g=this._getComponent(gq.e.NAME_AUDIO);return g||(g=new rq(this),this.o(g)),g.audioEnabled},set:function(g){let w=this._getComponent(gq.e.NAME_AUDIO);w||(w=new rq(this),this.o(w)),g?w.enableAudio():w.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(wq.c.prototype,"headphone",{get:function(){let g=this._getComponent(gq.e.NAME_AUDIO);return g||(g=new rq(this),this.o(g)),g.headphone},set:function(g){let w=this._getComponent(gq.e.NAME_AUDIO);w||(w=new rq(this),this.o(w)),g?w.switchAudioModeForHeadphones():w.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(wq.c.prototype,"audioListenerPositionProvider",{get:function(){let g=this._getComponent(gq.e.NAME_AUDIO);return g||(g=new rq(this),this.o(g)),g.audioListenerPositionProvider},set:function(g){let w=this._getComponent(gq.e.NAME_AUDIO);if(w||(w=new rq(this),this.o(w)),g&&"function"!==typeof g)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");w.audioListenerPositionProvider=g},enumerable:!0,configurable:!0}),Object.defineProperty(wq.c.prototype,"audioListenerRotationProvider",{get:function(){let g=this._getComponent(gq.e.NAME_AUDIO);return g||(g=new rq(this),this.o(g)),g.audioListenerRotationProvider},set:function(g){let w=this._getComponent(gq.e.NAME_AUDIO);if(w||(w=new rq(this),this.o(w)),g&&"function"!==typeof g)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");w.audioListenerRotationProvider=g},enumerable:!0,configurable:!0}),Object.defineProperty(wq.c.prototype,"audioPositioningRefreshRate",{get:function(){let g=this._getComponent(gq.e.NAME_AUDIO);return g||(g=new rq(this),this.o(g)),g.audioPositioningRefreshRate},set:function(g){let w=this._getComponent(gq.e.NAME_AUDIO);w||(w=new rq(this),this.o(w)),w.audioPositioningRefreshRate=g},enumerable:!0,configurable:!0});class rq{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(g){this.name=gq.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new o.ew,this._cachedCameraPosition=new o.ew,this._lastCheck=0,this._invertMatrixTemp=new o.Matrix,this._cameraDirectionTemp=new o.ew,(g=g||L.c.LastCreatedScene)&&(this.Aw=g,g.soundTracks=[],g.Ke=[])}register(){this.Aw._afterRenderStage.registerStep(gq.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(g){if(g.Ke=[],this.Aw.soundTracks)for(let w=0;w<this.Aw.soundTracks.length;w++){const q=this.Aw.soundTracks[w];for(let w=0;w<q.soundCollection.length;w++)g.Ke.push(q.soundCollection[w].serialize())}}addFromContainer(g){if(g.Ke)for(const w of g.Ke)w.play(),w.autoplay=!0,this.Aw.mainSoundTrack.addSound(w)}removeFromContainer(g){let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(g.Ke)for(const q of g.Ke)q.stop(),q.autoplay=!1,this.Aw.mainSoundTrack.removeSound(q),w&&q.dispose()}dispose(){const g=this.Aw;if(g._mainSoundTrack&&g.mainSoundTrack.dispose(),g.soundTracks)for(let w=0;w<g.soundTracks.length;w++)g.soundTracks[w].dispose()}disableAudio(){const g=this.Aw;let w;for(this._audioEnabled=!1,Ww.b.audioEngine&&Ww.b.audioEngine.audioContext&&Ww.b.audioEngine.audioContext.suspend(),w=0;w<g.mainSoundTrack.soundCollection.length;w++)g.mainSoundTrack.soundCollection[w].pause();if(g.soundTracks)for(w=0;w<g.soundTracks.length;w++)for(let q=0;q<g.soundTracks[w].soundCollection.length;q++)g.soundTracks[w].soundCollection[q].pause()}enableAudio(){const g=this.Aw;let w;for(this._audioEnabled=!0,Ww.b.audioEngine&&Ww.b.audioEngine.audioContext&&Ww.b.audioEngine.audioContext.resume(),w=0;w<g.mainSoundTrack.soundCollection.length;w++)g.mainSoundTrack.soundCollection[w].isPaused&&g.mainSoundTrack.soundCollection[w].play();if(g.soundTracks)for(w=0;w<g.soundTracks.length;w++)for(let q=0;q<g.soundTracks[w].soundCollection.length;q++)g.soundTracks[w].soundCollection[q].isPaused&&g.soundTracks[w].soundCollection[q].play()}switchAudioModeForHeadphones(){const g=this.Aw;if(this._headphone=!0,g.mainSoundTrack.switchPanningModelToHRTF(),g.soundTracks)for(let w=0;w<g.soundTracks.length;w++)g.soundTracks[w].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const g=this.Aw;if(this._headphone=!1,g.mainSoundTrack.switchPanningModelToEqualPower(),g.soundTracks)for(let w=0;w<g.soundTracks.length;w++)g.soundTracks[w].switchPanningModelToEqualPower()}_afterRender(){const g=oq.e.Now;if(this._lastCheck&&g-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=g;const w=this.Aw;if(!this._audioEnabled||!w._mainSoundTrack||!w.soundTracks||0===w._mainSoundTrack.soundCollection.length&&1===w.soundTracks.length)return;const q=Ww.b.audioEngine;if(q&&q.audioContext){let g,R=w.activeCamera;if(w.activeCameras&&w.activeCameras.length>0&&(R=w.activeCameras[0]),this.audioListenerPositionProvider){const g=this.audioListenerPositionProvider();q.audioContext.listener.setPosition(g.x||0,g.y||0,g.z||0)}else R?this._cachedCameraPosition.equals(R.globalPosition)||(this._cachedCameraPosition.T(R.globalPosition),q.audioContext.listener.setPosition(R.globalPosition.x,R.globalPosition.y,R.globalPosition.z)):q.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const g=this.audioListenerRotationProvider();q.audioContext.listener.setOrientation(g.x||0,g.y||0,g.z||0,0,1,0)}else R?(R.rigCameras&&R.rigCameras.length>0&&(R=R.rigCameras[0]),R.getViewMatrix().invertToRef(this._invertMatrixTemp),o.ew.TransformNormalToRef(rq._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.T(this._cameraDirectionTemp),q.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):q.audioContext.listener.setOrientation(0,0,0,0,1,0);for(g=0;g<w.mainSoundTrack.soundCollection.length;g++){const q=w.mainSoundTrack.soundCollection[g];q.useCustomAttenuation&&q.updateDistanceFromListener()}if(w.soundTracks)for(g=0;g<w.soundTracks.length;g++)for(let q=0;q<w.soundTracks[g].soundCollection.length;q++){const R=w.soundTracks[g].soundCollection[q];R.useCustomAttenuation&&R.updateDistanceFromListener()}}}}rq._CameraDirection=new o.ew(0,0,-1),Zw._SceneComponentInitialization=g=>{let w=g._getComponent(gq.e.NAME_AUDIO);w||(w=new rq(g),g.o(w))};const Sq="MSFT_audio_emitter";class iq{constructor(g){this.name=Sq,this._loader=g,this.enabled=this._loader.isExtensionUsed(Sq)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const g=this._loader.IS.extensions;if(g&&g[this.name]){const w=g[this.name];this._clips=w.clips,this._emitters=w.emitters,Q.Assign(this._clips),Q.Assign(this._emitters)}}loadSceneAsync(g,w){return K.LoadExtensionAsync(g,w,this.name,(async(q,R)=>{const o=new Array;o.push(this._loader.loadSceneAsync(g,w));for(const g of R.emitters){const w=Q.Get(`${q}/emitters`,this._emitters,g);if(void 0!=w.refDistance||void 0!=w.maxDistance||void 0!=w.rolloffFactor||void 0!=w.distanceModel||void 0!=w.innerAngle||void 0!=w.outerAngle)throw new Error(`${q}: Direction or Distance properties are not allowed on emitters attached to a scene`);o.push(this._loadEmitterAsync(`${q}/emitters/${w.index}`,w))}await Promise.all(o)}))}loadNodeAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(g,R)=>{const r=new Array,i=await this._loader.loadNodeAsync(g,w,(w=>{for(const q of R.emitters){const R=Q.Get(`${g}/emitters`,this._emitters,q);r.push(this._loadEmitterAsync(`${g}/emitters/${R.index}`,R).then((()=>{for(const g of R._babylonSounds)g.attachToMesh(w),void 0==R.innerAngle&&void 0==R.outerAngle||(g.setLocalDirectionToMesh(o.ew.Forward()),g.setDirectionalCone(2*S.Tools.ToDegrees(void 0==R.innerAngle?Math.PI:R.innerAngle),2*S.Tools.ToDegrees(void 0==R.outerAngle?Math.PI:R.outerAngle),0))})))}q(w)}));return await Promise.all(r),i}))}loadAnimationAsync(g,w){return K.LoadExtensionAsync(g,w,this.name,(async(q,R)=>{const o=await this._loader.loadAnimationAsync(g,w),r=new Array;Q.Assign(R.events);for(const S of R.events)r.push(this._loadAnimationEventAsync(`${q}/events/${S.index}`,g,w,S,o));return await Promise.all(r),o}))}_loadClipAsync(g,w){if(w._objectURL)return w._objectURL;let q;if(w.uri)q=this._loader.loadUriAsync(g,w,w.uri);else{const R=Q.Get(`${g}/bufferView`,this._loader.IS.bufferViews,w.bufferView);q=this._loader.loadBufferViewAsync(`/bufferViews/${R.index}`,R)}return w._objectURL=q.then((g=>URL.createObjectURL(new Blob([g],{type:w.mimeType})))),w._objectURL}_loadEmitterAsync(g,w){if(w._babylonSounds=w._babylonSounds||[],!w._babylonData){const g=new Array,q=w.name||`emitter${w.index}`,R={loop:!1,autoplay:!1,volume:void 0==w.volume?1:w.volume};for(let r=0;r<w.clips.length;r++){const o=`/extensions/${this.name}/clips`,S=Q.Get(o,this._clips,w.clips[r].clip);g.push(this._loadClipAsync(`${o}/${w.clips[r].clip}`,S).then((g=>{const o=w._babylonSounds[r]=new Zw(q,g,this._loader.babylonScene,null,R);o.refDistance=w.refDistance||1,o.maxDistance=w.maxDistance||256,o.rolloffFactor=w.rolloffFactor||1,o.distanceModel=w.distanceModel||"exponential"})))}const o=Promise.all(g).then((()=>{const g=w.clips.map((g=>g.weight||1)),q=new Iw(w.loop||!1,w._babylonSounds,g);w.innerAngle&&(q.directionalConeInnerAngle=2*S.Tools.ToDegrees(w.innerAngle)),w.outerAngle&&(q.directionalConeOuterAngle=2*S.Tools.ToDegrees(w.outerAngle)),w.volume&&(q.volume=w.volume),w._babylonData.sound=q}));w._babylonData={loaded:o}}return w._babylonData.loaded}_getEventAction(g,w,q,R,o){switch(q){case"play":return g=>{const q=(o||0)+(g-R);w.play(q)};case"stop":return()=>{w.stop()};case"pause":return()=>{w.pause()};default:throw new Error(`${g}: Unsupported action ${q}`)}}_loadAnimationEventAsync(g,w,q,R,o){if(0==o.targetedAnimations.length)return Promise.resolve();const r=o.targetedAnimations[0],S=R.k,i=Q.Get(`/extensions/${this.name}/emitters`,this._emitters,S);return this._loadEmitterAsync(g,i).then((()=>{const w=i._babylonData.sound;if(w){const q=new uw(R.time,this._getEventAction(g,w,R.action,R.time,R.startOffset));r.animation.addEvent(q),o.onAnimationGroupEndObservable.add((()=>{w.stop()})),o.onAnimationGroupPauseObservable.add((()=>{w.pause()}))}}))}}B(Sq),b(Sq,!0,(g=>new iq(g)));const Tq="MSFT_lod";class zq{constructor(g){var w;this.name=Tq,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new t.b,this.onMaterialLODsLoadedObservable=new t.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=g,this.maxLODsToLoad=(null===(w=this._loader.parent.extensionOptions[Tq])||void 0===w?void 0:w.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Tq)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let g=0;g<this._nodePromiseLODs.length;g++){const w=Promise.all(this._nodePromiseLODs[g]).then((()=>{0!==g&&(this._loader.endPerformanceCounter(`Node LOD ${g}`),this._loader.log(`Loaded node LOD ${g}`)),this.onNodeLODsLoadedObservable.notifyObservers(g),g!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${g+1}`),this._loadBufferLOD(this._nodeBufferLODs,g+1),this._nodeSignalLODs[g]&&this._nodeSignalLODs[g].resolve())}));this._loader._completePromises.push(w)}for(let g=0;g<this._materialPromiseLODs.length;g++){const w=Promise.all(this._materialPromiseLODs[g]).then((()=>{0!==g&&(this._loader.endPerformanceCounter(`Material LOD ${g}`),this._loader.log(`Loaded material LOD ${g}`)),this.onMaterialLODsLoadedObservable.notifyObservers(g),g!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${g+1}`),this._loadBufferLOD(this._materialBufferLODs,g+1),this._materialSignalLODs[g]&&this._materialSignalLODs[g].resolve())}));this._loader._completePromises.push(w)}}loadSceneAsync(g,w){const q=this._loader.loadSceneAsync(g,w);return this._loadBufferLOD(this._bufferLODs,0),q}loadNodeAsync(g,w,q){return K.LoadExtensionAsync(g,w,this.name,(async(g,o)=>{let r;const S=this._getLODs(g,w,this._loader.IS.nodes,o.ids);this._loader.logOpen(`${g}`);for(let w=0;w<S.length;w++){const g=S[w];0!==w&&(this._nodeIndexLOD=w,this._nodeSignalLODs[w]=this._nodeSignalLODs[w]||new R);const o=g=>{q(g),g.Mi(!1)},i=this._loader.loadNodeAsync(`/nodes/${g.index}`,g,o).then((g=>{if(0!==w){const g=S[w-1];g._babylonTransformNode&&(this._disposeTransformNode(g._babylonTransformNode),delete g._babylonTransformNode)}return g.Mi(!0),g}));this._nodePromiseLODs[w]=this._nodePromiseLODs[w]||[],0===w?r=i:(this._nodeIndexLOD=null,this._nodePromiseLODs[w].push(i))}return this._loader.logClose(),await r}))}_loadMaterialAsync(g,w,q,R,o){return this._nodeIndexLOD?null:K.LoadExtensionAsync(g,w,this.name,(async(g,r)=>{let S;const i=this._getLODs(g,w,this._loader.IS.materials,r.ids);this._loader.logOpen(`${g}`);for(let w=0;w<i.length;w++){const g=i[w];0!==w&&(this._materialIndexLOD=w);const r=this._loader._loadMaterialAsync(`/materials/${g.index}`,g,q,R,(g=>{0===w&&o(g)})).then((g=>{if(0!==w){o(g);const q=i[w-1]._data;q[R]&&(this._disposeMaterials([q[R].babylonMaterial]),delete q[R])}return g}));this._materialPromiseLODs[w]=this._materialPromiseLODs[w]||[],0===w?S=r:(this._materialIndexLOD=null,this._materialPromiseLODs[w].push(r))}return this._loader.logClose(),await S}))}_loadUriAsync(g,w,q){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const o=this._nodeIndexLOD-1;return this._nodeSignalLODs[o]=this._nodeSignalLODs[o]||new R,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(g,w,q)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const o=this._materialIndexLOD-1;return this._materialSignalLODs[o]=this._materialSignalLODs[o]||new R,this._materialSignalLODs[o].promise.then((async()=>await this._loader.loadUriAsync(g,w,q)))}return null}loadBufferAsync(g,w,q,o){if(this._loader.parent.useRangeRequests&&!w.uri){if(!this._loader.bin)throw new Error(`${g}: Uri is missing or the binary glTF is missing its binary chunk`);const w=async(g,w)=>{const r=q,S=r+o-1;let i=g[w];return i?(i.start=Math.min(i.start,r),i.end=Math.max(i.end,S)):(i={start:r,end:S,loaded:new R},g[w]=i),await i.loaded.promise.then((g=>new Uint8Array(g.buffer,g.byteOffset+q-i.start,o)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?w(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?w(this._materialBufferLODs,this._materialIndexLOD):w(this._bufferLODs,0)}return null}_loadBufferLOD(g,w){const q=g[w];q&&(this._loader.log(`Loading buffer range [${q.start}-${q.end}]`),this._loader.bin.readAsync(q.start,q.end-q.start+1).then((g=>{q.loaded.resolve(g)}),(g=>{q.loaded.reject(g)})))}_getLODs(g,w,q,R){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const o=[];for(let r=R.length-1;r>=0;r--)if(o.push(Q.Get(`${g}/ids/${R[r]}`,q,R[r])),o.length===this.maxLODsToLoad)return o;return o.push(w),o}_disposeTransformNode(g){const w=[],q=g.material;q&&w.push(q);for(const o of g.getChildMeshes())o.material&&w.push(o.material);g.dispose();const R=w.filter((g=>this._loader.babylonScene.meshes.every((w=>w.material!=g))));this._disposeMaterials(R)}_disposeMaterials(g){const w={};for(const q of g){for(const g of q.getActiveTextures())w[g.uniqueId]=g;q.dispose()}for(const q in w)for(const g of this._loader.babylonScene.materials)g.hasTexture(w[q])&&delete w[q];for(const q in w)w[q].dispose()}}B(Tq),b(Tq,!0,(g=>new zq(g)));const tq="MSFT_minecraftMesh";class mq{constructor(g){this.name=tq,this._loader=g,this.enabled=this._loader.isExtensionUsed(tq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtraAsync(g,w,this.name,(async(R,o)=>{if(o){if(!(q instanceof G.c))throw new Error(`${R}: Material type not supported`);const o=this._loader.loadMaterialPropertiesAsync(g,w,q);return q.needAlphaBlending()&&(q.forceDepthWrite=!0,q.separateCullingPass=!0),q.ti=q.forceDepthWrite,q.twoSidedLighting=!0,await o}}))}}B(tq),b(tq,!0,(g=>new mq(g)));const eq="MSFT_sRGBFactors";class yq{constructor(g){this.name=eq,this._loader=g,this.enabled=this._loader.isExtensionUsed(eq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(g,w,q){return K.LoadExtraAsync(g,w,this.name,(async(R,o)=>{if(o){if(!(q instanceof G.c))throw new Error(`${R}: Material type not supported`);const o=this._loader.loadMaterialPropertiesAsync(g,w,q),r=q.Ng().getEngine().useExactSrgbConversions;return q.albedoTexture||q.albedoColor.toLinearSpaceToRef(q.albedoColor,r),q.reflectivityTexture||q.reflectivityColor.toLinearSpaceToRef(q.reflectivityColor,r),await o}}))}}B(eq),b(eq,!0,(g=>new yq(g)));var Lq=q(12814);const Aq={};var lq=q(12875),Jq=q(12855),xq=q(12820),Gq=q(12836);function dq(g,w){for(const q of g)for(const g of q.dataOutputs)if(g.uniqueId===w)return g;throw new Error("Could not find data out connection with unique id "+w)}function Dq(g,w){for(const q of g)if(q instanceof Jq.d)for(const g of q.signalInputs)if(g.uniqueId===w)return g;throw new Error("Could not find signal in connection with unique id "+w)}async function Uq(g,w){const R=await Promise.all(g.allBlocks.map((async g=>{const w=function(g){switch(g){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([q.e(78),q.e(79)]).then(q.bind(q,14270))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await q.e(80).then(q.bind(q,14273))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await q.e(81).then(q.bind(q,14275))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await q.e(82).then(q.bind(q,14283))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await q.e(83).then(q.bind(q,14292))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await q.e(84).then(q.bind(q,14296))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await q.e(85).then(q.bind(q,14305))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await q.e(86).then(q.bind(q,14309))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await q.e(87).then(q.bind(q,14318))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await q.e(90).then(q.bind(q,14347))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await q.e(90).then(q.bind(q,14347))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await q.e(90).then(q.bind(q,14347))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await q.e(90).then(q.bind(q,14347))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await q.e(95).then(q.bind(q,14349))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await q.e(96).then(q.bind(q,14352))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await q.e(97).then(q.bind(q,14354))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await q.e(98).then(q.bind(q,14358))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await q.e(99).then(q.bind(q,14366))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await q.e(100).then(q.bind(q,14368))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await q.e(101).then(q.bind(q,14372))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await q.e(102).then(q.bind(q,14376))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await q.e(103).then(q.bind(q,14385))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await q.e(104).then(q.bind(q,14391))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await q.e(105).then(q.bind(q,14394))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await q.e(106).then(q.bind(q,14403))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await q.e(107).then(q.bind(q,14406))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await q.e(108).then(q.bind(q,14411))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await q.e(109).then(q.bind(q,14415))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await q.e(110).then(q.bind(q,14421))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await q.e(111).then(q.bind(q,14430))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await q.e(112).then(q.bind(q,14433))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await q.e(113).then(q.bind(q,14441))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await q.e(92).then(q.bind(q,14444))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await q.e(114).then(q.bind(q,14452))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await q.e(115).then(q.bind(q,14454))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await q.e(116).then(q.bind(q,14456))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await q.e(93).then(q.bind(q,14461))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await q.e(88).then(q.bind(q,14322))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await q.e(94).then(q.bind(q,14463))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await q.e(94).then(q.bind(q,14463))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await q.e(94).then(q.bind(q,14463))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await q.e(94).then(q.bind(q,14463))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await q.e(94).then(q.bind(q,14463))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await q.e(94).then(q.bind(q,14463))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await q.e(94).then(q.bind(q,14463))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await q.e(94).then(q.bind(q,14463))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await q.e(89).then(q.bind(q,14344))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await q.e(90).then(q.bind(q,14347))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await q.e(90).then(q.bind(q,14347))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await q.e(91).then(q.bind(q,14465))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await q.e(91).then(q.bind(q,14465))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await q.e(91).then(q.bind(q,14465))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await q.e(91).then(q.bind(q,14465))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await q.e(91).then(q.bind(q,14465))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await q.e(91).then(q.bind(q,14465))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await q.e(117).then(q.bind(q,14471))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await q.e(118).then(q.bind(q,14479))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await q.e(119).then(q.bind(q,14488))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await q.e(120).then(q.bind(q,14490))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await q.e(121).then(q.bind(q,14494))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await q.e(122).then(q.bind(q,14497))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await q.e(123).then(q.bind(q,14502))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await q.e(124).then(q.bind(q,14510))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await q.e(125).then(q.bind(q,14514))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await q.e(126).then(q.bind(q,14518))).FlowGraphDataSwitchBlock;default:if(Aq[g])return Aq[g];throw new Error(`Unknown block name ${g}`)}}(g.className);return await w()})));return function(g,w,q){const R=w.coordinator.createGraph(),o=[],r=w.valueParseFunction??xq.d;for(let S=0;S<g.allBlocks.length;S++){const i=aq(g.allBlocks[S],{Aw:w.coordinator.config.Aw,pathConverter:w.pathConverter,assetsContainer:w.coordinator.config.Aw,valueParseFunction:r},q[S]);o.push(i),i instanceof lq.c&&R.addEventBlock(i)}for(const S of o){for(const g of S.dataInputs)for(const w of g.connectedPointIds){const q=dq(o,w);g.connectTo(q)}if(S instanceof Jq.d)for(const g of S.signalOutputs)for(const w of g.connectedPointIds){const q=Dq(o,w);g.connectTo(q)}}for(const S of g.executionContexts)Nq(S,{graph:R,valueParseFunction:r},g.rightHanded);return R}(g,w,R)}function Nq(g,w,q){const R=w.graph.createContext();g.enableLogging&&(R.enableLogging=!0),R.treatDataAsRightHanded=q||!1;const o=w.valueParseFunction??xq.d;R.uniqueId=g.uniqueId;const r=R.Ng();if(g._assetsContext){var S,i,T,z,t,m,e,y,L,A;const w=g._assetsContext,q={meshes:null===(S=w.meshes)||void 0===S?void 0:S.map((g=>r.getMeshById(g))),lights:null===(i=w.lights)||void 0===i?void 0:i.map((g=>r.getLightByName(g))),cameras:null===(T=w.cameras)||void 0===T?void 0:T.map((g=>r.getCameraByName(g))),materials:null===(z=w.materials)||void 0===z?void 0:z.map((g=>r.getMaterialById(g))),textures:null===(t=w.textures)||void 0===t?void 0:t.map((g=>r.getTextureByName(g))),animations:null===(m=w.animations)||void 0===m?void 0:m.map((g=>r.animations.find((w=>w.name===g)))),skeletons:null===(e=w.skeletons)||void 0===e?void 0:e.map((g=>r.getSkeletonByName(g))),Ym:null===(y=w.Ym)||void 0===y?void 0:y.map((g=>r.getParticleSystemById(g))),animationGroups:null===(L=w.animationGroups)||void 0===L?void 0:L.map((g=>r.getAnimationGroupByName(g))),transformNodes:null===(A=w.transformNodes)||void 0===A?void 0:A.map((g=>r.getTransformNodeById(g))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Ke:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};R.assetsContext=q}for(const l in g._userVariables){const w=o(l,g._userVariables,R.assetsContext,r);R.userVariables[l]=w}for(const l in g._connectionValues){const w=o(l,g._connectionValues,R.assetsContext,r);R._setConnectionValueByKey(l,w)}return R}function aq(g,w,q){const R={},o=w.valueParseFunction??xq.d;if(g.config)for(const S in g.config)R[S]=o(S,g.config,w.assetsContainer||w.Aw,w.Aw);if((0,xq.l)(g.className)){if(!w.pathConverter)throw new Error("Path converter is required for this block");R.pathConverter=w.pathConverter}const r=new q(R);r.uniqueId=g.uniqueId;for(let S=0;S<g.dataInputs.length;S++){const w=r.getDataInput(g.dataInputs[S].name);if(!w)throw new Error("Could not find data input with name "+g.dataInputs[S].name+" in block "+g.className);w.deserialize(g.dataInputs[S])}for(let S=0;S<g.dataOutputs.length;S++){const w=r.getDataOutput(g.dataOutputs[S].name);if(!w)throw new Error("Could not find data output with name "+g.dataOutputs[S].name+" in block "+g.className);w.deserialize(g.dataOutputs[S])}return r.metadata=g.metadata,r.deserialize&&r.deserialize(g),r}function Hq(g){const[w,q]=g.split(":");return Cq({op:w,extension:q})}function Cq(g){var w;let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const R=g.extension?null===(w=Pq[g.extension])||void 0===w?void 0:w[g.op]:jq[g.op];if(!R&&(A.d.Warn(`No mapping found for operation ${g.op} and extension ${g.extension||"KHR_interactivity"}`),q)){const w={},q={flows:{}};if(g.inputValueSockets){w.values={};for(const q in g.inputValueSockets)w.values[q]={name:q}}return g.outputValueSockets&&(q.values={},Object.keys(g.outputValueSockets).forEach((g=>{q.values[g]={name:g}}))),{ot:[],inputs:w,outputs:q}}return R}function cq(g,w,q){Pq[w]||(Pq[w]={}),Pq[w][g]=q}const Pq={BABYLON:{"flow/log":{ot:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},jq={"event/onStart":{ot:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{ot:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{ot:["FlowGraphSendCustomEventBlock"],extraProcessor(g,w,q,R,o){if("event/send"!==w.op||!g.configuration||1!==Object.keys(g.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const r=g.configuration.event.value[0];if("number"!==typeof r)throw new Error("Event id should be a number");const S=R.arrays.events[r],i=o[0];return i.config||(i.config={}),i.config.eventId=S.eventId,i.config.eventData=S.eventData,o}},"event/receive":{ot:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(g,w){var q;if(!g.configuration)return A.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const R=g.configuration.event;if(!R)return A.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const o=R.value[0];if("number"!==typeof o)return A.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(q=w.events)||void 0===q?void 0:q[o])?{valid:!0}:(A.d.Error(`Event with id ${o} not found`),{valid:!1,error:`Event with id ${o} not found`})},extraProcessor(g,w,q,R,o){if("event/receive"!==w.op||!g.configuration||1!==Object.keys(g.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const r=g.configuration.event.value[0];if("number"!==typeof r)throw new Error("Event id should be a number");const S=R.arrays.events[r],i=o[0];return i.config||(i.config={}),i.config.eventId=S.eventId,i.config.eventData=S.eventData,o}},"math/e":Mq("FlowGraphEBlock"),"math/pi":Mq("FlowGraphPIBlock"),"math/inf":Mq("FlowGraphInfBlock"),"math/nan":Mq("FlowGraphNaNBlock"),"math/abs":Mq("FlowGraphAbsBlock"),"math/sign":Mq("FlowGraphSignBlock"),"math/trunc":Mq("FlowGraphTruncBlock"),"math/floor":Mq("FlowGraphFloorBlock"),"math/ceil":Mq("FlowGraphCeilBlock"),"math/round":{ot:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,w,q,R,o){var r;return(r=o[0]).config||(r.config={}),o[0].config.roundHalfAwayFromZero=!0,o}},"math/fract":Mq("FlowGraphFractBlock"),"math/neg":Mq("FlowGraphNegationBlock"),"math/add":Mq("FlowGraphAddBlock",["a","b"],!0),"math/sub":Mq("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{ot:["FlowGraphMultiplyBlock"],extraProcessor(g,w,q,R,o){var r;(r=o[0]).config||(r.config={}),o[0].config.useMatrixPerComponent=!0,o[0].config.preventIntegerFloatArithmetic=!0;let S=-1;return Object.keys(g.values||{}).find((w=>{var q;return void 0!==(null===(q=g.values)||void 0===q?void 0:q[w].type)&&(S=g.values[w].type,!0)})),-1!==S&&(o[0].config.type=R.arrays.types[S].flowGraphType),o},validation:g=>g.values?Vq(g):{valid:!0}},"math/div":Mq("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Mq("FlowGraphModuloBlock",["a","b"]),"math/min":Mq("FlowGraphMinBlock",["a","b"]),"math/max":Mq("FlowGraphMaxBlock",["a","b"]),"math/clamp":Mq("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Mq("FlowGraphSaturateBlock"),"math/mix":Mq("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Mq("FlowGraphEqualityBlock",["a","b"]),"math/lt":Mq("FlowGraphLessThanBlock",["a","b"]),"math/le":Mq("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Mq("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Mq("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Mq("FlowGraphIsNaNBlock"),"math/isinf":Mq("FlowGraphIsInfBlock"),"math/select":{ot:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{ot:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Mq("FlowGraphSinBlock"),"math/cos":Mq("FlowGraphCosBlock"),"math/tan":Mq("FlowGraphTanBlock"),"math/asin":Mq("FlowGraphASinBlock"),"math/acos":Mq("FlowGraphACosBlock"),"math/atan":Mq("FlowGraphATanBlock"),"math/atan2":Mq("FlowGraphATan2Block",["a","b"]),"math/sinh":Mq("FlowGraphSinhBlock"),"math/cosh":Mq("FlowGraphCoshBlock"),"math/tanh":Mq("FlowGraphTanhBlock"),"math/asinh":Mq("FlowGraphASinhBlock"),"math/acosh":Mq("FlowGraphACoshBlock"),"math/atanh":Mq("FlowGraphATanhBlock"),"math/exp":Mq("FlowGraphExponentialBlock"),"math/log":Mq("FlowGraphLogBlock"),"math/log2":Mq("FlowGraphLog2Block"),"math/log10":Mq("FlowGraphLog10Block"),"math/sqrt":Mq("FlowGraphSquareRootBlock"),"math/cbrt":Mq("FlowGraphCubeRootBlock"),"math/pow":Mq("FlowGraphPowerBlock",["a","b"]),"math/length":Mq("FlowGraphLengthBlock"),"math/normalize":Mq("FlowGraphNormalizeBlock"),"math/dot":Mq("FlowGraphDotBlock",["a","b"]),"math/cross":Mq("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Mq("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Mq("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{ot:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{ot:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{ot:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{ot:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{ot:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{ot:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{ot:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Mq("FlowGraphTransposeBlock"),"math/determinant":Mq("FlowGraphDeterminantBlock"),"math/inverse":Mq("FlowGraphInvertMatrixBlock"),"math/matmul":Mq("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{ot:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ei",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,w,q,R,o,r){const S=o[0].dataInputs.find((g=>"rotationQuaternion"===g.name));if(!S)throw new Error("Rotation quaternion input not found");return r._connectionValues[S.uniqueId]&&(r._connectionValues[S.uniqueId].type="Quaternion"),o}},"math/matDecompose":{ot:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ei"}}}},"math/quatConjugate":Mq("FlowGraphConjugateBlock",["a"]),"math/quatMul":{ot:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,w,q,R,o){var r;return(r=o[0]).config||(r.config={}),o[0].config.type="Quaternion",o}},"math/quatAngleBetween":Mq("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{ot:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Mq("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Mq("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{ot:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,w,q,R,o){var r;return(r=o[0]).config||(r.config={}),o[0].config.inputIsColumnMajor=!0,o}},"math/extract2x2":{ot:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{ot:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,w,q,R,o){var r;return(r=o[0]).config||(r.config={}),o[0].config.inputIsColumnMajor=!0,o}},"math/extract3x3":{ot:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{ot:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,w,q,R,o){var r;return(r=o[0]).config||(r.config={}),o[0].config.inputIsColumnMajor=!0,o}},"math/extract4x4":{ot:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{ot:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,w,q,R,o,r){var S,i;(i=o[0]).config||(i.config={});const T=o[0].dataInputs[0];return o[0].config.valueType=(null===(S=r._connectionValues[T.uniqueId])||void 0===S?void 0:S.type)??"FlowGraphInteger",o}},"math/and":{ot:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,w,q,R,o,r){var S,i,T;(T=o[0]).config||(T.config={});const z=o[0].dataInputs[0],t=o[0].dataInputs[1];return o[0].config.valueType=(null===(S=r._connectionValues[z.uniqueId])||void 0===S?void 0:S.type)??(null===(i=r._connectionValues[t.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",o}},"math/or":{ot:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,w,q,R,o,r){var S,i,T;(T=o[0]).config||(T.config={});const z=o[0].dataInputs[0],t=o[0].dataInputs[1];return o[0].config.valueType=(null===(S=r._connectionValues[z.uniqueId])||void 0===S?void 0:S.type)??(null===(i=r._connectionValues[t.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",o}},"math/xor":{ot:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(g,w,q,R,o,r){var S,i,T;(T=o[0]).config||(T.config={});const z=o[0].dataInputs[0],t=o[0].dataInputs[1];return o[0].config.valueType=(null===(S=r._connectionValues[z.uniqueId])||void 0===S?void 0:S.type)??(null===(i=r._connectionValues[t.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",o}},"math/asr":Mq("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Mq("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Mq("FlowGraphLeadingZerosBlock"),"math/ctz":Mq("FlowGraphTrailingZerosBlock"),"math/popcnt":Mq("FlowGraphOneBitsCounterBlock"),"math/rad":Mq("FlowGraphDegToRadBlock"),"math/deg":Mq("FlowGraphRadToDegBlock"),"type/boolToInt":Mq("FlowGraphBooleanToInt"),"type/boolToFloat":Mq("FlowGraphBooleanToFloat"),"type/intToBool":Mq("FlowGraphIntToBoolean"),"type/intToFloat":Mq("FlowGraphIntToFloat"),"type/floatToInt":Mq("FlowGraphFloatToInt"),"type/floatToBool":Mq("FlowGraphFloatToBoolean"),"flow/sequence":{ot:["FlowGraphSequenceBlock"],extraProcessor(g,w,q,R,o){const r=o[0];return r.config||(r.config={}),r.config.outputSignalCount=Object.keys(g.flows||[]).length,r.signalOutputs.forEach(((g,w)=>{g.name="out_"+w})),o}},"flow/branch":{ot:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{ot:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(g){if(g.configuration&&g.configuration.cases){const w=g.configuration.cases.value;if(!w.every((g=>"number"===typeof g&&/^-?\d+$/.test(g.toString()))))return A.d.Warn("Switch cases should be integers. Using empty array instead."),g.configuration.cases.value=[],{valid:!0};const q=new Set(w);g.configuration.cases.value=Array.from(q)}return{valid:!0}},extraProcessor(g,w,q,R,o){if("flow/switch"!==w.op||!g.flows||0===Object.keys(g.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return o[0].signalOutputs.forEach((g=>{"default"!==g.name&&(g.name="out_"+g.name)})),o}},"flow/while":{ot:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{ot:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(g,w,q,R,o){const r=o[0];return r.config||(r.config={}),r.config.incrementIndexWhenLoopDone=!0,o}},"flow/doN":{ot:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{ot:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(g,w,q,R,o){if("flow/multiGate"!==w.op||!g.flows||0===Object.keys(g.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const r=o[0];return r.config||(r.config={}),r.config.outputSignalCount=Object.keys(g.flows).length,r.signalOutputs.forEach(((g,w)=>{g.name="out_"+w})),o}},"flow/waitAll":{ot:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(g){var w,q;return"number"!==typeof(null===(w=g.configuration)||void 0===w||null===(q=w.inputFlows)||void 0===q?void 0:q.value[0])&&(g.configuration=g.configuration||{inputFlows:{value:[0]}},g.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{ot:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{ot:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{ot:["FlowGraphCancelDelayBlock"]},"variable/get":{ot:["FlowGraphGetVariableBlock"],validation(g){var w,q;return null!==(w=g.configuration)&&void 0!==w&&null!==(q=w.variable)&&void 0!==q&&q.value?{valid:!0}:(A.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(g,w)=>[w.getVariableName(g[0])]}}},"variable/set":{ot:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(g,w)=>[w.getVariableName(g[0])]}}},"variable/setMultiple":{ot:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(g,w)=>[g[0].map((g=>w.getVariableName(g)))]}},extraProcessor:(g,w,q,R,o)=>(o[0].dataInputs.forEach((g=>{g.name=R.getVariableName(+g.name)})),o)},"variable/interpolate":{ot:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(g,w)=>[w.getVariableName(g[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:g=>!0===g[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",dq:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",dq:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",dq:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",dq:"FlowGraphPlayAnimationBlock"},out:{name:"out",dq:"FlowGraphPlayAnimationBlock"},done:{name:"done",dq:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(g,w,q,R,o){var r,S,i;const T=o[0],z=null===(r=g.configuration)||void 0===r?void 0:r.variable.value[0];if("number"!==typeof z)throw A.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const t=R.arrays.staticVariables[z];"undefined"===typeof T.config.animationType.value&&(R.arrays.staticVariables,T.config.animationType.value=(0,Gq.M)(t.type));const m=o[4];return m.config||(m.config={}),(S=m.config).variable||(S.variable={}),m.config.variable.value=R.getVariableName(z),(i=o[3]).config||(i.config={}),o}},"pointer/get":{ot:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",dq:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",dq:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(g,w,q,R,o)=>(o.forEach((g=>{"FlowGraphJsonPointerParserBlock"===g.className&&(g.config||(g.config={}),g.config.outputValue=!0)})),o)},"pointer/set":{ot:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",dq:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",dq:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(g,w,q,R,o)=>(o.forEach((g=>{"FlowGraphJsonPointerParserBlock"===g.className&&(g.config||(g.config={}),g.config.outputValue=!0)})),o)},"pointer/interpolate":{ot:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",dq:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",dq:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",dq:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",dq:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",dq:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",dq:"FlowGraphPlayAnimationBlock"},out:{name:"out",dq:"FlowGraphPlayAnimationBlock"},done:{name:"done",dq:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(g,w,q,R,o)=>(o.forEach((w=>{"FlowGraphJsonPointerParserBlock"===w.className?(w.config||(w.config={}),w.config.outputValue=!0):"FlowGraphInterpolationBlock"===w.className&&(w.config||(w.config={}),Object.keys(g.values||[]).forEach((q=>{var o;const r=null===(o=g.values)||void 0===o?void 0:o[q];if("value"===q&&r){const g=r.type;void 0!==g&&(w.config.animationType=R.arrays.types[g].flowGraphType)}})))})),o)},"animation/start":{ot:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",dq:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(g,w)=>[g[0]*w._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(g,w)=>[g[0]*w._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(g,w,q,R,o,r,S){const i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=S,o}},"animation/stop":{ot:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",dq:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(g,w,q,R,o,r,S){const i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=S,o}},"animation/stopAt":{ot:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",dq:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(g,w)=>[g[0]*w._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(g,w,q,R,o,r,S){const i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=S,o}},"math/switch":{ot:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(g){if(g.configuration&&g.configuration.cases){const w=g.configuration.cases.value;if(!w.every((g=>"number"===typeof g&&/^-?\d+$/.test(g.toString()))))return A.d.Warn("Switch cases should be integers. Using empty array instead."),g.configuration.cases.value=[],{valid:!0};const q=new Set(w);g.configuration.cases.value=Array.from(q)}return{valid:!0}},extraProcessor(g,w,q,R,o){const r=o[0];return r.dataInputs.forEach((g=>{"default"!==g.name&&"case"!==g.name&&(g.name="in_"+g.name)})),r.config||(r.config={}),r.config.treatCasesAsIntegers=!0,o}},"debug/log":{ot:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Mq(g){let w=arguments.length>2?arguments[2]:void 0;return{ot:[g],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((g,w)=>(g[w]={name:w},g)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(g,q,R,o,r){var S;if(w){(S=r[0]).config||(S.config={}),r[0].config.preventIntegerFloatArithmetic=!0;let w=-1;Object.keys(g.values||{}).find((q=>{var R;return void 0!==(null===(R=g.values)||void 0===R?void 0:R[q].type)&&(w=g.values[q].type,!0)})),-1!==w&&(r[0].config.type=o.arrays.types[w].flowGraphType)}return r},validation:g=>w?Vq(g):{valid:!0}}}function Vq(g){if(g.values){const w=Object.keys(g.values).map((w=>g.values[w].type)).filter((g=>void 0!==g));if(!w.every((g=>g===w[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}jq["math/compose"]=jq["math/matCompose"],jq["math/decompose"]=jq["math/matDecompose"];var sq=q(11136);const hq={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ew",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class vq{constructor(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=g,this._gltf=w,this._animationTargetFps=q,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const g of this._interactivityGraph.types)this._types.push(hq[g.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const g of this._interactivityGraph.declarations){const w=Cq(g);if(!w)throw A.d.Error(["No mapping found for declaration",g]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:w,fullOperationName:g.extension?g.op+":"+g.extension:g.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const g of this._interactivityGraph.variables){const w=this._parseVariable(g);this._staticVariables.push(w)}}_parseVariable(g,w){const q=this._types[g.type];if(!q)throw A.d.Error(["No type found for variable",g]),new Error("Error parsing variables");if(g.value&&g.value.length!==q.length)throw A.d.Error(["Invalid value length for variable",g,q]),new Error("Error parsing variables");const R=g.value||[];if(!R.length)switch(q.flowGraphType){case"boolean":R.push(!1);break;case"FlowGraphInteger":R.push(0);break;case"number":R.push(NaN);break;case"Vector2":R.push(NaN,NaN);break;case"ew":R.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":R.fill(NaN,0,4);break;case"Matrix":R.fill(NaN,0,16);break;case"Matrix3D":R.fill(NaN,0,9)}return"number"===q.elementType&&"string"===typeof R[0]&&(R[0]=parseFloat(R[0])),{type:q.flowGraphType,value:w?w(R,this):R}}_parseEvents(){if(this._interactivityGraph.events)for(const g of this._interactivityGraph.events){const w={eventId:g.id||"internalEvent_"+this._internalEventsCounter++};g.values&&(w.eventData=Object.keys(g.values).map((w=>{var q;const R=null===(q=g.values)||void 0===q?void 0:q[w];if(!R)throw A.d.Error(["No value found for event key",w]),new Error("Error parsing events");const o=this._types[R.type];if(!o)throw A.d.Error(["No type found for event value",R]),new Error("Error parsing events");const r="undefined"!==typeof R.value?this._parseVariable(R):void 0;return{id:w,type:o.flowGraphType,eventData:!0,value:r}}))),this._events.push(w)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const w of this._interactivityGraph.nodes){if("number"!==typeof w.declaration)throw A.d.Error(["No declaration found for node",w]),new Error("Error parsing nodes");const q=this._mappings[w.declaration];if(!q)throw A.d.Error(["No mapping found for node",w]),new Error("Error parsing nodes");if(q.flowGraphMapping.validation){const R=q.flowGraphMapping.validation(w,this._interactivityGraph,this._gltf);var g;if(!R.valid)throw new Error(`Error validating interactivity node ${null===(g=this._interactivityGraph.declarations)||void 0===g?void 0:g[w.declaration].op} - ${R.error}`)}const R=[];for(const g of q.flowGraphMapping.ot){const o=this._getEmptyBlock(g,q.fullOperationName);this._parseNodeConfiguration(w,o,q.flowGraphMapping,g),R.push(o)}this._nodes.push({ot:R,fullOperationName:q.fullOperationName})}}_getEmptyBlock(g,w){return{uniqueId:(0,sq.c)(),className:g,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:w,metadata:{}}}_parseNodeConfiguration(g,w,q,R){const o=w.config;if(g.configuration){const w=Object.keys(g.configuration);for(const i of w){var r,S;const w=null===(r=g.configuration)||void 0===r?void 0:r[i];if(!w)throw A.d.Error(["No value found for node configuration",i]),new Error("Error parsing node configuration");const T=null===(S=q.configuration)||void 0===S?void 0:S[i];if(T&&T.dq?T.dq===R:0===q.ot.indexOf(R)){const g=(null===T||void 0===T?void 0:T.name)||i;w&&"undefined"!==typeof w.value||"undefined"===typeof(null===T||void 0===T?void 0:T.defaultValue)?w.value.length>=0?o[g]={value:1===w.value.length?w.value[0]:w.value}:A.d.Warn(["Invalid value for node configuration",w]):o[g]={value:T.defaultValue},T&&T.dataTransformer&&(o[g].value=T.dataTransformer([o[g].value],this)[0])}}}}_parseNodeConnections(g){for(let U=0;U<this._nodes.length;U++){var w;const N=null===(w=this._interactivityGraph.nodes)||void 0===w?void 0:w[U];if(!N)throw A.d.Error(["No node found for interactivity node",this._nodes[U]]),new Error("Error parsing node connections");const a=this._nodes[U],H=this._mappings[N.declaration];if(!H)throw A.d.Error(["No mapping found for node",N]),new Error("Error parsing node connections");const C=N.flows||{},c=Object.keys(C).sort();for(const g of c){var q,R,o,r;const w=C[g],z=null===(q=H.flowGraphMapping.outputs)||void 0===q||null===(R=q.flows)||void 0===R?void 0:R[g],t=(null===z||void 0===z?void 0:z.name)||g,m=this._createNewSocketConnection(t,!0);(z&&z.dq&&a.ot.find((g=>g.className===z.dq))||a.ot[0]).signalOutputs.push(m);const e=w.node,y=this._nodes[e];if(!y)throw A.d.Error(["No node found for input node id",e]),new Error("Error parsing node connections");const L=Hq(y.fullOperationName);if(!L)throw A.d.Error(["No mapping found for input node",y]),new Error("Error parsing node connections");let l=null===(o=L.inputs)||void 0===o||null===(r=o.flows)||void 0===r?void 0:r[w.socket||"in"],J=!1;if(!l)for(const g in null===(S=L.inputs)||void 0===S?void 0:S.flows){var S,i,T;if(g.startsWith("[")&&g.endsWith("]"))J=!0,l=null===(i=L.inputs)||void 0===i||null===(T=i.flows)||void 0===T?void 0:T[g]}const x=l?J?l.name.replace("$1",w.socket||""):l.name:w.socket||"in",G=l&&l.dq&&y.ot.find((g=>g.className===l.dq))||y.ot[0];let d=G.signalInputs.find((g=>g.name===x));d||(d=this._createNewSocketConnection(x),G.signalInputs.push(d)),d.connectedPointIds.push(m.uniqueId),m.connectedPointIds.push(d.uniqueId)}const P=N.values||{},j=Object.keys(P);for(const w of j){var z,t;const q=P[w];let R=null===(z=H.flowGraphMapping.inputs)||void 0===z||null===(t=z.values)||void 0===t?void 0:t[w],o=!1;if(!R)for(const g in null===(m=H.flowGraphMapping.inputs)||void 0===m?void 0:m.values){var m,e,y;if(g.startsWith("[")&&g.endsWith("]"))o=!0,R=null===(e=H.flowGraphMapping.inputs)||void 0===e||null===(y=e.values)||void 0===y?void 0:y[g]}const r=R?o?R.name.replace("$1",w):R.name:w,S=this._createNewSocketConnection(r);if((R&&R.dq&&a.ot.find((g=>g.className===R.dq))||a.ot[0]).dataInputs.push(S),void 0!==q.value){const w=this._parseVariable(q,R&&R.dataTransformer);g._connectionValues[S.uniqueId]=w}else{if("undefined"===typeof q.node)throw A.d.Error(["Invalid value for value connection",q]),new Error("Error parsing node connections");{var L,l,J;const g=q.node,w=q.socket||"value",R=this._nodes[g];if(!R)throw A.d.Error(["No node found for output socket reference",q]),new Error("Error parsing node connections");const o=Hq(R.fullOperationName);if(!o)throw A.d.Error(["No mapping found for output socket reference",q]),new Error("Error parsing node connections");let r=null===(L=o.outputs)||void 0===L||null===(l=L.values)||void 0===l?void 0:l[w],i=!1;if(!r)for(const q in null===(x=o.outputs)||void 0===x?void 0:x.values){var x,G,d;if(q.startsWith("[")&&q.endsWith("]"))i=!0,r=null===(G=o.outputs)||void 0===G||null===(d=G.values)||void 0===d?void 0:d[q]}const T=r?i?r.name.replace("$1",w):null===(J=r)||void 0===J?void 0:J.name:w,z=r&&r.dq&&R.ot.find((g=>g.className===r.dq))||R.ot[0];let t=z.dataOutputs.find((g=>g.name===T));t||(t=this._createNewSocketConnection(T,!0),z.dataOutputs.push(t)),S.connectedPointIds.push(t.uniqueId),t.connectedPointIds.push(S.uniqueId)}}}if(H.flowGraphMapping.interBlockConnectors)for(const g of H.flowGraphMapping.interBlockConnectors){const w=g.input,q=g.output,R=g.isVariable;this._connectFlowGraphNodes(w,q,a.ot[g.inputBlockIndex],a.ot[g.outputBlockIndex],R)}if(H.flowGraphMapping.extraProcessor){var D;const w=null===(D=this._interactivityGraph.declarations)||void 0===D?void 0:D[N.declaration];if(!w)throw A.d.Error(["No declaration found for extra processor",N]),new Error("Error parsing node connections");a.ot=H.flowGraphMapping.extraProcessor(N,w,H.flowGraphMapping,this,a.ot,g,this._gltf)}}}_createNewSocketConnection(g,w){return{uniqueId:(0,sq.c)(),name:g,_connectionType:w?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(g,w,q,R,o){const r=o?q.dataInputs:q.signalInputs,S=o?R.dataOutputs:R.signalOutputs,i=r.find((w=>w.name===g))||this._createNewSocketConnection(g),T=S.find((g=>g.name===w))||this._createNewSocketConnection(w,!0);r.find((w=>w.name===g))||r.push(i),S.find((g=>g.name===w))||S.push(T),i.connectedPointIds.push(T.uniqueId),T.connectedPointIds.push(i.uniqueId)}getVariableName(g){return"staticVariable_"+g}serializeToFlowGraph(){const g={uniqueId:(0,sq.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(g);for(let w=0;w<this._staticVariables.length;w++){const q=this._staticVariables[w];g._userVariables[this.getVariableName(w)]=q}return{rightHanded:!0,allBlocks:this._nodes.reduce(((g,w)=>g.concat(w.ot)),[]),executionContexts:[g]}}}const bq="KHR_interactivity";class Bq{constructor(g){this._loader=g,this.name=bq,this.enabled=this._loader.isExtensionUsed(bq),this._pathConverter=(0,f.h)(this._loader.IS),g._skipStartAnimationStep=!0;const w=g.babylonScene;w&&function(g){(0,f.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!g.activeCamera)return new o.Quaternion(NaN,NaN,NaN,NaN);const w=o.Quaternion.FromRotationMatrix(g.activeCamera.getWorldMatrix()).normalize();return g.useRightHandedSystem||(w.w*=-1,w.x*=-1),w},type:"Quaternion",getTarget:()=>g.activeCamera}),(0,f.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!g.activeCamera)return new o.ew(NaN,NaN,NaN);const w=g.activeCamera.getWorldMatrix().getTranslation();return g.useRightHandedSystem||(w.x*=-1),w},type:"ew",getTarget:()=>g.activeCamera}),(0,f.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:g=>{var w;return(null===(w=g._babylonAnimationGroup)||void 0===w?void 0:w.isPlaying)??!1},type:"boolean",getTarget:g=>g._babylonAnimationGroup}),(0,f.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:g=>{var w;return((null===(w=g._babylonAnimationGroup)||void 0===w?void 0:w.from)??0)/60},type:"number",getTarget:g=>g._babylonAnimationGroup}),(0,f.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:g=>{var w;return((null===(w=g._babylonAnimationGroup)||void 0===w?void 0:w.to)??0)/60},type:"number",getTarget:g=>g._babylonAnimationGroup}),(0,f.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:g=>{var w;return((null===(w=g._babylonAnimationGroup)||void 0===w?void 0:w.getCurrentFrame())??0)/60},type:"number",getTarget:g=>g._babylonAnimationGroup}),(0,f.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:g=>{var w;return((null===(w=g._babylonAnimationGroup)||void 0===w?void 0:w.getCurrentFrame())??0)/60},type:"number",getTarget:g=>g._babylonAnimationGroup})}(w)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var g;if(!this._loader.babylonScene||!this._pathConverter)return;const w=this._loader.babylonScene,q=null===(g=this._loader.IS.extensions)||void 0===g?void 0:g.KHR_interactivity;if(!q)return;const R=new Lq.b({Aw:w});R.dispatchEventsSynchronously=!1;const o=q.graphs.map((g=>new vq(g,this._loader.IS,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(o.map((async g=>await Uq(g,{coordinator:R,pathConverter:this._pathConverter})))),R.start()}}var fq;fq=async()=>(await Promise.resolve().then(q.bind(q,12881))).FlowGraphGLTFDataProvider,Aq[`${bq}/${"FlowGraphGLTFDataProvider"}`]=fq,B(bq),b(bq,!0,(g=>new Bq(g)));const Oq="KHR_node_visibility";(0,f.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:g=>{const w=g._babylonTransformNode;return!w||void 0===w.isVisible||w.isVisible},set:(g,w)=>{var q,R;null===(q=w._primitiveBabylonMeshes)||void 0===q||q.forEach((g=>{g.inheritVisibility=!0})),w._babylonTransformNode&&(w._babylonTransformNode.isVisible=g),null===(R=w._primitiveBabylonMeshes)||void 0===R||R.forEach((w=>{w.isVisible=g}))},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Eq{constructor(g){this.name=Oq,this._loader=g,this.enabled=g.isExtensionUsed(Oq)}async onReady(){var g;null===(g=this._loader.IS.nodes)||void 0===g||g.forEach((g=>{var w,q,R,o;(null===(w=g._primitiveBabylonMeshes)||void 0===w||w.forEach((g=>{g.inheritVisibility=!0})),null!==(q=g.extensions)&&void 0!==q&&q.KHR_node_visibility)&&(!1===(null===(R=g.extensions)||void 0===R?void 0:R.KHR_node_visibility.visible)&&(g._babylonTransformNode&&(g._babylonTransformNode.isVisible=!1),null===(o=g._primitiveBabylonMeshes)||void 0===o||o.forEach((g=>{g.isVisible=!1}))))}))}dispose(){this._loader=null}}B(Oq),b(Oq,!0,(g=>new Eq(g)));const Qq="KHR_node_selectability";cq("event/onSelect",Qq,{ot:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dq:"FlowGraphGetVariableBlock",dataTransformer:g=>["pickedMesh_"+g[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",dq:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(g,w,q,R,o,r,S){var i,T,z,t,m,e;const y=o[o.length-1];y.config=y.config||{},y.config.glTF=S;const L=null===(i=g.configuration)||void 0===i||null===(T=i.nodeIndex)||void 0===T?void 0:T.value[0];if(void 0===L||"number"!==typeof L)throw new Error("nodeIndex not found in configuration");const A="pickedMesh_"+L;return o[1].config.variable=A,r._userVariables[A]={className:"Mesh",id:null===S||void 0===S||null===(z=S.nodes)||void 0===z||null===(t=z[L]._babylonTransformNode)||void 0===t?void 0:t.id,uniqueId:null===S||void 0===S||null===(m=S.nodes)||void 0===m||null===(e=m[L]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},o}}),(0,f.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:g=>{const w=g._babylonTransformNode;return!w||void 0===w.jT||w.jT},set:(g,w)=>{var q;null===(q=w._primitiveBabylonMeshes)||void 0===q||q.forEach((w=>{w.jT=g}))},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"jT"],type:"boolean"});class Xq{constructor(g){this.name=Qq,this._loader=g,this.enabled=g.isExtensionUsed(Qq)}async onReady(){var g;null===(g=this._loader.IS.nodes)||void 0===g||g.forEach((g=>{var w,q,R;null!==(w=g.extensions)&&void 0!==w&&w.KHR_node_selectability&&!1===(null===(q=g.extensions)||void 0===q?void 0:q.KHR_node_selectability.selectable)&&(null===(R=g._babylonTransformNode)||void 0===R||R.getChildMeshes().forEach((g=>{g.jT=!1})))}))}dispose(){this._loader=null}}B(Qq),b(Qq,!0,(g=>new Xq(g)));const Kq="KHR_node_hoverability",Yq="targetMeshPointerOver_";cq("event/onHoverIn",Kq,{ot:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dq:"FlowGraphGetVariableBlock",dataTransformer:g=>[Yq+g[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",dq:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(g,w,q,R,o,r,S){var i,T,z,t,m,e;const y=o[o.length-1];y.config=y.config||{},y.config.glTF=S;const L=null===(i=g.configuration)||void 0===i||null===(T=i.nodeIndex)||void 0===T?void 0:T.value[0];if(void 0===L||"number"!==typeof L)throw new Error("nodeIndex not found in configuration");const A=Yq+L;return o[1].config.variable=A,r._userVariables[A]={className:"Mesh",id:null===S||void 0===S||null===(z=S.nodes)||void 0===z||null===(t=z[L]._babylonTransformNode)||void 0===t?void 0:t.id,uniqueId:null===S||void 0===S||null===(m=S.nodes)||void 0===m||null===(e=m[L]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},o}});const Fq="targetMeshPointerOut_";cq("event/onHoverOut",Kq,{ot:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dq:"FlowGraphGetVariableBlock",dataTransformer:g=>[Fq+g[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",dq:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(g,w,q,R,o,r,S){var i,T,z,t,m,e;const y=o[o.length-1];y.config=y.config||{},y.config.glTF=S;const L=null===(i=g.configuration)||void 0===i||null===(T=i.nodeIndex)||void 0===T?void 0:T.value[0];if(void 0===L||"number"!==typeof L)throw new Error("nodeIndex not found in configuration");const A=Fq+L;return o[1].config.variable=A,r._userVariables[A]={className:"Mesh",id:null===S||void 0===S||null===(z=S.nodes)||void 0===z||null===(t=z[L]._babylonTransformNode)||void 0===t?void 0:t.id,uniqueId:null===S||void 0===S||null===(m=S.nodes)||void 0===m||null===(e=m[L]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},o}}),(0,f.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:g=>{const w=g._babylonTransformNode;return!w||void 0===w.pointerOverDisableMeshTesting||w.pointerOverDisableMeshTesting},set:(g,w)=>{var q;null===(q=w._primitiveBabylonMeshes)||void 0===q||q.forEach((w=>{w.pointerOverDisableMeshTesting=!g}))},getTarget:g=>g._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class uq{constructor(g){this.name=Kq,this._loader=g,this.enabled=g.isExtensionUsed(Kq)}async onReady(){var g;null===(g=this._loader.IS.nodes)||void 0===g||g.forEach((g=>{var w,q,R;null!==(w=g.extensions)&&void 0!==w&&w.KHR_node_hoverability&&!1===(null===(q=g.extensions)||void 0===q?void 0:q.KHR_node_hoverability.hoverable)&&(null===(R=g._babylonTransformNode)||void 0===R||R.getChildMeshes().forEach((g=>{g.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}B(Kq),b(Kq,!0,(g=>new uq(g)));const nq="ExtrasAsMetadata";class Wq{_assignExtras(g,w){if(w.extras&&Object.keys(w.extras).length>0){const q=g.metadata=g.metadata||{};(q.IS=q.IS||{}).extras=w.extras}}constructor(g){this.name=nq,this.enabled=!0,this._loader=g}dispose(){this._loader=null}loadNodeAsync(g,w,q){return this._loader.loadNodeAsync(g,w,(g=>{this._assignExtras(g,w),q(g)}))}loadCameraAsync(g,w,q){return this._loader.loadCameraAsync(g,w,(g=>{this._assignExtras(g,w),q(g)}))}createMaterial(g,w,q){const R=this._loader.createMaterial(g,w,q);return this._assignExtras(R,w),R}}B(nq),b(nq,!1,(g=>new Wq(g)));q(12881)},12762:(g,w,q)=>{"use strict";q.d(w,{d:()=>V,h:()=>H,i:()=>a,j:()=>C});var R=q(10998),o=q(10991),r=q(12385),S=q(11586),i=q(11552),T=q(11567),z=q(11011),t=q(11034),m=q(11582),e=q(11670),y=q(11593),L=q(11226);class A{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ym=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Ke=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(g){this._environmentTexture=g}getNodes(){let g=[];g=g.concat(this.meshes),g=g.concat(this.lights),g=g.concat(this.cameras),g=g.concat(this.transformNodes);for(const w of this.skeletons)g=g.concat(w.bones);return g}}class l extends A{}class J{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const g=this.rootNodes;for(const R of g)R.dispose();g.length=0;const w=this.skeletons;for(const R of w)R.dispose();w.length=0;const q=this.animationGroups;for(const R of q)R.dispose();q.length=0}}class x extends A{constructor(g){super(),this._wasAddedToScene=!1,(g=g||t.c.LastCreatedScene)&&(this.Aw=g,this.proceduralTextures=[],g.WS.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=g.getEngine().onContextRestoredObservable.add((()=>{for(const g of this.geometries)g._rebuild();for(const g of this.meshes)g._rebuild();for(const g of this.Ym)g.rebuild();for(const g of this.textures)g._rebuild()})))}_topologicalSort(g){const w=new Map;for(const S of g)w.set(S.uniqueId,S);const q={dependsOn:new Map,dependedBy:new Map};for(const S of g){const g=S.uniqueId;q.dependsOn.set(g,new Set),q.dependedBy.set(g,new Set)}for(const S of g){const g=S.uniqueId,R=q.dependsOn.get(g);if(S instanceof m.d){const o=S.sourceMesh;w.has(o.uniqueId)&&(R.add(o.uniqueId),q.dependedBy.get(o.uniqueId).add(g))}const o=q.dependedBy.get(g);for(const r of S.getDescendants()){const R=r.uniqueId;if(w.has(R)){o.add(R);q.dependsOn.get(R).add(g)}}}const R=[],o=[];for(const S of g){const g=S.uniqueId;0===q.dependsOn.get(g).size&&(o.push(S),w.delete(g))}const r=o;for(;r.length>0;){const g=r.shift();R.push(g);const o=q.dependedBy.get(g.uniqueId);for(const R of Array.from(o.values())){const o=q.dependsOn.get(R);o.delete(g.uniqueId),0===o.size&&w.get(R)&&(r.push(w.get(R)),w.delete(R))}}return w.size>0&&(z.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),w.forEach((g=>{z.d.Error(g.name)}))),R}_addNodeAndDescendantsToList(g,w,q,R){if(q&&(!R||R(q))&&!w.has(q.uniqueId)){g.push(q),w.add(q.uniqueId);for(const o of q.getDescendants(!0))this._addNodeAndDescendantsToList(g,w,o,R)}}_isNodeInContainer(g){return g instanceof T.c&&-1!==this.meshes.indexOf(g)||(g instanceof i.d&&-1!==this.transformNodes.indexOf(g)||(g instanceof e.d&&-1!==this.lights.indexOf(g)||g instanceof y.b&&-1!==this.cameras.indexOf(g)))}_isValidHierarchy(){for(const g of this.meshes)if(g.parent&&!this._isNodeInContainer(g.parent))return z.d.Warn(`Node ${g.name} has a parent that is not in the container.`),!1;for(const g of this.transformNodes)if(g.parent&&!this._isNodeInContainer(g.parent))return z.d.Warn(`Node ${g.name} has a parent that is not in the container.`),!1;for(const g of this.lights)if(g.parent&&!this._isNodeInContainer(g.parent))return z.d.Warn(`Node ${g.name} has a parent that is not in the container.`),!1;for(const g of this.cameras)if(g.parent&&!this._isNodeInContainer(g.parent))return z.d.Warn(`Node ${g.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(g){let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||o.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const R={},r={},i=new J,T=[],z=[],t={doNotInstantiate:!0,...q},m=[],e=new Set;for(const o of this.transformNodes)null===o.parent&&this._addNodeAndDescendantsToList(m,e,o,t.predicate);for(const o of this.meshes)null===o.parent&&this._addNodeAndDescendantsToList(m,e,o,t.predicate);const y=this._topologicalSort(m),L=(q,o)=>{if(((w,q)=>{if(R[w.uniqueId]=q.uniqueId,r[q.uniqueId]=q,g&&(q.name=g(w.name)),q instanceof S.d){const g=q;if(g.morphTargetManager){const q=w.morphTargetManager;g.morphTargetManager=q.clone();for(let w=0;w<q.numTargets;w++){const o=q.getTarget(w),S=g.morphTargetManager.getTarget(w);R[o.uniqueId]=S.uniqueId,r[S.uniqueId]=S}}}})(q,o),q.parent){const g=R[q.parent.uniqueId],w=r[g];o.parent=w||q.parent}if(o.position&&q.position&&o.position.T(q.position),o.rotationQuaternion&&q.rotationQuaternion&&o.rotationQuaternion.T(q.rotationQuaternion),o.rotation&&q.rotation&&o.rotation.T(q.rotation),o.ei&&q.ei&&o.ei.T(q.ei),o.material){const S=o;if(S.material)if(w){const w=q.material;if(-1===z.indexOf(w)){let q=w.clone(g?g(w.name):"Clone of "+w.name);if(z.push(w),R[w.uniqueId]=q.uniqueId,r[q.uniqueId]=q,"MultiMaterial"===w.getClassName()){const o=w;for(const w of o.Li)w&&(q=w.clone(g?g(w.name):"Clone of "+w.name),z.push(w),R[w.uniqueId]=q.uniqueId,r[q.uniqueId]=q);o.Li=o.Li.map((g=>g&&r[R[g.uniqueId]]))}}"InstancedMesh"!==S.getClassName()&&(S.material=r[R[w.uniqueId]])}else"MultiMaterial"===S.material.getClassName()?-1===this.Aw.multiMaterials.indexOf(S.material)&&this.Aw.addMultiMaterial(S.material):-1===this.Aw.materials.indexOf(S.material)&&this.Aw.addMaterial(S.material)}null===o.parent&&i.rootNodes.push(o)};for(const o of y)if("InstancedMesh"===o.getClassName()){const g=o,w=g.sourceMesh,q=R[w.uniqueId];L(g,("number"===typeof q?r[q]:w).createInstance(g.name))}else{let g=!0;"ni"===o.getClassName()||"Node"===o.getClassName()||o.skeleton||!o.getTotalVertices||0===o.getTotalVertices()?g=!1:t.doNotInstantiate&&(g="function"===typeof t.doNotInstantiate?!t.doNotInstantiate(o):!t.doNotInstantiate);const w=g?o.createInstance(`instance of ${o.name}`):o.clone(`Clone of ${o.name}`,null,!0);if(!w)throw new Error(`Could not clone or instantiate node on Asset Container ${o.name}`);L(o,w)}for(const o of this.skeletons){if(t.predicate&&!t.predicate(o))continue;const w=o.clone(g?g(o.name):"Clone of "+o.name);for(const g of this.meshes)if(g.skeleton===o&&!g.isAnInstance){const q=r[R[g.uniqueId]];if(!q||q.isAnInstance)continue;if(q.skeleton=w,-1!==T.indexOf(w))continue;T.push(w);for(const g of w.bones)g._linkedTransformNode&&(g._linkedTransformNode=r[R[g._linkedTransformNode.uniqueId]])}i.skeletons.push(w)}for(const o of this.animationGroups){if(t.predicate&&!t.predicate(o))continue;const w=o.clone(g?g(o.name):"Clone of "+o.name,(g=>r[R[g.uniqueId]]||g));i.animationGroups.push(w)}return i}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||o.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Aw.environmentTexture=this.environmentTexture);for(const g of this.Aw._serializableComponents)g.addFromContainer(this);this.Aw.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const w=[];for(const q of this.cameras)g&&!g(q)||(this.Aw.addCamera(q),w.push(q));for(const q of this.lights)g&&!g(q)||(this.Aw.addLight(q),w.push(q));for(const q of this.meshes)g&&!g(q)||(this.Aw.Kz(q),w.push(q));for(const q of this.skeletons)g&&!g(q)||this.Aw.addSkeleton(q);for(const q of this.animations)g&&!g(q)||this.Aw.addAnimation(q);for(const q of this.animationGroups)g&&!g(q)||this.Aw.addAnimationGroup(q);for(const q of this.multiMaterials)g&&!g(q)||this.Aw.addMultiMaterial(q);for(const q of this.materials)g&&!g(q)||this.Aw.addMaterial(q);for(const q of this.morphTargetManagers)g&&!g(q)||this.Aw.addMorphTargetManager(q);for(const q of this.geometries)g&&!g(q)||this.Aw.addGeometry(q);for(const q of this.transformNodes)g&&!g(q)||(this.Aw.addTransformNode(q),w.push(q));for(const q of this.actionManagers)g&&!g(q)||this.Aw.addActionManager(q);for(const q of this.textures)g&&!g(q)||this.Aw.addTexture(q);for(const q of this.reflectionProbes)g&&!g(q)||this.Aw.addReflectionProbe(q);for(const q of w)q.parent&&-1===this.Aw.getNodes().indexOf(q.parent)&&(q.setParent?q.setParent(null):q.parent=null)}removeAllFromScene(){this._isValidHierarchy()||o.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Aw.environmentTexture&&(this.Aw.environmentTexture=null);for(const g of this.Aw._serializableComponents)g.removeFromContainer(this)}removeFromScene(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const w of this.cameras)g&&!g(w)||this.Aw.removeCamera(w);for(const w of this.lights)g&&!g(w)||this.Aw.removeLight(w);for(const w of this.meshes)g&&!g(w)||this.Aw.Xz(w,!0);for(const w of this.skeletons)g&&!g(w)||this.Aw.removeSkeleton(w);for(const w of this.animations)g&&!g(w)||this.Aw.removeAnimation(w);for(const w of this.animationGroups)g&&!g(w)||this.Aw.removeAnimationGroup(w);for(const w of this.multiMaterials)g&&!g(w)||this.Aw.removeMultiMaterial(w);for(const w of this.materials)g&&!g(w)||this.Aw.removeMaterial(w);for(const w of this.morphTargetManagers)g&&!g(w)||this.Aw.removeMorphTargetManager(w);for(const w of this.geometries)g&&!g(w)||this.Aw.removeGeometry(w);for(const w of this.transformNodes)g&&!g(w)||this.Aw.removeTransformNode(w);for(const w of this.actionManagers)g&&!g(w)||this.Aw.removeActionManager(w);for(const w of this.textures)g&&!g(w)||this.Aw.removeTexture(w);for(const w of this.reflectionProbes)g&&!g(w)||this.Aw.removeReflectionProbe(w)}dispose(){const g=this.cameras.slice(0);for(const y of g)y.dispose();this.cameras.length=0;const w=this.lights.slice(0);for(const y of w)y.dispose();this.lights.length=0;const q=this.meshes.slice(0);for(const y of q)y.dispose();this.meshes.length=0;const R=this.skeletons.slice(0);for(const y of R)y.dispose();this.skeletons.length=0;const o=this.animationGroups.slice(0);for(const y of o)y.dispose();this.animationGroups.length=0;const r=this.multiMaterials.slice(0);for(const y of r)y.dispose();this.multiMaterials.length=0;const S=this.materials.slice(0);for(const y of S)y.dispose();this.materials.length=0;const i=this.geometries.slice(0);for(const y of i)y.dispose();this.geometries.length=0;const T=this.transformNodes.slice(0);for(const y of T)y.dispose();this.transformNodes.length=0;const z=this.actionManagers.slice(0);for(const y of z)y.dispose();this.actionManagers.length=0;const t=this.textures.slice(0);for(const y of t)y.dispose();this.textures.length=0;const m=this.reflectionProbes.slice(0);for(const y of m)y.dispose();this.reflectionProbes.length=0;const e=this.morphTargetManagers.slice(0);for(const y of e)y.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const y of this.Aw._serializableComponents)y.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Aw.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(g,w,q){if(g&&w)for(const R of g){let g=!0;if(q)for(const w of q)if(R===w){g=!1;break}g&&(w.push(R),R._parentContainer=this)}}moveAllFromScene(g){this._wasAddedToScene=!1,void 0===g&&(g=new l);for(const w in this)Object.prototype.hasOwnProperty.call(this,w)&&(this[w]=this[w]||("_environmentTexture"===w?null:[]),this._moveAssets(this.Aw[w],this[w],g[w]));this.environmentTexture=this.Aw.environmentTexture,this.removeAllFromScene()}createRootMesh(){const g=new S.d("assetContainerRootMesh",this.Aw);for(const w of this.meshes)w.parent||g.addChild(w);return this.meshes.unshift(g),g}mergeAnimationsTo(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.c.LastCreatedScene,w=arguments.length>1?arguments[1]:void 0,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!g)return z.d.Error("No scene available to merge animations to"),[];const R=q||(w=>{let q=null;const R=w.animations.length?w.animations[0].targetProperty:"",o=w.name.split(".").join("").split("_primitive")[0];switch(R){case"position":case"rotationQuaternion":q=g.getTransformNodeByName(w.name)||g.getTransformNodeByName(o);break;case"influence":q=g.getMorphTargetByName(w.name)||g.getMorphTargetByName(o);break;default:q=g.getNodeByName(w.name)||g.getNodeByName(o)}return q}),o=this.getNodes();for(const i of o){const g=R(i);if(null!==g){for(const w of i.animations){const q=g.animations.filter((g=>g.targetProperty===w.targetProperty));for(const w of q){const q=g.animations.indexOf(w,0);q>-1&&g.animations.splice(q,1)}}g.animations=g.animations.concat(i.animations)}}const r=[],S=this.animationGroups.slice();for(const i of S){r.push(i.clone(i.name,R));for(const g of i.animatables)g.stop()}for(const i of w){const w=R(i.target);w&&(g.beginAnimation(w,i.fromFrame,i.toFrame,i.loopAnimation,i.speedRatio,i.onAnimationEnd?i.onAnimationEnd:void 0,void 0,!0,void 0,i.onAnimationLoop?i.onAnimationLoop:void 0),g.stopAnimation(i.target))}return r}populateRootNodes(){this.rootNodes.length=0;for(const g of this.meshes)g.parent||-1!==this.rootNodes.indexOf(g)||this.rootNodes.push(g);for(const g of this.transformNodes)g.parent||-1!==this.rootNodes.indexOf(g)||this.rootNodes.push(g);for(const g of this.lights)g.parent||-1!==this.rootNodes.indexOf(g)||this.rootNodes.push(g);for(const g of this.cameras)g.parent||-1!==this.rootNodes.indexOf(g)||this.rootNodes.push(g)}addAllAssetsToContainer(g){if(!g)return;const w=[],q=new Set;for(w.push(g);w.length>0;){const g=w.pop();if(g instanceof S.d?(g.Ti&&-1===this.geometries.indexOf(g.Ti)&&this.geometries.push(g.Ti),this.meshes.push(g)):g instanceof m.d?this.meshes.push(g):g instanceof i.d?this.transformNodes.push(g):g instanceof e.d?this.lights.push(g):g instanceof y.b&&this.cameras.push(g),g instanceof T.c){if(g.material&&-1===this.materials.indexOf(g.material)){this.materials.push(g.material);for(const w of g.material.getActiveTextures())-1===this.textures.indexOf(w)&&this.textures.push(w)}g.skeleton&&-1===this.skeletons.indexOf(g.skeleton)&&this.skeletons.push(g.skeleton),g.morphTargetManager&&-1===this.morphTargetManagers.indexOf(g.morphTargetManager)&&this.morphTargetManagers.push(g.morphTargetManager)}for(const R of g.getChildren())q.has(R)||w.push(R);q.add(g)}this.populateRootNodes()}_getByTags(g,w,q){if(void 0===w)return g;const R=[];for(const o in g){const r=g[o];L.e&&L.e.MatchesQuery(r,w)&&(!q||q(r))&&R.push(r)}return R}getMeshesByTags(g,w){return this._getByTags(this.meshes,g,w)}getCamerasByTags(g,w){return this._getByTags(this.cameras,g,w)}getLightsByTags(g,w){return this._getByTags(this.lights,g,w)}getMaterialsByTags(g,w){return this._getByTags(this.materials,g,w).concat(this._getByTags(this.multiMaterials,g,w))}getTransformNodesByTags(g,w){return this._getByTags(this.transformNodes,g,w)}}var G=q(11056);class d{constructor(g){this.byteOffset=0,this.buffer=g}async loadAsync(g){const w=await this.buffer.readAsync(this.byteOffset,g);this._dataView=new DataView(w.buffer,w.byteOffset,w.byteLength),this._dataByteOffset=0}readUint32(){const g=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,g}readUint8Array(g){const w=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,g);return this._dataByteOffset+=g,this.byteOffset+=g,w}readString(g){return(0,G.k)(this.readUint8Array(g))}skipBytes(g){this._dataByteOffset+=g,this.byteOffset+=g}}var D=q(12765);const U="Z2xURg",N={name:"IS",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:g=>-1!==g.indexOf("asset")&&-1!==g.indexOf("version")||g.startsWith("data:base64,"+U)||g.startsWith("data:;base64,"+U)||g.startsWith("data:application/octet-stream;base64,"+U)||g.startsWith("data:model/gltf-binary;base64,"+U)};var a,H,C,c=q(11043),P=q(11049);function j(g,w,q){try{return Promise.resolve(new Uint8Array(g,w,q))}catch(R){return Promise.reject(R)}}!function(g){g[g.AUTO=0]="AUTO",g[g.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(a||(a={})),function(g){g[g.NONE=0]="NONE",g[g.FIRST=1]="FIRST",g[g.ALL=2]="ALL"}(H||(H={})),function(g){g[g.LOADING=0]="LOADING",g[g.READY=1]="READY",g[g.COMPLETE=2]="COMPLETE"}(C||(C={}));class M{constructor(){this.coordinateSystemMode=a.AUTO,this.animationStartMode=H.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=g=>Promise.resolve(g),this.extensionOptions={}}T(g){g&&(this.onParsed=g.onParsed,this.coordinateSystemMode=g.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=g.animationStartMode??this.animationStartMode,this.loadNodeAnimations=g.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=g.loadSkins??this.loadSkins,this.loadMorphTargets=g.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=g.compileMaterials??this.compileMaterials,this.useClipPlane=g.useClipPlane??this.useClipPlane,this.compileShadowGenerators=g.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=g.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=g.useRangeRequests??this.useRangeRequests,this.createInstances=g.createInstances??this.createInstances,this.alwaysComputeBoundingBox=g.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=g.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=g.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=g.skipMaterials??this.skipMaterials,this.useSRGBBuffers=g.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=g.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=g.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=g.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=g.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=g.customRootNode,this.onMeshLoaded=g.onMeshLoaded,this.onSkinLoaded=g.onSkinLoaded,this.onTextureLoaded=g.onTextureLoaded,this.onMaterialLoaded=g.onMaterialLoaded,this.onCameraLoaded=g.onCameraLoaded,this.extensionOptions=g.extensionOptions??this.extensionOptions)}}class V extends M{constructor(g){super(),this.onParsedObservable=new R.b,this.onMeshLoadedObservable=new R.b,this.onSkinLoadedObservable=new R.b,this.onTextureLoadedObservable=new R.b,this.onMaterialLoadedObservable=new R.b,this.onCameraLoadedObservable=new R.b,this.onCompleteObservable=new R.b,this.onErrorObservable=new R.b,this.WS=new R.b,this.onExtensionLoadedObservable=new R.b,this.validate=!1,this.onValidatedObservable=new R.b,this._loader=null,this._state=null,this._requests=new Array,this.name=N.name,this.extensions=N.extensions,this.onLoaderStateChangedObservable=new R.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.T(g)}set onParsed(g){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),g&&(this._onParsedObserver=this.onParsedObservable.add(g))}set onMeshLoaded(g){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),g&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(g))}set onSkinLoaded(g){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),g&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((w=>g(w.node,w.skinnedNode))))}set onTextureLoaded(g){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),g&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(g))}set onMaterialLoaded(g){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),g&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(g))}set onCameraLoaded(g){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),g&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(g))}set onComplete(g){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(g)}set onError(g){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(g)}set onDispose(g){this._onDisposeObserver&&this.WS.remove(this._onDisposeObserver),this._onDisposeObserver=this.WS.add(g)}set onExtensionLoaded(g){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(g)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(g){this._loggingEnabled!==g&&(this._loggingEnabled=g,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(g){this._capturePerformanceCounters!==g&&(this._capturePerformanceCounters=g,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(g){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(g)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const g of this._requests)g.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=g=>Promise.resolve(g),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.WS.notifyObservers(void 0),this.WS.clear()}loadFile(g,w,q,r,S,i,T,t){if(ArrayBuffer.isView(w))return this._loadBinary(g,w,q,r,T,t),null;this._progressCallback=S;const m=w.name||o.Tools.GetFilename(w);if(i){if(this.useRangeRequests){this.validate&&z.d.Warn("glTF validation is not supported when range requests are enabled");const q={abort:()=>{},onCompleteObservable:new R.b},o={readAsync:(q,R)=>new Promise(((o,r)=>{this._loadFile(g,w,(g=>{o(new Uint8Array(g))}),!0,(g=>{r(g)}),(g=>{g.setRequestHeader("Range",`bytes=${q}-${q+R-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new d(o)).then((g=>{q.onCompleteObservable.notifyObservers(q),r(g)}),T?g=>T(void 0,g):void 0),q}return this._loadFile(g,w,(w=>{this._validate(g,new Uint8Array(w,0,w.byteLength),q,m),this._unpackBinaryAsync(new d({readAsync:(g,q)=>j(w,g,q),byteLength:w.byteLength})).then((g=>{r(g)}),T?g=>T(void 0,g):void 0)}),!0,T)}return this._loadFile(g,w,(w=>{try{this._validate(g,w,q,m),r({json:this._parseJson(w)})}catch{T&&T()}}),!1,T)}_loadBinary(g,w,q,R,o,r){this._validate(g,new Uint8Array(w.buffer,w.byteOffset,w.byteLength),q,r),this._unpackBinaryAsync(new d({readAsync:(g,q)=>function(g,w,q){try{if(w<0||w>=g.byteLength)throw new RangeError("Offset is out of range.");if(w+q>g.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(g.buffer,g.byteOffset+w,q))}catch(R){return Promise.reject(R)}}(w,g,q),byteLength:w.byteLength})).then((g=>{R(g)}),o?g=>o(void 0,g):void 0)}importMeshAsync(g,w,q,R,o,r){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(q),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(q),this._loader.importMeshAsync(g,w,null,q,R,o,r))))}loadAsync(g,w,q,R,o){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(w),this.onParsedObservable.clear(),this._log(`Loading ${o||""}`),this._loader=this._getLoader(w),this._loader.loadAsync(g,w,q,R,o))))}loadAssetContainerAsync(g,w,q,R,o){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(w),this.onParsedObservable.clear(),this._log(`Loading ${o||""}`),this._loader=this._getLoader(w);const r=new x(g),S=[];this.onMaterialLoadedObservable.add((g=>{S.push(g)}));const i=[];this.onTextureLoadedObservable.add((g=>{i.push(g)}));const T=[];this.onCameraLoadedObservable.add((g=>{T.push(g)}));const z=[];return this.onMeshLoadedObservable.add((g=>{g.morphTargetManager&&z.push(g.morphTargetManager)})),this._loader.importMeshAsync(null,g,r,w,q,R,o).then((g=>(Array.prototype.push.apply(r.geometries,g.geometries),Array.prototype.push.apply(r.meshes,g.meshes),Array.prototype.push.apply(r.Ym,g.Ym),Array.prototype.push.apply(r.skeletons,g.skeletons),Array.prototype.push.apply(r.animationGroups,g.animationGroups),Array.prototype.push.apply(r.materials,S),Array.prototype.push.apply(r.textures,i),Array.prototype.push.apply(r.lights,g.lights),Array.prototype.push.apply(r.transformNodes,g.transformNodes),Array.prototype.push.apply(r.cameras,T),Array.prototype.push.apply(r.morphTargetManagers,z),r)))}))}canDirectLoad(g){return N.canDirectLoad(g)}directLoad(g,w){if(w.startsWith("base64,"+U)||w.startsWith(";base64,"+U)||w.startsWith("application/octet-stream;base64,"+U)||w.startsWith("model/gltf-binary;base64,"+U)){const q=(0,c.b)(w);return this._validate(g,new Uint8Array(q,0,q.byteLength)),this._unpackBinaryAsync(new d({readAsync:(g,w)=>j(q,g,w),byteLength:q.byteLength}))}return this._validate(g,w),Promise.resolve({json:this._parseJson(w)})}createPlugin(g){return new V(g[N.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((g,w)=>{this.onCompleteObservable.addOnce((()=>{g()})),this.onErrorObservable.addOnce((g=>{w(g)}))}))}_setState(g){this._state!==g&&(this._state=g,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(C[this._state]))}_loadFile(g,w,q,R,o,r){const S=g._loadFile(w,q,(g=>{this._onProgress(g,S)}),!0,R,o,r);return S.onCompleteObservable.add((()=>{S._lengthComputable=!0,S._total=S._loaded})),this._requests.push(S),S}_onProgress(g,w){if(!this._progressCallback)return;w._lengthComputable=g.lengthComputable,w._loaded=g.loaded,w._total=g.total;let q=!0,R=0,o=0;for(const r of this._requests){if(void 0===r._lengthComputable||void 0===r._loaded||void 0===r._total)return;q=q&&r._lengthComputable,R+=r._loaded,o+=r._total}this._progressCallback({lengthComputable:q,loaded:R,total:q?o:0})}_validate(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),D.c.ValidateAsync(w,q,R,(w=>this.preprocessUrlAsync(q+w).then((w=>g._loadFileAsync(w,void 0,!0,!0).then((g=>new Uint8Array(g,0,g.byteLength))))))).then((g=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(g),this.onValidatedObservable.clear()}),(g=>{this._endPerformanceCounter("Validate JSON"),o.Tools.Warn(`Failed to validate: ${g.message}`),this.onValidatedObservable.clear()})))}_getLoader(g){const w=g.json.asset||{};this._log(`Asset version: ${w.version}`),w.minVersion&&this._log(`Asset minimum version: ${w.minVersion}`),w.generator&&this._log(`Asset generator: ${w.generator}`);const q=V._parseVersion(w.version);if(!q)throw new Error("Invalid version: "+w.version);if(void 0!==w.minVersion){const g=V._parseVersion(w.minVersion);if(!g)throw new Error("Invalid minimum version: "+w.minVersion);if(V._compareVersion(g,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+w.minVersion)}const R={1:V._CreateGLTF1Loader,2:V._CreateGLTF2Loader}[q.major];if(!R)throw new Error("Unsupported version: "+w.version);return R(this)}_parseJson(g){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${g.length}`);const w=JSON.parse(g);return this._endPerformanceCounter("Parse JSON"),w}_unpackBinaryAsync(g){return this._startPerformanceCounter("Unpack Binary"),g.loadAsync(20).then((()=>{const w=g.readUint32();if(1179937895!==w)throw new P.f("Unexpected magic: "+w,P.c.GLTFLoaderUnexpectedMagicError);const q=g.readUint32();this.loggingEnabled&&this._log(`Binary version: ${q}`);const R=g.readUint32();let o;switch(this.useRangeRequests||R===g.buffer.byteLength||z.d.Warn(`Length in header does not match actual data length: ${R} != ${g.buffer.byteLength}`),q){case 1:o=this._unpackBinaryV1Async(g,R);break;case 2:o=this._unpackBinaryV2Async(g,R);break;default:throw new Error("Unsupported version: "+q)}return this._endPerformanceCounter("Unpack Binary"),o}))}_unpackBinaryV1Async(g,w){const q=g.readUint32(),R=g.readUint32();if(0!==R)throw new Error(`Unexpected content format: ${R}`);const o=w-g.byteOffset,r={json:this._parseJson(g.readString(q)),bin:null};if(0!==o){const w=g.byteOffset;r.bin={readAsync:(q,R)=>g.buffer.readAsync(w+q,R),byteLength:o}}return Promise.resolve(r)}_unpackBinaryV2Async(g,w){const q=1313821514,R=5130562,o=g.readUint32();if(g.readUint32()!==q)throw new Error("First chunk format is not JSON");return g.byteOffset+o===w?g.loadAsync(o).then((()=>({json:this._parseJson(g.readString(o)),bin:null}))):g.loadAsync(o+8).then((()=>{const r={json:this._parseJson(g.readString(o)),bin:null},S=()=>{const o=g.readUint32();switch(g.readUint32()){case q:throw new Error("Unexpected JSON chunk");case R:{const w=g.byteOffset;r.bin={readAsync:(q,R)=>g.buffer.readAsync(w+q,R),byteLength:o},g.skipBytes(o);break}default:g.skipBytes(o)}return g.byteOffset!==w?g.loadAsync(8).then(S):Promise.resolve(r)};return S()}))}static _parseVersion(g){if("1.0"===g||"1.0.1"===g)return{major:1,minor:0};const w=(g+"").match(/^(\d+)\.(\d+)/);return w?{major:parseInt(w[1]),minor:parseInt(w[2])}:null}static _compareVersion(g,w){return g.major>w.major?1:g.major<w.major?-1:g.minor>w.minor?1:g.minor<w.minor?-1:0}_logOpen(g){this._log(g),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(g){const w=V._logSpaces.substring(0,2*this._logIndentLevel);z.d.Log(`${w}${g}`)}_logDisabled(g){}_startPerformanceCounterEnabled(g){o.Tools.StartPerformanceCounter(g)}_startPerformanceCounterDisabled(g){}_endPerformanceCounterEnabled(g){o.Tools.EndPerformanceCounter(g)}_endPerformanceCounterDisabled(g){}}V.IncrementalLoading=!0,V.HomogeneousCoordinates=!1,V._logSpaces="                                ",(0,r.e)(new V)},12765:(g,w,q)=>{"use strict";q.d(w,{c:()=>S});var R=q(10991);function o(g,w,q,R){const o={externalResourceFunction:R};return q&&(o.uri="file:"===w?q:w+q),ArrayBuffer.isView(g)?GLTFValidator.validateBytes(g,o):GLTFValidator.validateString(g,o)}function r(){const g=[];onmessage=w=>{const q=w.data;switch(q.id){case"init":importScripts(q.url);break;case"validate":o(q.data,q.rootUrl,q.fileName,(w=>new Promise(((q,R)=>{const o=g.length;g.push({resolve:q,reject:R}),postMessage({id:"getExternalResource",index:o,uri:w})})))).then((g=>{postMessage({id:"validate.resolve",value:g})}),(g=>{postMessage({id:"validate.reject",reason:g})}));break;case"getExternalResource.resolve":g[q.index].resolve(q.value);break;case"getExternalResource.reject":g[q.index].reject(q.reason)}}}class S{static ValidateAsync(g,w,q,S){return"function"===typeof Worker?new Promise(((i,T)=>{const z=`${o}(${r})()`,t=URL.createObjectURL(new Blob([z],{type:"application/javascript"})),m=new Worker(t),e=g=>{m.removeEventListener("error",e),m.removeEventListener("message",y),T(g)},y=g=>{const w=g.data;switch(w.id){case"getExternalResource":S(w.uri).then((g=>{m.postMessage({id:"getExternalResource.resolve",index:w.index,value:g},[g.buffer])}),(g=>{m.postMessage({id:"getExternalResource.reject",index:w.index,reason:g})}));break;case"validate.resolve":m.removeEventListener("error",e),m.removeEventListener("message",y),i(w.value),m.terminate();break;case"validate.reject":m.removeEventListener("error",e),m.removeEventListener("message",y),T(w.reason),m.terminate()}};if(m.addEventListener("error",e),m.addEventListener("message",y),m.postMessage({id:"init",url:R.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(g)){const R=g.slice();m.postMessage({id:"validate",data:R,rootUrl:w,fileName:q},[R.buffer])}else m.postMessage({id:"validate",data:g,rootUrl:w,fileName:q})})):(this._LoadScriptPromise||(this._LoadScriptPromise=R.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>o(g,w,q,S))))}}S.Configuration={url:`${R.Tools._DefaultCdnUrl}/gltf_validator.js`}},13292:(g,w,q)=>{"use strict";q.d(w,{e:()=>N});var R=q(11161),o=q(11170),r=q(11218),S=q(11180),i=q(11520),T=q(11466),z=q(11250),t=q(11395),m=q(11128),e=q(11081);q(12520),q(12426),q(12444),q(12435),q(12450),q(12458),q(12466);const y="imageProcessingCompatibility",L="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";e.d.IncludesShadersStore[y]||(e.d.IncludesShadersStore[y]=L);const A="skyPixelShader",l="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";e.d.ShadersStore[A]||(e.d.ShadersStore[A]=l);q(12525),q(12468),q(12473),q(12491),q(12482);const J="skyVertexShader",x="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";e.d.ShadersStore[J]||(e.d.ShadersStore[J]=x);var G=q(11462),d=q(11506),D=q(11499);class U extends i.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class N extends T.b{constructor(g,w){super(g,w),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new S.ew(0,100,0),this.useSunPosition=!1,this.cameraOffset=S.ew.Zero(),this.up=S.ew.Up(),this.dithering=!1,this._cameraPosition=S.ew.Zero(),this._skyOrientation=new S.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(g,w){const q=w._drawWrapper;if(this.isFrozen&&q.effect&&q._wasPreviouslyReady)return!0;w.materialDefines||(w.materialDefines=new U);const R=w.materialDefines,o=this.Ng();if(this._isReadyForSubMesh(w))return!0;if((0,D.P)(g,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,R),(0,D.I)(g,R,!0,!1),R.IMAGEPROCESSINGPOSTPROCESS!==o.imageProcessingConfiguration.applyByPostProcess&&R.markAsMiscDirty(),R.DITHER!==this.dithering&&R.markAsMiscDirty(),R.isDirty){R.markAsProcessed(),o.resetCachedMaterial();const g=new G.e;R.FOG&&g.addFallback(1,"FOG"),R.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess,R.DITHER=this.dithering;const q=[z.h.PositionKind];R.VERTEXCOLOR&&q.push(z.h.ColorKind);const r="sky",S=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,d.c)(S);const i=R.toString();w.setEffect(o.getEngine().createEffect(r,q,S,[],i,g,this.onCompiled,this.onError),R,this._materialContext)}return!(!w.effect||!w.effect.isReady())&&(R._renderId=o.getRenderId(),q._wasPreviouslyReady=!0,!0)}bindForSubMesh(g,w,q){const R=this.Ng(),o=q.materialDefines;if(!o)return;const r=q.effect;if(!r)return;this._activeEffect=r,this.bindOnlyWorldMatrix(g),this._activeEffect.setMatrix("viewProjection",R.getTransformMatrix()),this._mustRebind(R,r,q)&&((0,d.d)(r,this,R),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,D.j)(o,r,R)),R.fogEnabled&&w.applyFog&&R.fogMode!==t.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",R.getViewMatrix()),(0,D.e)(R,w,this._activeEffect);const i=R.activeCamera;if(i){const g=i.getWorldMatrix();this._cameraPosition.x=g.m[12],this._cameraPosition.y=g.m[13],this._cameraPosition.z=g.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const g=Math.PI*(this.inclination-.5),w=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(w)*Math.cos(g),this.sunPosition.y=this.distance*Math.sin(-g),this.sunPosition.z=this.distance*Math.sin(w)*Math.cos(g),S.Quaternion.FromUnitVectorsToRef(S.ew.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(w,this._activeEffect,q)}getAnimatables(){return[]}dispose(g){super.dispose(g)}clone(g){return r.c.Clone((()=>new N(g,this.Ng())),this)}serialize(){const g=super.serialize();return g.customType="BABYLON.SkyMaterial",g}getClassName(){return"SkyMaterial"}static Parse(g,w,q){return r.c.Parse((()=>new N(g.name,w)),g,w,q)}}(0,R.e)([(0,o.K)()],N.prototype,"luminance",void 0),(0,R.e)([(0,o.K)()],N.prototype,"turbidity",void 0),(0,R.e)([(0,o.K)()],N.prototype,"rayleigh",void 0),(0,R.e)([(0,o.K)()],N.prototype,"mieCoefficient",void 0),(0,R.e)([(0,o.K)()],N.prototype,"mieDirectionalG",void 0),(0,R.e)([(0,o.K)()],N.prototype,"distance",void 0),(0,R.e)([(0,o.K)()],N.prototype,"inclination",void 0),(0,R.e)([(0,o.K)()],N.prototype,"azimuth",void 0),(0,R.e)([(0,o.H)()],N.prototype,"sunPosition",void 0),(0,R.e)([(0,o.K)()],N.prototype,"useSunPosition",void 0),(0,R.e)([(0,o.H)()],N.prototype,"cameraOffset",void 0),(0,R.e)([(0,o.H)()],N.prototype,"up",void 0),(0,R.e)([(0,o.K)()],N.prototype,"dithering",void 0),(0,m.g)("BABYLON.SkyMaterial",N)},11754:(g,w,q)=>{"use strict";function R(g,w){w.headers=g.headers||{},w.statusMessage=g.statusText,w.statusCode=g.status,w.data=g.response}function o(g,w,q){return new Promise((function(o,r){q=q||{};var S,i,T,z=new XMLHttpRequest,t=q.body,m=q.headers||{};for(S in q.timeout&&(z.timeout=q.timeout),z.ontimeout=z.onerror=function(g){g.timeout="timeout"==g.type,r(g)},z.open(g,w.href||w),z.onload=function(){for(T=z.getAllResponseHeaders().trim().split(/[\r\n]+/),R(z,z);i=T.shift();)i=i.split(": "),z.headers[i.shift().toLowerCase()]=i.join(": ");if((i=z.headers["content-type"])&&~i.indexOf("application/json"))try{z.data=JSON.parse(z.data,q.reviver)}catch(g){return R(z,g),r(g)}(z.status>=400?r:o)(z)},typeof FormData<"u"&&t instanceof FormData||t&&"object"==typeof t&&(m["content-type"]="application/json",t=JSON.stringify(t)),z.withCredentials=!!q.withCredentials,m)z.setRequestHeader(S,m[S]);z.send(t)}))}q.r(w),q.d(w,{del:()=>T,get:()=>r,patch:()=>i,post:()=>S,put:()=>z,send:()=>o});var r=o.bind(o,"GET"),S=o.bind(o,"POST"),i=o.bind(o,"PATCH"),T=o.bind(o,"DELETE"),z=o.bind(o,"PUT")},13400:(g,w,q)=>{"use strict";q.d(w,{d:()=>m});const R=.5*(Math.sqrt(3)-1),o=(3-Math.sqrt(3))/6,r=1/3,S=1/6,i=(Math.sqrt(5)-1)/4,T=(5-Math.sqrt(5))/20,z=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),t=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const m=class{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const w="function"==typeof g?g:function(g){let w=0,q=0,R=0,o=1;const r=function(){let g=4022871197;return function(w){w=w.toString();for(let q=0;q<w.length;q++){g+=w.charCodeAt(q);let R=.02519603282416938*g;g=R>>>0,R-=g,R*=g,g=R>>>0,R-=g,g+=4294967296*R}return 2.3283064365386963e-10*(g>>>0)}}();w=r(" "),q=r(" "),R=r(" "),w-=r(g),w<0&&(w+=1);q-=r(g),q<0&&(q+=1);R-=r(g),R<0&&(R+=1);return function(){const g=2091639*w+2.3283064365386963e-10*o;return w=q,q=R,R=g-(o=0|g)}}(g);this.p=function(g){const w=new Uint8Array(256);for(let q=0;q<256;q++)w[q]=q;for(let q=0;q<255;q++){const R=q+~~(g()*(256-q)),o=w[q];w[q]=w[R],w[R]=o}return w}(w),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let q=0;q<512;q++)this.perm[q]=this.p[255&q],this.permMod12[q]=this.perm[q]%12}noise2D(g,w){const q=this.permMod12,r=this.perm;let S=0,i=0,T=0;const t=(g+w)*R,m=Math.floor(g+t),e=Math.floor(w+t),y=(m+e)*o,L=g-(m-y),A=w-(e-y);let l,J;L>A?(l=1,J=0):(l=0,J=1);const x=L-l+o,G=A-J+o,d=L-1+2*o,D=A-1+2*o,U=255&m,N=255&e;let a=.5-L*L-A*A;if(a>=0){const g=3*q[U+r[N]];a*=a,S=a*a*(z[g]*L+z[g+1]*A)}let H=.5-x*x-G*G;if(H>=0){const g=3*q[U+l+r[N+J]];H*=H,i=H*H*(z[g]*x+z[g+1]*G)}let C=.5-d*d-D*D;if(C>=0){const g=3*q[U+1+r[N+1]];C*=C,T=C*C*(z[g]*d+z[g+1]*D)}return 70*(S+i+T)}noise3D(g,w,q){const R=this.permMod12,o=this.perm;let i,T,t,m;const e=(g+w+q)*r,y=Math.floor(g+e),L=Math.floor(w+e),A=Math.floor(q+e),l=(y+L+A)*S,J=g-(y-l),x=w-(L-l),G=q-(A-l);let d,D,U,N,a,H;J>=x?x>=G?(d=1,D=0,U=0,N=1,a=1,H=0):J>=G?(d=1,D=0,U=0,N=1,a=0,H=1):(d=0,D=0,U=1,N=1,a=0,H=1):x<G?(d=0,D=0,U=1,N=0,a=1,H=1):J<G?(d=0,D=1,U=0,N=0,a=1,H=1):(d=0,D=1,U=0,N=1,a=1,H=0);const C=J-d+S,c=x-D+S,P=G-U+S,j=J-N+2*S,M=x-a+2*S,V=G-H+2*S,s=J-1+.5,h=x-1+.5,v=G-1+.5,b=255&y,B=255&L,f=255&A;let O=.6-J*J-x*x-G*G;if(O<0)i=0;else{const g=3*R[b+o[B+o[f]]];O*=O,i=O*O*(z[g]*J+z[g+1]*x+z[g+2]*G)}let E=.6-C*C-c*c-P*P;if(E<0)T=0;else{const g=3*R[b+d+o[B+D+o[f+U]]];E*=E,T=E*E*(z[g]*C+z[g+1]*c+z[g+2]*P)}let Q=.6-j*j-M*M-V*V;if(Q<0)t=0;else{const g=3*R[b+N+o[B+a+o[f+H]]];Q*=Q,t=Q*Q*(z[g]*j+z[g+1]*M+z[g+2]*V)}let X=.6-s*s-h*h-v*v;if(X<0)m=0;else{const g=3*R[b+1+o[B+1+o[f+1]]];X*=X,m=X*X*(z[g]*s+z[g+1]*h+z[g+2]*v)}return 32*(i+T+t+m)}noise4D(g,w,q,R){const o=this.perm;let r,S,z,m,e;const y=(g+w+q+R)*i,L=Math.floor(g+y),A=Math.floor(w+y),l=Math.floor(q+y),J=Math.floor(R+y),x=(L+A+l+J)*T,G=g-(L-x),d=w-(A-x),D=q-(l-x),U=R-(J-x);let N=0,a=0,H=0,C=0;G>d?N++:a++,G>D?N++:H++,G>U?N++:C++,d>D?a++:H++,d>U?a++:C++,D>U?H++:C++;const c=N>=3?1:0,P=a>=3?1:0,j=H>=3?1:0,M=C>=3?1:0,V=N>=2?1:0,s=a>=2?1:0,h=H>=2?1:0,v=C>=2?1:0,b=N>=1?1:0,B=a>=1?1:0,f=H>=1?1:0,O=C>=1?1:0,E=G-c+T,Q=d-P+T,X=D-j+T,K=U-M+T,Y=G-V+2*T,F=d-s+2*T,u=D-h+2*T,n=U-v+2*T,W=G-b+3*T,p=d-B+3*T,Z=D-f+3*T,I=U-O+3*T,k=G-1+4*T,gg=d-1+4*T,wg=D-1+4*T,qg=U-1+4*T,Rg=255&L,og=255&A,rg=255&l,Sg=255&J;let ig=.6-G*G-d*d-D*D-U*U;if(ig<0)r=0;else{const g=o[Rg+o[og+o[rg+o[Sg]]]]%32*4;ig*=ig,r=ig*ig*(t[g]*G+t[g+1]*d+t[g+2]*D+t[g+3]*U)}let Tg=.6-E*E-Q*Q-X*X-K*K;if(Tg<0)S=0;else{const g=o[Rg+c+o[og+P+o[rg+j+o[Sg+M]]]]%32*4;Tg*=Tg,S=Tg*Tg*(t[g]*E+t[g+1]*Q+t[g+2]*X+t[g+3]*K)}let zg=.6-Y*Y-F*F-u*u-n*n;if(zg<0)z=0;else{const g=o[Rg+V+o[og+s+o[rg+h+o[Sg+v]]]]%32*4;zg*=zg,z=zg*zg*(t[g]*Y+t[g+1]*F+t[g+2]*u+t[g+3]*n)}let tg=.6-W*W-p*p-Z*Z-I*I;if(tg<0)m=0;else{const g=o[Rg+b+o[og+B+o[rg+f+o[Sg+O]]]]%32*4;tg*=tg,m=tg*tg*(t[g]*W+t[g+1]*p+t[g+2]*Z+t[g+3]*I)}let mg=.6-k*k-gg*gg-wg*wg-qg*qg;if(mg<0)e=0;else{const g=o[Rg+1+o[og+1+o[rg+1+o[Sg+1]]]]%32*4;mg*=mg,e=mg*mg*(t[g]*k+t[g+1]*gg+t[g+2]*wg+t[g+3]*qg)}return 27*(r+S+z+m+e)}}}}]);