/*! For license information please see fhz9vr.32.4d6aeecb.chunk.js.LICENSE.txt */
(self["269hv5nclphh"]=self["269hv5nclphh"]||[]).push([[32],{14379:(E,H,d)=>{"use strict";var n=d(14381),Z=d(14384),I=d(14387);d.g.__TYPEDARRAY_POOL||(d.g.__TYPEDARRAY_POOL={UINT8:Z([32,0]),UINT16:Z([32,0]),UINT32:Z([32,0]),INT8:Z([32,0]),INT16:Z([32,0]),INT32:Z([32,0]),FLOAT:Z([32,0]),DOUBLE:Z([32,0]),DATA:Z([32,0]),UINT8C:Z([32,0]),BUFFER:Z([32,0])});var g="undefined"!==typeof Uint8ClampedArray,l=d.g.__TYPEDARRAY_POOL;l.UINT8C||(l.UINT8C=Z([32,0])),l.BUFFER||(l.BUFFER=Z([32,0]));var r=l.DATA,t=l.BUFFER;function S(E){if(E){var H=E.length||E.byteLength,d=n.log2(H);r[d].push(E)}}function M(E){E=n.nextPow2(E);var H=n.log2(E),d=r[H];return d.length>0?d.pop():new ArrayBuffer(E)}function V(E){return new Uint8Array(M(E),0,E)}function C(E){return new Uint16Array(M(2*E),0,E)}function w(E){return new Uint32Array(M(4*E),0,E)}function R(E){return new Int8Array(M(E),0,E)}function Q(E){return new Int16Array(M(2*E),0,E)}function L(E){return new Int32Array(M(4*E),0,E)}function D(E){return new Float32Array(M(4*E),0,E)}function e(E){return new Float64Array(M(8*E),0,E)}function s(E){return g?new Uint8ClampedArray(M(E),0,E):V(E)}function i(E){return new DataView(M(E),0,E)}H.free=function(E){if(I(E))t[n.log2(E.length)].push(E);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(E)&&(E=E.buffer),!E)return;var H=E.length||E.byteLength,d=0|n.log2(H);r[d].push(E)}},H.freeUint8=H.freeUint16=H.freeUint32=H.freeInt8=H.freeInt16=H.freeInt32=H.freeFloat32=H.freeFloat=H.freeFloat64=H.freeDouble=H.freeUint8Clamped=H.freeDataView=function(E){S(E.buffer)},H.freeArrayBuffer=S,H.freeBuffer=function(E){t[n.log2(E.length)].push(E)},H.malloc=function(E,H){if(void 0===H||"arraybuffer"===H)return M(E);switch(H){case"uint8":return V(E);case"uint16":return C(E);case"uint32":return w(E);case"int8":return R(E);case"int16":return Q(E);case"int32":return L(E);case"float":case"float32":return D(E);case"double":case"float64":return e(E);case"uint8_clamped":return s(E);case"buffer":throw"Buffer not supported";case"data":case"dataview":return i(E);default:return null}return null},H.mallocArrayBuffer=M,H.mallocUint8=V,H.mallocUint16=C,H.mallocUint32=w,H.mallocInt8=R,H.mallocInt16=Q,H.mallocInt32=L,H.mallocFloat32=H.mallocFloat=D,H.mallocFloat64=H.mallocDouble=e,H.mallocUint8Clamped=s,H.mallocDataView=i,H.clearCache=function(){for(var E=0;E<32;++E)l.UINT8[E].length=0,l.UINT16[E].length=0,l.UINT32[E].length=0,l.INT8[E].length=0,l.INT16[E].length=0,l.INT32[E].length=0,l.FLOAT[E].length=0,l.DOUBLE[E].length=0,l.UINT8C[E].length=0,r[E].length=0,t[E].length=0}},14459:(E,H,d)=>{E.exports=Z;var n=d(13199);function Z(E,H){if(!(this instanceof Z))return new Z(E,H);var d=n.create();n.add(d,E,H),this.base=n.min(n.create(),E,d),this.tS=n.clone(H),this.max=n.max(n.create(),E,d),this.mag=n.length(this.tS)}var I=Z.prototype;I.width=function(){return this.tS[0]},I.height=function(){return this.tS[1]},I.depth=function(){return this.tS[2]},I.x0=function(){return this.base[0]},I.y0=function(){return this.base[1]},I.z0=function(){return this.base[2]},I.x1=function(){return this.max[0]},I.y1=function(){return this.max[1]},I.z1=function(){return this.max[2]},I.translate=function(E){return n.add(this.max,this.max,E),n.add(this.base,this.base,E),this},I.setPosition=function(E){return n.add(this.max,E,this.tS),n.k(this.base,E),this},I.expand=function(E){var H=n.create(),d=n.create();return n.max(H,E.max,this.max),n.min(d,E.base,this.base),n.RH(H,H,d),new Z(d,H)},I.intersects=function(E){return!(E.base[0]>this.max[0])&&(!(E.base[1]>this.max[1])&&(!(E.base[2]>this.max[2])&&(!(E.max[0]<this.base[0])&&(!(E.max[1]<this.base[1])&&!(E.max[2]<this.base[2])))))},I.touches=function(E){var H=this.union(E);return null!==H&&(0==H.width()||0==H.height()||0==H.depth())},I.union=function(E){if(!this.intersects(E))return null;var H=Math.max(E.base[0],this.base[0]),d=Math.max(E.base[1],this.base[1]),n=Math.max(E.base[2],this.base[2]);return new Z([H,d,n],[Math.min(E.max[0],this.max[0])-H,Math.min(E.max[1],this.max[1])-d,Math.min(E.max[2],this.max[2])-n])}},14381:(E,H)=>{"use strict";function d(E){var H=32;return(E&=-E)&&H--,65535&E&&(H-=16),16711935&E&&(H-=8),252645135&E&&(H-=4),858993459&E&&(H-=2),1431655765&E&&(H-=1),H}H.INT_BITS=32,H.INT_MAX=2147483647,H.INT_MIN=-1<<31,H.sign=function(E){return(E>0)-(E<0)},H.abs=function(E){var H=E>>31;return(E^H)-H},H.min=function(E,H){return H^(E^H)&-(E<H)},H.max=function(E,H){return E^(E^H)&-(E<H)},H.isPow2=function(E){return!(E&E-1)&&!!E},H.log2=function(E){var H,d;return H=(E>65535)<<4,H|=d=((E>>>=H)>255)<<3,H|=d=((E>>>=d)>15)<<2,(H|=d=((E>>>=d)>3)<<1)|(E>>>=d)>>1},H.log10=function(E){return E>=1e9?9:E>=1e8?8:E>=1e7?7:E>=1e6?6:E>=1e5?5:E>=1e4?4:E>=1e3?3:E>=100?2:E>=10?1:0},H.popCount=function(E){return 16843009*((E=(858993459&(E-=E>>>1&1431655765))+(E>>>2&858993459))+(E>>>4)&252645135)>>>24},H.countTrailingZeros=d,H.nextPow2=function(E){return E+=0===E,--E,E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)+1},H.prevPow2=function(E){return E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)-(E>>>1)},H.parity=function(E){return E^=E>>>16,E^=E>>>8,E^=E>>>4,27030>>>(E&=15)&1};var n=new Array(256);!function(E){for(var H=0;H<256;++H){var d=H,n=H,Z=7;for(d>>>=1;d;d>>>=1)n<<=1,n|=1&d,--Z;E[H]=n<<Z&255}}(n),H.reverse=function(E){return n[255&E]<<24|n[E>>>8&255]<<16|n[E>>>16&255]<<8|n[E>>>24&255]},H.interleave2=function(E,H){return(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))|(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))<<1},H.deinterleave2=function(E,H){return(E=65535&((E=16711935&((E=252645135&((E=858993459&((E=E>>>H&1431655765)|E>>>1))|E>>>2))|E>>>4))|E>>>16))<<16>>16},H.interleave3=function(E,H,d){return E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2),(E|=(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<1)|(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<2},H.deinterleave3=function(E,H){return(E=1023&((E=4278190335&((E=251719695&((E=3272356035&((E=E>>>H&1227133513)|E>>>2))|E>>>4))|E>>>8))|E>>>16))<<22>>22},H.nextCombination=function(E){var H=E|E-1;return H+1|(~H&-~H)-1>>>d(E)+1}},14374:(E,H,d)=>{"use strict";E.exports=function(E,H,d){switch(arguments.length){case 1:return n=[],t(Z=E,Z,S,!0),n;case 2:return"function"===typeof H?t(E,E,H,!0):function(E,H){return n=[],t(E,H,S,!1),n}(E,H);case 3:return t(E,H,d,!1);default:throw new Error("box-intersect: Invalid arguments")}var Z};var n,Z=d(14379),I=d(14396),g=d(14406);function l(E,H){for(var d=0;d<E;++d)if(!(H[d]<=H[d+E]))return!0;return!1}function r(E,H,d,n){for(var Z=0,I=0,g=0,r=E.length;g<r;++g){var t=E[g];if(!l(H,t)){for(var S=0;S<2*H;++S)d[Z++]=t[S];n[I++]=g}}return I}function t(E,H,d,n){var l=E.length,t=H.length;if(!(l<=0||t<=0)){var S=E[0].length>>>1;if(!(S<=0)){var M,V=Z.mallocDouble(2*S*l),C=Z.mallocInt32(l);if((l=r(E,S,V,C))>0){if(1===S&&n)I.init(l),M=I.sweepComplete(S,d,0,l,V,C,0,l,V,C);else{var w=Z.mallocDouble(2*S*t),R=Z.mallocInt32(t);(t=r(H,S,w,R))>0&&(I.init(l+t),M=1===S?I.sweepBipartite(S,d,0,l,V,C,0,t,w,R):g(S,d,n,l,V,C,t,w,R),Z.free(w),Z.free(R))}Z.free(V),Z.free(C)}return M}}}function S(E,H){n.push([E,H])}},14409:(E,H)=>{"use strict";var d="d",n="ax",Z="fp",I="es",g="rs",l="re",r="rb",t="bs",S="be",M="bb",V=[d,n,"vv",g,l,r,"ri",t,S,M,"bi"];function C(E){var H="bruteForce"+(E?"Full":"Partial"),n=[],g=V.slice();E||g.splice(3,0,Z);var l=["function "+H+"("+g.join()+"){"];function r(H,Z){var g=function(E,H,n){var Z="bruteForce"+(E?"Red":"Blue")+(H?"Flip":"")+(n?"Full":""),g=["function ",Z,"(",V.join(),"){","var ",I,"=2*",d,";"],l="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",r="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(n?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return E?g.push(l,"Q",":",r):g.push(r,"Q",":",l),n?g.push("if(y1<x0||x1<y0)continue;"):H?g.push("if(y0<=x0||x1<y0)continue;"):g.push("if(y0<x0||x1<y0)continue;"),g.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),H?g.push("yi,xi"):g.push("xi,yi"),g.push(");if(rv!==void 0)return rv;}}}"),{name:Z,code:g.join("")}}(H,Z,E);n.push(g.code),l.push("return "+g.name+"("+V.join()+");")}l.push("if(re-rs>be-bs){"),E?(r(!0,!1),l.push("}else{"),r(!1,!1)):(l.push("if(fp){"),r(!0,!0),l.push("}else{"),r(!0,!1),l.push("}}else{if(fp){"),r(!1,!0),l.push("}else{"),r(!1,!1),l.push("}")),l.push("}}return "+H);var t=n.join("")+l.join("");return new Function(t)()}H.partial=C(!1),H.full=C(!0)},14406:(E,H,d)=>{"use strict";E.exports=function(E,H,d,I,S,W,U,Y,c){!function(E,H){var d=8*Z.log2(H+1)*(E+1)|0,I=Z.nextPow2(s*d);p.length<I&&(n.free(p),p=n.mallocInt32(I));var g=Z.nextPow2(i*d);f.length<g&&(n.free(f),f=n.mallocDouble(g))}(E,I+U);var u,o=0,F=2*E;P(o++,0,0,I,0,U,d?16:0,-1/0,1/0),d||P(o++,0,0,U,0,I,1,-1/0,1/0);for(;o>0;){var a=(o-=1)*s,k=p[a],O=p[a+1],G=p[a+2],x=p[a+3],q=p[a+4],b=p[a+5],h=o*i,y=f[h],v=f[h+1],z=1&b,K=!!(16&b),N=S,mE=W,T=Y,A=c;if(z&&(N=Y,mE=c,T=S,A=W),!(2&b&&O>=(G=Q(E,k,O,G,N,mE,v)))&&!(4&b&&(O=L(E,k,O,G,N,mE,y))>=G)){var B=G-O,J=q-x;if(K){if(E*B*(B+J)<C){if(void 0!==(u=r.scanComplete(E,k,H,O,G,N,mE,x,q,T,A)))return u;continue}}else{if(E*Math.min(B,J)<M){if(void 0!==(u=g(E,k,H,z,O,G,N,mE,x,q,T,A)))return u;continue}if(E*B*J<V){if(void 0!==(u=r.scanBipartite(E,k,H,z,O,G,N,mE,x,q,T,A)))return u;continue}}var EE=w(E,k,O,G,N,mE,y,v);if(O<EE)if(E*(EE-O)<M){if(void 0!==(u=l(E,k+1,H,O,EE,N,mE,x,q,T,A)))return u}else if(k===E-2){if(void 0!==(u=z?r.sweepBipartite(E,H,x,q,T,A,O,EE,N,mE):r.sweepBipartite(E,H,O,EE,N,mE,x,q,T,A)))return u}else P(o++,k+1,O,EE,x,q,z,-1/0,1/0),P(o++,k+1,x,q,O,EE,1^z,-1/0,1/0);if(EE<G){var HE=t(E,k,x,q,T,A),dE=T[F*HE+k],nE=R(E,k,HE,q,T,A,dE);if(nE<q&&P(o++,k,EE,G,nE,q,(4|z)+(K?16:0),dE,v),x<HE&&P(o++,k,EE,G,x,HE,(2|z)+(K?16:0),y,dE),HE+1===nE){if(void 0!==(u=K?X(E,k,H,EE,G,N,mE,HE,T,A[HE]):j(E,k,H,z,EE,G,N,mE,HE,T,A[HE])))return u}else if(HE<nE){var ZE;if(K){if(EE<(ZE=D(E,k,EE,G,N,mE,dE))){var IE=R(E,k,EE,ZE,N,mE,dE);if(k===E-2){if(EE<IE&&void 0!==(u=r.sweepComplete(E,H,EE,IE,N,mE,HE,nE,T,A)))return u;if(IE<ZE&&void 0!==(u=r.sweepBipartite(E,H,IE,ZE,N,mE,HE,nE,T,A)))return u}else EE<IE&&P(o++,k+1,EE,IE,HE,nE,16,-1/0,1/0),IE<ZE&&(P(o++,k+1,IE,ZE,HE,nE,0,-1/0,1/0),P(o++,k+1,HE,nE,IE,ZE,1,-1/0,1/0))}}else EE<(ZE=z?e(E,k,EE,G,N,mE,dE):D(E,k,EE,G,N,mE,dE))&&(k===E-2?u=z?r.sweepBipartite(E,H,HE,nE,T,A,EE,ZE,N,mE):r.sweepBipartite(E,H,EE,ZE,N,mE,HE,nE,T,A):(P(o++,k+1,EE,ZE,HE,nE,z,-1/0,1/0),P(o++,k+1,HE,nE,EE,ZE,1^z,-1/0,1/0)))}}}}};var n=d(14379),Z=d(14381),I=d(14409),g=I.partial,l=I.full,r=d(14396),t=d(14411),S=d(14413),M=128,V=1<<22,C=1<<22,w=S("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),R=S("lo===p0",["p0"]),Q=S("lo<p0",["p0"]),L=S("hi<=p0",["p0"]),D=S("lo<=p0&&p0<=hi",["p0"]),e=S("lo<p0&&p0<=hi",["p0"]),s=6,i=2,p=n.mallocInt32(1024),f=n.mallocDouble(1024);function P(E,H,d,n,Z,I,g,l,r){var t=s*E;p[t]=H,p[t+1]=d,p[t+2]=n,p[t+3]=Z,p[t+4]=I,p[t+5]=g;var S=i*E;f[S]=l,f[S+1]=r}function j(E,H,d,n,Z,I,g,l,r,t,S){var M=2*E,V=r*M,C=t[V+H];E:for(var w=Z,R=Z*M;w<I;++w,R+=M){var Q=g[R+H],L=g[R+H+E];if(!(C<Q||L<C)&&(!n||C!==Q)){for(var D,e=l[w],s=H+1;s<E;++s){Q=g[R+s],L=g[R+s+E];var i=t[V+s],p=t[V+s+E];if(L<i||p<Q)continue E}if(void 0!==(D=n?d(S,e):d(e,S)))return D}}}function X(E,H,d,n,Z,I,g,l,r,t){var S=2*E,M=l*S,V=r[M+H];E:for(var C=n,w=n*S;C<Z;++C,w+=S){var R=g[C];if(R!==t){var Q=I[w+H],L=I[w+H+E];if(!(V<Q||L<V)){for(var D=H+1;D<E;++D){Q=I[w+D],L=I[w+D+E];var e=r[M+D],s=r[M+D+E];if(L<e||s<Q)continue E}var i=d(R,t);if(void 0!==i)return i}}}}},14411:(E,H,d)=>{"use strict";E.exports=function(E,H,d,g,l,r){if(g<=d+1)return d;var t=d,S=g,M=g+d>>>1,V=2*E,C=M,w=l[V*M+H];for(;t<S;){if(S-t<Z){I(E,H,t,S,l,r),w=l[V*M+H];break}var R=S-t,Q=Math.random()*R+t|0,L=l[V*Q+H],D=Math.random()*R+t|0,e=l[V*D+H],s=Math.random()*R+t|0,i=l[V*s+H];L<=e?i>=e?(C=D,w=e):L>=i?(C=Q,w=L):(C=s,w=i):e>=i?(C=D,w=e):i>=L?(C=Q,w=L):(C=s,w=i);for(var p=V*(S-1),f=V*C,P=0;P<V;++P,++p,++f){var j=l[p];l[p]=l[f],l[f]=j}var X=r[S-1];r[S-1]=r[C],r[C]=X;for(p=V*(S-1),f=V*(C=n(E,H,t,S-1,l,r,w)),P=0;P<V;++P,++p,++f){j=l[p];l[p]=l[f],l[f]=j}X=r[S-1];if(r[S-1]=r[C],r[C]=X,M<C){for(S=C-1;t<S&&l[V*(S-1)+H]===w;)S-=1;S+=1}else{if(!(C<M))break;for(t=C+1;t<S&&l[V*t+H]===w;)t+=1}}return n(E,H,d,M,l,r,l[V*M+H])};var n=d(14413)("lo<p0",["p0"]),Z=8;function I(E,H,d,n,Z,I){for(var g=2*E,l=g*(d+1)+H,r=d+1;r<n;++r,l+=g)for(var t=Z[l],S=r,M=g*(r-1);S>d&&Z[M+H]>t;--S,M-=g){for(var V=M,C=M+g,w=0;w<g;++w,++V,++C){var R=Z[V];Z[V]=Z[C],Z[C]=R}var Q=I[S];I[S]=I[S-1],I[S-1]=Q}}},14413:E=>{"use strict";E.exports=function(E,d){var n="abcdef".split("").concat(d),Z=[];E.indexOf("lo")>=0&&Z.push("lo=e[k+n]");E.indexOf("hi")>=0&&Z.push("hi=e[k+o]");return n.push(H.replace("_",Z.join()).replace("$",E)),Function.apply(void 0,n)};var H="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14399:E=>{"use strict";E.exports=function(E,n){n<=4*H?d(0,n-1,E):t(0,n-1,E)};var H=32;function d(E,H,d){for(var n=2*(E+1),Z=E+1;Z<=H;++Z){for(var I=d[n++],g=d[n++],l=Z,r=n-2;l-- >E;){var t=d[r-2],S=d[r-1];if(t<I)break;if(t===I&&S<g)break;d[r]=t,d[r+1]=S,r-=2}d[r]=I,d[r+1]=g}}function n(E,H,d){H*=2;var n=d[E*=2],Z=d[E+1];d[E]=d[H],d[E+1]=d[H+1],d[H]=n,d[H+1]=Z}function Z(E,H,d){H*=2,d[E*=2]=d[H],d[E+1]=d[H+1]}function I(E,H,d,n){H*=2,d*=2;var Z=n[E*=2],I=n[E+1];n[E]=n[H],n[E+1]=n[H+1],n[H]=n[d],n[H+1]=n[d+1],n[d]=Z,n[d+1]=I}function g(E,H,d,n,Z){H*=2,Z[E*=2]=Z[H],Z[H]=d,Z[E+1]=Z[H+1],Z[H+1]=n}function l(E,H,d){H*=2;var n=d[E*=2],Z=d[H];return!(n<Z)&&(n!==Z||d[E+1]>d[H+1])}function r(E,H,d,n){var Z=n[E*=2];return Z<H||Z===H&&n[E+1]<d}function t(E,S,M){var V=(S-E+1)/6|0,C=E+V,w=S-V,R=E+S>>1,Q=R-V,L=R+V,D=C,e=Q,s=R,i=L,p=w,f=E+1,P=S-1,j=0;l(D,e,M)&&(j=D,D=e,e=j),l(i,p,M)&&(j=i,i=p,p=j),l(D,s,M)&&(j=D,D=s,s=j),l(e,s,M)&&(j=e,e=s,s=j),l(D,i,M)&&(j=D,D=i,i=j),l(s,i,M)&&(j=s,s=i,i=j),l(e,p,M)&&(j=e,e=p,p=j),l(e,s,M)&&(j=e,e=s,s=j),l(i,p,M)&&(j=i,i=p,p=j);for(var X=M[2*e],W=M[2*e+1],U=M[2*i],Y=M[2*i+1],c=2*D,u=2*s,o=2*p,F=2*C,a=2*R,k=2*w,O=0;O<2;++O){var G=M[c+O],x=M[u+O],q=M[o+O];M[F+O]=G,M[a+O]=x,M[k+O]=q}Z(Q,E,M),Z(L,S,M);for(var b=f;b<=P;++b)if(r(b,X,W,M))b!==f&&n(b,f,M),++f;else if(!r(b,U,Y,M))for(;;){if(r(P,U,Y,M)){r(P,X,W,M)?(I(b,f,P,M),++f,--P):(n(b,P,M),--P);break}if(--P<b)break}g(E,f-1,X,W,M),g(S,P+1,U,Y,M),f-2-E<=H?d(E,f-2,M):t(E,f-2,M),S-(P+2)<=H?d(P+2,S,M):t(P+2,S,M),P-f<=H?d(f,P,M):t(f,P,M)}},14396:(E,H,d)=>{"use strict";E.exports={init:function(E){var H=Z.nextPow2(E);r.length<H&&(n.free(r),r=n.mallocInt32(H));t.length<H&&(n.free(t),t=n.mallocInt32(H));S.length<H&&(n.free(S),S=n.mallocInt32(H));M.length<H&&(n.free(M),M=n.mallocInt32(H));V.length<H&&(n.free(V),V=n.mallocInt32(H));C.length<H&&(n.free(C),C=n.mallocInt32(H));var d=8*H;w.length<d&&(n.free(w),w=n.mallocDouble(d))},sweepBipartite:function(E,H,d,n,Z,l,V,C,L,D){for(var e=0,s=2*E,i=E-1,p=s-1,f=d;f<n;++f){var P=l[f],j=s*f;w[e++]=Z[j+i],w[e++]=-(P+1),w[e++]=Z[j+p],w[e++]=P}for(f=V;f<C;++f){P=D[f]+g;var X=s*f;w[e++]=L[X+i],w[e++]=-P,w[e++]=L[X+p],w[e++]=P}var W=e>>>1;I(w,W);var U=0,Y=0;for(f=0;f<W;++f){var c=0|w[2*f+1];if(c>=g)R(S,M,Y--,c=c-g|0);else if(c>=0)R(r,t,U--,c);else if(c<=-g){c=-c-g|0;for(var u=0;u<U;++u){if(void 0!==(o=H(r[u],c)))return o}Q(S,M,Y++,c)}else{c=-c-1|0;for(u=0;u<Y;++u){var o;if(void 0!==(o=H(c,S[u])))return o}Q(r,t,U++,c)}}},sweepComplete:function(E,H,d,n,Z,g,l,L,D,e){for(var s=0,i=2*E,p=E-1,f=i-1,P=d;P<n;++P){var j=g[P]+1<<1,X=i*P;w[s++]=Z[X+p],w[s++]=-j,w[s++]=Z[X+f],w[s++]=j}for(P=l;P<L;++P){j=e[P]+1<<1;var W=i*P;w[s++]=D[W+p],w[s++]=1|-j,w[s++]=D[W+f],w[s++]=1|j}var U=s>>>1;I(w,U);var Y=0,c=0,u=0;for(P=0;P<U;++P){var o=0|w[2*P+1],F=1&o;if(P<U-1&&o>>1===w[2*P+3]>>1&&(F=2,P+=1),o<0){for(var a=-(o>>1)-1,k=0;k<u;++k){if(void 0!==(O=H(V[k],a)))return O}if(0!==F)for(k=0;k<Y;++k){if(void 0!==(O=H(r[k],a)))return O}if(1!==F)for(k=0;k<c;++k){var O;if(void 0!==(O=H(S[k],a)))return O}0===F?Q(r,t,Y++,a):1===F?Q(S,M,c++,a):2===F&&Q(V,C,u++,a)}else{a=(o>>1)-1;0===F?R(r,t,Y--,a):1===F?R(S,M,c--,a):2===F&&R(V,C,u--,a)}}},scanBipartite:function(E,H,d,n,Z,l,S,M,V,C,L,D){var e=0,s=2*E,i=H,p=H+E,f=1,P=1;n?P=g:f=g;for(var j=Z;j<l;++j){var X=j+f,W=s*j;w[e++]=S[W+i],w[e++]=-X,w[e++]=S[W+p],w[e++]=X}for(j=V;j<C;++j){X=j+P;var U=s*j;w[e++]=L[U+i],w[e++]=-X}var Y=e>>>1;I(w,Y);var c=0;for(j=0;j<Y;++j){var u=0|w[2*j+1];if(u<0){var o=!1;if((X=-u)>=g?(o=!n,X-=g):(o=!!n,X-=1),o)Q(r,t,c++,X);else{var F=D[X],a=s*X,k=L[a+H+1],O=L[a+H+1+E];E:for(var G=0;G<c;++G){var x=r[G],q=s*x;if(!(O<S[q+H+1]||S[q+H+1+E]<k)){for(var b=H+2;b<E;++b)if(L[a+b+E]<S[q+b]||S[q+b+E]<L[a+b])continue E;var h,y=M[x];if(void 0!==(h=n?d(F,y):d(y,F)))return h}}}}else R(r,t,c--,u-f)}},scanComplete:function(E,H,d,n,Z,l,t,S,M,V,C){for(var R=0,Q=2*E,L=H,D=H+E,e=n;e<Z;++e){var s=e+g,i=Q*e;w[R++]=l[i+L],w[R++]=-s,w[R++]=l[i+D],w[R++]=s}for(e=S;e<M;++e){s=e+1;var p=Q*e;w[R++]=V[p+L],w[R++]=-s}var f=R>>>1;I(w,f);var P=0;for(e=0;e<f;++e){var j=0|w[2*e+1];if(j<0){if((s=-j)>=g)r[P++]=s-g;else{var X=C[s-=1],W=Q*s,U=V[W+H+1],Y=V[W+H+1+E];E:for(var c=0;c<P;++c){var u=r[c],o=t[u];if(o===X)break;var F=Q*u;if(!(Y<l[F+H+1]||l[F+H+1+E]<U)){for(var a=H+2;a<E;++a)if(V[W+a+E]<l[F+a]||l[F+a+E]<V[W+a])continue E;var k=d(o,X);if(void 0!==k)return k}}}}else{for(s=j-g,c=P-1;c>=0;--c)if(r[c]===s){for(a=c+1;a<P;++a)r[a-1]=r[a];break}--P}}}};var n=d(14379),Z=d(14381),I=d(14399),g=1<<28,l=1024,r=n.mallocInt32(l),t=n.mallocInt32(l),S=n.mallocInt32(l),M=n.mallocInt32(l),V=n.mallocInt32(l),C=n.mallocInt32(l),w=n.mallocDouble(8192);function R(E,H,d,n){var Z=H[n],I=E[d-1];E[Z]=I,H[I]=Z}function Q(E,H,d,n){E[d]=n,H[n]=d}},14384:E=>{"use strict";function H(E,d,n){var Z=0|E[n];if(Z<=0)return[];var I,g=new Array(Z);if(n===E.length-1)for(I=0;I<Z;++I)g[I]=d;else for(I=0;I<Z;++I)g[I]=H(E,d,n+1);return g}E.exports=function(E,d){switch("undefined"===typeof d&&(d=0),typeof E){case"number":if(E>0)return function(E,H){var d,n;for(d=new Array(E),n=0;n<E;++n)d[n]=H;return d}(0|E,d);break;case"object":if("number"===typeof E.length)return H(E,d,0)}return[]}},14349:(E,H,d)=>{E.exports=function(){var E=this;this.components={},this.comps=this.components;var H=this.components,d=1,Z={},I=[],g=[],l={timeout:!1,removals:[],multiComps:[]};function r(E,d){var n=H[d],I=Z[d],g=I.hash[E];g&&(I.remove(E),n.md&&(n.multi?(g.forEach((H=>{H&&n.md(E,H)})),g.length=0):n.md(E,g)),l.removals.push(I),t())}function t(){l.timeout||(l.timeout=!0,setTimeout(S,1))}function S(){l.timeout=!1,M()}function M(){l.multiComps.length&&function(E){for(var H=0;H<E.length;H++){var{entID:d,data:n}=E[H],Z=n.hash[d];if(Z){for(var I=0;I<Z.length;I++)Z[I]||(Z.splice(I,1),I--);0===Z.length&&(n.remove(d),l.removals.push(n))}}E.length=0}(l.multiComps),l.removals.length&&function(E){for(var H=0;H<E.length;H++){E[H].flush()}E.length=0}(l.removals)}this.fM=Z,this._systems=I,this._renderSystems=g,this.VS=function(H){var n=d++;return Array.isArray(H)&&H.forEach((H=>E.Kr(n,H))),n},this.deleteEntity=function(H){return Object.keys(Z).forEach((E=>{Z[E].hash[H]&&r(H,E)})),E},this.WS=function(E){if(!E)throw new Error("Missing component definition");var d=E.name;if(!d)throw new Error("Component definition must have a name property.");if("string"!==typeof d)throw new Error("Component name must be a string.");if(""===d)throw new Error("Component name must be a non-empty string.");if(Z[d])throw new Error(`Component ${d} already exists.`);var l={};return l.name=d,l.multi=!!E.multi,l.order=isNaN(E.order)?99:E.order,l.stateConstructor=E.stateConstructor||null,l.state=E.state||{},l.bl=E.bl||null,l.md=E.md||null,l.system=E.system||null,l.Nl=E.Nl||null,H[d]=l,Z[d]=new n,Z[d]._pendingMultiCleanup=!1,Z[d]._multiCleanupIDs=l.multi?[]:null,l.system&&(I.push(d),I.sort(((E,d)=>H[E].order-H[d].order))),l.Nl&&(g.push(d),g.sort(((E,d)=>H[E].order-H[d].order))),d},this.overwriteComponent=function(E,d){var n=H[E];if(!n)throw new Error(`Unknown component: ${E}`);if(!d)throw new Error("Missing component definition");if(n.name!==d.name)throw new Error("Overwriting component must use the same name property.");var l={};l.name=E,l.multi=!!d.multi,l.order=isNaN(d.order)?99:d.order,l.state=d.state||{},l.bl=d.bl||null,l.md=d.md||null,l.system=d.system||null,l.Nl=d.Nl||null,H[E]=l,Z[E]._pendingMultiCleanup=!1,Z[E]._multiCleanupIDs=l.multi?[]:null;var r=I.indexOf(E);l.system&&r<0&&I.push(E),!l.system&&r>=0&&I.splice(r,1),I.sort(((E,d)=>H[E].order-H[d].order));var t=g.indexOf(E);l.Nl&&t<0&&g.push(E),!l.Nl&&t>=0&&g.splice(t,1),g.sort(((E,d)=>H[E].order-H[d].order));var S=l.state;return this.Nt(E).forEach((E=>{for(var H in S)H in E||(E[H]=S[H]);l.bl&&l.bl(E.zl,E)})),E},this.deleteComponent=function(d){var n=Z[d];if(!n)throw new Error(`Unknown component: ${d}`);n.flush(),n.list.forEach((E=>{E&&r(E.zl||E[0].zl,d)}));var l=I.indexOf(d),t=g.indexOf(d);return l>-1&&I.splice(l,1),t>-1&&g.splice(t,1),Z[d].dispose(),delete Z[d],delete H[d],E},this.Kr=function(E,d,n){var I,g=H[d],l=Z[d];if(!l)throw new Error(`Unknown component: ${d}.`);if(l.hash[E]&&!g.multi)throw new Error(`Entity ${E} already has component: ${d}.`);if(g.stateConstructor){if(!(I=new g.stateConstructor).hasOwnProperty("zl"))throw new Error(`Component ${g.name} stateConstructor type does not have property __id`)}else I=Object.assign({},{zl:E},g.state,n);if(I.zl=E,g.multi){var r=l.hash[E];r||(r=[],l.add(E,r)),r.push(I)}else l.add(E,I);return g.bl&&g.bl(E,I),this},this.Zt=function(E,H){var d=Z[H];if(!d)throw new Error(`Unknown component: ${H}.`);return!!d.hash[E]},this.Br=function(H,d){if(!Z[d])throw new Error(`Unknown component: ${d}.`);return r(H,d),E},this.getState=function(E,H){var d=Z[H];if(!d)throw new Error(`Unknown component: ${H}.`);return d.hash[E]},this.Nt=function(E){var H=Z[E];if(!H)throw new Error(`Unknown component: ${E}.`);return M(),H.list},this.MC=function(E){if(!Z[E])throw new Error(`Unknown component: ${E}.`);var H=Z[E].hash;return E=>H[E]},this.wC=function(E){if(!Z[E])throw new Error(`Unknown component: ${E}.`);var H=Z[E].hash;return E=>!!H[E]},this.ql=function(d){M();for(var n=0;n<I.length;n++){var g=I[n],l=H[g],r=Z[g];l.system(d,r.list),M()}return E},this.render=function(d){M();for(var n=0;n<g.length;n++){var I=g[n],l=H[I],r=Z[I];l.Nl(d,r.list),M()}return E},this.removeMultiComponent=function(d,n,I){var g=H[n],r=Z[n];if(!r)throw new Error(`Unknown component: ${n}.`);if(!g.multi)throw new Error("removeMultiComponent called on non-multi component");return function(E,H,d,n){var Z=d.hash[E];if(Z){var I=Z[n];I&&(Z[n]=null,H.md&&H.md(E,I),l.multiComps.push({entID:E,data:d}),t())}}(d,g,r,I),E}};var n=d(14353)},14353:E=>{function H(E,H){var d=E._map[H];if(delete E.hash[H],delete E._map[H],d===E.list.length-1)E.list.pop();else{var n=E.list.pop();if(E.list[d]=n,null===n||null===n[0]){var Z=E.list.length;for(var I in E._map)if(E._map[I]===Z)return void(E._map[I]=d)}else{var g=n.zl||n[0].zl;E._map[g]=d}}}E.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(E,H){if("number"===typeof this._map[E]){var d=this._map[E];this.hash[E]=H,this.list[d]=H}else this._map[E]=this.list.length,this.hash[E]=H,this.list.push(H)}remove(E){var H=this._map[E];this.hash[E]=null,this.list[H]=null,this._pendingRemovals.push(E)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var E=0;E<this._pendingRemovals.length;E++){var d=this._pendingRemovals[E];null===this.hash[d]&&H(this,d)}this._pendingRemovals.length=0}}},14303:E=>{"use strict";var H,d="object"===typeof Reflect?Reflect:null,n=function(E,H,d){return Function.prototype.apply.call(E,H,d)};H=d&&"function"===typeof d.ownKeys?d.ownKeys:Object.getOwnPropertySymbols?function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:function(E){return Object.getOwnPropertyNames(E)};var Z=Number.isNaN||function(E){return E!==E};function I(){I.init.call(this)}E.exports=I,E.exports.once=function(E,H){return new Promise((function(d,n){function Z(d){E.removeListener(H,I),n(d)}function I(){"function"===typeof E.removeListener&&E.removeListener("error",Z),d([].slice.call(arguments))}R(E,H,I,{once:!0}),"error"!==H&&function(E,H,d){"function"===typeof E.on&&R(E,"error",H,d)}(E,Z,{once:!0})}))},I.EventEmitter=I,I.prototype._events=void 0,I.prototype._eventsCount=0,I.prototype._maxListeners=void 0;var g=10;function l(E){if("function"!==typeof E)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}function r(E){return void 0===E._maxListeners?I.defaultMaxListeners:E._maxListeners}function t(E,H,d,n){var Z,I,g,t;if(l(d),void 0===(I=E._events)?(I=E._events=Object.create(null),E._eventsCount=0):(void 0!==I.newListener&&(E.emit("newListener",H,d.listener?d.listener:d),I=E._events),g=I[H]),void 0===g)g=I[H]=d,++E._eventsCount;else if("function"===typeof g?g=I[H]=n?[d,g]:[g,d]:n?g.unshift(d):g.push(d),(Z=r(E))>0&&g.length>Z&&!g.warned){g.warned=!0;var S=new Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(H)+" listeners added. Use emitter.setMaxListeners() to increase limit");S.name="MaxListenersExceededWarning",S.nH=E,S.type=H,S.count=g.length,t=S,console&&console.warn&&console.warn(t)}return E}function S(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function M(E,H,d){var n={fired:!1,wrapFn:void 0,target:E,type:H,listener:d},Z=S.bind(n);return Z.listener=d,n.wrapFn=Z,Z}function V(E,H,d){var n=E._events;if(void 0===n)return[];var Z=n[H];return void 0===Z?[]:"function"===typeof Z?d?[Z.listener||Z]:[Z]:d?function(E){for(var H=new Array(E.length),d=0;d<H.length;++d)H[d]=E[d].listener||E[d];return H}(Z):w(Z,Z.length)}function C(E){var H=this._events;if(void 0!==H){var d=H[E];if("function"===typeof d)return 1;if(void 0!==d)return d.length}return 0}function w(E,H){for(var d=new Array(H),n=0;n<H;++n)d[n]=E[n];return d}function R(E,H,d,n){if("function"===typeof E.on)n.once?E.once(H,d):E.on(H,d);else{if("function"!==typeof E.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E);E.addEventListener(H,(function Z(I){n.once&&E.removeEventListener(H,Z),d(I)}))}}Object.defineProperty(I,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(E){if("number"!==typeof E||E<0||Z(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");g=E}}),I.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},I.prototype.setMaxListeners=function(E){if("number"!==typeof E||E<0||Z(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this},I.prototype.getMaxListeners=function(){return r(this)},I.prototype.emit=function(E){for(var H=[],d=1;d<arguments.length;d++)H.push(arguments[d]);var Z="error"===E,I=this._events;if(void 0!==I)Z=Z&&void 0===I.error;else if(!Z)return!1;if(Z){var g;if(H.length>0&&(g=H[0]),g instanceof Error)throw g;var l=new Error("Unhandled error."+(g?" ("+g.message+")":""));throw l.context=g,l}var r=I[E];if(void 0===r)return!1;if("function"===typeof r)n(r,this,H);else{var t=r.length,S=w(r,t);for(d=0;d<t;++d)n(S[d],this,H)}return!0},I.prototype.addListener=function(E,H){return t(this,E,H,!1)},I.prototype.on=I.prototype.addListener,I.prototype.prependListener=function(E,H){return t(this,E,H,!0)},I.prototype.once=function(E,H){return l(H),this.on(E,M(this,E,H)),this},I.prototype.prependOnceListener=function(E,H){return l(H),this.prependListener(E,M(this,E,H)),this},I.prototype.removeListener=function(E,H){var d,n,Z,I,g;if(l(H),void 0===(n=this._events))return this;if(void 0===(d=n[E]))return this;if(d===H||d.listener===H)0===--this._eventsCount?this._events=Object.create(null):(delete n[E],n.removeListener&&this.emit("removeListener",E,d.listener||H));else if("function"!==typeof d){for(Z=-1,I=d.length-1;I>=0;I--)if(d[I]===H||d[I].listener===H){g=d[I].listener,Z=I;break}if(Z<0)return this;0===Z?d.shift():function(E,H){for(;H+1<E.length;H++)E[H]=E[H+1];E.pop()}(d,Z),1===d.length&&(n[E]=d[0]),void 0!==n.removeListener&&this.emit("removeListener",E,g||H)}return this},I.prototype.off=I.prototype.removeListener,I.prototype.ZH=function(E){var H,d,n;if(void 0===(d=this._events))return this;if(void 0===d.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==d[E]&&(0===--this._eventsCount?this._events=Object.create(null):delete d[E]),this;if(0===arguments.length){var Z,I=Object.keys(d);for(n=0;n<I.length;++n)"removeListener"!==(Z=I[n])&&this.ZH(Z);return this.ZH("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(H=d[E]))this.removeListener(E,H);else if(void 0!==H)for(n=H.length-1;n>=0;n--)this.removeListener(E,H[n]);return this},I.prototype.listeners=function(E){return V(this,E,!0)},I.prototype.rawListeners=function(E){return V(this,E,!1)},I.listenerCount=function(E,H){return"function"===typeof E.listenerCount?E.listenerCount(H):C.call(E,H)},I.prototype.listenerCount=C,I.prototype.eventNames=function(){return this._eventsCount>0?H(this._events):[]}},14595:E=>{"use strict";E.exports=function(E,H,d,n,Z,I){var g=+H[0],l=+H[1],r=+H[2],t=+d[0],S=+d[1],M=+d[2],V=Math.sqrt(t*t+S*S+M*M);if(0===V)throw new Error("Can't raycast along a zero vector");return function(E,H,d,n,Z,I,g,l,r,t){for(var S=0,M=Math.floor,V=0|M(H),C=0|M(d),w=0|M(n),R=Z>0?1:-1,Q=I>0?1:-1,L=g>0?1:-1,D=Math.abs(1/Z),e=Math.abs(1/I),s=Math.abs(1/g),i=D<1/0?D*(R>0?V+1-H:H-V):1/0,p=e<1/0?e*(Q>0?C+1-d:d-C):1/0,f=s<1/0?s*(L>0?w+1-n:n-w):1/0,P=-1;S<=l;){var j=E(V,C,w);if(j)return r&&(r[0]=H+S*Z,r[1]=d+S*I,r[2]=n+S*g),t&&(t[0]=t[1]=t[2]=0,0===P&&(t[0]=-R),1===P&&(t[1]=-Q),2===P&&(t[2]=-L)),j;i<p?i<f?(V+=R,S=i,i+=D,P=0):(w+=L,S=f,f+=s,P=2):p<f?(C+=Q,S=p,p+=e,P=1):(w+=L,S=f,f+=s,P=2)}return r&&(r[0]=H+S*Z,r[1]=d+S*I,r[2]=n+S*g),t&&(t[0]=t[1]=t[2]=0),0}(E,g,l,r,t/=V,S/=V,M/=V,n="undefined"===typeof n?64:+n,Z,I)}},14628:(E,H,d)=>{"use strict";d.d(H,{b:()=>I});var n=d(14303);function Z(){this.VV=!1,this.stopPropagation=!1,this.CV=!1,this.disabled=!1}class I{constructor(E,H){this.version="0.7.0";var d=Object.assign({},new Z,H||{});this.element=E||document,this.VV=!!d.VV,this.stopPropagation=!!d.stopPropagation,this.CV=!!d.CV,this.disabled=!!d.disabled,this.filterEvents=(E,H)=>!0,this.down=new n.EventEmitter,this.up=new n.EventEmitter,this.state={},this.bt={dx:0,dy:0,dC:0,qt:0,nC:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?l(this):document.addEventListener("DOMContentLoaded",(E=>{l(this)}),{once:!0})}bind(E){for(var H=arguments.length,d=new Array(H>1?H-1:0),n=1;n<H;n++)d[n-1]=arguments[n];d.forEach((H=>{var d=this._keyBindmap[H]||[];d.includes(E)||(d.push(E),this._keyBindmap[H]=d)})),this.state[E]=!!this.state[E],this.pressCount[E]=this.pressCount[E]||0,this.releaseCount[E]=this.releaseCount[E]||0}unbind(E){for(var H in this._keyBindmap){var d=this._keyBindmap[H],n=d.indexOf(E);n>-1&&d.splice(n,1)}}getBindings(){var E={};for(var H in this._keyBindmap){this._keyBindmap[H].forEach((d=>{E[d]=E[d]||[],E[d].push(H)}))}return E}ql(){g(this.bt),g(this.pressCount),g(this.releaseCount)}}function g(E){for(var H in E)E[H]=0}function l(E){window.addEventListener("keydown",w.bind(null,E,!0),!1),window.addEventListener("keyup",w.bind(null,E,!1),!1);var H={passive:!0};E.element.addEventListener("touchstart",M.bind(void 0,E),{passive:!1}),E.element.addEventListener("touchend",C.bind(void 0,E),H),E.element.addEventListener("mousedown",R.bind(null,E,!0),H),window.document.addEventListener("mouseup",R.bind(null,E,!1),H),E.element.addEventListener("touchmove",Q.bind(null,E),H),E.element.addEventListener("mousemove",Q.bind(null,E),H),window.PointerEvent,E.element.addEventListener("wheel",L.bind(null,E),H),E.element.addEventListener("contextmenu",D.bind(null,E),!1),window.addEventListener("blur",e.bind(null,E),!1)}var r=0,t=0,S=null;function M(E,H){H.preventDefault(),V(H)}function V(E){let H=!1;for(let d=0;d<E.touches.length;++d)if(E.touches[d].identifier===S){H=!0;break}if(!H){const H=E.changedTouches[0];r=H.clientX,t=H.clientY,S=H.identifier}}function C(E,H){for(var d=H.changedTouches,n=0;n<d.length;++n)d[n].identifier===S&&(S=null)}function w(E,H,d){s(d.code,H,E,d)}function R(E,H,d){if("pointerId"in d)if(H){if(null!==E._touches.currID)return;E._touches.currID=d.pointerId}else{if(E._touches.currID!==d.pointerId)return;E._touches.currID=null}return s("Mouse"+("button"in d?d.button+1:1),H,E,d),!1}function Q(E,H){var d=H.movementX||H.mozMovementX||0,n=H.movementY||H.mozMovementY||0;if(H.touches&&0===(d|n)){var Z=function(E){V(E);for(let H=0;H<E.changedTouches.length;++H)if(E.changedTouches[H].identifier==S){const d=E.changedTouches[H],n=[d.clientX-r,d.clientY-t];return r=d.clientX,t=d.clientY,n}return console.error(`Did not find touch id ${S}`),[0,0]}(H);d=Z[0],n=Z[1]}E.bt.dx+=d,E.bt.dy+=n}function L(E,H){var d=1;switch(H.deltaMode){case 0:d=1;break;case 1:d=12;break;case 2:d=E.element.clientHeight||window.innerHeight}E.bt.dC+=(H.deltaX||0)*d,E.bt.qt+=(H.deltaY||0)*d,E.bt.nC+=(H.deltaZ||0)*d}function D(E,H){if(!E.CV)return H.preventDefault(),!1}function e(E){for(var H in E._keyStates)E._keyStates[H]&&(/^Mouse\d/.test(H)||s(H,!1,E,{code:H,note:"szk6vjikiej",preventDefault:()=>{},stopPropagation:()=>{}}))}function s(E,H,d,n){var Z=d._keyBindmap[E];Z&&(i(d._keyStates[E],H)&&(d._keyStates[E]=H,Z.forEach((E=>{(!d.filterEvents||d.filterEvents(n,E))&&function(E,H,d,n){var Z=H?d.pressCount:d.releaseCount;Z[E]=(Z[E]||0)+1;var I=d._bindPressCount[E]||0;(I+=H?1:-1)<0&&(I=0);d._bindPressCount[E]=I;var g=d.state[E];if(i(g,I)){d.state[E]=I>0;var l=H?d.down:d.up;d.disabled||l.emit(E,n)}}(E,H,d,n)}))),"button"in n||(d.VV&&!n.defaultPrevented&&n.preventDefault(),d.stopPropagation&&n.stopPropagation()))}function i(E,H){return E?!H:H}},13266:E=>{E.exports=function(E,H,d){return E[0]=H[0]+d[0],E[1]=H[1]+d[1],E[2]=H[2]+d[2],E}},13224:(E,H,d)=>{E.exports=function(E,H){var d=n(E[0],E[1],E[2]),g=n(H[0],H[1],H[2]);Z(d,d),Z(g,g);var l=I(d,g);return l>1?0:Math.acos(l)};var n=d(13230),Z=d(13234),I=d(13239)},13327:E=>{E.exports=function(E,H){return E[0]=Math.ceil(H[0]),E[1]=Math.ceil(H[1]),E[2]=Math.ceil(H[2]),E}},13215:E=>{E.exports=function(E){var H=new Float32Array(3);return H[0]=E[0],H[1]=E[1],H[2]=E[2],H}},13241:E=>{E.exports=function(E,H){return E[0]=H[0],E[1]=H[1],E[2]=H[2],E}},13209:E=>{E.exports=function(){var E=new Float32Array(3);return E[0]=0,E[1]=0,E[2]=0,E}},13405:E=>{E.exports=function(E,H,d){var n=H[0],Z=H[1],I=H[2],g=d[0],l=d[1],r=d[2];return E[0]=Z*r-I*l,E[1]=I*g-n*r,E[2]=n*l-Z*g,E}},13353:(E,H,d)=>{E.exports=d(13348)},13348:E=>{E.exports=function(E,H){var d=H[0]-E[0],n=H[1]-E[1],Z=H[2]-E[2];return Math.sqrt(d*d+n*n+Z*Z)}},13298:(E,H,d)=>{E.exports=d(13296)},13296:E=>{E.exports=function(E,H,d){return E[0]=H[0]/d[0],E[1]=H[1]/d[1],E[2]=H[2]/d[2],E}},13239:E=>{E.exports=function(E,H){return E[0]*H[0]+E[1]*H[1]+E[2]*H[2]}},13203:E=>{E.exports=1e-6},13253:(E,H,d)=>{E.exports=function(E,H){var d=E[0],Z=E[1],I=E[2],g=H[0],l=H[1],r=H[2];return Math.abs(d-g)<=n*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(Z-l)<=n*Math.max(1,Math.abs(Z),Math.abs(l))&&Math.abs(I-r)<=n*Math.max(1,Math.abs(I),Math.abs(r))};var n=d(13203)},13261:E=>{E.exports=function(E,H){return E[0]===H[0]&&E[1]===H[1]&&E[2]===H[2]}},13318:E=>{E.exports=function(E,H){return E[0]=Math.floor(H[0]),E[1]=Math.floor(H[1]),E[2]=Math.floor(H[2]),E}},13443:(E,H,d)=>{E.exports=function(E,H,d,Z,I,g){var l,r;H||(H=3);d||(d=0);r=Z?Math.min(Z*H+d,E.length):E.length;for(l=d;l<r;l+=H)n[0]=E[l],n[1]=E[l+1],n[2]=E[l+2],I(n,n,g),E[l]=n[0],E[l+1]=n[1],E[l+2]=n[2];return E};var n=d(13209)()},13230:E=>{E.exports=function(E,H,d){var n=new Float32Array(3);return n[0]=E,n[1]=H,n[2]=d,n}},13199:(E,H,d)=>{E.exports={EPSILON:d(13203),create:d(13209),clone:d(13215),angle:d(13224),cl:d(13230),k:d(13241),set:d(13247),equals:d(13253),exactEquals:d(13261),add:d(13266),RH:d(13275),sub:d(13280),multiply:d(13282),mul:d(13291),divide:d(13296),div:d(13298),min:d(13303),max:d(13312),floor:d(13318),ceil:d(13327),round:d(13333),scale:d(13338),ul:d(13342),distance:d(13348),i:d(13353),squaredDistance:d(13356),sqrDist:d(13363),length:d(13365),len:d(13372),squaredLength:d(13378),ol:d(13386),negate:d(13393),inverse:d(13400),normalize:d(13234),dot:d(13239),cross:d(13405),Wl:d(13408),random:d(13410),transformMat4:d(13413),transformMat3:d(13421),transformQuat:d(13429),Fl:d(13433),al:d(13436),kl:d(13441),forEach:d(13443)}},13400:E=>{E.exports=function(E,H){return E[0]=1/H[0],E[1]=1/H[1],E[2]=1/H[2],E}},13372:(E,H,d)=>{E.exports=d(13365)},13365:E=>{E.exports=function(E){var H=E[0],d=E[1],n=E[2];return Math.sqrt(H*H+d*d+n*n)}},13408:E=>{E.exports=function(E,H,d,n){var Z=H[0],I=H[1],g=H[2];return E[0]=Z+n*(d[0]-Z),E[1]=I+n*(d[1]-I),E[2]=g+n*(d[2]-g),E}},13312:E=>{E.exports=function(E,H,d){return E[0]=Math.max(H[0],d[0]),E[1]=Math.max(H[1],d[1]),E[2]=Math.max(H[2],d[2]),E}},13303:E=>{E.exports=function(E,H,d){return E[0]=Math.min(H[0],d[0]),E[1]=Math.min(H[1],d[1]),E[2]=Math.min(H[2],d[2]),E}},13291:(E,H,d)=>{E.exports=d(13282)},13282:E=>{E.exports=function(E,H,d){return E[0]=H[0]*d[0],E[1]=H[1]*d[1],E[2]=H[2]*d[2],E}},13393:E=>{E.exports=function(E,H){return E[0]=-H[0],E[1]=-H[1],E[2]=-H[2],E}},13234:E=>{E.exports=function(E,H){var d=H[0],n=H[1],Z=H[2],I=d*d+n*n+Z*Z;I>0&&(I=1/Math.sqrt(I),E[0]=H[0]*I,E[1]=H[1]*I,E[2]=H[2]*I);return E}},13410:E=>{E.exports=function(E,H){H=H||1;var d=2*Math.random()*Math.PI,n=2*Math.random()-1,Z=Math.sqrt(1-n*n)*H;return E[0]=Math.cos(d)*Z,E[1]=Math.sin(d)*Z,E[2]=n*H,E}},13433:E=>{E.exports=function(E,H,d,n){var Z=d[1],I=d[2],g=H[1]-Z,l=H[2]-I,r=Math.sin(n),t=Math.cos(n);return E[0]=H[0],E[1]=Z+g*t-l*r,E[2]=I+g*r+l*t,E}},13436:E=>{E.exports=function(E,H,d,n){var Z=d[0],I=d[2],g=H[0]-Z,l=H[2]-I,r=Math.sin(n),t=Math.cos(n);return E[0]=Z+l*r+g*t,E[1]=H[1],E[2]=I+l*t-g*r,E}},13441:E=>{E.exports=function(E,H,d,n){var Z=d[0],I=d[1],g=H[0]-Z,l=H[1]-I,r=Math.sin(n),t=Math.cos(n);return E[0]=Z+g*t-l*r,E[1]=I+g*r+l*t,E[2]=H[2],E}},13333:E=>{E.exports=function(E,H){return E[0]=Math.round(H[0]),E[1]=Math.round(H[1]),E[2]=Math.round(H[2]),E}},13338:E=>{E.exports=function(E,H,d){return E[0]=H[0]*d,E[1]=H[1]*d,E[2]=H[2]*d,E}},13342:E=>{E.exports=function(E,H,d,n){return E[0]=H[0]+d[0]*n,E[1]=H[1]+d[1]*n,E[2]=H[2]+d[2]*n,E}},13247:E=>{E.exports=function(E,H,d,n){return E[0]=H,E[1]=d,E[2]=n,E}},13363:(E,H,d)=>{E.exports=d(13356)},13386:(E,H,d)=>{E.exports=d(13378)},13356:E=>{E.exports=function(E,H){var d=H[0]-E[0],n=H[1]-E[1],Z=H[2]-E[2];return d*d+n*n+Z*Z}},13378:E=>{E.exports=function(E){var H=E[0],d=E[1],n=E[2];return H*H+d*d+n*n}},13280:(E,H,d)=>{E.exports=d(13275)},13275:E=>{E.exports=function(E,H,d){return E[0]=H[0]-d[0],E[1]=H[1]-d[1],E[2]=H[2]-d[2],E}},13421:E=>{E.exports=function(E,H,d){var n=H[0],Z=H[1],I=H[2];return E[0]=n*d[0]+Z*d[3]+I*d[6],E[1]=n*d[1]+Z*d[4]+I*d[7],E[2]=n*d[2]+Z*d[5]+I*d[8],E}},13413:E=>{E.exports=function(E,H,d){var n=H[0],Z=H[1],I=H[2],g=d[3]*n+d[7]*Z+d[11]*I+d[15];return g=g||1,E[0]=(d[0]*n+d[4]*Z+d[8]*I+d[12])/g,E[1]=(d[1]*n+d[5]*Z+d[9]*I+d[13])/g,E[2]=(d[2]*n+d[6]*Z+d[10]*I+d[14])/g,E}},13429:E=>{E.exports=function(E,H,d){var n=H[0],Z=H[1],I=H[2],g=d[0],l=d[1],r=d[2],t=d[3],S=t*n+l*I-r*Z,M=t*Z+r*n-g*I,V=t*I+g*Z-l*n,C=-g*n-l*Z-r*I;return E[0]=S*t+C*-g+M*-r-V*-l,E[1]=M*t+C*-l+V*-g-S*-r,E[2]=V*t+C*-r+S*-l-M*-g,E}},14326:E=>{"use strict";E.exports=function(E){for(var H=new Array(E),d=0;d<E;++d)H[d]=d;return H}},14387:E=>{E.exports=function(E){return null!=E&&null!=E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}},14604:(E,H,d)=>{"use strict";d.d(H,{d:()=>n});class n{constructor(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.mM=!1,this.TS=!1,this.KS=30,this.NS=0,this.ZM=!1,this.fullscreen=!1,this.BS=function(E){},this.JS=function(){},this.dM=function(){},this.dd=function(){},this.EM=function(E){},this.onFullscreenChanged=function(E){},t((()=>{!function(E,H){E._nowObject=performance||Date,E._lastTick=0,E._renderAccum=0,E._rt=0,E._frameCB=l.bind(null,E),requestAnimationFrame(E._frameCB),H>0&&(E._intervalCB=g.bind(null,E),E._interval=setInterval(E._intervalCB,Math.max(H,1e3/E.KS/2)))}(this,H),function(E,H){if(!H)return;var d=!1,n=!1;document.addEventListener("pointerlockchange",(n=>{d=document.pointerLockElement===H,E.EM(d)})),document.addEventListener("fullscreenchange",(d=>{n=document.fullscreenElement===H,E.onFullscreenChanged(n)})),Object.defineProperty(E,"ZM",{get:()=>d,set:E=>{E&&!d?r(H):d&&!E&&function(E){E.exitPointerLock&&E.exitPointerLock()}(document)}}),Object.defineProperty(E,"fullscreen",{get:()=>n,set:E=>{E&&!n?H.requestFullscreen():n&&!E&&document.exitFullscreen()}}),H.addEventListener("click",(Z=>{E.mM&&!d&&r(H),E.TS&&!n&&H.requestFullscreen()}));var Z=()=>E.dd();if(window.ResizeObserver){new ResizeObserver(Z).observe(H)}else window.addEventListener("resize",Z)}(this,E),this.dM()}))}}var Z=3,I=20;function g(E){for(var H=1e3/E.KS,d=E._nowObject.now()+I,n=0;E._nowObject.now()>=E._lastTick+H&&E._nowObject.now()<d&&++n<=Z;)E.BS(H),E._lastTick+=H;var g=5*(H+5),l=E._nowObject.now();if(l-E._lastTick>g)for(;l>=E._lastTick+H;)E._lastTick+=H}function l(E){requestAnimationFrame(E._frameCB),g(E);var H=E._nowObject.now(),d=H-E._rt;if(E._rt=H,E.NS>0){E._renderAccum+=d;var n=1e3/E.NS;if(E._renderAccum<n)return;E._renderAccum=Math.min(E._renderAccum-n,n)}var Z=1e3/E.KS,I=(H-E._lastTick)/Z;E.JS(d,I,Z)}function r(E){E.requestPointerLock&&E.requestPointerLock()}var t=E=>{if("loading"===document.readyState){var H=()=>{document.removeEventListener("readystatechange",H),E()};document.addEventListener("readystatechange",H)}else setTimeout(E,1)}},14318:(E,H,d)=>{var n=d(14326),Z=d(14335),I="undefined"!==typeof Float64Array;function g(E,H){return E[0]-H[0]}function l(){var E,H=this.stride,d=new Array(H.length);for(E=0;E<d.length;++E)d[E]=[Math.abs(H[E]),E];d.sort(g);var n=new Array(d.length);for(E=0;E<n.length;++E)n[E]=d[E][1];return n}function r(E,H){var d=["View",H,"d",E].join("");H<0&&(d="View_Nil"+E);var Z="generic"===E;if(-1===H){var I="function "+d+"(a){this.data=a;};var proto="+d+".prototype;proto.dtype='"+E+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+d+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+d+"(a){return new "+d+"(a);}";return new Function(I)()}if(0===H){I="function "+d+"(a,d) {this.data = a;this.offset = d};var proto="+d+".prototype;proto.dtype='"+E+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+d+"_copy() {return new "+d+"(this.data,this.offset)};proto.pick=function "+d+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+d+"_get(){return "+(Z?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+d+"_set(v){return "+(Z?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+d+"(a,b,c,d){return new "+d+"(a,d)}";return new Function("TrivialArray",I)(t[E][0])}I=["'use strict'"];var g=n(H),r=g.map((function(E){return"i"+E})),S="this.offset+"+g.map((function(E){return"this.stride["+E+"]*i"+E})).join("+"),M=g.map((function(E){return"b"+E})).join(","),V=g.map((function(E){return"c"+E})).join(",");I.push("function "+d+"(a,"+M+","+V+",d){this.data=a","this.shape=["+M+"]","this.stride=["+V+"]","this.offset=d|0}","var proto="+d+".prototype","proto.dtype='"+E+"'","proto.dimension="+H),I.push("Object.defineProperty(proto,'size',{get:function "+d+"_size(){return "+g.map((function(E){return"this.shape["+E+"]"})).join("*"),"}})"),1===H?I.push("proto.order=[0]"):(I.push("Object.defineProperty(proto,'order',{get:"),H<4?(I.push("function "+d+"_order(){"),2===H?I.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===H&&I.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):I.push("ORDER})")),I.push("proto.set=function "+d+"_set("+r.join(",")+",v){"),Z?I.push("return this.data.set("+S+",v)}"):I.push("return this.data["+S+"]=v}"),I.push("proto.get=function "+d+"_get("+r.join(",")+"){"),Z?I.push("return this.data.get("+S+")}"):I.push("return this.data["+S+"]}"),I.push("proto.index=function "+d+"_index(",r.join(),"){return "+S+"}"),I.push("proto.hi=function "+d+"_hi("+r.join(",")+"){return new "+d+"(this.data,"+g.map((function(E){return["(typeof i",E,"!=='number'||i",E,"<0)?this.shape[",E,"]:i",E,"|0"].join("")})).join(",")+","+g.map((function(E){return"this.stride["+E+"]"})).join(",")+",this.offset)}");var C=g.map((function(E){return"a"+E+"=this.shape["+E+"]"})),w=g.map((function(E){return"c"+E+"=this.stride["+E+"]"}));I.push("proto.lo=function "+d+"_lo("+r.join(",")+"){var b=this.offset,d=0,"+C.join(",")+","+w.join(","));for(var R=0;R<H;++R)I.push("if(typeof i"+R+"==='number'&&i"+R+">=0){d=i"+R+"|0;b+=c"+R+"*d;a"+R+"-=d}");I.push("return new "+d+"(this.data,"+g.map((function(E){return"a"+E})).join(",")+","+g.map((function(E){return"c"+E})).join(",")+",b)}"),I.push("proto.step=function "+d+"_step("+r.join(",")+"){var "+g.map((function(E){return"a"+E+"=this.shape["+E+"]"})).join(",")+","+g.map((function(E){return"b"+E+"=this.stride["+E+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(R=0;R<H;++R)I.push("if(typeof i"+R+"==='number'){d=i"+R+"|0;if(d<0){c+=b"+R+"*(a"+R+"-1);a"+R+"=ceil(-a"+R+"/d)}else{a"+R+"=ceil(a"+R+"/d)}b"+R+"*=d}");I.push("return new "+d+"(this.data,"+g.map((function(E){return"a"+E})).join(",")+","+g.map((function(E){return"b"+E})).join(",")+",c)}");var Q=new Array(H),L=new Array(H);for(R=0;R<H;++R)Q[R]="a[i"+R+"]",L[R]="b[i"+R+"]";I.push("proto.transpose=function "+d+"_transpose("+r+"){"+r.map((function(E,H){return E+"=("+E+"===undefined?"+H+":"+E+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+d+"(this.data,"+Q.join(",")+","+L.join(",")+",this.offset)}"),I.push("proto.pick=function "+d+"_pick("+r+"){var a=[],b=[],c=this.offset");for(R=0;R<H;++R)I.push("if(typeof i"+R+"==='number'&&i"+R+">=0){c=(c+this.stride["+R+"]*i"+R+")|0}else{a.push(this.shape["+R+"]);b.push(this.stride["+R+"])}");return I.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),I.push("return function construct_"+d+"(data,shape,stride,offset){return new "+d+"(data,"+g.map((function(E){return"shape["+E+"]"})).join(",")+","+g.map((function(E){return"stride["+E+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",I.join("\n"))(t[E],l)}var t={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};E.exports=function(E,H,d,n){if(void 0===E)return(0,t.array[0])([]);"number"===typeof E&&(E=[E]),void 0===H&&(H=[E.length]);var g=H.length;if(void 0===d){d=new Array(g);for(var l=g-1,S=1;l>=0;--l)d[l]=S,S*=H[l]}if(void 0===n){n=0;for(l=0;l<g;++l)d[l]<0&&(n-=(H[l]-1)*d[l])}for(var M=function(E){if(Z(E))return"buffer";if(I)switch(Object.prototype.toString.call(E)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(E)?"array":"generic"}(E),V=t[M];V.length<=g+1;)V.push(r(M,V.length-1));return(0,V[g+1])(E,H,d,n)}},14335:E=>{function H(E){return!!E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}E.exports=function(E){return null!=E&&(H(E)||function(E){return"function"===typeof E.readFloatLE&&"function"===typeof E.slice&&H(E.slice(0,0))}(E)||!!E._isBuffer)}},14465:E=>{"use strict";var H=[],d=[],n=[],Z=[],I=[],g=[],l=[],r=[],t=[],S=[],M=[],V=[];E.exports=function(E,C,w,R,Q,L){for(var D=l,e=t,s=S,i=V,p=0;p<3;p++)D[p]=+w[p],s[p]=+C.max[p],e[p]=+C.base[p];L||(L=1e-10);var f=function(E,l,t,S,V,C){var w=H,R=d,Q=n,L=Z,D=I,e=g,s=r,i=Math.floor,p=0,f=0,P=0,j=0,X=0;if(W(),0===P)return 0;for(j=c();f<=P;){if(U(j)&&Y())return p;j=c()}for(p+=P,X=0;X<3;X++)S[X]+=t[X],V[X]+=t[X];return p;function W(){if(f=0,0!==(P=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])))for(var E=0;E<3;E++){var H=t[E]>=0;L[E]=H?1:-1;var d=H?V[E]:S[E];w[E]=H?S[E]:V[E],R[E]=u(d,L[E]),Q[E]=o(w[E],L[E]),s[E]=t[E]/P,D[E]=Math.abs(1/s[E]);var n=H?R[E]+1-d:d-R[E];e[E]=D[E]<1/0?D[E]*n:1/0}}function U(H){for(var d=L[0],n=0===H?R[0]:Q[0],Z=R[0]+d,I=L[1],g=1===H?R[1]:Q[1],l=R[1]+I,r=L[2],t=2===H?R[2]:Q[2],S=R[2]+r,M=n;M!=Z;M+=d)for(var V=g;V!=l;V+=I)for(var C=t;C!=S;C+=r)if(E(M,V,C))return!0;return!1}function Y(){p+=f;var E=L[j],H=f/P,d=M;for(X=0;X<3;X++){var n=t[X]*H;S[X]+=n,V[X]+=n,d[X]=t[X]-n}if(E>0?V[j]=Math.round(V[j]):S[j]=Math.round(S[j]),l(p,j,E,d))return!0;for(X=0;X<3;X++)t[X]=d[X];return W(),0===P}function c(){var E=e[0]<e[1]?e[0]<e[2]?0:2:e[1]<e[2]?1:2,H=e[E]-f;for(f=e[E],R[E]+=L[E],e[E]+=D[E],X=0;X<3;X++)w[X]+=H*s[X],Q[X]=o(w[X],L[X]);return E}function u(E,H){return i(E-H*C)}function o(E,H){return i(E+H*C)}}(E,R,D,e,s,L);if(!Q){for(p=0;p<3;p++)i[p]=w[p]>0?s[p]-C.max[p]:e[p]-C.base[p];C.translate(i)}return f}},14637:(E,H,d)=>{"use strict";d.d(H,{e:()=>M});var n=d(14459),Z=d(13199);class I{constructor(E,H,d,I,g,l,r){this.Kt=new n(E.base,E.tS),this.ZI=H,this.friction=d,this.restitution=I,this.sl=g,this.pC=l,this.il=!!r,this.rS=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.tw=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.et=Z.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=Z.create(),this._impulses=Z.create(),this._sleepFrameCount=10}loadFromCopy(E){Z.k(this.Kt.base,E.Kt.base),Z.k(this.Kt.tS,E.Kt.tS),Z.k(this.Kt.max,E.Kt.max),this.Kt.mag=E.Kt.mag,this.ZI=E.ZI,this.friction=E.friction,this.restitution=E.restitution,this.sl=E.sl,this.pC=E.pC,this.il=E.il,this.rS=E.rS,this.fluidDrag=E.fluidDrag,this.tw=E.tw,this.preventFallOffEdge=E.preventFallOffEdge,this.rolledBackLastTick=E.rolledBackLastTick,Z.k(this.et,E.et),Z.k(this.resting,E.resting),this.inFluid=E.inFluid,this._ratioInFluid=E._ratioInFluid,Z.k(this._forces,E._forces),Z.k(this._impulses,E._impulses),this._sleepFrameCount=E._sleepFrameCount}setPosition(E){g(E),Z.RH(E,E,this.Kt.base),this.Kt.translate(E),this.ft()}Zd(){return Z.clone(this.Kt.base)}applyForce(E){g(E),Z.add(this._forces,this._forces,E),this.ft()}applyImpulse(E){g(E),Z.add(this._impulses,this._impulses,E),this.ft()}ft(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var g=E=>{};var l=d(14459),r=d(13199),t=d(14465);function S(){this.rS=.1,this.fluidDrag=.4,this.Xl=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function M(E,H,d){E=Object.assign(new S,E),this.gravity=E.gravity||[0,-10,0],this.rS=E.rS||.1,this.Xl=E.Xl||2,this.fluidDrag=E.fluidDrag||.4,this.minBounceImpulse=E.minBounceImpulse,this.bodies=[],this.zV=E.zV,this.testSolid=H,this.testFluid=d}M.prototype.YC=function(E,H,d,n,Z,g){E=E||new l([0,0,0],[1,1,1]),"undefined"==typeof H&&(H=1),"undefined"==typeof d&&(d=1),"undefined"==typeof n&&(n=0),"undefined"==typeof Z&&(Z=1);var r=new I(E,H,d,n,Z,g);return this.bodies.push(r),r},M.prototype.cC=function(E){var H=this.bodies.indexOf(E);H<0||(this.bodies.splice(H,1),E.Kt=E.pC=null)};var V=r.create(),C=r.create(),w=r.create(),R=r.create(),Q=r.create(),L=r.create(),D=r.create(),e=new l([0,0,0],[1,1,1]),s=new I(e,1,1,0,1,(()=>{}),!1);function i(E,H,d){return H=d,H*=1-(1-E.ratioInFluid)**2}M.prototype.ql=function(E){E/=1e3;var H=G(0,r.squaredLength(this.gravity));this.bodies.forEach((d=>function(E,H,d,n){r.k(Q,H.resting),E.zV&&s.loadFromCopy(H);if(H.ZI<=0)return r.set(H.et,0,0,0),r.set(H._forces,0,0,0),void r.set(H._impulses,0,0,0);var Z=n||0===H.sl;if(function(E,H,d,n){if(H._sleepFrameCount>0)return!1;if(n)return!0;var Z=!1,I=.5*d*d*H.sl;return r.scale(O,E.gravity,I),t(E.testSolid,H.Kt,O,(function(){return Z=!0,!0}),!0),Z}(E,H,d,Z))return;H._sleepFrameCount--,function(E,H){var d=H.Kt,n=Math.floor(d.base[0]),Z=Math.floor(d.base[2]),I=Math.floor(d.base[1]),g=Math.floor(d.max[1]);if(!E.testFluid(n,I,Z))return H.inFluid=!1,void(H.ratioInFluid=0);var l=1,t=I+1;for(;t<=g&&E.testFluid(n,t,Z);)l++,t++;var S=(I+l-d.base[1])/d.tS[1];S>1&&(S=1);var M=d.tS[0]*d.tS[1]*d.tS[2]*S,V=f;r.scale(V,E.gravity,-E.Xl*M*H.sl),H.applyForce(V),H.inFluid=!0,H.ratioInFluid=S}(E,H),q(H._forces),q(H._impulses),q(H.et),q(H.resting),r.scale(V,H._forces,1/H.ZI),r.ul(V,V,E.gravity,H.sl),r.scale(C,H._impulses,1/H.ZI),r.ul(C,C,V,d),r.add(H.et,H.et,C),H.friction&&(P(E,0,H,C,d),P(E,1,H,C,d),P(E,2,H,C,d));var I=H.fluidDrag>=0?H.fluidDrag:E.fluidDrag,g=H.rS>=0?H.rS:E.rS,l=g,S=g;H.inFluid&&(l=i(H,l,H.fluidDragHoriz>=0?H.fluidDragHoriz:I),S=i(H,S,H.fluidDragVert>=0?H.fluidDragVert:I));l=Math.max(1-l*d/H.ZI,0),S=Math.max(1-S*d/H.ZI,0),r.set(p,l,S,l),r.multiply(H.et,H.et,p),r.scale(w,H.et,d),r.set(H._forces,0,0,0),r.set(H._impulses,0,0,0),H.il&&x(W,H.Kt);r.k(L,w),r.set(D,0,0,0),H.preventFallOffEdge&&function(E,H,d,n){if(!H.resting[1]||d[1]>0)return;var Z=F;x(Z,H.Kt);for(var I=0;I<3;I+=2){r.set(o,0,0,0),o[I]=d[I];var g=!0;(g=(g=(g=(g=g&&!k(E,Z.base[0]+o[0]+1e-5,Z.base[1],Z.base[2]+o[2]+1e-5))&&!k(E,Z.max[0]+o[0]-1e-5,Z.base[1],Z.base[2]+o[2]+1e-5))&&!k(E,Z.base[0]+o[0]+1e-5,Z.base[1],Z.max[2]+o[2]-1e-5))&&!k(E,Z.max[0]+o[0]-1e-5,Z.base[1],Z.max[2]+o[2]-1e-5))?(n[I]=d[I]>0?1:-1,d[I]=0):0===I&&(r.set(a,d[0],0,0),X(E,Z,a,n,H.slideOnCollision))}}(E,H,w,D);X(E,H.Kt,w,H.resting,H.slideOnCollision),H.il&&function(E,H,d,n){if(H.resting[1]>=0&&!H.inFluid)return;var Z=0!==H.resting[0],I=0!==H.resting[2];if(!Z&&!I)return;var g=Math.abs(n[0]/n[2]),l=4;if(!Z&&g>l)return;if(!I&&g<1/l)return;r.add(Y,d.base,n);var S=E.testSolid;t(S,d,n,(function(E,H,d,n){if(1!==H)return!0;n[H]=0}));var M=d.base[1],V=H.inFluid?1.951:1.001,C=Math.floor(M+V)-M;r.set(c,0,C,0);var w=!1;if(t(S,d,c,(function(E,H,d,n){return w=!0,!0})),w)return;r.RH(u,Y,d.base),u[1]=0,X(E,d,u,U,!0);var R=G(d.base[0],Y[0]),Q=G(d.base[2],Y[2]);if(Z&&!R&&(!Q||!I))return;if(I&&(!R||!Z)&&!Q)return;var L=!0;if(L=L&&!k(E,d.base[0]+1e-5,d.base[1],d.base[2]+1e-5),L=L&&!k(E,d.max[0]-1e-5,d.base[1],d.base[2]+1e-5),L=L&&!k(E,d.base[0]+1e-5,d.base[1],d.max[2]-1e-5),L=L&&!k(E,d.max[0]-1e-5,d.base[1],d.max[2]-1e-5),L)return;x(H.Kt,d),H.resting[0]=U[0],H.resting[2]=U[2],H.tw&&H.tw()}(E,H,W,L);for(var M=0;M<3;++M)H.resting[M]=H.resting[M]||D[M],R[M]=0,H.resting[M]&&(Q[M]||(R[M]=-H.et[M]),H.et[M]=0);var e=r.length(R);e>.001&&(r.scale(R,R,H.ZI),H.pC&&H.pC(R),H.restitution>0&&e>E.minBounceImpulse&&(r.scale(R,R,H.restitution),H.applyImpulse(R)));var j=r.squaredLength(H.et);j>1e-5&&H.ft();E.zV&&E.zV(H)?(H.loadFromCopy(s),H.rolledBackLastTick=!0):H.rolledBackLastTick=!1}(this,d,E,H)))};var p=r.create([0,0,0]);var f=r.create();function P(E,H,d,n,Z){var I=d.resting[H],g=n[H];if(!d.alwaysApplyHorizFriction||1!==H){if(0===I)return;if(I*g<=0)return}r.k(j,d.et),j[H]=0;var l=r.length(j);if(!G(l,0)){var t=Math.abs(d.friction*E.gravity[H]*Z),S=l>t?(l-t)/l:0;d.et[(H+1)%3]*=S,d.et[(H+2)%3]*=S}}var j=r.create();function X(E,H,d,n,Z){return r.set(n,0,0,0),t(E.testSolid,H,d,(function(E,H,d,I){n[H]=d,I[H]=0,Z||(I[0]=0,I[1]=0,I[2]=0)}))}var W=new l([],[]),U=r.create(),Y=r.create(),c=r.create(),u=r.create();var o=r.create(),F=new l([],[]),a=r.create();function k(E,H,d,n){return E.testSolid(Math.floor(H),Math.floor(d-1),Math.floor(n))}var O=r.create();function G(E,H){return Math.abs(E-H)<1e-5}function x(E,H){for(var d=0;d<3;d++)E.base[d]=H.base[d],E.max[d]=H.max[d],E.tS[d]=H.tS[d]}var q=function(E){}},13066:function(E,H){!function(E){"use strict";var H=function(E,d){return H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,H){E.__proto__=H}||function(E,H){for(var d in H)Object.prototype.hasOwnProperty.call(H,d)&&(E[d]=H[d])},H(E,d)};function d(E,d){if("function"!==typeof d&&null!==d)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function n(){this.constructor=E}H(E,d),E.prototype=null===d?Object.create(d):(n.prototype=d.prototype,new n)}function n(E,H,d,n){var Z,I=arguments.length,g=I<3?H:null===n?n=Object.getOwnPropertyDescriptor(H,d):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(E,H,d,n);else for(var l=E.length-1;l>=0;l--)(Z=E[l])&&(g=(I<3?Z(g):I>3?Z(H,d,g):Z(H,d))||g);return I>3&&g&&Object.defineProperty(H,d,g),g}function Z(E,H,d){if(d||2===arguments.length)for(var n,Z=0,I=H.length;Z<I;Z++)!n&&Z in H||(n||(n=Array.prototype.slice.call(H,0,Z)),n[Z]=H[Z]);return E.concat(n||Array.prototype.slice.call(H))}var I,g=255,l=213;E.OPERATION=void 0,(I=E.OPERATION||(E.OPERATION={}))[I.ADD=128]="ADD",I[I.REPLACE=0]="REPLACE",I[I.DELETE=64]="DELETE",I[I.DELETE_AND_ADD=192]="DELETE_AND_ADD",I[I.TOUCH=1]="TOUCH",I[I.CLEAR=10]="CLEAR";var r=function(){function H(E,H,d){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=E,this.setParent(H,d)}return H.prototype.setParent=function(E,H,d){var n=this;if(this.indexes||(this.indexes=this.ref instanceof uE?this.ref._definition.indexes:{}),this.parent=E,this.parentIndex=d,H)if(this.root=H,this.ref instanceof uE){var Z=this.ref._definition;for(var I in Z.schema){var g=this.ref[I];if(g&&g.$changes){var l=Z.indexes[I];g.$changes.setParent(this.ref,H,l)}}}else"object"===typeof this.ref&&this.ref.forEach((function(E,H){if(E instanceof uE){var d=E.$changes,Z=n.ref.$changes.indexes[H];d.setParent(n.ref,n.root,Z)}}))},H.prototype.operation=function(E){this.changes.set(--this.currentCustomOperation,E)},H.prototype.change=function(H,d){void 0===d&&(d=E.OPERATION.ADD);var n="number"===typeof H?H:this.indexes[H];this.assertValidIndex(n,H);var Z=this.changes.get(n);Z&&Z.op!==E.OPERATION.DELETE&&Z.op!==E.OPERATION.TOUCH||this.changes.set(n,{op:Z&&Z.op===E.OPERATION.DELETE?E.OPERATION.DELETE_AND_ADD:d,index:n}),this.allChanges.add(n),this.changed=!0,this.touchParents()},H.prototype.touch=function(H){var d="number"===typeof H?H:this.indexes[H];this.assertValidIndex(d,H),this.changes.has(d)||this.changes.set(d,{op:E.OPERATION.TOUCH,index:d}),this.allChanges.add(d),this.touchParents()},H.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},H.prototype.getType=function(E){if(this.ref._definition)return(H=this.ref._definition).schema[H.fieldsByIndex[E]];var H,d=(H=this.parent._definition).schema[H.fieldsByIndex[this.parentIndex]];return Object.values(d)[0]},H.prototype.getChildrenFilter=function(){var E=this.parent._definition.childFilters;return E&&E[this.parentIndex]},H.prototype.getValue=function(E){return this.ref.getByIndex(E)},H.prototype.delete=function(H){var d="number"===typeof H?H:this.indexes[H];if(void 0!==d){var n=this.getValue(d);this.changes.set(d,{op:E.OPERATION.DELETE,index:d}),this.allChanges.delete(d),delete this.caches[d],n&&n.$changes&&(n.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(H," (").concat(d,")"))},H.prototype.discard=function(H,d){var n=this;void 0===H&&(H=!1),void 0===d&&(d=!1),this.ref instanceof uE||this.changes.forEach((function(H){if(H.op===E.OPERATION.DELETE){var d=n.ref.getIndex(H.index);delete n.indexes[d]}})),this.changes.clear(),this.changed=H,d&&this.allChanges.clear(),this.currentCustomOperation=0},H.prototype.discardAll=function(){var E=this;this.changes.forEach((function(H){var d=E.getValue(H.index);d&&d.$changes&&d.$changes.discardAll()})),this.discard()},H.prototype.cache=function(E,H){this.caches[E]=H},H.prototype.clone=function(){return new H(this.ref,this.parent,this.root)},H.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},H.prototype.assertValidIndex=function(E,H){if(void 0===E)throw new Error('ChangeTree: missing index for field "'.concat(H,'"'))},H}();function t(E,H,d,n){return E[H]||(E[H]=[]),E[H].push(d),null===n||void 0===n||n.forEach((function(E,H){return d(E,H)})),function(){return M(E[H],E[H].indexOf(d))}}function S(H){var d=this,n="string"!==typeof this.$changes.getType();this.$items.forEach((function(Z,I){H.push({refId:d.$changes.refId,op:E.OPERATION.DELETE,field:I,value:void 0,previousValue:Z}),n&&d.$changes.root.removeRef(Z.$changes.refId)}))}function M(E,H){if(-1===H||H>=E.length)return!1;for(var d=E.length-1,n=H;n<d;n++)E[n]=E[n+1];return E.length=d,!0}var V=function(E,H){var d=E.toString(),n=H.toString();return d<n?-1:d>n?1:0};function C(E){return E.$proxy=!0,E=new Proxy(E,{get:function(E,H){return"symbol"===typeof H||isNaN(H)?E[H]:E.at(H)},set:function(E,H,d){if("symbol"===typeof H||isNaN(H))E[H]=d;else{var n=Array.from(E.$items.keys()),Z=parseInt(n[H]||H);void 0===d||null===d?E.deleteAt(Z):E.setAt(Z,d)}return!0},deleteProperty:function(E,H){return"number"===typeof H?E.deleteAt(H):delete E[H],!0}})}var w=function(){function H(){for(var E=[],H=0;H<arguments.length;H++)E[H]=arguments[H];this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,E)}return H.prototype.bl=function(H,d){return void 0===d&&(d=!0),t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,H,d?this.$items:void 0)},H.prototype.md=function(H){return t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,H)},H.is=function(E){return Array.isArray(E)||void 0!==E.array},Object.defineProperty(H.prototype,"length",{get:function(){return this.$items.size},set:function(E){0===E?this.clear():this.splice(E,this.length-E)},enumerable:!1,configurable:!0}),H.prototype.push=function(){for(var E,H=this,d=[],n=0;n<arguments.length;n++)d[n]=arguments[n];return d.forEach((function(d){E=H.$refId++,H.setAt(E,d)})),E},H.prototype.pop=function(){var E=Array.from(this.$indexes.values()).pop();if(void 0!==E){this.$changes.delete(E),this.$indexes.delete(E);var H=this.$items.get(E);return this.$items.delete(E),H}},H.prototype.at=function(E){var H=Array.from(this.$items.keys())[E];return this.$items.get(H)},H.prototype.setAt=function(H,d){var n,Z;if(void 0!==d&&null!==d){if(this.$items.get(H)!==d){void 0!==d.$changes&&d.$changes.setParent(this,this.$changes.root,H);var I=null!==(Z=null===(n=this.$changes.indexes[H])||void 0===n?void 0:n.op)&&void 0!==Z?Z:E.OPERATION.ADD;this.$changes.indexes[H]=H,this.$indexes.set(H,H),this.$items.set(H,d),this.$changes.change(H,I)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},H.prototype.deleteAt=function(E){var H=Array.from(this.$items.keys())[E];return void 0!==H&&this.$deleteAt(H)},H.prototype.$deleteAt=function(E){return this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E)},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&S.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.concat=function(){for(var E,d=[],n=0;n<arguments.length;n++)d[n]=arguments[n];return new(H.bind.apply(H,Z([void 0],(E=Array.from(this.$items.values())).concat.apply(E,d),!1)))},H.prototype.join=function(E){return Array.from(this.$items.values()).join(E)},H.prototype.reverse=function(){var E=this,H=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(d,n){E.setAt(H[n],d)})),this},H.prototype.shift=function(){var E=Array.from(this.$items.keys()).shift();if(void 0!==E){var H=this.$items.get(E);return this.$deleteAt(E),H}},H.prototype.slice=function(E,d){var n=new H;return n.push.apply(n,Array.from(this.$items.values()).slice(E,d)),n},H.prototype.sort=function(E){var H=this;void 0===E&&(E=V);var d=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(E).forEach((function(E,n){H.setAt(d[n],E)})),this},H.prototype.splice=function(E,H){void 0===H&&(H=this.length-E);for(var d=Array.from(this.$items.keys()),n=[],Z=E;Z<E+H;Z++)n.push(this.$items.get(d[Z])),this.$deleteAt(d[Z]);return n},H.prototype.unshift=function(){for(var E=this,H=[],d=0;d<arguments.length;d++)H[d]=arguments[d];var n=this.length,Z=H.length,I=Array.from(this.$items.values());return H.forEach((function(H,d){E.setAt(d,H)})),I.forEach((function(H,d){E.setAt(Z+d,H)})),n+Z},H.prototype.indexOf=function(E,H){return Array.from(this.$items.values()).indexOf(E,H)},H.prototype.lastIndexOf=function(E,H){return void 0===H&&(H=this.length-1),Array.from(this.$items.values()).lastIndexOf(E,H)},H.prototype.every=function(E,H){return Array.from(this.$items.values()).every(E,H)},H.prototype.some=function(E,H){return Array.from(this.$items.values()).some(E,H)},H.prototype.forEach=function(E,H){Array.from(this.$items.values()).forEach(E,H)},H.prototype.map=function(E,H){return Array.from(this.$items.values()).map(E,H)},H.prototype.filter=function(E,H){return Array.from(this.$items.values()).filter(E,H)},H.prototype.reduce=function(E,H){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},H.prototype.reduceRight=function(E,H){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},H.prototype.find=function(E,H){return Array.from(this.$items.values()).find(E,H)},H.prototype.findIndex=function(E,H){return Array.from(this.$items.values()).findIndex(E,H)},H.prototype.fill=function(E,H,d){throw new Error("ArraySchema#fill() not implemented")},H.prototype.copyWithin=function(E,H,d){throw new Error("ArraySchema#copyWithin() not implemented")},H.prototype.toString=function(){return this.$items.toString()},H.prototype.toLocaleString=function(){return this.$items.toLocaleString()},H.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(H,Symbol.species,{get:function(){return H},enumerable:!1,configurable:!0}),H.prototype.entries=function(){return this.$items.entries()},H.prototype.keys=function(){return this.$items.keys()},H.prototype.values=function(){return this.$items.values()},H.prototype.includes=function(E,H){return Array.from(this.$items.values()).includes(E,H)},H.prototype.flatMap=function(E,H){throw new Error("ArraySchema#flatMap() is not supported.")},H.prototype.flat=function(E){throw new Error("ArraySchema#flat() is not supported.")},H.prototype.findLast=function(){var E=Array.from(this.$items.values());return E.findLast.apply(E,arguments)},H.prototype.findLastIndex=function(){var E=Array.from(this.$items.values());return E.findLastIndex.apply(E,arguments)},H.prototype.setIndex=function(E,H){this.$indexes.set(E,H)},H.prototype.getIndex=function(E){return this.$indexes.get(E)},H.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},H.prototype.deleteByIndex=function(E){var H=this.$indexes.get(E);this.$items.delete(H),this.$indexes.delete(E)},H.prototype.toArray=function(){return Array.from(this.$items.values())},H.prototype.toJSON=function(){return this.toArray().map((function(E){return"function"===typeof E.toJSON?E.toJSON():E}))},H.prototype.clone=function(E){return E?new(H.bind.apply(H,Z([void 0],Array.from(this.$items.values()),!1))):new(H.bind.apply(H,Z([void 0],this.map((function(E){return E.$changes?E.clone():E})),!1)))},H}();function R(E){return E.$proxy=!0,E=new Proxy(E,{get:function(E,H){return"symbol"!==typeof H&&"undefined"===typeof E[H]?E.get(H):E[H]},set:function(E,H,d){return"symbol"!==typeof H&&-1===H.indexOf("$")&&"bl"!==H&&"md"!==H&&"onChange"!==H?E.set(H,d):E[H]=d,!0},deleteProperty:function(E,H){return E.delete(H),!0}})}var Q=function(){function H(E){var d=this;if(this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E)if(E instanceof Map||E instanceof H)E.forEach((function(E,H){return d.set(H,E)}));else for(var n in E)this.set(n,E[n])}return H.prototype.bl=function(H,d){return void 0===d&&(d=!0),t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,H,d?this.$items:void 0)},H.prototype.md=function(H){return t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,H)},H.is=function(E){return void 0!==E.map},H.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(H.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(H,Symbol.species,{get:function(){return H},enumerable:!1,configurable:!0}),H.prototype.set=function(H,d){if(void 0===d||null===d)throw new Error("MapSchema#set('".concat(H,"', ").concat(d,"): trying to set ").concat(d," value on '").concat(H,"'."));H=H.toString();var n="undefined"!==typeof this.$changes.indexes[H],Z=n?this.$changes.indexes[H]:this.$refId++,I=n?E.OPERATION.REPLACE:E.OPERATION.ADD,g=void 0!==d.$changes;if(g&&d.$changes.setParent(this,this.$changes.root,Z),n){if(!g&&this.$items.get(H)===d)return;g&&this.$items.get(H)!==d&&(I=E.OPERATION.ADD)}else this.$changes.indexes[H]=Z,this.$indexes.set(Z,H);return this.$items.set(H,d),this.$changes.change(H,I),this},H.prototype.get=function(E){return this.$items.get(E)},H.prototype.delete=function(E){return this.$changes.delete(E),this.$items.delete(E)},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&S.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.has=function(E){return this.$items.has(E)},H.prototype.forEach=function(E){this.$items.forEach(E)},H.prototype.entries=function(){return this.$items.entries()},H.prototype.keys=function(){return this.$items.keys()},H.prototype.values=function(){return this.$items.values()},Object.defineProperty(H.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),H.prototype.setIndex=function(E,H){this.$indexes.set(E,H)},H.prototype.getIndex=function(E){return this.$indexes.get(E)},H.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},H.prototype.deleteByIndex=function(E){var H=this.$indexes.get(E);this.$items.delete(H),this.$indexes.delete(E)},H.prototype.toJSON=function(){var E={};return this.forEach((function(H,d){E[d]="function"===typeof H.toJSON?H.toJSON():H})),E},H.prototype.clone=function(E){var d;return E?d=Object.assign(new H,this):(d=new H,this.forEach((function(E,H){E.$changes?d.set(H,E.clone()):d.set(H,E)}))),d},H}(),L={};function D(E,H){L[E]=H}function e(E){return L[E]}var s=function(){function E(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return E.create=function(H){var d=new E;return d.schema=Object.assign({},H&&H.schema||{}),d.indexes=Object.assign({},H&&H.indexes||{}),d.fieldsByIndex=Object.assign({},H&&H.fieldsByIndex||{}),d.descriptors=Object.assign({},H&&H.descriptors||{}),d.deprecated=Object.assign({},H&&H.deprecated||{}),d},E.prototype.addField=function(E,H){var d=this.getNextFieldIndex();this.fieldsByIndex[d]=E,this.indexes[E]=d,this.schema[E]=Array.isArray(H)?{array:H[0]}:H},E.prototype.hasField=function(E){return void 0!==this.indexes[E]},E.prototype.addFilter=function(E,H){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[E]]=H,this.indexesWithFilters.push(this.indexes[E]),!0},E.prototype.addChildrenFilter=function(E,H){var d=this.indexes[E],n=this.schema[E];if(e(Object.keys(n)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[d]=H,!0;console.warn("@filterChildren: field '".concat(E,"' can't have children. Ignoring filter."))},E.prototype.getChildrenFilter=function(E){return this.childFilters&&this.childFilters[this.indexes[E]]},E.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},E}();function i(E){return E._context&&E._context.useFilters}var p=function(){function E(){this.types={},this.schemas=new Map,this.useFilters=!1}return E.prototype.has=function(E){return this.schemas.has(E)},E.prototype.get=function(E){return this.types[E]},E.prototype.add=function(E,H){void 0===H&&(H=this.schemas.size),E._definition=s.create(E._definition),E._typeid=H,this.types[H]=E,this.schemas.set(E,H)},E.create=function(H){return void 0===H&&(H={}),function(d){return H.context||(H.context=new E),P(d,H)}},E}(),f=new p;function P(E,H){return void 0===H&&(H={}),function(d,n){var I=H.context||f,g=d.constructor;if(g._context=I,!E)throw new Error("".concat(g.name,': @type() reference provided for "').concat(n,"\" is undefined. Make sure you don't have any circular dependencies."));I.has(g)||I.add(g);var l=g._definition;if(l.addField(n,E),l.descriptors[n]){if(l.deprecated[n])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(n,"' definition on '").concat(g.name,"'.\nCheck @type() annotation"))}catch(L){var r=L.stack.split("\n")[4].trim();throw new Error("".concat(L.message," ").concat(r))}}var t=w.is(E),S=!t&&Q.is(E);if("string"!==typeof E&&!uE.is(E)){var M=Object.values(E)[0];"string"===typeof M||I.has(M)||I.add(M)}if(H.manual)l.descriptors[n]={enumerable:!0,configurable:!0,writable:!0};else{var V="_".concat(n);l.descriptors[V]={enumerable:!1,configurable:!1,writable:!0},l.descriptors[n]={get:function(){return this[V]},set:function(E){E!==this[V]&&(void 0!==E&&null!==E?(!t||E instanceof w||(E=new(w.bind.apply(w,Z([void 0],E,!1)))),!S||E instanceof Q||(E=new Q(E)),void 0===E.$proxy&&(S?E=R(E):t&&(E=C(E))),this.$changes.change(n),E.$changes&&E.$changes.setParent(this,this.$changes.root,this._definition.indexes[n])):this[V]&&this.$changes.delete(n),this[V]=E)},enumerable:!0,configurable:!0}}}}function j(E){return function(H,d){var n=H.constructor;n._definition.addFilter(d,E)&&(n._context.useFilters=!0)}}function X(E){return function(H,d){var n=H.constructor;n._definition.addChildrenFilter(d,E)&&(n._context.useFilters=!0)}}function W(E){return void 0===E&&(E=!0),function(H,d){var n=H.constructor._definition;n.deprecated[d]=!0,E&&(n.descriptors[d]={get:function(){throw new Error("".concat(d," is deprecated."))},set:function(E){},enumerable:!1,configurable:!0})}}function U(E,H,d){for(var n in void 0===d&&(d={}),d.context||(d.context=E._context||d.context||f),H)P(H[n],d)(E.prototype,n);return E}function Y(E){for(var H=0,d=0,n=0,Z=E.length;n<Z;n++)(H=E.charCodeAt(n))<128?d+=1:H<2048?d+=2:H<55296||H>=57344?d+=3:(n++,d+=4);return d}function c(E,H,d){for(var n=0,Z=0,I=d.length;Z<I;Z++)(n=d.charCodeAt(Z))<128?E[H++]=n:n<2048?(E[H++]=192|n>>6,E[H++]=128|63&n):n<55296||n>=57344?(E[H++]=224|n>>12,E[H++]=128|n>>6&63,E[H++]=128|63&n):(Z++,n=65536+((1023&n)<<10|1023&d.charCodeAt(Z)),E[H++]=240|n>>18,E[H++]=128|n>>12&63,E[H++]=128|n>>6&63,E[H++]=128|63&n)}function u(E,H){E.push(255&H)}function o(E,H){E.push(255&H)}function F(E,H){E.push(255&H),E.push(H>>8&255)}function a(E,H){E.push(255&H),E.push(H>>8&255)}function k(E,H){E.push(255&H),E.push(H>>8&255),E.push(H>>16&255),E.push(H>>24&255)}function O(E,H){var d=H>>24,n=H>>16,Z=H>>8,I=H;E.push(255&I),E.push(255&Z),E.push(255&n),E.push(255&d)}function G(E,H){var d=Math.floor(H/Math.pow(2,32));O(E,H>>>0),O(E,d)}function x(E,H){var d=H/Math.pow(2,32)|0;O(E,H>>>0),O(E,d)}function q(E,H){z(E,H)}function b(E,H){K(E,H)}var h=new Int32Array(2),y=new Float32Array(h.buffer),v=new Float64Array(h.buffer);function z(E,H){y[0]=H,k(E,h[0])}function K(E,H){v[0]=H,k(E,h[0]),k(E,h[1])}function N(E,H){return o(E,H?1:0)}function mE(E,H){H||(H="");var d=Y(H),n=0;if(d<32)E.push(160|d),n=1;else if(d<256)E.push(217),o(E,d),n=2;else if(d<65536)E.push(218),a(E,d),n=3;else{if(!(d<4294967296))throw new Error("String too long");E.push(219),O(E,d),n=5}return c(E,E.length,H),n+d}function T(E,H){return isNaN(H)?T(E,0):isFinite(H)?H!==(0|H)?(E.push(203),K(E,H),9):H>=0?H<128?(o(E,H),1):H<256?(E.push(204),o(E,H),2):H<65536?(E.push(205),a(E,H),3):H<4294967296?(E.push(206),O(E,H),5):(E.push(207),x(E,H),9):H>=-32?(E.push(224|H+32),1):H>=-128?(E.push(208),u(E,H),2):H>=-32768?(E.push(209),F(E,H),3):H>=-2147483648?(E.push(210),k(E,H),5):(E.push(211),G(E,H),9):T(E,H>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var A=Object.freeze({__proto__:null,utf8Write:c,int8:u,uint8:o,int16:F,uint16:a,int32:k,uint32:O,int64:G,uint64:x,float32:q,float64:b,writeFloat32:z,writeFloat64:K,boolean:N,string:mE,number:T});function B(E,H,d){for(var n="",Z=0,I=H,g=H+d;I<g;I++){var l=E[I];0!==(128&l)?192!==(224&l)?224!==(240&l)?240!==(248&l)?console.error("Invalid byte "+l.toString(16)):(Z=(7&l)<<18|(63&E[++I])<<12|(63&E[++I])<<6|63&E[++I])>=65536?(Z-=65536,n+=String.fromCharCode(55296+(Z>>>10),56320+(1023&Z))):n+=String.fromCharCode(Z):n+=String.fromCharCode((15&l)<<12|(63&E[++I])<<6|63&E[++I]):n+=String.fromCharCode((31&l)<<6|63&E[++I]):n+=String.fromCharCode(l)}return n}function J(E,H){return EE(E,H)<<24>>24}function EE(E,H){return E[H.offset++]}function HE(E,H){return dE(E,H)<<16>>16}function dE(E,H){return E[H.offset++]|E[H.offset++]<<8}function nE(E,H){return E[H.offset++]|E[H.offset++]<<8|E[H.offset++]<<16|E[H.offset++]<<24}function ZE(E,H){return nE(E,H)>>>0}function IE(E,H){return VE(E,H)}function gE(E,H){return CE(E,H)}function lE(E,H){var d=ZE(E,H);return nE(E,H)*Math.pow(2,32)+d}function rE(E,H){var d=ZE(E,H);return ZE(E,H)*Math.pow(2,32)+d}var tE=new Int32Array(2),SE=new Float32Array(tE.buffer),ME=new Float64Array(tE.buffer);function VE(E,H){return tE[0]=nE(E,H),SE[0]}function CE(E,H){return tE[0]=nE(E,H),tE[1]=nE(E,H),ME[0]}function wE(E,H){return EE(E,H)>0}function RE(E,H){var d,n=E[H.offset++];n<192?d=31&n:217===n?d=EE(E,H):218===n?d=dE(E,H):219===n&&(d=ZE(E,H));var Z=B(E,H.offset,d);return H.offset+=d,Z}function QE(E,H){var d=E[H.offset];return d<192&&d>160||217===d||218===d||219===d}function LE(E,H){var d=E[H.offset++];return d<128?d:202===d?VE(E,H):203===d?CE(E,H):204===d?EE(E,H):205===d?dE(E,H):206===d?ZE(E,H):207===d?rE(E,H):208===d?J(E,H):209===d?HE(E,H):210===d?nE(E,H):211===d?lE(E,H):d>223?-1*(255-d+1):void 0}function DE(E,H){var d=E[H.offset];return d<128||d>=202&&d<=211}function eE(E,H){return E[H.offset]<160}function sE(E,H){return E[H.offset-1]===g&&(E[H.offset]<128||E[H.offset]>=202&&E[H.offset]<=211)}var iE=Object.freeze({__proto__:null,int8:J,uint8:EE,int16:HE,uint16:dE,int32:nE,uint32:ZE,float32:IE,float64:gE,int64:lE,uint64:rE,readFloat32:VE,readFloat64:CE,boolean:wE,string:RE,stringCheck:QE,number:LE,numberCheck:DE,arrayCheck:eE,switchStructureCheck:sE}),pE=function(){function H(E){var H=this;this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E&&E.forEach((function(E){return H.add(E)}))}return H.prototype.bl=function(H,d){return void 0===d&&(d=!0),t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,H,d?this.$items:void 0)},H.prototype.md=function(H){return t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,H)},H.is=function(E){return void 0!==E.collection},H.prototype.add=function(E){var H=this.$refId++;return void 0!==E.$changes&&E.$changes.setParent(this,this.$changes.root,H),this.$changes.indexes[H]=H,this.$indexes.set(H,H),this.$items.set(H,E),this.$changes.change(H),H},H.prototype.at=function(E){var H=Array.from(this.$items.keys())[E];return this.$items.get(H)},H.prototype.entries=function(){return this.$items.entries()},H.prototype.delete=function(E){for(var H,d,n=this.$items.entries();(d=n.next())&&!d.done;)if(E===d.value[1]){H=d.value[0];break}return void 0!==H&&(this.$changes.delete(H),this.$indexes.delete(H),this.$items.delete(H))},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&S.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.has=function(E){return Array.from(this.$items.values()).some((function(H){return H===E}))},H.prototype.forEach=function(E){var H=this;this.$items.forEach((function(d,n,Z){return E(d,n,H)}))},H.prototype.values=function(){return this.$items.values()},Object.defineProperty(H.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),H.prototype.setIndex=function(E,H){this.$indexes.set(E,H)},H.prototype.getIndex=function(E){return this.$indexes.get(E)},H.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},H.prototype.deleteByIndex=function(E){var H=this.$indexes.get(E);this.$items.delete(H),this.$indexes.delete(E)},H.prototype.toArray=function(){return Array.from(this.$items.values())},H.prototype.toJSON=function(){var E=[];return this.forEach((function(H,d){E.push("function"===typeof H.toJSON?H.toJSON():H)})),E},H.prototype.clone=function(E){var d;return E?d=Object.assign(new H,this):(d=new H,this.forEach((function(E){E.$changes?d.add(E.clone()):d.add(E)}))),d},H}(),fE=function(){function H(E){var H=this;this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,E&&E.forEach((function(E){return H.add(E)}))}return H.prototype.bl=function(H,d){return void 0===d&&(d=!0),t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.ADD,H,d?this.$items:void 0)},H.prototype.md=function(H){return t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,H)},H.is=function(E){return void 0!==E.set},H.prototype.add=function(H){var d,n;if(this.has(H))return!1;var Z=this.$refId++;void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,Z);var I=null!==(n=null===(d=this.$changes.indexes[Z])||void 0===d?void 0:d.op)&&void 0!==n?n:E.OPERATION.ADD;return this.$changes.indexes[Z]=Z,this.$indexes.set(Z,Z),this.$items.set(Z,H),this.$changes.change(Z,I),Z},H.prototype.entries=function(){return this.$items.entries()},H.prototype.delete=function(E){for(var H,d,n=this.$items.entries();(d=n.next())&&!d.done;)if(E===d.value[1]){H=d.value[0];break}return void 0!==H&&(this.$changes.delete(H),this.$indexes.delete(H),this.$items.delete(H))},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&S.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.has=function(E){for(var H,d=this.$items.values(),n=!1;(H=d.next())&&!H.done;)if(E===H.value){n=!0;break}return n},H.prototype.forEach=function(E){var H=this;this.$items.forEach((function(d,n,Z){return E(d,n,H)}))},H.prototype.values=function(){return this.$items.values()},Object.defineProperty(H.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),H.prototype.setIndex=function(E,H){this.$indexes.set(E,H)},H.prototype.getIndex=function(E){return this.$indexes.get(E)},H.prototype.getByIndex=function(E){return this.$items.get(this.$indexes.get(E))},H.prototype.deleteByIndex=function(E){var H=this.$indexes.get(E);this.$items.delete(H),this.$indexes.delete(E)},H.prototype.toArray=function(){return Array.from(this.$items.values())},H.prototype.toJSON=function(){var E=[];return this.forEach((function(H,d){E.push("function"===typeof H.toJSON?H.toJSON():H)})),E},H.prototype.clone=function(E){var d;return E?d=Object.assign(new H,this):(d=new H,this.forEach((function(E){E.$changes?d.add(E.clone()):d.add(E)}))),d},H}(),PE=function(){function E(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return E.prototype.addRefId=function(E){this.refIds.has(E)||(this.refIds.add(E),this.containerIndexes.set(E,new Set))},E.get=function(H){return void 0===H.$filterState&&(H.$filterState=new E),H.$filterState},E}(),jE=function(){function E(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return E.prototype.getNextUniqueId=function(){return this.nextUniqueId++},E.prototype.addRef=function(E,H,d){void 0===d&&(d=!0),this.refs.set(E,H),d&&(this.refCounts[E]=(this.refCounts[E]||0)+1)},E.prototype.removeRef=function(E){this.refCounts[E]=this.refCounts[E]-1,this.deletedRefs.add(E)},E.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},E.prototype.garbageCollectDeletedRefs=function(){var E=this;this.deletedRefs.forEach((function(H){if(!(E.refCounts[H]>0)){var d=E.refs.get(H);if(d instanceof uE)for(var n in d._definition.schema)"string"!==typeof d._definition.schema[n]&&d[n]&&d[n].$changes&&E.removeRef(d[n].$changes.refId);else{var Z=d.$changes.parent._definition,I=Z.schema[Z.fieldsByIndex[d.$changes.parentIndex]];"function"===typeof Object.values(I)[0]&&Array.from(d.values()).forEach((function(H){return E.removeRef(H.$changes.refId)}))}E.refs.delete(H),delete E.refCounts[H]}})),this.deletedRefs.clear()},E}(),XE=function(E){function H(){return null!==E&&E.apply(this,arguments)||this}return d(H,E),H}(Error);function WE(E,H,d,n){var Z,I=!1;switch(H){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":Z="number",isNaN(E)&&console.log('trying to encode "NaN" in '.concat(d.constructor.name,"#").concat(n));break;case"string":Z="string",I=!0;break;case"boolean":return}if(typeof E!==Z&&(!I||I&&null!==E)){var g="'".concat(JSON.stringify(E),"'").concat(E&&E.constructor&&" (".concat(E.constructor.name,")")||"");throw new XE("a '".concat(Z,"' was expected, but ").concat(g," was provided in ").concat(d.constructor.name,"#").concat(n))}}function UE(E,H,d,n){if(!(E instanceof H))throw new XE("a '".concat(H.name,"' was expected, but '").concat(E.constructor.name,"' was provided in ").concat(d.constructor.name,"#").concat(n))}function YE(E,H,d,n,Z){WE(d,E,n,Z);var I=A[E];if(!I)throw new XE("a '".concat(E,"' was expected, but ").concat(d," was provided in ").concat(n.constructor.name,"#").concat(Z));I(H,d)}function cE(E,H,d){return iE[E](H,d)}var uE=function(){function H(){for(var E=[],H=0;H<arguments.length;H++)E[H]=arguments[H];Object.defineProperties(this,{$changes:{value:new r(this,void 0,new jE),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var d=this._definition.descriptors;d&&Object.defineProperties(this,d),E[0]&&this.assign(E[0])}return H.onError=function(E){console.error(E)},H.is=function(E){return E._definition&&void 0!==E._definition.schema},H.prototype.onChange=function(H){return t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.REPLACE,H)},H.prototype.md=function(H){return t(this.$callbacks||(this.$callbacks=[]),E.OPERATION.DELETE,H)},H.prototype.assign=function(E){return Object.assign(this,E),this},Object.defineProperty(H.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),H.prototype.setDirty=function(E,H){this.$changes.change(E,H)},H.prototype.listen=function(E,H,d){var n=this;return void 0===d&&(d=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[E]||(this.$callbacks[E]=[]),this.$callbacks[E].push(H),d&&void 0!==this[E]&&H(this[E],void 0),function(){return M(n.$callbacks[E],n.$callbacks[E].indexOf(H))}},H.prototype.decode=function(d,n,Z){var I;void 0===n&&(n={offset:0}),void 0===Z&&(Z=this);var l=[],r=this.$changes.root,t=d.length,S=0;for(r.refs.set(S,this);n.offset<t;){var M=d[n.offset++];if(M!=g){var V=Z.$changes,C=void 0!==Z._definition,R=C?M>>6<<6:M;if(R!==E.OPERATION.CLEAR){var L=C?M%(R||255):LE(d,n),D=C?Z._definition.fieldsByIndex[L]:"",s=V.getType(L),i=void 0,p=void 0,f=void 0;if(C?p=Z["_".concat(D)]:(p=Z.getByIndex(L),(R&E.OPERATION.ADD)===E.OPERATION.ADD?(f=Z instanceof Q?RE(d,n):L,Z.setIndex(L,f)):f=Z.getIndex(L)),(R&E.OPERATION.DELETE)===E.OPERATION.DELETE&&(R!==E.OPERATION.DELETE_AND_ADD&&Z.deleteByIndex(L),p&&p.$changes&&r.removeRef(p.$changes.refId),i=null),void 0!==D){if(R===E.OPERATION.DELETE);else if(H.is(s)){var P=LE(d,n);if(i=r.refs.get(P),R!==E.OPERATION.REPLACE){var j=this.getSchemaType(d,n,s);i||((i=this.createTypeInstance(j)).$changes.refId=P,p&&(i.$callbacks=p.$callbacks,p.$changes.refId&&P!==p.$changes.refId&&r.removeRef(p.$changes.refId))),r.addRef(P,i,i!==p)}}else if("string"===typeof s)i=cE(s,d,n);else{var X=e(Object.keys(s)[0]),W=LE(d,n),U=r.refs.has(W)?p||r.refs.get(W):new X.constructor;if((i=U.clone(!0)).$changes.refId=W,p&&(i.$callbacks=p.$callbacks,p.$changes.refId&&W!==p.$changes.refId)){r.removeRef(p.$changes.refId);for(var Y=p.entries(),c=void 0;(c=Y.next())&&!c.done;){var u=(I=c.value)[0],o=I[1];l.push({refId:W,op:E.OPERATION.DELETE,field:u,value:void 0,previousValue:o})}}r.addRef(W,i,U!==p)}if(null!==i&&void 0!==i)if(i.$changes&&i.$changes.setParent(V.ref,V.root,L),Z instanceof H)Z[D]=i;else if(Z instanceof Q)u=f,Z.$items.set(u,i),Z.$changes.allChanges.add(L);else if(Z instanceof w)Z.setAt(L,i);else if(Z instanceof pE){var F=Z.add(i);Z.setIndex(L,F)}else Z instanceof fE&&!1!==(F=Z.add(i))&&Z.setIndex(L,F);p!==i&&l.push({refId:S,op:R,field:D,dynamicIndex:f,value:i,previousValue:p})}else{console.warn("@colyseus/schema: definition mismatch");for(var a={offset:n.offset};n.offset<t&&(!sE(d,n)||(a.offset=n.offset+1,!r.refs.has(LE(d,a))));)n.offset++}}else Z.clear(l)}else{S=LE(d,n);var k=r.refs.get(S);if(!k)throw new Error('"refId" not found: '.concat(S));Z=k}}return this._triggerChanges(l),r.garbageCollectDeletedRefs(),l},H.prototype.encode=function(d,n,Z){void 0===d&&(d=!1),void 0===n&&(n=[]),void 0===Z&&(Z=!1);for(var I=this.$changes,l=new WeakSet,r=[I],t=1,S=0;S<t;S++){var M=r[S],V=M.ref,C=V instanceof H;M.ensureRefId(),l.add(M),M!==I&&(M.changed||d)&&(o(n,g),T(n,M.refId));for(var w=d?Array.from(M.allChanges):Array.from(M.changes.values()),R=0,L=w.length;R<L;R++){var D=d?{op:E.OPERATION.ADD,index:w[R]}:w[R],s=D.index,i=C?V._definition.fieldsByIndex&&V._definition.fieldsByIndex[s]:s,p=n.length;if(D.op!==E.OPERATION.TOUCH)if(C)o(n,s|D.op);else{if(o(n,D.op),D.op===E.OPERATION.CLEAR)continue;T(n,s)}if(C||(D.op&E.OPERATION.ADD)!=E.OPERATION.ADD||V instanceof Q&&mE(n,M.ref.$indexes.get(s)),D.op!==E.OPERATION.DELETE){var f=M.getType(s),P=M.getValue(s);if(P&&P.$changes&&!l.has(P.$changes)&&(r.push(P.$changes),P.$changes.ensureRefId(),t++),D.op!==E.OPERATION.TOUCH){if(H.is(f))UE(P,f,V,i),T(n,P.$changes.refId),(D.op&E.OPERATION.ADD)===E.OPERATION.ADD&&this.tryEncodeTypeId(n,f,P.constructor);else if("string"===typeof f)YE(f,n,P,V,i);else{var j=e(Object.keys(f)[0]);UE(V["_".concat(i)],j.constructor,V,i),T(n,P.$changes.refId)}Z&&M.cache(s,n.slice(p))}}}d||Z||M.discard()}return n},H.prototype.encodeAll=function(E){return this.encode(!0,[],E)},H.prototype.applyFilters=function(d,n){var Z,I;void 0===n&&(n=!1);for(var l=this,r=new Set,t=PE.get(d),S=[this.$changes],M=1,V=[],C=function(C){var w=S[C];if(r.has(w.refId))return"continue";var R=w.ref,L=R instanceof H;o(V,g),T(V,w.refId);var D=t.refIds.has(w),e=n||!D;t.addRefId(w);var s=t.containerIndexes.get(w),i=e?Array.from(w.allChanges):Array.from(w.changes.values());!n&&L&&R._definition.indexesWithFilters&&R._definition.indexesWithFilters.forEach((function(H){!s.has(H)&&w.allChanges.has(H)&&(e?i.push(H):i.push({op:E.OPERATION.ADD,index:H}))}));for(var p=0,f=i.length;p<f;p++){var P=e?{op:E.OPERATION.ADD,index:i[p]}:i[p];if(P.op!==E.OPERATION.CLEAR){var j=P.index;if(P.op!==E.OPERATION.DELETE){var X=w.getValue(j),W=w.getType(j);if(L){if((U=R._definition.filters&&R._definition.filters[j])&&!U.call(R,d,X,l)){X&&X.$changes&&r.add(X.$changes.refId);continue}}else{var U,Y=w.parent;if((U=w.getChildrenFilter())&&!U.call(Y,d,R.$indexes.get(j),X,l)){X&&X.$changes&&r.add(X.$changes.refId);continue}}if(X.$changes&&(S.push(X.$changes),M++),P.op!==E.OPERATION.TOUCH)if(P.op===E.OPERATION.ADD||L)V.push.apply(V,null!==(Z=w.caches[j])&&void 0!==Z?Z:[]),s.add(j);else if(s.has(j))V.push.apply(V,null!==(I=w.caches[j])&&void 0!==I?I:[]);else{if(s.add(j),o(V,E.OPERATION.ADD),T(V,j),R instanceof Q){var c=w.ref.$indexes.get(j);mE(V,c)}X.$changes?T(V,X.$changes.refId):A[W](V,X)}else X.$changes&&!L&&(o(V,E.OPERATION.ADD),T(V,j),R instanceof Q&&(c=w.ref.$indexes.get(j),mE(V,c)),T(V,X.$changes.refId))}else L?o(V,P.op|j):(o(V,P.op),T(V,j))}else o(V,P.op)}},w=0;w<M;w++)C(w);return V},H.prototype.clone=function(){var E,H=new this.constructor,d=this._definition.schema;for(var n in d)"object"===typeof this[n]&&"function"===typeof(null===(E=this[n])||void 0===E?void 0:E.clone)?H[n]=this[n].clone():H[n]=this[n];return H},H.prototype.toJSON=function(){var E=this._definition.schema,H=this._definition.deprecated,d={};for(var n in E)H[n]||null===this[n]||"undefined"===typeof this[n]||(d[n]="function"===typeof this[n].toJSON?this[n].toJSON():this["_".concat(n)]);return d},H.prototype.discardAllChanges=function(){this.$changes.discardAll()},H.prototype.getByIndex=function(E){return this[this._definition.fieldsByIndex[E]]},H.prototype.deleteByIndex=function(E){this[this._definition.fieldsByIndex[E]]=void 0},H.prototype.tryEncodeTypeId=function(E,H,d){H._typeid!==d._typeid&&(o(E,l),T(E,d._typeid))},H.prototype.getSchemaType=function(E,H,d){var n;return E[H.offset]===l&&(H.offset++,n=this.constructor._context.get(LE(E,H))),n||d},H.prototype.createTypeInstance=function(E){var H=new E;return H.$changes.root=this.$changes.root,H},H.prototype._triggerChanges=function(d){for(var n,Z,I,g,l,r,t,S,M,V=new Set,C=this.$changes.root.refs,w=function(w){var R=d[w],Q=R.refId,L=C.get(Q),D=L.$callbacks;if((R.op&E.OPERATION.DELETE)===E.OPERATION.DELETE&&R.previousValue instanceof H&&(null===(Z=null===(n=R.previousValue.$callbacks)||void 0===n?void 0:n[E.OPERATION.DELETE])||void 0===Z||Z.forEach((function(E){return E()}))),!D)return"continue";if(L instanceof H){if(!V.has(Q))try{null===(I=null===D||void 0===D?void 0:D[E.OPERATION.REPLACE])||void 0===I||I.forEach((function(E){return E()}))}catch(e){H.onError(e)}try{D.hasOwnProperty(R.field)&&(null===(g=D[R.field])||void 0===g||g.forEach((function(E){return E(R.value,R.previousValue)})))}catch(e){H.onError(e)}}else R.op===E.OPERATION.ADD&&void 0===R.previousValue?null===(l=D[E.OPERATION.ADD])||void 0===l||l.forEach((function(E){var H;return E(R.value,null!==(H=R.dynamicIndex)&&void 0!==H?H:R.field)})):R.op===E.OPERATION.DELETE?void 0!==R.previousValue&&(null===(r=D[E.OPERATION.DELETE])||void 0===r||r.forEach((function(E){var H;return E(R.previousValue,null!==(H=R.dynamicIndex)&&void 0!==H?H:R.field)}))):R.op===E.OPERATION.DELETE_AND_ADD&&(void 0!==R.previousValue&&(null===(t=D[E.OPERATION.DELETE])||void 0===t||t.forEach((function(E){var H;return E(R.previousValue,null!==(H=R.dynamicIndex)&&void 0!==H?H:R.field)}))),null===(S=D[E.OPERATION.ADD])||void 0===S||S.forEach((function(E){var H;return E(R.value,null!==(H=R.dynamicIndex)&&void 0!==H?H:R.field)}))),R.value!==R.previousValue&&(null===(M=D[E.OPERATION.REPLACE])||void 0===M||M.forEach((function(E){var H;return E(R.value,null!==(H=R.dynamicIndex)&&void 0!==H?H:R.field)})));V.add(Q)},R=0;R<d.length;R++)w(R)},H._definition=s.create(),H}();function oE(E){for(var H=[E.$changes],d=1,n={},Z=n,I=function(E){var d=H[E];d.changes.forEach((function(E){var H=d.ref,n=E.index,I=H._definition?H._definition.fieldsByIndex[n]:H.$indexes.get(n);Z[I]=d.getValue(n)}))},g=0;g<d;g++)I(g);return n}var FE={context:new p},aE=function(E){function H(){return null!==E&&E.apply(this,arguments)||this}return d(H,E),n([P("string",FE)],H.prototype,"name",void 0),n([P("string",FE)],H.prototype,"type",void 0),n([P("number",FE)],H.prototype,"referencedType",void 0),H}(uE),kE=function(E){function H(){var H=null!==E&&E.apply(this,arguments)||this;return H.fields=new w,H}return d(H,E),n([P("number",FE)],H.prototype,"id",void 0),n([P([aE],FE)],H.prototype,"fields",void 0),H}(uE),OE=function(E){function H(){var H=null!==E&&E.apply(this,arguments)||this;return H.types=new w,H}return d(H,E),H.encode=function(E){var d=E.constructor,n=new H;n.rootType=d._typeid;var Z=function(E,H){for(var d in H){var Z=new aE;Z.name=d;var I=void 0;if("string"===typeof H[d])I=H[d];else{var g=H[d],l=void 0;uE.is(g)?(I="ref",l=H[d]):"string"===typeof g[I=Object.keys(g)[0]]?I+=":"+g[I]:l=g[I],Z.referencedType=l?l._typeid:-1}Z.type=I,E.fields.push(Z)}n.types.push(E)},I=d._context.types;for(var g in I){var l=new kE;l.id=Number(g),Z(l,I[g]._definition.schema)}return n.encodeAll()},H.decode=function(E,n){var Z=new p,I=new H;I.decode(E,n);var g=I.types.reduce((function(E,H){var n=function(E){function H(){return null!==E&&E.apply(this,arguments)||this}return d(H,E),H}(uE),I=H.id;return E[I]=n,Z.add(n,I),E}),{});I.types.forEach((function(E){var H=g[E.id];E.fields.forEach((function(E){var d;if(void 0!==E.referencedType){var n=E.type,I=g[E.referencedType];if(!I){var l=E.type.split(":");n=l[0],I=l[1]}"ref"===n?P(I,{context:Z})(H.prototype,E.name):P(((d={})[n]=I,d),{context:Z})(H.prototype,E.name)}else P(E.type,{context:Z})(H.prototype,E.name)}))}));var l=g[I.rootType],r=new l;for(var t in l._definition.schema){var S=l._definition.schema[t];"string"!==typeof S&&(r[t]="function"===typeof S?new S:new(e(Object.keys(S)[0]).constructor))}return r},n([P([kE],FE)],H.prototype,"types",void 0),n([P("number",FE)],H.prototype,"rootType",void 0),H}(uE);D("map",{constructor:Q}),D("array",{constructor:w}),D("set",{constructor:fE}),D("collection",{constructor:pE}),E.ArraySchema=w,E.CollectionSchema=pE,E.Context=p,E.MapSchema=Q,E.Reflection=OE,E.ReflectionField=aE,E.ReflectionType=kE,E.Schema=uE,E.SchemaDefinition=s,E.SetSchema=fE,E.decode=iE,E.defineTypes=U,E.deprecated=W,E.dumpChanges=oE,E.encode=A,E.filter=j,E.filterChildren=X,E.hasFilter=i,E.registerType=D,E.type=P,Object.defineProperty(E,"__esModule",{value:!0})}(H)},14497:E=>{"use strict";E.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14489:(E,H,d)=>{var n=d(14497),Z=d(14502),I=Object.hasOwnProperty,g=Object.create(null);for(var l in n)I.call(n,l)&&(g[n[l]]=l);var r=E.exports={to:{},get:{}};function t(E,H,d){return Math.min(Math.max(H,E),d)}function S(E){var H=Math.round(E).toString(16).toUpperCase();return H.length<2?"0"+H:H}r.get=function(E){var H,d;switch(E.substring(0,3).toLowerCase()){case"hsl":H=r.get.hsl(E),d="hsl";break;case"hwb":H=r.get.hwb(E),d="hwb";break;default:H=r.get.rgb(E),d="rgb"}return H?{model:d,value:H}:null},r.get.rgb=function(E){if(!E)return null;var H,d,Z,g=[0,0,0,1];if(H=E.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(Z=H[2],H=H[1],d=0;d<3;d++){var l=2*d;g[d]=parseInt(H.slice(l,l+2),16)}Z&&(g[3]=parseInt(Z,16)/255)}else if(H=E.match(/^#([a-f0-9]{3,4})$/i)){for(Z=(H=H[1])[3],d=0;d<3;d++)g[d]=parseInt(H[d]+H[d],16);Z&&(g[3]=parseInt(Z+Z,16)/255)}else if(H=E.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(d=0;d<3;d++)g[d]=parseInt(H[d+1],0);H[4]&&(H[5]?g[3]=.01*parseFloat(H[4]):g[3]=parseFloat(H[4]))}else{if(!(H=E.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(H=E.match(/^(\w+)$/))?"transparent"===H[1]?[0,0,0,0]:I.call(n,H[1])?((g=n[H[1]])[3]=1,g):null:null;for(d=0;d<3;d++)g[d]=Math.round(2.55*parseFloat(H[d+1]));H[4]&&(H[5]?g[3]=.01*parseFloat(H[4]):g[3]=parseFloat(H[4]))}for(d=0;d<3;d++)g[d]=t(g[d],0,255);return g[3]=t(g[3],0,1),g},r.get.hsl=function(E){if(!E)return null;var H=E.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(H){var d=parseFloat(H[4]);return[(parseFloat(H[1])%360+360)%360,t(parseFloat(H[2]),0,100),t(parseFloat(H[3]),0,100),t(isNaN(d)?1:d,0,1)]}return null},r.get.hwb=function(E){if(!E)return null;var H=E.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(H){var d=parseFloat(H[4]);return[(parseFloat(H[1])%360+360)%360,t(parseFloat(H[2]),0,100),t(parseFloat(H[3]),0,100),t(isNaN(d)?1:d,0,1)]}return null},r.to.hex=function(){var E=Z(arguments);return"#"+S(E[0])+S(E[1])+S(E[2])+(E[3]<1?S(Math.round(255*E[3])):"")},r.to.rgb=function(){var E=Z(arguments);return E.length<4||1===E[3]?"rgb("+Math.round(E[0])+", "+Math.round(E[1])+", "+Math.round(E[2])+")":"rgba("+Math.round(E[0])+", "+Math.round(E[1])+", "+Math.round(E[2])+", "+E[3]+")"},r.to.rgb.percent=function(){var E=Z(arguments),H=Math.round(E[0]/255*100),d=Math.round(E[1]/255*100),n=Math.round(E[2]/255*100);return E.length<4||1===E[3]?"rgb("+H+"%, "+d+"%, "+n+"%)":"rgba("+H+"%, "+d+"%, "+n+"%, "+E[3]+")"},r.to.hsl=function(){var E=Z(arguments);return E.length<4||1===E[3]?"hsl("+E[0]+", "+E[1]+"%, "+E[2]+"%)":"hsla("+E[0]+", "+E[1]+"%, "+E[2]+"%, "+E[3]+")"},r.to.hwb=function(){var E=Z(arguments),H="";return E.length>=4&&1!==E[3]&&(H=", "+E[3]),"hwb("+E[0]+", "+E[1]+"%, "+E[2]+"%"+H+")"},r.to.keyword=function(E){return g[E.slice(0,3)]}},14486:(E,H,d)=>{const n=d(14489),Z=d(14517),I=["keyword","gray","hex"],g={};for(const C of Object.keys(Z))g[[...Z[C].labels].sort().join("")]=C;const l={};function r(E,H){if(!(this instanceof r))return new r(E,H);if(H&&H in I&&(H=null),H&&!(H in Z))throw new Error("Unknown model: "+H);let d,t;if(null==E)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(E instanceof r)this.model=E.model,this.color=[...E.color],this.valpha=E.valpha;else if("string"===typeof E){const H=n.get(E);if(null===H)throw new Error("Unable to parse color from string: "+E);this.model=H.model,t=Z[this.model].channels,this.color=H.value.slice(0,t),this.valpha="number"===typeof H.value[t]?H.value[t]:1}else if(E.length>0){this.model=H||"rgb",t=Z[this.model].channels;const d=Array.prototype.slice.call(E,0,t);this.color=V(d,t),this.valpha="number"===typeof E[t]?E[t]:1}else if("number"===typeof E)this.model="rgb",this.color=[E>>16&255,E>>8&255,255&E],this.valpha=1;else{this.valpha=1;const H=Object.keys(E);"alpha"in E&&(H.splice(H.indexOf("alpha"),1),this.valpha="number"===typeof E.alpha?E.alpha:0);const n=H.sort().join("");if(!(n in g))throw new Error("Unable to parse color from object: "+JSON.stringify(E));this.model=g[n];const{labels:I}=Z[this.model],l=[];for(d=0;d<I.length;d++)l.push(E[I[d]]);this.color=V(l)}if(l[this.model])for(t=Z[this.model].channels,d=0;d<t;d++){const E=l[this.model][d];E&&(this.color[d]=E(this.color[d]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}r.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(E){let H=this.model in n.to?this:this.rgb();H=H.round("number"===typeof E?E:1);const d=1===H.valpha?H.color:[...H.color,this.valpha];return n.to[H.model](d)},percentString(E){const H=this.rgb().round("number"===typeof E?E:1),d=1===H.valpha?H.color:[...H.color,this.valpha];return n.to.rgb.percent(d)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const E={},{channels:H}=Z[this.model],{labels:d}=Z[this.model];for(let n=0;n<H;n++)E[d[n]]=this.color[n];return 1!==this.valpha&&(E.alpha=this.valpha),E},unitArray(){const E=this.rgb().color;return E[0]/=255,E[1]/=255,E[2]/=255,1!==this.valpha&&E.push(this.valpha),E},unitObject(){const E=this.rgb().object();return E.r/=255,E.g/=255,E.b/=255,1!==this.valpha&&(E.alpha=this.valpha),E},round(E){return E=Math.max(E||0,0),new r([...this.color.map(t(E)),this.valpha],this.model)},alpha(E){return void 0!==E?new r([...this.color,Math.max(0,Math.min(1,E))],this.model):this.valpha},red:S("rgb",0,M(255)),green:S("rgb",1,M(255)),blue:S("rgb",2,M(255)),hue:S(["hsl","hsv","hsl","hwb","hcg"],0,(E=>(E%360+360)%360)),saturationl:S("hsl",1,M(100)),lightness:S("hsl",2,M(100)),saturationv:S("hsv",1,M(100)),value:S("hsv",2,M(100)),chroma:S("hcg",1,M(100)),gray:S("hcg",2,M(100)),white:S("hwb",1,M(100)),wblack:S("hwb",2,M(100)),cyan:S("cmyk",0,M(100)),magenta:S("cmyk",1,M(100)),yellow:S("cmyk",2,M(100)),black:S("cmyk",3,M(100)),x:S("xyz",0,M(95.047)),y:S("xyz",1,M(100)),z:S("xyz",2,M(108.833)),l:S("lab",0,M(100)),a:S("lab",1),b:S("lab",2),keyword(E){return void 0!==E?new r(E):Z[this.model].keyword(this.color)},hex(E){return void 0!==E?new r(E):n.to.hex(this.rgb().round().color)},hexa(E){if(void 0!==E)return new r(E);const H=this.rgb().round().color;let d=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===d.length&&(d="0"+d),n.to.hex(H)+d},rgbNumber(){const E=this.rgb().color;return(255&E[0])<<16|(255&E[1])<<8|255&E[2]},luminosity(){const E=this.rgb().color,H=[];for(const[d,n]of E.entries()){const E=n/255;H[d]=E<=.04045?E/12.92:((E+.055)/1.055)**2.4}return.2126*H[0]+.7152*H[1]+.0722*H[2]},contrast(E){const H=this.luminosity(),d=E.luminosity();return H>d?(H+.05)/(d+.05):(d+.05)/(H+.05)},level(E){const H=this.contrast(E);return H>=7?"AAA":H>=4.5?"AA":""},isDark(){const E=this.rgb().color;return(2126*E[0]+7152*E[1]+722*E[2])/1e4<128},isLight(){return!this.isDark()},negate(){const E=this.rgb();for(let H=0;H<3;H++)E.color[H]=255-E.color[H];return E},lighten(E){const H=this.hsl();return H.color[2]+=H.color[2]*E,H},darken(E){const H=this.hsl();return H.color[2]-=H.color[2]*E,H},saturate(E){const H=this.hsl();return H.color[1]+=H.color[1]*E,H},desaturate(E){const H=this.hsl();return H.color[1]-=H.color[1]*E,H},whiten(E){const H=this.hwb();return H.color[1]+=H.color[1]*E,H},blacken(E){const H=this.hwb();return H.color[2]+=H.color[2]*E,H},grayscale(){const E=this.rgb().color,H=.3*E[0]+.59*E[1]+.11*E[2];return r.rgb(H,H,H)},fade(E){return this.alpha(this.valpha-this.valpha*E)},opaquer(E){return this.alpha(this.valpha+this.valpha*E)},rotate(E){const H=this.hsl();let d=H.color[0];return d=(d+E)%360,d=d<0?360+d:d,H.color[0]=d,H},mix(E,H){if(!E||!E.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof E);const d=E.rgb(),n=this.rgb(),Z=void 0===H?.5:H,I=2*Z-1,g=d.alpha()-n.alpha(),l=((I*g===-1?I:(I+g)/(1+I*g))+1)/2,t=1-l;return r.rgb(l*d.red()+t*n.red(),l*d.green()+t*n.green(),l*d.blue()+t*n.blue(),d.alpha()*Z+n.alpha()*(1-Z))}};for(const C of Object.keys(Z)){if(I.includes(C))continue;const{channels:E}=Z[C];r.prototype[C]=function(){if(this.model===C)return new r(this);for(var E=arguments.length,H=new Array(E),d=0;d<E;d++)H[d]=arguments[d];return H.length>0?new r(H,C):new r([...(n=Z[this.model][C].raw(this.color),Array.isArray(n)?n:[n]),this.valpha],C);var n},r[C]=function(){for(var H=arguments.length,d=new Array(H),n=0;n<H;n++)d[n]=arguments[n];let Z=d[0];return"number"===typeof Z&&(Z=V(d,E)),new r(Z,C)}}function t(E){return function(H){return function(E,H){return Number(E.toFixed(H))}(H,E)}}function S(E,H,d){E=Array.isArray(E)?E:[E];for(const n of E)(l[n]||(l[n]=[]))[H]=d;return E=E[0],function(n){let Z;return void 0!==n?(d&&(n=d(n)),Z=this[E](),Z.color[H]=n,Z):(Z=this[E]().color[H],d&&(Z=d(Z)),Z)}}function M(E){return function(H){return Math.max(0,Math.min(E,H))}}function V(E,H){for(let d=0;d<H;d++)"number"!==typeof E[d]&&(E[d]=0);return E}E.exports=r},14524:(E,H,d)=>{const n=d(14533),Z={};for(const g of Object.keys(n))Z[n[g]]=g;const I={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};E.exports=I;for(const g of Object.keys(I)){if(!("channels"in I[g]))throw new Error("missing channels property: "+g);if(!("labels"in I[g]))throw new Error("missing channel labels property: "+g);if(I[g].labels.length!==I[g].channels)throw new Error("channel and label counts mismatch: "+g);const{channels:E,labels:H}=I[g];delete I[g].channels,delete I[g].labels,Object.defineProperty(I[g],"channels",{value:E}),Object.defineProperty(I[g],"labels",{value:H})}I.rgb.hsl=function(E){const H=E[0]/255,d=E[1]/255,n=E[2]/255,Z=Math.min(H,d,n),I=Math.max(H,d,n),g=I-Z;let l,r;I===Z?l=0:H===I?l=(d-n)/g:d===I?l=2+(n-H)/g:n===I&&(l=4+(H-d)/g),l=Math.min(60*l,360),l<0&&(l+=360);const t=(Z+I)/2;return r=I===Z?0:t<=.5?g/(I+Z):g/(2-I-Z),[l,100*r,100*t]},I.rgb.hsv=function(E){let H,d,n,Z,I;const g=E[0]/255,l=E[1]/255,r=E[2]/255,t=Math.max(g,l,r),S=t-Math.min(g,l,r),M=function(E){return(t-E)/6/S+.5};return 0===S?(Z=0,I=0):(I=S/t,H=M(g),d=M(l),n=M(r),g===t?Z=n-d:l===t?Z=1/3+H-n:r===t&&(Z=2/3+d-H),Z<0?Z+=1:Z>1&&(Z-=1)),[360*Z,100*I,100*t]},I.rgb.hwb=function(E){const H=E[0],d=E[1];let n=E[2];const Z=I.rgb.hsl(E)[0],g=1/255*Math.min(H,Math.min(d,n));return n=1-1/255*Math.max(H,Math.max(d,n)),[Z,100*g,100*n]},I.rgb.cmyk=function(E){const H=E[0]/255,d=E[1]/255,n=E[2]/255,Z=Math.min(1-H,1-d,1-n);return[100*((1-H-Z)/(1-Z)||0),100*((1-d-Z)/(1-Z)||0),100*((1-n-Z)/(1-Z)||0),100*Z]},I.rgb.keyword=function(E){const H=Z[E];if(H)return H;let d,I=1/0;for(const Z of Object.keys(n)){const H=n[Z],r=(l=H,((g=E)[0]-l[0])**2+(g[1]-l[1])**2+(g[2]-l[2])**2);r<I&&(I=r,d=Z)}var g,l;return d},I.keyword.rgb=function(E){return n[E]},I.rgb.xyz=function(E){let H=E[0]/255,d=E[1]/255,n=E[2]/255;H=H>.04045?((H+.055)/1.055)**2.4:H/12.92,d=d>.04045?((d+.055)/1.055)**2.4:d/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92;return[100*(.4124*H+.3576*d+.1805*n),100*(.2126*H+.7152*d+.0722*n),100*(.0193*H+.1192*d+.9505*n)]},I.rgb.lab=function(E){const H=I.rgb.xyz(E);let d=H[0],n=H[1],Z=H[2];d/=95.047,n/=100,Z/=108.883,d=d>.008856?d**(1/3):7.787*d+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116;return[116*n-16,500*(d-n),200*(n-Z)]},I.hsl.rgb=function(E){const H=E[0]/360,d=E[1]/100,n=E[2]/100;let Z,I,g;if(0===d)return g=255*n,[g,g,g];Z=n<.5?n*(1+d):n+d-n*d;const l=2*n-Z,r=[0,0,0];for(let t=0;t<3;t++)I=H+1/3*-(t-1),I<0&&I++,I>1&&I--,g=6*I<1?l+6*(Z-l)*I:2*I<1?Z:3*I<2?l+(Z-l)*(2/3-I)*6:l,r[t]=255*g;return r},I.hsl.hsv=function(E){const H=E[0];let d=E[1]/100,n=E[2]/100,Z=d;const I=Math.max(n,.01);n*=2,d*=n<=1?n:2-n,Z*=I<=1?I:2-I;return[H,100*(0===n?2*Z/(I+Z):2*d/(n+d)),100*((n+d)/2)]},I.hsv.rgb=function(E){const H=E[0]/60,d=E[1]/100;let n=E[2]/100;const Z=Math.floor(H)%6,I=H-Math.floor(H),g=255*n*(1-d),l=255*n*(1-d*I),r=255*n*(1-d*(1-I));switch(n*=255,Z){case 0:return[n,r,g];case 1:return[l,n,g];case 2:return[g,n,r];case 3:return[g,l,n];case 4:return[r,g,n];case 5:return[n,g,l]}},I.hsv.hsl=function(E){const H=E[0],d=E[1]/100,n=E[2]/100,Z=Math.max(n,.01);let I,g;g=(2-d)*n;const l=(2-d)*Z;return I=d*Z,I/=l<=1?l:2-l,I=I||0,g/=2,[H,100*I,100*g]},I.hwb.rgb=function(E){const H=E[0]/360;let d=E[1]/100,n=E[2]/100;const Z=d+n;let I;Z>1&&(d/=Z,n/=Z);const g=Math.floor(6*H),l=1-n;I=6*H-g,0!==(1&g)&&(I=1-I);const r=d+I*(l-d);let t,S,M;switch(g){default:case 6:case 0:t=l,S=r,M=d;break;case 1:t=r,S=l,M=d;break;case 2:t=d,S=l,M=r;break;case 3:t=d,S=r,M=l;break;case 4:t=r,S=d,M=l;break;case 5:t=l,S=d,M=r}return[255*t,255*S,255*M]},I.cmyk.rgb=function(E){const H=E[0]/100,d=E[1]/100,n=E[2]/100,Z=E[3]/100;return[255*(1-Math.min(1,H*(1-Z)+Z)),255*(1-Math.min(1,d*(1-Z)+Z)),255*(1-Math.min(1,n*(1-Z)+Z))]},I.xyz.rgb=function(E){const H=E[0]/100,d=E[1]/100,n=E[2]/100;let Z,I,g;return Z=3.2406*H+-1.5372*d+-.4986*n,I=-.9689*H+1.8758*d+.0415*n,g=.0557*H+-.204*d+1.057*n,Z=Z>.0031308?1.055*Z**(1/2.4)-.055:12.92*Z,I=I>.0031308?1.055*I**(1/2.4)-.055:12.92*I,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,Z=Math.min(Math.max(0,Z),1),I=Math.min(Math.max(0,I),1),g=Math.min(Math.max(0,g),1),[255*Z,255*I,255*g]},I.xyz.lab=function(E){let H=E[0],d=E[1],n=E[2];H/=95.047,d/=100,n/=108.883,H=H>.008856?H**(1/3):7.787*H+16/116,d=d>.008856?d**(1/3):7.787*d+16/116,n=n>.008856?n**(1/3):7.787*n+16/116;return[116*d-16,500*(H-d),200*(d-n)]},I.lab.xyz=function(E){let H,d,n;d=(E[0]+16)/116,H=E[1]/500+d,n=d-E[2]/200;const Z=d**3,I=H**3,g=n**3;return d=Z>.008856?Z:(d-16/116)/7.787,H=I>.008856?I:(H-16/116)/7.787,n=g>.008856?g:(n-16/116)/7.787,H*=95.047,d*=100,n*=108.883,[H,d,n]},I.lab.lch=function(E){const H=E[0],d=E[1],n=E[2];let Z;Z=360*Math.atan2(n,d)/2/Math.PI,Z<0&&(Z+=360);return[H,Math.sqrt(d*d+n*n),Z]},I.lch.lab=function(E){const H=E[0],d=E[1],n=E[2]/360*2*Math.PI;return[H,d*Math.cos(n),d*Math.sin(n)]},I.rgb.ansi16=function(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[d,n,Z]=E;let g=null===H?I.rgb.hsv(E)[2]:H;if(g=Math.round(g/50),0===g)return 30;let l=30+(Math.round(Z/255)<<2|Math.round(n/255)<<1|Math.round(d/255));return 2===g&&(l+=60),l},I.hsv.ansi16=function(E){return I.rgb.ansi16(I.hsv.rgb(E),E[2])},I.rgb.ansi256=function(E){const H=E[0],d=E[1],n=E[2];if(H===d&&d===n)return H<8?16:H>248?231:Math.round((H-8)/247*24)+232;return 16+36*Math.round(H/255*5)+6*Math.round(d/255*5)+Math.round(n/255*5)},I.ansi16.rgb=function(E){let H=E%10;if(0===H||7===H)return E>50&&(H+=3.5),H=H/10.5*255,[H,H,H];const d=.5*(1+~~(E>50));return[(1&H)*d*255,(H>>1&1)*d*255,(H>>2&1)*d*255]},I.ansi256.rgb=function(E){if(E>=232){const H=10*(E-232)+8;return[H,H,H]}let H;E-=16;return[Math.floor(E/36)/5*255,Math.floor((H=E%36)/6)/5*255,H%6/5*255]},I.rgb.hex=function(E){const H=(((255&Math.round(E[0]))<<16)+((255&Math.round(E[1]))<<8)+(255&Math.round(E[2]))).toString(16).toUpperCase();return"000000".substring(H.length)+H},I.hex.rgb=function(E){const H=E.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!H)return[0,0,0];let d=H[0];3===H[0].length&&(d=d.split("").map((E=>E+E)).join(""));const n=parseInt(d,16);return[n>>16&255,n>>8&255,255&n]},I.rgb.hcg=function(E){const H=E[0]/255,d=E[1]/255,n=E[2]/255,Z=Math.max(Math.max(H,d),n),I=Math.min(Math.min(H,d),n),g=Z-I;let l,r;return l=g<1?I/(1-g):0,r=g<=0?0:Z===H?(d-n)/g%6:Z===d?2+(n-H)/g:4+(H-d)/g,r/=6,r%=1,[360*r,100*g,100*l]},I.hsl.hcg=function(E){const H=E[1]/100,d=E[2]/100,n=d<.5?2*H*d:2*H*(1-d);let Z=0;return n<1&&(Z=(d-.5*n)/(1-n)),[E[0],100*n,100*Z]},I.hsv.hcg=function(E){const H=E[1]/100,d=E[2]/100,n=H*d;let Z=0;return n<1&&(Z=(d-n)/(1-n)),[E[0],100*n,100*Z]},I.hcg.rgb=function(E){const H=E[0]/360,d=E[1]/100,n=E[2]/100;if(0===d)return[255*n,255*n,255*n];const Z=[0,0,0],I=H%1*6,g=I%1,l=1-g;let r=0;switch(Math.floor(I)){case 0:Z[0]=1,Z[1]=g,Z[2]=0;break;case 1:Z[0]=l,Z[1]=1,Z[2]=0;break;case 2:Z[0]=0,Z[1]=1,Z[2]=g;break;case 3:Z[0]=0,Z[1]=l,Z[2]=1;break;case 4:Z[0]=g,Z[1]=0,Z[2]=1;break;default:Z[0]=1,Z[1]=0,Z[2]=l}return r=(1-d)*n,[255*(d*Z[0]+r),255*(d*Z[1]+r),255*(d*Z[2]+r)]},I.hcg.hsv=function(E){const H=E[1]/100,d=H+E[2]/100*(1-H);let n=0;return d>0&&(n=H/d),[E[0],100*n,100*d]},I.hcg.hsl=function(E){const H=E[1]/100,d=E[2]/100*(1-H)+.5*H;let n=0;return d>0&&d<.5?n=H/(2*d):d>=.5&&d<1&&(n=H/(2*(1-d))),[E[0],100*n,100*d]},I.hcg.hwb=function(E){const H=E[1]/100,d=H+E[2]/100*(1-H);return[E[0],100*(d-H),100*(1-d)]},I.hwb.hcg=function(E){const H=E[1]/100,d=1-E[2]/100,n=d-H;let Z=0;return n<1&&(Z=(d-n)/(1-n)),[E[0],100*n,100*Z]},I.apple.rgb=function(E){return[E[0]/65535*255,E[1]/65535*255,E[2]/65535*255]},I.rgb.apple=function(E){return[E[0]/255*65535,E[1]/255*65535,E[2]/255*65535]},I.gray.rgb=function(E){return[E[0]/100*255,E[0]/100*255,E[0]/100*255]},I.gray.hsl=function(E){return[0,0,E[0]]},I.gray.hsv=I.gray.hsl,I.gray.hwb=function(E){return[0,100,E[0]]},I.gray.cmyk=function(E){return[0,0,0,E[0]]},I.gray.lab=function(E){return[E[0],0,0]},I.gray.hex=function(E){const H=255&Math.round(E[0]/100*255),d=((H<<16)+(H<<8)+H).toString(16).toUpperCase();return"000000".substring(d.length)+d},I.rgb.gray=function(E){return[(E[0]+E[1]+E[2])/3/255*100]}},14517:(E,H,d)=>{const n=d(14524),Z=d(14536),I={};Object.keys(n).forEach((E=>{I[E]={},Object.defineProperty(I[E],"channels",{value:n[E].channels}),Object.defineProperty(I[E],"labels",{value:n[E].labels});const H=Z(E);Object.keys(H).forEach((d=>{const n=H[d];I[E][d]=function(E){const H=function(){for(var H=arguments.length,d=new Array(H),n=0;n<H;n++)d[n]=arguments[n];const Z=d[0];if(void 0===Z||null===Z)return Z;Z.length>1&&(d=Z);const I=E(d);if("object"===typeof I)for(let E=I.length,g=0;g<E;g++)I[g]=Math.round(I[g]);return I};return"conversion"in E&&(H.conversion=E.conversion),H}(n),I[E][d].raw=function(E){const H=function(){for(var H=arguments.length,d=new Array(H),n=0;n<H;n++)d[n]=arguments[n];const Z=d[0];return void 0===Z||null===Z?Z:(Z.length>1&&(d=Z),E(d))};return"conversion"in E&&(H.conversion=E.conversion),H}(n)}))})),E.exports=I},14536:(E,H,d)=>{const n=d(14524);function Z(E){const H=function(){const E={},H=Object.keys(n);for(let d=H.length,n=0;n<d;n++)E[H[n]]={distance:-1,parent:null};return E}(),d=[E];for(H[E].distance=0;d.length;){const E=d.pop(),Z=Object.keys(n[E]);for(let n=Z.length,I=0;I<n;I++){const n=Z[I],g=H[n];-1===g.distance&&(g.distance=H[E].distance+1,g.parent=E,d.unshift(n))}}return H}function I(E,H){return function(d){return H(E(d))}}function g(E,H){const d=[H[E].parent,E];let Z=n[H[E].parent][E],g=H[E].parent;for(;H[g].parent;)d.unshift(H[g].parent),Z=I(n[H[g].parent][g],Z),g=H[g].parent;return Z.conversion=d,Z}E.exports=function(E){const H=Z(E),d={},n=Object.keys(H);for(let Z=n.length,I=0;I<Z;I++){const E=n[I];null!==H[E].parent&&(d[E]=g(E,H))}return d}},14533:E=>{"use strict";E.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13099:(E,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.discordURLBuilder=void 0,H.discordURLBuilder=function(E){var H;const d=(null===(H=null===window||void 0===window?void 0:window.location)||void 0===H?void 0:H.hostname)||"localhost",n=E.hostname.split("."),Z=!E.hostname.includes("trycloudflare.com")&&!E.hostname.includes("discordsays.com")&&n.length>2?`/${n[0]}`:"";return E.pathname.startsWith("/.proxy")?`${E.protocol}//${d}${Z}${E.pathname}${E.search}`:`${E.protocol}//${d}/.proxy/colyseus${Z}${E.pathname}${E.search}`}},13088:function(E,H,d){"use strict";var n,Z,I,g,l=this&&this.__awaiter||function(E,H,d,n){return new(d||(d=Promise))((function(Z,I){function g(E){try{r(n.next(E))}catch(H){I(H)}}function l(E){try{r(n.throw(E))}catch(H){I(H)}}function r(E){var H;E.done?Z(E.value):(H=E.value,H instanceof d?H:new d((function(E){E(H)}))).then(g,l)}r((n=n.apply(E,H||[])).next())}))},r=this&&this.__classPrivateFieldGet||function(E,H,d,n){if("a"===d&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof H?E!==H||!n:!H.has(E))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===d?n:"a"===d?n.call(E):n?n.value:H.get(E)},t=this&&this.__classPrivateFieldSet||function(E,H,d,n,Z){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!Z)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof H?E!==H||!Z:!H.has(E))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?Z.call(E,d):Z?Z.value=d:H.set(E,d),d};Object.defineProperty(H,"__esModule",{value:!0}),H.Auth=void 0;const S=d(13093),M=d(13050);H.Auth=class{constructor(E){this.http=E,this.settings={path:"/auth",key:"colyseus-auth-token"},n.set(this,!1),Z.set(this,void 0),I.set(this,void 0),g.set(this,(0,M.createNanoEvents)()),(0,S.getItem)(this.settings.key,(E=>this.token=E))}set token(E){this.http.authToken=E}get token(){return this.http.authToken}onChange(E){const H=r(this,g,"f").on("change",E);return r(this,n,"f")||t(this,Z,new Promise(((E,H)=>{this.getUserData().then((E=>{this.emitChange(Object.assign(Object.assign({},E),{token:this.token}))})).catch((E=>{this.emitChange({user:null,token:void 0})})).finally((()=>{E()}))})),"f"),t(this,n,!0,"f"),H}getUserData(){return l(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(E,H,d){return l(this,void 0,void 0,(function*(){const n=(yield this.http.post(`${this.settings.path}/register`,{body:{email:E,password:H,options:d}})).data;return this.emitChange(n),n}))}signInWithEmailAndPassword(E,H){return l(this,void 0,void 0,(function*(){const d=(yield this.http.post(`${this.settings.path}/login`,{body:{email:E,password:H}})).data;return this.emitChange(d),d}))}signInAnonymously(E){return l(this,void 0,void 0,(function*(){const H=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:E}})).data;return this.emitChange(H),H}))}sendPasswordResetEmail(E){return l(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:E}})).data}))}signInWithProvider(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l(this,void 0,void 0,(function*(){return new Promise(((d,n)=>{const Z=H.width||480,g=H.height||768,l=this.token?`?token=${this.token}`:"",S=`Login with ${E[0].toUpperCase()+E.substring(1)}`,M=this.http.client.getHttpEndpoint(`${H.prefix||`${this.settings.path}/provider`}/${E}${l}`),V=screen.width/2-Z/2,C=screen.height/2-g/2;t(this,I,window.open(M,S,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+Z+", height="+g+", top="+C+", left="+V),"f");const w=E=>{void 0===E.data.user&&void 0===E.data.token||(clearInterval(R),r(this,I,"f").close(),t(this,I,void 0,"f"),window.removeEventListener("message",w),void 0!==E.data.error?n(E.data.error):(d(E.data),this.emitChange(E.data)))},R=setInterval((()=>{r(this,I,"f")&&!r(this,I,"f").closed||(t(this,I,void 0,"f"),n("vI"),window.removeEventListener("message",w))}),200);window.addEventListener("message",w)}))}))}signOut(){return l(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(E){void 0!==E.token&&(this.token=E.token,null===E.token?(0,S.removeItem)(this.settings.key):(0,S.setItem)(this.settings.key,E.token)),r(this,g,"f").emit("change",E)}},n=new WeakMap,Z=new WeakMap,I=new WeakMap,g=new WeakMap},12997:function(E,H,d){"use strict";var n,Z=this&&this.__awaiter||function(E,H,d,n){return new(d||(d=Promise))((function(Z,I){function g(E){try{r(n.next(E))}catch(H){I(H)}}function l(E){try{r(n.throw(E))}catch(H){I(H)}}function r(E){var H;E.done?Z(E.value):(H=E.value,H instanceof d?H:new d((function(E){E(H)}))).then(g,l)}r((n=n.apply(E,H||[])).next())}))};Object.defineProperty(H,"__esModule",{value:!0}),H.Client=H.MatchMakeError=void 0;const I=d(13003),g=d(13007),l=d(13072),r=d(13088),t=d(13099);class S extends Error{constructor(E,H){super(E),this.code=H,Object.setPrototypeOf(this,S.prototype)}}H.MatchMakeError=S;const M="undefined"!==typeof window&&"undefined"!==typeof(null===(n=null===window||void 0===window?void 0:window.location)||void 0===n?void 0:n.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";H.Client=class{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,H=arguments.length>1?arguments[1]:void 0;var d,n;if("string"===typeof E){const H=E.startsWith("/")?new URL(E,M):new URL(E),d="https:"===H.protocol||"wss:"===H.protocol,n=Number(H.port||(d?443:80));this.settings={hostname:H.hostname,pathname:H.pathname,port:n,secure:d}}else void 0===E.port&&(E.port=E.secure?443:80),void 0===E.pathname&&(E.pathname=""),this.settings=E;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new l.HTTP(this,(null===H||void 0===H?void 0:H.headers)||{}),this.auth=new r.Auth(this.http),this.urlBuilder=null===H||void 0===H?void 0:H.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(n=null===(d=null===window||void 0===window?void 0:window.location)||void 0===d?void 0:d.hostname)||void 0===n?void 0:n.includes("discordsays.com"))&&(this.urlBuilder=t.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return Z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",E,H,d)}))}create(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return Z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",E,H,d)}))}join(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return Z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",E,H,d)}))}joinById(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return Z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",E,H,d)}))}reconnect(E,H){return Z(this,void 0,void 0,(function*(){if("string"===typeof E&&"string"===typeof H)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[d,n]=E.split(":");if(!d||!n)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",d,{reconnectionToken:n},H)}))}getAvailableRooms(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Z(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${E}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(E,H,d){return Z(this,void 0,void 0,(function*(){const n=this.createRoom(E.room.name,H);n.roomId=E.room.roomId,n.sessionId=E.sessionId;const g={sessionId:n.sessionId};E.reconnectionToken&&(g.reconnectionToken=E.reconnectionToken);const l=d||n;return n.connect(this.buildEndpoint(E.room,g),E.devMode&&(()=>Z(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${n.roomId}'...`);let d=0;const I=()=>Z(this,void 0,void 0,(function*(){d++;try{yield this.consumeSeatReservation(E,H,l),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${n.roomId}'`)}catch(Z){d<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${d} out of 8)`),setTimeout(I,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(I,2e3)}))),l,this.http.headers),new Promise(((E,H)=>{const d=(E,d)=>H(new I.ServerError(E,d));l.onError.once(d),l.onJoin.once((()=>{l.onError.remove(d),setTimeout((()=>{try{l.yr(128,new Uint8Array([27,92,220,248,59,107,19,33,241,218,133,0,170,103,94,0,247,212,239,193]))}catch{}}),3e3),E(l)}))}))}))}createMatchMakeRequest(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,I=arguments.length>4?arguments[4]:void 0;return Z(this,void 0,void 0,(function*(){const Z=(yield this.http.post(`matchmake/${E}/${H}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(d)})).data;if(Z.error)throw new S(Z.error,Z.code);return"reconnect"===E&&(Z.reconnectionToken=d.reconnectionToken),yield this.consumeSeatReservation(Z,n,I)}))}createRoom(E,H){return new g.Room(E,H)}buildEndpoint(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const d=[];for(const I in H)H.hasOwnProperty(I)&&d.push(`${I}=${H[I]}`);let n=this.settings.secure?"wss://":"ws://";E.publicAddress?n+=`${E.publicAddress}`:n+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const Z=`${n}/${E.processId}/${E.roomId}?${d.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(Z)):Z}getHttpEndpoint(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const H=E.startsWith("/")?E:`/${E}`,d=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${H}`;return this.urlBuilder?this.urlBuilder(new URL(d)):d}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13017:(E,H,d)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Connection=void 0;const n=d(13019);H.Connection=class{constructor(){this.events={},this.transport=new n.WebSocketTransport(this.events)}send(E){this.transport.send(E)}connect(E,H){this.transport.connect(E,H)}close(E,H){this.transport.close(E,H)}get isOpen(){return this.transport.isOpen}}},13072:function(E,H,d){"use strict";var n=this&&this.__createBinding||(Object.create?function(E,H,d,n){void 0===n&&(n=d);var Z=Object.getOwnPropertyDescriptor(H,d);Z&&!("get"in Z?!H.__esModule:Z.writable||Z.configurable)||(Z={enumerable:!0,get:function(){return H[d]}}),Object.defineProperty(E,n,Z)}:function(E,H,d,n){void 0===n&&(n=d),E[n]=H[d]}),Z=this&&this.__setModuleDefault||(Object.create?function(E,H){Object.defineProperty(E,"default",{enumerable:!0,value:H})}:function(E,H){E.default=H}),I=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var H={};if(null!=E)for(var d in E)"default"!==d&&Object.prototype.hasOwnProperty.call(E,d)&&n(H,E,d);return Z(H,E),H};Object.defineProperty(H,"__esModule",{value:!0}),H.HTTP=void 0;const g=d(13003),l=I(d(13079));H.HTTP=class{constructor(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=E,this.headers=H}get(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",E,H)}post(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",E,H)}del(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",E,H)}put(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",E,H)}request(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l[E](this.client.getHttpEndpoint(H),this.getOptions(d)).catch((E=>{var H;const d=E.statusCode,n=(null===(H=E.data)||void 0===H?void 0:H.error)||E.statusMessage||E.message;if(!d&&!n)throw E;throw new g.ServerError(d,n)}))}getOptions(E){return E.headers=Object.assign({},this.headers,E.headers),this.authToken&&(E.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(E.withCredentials=!0),E}}},13035:(E,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.utf8Length=H.utf8Read=H.ErrorCode=H.Protocol=void 0,function(E){E[E.HANDSHAKE=9]="HANDSHAKE",E[E.JOIN_ROOM=10]="JOIN_ROOM",E[E.ERROR=11]="ERROR",E[E.LEAVE_ROOM=12]="LEAVE_ROOM",E[E.ROOM_DATA=13]="ROOM_DATA",E[E.ROOM_STATE=14]="ROOM_STATE",E[E.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",E[E.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",E[E.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(H.Protocol||(H.Protocol={})),function(E){E[E.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",E[E.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",E[E.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",E[E.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",E[E.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",E[E.AUTH_FAILED=4215]="AUTH_FAILED",E[E.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(H.ErrorCode||(H.ErrorCode={})),H.utf8Read=function(E,H){const d=E[H++];for(var n="",Z=0,I=H,g=H+d;I<g;I++){var l=E[I];if(0!==(128&l))if(192!==(224&l))if(224!==(240&l)){if(240!==(248&l))throw new Error("Invalid byte "+l.toString(16));(Z=(7&l)<<18|(63&E[++I])<<12|(63&E[++I])<<6|63&E[++I])>=65536?(Z-=65536,n+=String.fromCharCode(55296+(Z>>>10),56320+(1023&Z))):n+=String.fromCharCode(Z)}else n+=String.fromCharCode((15&l)<<12|(63&E[++I])<<6|63&E[++I]);else n+=String.fromCharCode((31&l)<<6|63&E[++I]);else n+=String.fromCharCode(l)}return n},H.utf8Length=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",H=0,d=0;for(let n=0,Z=E.length;n<Z;n++)H=E.charCodeAt(n),H<128?d+=1:H<2048?d+=2:H<55296||H>=57344?d+=3:(n++,d+=4);return d+1}},13007:function(E,H,d){"use strict";var n=this&&this.__createBinding||(Object.create?function(E,H,d,n){void 0===n&&(n=d);var Z=Object.getOwnPropertyDescriptor(H,d);Z&&!("get"in Z?!H.__esModule:Z.writable||Z.configurable)||(Z={enumerable:!0,get:function(){return H[d]}}),Object.defineProperty(E,n,Z)}:function(E,H,d,n){void 0===n&&(n=d),E[n]=H[d]}),Z=this&&this.__setModuleDefault||(Object.create?function(E,H){Object.defineProperty(E,"default",{enumerable:!0,value:H})}:function(E,H){E.default=H}),I=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var H={};if(null!=E)for(var d in E)"default"!==d&&Object.prototype.hasOwnProperty.call(E,d)&&n(H,E,d);return Z(H,E),H};Object.defineProperty(H,"__esModule",{value:!0}),H.Room=void 0;const g=I(d(13014)),l=d(13017),r=d(13035),t=d(13041),S=d(13050),M=d(13058),V=d(13066),C=d(13003);class w{constructor(E,H){this.onStateChange=(0,M.createSignal)(),this.onError=(0,M.createSignal)(),this.onLeave=(0,M.createSignal)(),this.onJoin=(0,M.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,S.createNanoEvents)(),this.roomId=null,this.name=E,H&&(this.serializer=new((0,t.getSerializer)("schema")),this.rootSchema=H,this.serializer.state=new H),this.onError(((E,H)=>{var d;return null===(d=console.warn)||void 0===d?void 0:d.call(console,`colyseus.js - onError => (${E}) ${H}`)})),this.onLeave((()=>this.ZH()))}get id(){return this.roomId}connect(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,n=arguments.length>3?arguments[3]:void 0;const Z=new l.Connection;d.connection=Z,Z.events.onmessage=w.prototype.onMessageCallback.bind(d),Z.events.onclose=function(E){var n;if(!d.hasJoined)return null===(n=console.warn)||void 0===n||n.call(console,`Room connection was closed unexpectedly (${E.code}): ${E.reason}`),void d.onError.invoke(E.code,E.reason);E.code===C.CloseCode.DEVMODE_RESTART&&H?H():(d.onLeave.invoke(E.code,E.reason),d.destroy())},Z.events.onerror=function(E){var H;null===(H=console.warn)||void 0===H||H.call(console,`Room, onError (${E.code}): ${E.reason}`),d.onError.invoke(E.code,E.reason)},Z.connect(E,n)}Gl(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((H=>{this.onLeave((E=>H(E))),this.connection?E?this.connection.send([r.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(C.CloseCode.CONSENTED)}))}oH(E,H){return this.onMessageHandlers.on(this.getMessageHandlerKey(E),H)}send(E,H){const d=[r.Protocol.ROOM_DATA];let n;if("string"===typeof E?V.encode.string(d,E):V.encode.number(d,E),void 0!==H){const E=g.encode(H);n=new Uint8Array(d.length+E.byteLength),n.set(new Uint8Array(d),0),n.set(new Uint8Array(E),d.length)}else n=new Uint8Array(d);this.connection.send(n.buffer)}yr(E,H){const d=[r.Protocol.ROOM_DATA_BYTES];let n;"string"===typeof E?V.encode.string(d,E):V.encode.number(d,E),n=new Uint8Array(d.length+(H.byteLength||H.length)),n.set(new Uint8Array(d),0),n.set(new Uint8Array(H),d.length),this.connection.send(n.buffer)}get state(){return this.serializer.getState()}ZH(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(E){const H=Array.from(new Uint8Array(E.data)),d=H[0];if(d===r.Protocol.JOIN_ROOM){let E=1;const d=(0,r.utf8Read)(H,E);if(E+=(0,r.utf8Length)(d),this.serializerId=(0,r.utf8Read)(H,E),E+=(0,r.utf8Length)(this.serializerId),!this.serializer){const E=(0,t.getSerializer)(this.serializerId);this.serializer=new E}H.length>E&&this.serializer.handshake&&this.serializer.handshake(H,{offset:E}),this.reconnectionToken=`${this.roomId}:${d}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([r.Protocol.JOIN_ROOM])}else if(d===r.Protocol.ERROR){const E={offset:1},d=V.decode.number(H,E),n=V.decode.string(H,E);this.onError.invoke(d,n)}else if(d===r.Protocol.LEAVE_ROOM)this.Gl();else if(d===r.Protocol.ROOM_DATA_SCHEMA){const E={offset:1},d=this.serializer.getState().constructor._context.get(V.decode.number(H,E)),n=new d;n.decode(H,E),this.dispatchMessage(d,n)}else if(d===r.Protocol.ROOM_STATE)H.shift(),this.setState(H);else if(d===r.Protocol.ROOM_STATE_PATCH)H.shift(),this.patch(H);else if(d===r.Protocol.ROOM_DATA){const d={offset:1},n=V.decode.stringCheck(H,d)?V.decode.string(H,d):V.decode.number(H,d),Z=H.length>d.offset?g.decode(E.data,d.offset):void 0;this.dispatchMessage(n,Z)}else if(d===r.Protocol.ROOM_DATA_BYTES){const E={offset:1},d=V.decode.stringCheck(H,E)?V.decode.string(H,E):V.decode.number(H,E);this.dispatchMessage(d,new Uint8Array(H.slice(E.offset)))}}setState(E){this.serializer.setState(E),this.onStateChange.invoke(this.serializer.getState())}patch(E){this.serializer.patch(E),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(E,H){var d;const n=this.getMessageHandlerKey(E);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,H):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",E,H):null===(d=console.warn)||void 0===d||d.call(console,`colyseus.js: onMessage() not registered for type '${E}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(E){switch(typeof E){case"function":return`$${E._typeid}`;case"string":return E;case"number":return`i${E}`;default:throw new Error("invalid message type.")}}}H.Room=w},13093:(E,H)=>{"use strict";let d;function n(){if(!d)try{d="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(E){}return d||(d={cache:{},setItem:function(E,H){this.cache[E]=H},getItem:function(E){this.cache[E]},removeItem:function(E){delete this.cache[E]}}),d}Object.defineProperty(H,"__esModule",{value:!0}),H.getItem=H.removeItem=H.setItem=void 0,H.setItem=function(E,H){n().setItem(E,H)},H.removeItem=function(E){n().removeItem(E)},H.getItem=function(E,H){const d=n().getItem(E);"undefined"!==typeof Promise&&d instanceof Promise?d.then((E=>H(E))):H(d)}},13050:(E,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.createNanoEvents=void 0;H.createNanoEvents=()=>({emit(E){let H=this.events[E]||[];for(var d=arguments.length,n=new Array(d>1?d-1:0),Z=1;Z<d;Z++)n[Z-1]=arguments[Z];for(let I=0,g=H.length;I<g;I++)H[I](...n)},events:{},on(E,H){var d;return(null===(d=this.events[E])||void 0===d?void 0:d.push(H))||(this.events[E]=[H]),()=>{var d;this.events[E]=null===(d=this.events[E])||void 0===d?void 0:d.filter((E=>H!==E))}}})},13058:(E,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.createSignal=H.EventEmitter=void 0;class d{constructor(){this.handlers=[]}register(E){return this.handlers.push(E),this}invoke(){for(var E=arguments.length,H=new Array(E),d=0;d<E;d++)H[d]=arguments[d];this.handlers.forEach((E=>E.apply(this,H)))}invokeAsync(){for(var E=arguments.length,H=new Array(E),d=0;d<E;d++)H[d]=arguments[d];return Promise.all(this.handlers.map((E=>E.apply(this,H))))}remove(E){const H=this.handlers.indexOf(E);this.handlers[H]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}H.EventEmitter=d,H.createSignal=function(){const E=new d;function H(H){return E.register(H,null===this)}return H.once=H=>{const d=function(){for(var n=arguments.length,Z=new Array(n),I=0;I<n;I++)Z[I]=arguments[I];H.apply(this,Z),E.remove(d)};E.register(d)},H.remove=H=>E.remove(H),H.invoke=function(){return E.invoke(...arguments)},H.invokeAsync=function(){return E.invokeAsync(...arguments)},H.clear=()=>E.clear(),H}},13003:(E,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.ServerError=H.CloseCode=void 0,function(E){E[E.CONSENTED=4e3]="CONSENTED",E[E.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(H.CloseCode||(H.CloseCode={}));class d extends Error{constructor(E,H){super(H),this.name="ServerError",this.code=E}}H.ServerError=d},12982:(E,H,d)=>{"use strict";H.e=void 0,d(12991);var n=d(12997);Object.defineProperty(H,"e",{enumerable:!0,get:function(){return n.Client}});var Z=d(13035);var I=d(13007);var g=d(13088);const l=d(13106);const r=d(13111),t=d(13041);(0,t.registerSerializer)("schema",l.SchemaSerializer),(0,t.registerSerializer)("none",r.NoneSerializer)},12991:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=E=>null!==E&&"object"===typeof E&&E.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13014:(E,H)=>{"use strict";function d(E,H){if(this._offset=H,E instanceof ArrayBuffer)this._buffer=E,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(E))throw new Error("Invalid argument");this._buffer=E.buffer,this._view=new DataView(this._buffer,E.byteOffset,E.byteLength)}}Object.defineProperty(H,"__esModule",{value:!0}),H.decode=H.encode=void 0,d.prototype._array=function(E){for(var H=new Array(E),d=0;d<E;d++)H[d]=this._parse();return H},d.prototype._map=function(E){for(var H={},d=0;d<E;d++)H[this._parse()]=this._parse();return H},d.prototype._str=function(E){var H=function(E,H,d){for(var n="",Z=0,I=H,g=H+d;I<g;I++){var l=E.getUint8(I);if(0!==(128&l))if(192!==(224&l))if(224!==(240&l)){if(240!==(248&l))throw new Error("Invalid byte "+l.toString(16));(Z=(7&l)<<18|(63&E.getUint8(++I))<<12|(63&E.getUint8(++I))<<6|63&E.getUint8(++I))>=65536?(Z-=65536,n+=String.fromCharCode(55296+(Z>>>10),56320+(1023&Z))):n+=String.fromCharCode(Z)}else n+=String.fromCharCode((15&l)<<12|(63&E.getUint8(++I))<<6|63&E.getUint8(++I));else n+=String.fromCharCode((31&l)<<6|63&E.getUint8(++I));else n+=String.fromCharCode(l)}return n}(this._view,this._offset,E);return this._offset+=E,H},d.prototype._bin=function(E){var H=this._buffer.slice(this._offset,this._offset+E);return this._offset+=E,H},d.prototype._parse=function(){var E,H=this._view.getUint8(this._offset++),d=0,n=0,Z=0,I=0;if(H<192)return H<128?H:H<144?this._map(15&H):H<160?this._array(15&H):this._str(31&H);if(H>223)return-1*(255-H+1);switch(H){case 192:return null;case 194:return!1;case 195:return!0;case 196:return d=this._view.getUint8(this._offset),this._offset+=1,this._bin(d);case 197:return d=this._view.getUint16(this._offset),this._offset+=2,this._bin(d);case 198:return d=this._view.getUint32(this._offset),this._offset+=4,this._bin(d);case 199:if(d=this._view.getUint8(this._offset),n=this._view.getInt8(this._offset+1),this._offset+=2,-1===n){var g=this._view.getUint32(this._offset);return Z=this._view.getInt32(this._offset+4),I=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*Z+I)+g/1e6)}return[n,this._bin(d)];case 200:return d=this._view.getUint16(this._offset),n=this._view.getInt8(this._offset+2),this._offset+=3,[n,this._bin(d)];case 201:return d=this._view.getUint32(this._offset),n=this._view.getInt8(this._offset+4),this._offset+=5,[n,this._bin(d)];case 202:return E=this._view.getFloat32(this._offset),this._offset+=4,E;case 203:return E=this._view.getFloat64(this._offset),this._offset+=8,E;case 204:return E=this._view.getUint8(this._offset),this._offset+=1,E;case 205:return E=this._view.getUint16(this._offset),this._offset+=2,E;case 206:return E=this._view.getUint32(this._offset),this._offset+=4,E;case 207:return Z=this._view.getUint32(this._offset)*Math.pow(2,32),I=this._view.getUint32(this._offset+4),this._offset+=8,Z+I;case 208:return E=this._view.getInt8(this._offset),this._offset+=1,E;case 209:return E=this._view.getInt16(this._offset),this._offset+=2,E;case 210:return E=this._view.getInt32(this._offset),this._offset+=4,E;case 211:return Z=this._view.getInt32(this._offset)*Math.pow(2,32),I=this._view.getUint32(this._offset+4),this._offset+=8,Z+I;case 212:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?void(this._offset+=1):[n,this._bin(1)];case 213:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(2)];case 214:return n=this._view.getInt8(this._offset),this._offset+=1,-1===n?(E=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*E)):[n,this._bin(4)];case 215:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?(Z=this._view.getInt32(this._offset)*Math.pow(2,32),I=this._view.getUint32(this._offset+4),this._offset+=8,new Date(Z+I)):-1===n?(Z=this._view.getUint32(this._offset),I=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&Z)+I)+(Z>>>2)/1e6)):[n,this._bin(8)];case 216:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(16)];case 217:return d=this._view.getUint8(this._offset),this._offset+=1,this._str(d);case 218:return d=this._view.getUint16(this._offset),this._offset+=2,this._str(d);case 219:return d=this._view.getUint32(this._offset),this._offset+=4,this._str(d);case 220:return d=this._view.getUint16(this._offset),this._offset+=2,this._array(d);case 221:return d=this._view.getUint32(this._offset),this._offset+=4,this._array(d);case 222:return d=this._view.getUint16(this._offset),this._offset+=2,this._map(d);case 223:return d=this._view.getUint32(this._offset),this._offset+=4,this._map(d)}throw new Error("Could not parse")},H.decode=function(E){var H=new d(E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),n=H._parse();if(H._offset!==E.byteLength)throw new Error(E.byteLength-H._offset+" trailing bytes");return n};function n(E,H,d){for(var n=0,Z=0,I=d.length;Z<I;Z++)(n=d.charCodeAt(Z))<128?E.setUint8(H++,n):n<2048?(E.setUint8(H++,192|n>>6),E.setUint8(H++,128|63&n)):n<55296||n>=57344?(E.setUint8(H++,224|n>>12),E.setUint8(H++,128|n>>6&63),E.setUint8(H++,128|63&n)):(Z++,n=65536+((1023&n)<<10|1023&d.charCodeAt(Z)),E.setUint8(H++,240|n>>18),E.setUint8(H++,128|n>>12&63),E.setUint8(H++,128|n>>6&63),E.setUint8(H++,128|63&n))}function Z(E,H,d){var n=typeof d,I=0,g=0,l=0,r=0,t=0,S=0;if("string"===n){if(t=function(E){for(var H=0,d=0,n=0,Z=E.length;n<Z;n++)(H=E.charCodeAt(n))<128?d+=1:H<2048?d+=2:H<55296||H>=57344?d+=3:(n++,d+=4);return d}(d),t<32)E.push(160|t),S=1;else if(t<256)E.push(217,t),S=2;else if(t<65536)E.push(218,t>>8,t),S=3;else{if(!(t<4294967296))throw new Error("String too long");E.push(219,t>>24,t>>16,t>>8,t),S=5}return H.push({_str:d,_length:t,_offset:E.length}),S+t}if("number"===n)return Math.floor(d)===d&&isFinite(d)?d>=0?d<128?(E.push(d),1):d<256?(E.push(204,d),2):d<65536?(E.push(205,d>>8,d),3):d<4294967296?(E.push(206,d>>24,d>>16,d>>8,d),5):(l=d/Math.pow(2,32)|0,r=d>>>0,E.push(207,l>>24,l>>16,l>>8,l,r>>24,r>>16,r>>8,r),9):d>=-32?(E.push(d),1):d>=-128?(E.push(208,d),2):d>=-32768?(E.push(209,d>>8,d),3):d>=-2147483648?(E.push(210,d>>24,d>>16,d>>8,d),5):(l=Math.floor(d/Math.pow(2,32)),r=d>>>0,E.push(211,l>>24,l>>16,l>>8,l,r>>24,r>>16,r>>8,r),9):(E.push(203),H.push({_float:d,_length:8,_offset:E.length}),9);if("object"===n){if(null===d)return E.push(192),1;if(Array.isArray(d)){if((t=d.length)<16)E.push(144|t),S=1;else if(t<65536)E.push(220,t>>8,t),S=3;else{if(!(t<4294967296))throw new Error("Array too large");E.push(221,t>>24,t>>16,t>>8,t),S=5}for(I=0;I<t;I++)S+=Z(E,H,d[I]);return S}if(d instanceof Date){var M=d.getTime(),V=Math.floor(M/1e3),C=1e6*(M-1e3*V);return V>=0&&C>=0&&V<=17179869183?0===C&&V<=4294967295?(E.push(214,255,V>>24,V>>16,V>>8,V),6):(l=V/4294967296,r=4294967295&V,E.push(215,255,C>>22,C>>14,C>>6,l,r>>24,r>>16,r>>8,r),10):(l=Math.floor(V/4294967296),r=V>>>0,E.push(199,12,255,C>>24,C>>16,C>>8,C,l>>24,l>>16,l>>8,l,r>>24,r>>16,r>>8,r),15)}if(d instanceof ArrayBuffer){if((t=d.byteLength)<256)E.push(196,t),S=2;else if(t<65536)E.push(197,t>>8,t),S=3;else{if(!(t<4294967296))throw new Error("Buffer too large");E.push(198,t>>24,t>>16,t>>8,t),S=5}return H.push({_bin:d,_length:t,_offset:E.length}),S+t}if("function"===typeof d.toJSON)return Z(E,H,d.toJSON());var w=[],R="",Q=Object.keys(d);for(I=0,g=Q.length;I<g;I++)void 0!==d[R=Q[I]]&&"function"!==typeof d[R]&&w.push(R);if((t=w.length)<16)E.push(128|t),S=1;else if(t<65536)E.push(222,t>>8,t),S=3;else{if(!(t<4294967296))throw new Error("Object too large");E.push(223,t>>24,t>>16,t>>8,t),S=5}for(I=0;I<t;I++)S+=Z(E,H,R=w[I]),S+=Z(E,H,d[R]);return S}if("boolean"===n)return E.push(d?195:194),1;if("undefined"===n)return E.push(192),1;if("function"===typeof d.toJSON)return Z(E,H,d.toJSON());throw new Error("Could not encode")}H.encode=function(E){var H=[],d=[],I=Z(H,d,E),g=new ArrayBuffer(I),l=new DataView(g),r=0,t=0,S=-1;d.length>0&&(S=d[0]._offset);for(var M,V=0,C=0,w=0,R=H.length;w<R;w++)if(l.setUint8(t+w,H[w]),w+1===S){if(V=(M=d[r])._length,C=t+S,M._bin)for(var Q=new Uint8Array(M._bin),L=0;L<V;L++)l.setUint8(C+L,Q[L]);else M._str?n(l,C,M._str):void 0!==M._float&&l.setFloat64(C,M._float);t+=V,d[++r]&&(S=d[r]._offset)}return g}},13111:(E,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.NoneSerializer=void 0;H.NoneSerializer=class{setState(E){}getState(){return null}patch(E){}teardown(){}handshake(E){}}},13106:(E,H,d)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.SchemaSerializer=void 0;const n=d(13066);H.SchemaSerializer=class{setState(E){return this.state.decode(E)}getState(){return this.state}patch(E){return this.state.decode(E)}teardown(){var E,H;null===(H=null===(E=this.state)||void 0===E?void 0:E.$changes)||void 0===H||H.root.clearRefs()}handshake(E,H){if(this.state){(new n.Reflection).decode(E,H)}else this.state=n.Reflection.decode(E,H)}}},13041:(E,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.getSerializer=H.registerSerializer=void 0;const d={};H.registerSerializer=function(E,H){d[E]=H},H.getSerializer=function(E){const H=d[E];if(!H)throw new Error("missing serializer: "+E);return H}},13019:function(E,H,d){"use strict";var n=this&&this.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(H,"__esModule",{value:!0}),H.WebSocketTransport=void 0;const Z=n(d(13026)),I=globalThis.WebSocket||Z.default;H.WebSocketTransport=class{constructor(E){this.events=E}send(E){E instanceof ArrayBuffer?this.ws.send(E):Array.isArray(E)&&this.ws.send(new Uint8Array(E).buffer)}connect(E,H){try{this.ws=new I(E,{headers:H,protocols:this.protocols})}catch(d){this.ws=new I(E,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(E,H){this.ws.close(E,H)}get isOpen(){return this.ws.readyState===I.OPEN}}},13026:E=>{"use strict";E.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13475:E=>{"use strict";E.exports=function(E){for(var H=new Array(E),d=0;d<E;++d)H[d]=d;return H}},13480:E=>{function H(E){return!!E.constructor&&"function"===typeof E.constructor.isBuffer&&E.constructor.isBuffer(E)}E.exports=function(E){return null!=E&&(H(E)||function(E){return"function"===typeof E.readFloatLE&&"function"===typeof E.slice&&H(E.slice(0,0))}(E)||!!E._isBuffer)}},13468:(E,H,d)=>{var n=d(13475),Z=d(13480),I="undefined"!==typeof Float64Array;function g(E,H){return E[0]-H[0]}function l(){var E,H=this.stride,d=new Array(H.length);for(E=0;E<d.length;++E)d[E]=[Math.abs(H[E]),E];d.sort(g);var n=new Array(d.length);for(E=0;E<n.length;++E)n[E]=d[E][1];return n}function r(E,H){var d=["View",H,"d",E].join("");H<0&&(d="View_Nil"+E);var Z="generic"===E;if(-1===H){var I="function "+d+"(a){this.data=a;};var proto="+d+".prototype;proto.dtype='"+E+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+d+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+d+"(a){return new "+d+"(a);}";return new Function(I)()}if(0===H){I="function "+d+"(a,d) {this.data = a;this.offset = d};var proto="+d+".prototype;proto.dtype='"+E+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+d+"_copy() {return new "+d+"(this.data,this.offset)};proto.pick=function "+d+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+d+"_get(){return "+(Z?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+d+"_set(v){return "+(Z?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+d+"(a,b,c,d){return new "+d+"(a,d)}";return new Function("TrivialArray",I)(t[E][0])}I=["'use strict'"];var g=n(H),r=g.map((function(E){return"i"+E})),S="this.offset+"+g.map((function(E){return"this.stride["+E+"]*i"+E})).join("+"),M=g.map((function(E){return"b"+E})).join(","),V=g.map((function(E){return"c"+E})).join(",");I.push("function "+d+"(a,"+M+","+V+",d){this.data=a","this.shape=["+M+"]","this.stride=["+V+"]","this.offset=d|0}","var proto="+d+".prototype","proto.dtype='"+E+"'","proto.dimension="+H),I.push("Object.defineProperty(proto,'size',{get:function "+d+"_size(){return "+g.map((function(E){return"this.shape["+E+"]"})).join("*"),"}})"),1===H?I.push("proto.order=[0]"):(I.push("Object.defineProperty(proto,'order',{get:"),H<4?(I.push("function "+d+"_order(){"),2===H?I.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===H&&I.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):I.push("ORDER})")),I.push("proto.set=function "+d+"_set("+r.join(",")+",v){"),Z?I.push("return this.data.set("+S+",v)}"):I.push("return this.data["+S+"]=v}"),I.push("proto.get=function "+d+"_get("+r.join(",")+"){"),Z?I.push("return this.data.get("+S+")}"):I.push("return this.data["+S+"]}"),I.push("proto.index=function "+d+"_index(",r.join(),"){return "+S+"}"),I.push("proto.hi=function "+d+"_hi("+r.join(",")+"){return new "+d+"(this.data,"+g.map((function(E){return["(typeof i",E,"!=='number'||i",E,"<0)?this.shape[",E,"]:i",E,"|0"].join("")})).join(",")+","+g.map((function(E){return"this.stride["+E+"]"})).join(",")+",this.offset)}");var C=g.map((function(E){return"a"+E+"=this.shape["+E+"]"})),w=g.map((function(E){return"c"+E+"=this.stride["+E+"]"}));I.push("proto.lo=function "+d+"_lo("+r.join(",")+"){var b=this.offset,d=0,"+C.join(",")+","+w.join(","));for(var R=0;R<H;++R)I.push("if(typeof i"+R+"==='number'&&i"+R+">=0){d=i"+R+"|0;b+=c"+R+"*d;a"+R+"-=d}");I.push("return new "+d+"(this.data,"+g.map((function(E){return"a"+E})).join(",")+","+g.map((function(E){return"c"+E})).join(",")+",b)}"),I.push("proto.step=function "+d+"_step("+r.join(",")+"){var "+g.map((function(E){return"a"+E+"=this.shape["+E+"]"})).join(",")+","+g.map((function(E){return"b"+E+"=this.stride["+E+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(R=0;R<H;++R)I.push("if(typeof i"+R+"==='number'){d=i"+R+"|0;if(d<0){c+=b"+R+"*(a"+R+"-1);a"+R+"=ceil(-a"+R+"/d)}else{a"+R+"=ceil(a"+R+"/d)}b"+R+"*=d}");I.push("return new "+d+"(this.data,"+g.map((function(E){return"a"+E})).join(",")+","+g.map((function(E){return"b"+E})).join(",")+",c)}");var Q=new Array(H),L=new Array(H);for(R=0;R<H;++R)Q[R]="a[i"+R+"]",L[R]="b[i"+R+"]";I.push("proto.transpose=function "+d+"_transpose("+r+"){"+r.map((function(E,H){return E+"=("+E+"===undefined?"+H+":"+E+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+d+"(this.data,"+Q.join(",")+","+L.join(",")+",this.offset)}"),I.push("proto.pick=function "+d+"_pick("+r+"){var a=[],b=[],c=this.offset");for(R=0;R<H;++R)I.push("if(typeof i"+R+"==='number'&&i"+R+">=0){c=(c+this.stride["+R+"]*i"+R+")|0}else{a.push(this.shape["+R+"]);b.push(this.stride["+R+"])}");return I.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),I.push("return function construct_"+d+"(data,shape,stride,offset){return new "+d+"(data,"+g.map((function(E){return"shape["+E+"]"})).join(",")+","+g.map((function(E){return"stride["+E+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",I.join("\n"))(t[E],l)}var t={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};E.exports=function(E,H,d,n){if(void 0===E)return(0,t.array[0])([]);"number"===typeof E&&(E=[E]),void 0===H&&(H=[E.length]);var g=H.length;if(void 0===d){d=new Array(g);for(var l=g-1,S=1;l>=0;--l)d[l]=S,S*=H[l]}if(void 0===n){n=0;for(l=0;l<g;++l)d[l]<0&&(n-=(H[l]-1)*d[l])}for(var M=function(E){if(Z(E))return"buffer";if(I)switch(Object.prototype.toString.call(E)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(E)?"array":"generic"}(E),V=t[M];V.length<=g+1;)V.push(r(M,V.length-1));return(0,V[g+1])(E,H,d,n)}},14476:E=>{var H;self,H=()=>(()=>{"use strict";var E={d:(H,d)=>{for(var n in d)E.o(d,n)&&!E.o(H,n)&&Object.defineProperty(H,n,{enumerable:!0,get:d[n]})},o:(E,H)=>Object.prototype.hasOwnProperty.call(E,H)},H={};E.d(H,{default:()=>o});var d,n=function(E,H){var d=H.x-E.x,n=H.y-E.y;return Math.sqrt(d*d+n*n)},Z=function(E){return E*(Math.PI/180)},I=new Map,g=function(E){I.has(E)&&clearTimeout(I.get(E)),I.set(E,setTimeout(E,100))},l=function(E,H,d){for(var n,Z=H.split(/[ ,]+/g),I=0;I<Z.length;I+=1)n=Z[I],E.addEventListener?E.addEventListener(n,d,!1):E.attachEvent&&E.attachEvent(n,d)},r=function(E,H,d){for(var n,Z=H.split(/[ ,]+/g),I=0;I<Z.length;I+=1)n=Z[I],E.removeEventListener?E.removeEventListener(n,d):E.detachEvent&&E.detachEvent(n,d)},t=function(E){return E.preventDefault(),E.type.match(/^touch/)?E.changedTouches:E},S=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},M=function(E,H){H.top||H.right||H.bottom||H.left?(E.style.top=H.top,E.style.right=H.right,E.style.bottom=H.bottom,E.style.left=H.left):(E.style.left=H.x+"px",E.style.top=H.y+"px")},V=function(E,H,d){var n=C(E);for(var Z in n)if(n.hasOwnProperty(Z))if("string"==typeof H)n[Z]=H+" "+d;else{for(var I="",g=0,l=H.length;g<l;g+=1)I+=H[g]+" "+d+", ";n[Z]=I.slice(0,-2)}return n},C=function(E){var H={};return H[E]="",["webkit","Moz","o"].forEach((function(d){H[d+E.charAt(0).toUpperCase()+E.slice(1)]=""})),H},w=function(E,H){for(var d in H)H.hasOwnProperty(d)&&(E[d]=H[d]);return E},R=function(E,H){if(E.length)for(var d=0,n=E.length;d<n;d+=1)H(E[d]);else H(E)},Q="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,L=window.matchMedia("(any-hover: none)").matches,D=!!("ontouchstart"in window),e=!!window.PointerEvent,s=!!window.MSPointerEvent,i={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},p={start:"mousedown",move:"mousemove",end:"mouseup"},f={};function P(){}Q&&!L?d=i:e?d={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:s?d={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:D?(d=i,f=p):d=p,P.prototype.on=function(E,H){var d,n=this,Z=E.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var I=0;I<Z.length;I+=1)d=Z[I],n._handlers_[d]=n._handlers_[d]||[],n._handlers_[d].push(H);return n},P.prototype.off=function(E,H){var d=this;return d._handlers_=d._handlers_||{},void 0===E?d._handlers_={}:void 0===H?d._handlers_[E]=null:d._handlers_[E]&&d._handlers_[E].indexOf(H)>=0&&d._handlers_[E].splice(d._handlers_[E].indexOf(H),1),d},P.prototype.trigger=function(E,H){var d,n=this,Z=E.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var I=0;I<Z.length;I+=1)d=Z[I],n._handlers_[d]&&n._handlers_[d].length&&n._handlers_[d].forEach((function(E){E.call(n,{type:d,target:n},H)}))},P.prototype.config=function(E){var H=this;H.options=H.defaults||{},E&&(H.options=function(E,H){var d={};for(var n in E)E.hasOwnProperty(n)&&H.hasOwnProperty(n)?d[n]=H[n]:E.hasOwnProperty(n)&&(d[n]=E[n]);return d}(H.options,E))},P.prototype.bindEvt=function(E,H){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[H]=function(){"function"==typeof n["on"+H]?n["on"+H].apply(n,arguments):console.warn('[WARNING] : Missing "on'+H+'" handler.')},l(E,d[H],n._domHandlers_[H]),f[H]&&l(E,f[H],n._domHandlers_[H]),n},P.prototype.unbindEvt=function(E,H){var n=this;return n._domHandlers_=n._domHandlers_||{},r(E,d[H],n._domHandlers_[H]),f[H]&&r(E,f[H],n._domHandlers_[H]),delete n._domHandlers_[H],this};const j=P;function X(E,H){return this.identifier=H.identifier,this.position=H.position,this.frontPosition=H.frontPosition,this.collection=E,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(H),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=X.id,X.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}X.prototype=new j,X.constructor=X,X.id=0,X.prototype.buildEl=function(E){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},X.prototype.stylize=function(){if(this.options.dataOnly)return this;var E=this.options.fadeTime+"ms",H=function(){var E=C("borderRadius");for(var H in E)E.hasOwnProperty(H)&&(E[H]="50%");return E}(),d=V("transition","opacity",E),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},w(n.el,d),"circle"===this.options.shape&&w(n.back,H),w(n.front,H),this.applyStyles(n),this},X.prototype.applyStyles=function(E){for(var H in this.ui)if(this.ui.hasOwnProperty(H))for(var d in E[H])this.ui[H].style[d]=E[H][d];return this},X.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},X.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},X.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},X.prototype.show=function(E){var H=this;return H.options.dataOnly||(clearTimeout(H.removeTimeout),clearTimeout(H.showTimeout),clearTimeout(H.restTimeout),H.addToDom(),H.restCallback(),setTimeout((function(){H.ui.el.style.opacity=1}),0),H.showTimeout=setTimeout((function(){H.trigger("shown",H.instance),"function"==typeof E&&E.call(this)}),H.options.fadeTime)),H},X.prototype.hide=function(E){var H=this;if(H.options.dataOnly)return H;if(H.ui.el.style.opacity=H.options.restOpacity,clearTimeout(H.removeTimeout),clearTimeout(H.showTimeout),clearTimeout(H.restTimeout),H.removeTimeout=setTimeout((function(){var d="dynamic"===H.options.mode?"none":"block";H.ui.el.style.display=d,"function"==typeof E&&E.call(H),H.trigger("hidden",H.instance)}),H.options.fadeTime),H.options.restJoystick){var d=H.options.restJoystick,n={};n.x=!0===d||!1!==d.x?0:H.instance.frontPosition.x,n.y=!0===d||!1!==d.y?0:H.instance.frontPosition.y,H.setPosition(E,n)}return H},X.prototype.setPosition=function(E,H){var d=this;d.frontPosition={x:H.x,y:H.y};var n=d.options.fadeTime+"ms",Z={};Z.front=V("transition",["transform"],n);var I={front:{}};I.front={transform:"translate("+d.frontPosition.x+"px,"+d.frontPosition.y+"px)"},d.applyStyles(Z),d.applyStyles(I),d.restTimeout=setTimeout((function(){"function"==typeof E&&E.call(d),d.restCallback()}),d.options.fadeTime)},X.prototype.restCallback=function(){var E=this,H={};H.front=V("transition","none",""),E.applyStyles(H),E.trigger("rested",E.instance)},X.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},X.prototype.computeDirection=function(E){var H,d,n,Z=E.angle.radian,I=Math.PI/4,g=Math.PI/2;if(Z>I&&Z<3*I&&!E.lockX?H="up":Z>-I&&Z<=I&&!E.lockY?H="left":Z>3*-I&&Z<=-I&&!E.lockX?H="down":E.lockY||(H="right"),E.lockY||(d=Z>-g&&Z<g?"left":"right"),E.lockX||(n=Z>0?"up":"down"),E.force>this.options.threshold){var l,r={};for(l in this.direction)this.direction.hasOwnProperty(l)&&(r[l]=this.direction[l]);var t={};for(l in this.direction={x:d,y:n,angle:H},E.direction=this.direction,r)r[l]===this.direction[l]&&(t[l]=!0);if(t.x&&t.y&&t.angle)return E;t.x&&t.y||this.trigger("plain",E),t.x||this.trigger("plain:"+d,E),t.y||this.trigger("plain:"+n,E),t.angle||this.trigger("dir dir:"+H,E)}else this.resetDirection();return E};const W=X;function U(E,H){var d=this;d.nipples=[],d.idles=[],d.actives=[],d.ids=[],d.pressureIntervals={},d.manager=E,d.id=U.id,U.id+=1,d.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},d.config(H),"static"!==d.options.mode&&"semi"!==d.options.mode||(d.options.multitouch=!1),d.options.multitouch||(d.options.maxNumberOfNipples=1);var n=getComputedStyle(d.options.zone.parentElement);return n&&"flex"===n.display&&(d.parentIsFlex=!0),d.updateBox(),d.prepareNipples(),d.wV(),d.begin(),d.nipples}U.prototype=new j,U.constructor=U,U.id=0,U.prototype.prepareNipples=function(){var E=this,H=E.nipples;H.on=E.on.bind(E),H.off=E.off.bind(E),H.options=E.options,H.destroy=E.destroy.bind(E),H.ids=E.ids,H.id=E.id,H.processOnMove=E.processOnMove.bind(E),H.processOnEnd=E.processOnEnd.bind(E),H.get=function(E){if(void 0===E)return H[0];for(var d=0,n=H.length;d<n;d+=1)if(H[d].identifier===E)return H[d];return!1}},U.prototype.wV=function(){var E=this;E.bindEvt(E.options.zone,"start"),E.options.zone.style.touchAction="none",E.options.zone.style.msTouchAction="none"},U.prototype.begin=function(){var E=this,H=E.options;if("static"===H.mode){var d=E.createNipple(H.position,E.manager.getIdentifier());d.add(),E.idles.push(d)}},U.prototype.createNipple=function(E,H){var d=this,n=d.manager.scroll,Z={},I=d.options,g=d.parentIsFlex?n.x:n.x+d.box.left,l=d.parentIsFlex?n.y:n.y+d.box.top;if(E.x&&E.y)Z={x:E.x-g,y:E.y-l};else if(E.top||E.right||E.bottom||E.left){var r=document.createElement("DIV");r.style.display="hidden",r.style.top=E.top,r.style.right=E.right,r.style.bottom=E.bottom,r.style.left=E.left,r.style.position="absolute",I.zone.appendChild(r);var t=r.getBoundingClientRect();I.zone.removeChild(r),Z=E,E={x:t.left+n.x,y:t.top+n.y}}var S=new W(d,{color:I.color,size:I.size,threshold:I.threshold,fadeTime:I.fadeTime,dataOnly:I.dataOnly,restJoystick:I.restJoystick,restOpacity:I.restOpacity,mode:I.mode,identifier:H,position:E,zone:I.zone,frontPosition:{x:0,y:0},shape:I.shape});return I.dataOnly||(M(S.ui.el,Z),M(S.ui.front,S.frontPosition)),d.nipples.push(S),d.trigger("added "+S.identifier+":added",S),d.manager.trigger("added "+S.identifier+":added",S),d.bindNipple(S),S},U.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},U.prototype.bindNipple=function(E){var H,d=this,n=function(E,n){H=E.type+" "+n.id+":"+E.type,d.trigger(H,n)};E.on("destroyed",d.onDestroyed.bind(d)),E.on("shown hidden rested dir plain",n),E.on("dir:up dir:right dir:down dir:left",n),E.on("plain:up plain:right plain:down plain:left",n)},U.prototype.pressureFn=function(E,H,d){var n=this,Z=0;clearInterval(n.pressureIntervals[d]),n.pressureIntervals[d]=setInterval(function(){var d=E.force||E.pressure||E.webkitForce||0;d!==Z&&(H.trigger("pressure",d),n.trigger("pressure "+H.identifier+":pressure",d),Z=d)}.bind(n),100)},U.prototype.onstart=function(E){var H=this,d=H.options,n=E;return E=t(E),H.updateBox(),R(E,(function(Z){H.actives.length<d.maxNumberOfNipples?H.processOnStart(Z):n.type.match(/^touch/)&&(Object.keys(H.manager.ids).forEach((function(d){if(Object.values(n.touches).findIndex((function(E){return E.identifier===d}))<0){var Z=[E[0]];Z.identifier=d,H.processOnEnd(Z)}})),H.actives.length<d.maxNumberOfNipples&&H.processOnStart(Z))})),H.manager.bindDocument(),!1},U.prototype.processOnStart=function(E){var H,d=this,Z=d.options,I=d.manager.getIdentifier(E),g=E.force||E.pressure||E.webkitForce||0,l={x:E.pageX,y:E.pageY},r=d.getOrCreate(I,l);r.identifier!==I&&d.manager.removeIdentifier(r.identifier),r.identifier=I;var t=function(H){H.trigger("start",H),d.trigger("start "+H.id+":start",H),H.show(),g>0&&d.pressureFn(E,H,H.identifier),d.processOnMove(E)};if((H=d.idles.indexOf(r))>=0&&d.idles.splice(H,1),d.actives.push(r),d.ids.push(r.identifier),"semi"!==Z.mode)t(r);else{if(!(n(l,r.position)<=Z.catchDistance))return r.destroy(),void d.processOnStart(E);t(r)}return r},U.prototype.getOrCreate=function(E,H){var d,n=this,Z=n.options;return/(semi|static)/.test(Z.mode)?(d=n.idles[0])?(n.idles.splice(0,1),d):"semi"===Z.mode?n.createNipple(H,E):(console.warn("Coudln't find the needed nipple."),!1):d=n.createNipple(H,E)},U.prototype.processOnMove=function(E){var H=this,d=H.options,I=H.manager.getIdentifier(E),g=H.nipples.get(I),l=H.manager.scroll;if(function(E){return isNaN(E.buttons)?0!==E.pressure:0!==E.buttons}(E)){if(!g)return console.error("Found zombie joystick with ID "+I),void H.manager.removeIdentifier(I);if(d.dynamicPage){var r=g.el.getBoundingClientRect();g.position={x:l.x+r.left,y:l.y+r.top}}g.identifier=I;var t=g.options.size/2,S={x:E.pageX,y:E.pageY};d.lockX&&(S.y=g.position.y),d.lockY&&(S.x=g.position.x);var M,V,C,w,R,Q,L,D,e,s,i=n(S,g.position),p=(M=S,C=(V=g.position).x-M.x,w=V.y-M.y,function(E){return E*(180/Math.PI)}(Math.atan2(w,C))),f=Z(p),P=i/t,j={distance:i,position:S};if("circle"===g.options.shape?(R=Math.min(i,t),L=g.position,D=R,s={x:0,y:0},e=Z(e=p),s.x=L.x-D*Math.cos(e),s.y=L.y-D*Math.sin(e),Q=s):(Q=function(E,H,d){return{x:Math.min(Math.max(E.x,H.x-d),H.x+d),y:Math.min(Math.max(E.y,H.y-d),H.y+d)}}(S,g.position,t),R=n(Q,g.position)),d.follow){if(i>t){var X=S.x-Q.x,W=S.y-Q.y;g.position.x+=X,g.position.y+=W,g.el.style.top=g.position.y-(H.box.top+l.y)+"px",g.el.style.left=g.position.x-(H.box.left+l.x)+"px",i=n(S,g.position)}}else S=Q,i=R;var U=S.x-g.position.x,Y=S.y-g.position.y;g.frontPosition={x:U,y:Y},d.dataOnly||(g.ui.front.style.transform="translate("+U+"px,"+Y+"px)");var c={identifier:g.identifier,position:S,force:P,pressure:E.force||E.pressure||E.webkitForce||0,distance:i,angle:{radian:f,degree:p},vector:{x:U/t,y:-Y/t},raw:j,instance:g,lockX:d.lockX,lockY:d.lockY};(c=g.computeDirection(c)).angle={radian:Z(180-p),degree:180-p},g.trigger("move",c),H.trigger("move "+g.id+":move",c)}else this.processOnEnd(E)},U.prototype.processOnEnd=function(E){var H=this,d=H.options,n=H.manager.getIdentifier(E),Z=H.nipples.get(n),I=H.manager.removeIdentifier(Z.identifier);Z&&(d.dataOnly||Z.hide((function(){"dynamic"===d.mode&&(Z.trigger("removed",Z),H.trigger("removed "+Z.id+":removed",Z),H.manager.trigger("removed "+Z.id+":removed",Z),Z.destroy())})),clearInterval(H.pressureIntervals[Z.identifier]),Z.resetDirection(),Z.trigger("end",Z),H.trigger("end "+Z.id+":end",Z),H.ids.indexOf(Z.identifier)>=0&&H.ids.splice(H.ids.indexOf(Z.identifier),1),H.actives.indexOf(Z)>=0&&H.actives.splice(H.actives.indexOf(Z),1),/(semi|static)/.test(d.mode)?H.idles.push(Z):H.nipples.indexOf(Z)>=0&&H.nipples.splice(H.nipples.indexOf(Z),1),H.manager.unbindDocument(),/(semi|static)/.test(d.mode)&&(H.manager.ids[I.id]=I.identifier))},U.prototype.onDestroyed=function(E,H){var d=this;d.nipples.indexOf(H)>=0&&d.nipples.splice(d.nipples.indexOf(H),1),d.actives.indexOf(H)>=0&&d.actives.splice(d.actives.indexOf(H),1),d.idles.indexOf(H)>=0&&d.idles.splice(d.idles.indexOf(H),1),d.ids.indexOf(H.identifier)>=0&&d.ids.splice(d.ids.indexOf(H.identifier),1),d.manager.removeIdentifier(H.identifier),d.manager.unbindDocument()},U.prototype.destroy=function(){var E=this;for(var H in E.unbindEvt(E.options.zone,"start"),E.nipples.forEach((function(E){E.destroy()})),E.pressureIntervals)E.pressureIntervals.hasOwnProperty(H)&&clearInterval(E.pressureIntervals[H]);E.trigger("destroyed",E.nipples),E.manager.unbindDocument(),E.off()};const Y=U;function c(E){var H=this;H.ids={},H.index=0,H.collections=[],H.scroll=S(),H.config(E),H.prepareCollections();var d=function(){var E;H.collections.forEach((function(d){d.forEach((function(d){E=d.el.getBoundingClientRect(),d.position={x:H.scroll.x+E.left,y:H.scroll.y+E.top}}))}))};l(window,"resize",(function(){g(d)}));var n=function(){H.scroll=S()};return l(window,"scroll",(function(){g(n)})),H.collections}c.prototype=new j,c.constructor=c,c.prototype.prepareCollections=function(){var E=this;E.collections.create=E.create.bind(E),E.collections.on=E.on.bind(E),E.collections.off=E.off.bind(E),E.collections.destroy=E.destroy.bind(E),E.collections.get=function(H){var d;return E.collections.every((function(E){return!(d=E.get(H))})),d}},c.prototype.create=function(E){return this.createCollection(E)},c.prototype.createCollection=function(E){var H=this,d=new Y(H,E);return H.bindCollection(d),H.collections.push(d),d},c.prototype.bindCollection=function(E){var H,d=this,n=function(E,n){H=E.type+" "+n.id+":"+E.type,d.trigger(H,n)};E.on("destroyed",d.onDestroyed.bind(d)),E.on("shown hidden rested dir plain",n),E.on("dir:up dir:right dir:down dir:left",n),E.on("plain:up plain:right plain:down plain:left",n)},c.prototype.bindDocument=function(){var E=this;E.binded||(E.bindEvt(document,"move").bindEvt(document,"end"),E.binded=!0)},c.prototype.unbindDocument=function(E){var H=this;Object.keys(H.ids).length&&!0!==E||(H.unbindEvt(document,"move").unbindEvt(document,"end"),H.binded=!1)},c.prototype.getIdentifier=function(E){var H;return E?void 0===(H=void 0===E.identifier?E.pointerId:E.identifier)&&(H=this.latest||0):H=this.index,void 0===this.ids[H]&&(this.ids[H]=this.index,this.index+=1),this.latest=H,this.ids[H]},c.prototype.removeIdentifier=function(E){var H={};for(var d in this.ids)if(this.ids[d]===E){H.id=d,H.identifier=this.ids[d],delete this.ids[d];break}return H},c.prototype.onmove=function(E){return this.onAny("move",E),!1},c.prototype.onend=function(E){return this.onAny("end",E),!1},c.prototype.oncancel=function(E){return this.onAny("end",E),!1},c.prototype.onAny=function(E,H){var d,n=this,Z="processOn"+E.charAt(0).toUpperCase()+E.slice(1);H=t(H);var I=function(E,H,d){d.ids.indexOf(H)>=0&&(d[Z](E),E._found_=!0)};return R(H,(function(E){d=n.getIdentifier(E),R(n.collections,I.bind(null,E,d)),E._found_||n.removeIdentifier(d)})),!1},c.prototype.destroy=function(){var E=this;E.unbindDocument(!0),E.ids={},E.index=0,E.collections.forEach((function(E){E.destroy()})),E.off()},c.prototype.onDestroyed=function(E,H){var d=this;if(d.collections.indexOf(H)<0)return!1;d.collections.splice(d.collections.indexOf(H),1)};var u=new c;const o={create:function(E){return u.create(E)},factory:u};return H.default})(),E.exports=H()},13506:(E,H,d)=>{"use strict";const{Deflate:n,deflate:Z,deflateRaw:I,gzip:g}=d(13513),{Inflate:l,inflate:r,inflateRaw:t,ungzip:S}=d(13583),M=d(13554);E.exports.Deflate=n,E.exports.deflate=Z,E.exports.deflateRaw=I,E.exports.gzip=g,E.exports.Inflate=l,E.exports.inflate=r,E.exports.inflateRaw=t,E.exports.ungzip=S,E.exports.constants=M},13513:(E,H,d)=>{"use strict";const n=d(13520),Z=d(13563),I=d(13571),g=d(13545),l=d(13577),r=Object.prototype.toString,{Z_NO_FLUSH:t,Z_SYNC_FLUSH:S,Z_FULL_FLUSH:M,Z_FINISH:V,Z_OK:C,Z_STREAM_END:w,Z_DEFAULT_COMPRESSION:R,Z_DEFAULT_STRATEGY:Q,Z_DEFLATED:L}=d(13554);function D(E){this.options=Z.assign({level:R,method:L,GE:16384,windowBits:15,memLevel:8,strategy:Q},E||{});let H=this.options;H.raw&&H.windowBits>0?H.windowBits=-H.windowBits:H.gzip&&H.windowBits>0&&H.windowBits<16&&(H.windowBits+=16),this.err=0,this.tH="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;let d=n.deflateInit2(this.strm,H.level,H.method,H.windowBits,H.memLevel,H.strategy);if(d!==C)throw new Error(g[d]);if(H.header&&n.deflateSetHeader(this.strm,H.header),H.dictionary){let E;if(E="string"===typeof H.dictionary?I.string2buf(H.dictionary):"[object ArrayBuffer]"===r.call(H.dictionary)?new Uint8Array(H.dictionary):H.dictionary,d=n.deflateSetDictionary(this.strm,E),d!==C)throw new Error(g[d]);this._dict_set=!0}}function e(E,H){const d=new D(H);if(d.push(E,!0),d.err)throw d.tH||g[d.err];return d.result}D.prototype.push=function(E,H){const d=this.strm,Z=this.options.GE;let g,l;if(this.ended)return!1;for(l=H===~~H?H:!0===H?V:t,"string"===typeof E?d.input=I.string2buf(E):"[object ArrayBuffer]"===r.call(E)?d.input=new Uint8Array(E):d.input=E,d.next_in=0,d.avail_in=d.input.length;;)if(0===d.avail_out&&(d.output=new Uint8Array(Z),d.next_out=0,d.avail_out=Z),(l===S||l===M)&&d.avail_out<=6)this.onData(d.output.subarray(0,d.next_out)),d.avail_out=0;else{if(g=n.deflate(d,l),g===w)return d.next_out>0&&this.onData(d.output.subarray(0,d.next_out)),g=n.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===C;if(0!==d.avail_out){if(l>0&&d.next_out>0)this.onData(d.output.subarray(0,d.next_out)),d.avail_out=0;else if(0===d.avail_in)break}else this.onData(d.output)}return!0},D.prototype.onData=function(E){this.chunks.push(E)},D.prototype.onEnd=function(E){E===C&&(this.result=Z.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.tH=this.strm.tH},E.exports.Deflate=D,E.exports.deflate=e,E.exports.deflateRaw=function(E,H){return(H=H||{}).raw=!0,e(E,H)},E.exports.gzip=function(E,H){return(H=H||{}).gzip=!0,e(E,H)},E.exports.constants=d(13554)},13583:(E,H,d)=>{"use strict";const n=d(13590),Z=d(13563),I=d(13571),g=d(13545),l=d(13577),r=d(13609),t=Object.prototype.toString,{Z_NO_FLUSH:S,Z_FINISH:M,Z_OK:V,Z_STREAM_END:C,Z_NEED_DICT:w,Z_STREAM_ERROR:R,Z_DATA_ERROR:Q,Z_MEM_ERROR:L}=d(13554);function D(E){this.options=Z.assign({GE:65536,windowBits:15,to:""},E||{});const H=this.options;H.raw&&H.windowBits>=0&&H.windowBits<16&&(H.windowBits=-H.windowBits,0===H.windowBits&&(H.windowBits=-15)),!(H.windowBits>=0&&H.windowBits<16)||E&&E.windowBits||(H.windowBits+=32),H.windowBits>15&&H.windowBits<48&&0===(15&H.windowBits)&&(H.windowBits|=15),this.err=0,this.tH="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;let d=n.inflateInit2(this.strm,H.windowBits);if(d!==V)throw new Error(g[d]);if(this.header=new r,n.inflateGetHeader(this.strm,this.header),H.dictionary&&("string"===typeof H.dictionary?H.dictionary=I.string2buf(H.dictionary):"[object ArrayBuffer]"===t.call(H.dictionary)&&(H.dictionary=new Uint8Array(H.dictionary)),H.raw&&(d=n.inflateSetDictionary(this.strm,H.dictionary),d!==V)))throw new Error(g[d])}function e(E,H){const d=new D(H);if(d.push(E),d.err)throw d.tH||g[d.err];return d.result}D.prototype.push=function(E,H){const d=this.strm,Z=this.options.GE,g=this.options.dictionary;let l,r,D;if(this.ended)return!1;for(r=H===~~H?H:!0===H?M:S,"[object ArrayBuffer]"===t.call(E)?d.input=new Uint8Array(E):d.input=E,d.next_in=0,d.avail_in=d.input.length;;){for(0===d.avail_out&&(d.output=new Uint8Array(Z),d.next_out=0,d.avail_out=Z),l=n.inflate(d,r),l===w&&g&&(l=n.inflateSetDictionary(d,g),l===V?l=n.inflate(d,r):l===Q&&(l=w));d.avail_in>0&&l===C&&d.state.wrap>0&&0!==E[d.next_in];)n.inflateReset(d),l=n.inflate(d,r);switch(l){case R:case Q:case w:case L:return this.onEnd(l),this.ended=!0,!1}if(D=d.avail_out,d.next_out&&(0===d.avail_out||l===C))if("string"===this.options.to){let E=I.utf8border(d.output,d.next_out),H=d.next_out-E,n=I.buf2string(d.output,E);d.next_out=H,d.avail_out=Z-H,H&&d.output.set(d.output.subarray(E,E+H),0),this.onData(n)}else this.onData(d.output.length===d.next_out?d.output:d.output.subarray(0,d.next_out));if(l!==V||0!==D){if(l===C)return l=n.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(0===d.avail_in)break}}return!0},D.prototype.onData=function(E){this.chunks.push(E)},D.prototype.onEnd=function(E){E===V&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Z.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.tH=this.strm.tH},E.exports.Inflate=D,E.exports.inflate=e,E.exports.inflateRaw=function(E,H){return(H=H||{}).raw=!0,e(E,H)},E.exports.ungzip=e,E.exports.constants=d(13554)},13563:E=>{"use strict";const H=(E,H)=>Object.prototype.hasOwnProperty.call(E,H);E.exports.assign=function(E){const d=Array.prototype.slice.call(arguments,1);for(;d.length;){const n=d.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(const d in n)H(n,d)&&(E[d]=n[d])}}return E},E.exports.flattenChunks=E=>{let H=0;for(let n=0,Z=E.length;n<Z;n++)H+=E[n].length;const d=new Uint8Array(H);for(let n=0,Z=0,I=E.length;n<I;n++){let H=E[n];d.set(H,Z),Z+=H.length}return d}},13571:E=>{"use strict";let H=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(n){H=!1}const d=new Uint8Array(256);for(let Z=0;Z<256;Z++)d[Z]=Z>=252?6:Z>=248?5:Z>=240?4:Z>=224?3:Z>=192?2:1;d[254]=d[254]=1,E.exports.string2buf=E=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(E);let H,d,n,Z,I,g=E.length,l=0;for(Z=0;Z<g;Z++)d=E.charCodeAt(Z),55296===(64512&d)&&Z+1<g&&(n=E.charCodeAt(Z+1),56320===(64512&n)&&(d=65536+(d-55296<<10)+(n-56320),Z++)),l+=d<128?1:d<2048?2:d<65536?3:4;for(H=new Uint8Array(l),I=0,Z=0;I<l;Z++)d=E.charCodeAt(Z),55296===(64512&d)&&Z+1<g&&(n=E.charCodeAt(Z+1),56320===(64512&n)&&(d=65536+(d-55296<<10)+(n-56320),Z++)),d<128?H[I++]=d:d<2048?(H[I++]=192|d>>>6,H[I++]=128|63&d):d<65536?(H[I++]=224|d>>>12,H[I++]=128|d>>>6&63,H[I++]=128|63&d):(H[I++]=240|d>>>18,H[I++]=128|d>>>12&63,H[I++]=128|d>>>6&63,H[I++]=128|63&d);return H};E.exports.buf2string=(E,n)=>{const Z=n||E.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(E.subarray(0,n));let I,g;const l=new Array(2*Z);for(g=0,I=0;I<Z;){let H=E[I++];if(H<128){l[g++]=H;continue}let n=d[H];if(n>4)l[g++]=65533,I+=n-1;else{for(H&=2===n?31:3===n?15:7;n>1&&I<Z;)H=H<<6|63&E[I++],n--;n>1?l[g++]=65533:H<65536?l[g++]=H:(H-=65536,l[g++]=55296|H>>10&1023,l[g++]=56320|1023&H)}}return((E,d)=>{if(d<65534&&E.subarray&&H)return String.fromCharCode.apply(null,E.length===d?E:E.subarray(0,d));let n="";for(let H=0;H<d;H++)n+=String.fromCharCode(E[H]);return n})(l,g)},E.exports.utf8border=(E,H)=>{(H=H||E.length)>E.length&&(H=E.length);let n=H-1;for(;n>=0&&128===(192&E[n]);)n--;return n<0||0===n?H:n+d[E[n]]>H?n:H}},13529:E=>{"use strict";E.exports=(E,H,d,n)=>{let Z=65535&E,I=E>>>16&65535,g=0;for(;0!==d;){g=d>2e3?2e3:d,d-=g;do{Z=Z+H[n++]|0,I=I+Z|0}while(--g);Z%=65521,I%=65521}return Z|I<<16}},13554:E=>{"use strict";E.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13537:E=>{"use strict";const H=new Uint32Array((()=>{let E,H=[];for(var d=0;d<256;d++){E=d;for(var n=0;n<8;n++)E=1&E?3988292384^E>>>1:E>>>1;H[d]=E}return H})());E.exports=(E,d,n,Z)=>{const I=H,g=Z+n;E^=-1;for(let H=Z;H<g;H++)E=E>>>8^I[255&(E^d[H])];return~E}},13520:(E,H,d)=>{"use strict";const{_tr_init:n,_tr_stored_block:Z,_tr_flush_block:I,_tr_tally:g,_tr_align:l}=d(13527),r=d(13529),t=d(13537),S=d(13545),{Z_NO_FLUSH:M,Z_PARTIAL_FLUSH:V,Z_FULL_FLUSH:C,Z_FINISH:w,Z_BLOCK:R,Z_OK:Q,Z_STREAM_END:L,Z_STREAM_ERROR:D,Z_DATA_ERROR:e,Z_BUF_ERROR:s,Z_DEFAULT_COMPRESSION:i,Z_FILTERED:p,Z_HUFFMAN_ONLY:f,Z_RLE:P,Z_FIXED:j,Z_DEFAULT_STRATEGY:X,Z_UNKNOWN:W,Z_DEFLATED:U}=d(13554),Y=258,c=262,u=103,o=113,F=666,a=(E,H)=>(E.tH=S[H],H),k=E=>(E<<1)-(E>4?9:0),O=E=>{let H=E.length;for(;--H>=0;)E[H]=0};let G=(E,H,d)=>(H<<E.hash_shift^d)&E.hash_mask;const x=E=>{const H=E.state;let d=H.pending;d>E.avail_out&&(d=E.avail_out),0!==d&&(E.output.set(H.pending_buf.subarray(H.pending_out,H.pending_out+d),E.next_out),E.next_out+=d,H.pending_out+=d,E.total_out+=d,E.avail_out-=d,H.pending-=d,0===H.pending&&(H.pending_out=0))},q=(E,H)=>{I(E,E.block_start>=0?E.block_start:-1,E.strstart-E.block_start,H),E.block_start=E.strstart,x(E.strm)},b=(E,H)=>{E.pending_buf[E.pending++]=H},h=(E,H)=>{E.pending_buf[E.pending++]=H>>>8&255,E.pending_buf[E.pending++]=255&H},y=(E,H,d,n)=>{let Z=E.avail_in;return Z>n&&(Z=n),0===Z?0:(E.avail_in-=Z,H.set(E.input.subarray(E.next_in,E.next_in+Z),d),1===E.state.wrap?E.adler=r(E.adler,H,Z,d):2===E.state.wrap&&(E.adler=t(E.adler,H,Z,d)),E.next_in+=Z,E.total_in+=Z,Z)},v=(E,H)=>{let d,n,Z=E.max_chain_length,I=E.strstart,g=E.prev_length,l=E.nice_match;const r=E.strstart>E.w_size-c?E.strstart-(E.w_size-c):0,t=E.window,S=E.w_mask,M=E.prev,V=E.strstart+Y;let C=t[I+g-1],w=t[I+g];E.prev_length>=E.good_match&&(Z>>=2),l>E.lookahead&&(l=E.lookahead);do{if(d=H,t[d+g]===w&&t[d+g-1]===C&&t[d]===t[I]&&t[++d]===t[I+1]){I+=2,d++;do{}while(t[++I]===t[++d]&&t[++I]===t[++d]&&t[++I]===t[++d]&&t[++I]===t[++d]&&t[++I]===t[++d]&&t[++I]===t[++d]&&t[++I]===t[++d]&&t[++I]===t[++d]&&I<V);if(n=Y-(V-I),I=V-Y,n>g){if(E.match_start=H,g=n,n>=l)break;C=t[I+g-1],w=t[I+g]}}}while((H=M[H&S])>r&&0!==--Z);return g<=E.lookahead?g:E.lookahead},z=E=>{const H=E.w_size;let d,n,Z,I,g;do{if(I=E.window_size-E.lookahead-E.strstart,E.strstart>=H+(H-c)){E.window.set(E.window.subarray(H,H+H),0),E.match_start-=H,E.strstart-=H,E.block_start-=H,n=E.hash_size,d=n;do{Z=E.head[--d],E.head[d]=Z>=H?Z-H:0}while(--n);n=H,d=n;do{Z=E.prev[--d],E.prev[d]=Z>=H?Z-H:0}while(--n);I+=H}if(0===E.strm.avail_in)break;if(n=y(E.strm,E.window,E.strstart+E.lookahead,I),E.lookahead+=n,E.lookahead+E.insert>=3)for(g=E.strstart-E.insert,E.ins_h=E.window[g],E.ins_h=G(E,E.ins_h,E.window[g+1]);E.insert&&(E.ins_h=G(E,E.ins_h,E.window[g+3-1]),E.prev[g&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=g,g++,E.insert--,!(E.lookahead+E.insert<3)););}while(E.lookahead<c&&0!==E.strm.avail_in)},K=(E,H)=>{let d,n;for(;;){if(E.lookahead<c){if(z(E),E.lookahead<c&&H===M)return 1;if(0===E.lookahead)break}if(d=0,E.lookahead>=3&&(E.ins_h=G(E,E.ins_h,E.window[E.strstart+3-1]),d=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),0!==d&&E.strstart-d<=E.w_size-c&&(E.match_length=v(E,d)),E.match_length>=3)if(n=g(E,E.strstart-E.match_start,E.match_length-3),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=3){E.match_length--;do{E.strstart++,E.ins_h=G(E,E.ins_h,E.window[E.strstart+3-1]),d=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart}while(0!==--E.match_length);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=G(E,E.ins_h,E.window[E.strstart+1]);else n=g(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(n&&(q(E,!1),0===E.strm.avail_out))return 1}return E.insert=E.strstart<2?E.strstart:2,H===w?(q(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(q(E,!1),0===E.strm.avail_out)?1:2},N=(E,H)=>{let d,n,Z;for(;;){if(E.lookahead<c){if(z(E),E.lookahead<c&&H===M)return 1;if(0===E.lookahead)break}if(d=0,E.lookahead>=3&&(E.ins_h=G(E,E.ins_h,E.window[E.strstart+3-1]),d=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=2,0!==d&&E.prev_length<E.max_lazy_match&&E.strstart-d<=E.w_size-c&&(E.match_length=v(E,d),E.match_length<=5&&(E.strategy===p||3===E.match_length&&E.strstart-E.match_start>4096)&&(E.match_length=2)),E.prev_length>=3&&E.match_length<=E.prev_length){Z=E.strstart+E.lookahead-3,n=g(E,E.strstart-1-E.prev_match,E.prev_length-3),E.lookahead-=E.prev_length-1,E.prev_length-=2;do{++E.strstart<=Z&&(E.ins_h=G(E,E.ins_h,E.window[E.strstart+3-1]),d=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart)}while(0!==--E.prev_length);if(E.match_available=0,E.match_length=2,E.strstart++,n&&(q(E,!1),0===E.strm.avail_out))return 1}else if(E.match_available){if(n=g(E,0,E.window[E.strstart-1]),n&&q(E,!1),E.strstart++,E.lookahead--,0===E.strm.avail_out)return 1}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(n=g(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<2?E.strstart:2,H===w?(q(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(q(E,!1),0===E.strm.avail_out)?1:2};function mE(E,H,d,n,Z){this.good_length=E,this.max_lazy=H,this.nice_length=d,this.max_chain=n,this.func=Z}const T=[new mE(0,0,0,0,((E,H)=>{let d=65535;for(d>E.pending_buf_size-5&&(d=E.pending_buf_size-5);;){if(E.lookahead<=1){if(z(E),0===E.lookahead&&H===M)return 1;if(0===E.lookahead)break}E.strstart+=E.lookahead,E.lookahead=0;const n=E.block_start+d;if((0===E.strstart||E.strstart>=n)&&(E.lookahead=E.strstart-n,E.strstart=n,q(E,!1),0===E.strm.avail_out))return 1;if(E.strstart-E.block_start>=E.w_size-c&&(q(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,H===w?(q(E,!0),0===E.strm.avail_out?3:4):(E.strstart>E.block_start&&(q(E,!1),E.strm.avail_out),1)})),new mE(4,4,8,4,K),new mE(4,5,16,8,K),new mE(4,6,32,32,K),new mE(4,4,16,16,N),new mE(8,16,32,32,N),new mE(8,16,128,128,N),new mE(8,32,128,256,N),new mE(32,128,258,1024,N),new mE(32,258,258,4096,N)];function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=U,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),O(this.dyn_ltree),O(this.dyn_dtree),O(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),O(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),O(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const B=E=>{if(!E||!E.state)return a(E,D);E.total_in=E.total_out=0,E.data_type=W;const H=E.state;return H.pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?42:o,E.adler=2===H.wrap?0:1,H.last_flush=M,n(H),Q},J=E=>{const H=B(E);var d;return H===Q&&((d=E.state).window_size=2*d.w_size,O(d.head),d.max_lazy_match=T[d.level].max_lazy,d.good_match=T[d.level].good_length,d.nice_match=T[d.level].nice_length,d.max_chain_length=T[d.level].max_chain,d.strstart=0,d.block_start=0,d.lookahead=0,d.insert=0,d.match_length=d.prev_length=2,d.match_available=0,d.ins_h=0),H},EE=(E,H,d,n,Z,I)=>{if(!E)return D;let g=1;if(H===i&&(H=6),n<0?(g=0,n=-n):n>15&&(g=2,n-=16),Z<1||Z>9||d!==U||n<8||n>15||H<0||H>9||I<0||I>j)return a(E,D);8===n&&(n=9);const l=new A;return E.state=l,l.strm=E,l.wrap=g,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=Z+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<Z+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=H,l.strategy=I,l.method=d,J(E)};E.exports.deflateInit=(E,H)=>EE(E,H,U,15,8,X),E.exports.deflateInit2=EE,E.exports.deflateReset=J,E.exports.deflateResetKeep=B,E.exports.deflateSetHeader=(E,H)=>E&&E.state?2!==E.state.wrap?D:(E.state.gzhead=H,Q):D,E.exports.deflate=(E,H)=>{let d,n;if(!E||!E.state||H>R||H<0)return E?a(E,D):D;const I=E.state;if(!E.output||!E.input&&0!==E.avail_in||I.status===F&&H!==w)return a(E,0===E.avail_out?s:D);I.strm=E;const r=I.last_flush;if(I.last_flush=H,42===I.status)if(2===I.wrap)E.adler=0,b(I,31),b(I,139),b(I,8),I.gzhead?(b(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),b(I,255&I.gzhead.time),b(I,I.gzhead.time>>8&255),b(I,I.gzhead.time>>16&255),b(I,I.gzhead.time>>24&255),b(I,9===I.level?2:I.strategy>=f||I.level<2?4:0),b(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(b(I,255&I.gzhead.extra.length),b(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(E.adler=t(E.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(b(I,0),b(I,0),b(I,0),b(I,0),b(I,0),b(I,9===I.level?2:I.strategy>=f||I.level<2?4:0),b(I,3),I.status=o);else{let H=U+(I.w_bits-8<<4)<<8,d=-1;d=I.strategy>=f||I.level<2?0:I.level<6?1:6===I.level?2:3,H|=d<<6,0!==I.strstart&&(H|=32),H+=31-H%31,I.status=o,h(I,H),0!==I.strstart&&(h(I,E.adler>>>16),h(I,65535&E.adler)),E.adler=1}if(69===I.status)if(I.gzhead.extra){for(d=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>d&&(E.adler=t(E.adler,I.pending_buf,I.pending-d,d)),x(E),d=I.pending,I.pending!==I.pending_buf_size));)b(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>d&&(E.adler=t(E.adler,I.pending_buf,I.pending-d,d)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(73===I.status)if(I.gzhead.name){d=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>d&&(E.adler=t(E.adler,I.pending_buf,I.pending-d,d)),x(E),d=I.pending,I.pending===I.pending_buf_size)){n=1;break}n=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,b(I,n)}while(0!==n);I.gzhead.hcrc&&I.pending>d&&(E.adler=t(E.adler,I.pending_buf,I.pending-d,d)),0===n&&(I.gzindex=0,I.status=91)}else I.status=91;if(91===I.status)if(I.gzhead.comment){d=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>d&&(E.adler=t(E.adler,I.pending_buf,I.pending-d,d)),x(E),d=I.pending,I.pending===I.pending_buf_size)){n=1;break}n=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,b(I,n)}while(0!==n);I.gzhead.hcrc&&I.pending>d&&(E.adler=t(E.adler,I.pending_buf,I.pending-d,d)),0===n&&(I.status=u)}else I.status=u;if(I.status===u&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&x(E),I.pending+2<=I.pending_buf_size&&(b(I,255&E.adler),b(I,E.adler>>8&255),E.adler=0,I.status=o)):I.status=o),0!==I.pending){if(x(E),0===E.avail_out)return I.last_flush=-1,Q}else if(0===E.avail_in&&k(H)<=k(r)&&H!==w)return a(E,s);if(I.status===F&&0!==E.avail_in)return a(E,s);if(0!==E.avail_in||0!==I.lookahead||H!==M&&I.status!==F){let d=I.strategy===f?((E,H)=>{let d;for(;;){if(0===E.lookahead&&(z(E),0===E.lookahead)){if(H===M)return 1;break}if(E.match_length=0,d=g(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++,d&&(q(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,H===w?(q(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(q(E,!1),0===E.strm.avail_out)?1:2})(I,H):I.strategy===P?((E,H)=>{let d,n,Z,I;const l=E.window;for(;;){if(E.lookahead<=Y){if(z(E),E.lookahead<=Y&&H===M)return 1;if(0===E.lookahead)break}if(E.match_length=0,E.lookahead>=3&&E.strstart>0&&(Z=E.strstart-1,n=l[Z],n===l[++Z]&&n===l[++Z]&&n===l[++Z])){I=E.strstart+Y;do{}while(n===l[++Z]&&n===l[++Z]&&n===l[++Z]&&n===l[++Z]&&n===l[++Z]&&n===l[++Z]&&n===l[++Z]&&n===l[++Z]&&Z<I);E.match_length=Y-(I-Z),E.match_length>E.lookahead&&(E.match_length=E.lookahead)}if(E.match_length>=3?(d=g(E,1,E.match_length-3),E.lookahead-=E.match_length,E.strstart+=E.match_length,E.match_length=0):(d=g(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++),d&&(q(E,!1),0===E.strm.avail_out))return 1}return E.insert=0,H===w?(q(E,!0),0===E.strm.avail_out?3:4):E.last_lit&&(q(E,!1),0===E.strm.avail_out)?1:2})(I,H):T[I.level].func(I,H);if(3!==d&&4!==d||(I.status=F),1===d||3===d)return 0===E.avail_out&&(I.last_flush=-1),Q;if(2===d&&(H===V?l(I):H!==R&&(Z(I,0,0,!1),H===C&&(O(I.head),0===I.lookahead&&(I.strstart=0,I.block_start=0,I.insert=0))),x(E),0===E.avail_out))return I.last_flush=-1,Q}return H!==w?Q:I.wrap<=0?L:(2===I.wrap?(b(I,255&E.adler),b(I,E.adler>>8&255),b(I,E.adler>>16&255),b(I,E.adler>>24&255),b(I,255&E.total_in),b(I,E.total_in>>8&255),b(I,E.total_in>>16&255),b(I,E.total_in>>24&255)):(h(I,E.adler>>>16),h(I,65535&E.adler)),x(E),I.wrap>0&&(I.wrap=-I.wrap),0!==I.pending?Q:L)},E.exports.deflateEnd=E=>{if(!E||!E.state)return D;const H=E.state.status;return 42!==H&&69!==H&&73!==H&&91!==H&&H!==u&&H!==o&&H!==F?a(E,D):(E.state=null,H===o?a(E,e):Q)},E.exports.deflateSetDictionary=(E,H)=>{let d=H.length;if(!E||!E.state)return D;const n=E.state,Z=n.wrap;if(2===Z||1===Z&&42!==n.status||n.lookahead)return D;if(1===Z&&(E.adler=r(E.adler,H,d,0)),n.wrap=0,d>=n.w_size){0===Z&&(O(n.head),n.strstart=0,n.block_start=0,n.insert=0);let E=new Uint8Array(n.w_size);E.set(H.subarray(d-n.w_size,d),0),H=E,d=n.w_size}const I=E.avail_in,g=E.next_in,l=E.input;for(E.avail_in=d,E.next_in=0,E.input=H,z(n);n.lookahead>=3;){let E=n.strstart,H=n.lookahead-2;do{n.ins_h=G(n,n.ins_h,n.window[E+3-1]),n.prev[E&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=E,E++}while(--H);n.strstart=E,n.lookahead=2,z(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,E.next_in=g,E.input=l,E.avail_in=I,n.wrap=Z,Q},E.exports.deflateInfo="pako deflate (from Nodeca project)"},13609:E=>{"use strict";E.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13597:E=>{"use strict";E.exports=function(E,H){let d,n,Z,I,g,l,r,t,S,M,V,C,w,R,Q,L,D,e,s,i,p,f,P,j;const X=E.state;d=E.next_in,P=E.input,n=d+(E.avail_in-5),Z=E.next_out,j=E.output,I=Z-(H-E.avail_out),g=Z+(E.avail_out-257),l=X.dmax,r=X.wsize,t=X.whave,S=X.wnext,M=X.window,V=X.hold,C=X.bits,w=X.lencode,R=X.distcode,Q=(1<<X.lenbits)-1,L=(1<<X.distbits)-1;E:do{C<15&&(V+=P[d++]<<C,C+=8,V+=P[d++]<<C,C+=8),D=w[V&Q];H:for(;;){if(e=D>>>24,V>>>=e,C-=e,e=D>>>16&255,0===e)j[Z++]=65535&D;else{if(!(16&e)){if(0===(64&e)){D=w[(65535&D)+(V&(1<<e)-1)];continue H}if(32&e){X.mode=12;break E}E.tH="invalid literal/length code",X.mode=30;break E}s=65535&D,e&=15,e&&(C<e&&(V+=P[d++]<<C,C+=8),s+=V&(1<<e)-1,V>>>=e,C-=e),C<15&&(V+=P[d++]<<C,C+=8,V+=P[d++]<<C,C+=8),D=R[V&L];d:for(;;){if(e=D>>>24,V>>>=e,C-=e,e=D>>>16&255,!(16&e)){if(0===(64&e)){D=R[(65535&D)+(V&(1<<e)-1)];continue d}E.tH="invalid distance code",X.mode=30;break E}if(i=65535&D,e&=15,C<e&&(V+=P[d++]<<C,C+=8,C<e&&(V+=P[d++]<<C,C+=8)),i+=V&(1<<e)-1,i>l){E.tH="invalid distance too far back",X.mode=30;break E}if(V>>>=e,C-=e,e=Z-I,i>e){if(e=i-e,e>t&&X.sane){E.tH="invalid distance too far back",X.mode=30;break E}if(p=0,f=M,0===S){if(p+=r-e,e<s){s-=e;do{j[Z++]=M[p++]}while(--e);p=Z-i,f=j}}else if(S<e){if(p+=r+S-e,e-=S,e<s){s-=e;do{j[Z++]=M[p++]}while(--e);if(p=0,S<s){e=S,s-=e;do{j[Z++]=M[p++]}while(--e);p=Z-i,f=j}}}else if(p+=S-e,e<s){s-=e;do{j[Z++]=M[p++]}while(--e);p=Z-i,f=j}for(;s>2;)j[Z++]=f[p++],j[Z++]=f[p++],j[Z++]=f[p++],s-=3;s&&(j[Z++]=f[p++],s>1&&(j[Z++]=f[p++]))}else{p=Z-i;do{j[Z++]=j[p++],j[Z++]=j[p++],j[Z++]=j[p++],s-=3}while(s>2);s&&(j[Z++]=j[p++],s>1&&(j[Z++]=j[p++]))}break}}break}}while(d<n&&Z<g);s=C>>3,d-=s,C-=s<<3,V&=(1<<C)-1,E.next_in=d,E.next_out=Z,E.avail_in=d<n?n-d+5:5-(d-n),E.avail_out=Z<g?g-Z+257:257-(Z-g),X.hold=V,X.bits=C}},13590:(E,H,d)=>{"use strict";const n=d(13529),Z=d(13537),I=d(13597),g=d(13601),{Z_FINISH:l,Z_BLOCK:r,Z_TREES:t,Z_OK:S,Z_STREAM_END:M,Z_NEED_DICT:V,Z_STREAM_ERROR:C,Z_DATA_ERROR:w,Z_MEM_ERROR:R,Z_BUF_ERROR:Q,Z_DEFLATED:L}=d(13554),D=12,e=30,s=E=>(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24);function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const p=E=>{if(!E||!E.state)return C;const H=E.state;return E.total_in=E.total_out=H.total=0,E.tH="",H.wrap&&(E.adler=1&H.wrap),H.mode=1,H.last=0,H.havedict=0,H.dmax=32768,H.head=null,H.hold=0,H.bits=0,H.lencode=H.lendyn=new Int32Array(852),H.distcode=H.distdyn=new Int32Array(592),H.sane=1,H.back=-1,S},f=E=>{if(!E||!E.state)return C;const H=E.state;return H.wsize=0,H.whave=0,H.wnext=0,p(E)},P=(E,H)=>{let d;if(!E||!E.state)return C;const n=E.state;return H<0?(d=0,H=-H):(d=1+(H>>4),H<48&&(H&=15)),H&&(H<8||H>15)?C:(null!==n.window&&n.wbits!==H&&(n.window=null),n.wrap=d,n.wbits=H,f(E))},j=(E,H)=>{if(!E)return C;const d=new i;E.state=d,d.window=null;const n=P(E,H);return n!==S&&(E.state=null),n};let X,W,U=!0;const Y=E=>{if(U){X=new Int32Array(512),W=new Int32Array(32);let H=0;for(;H<144;)E.lens[H++]=8;for(;H<256;)E.lens[H++]=9;for(;H<280;)E.lens[H++]=7;for(;H<288;)E.lens[H++]=8;for(g(1,E.lens,0,288,X,0,E.work,{bits:9}),H=0;H<32;)E.lens[H++]=5;g(2,E.lens,0,32,W,0,E.work,{bits:5}),U=!1}E.lencode=X,E.lenbits=9,E.distcode=W,E.distbits=5},c=(E,H,d,n)=>{let Z;const I=E.state;return null===I.window&&(I.wsize=1<<I.wbits,I.wnext=0,I.whave=0,I.window=new Uint8Array(I.wsize)),n>=I.wsize?(I.window.set(H.subarray(d-I.wsize,d),0),I.wnext=0,I.whave=I.wsize):(Z=I.wsize-I.wnext,Z>n&&(Z=n),I.window.set(H.subarray(d-n,d-n+Z),I.wnext),(n-=Z)?(I.window.set(H.subarray(d-n,d),0),I.wnext=n,I.whave=I.wsize):(I.wnext+=Z,I.wnext===I.wsize&&(I.wnext=0),I.whave<I.wsize&&(I.whave+=Z))),0};E.exports.inflateReset=f,E.exports.inflateReset2=P,E.exports.inflateResetKeep=p,E.exports.inflateInit=E=>j(E,15),E.exports.inflateInit2=j,E.exports.inflate=(E,H)=>{let d,i,p,f,P,j,X,W,U,u,o,F,a,k,O,G,x,q,b,h,y,v,z=0;const K=new Uint8Array(4);let N,mE;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!E||!E.state||!E.output||!E.input&&0!==E.avail_in)return C;d=E.state,d.mode===D&&(d.mode=13),P=E.next_out,p=E.output,X=E.avail_out,f=E.next_in,i=E.input,j=E.avail_in,W=d.hold,U=d.bits,u=j,o=X,v=S;E:for(;;)switch(d.mode){case 1:if(0===d.wrap){d.mode=13;break}for(;U<16;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}if(2&d.wrap&&35615===W){d.check=0,K[0]=255&W,K[1]=W>>>8&255,d.check=Z(d.check,K,2,0),W=0,U=0,d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&W)<<8)+(W>>8))%31){E.tH="incorrect header check",d.mode=e;break}if((15&W)!==L){E.tH="unknown compression method",d.mode=e;break}if(W>>>=4,U-=4,y=8+(15&W),0===d.wbits)d.wbits=y;else if(y>d.wbits){E.tH="invalid window size",d.mode=e;break}d.dmax=1<<d.wbits,E.adler=d.check=1,d.mode=512&W?10:D,W=0,U=0;break;case 2:for(;U<16;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}if(d.flags=W,(255&d.flags)!==L){E.tH="unknown compression method",d.mode=e;break}if(57344&d.flags){E.tH="unknown header flags set",d.mode=e;break}d.head&&(d.head.text=W>>8&1),512&d.flags&&(K[0]=255&W,K[1]=W>>>8&255,d.check=Z(d.check,K,2,0)),W=0,U=0,d.mode=3;case 3:for(;U<32;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}d.head&&(d.head.time=W),512&d.flags&&(K[0]=255&W,K[1]=W>>>8&255,K[2]=W>>>16&255,K[3]=W>>>24&255,d.check=Z(d.check,K,4,0)),W=0,U=0,d.mode=4;case 4:for(;U<16;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}d.head&&(d.head.xflags=255&W,d.head.os=W>>8),512&d.flags&&(K[0]=255&W,K[1]=W>>>8&255,d.check=Z(d.check,K,2,0)),W=0,U=0,d.mode=5;case 5:if(1024&d.flags){for(;U<16;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}d.length=W,d.head&&(d.head.extra_len=W),512&d.flags&&(K[0]=255&W,K[1]=W>>>8&255,d.check=Z(d.check,K,2,0)),W=0,U=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&(F=d.length,F>j&&(F=j),F&&(d.head&&(y=d.head.extra_len-d.length,d.head.extra||(d.head.extra=new Uint8Array(d.head.extra_len)),d.head.extra.set(i.subarray(f,f+F),y)),512&d.flags&&(d.check=Z(d.check,i,F,f)),j-=F,f+=F,d.length-=F),d.length))break E;d.length=0,d.mode=7;case 7:if(2048&d.flags){if(0===j)break E;F=0;do{y=i[f+F++],d.head&&y&&d.length<65536&&(d.head.name+=String.fromCharCode(y))}while(y&&F<j);if(512&d.flags&&(d.check=Z(d.check,i,F,f)),j-=F,f+=F,y)break E}else d.head&&(d.head.name=null);d.length=0,d.mode=8;case 8:if(4096&d.flags){if(0===j)break E;F=0;do{y=i[f+F++],d.head&&y&&d.length<65536&&(d.head.comment+=String.fromCharCode(y))}while(y&&F<j);if(512&d.flags&&(d.check=Z(d.check,i,F,f)),j-=F,f+=F,y)break E}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;U<16;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}if(W!==(65535&d.check)){E.tH="header crc mismatch",d.mode=e;break}W=0,U=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0),E.adler=d.check=0,d.mode=D;break;case 10:for(;U<32;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}E.adler=d.check=s(W),W=0,U=0,d.mode=11;case 11:if(0===d.havedict)return E.next_out=P,E.avail_out=X,E.next_in=f,E.avail_in=j,d.hold=W,d.bits=U,V;E.adler=d.check=1,d.mode=D;case D:if(H===r||H===t)break E;case 13:if(d.last){W>>>=7&U,U-=7&U,d.mode=27;break}for(;U<3;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}switch(d.last=1&W,W>>>=1,U-=1,3&W){case 0:d.mode=14;break;case 1:if(Y(d),d.mode=20,H===t){W>>>=2,U-=2;break E}break;case 2:d.mode=17;break;case 3:E.tH="invalid block type",d.mode=e}W>>>=2,U-=2;break;case 14:for(W>>>=7&U,U-=7&U;U<32;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}if((65535&W)!==(W>>>16^65535)){E.tH="invalid stored block lengths",d.mode=e;break}if(d.length=65535&W,W=0,U=0,d.mode=15,H===t)break E;case 15:d.mode=16;case 16:if(F=d.length,F){if(F>j&&(F=j),F>X&&(F=X),0===F)break E;p.set(i.subarray(f,f+F),P),j-=F,f+=F,X-=F,P+=F,d.length-=F;break}d.mode=D;break;case 17:for(;U<14;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}if(d.nlen=257+(31&W),W>>>=5,U-=5,d.ndist=1+(31&W),W>>>=5,U-=5,d.ncode=4+(15&W),W>>>=4,U-=4,d.nlen>286||d.ndist>30){E.tH="too many length or distance symbols",d.mode=e;break}d.have=0,d.mode=18;case 18:for(;d.have<d.ncode;){for(;U<3;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}d.lens[T[d.have++]]=7&W,W>>>=3,U-=3}for(;d.have<19;)d.lens[T[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,N={bits:d.lenbits},v=g(0,d.lens,0,19,d.lencode,0,d.work,N),d.lenbits=N.bits,v){E.tH="invalid code lengths set",d.mode=e;break}d.have=0,d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;z=d.lencode[W&(1<<d.lenbits)-1],O=z>>>24,G=z>>>16&255,x=65535&z,!(O<=U);){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}if(x<16)W>>>=O,U-=O,d.lens[d.have++]=x;else{if(16===x){for(mE=O+2;U<mE;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}if(W>>>=O,U-=O,0===d.have){E.tH="invalid bit length repeat",d.mode=e;break}y=d.lens[d.have-1],F=3+(3&W),W>>>=2,U-=2}else if(17===x){for(mE=O+3;U<mE;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}W>>>=O,U-=O,y=0,F=3+(7&W),W>>>=3,U-=3}else{for(mE=O+7;U<mE;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}W>>>=O,U-=O,y=0,F=11+(127&W),W>>>=7,U-=7}if(d.have+F>d.nlen+d.ndist){E.tH="invalid bit length repeat",d.mode=e;break}for(;F--;)d.lens[d.have++]=y}}if(d.mode===e)break;if(0===d.lens[256]){E.tH="invalid code -- missing end-of-block",d.mode=e;break}if(d.lenbits=9,N={bits:d.lenbits},v=g(1,d.lens,0,d.nlen,d.lencode,0,d.work,N),d.lenbits=N.bits,v){E.tH="invalid literal/lengths set",d.mode=e;break}if(d.distbits=6,d.distcode=d.distdyn,N={bits:d.distbits},v=g(2,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,N),d.distbits=N.bits,v){E.tH="invalid distances set",d.mode=e;break}if(d.mode=20,H===t)break E;case 20:d.mode=21;case 21:if(j>=6&&X>=258){E.next_out=P,E.avail_out=X,E.next_in=f,E.avail_in=j,d.hold=W,d.bits=U,I(E,o),P=E.next_out,p=E.output,X=E.avail_out,f=E.next_in,i=E.input,j=E.avail_in,W=d.hold,U=d.bits,d.mode===D&&(d.back=-1);break}for(d.back=0;z=d.lencode[W&(1<<d.lenbits)-1],O=z>>>24,G=z>>>16&255,x=65535&z,!(O<=U);){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}if(G&&0===(240&G)){for(q=O,b=G,h=x;z=d.lencode[h+((W&(1<<q+b)-1)>>q)],O=z>>>24,G=z>>>16&255,x=65535&z,!(q+O<=U);){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}W>>>=q,U-=q,d.back+=q}if(W>>>=O,U-=O,d.back+=O,d.length=x,0===G){d.mode=26;break}if(32&G){d.back=-1,d.mode=D;break}if(64&G){E.tH="invalid literal/length code",d.mode=e;break}d.extra=15&G,d.mode=22;case 22:if(d.extra){for(mE=d.extra;U<mE;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}d.length+=W&(1<<d.extra)-1,W>>>=d.extra,U-=d.extra,d.back+=d.extra}d.was=d.length,d.mode=23;case 23:for(;z=d.distcode[W&(1<<d.distbits)-1],O=z>>>24,G=z>>>16&255,x=65535&z,!(O<=U);){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}if(0===(240&G)){for(q=O,b=G,h=x;z=d.distcode[h+((W&(1<<q+b)-1)>>q)],O=z>>>24,G=z>>>16&255,x=65535&z,!(q+O<=U);){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}W>>>=q,U-=q,d.back+=q}if(W>>>=O,U-=O,d.back+=O,64&G){E.tH="invalid distance code",d.mode=e;break}d.offset=x,d.extra=15&G,d.mode=24;case 24:if(d.extra){for(mE=d.extra;U<mE;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}d.offset+=W&(1<<d.extra)-1,W>>>=d.extra,U-=d.extra,d.back+=d.extra}if(d.offset>d.dmax){E.tH="invalid distance too far back",d.mode=e;break}d.mode=25;case 25:if(0===X)break E;if(F=o-X,d.offset>F){if(F=d.offset-F,F>d.whave&&d.sane){E.tH="invalid distance too far back",d.mode=e;break}F>d.wnext?(F-=d.wnext,a=d.wsize-F):a=d.wnext-F,F>d.length&&(F=d.length),k=d.window}else k=p,a=P-d.offset,F=d.length;F>X&&(F=X),X-=F,d.length-=F;do{p[P++]=k[a++]}while(--F);0===d.length&&(d.mode=21);break;case 26:if(0===X)break E;p[P++]=d.length,X--,d.mode=21;break;case 27:if(d.wrap){for(;U<32;){if(0===j)break E;j--,W|=i[f++]<<U,U+=8}if(o-=X,E.total_out+=o,d.total+=o,o&&(E.adler=d.check=d.flags?Z(d.check,p,o,P-o):n(d.check,p,o,P-o)),o=X,(d.flags?W:s(W))!==d.check){E.tH="incorrect data check",d.mode=e;break}W=0,U=0}d.mode=28;case 28:if(d.wrap&&d.flags){for(;U<32;){if(0===j)break E;j--,W+=i[f++]<<U,U+=8}if(W!==(4294967295&d.total)){E.tH="incorrect length check",d.mode=e;break}W=0,U=0}d.mode=29;case 29:v=M;break E;case e:v=w;break E;case 31:return R;default:return C}return E.next_out=P,E.avail_out=X,E.next_in=f,E.avail_in=j,d.hold=W,d.bits=U,(d.wsize||o!==E.avail_out&&d.mode<e&&(d.mode<27||H!==l))&&c(E,E.output,E.next_out,o-E.avail_out)?(d.mode=31,R):(u-=E.avail_in,o-=E.avail_out,E.total_in+=u,E.total_out+=o,d.total+=o,d.wrap&&o&&(E.adler=d.check=d.flags?Z(d.check,p,o,E.next_out-o):n(d.check,p,o,E.next_out-o)),E.data_type=d.bits+(d.last?64:0)+(d.mode===D?128:0)+(20===d.mode||15===d.mode?256:0),(0===u&&0===o||H===l)&&v===S&&(v=Q),v)},E.exports.inflateEnd=E=>{if(!E||!E.state)return C;let H=E.state;return H.window&&(H.window=null),E.state=null,S},E.exports.inflateGetHeader=(E,H)=>{if(!E||!E.state)return C;const d=E.state;return 0===(2&d.wrap)?C:(d.head=H,H.done=!1,S)},E.exports.inflateSetDictionary=(E,H)=>{const d=H.length;let Z,I,g;return E&&E.state?(Z=E.state,0!==Z.wrap&&11!==Z.mode?C:11===Z.mode&&(I=1,I=n(I,H,d,0),I!==Z.check)?w:(g=c(E,H,d,d),g?(Z.mode=31,R):(Z.havedict=1,S))):C},E.exports.inflateInfo="pako inflate (from Nodeca project)"},13601:E=>{"use strict";const H=15,d=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),n=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Z=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),I=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);E.exports=(E,g,l,r,t,S,M,V)=>{const C=V.bits;let w,R,Q,L,D,e,s=0,i=0,p=0,f=0,P=0,j=0,X=0,W=0,U=0,Y=0,c=null,u=0;const o=new Uint16Array(16),F=new Uint16Array(16);let a,k,O,G=null,x=0;for(s=0;s<=H;s++)o[s]=0;for(i=0;i<r;i++)o[g[l+i]]++;for(P=C,f=H;f>=1&&0===o[f];f--);if(P>f&&(P=f),0===f)return t[S++]=20971520,t[S++]=20971520,V.bits=1,0;for(p=1;p<f&&0===o[p];p++);for(P<p&&(P=p),W=1,s=1;s<=H;s++)if(W<<=1,W-=o[s],W<0)return-1;if(W>0&&(0===E||1!==f))return-1;for(F[1]=0,s=1;s<H;s++)F[s+1]=F[s]+o[s];for(i=0;i<r;i++)0!==g[l+i]&&(M[F[g[l+i]]++]=i);if(0===E?(c=G=M,e=19):1===E?(c=d,u-=257,G=n,x-=257,e=256):(c=Z,G=I,e=-1),Y=0,i=0,s=p,D=S,j=P,X=0,Q=-1,U=1<<P,L=U-1,1===E&&U>852||2===E&&U>592)return 1;for(;;){a=s-X,M[i]<e?(k=0,O=M[i]):M[i]>e?(k=G[x+M[i]],O=c[u+M[i]]):(k=96,O=0),w=1<<s-X,R=1<<j,p=R;do{R-=w,t[D+(Y>>X)+R]=a<<24|k<<16|O}while(0!==R);for(w=1<<s-1;Y&w;)w>>=1;if(0!==w?(Y&=w-1,Y+=w):Y=0,i++,0===--o[s]){if(s===f)break;s=g[l+M[i]]}if(s>P&&(Y&L)!==Q){for(0===X&&(X=P),D+=p,j=s-X,W=1<<j;j+X<f&&(W-=o[j+X],!(W<=0));)j++,W<<=1;if(U+=1<<j,1===E&&U>852||2===E&&U>592)return 1;Q=Y&L,t[Q]=P<<24|j<<16|D-S}}return 0!==Y&&(t[D+Y]=s-X<<24|64<<16),V.bits=P,0}},13545:E=>{"use strict";E.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13527:E=>{"use strict";function H(E){let H=E.length;for(;--H>=0;)E[H]=0}const d=256,n=286,Z=30,I=15,g=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),l=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),t=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),S=new Array(576);H(S);const M=new Array(60);H(M);const V=new Array(512);H(V);const C=new Array(256);H(C);const w=new Array(29);H(w);const R=new Array(Z);function Q(E,H,d,n,Z){this.static_tree=E,this.extra_bits=H,this.extra_base=d,this.elems=n,this.max_length=Z,this.has_stree=E&&E.length}let L,D,e;function s(E,H){this.dyn_tree=E,this.max_code=0,this.stat_desc=H}H(R);const i=E=>E<256?V[E]:V[256+(E>>>7)],p=(E,H)=>{E.pending_buf[E.pending++]=255&H,E.pending_buf[E.pending++]=H>>>8&255},f=(E,H,d)=>{E.bi_valid>16-d?(E.bi_buf|=H<<E.bi_valid&65535,p(E,E.bi_buf),E.bi_buf=H>>16-E.bi_valid,E.bi_valid+=d-16):(E.bi_buf|=H<<E.bi_valid&65535,E.bi_valid+=d)},P=(E,H,d)=>{f(E,d[2*H],d[2*H+1])},j=(E,H)=>{let d=0;do{d|=1&E,E>>>=1,d<<=1}while(--H>0);return d>>>1},X=(E,H,d)=>{const n=new Array(16);let Z,g,l=0;for(Z=1;Z<=I;Z++)n[Z]=l=l+d[Z-1]<<1;for(g=0;g<=H;g++){let H=E[2*g+1];0!==H&&(E[2*g]=j(n[H]++,H))}},W=E=>{let H;for(H=0;H<n;H++)E.dyn_ltree[2*H]=0;for(H=0;H<Z;H++)E.dyn_dtree[2*H]=0;for(H=0;H<19;H++)E.bl_tree[2*H]=0;E.dyn_ltree[512]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0},U=E=>{E.bi_valid>8?p(E,E.bi_buf):E.bi_valid>0&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0},Y=(E,H,d,n)=>{const Z=2*H,I=2*d;return E[Z]<E[I]||E[Z]===E[I]&&n[H]<=n[d]},c=(E,H,d)=>{const n=E.heap[d];let Z=d<<1;for(;Z<=E.heap_len&&(Z<E.heap_len&&Y(H,E.heap[Z+1],E.heap[Z],E.depth)&&Z++,!Y(H,n,E.heap[Z],E.depth));)E.heap[d]=E.heap[Z],d=Z,Z<<=1;E.heap[d]=n},u=(E,H,n)=>{let Z,I,r,t,S=0;if(0!==E.last_lit)do{Z=E.pending_buf[E.d_buf+2*S]<<8|E.pending_buf[E.d_buf+2*S+1],I=E.pending_buf[E.l_buf+S],S++,0===Z?P(E,I,H):(r=C[I],P(E,r+d+1,H),t=g[r],0!==t&&(I-=w[r],f(E,I,t)),Z--,r=i(Z),P(E,r,n),t=l[r],0!==t&&(Z-=R[r],f(E,Z,t)))}while(S<E.last_lit);P(E,256,H)},o=(E,H)=>{const d=H.dyn_tree,n=H.stat_desc.static_tree,Z=H.stat_desc.has_stree,g=H.stat_desc.elems;let l,r,t,S=-1;for(E.heap_len=0,E.heap_max=573,l=0;l<g;l++)0!==d[2*l]?(E.heap[++E.heap_len]=S=l,E.depth[l]=0):d[2*l+1]=0;for(;E.heap_len<2;)t=E.heap[++E.heap_len]=S<2?++S:0,d[2*t]=1,E.depth[t]=0,E.opt_len--,Z&&(E.static_len-=n[2*t+1]);for(H.max_code=S,l=E.heap_len>>1;l>=1;l--)c(E,d,l);t=g;do{l=E.heap[1],E.heap[1]=E.heap[E.heap_len--],c(E,d,1),r=E.heap[1],E.heap[--E.heap_max]=l,E.heap[--E.heap_max]=r,d[2*t]=d[2*l]+d[2*r],E.depth[t]=(E.depth[l]>=E.depth[r]?E.depth[l]:E.depth[r])+1,d[2*l+1]=d[2*r+1]=t,E.heap[1]=t++,c(E,d,1)}while(E.heap_len>=2);E.heap[--E.heap_max]=E.heap[1],((E,H)=>{const d=H.dyn_tree,n=H.max_code,Z=H.stat_desc.static_tree,g=H.stat_desc.has_stree,l=H.stat_desc.extra_bits,r=H.stat_desc.extra_base,t=H.stat_desc.max_length;let S,M,V,C,w,R,Q=0;for(C=0;C<=I;C++)E.bl_count[C]=0;for(d[2*E.heap[E.heap_max]+1]=0,S=E.heap_max+1;S<573;S++)M=E.heap[S],C=d[2*d[2*M+1]+1]+1,C>t&&(C=t,Q++),d[2*M+1]=C,M>n||(E.bl_count[C]++,w=0,M>=r&&(w=l[M-r]),R=d[2*M],E.opt_len+=R*(C+w),g&&(E.static_len+=R*(Z[2*M+1]+w)));if(0!==Q){do{for(C=t-1;0===E.bl_count[C];)C--;E.bl_count[C]--,E.bl_count[C+1]+=2,E.bl_count[t]--,Q-=2}while(Q>0);for(C=t;0!==C;C--)for(M=E.bl_count[C];0!==M;)V=E.heap[--S],V>n||(d[2*V+1]!==C&&(E.opt_len+=(C-d[2*V+1])*d[2*V],d[2*V+1]=C),M--)}})(E,H),X(d,S,E.bl_count)},F=(E,H,d)=>{let n,Z,I=-1,g=H[1],l=0,r=7,t=4;for(0===g&&(r=138,t=3),H[2*(d+1)+1]=65535,n=0;n<=d;n++)Z=g,g=H[2*(n+1)+1],++l<r&&Z===g||(l<t?E.bl_tree[2*Z]+=l:0!==Z?(Z!==I&&E.bl_tree[2*Z]++,E.bl_tree[32]++):l<=10?E.bl_tree[34]++:E.bl_tree[36]++,l=0,I=Z,0===g?(r=138,t=3):Z===g?(r=6,t=3):(r=7,t=4))},a=(E,H,d)=>{let n,Z,I=-1,g=H[1],l=0,r=7,t=4;for(0===g&&(r=138,t=3),n=0;n<=d;n++)if(Z=g,g=H[2*(n+1)+1],!(++l<r&&Z===g)){if(l<t)do{P(E,Z,E.bl_tree)}while(0!==--l);else 0!==Z?(Z!==I&&(P(E,Z,E.bl_tree),l--),P(E,16,E.bl_tree),f(E,l-3,2)):l<=10?(P(E,17,E.bl_tree),f(E,l-3,3)):(P(E,18,E.bl_tree),f(E,l-11,7));l=0,I=Z,0===g?(r=138,t=3):Z===g?(r=6,t=3):(r=7,t=4)}};let k=!1;const O=(E,H,d,n)=>{f(E,0+(n?1:0),3),((E,H,d,n)=>{U(E),n&&(p(E,d),p(E,~d)),E.pending_buf.set(E.window.subarray(H,H+d),E.pending),E.pending+=d})(E,H,d,!0)};E.exports._tr_init=E=>{k||((()=>{let E,H,d,t,s;const i=new Array(16);for(d=0,t=0;t<28;t++)for(w[t]=d,E=0;E<1<<g[t];E++)C[d++]=t;for(C[d-1]=t,s=0,t=0;t<16;t++)for(R[t]=s,E=0;E<1<<l[t];E++)V[s++]=t;for(s>>=7;t<Z;t++)for(R[t]=s<<7,E=0;E<1<<l[t]-7;E++)V[256+s++]=t;for(H=0;H<=I;H++)i[H]=0;for(E=0;E<=143;)S[2*E+1]=8,E++,i[8]++;for(;E<=255;)S[2*E+1]=9,E++,i[9]++;for(;E<=279;)S[2*E+1]=7,E++,i[7]++;for(;E<=287;)S[2*E+1]=8,E++,i[8]++;for(X(S,287,i),E=0;E<Z;E++)M[2*E+1]=5,M[2*E]=j(E,5);L=new Q(S,g,257,n,I),D=new Q(M,l,0,Z,I),e=new Q(new Array(0),r,0,19,7)})(),k=!0),E.l_desc=new s(E.dyn_ltree,L),E.d_desc=new s(E.dyn_dtree,D),E.bl_desc=new s(E.bl_tree,e),E.bi_buf=0,E.bi_valid=0,W(E)},E.exports._tr_stored_block=O,E.exports._tr_flush_block=(E,H,n,Z)=>{let I,g,l=0;E.level>0?(2===E.strm.data_type&&(E.strm.data_type=(E=>{let H,n=4093624447;for(H=0;H<=31;H++,n>>>=1)if(1&n&&0!==E.dyn_ltree[2*H])return 0;if(0!==E.dyn_ltree[18]||0!==E.dyn_ltree[20]||0!==E.dyn_ltree[26])return 1;for(H=32;H<d;H++)if(0!==E.dyn_ltree[2*H])return 1;return 0})(E)),o(E,E.l_desc),o(E,E.d_desc),l=(E=>{let H;for(F(E,E.dyn_ltree,E.l_desc.max_code),F(E,E.dyn_dtree,E.d_desc.max_code),o(E,E.bl_desc),H=18;H>=3&&0===E.bl_tree[2*t[H]+1];H--);return E.opt_len+=3*(H+1)+5+5+4,H})(E),I=E.opt_len+3+7>>>3,g=E.static_len+3+7>>>3,g<=I&&(I=g)):I=g=n+5,n+4<=I&&-1!==H?O(E,H,n,Z):4===E.strategy||g===I?(f(E,2+(Z?1:0),3),u(E,S,M)):(f(E,4+(Z?1:0),3),((E,H,d,n)=>{let Z;for(f(E,H-257,5),f(E,d-1,5),f(E,n-4,4),Z=0;Z<n;Z++)f(E,E.bl_tree[2*t[Z]+1],3);a(E,E.dyn_ltree,H-1),a(E,E.dyn_dtree,d-1)})(E,E.l_desc.max_code+1,E.d_desc.max_code+1,l+1),u(E,E.dyn_ltree,E.dyn_dtree)),W(E),Z&&U(E)},E.exports._tr_tally=(E,H,n)=>(E.pending_buf[E.d_buf+2*E.last_lit]=H>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&H,E.pending_buf[E.l_buf+E.last_lit]=255&n,E.last_lit++,0===H?E.dyn_ltree[2*n]++:(E.matches++,H--,E.dyn_ltree[2*(C[n]+d+1)]++,E.dyn_dtree[2*i(H)]++),E.last_lit===E.lit_bufsize-1),E.exports._tr_align=E=>{f(E,2,3),P(E,256,S),(E=>{16===E.bi_valid?(p(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):E.bi_valid>=8&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)})(E)}},13577:E=>{"use strict";E.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.tH="",this.state=null,this.data_type=2,this.adler=0}},13185:E=>{function H(E,H,d){for(var n=E.length,Z=-1/0,I=1/0,g=0;g<n;g++){var l=(d[0][g]-E[g])/H[g],r=(d[1][g]-E[g])/H[g];if(l>r){var t=l;l=r,r=t}if(r<Z||l>I)return 1/0;l>Z&&(Z=l),r<I&&(I=r)}return Z>I?1/0:Z}E.exports=function(E,d,n,Z){var I=H(d,n,Z);if(I===1/0)E=null;else{E=E||[];for(var g=0;g<d.length;g++)E[g]=d[g]+n[g]*I}return E},E.exports.distance=H},14557:(E,H,d)=>{"use strict";d.d(H,{b:()=>g});var n=d(39);const Z=n.useLayoutEffect;const I=function(E){var H=(0,n.useRef)(E);return Z((function(){H.current=E})),H};var g=function(E){var H=I(E);(0,n.gH)((function(){var E=function(E){var d;if(null!=H.current&&(d=H.current(E)),E.defaultPrevented&&(E.returnValue=""),"string"===typeof d)return E.returnValue=d,d};return window.addEventListener("beforeunload",E),function(){window.removeEventListener("beforeunload",E)}}),[])}},14502:(E,H,d)=>{"use strict";var n=d(14511),Z=Array.prototype.concat,I=Array.prototype.slice,g=E.exports=function(E){for(var H=[],d=0,g=E.length;d<g;d++){var l=E[d];n(l)?H=Z.call(H,I.call(l)):H.push(l)}return H};g.wrap=function(E){return function(){return E(g(arguments))}}},14511:E=>{E.exports=function(E){return!(!E||"string"===typeof E)&&(E instanceof Array||Array.isArray(E)||E.length>=0&&(E.splice instanceof Function||Object.getOwnPropertyDescriptor(E,E.length-1)&&"String"!==E.constructor.name))}},13457:(E,H,d)=>{var n=d(13461);function Z(E){for(var H,d,Z=0,I=E.length,g=0;g<E.length;){for(H=E[g],d=0;g<I&&E[g]===H;)++g,++d;Z+=n.log2(d)/7|0,Z+=n.log2(H>>>0)/7|0,Z+=2}return Z}H.size=Z,H.encode=function(E,H){H||(H=new Uint8Array(Z(E)));for(var d,n,I=0,g=H.length,l=0;l<E.length;){for(d=E[l],n=0;l<E.length&&E[l]===d;)++l,++n;for(;I<g&&n>=128;)H[I++]=128+(127&n),n>>>=7;if(I>=g)throw new Error("RLE buffer overflow");for(H[I++]=n,d>>>=0;I<g&&d>=128;)H[I++]=128+(127&d),d>>>=7;if(I>=g)throw new Error("RLE buffer overflow");H[I++]=d}return H},H.decode=function(E,H){for(var d,n,Z,I,g=H.length,l=E.length,r=0,t=0;t<l;){for(d=0,n=0;t<l&&E[t]>=128;)d+=(127&E[t++])<<n,n+=7;if(d+=E[t++]<<n,t>=l)throw new Error("RLE buffer underrun");if(r+d>g)throw new Error("Chunk buffer overflow");for(Z=0,n=0;t<l&&E[t]>=128;)Z+=(127&E[t++])<<n,n+=7;if(t>=l)throw new Error("RLE buffer underrun");for(Z+=E[t++]<<n,I=0;I<d;++I)H[r++]=Z}return H}},13461:(E,H)=>{"use strict";function d(E){var H=32;return(E&=-E)&&H--,65535&E&&(H-=16),16711935&E&&(H-=8),252645135&E&&(H-=4),858993459&E&&(H-=2),1431655765&E&&(H-=1),H}H.INT_BITS=32,H.INT_MAX=2147483647,H.INT_MIN=-1<<31,H.sign=function(E){return(E>0)-(E<0)},H.abs=function(E){var H=E>>31;return(E^H)-H},H.min=function(E,H){return H^(E^H)&-(E<H)},H.max=function(E,H){return E^(E^H)&-(E<H)},H.isPow2=function(E){return!(E&E-1)&&!!E},H.log2=function(E){var H,d;return H=(E>65535)<<4,H|=d=((E>>>=H)>255)<<3,H|=d=((E>>>=d)>15)<<2,(H|=d=((E>>>=d)>3)<<1)|(E>>>=d)>>1},H.log10=function(E){return E>=1e9?9:E>=1e8?8:E>=1e7?7:E>=1e6?6:E>=1e5?5:E>=1e4?4:E>=1e3?3:E>=100?2:E>=10?1:0},H.popCount=function(E){return 16843009*((E=(858993459&(E-=E>>>1&1431655765))+(E>>>2&858993459))+(E>>>4)&252645135)>>>24},H.countTrailingZeros=d,H.nextPow2=function(E){return E+=0===E,--E,E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)+1},H.prevPow2=function(E){return E|=E>>>1,E|=E>>>2,E|=E>>>4,E|=E>>>8,(E|=E>>>16)-(E>>>1)},H.parity=function(E){return E^=E>>>16,E^=E>>>8,E^=E>>>4,27030>>>(E&=15)&1};var n=new Array(256);!function(E){for(var H=0;H<256;++H){var d=H,n=H,Z=7;for(d>>>=1;d;d>>>=1)n<<=1,n|=1&d,--Z;E[H]=n<<Z&255}}(n),H.reverse=function(E){return n[255&E]<<24|n[E>>>8&255]<<16|n[E>>>16&255]<<8|n[E>>>24&255]},H.interleave2=function(E,H){return(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))|(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))<<1},H.deinterleave2=function(E,H){return(E=65535&((E=16711935&((E=252645135&((E=858993459&((E=E>>>H&1431655765)|E>>>1))|E>>>2))|E>>>4))|E>>>16))<<16>>16},H.interleave3=function(E,H,d){return E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2),(E|=(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<1)|(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<2},H.deinterleave3=function(E,H){return(E=1023&((E=4278190335&((E=251719695&((E=3272356035&((E=E>>>H&1227133513)|E>>>2))|E>>>4))|E>>>8))|E>>>16))<<22>>22},H.nextCombination=function(E){var H=E|E-1;return H+1|(~H&-~H)-1>>>d(E)+1}},13498:E=>{"use strict";E.exports=function(E,H,d,n){var Z=self||window;try{try{var I;try{I=new Z.Blob([E])}catch(t){(I=new(Z.BlobBuilder||Z.WebKitBlobBuilder||Z.MozBlobBuilder||Z.MSBlobBuilder)).append(E),I=I.getBlob()}var g=Z.URL||Z.webkitURL,l=g.createObjectURL(I),r=new Z[H](l,d);return g.revokeObjectURL(l),r}catch(t){return new Z[H]("data:application/javascript,".concat(encodeURIComponent(E)),d)}}catch(t){if(!n)throw Error("Inline worker is not supported");return new Z[H](n,d)}}},13175:(E,H,d)=>{"use strict";function n(E,H,d,n,Z){var I={};return Object.keys(n).forEach((function(E){I[E]=n[E]})),I.enumerable=!!I.enumerable,I.configurable=!!I.configurable,("value"in I||I.initializer)&&(I.writable=!0),I=d.slice().reverse().reduce((function(d,n){return n(E,H,d)||d}),I),Z&&void 0!==I.initializer&&(I.value=I.initializer?I.initializer.call(Z):void 0,I.initializer=void 0),void 0===I.initializer&&(Object.defineProperty(E,H,I),I=null),I}d.d(H,{b:()=>n})},13171:(E,H,d)=>{"use strict";function n(E,H,d,n){d&&Object.defineProperty(E,H,{enumerable:d.enumerable,configurable:d.configurable,writable:d.writable,value:d.initializer?d.initializer.call(n):void 0})}d.d(H,{e:()=>n})},14545:(E,H,d)=>{"use strict";d.d(H,{b:()=>g,d:()=>M,e:()=>l,i:()=>I,l:()=>r,p:()=>Z,r:()=>t,t:()=>S});var n=d(12608);class Z{constructor(){this._easingMode=Z.EASINGMODE_EASEIN}setEasingMode(E){const H=Math.min(Math.max(E,0),2);this._easingMode=H}getEasingMode(){return this._easingMode}easeInCore(E){throw new Error("You must implement this method")}ease(E){switch(this._easingMode){case Z.EASINGMODE_EASEIN:return this.easeInCore(E);case Z.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-E)}return E>=.5?.5*(1-this.easeInCore(2*(1-E)))+.5:.5*this.easeInCore(2*E)}}Z.EASINGMODE_EASEIN=0,Z.EASINGMODE_EASEOUT=1,Z.EASINGMODE_EASEINOUT=2;class I extends Z{easeInCore(E){return E=Math.max(0,Math.min(1,E)),1-Math.sqrt(1-E*E)}}class g extends Z{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=E}easeInCore(E){const H=Math.max(0,this.amplitude);return Math.pow(E,3)-E*H*Math.sin(3.141592653589793*E)}}class l extends Z{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=E,this.bounciness=H}easeInCore(E){const H=Math.max(0,this.bounces);let d=this.bounciness;d<=1&&(d=1.001);const n=Math.pow(d,H),Z=1-d,I=(1-n)/Z+.5*n,g=E*I,l=Math.log(-g*(1-d)+1)/Math.log(d),r=Math.floor(l),t=r+1,S=(1-Math.pow(d,r))/(Z*I),M=.5*(S+(1-Math.pow(d,t))/(Z*I)),V=E-M,C=M-S;return-Math.pow(1/d,H-r)/(C*C)*(V-C)*(V+C)}}class r extends Z{easeInCore(E){return E*E*E}}class t extends Z{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=E,this.springiness=H}easeInCore(E){let H;const d=Math.max(0,this.oscillations),n=Math.max(0,this.springiness);return H=0==n?E:(Math.exp(n*E)-1)/(Math.exp(n)-1),H*Math.sin((6.283185307179586*d+1.5707963267948966)*E)}}class S extends Z{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=E}easeInCore(E){return this.exponent<=0?E:(Math.exp(this.exponent*E)-1)/(Math.exp(this.exponent)-1)}}class M extends Z{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=E,this.y1=H,this.x2=d,this.y2=n}easeInCore(E){return n.b.Interpolate(E,this.x1,this.y1,this.x2,this.y2)}}},14027:(E,H,d)=>{"use strict";d.d(H,{e:()=>g});var n=d(12384),Z=d(12399),I=d(12815);class g extends I.c{get _matrix(){return this._compose(),this.YV}set _matrix(E){(E.updateFlag!==this.YV.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.YV.l(E),this._markAsDirtyAndDecompose())}constructor(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(E,H.fE(),!1),this.name=E,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=H,this.YV=(null===Z||void 0===Z?void 0:Z.clone())??n.Matrix.Identity(),this._restMatrix=I??this.YV.clone(),this._bindMatrix=g??this.YV.clone(),this._index=l,this._absoluteMatrix=new n.Matrix,this._absoluteBindMatrix=new n.Matrix,this._absoluteInverseBindMatrix=new n.Matrix,this._finalMatrix=new n.Matrix,H.bones.push(this),this.setParent(d,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(E){this.setParent(E)}setParent(E){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==E){if(this.parent){const E=this.parent.children.indexOf(this);-1!==E&&this.parent.children.splice(E,1)}this._parentNode=E,this.parent&&this.parent.children.push(this),H&&this._updateAbsoluteBindMatrices(),this.HS()}}getLocalMatrix(){return this._compose(),this.YV}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(E){this._restMatrix.l(E)}setRestPose(E){this.setRestMatrix(E)}getBindPose(){return this.getBindMatrix()}setBindMatrix(E){this.bd(E)}setBindPose(E){this.setBindMatrix(E)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const E=n.TmpVectors.wH[0],H=n.TmpVectors.Quaternion[0],d=n.TmpVectors.wH[1];this.getRestMatrix().decompose(E,H,d),this._linkedTransformNode.position.l(d),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??n.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.l(H),this._linkedTransformNode.mg.l(E)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(E){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=E,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Er}set position(E){this._decompose(),this.Er.l(E),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(E){this.setRotation(E)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(E){this.setRotationQuaternion(E)}get mg(){return this.getScale()}set mg(E){this.setScale(E)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=n.wH.Zero(),this._localRotation=n.Quaternion.Zero(),this.Er=n.wH.Zero()),this.YV.decompose(this._localScaling,this._localRotation,this.Er))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,n.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Er,this.YV)):this._needToCompose=!1)}bd(E){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.l(E),H&&this._updateAbsoluteBindMatrices(),d?this._matrix=E:this.HS()}_updateAbsoluteBindMatrices(E){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(E||(E=this._bindMatrix),this.parent?E.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.l(E),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),H)for(let d=0;d<this.children.length;d++)this.children[d]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}HS(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.HS(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.HS(),this._needToDecompose=!0}_updatePosition(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const I=this.getLocalMatrix();if(0==H)Z?(I.addAtIndex(12,E.x),I.addAtIndex(13,E.y),I.addAtIndex(14,E.z)):I.setTranslationFromFloats(E.x,E.y,E.z);else{let H=null;d&&(H=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=g._TmpMats[0],r=g._TmpVecs[0];this.parent?d&&H?(l.l(this.parent.getAbsoluteMatrix()),l.multiplyToRef(H,l)):l.l(this.parent.getAbsoluteMatrix()):n.Matrix.IdentityToRef(l),Z&&l.setTranslationFromFloats(0,0,0),l.invert(),n.wH.TransformCoordinatesToRef(E,l,r),Z?(I.addAtIndex(12,r.x),I.addAtIndex(13,r.y),I.addAtIndex(14,r.z)):I.setTranslationFromFloats(r.x,r.y,r.z)}this._markAsDirtyAndDecompose()}translate(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;this._updatePosition(E,H,d,!0)}setPosition(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;this._updatePosition(E,H,d,!1)}setAbsolutePosition(E,H){this.setPosition(E,1,H)}scale(E,H,d){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const I=this.getLocalMatrix(),l=g._TmpMats[0];n.Matrix.ScalingToRef(E,H,d,l),l.multiplyToRef(I,I),l.invert();for(const n of this.children){const Z=n.getLocalMatrix();Z.multiplyToRef(l,Z),Z.multiplyAtIndex(12,E),Z.multiplyAtIndex(13,H),Z.multiplyAtIndex(14,d),n._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),Z)for(const n of this.children)n.scale(E,H,d,Z)}setScale(E){this._decompose(),this._localScaling.l(E),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(E){this._decompose(),E.l(this._localScaling)}setYawPitchRoll(E,H,d){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4?arguments[4]:void 0;if(0===Z){const l=g._TmpQuat;return n.Quaternion.RotationYawPitchRollToRef(E,H,d,l),void this.setRotationQuaternion(l,Z,I)}const l=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(l,I))return;const r=g._TmpMats[1];n.Matrix.RotationYawPitchRollToRef(E,H,d,r),l.multiplyToRef(r,r),this._rotateWithMatrix(r,Z,I)}rotate(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3?arguments[3]:void 0;const I=g._TmpMats[0];I.setTranslationFromFloats(0,0,0),n.Matrix.RotationAxisToRef(E,H,I),this._rotateWithMatrix(I,d,Z)}setAxisAngle(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3?arguments[3]:void 0;if(0===d){const I=g._TmpQuat;return n.Quaternion.RotationAxisToRef(E,H,I),void this.setRotationQuaternion(I,d,Z)}const I=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(I,Z))return;const l=g._TmpMats[1];n.Matrix.RotationAxisToRef(E,H,l),I.multiplyToRef(l,l),this._rotateWithMatrix(l,d,Z)}setRotation(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(E.y,E.x,E.z,H,d)}setRotationQuaternion(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;if(0===H)return this._decompose(),this._localRotation.l(E),void this._markAsDirtyAndCompose();const Z=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Z,d))return;const I=g._TmpMats[1];n.Matrix.FromQuaternionToRef(E,I),Z.multiplyToRef(I,I),this._rotateWithMatrix(I,H,d)}setRotationMatrix(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;if(0===H){const Z=g._TmpQuat;return n.Quaternion.FromRotationMatrixToRef(E,Z),void this.setRotationQuaternion(Z,H,d)}const Z=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Z,d))return;const I=g._TmpMats[1];I.l(E),Z.multiplyToRef(E,I),this._rotateWithMatrix(I,H,d)}_rotateWithMatrix(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;const n=this.getLocalMatrix(),Z=n.m[12],I=n.m[13],l=n.m[14],r=this.getParent(),t=g._TmpMats[3],S=g._TmpMats[4];r&&1==H?(d?(t.l(d.getWorldMatrix()),r.getAbsoluteMatrix().multiplyToRef(t,t)):t.l(r.getAbsoluteMatrix()),S.l(t),S.invert(),n.multiplyToRef(t,n),n.multiplyToRef(E,n),n.multiplyToRef(S,n)):1==H&&d?(t.l(d.getWorldMatrix()),S.l(t),S.invert(),n.multiplyToRef(t,n),n.multiplyToRef(E,n),n.multiplyToRef(S,n)):n.multiplyToRef(E,n),n.setTranslationFromFloats(Z,I,l),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(E,H){const d=g._TmpMats[2];return E.l(this.getAbsoluteMatrix()),H?(E.multiplyToRef(H.getWorldMatrix(),E),n.Matrix.ScalingToRef(H.mg.x,H.mg.y,H.mg.z,d)):n.Matrix.IdentityToRef(d),E.invert(),!isNaN(E.m[0])&&(d.multiplyAtIndex(0,this._scalingDeterminant),E.multiplyToRef(d,E),!0)}Zd(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=n.wH.Zero();return this.getPositionToRef(E,H,d),d}getPositionToRef(){let E=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const E=this.getLocalMatrix();H.x=E.m[12],H.y=E.m[13],H.z=E.m[14]}else{let d=null;E&&(d=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let n=g._TmpMats[0];E&&d?(n.l(this.getAbsoluteMatrix()),n.multiplyToRef(d,n)):n=this.getAbsoluteMatrix(),H.x=n.m[12],H.y=n.m[13],H.z=n.m[14]}}getAbsolutePosition(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const H=n.wH.Zero();return this.getPositionToRef(1,E,H),H}getAbsolutePositionToRef(E,H){this.getPositionToRef(1,E,H)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.YV.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.l(this.YV);const E=this._skeleton.getPoseMatrix();E&&this._absoluteMatrix.multiplyToRef(E,this._absoluteMatrix)}const E=this.children,H=E.length;for(let d=0;d<H;d++)E[d].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Ur(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=n.wH.Zero();return this.getDirectionToRef(E,H,d),d}getDirectionToRef(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0,Z=null;H&&(Z=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const I=g._TmpMats[0];I.l(this.getAbsoluteMatrix()),H&&Z&&I.multiplyToRef(Z,I),n.wH.TransformNormalToRef(E,I,d),d.normalize()}getRotation(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=n.wH.Zero();return this.getRotationToRef(E,H,d),d}getRotationToRef(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;const n=g._TmpQuat;this.getRotationQuaternionToRef(E,H,n),n.toEulerAnglesToRef(d)}getRotationQuaternion(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=n.Quaternion.Identity();return this.getRotationQuaternionToRef(E,H,d),d}getRotationQuaternionToRef(){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),H.l(this._localRotation);else{const d=g._TmpMats[0],n=this.getAbsoluteMatrix();E?n.multiplyToRef(E.getWorldMatrix(),d):d.l(n),d.multiplyAtIndex(0,this._scalingDeterminant),d.multiplyAtIndex(1,this._scalingDeterminant),d.multiplyAtIndex(2,this._scalingDeterminant),d.decompose(void 0,H,void 0)}}getRotationMatrix(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1?arguments[1]:void 0;const d=n.Matrix.Identity();return this.getRotationMatrixToRef(E,H,d),d}getRotationMatrixToRef(){let E=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(H);else{const d=g._TmpMats[0],n=this.getAbsoluteMatrix();E?n.multiplyToRef(E.getWorldMatrix(),d):d.l(n),d.multiplyAtIndex(0,this._scalingDeterminant),d.multiplyAtIndex(1,this._scalingDeterminant),d.multiplyAtIndex(2,this._scalingDeterminant),d.getRotationMatrixToRef(H)}}getAbsolutePositionFromLocal(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=n.wH.Zero();return this.getAbsolutePositionFromLocalToRef(E,H,d),d}getAbsolutePositionFromLocalToRef(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0,Z=null;H&&(Z=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const I=g._TmpMats[0];I.l(this.getAbsoluteMatrix()),H&&Z&&I.multiplyToRef(Z,I),n.wH.TransformCoordinatesToRef(E,I,d)}getLocalPositionFromAbsolute(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=n.wH.Zero();return this.getLocalPositionFromAbsoluteToRef(E,H,d),d}getLocalPositionFromAbsoluteToRef(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0,Z=null;H&&(Z=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const I=g._TmpMats[0];I.l(this.getAbsoluteMatrix()),H&&Z&&I.multiplyToRef(Z,I),I.invert(),n.wH.TransformCoordinatesToRef(E,I,d)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const E=this._skeleton.bones.indexOf(this);if(-1!==E&&this._skeleton.bones.splice(E,1),this._parentNode&&this._parentNode.children){const E=this._parentNode.children,H=E.indexOf(this);-1!==H&&E.splice(H,1)}super.dispose()}}g._TmpVecs=(0,Z.e)(2,n.wH.Zero),g._TmpQuat=n.Quaternion.Identity(),g._TmpMats=(0,Z.e)(5,n.Matrix.Identity)},14539:(E,H,d)=>{"use strict";d.d(H,{b:()=>o});var n=d(12369),Z=d(12372),I=d(12230),g=d(12384),l=d(12406),r=d(12815),t=d(12840),S=d(12670),M=d(12247),V=d(12391);class C{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(E){this._zoomStopsAnimation=E}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(E){this._idleRotationSpeed=E}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(E){this._idleRotationWaitTime=E}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(E){this._idleRotationSpinupTime=E}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(E){this._attachedCamera=E;const H=this._attachedCamera.fE();this._onPrePointerObservableObserver=H.onPrePointerObservable.add((E=>{E.type!==S.e.POINTERDOWN?E.type===S.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const E=M.b.Now;let H=0;null!=this._lastFrameTime&&(H=E-this._lastFrameTime),this._lastFrameTime=E,this._applyUserInteraction();const d=E-this._lastInteractionTime-this._idleRotationWaitTime,n=Math.max(Math.min(d/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*n,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(H/1e3))}))}detach(){if(!this._attachedCamera)return;const E=this._attachedCamera.fE();this._onPrePointerObservableObserver&&E.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(E){this._lastInteractionTime=E??M.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<V.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let E=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(E=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?E:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=M.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var w=d(14545),R=d(12910);class Q{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(E){if(this._autoTransitionRange===E)return;this._autoTransitionRange=E;const H=this._attachedCamera;H&&(E?this._onMeshTargetChangedObserver=H.onMeshTargetChangedObservable.add((E=>{if(E&&(E.yd(!0),E.getBoundingInfo)){const H=E.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*H,this.upperRadiusTransitionRange=.05*H}})):this._onMeshTargetChangedObserver&&H.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(E){this._attachedCamera=E,this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(E){return!!this._attachedCamera&&(this._attachedCamera.radius===E&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(E){if(!this._attachedCamera)return;this._radiusBounceTransition||(Q.EasingFunction.setEasingMode(Q.EasingMode),this._radiusBounceTransition=R.b.CreateAnimation("radius",R.b.ANIMATIONTYPE_FLOAT,60,Q.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const H=R.b.TransitionTo("radius",this._attachedCamera.radius+E,this._attachedCamera,this._attachedCamera.fE(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));H&&this._animatables.push(H)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}Q.EasingFunction=new w.b(.3),Q.EasingMode=w.p.EASINGMODE_EASEOUT;class L{constructor(){this.onTargetFramingAnimationEndObservable=new I.e,this._mode=L.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(E){this._mode=E}get mode(){return this._mode}set radiusScale(E){this._radiusScale=E}get radiusScale(){return this._radiusScale}set positionScale(E){this._positionScale=E}get positionScale(){return this._positionScale}set defaultElevation(E){this._defaultElevation=E}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(E){this._elevationReturnTime=E}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(E){this._elevationReturnWaitTime=E}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(E){this._zoomStopsAnimation=E}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(E){this._framingTime=E}get framingTime(){return this._framingTime}init(){}attach(E){this._attachedCamera=E;const H=this._attachedCamera.fE();L.EasingFunction.setEasingMode(L.EasingMode),this._onPrePointerObservableObserver=H.onPrePointerObservable.add((E=>{E.type!==S.e.POINTERDOWN?E.type===S.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=E.onMeshTargetChangedObservable.add((E=>{E&&E.getBoundingInfo&&this.zoomOnMesh(E,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=E.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const E=this._attachedCamera.fE();this._onPrePointerObservableObserver&&E.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E.yd(!0);const n=E.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(n.minimumWorld,n.maximumWorld,H,d)}zoomOnMeshHierarchy(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E.yd(!0);const n=E.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(n.min,n.max,H,d)}zoomOnMeshesHierarchy(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new g.wH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Z=new g.wH(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let I=0;I<E.length;I++){const H=E[I].getHierarchyBoundingVectors(!0);g.wH.CheckExtends(H.min,n,Z),g.wH.CheckExtends(H.max,n,Z)}this.zoomOnBoundingInfo(n,Z,H,d)}zoomOnBoundingInfo(E,H){let d,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const I=E.y,l=I+(H.y-I)*this._positionScale,r=H.RH(E).scale(.5);if(!isFinite(l))return!1;if(n)d=new g.wH(0,l,0);else{const H=E.add(r);d=new g.wH(H.x,l,H.z)}this._vectorTransition||(this._vectorTransition=R.b.CreateAnimation("target",R.b.ANIMATIONTYPE_VECTOR3,60,L.EasingFunction)),this._betaIsAnimating=!0;let t=R.b.TransitionTo("target",d,this._attachedCamera,this._attachedCamera.fE(),60,this._vectorTransition,this._framingTime);t&&this._animatables.push(t);let S=0;if(this._mode===L.FitFrustumSidesMode){const d=this._calculateLowerRadiusFromModelBoundingSphere(E,H);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=r.length()+this._attachedCamera.Gd),S=d}else this._mode===L.IgnoreBoundsSizeMode&&(S=this._calculateLowerRadiusFromModelBoundingSphere(E,H),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Gd));if(this.autoCorrectCameraLimitsAndSensibility){const d=H.RH(E).length();this._attachedCamera.panningSensibility=5e3/d,this._attachedCamera.wheelPrecision=100/S}return this._radiusTransition||(this._radiusTransition=R.b.CreateAnimation("radius",R.b.ANIMATIONTYPE_FLOAT,60,L.EasingFunction)),t=R.b.TransitionTo("radius",S,this._attachedCamera,this._attachedCamera.fE(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),Z&&Z(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),t&&this._animatables.push(t),!0}_calculateLowerRadiusFromModelBoundingSphere(E,H){const d=this._attachedCamera;if(!d)return 0;let n=d._calculateLowerRadiusFromModelBoundingSphere(E,H,this._radiusScale);return d.lowerRadiusLimit&&this._mode===L.IgnoreBoundsSizeMode&&(n=n<d.lowerRadiusLimit?d.lowerRadiusLimit:n),d.upperRadiusLimit&&(n=n>d.upperRadiusLimit?d.upperRadiusLimit:n),n}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const E=M.b.Now-this._lastInteractionTime,H=.5*Math.PI-this._defaultElevation,d=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>d&&E>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=R.b.CreateAnimation("beta",R.b.ANIMATIONTYPE_FLOAT,60,L.EasingFunction));const E=R.b.TransitionTo("beta",H,this._attachedCamera,this._attachedCamera.fE(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));E&&this._animatables.push(E)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=M.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}L.EasingFunction=new w.t,L.EasingMode=w.p.EASINGMODE_EASEINOUT,L.IgnoreBoundsSizeMode=0,L.FitFrustumSidesMode=1;var D=d(12845),e=d(12871),s=d(14018),i=d(12228);class p{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(E){E=i.Tools.BackCompatCameraNoPreventDefault(arguments);const H=this.camera.getEngine(),d=H.getInputElement();let n=0,Z=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=I=>{var g,l;const r=I.event,t="touch"===r.pointerType;if(I.type!==S.e.POINTERMOVE&&-1===this.buttons.indexOf(r.button))return;const M=r.target;if(this._altKey=r.altKey,this._ctrlKey=r.ctrlKey,this._metaKey=r.metaKey,this._shiftKey=r.shiftKey,this._buttonsPressed=r.buttons,H.isPointerLock){const E=r.movementX,H=r.movementY;this.onTouch(null,E,H),this._pointA=null,this._pointB=null}else{if(I.type!==S.e.POINTERDOWN&&I.type!==S.e.POINTERDOUBLETAP&&t&&(null===(g=this._pointA)||void 0===g?void 0:g.pointerId)!==r.pointerId&&(null===(l=this._pointB)||void 0===l?void 0:l.pointerId)!==r.pointerId)return;if(I.type!==S.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!t)if(I.type===S.e.POINTERDOUBLETAP)this.onDoubleTap(r.pointerType);else if(I.type!==S.e.POINTERUP||this._currentMousePointerIdDown!==r.pointerId&&!t){if(I.type===S.e.POINTERMOVE)if(E||r.preventDefault(),this._pointA&&null===this._pointB){const E=r.clientX-this._pointA.x,H=r.clientY-this._pointA.y;this._pointA.x=r.clientX,this._pointA.y=r.clientY,this.onTouch(this._pointA,E,H)}else if(this._pointA&&this._pointB){const E=this._pointA.pointerId===r.pointerId?this._pointA:this._pointB;E.x=r.clientX,E.y=r.clientY;const H=this._pointA.x-this._pointB.x,d=this._pointA.y-this._pointB.y,g=H*H+d*d,l={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:r.pointerId,type:I.type};this.onMultiTouch(this._pointA,this._pointB,n,g,Z,l),Z=l,n=g}}else{try{null===M||void 0===M||M.releasePointerCapture(r.pointerId)}catch(V){}t||(this._pointB=null),H._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==r.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==r.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==n||Z)&&(this.onMultiTouch(this._pointA,this._pointB,n,0,Z,null),n=0,Z=null),this._currentMousePointerIdDown=-1,this.onButtonUp(r),E||r.preventDefault()}else{try{null===M||void 0===M||M.setPointerCapture(r.pointerId)}catch(V){}if(null===this._pointA)this._pointA={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType};else{if(null!==this._pointB)return;this._pointB={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType}}-1!==this._currentMousePointerIdDown||t||(this._currentMousePointerIdDown=r.pointerId),this.onButtonDown(r),E||(r.preventDefault(),d&&d.focus())}}},this._observer=this.camera.fE()._inputManager._addCameraPointerObserver(this._pointerInput,S.e.POINTERDOWN|S.e.POINTERUP|S.e.POINTERMOVE|S.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,n=0,Z=null,this.onLostFocus()},this._contextMenuBind=E=>this.onContextMenu(E),d&&d.addEventListener("contextmenu",this._contextMenuBind,!1);const I=this.camera.fE().getEngine().getHostWindow();I&&i.Tools.RegisterTopRootEvents(I,[{name:"blur",handler:this._onLostFocus}])}bM(){if(this._onLostFocus){const E=this.camera.fE().getEngine().getHostWindow();E&&i.Tools.UnregisterTopRootEvents(E,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.fE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const E=this.camera.fE().getEngine().getInputElement();E&&E.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(E){}onTouch(E,H,d){}onMultiTouch(E,H,d,n,Z,I){}onContextMenu(E){E.preventDefault()}onButtonDown(E){}onButtonUp(E){}onLostFocus(){}}(0,n.e)([(0,Z.K)()],p.prototype,"buttons",void 0);class f extends p{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(E,H){if(0!==this.panningSensibility&&E&&H){const d=H.x-E.x,n=H.y-E.y;this.camera.inertialPanningX+=-d/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility}}_computePinchZoom(E,H){const d=this.camera.radius||f.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=d*Math.sqrt(E)/Math.sqrt(H):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(H-E)*d*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(H-E)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(E,H,d){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-H/this.panningSensibility,this.camera.inertialPanningY+=d/this.panningSensibility):(this.camera.inertialAlphaOffset-=H/this.angularSensibilityX,this.camera.inertialBetaOffset-=d/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(E,H,d,n,Z,I){0===d&&null===Z||0===n&&null===I||(this.multiTouchPanAndZoom?(this._computePinchZoom(d,n),this._computeMultiTouchPanning(Z,I)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(n)-Math.sqrt(d))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(d,n),this._isPinching=!0):this._computeMultiTouchPanning(Z,I)):this.multiTouchPanning?this._computeMultiTouchPanning(Z,I):this.pinchZoom&&this._computePinchZoom(d,n))}onButtonDown(E){this._isPanClick=E.button===this.camera._panningMouseButton}onButtonUp(E){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}f.MinimumRadiusForPinch=.001,(0,n.e)([(0,Z.K)()],f.prototype,"buttons",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"angularSensibilityX",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"angularSensibilityY",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"pinchPrecision",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"pinchDeltaPercentage",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"useNaturalPinchZoom",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"pinchZoom",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"panningSensibility",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"multiTouchPanning",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"multiTouchPanAndZoom",void 0),s.d.ArcRotateCameraPointersInput=f;var P=d(12679);class j{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(E){E=i.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.fE(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((H=>{const d=H.event;if(!d.metaKey)if(H.type===P.d.KEYDOWN){if(this._ctrlPressed=d.ctrlKey,this._altPressed=d.altKey,-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysReset.indexOf(d.keyCode)){-1===this._keys.indexOf(d.keyCode)&&this._keys.push(d.keyCode),d.preventDefault&&(E||d.preventDefault())}}else if(-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysReset.indexOf(d.keyCode)){const H=this._keys.indexOf(d.keyCode);H>=0&&this._keys.splice(H,1),d.preventDefault&&(E||d.preventDefault())}})))}bM(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const E=this.camera;for(let H=0;H<this._keys.length;H++){const d=this._keys[H];-1!==this.keysLeft.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningX-=1/this.panningSensibility:E.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?E.inertialRadiusOffset+=1/this.zoomingSensibility:E.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningX+=1/this.panningSensibility:E.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(d)?this._ctrlPressed&&this.camera._useCtrlForPanning?E.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?E.inertialRadiusOffset-=1/this.zoomingSensibility:E.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(d)&&E.useInputToRestoreState&&E.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,n.e)([(0,Z.K)()],j.prototype,"keysUp",void 0),(0,n.e)([(0,Z.K)()],j.prototype,"keysDown",void 0),(0,n.e)([(0,Z.K)()],j.prototype,"keysLeft",void 0),(0,n.e)([(0,Z.K)()],j.prototype,"keysRight",void 0),(0,n.e)([(0,Z.K)()],j.prototype,"keysReset",void 0),(0,n.e)([(0,Z.K)()],j.prototype,"panningSensibility",void 0),(0,n.e)([(0,Z.K)()],j.prototype,"zoomingSensibility",void 0),(0,n.e)([(0,Z.K)()],j.prototype,"useAltToZoom",void 0),(0,n.e)([(0,Z.K)()],j.prototype,"angularSpeed",void 0),s.d.ArcRotateCameraKeyboardMoveInput=j;var X=d(12439),W=d(12683);class U{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new g.wH(0,0,0),this._globalOffset=new g.wH(0,0,0),this._inertialPanning=g.wH.Zero()}_computeDeltaFromMouseWheelLegacyEvent(E,H){let d=0;const n=.01*E*this.wheelDeltaPercentage*H;return d=E>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage),d}attachControl(E){E=i.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=H=>{if(H.type!==S.e.POINTERWHEEL)return;const d=H.event;let n=0;const Z=d.deltaMode===W.b.DOM_DELTA_LINE?40:1,I=-d.deltaY*Z;if(this.customComputeDeltaFromMouseWheel)n=this.customComputeDeltaFromMouseWheel(I,this,d);else if(this.wheelDeltaPercentage){if(n=this._computeDeltaFromMouseWheelLegacyEvent(I,this.camera.radius),n>0){let E=this.camera.radius,H=this.camera.inertialRadiusOffset+n;for(let d=0;d<20&&!(E<=H)&&!(Math.abs(H*this.camera.inertia)<.001);d++)E-=H,H*=this.camera.inertia;E=(0,l.Clamp)(E,0,Number.MAX_VALUE),n=this._computeDeltaFromMouseWheelLegacyEvent(I,E)}}else n=I/(40*this.wheelPrecision);n&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(n)):this.camera.inertialRadiusOffset+=n),d.preventDefault&&(E||d.preventDefault())},this._observer=this.camera.fE()._inputManager._addCameraPointerObserver(this._wheel,S.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ng(0)}bM(){this._observer&&(this.camera.fE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const E=this.camera;0+E.inertialAlphaOffset+E.inertialBetaOffset+E.inertialRadiusOffset&&(this._updateHitPlane(),E.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(E.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const E=this.camera,H=E.target.RH(E.position);this._hitPlane=X.d.FromPositionAndNormal(E.target,H)}_getPosition(){const E=this.camera,H=E.fE(),d=H.createPickingRay(H.pointerX,H.pointerY,g.Matrix.Identity(),E,!1);0===E.targetScreenOffset.x&&0===E.targetScreenOffset.y||(this._viewOffset.set(E.targetScreenOffset.x,E.targetScreenOffset.y,0),E.getViewMatrix().invertToRef(E._cameraTransformMatrix),this._globalOffset=g.wH.TransformNormal(this._viewOffset,E._cameraTransformMatrix),d.origin.addInPlace(this._globalOffset));let n=0;return this._hitPlane&&(n=d.intersectsPlane(this._hitPlane)??0),d.origin.addInPlace(d.direction.scaleInPlace(n))}_zoomToMouse(E){const H=this.camera,d=1-H.inertia;if(H.lowerRadiusLimit){const n=H.lowerRadiusLimit??0;H.radius-(H.inertialRadiusOffset+E)/d<n&&(E=(H.radius-n)*d-H.inertialRadiusOffset)}if(H.upperRadiusLimit){const n=H.upperRadiusLimit??0;H.radius-(H.inertialRadiusOffset+E)/d>n&&(E=(H.radius-n)*d-H.inertialRadiusOffset)}const n=E/d/H.radius,Z=this._getPosition(),I=g.TmpVectors.wH[6];Z.subtractToRef(H.target,I),I.scaleInPlace(n),I.scaleInPlace(d),this._inertialPanning.addInPlace(I),H.inertialRadiusOffset+=E}_zeroIfClose(E){Math.abs(E.x)<V.c&&(E.x=0),Math.abs(E.y)<V.c&&(E.y=0),Math.abs(E.z)<V.c&&(E.z=0)}}(0,n.e)([(0,Z.K)()],U.prototype,"wheelPrecision",void 0),(0,n.e)([(0,Z.K)()],U.prototype,"zoomToMouseLocation",void 0),(0,n.e)([(0,Z.K)()],U.prototype,"wheelDeltaPercentage",void 0),s.d.ArcRotateCameraMouseWheelInput=U;class Y extends s.h{constructor(E){super(E)}addMouseWheel(){return this.add(new U),this}addPointers(){return this.add(new f),this}addKeyboard(){return this.add(new j),this}}var c=d(12344);function u(E,H){return isNaN(E)?H:E}r.c.AddNodeConstructor("ArcRotateCamera",((E,H)=>()=>new o(E,0,0,1,g.wH.Zero(),H)));class o extends e.d{get target(){return this._target}set target(E){this.setTarget(E)}get targetHost(){return this._targetHost}set targetHost(E){E&&this.setTarget(E)}getTarget(){return this.target}get position(){return this._position}set position(E){this.setPosition(E)}set upVector(E){this._upToYMatrix||(this._yToUpMatrix=new g.Matrix,this._upToYMatrix=new g.Matrix,this._upVector=g.wH.Zero()),E.normalize(),this._upVector.l(E),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){g.Matrix.RotationAlignToRef(g.wH.UpReadOnly,this._upVector,this._yToUpMatrix),g.Matrix.RotationAlignToRef(this._upVector,g.wH.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const E=this.inputs.attached.pointers;return E?E.angularSensibilityX:0}set angularSensibilityX(E){const H=this.inputs.attached.pointers;H&&(H.angularSensibilityX=E)}get angularSensibilityY(){const E=this.inputs.attached.pointers;return E?E.angularSensibilityY:0}set angularSensibilityY(E){const H=this.inputs.attached.pointers;H&&(H.angularSensibilityY=E)}get pinchPrecision(){const E=this.inputs.attached.pointers;return E?E.pinchPrecision:0}set pinchPrecision(E){const H=this.inputs.attached.pointers;H&&(H.pinchPrecision=E)}get pinchDeltaPercentage(){const E=this.inputs.attached.pointers;return E?E.pinchDeltaPercentage:0}set pinchDeltaPercentage(E){const H=this.inputs.attached.pointers;H&&(H.pinchDeltaPercentage=E)}get useNaturalPinchZoom(){const E=this.inputs.attached.pointers;return!!E&&E.useNaturalPinchZoom}set useNaturalPinchZoom(E){const H=this.inputs.attached.pointers;H&&(H.useNaturalPinchZoom=E)}get panningSensibility(){const E=this.inputs.attached.pointers;return E?E.panningSensibility:0}set panningSensibility(E){const H=this.inputs.attached.pointers;H&&(H.panningSensibility=E)}get keysUp(){const E=this.inputs.attached.keyboard;return E?E.keysUp:[]}set keysUp(E){const H=this.inputs.attached.keyboard;H&&(H.keysUp=E)}get keysDown(){const E=this.inputs.attached.keyboard;return E?E.keysDown:[]}set keysDown(E){const H=this.inputs.attached.keyboard;H&&(H.keysDown=E)}get keysLeft(){const E=this.inputs.attached.keyboard;return E?E.keysLeft:[]}set keysLeft(E){const H=this.inputs.attached.keyboard;H&&(H.keysLeft=E)}get keysRight(){const E=this.inputs.attached.keyboard;return E?E.keysRight:[]}set keysRight(E){const H=this.inputs.attached.keyboard;H&&(H.keysRight=E)}get wheelPrecision(){const E=this.inputs.attached.mousewheel;return E?E.wheelPrecision:0}set wheelPrecision(E){const H=this.inputs.attached.mousewheel;H&&(H.wheelPrecision=E)}get zoomToMouseLocation(){const E=this.inputs.attached.mousewheel;return!!E&&E.zoomToMouseLocation}set zoomToMouseLocation(E){const H=this.inputs.attached.mousewheel;H&&(H.zoomToMouseLocation=E)}get wheelDeltaPercentage(){const E=this.inputs.attached.mousewheel;return E?E.wheelDeltaPercentage:0}set wheelDeltaPercentage(E){const H=this.inputs.attached.mousewheel;H&&(H.wheelDeltaPercentage=E)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(E){E!==this.useBouncingBehavior&&(E?(this._bouncingBehavior=new Q,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(E){E!==this.useFramingBehavior&&(E?(this._framingBehavior=new L,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(E){E!==this.useAutoRotationBehavior&&(E?(this._autoRotationBehavior=new C,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(E,H,d,n,Z,l){var r;let t=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(E,g.wH.Zero(),l,t),r=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=g.wH.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=g.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new g.Matrix,this.panningAxis=new g.wH(1,1,0),this._transformedDirection=new g.wH,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new I.e,this.checkCollisions=!1,this.collisionRadius=new g.wH(.5,.5,.5),this._previousPosition=g.wH.Zero(),this._collisionVelocity=g.wH.Zero(),this._newPosition=g.wH.Zero(),this._computationVector=g.wH.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new g.wH(NaN,NaN,NaN),this._goalTargetScreenOffset=new g.Vector2(NaN,NaN),this._onCollisionPositionChange=function(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d?(r.setPosition(H),r.pC&&r.pC(d)):r._previousPosition.l(r._position);const n=Math.cos(r.alpha),Z=Math.sin(r.alpha),I=Math.cos(r.beta);let g=Math.sin(r.beta);0===g&&(g=1e-4);const l=r._getTargetPosition();r._computationVector.en(r.radius*n*g,r.radius*I,r.radius*Z*g),l.addToRef(r._computationVector,r._newPosition),r._position.l(r._newPosition);let t=r.upVector;r.allowUpsideDown&&r.beta<0&&(t=t.clone(),t=t.negate()),r._computeViewMatrix(r._position,l,t),r._viewMatrix.addAtIndex(12,r.targetScreenOffset.x),r._viewMatrix.addAtIndex(13,r.targetScreenOffset.y),r._collisionTriggered=!1},this._target=g.wH.Zero(),Z&&this.setTarget(Z),this.alpha=H,this.beta=d,this.radius=n,this.getViewMatrix(),this.inputs=new Y(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new g.wH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=g.Vector2.Zero()}_updateCache(E){E||super._updateCache(),this._cache._target.l(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.l(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const E=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?E.addToRef(this._targetBoundingCenter,this._target):this._target.l(E)}const E=this._getLockedTargetPosition();return E||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>V.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,I=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=I?this._currentInterpolationFactor=I:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=u(E,this._goalAlpha),this._goalBeta=u(H,this._goalBeta),this._goalRadius=u(d,this._goalRadius),this._goalTarget.set(u(n.x,this._goalTarget.x),u(n.y,this._goalTarget.y),u(n.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(u(Z.x,this._goalTargetScreenOffset.x),u(Z.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,l.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,l.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,l.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,l.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(E,H){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const Z=arguments;H=i.Tools.BackCompatCameraNoPreventDefault(Z),this._useCtrlForPanning=d,this._panningMouseButton=n,"boolean"===typeof Z[0]&&(Z.length>1&&(this._useCtrlForPanning=Z[1]),Z.length>2&&(this._panningMouseButton=Z[2])),this.inputs.attachElement(H),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}bM(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let E=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){E=!0;const H=this.invertRotation?-1:1,d=this._calculateHandednessMultiplier();let n=this.inertialAlphaOffset*d;this.beta<0&&(n*=-1),this.alpha+=n*H,this.beta+=this.inertialBetaOffset*H,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<V.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<V.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*V.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){E=!0;const H=new g.wH(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),H.multiplyInPlace(this.panningAxis),g.wH.TransformNormalToRef(H,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const E=this.upVector,H=g.wH.CrossToRef(this._transformedDirection,E,this._transformedDirection);g.wH.CrossToRef(E,H,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);g.wH.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.l(this._transformedDirection)}else{if(this.parent){const E=g.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(E),E.transposeToRef(E),g.wH.TransformCoordinatesToRef(this._transformedDirection,E,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*V.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*V.c&&(this.inertialPanningY=0)}if(E)this.stopInterpolation();else if(this._isInterpolating){let E=!1;const H=this._scene.getEngine().getDeltaTime()/1e3,d=1-Math.pow(2,-H/this._currentInterpolationFactor),n=u(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const H=g.TmpVectors.wH[0].set(u(this._goalTarget.x,this._target.x),u(this._goalTarget.y,this._target.y),u(this._goalTarget.z,this._target.z));g.wH.LerpToRef(this.target,H,d,this._target),10*g.wH.Distance(this.target,H)/n<V.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.l(H),this.setTarget(this.target,!1,!0,!0)):E=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const H=g.Quaternion.RotationAlphaBetaGammaToRef(u(this._goalAlpha,this.alpha),u(this._goalBeta,this.beta),0,g.TmpVectors.Quaternion[0]),n=g.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,g.TmpVectors.Quaternion[1]),Z=g.Quaternion.SlerpToRef(n,H,d,g.TmpVectors.Quaternion[2]);Z.normalize();const I=Z.toAlphaBetaGammaToRef(g.TmpVectors.wH[0]);if(this.alpha=I.x,this.beta=I.y,Z.isApprox(H,V.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const E=H.toAlphaBetaGammaToRef(g.TmpVectors.wH[0]);this.alpha=E.x,this.beta=E.y}else E=!0}if(isNaN(this._goalRadius)||(this.radius+=(n-this.radius)*d,Math.abs(n/this.radius-1)<V.c?(this._goalRadius=NaN,this.radius=n):E=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const H=g.TmpVectors.Vector2[0].set(u(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),u(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));g.Vector2.LerpToRef(this.targetScreenOffset,H,d,this.targetScreenOffset),g.Vector2.Distance(this.targetScreenOffset,H)<V.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.l(H)):E=!0}this._isInterpolating=E}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.wH.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const E=this.alpha;var H,d;this.alpha=function(E){let H=Math.PI/2;return 0===E.x&&0===E.z||(H=Math.acos(E.x/Math.sqrt(Math.pow(E.x,2)+Math.pow(E.z,2)))),E.z<0&&(H=2*Math.PI-H),H}(this._computationVector),this.beta=(H=this._computationVector.y,d=this.radius,Math.acos(H/d));const n=Math.round((E-this.alpha)/(2*Math.PI));this.alpha+=2*n*Math.PI,this._checkLimits()}setPosition(E){this._position.equals(E)||(this._position.l(E),this.rebuildAnglesAndRadius())}setTarget(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n=this.overrideCloneAlphaBetaRadius??n,E.yd)H&&E.getBoundingInfo?this._targetBoundingCenter=E.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,E.yd(),this._targetHost=E,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const H=E,n=this._getTargetPosition();if(n&&!d&&n.equals(H))return;this._targetHost=null,this._target=H,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}n||this.rebuildAnglesAndRadius()}_getViewMatrix(){const E=Math.cos(this.alpha),H=Math.sin(this.alpha),d=Math.cos(this.beta);let n=Math.sin(this.beta);0===n&&(n=1e-4),0===this.radius&&(this.radius=1e-4);const Z=this._getTargetPosition();if(this._computationVector.en(this.radius*E*n,this.radius*d,this.radius*H*n),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.wH.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),Z.addToRef(this._computationVector,this._newPosition),this.fE().collisionsEnabled&&this.checkCollisions){const E=this.fE().collisionCoordinator;this._collider||(this._collider=E.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,E.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.l(this._newPosition);let E=this.upVector;this.allowUpsideDown&&n<0&&(E=E.negate()),this._computeViewMatrix(this._position,Z,E),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.l(Z),this._viewMatrix}zoomOn(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E=E||this.fE().meshes;const d=t.e.MinMax(E);let n=this._calculateLowerRadiusFromModelBoundingSphere(d.min,d.max);if(n=Math.max(Math.min(n,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=n*this.zoomOnFactor,this.mode===D.b.ORTHOGRAPHIC_CAMERA){const E=this.fE().getEngine().getAspectRatio(this),H=n*this.zoomOnFactor/2;this.orthoLeft=-H*E,this.orthoRight=H*E,this.orthoBottom=-H,this.orthoTop=H}this.focusOn({min:d.min,max:d.max,distance:n},H)}focusOn(E){let H,d,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===E.min){const n=E||this.fE().meshes;H=t.e.MinMax(n),d=g.wH.Distance(H.min,H.max)}else{H=E,d=E.distance}this._target=t.e.Center(H),n||(this.maxZ=2*d)}createRigCamera(E,H){let d=0;switch(this.cameraRigMode){case D.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case D.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case D.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case D.b.RIG_MODE_VR:d=this._cameraRigParams.stereoHalfAngle*(0===H?1:-1);break;case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:d=this._cameraRigParams.stereoHalfAngle*(0===H?-1:1)}const n=new o(E,this.alpha+d,this.beta,this.radius,this._target,this.fE());return n._cameraRigParams={},n.isRigCamera=!0,n.rigParent=this,n.upVector=this.upVector,n.mode=this.mode,n.orthoLeft=this.orthoLeft,n.orthoRight=this.orthoRight,n.orthoBottom=this.orthoBottom,n.orthoTop=this.orthoTop,n}_updateRigCameras(){const E=this._rigCameras[0],H=this._rigCameras[1];switch(E.beta=H.beta=this.beta,this.cameraRigMode){case D.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case D.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case D.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case D.b.RIG_MODE_VR:E.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,H.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:E.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,H.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const n=g.wH.Distance(E,H),Z=this.fE().getEngine().getAspectRatio(this),I=Math.tan(this.fov/2),l=I*Z,r=.5*n*d,t=r*Math.sqrt(1+1/(l*l)),S=r*Math.sqrt(1+1/(I*I));return Math.max(t,S)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,n.e)([(0,Z.K)()],o.prototype,"alpha",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"beta",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"radius",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,n.e)([(0,Z.I)("target")],o.prototype,"_target",void 0),(0,n.e)([(0,Z.t)("targetHost")],o.prototype,"_targetHost",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"inertialAlphaOffset",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"inertialBetaOffset",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"inertialRadiusOffset",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"lowerAlphaLimit",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"upperAlphaLimit",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"lowerBetaLimit",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"upperBetaLimit",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"lowerRadiusLimit",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"upperRadiusLimit",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"lowerTargetYLimit",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"inertialPanningX",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"inertialPanningY",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"pinchToPanMaxDistance",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"panningDistanceLimit",void 0),(0,n.e)([(0,Z.I)()],o.prototype,"panningOriginTarget",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"panningInertia",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"zoomToMouseLocation",null),(0,n.e)([(0,Z.K)()],o.prototype,"zoomOnFactor",void 0),(0,n.e)([(0,Z.E)()],o.prototype,"targetScreenOffset",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"allowUpsideDown",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"useInputToRestoreState",void 0),(0,n.e)([(0,Z.K)()],o.prototype,"restoreStateInterpolationFactor",void 0),(0,c.e)("BABYLON.ArcRotateCamera",o)},14018:(E,H,d)=>{"use strict";d.d(H,{d:()=>g,h:()=>l});var n=d(12237),Z=d(12428),I=d(12845),g={};class l{constructor(E){this.attachedToElement=!1,this.attached={},this.camera=E,this.checkInputs=()=>{}}add(E){const H=E.getSimpleName();this.attached[H]?n.b.Warn("camera input of type "+H+" already exists on camera"):(this.attached[H]=E,E.camera=this.camera,E.checkInputs&&(this.checkInputs=this._addCheckInputs(E.checkInputs.bind(E))),this.attachedToElement&&E.attachControl(this.noPreventDefault))}remove(E){for(const H in this.attached){const d=this.attached[H];if(d===E)return d.bM(),d.camera=null,delete this.attached[H],void this.rebuildInputCheck()}}removeByType(E){for(const H in this.attached){const d=this.attached[H];d.getClassName()===E&&(d.bM(),d.camera=null,delete this.attached[H],this.rebuildInputCheck())}}_addCheckInputs(E){const H=this.checkInputs;return()=>{H(),E()}}attachInput(E){this.attachedToElement&&E.attachControl(this.noPreventDefault)}attachElement(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){E=!I.b.ForceAttachControlToAlwaysPreventDefault&&E,this.attachedToElement=!0,this.noPreventDefault=E;for(const H in this.attached)this.attached[H].attachControl(E)}}detachElement(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const H in this.attached)this.attached[H].bM(),E&&(this.attached[H].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const E in this.attached){const H=this.attached[E];H.checkInputs&&(this.checkInputs=this._addCheckInputs(H.checkInputs.bind(H)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(E){const H={};for(const d in this.attached){const E=this.attached[d],n=Z.c.Serialize(E);H[E.getClassName()]=n}E.inputsmgr=H}parse(E){const H=E.inputsmgr;if(H){this.clear();for(const E in H){const d=g[E];if(d){const n=H[E],I=Z.c.Parse((()=>new d),n,null);this.add(I)}}}else for(const d in this.attached){const H=g[this.attached[d].getClassName()];if(H){const n=Z.c.Parse((()=>new H),E,null);this.remove(this.attached[d]),this.add(n)}}}}},14011:(E,H,d)=>{"use strict";d.d(H,{e:()=>p});var n=d(12369),Z=d(12372),I=d(12384),g=d(12871),l=d(14018),r=d(12679),t=d(12228);class S{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(E){E=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.fE(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((H=>{const d=H.event;if(!d.metaKey)if(H.type===r.d.KEYDOWN){if(-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysUpward.indexOf(d.keyCode)||-1!==this.keysDownward.indexOf(d.keyCode)||-1!==this.keysRotateLeft.indexOf(d.keyCode)||-1!==this.keysRotateRight.indexOf(d.keyCode)||-1!==this.keysRotateUp.indexOf(d.keyCode)||-1!==this.keysRotateDown.indexOf(d.keyCode)){-1===this._keys.indexOf(d.keyCode)&&this._keys.push(d.keyCode),E||d.preventDefault()}}else if(-1!==this.keysUp.indexOf(d.keyCode)||-1!==this.keysDown.indexOf(d.keyCode)||-1!==this.keysLeft.indexOf(d.keyCode)||-1!==this.keysRight.indexOf(d.keyCode)||-1!==this.keysUpward.indexOf(d.keyCode)||-1!==this.keysDownward.indexOf(d.keyCode)||-1!==this.keysRotateLeft.indexOf(d.keyCode)||-1!==this.keysRotateRight.indexOf(d.keyCode)||-1!==this.keysRotateUp.indexOf(d.keyCode)||-1!==this.keysRotateDown.indexOf(d.keyCode)){const H=this._keys.indexOf(d.keyCode);H>=0&&this._keys.splice(H,1),E||d.preventDefault()}})))}bM(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const E=this.camera;for(let H=0;H<this._keys.length;H++){const d=this._keys[H],n=E._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(d)?E._localDirection.en(-n,0,0):-1!==this.keysUp.indexOf(d)?E._localDirection.en(0,0,n):-1!==this.keysRight.indexOf(d)?E._localDirection.en(n,0,0):-1!==this.keysDown.indexOf(d)?E._localDirection.en(0,0,-n):-1!==this.keysUpward.indexOf(d)?E._localDirection.en(0,n,0):-1!==this.keysDownward.indexOf(d)?E._localDirection.en(0,-n,0):-1!==this.keysRotateLeft.indexOf(d)?(E._localDirection.en(0,0,0),E.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(d)?(E._localDirection.en(0,0,0),E.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(d)?(E._localDirection.en(0,0,0),E.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(d)&&(E._localDirection.en(0,0,0),E.cameraRotation.x+=this._getLocalRotation()),E.fE().useRightHandedSystem&&(E._localDirection.z*=-1),E.getViewMatrix().invertToRef(E._cameraTransformMatrix),I.wH.TransformNormalToRef(E._localDirection,E._cameraTransformMatrix,E._transformedDirection),E.cameraDirection.addInPlace(E._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const E=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*E}}(0,n.e)([(0,Z.K)()],S.prototype,"keysUp",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"keysUpward",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"keysDown",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"keysDownward",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"keysLeft",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"keysRight",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"rotationSpeed",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"keysRotateLeft",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"keysRotateRight",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"keysRotateUp",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"keysRotateDown",void 0),l.d.FreeCameraKeyboardMoveInput=S;var M=d(12230),V=d(12670);class C{constructor(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=E,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new M.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(E){E=t.Tools.BackCompatCameraNoPreventDefault(arguments);const H=this.camera.getEngine(),d=H.getInputElement();this._pointerInput||(this._pointerInput=n=>{const Z=n.event,I="touch"===Z.pointerType;if(!this.touchEnabled&&I)return;if(n.type!==V.e.POINTERMOVE&&-1===this.buttons.indexOf(Z.button))return;const g=Z.target;if(n.type===V.e.POINTERDOWN){if(I&&-1!==this._activePointerId||!I&&-1!==this._currentActiveButton)return;this._activePointerId=Z.pointerId;try{null===g||void 0===g||g.setPointerCapture(Z.pointerId)}catch(l){}-1===this._currentActiveButton&&(this._currentActiveButton=Z.button),this._previousPosition={x:Z.clientX,y:Z.clientY},E||(Z.preventDefault(),d&&d.focus()),H.isPointerLock&&this._onMouseMove&&this._onMouseMove(n.event)}else if(n.type===V.e.POINTERUP){if(I&&this._activePointerId!==Z.pointerId||!I&&this._currentActiveButton!==Z.button)return;try{null===g||void 0===g||g.releasePointerCapture(Z.pointerId)}catch(l){}this._currentActiveButton=-1,this._previousPosition=null,E||Z.preventDefault(),this._activePointerId=-1}else if(n.type===V.e.POINTERMOVE&&(this._activePointerId===Z.pointerId||!I))if(H.isPointerLock&&this._onMouseMove)this._onMouseMove(n.event);else if(this._previousPosition){const H=this.camera._calculateHandednessMultiplier(),d=(Z.clientX-this._previousPosition.x)*H,n=Z.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=d/this.angularSensibility,this.camera.cameraRotation.x+=n/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:d,offsetY:n}),this._previousPosition={x:Z.clientX,y:Z.clientY},E||Z.preventDefault()}}),this._onMouseMove=d=>{if(!H.isPointerLock)return;const n=this.camera._calculateHandednessMultiplier(),Z=d.movementX*n;this.camera.cameraRotation.y+=Z/this.angularSensibility;const I=d.movementY;this.camera.cameraRotation.x+=I/this.angularSensibility,this._previousPosition=null,E||d.preventDefault()},this._observer=this.camera.fE()._inputManager._addCameraPointerObserver(this._pointerInput,V.e.POINTERDOWN|V.e.POINTERUP|V.e.POINTERMOVE),d&&(this._contextMenuBind=E=>this.onContextMenu(E),d.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(E){E.preventDefault()}bM(){if(this._observer){if(this.camera.fE()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const E=this.camera.getEngine().getInputElement();E&&E.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,n.e)([(0,Z.K)()],C.prototype,"buttons",void 0),(0,n.e)([(0,Z.K)()],C.prototype,"angularSensibility",void 0),l.d.FreeCameraMouseInput=C;var w,R=d(12683);class Q{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new M.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(E){E=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=H=>{if(H.type!==V.e.POINTERWHEEL)return;const d=H.event,n=d.deltaMode===R.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*n*d.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*n*d.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*n*d.deltaZ/this._normalize,d.preventDefault&&(E||d.preventDefault())},this._observer=this.camera.fE()._inputManager._addCameraPointerObserver(this._wheel,V.e.POINTERWHEEL)}bM(){this._observer&&(this.camera.fE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,n.e)([(0,Z.K)()],Q.prototype,"wheelPrecisionX",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"wheelPrecisionY",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"wheelPrecisionZ",void 0),function(E){E[E.MoveRelative=0]="MoveRelative",E[E.RotateRelative=1]="RotateRelative",E[E.MoveScene=2]="MoveScene"}(w||(w={}));class L extends Q{constructor(){super(...arguments),this._moveRelative=I.wH.Zero(),this._rotateRelative=I.wH.Zero(),this._moveScene=I.wH.Zero(),this._wheelXAction=w.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=w.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(E){null===E&&this._wheelXAction!==w.MoveRelative||(this._wheelXAction=w.MoveRelative,this._wheelXActionCoordinate=E)}get wheelXMoveRelative(){return this._wheelXAction!==w.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(E){null===E&&this._wheelYAction!==w.MoveRelative||(this._wheelYAction=w.MoveRelative,this._wheelYActionCoordinate=E)}get wheelYMoveRelative(){return this._wheelYAction!==w.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(E){null===E&&this._wheelZAction!==w.MoveRelative||(this._wheelZAction=w.MoveRelative,this._wheelZActionCoordinate=E)}get wheelZMoveRelative(){return this._wheelZAction!==w.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(E){null===E&&this._wheelXAction!==w.RotateRelative||(this._wheelXAction=w.RotateRelative,this._wheelXActionCoordinate=E)}get wheelXRotateRelative(){return this._wheelXAction!==w.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(E){null===E&&this._wheelYAction!==w.RotateRelative||(this._wheelYAction=w.RotateRelative,this._wheelYActionCoordinate=E)}get wheelYRotateRelative(){return this._wheelYAction!==w.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(E){null===E&&this._wheelZAction!==w.RotateRelative||(this._wheelZAction=w.RotateRelative,this._wheelZActionCoordinate=E)}get wheelZRotateRelative(){return this._wheelZAction!==w.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(E){null===E&&this._wheelXAction!==w.MoveScene||(this._wheelXAction=w.MoveScene,this._wheelXActionCoordinate=E)}get wheelXMoveScene(){return this._wheelXAction!==w.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(E){null===E&&this._wheelYAction!==w.MoveScene||(this._wheelYAction=w.MoveScene,this._wheelYActionCoordinate=E)}get wheelYMoveScene(){return this._wheelYAction!==w.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(E){null===E&&this._wheelZAction!==w.MoveScene||(this._wheelZAction=w.MoveScene,this._wheelZActionCoordinate=E)}get wheelZMoveScene(){return this._wheelZAction!==w.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ng(0),this._rotateRelative.ng(0),this._moveScene.ng(0),this._updateCamera(),this.camera.fE().useRightHandedSystem&&(this._moveRelative.z*=-1);const E=I.Matrix.Zero();this.camera.getViewMatrix().invertToRef(E);const H=I.wH.Zero();I.wH.TransformNormalToRef(this._moveRelative,E,H),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(H),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(E,H,d){if(0===E)return;if(null===H||null===d)return;let n=null;switch(H){case w.MoveRelative:n=this._moveRelative;break;case w.RotateRelative:n=this._rotateRelative;break;case w.MoveScene:n=this._moveScene}switch(d){case 0:n.set(E,0,0);break;case 1:n.set(0,E,0);break;case 2:n.set(0,0,E)}}}(0,n.e)([(0,Z.K)()],L.prototype,"wheelXMoveRelative",null),(0,n.e)([(0,Z.K)()],L.prototype,"wheelYMoveRelative",null),(0,n.e)([(0,Z.K)()],L.prototype,"wheelZMoveRelative",null),(0,n.e)([(0,Z.K)()],L.prototype,"wheelXRotateRelative",null),(0,n.e)([(0,Z.K)()],L.prototype,"wheelYRotateRelative",null),(0,n.e)([(0,Z.K)()],L.prototype,"wheelZRotateRelative",null),(0,n.e)([(0,Z.K)()],L.prototype,"wheelXMoveScene",null),(0,n.e)([(0,Z.K)()],L.prototype,"wheelYMoveScene",null),(0,n.e)([(0,Z.K)()],L.prototype,"wheelZMoveScene",null),l.d.FreeCameraMouseWheelInput=L;class D{constructor(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=E,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=t.Tools.IsSafari()}attachControl(E){E=t.Tools.BackCompatCameraNoPreventDefault(arguments);let H=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=d=>{const n=d.event,Z="mouse"===n.pointerType||this._isSafari&&"undefined"===typeof n.pointerType;if(this.allowMouse||!Z)if(d.type===V.e.POINTERDOWN){if(E||n.preventDefault(),this._pointerPressed.push(n.pointerId),1!==this._pointerPressed.length)return;H={x:n.clientX,y:n.clientY}}else if(d.type===V.e.POINTERUP){E||n.preventDefault();const d=this._pointerPressed.indexOf(n.pointerId);if(-1===d)return;if(this._pointerPressed.splice(d,1),0!=d)return;H=null,this._offsetX=null,this._offsetY=null}else if(d.type===V.e.POINTERMOVE){if(E||n.preventDefault(),!H)return;if(0!=this._pointerPressed.indexOf(n.pointerId))return;this._offsetX=n.clientX-H.x,this._offsetY=-(n.clientY-H.y)}}),this._observer=this.camera.fE()._inputManager._addCameraPointerObserver(this._pointerInput,V.e.POINTERDOWN|V.e.POINTERUP|V.e.POINTERMOVE),this._onLostFocus){const E=this.camera.getEngine().getInputElement();E&&E.addEventListener("blur",this._onLostFocus)}}bM(){if(this._pointerInput){if(this._observer&&(this.camera.fE()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const E=this.camera.getEngine().getInputElement();E&&E.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const E=this.camera,H=E._calculateHandednessMultiplier();E.cameraRotation.y=H*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)E.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const H=E._computeLocalCameraSpeed(),d=new I.wH(0,0,0!==this.touchMoveSensibility?H*this._offsetY/this.touchMoveSensibility:0);I.Matrix.RotationYawPitchRollToRef(E.rotation.y,E.rotation.x,0,E._cameraRotationMatrix),E.cameraDirection.addInPlace(I.wH.TransformCoordinates(d,E._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,n.e)([(0,Z.K)()],D.prototype,"touchAngularSensibility",void 0),(0,n.e)([(0,Z.K)()],D.prototype,"touchMoveSensibility",void 0),l.d.FreeCameraTouchInput=D;class e extends l.h{constructor(E){super(E),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new S),this}addMouse(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new C(E),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new L,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new D),this}clear(){super.clear(),this._mouseInput=null}}var s=d(12344),i=d(12296);class p extends g.d{get angularSensibility(){const E=this.inputs.attached.mouse;return E?E.angularSensibility:0}set angularSensibility(E){const H=this.inputs.attached.mouse;H&&(H.angularSensibility=E)}get keysUp(){const E=this.inputs.attached.keyboard;return E?E.keysUp:[]}set keysUp(E){const H=this.inputs.attached.keyboard;H&&(H.keysUp=E)}get keysUpward(){const E=this.inputs.attached.keyboard;return E?E.keysUpward:[]}set keysUpward(E){const H=this.inputs.attached.keyboard;H&&(H.keysUpward=E)}get keysDown(){const E=this.inputs.attached.keyboard;return E?E.keysDown:[]}set keysDown(E){const H=this.inputs.attached.keyboard;H&&(H.keysDown=E)}get keysDownward(){const E=this.inputs.attached.keyboard;return E?E.keysDownward:[]}set keysDownward(E){const H=this.inputs.attached.keyboard;H&&(H.keysDownward=E)}get keysLeft(){const E=this.inputs.attached.keyboard;return E?E.keysLeft:[]}set keysLeft(E){const H=this.inputs.attached.keyboard;H&&(H.keysLeft=E)}get keysRight(){const E=this.inputs.attached.keyboard;return E?E.keysRight:[]}set keysRight(E){const H=this.inputs.attached.keyboard;H&&(H.keysRight=E)}get keysRotateLeft(){const E=this.inputs.attached.keyboard;return E?E.keysRotateLeft:[]}set keysRotateLeft(E){const H=this.inputs.attached.keyboard;H&&(H.keysRotateLeft=E)}get keysRotateRight(){const E=this.inputs.attached.keyboard;return E?E.keysRotateRight:[]}set keysRotateRight(E){const H=this.inputs.attached.keyboard;H&&(H.keysRotateRight=E)}get keysRotateUp(){const E=this.inputs.attached.keyboard;return E?E.keysRotateUp:[]}set keysRotateUp(E){const H=this.inputs.attached.keyboard;H&&(H.keysRotateUp=E)}get keysRotateDown(){const E=this.inputs.attached.keyboard;return E?E.keysRotateDown:[]}set keysRotateDown(E){const H=this.inputs.attached.keyboard;H&&(H.keysRotateDown=E)}constructor(E,H,d){var n;super(E,H,d,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),n=this,this.ellipsoid=new I.wH(.5,1,.5),this.ellipsoidOffset=new I.wH(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=I.wH.Zero(),this._diffPosition=I.wH.Zero(),this._newPosition=I.wH.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n._newPosition.l(H),n._newPosition.subtractToRef(n._oldPosition,n._diffPosition),n._diffPosition.length()>i.c.CollisionsEpsilon&&(n.position.addToRef(n._diffPosition,n._deferredPositionUpdate),n._deferOnly?n._deferredUpdated=!0:n.position.l(n._deferredPositionUpdate),n.pC&&d&&n.pC(d))},this.inputs=new e(this),this.inputs.addKeyboard().addMouse()}attachControl(E,H){H=t.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(H)}bM(){this.inputs.detachElement(),this.cameraDirection=new I.wH(0,0,0),this.cameraRotation=new I.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(E){this._collisionMask=isNaN(E)?-1:E}_collideWithWorld(E){let H;H=this.parent?I.wH.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,H.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const d=this.fE().collisionCoordinator;this._collider||(this._collider=d.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let n=E;this.applyGravity&&(n=E.add(this.fE().gravity)),d.getNewPosition(this._oldPosition,n,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=I.wH.Zero(),this._transformedDirection=I.wH.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(E){this._needMoveForGravity=E}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.fE().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ag"}}(0,n.e)([(0,Z.I)()],p.prototype,"ellipsoid",void 0),(0,n.e)([(0,Z.I)()],p.prototype,"ellipsoidOffset",void 0),(0,n.e)([(0,Z.K)()],p.prototype,"checkCollisions",void 0),(0,n.e)([(0,Z.K)()],p.prototype,"applyGravity",void 0),(0,s.e)("BABYLON.FreeCamera",p)},14611:(E,H,d)=>{"use strict";d.d(H,{e:()=>I});var n=d(12491),Z=d(14613);class I{constructor(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=d,this.lM=[],this._maxBlockCapacity=H||64,this._selectionContent=new n.b(1024),this._creationFunc=E}update(E,H,d){Z.b._CreateBlocks(E,H,d,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}wS(E){for(let H=0;H<this.XS.length;H++){this.XS[H].addEntry(E)}}CS(E){for(let H=0;H<this.XS.length;H++){this.XS[H].removeEntry(E)}}select(E,H){this._selectionContent.reset();for(let d=0;d<this.XS.length;d++){this.XS[d].select(E,this._selectionContent,H)}return H?this._selectionContent.concat(this.lM):this._selectionContent.concatWithNoDuplicate(this.lM),this._selectionContent}intersects(E,H,d){this._selectionContent.reset();for(let n=0;n<this.XS.length;n++){this.XS[n].intersects(E,H,this._selectionContent,d)}return d?this._selectionContent.concat(this.lM):this._selectionContent.concatWithNoDuplicate(this.lM),this._selectionContent}intersectsRay(E){this._selectionContent.reset();for(let H=0;H<this.XS.length;H++){this.XS[H].intersectsRay(E,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.lM),this._selectionContent}}I.CreationFuncForMeshes=(E,H)=>{const d=E.getBoundingInfo();!E.isBlocked&&d.boundingBox.intersectsMinMax(H.VM,H.CM)&&H.entries.push(E)},I.CreationFuncForSubMeshes=(E,H)=>{E.getBoundingInfo().boundingBox.intersectsMinMax(H.VM,H.CM)&&H.entries.push(E)}},14613:(E,H,d)=>{"use strict";d.d(H,{b:()=>I});var n=d(12384),Z=d(12746);class I{constructor(E,H,d,n,Z,I){this.entries=[],this.wM=new Array,this._capacity=d,this._depth=n,this._maxDepth=Z,this._creationFunc=I,this._minPoint=E,this._maxPoint=H,this.wM.push(E.clone()),this.wM.push(H.clone()),this.wM.push(E.clone()),this.wM[2].x=H.x,this.wM.push(E.clone()),this.wM[3].y=H.y,this.wM.push(E.clone()),this.wM[4].z=H.z,this.wM.push(H.clone()),this.wM[5].z=E.z,this.wM.push(H.clone()),this.wM[6].x=E.x,this.wM.push(H.clone()),this.wM[7].y=E.y}get Ld(){return this._capacity}get VM(){return this._minPoint}get CM(){return this._maxPoint}addEntry(E){if(this.XS)for(let H=0;H<this.XS.length;H++){this.XS[H].addEntry(E)}else this._creationFunc(E,this),this.entries.length>this.Ld&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(E){if(this.XS){for(let H=0;H<this.XS.length;H++){this.XS[H].removeEntry(E)}return}const H=this.entries.indexOf(E);H>-1&&this.entries.splice(H,1)}addEntries(E){for(let H=0;H<E.length;H++){const d=E[H];this.addEntry(d)}}select(E,H,d){if(Z.b.IsInFrustum(this.wM,E)){if(this.XS){for(let n=0;n<this.XS.length;n++){this.XS[n].select(E,H,d)}return}d?H.concat(this.entries):H.concatWithNoDuplicate(this.entries)}}intersects(E,H,d,n){if(Z.b.IntersectsSphere(this._minPoint,this._maxPoint,E,H)){if(this.XS){for(let Z=0;Z<this.XS.length;Z++){this.XS[Z].intersects(E,H,d,n)}return}n?d.concat(this.entries):d.concatWithNoDuplicate(this.entries)}}intersectsRay(E,H){if(E.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.XS){for(let d=0;d<this.XS.length;d++){this.XS[d].intersectsRay(E,H)}return}H.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){I._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(E,H,d,Z,g,l,r,t){r.XS=new Array;const S=new n.wH((H.x-E.x)/2,(H.y-E.y)/2,(H.z-E.z)/2);for(let n=0;n<2;n++)for(let H=0;H<2;H++)for(let M=0;M<2;M++){const V=E.add(S.multiplyByFloats(n,H,M)),C=E.add(S.multiplyByFloats(n+1,H+1,M+1)),w=new I(V,C,Z,g+1,l,t);w.addEntries(d),r.XS.push(w)}}}},14622:(E,H,d)=>{"use strict";d.d(H,{c:()=>S});var n=d(12634),Z=d(12384),I=d(12817),g=d(13788),l=d(12666),r=d(14611),t=d(12268);n.c.prototype.createOrUpdateSelectionOctree=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,d=this._getComponent(l.e.NAME_OCTREE);d||(d=new S(this),this.Md(d)),this.IM||(this.IM=new r.e(r.e.CreationFuncForMeshes,E,H));const n=this.getWorldExtends();return this.IM.update(n.min,n.max,this.meshes),this.IM},Object.defineProperty(n.c.prototype,"selectionOctree",{get:function(){return this.IM},enumerable:!0,configurable:!0}),I.b.prototype.createOrUpdateSubmeshesOctree=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const d=this.fE();let n=d._getComponent(l.e.NAME_OCTREE);n||(n=new S(d),d.Md(n)),this._submeshesOctree||(this._submeshesOctree=new r.e(r.e.CreationFuncForSubMeshes,E,H)),this.yd(!0);const Z=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(Z.minimumWorld,Z.maximumWorld,this.od),this._submeshesOctree};class S{constructor(E){this.name=l.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new g.b(Z.wH.Zero(),new Z.wH(1,1,1)),(E=E||t.b.LastCreatedScene)&&(this.QH=E,this.QH.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.QH.getActiveSubMeshCandidates=E=>this.getActiveSubMeshCandidates(E),this.QH.getCollidingSubMeshCandidates=(E,H)=>this.getCollidingSubMeshCandidates(E,H),this.QH.getIntersectingSubMeshCandidates=(E,H)=>this.getIntersectingSubMeshCandidates(E,H))}register(){this.QH.onMeshRemovedObservable.add((E=>{const H=this.QH.selectionOctree;if(void 0!==H&&null!==H){const d=H.lM.indexOf(E);-1!==d&&H.lM.splice(d,1)}})),this.QH.onMeshImportedObservable.add((E=>{const H=this.QH.selectionOctree;void 0!==H&&null!==H&&H.wS(E)}))}getActiveMeshCandidates(){var E;return(null===(E=this.QH.IM)||void 0===E?void 0:E.select(this.QH.frustumPlanes))||this.QH._getDefaultMeshCandidates()}getActiveSubMeshCandidates(E){if(E._submeshesOctree&&E.useOctreeForRenderingSelection){return E._submeshesOctree.select(this.QH.frustumPlanes)}return this.QH._getDefaultSubMeshCandidates(E)}getIntersectingSubMeshCandidates(E,H){if(E._submeshesOctree&&E.useOctreeForPicking){g.b.TransformToRef(H,E.getWorldMatrix(),this._tempRay);return E._submeshesOctree.intersectsRay(this._tempRay)}return this.QH._getDefaultSubMeshCandidates(E)}getCollidingSubMeshCandidates(E,H){if(E._submeshesOctree&&E.useOctreeForCollisions){const d=H._velocityWorldLength+Math.max(H._radius.x,H._radius.y,H._radius.z);return E._submeshesOctree.intersects(H._basePointWorld,d)}return this.QH._getDefaultSubMeshCandidates(E)}rebuild(){}dispose(){}}},13788:(E,H,d)=>{"use strict";d.d(H,{b:()=>C});var n=d(12634),Z=d(12845),I=d(12391),g=d(12384),l=d(12399),r=d(12736),t=d(12659),S=d(12268),M=d(12692);const V={internalPickerForMesh:void 0};class C{constructor(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:I.c;this.origin=E,this.direction=H,this.length=d,this.epsilon=n}clone(){return new C(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=C._TmpVector3[0].en(E.x-d,E.y-d,E.z-d),Z=C._TmpVector3[1].en(H.x+d,H.y+d,H.z+d);let I,g,l,r,t=0,S=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<n.x||this.origin.x>Z.x)return!1}else if(I=1/this.direction.x,g=(n.x-this.origin.x)*I,l=(Z.x-this.origin.x)*I,l===-1/0&&(l=1/0),g>l&&(r=g,g=l,l=r),t=Math.max(g,t),S=Math.min(l,S),t>S)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<n.y||this.origin.y>Z.y)return!1}else if(I=1/this.direction.y,g=(n.y-this.origin.y)*I,l=(Z.y-this.origin.y)*I,l===-1/0&&(l=1/0),g>l&&(r=g,g=l,l=r),t=Math.max(g,t),S=Math.min(l,S),t>S)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<n.z||this.origin.z>Z.z)return!1}else if(I=1/this.direction.z,g=(n.z-this.origin.z)*I,l=(Z.z-this.origin.z)*I,l===-1/0&&(l=1/0),g>l&&(r=g,g=l,l=r),t=Math.max(g,t),S=Math.min(l,S),t>S)return!1;return!0}intersectsBox(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(E.minimum,E.maximum,H)}intersectsSphere(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const d=E.center.x-this.origin.x,n=E.center.y-this.origin.y,Z=E.center.z-this.origin.z,I=d*d+n*n+Z*Z,g=E.radius+H,l=g*g;if(I<=l)return!0;const r=d*this.direction.x+n*this.direction.y+Z*this.direction.z;if(r<0)return!1;return I-r*r<=l}intersectsTriangle(E,H,d){const n=C._TmpVector3[0],Z=C._TmpVector3[1],I=C._TmpVector3[2],l=C._TmpVector3[3],t=C._TmpVector3[4];H.subtractToRef(E,n),d.subtractToRef(E,Z),g.wH.CrossToRef(this.direction,Z,I);const S=g.wH.Dot(n,I);if(0===S)return null;const M=1/S;this.origin.subtractToRef(E,l);const V=g.wH.Dot(l,I)*M;if(V<-this.epsilon||V>1+this.epsilon)return null;g.wH.CrossToRef(l,n,t);const w=g.wH.Dot(this.direction,t)*M;if(w<-this.epsilon||V+w>1+this.epsilon)return null;const R=g.wH.Dot(Z,t)*M;return R>this.length?null:new r.d(1-V-w,V,R)}intersectsPlane(E){let H;const d=g.wH.Dot(E.normal,this.direction);if(Math.abs(d)<9.99999997475243e-7)return null;{const n=g.wH.Dot(E.normal,this.origin);return H=(-E.d-n)/d,H<0?H<-9.99999997475243e-7?null:0:H}}intersectsAxis(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(E){case"y":{const E=(this.origin.y-H)/this.direction.y;return E>0?null:new g.wH(this.origin.x+this.direction.x*-E,H,this.origin.z+this.direction.z*-E)}case"x":{const E=(this.origin.x-H)/this.direction.x;return E>0?null:new g.wH(H,this.origin.y+this.direction.y*-E,this.origin.z+this.direction.z*-E)}case"z":{const E=(this.origin.z-H)/this.direction.z;return E>0?null:new g.wH(this.origin.x+this.direction.x*-E,this.origin.y+this.direction.y*-E,H)}default:return null}}intersectsMesh(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4?arguments[4]:void 0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const l=g.TmpVectors.Matrix[0];return E.getWorldMatrix().invertToRef(l),this._tmpRay?C.TransformToRef(this,l,this._tmpRay):this._tmpRay=C.Transform(this,l),E.intersects(this._tmpRay,H,d,n,Z,I)}intersectsMeshes(E,H,d){d?d.length=0:d=[];for(let n=0;n<E.length;n++){const Z=this.intersectsMesh(E[n],H);Z.hit&&d.push(Z)}return d.sort(this._comparePickingInfo),d}_comparePickingInfo(E,H){return E.distance<H.distance?-1:E.distance>H.distance?1:0}intersectionSegment(E,H,d){const n=this.origin,Z=g.TmpVectors.wH[0],I=g.TmpVectors.wH[1],l=g.TmpVectors.wH[2],r=g.TmpVectors.wH[3];H.subtractToRef(E,Z),this.direction.scaleToRef(C._Rayl,l),n.addToRef(l,I),E.subtractToRef(n,r);const t=g.wH.Dot(Z,Z),S=g.wH.Dot(Z,l),M=g.wH.Dot(l,l),V=g.wH.Dot(Z,r),w=g.wH.Dot(l,r),R=t*M-S*S;let Q,L,D=R,e=R;R<C._Smallnum?(Q=0,D=1,L=w,e=M):(Q=S*w-M*V,L=t*w-S*V,Q<0?(Q=0,L=w,e=M):Q>D&&(Q=D,L=w+S,e=M)),L<0?(L=0,-V<0?Q=0:-V>t?Q=D:(Q=-V,D=t)):L>e&&(L=e,-V+S<0?Q=0:-V+S>t?Q=D:(Q=-V+S,D=t));const s=Math.abs(Q)<C._Smallnum?0:Q/D,i=Math.abs(L)<C._Smallnum?0:L/e,p=g.TmpVectors.wH[4];l.scaleToRef(i,p);const f=g.TmpVectors.wH[5];Z.scaleToRef(s,f),f.addInPlace(r);const P=g.TmpVectors.wH[6];f.subtractToRef(p,P);return i>0&&i<=this.length&&P.lengthSquared()<d*d?f.length():-1}update(E,H,d,n,Z,I,l){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){C._RayDistant||(C._RayDistant=C.Zero()),C._RayDistant.unprojectRayToRef(E,H,d,n,g.Matrix.IdentityReadOnly,I,l);const r=g.TmpVectors.Matrix[0];Z.invertToRef(r),C.TransformToRef(C._RayDistant,r,this)}else this.unprojectRayToRef(E,H,d,n,Z,I,l);return this}static Zero(){return new C(g.wH.Zero(),g.wH.Zero())}static CreateNew(E,H,d,n,Z,I,g){return C.Zero().update(E,H,d,n,Z,I,g)}static CreateNewFromTo(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.Matrix.IdentityReadOnly;const n=new C(new g.wH(0,0,0),new g.wH(0,0,0));return C.CreateFromToToRef(E,H,n,d)}static CreateFromToToRef(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.Matrix.IdentityReadOnly;d.origin.l(E);const Z=H.subtractToRef(E,d.direction),I=Math.sqrt(Z.x*Z.x+Z.y*Z.y+Z.z*Z.z);return d.length=I,d.direction.normalize(),C.TransformToRef(d,n,d)}static Transform(E,H){const d=new C(new g.wH(0,0,0),new g.wH(0,0,0));return C.TransformToRef(E,H,d),d}static TransformToRef(E,H,d){g.wH.TransformCoordinatesToRef(E.origin,H,d.origin),g.wH.TransformNormalToRef(E.direction,H,d.direction),d.length=E.length,d.epsilon=E.epsilon;const n=d.direction,Z=n.length();if(0!==Z&&1!==Z){const E=1/Z;n.x*=E,n.y*=E,n.z*=E,d.length*=Z}return d}unprojectRayToRef(E,H,d,n,Z,I,l){const r=g.TmpVectors.Matrix[0];Z.multiplyToRef(I,r),r.multiplyToRef(l,r),r.invert();const t=S.b.LastCreatedEngine,M=g.TmpVectors.wH[0];M.x=E/d*2-1,M.y=-(H/n*2-1),M.z=null!==t&&void 0!==t&&t.o?1:null!==t&&void 0!==t&&t.isNDCHalfZRange?0:-1;const V=g.TmpVectors.wH[1].en(M.x,M.y,1-1e-8),C=g.TmpVectors.wH[2],w=g.TmpVectors.wH[3];g.wH._UnprojectFromInvertedMatrixToRef(M,r,C),g.wH._UnprojectFromInvertedMatrixToRef(V,r,w),this.origin.l(C),w.subtractToRef(C,this.direction),this.direction.normalize()}}function w(E,H,d,n,Z){let I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=C.Zero();return R(E,H,d,n,g,Z,I),g}function R(E,H,d,n,Z,I){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const t=E.getEngine();if(!I&&!(I=E.activeCamera))return E;const S=I.viewport,M=t.getRenderHeight(),{x:V,y:C,width:w,height:R}=S.toGlobal(t.getRenderWidth(),M),Q=1/t.getHardwareScalingLevel();return H=H*Q-V,d=d*Q-(M-C-R),Z.update(H,d,w,R,n||g.Matrix.IdentityReadOnly,l?g.Matrix.IdentityReadOnly:I.getViewMatrix(),I.getProjectionMatrix(),r),E}function Q(E,H,d,n,Z){if(!t.c)return E;const I=E.getEngine();if(!Z&&!(Z=E.activeCamera))throw new Error("Active camera not set");const l=Z.viewport,r=I.getRenderHeight(),{x:S,y:M,width:V,height:C}=l.toGlobal(I.getRenderWidth(),r),w=g.Matrix.Identity(),R=1/I.getHardwareScalingLevel();return H=H*R-S,d=d*R-(r-M-C),n.update(H,d,V,C,w,w,Z.getProjectionMatrix()),E}function L(E,H,d,n,Z,I,g,l){const r=H(n,d.enableDistantPicking),t=d.intersects(r,Z,g,I,n,l);return t&&t.hit?!Z&&null!=E&&t.distance>=E.distance?null:t:null}function D(E,H,d,n,Z,I){let l=null;const r=!!(E.activeCameras&&E.activeCameras.length>1&&E.cameraToUseForPointers!==E.activeCamera),S=E.cameraToUseForPointers||E.activeCamera,M=V.internalPickerForMesh||L;for(let t=0;t<E.meshes.length;t++){const V=E.meshes[t];if(d){if(!d(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.Tr)continue;const C=r&&V.isWorldMatrixCameraDependent(),w=V.yd(C,S);if(V.hasThinInstances&&V.Yt){const E=M(l,H,V,w,!0,!0,I);if(E){if(Z)return E;const r=g.TmpVectors.Matrix[1],t=V.thinInstanceGetWorldMatrices();for(let E=0;E<t.length;E++){if(d&&!d(V,E))continue;t[E].multiplyToRef(w,r);const g=M(l,H,V,r,n,Z,I,!0);if(g&&(l=g,l.thinInstanceIndex=E,n))return l}}}else{const E=M(l,H,V,w,n,Z,I);if(E&&(l=E,n))return l}}return l||new t.c}function e(E,H,d,n){if(!t.c)return null;const Z=[],I=!!(E.activeCameras&&E.activeCameras.length>1&&E.cameraToUseForPointers!==E.activeCamera),l=E.cameraToUseForPointers||E.activeCamera,r=V.internalPickerForMesh||L;for(let t=0;t<E.meshes.length;t++){const S=E.meshes[t];if(d){if(!d(S,-1))continue}else if(!S.isEnabled()||!S.isVisible||!S.Tr)continue;const M=I&&S.isWorldMatrixCameraDependent(),V=S.yd(M,l);if(S.hasThinInstances&&S.Yt){if(r(null,H,S,V,!0,!0,n)){const E=g.TmpVectors.Matrix[1],I=S.thinInstanceGetWorldMatrices();for(let g=0;g<I.length;g++){if(d&&!d(S,g))continue;I[g].multiplyToRef(V,E);const l=r(null,H,S,E,!1,!1,n,!0);l&&(l.thinInstanceIndex=g,Z.push(l))}}}else{const E=r(null,H,S,V,!1,!1,n);E&&Z.push(E)}}return Z}function s(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3?arguments[3]:void 0,Z=arguments.length>4?arguments[4]:void 0;n||(n=E.getWorldMatrix()),H.length=d,Z?H.origin.l(Z):H.origin.l(E.position);const I=g.TmpVectors.wH[2];I.set(0,0,E._scene.useRightHandedSystem?-1:1);const l=g.TmpVectors.wH[3];return g.wH.TransformNormalToRef(I,n,l),g.wH.NormalizeToRef(l,H.direction),H}var i,p;C._TmpVector3=(0,l.e)(6,g.wH.Zero),C._RayDistant=C.Zero(),C._Smallnum=1e-8,C._Rayl=1e9,i=n.c,(p=Z.b)&&(p.prototype.getForwardRay=function(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,H=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;return s(this,new C(g.wH.Zero(),g.wH.Zero(),E),E,H,d)},p.prototype.getForwardRayToRef=function(E){return s(this,E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),i&&(M.b._IsPickingAvailable=!0,i.prototype.createPickingRay=function(E,H,d,n){return w(this,E,H,d,n,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),n.c.prototype.createPickingRayToRef=function(E,H,d,n,Z){return R(this,E,H,d,n,Z,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},n.c.prototype.createPickingRayInCameraSpace=function(E,H,d){return function(E,H,d,n){const Z=C.Zero();return Q(E,H,d,Z,n),Z}(this,E,H,d)},n.c.prototype.createPickingRayInCameraSpaceToRef=function(E,H,d,n){return Q(this,E,H,d,n)},n.c.prototype.pickWithBoundingInfo=function(E,H,d,n,Z){return function(E,H,d,n,Z,I){if(!t.c)return null;const l=D(E,(n=>(E._tempPickingRay||(E._tempPickingRay=C.Zero()),R(E,H,d,n,E._tempPickingRay,I||null),E._tempPickingRay)),n,Z,!0);return l&&(l.ray=w(E,H,d,g.Matrix.Identity(),I||null)),l}(this,E,H,d,n,Z)},n.c.prototype.Pd=function(E,H,d,n,Z,I){return function(E,H,d,n,Z,I,l){const r=D(E,((n,Z)=>(E._tempPickingRay||(E._tempPickingRay=C.Zero()),R(E,H,d,n,E._tempPickingRay,I||null,!1,Z),E._tempPickingRay)),n,Z,!1,l);return r&&(r.ray=w(E,H,d,g.Matrix.Identity(),I||null)),r}(this,E,H,d,n,Z,I)},n.c.prototype.pickWithRay=function(E,H,d,n){return function(E,H,d,n,Z){const I=D(E,(d=>(E._pickWithRayInverseMatrix||(E._pickWithRayInverseMatrix=g.Matrix.Identity()),d.invertToRef(E._pickWithRayInverseMatrix),E._cachedRayForTransform||(E._cachedRayForTransform=C.Zero()),C.TransformToRef(H,E._pickWithRayInverseMatrix,E._cachedRayForTransform),E._cachedRayForTransform)),d,n,!1,Z);return I&&(I.ray=H),I}(this,E,H,d,n)},n.c.prototype.multiPick=function(E,H,d,n,Z){return function(E,H,d,n,Z,I){return e(E,(n=>w(E,H,d,n,Z||null)),n,I)}(this,E,H,d,n,Z)},n.c.prototype.multiPickWithRay=function(E,H,d){return function(E,H,d,n){return e(E,(d=>(E._pickWithRayInverseMatrix||(E._pickWithRayInverseMatrix=g.Matrix.Identity()),d.invertToRef(E._pickWithRayInverseMatrix),E._cachedRayForTransform||(E._cachedRayForTransform=C.Zero()),C.TransformToRef(H,E._pickWithRayInverseMatrix,E._cachedRayForTransform),E._cachedRayForTransform)),d,n)}(this,E,H,d)}},14066:(E,H,d)=>{"use strict";var n=d(12323),Z=d(12237),I=d(12271),g=d(12350),l=d(12296),r=d(12331);l.c.prototype._partialLoadFile=function(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(E,(E=>{d[H]=E,d._internalCount++,6===d._internalCount&&n(d)}),void 0,void 0,!0,((E,H)=>{Z&&E&&Z(E.status+" "+E.statusText,H)}))},l.c.prototype._cascadeLoadFiles=function(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Z=[];Z._internalCount=0;for(let I=0;I<6;I++)this._partialLoadFile(d[I],I,Z,H,n)},l.c.prototype._cascadeLoadImgs=function(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5?arguments[5]:void 0;const g=[];g._internalCount=0;for(let l=0;l<6;l++)this._partialLoadImg(n[l],l,g,E,H,d,Z,I)},l.c.prototype._partialLoadImg=function(E,H,d,n,Z,l){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7?arguments[7]:void 0;const S=(0,g.e)();(0,I.p)(E,(E=>{d[H]=E,d._internalCount++,n&&n.removePendingData(S),6===d._internalCount&&l&&l(Z,d)}),((E,H)=>{n&&n.removePendingData(S),r&&r(E,H)}),n?n.offlineProvider:null,t),n&&n.addPendingData(S)},l.c.prototype.createCubeTextureBase=function(E,H,d,I){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]&&arguments[8],V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,C=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,R=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,Q=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,L=arguments.length>14&&void 0!==arguments[14]&&arguments[14],D=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const e=w||new n.d(this,7);e.isCube=!0,e.url=E,e.generateMipMaps=!I,e._lodGenerationScale=V,e._lodGenerationOffset=C,e._useSRGBBuffer=!!L&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!I),e!==w&&(e.label=E.substring(0,60)),this._doNotHandleContextLost||(e._extension=S,e._files=d,e._buffer=D);const s=E;this._transformTextureUrl&&!w&&(E=this._transformTextureUrl(E));const i=S??function(E){const H=E.split("?")[0],d=H.lastIndexOf(".");return d>-1?H.substring(d).toLowerCase():""}(E),p=(0,r.c)(i),f=(E,H)=>{e.dispose(),l?l(E,H):E&&Z.b.Warn(E)},P=(n,l)=>{E===s?n&&f(n.status+" "+n.statusText,l):(Z.b.Warn(`Failed to load ${E}, falling back to the ${s}`),this.createCubeTextureBase(s,H,d,!!I,g,f,t,S,M,V,C,e,R,Q,L,D))};if(p)p.then((n=>{const Z=E=>{R&&R(e,E),n.loadCubeData(E,e,M,g,((E,H)=>{f(E,H)}))};D?Z(D):d&&6===d.length?n.supportCascades?this._cascadeLoadFiles(H,(E=>Z(E.map((E=>new Uint8Array(E))))),d,f):f("Textures type does not support cascades."):this._loadFile(E,(E=>Z(new Uint8Array(E))),void 0,void 0,!0,P)}));else{if(!d||0===d.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(H,e,((E,H)=>{Q&&Q(E,H)}),d,f)}return this._internalTexturesCache.push(e),e}},14624:(E,H,d)=>{"use strict";d(12237);var n=d(12522);d(12323),d(12471),d(12321),d(12571),d(12533);n.b},14095:(E,H,d)=>{"use strict";d.d(H,{c:()=>Z});var n=d(12344);class Z{constructor(E){this.value=this._toInt(E)}_toInt(E){return 0|E}add(E){return new Z(this.value+E.value)}RH(E){return new Z(this.value-E.value)}multiply(E){return new Z(Math.imul(this.value,E.value))}divide(E){return new Z(this.value/E.value)}getClassName(){return Z.ClassName}equals(E){return this.value===E.value}static FromValue(E){return new Z(E)}toString(){return this.value.toString()}}Z.ClassName="FlowGraphInteger",(0,n.e)("FlowGraphInteger",Z)},14107:(E,H,d)=>{"use strict";d.d(H,{c:()=>Z,d:()=>I});var n=d(12384);class Z{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.sd=E}get m(){return this.sd}transformVector(E){return this.transformVectorToRef(E,new n.Vector2)}transformVectorToRef(E,H){return H.x=E.x*this.sd[0]+E.y*this.sd[1],H.y=E.x*this.sd[2]+E.y*this.sd[3],H}kd(){return this.toArray()}toArray(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let H=0;H<4;H++)E[H]=this.sd[H];return E}Xd(E){for(let H=0;H<4;H++)this.sd[H]=E[H];return this}multiplyToRef(E,H){const d=E.sd,n=this.sd,Z=H.sd;return Z[0]=d[0]*n[0]+d[1]*n[2],Z[1]=d[0]*n[1]+d[1]*n[3],Z[2]=d[2]*n[0]+d[3]*n[2],Z[3]=d[2]*n[1]+d[3]*n[3],H}multiply(E){return this.multiplyToRef(E,new Z)}divideToRef(E,H){const d=this.sd,n=E.sd,Z=H.sd;return Z[0]=d[0]/n[0],Z[1]=d[1]/n[1],Z[2]=d[2]/n[2],Z[3]=d[3]/n[3],H}divide(E){return this.divideToRef(E,new Z)}addToRef(E,H){const d=this.sd,n=E.m,Z=H.m;return Z[0]=d[0]+n[0],Z[1]=d[1]+n[1],Z[2]=d[2]+n[2],Z[3]=d[3]+n[3],H}add(E){return this.addToRef(E,new Z)}subtractToRef(E,H){const d=this.sd,n=E.m,Z=H.m;return Z[0]=d[0]-n[0],Z[1]=d[1]-n[1],Z[2]=d[2]-n[2],Z[3]=d[3]-n[3],H}RH(E){return this.subtractToRef(E,new Z)}transpose(){const E=this.sd;return new Z([E[0],E[2],E[1],E[3]])}determinant(){const E=this.sd;return E[0]*E[3]-E[1]*E[2]}inverse(){const E=this.determinant();if(0===E)throw new Error("Matrix is not invertible");const H=this.sd,d=1/E;return new Z([H[3]*d,-H[1]*d,-H[2]*d,H[0]*d])}equals(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const d=this.sd,n=E.m;return 0===H?d[0]===n[0]&&d[1]===n[1]&&d[2]===n[2]&&d[3]===n[3]:Math.abs(d[0]-n[0])<H&&Math.abs(d[1]-n[1])<H&&Math.abs(d[2]-n[2])<H&&Math.abs(d[3]-n[3])<H}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.sd.join(", ")})`}}class I{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.sd=E}get m(){return this.sd}transformVector(E){return this.transformVectorToRef(E,new n.wH)}transformVectorToRef(E,H){const d=this.sd;return H.x=E.x*d[0]+E.y*d[1]+E.z*d[2],H.y=E.x*d[3]+E.y*d[4]+E.z*d[5],H.z=E.x*d[6]+E.y*d[7]+E.z*d[8],H}multiplyToRef(E,H){const d=E.sd,n=this.sd,Z=H.m;return Z[0]=d[0]*n[0]+d[1]*n[3]+d[2]*n[6],Z[1]=d[0]*n[1]+d[1]*n[4]+d[2]*n[7],Z[2]=d[0]*n[2]+d[1]*n[5]+d[2]*n[8],Z[3]=d[3]*n[0]+d[4]*n[3]+d[5]*n[6],Z[4]=d[3]*n[1]+d[4]*n[4]+d[5]*n[7],Z[5]=d[3]*n[2]+d[4]*n[5]+d[5]*n[8],Z[6]=d[6]*n[0]+d[7]*n[3]+d[8]*n[6],Z[7]=d[6]*n[1]+d[7]*n[4]+d[8]*n[7],Z[8]=d[6]*n[2]+d[7]*n[5]+d[8]*n[8],H}multiply(E){return this.multiplyToRef(E,new I)}divideToRef(E,H){const d=this.sd,n=E.m,Z=H.m;return Z[0]=d[0]/n[0],Z[1]=d[1]/n[1],Z[2]=d[2]/n[2],Z[3]=d[3]/n[3],Z[4]=d[4]/n[4],Z[5]=d[5]/n[5],Z[6]=d[6]/n[6],Z[7]=d[7]/n[7],Z[8]=d[8]/n[8],H}divide(E){return this.divideToRef(E,new I)}addToRef(E,H){const d=this.sd,n=E.m,Z=H.m;return Z[0]=d[0]+n[0],Z[1]=d[1]+n[1],Z[2]=d[2]+n[2],Z[3]=d[3]+n[3],Z[4]=d[4]+n[4],Z[5]=d[5]+n[5],Z[6]=d[6]+n[6],Z[7]=d[7]+n[7],Z[8]=d[8]+n[8],H}add(E){return this.addToRef(E,new I)}subtractToRef(E,H){const d=this.sd,n=E.m,Z=H.m;return Z[0]=d[0]-n[0],Z[1]=d[1]-n[1],Z[2]=d[2]-n[2],Z[3]=d[3]-n[3],Z[4]=d[4]-n[4],Z[5]=d[5]-n[5],Z[6]=d[6]-n[6],Z[7]=d[7]-n[7],Z[8]=d[8]-n[8],H}RH(E){return this.subtractToRef(E,new I)}toArray(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let H=0;H<9;H++)E[H]=this.sd[H];return E}kd(){return this.toArray()}Xd(E){for(let H=0;H<9;H++)this.sd[H]=E[H];return this}transpose(){const E=this.sd;return new I([E[0],E[3],E[6],E[1],E[4],E[7],E[2],E[5],E[8]])}determinant(){const E=this.sd;return E[0]*(E[4]*E[8]-E[5]*E[7])-E[1]*(E[3]*E[8]-E[5]*E[6])+E[2]*(E[3]*E[7]-E[4]*E[6])}inverse(){const E=this.determinant();if(0===E)throw new Error("Matrix is not invertible");const H=this.sd,d=1/E;return new I([(H[4]*H[8]-H[5]*H[7])*d,(H[2]*H[7]-H[1]*H[8])*d,(H[1]*H[5]-H[2]*H[4])*d,(H[5]*H[6]-H[3]*H[8])*d,(H[0]*H[8]-H[2]*H[6])*d,(H[2]*H[3]-H[0]*H[5])*d,(H[3]*H[7]-H[4]*H[6])*d,(H[1]*H[6]-H[0]*H[7])*d,(H[0]*H[4]-H[1]*H[3])*d])}equals(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const d=this.sd,n=E.m;return 0===H?d[0]===n[0]&&d[1]===n[1]&&d[2]===n[2]&&d[3]===n[3]&&d[4]===n[4]&&d[5]===n[5]&&d[6]===n[6]&&d[7]===n[7]&&d[8]===n[8]:Math.abs(d[0]-n[0])<H&&Math.abs(d[1]-n[1])<H&&Math.abs(d[2]-n[2])<H&&Math.abs(d[3]-n[3])<H&&Math.abs(d[4]-n[4])<H&&Math.abs(d[5]-n[5])<H&&Math.abs(d[6]-n[6])<H&&Math.abs(d[7]-n[7])<H&&Math.abs(d[8]-n[8])<H}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.sd.join(", ")})`}}},14115:(E,H,d)=>{"use strict";var n;function Z(E,H,d,n){switch(H){case"Animation":return n?E.animations.find((E=>E.uniqueId===d))??null:E.animations[d]??null;case"AnimationGroup":return n?E.animationGroups.find((E=>E.uniqueId===d))??null:E.animationGroups[d]??null;case"Mesh":return n?E.meshes.find((E=>E.uniqueId===d))??null:E.meshes[d]??null;case"Material":return n?E.materials.find((E=>E.uniqueId===d))??null:E.materials[d]??null;case"pS":return n?E.cameras.find((E=>E.uniqueId===d))??null:E.cameras[d]??null;case"Light":return n?E.lights.find((E=>E.uniqueId===d))??null:E.lights[d]??null;default:return null}}d.d(H,{b:()=>Z}),function(E){E.Animation="Animation",E.AnimationGroup="AnimationGroup",E.Mesh="Mesh",E.Material="Material",E.pS="pS",E.Light="Light"}(n||(n={}))},14137:(E,H,d)=>{"use strict";d.d(H,{b:()=>Z});var n=d(14140);class Z extends n.d{constructor(E,H){if(super(E),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),H)for(const d of H)this._eventsSignalOutputs[d]=this._registerSignalOutput(d+"Event")}_executeOnTick(E){}_startPendingTasks(E){E._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(E),this._resetAfterCanceled(E)),this._preparePendingTasks(E),E._addPendingBlock(this),this.out._activateSignal(E),E._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(E){E._deleteExecutionVariable(this,"_initialized"),E._removePendingBlock(this)}}},14125:(E,H,d)=>{"use strict";d.d(H,{c:()=>t});var n=d(12350),Z=d(12344),I=d(14127),g=d(12230),l=d(14089);class r extends I.b{constructor(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.defaultValue,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(E,H,d),this.richType=n,this._defaultValue=Z,this._optional=I,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new g.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(E){this._isDisabled!==E&&(this._isDisabled=E,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(E,H){H._getConnectionValue(this)!==E&&(H._setConnectionValue(this,E),this.onValueChangedObservable.notifyObservers(E))}resetToDefaultValue(E){E._setConnectionValue(this,this._defaultValue)}connectTo(E){this._isDisabled||super.connectTo(E)}_getValueOrDefault(E){const H=E._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(H):H}getValue(E){if(1===this.connectionType){E._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(E);const H=this._getValueOrDefault(E);return this._lastValue=H,this.richType.typeTransformer?this.richType.typeTransformer(H):H}const H=this.isConnected()?this._connectedPoint[0].getValue(E):this._getValueOrDefault(E);return this._lastValue=H,this.richType.typeTransformer?this.richType.typeTransformer(H):H}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(E),E.richType={},this.richType.serialize(E.richType),E.optional=this._optional,(0,l.h)("defaultValue",this._defaultValue,E)}}(0,Z.e)("FlowGraphDataConnection",r);class t{constructor(E){var H;this.config=E,this.uniqueId=(0,n.e)(),this.name=(null===(H=this.config)||void 0===H?void 0:H.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(E){}registerDataInput(E,H,d){const n=new r(E,0,this,H,d);return this.dataInputs.push(n),n}registerDataOutput(E,H,d){const n=new r(E,1,this,H,d);return this.dataOutputs.push(n),n}getDataInput(E){return this.dataInputs.find((H=>H.name===E))}getDataOutput(E){return this.dataOutputs.find((H=>H.name===E))}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.h;if(E.uniqueId=this.uniqueId,E.config={},this.config){const d=this.config,n=Object.keys(d);for(const Z of n)H(Z,d[Z],E.config)}E.dataInputs=[],E.dataOutputs=[],E.className=this.getClassName();for(const d of this.dataInputs){const H={};d.serialize(H),E.dataInputs.push(H)}for(const d of this.dataOutputs){const H={};d.serialize(H),E.dataOutputs.push(H)}}deserialize(E){}_log(E,H,d){var n;null===(n=E.logger)||void 0===n||n.addLogItem({action:H,Wd:d,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14127:(E,H,d)=>{"use strict";d.d(H,{b:()=>I});var n,Z=d(12350);!function(E){E[E.Input=0]="Input",E[E.Output=1]="Output"}(n||(n={}));class I{constructor(E,H,d){this._ownerBlock=d,this._connectedPoint=[],this.uniqueId=(0,Z.e)(),this.connectedPointIds=[],this.name=E,this._connectionType=H}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(E){if(this._connectionType===E._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||E._isSingularConnection()&&E._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(E),E._connectedPoint.push(this)}disconnectFrom(E){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const d=this._connectedPoint.indexOf(E),n=E._connectedPoint.indexOf(this);-1!==d&&-1!==n&&(H&&this._connectedPoint.splice(d,1),E._connectedPoint.splice(n,1))}disconnectFromAll(){for(const E of this._connectedPoint)this.disconnectFrom(E,!1);this._connectedPoint.length=0}dispose(){for(const E of this._connectedPoint)this.disconnectFrom(E)}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};E.uniqueId=this.uniqueId,E.name=this.name,E._connectionType=this._connectionType,E.connectedPointIds=[],E.className=this.getClassName();for(const H of this._connectedPoint)E.connectedPointIds.push(H.uniqueId)}getClassName(){return"FGConnection"}deserialize(E){this.uniqueId=E.uniqueId,this.name=E.name,this._connectionType=E._connectionType,this.connectedPointIds=E.connectedPointIds}}},14084:(E,H,d)=>{"use strict";d.d(H,{b:()=>e});var n,Z=d(12230),I=d(12369),g=d(12372),l=d(12350),r=d(14089),t=d(14115),S=d(12237);!function(E){E.ExecuteBlock="ExecuteBlock",E.ExecuteEvent="ExecuteEvent",E.TriggerConnection="TriggerConnection",E.ContextVariableSet="ContextVariableSet",E.GlobalVariableSet="GlobalVariableSet",E.GlobalVariableDelete="GlobalVariableDelete",E.GlobalVariableGet="GlobalVariableGet",E.AddConnection="AddConnection",E.GetConnectionValue="GetConnectionValue",E.SetConnectionValue="SetConnectionValue",E.ActivateSignal="ActivateSignal",E.ContextVariableGet="ContextVariableGet"}(n||(n={}));class M{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(E){if(E.time||(E.time=Date.now()),this.log.push(E),this.logToConsole){var H;const d=null===(H=E.Wd)||void 0===H?void 0:H.value;"object"===typeof d&&d.getClassName?S.b.Log(`[FGLog] ${E.className}:${E.uniqueId.split("-")[0]} ${E.action} - ${JSON.stringify(d.getClassName())}: ${d.toString()}`):S.b.Log(`[FGLog] ${E.className}:${E.uniqueId.split("-")[0]} ${E.action} - ${JSON.stringify(E.Wd)}`)}}getItemsOfType(E){return this.log.filter((H=>H.action===E))}}class V{get enableLogging(){return this._enableLogging}set enableLogging(E){this._enableLogging!==E&&(this._enableLogging=E,this._enableLogging?(this.logger=new M,this.logger.logToConsole=!0):this.logger=null)}constructor(E){this.uniqueId=(0,l.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new Z.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=E,this.assetsContext=E.assetsContext??E.QH}hasVariable(E){return E in this._userVariables}setVariable(E,H){var d;this._userVariables[E]=H,null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Wd:{name:E,value:H}})}getAsset(E,H){return(0,t.b)(this.assetsContext,E,H)}getVariable(E){var H;return null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Wd:{name:E,value:this._userVariables[E]}}),this._userVariables[E]}get userVariables(){return this._userVariables}fE(){return this._configuration.QH}_getUniqueIdPrefixedName(E,H){return`${E.uniqueId}_${H}`}_getGlobalContextVariable(E,H){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Wd:{name:E,defaultValue:H,possibleValue:this._globalContextVariables[E]}}),this._hasGlobalContextVariable(E)?this._globalContextVariables[E]:H}_setGlobalContextVariable(E,H){var d;null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Wd:{name:E,value:H}}),this._globalContextVariables[E]=H}_deleteGlobalContextVariable(E){var H;null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Wd:{name:E}}),delete this._globalContextVariables[E]}_hasGlobalContextVariable(E){return E in this._globalContextVariables}_setExecutionVariable(E,H,d){this._executionVariables[this._getUniqueIdPrefixedName(E,H)]=d}_getExecutionVariable(E,H,d){return this._hasExecutionVariable(E,H)?this._executionVariables[this._getUniqueIdPrefixedName(E,H)]:d}_deleteExecutionVariable(E,H){delete this._executionVariables[this._getUniqueIdPrefixedName(E,H)]}_hasExecutionVariable(E,H){return this._getUniqueIdPrefixedName(E,H)in this._executionVariables}_hasConnectionValue(E){return E.uniqueId in this._connectionValues}_setConnectionValue(E,H){var d;this._connectionValues[E.uniqueId]=H,null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Wd:{connectionPointId:E.uniqueId,value:H}})}_setConnectionValueByKey(E,H){this._connectionValues[E]=H}_getConnectionValue(E){var H;return null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Wd:{connectionPointId:E.uniqueId,value:this._connectionValues[E.uniqueId]}}),this._connectionValues[E.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(E){this._pendingBlocks.includes(E)||(this._pendingBlocks.push(E),this._pendingBlocks.sort(((E,H)=>E.priority-H.priority)))}_removePendingBlock(E){const H=this._pendingBlocks.indexOf(E);-1!==H&&this._pendingBlocks.splice(H,1)}_clearPendingBlocks(){for(const E of this._pendingBlocks)E._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(E){var H;this.onNodeExecutedObservable.notifyObservers(E),null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:E.getClassName(),uniqueId:E.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(E){this._setGlobalContextVariable("timeSinceStart",E.timeSinceStart),this._setGlobalContextVariable("deltaTime",E.deltaTime);for(const d of this._pendingBlocks){var H;null===(H=d._executeOnTick)||void 0===H||H.call(d,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.h;E.uniqueId=this.uniqueId,E._userVariables={};for(const n in this._userVariables)H(n,this._userVariables[n],E._userVariables);E._connectionValues={};for(const n in this._connectionValues)H(n,this._connectionValues[n],E._connectionValues);var d;this.assetsContext!==this.fE()&&(E._assetsContext={meshes:this.assetsContext.meshes.map((E=>E.id)),materials:this.assetsContext.materials.map((E=>E.id)),textures:this.assetsContext.textures.map((E=>E.name)),animations:this.assetsContext.animations.map((E=>E.name)),lights:this.assetsContext.lights.map((E=>E.id)),cameras:this.assetsContext.cameras.map((E=>E.id)),bV:null===(d=this.assetsContext.bV)||void 0===d?void 0:d.map((E=>E.name)),skeletons:this.assetsContext.skeletons.map((E=>E.id)),lV:this.assetsContext.lV.map((E=>E.name)),geometries:this.assetsContext.geometries.map((E=>E.id)),multiMaterials:this.assetsContext.multiMaterials.map((E=>E.id)),transformNodes:this.assetsContext.transformNodes.map((E=>E.id))})}getClassName(){return"FlowGraphContext"}}(0,I.e)([(0,g.K)()],V.prototype,"uniqueId",void 0);var C=d(14123),w=d(12670);class R{constructor(E){this.onEventTriggeredObservable=new Z.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=E,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Qd.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const E=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Wd:{timeSinceStart:this._startingTime,deltaTime:E}}),this._startingTime+=E})),this._meshPickedObserver=this._scene.onPointerObservable.add((E=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Wd:E})}),w.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((E=>{const H=E.pointerId,d=E.mesh,n=this._pointerUnderMeshState[H];!n&&d?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Wd:{pointerId:H,mesh:d}}):n&&!d?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Wd:{pointerId:H,mesh:n}}):n&&d&&n!==d&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Wd:{pointerId:H,mesh:n,over:d}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Wd:{pointerId:H,mesh:d,out:n}})),this._pointerUnderMeshState[H]=d}),w.e.POINTERMOVE)}dispose(){var E,H,d,n,Z;null===(E=this._sceneDisposeObserver)||void 0===E||E.remove(),null===(H=this._sceneReadyObserver)||void 0===H||H.remove(),null===(d=this._sceneOnBeforeRenderObserver)||void 0===d||d.remove(),null===(n=this._meshPickedObserver)||void 0===n||n.remove(),null===(Z=this._meshUnderPointerObserver)||void 0===Z||Z.remove(),this.onEventTriggeredObservable.clear()}}var Q,L=d(14132);!function(E){E[E.Stopped=0]="Stopped",E[E.Started=1]="Started"}(Q||(Q={}));class D{get state(){return this._state}set state(E){this._state=E,this.onStateChangedObservable.notifyObservers(E)}constructor(E){this.onStateChangedObservable=new Z.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=E.QH,this._sceneEventCoordinator=new R(this._scene),this._coordinator=E.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((E=>{for(const H of this._executionContexts){const d=this._getContextualOrder(E.type,H);for(const n of d)if(!n._executeEvent(H,E.Wd))break}switch(E.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const H of this._executionContexts)H._notifyOnTick(E.Wd);break;case"SceneDispose":this.dispose()}}))}createContext(){const E=new V({QH:this._scene,coordinator:this._coordinator});return this._executionContexts.push(E),E}getContext(E){return this._executionContexts[E]}addEventBlock(E){if("PointerOver"!==E.type&&"PointerOut"!==E.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==E.type&&this._eventBlocks[E.type].push(E),1===this.state)for(const H of this._executionContexts)E._startPendingTasks(H);else this.onStateChangedObservable.addOnce((H=>{if(1===H)for(const d of this._executionContexts)E._startPendingTasks(d)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((E=>{1===E&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const E of this._executionContexts)for(const H in this._eventBlocks){const d=this._getContextualOrder(H,E);for(const H of d)H._startPendingTasks(E)}}_getContextualOrder(E,H){const d=this._eventBlocks[E].sort(((E,H)=>H.initPriority-E.initPriority));if("MeshPick"===E){const E=[];for(const n of d){const Z=n.asset.getValue(H);let I=0;for(;I<d.length;I++){const E=d[I].asset.getValue(H);if(Z&&E&&(0,L.i)(Z,E))break}E.splice(I,0,n)}return E}return d}dispose(){var E;if(0!==this.state){this.state=0;for(const E of this._executionContexts)E._clearPendingBlocks();this._executionContexts.length=0;for(const E in this._eventBlocks)this._eventBlocks[E].length=0;null===(E=this._eventObserver)||void 0===E||E.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(E){const H=[],d=new Set;for(const n in this._eventBlocks)for(const E of this._eventBlocks[n])H.push(E),d.add(E.uniqueId);for(;H.length>0;){const n=H.pop();E(n);for(const E of n.dataInputs)for(const n of E._connectedPoint)d.has(n._ownerBlock.uniqueId)||(H.push(n._ownerBlock),d.add(n._ownerBlock.uniqueId));if(n instanceof C.e)for(const E of n.signalOutputs)for(const n of E._connectedPoint)d.has(n._ownerBlock.uniqueId)||(H.push(n._ownerBlock),d.add(n._ownerBlock.uniqueId))}}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},H=arguments.length>1?arguments[1]:void 0;E.allBlocks=[],this.visitAllBlocks((H=>{const d={};H.serialize(d),E.allBlocks.push(d)})),E.executionContexts=[];for(const d of this._executionContexts){const n={};d.serialize(n,H),E.executionContexts.push(n)}}}class e{constructor(E){this.config=E,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.QH.Qd.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.QH.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const E=this._executeOnNextFrame.slice(0);if(E.length)for(const H of E){this.notifyCustomEvent(H.id,H.data,!1);const E=this._executeOnNextFrame.findIndex((E=>E.uniqueId===H.uniqueId));-1!==E&&this._executeOnNextFrame.splice(E,1)}}));(e.SceneCoordinators.get(this.config.QH)??[]).push(this)}createGraph(){const E=new D({QH:this.config.QH,coordinator:this});return this._flowGraphs.push(E),E}removeGraph(E){const H=this._flowGraphs.indexOf(E);-1!==H&&(E.dispose(),this._flowGraphs.splice(H,1))}start(){for(const E of this._flowGraphs)E.start()}dispose(){var E,H;for(const Z of this._flowGraphs)Z.dispose();this._flowGraphs.length=0,null===(E=this._disposeObserver)||void 0===E||E.remove(),null===(H=this._onBeforeRenderObserver)||void 0===H||H.remove();const d=e.SceneCoordinators.get(this.config.QH)??[],n=d.indexOf(this);-1!==n&&d.splice(n,1)}serialize(E,H){E._flowGraphs=[];for(const d of this._flowGraphs){const n={};d.serialize(n,H),E._flowGraphs.push(n)}E.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(E){let H=this._customEventsMap.get(E);return H||(H=new Z.e,this._customEventsMap.set(E,H)),H}notifyCustomEvent(E,H){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:E,data:H,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(E)){const H=this._eventExecutionCounter.get(E);if(this._eventExecutionCounter.set(E,H+1),H>=e.MaxEventTypeExecutionPerFrame)return void(H===e.MaxEventTypeExecutionPerFrame&&S.b.Warn(`FlowGraphCoordinator: Too many executions of event "${E}".`))}else this._eventExecutionCounter.set(E,1);const d=this._customEventsMap.get(E);d&&d.notifyObservers(H)}}e.MaxEventsPerType=30,e.MaxEventTypeExecutionPerFrame=30,e.SceneCoordinators=new Map},14134:(E,H,d)=>{"use strict";d.d(H,{d:()=>Z});var n=d(14137);class Z extends n.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(E){E._notifyExecuteNode(this),this.done._activateSignal(E)}}},14123:(E,H,d)=>{"use strict";d.d(H,{e:()=>l});var n=d(14125),Z=d(14127),I=d(12344);class g extends Z.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(E){super.connectTo(E),this._connectedPoint.sort(((E,H)=>H.priority-E.priority))}_activateSignal(E){var H;if(null===(H=E.logger)||void 0===H||H.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Wd:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)E._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(E,this),E._increaseExecutionId();else for(const d of this._connectedPoint)d._activateSignal(E)}}(0,I.e)("FlowGraphSignalConnection",g);class l extends n.c{constructor(E){super(E),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(E){const H=new g(E,0,this);return this.signalInputs.push(H),H}_registerSignalOutput(E){const H=new g(E,1,this);return this.signalOutputs.push(H),H}_unregisterSignalInput(E){const H=this.signalInputs.findIndex((H=>H.name===E));-1!==H&&(this.signalInputs[H].dispose(),this.signalInputs.splice(H,1))}_unregisterSignalOutput(E){const H=this.signalOutputs.findIndex((H=>H.name===E));-1!==H&&(this.signalOutputs[H].dispose(),this.signalOutputs.splice(H,1))}_reportError(E,H){this.error.Wd="string"===typeof H?new Error(H):H,this.error._activateSignal(E)}getSignalInput(E){return this.signalInputs.find((H=>H.name===E))}getSignalOutput(E){return this.signalOutputs.find((H=>H.name===E))}serialize(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(E),E.signalInputs=[],E.signalOutputs=[];for(const H of this.signalInputs){const d={};H.serialize(d),E.signalInputs.push(d)}for(const H of this.signalOutputs){const d={};H.serialize(d),E.signalOutputs.push(d)}}deserialize(E){for(let H=0;H<E.signalInputs.length;H++){const d=this.getSignalInput(E.signalInputs[H].name);if(!d)throw new Error("Could not find signal input with name "+E.signalInputs[H].name+" in block "+E.className);d.deserialize(E.signalInputs[H])}for(let H=0;H<E.signalOutputs.length;H++){const d=this.getSignalOutput(E.signalOutputs[H].name);if(!d)throw new Error("Could not find signal output with name "+E.signalOutputs[H].name+" in block "+E.className);d.deserialize(E.signalOutputs[H])}}getClassName(){return"FlowGraphExecutionBlock"}}},14140:(E,H,d)=>{"use strict";d.d(H,{d:()=>Z});var n=d(14123);class Z extends n.e{constructor(E){super(E),this.out=this._registerSignalOutput("out")}}},14103:(E,H,d)=>{"use strict";d.d(H,{B:()=>C,E:()=>w,G:()=>R,H:()=>j,L:()=>X,M:()=>P,P:()=>f,e:()=>t,h:()=>V,j:()=>p,m:()=>Q,o:()=>L,p:()=>D,r:()=>M,v:()=>i,y:()=>S});var n,Z=d(12384),I=d(12437),g=d(14095),l=d(14107);!function(E){E.Any="any",E.String="string",E.Number="number",E.Boolean="boolean",E.Object="object",E.Integer="FlowGraphInteger",E.Vector2="Vector2",E.wH="wH",E.Vector4="Vector4",E.Quaternion="Quaternion",E.Matrix="Matrix",E.Matrix2D="Matrix2D",E.Matrix3D="Matrix3D",E.DH="DH",E.gg="gg"}(n||(n={}));class r{constructor(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=E,this.defaultValue=H,this.animationType=d}serialize(E){E.typeName=this.typeName,E.defaultValue=this.defaultValue}}const t=new r("any",void 0),S=new r("string",""),M=new r("number",0,0),V=new r("boolean",!1),C=new r("Vector2",Z.Vector2.Zero(),5),w=new r("wH",Z.wH.Zero(),1),R=new r("Vector4",Z.Vector4.Zero()),Q=new r("Matrix",Z.Matrix.Identity(),3),L=new r("Matrix2D",new l.c),D=new r("Matrix3D",new l.d),e=new r("DH",I.DH.Black(),4),s=new r("gg",new I.gg(0,0,0,0),7),i=new r("Quaternion",Z.Quaternion.Identity(),2);i.typeTransformer=E=>{if(E.getClassName){if("Vector4"===E.getClassName())return Z.Quaternion.eH(E.kd());if("wH"===E.getClassName())return Z.Quaternion.FromEulerVector(E);if("Matrix"===E.getClassName())return Z.Quaternion.FromRotationMatrix(E)}return E};const p=new r("FlowGraphInteger",new g.c(0),0);function f(E){const H=E;switch(typeof E){case"string":return S;case"number":return M;case"boolean":return V;case"object":if(H.getClassName)switch(H.getClassName()){case"Vector2":return C;case"wH":return w;case"Vector4":return R;case"Matrix":return Q;case"DH":return e;case"gg":return s;case"Quaternion":return i;case"FlowGraphInteger":return p;case"Matrix2D":return L;case"Matrix3D":return D}return t;default:return t}}function P(E){switch(E){case"string":return S;case"number":return M;case"boolean":return V;case"Vector2":return C;case"wH":return w;case"Vector4":return R;case"Matrix":return Q;case"DH":return e;case"gg":return s;case"Quaternion":return i;case"FlowGraphInteger":return p;case"Matrix2D":return L;case"Matrix3D":return D;default:return t}}function j(E){switch(E){case"number":default:return 0;case"Vector2":return 5;case"wH":return 1;case"Matrix":return 3;case"DH":return 4;case"gg":return 7;case"Quaternion":return 2}}function X(E){switch(E){case 0:return M;case 5:return C;case 1:return w;case 3:return Q;case 4:return e;case 7:return s;case 2:return i;default:return t}}},14089:(E,H,d)=>{"use strict";d.d(H,{e:()=>S,h:()=>t,l:()=>M});var n=d(12437),Z=d(12384),I=d(14095),g=d(14103),l=d(14107);function r(E){return"Vector2"===E||"wH"===E||"Vector4"===E||"Quaternion"===E||"DH"===E||"gg"===E}function t(E,H,d){var n;const Z=(null===H||void 0===H||null===(n=H.getClassName)||void 0===n?void 0:n.call(H))??"";if(r(Z)||function(E){return"Matrix"===E||"Matrix2D"===E||"Matrix3D"===E}(Z))d[E]={value:H.kd(),className:Z};else if("FlowGraphInteger"===Z)d[E]={value:H.value,className:Z};else if(Z&&(H.id||H.name))d[E]={id:H.id,name:H.name,className:Z};else{if("object"===typeof H)throw new Error(`Could not serialize value ${H}`);d[E]=H}}function S(E,H,d,t){const M=H[E];let V;const C=(null===M||void 0===M?void 0:M.type)??(null===M||void 0===M?void 0:M.className);if(function(E){return"Mesh"===E||"AbstractMesh"===E||"GroundMesh"===E||"InstanceMesh"===E||"LinesMesh"===E||"GoldbergMesh"===E||"GreasedLineMesh"===E||"TrailMesh"===E}(C)){let E=t.meshes.filter((E=>M.id?E.id===M.id:E.name===M.name));0===E.length&&(E=t.transformNodes.filter((E=>M.id?E.id===M.id:E.name===M.name))),V=M.uniqueId?E.find((E=>E.uniqueId===M.uniqueId)):E[0]}else if(r(C))V=function(E,H){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===E)return Z.Vector2.eH(H);if("wH"===E)return d&&(H[2]*=-1),Z.wH.eH(H);if("Vector4"===E)return Z.Vector4.eH(H);if("Quaternion"===E)return d&&(H[2]*=-1,H[3]*=-1),Z.Quaternion.eH(H);if("DH"===E)return new n.DH(H[0],H[1],H[2]);if("gg"===E)return new n.gg(H[0],H[1],H[2],H[3]);throw new Error(`Unknown vector class name ${E}`)}(C,M.value);else if(function(E){return"AnimationGroup"===E}(C)){const E=t.animationGroups.filter((E=>E.name===M.name));V=1===E.length?E[0]:E.find((E=>E.uniqueId===M.uniqueId))}else V="Matrix"===C?Z.Matrix.eH(M.value):"Matrix2D"===C?new l.c(M.value):"Matrix3D"===C?new l.d(M.value):"FlowGraphInteger"===C?I.c.FromValue(M.value):"number"===C||"string"===C||"boolean"===C?M.value[0]:M&&void 0!==M.value?M.value:Array.isArray(M)?M.reduce(((E,H)=>H.eventData?(E[H.id]={type:(0,g.M)(H.type)},"undefined"!==typeof H.value&&(E[H.id].value=S("value",H,d,t)),E):E),{}):M;return V}function M(E){return"FlowGraphJsonPointerParserBlock"===E}},14132:(E,H,d)=>{"use strict";function n(E,H){return!(!E.parent||E.parent!==H&&!n(E.parent,H))}function Z(E){if(E.getClassName)return E.getClassName()}function I(E,H){return E===H&&("Vector2"===E||"wH"===E||"Vector4"===E||"Quaternion"===E)}function g(E,H){return E===H&&("Matrix"===E||"Matrix2D"===E||"Matrix3D"===E)}function l(E,H){return"FlowGraphInteger"===E&&"FlowGraphInteger"===H}function r(E,H){const d="number"===typeof E||"number"===typeof(null===E||void 0===E?void 0:E.value);return d&&!H?!isNaN(t(E)):d}function t(E){return"number"===typeof E?E:E.value}d.d(H,{c:()=>l,e:()=>g,f:()=>I,g:()=>Z,i:()=>n,k:()=>t,m:()=>r})},13489:(E,H,d)=>{"use strict";d.r(H),d.d(H,{SceneInstrumentation:()=>I});var n=d(12228),Z=d(12612);class I{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(E){E!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=E,E?(this._onBeforeActiveMeshesEvaluationObserver=this.QH.onBeforeActiveMeshesEvaluationObservable.add((()=>{n.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.QH.onAfterActiveMeshesEvaluationObservable.add((()=>{n.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.QH.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.QH.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(E){E!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=E,E?(this._onBeforeRenderTargetsRenderObserver=this.QH.onBeforeRenderTargetsRenderObservable.add((()=>{n.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.QH.onAfterRenderTargetsRenderObservable.add((()=>{n.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.QH.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.QH.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(E){E!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=E,E?(this._onBeforeParticlesRenderingObserver=this.QH.onBeforeParticlesRenderingObservable.add((()=>{n.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.QH.onAfterParticlesRenderingObservable.add((()=>{n.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.QH.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.QH.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(E){E!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=E,this.QH.spriteManagers&&(E?(this._onBeforeSpritesRenderingObserver=this.QH.onBeforeSpritesRenderingObservable.add((()=>{n.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.QH.onAfterSpritesRenderingObservable.add((()=>{n.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.QH.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.QH.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(E){E!==this._capturePhysicsTime&&this.QH.onBeforePhysicsObservable&&(this._capturePhysicsTime=E,E?(this._onBeforePhysicsObserver=this.QH.onBeforePhysicsObservable.add((()=>{n.Tools.StartPerformanceCounter("qg"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.QH.onAfterPhysicsObservable.add((()=>{n.Tools.EndPerformanceCounter("qg"),this._physicsTime.endMonitoring()}))):(this.QH.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.QH.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(E){E!==this._captureAnimationsTime&&(this._captureAnimationsTime=E,E?this._onAfterAnimationsObserver=this.QH.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.QH.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(E){this._captureFrameTime=E}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(E){this._captureInterFrameTime=E}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(E){E!==this._captureRenderTime&&(this._captureRenderTime=E,E?(this._onBeforeDrawPhaseObserver=this.QH.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),n.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.QH.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),n.Tools.EndPerformanceCounter("Main render")}))):(this.QH.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.QH.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(E){E!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=E,E?(this._onBeforeCameraRenderObserver=this.QH.onBeforeCameraRenderObservable.add((E=>{this._cameraRenderTime.beginMonitoring(),n.Tools.StartPerformanceCounter(`Rendering camera ${E.name}`)})),this._onAfterCameraRenderObserver=this.QH.onAfterCameraRenderObservable.add((E=>{this._cameraRenderTime.endMonitoring(!1),n.Tools.EndPerformanceCounter(`Rendering camera ${E.name}`)}))):(this.QH.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.QH.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.QH.getEngine()._drawCalls}constructor(E){this.QH=E,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new Z.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new Z.e,this._captureFrameTime=!1,this._frameTime=new Z.e,this._captureRenderTime=!1,this._renderTime=new Z.e,this._captureInterFrameTime=!1,this._interFrameTime=new Z.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new Z.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new Z.e,this._capturePhysicsTime=!1,this._physicsTime=new Z.e,this._captureAnimationsTime=!1,this._animationsTime=new Z.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new Z.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=E.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(n.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.QH.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=E.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(n.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Cd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Cd(),this._captureParticlesRenderTime&&this._particlesRenderTime.Cd(),this._captureSpritesRenderTime&&this._spritesRenderTime.Cd(),this._captureRenderTime&&this._renderTime.Cd(),this._captureCameraRenderTime&&this._cameraRenderTime.Cd()}))}dispose(){this._disposed||(this.QH.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.QH.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.QH.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.QH.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.QH.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.QH.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.QH.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.QH.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.QH.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.QH.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.QH.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.QH.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.QH.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.QH.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.QH.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.QH.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.QH.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.QH=null,this._disposed=!0)}}},14075:(E,H,d)=>{"use strict";d.d(H,{d:()=>S});var n=d(12369),Z=d(12372),I=d(12384),g=d(12815),l=d(12919),r=d(12976),t=d(12344);g.c.AddNodeConstructor("Light_Type_1",((E,H)=>()=>new S(E,I.wH.Zero(),H)));class S extends r.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(E){this._shadowFrustumSize=E,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(E){this._shadowOrthoScale=E,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(E){this._orthoLeft=E}get orthoRight(){return this._orthoRight}set orthoRight(E){this._orthoRight=E}get orthoTop(){return this._orthoTop}set orthoTop(E){this._orthoTop=E}get orthoBottom(){return this._orthoBottom}set orthoBottom(E){this._orthoBottom=E}constructor(E,H,d){super(E,d),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=H.scale(-1),this.direction=H}getClassName(){return"Ng"}getTypeID(){return l.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(E,H,d){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(E):this._setDefaultAutoExtendShadowProjectionMatrix(E,H,d)}_setDefaultFixedFrustumShadowProjectionMatrix(E){const H=this.fE().activeCamera;H&&I.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:H.Gd,void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ,E,this.fE().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(E,H,d){const n=this.fE().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const E=I.wH.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let n=Number.MAX_VALUE,Z=-Number.MAX_VALUE;for(let g=0;g<d.length;g++){const l=d[g];if(!l)continue;const r=l.getBoundingInfo().boundingBox;for(let d=0;d<r.vectorsWorld.length;d++)I.wH.TransformCoordinatesToRef(r.vectorsWorld[d],H,E),E.x<this._orthoLeft&&(this._orthoLeft=E.x),E.y<this._orthoBottom&&(this._orthoBottom=E.y),E.x>this._orthoRight&&(this._orthoRight=E.x),E.y>this._orthoTop&&(this._orthoTop=E.y),this.autoCalcShadowZBounds&&(E.z<n&&(n=E.z),E.z>Z&&(Z=E.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=n,this._shadowMaxZ=Z)}const Z=this._orthoRight-this._orthoLeft,g=this._orthoTop-this._orthoBottom,l=void 0!==this.shadowMinZ?this.shadowMinZ:(null===n||void 0===n?void 0:n.Gd)||0,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===n||void 0===n?void 0:n.maxZ)||1e4,t=this.fE().getEngine().o;I.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-Z*this.shadowOrthoScale,this._orthoRight+Z*this.shadowOrthoScale,this._orthoBottom-g*this.shadowOrthoScale,this._orthoTop+g*this.shadowOrthoScale,t?r:l,t?l:r,E,this.fE().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(E,H){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,H),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,H),this)}transferToNodeMaterialEffect(E,H){return this.computeTransformedInformation()?(E.setFloat3(H,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(E.setFloat3(H,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(E){const H=this._scene.getEngine();return!H.o&&H.isNDCHalfZRange?0:1}getDepthMaxZ(E){const H=this._scene.getEngine();return H.o&&H.isNDCHalfZRange?0:1}prepareLightSpecificDefines(E,H){E["DIRLIGHT"+H]=!0}}(0,n.e)([(0,Z.K)()],S.prototype,"shadowFrustumSize",null),(0,n.e)([(0,Z.K)()],S.prototype,"shadowOrthoScale",null),(0,n.e)([(0,Z.K)()],S.prototype,"autoUpdateExtends",void 0),(0,n.e)([(0,Z.K)()],S.prototype,"autoCalcShadowZBounds",void 0),(0,n.e)([(0,Z.K)("orthoLeft")],S.prototype,"_orthoLeft",void 0),(0,n.e)([(0,Z.K)("orthoRight")],S.prototype,"_orthoRight",void 0),(0,n.e)([(0,Z.K)("orthoTop")],S.prototype,"_orthoTop",void 0),(0,n.e)([(0,Z.K)("orthoBottom")],S.prototype,"_orthoBottom",void 0),(0,t.e)("BABYLON.DirectionalLight",S)},14551:(E,H,d)=>{"use strict";d.d(H,{d:()=>S});var n=d(12369),Z=d(12372),I=d(12384),g=d(12437),l=d(12815),r=d(12919),t=d(12344);l.c.AddNodeConstructor("Light_Type_3",((E,H)=>()=>new S(E,I.wH.Zero(),H)));class S extends r.e{constructor(E,H,d){super(E,d),this.groundColor=new g.DH(0,0,0),this.direction=H||I.wH.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Tg"}setDirectionToTarget(E){return this.direction=I.wH.Normalize(E.RH(I.wH.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(E,H){const d=I.wH.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",d.x,d.y,d.z,0,H),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Lg),H),this}transferToNodeMaterialEffect(E,H){const d=I.wH.Normalize(this.direction);return E.setFloat3(H,d.x,d.y,d.z),this}yd(){return this._worldMatrix||(this._worldMatrix=I.Matrix.Identity()),this._worldMatrix}getTypeID(){return r.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(E,H){E["HEMILIGHT"+H]=!0}}(0,n.e)([(0,Z.g)()],S.prototype,"groundColor",void 0),(0,n.e)([(0,Z.I)()],S.prototype,"direction",void 0),(0,t.e)("BABYLON.HemisphericLight",S)},14049:(E,H,d)=>{"use strict";d.d(H,{e:()=>M});var n=d(12369),Z=d(12372),I=d(12384),g=d(12815),l=d(12919),r=d(12976),t=d(12366),S=d(12344);g.c.AddNodeConstructor("Light_Type_2",((E,H)=>()=>new M(E,I.wH.Zero(),I.wH.Zero(),0,0,H)));class M extends r.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(E){this._iesProfileTexture!==E&&(this._iesProfileTexture=E,this._iesProfileTexture&&M._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(E){this._angle=E,this._cosHalfAngle=Math.cos(.5*E),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(E){this._innerAngle=E,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(E){this._shadowAngleScale=E,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(E){this._projectionTextureLightNear=E,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(E){this._projectionTextureLightFar=E,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(E){this._projectionTextureUpDirection=E,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(E){this._projectionTexture!==E&&(this._projectionTexture=E,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(M._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):M._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(E){return void 0!==E.onGeneratedObservable}static _IsTexture(E){return void 0!==E.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(E){this._projectionTextureProjectionLightMatrix=E,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(E,H,d,n,Z,g){super(E,g),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=I.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=I.wH.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=I.wH.Zero(),this._projectionTextureViewLightMatrix=I.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=I.Matrix.Zero(),this._projectionTextureScalingMatrix=I.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=H,this.direction=d,this.angle=n,this.exponent=Z}getClassName(){return"SpotLight"}getTypeID(){return l.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(E){super._setDirection(E),this._projectionTextureViewLightDirty=!0}_setPosition(E){super._setPosition(E),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(E,H,d){const n=this.fE().activeCamera;if(!n)return;this._shadowAngleScale=this._shadowAngleScale||1;const Z=this._shadowAngleScale*this._angle,g=void 0!==this.shadowMinZ?this.shadowMinZ:n.Gd,l=void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,r=this.fE().getEngine().o;I.Matrix.PerspectiveFovLHToRef(Z,1,r?l:g,r?g:l,E,!0,this._scene.getEngine().isNDCHalfZRange,void 0,r)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),I.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const E=this.projectionTextureLightFar,H=this.projectionTextureLightNear,d=E/(E-H),n=-d*H,Z=1/Math.tan(this._angle/2);I.Matrix.FromValuesToRef(Z/1,0,0,0,0,Z,0,0,0,0,d,1,0,0,n,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof t.c){const E=this._projectionTexture.uScale/2,H=this._projectionTexture.vScale/2;I.Matrix.FromValuesToRef(E,0,0,0,0,H,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(E,H){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),E.setMatrix("textureProjectionMatrix"+H,this._projectionTextureMatrix),E.setTexture("projectionLightTexture"+H,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&E.setTexture("iesLightTexture"+H,this._iesProfileTexture),this}transferToEffect(E,H){let d;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,H),d=I.wH.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,H),d=I.wH.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",d.x,d.y,d.z,this._cosHalfAngle,H),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,H),this}transferToNodeMaterialEffect(E,H){let d;return d=this.computeTransformedInformation()?I.wH.Normalize(this.transformedDirection):I.wH.Normalize(this.direction),this.fE().useRightHandedSystem?E.setFloat3(H,-d.x,-d.y,-d.z):E.setFloat3(H,d.x,d.y,d.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(E){const H=this._scene.getEngine(),d=void 0!==this.shadowMinZ?this.shadowMinZ:(null===E||void 0===E?void 0:E.Gd)??0;return H.o&&H.isNDCHalfZRange?d:this._scene.getEngine().isNDCHalfZRange?0:d}getDepthMaxZ(E){const H=this._scene.getEngine(),d=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===E||void 0===E?void 0:E.maxZ)??1e4;return H.o&&H.isNDCHalfZRange?0:d}prepareLightSpecificDefines(E,H){E["SPOTLIGHT"+H]=!0,E["PROJECTEDLIGHTTEXTURE"+H]=!(!this.projectionTexture||!this.projectionTexture.isReady()),E["IESLIGHTTEXTURE"+H]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,n.e)([(0,Z.K)()],M.prototype,"angle",null),(0,n.e)([(0,Z.K)()],M.prototype,"innerAngle",null),(0,n.e)([(0,Z.K)()],M.prototype,"shadowAngleScale",null),(0,n.e)([(0,Z.K)()],M.prototype,"exponent",void 0),(0,n.e)([(0,Z.K)()],M.prototype,"projectionTextureLightNear",null),(0,n.e)([(0,Z.K)()],M.prototype,"projectionTextureLightFar",null),(0,n.e)([(0,Z.K)()],M.prototype,"projectionTextureUpDirection",null),(0,n.e)([(0,Z.A)("projectedLightTexture")],M.prototype,"_projectionTexture",void 0),(0,S.e)("BABYLON.SpotLight",M)},13782:(E,H,d)=>{"use strict";d.d(H,{e:()=>g,f:()=>I,j:()=>l});const n={},Z={};function I(E,H){n[E]=H}function g(E,H){Z[E]=H}function l(E){return Z[E]?Z[E]:null}},13681:(E,H,d)=>{"use strict";d.d(H,{d:()=>f,h:()=>a});var n,Z=d(12228),I=d(12230),g=d(12634),l=d(12268),r=d(12237),t=d(12851),S=d(12271),M=d(12275),V=d(12350),C=d(12296),w=d(12260);!function(E){E[E.Clean=0]="Clean",E[E.Stop=1]="Stop",E[E.Sync=2]="Sync",E[E.NoSync=3]="NoSync"}(n||(n={}));const R=new I.e,Q={};let L=!1;function D(){return Q[".babylon"]}function e(E,H){const d=Q[E];return d||(r.b.Warn("Unable to find a plugin to load "+E+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),H?D():void 0)}function s(E,H,d){let n="Unable to load from "+(E.rawData?"binary data":E.url);return H?n+=`: ${H}`:d&&(n+=`: ${d}`),n}async function i(E,H,d,n,Z,I,g,l,r){var t;const M="data:"===(V=E.url).substring(0,5)?V.substring(5):null;var V;if(E.rawData&&!g)throw"When using ArrayBufferView to load data the file extension must be provided.";const L=M||g?"":function(E){const H=E.indexOf("?");-1!==H&&(E=E.substring(0,H));const d=E.lastIndexOf(".");return E.substring(d,E.length).toLowerCase()}(E.url);let s=g?e(g,!0):M?function(E){for(const H in Q){const d=Q[H].plugin;if(d.canDirectLoad&&d.canDirectLoad(E))return Q[H]}return D()}(E.url):e(L,!1);if(!s&&L){if(E.url&&!E.url.startsWith("blob:")){const H=await async function(E,H){const d=H.method||"GET";return await new Promise(((n,Z)=>{const I=new w.b;I.addEventListener("readystatechange",(()=>{if(4==I.readyState)if(200==I.status){const E={};if(H.responseHeaders)for(const d of H.responseHeaders)E[d]=I.getResponseHeader(d)||"";n({response:I.response,headerValues:E})}else Z(`Unable to fetch data from ${E}. Error code: ${I.status}`)})),I.open(d,E),I.send()}))}(E.url,{method:"HEAD",responseHeaders:["Content-Type"]}),d=H.headerValues?H.headerValues["Content-Type"]:"";d&&(s=function(E){for(const H in Q){const d=Q[H];if(d.mimeType===E)return d}}(d))}s||(s=D())}if(!s)throw new Error(`No plugin or fallback for ${g??E.url}`);if(!1===(null===r||void 0===r||null===(t=r[s.plugin.name])||void 0===t?void 0:t.enabled))throw new Error(`The '${s.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(E.rawData&&!s.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(E=>{if(s.plugin.createPlugin){const H=s.plugin.createPlugin(r??{});return H instanceof Promise?(H.then(E).catch((E=>{Z("Error instantiating plugin.",E)})),null):(E(H),H)}return E(s.plugin),s.plugin})((r=>{var t;if(!r)throw`The loader plugin corresponding to the '${g}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(R.notifyObservers(r),M&&(r.canDirectLoad&&r.canDirectLoad(E.url)||!(0,S.i)(E.url))){if(r.directLoad){const E=r.directLoad(H,M);E instanceof Promise?E.then((E=>{d(r,E)})).catch((E=>{Z("Error in directLoad of _loadData: "+E,E)})):d(r,E)}else d(r,M);return}const V=s.isBinary,w=(E,n)=>{H.M?Z("Scene has been disposed"):d(r,E,n)};let Q=null,L=!1;null===(t=r.Qd)||void 0===t||t.add((()=>{L=!0,Q&&(Q.abort(),Q=null),I()}));const D=()=>{if(L)return;const d=(E,H)=>{Z(null===E||void 0===E?void 0:E.statusText,H)};if(!r.loadFile&&E.rawData)throw"Plugin does not support loading ArrayBufferView.";Q=r.loadFile?r.loadFile(H,E.rawData||E.file||E.url,E.rootUrl,w,n,V,d,l):H._loadFile(E.file||E.url,w,n,!0,V,d)},e=H.getEngine();let i=e.enableOfflineSupport;if(i){let d=!1;for(const n of H.disableOfflineSupportExceptionRules)if(n.test(E.url)){d=!0;break}i=!d}i&&C.c.OfflineProviderFactory?H.offlineProvider=C.c.OfflineProviderFactory(E.url,D,e.disableManifestCheck):D()}))}function p(E,H){let d,n,I=null,g=null;if(H)if(H.name)d=`file:${H.name}`,n=H.name,I=H;else if(ArrayBuffer.isView(H))d="",n=(0,V.e)(),g=H;else if(H.startsWith("data:"))d=H,n="";else if(E){const I=H;if("/"===I.substring(0,1))return Z.Tools.Error("Wrong sceneFilename parameter"),null;d=E+I,n=I}else d=H,n=Z.Tools.GetFilename(H),E=Z.Tools.GetFolderPath(H);else d=E,n=Z.Tools.GetFilename(E),E=Z.Tools.GetFolderPath(E);return{url:d,rootUrl:E,name:n,file:I,rawData:g}}function f(E){if("string"===typeof E.extensions){const H=E.extensions;Q[H.toLowerCase()]={plugin:E,isBinary:!1}}else{const H=E.extensions,d=Object.keys(H);for(const n of d)Q[n.toLowerCase()]={plugin:E,isBinary:H[n].isBinary,mimeType:H[n].mimeType}}}async function P(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.b.LastCreatedScene,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!n)return r.b.Error("No scene available to import mesh to"),null;const C=p(H,d);if(!C)return null;const w={};n.addPendingData(w);const R=()=>{n.removePendingData(w)},Q=(E,H)=>{const d=s(C,E,H);g?g(n,d,new M.f(d,M.d.SceneLoaderError,H)):r.b.Error(d),R()},L=I?E=>{try{I(E)}catch(H){Q("Error in onProgress callback: "+H,H)}}:void 0,D=(E,H,d,I,g,l,r,t)=>{if(n.importedMeshesFiles.push(C.url),Z)try{Z(E,H,d,I,g,l,r,t)}catch(S){Q("Error in onSuccess callback: "+S,S)}n.removePendingData(w)};return await i(C,n,((H,d,Z)=>{if(H.rewriteRootURL&&(C.rootUrl=H.rewriteRootURL(C.rootUrl,Z)),H.importMesh){const Z=[],I=[],g=[];if(!H.importMesh(E,n,d,C.rootUrl,Z,I,g,Q))return;n.loadingPluginName=H.name,D(Z,I,g,[],[],[],[],[])}else{H.importMeshAsync(E,n,d,C.rootUrl,L,C.name).then((E=>{n.loadingPluginName=H.name,D(E.meshes,E.lV,E.skeletons,E.animationGroups,E.transformNodes,E.geometries,E.lights,E.spriteManagers)})).catch((E=>{Q(E.message,E)}))}}),L,Q,R,t,S,V)}async function j(E,H,d,n,Z,I,g,l){return await new Promise(((r,t)=>{try{P(E,H,d,n,((E,H,d,n,Z,I,g,l)=>{r({meshes:E,lV:H,skeletons:d,animationGroups:n,transformNodes:Z,geometries:I,lights:g,spriteManagers:l})}),Z,((E,H,d)=>{t(d||new Error(H))}),I,g,l).catch(t)}catch(M){t(M)}}))}async function X(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.LastCreatedEngine,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};d?await U(E,H,new g.c(d),n,I,r,t,S,M):Z.Tools.Error("No engine available")}async function W(E,H,d,n,Z,I,g){return await new Promise(((l,r)=>{X(E,H,d,(E=>{l(E)}),n,((E,H,d)=>{r(d||new Error(H))}),Z,I,g)}))}async function U(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.LastCreatedScene,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!d)return r.b.Error("No scene available to append to"),null;const C=p(E,H);if(!C)return null;const w={};d.addPendingData(w);const R=()=>{d.removePendingData(w)};t.e.ShowLoadingScreen&&!L&&(L=!0,d.getEngine().displayLoadingUI(),d.executeWhenReady((()=>{d.getEngine().hideLoadingUI(),L=!1})));const Q=(E,H)=>{const n=s(C,E,H);I?I(d,n,new M.f(n,M.d.SceneLoaderError,H)):r.b.Error(n),R()},D=Z?E=>{try{Z(E)}catch(H){Q("Error in onProgress callback",H)}}:void 0,e=()=>{if(n)try{n(d)}catch(E){Q("Error in onSuccess callback",E)}d.removePendingData(w)};return await i(C,d,((E,H)=>{if(E.load){if(!E.load(d,H,C.rootUrl,Q))return;d.loadingPluginName=E.name,e()}else{E.loadAsync(d,H,C.rootUrl,D,C.name).then((()=>{d.loadingPluginName=E.name,e()})).catch((E=>{Q(E.message,E)}))}}),D,Q,R,g,S,V)}async function Y(E,H,d,n,Z,I,g){return await new Promise(((l,r)=>{try{U(E,H,d,(E=>{l(E)}),n,((E,H,d)=>{r(d||new Error(H))}),Z,I,g).catch(r)}catch(M){r(M)}}))}async function c(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.LastCreatedScene,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!d)return r.b.Error("No scene available to load asset container to"),null;const V=p(E,H);if(!V)return null;const C={};d.addPendingData(C);const w=()=>{d.removePendingData(C)},R=(E,H)=>{const n=s(V,E,H);I?I(d,n,new M.f(n,M.d.SceneLoaderError,H)):r.b.Error(n),w()},Q=Z?E=>{try{Z(E)}catch(H){R("Error in onProgress callback",H)}}:void 0,L=E=>{if(n)try{n(E)}catch(H){R("Error in onSuccess callback",H)}d.removePendingData(C)};return await i(V,d,((E,H)=>{if(E.loadAssetContainer){const n=E.loadAssetContainer(d,H,V.rootUrl,R);if(!n)return;n.populateRootNodes(),d.loadingPluginName=E.name,L(n)}else if(E.loadAssetContainerAsync){E.loadAssetContainerAsync(d,H,V.rootUrl,Q,V.name).then((H=>{H.populateRootNodes(),d.loadingPluginName=E.name,L(H)})).catch((E=>{R(E.message,E)}))}else R("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),Q,R,w,g,t,S)}async function u(E,H,d,n,Z,I,g){return await new Promise(((l,r)=>{try{c(E,H,d,(E=>{l(E)}),n,((E,H,d)=>{r(d||new Error(H))}),Z,I,g).catch(r)}catch(M){r(M)}}))}async function o(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.b.LastCreatedScene,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,V=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!d)return void r.b.Error("No scene available to load animations to");if(n){for(const n of d.animatables)n.reset();d.stopAllAnimations();const E=d.animationGroups.slice();for(const d of E)d.dispose();const H=d.getNodes();for(const d of H)d.animations&&(d.animations=[])}else switch(Z){case 0:const E=d.animationGroups.slice();for(const H of E)H.dispose();break;case 1:for(const H of d.animationGroups)H.stop();break;case 2:for(const H of d.animationGroups)H.reset(),H.restart();break;case 3:break;default:return void r.b.Error("Unknown animation group loading mode value '"+Z+"'")}const w=d.animatables.length;await c(E,H,d,(E=>{E.mergeAnimationsTo(d,d.animatables.slice(w),I),E.dispose(),d.onAnimationFileImportedObservable.notifyObservers(d),g&&g(d)}),t,S,M,V,C)}async function F(E,H,d,n,Z,I,g,l,r,t){return await new Promise(((S,V)=>{try{o(E,H,d,n,Z,I,(E=>{S(E)}),g,((E,H,d)=>{V(d||new Error(H))}),l,r,t).catch(V)}catch(M){V(M)}}))}class a{static get ForceFullSceneLoadingForIncremental(){return t.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(E){t.e.ForceFullSceneLoadingForIncremental=E}static get ShowLoadingScreen(){return t.e.ShowLoadingScreen}static set ShowLoadingScreen(E){t.e.ShowLoadingScreen=E}static get loggingLevel(){return t.e.loggingLevel}static set loggingLevel(E){t.e.loggingLevel=E}static get CleanBoneMatrixWeights(){return t.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(E){t.e.CleanBoneMatrixWeights=E}static GetDefaultPlugin(){return D()}static GetPluginForExtension(E){var H;return null===(H=e(E,!0))||void 0===H?void 0:H.plugin}static IsPluginForExtensionAvailable(E){return function(E){return!!Q[E]}(E)}static RegisterPlugin(E){f(E)}static ImportMesh(E,H,d,n,Z,I,g,r,t){P(E,H,d,n,Z,I,g,r,t).catch((E=>null===g||void 0===g?void 0:g(l.b.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async ImportMeshAsync(E,H,d,n,Z,I,g){return await j(E,H,d,n,Z,I,g)}static Load(E,H,d,n,Z,I,g,r){X(E,H,d,n,Z,I,g,r).catch((E=>null===I||void 0===I?void 0:I(l.b.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async LoadAsync(E,H,d,n,Z,I){return await W(E,H,d,n,Z,I)}static Append(E,H,d,n,Z,I,g,r){U(E,H,d,n,Z,I,g,r).catch((E=>null===I||void 0===I?void 0:I(d??l.b.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async AppendAsync(E,H,d,n,Z,I){return await Y(E,H,d,n,Z,I)}static LoadAssetContainer(E,H,d,n,Z,I,g,r){c(E,H,d,n,Z,I,g,r).catch((E=>null===I||void 0===I?void 0:I(d??l.b.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async LoadAssetContainerAsync(E,H,d,n,Z,I){return await u(E,H,d,n,Z,I)}static ImportAnimations(E,H,d,n,Z,I,g,r,t,S,M){o(E,H,d,n,Z,I,g,r,t,S,M).catch((E=>null===t||void 0===t?void 0:t(d??l.b.LastCreatedScene,null===E||void 0===E?void 0:E.message,E)))}static async ImportAnimationsAsync(E,H,d,n,Z,I,g,l,r,t,S){return await F(E,H,d,n,Z,I,l,t,S)}}a.NO_LOGGING=0,a.MINIMAL_LOGGING=1,a.SUMMARY_LOGGING=2,a.DETAILED_LOGGING=3,a.OnPluginActivatedObservable=R},14060:(E,H,d)=>{"use strict";d.d(H,{e:()=>V});var n=d(12369),Z=d(12372),I=d(12228),g=d(12384),l=d(12414),r=d(12366),t=d(12344),S=d(12230),M=d(12428);d(14066);class V extends l.b{set boundingBoxSize(E){if(this._boundingBoxSize&&this._boundingBoxSize.equals(E))return;this._boundingBoxSize=E;const H=this.fE();H&&H.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(E){this._rotationY=E,this.setReflectionTextureMatrix(g.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(E,H,d){let n="";for(const Z of E)n+=Z;return new V(n,H,null,d,E)}static CreateFromPrefilteredData(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Z=H.useDelayedTextureLoading;H.useDelayedTextureLoading=!1;const I=new V(E,H,null,!1,null,null,null,void 0,!0,d,n);return H.useDelayedTextureLoading=Z,I}constructor(E,H){var d;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,V=arguments.length>8&&void 0!==arguments[8]&&arguments[8],C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,w=arguments.length>10&&void 0!==arguments[10]&&arguments[10],R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,Q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,L=arguments.length>13?arguments[13]:void 0,D=arguments.length>14?arguments[14]:void 0;super(H),this.onLoadObservable=new S.e,this.boundingBoxPosition=g.wH.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new g.Matrix,this._buffer=null,this.name=E,this.url=E,this._noMipmap=Z,this.Od=!1,this.isCube=!0,this._textureMatrix=g.Matrix.Identity(),this.coordinatesMode=r.c.CUBIC_MODE;let e=null,s=null;null===n||Array.isArray(n)?(this._noMipmap=Z,this._format=M,this._createPolynomials=w,e=n,this._loaderOptions=L,this._useSRGBBuffer=D,this._lodScale=R,this._lodOffset=Q):(e=n.extensions??null,this._noMipmap=n.noMipmap??!1,I=n.files??null,s=n.buffer??null,this._format=n.format??5,V=n.prefiltered??!1,C=n.forcedExtension??null,this._createPolynomials=n.createPolynomials??!1,this._lodScale=n.lodScale??.8,this._lodOffset=n.lodOffset??0,this._loaderOptions=n.loaderOptions,this._useSRGBBuffer=n.useSRGBBuffer,l=n.A??null,t=n.onError??null),(E||I)&&this.updateURL(E,C,l,V,t,e,null===(d=this.fE())||void 0===d?void 0:d.useDelayedTextureLoading,I,s)}getClassName(){return"CubeTexture"}updateURL(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=E),this.url=E,H&&(this._forcedExtension=H);const t=E.lastIndexOf("."),S=H||(t>-1?E.substring(t).toLowerCase():""),M=0===S.indexOf(".dds"),V=0===S.indexOf(".env"),C=0===S.indexOf(".basis");if(V?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=n,n&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),l)this._files=l;else if(C||V||M||I||(I=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,I){for(let H=0;H<I.length;H++)this._files.push(E+I[H]);this._extensions=I}this._buffer=r,g?(this.delayLoadState=4,this._delayedOnLoad=d,this._delayedOnError=Z):this._loadTexture(d,Z)}delayLoad(E){4===this.delayLoadState&&(E&&(this._forcedExtension=E),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(E){var H,d;if(E.updateFlag===this._textureMatrix.updateFlag)return;E.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(d=this.fE())||void 0===d||d.markAllMaterialsAsDirty(1,(E=>-1!==E.getActiveTextures().indexOf(this))));if(this._textureMatrix=E,null===(H=this.fE())||void 0===H||!H.useRightHandedSystem)return;const n=g.TmpVectors.wH[0],Z=g.TmpVectors.Quaternion[0],I=g.TmpVectors.wH[1];this._textureMatrix.decompose(n,Z,I),Z.z*=-1,Z.w*=-1,g.Matrix.ComposeToRef(n,Z,I,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var E;return null!==(E=this.fE())&&void 0!==E&&E.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=this.fE(),n=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const Z=()=>{var H;(this.onLoadObservable.notifyObservers(this),n)&&(n.dispose(),null===(H=this.fE())||void 0===H||H.markAllMaterialsAsDirty(1));E&&E()},g=(E,d)=>{this._loadingError=!0,this._errorObject={message:E,exception:d},H&&H(E,d),r.c.OnTextureLoadErrorObservable.notifyObservers(this)};var l;this._texture?this._texture.isReady?I.Tools.SetImmediate((()=>Z())):this._texture.onLoadedObservable.add((()=>Z())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,d,this._lodScale,this._lodOffset,E,g,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,d,this._files,this._noMipmap,E,g,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(l=this._texture)||void 0===l||l.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(E,H,d){const n=M.c.Parse((()=>{let n=!1;return E.prefiltered&&(n=E.prefiltered),new V(d+(E.url??E.name),H,E.extensions,!1,E.files||null,null,null,void 0,n,E.forcedExtension)}),E,H);if(E.boundingBoxPosition&&(n.boundingBoxPosition=g.wH.eH(E.boundingBoxPosition)),E.boundingBoxSize&&(n.boundingBoxSize=g.wH.eH(E.boundingBoxSize)),E.animations)for(let Z=0;Z<E.animations.length;Z++){const H=E.animations[Z],d=(0,t.c)("BABYLON.Animation");d&&n.animations.push(d.Parse(H))}return n}clone(){let E=0;const H=M.c.Clone((()=>{const H=new V(this.url,this.fE()||this._getEngine(),this._extensions,this._noMipmap,this._files);return E=H.uniqueId,H}),this);return H.uniqueId=E,H}}(0,n.e)([(0,Z.K)()],V.prototype,"url",void 0),(0,n.e)([(0,Z.I)()],V.prototype,"boundingBoxPosition",void 0),(0,n.e)([(0,Z.I)()],V.prototype,"boundingBoxSize",null),(0,n.e)([(0,Z.K)("rotationY")],V.prototype,"rotationY",null),(0,n.e)([(0,Z.K)("files")],V.prototype,"_files",void 0),(0,n.e)([(0,Z.K)("forcedExtension")],V.prototype,"_forcedExtension",void 0),(0,n.e)([(0,Z.K)("extensions")],V.prototype,"_extensions",void 0),(0,n.e)([(0,Z.s)("textureMatrix")],V.prototype,"_textureMatrix",void 0),(0,n.e)([(0,Z.s)("textureMatrixRefraction")],V.prototype,"_textureMatrixRefraction",void 0),r.c._CubeTextureParser=V.Parse,(0,t.e)("BABYLON.CubeTexture",V)},14561:(E,H,d)=>{"use strict";d.d(H,{c:()=>r});var n=d(12237),Z=d(12366),I=d(12358),g=d(12524),l=d(12323);g.ThinEngine.prototype.createDynamicTexture=function(E,H,d,n){const Z=new l.d(this,4);return Z.baseWidth=E,Z.baseHeight=H,d&&(E=this.needPOTTextures?(0,I.f)(E,this._caps.maxTextureSize):E,H=this.needPOTTextures?(0,I.f)(H,this._caps.maxTextureSize):H),Z.width=E,Z.height=H,Z.isReady=!1,Z.generateMipMaps=d,Z.samplingMode=n,this.updateTextureSamplingMode(n,Z),this._internalTexturesCache.push(Z),Z},g.ThinEngine.prototype.updateDynamicTexture=function(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4?arguments[4]:void 0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!E)return;const g=this._gl,l=g.TEXTURE_2D,r=this._bindTextureDirectly(l,E,!0,I);this._unpackFlipY(void 0===d?E.invertY:d),n&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const t=this._getWebGLTextureType(E.type),S=this._getInternalFormat(Z||E.format),M=this._getRGBABufferInternalSizedFormat(E.type,S);g.texImage2D(l,0,M,S,t,H),E.generateMipMaps&&g.generateMipmap(l),r||this._bindTextureDirectly(l,null),n&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Z&&(E.format=Z),E._dynamicTextureSource=H,E._premulAlpha=n,E.invertY=d||!1,E.isReady=!0};class r extends Z.c{constructor(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,l=arguments.length>6?arguments[6]:void 0;const r=!d||d._isScene;super(null,r?d:null===d||void 0===d?void 0:d.QH,r?!n:d,l,I,void 0,void 0,void 0,void 0,g),this.name=E,this.wrapU=Z.c.CLAMP_ADDRESSMODE,this.wrapV=Z.c.CLAMP_ADDRESSMODE,this._generateMipMaps=n;const t=this._getEngine();if(!t)return;if(H.getContext)this._canvas=H,this._ownCanvas=!1,this._texture=t.createDynamicTexture(this._canvas.width,this._canvas.height,n,I);else{this._canvas=t.createCanvas(1,1),this._ownCanvas=!0;const E=H;E.width||0===E.width?this._texture=t.createDynamicTexture(E.width,E.height,n,I):this._texture=t.createDynamicTexture(H,H,n,I)}const S=this.getSize();this._canvas.width!==S.width&&(this._canvas.width=S.width),this._canvas.height!==S.height&&(this._canvas.height=S.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(E){this._canvas.width=E.width,this._canvas.height=E.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(E.width,E.height,this._generateMipMaps,this.samplingMode)}scale(E){const H=this.getSize();H.width*=E,H.height*=E,this._recreate(H)}scaleTo(E,H){const d=this.getSize();d.width=E,d.height=H,this._recreate(d)}getContext(){return this._context}clear(E){const H=this.getSize();E&&(this._context.fillStyle=E),this._context.clearRect(0,0,H.width,H.height)}update(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===E||E,H,this._format||void 0,void 0,d)}drawText(E,H,d,n,Z,I,g){let l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const r=this.getSize();if(I&&(this._context.fillStyle=I,this._context.fillRect(0,0,r.width,r.height)),this._context.font=n,null===H||void 0===H){const d=this._context.measureText(E);H=(r.width-d.width)/2}if(null===d||void 0===d){const E=parseInt(n.replace(/\D/g,""));d=r.height/2+E/3.65}this._context.fillStyle=Z||"",this._context.fillText(E,H,d),l&&this.update(g)}dispose(){var E,H;(super.dispose(),this._ownCanvas)&&(null===(E=this._canvas)||void 0===E||null===(H=E.remove)||void 0===H||H.call(E));this._canvas=null,this._context=null}clone(){const E=this.fE();if(!E)return this;const H=this.getSize(),d=new r(this.name,H,E,this._generateMipMaps);return d.Od=this.Od,d.level=this.level,d.wrapU=this.wrapU,d.wrapV=this.wrapV,d}serialize(){const E=this.fE();E&&!E.isReady()&&n.b.Warn("The scene must be ready before serializing the dynamic texture");const H=super.serialize();return r._IsCanvasElement(this._canvas)&&(H.base64String=this._canvas.toDataURL()),H.invertY=this._invertY,H.samplingMode=this.samplingMode,H}static _IsCanvasElement(E){return void 0!==E.toDataURL}_rebuild(){this.update()}}},13970:(E,H,d)=>{"use strict";d.d(H,{e:()=>Z});var n=d(12366);class Z extends n.c{get depth(){return this._depth}constructor(E,H,d,Z,I,g){let l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7],t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:n.c.TRILINEAR_SAMPLINGMODE,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,M=arguments.length>10?arguments[10]:void 0;super(null,g,!l,r),this.format=I,this._texture=g.getEngine().createRawTexture2DArray(E,H,d,Z,I,l,r,t,null,S,M),this._depth=Z,this.is2DArray=!0}update(E){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,E,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(E,H,d,n,I){return new Z(E,H,d,n,5,I,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13792:(E,H,d)=>{"use strict";d.d(H,{c:()=>l,d:()=>r,g:()=>I,i:()=>g});var n=d(12406),Z=d(12384);function I(E,H){return`{X: ${E.x.toFixed(H)} Y: ${E.y.toFixed(H)}}`}function g(E,H){return`{X: ${E._x.toFixed(H)} Y: ${E._y.toFixed(H)} Z: ${E._z.toFixed(H)}}`}function l(E,H){return 2*Math.acos((0,n.Clamp)(Z.Quaternion.Dot(E,H)))}function r(E,H){const d=new Z.Quaternion;return function(E,H,d){const I=Z.wH.Cross(E,H),g=Math.acos((0,n.Clamp)(Z.wH.Dot(E,H),-1,1));Z.Quaternion.RotationAxisToRef(I,g,d)}(E,H,d),d}},13637:(E,H,d)=>{"use strict";d.d(H,{e:()=>t});var n=d(12384),Z=d(12437),I=d(12840),g=d(12825),l=d(12448);d(13642);function r(E){let H=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const d=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],I=[];let r=[];const t=E.width||E.size||1,S=E.height||E.size||1,M=E.depth||E.size||1,V=E.wrap||!1;let C=void 0===E.topBaseAt?1:E.topBaseAt,w=void 0===E.bottomBaseAt?0:E.bottomBaseAt;C=(C+4)%4,w=(w+4)%4;let R=[2,0,3,1][C],Q=[2,0,1,3][w],L=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(V){H=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],L=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let E=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],d=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const n=[17,18,19,16],Z=[22,23,20,21];for(;R>0;)E.unshift(E.pop()),n.unshift(n.pop()),R--;for(;Q>0;)d.unshift(d.pop()),Z.unshift(Z.pop()),Q--;E=E.flat(),d=d.flat(),L=L.concat(E).concat(d),H.push(n[0],n[2],n[3],n[0],n[1],n[2]),H.push(Z[0],Z[2],Z[3],Z[0],Z[1],Z[2])}const D=[t/2,S/2,M/2];r=L.reduce(((E,H,d)=>E.concat(H*D[d%3])),[]);const e=0===E.sideOrientation?0:E.sideOrientation||g.c.DEFAULTSIDE,s=E.faceUV||new Array(6),i=E.faceColors,p=[];for(let g=0;g<6;g++)void 0===s[g]&&(s[g]=new n.Vector4(0,0,1,1)),i&&void 0===i[g]&&(i[g]=new Z.gg(1,1,1,1));for(let n=0;n<6;n++)if(I.push(s[n].z,l.e?1-s[n].w:s[n].w),I.push(s[n].x,l.e?1-s[n].w:s[n].w),I.push(s[n].x,l.e?1-s[n].y:s[n].y),I.push(s[n].z,l.e?1-s[n].y:s[n].y),i)for(let E=0;E<4;E++)p.push(i[n].r,i[n].g,i[n].b,i[n].a);g.c._ComputeSides(e,r,H,d,I,E.frontUVs,E.backUVs);const f=new g.c;if(f.indices=H,f.jE=r,f.XE=d,f.UE=I,i){const E=e===g.c.DOUBLESIDE?p.concat(p):p;f.WE=E}return f}function t(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new I.e(E,d);H.sideOrientation=I.e._GetDefaultSideOrientation(H.sideOrientation),n._originalBuilderSideOrientation=H.sideOrientation;return r(H).cE(n,H.updatable),n}g.c.CreateBox=r,I.e.CreateBox=function(E,H){return t(E,{size:H,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13785:(E,H,d)=>{"use strict";d.d(H,{e:()=>l});var n=d(12840),Z=d(12825),I=d(12448);function g(E){const H=[],d=[],n=[],g=[],l=E.radius||.5,r=E.tessellation||64,t=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,S=0===E.sideOrientation?0:E.sideOrientation||Z.c.DEFAULTSIDE;H.push(0,0,0),g.push(.5,.5);const M=2*Math.PI*t,V=1===t?M/r:M/(r-1);let C=0;for(let Z=0;Z<r;Z++){const E=Math.cos(C),d=Math.sin(C),n=(E+1)/2,Z=(1-d)/2;H.push(l*E,l*d,0),g.push(n,I.e?1-Z:Z),C+=V}1===t&&(H.push(H[3],H[4],H[5]),g.push(g[2],I.e?1-g[3]:g[3]));const w=H.length/3;for(let Z=1;Z<w-1;Z++)d.push(Z+1,0,Z);Z.c.ComputeNormals(H,d,n),Z.c._ComputeSides(S,H,d,n,g,E.frontUVs,E.backUVs);const R=new Z.c;return R.indices=d,R.jE=H,R.XE=n,R.UE=g,R}function l(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new n.e(E,d);H.sideOrientation=n.e._GetDefaultSideOrientation(H.sideOrientation),Z._originalBuilderSideOrientation=H.sideOrientation;return g(H).cE(Z,H.updatable),Z}Z.c.CreateDisc=g,n.e.CreateDisc=function(E,H,d){return l(E,{radius:H,tessellation:d,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13642:(E,H,d)=>{"use strict";d.d(H,{i:()=>Q,e:()=>D,m:()=>L});var n=d(12384),Z=d(12437),I=d(12840),g=d(12825),l=d(12463);I.e._GroundMeshParser=(E,H)=>r.Parse(E,H);class r extends I.e{constructor(E,H){super(E,H),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=E,this._subdivisionsY=E,this.subdivide(E);const d=this;d.createOrUpdateSubmeshesOctree&&d.createOrUpdateSubmeshesOctree(H)}getHeightAtCoordinates(E,H){const d=this.getWorldMatrix(),Z=n.TmpVectors.Matrix[5];d.invertToRef(Z);const I=n.TmpVectors.wH[8];if(n.wH.TransformCoordinatesFromFloatsToRef(E,0,H,Z,I),E=I.x,H=I.z,E<this._minX||E>=this._maxX||H<=this._minZ||H>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const g=this._getFacetAt(E,H),l=-(g.x*E+g.z*H+g.w)/g.y;return n.wH.TransformCoordinatesFromFloatsToRef(0,l,0,d,I),I.y}getNormalAtCoordinates(E,H){const d=new n.wH(0,1,0);return this.getNormalAtCoordinatesToRef(E,H,d),d}getNormalAtCoordinatesToRef(E,H,d){const Z=this.getWorldMatrix(),I=n.TmpVectors.Matrix[5];Z.invertToRef(I);const g=n.TmpVectors.wH[8];if(n.wH.TransformCoordinatesFromFloatsToRef(E,0,H,I,g),E=g.x,H=g.z,E<this._minX||E>this._maxX||H<this._minZ||H>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const l=this._getFacetAt(E,H);return n.wH.TransformNormalFromFloatsToRef(l.x,l.y,l.z,Z,d),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(E,H){const d=Math.floor((E+this._maxX)*this._subdivisionsX/this._width),n=Math.floor(-(H+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),Z=this._heightQuads[n*this._subdivisionsX+d];let I;return I=H<Z.slope.x*E+Z.slope.y?Z.facet1:Z.facet2,I}_initHeightQuads(){const E=this._subdivisionsX,H=this._subdivisionsY;this._heightQuads=[];for(let d=0;d<H;d++)for(let H=0;H<E;H++){const Z={slope:n.Vector2.Zero(),facet1:new n.Vector4(0,0,0,0),facet2:new n.Vector4(0,0,0,0)};this._heightQuads[d*E+H]=Z}return this}_computeHeightQuads(){const E=this.getVerticesData(l.g.PositionKind);if(!E)return this;const H=n.TmpVectors.wH[3],d=n.TmpVectors.wH[2],Z=n.TmpVectors.wH[1],I=n.TmpVectors.wH[0],g=n.TmpVectors.wH[4],r=n.TmpVectors.wH[5],t=n.TmpVectors.wH[6],S=n.TmpVectors.wH[7],M=n.TmpVectors.wH[8];let V=0,C=0,w=0,R=0,Q=0,L=0,D=0;const e=this._subdivisionsX,s=this._subdivisionsY;for(let l=0;l<s;l++)for(let s=0;s<e;s++){V=3*s,C=l*(e+1)*3,w=(l+1)*(e+1)*3,H.x=E[C+V],H.y=E[C+V+1],H.z=E[C+V+2],d.x=E[C+V+3],d.y=E[C+V+4],d.z=E[C+V+5],Z.x=E[w+V],Z.y=E[w+V+1],Z.z=E[w+V+2],I.x=E[w+V+3],I.y=E[w+V+4],I.z=E[w+V+5],R=(I.z-H.z)/(I.x-H.x),Q=H.z-R*H.x,d.subtractToRef(H,g),Z.subtractToRef(H,r),I.subtractToRef(H,t),n.wH.CrossToRef(t,r,S),n.wH.CrossToRef(g,t,M),S.normalize(),M.normalize(),L=-(S.x*H.x+S.y*H.y+S.z*H.z),D=-(M.x*d.x+M.y*d.y+M.z*d.z);const i=this._heightQuads[l*e+s];i.slope.en(R,Q),i.facet1.en(S.x,S.y,S.z,L),i.facet2.en(M.x,M.y,M.z,D)}return this}serialize(E){super.serialize(E),E.subdivisionsX=this._subdivisionsX,E.subdivisionsY=this._subdivisionsY,E.minX=this._minX,E.maxX=this._maxX,E.Gd=this._minZ,E.maxZ=this._maxZ,E.width=this._width,E.height=this._height}static Parse(E,H){const d=new r(E.name,H);return d._subdivisionsX=E.subdivisionsX||1,d._subdivisionsY=E.subdivisionsY||1,d._minX=E.minX,d._maxX=E.maxX,d._minZ=E.Gd,d._maxZ=E.maxZ,d._width=E.width,d._height=E.height,d}}var t=d(12228),S=d(12268),M=d(12391),V=d(12448);function C(E){const H=[],d=[],Z=[],I=[];let l,r;const t=E.width||E.size||1,S=E.height||E.size||1,M=0|(E.subdivisionsX||E.subdivisions||1),C=0|(E.subdivisionsY||E.subdivisions||1);for(l=0;l<=C;l++)for(r=0;r<=M;r++){const E=new n.wH(r*t/M-t/2,0,(C-l)*S/C-S/2),H=new n.wH(0,1,0);d.push(E.x,E.y,E.z),Z.push(H.x,H.y,H.z),I.push(r/M,V.e?l/C:1-l/C)}for(l=0;l<C;l++)for(r=0;r<M;r++)H.push(r+1+(l+1)*(M+1)),H.push(r+1+l*(M+1)),H.push(r+l*(M+1)),H.push(r+(l+1)*(M+1)),H.push(r+1+(l+1)*(M+1)),H.push(r+l*(M+1));const w=new g.c;return w.indices=H,w.jE=d,w.XE=Z,w.UE=I,w}function w(E){const H=void 0!==E.xmin&&null!==E.xmin?E.xmin:-1,d=void 0!==E.zmin&&null!==E.zmin?E.zmin:-1,Z=void 0!==E.xmax&&null!==E.xmax?E.xmax:1,I=void 0!==E.zmax&&null!==E.zmax?E.zmax:1,l=E.subdivisions||{w:1,h:1},r=E.precision||{w:1,h:1},t=[],S=[],M=[],V=[];let C,w,R,Q;l.h=l.h<1?1:l.h,l.w=l.w<1?1:l.w,r.w=r.w<1?1:r.w,r.h=r.h<1?1:r.h;const L=(Z-H)/l.w,D=(I-d)/l.h;function e(E,H,d,Z){const I=S.length/3,g=r.w+1;for(C=0;C<r.h;C++)for(w=0;w<r.w;w++){const E=[I+w+C*g,I+(w+1)+C*g,I+(w+1)+(C+1)*g,I+w+(C+1)*g];t.push(E[1]),t.push(E[2]),t.push(E[3]),t.push(E[0]),t.push(E[1]),t.push(E[3])}const l=n.wH.Zero(),R=new n.wH(0,1,0);for(C=0;C<=r.h;C++)for(l.z=C*(Z-H)/r.h+H,w=0;w<=r.w;w++)l.x=w*(d-E)/r.w+E,l.y=0,S.push(l.x,l.y,l.z),M.push(R.x,R.y,R.z),V.push(w/r.w,C/r.h)}for(R=0;R<l.h;R++)for(Q=0;Q<l.w;Q++)e(H+Q*L,d+R*D,H+(Q+1)*L,d+(R+1)*D);const s=new g.c;return s.indices=t,s.jE=S,s.XE=M,s.UE=V,s}function R(E){const H=[],d=[],I=[],l=[];let r,t;const S=E.colorFilter||new Z.DH(.3,.59,.11),V=E.alphaFilter||0;let C=!1;if(E.minHeight>E.maxHeight){C=!0;const H=E.maxHeight;E.maxHeight=E.minHeight,E.minHeight=H}for(r=0;r<=E.subdivisions;r++)for(t=0;t<=E.subdivisions;t++){const H=new n.wH(t*E.width/E.subdivisions-E.width/2,0,(E.subdivisions-r)*E.height/E.subdivisions-E.height/2),Z=4*(((H.x+E.width/2)/E.width*(E.bufferWidth-1)|0)+((1-(H.z+E.height/2)/E.height)*(E.bufferHeight-1)|0)*E.bufferWidth);let g=E.buffer[Z]/255,w=E.buffer[Z+1]/255,R=E.buffer[Z+2]/255;const Q=E.buffer[Z+3]/255;C&&(g=1-g,w=1-w,R=1-R);const L=g*S.r+w*S.g+R*S.b;H.y=Q>=V?E.minHeight+(E.maxHeight-E.minHeight)*L:E.minHeight-M.c,E.heightBuffer&&(E.heightBuffer[r*(E.subdivisions+1)+t]=H.y),d.push(H.x,H.y,H.z),I.push(0,0,0),l.push(t/E.subdivisions,1-r/E.subdivisions)}for(r=0;r<E.subdivisions;r++)for(t=0;t<E.subdivisions;t++){const n=t+1+(r+1)*(E.subdivisions+1),Z=t+1+r*(E.subdivisions+1),I=t+r*(E.subdivisions+1),g=t+(r+1)*(E.subdivisions+1),l=d[3*n+1]>=E.minHeight,S=d[3*Z+1]>=E.minHeight,M=d[3*I+1]>=E.minHeight;l&&S&&M&&(H.push(n),H.push(Z),H.push(I));d[3*g+1]>=E.minHeight&&l&&M&&(H.push(g),H.push(n),H.push(I))}g.c.ComputeNormals(d,H,I);const w=new g.c;return w.indices=H,w.jE=d,w.XE=I,w.UE=l,w}function Q(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const d=new r(E,arguments.length>2?arguments[2]:void 0);d._setReady(!1),d._subdivisionsX=H.subdivisionsX||H.subdivisions||1,d._subdivisionsY=H.subdivisionsY||H.subdivisions||1,d._width=H.width||1,d._height=H.height||1,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ;return C(H).cE(d,H.updatable),d._setReady(!0),d}function L(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new I.e(E,d);return w(H).cE(n,H.updatable),n}function D(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const I=d.width||10,g=d.height||10,l=d.subdivisions||1,M=d.minHeight||0,V=d.maxHeight||1,C=d.colorFilter||new Z.DH(.3,.59,.11),w=d.alphaFilter||0,Q=d.updatable,L=d.onReady;n=n||S.b.LastCreatedScene;const D=new r(E,n);let e;D._subdivisionsX=l,D._subdivisionsY=l,D._width=I,D._height=g,D._maxX=D._width/2,D._maxZ=D._height/2,D._minX=-D._maxX,D._minZ=-D._maxZ,D._setReady(!1),d.passHeightBufferInCallback&&(e=new Float32Array((l+1)*(l+1)));const s=(E,H,d)=>{R({width:I,height:g,subdivisions:l,minHeight:M,maxHeight:V,colorFilter:C,buffer:E,bufferWidth:H,bufferHeight:d,alphaFilter:w,heightBuffer:e}).cE(D,Q),L&&L(D,e),D._setReady(!0)};if("string"===typeof H){const E=E=>{var H;const d=E.width,Z=E.height;if(n.M)return;const I=null===(H=n)||void 0===H?void 0:H.getEngine().resizeImageBitmap(E,d,Z);s(I,d,Z)};t.Tools.LoadImage(H,E,d.onError?d.onError:()=>{},n.offlineProvider)}else s(H.data,H.width,H.height);return D}g.c.CreateGround=C,g.c.CreateTiledGround=w,g.c.CreateGroundFromHeightMap=R,I.e.CreateGround=(E,H,d,n,Z,I)=>Q(E,{width:H,height:d,subdivisions:n,updatable:I},Z),I.e.CreateTiledGround=(E,H,d,n,Z,I,g,l,r)=>L(E,{xmin:H,zmin:d,xmax:n,zmax:Z,subdivisions:I,precision:g,updatable:r},l),I.e.CreateGroundFromHeightMap=(E,H,d,n,Z,I,g,l,r,t,S)=>D(E,H,{width:d,height:n,subdivisions:Z,minHeight:I,maxHeight:g,updatable:r,onReady:t,alphaFilter:S},l)},14275:(E,H,d)=>{"use strict";d.d(H,{e:()=>C,i:()=>M,k:()=>V});var n=d(12384),Z=d(12840),I=d(12825),g=d(12927),l=d(12463),r=d(12237);function t(E){const H=[],d=[],n=E.lines,Z=E.WE,g=[];let l=0;for(let I=0;I<n.length;I++){const E=n[I];for(let n=0;n<E.length;n++){const{x:r,y:t,z:S}=E[n];if(d.push(r,t,S),Z){const E=Z[I],{r:H,g:d,b:l,a:r}=E[n];g.push(H,d,l,r)}n>0&&(H.push(l-1),H.push(l)),l++}}const r=new I.c;return r.indices=H,r.jE=d,Z&&(r.WE=g),r}function S(E){const H=E.dashSize||3,d=E.gapSize||1,Z=E.dashNb||200,g=E.points,l=[],r=[],t=n.wH.Zero();let S=0,M=0,V=0,C=0,w=0,R=0,Q=0;for(Q=0;Q<g.length-1;Q++)g[Q+1].subtractToRef(g[Q],t),S+=t.length();for(V=S/Z,C=H*V/(H+d),Q=0;Q<g.length-1;Q++){g[Q+1].subtractToRef(g[Q],t),M=Math.floor(t.length()/V),t.normalize();for(let E=0;E<M;E++)w=V*E,l.push(g[Q].x+w*t.x,g[Q].y+w*t.y,g[Q].z+w*t.z),l.push(g[Q].x+(w+C)*t.x,g[Q].y+(w+C)*t.y,g[Q].z+(w+C)*t.z),r.push(R,R+1),R+=2}const L=new I.c;return L.jE=l,L.indices=r,L}function M(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=H.instance,Z=H.lines,I=H.WE;if(n){const E=n.getVerticesData(l.g.PositionKind);let H,d;I&&(H=n.getVerticesData(l.g.ColorKind));let g=0,r=0;for(let n=0;n<Z.length;n++){const l=Z[n];for(let Z=0;Z<l.length;Z++)E[g]=l[Z].x,E[g+1]=l[Z].y,E[g+2]=l[Z].z,I&&H&&(d=I[n],H[r]=d[Z].r,H[r+1]=d[Z].g,H[r+2]=d[Z].b,H[r+3]=d[Z].a,r+=4),g+=3}return n.updateVerticesData(l.g.PositionKind,E,!1,!1),I&&H&&n.updateVerticesData(l.g.ColorKind,H,!1,!1),n.refreshBoundingInfo(),n}const r=!!I,S=new g.c(E,d,null,void 0,void 0,r,H.useVertexAlpha,H.material);return t(H).cE(S,H.updatable),S}function V(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=H.WE?[H.WE]:null;return M(E,{lines:[H.points],updatable:H.updatable,instance:H.instance,WE:n,useVertexAlpha:H.useVertexAlpha,material:H.material},d)}function C(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=H.points,l=H.instance,t=H.gapSize||1,M=H.dashSize||3;if(l){const E=E=>{const H=n.wH.Zero(),d=E.length/6;let Z=0,g=0,r=0,t=0,S=0,M=0,V=0,C=0;for(V=0;V<I.length-1;V++)I[V+1].subtractToRef(I[V],H),Z+=H.length();r=Z/d;const w=l._creationDataStorage.dashSize;for(t=w*r/(w+l._creationDataStorage.gapSize),V=0;V<I.length-1;V++)for(I[V+1].subtractToRef(I[V],H),g=Math.floor(H.length()/r),H.normalize(),C=0;C<g&&M<E.length;)S=r*C,E[M]=I[V].x+S*H.x,E[M+1]=I[V].y+S*H.y,E[M+2]=I[V].z+S*H.z,E[M+3]=I[V].x+(S+t)*H.x,E[M+4]=I[V].y+(S+t)*H.y,E[M+5]=I[V].z+(S+t)*H.z,M+=6,C++;for(;M<E.length;)E[M]=I[V].x,E[M+1]=I[V].y,E[M+2]=I[V].z,M+=3};return(H.dashNb||H.dashSize||H.gapSize||H.useVertexAlpha||H.material)&&r.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),l.updateMeshPositions(E,!1),l}const V=new g.c(E,d,null,void 0,void 0,void 0,H.useVertexAlpha,H.material);return S(H).cE(V,H.updatable),V._creationDataStorage=new Z.h,V._creationDataStorage.dashSize=M,V._creationDataStorage.gapSize=t,V}I.c.CreateLineSystem=t,I.c.CreateDashedLines=S,Z.e.Ut=function(E,H){return V(E,{points:H,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},Z.e.CreateDashedLines=function(E,H,d,n,Z){return C(E,{points:H,dashSize:d,gapSize:n,dashNb:Z,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13686:(E,H,d)=>{"use strict";d.d(H,{d:()=>l,f:()=>r});var n=d(12840),Z=d(12825),I=d(12448);function g(E){const H=[],d=[],n=[],g=[],l=void 0!==E.width?E.width:void 0!==E.size?E.size:1,r=void 0!==E.height?E.height:void 0!==E.size?E.size:1,t=0===E.sideOrientation?0:E.sideOrientation||Z.c.DEFAULTSIDE,S=l/2,M=r/2;d.push(-S,-M,0),n.push(0,0,-1),g.push(0,I.e?1:0),d.push(S,-M,0),n.push(0,0,-1),g.push(1,I.e?1:0),d.push(S,M,0),n.push(0,0,-1),g.push(1,I.e?0:1),d.push(-S,M,0),n.push(0,0,-1),g.push(0,I.e?0:1),H.push(0),H.push(1),H.push(2),H.push(0),H.push(2),H.push(3),Z.c._ComputeSides(t,d,H,n,g,E.frontUVs,E.backUVs);const V=new Z.c;return V.indices=H,V.jE=d,V.XE=n,V.UE=g,V}function l(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new n.e(E,d);H.sideOrientation=n.e._GetDefaultSideOrientation(H.sideOrientation),Z._originalBuilderSideOrientation=H.sideOrientation;return g(H).cE(Z,H.updatable),H.sourcePlane&&(Z.translate(H.sourcePlane.normal,-H.sourcePlane.d),Z.setDirection(H.sourcePlane.normal.scale(-1))),Z}const r={ut:l};Z.c.ut=g,n.e.ut=(E,H,d,n,Z)=>l(E,{size:H,width:H,height:H,sideOrientation:Z,updatable:n},d)},13775:(E,H,d)=>{"use strict";d.d(H,{b:()=>r});var n=d(12384),Z=d(12840),I=d(12825),g=d(12448);function l(E){const H=0|(E.segments||32),d=E.diameterX||E.diameter||1,Z=E.diameterY||E.diameter||1,l=E.diameterZ||E.diameter||1,r=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,t=E.slice&&E.slice<=0?1:E.slice||1,S=0===E.sideOrientation?0:E.sideOrientation||I.c.DEFAULTSIDE,M=!!E.dedupTopBottomIndices,V=new n.wH(d/2,Z/2,l/2),C=2+H,w=2*C,R=[],Q=[],L=[],D=[];for(let I=0;I<=C;I++){const E=I/C,H=E*Math.PI*t;for(let d=0;d<=w;d++){const Z=d/w,I=Z*Math.PI*2*r,l=n.Matrix.RotationZ(-H),t=n.Matrix.RotationY(I),S=n.wH.TransformCoordinates(n.wH.Up(),l),M=n.wH.TransformCoordinates(S,t),C=M.multiply(V),R=M.divide(V).normalize();Q.push(C.x,C.y,C.z),L.push(R.x,R.y,R.z),D.push(Z,g.e?1-E:E)}if(I>0){const E=Q.length/3;for(let H=E-2*(w+1);H+w+2<E;H++)M?(I>1&&(R.push(H),R.push(H+1),R.push(H+w+1)),(I<C||t<1)&&(R.push(H+w+1),R.push(H+1),R.push(H+w+2))):(R.push(H),R.push(H+1),R.push(H+w+1),R.push(H+w+1),R.push(H+1),R.push(H+w+2))}}I.c._ComputeSides(S,Q,R,L,D,E.frontUVs,E.backUVs);const e=new I.c;return e.indices=R,e.jE=Q,e.XE=L,e.UE=D,e}function r(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new Z.e(E,d);H.sideOrientation=Z.e._GetDefaultSideOrientation(H.sideOrientation),n._originalBuilderSideOrientation=H.sideOrientation;return l(H).cE(n,H.updatable),n}I.c.CreateSphere=l,Z.e.CreateSphere=(E,H,d,n,Z,I)=>r(E,{segments:H,diameterX:d,diameterY:d,diameterZ:d,sideOrientation:I,updatable:Z},n)},14577:(E,H,d)=>{"use strict";d.d(H,{c:()=>l});var n=d(12949),Z=d(14073),I=d(12968),g=d(12825);class l{static get Configuration(){return{get decoder(){return Z.e.DefaultConfiguration},set decoder(E){Z.e.DefaultConfiguration=E}}}static set Configuration(E){Z.e.DefaultConfiguration=E.decoder}static get DecoderAvailable(){return(0,n.i)(Z.e.DefaultConfiguration)}static get Default(){return l._Default??(l._Default=new l),l._Default}static ResetDefault(E){l._Default&&(E||l._Default.dispose(),l._Default=null)}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.DefaultNumWorkers;const H="number"===typeof E?{...Z.e.DefaultConfiguration,numWorkers:E}:{...Z.e.DefaultConfiguration,...E};this._decoder=new Z.e(H)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(E,H,d){return this._decoder.decodeMeshToMeshDataAsync(E,H,d)}async decodeMeshToGeometryAsync(E,H,d,n){return await this._decoder.decodeMeshToGeometryAsync(E,H,d,n)}async _decodeMeshToGeometryForGltfAsync(E,H,d,n,Z,I){return await this._decoder._decodeMeshToGeometryForGltfAsync(E,H,d,n,Z,I)}async decodeMeshAsync(E,H){const d=await this._decoder.decodeMeshToMeshDataAsync(E,H),n=new g.c;d.indices&&(n.indices=d.indices);for(const Z of d.attributes){const E=I.c.GetFloatData(Z.data,Z.size,I.c.GetDataType(Z.data),Z.byteOffset,Z.byteStride,Z.normalized,d.totalVertices);n.set(E,Z.kind)}return n}}l.DefaultNumWorkers=(0,n.f)(),l._Default=null},14073:(E,H,d)=>{"use strict";d.d(H,{e:()=>t});var n=d(12949),Z=d(12228),I=d(12848),g=d(12968),l=d(12237),r=d(12964);class t extends n.e{static get DefaultAvailable(){return(0,n.i)(t.DefaultConfiguration)}static get Default(){return t._Default??(t._Default=new t),t._Default}static ResetDefault(E){t._Default&&(E||t._Default.dispose(),t._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(E,H){return{module:await(H||DracoDecoderModule)({wasmBinary:E})}}_getWorkerContent(){return`${r.e}(${r.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DefaultConfiguration)}decodeMeshToMeshDataAsync(E,H,d){const n=E instanceof ArrayBuffer?new Int8Array(E):new Int8Array(E.buffer,E.byteOffset,E.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async E=>await new Promise(((Z,I)=>{E.push(((E,g)=>{let r=null;const t=[],S=H=>{E.removeEventListener("error",S),E.removeEventListener("message",M),I(H),g()},M=H=>{const n=H.data;switch(n.id){case"indices":r=n.data;break;case"attribute":t.push({kind:n.kind,data:n.data,size:n.size,byteOffset:n.byteOffset,byteStride:n.byteStride,normalized:(I=n.kind,V=n.normalized,d&&void 0!==d[I]?(V!==d[I]&&l.b.Warn(`Normalized flag from Draco data (${V}) does not match normalized flag from glTF accessor (${d[I]}). Using flag from glTF accessor.`),d[I]):V)});break;case"decodeMeshDone":E.removeEventListener("error",S),E.removeEventListener("message",M),Z({indices:r,attributes:t,totalVertices:n.totalVertices}),g()}var I,V};E.addEventListener("error",S),E.addEventListener("message",M);const V=n.slice();E.postMessage({id:"decodeMesh",dataView:V,attributes:H},[V.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((E=>{let d=null;const Z=[],I=(0,r.e)(E.module,n,H,(E=>{d=E}),((E,H,d,n,I,g)=>{Z.push({kind:E,data:H,size:d,byteOffset:n,byteStride:I,normalized:g})}));return{indices:d,attributes:Z,totalVertices:I}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(E,H,d,n){const Z=await this.decodeMeshToMeshDataAsync(d,n),l=new I.c(E,H);Z.indices&&l.setIndices(Z.indices);for(const I of Z.attributes)l.setVerticesBuffer(new g.c(H.getEngine(),I.data,I.kind,!1,void 0,I.byteStride,void 0,I.byteOffset,I.size,void 0,I.normalized,!0),Z.totalVertices);return l}async _decodeMeshToGeometryForGltfAsync(E,H,d,n,Z,l){const r=await this.decodeMeshToMeshDataAsync(d,n,Z),t=new I.c(E,H);l&&(t._boundingInfo=l,t.useBoundingInfoFromGeometry=!0),r.indices&&t.setIndices(r.indices);for(const I of r.attributes)t.setVerticesBuffer(new g.c(H.getEngine(),I.data,I.kind,!1,void 0,I.byteStride,void 0,I.byteOffset,I.size,void 0,I.normalized,!0),r.totalVertices);return t}}t.DefaultConfiguration={wasmUrl:`${Z.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${Z.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${Z.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},t._Default=null},14268:(E,H,d)=>{"use strict";d.d(H,{d:()=>lE});var n=d(12384),Z=d(12840),I=d(12463),g=d(12825),l=d(12448);function r(E){let H=E.pathArray;const d=E.closeArray||!1,n=E.closePath||!1,Z=E.invertUV||!1,r=Math.floor(H[0].length/2);let t=E.offset||r;t=t>r?r:Math.floor(t);const S=0===E.sideOrientation?0:E.sideOrientation||g.c.DEFAULTSIDE,M=E.UE,V=E.WE,C=[],w=[],R=[],Q=[],L=[],D=[],e=[],s=[];let i;const p=[],f=[];let P,j,X;if(H.length<2){const E=[],d=[];for(j=0;j<H[0].length-t;j++)E.push(H[0][j]),d.push(H[0][j+t]);H=[E,d]}let W=0;const U=n?1:0,Y=d?1:0;let c,u,o,F,a,k;for(i=H[0].length,P=0;P<H.length+Y;P++){for(e[P]=0,L[P]=[0],c=P===H.length?H[0]:H[P],u=c.length,i=i<u?i:u,X=0;X<u;)C.push(c[X].x,c[X].y,c[X].z),X>0&&(o=c[X].RH(c[X-1]).length(),F=o+e[P],L[P].push(F),e[P]=F),X++;n&&(X--,C.push(c[0].x,c[0].y,c[0].z),o=c[X].RH(c[0]).length(),F=o+e[P],L[P].push(F),e[P]=F),p[P]=u+U,f[P]=W,W+=u+U}let O,G,x=null,q=null;for(j=0;j<i+U;j++)for(s[j]=0,D[j]=[0],P=0;P<H.length-1+Y;P++)a=H[P],k=P===H.length-1?H[0]:H[P+1],j===i?(x=a[0],q=k[0]):(x=a[j],q=k[j]),o=q.RH(x).length(),F=o+s[j],D[j].push(F),s[j]=F;if(M)for(P=0;P<M.length;P++)Q.push(M[P].x,l.e?1-M[P].y:M[P].y);else for(P=0;P<H.length+Y;P++)for(j=0;j<i+U;j++)O=0!=e[P]?L[P][j]/e[P]:0,G=0!=s[j]?D[j][P]/s[j]:0,Z?Q.push(G,O):Q.push(O,l.e?1-G:G);P=0;let b=0,h=p[P]-1,y=p[P+1]-1,v=h<y?h:y,z=f[1]-f[0];const K=p.length-1;for(;b<=v&&P<K;)w.push(b,b+z,b+1),w.push(b+z+1,b+1,b+z),b+=1,b===v&&(P++,z=f[P+1]-f[P],h=p[P]-1,y=p[P+1]-1,b=f[P],v=h<y?h+b:y+b);if(g.c.ComputeNormals(C,w,R),n){let E=0,d=0;for(P=0;P<H.length;P++){E=3*f[P],d=P+1<H.length?3*(f[P+1]-1):R.length-3,R[E]=.5*(R[E]+R[d]),R[E+1]=.5*(R[E+1]+R[d+1]),R[E+2]=.5*(R[E+2]+R[d+2]);const n=Math.sqrt(R[E]*R[E]+R[E+1]*R[E+1]+R[E+2]*R[E+2]);R[E]/=n,R[E+1]/=n,R[E+2]/=n,R[d]=R[E],R[d+1]=R[E+1],R[d+2]=R[E+2]}}if(d){let E=3*f[0],d=3*f[H.length];for(j=0;j<i+U;j++){R[E]=.5*(R[E]+R[d]),R[E+1]=.5*(R[E+1]+R[d+1]),R[E+2]=.5*(R[E+2]+R[d+2]);const H=Math.sqrt(R[E]*R[E]+R[E+1]*R[E+1]+R[E+2]*R[E+2]);R[E]/=H,R[E+1]/=H,R[E+2]/=H,R[d]=R[E],R[d+1]=R[E+1],R[d+2]=R[E+2],E+=3,d+=3}}g.c._ComputeSides(S,C,w,R,Q,E.frontUVs,E.backUVs);let N=null;if(V){N=new Float32Array(4*V.length);for(let E=0;E<V.length;E++)N[4*E]=V[E].r,N[4*E+1]=V[E].g,N[4*E+2]=V[E].b,N[4*E+3]=V[E].a}const mE=new g.c,T=new Float32Array(C),A=new Float32Array(R),B=new Float32Array(Q);return mE.indices=w,mE.jE=T,mE.XE=A,mE.UE=B,N&&mE.set(N,I.g.ColorKind),n&&(mE._idx=f),mE}function t(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=H.pathArray,S=H.closeArray,M=H.closePath,V=Z.e._GetDefaultSideOrientation(H.sideOrientation),C=H.instance,w=H.updatable;if(C){const E=n.TmpVectors.wH[0].ng(Number.MAX_VALUE),d=n.TmpVectors.wH[1].ng(-Number.MAX_VALUE),r=H=>{let n=t[0].length;const I=C;let g=0;const l=I._originalBuilderSideOrientation===Z.e.DOUBLESIDE?2:1;for(let Z=1;Z<=l;++Z)for(let l=0;l<t.length;++l){const Z=t[l],r=Z.length;n=n<r?n:r;for(let I=0;I<n;++I){const n=Z[I];H[g]=n.x,H[g+1]=n.y,H[g+2]=n.z,E.minimizeInPlaceFromFloats(n.x,n.y,n.z),d.maximizeInPlaceFromFloats(n.x,n.y,n.z),g+=3}if(I._creationDataStorage&&I._creationDataStorage.closePath){const E=Z[0];H[g]=E.x,H[g+1]=E.y,H[g+2]=E.z,g+=3}}},S=C.getVerticesData(I.g.PositionKind);if(r(S),C.hasBoundingInfo?C.getBoundingInfo().reConstruct(E,d,C._worldMatrix):C.buildBoundingInfo(E,d,C._worldMatrix),C.updateVerticesData(I.g.PositionKind,S,!1,!1),H.WE){const E=C.getVerticesData(I.g.ColorKind);for(let d=0,n=0;d<H.WE.length;d++,n+=4){const Z=H.WE[d];E[n]=Z.r,E[n+1]=Z.g,E[n+2]=Z.b,E[n+3]=Z.a}C.updateVerticesData(I.g.ColorKind,E,!1,!1)}if(H.UE){const E=C.getVerticesData(I.g.UVKind);for(let d=0;d<H.UE.length;d++)E[2*d]=H.UE[d].x,E[2*d+1]=l.e?1-H.UE[d].y:H.UE[d].y;C.updateVerticesData(I.g.UVKind,E,!1,!1)}if(!C.areNormalsFrozen||C.isFacetDataEnabled){const E=C.Nd(),H=C.getVerticesData(I.g.NormalKind),d=C.isFacetDataEnabled?C.getFacetDataParameters():null;if(g.c.ComputeNormals(S,E,H,d),C._creationDataStorage&&C._creationDataStorage.closePath){let E=0,d=0;for(let n=0;n<t.length;n++)E=3*C._creationDataStorage.idx[n],d=n+1<t.length?3*(C._creationDataStorage.idx[n+1]-1):H.length-3,H[E]=.5*(H[E]+H[d]),H[E+1]=.5*(H[E+1]+H[d+1]),H[E+2]=.5*(H[E+2]+H[d+2]),H[d]=H[E],H[d+1]=H[E+1],H[d+2]=H[E+2]}C.areNormalsFrozen||C.updateVerticesData(I.g.NormalKind,H,!1,!1)}return C}{const n=new Z.e(E,d);n._originalBuilderSideOrientation=V,n._creationDataStorage=new Z.h;const I=r(H);return M&&(n._creationDataStorage.idx=I._idx),n._creationDataStorage.closePath=M,n._creationDataStorage.closeArray=S,I.cE(n,w),n}}g.c.CreateRibbon=r,Z.e.CreateRibbon=function(E,H){return t(E,{pathArray:H,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var S=d(13785),M=d(13637),V=d(12437);function C(E){const H=E.pattern||Z.e.NO_FLIP,d=E.tileWidth||E.tileSize||1,n=E.tileHeight||E.tileSize||1,I=E.alignHorizontal||0,l=E.alignVertical||0,r=E.width||E.size||1,t=Math.floor(r/d);let S=r-t*d;const M=E.height||E.size||1,V=Math.floor(M/n);let C=M-V*n;const w=d*t/2,R=n*V/2;let Q=0,L=0,D=0,e=0,s=0,i=0;if(S>0||C>0){switch(D=-w,e=-R,s=w,i=R,I){case Z.e.CENTER:S/=2,D-=S,s+=S;break;case Z.e.LEFT:s+=S,Q=-S/2;break;case Z.e.RIGHT:D-=S,Q=S/2}switch(l){case Z.e.CENTER:C/=2,e-=C,i+=C;break;case Z.e.BOTTOM:i+=C,L=-C/2;break;case Z.e.TOP:e-=C,L=C/2}}const p=[],f=[],P=[];P[0]=[0,0,1,0,1,1,0,1],P[1]=[0,0,1,0,1,1,0,1],H!==Z.e.ROTATE_TILE&&H!==Z.e.ROTATE_ROW||(P[1]=[1,1,0,1,0,0,1,0]),H!==Z.e.FLIP_TILE&&H!==Z.e.FLIP_ROW||(P[1]=[1,0,0,0,0,1,1,1]),H!==Z.e.FLIP_N_ROTATE_TILE&&H!==Z.e.FLIP_N_ROTATE_ROW||(P[1]=[0,1,1,1,1,0,0,0]);let j=[];const X=[],W=[];let U=0;for(let g=0;g<V;g++)for(let E=0;E<t;E++)p.push(E*d-w+Q,g*n-R+L,0),p.push((E+1)*d-w+Q,g*n-R+L,0),p.push((E+1)*d-w+Q,(g+1)*n-R+L,0),p.push(E*d-w+Q,(g+1)*n-R+L,0),W.push(U,U+1,U+3,U+1,U+2,U+3),j=H===Z.e.FLIP_TILE||H===Z.e.ROTATE_TILE||H===Z.e.FLIP_N_ROTATE_TILE?j.concat(P[(E%2+g%2)%2]):H===Z.e.FLIP_ROW||H===Z.e.ROTATE_ROW||H===Z.e.FLIP_N_ROTATE_ROW?j.concat(P[g%2]):j.concat(P[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),U+=4;if(S>0||C>0){const E=C>0&&(l===Z.e.CENTER||l===Z.e.TOP),g=C>0&&(l===Z.e.CENTER||l===Z.e.BOTTOM),r=S>0&&(I===Z.e.CENTER||I===Z.e.RIGHT),M=S>0&&(I===Z.e.CENTER||I===Z.e.LEFT);let P,Y,c,u,o=[];if(E&&r&&(p.push(D+Q,e+L,0),p.push(-w+Q,e+L,0),p.push(-w+Q,e+C+L,0),p.push(D+Q,e+C+L,0),W.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,P=1-S/d,Y=1-C/n,c=1,u=1,o=[P,Y,c,Y,c,u,P,u],H===Z.e.ROTATE_ROW&&(o=[1-P,1-Y,1-c,1-Y,1-c,1-u,1-P,1-u]),H===Z.e.FLIP_ROW&&(o=[1-P,Y,1-c,Y,1-c,u,1-P,u]),H===Z.e.FLIP_N_ROTATE_ROW&&(o=[P,1-Y,c,1-Y,c,1-u,P,1-u]),j=j.concat(o),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),E&&M&&(p.push(w+Q,e+L,0),p.push(s+Q,e+L,0),p.push(s+Q,e+C+L,0),p.push(w+Q,e+C+L,0),W.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,P=0,Y=1-C/n,c=S/d,u=1,o=[P,Y,c,Y,c,u,P,u],(H===Z.e.ROTATE_ROW||H===Z.e.ROTATE_TILE&&t%2===0)&&(o=[1-P,1-Y,1-c,1-Y,1-c,1-u,1-P,1-u]),(H===Z.e.FLIP_ROW||H===Z.e.FLIP_TILE&&t%2===0)&&(o=[1-P,Y,1-c,Y,1-c,u,1-P,u]),(H===Z.e.FLIP_N_ROTATE_ROW||H===Z.e.FLIP_N_ROTATE_TILE&&t%2===0)&&(o=[P,1-Y,c,1-Y,c,1-u,P,1-u]),j=j.concat(o),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&r&&(p.push(D+Q,R+L,0),p.push(-w+Q,R+L,0),p.push(-w+Q,i+L,0),p.push(D+Q,i+L,0),W.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,P=1-S/d,Y=0,c=1,u=C/n,o=[P,Y,c,Y,c,u,P,u],(H===Z.e.ROTATE_ROW&&V%2===1||H===Z.e.ROTATE_TILE&&V%1===0)&&(o=[1-P,1-Y,1-c,1-Y,1-c,1-u,1-P,1-u]),(H===Z.e.FLIP_ROW&&V%2===1||H===Z.e.FLIP_TILE&&V%2===0)&&(o=[1-P,Y,1-c,Y,1-c,u,1-P,u]),(H===Z.e.FLIP_N_ROTATE_ROW&&V%2===1||H===Z.e.FLIP_N_ROTATE_TILE&&V%2===0)&&(o=[P,1-Y,c,1-Y,c,1-u,P,1-u]),j=j.concat(o),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&M&&(p.push(w+Q,R+L,0),p.push(s+Q,R+L,0),p.push(s+Q,i+L,0),p.push(w+Q,i+L,0),W.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,P=0,Y=0,c=S/d,u=C/n,o=[P,Y,c,Y,c,u,P,u],(H===Z.e.ROTATE_ROW&&V%2===1||H===Z.e.ROTATE_TILE&&(V+t)%2===1)&&(o=[1-P,1-Y,1-c,1-Y,1-c,1-u,1-P,1-u]),(H===Z.e.FLIP_ROW&&V%2===1||H===Z.e.FLIP_TILE&&(V+t)%2===1)&&(o=[1-P,Y,1-c,Y,1-c,u,1-P,u]),(H===Z.e.FLIP_N_ROTATE_ROW&&V%2===1||H===Z.e.FLIP_N_ROTATE_TILE&&(V+t)%2===1)&&(o=[P,1-Y,c,1-Y,c,1-u,P,1-u]),j=j.concat(o),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),E){const E=[];P=0,Y=1-C/n,c=1,u=1,E[0]=[P,Y,c,Y,c,u,P,u],E[1]=[P,Y,c,Y,c,u,P,u],H!==Z.e.ROTATE_TILE&&H!==Z.e.ROTATE_ROW||(E[1]=[1-P,1-Y,1-c,1-Y,1-c,1-u,1-P,1-u]),H!==Z.e.FLIP_TILE&&H!==Z.e.FLIP_ROW||(E[1]=[1-P,Y,1-c,Y,1-c,u,1-P,u]),H!==Z.e.FLIP_N_ROTATE_TILE&&H!==Z.e.FLIP_N_ROTATE_ROW||(E[1]=[P,1-Y,c,1-Y,c,1-u,P,1-u]);for(let n=0;n<t;n++)p.push(n*d-w+Q,e+L,0),p.push((n+1)*d-w+Q,e+L,0),p.push((n+1)*d-w+Q,e+C+L,0),p.push(n*d-w+Q,e+C+L,0),W.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,j=H===Z.e.FLIP_TILE||H===Z.e.ROTATE_TILE||H===Z.e.FLIP_N_ROTATE_TILE?j.concat(E[(n+1)%2]):H===Z.e.FLIP_ROW||H===Z.e.ROTATE_ROW||H===Z.e.FLIP_N_ROTATE_ROW?j.concat(E[1]):j.concat(E[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const E=[];P=0,Y=0,c=1,u=C/n,E[0]=[P,Y,c,Y,c,u,P,u],E[1]=[P,Y,c,Y,c,u,P,u],H!==Z.e.ROTATE_TILE&&H!==Z.e.ROTATE_ROW||(E[1]=[1-P,1-Y,1-c,1-Y,1-c,1-u,1-P,1-u]),H!==Z.e.FLIP_TILE&&H!==Z.e.FLIP_ROW||(E[1]=[1-P,Y,1-c,Y,1-c,u,1-P,u]),H!==Z.e.FLIP_N_ROTATE_TILE&&H!==Z.e.FLIP_N_ROTATE_ROW||(E[1]=[P,1-Y,c,1-Y,c,1-u,P,1-u]);for(let n=0;n<t;n++)p.push(n*d-w+Q,i-C+L,0),p.push((n+1)*d-w+Q,i-C+L,0),p.push((n+1)*d-w+Q,i+L,0),p.push(n*d-w+Q,i+L,0),W.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,j=H===Z.e.FLIP_TILE||H===Z.e.ROTATE_TILE||H===Z.e.FLIP_N_ROTATE_TILE?j.concat(E[(n+V)%2]):H===Z.e.FLIP_ROW||H===Z.e.ROTATE_ROW||H===Z.e.FLIP_N_ROTATE_ROW?j.concat(E[V%2]):j.concat(E[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(r){const E=[];P=1-S/d,Y=0,c=1,u=1,E[0]=[P,Y,c,Y,c,u,P,u],E[1]=[P,Y,c,Y,c,u,P,u],H!==Z.e.ROTATE_TILE&&H!==Z.e.ROTATE_ROW||(E[1]=[1-P,1-Y,1-c,1-Y,1-c,1-u,1-P,1-u]),H!==Z.e.FLIP_TILE&&H!==Z.e.FLIP_ROW||(E[1]=[1-P,Y,1-c,Y,1-c,u,1-P,u]),H!==Z.e.FLIP_N_ROTATE_TILE&&H!==Z.e.FLIP_N_ROTATE_ROW||(E[1]=[P,1-Y,c,1-Y,c,1-u,P,1-u]);for(let d=0;d<V;d++)p.push(D+Q,d*n-R+L,0),p.push(D+S+Q,d*n-R+L,0),p.push(D+S+Q,(d+1)*n-R+L,0),p.push(D+Q,(d+1)*n-R+L,0),W.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,j=H===Z.e.FLIP_TILE||H===Z.e.ROTATE_TILE||H===Z.e.FLIP_N_ROTATE_TILE?j.concat(E[(d+1)%2]):H===Z.e.FLIP_ROW||H===Z.e.ROTATE_ROW||H===Z.e.FLIP_N_ROTATE_ROW?j.concat(E[d%2]):j.concat(E[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(M){const E=[];P=0,Y=0,c=S/n,u=1,E[0]=[P,Y,c,Y,c,u,P,u],E[1]=[P,Y,c,Y,c,u,P,u],H!==Z.e.ROTATE_TILE&&H!==Z.e.ROTATE_ROW||(E[1]=[1-P,1-Y,1-c,1-Y,1-c,1-u,1-P,1-u]),H!==Z.e.FLIP_TILE&&H!==Z.e.FLIP_ROW||(E[1]=[1-P,Y,1-c,Y,1-c,u,1-P,u]),H!==Z.e.FLIP_N_ROTATE_TILE&&H!==Z.e.FLIP_N_ROTATE_ROW||(E[1]=[P,1-Y,c,1-Y,c,1-u,P,1-u]);for(let d=0;d<V;d++)p.push(s-S+Q,d*n-R+L,0),p.push(s+Q,d*n-R+L,0),p.push(s+Q,(d+1)*n-R+L,0),p.push(s-S+Q,(d+1)*n-R+L,0),W.push(U,U+1,U+3,U+1,U+2,U+3),U+=4,j=H===Z.e.FLIP_TILE||H===Z.e.ROTATE_TILE||H===Z.e.FLIP_N_ROTATE_TILE?j.concat(E[(d+t)%2]):H===Z.e.FLIP_ROW||H===Z.e.ROTATE_ROW||H===Z.e.FLIP_N_ROTATE_ROW?j.concat(E[d%2]):j.concat(E[0]),X.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const Y=0===E.sideOrientation?0:E.sideOrientation||g.c.DEFAULTSIDE;g.c._ComputeSides(Y,p,W,f,j,E.frontUVs,E.backUVs);const c=new g.c;c.indices=W,c.jE=p,c.XE=f,c.UE=j;const u=Y===g.c.DOUBLESIDE?X.concat(X):X;return c.WE=u,c}function w(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new Z.e(E,d);H.sideOrientation=Z.e._GetDefaultSideOrientation(H.sideOrientation),n._originalBuilderSideOrientation=H.sideOrientation;return C(H).cE(n,H.updatable),n}function R(E){const H=E.faceUV||new Array(6),d=E.faceColors,I=E.pattern||Z.e.NO_FLIP,r=E.width||E.size||1,t=E.height||E.size||1,S=E.depth||E.size||1,M=E.tileWidth||E.tileSize||1,w=E.tileHeight||E.tileSize||1,R=E.alignHorizontal||0,Q=E.alignVertical||0,L=0===E.sideOrientation?0:E.sideOrientation||g.c.DEFAULTSIDE;for(let Z=0;Z<6;Z++)void 0===H[Z]&&(H[Z]=new n.Vector4(0,0,1,1)),d&&void 0===d[Z]&&(d[Z]=new V.gg(1,1,1,1));const D=r/2,e=t/2,s=S/2,i=[];for(let n=0;n<2;n++)i[n]=C({pattern:I,tileWidth:M,tileHeight:w,width:r,height:t,alignVertical:Q,alignHorizontal:R,sideOrientation:L});for(let n=2;n<4;n++)i[n]=C({pattern:I,tileWidth:M,tileHeight:w,width:S,height:t,alignVertical:Q,alignHorizontal:R,sideOrientation:L});let p=Q;Q===Z.e.BOTTOM?p=Z.e.TOP:Q===Z.e.TOP&&(p=Z.e.BOTTOM);for(let n=4;n<6;n++)i[n]=C({pattern:I,tileWidth:M,tileHeight:w,width:r,height:S,alignVertical:p,alignHorizontal:R,sideOrientation:L});let f=[],P=[],j=[],X=[];const W=[],U=[],Y=[],c=[];let u=0,o=0;for(let Z=0;Z<6;Z++){const E=i[Z].jE.length;U[Z]=[],Y[Z]=[];for(let H=0;H<E/3;H++)U[Z].push(new n.wH(i[Z].jE[3*H],i[Z].jE[3*H+1],i[Z].jE[3*H+2])),Y[Z].push(new n.wH(i[Z].XE[3*H],i[Z].XE[3*H+1],i[Z].XE[3*H+2]));u=i[Z].UE.length,c[Z]=[];for(let d=0;d<u;d+=2)c[Z][d]=H[Z].x+(H[Z].z-H[Z].x)*i[Z].UE[d],c[Z][d+1]=H[Z].y+(H[Z].w-H[Z].y)*i[Z].UE[d+1],l.e&&(c[Z][d+1]=1-c[Z][d+1]);if(j=j.concat(c[Z]),X=X.concat(i[Z].indices.map((E=>E+o))),o+=U[Z].length,d)for(let H=0;H<4;H++)W.push(d[Z].r,d[Z].g,d[Z].b,d[Z].a)}const F=new n.wH(0,0,s),a=n.Matrix.RotationY(Math.PI);f=U[0].map((E=>n.wH.TransformNormal(E,a).add(F))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[]),P=Y[0].map((E=>n.wH.TransformNormal(E,a))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[]),f=f.concat(U[1].map((E=>E.RH(F))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[])),P=P.concat(Y[1].map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[]));const k=new n.wH(D,0,0),O=n.Matrix.RotationY(-Math.PI/2);f=f.concat(U[2].map((E=>n.wH.TransformNormal(E,O).add(k))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[])),P=P.concat(Y[2].map((E=>n.wH.TransformNormal(E,O))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[]));const G=n.Matrix.RotationY(Math.PI/2);f=f.concat(U[3].map((E=>n.wH.TransformNormal(E,G).RH(k))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[])),P=P.concat(Y[3].map((E=>n.wH.TransformNormal(E,G))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[]));const x=new n.wH(0,e,0),q=n.Matrix.RotationX(Math.PI/2);f=f.concat(U[4].map((E=>n.wH.TransformNormal(E,q).add(x))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[])),P=P.concat(Y[4].map((E=>n.wH.TransformNormal(E,q))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[]));const b=n.Matrix.RotationX(-Math.PI/2);f=f.concat(U[5].map((E=>n.wH.TransformNormal(E,b).RH(x))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[])),P=P.concat(Y[5].map((E=>n.wH.TransformNormal(E,b))).map((E=>[E.x,E.y,E.z])).reduce(((E,H)=>E.concat(H)),[])),g.c._ComputeSides(L,f,X,P,j);const h=new g.c;if(h.indices=X,h.jE=f,h.XE=P,h.UE=j,d){const E=L===g.c.DOUBLESIDE?W.concat(W):W;h.WE=E}return h}function Q(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new Z.e(E,d);H.sideOrientation=Z.e._GetDefaultSideOrientation(H.sideOrientation),n._originalBuilderSideOrientation=H.sideOrientation;return R(H).cE(n,H.updatable),n}g.c.CreateTiledPlane=C;g.c.CreateTiledBox=R;var L=d(13775),D=d(12634),e=d(12594);function s(E){const H=E.height||2;let d=0===E.diameterTop?0:E.diameterTop||E.diameter||1,I=0===E.diameterBottom?0:E.diameterBottom||E.diameter||1;d=d||1e-5,I=I||1e-5;const r=0|(E.tessellation||24),t=0|(E.subdivisions||1),S=!!E.hasRings,M=!!E.enclose,C=0===E.cap?0:E.cap||Z.e.CAP_ALL,w=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1,R=0===E.sideOrientation?0:E.sideOrientation||g.c.DEFAULTSIDE,Q=E.faceUV||new Array(3),L=E.faceColors,D=2+(1+(1!==w&&M?2:0))*(S?t:1);let s;for(s=0;s<D;s++)L&&void 0===L[s]&&(L[s]=new V.gg(1,1,1,1));for(s=0;s<D;s++)Q&&void 0===Q[s]&&(Q[s]=new n.Vector4(0,0,1,1));const i=[],p=[],f=[],P=[],j=[],X=2*Math.PI*w/r;let W,U,Y;const c=(I-d)/2/H,u=n.wH.Zero(),o=n.wH.Zero(),F=n.wH.Zero(),a=n.wH.Zero(),k=n.wH.Zero(),O=e.e.Y;let G,x,q,b=1,h=1,y=0,v=0;for(G=0;G<=t;G++)for(U=G/t,Y=(U*(d-I)+I)/2,b=S&&0!==G&&G!==t?2:1,q=0;q<b;q++){for(S&&(h+=q),M&&(h+=2*q),x=0;x<=r;x++)W=x*X,u.x=Math.cos(-W)*Y,u.y=-H/2+U*H,u.z=Math.sin(-W)*Y,0===d&&G===t?(o.x=f[f.length-3*(r+1)],o.y=f[f.length-3*(r+1)+1],o.z=f[f.length-3*(r+1)+2]):(o.x=u.x,o.z=u.z,o.y=Math.sqrt(o.x*o.x+o.z*o.z)*c,o.normalize()),0===x&&(F.l(u),a.l(o)),p.push(u.x,u.y,u.z),f.push(o.x,o.y,o.z),v=S?y!==h?Q[h].y:Q[h].w:Q[h].y+(Q[h].w-Q[h].y)*U,P.push(Q[h].x+(Q[h].z-Q[h].x)*x/r,l.e?1-v:v),L&&j.push(L[h].r,L[h].g,L[h].b,L[h].a);1!==w&&M&&(p.push(u.x,u.y,u.z),p.push(0,u.y,0),p.push(0,u.y,0),p.push(F.x,F.y,F.z),n.wH.CrossToRef(O,o,k),k.normalize(),f.push(k.x,k.y,k.z,k.x,k.y,k.z),n.wH.CrossToRef(a,O,k),k.normalize(),f.push(k.x,k.y,k.z,k.x,k.y,k.z),v=S?y!==h?Q[h+1].y:Q[h+1].w:Q[h+1].y+(Q[h+1].w-Q[h+1].y)*U,P.push(Q[h+1].x,l.e?1-v:v),P.push(Q[h+1].z,l.e?1-v:v),v=S?y!==h?Q[h+2].y:Q[h+2].w:Q[h+2].y+(Q[h+2].w-Q[h+2].y)*U,P.push(Q[h+2].x,l.e?1-v:v),P.push(Q[h+2].z,l.e?1-v:v),L&&(j.push(L[h+1].r,L[h+1].g,L[h+1].b,L[h+1].a),j.push(L[h+1].r,L[h+1].g,L[h+1].b,L[h+1].a),j.push(L[h+2].r,L[h+2].g,L[h+2].b,L[h+2].a),j.push(L[h+2].r,L[h+2].g,L[h+2].b,L[h+2].a))),y!==h&&(y=h)}const z=1!==w&&M?r+4:r;for(G=0,h=0;h<t;h++){let E=0,H=0,d=0,n=0;for(x=0;x<r;x++)E=G*(z+1)+x,H=(G+1)*(z+1)+x,d=G*(z+1)+(x+1),n=(G+1)*(z+1)+(x+1),i.push(E,H,d),i.push(n,d,H);1!==w&&M&&(i.push(E+2,H+2,d+2),i.push(n+2,d+2,H+2),i.push(E+4,H+4,d+4),i.push(n+4,d+4,H+4)),G=S?G+2:G+1}const K=E=>{const Z=E?d/2:I/2;if(0===Z)return;let g,t,S;const M=E?Q[D-1]:Q[0];let V=null;L&&(V=E?L[D-1]:L[0]);const C=p.length/3,R=E?H/2:-H/2,e=new n.wH(0,R,0);p.push(e.x,e.y,e.z),f.push(0,E?1:-1,0);const s=M.y+.5*(M.w-M.y);P.push(M.x+.5*(M.z-M.x),l.e?1-s:s),V&&j.push(V.r,V.g,V.b,V.a);const X=new n.Vector2(.5,.5);for(S=0;S<=r;S++){g=2*Math.PI*S*w/r;const H=Math.cos(-g),d=Math.sin(-g);t=new n.wH(H*Z,R,d*Z);const I=new n.Vector2(H*X.x+.5,d*X.y+.5);p.push(t.x,t.y,t.z),f.push(0,E?1:-1,0);const C=M.y+(M.w-M.y)*I.y;P.push(M.x+(M.z-M.x)*I.x,l.e?1-C:C),V&&j.push(V.r,V.g,V.b,V.a)}for(S=0;S<r;S++)E?(i.push(C),i.push(C+(S+2)),i.push(C+(S+1))):(i.push(C),i.push(C+(S+1)),i.push(C+(S+2)))};C!==Z.e.CAP_START&&C!==Z.e.CAP_ALL||K(!1),C!==Z.e.CAP_END&&C!==Z.e.CAP_ALL||K(!0),g.c._ComputeSides(R,p,i,f,P,E.frontUVs,E.backUVs);const N=new g.c;return N.indices=i,N.jE=p,N.XE=f,N.UE=P,L&&(N.WE=j),N}function i(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const n=new Z.e(E,d);H.sideOrientation=Z.e._GetDefaultSideOrientation(H.sideOrientation),n._originalBuilderSideOrientation=H.sideOrientation;return s(H).cE(n,H.updatable),n}function p(E){const H=[],d=[],Z=[],I=[],r=E.diameter||1,t=E.thickness||.5,S=0|(E.tessellation||16),M=0===E.sideOrientation?0:E.sideOrientation||g.c.DEFAULTSIDE,V=S+1;for(let g=0;g<=S;g++){const E=g/S,M=g*Math.PI*2/S-Math.PI/2,C=n.Matrix.Translation(r/2,0,0).multiply(n.Matrix.RotationY(M));for(let r=0;r<=S;r++){const M=1-r/S,w=r*Math.PI*2/S+Math.PI,R=Math.cos(w),Q=Math.sin(w);let L=new n.wH(R,Q,0),D=L.scale(t/2);const e=new n.Vector2(E,M);D=n.wH.TransformCoordinates(D,C),L=n.wH.TransformNormal(L,C),d.push(D.x,D.y,D.z),Z.push(L.x,L.y,L.z),I.push(e.x,l.e?1-e.y:e.y);const s=(g+1)%V,i=(r+1)%V;H.push(g*V+r),H.push(g*V+i),H.push(s*V+r),H.push(g*V+i),H.push(s*V+i),H.push(s*V+r)}}g.c._ComputeSides(M,d,H,Z,I,E.frontUVs,E.backUVs);const C=new g.c;return C.indices=H,C.jE=d,C.XE=Z,C.UE=I,C}function f(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const n=new Z.e(E,d);H.sideOrientation=Z.e._GetDefaultSideOrientation(H.sideOrientation),n._originalBuilderSideOrientation=H.sideOrientation;return p(H).cE(n,H.updatable),n}g.c.CreateCylinder=s,Z.e.CreateCylinder=(E,H,d,n,I,g,l,r,t)=>{void 0!==l&&l instanceof D.c||(void 0!==l&&(t=r||Z.e.DEFAULTSIDE,r=l),l=g,g=1);return i(E,{height:H,diameterTop:d,diameterBottom:n,tessellation:I,subdivisions:g,sideOrientation:t,updatable:r},l)};function P(E){const H=[],d=[],Z=[],I=[],r=E.radius||2,t=E.tube||.5,S=E.radialSegments||32,M=E.tubularSegments||32,V=E.p||2,C=E.q||3,w=0===E.sideOrientation?0:E.sideOrientation||g.c.DEFAULTSIDE,R=E=>{const H=Math.cos(E),d=Math.sin(E),Z=C/V*E,I=Math.cos(Z),g=r*(2+I)*.5*H,l=r*(2+I)*d*.5,t=r*Math.sin(Z)*.5;return new n.wH(g,l,t)};let Q,L;for(Q=0;Q<=S;Q++){const E=Q%S/S*2*V*Math.PI,H=R(E),Z=R(E+.01),g=Z.RH(H);let r=Z.add(H);const C=n.wH.Cross(g,r);for(r=n.wH.Cross(C,g),C.normalize(),r.normalize(),L=0;L<M;L++){const E=L%M/M*2*Math.PI,n=-t*Math.cos(E),Z=t*Math.sin(E);d.push(H.x+n*r.x+Z*C.x),d.push(H.y+n*r.y+Z*C.y),d.push(H.z+n*r.z+Z*C.z),I.push(Q/S),I.push(l.e?1-L/M:L/M)}}for(Q=0;Q<S;Q++)for(L=0;L<M;L++){const E=(L+1)%M,d=Q*M+L,n=(Q+1)*M+L,Z=(Q+1)*M+E,I=Q*M+E;H.push(I),H.push(n),H.push(d),H.push(I),H.push(Z),H.push(n)}g.c.ComputeNormals(d,H,Z),g.c._ComputeSides(w,d,H,Z,I,E.frontUVs,E.backUVs);const D=new g.c;return D.indices=H,D.jE=d,D.XE=Z,D.UE=I,D}function j(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const n=new Z.e(E,d);H.sideOrientation=Z.e._GetDefaultSideOrientation(H.sideOrientation),n._originalBuilderSideOrientation=H.sideOrientation;return P(H).cE(n,H.updatable),n}g.c.CreateTorus=p,Z.e.CreateTorus=(E,H,d,n,Z,I,g)=>f(E,{diameter:H,thickness:d,tessellation:n,sideOrientation:g,updatable:I},Z);g.c.CreateTorusKnot=P,Z.e.CreateTorusKnot=(E,H,d,n,Z,I,g,l,r,t)=>j(E,{radius:H,tube:d,radialSegments:n,tubularSegments:Z,p:I,q:g,sideOrientation:t,updatable:r},l);var X=d(14275),W=d(12937),U=d(12608);function Y(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=H.path,I=H.shape,g=H.scale||1,l=H.rotation||0,r=0===H.cap?0:H.cap||Z.e.NO_CAP,t=H.updatable,S=Z.e._GetDefaultSideOrientation(H.sideOrientation),M=H.instance||null,V=H.invertUV||!1,C=H.closeShape||!1,w=H.closePath||!1,R=H.capFunction||null;return u(E,I,n,g,l,null,null,w,C,r,!1,d,!!t,S,M,V,H.frontUVs||null,H.backUVs||null,H.firstNormal||null,!!H.adjustFrame,R)}function c(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=H.path,I=H.shape,g=H.scaleFunction||(()=>1),l=H.rotationFunction||(()=>0),r=H.closePath||H.ribbonCloseArray||!1,t=H.closeShape||H.ribbonClosePath||!1,S=0===H.cap?0:H.cap||Z.e.NO_CAP,M=H.updatable,V=H.firstNormal||null,C=H.adjustFrame||!1,w=Z.e._GetDefaultSideOrientation(H.sideOrientation),R=H.instance,Q=H.invertUV||!1,L=H.capFunction||null;return u(E,I,n,null,null,g,l,r,t,S,!0,d,!!M,w,R||null,Q,H.frontUVs||null,H.backUVs||null,V,C,L||null)}function u(E,H,d,I,g,l,r,S,M,V,C,w,R,Q,L,D,e,s,i,p,f){const P=(E,H,d,I,g,l,r,t,S,M,V)=>{const C=d.getTangents(),w=d.getNormals(),R=d.getBinormals(),Q=d.getDistances();if(V)for(let Z=0;Z<C.length;Z++)if(0==C[Z].x&&0==C[Z].y&&0==C[Z].z&&C[Z].l(C[Z-1]),0==w[Z].x&&0==w[Z].y&&0==w[Z].z&&w[Z].l(w[Z-1]),0==R[Z].x&&0==R[Z].y&&0==R[Z].z&&R[Z].l(R[Z-1]),Z>0){let E=C[Z-1];n.wH.Dot(E,C[Z])<0&&C[Z].scaleInPlace(-1),E=w[Z-1],n.wH.Dot(E,w[Z])<0&&w[Z].scaleInPlace(-1),E=R[Z-1],n.wH.Dot(E,R[Z])<0&&R[Z].scaleInPlace(-1)}let L=0;const D=M&&t?t:()=>null!==l?l:0,e=M&&r?r:()=>null!==g?g:1;let s=S===Z.e.NO_CAP||S===Z.e.CAP_END?0:2;const i=n.TmpVectors.Matrix[0];for(let Z=0;Z<H.length;Z++){const d=[],g=D(Z,Q[Z]),l=e(Z,Q[Z]);n.Matrix.RotationAxisToRef(C[Z],L,i);for(let I=0;I<E.length;I++){const g=C[Z].scale(E[I].z).add(w[Z].scale(E[I].x)).add(R[Z].scale(E[I].y)),r=n.wH.Zero();n.wH.TransformCoordinatesToRef(g,i,r),r.scaleInPlace(l).addInPlace(H[Z]),d[I]=r}I[s]=d,L+=g,s++}const p=f||(E=>{const H=Array(),d=n.wH.Zero();let Z;for(Z=0;Z<E.length;Z++)d.addInPlace(E[Z]);for(d.scaleInPlace(1/E.length),Z=0;Z<E.length;Z++)H.push(d);return H});switch(S){case Z.e.NO_CAP:break;case Z.e.CAP_START:I[0]=p(I[2]),I[1]=I[2];break;case Z.e.CAP_END:I[s]=I[s-1],I[s+1]=p(I[s-1]);break;case Z.e.CAP_ALL:I[0]=p(I[2]),I[1]=I[2],I[s]=I[s-1],I[s+1]=p(I[s-1])}return I};let j,X;if(L){const E=L._creationDataStorage;return j=i?E.path3D.update(d,i):E.path3D.update(d),X=P(H,d,E.path3D,E.pathArray,I,g,l,r,E.cap,C,p),L=t("",{pathArray:X,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:L},w||void 0)}j=i?new U.j(d,i):new U.j(d);X=P(H,d,j,new Array,I,g,l,r,V=V<0||V>3?0:V,C,p);const W=t(E,{pathArray:X,closeArray:S,closePath:M,updatable:R,sideOrientation:Q,invertUV:D,frontUVs:e||void 0,backUVs:s||void 0},w);return W._creationDataStorage.pathArray=X,W._creationDataStorage.path3D=j,W._creationDataStorage.cap=V,W}function o(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=H.arc?H.arc<=0||H.arc>1?1:H.arc:1,g=void 0===H.closed||H.closed,l=H.shape,r=H.radius||1,S=H.tessellation||64,M=H.clip||0,V=H.updatable,C=Z.e._GetDefaultSideOrientation(H.sideOrientation),w=H.cap||Z.e.NO_CAP,R=2*Math.PI,Q=[],L=H.invertUV||!1;let D=0,e=0;const s=R/S*I;let i,p;for(D=0;D<=S-M;D++){for(p=[],w!=Z.e.CAP_START&&w!=Z.e.CAP_ALL||(p.push(new n.wH(0,l[0].y,0)),p.push(new n.wH(Math.cos(D*s)*l[0].x*r,l[0].y,Math.sin(D*s)*l[0].x*r))),e=0;e<l.length;e++)i=new n.wH(Math.cos(D*s)*l[e].x*r,l[e].y,Math.sin(D*s)*l[e].x*r),p.push(i);w!=Z.e.CAP_END&&w!=Z.e.CAP_ALL||(p.push(new n.wH(Math.cos(D*s)*l[l.length-1].x*r,l[l.length-1].y,Math.sin(D*s)*l[l.length-1].x*r)),p.push(new n.wH(0,l[l.length-1].y,0))),Q.push(p)}return t(E,{pathArray:Q,closeArray:g,sideOrientation:C,updatable:V,invertUV:L,frontUVs:H.frontUVs,backUVs:H.backUVs},d)}Z.e.ExtrudeShape=function(E,H,d,n,I,g){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0,S=arguments.length>9?arguments[9]:void 0;return Y(E,{shape:H,path:d,scale:n,rotation:I,cap:0===g?0:g||Z.e.NO_CAP,sideOrientation:t,instance:S,updatable:r},l)},Z.e.ExtrudeShapeCustom=(E,H,d,n,I,g,l,r,t,S,M,V)=>c(E,{shape:H,path:d,scaleFunction:n,rotationFunction:I,ribbonCloseArray:g,ribbonClosePath:l,cap:0===r?0:r||Z.e.NO_CAP,sideOrientation:M,instance:V,updatable:S},t);Z.e.CreateLathe=(E,H,d,n,Z,I,g)=>o(E,{shape:H,radius:d,tessellation:n,sideOrientation:g,updatable:I},Z);var F=d(13686),a=d(13642);function k(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=H.path;let g=H.instance,l=1;void 0!==H.radius?l=H.radius:g&&(l=g._creationDataStorage.radius);const r=H.tessellation||64,S=H.radiusFunction||null;let M=H.cap||Z.e.NO_CAP;const V=H.invertUV||!1,C=H.updatable,w=Z.e._GetDefaultSideOrientation(H.sideOrientation);H.arc=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1;const R=(E,H,d,I,g,l,r,t)=>{const S=H.getTangents(),M=H.getNormals(),V=H.getDistances(),C=2*Math.PI/g*t,w=l||(()=>I);let R,Q,L,D;const e=n.TmpVectors.Matrix[0];let s=r===Z.e.NO_CAP||r===Z.e.CAP_END?0:2;for(let Z=0;Z<E.length;Z++){Q=w(Z,V[Z]),R=Array(),L=M[Z];for(let H=0;H<g;H++)n.Matrix.RotationAxisToRef(S[Z],C*H,e),D=R[H]?R[H]:n.wH.Zero(),n.wH.TransformCoordinatesToRef(L,e,D),D.scaleInPlace(Q).addInPlace(E[Z]),R[H]=D;d[s]=R,s++}const i=(H,d)=>{const n=Array();for(let Z=0;Z<H;Z++)n.push(E[d]);return n};switch(r){case Z.e.NO_CAP:break;case Z.e.CAP_START:d[0]=i(g,0),d[1]=d[2].slice(0);break;case Z.e.CAP_END:d[s]=d[s-1].slice(0),d[s+1]=i(g,E.length-1);break;case Z.e.CAP_ALL:d[0]=i(g,0),d[1]=d[2].slice(0),d[s]=d[s-1].slice(0),d[s+1]=i(g,E.length-1)}return d};let Q,L;if(g){const E=g._creationDataStorage,d=H.arc||E.arc;return Q=E.path3D.update(I),L=R(I,Q,E.pathArray,l,E.tessellation,S,E.cap,d),g=t("",{pathArray:L,instance:g}),E.path3D=Q,E.pathArray=L,E.arc=d,E.radius=l,g}Q=new U.j(I);M=M<0||M>3?0:M,L=R(I,Q,new Array,l,r,S,M,H.arc);const D=t(E,{pathArray:L,closePath:!0,closeArray:!1,updatable:C,sideOrientation:w,invertUV:V,frontUVs:H.frontUVs,backUVs:H.backUVs},d);return D._creationDataStorage.pathArray=L,D._creationDataStorage.path3D=Q,D._creationDataStorage.tessellation=r,D._creationDataStorage.cap=M,D._creationDataStorage.arc=H.arc,D._creationDataStorage.radius=l,D}function O(E){const H=[];H[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},H[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},H[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},H[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},H[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},H[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},H[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},H[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},H[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},H[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},H[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},H[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},H[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},H[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},H[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const d=E.type&&(E.type<0||E.type>=H.length)?0:E.type||0,Z=E.size,I=E.sizeX||Z||1,r=E.sizeY||Z||1,t=E.sizeZ||Z||1,S=E.custom||H[d],M=S.face.length,C=E.faceUV||new Array(M),w=E.faceColors,R=void 0===E.flat||E.flat,Q=0===E.sideOrientation?0:E.sideOrientation||g.c.DEFAULTSIDE,L=[],D=[],e=[],s=[],i=[];let p=0,f=0;const P=[];let j,X,W,U,Y,c,u=0,o=0;if(R)for(o=0;o<M;o++)w&&void 0===w[o]&&(w[o]=new V.gg(1,1,1,1)),C&&void 0===C[o]&&(C[o]=new n.Vector4(0,0,1,1));if(R)for(o=0;o<M;o++){const E=S.face[o].length;for(W=2*Math.PI/E,U=.5*Math.tan(W/2),Y=.5,u=0;u<E;u++)L.push(S.vertex[S.face[o][u]][0]*I,S.vertex[S.face[o][u]][1]*r,S.vertex[S.face[o][u]][2]*t),P.push(p),p++,j=C[o].x+(C[o].z-C[o].x)*(.5+U),X=C[o].y+(C[o].w-C[o].y)*(Y-.5),s.push(j,l.e?1-X:X),c=U*Math.cos(W)-Y*Math.sin(W),Y=U*Math.sin(W)+Y*Math.cos(W),U=c,w&&i.push(w[o].r,w[o].g,w[o].b,w[o].a);for(u=0;u<E-2;u++)D.push(P[0+f],P[u+2+f],P[u+1+f]);f+=E}else{for(u=0;u<S.vertex.length;u++)L.push(S.vertex[u][0]*I,S.vertex[u][1]*r,S.vertex[u][2]*t),s.push(0,l.e?1:0);for(o=0;o<M;o++)for(u=0;u<S.face[o].length-2;u++)D.push(S.face[o][0],S.face[o][u+2],S.face[o][u+1])}g.c.ComputeNormals(L,D,e),g.c._ComputeSides(Q,L,D,e,s,E.frontUVs,E.backUVs);const F=new g.c;return F.jE=L,F.indices=D,F.XE=e,F.UE=s,w&&R&&(F.WE=i),F}function G(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new Z.e(E,d);H.sideOrientation=Z.e._GetDefaultSideOrientation(H.sideOrientation),n._originalBuilderSideOrientation=H.sideOrientation;return O(H).cE(n,H.updatable),n}Z.e.CreateTube=(E,H,d,n,Z,I,g,l,r,t)=>k(E,{path:H,radius:d,tessellation:n,radiusFunction:Z,arc:1,cap:I,updatable:l,sideOrientation:r,instance:t},g);function x(E){const H=E.sideOrientation||g.c.DEFAULTSIDE,d=E.radius||1,Z=void 0===E.flat||E.flat,I=0|(E.subdivisions||4),r=E.radiusX||d,t=E.radiusY||d,S=E.radiusZ||d,M=(1+Math.sqrt(5))/2,V=[-1,M,-0,1,M,0,-1,-M,0,1,-M,0,0,-1,-M,0,1,-M,0,-1,M,0,1,M,M,0,1,M,0,-1,-M,0,1,-M,0,-1],C=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],w=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],R=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],Q=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],L=[],D=[],e=[],s=[];let i=0;const p=new Array(3),f=new Array(3);let P;for(P=0;P<3;P++)p[P]=n.wH.Zero(),f[P]=n.Vector2.Zero();for(let g=0;g<20;g++){for(P=0;P<3;P++){const E=C[3*g+P];p[P].en(V[3*w[E]],V[3*w[E]+1],V[3*w[E]+2]),p[P].normalize(),f[P].en(.134765625*R[2*E]+.05859375+-.0390625*Q[g],.2333984375*R[2*E+1]+.025390625+.01953125*Q[g])}const E=(E,H,d,g)=>{const M=n.wH.Lerp(p[0],p[2],H/I),V=n.wH.Lerp(p[1],p[2],H/I),C=I===H?p[2]:n.wH.Lerp(M,V,E/(I-H));let w;if(C.normalize(),Z){const E=n.wH.Lerp(p[0],p[2],g/I),H=n.wH.Lerp(p[1],p[2],g/I);w=n.wH.Lerp(E,H,d/(I-g))}else w=new n.wH(C.x,C.y,C.z);w.x/=r,w.y/=t,w.z/=S,w.normalize();const R=n.Vector2.Lerp(f[0],f[2],H/I),Q=n.Vector2.Lerp(f[1],f[2],H/I),P=I===H?f[2]:n.Vector2.Lerp(R,Q,E/(I-H));D.push(C.x*r,C.y*t,C.z*S),e.push(w.x,w.y,w.z),s.push(P.x,l.e?1-P.y:P.y),L.push(i),i++};for(let H=0;H<I;H++)for(let d=0;d+H<I;d++)E(d,H,d+1/3,H+1/3),E(d+1,H,d+1/3,H+1/3),E(d,H+1,d+1/3,H+1/3),d+H+1<I&&(E(d+1,H,d+2/3,H+2/3),E(d+1,H+1,d+2/3,H+2/3),E(d,H+1,d+2/3,H+2/3))}g.c._ComputeSides(H,D,L,e,s,E.frontUVs,E.backUVs);const j=new g.c;return j.indices=L,j.jE=D,j.XE=e,j.UE=s,j}function q(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new Z.e(E,d);H.sideOrientation=Z.e._GetDefaultSideOrientation(H.sideOrientation),n._originalBuilderSideOrientation=H.sideOrientation;return x(H).cE(n,H.updatable),n}g.c.CreatePolyhedron=O,Z.e.CreatePolyhedron=(E,H,d)=>G(E,H,d);g.c.CreateIcoSphere=x,Z.e.CreateIcoSphere=(E,H,d)=>q(E,H,d);var b=d(12406);const h=new n.wH(1,0,0),y=new n.wH(-1,0,0),v=new n.wH(0,1,0),z=new n.wH(0,-1,0),K=new n.wH(0,0,1),N=new n.wH(0,0,-1);class mE{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.wH.Zero(),H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.wH.Up(),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.Vector2.Zero(),Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=E,this.normal=H,this.uv=d,this.vertexIdx=Z,this.vertexIdxForBones=I,this.localPositionOverride=g,this.localNormalOverride=l,this.matrixIndicesOverride=r,this.matrixWeightsOverride=t}clone(){var E,H,d,n;return new mE(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(E=this.localPositionOverride)||void 0===E?void 0:E.slice(),null===(H=this.localNormalOverride)||void 0===H?void 0:H.slice(),null===(d=this.matrixIndicesOverride)||void 0===d?void 0:d.slice(),null===(n=this.matrixWeightsOverride)||void 0===n?void 0:n.slice())}}function T(E,H,d){var r,t,S,M,V;const C=!!H.skeleton,w=!(null===(r=H.morphTargetManager)||void 0===r||!r.numTargets),R=d.localMode||C,Q=H.Nd(),L=C||w?H.yl(!0,!0):H.getVerticesData(I.g.PositionKind),D=C||w?H.getNormalsData(!0,!0):H.getVerticesData(I.g.NormalKind),e=R?C?H.getVerticesData(I.g.PositionKind):L:null,s=R?C?H.getVerticesData(I.g.NormalKind):D:null,i=H.getVerticesData(I.g.UVKind),p=C?H.getVerticesData(I.g.MatricesIndicesKind):null,f=C?H.getVerticesData(I.g.MatricesWeightsKind):null,P=C?H.getVerticesData(I.g.MatricesIndicesExtraKind):null,j=C?H.getVerticesData(I.g.MatricesWeightsExtraKind):null,X=d.position||n.wH.Zero();let W=d.normal||n.wH.Up();const U=d.size||n.wH.One(),Y=d.angle||0;if(!W){const E=new n.wH(0,0,1),d=H.fE().activeCamera,Z=n.wH.TransformCoordinates(E,d.getWorldMatrix());W=d.globalPosition.RH(Z)}const c=-Math.atan2(W.z,W.x)-Math.PI/2,u=Math.sqrt(W.x*W.x+W.z*W.z),o=Math.atan2(W.y,u),F=new g.c;F.indices=[],F.jE=[],F.XE=[],F.UE=[],F.matricesIndices=C?[]:null,F.matricesWeights=C?[]:null,F.matricesIndicesExtra=P?[]:null,F.matricesWeightsExtra=j?[]:null;let a=0;const k=(E,H)=>{const Z=new mE;if(!Q||!L||!D)return Z;const I=Q[E];if(Z.vertexIdx=3*I,Z.vertexIdxForBones=4*I,Z.position=new n.wH(L[3*I],L[3*I+1],L[3*I+2]),n.wH.TransformCoordinatesToRef(Z.position,H,Z.position),Z.normal=new n.wH(D[3*I],D[3*I+1],D[3*I+2]),n.wH.TransformNormalToRef(Z.normal,H,Z.normal),d.captureUVS&&i){const E=i[2*I+1];Z.uv=new n.Vector2(i[2*I],l.e?1-E:E)}return Z},O=[0,0,0,0],G=(E,H)=>{if(0===E.length)return E;const d=.5*Math.abs(n.wH.Dot(U,H)),Z=(E,H,d,n)=>{for(let Z=0;Z<n;++Z)if(E[d+Z]===H)return d+Z;return-1},I=(E,I)=>{const g=n.wH.GetClipFactor(E.position,I.position,H,d);let l=O,r=O;if(p&&f){const H=E.matrixIndicesOverride?0:E.vertexIdxForBones,d=E.matrixIndicesOverride??p,n=E.matrixWeightsOverride??f,t=I.matrixIndicesOverride?0:I.vertexIdxForBones,S=I.matrixIndicesOverride??p,M=I.matrixWeightsOverride??f;l=[0,0,0,0],r=[0,0,0,0];let V=0;for(let E=0;E<4;++E)if(n[H+E]>0){const I=Z(S,d[H+E],t,4);l[V]=d[H+E],r[V]=(0,b.Lerp)(n[H+E],I>=0?M[I]:0,g),V++}for(let E=0;E<4&&V<4;++E){const n=S[t+E];-1===Z(d,n,H,4)&&(l[V]=n,r[V]=(0,b.Lerp)(0,M[t+E],g),V++)}const C=r[0]+r[1]+r[2]+r[3];r[0]/=C,r[1]/=C,r[2]/=C,r[3]/=C}const t=E.localPositionOverride?E.localPositionOverride[0]:(null===e||void 0===e?void 0:e[E.vertexIdx])??0,S=E.localPositionOverride?E.localPositionOverride[1]:(null===e||void 0===e?void 0:e[E.vertexIdx+1])??0,M=E.localPositionOverride?E.localPositionOverride[2]:(null===e||void 0===e?void 0:e[E.vertexIdx+2])??0,V=I.localPositionOverride?I.localPositionOverride[0]:(null===e||void 0===e?void 0:e[I.vertexIdx])??0,C=I.localPositionOverride?I.localPositionOverride[1]:(null===e||void 0===e?void 0:e[I.vertexIdx+1])??0,w=I.localPositionOverride?I.localPositionOverride[2]:(null===e||void 0===e?void 0:e[I.vertexIdx+2])??0,R=E.localNormalOverride?E.localNormalOverride[0]:(null===s||void 0===s?void 0:s[E.vertexIdx])??0,Q=E.localNormalOverride?E.localNormalOverride[1]:(null===s||void 0===s?void 0:s[E.vertexIdx+1])??0,L=E.localNormalOverride?E.localNormalOverride[2]:(null===s||void 0===s?void 0:s[E.vertexIdx+2])??0,D=R+((I.localNormalOverride?I.localNormalOverride[0]:(null===s||void 0===s?void 0:s[I.vertexIdx])??0)-R)*g,i=Q+((I.localNormalOverride?I.localNormalOverride[1]:(null===s||void 0===s?void 0:s[I.vertexIdx+1])??0)-Q)*g,P=L+((I.localNormalOverride?I.localNormalOverride[2]:(null===s||void 0===s?void 0:s[I.vertexIdx+2])??0)-L)*g,j=Math.sqrt(D*D+i*i+P*P);return new mE(n.wH.Lerp(E.position,I.position,g),n.wH.Lerp(E.normal,I.normal,g).normalize(),n.Vector2.Lerp(E.uv,I.uv,g),-1,-1,e?[t+(V-t)*g,S+(C-S)*g,M+(w-M)*g]:null,s?[D/j,i/j,P/j]:null,l,r)};let g=null;E.length>3&&(g=[]);for(let l=0;l<E.length;l+=3){let Z=0,r=null,t=null,S=null,M=null;const V=n.wH.Dot(E[l].position,H)-d>0,C=n.wH.Dot(E[l+1].position,H)-d>0,w=n.wH.Dot(E[l+2].position,H)-d>0;switch(Z=(V?1:0)+(C?1:0)+(w?1:0),Z){case 0:E.length>3?(g.push(E[l]),g.push(E[l+1]),g.push(E[l+2])):g=E;break;case 1:if(g=g??new Array,V&&(r=E[l+1],t=E[l+2],S=I(E[l],r),M=I(E[l],t)),C){r=E[l],t=E[l+2],S=I(E[l+1],r),M=I(E[l+1],t),g.push(S),g.push(t.clone()),g.push(r.clone()),g.push(t.clone()),g.push(S.clone()),g.push(M);break}w&&(r=E[l],t=E[l+1],S=I(E[l+2],r),M=I(E[l+2],t)),r&&t&&S&&M&&(g.push(r.clone()),g.push(t.clone()),g.push(S),g.push(M),g.push(S.clone()),g.push(t.clone()));break;case 2:g=g??new Array,V||(r=E[l].clone(),t=I(r,E[l+1]),S=I(r,E[l+2]),g.push(r),g.push(t),g.push(S)),C||(r=E[l+1].clone(),t=I(r,E[l+2]),S=I(r,E[l]),g.push(r),g.push(t),g.push(S)),w||(r=E[l+2].clone(),t=I(r,E[l]),S=I(r,E[l+1]),g.push(r),g.push(t),g.push(S))}}return g},x=H instanceof Z.e?H:null,q=null===x||void 0===x?void 0:x._thinInstanceDataStorage.matrixData,T=(null===x||void 0===x?void 0:x.Rg)||1,A=n.TmpVectors.Matrix[0];A.l(n.Matrix.IdentityReadOnly);for(let Z=0;Z<T;++Z){if(null!==x&&void 0!==x&&x.hasThinInstances&&q){const E=16*Z;A.setRowFromFloats(0,q[E+0],q[E+1],q[E+2],q[E+3]),A.setRowFromFloats(1,q[E+4],q[E+5],q[E+6],q[E+7]),A.setRowFromFloats(2,q[E+8],q[E+9],q[E+10],q[E+11]),A.setRowFromFloats(3,q[E+12],q[E+13],q[E+14],q[E+15])}const E=n.Matrix.RotationYawPitchRoll(c,o,Y).multiply(n.Matrix.Translation(X.x,X.y,X.z)),I=n.Matrix.Invert(E),g=H.getWorldMatrix(),r=A.multiply(g).multiply(I),t=new Array(3);for(let H=0;H<Q.length;H+=3){let E=t;if(E[0]=k(H,r),E[1]=k(H+1,r),E[2]=k(H+2,r),!(d.cullBackFaces&&-E[0].normal.z<=0&&-E[1].normal.z<=0&&-E[2].normal.z<=0)&&(E=G(E,h),E&&(E=G(E,y),E&&(E=G(E,v),E&&(E=G(E,z),E&&(E=G(E,K),E&&(E=G(E,N),E)))))))for(let H=0;H<E.length;H++){const n=E[H];if(F.indices.push(a),R?(n.localPositionOverride?(F.jE[3*a]=n.localPositionOverride[0],F.jE[3*a+1]=n.localPositionOverride[1],F.jE[3*a+2]=n.localPositionOverride[2]):e&&(F.jE[3*a]=e[n.vertexIdx],F.jE[3*a+1]=e[n.vertexIdx+1],F.jE[3*a+2]=e[n.vertexIdx+2]),n.localNormalOverride?(F.XE[3*a]=n.localNormalOverride[0],F.XE[3*a+1]=n.localNormalOverride[1],F.XE[3*a+2]=n.localNormalOverride[2]):s&&(F.XE[3*a]=s[n.vertexIdx],F.XE[3*a+1]=s[n.vertexIdx+1],F.XE[3*a+2]=s[n.vertexIdx+2])):(n.position.toArray(F.jE,3*a),n.normal.toArray(F.XE,3*a)),F.matricesIndices&&F.matricesWeights&&(n.matrixIndicesOverride?(F.matricesIndices[4*a]=n.matrixIndicesOverride[0],F.matricesIndices[4*a+1]=n.matrixIndicesOverride[1],F.matricesIndices[4*a+2]=n.matrixIndicesOverride[2],F.matricesIndices[4*a+3]=n.matrixIndicesOverride[3]):(p&&(F.matricesIndices[4*a]=p[n.vertexIdxForBones],F.matricesIndices[4*a+1]=p[n.vertexIdxForBones+1],F.matricesIndices[4*a+2]=p[n.vertexIdxForBones+2],F.matricesIndices[4*a+3]=p[n.vertexIdxForBones+3]),P&&F.matricesIndicesExtra&&(F.matricesIndicesExtra[4*a]=P[n.vertexIdxForBones],F.matricesIndicesExtra[4*a+1]=P[n.vertexIdxForBones+1],F.matricesIndicesExtra[4*a+2]=P[n.vertexIdxForBones+2],F.matricesIndicesExtra[4*a+3]=P[n.vertexIdxForBones+3])),n.matrixWeightsOverride?(F.matricesWeights[4*a]=n.matrixWeightsOverride[0],F.matricesWeights[4*a+1]=n.matrixWeightsOverride[1],F.matricesWeights[4*a+2]=n.matrixWeightsOverride[2],F.matricesWeights[4*a+3]=n.matrixWeightsOverride[3]):(f&&(F.matricesWeights[4*a]=f[n.vertexIdxForBones],F.matricesWeights[4*a+1]=f[n.vertexIdxForBones+1],F.matricesWeights[4*a+2]=f[n.vertexIdxForBones+2],F.matricesWeights[4*a+3]=f[n.vertexIdxForBones+3]),j&&F.matricesWeightsExtra&&(F.matricesWeightsExtra[4*a]=j[n.vertexIdxForBones],F.matricesWeightsExtra[4*a+1]=j[n.vertexIdxForBones+1],F.matricesWeightsExtra[4*a+2]=j[n.vertexIdxForBones+2],F.matricesWeightsExtra[4*a+3]=j[n.vertexIdxForBones+3]))),d.captureUVS)n.uv.toArray(F.UE,2*a);else{F.UE.push(.5+n.position.x/U.x);const E=.5+n.position.y/U.y;F.UE.push(l.e?1-E:E)}a++}}}0===F.indices.length&&(F.indices=null),0===F.jE.length&&(F.jE=null),0===F.XE.length&&(F.XE=null),0===F.UE.length&&(F.UE=null),0===(null===(t=F.matricesIndices)||void 0===t?void 0:t.length)&&(F.matricesIndices=null),0===(null===(S=F.matricesWeights)||void 0===S?void 0:S.length)&&(F.matricesWeights=null),0===(null===(M=F.matricesIndicesExtra)||void 0===M?void 0:M.length)&&(F.matricesIndicesExtra=null),0===(null===(V=F.matricesWeightsExtra)||void 0===V?void 0:V.length)&&(F.matricesWeightsExtra=null);const B=new Z.e(E,H.fE());return F.cE(B),R?(B.skeleton=H.skeleton,B.parent=H):(B.position=X.clone(),B.rotation=new n.wH(o,c,Y)),B.yd(!0),B.refreshBoundingInfo(!0,!0),B}function A(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const H=0|Math.max(E.subdivisions?E.subdivisions:2,1),d=0|Math.max(E.tessellation?E.tessellation:16,3),Z=Math.max(E.height?E.height:1,0),I=Math.max(E.radius?E.radius:.25,0),r=0|Math.max(E.capSubdivisions?E.capSubdivisions:6,1),t=d,S=H,M=Math.max(E.radiusTop?E.radiusTop:I,0),V=Math.max(E.radiusBottom?E.radiusBottom:I,0),C=Z-(M+V),w=2*Math.PI,R=Math.max(E.topCapSubdivisions?E.topCapSubdivisions:r,1),Q=Math.max(E.bottomCapSubdivisions?E.bottomCapSubdivisions:r,1),L=Math.acos((V-M)/Z);let D=[];const e=[],s=[],i=[];let p=0;const f=[],P=.5*C,j=.5*Math.PI;let X,W;const U=n.wH.Zero(),Y=n.wH.Zero(),c=Math.cos(L),u=Math.sin(L),o=new n.Vector2(M*u,P+M*c).RH(new n.Vector2(V*u,V*c-P)).length(),F=M*L+o+V*(j-L);let a=0;for(W=0;W<=R;W++){const E=[],H=j-L*(W/R);a+=M*L/R;const d=Math.cos(H),n=Math.sin(H),Z=d*M;for(X=0;X<=t;X++){const H=X/t,I=H*w+0,g=Math.sin(I),r=Math.cos(I);Y.x=Z*g,Y.y=P+n*M,Y.z=Z*r,e.push(Y.x,Y.y,Y.z),U.set(d*g,n,d*r),s.push(U.x,U.y,U.z),i.push(H,l.e?a/F:1-a/F),E.push(p),p++}f.push(E)}const k=Z-M-V+c*M-c*V,O=u*(V-M)/k;for(W=1;W<=S;W++){const E=[];a+=o/S;const H=u*(W*(V-M)/S+M);for(X=0;X<=t;X++){const d=X/t,n=d*w+0,Z=Math.sin(n),I=Math.cos(n);Y.x=H*Z,Y.y=P+c*M-W*k/S,Y.z=H*I,e.push(Y.x,Y.y,Y.z),U.set(Z,O,I).normalize(),s.push(U.x,U.y,U.z),i.push(d,l.e?a/F:1-a/F),E.push(p),p++}f.push(E)}for(W=1;W<=Q;W++){const E=[],H=j-L-(Math.PI-L)*(W/Q);a+=V*L/Q;const d=Math.cos(H),n=Math.sin(H),Z=d*V;for(X=0;X<=t;X++){const H=X/t,I=H*w+0,g=Math.sin(I),r=Math.cos(I);Y.x=Z*g,Y.y=n*V-P,Y.z=Z*r,e.push(Y.x,Y.y,Y.z),U.set(d*g,n,d*r),s.push(U.x,U.y,U.z),i.push(H,l.e?a/F:1-a/F),E.push(p),p++}f.push(E)}for(X=0;X<t;X++)for(W=0;W<R+S+Q;W++){const E=f[W][X],H=f[W+1][X],d=f[W+1][X+1],n=f[W][X+1];D.push(E),D.push(H),D.push(n),D.push(H),D.push(d),D.push(n)}if(D=D.reverse(),E.orientation&&!E.orientation.equals(n.wH.Up())){const H=new n.Matrix;E.orientation.clone().scale(.5*Math.PI).cross(n.wH.Up()).toQuaternion().toRotationMatrix(H);const d=n.wH.Zero();for(let E=0;E<e.length;E+=3)d.set(e[E],e[E+1],e[E+2]),n.wH.TransformCoordinatesToRef(d.clone(),H,d),e[E]=d.x,e[E+1]=d.y,e[E+2]=d.z}const G=new g.c;return G.jE=e,G.XE=s,G.UE=i,G.indices=D,G}function B(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:n.wH.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=new Z.e(E,d);return A(H).cE(I,H.updatable),I}Z.e.CreateDecal=(E,H,d,n,Z,I)=>T(E,H,{position:d,normal:n,size:Z,angle:I});Z.e.CreateCapsule=(E,H,d)=>B(E,H,d),g.c.CreateCapsule=A;var J=d(12237),EE=d(12391);class HE{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=E,this.y=H,E!==Math.floor(E)&&(E=Math.floor(E),J.b.Warn("x is not an integer, floor(x) used")),H!==Math.floor(H)&&(H=Math.floor(H),J.b.Warn("y is not an integer, floor(y) used"))}clone(){return new HE(this.x,this.y)}rotate60About(E){const H=this.x;return this.x=E.x+E.y-this.y,this.y=H+this.y-E.x,this}rotateNeg60About(E){const H=this.x;return this.x=H+this.y-E.y,this.y=E.x+E.y-H,this}rotate120(E,H){E!==Math.floor(E)&&(E=Math.floor(E),J.b.Warn("m not an integer only floor(m) used")),H!==Math.floor(H)&&(H=Math.floor(H),J.b.Warn("n not an integer only floor(n) used"));const d=this.x;return this.x=E-d-this.y,this.y=H+d,this}rotateNeg120(E,H){E!==Math.floor(E)&&(E=Math.floor(E),J.b.Warn("m is not an integer, floor(m) used")),H!==Math.floor(H)&&(H=Math.floor(H),J.b.Warn("n is not an integer,   floor(n) used"));const d=this.x;return this.x=this.y-H,this.y=E+H-d-this.y,this}toCartesianOrigin(E,H){const d=n.wH.Zero();return d.x=E.x+2*this.x*H+this.y*H,d.y=E.y+Math.sqrt(3)*this.y*H,d}static Zero(){return new HE(0,0)}}class dE{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new nE("icosahedron","Regular",[[0,EE.f,-1],[-EE.f,1,0],[-1,0,-EE.f],[1,0,-EE.f],[EE.f,1,0],[0,EE.f,1],[-1,0,EE.f],[-EE.f,-1,0],[0,-EE.f,-1],[EE.f,-1,0],[1,0,EE.f],[0,-EE.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let E=12;const H={},d=this.m,n=this.n;let Z,I,g,l,r,t=d,S=1,M=0;0!==n&&(t=(0,b.HighestCommonFactor)(d,n)),S=d/t,M=n/t;const V=HE.Zero(),C=new HE(d,n),w=new HE(-n,d+n),R=HE.Zero(),Q=HE.Zero(),L=HE.Zero();let D,e,s,i,p=[];const f=[],P=this.vertByDist,j=(d,n,Z,I)=>{D=d+"|"+Z,e=n+"|"+I,D in H||e in H?D in H&&!(e in H)?H[e]=H[D]:e in H&&!(D in H)&&(H[D]=H[e]):(H[D]=E,H[e]=E,E++),P[Z][0]>2?f[H[D]]=[-P[Z][0],P[Z][1],H[D]]:f[H[D]]=[p[P[Z][0]],P[Z][1],H[D]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let X=0;X<20;X++){if(p=this.IDATA.face[X],g=p[2],l=p[1],r=p[0],s=V.x+"|"+V.y,D=X+"|"+s,D in H||(H[D]=g,f[g]=[p[P[s][0]],P[s][1]]),s=C.x+"|"+C.y,D=X+"|"+s,D in H||(H[D]=l,f[l]=[p[P[s][0]],P[s][1]]),s=w.x+"|"+w.y,D=X+"|"+s,D in H||(H[D]=r,f[r]=[p[P[s][0]],P[s][1]]),Z=this.IDATA.edgematch[X][0],I=this.IDATA.edgematch[X][1],"B"===I)for(let E=1;E<t;E++)Q.x=d-E*(S+M),Q.y=n+E*S,L.x=-E*M,L.y=E*(S+M),s=Q.x+"|"+Q.y,i=L.x+"|"+L.y,j(X,Z,s,i);if("O"===I)for(let E=1;E<t;E++)L.x=-E*M,L.y=E*(S+M),R.x=E*S,R.y=E*M,s=L.x+"|"+L.y,i=R.x+"|"+R.y,j(X,Z,s,i);if(Z=this.IDATA.edgematch[X][2],I=this.IDATA.edgematch[X][3],I&&"A"===I)for(let E=1;E<t;E++)R.x=E*S,R.y=E*M,Q.x=d-(t-E)*(S+M),Q.y=n+(t-E)*S,s=R.x+"|"+R.y,i=Q.x+"|"+Q.y,j(X,Z,s,i);for(let d=0;d<this.vertices.length;d++)s=this.vertices[d].x+"|"+this.vertices[d].y,D=X+"|"+s,D in H||(H[D]=E++,P[s][0]>2?f[H[D]]=[-P[s][0],P[s][1],H[D]]:f[H[D]]=[p[P[s][0]],P[s][1],H[D]])}this.closestTo=f,this.vecToidx=H}calcCoeffs(){const E=this.m,H=this.n,d=Math.sqrt(3)/3,n=E*E+H*H+E*H;this.coau=(E+H)/n,this.cobu=-H/n,this.coav=-d*(E-H)/n,this.cobv=d*(2*E+H)/n}createInnerFacets(){const E=this.m,H=this.n;for(let d=0;d<H+E+1;d++)for(let E=this.min[d];E<this.max[d]+1;E++)E<this.max[d]&&E<this.max[d+1]+1&&this.innerFacets.push(["|"+E+"|"+d,"|"+E+"|"+(d+1),"|"+(E+1)+"|"+d]),d>0&&E<this.max[d-1]&&E+1<this.max[d]+1&&this.innerFacets.push(["|"+E+"|"+d,"|"+(E+1)+"|"+d,"|"+(E+1)+"|"+(d-1)])}edgeVecsABOB(){const E=this.m,H=this.n,d=new HE(-H,E+H);for(let n=1;n<E+H;n++){const E=new HE(this.min[n],n),H=new HE(this.min[n-1],n-1),Z=new HE(this.min[n+1],n+1),I=E.clone(),g=H.clone(),l=Z.clone();I.rotate60About(d),g.rotate60About(d),l.rotate60About(d);const r=new HE(this.max[I.y],I.y),t=new HE(this.max[I.y-1],I.y-1),S=new HE(this.max[I.y-1]-1,I.y-1);I.x===r.x&&I.y===r.y||(I.x!==t.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,t,S]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,S,r])):I.y===l.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([E,H,t]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([E,t,Z])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([E,H,t]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([E,t,r])))}}mapABOBtoOBOA(){const E=new HE(0,0);for(let H=0;H<this.isoVecsABOB.length;H++){const d=[];for(let n=0;n<3;n++)E.x=this.isoVecsABOB[H][n].x,E.y=this.isoVecsABOB[H][n].y,0===this.vertexTypes[H][n]&&E.rotateNeg120(this.m,this.n),d.push(E.clone());this.isoVecsOBOA.push(d)}}mapABOBtoBAOA(){const E=new HE(0,0);for(let H=0;H<this.isoVecsABOB.length;H++){const d=[];for(let n=0;n<3;n++)E.x=this.isoVecsABOB[H][n].x,E.y=this.isoVecsABOB[H][n].y,1===this.vertexTypes[H][n]&&E.rotate120(this.m,this.n),d.push(E.clone());this.isoVecsBAOA.push(d)}}MapToFace(E,H){const d=this.IDATA.face[E],Z=d[2],I=d[1],g=d[0],l=n.wH.eH(this.IDATA.vertex[Z]),r=n.wH.eH(this.IDATA.vertex[I]),t=n.wH.eH(this.IDATA.vertex[g]),S=r.RH(l),M=t.RH(l),V=S.scale(this.coau).add(M.scale(this.cobu)),C=S.scale(this.coav).add(M.scale(this.cobv)),w=[];let R,Q=n.TmpVectors.wH[0];for(let n=0;n<this.cartesian.length;n++)Q=V.scale(this.cartesian[n].x).add(C.scale(this.cartesian[n].y)).add(l),w[n]=[Q.x,Q.y,Q.z],R=E+"|"+this.vertices[n].x+"|"+this.vertices[n].y,H.vertex[this.vecToidx[R]]=[Q.x,Q.y,Q.z]}build(E,H){const d=[],n=HE.Zero(),Z=new HE(E,H),I=new HE(-H,E+H);d.push(n,Z,I);for(let s=H;s<E+1;s++)for(let H=0;H<E+1-s;H++)d.push(new HE(H,s));if(H>0){const n=(0,b.HighestCommonFactor)(E,H),Z=E/n,I=H/n;for(let l=1;l<n;l++)d.push(new HE(l*Z,l*I)),d.push(new HE(-l*I,l*(Z+I))),d.push(new HE(E-l*(Z+I),H+l*Z));const g=E/H;for(let l=1;l<H;l++)for(let n=0;n<l*g;n++)d.push(new HE(n,l)),d.push(new HE(n,l).rotate120(E,H)),d.push(new HE(n,l).rotateNeg120(E,H))}d.sort(((E,H)=>E.x-H.x)),d.sort(((E,H)=>E.y-H.y));const g=new Array(E+H+1),l=new Array(E+H+1);for(let s=0;s<g.length;s++)g[s]=1/0,l[s]=-1/0;let r=0,t=0;const S=d.length;for(let s=0;s<S;s++)t=d[s].x,r=d[s].y,g[r]=Math.min(t,g[r]),l[r]=Math.max(t,l[r]);const M=(d,n)=>{const Z=d.clone();return"A"===n&&Z.rotateNeg120(E,H),"B"===n&&Z.rotate120(E,H),Z.x<0?Z.y:Z.x+Z.y},V=[],C=[],w=[],R=[],Q={},L=[];let D=-1,e=-1;for(let s=0;s<S;s++)V[s]=d[s].toCartesianOrigin(new HE(0,0),.5),C[s]=M(d[s],"O"),w[s]=M(d[s],"A"),R[s]=M(d[s],"B"),C[s]===w[s]&&w[s]===R[s]?(D=3,e=C[s]):C[s]===w[s]?(D=4,e=C[s]):w[s]===R[s]?(D=5,e=w[s]):R[s]===C[s]&&(D=6,e=C[s]),C[s]<w[s]&&C[s]<R[s]&&(D=2,e=C[s]),w[s]<C[s]&&w[s]<R[s]&&(D=1,e=w[s]),R[s]<w[s]&&R[s]<C[s]&&(D=0,e=R[s]),L.push([D,e,d[s].x,d[s].y]);L.sort(((E,H)=>E[2]-H[2])),L.sort(((E,H)=>E[3]-H[3])),L.sort(((E,H)=>E[1]-H[1])),L.sort(((E,H)=>E[0]-H[0]));for(let s=0;s<L.length;s++)Q[L[s][2]+"|"+L[s][3]]=[L[s][0],L[s][1],s];return this.m=E,this.n=H,this.vertices=d,this.vertByDist=Q,this.cartesian=V,this.min=g,this.max=l,this}}class nE{constructor(E,H,d,n){this.name=E,this.category=H,this.vertex=d,this.face=n}}class ZE extends nE{innerToData(E,H){for(let d=0;d<H.innerFacets.length;d++)this.face.push(H.innerFacets[d].map((d=>H.vecToidx[E+d])))}mapABOBtoDATA(E,H){const d=H.IDATA.edgematch[E][0];for(let n=0;n<H.isoVecsABOB.length;n++){const Z=[];for(let I=0;I<3;I++)0===H.vertexTypes[n][I]?Z.push(E+"|"+H.isoVecsABOB[n][I].x+"|"+H.isoVecsABOB[n][I].y):Z.push(d+"|"+H.isoVecsABOB[n][I].x+"|"+H.isoVecsABOB[n][I].y);this.face.push([H.vecToidx[Z[0]],H.vecToidx[Z[1]],H.vecToidx[Z[2]]])}}mapOBOAtoDATA(E,H){const d=H.IDATA.edgematch[E][0];for(let n=0;n<H.isoVecsOBOA.length;n++){const Z=[];for(let I=0;I<3;I++)1===H.vertexTypes[n][I]?Z.push(E+"|"+H.isoVecsOBOA[n][I].x+"|"+H.isoVecsOBOA[n][I].y):Z.push(d+"|"+H.isoVecsOBOA[n][I].x+"|"+H.isoVecsOBOA[n][I].y);this.face.push([H.vecToidx[Z[0]],H.vecToidx[Z[1]],H.vecToidx[Z[2]]])}}mapBAOAtoDATA(E,H){const d=H.IDATA.edgematch[E][2];for(let n=0;n<H.isoVecsBAOA.length;n++){const Z=[];for(let I=0;I<3;I++)1===H.vertexTypes[n][I]?Z.push(E+"|"+H.isoVecsBAOA[n][I].x+"|"+H.isoVecsBAOA[n][I].y):Z.push(d+"|"+H.isoVecsBAOA[n][I].x+"|"+H.isoVecsBAOA[n][I].y);this.face.push([H.vecToidx[Z[0]],H.vecToidx[Z[1]],H.vecToidx[Z[2]]])}}orderData(E){const H=[];for(let I=0;I<13;I++)H[I]=[];const d=E.closestTo;for(let I=0;I<d.length;I++)d[I][0]>-1?d[I][1]>0&&H[d[I][0]].push([I,d[I][1]]):H[12].push([I,d[I][0]]);const n=[];for(let I=0;I<12;I++)n[I]=I;let Z=12;for(let I=0;I<12;I++){H[I].sort(((E,H)=>E[1]-H[1]));for(let E=0;E<H[I].length;E++)n[H[I][E][0]]=Z++}for(let I=0;I<H[12].length;I++)n[H[12][I][0]]=Z++;for(let I=0;I<this.vertex.length;I++)this.vertex[I].push(n[I]);this.vertex.sort(((E,H)=>E[3]-H[3]));for(let I=0;I<this.vertex.length;I++)this.vertex[I].pop();for(let I=0;I<this.face.length;I++)for(let E=0;E<this.face[I].length;E++)this.face[I][E]=n[this.face[I][E]];this.sharedNodes=H[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(E,H){const d=[],n=[];let Z=H.pop();n.push(Z);let I=this.face[Z].indexOf(E);I=(I+2)%3;let g=this.face[Z][I];d.push(g);let l=0;for(;H.length>0;)Z=H[l],this.face[Z].indexOf(g)>-1?(I=(this.face[Z].indexOf(g)+1)%3,g=this.face[Z][I],d.push(g),n.push(Z),H.splice(l,1),l=0):l++;return this.adjacentFaces.push(d),n}toGoldbergPolyhedronData(){const E=new nE("GeoDual","Goldberg",[],[]);E.name="GD dual";const H=this.vertex.length,d=new Array(H);for(let r=0;r<H;r++)d[r]=[];for(let r=0;r<this.face.length;r++)for(let E=0;E<3;E++)d[this.face[r][E]].push(r);let n=0,Z=0,I=0,g=[],l=[];this.adjacentFaces=[];for(let r=0;r<d.length;r++){E.face[r]=this.setOrder(r,d[r].concat([]));for(const H of d[r]){n=0,Z=0,I=0,g=this.face[H];for(let E=0;E<3;E++)l=this.vertex[g[E]],n+=l[0],Z+=l[1],I+=l[2];E.vertex[H]=[n/3,Z/3,I/3]}}return E}static BuildGeodesicData(E){const H=new ZE("Geodesic-m-n","Geodesic",[[0,EE.f,-1],[-EE.f,1,0],[-1,0,-EE.f],[1,0,-EE.f],[EE.f,1,0],[0,EE.f,1],[-1,0,EE.f],[-EE.f,-1,0],[0,-EE.f,-1],[EE.f,-1,0],[1,0,EE.f],[0,-EE.f,1]],[]);E.setIndices(),E.calcCoeffs(),E.createInnerFacets(),E.edgeVecsABOB(),E.mapABOBtoOBOA(),E.mapABOBtoBAOA();for(let d=0;d<E.IDATA.face.length;d++)E.MapToFace(d,H),H.innerToData(d,E),"B"===E.IDATA.edgematch[d][1]&&H.mapABOBtoDATA(d,E),"O"===E.IDATA.edgematch[d][1]&&H.mapOBOAtoDATA(d,E),"A"===E.IDATA.edgematch[d][3]&&H.mapBAOAtoDATA(d,E);H.orderData(E);return H.vertex=H.vertex.map((function(E){const H=E[0],d=E[1],n=E[2],Z=Math.sqrt(H*H+d*d+n*n);return E[0]*=1/Z,E[1]*=1/Z,E[2]*=1/Z,E})),H}}Z.e._GoldbergMeshParser=(E,H)=>IE.Parse(E,H);class IE extends Z.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(E,H){return void 0===H?(E>this.goldbergData.nbUnsharedFaces-1&&(J.b.Warn("Maximum number of unshared faces used"),E=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+E):(E>11&&(J.b.Warn("Last pole used"),E=11),H>this.goldbergData.nbFacesAtPole-1&&(J.b.Warn("Maximum number of faces at a pole used"),H=this.goldbergData.nbFacesAtPole-1),12+E*this.goldbergData.nbFacesAtPole+H)}_changeGoldbergFaceColors(E){for(let d=0;d<E.length;d++){const H=E[d][0],n=E[d][1],Z=E[d][2];for(let E=H;E<n+1;E++)this.goldbergData.faceColors[E]=Z}const H=[];for(let d=0;d<12;d++)for(let E=0;E<5;E++)H.push(this.goldbergData.faceColors[d].r,this.goldbergData.faceColors[d].g,this.goldbergData.faceColors[d].b,this.goldbergData.faceColors[d].a);for(let d=12;d<this.goldbergData.faceColors.length;d++)for(let E=0;E<6;E++)H.push(this.goldbergData.faceColors[d].r,this.goldbergData.faceColors[d].g,this.goldbergData.faceColors[d].b,this.goldbergData.faceColors[d].a);return H}setGoldbergFaceColors(E){const H=this._changeGoldbergFaceColors(E);this.aE(I.g.ColorKind,H)}updateGoldbergFaceColors(E){const H=this._changeGoldbergFaceColors(E);this.updateVerticesData(I.g.ColorKind,H)}_changeGoldbergFaceUVs(E){const H=this.getVerticesData(I.g.UVKind);for(let d=0;d<E.length;d++){const n=E[d][0],Z=E[d][1],I=E[d][2],g=E[d][3],l=E[d][4],r=[],t=[];let S,M;for(let E=0;E<5;E++)S=I.x+g*Math.cos(l+E*Math.PI/2.5),M=I.y+g*Math.sin(l+E*Math.PI/2.5),S<0&&(S=0),S>1&&(S=1),r.push(S,M);for(let E=0;E<6;E++)S=I.x+g*Math.cos(l+E*Math.PI/3),M=I.y+g*Math.sin(l+E*Math.PI/3),S<0&&(S=0),S>1&&(S=1),t.push(S,M);for(let E=n;E<Math.min(12,Z+1);E++)for(let d=0;d<5;d++)H[10*E+2*d]=r[2*d],H[10*E+2*d+1]=r[2*d+1];for(let E=Math.max(12,n);E<Z+1;E++)for(let d=0;d<6;d++)H[12*E-24+2*d]=t[2*d],H[12*E-23+2*d]=t[2*d+1]}return H}setGoldbergFaceUVs(E){const H=this._changeGoldbergFaceUVs(E);this.aE(I.g.UVKind,H)}updateGoldbergFaceUVs(E){const H=this._changeGoldbergFaceUVs(E);this.updateVerticesData(I.g.UVKind,H)}placeOnGoldbergFaceAt(E,H,d){const Z=n.wH.RotationFromAxis(this.goldbergData.faceXaxis[H],this.goldbergData.faceYaxis[H],this.goldbergData.faceZaxis[H]);E.rotation=Z,E.position=this.goldbergData.faceCenters[H].add(this.goldbergData.faceXaxis[H].scale(d.x)).add(this.goldbergData.faceYaxis[H].scale(d.y)).add(this.goldbergData.faceZaxis[H].scale(d.z))}serialize(E){super.serialize(E),E.type="GoldbergMesh";const H={};if(H.adjacentFaces=this.goldbergData.adjacentFaces,H.nbSharedFaces=this.goldbergData.nbSharedFaces,H.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,H.nbFaces=this.goldbergData.nbFaces,H.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){H.faceColors=[];for(const E of this.goldbergData.faceColors)H.faceColors.push(E.kd())}if(this.goldbergData.faceCenters){H.faceCenters=[];for(const E of this.goldbergData.faceCenters)H.faceCenters.push(E.kd())}if(this.goldbergData.faceZaxis){H.faceZaxis=[];for(const E of this.goldbergData.faceZaxis)H.faceZaxis.push(E.kd())}if(this.goldbergData.faceYaxis){H.faceYaxis=[];for(const E of this.goldbergData.faceYaxis)H.faceYaxis.push(E.kd())}if(this.goldbergData.faceXaxis){H.faceXaxis=[];for(const E of this.goldbergData.faceXaxis)H.faceXaxis.push(E.kd())}E.goldbergData=H}static Parse(E,H){const d=E.goldbergData;d.faceColors=d.faceColors.map((E=>V.gg.eH(E))),d.faceCenters=d.faceCenters.map((E=>n.wH.eH(E))),d.faceZaxis=d.faceZaxis.map((E=>n.wH.eH(E))),d.faceXaxis=d.faceXaxis.map((E=>n.wH.eH(E))),d.faceYaxis=d.faceYaxis.map((E=>n.wH.eH(E)));const Z=new IE(E.name,H);return Z.goldbergData=d,Z}}var gE=d(12933);const lE={CreateBox:M.e,CreateTiledBox:Q,CreateSphere:L.b,CreateDisc:S.e,CreateIcoSphere:q,CreateRibbon:t,CreateCylinder:i,CreateTorus:f,CreateTorusKnot:j,CreateLineSystem:X.i,Ut:X.k,CreateDashedLines:X.e,ExtrudeShape:Y,ExtrudeShapeCustom:c,CreateLathe:o,CreateTiledPlane:w,ut:F.d,CreateGround:a.i,CreateTiledGround:a.m,CreateGroundFromHeightMap:a.e,CreatePolygon:W.c,ExtrudePolygon:W.e,CreateTube:k,CreatePolyhedron:G,CreateGeodesic:function(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=H.m||1;n!==Math.floor(n)&&(n=Math.floor(n),J.b.Warn("m not an integer only floor(m) used"));let Z=H.n||0;if(Z!==Math.floor(Z)&&(Z=Math.floor(Z),J.b.Warn("n not an integer only floor(n) used")),Z>n){const E=Z;Z=n,n=E,J.b.Warn("n > m therefore m and n swapped")}const I=new dE;return I.build(n,Z),G(E,{custom:ZE.BuildGeodesicData(I),size:H.size,sizeX:H.sizeX,sizeY:H.sizeY,sizeZ:H.sizeZ,faceUV:H.faceUV,faceColors:H.faceColors,flat:H.flat,updatable:H.updatable,sideOrientation:H.sideOrientation,frontUVs:H.frontUVs,backUVs:H.backUVs},d)},CreateGoldberg:function(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=H.size,r=H.sizeX||I||1,t=H.sizeY||I||1,S=H.sizeZ||I||1;let M=H.m||1;M!==Math.floor(M)&&(M=Math.floor(M),J.b.Warn("m not an integer only floor(m) used"));let C=H.n||0;if(C!==Math.floor(C)&&(C=Math.floor(C),J.b.Warn("n not an integer only floor(n) used")),C>M){const E=C;C=M,M=E,J.b.Warn("n > m therefore m and n swapped")}const w=new dE;w.build(M,C);const R=ZE.BuildGeodesicData(w),Q=R.toGoldbergPolyhedronData(),L=new IE(E,d);H.sideOrientation=Z.e._GetDefaultSideOrientation(H.sideOrientation),L._originalBuilderSideOrientation=H.sideOrientation;(function(E,H){const d=E.size,Z=E.sizeX||d||1,I=E.sizeY||d||1,r=E.sizeZ||d||1,t=0===E.sideOrientation?0:E.sideOrientation||g.c.DEFAULTSIDE,S=[],M=[],V=[],C=[];let w=1/0,R=-1/0,Q=1/0,L=-1/0;for(let n=0;n<H.vertex.length;n++)w=Math.min(w,H.vertex[n][0]*Z),R=Math.max(R,H.vertex[n][0]*Z),Q=Math.min(Q,H.vertex[n][1]*I),L=Math.max(L,H.vertex[n][1]*I);let D=0;for(let g=0;g<H.face.length;g++){const E=H.face[g],d=n.wH.eH(H.vertex[E[0]]),t=n.wH.eH(H.vertex[E[2]]),e=n.wH.eH(H.vertex[E[1]]),s=t.RH(d),i=e.RH(d),p=n.wH.Cross(i,s).normalize();for(let n=0;n<E.length;n++){V.push(p.x,p.y,p.z);const d=H.vertex[E[n]];S.push(d[0]*Z,d[1]*I,d[2]*r);const g=(d[1]*I-Q)/(L-Q);C.push((d[0]*Z-w)/(R-w),l.e?1-g:g)}for(let H=0;H<E.length-2;H++)M.push(D,D+H+2,D+H+1);D+=E.length}g.c._ComputeSides(t,S,M,V,C);const e=new g.c;return e.jE=S,e.indices=M,e.XE=V,e.UE=C,e})(H,Q).cE(L,H.updatable),L.goldbergData.nbSharedFaces=R.sharedNodes,L.goldbergData.nbUnsharedFaces=R.poleNodes,L.goldbergData.adjacentFaces=R.adjacentFaces,L.goldbergData.nbFaces=L.goldbergData.nbSharedFaces+L.goldbergData.nbUnsharedFaces,L.goldbergData.nbFacesAtPole=(L.goldbergData.nbUnsharedFaces-12)/12;for(let Z=0;Z<R.vertex.length;Z++)L.goldbergData.faceCenters.push(n.wH.eH(R.vertex[Z])),L.goldbergData.faceCenters[Z].x*=r,L.goldbergData.faceCenters[Z].y*=t,L.goldbergData.faceCenters[Z].z*=S,L.goldbergData.faceColors.push(new V.gg(1,1,1,1));for(let Z=0;Z<Q.face.length;Z++){const E=Q.face[Z],H=n.wH.eH(Q.vertex[E[0]]),d=n.wH.eH(Q.vertex[E[2]]),I=n.wH.eH(Q.vertex[E[1]]),g=d.RH(H),l=I.RH(H),r=n.wH.Cross(l,g).normalize(),t=n.wH.Cross(l,r).normalize();L.goldbergData.faceXaxis.push(l.normalize()),L.goldbergData.faceYaxis.push(r),L.goldbergData.faceZaxis.push(t)}return L},CreateDecal:T,CreateCapsule:B,CreateText:gE.e}},13700:(E,H,d)=>{"use strict";d.d(H,{b:()=>lH});var n=d(12384),Z=d(12781);class I extends Z.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var g=d(12437),l=(d(12562),d(12344));class r{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(E){this._targetStopDuration!==E&&(this._targetStopDuration=E)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(E){this._noiseTexture!==E&&(this._noiseTexture=E,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(E){this._animationSheetEnabled!==E&&(this._animationSheetEnabled=E)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(E){this._isAnimationSheetEnabled!=E&&(this._isAnimationSheetEnabled=E,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(E){this._useLogarithmicDepth=E&&this.fE().getEngine().getCaps().fragmentDepthSupported}fE(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(E){switch(E){case r.BLENDMODE_MULTIPLYADD:return;case r.BLENDMODE_ADD:E=1;break;case r.BLENDMODE_ONEONE:E=6;break;case r.BLENDMODE_STANDARD:E=2;break;case r.BLENDMODE_MULTIPLY:E=4;break;case r.BLENDMODE_SUBTRACT:E=3}this._engine.setAlphaMode(E)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:n.wH.Zero()}set direction1(E){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=E)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:n.wH.Zero()}set direction2(E){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=E)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:n.wH.Zero()}set minEmitBox(E){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=E)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:n.wH.Zero()}set maxEmitBox(E){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=E)}get billboardMode(){return this._billboardMode}set billboardMode(E){this._billboardMode!==E&&(this._billboardMode=E,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(E){this._isBillboardBased!==E&&(this._isBillboardBased=E,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(E){this._attachImageProcessingConfiguration(E)}_attachImageProcessingConfiguration(E){E!==this._imageProcessingConfiguration&&(!E&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=E)}_reset(){}_removeGradientAndTexture(E,H,d){if(!H)return this;let n=0;for(const Z of H){if(Z.gradient===E){H.splice(n,1);break}n++}return d&&d.dispose(),this}constructor(E){this.animations=[],this.renderingGroupId=0,this.nH=n.wH.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new n.wH(10,10,10),this.onAnimationEnd=null,this.blendMode=r.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new n.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.jt=new n.wH(0,0,0),this._useLogarithmicDepth=!1,this.gravity=n.wH.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new g.gg(1,1,1,1),this.color2=new g.gg(1,1,1,1),this.colorDead=new g.gg(0,0,0,1),this.textureMask=new g.gg(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new I,this.id=E,this.name=E}createPointEmitter(E,H){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new n.wH(0,1,0),arguments.length>2&&void 0!==arguments[2]||new n.wH(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new n.wH(0,1,0),arguments.length>4&&void 0!==arguments[4]||new n.wH(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new n.wH(0,1,0),arguments.length>3&&void 0!==arguments[3]||new n.wH(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(E,H,d,n){throw new Error("Method not implemented.")}}r.BLENDMODE_ONEONE=0,r.BLENDMODE_STANDARD=1,r.BLENDMODE_ADD=2,r.BLENDMODE_MULTIPLY=3,r.BLENDMODE_MULTIPLYADD=4,r.BLENDMODE_SUBTRACT=-1,(0,l.e)("BABYLON.BaseParticleSystem",r);var t=d(12406),S=d(12244);class M{constructor(){this.direction1=new n.wH(0,1,0),this.direction2=new n.wH(0,1,0),this.minEmitBox=new n.wH(-.5,-.5,-.5),this.maxEmitBox=new n.wH(.5,.5,.5)}startDirectionFunction(E,H,d,Z){const I=(0,t.RandomRange)(this.direction1.x,this.direction2.x),g=(0,t.RandomRange)(this.direction1.y,this.direction2.y),l=(0,t.RandomRange)(this.direction1.z,this.direction2.z);if(Z)return H.x=I,H.y=g,void(H.z=l);n.wH.TransformNormalFromFloatsToRef(I,g,l,E,H)}startPositionFunction(E,H,d,Z){const I=(0,t.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),g=(0,t.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),l=(0,t.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(Z)return H.x=I,H.y=g,void(H.z=l);n.wH.TransformCoordinatesFromFloatsToRef(I,g,l,E,H)}clone(){const E=new M;return S.b.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2),E.setVector3("minEmitBox",this.minEmitBox),E.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3),E.addUniform("minEmitBox",3),E.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.direction1=this.direction1.kd(),E.direction2=this.direction2.kd(),E.minEmitBox=this.minEmitBox.kd(),E.maxEmitBox=this.maxEmitBox.kd(),E}parse(E){n.wH.FromArrayToRef(E.direction1,0,this.direction1),n.wH.FromArrayToRef(E.direction2,0,this.direction2),n.wH.FromArrayToRef(E.minEmitBox,0,this.minEmitBox),n.wH.FromArrayToRef(E.maxEmitBox,0,this.maxEmitBox)}}class V{get radius(){return this._radius}set radius(E){this._radius=E,this._buildHeight()}get angle(){return this._angle}set angle(E){this._angle=E,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=d,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=H,this.radius=E}startDirectionFunction(E,H,d,Z){Z?n.TmpVectors.wH[0].l(d.Er).normalize():d.position.subtractToRef(E.getTranslation(),n.TmpVectors.wH[0]).normalize();const I=(0,t.RandomRange)(0,this.directionRandomizer),g=(0,t.RandomRange)(0,this.directionRandomizer),l=(0,t.RandomRange)(0,this.directionRandomizer);H.x=n.TmpVectors.wH[0].x+I,H.y=n.TmpVectors.wH[0].y+g,H.z=n.TmpVectors.wH[0].z+l,H.normalize()}startPositionFunction(E,H,d,Z){const I=(0,t.RandomRange)(0,2*Math.PI);let g;this.emitFromSpawnPointOnly?g=1e-4:(g=(0,t.RandomRange)(0,this.heightRange),g=1-g*g);let l=this._radius-(0,t.RandomRange)(0,this._radius*this.radiusRange);l*=g;const r=l*Math.sin(I),S=l*Math.cos(I),M=g*this._height;if(Z)return H.x=r,H.y=M,void(H.z=S);n.wH.TransformCoordinatesFromFloatsToRef(r,M,S,E,H)}clone(){const E=new V(this._radius,this._angle,this.directionRandomizer);return S.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat2("radius",this._radius,this.radiusRange),E.setFloat("coneAngle",this._angle),E.setFloat2("height",this._height,this.heightRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",2),E.addUniform("coneAngle",1),E.addUniform("height",2),E.addUniform("directionRandomizer",1)}getEffectDefines(){let E="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(E+="\n#define CONEEMITTERSPAWNPOINT"),E}getClassName(){return"ConeParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this._radius,E.angle=this._angle,E.directionRandomizer=this.directionRandomizer,E.radiusRange=this.radiusRange,E.heightRange=this.heightRange,E.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,E}parse(E){this.radius=E.radius,this.angle=E.angle,this.directionRandomizer=E.directionRandomizer,this.radiusRange=void 0!==E.radiusRange?E.radiusRange:1,this.heightRange=void 0!==E.radiusRange?E.heightRange:1,this.emitFromSpawnPointOnly=void 0!==E.emitFromSpawnPointOnly&&E.emitFromSpawnPointOnly}}class C extends V{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.wH(0,1,0),Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.wH(0,1,0);super(E,H),this.direction1=d,this.direction2=Z}startDirectionFunction(E,H){const d=(0,t.RandomRange)(this.direction1.x,this.direction2.x),Z=(0,t.RandomRange)(this.direction1.y,this.direction2.y),I=(0,t.RandomRange)(this.direction1.z,this.direction2.z);n.wH.TransformNormalFromFloatsToRef(d,Z,I,E,H)}clone(){const E=new C(this.radius,this.angle,this.direction1,this.direction2);return S.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.kd(),E.direction2=this.direction2.kd(),E}parse(E){super.parse(E),this.direction1.l(E.direction1),this.direction2.l(E.direction2)}}class w{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=E,this.height=H,this.radiusRange=d,this.directionRandomizer=Z,this._tempVector=n.wH.Zero()}startDirectionFunction(E,H,d,Z,I){d.position.subtractToRef(E.getTranslation(),this._tempVector),this._tempVector.normalize(),n.wH.TransformNormalToRef(this._tempVector,I,this._tempVector);const g=(0,t.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let l=Math.atan2(this._tempVector.x,this._tempVector.z);l+=(0,t.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=g,this._tempVector.x=Math.sin(l),this._tempVector.z=Math.cos(l),this._tempVector.normalize(),Z?H.l(this._tempVector):n.wH.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,E,H)}startPositionFunction(E,H,d,Z){const I=(0,t.RandomRange)(-this.height/2,this.height/2),g=(0,t.RandomRange)(0,2*Math.PI),l=(0,t.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),r=Math.sqrt(l)*this.radius,S=r*Math.cos(g),M=r*Math.sin(g);Z?H.en(S,I,M):n.wH.TransformCoordinatesFromFloatsToRef(S,I,M,E,H)}clone(){const E=new w(this.radius,this.directionRandomizer);return S.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("height",this.height),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("height",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.height=this.height,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.height=E.height,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class R extends w{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.wH(0,1,0),I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.wH(0,1,0);super(E,H,d),this.direction1=Z,this.direction2=I}startDirectionFunction(E,H,d,Z){const I=(0,t.RandomRange)(this.direction1.x,this.direction2.x),g=(0,t.RandomRange)(this.direction1.y,this.direction2.y),l=(0,t.RandomRange)(this.direction1.z,this.direction2.z);Z?H.en(I,g,l):n.wH.TransformNormalFromFloatsToRef(I,g,l,E,H)}clone(){const E=new R(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return S.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("height",this.height),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("height",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.kd(),E.direction2=this.direction2.kd(),E}parse(E){super.parse(E),n.wH.FromArrayToRef(E.direction1,0,this.direction1),n.wH.FromArrayToRef(E.direction2,0,this.direction2)}}class Q{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=E,this.radiusRange=H,this.directionRandomizer=d}startDirectionFunction(E,H,d,Z){const I=d.position.RH(E.getTranslation()).normalize(),g=(0,t.RandomRange)(0,this.directionRandomizer),l=(0,t.RandomRange)(0,this.directionRandomizer),r=(0,t.RandomRange)(0,this.directionRandomizer);I.x+=g,I.y+=l,I.z+=r,I.normalize(),Z?H.l(I):n.wH.TransformNormalFromFloatsToRef(I.x,I.y,I.z,E,H)}startPositionFunction(E,H,d,Z){const I=this.radius-(0,t.RandomRange)(0,this.radius*this.radiusRange),g=(0,t.RandomRange)(0,1),l=(0,t.RandomRange)(0,2*Math.PI),r=Math.acos(2*g-1),S=I*Math.cos(l)*Math.sin(r),M=I*Math.cos(r),V=I*Math.sin(l)*Math.sin(r);Z?H.en(S,Math.abs(M),V):n.wH.TransformCoordinatesFromFloatsToRef(S,Math.abs(M),V,E,H)}clone(){const E=new Q(this.radius,this.directionRandomizer);return S.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class L{constructor(){this.direction1=new n.wH(0,1,0),this.direction2=new n.wH(0,1,0)}startDirectionFunction(E,H,d,Z){const I=(0,t.RandomRange)(this.direction1.x,this.direction2.x),g=(0,t.RandomRange)(this.direction1.y,this.direction2.y),l=(0,t.RandomRange)(this.direction1.z,this.direction2.z);Z?H.en(I,g,l):n.wH.TransformNormalFromFloatsToRef(I,g,l,E,H)}startPositionFunction(E,H,d,Z){Z?H.en(0,0,0):n.wH.TransformCoordinatesFromFloatsToRef(0,0,0,E,H)}clone(){const E=new L;return S.b.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.direction1=this.direction1.kd(),E.direction2=this.direction2.kd(),E}parse(E){n.wH.FromArrayToRef(E.direction1,0,this.direction1),n.wH.FromArrayToRef(E.direction2,0,this.direction2)}}class D{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=E,this.radiusRange=H,this.directionRandomizer=d}startDirectionFunction(E,H,d,Z){const I=d.position.RH(E.getTranslation()).normalize(),g=(0,t.RandomRange)(0,this.directionRandomizer),l=(0,t.RandomRange)(0,this.directionRandomizer),r=(0,t.RandomRange)(0,this.directionRandomizer);I.x+=g,I.y+=l,I.z+=r,I.normalize(),Z?H.l(I):n.wH.TransformNormalFromFloatsToRef(I.x,I.y,I.z,E,H)}startPositionFunction(E,H,d,Z){const I=this.radius-(0,t.RandomRange)(0,this.radius*this.radiusRange),g=(0,t.RandomRange)(0,1),l=(0,t.RandomRange)(0,2*Math.PI),r=Math.acos(2*g-1),S=I*Math.cos(l)*Math.sin(r),M=I*Math.cos(r),V=I*Math.sin(l)*Math.sin(r);Z?H.en(S,M,V):n.wH.TransformCoordinatesFromFloatsToRef(S,M,V,E,H)}clone(){const E=new D(this.radius,this.directionRandomizer);return S.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.radius=this.radius,E.radiusRange=this.radiusRange,E.directionRandomizer=this.directionRandomizer,E}parse(E){this.radius=E.radius,this.radiusRange=E.radiusRange,this.directionRandomizer=E.directionRandomizer}}class e extends D{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.wH(0,1,0),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.wH(0,1,0);super(E),this.direction1=H,this.direction2=d}startDirectionFunction(E,H){const d=(0,t.RandomRange)(this.direction1.x,this.direction2.x),Z=(0,t.RandomRange)(this.direction1.y,this.direction2.y),I=(0,t.RandomRange)(this.direction1.z,this.direction2.z);n.wH.TransformNormalFromFloatsToRef(d,Z,I,E,H)}clone(){const E=new e(this.radius,this.direction1,this.direction2);return S.b.DeepCopy(this,E),E}applyToShader(E){E.setFloat("radius",this.radius),E.setFloat("radiusRange",this.radiusRange),E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("radius",1),E.addUniform("radiusRange",1),E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const E=super.serialize();return E.direction1=this.direction1.kd(),E.direction2=this.direction2.kd(),E}parse(E){super.parse(E),this.direction1.l(E.direction1),this.direction2.l(E.direction2)}}class s{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(E,H,d,Z){const I=n.TmpVectors.wH[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,d,I);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,d,I);const E=n.TmpVectors.wH[1];I.subtractToRef(d.position,E),E.scaleToRef(1/d.lifeTime,I)}else I.set(0,0,0);Z?H.l(I):n.wH.TransformNormalToRef(I,E,H)}startPositionFunction(E,H,d,Z){const I=n.TmpVectors.wH[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,d,I):I.set(0,0,0),Z?H.l(I):n.wH.TransformCoordinatesToRef(I,E,H)}clone(){const E=new s;return S.b.DeepCopy(this,E),E}applyToShader(E){}buildUniformLayout(E){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const E={};return E.type=this.getClassName(),E.particlePositionGenerator=this.particlePositionGenerator,E.particleDestinationGenerator=this.particleDestinationGenerator,E}parse(E){E.particlePositionGenerator&&(this.particlePositionGenerator=E.particlePositionGenerator),E.particleDestinationGenerator&&(this.particleDestinationGenerator=E.particleDestinationGenerator)}}var i=d(12463);class p{get mesh(){return this._mesh}set mesh(E){this._mesh!==E&&(this._mesh=E,E?(this._indices=E.Nd(),this._positions=E.getVerticesData(i.g.PositionKind),this._normals=E.getVerticesData(i.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=n.wH.Zero(),this._mesh=null,this.direction1=new n.wH(0,1,0),this.direction2=new n.wH(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=E}startDirectionFunction(E,H,d,Z){if(this.useMeshNormalsForDirection&&this._normals)return void n.wH.TransformNormalToRef(this._storedNormal,E,H);const I=(0,t.RandomRange)(this.direction1.x,this.direction2.x),g=(0,t.RandomRange)(this.direction1.y,this.direction2.y),l=(0,t.RandomRange)(this.direction1.z,this.direction2.z);Z?H.en(I,g,l):n.wH.TransformNormalFromFloatsToRef(I,g,l,E,H)}startPositionFunction(E,H,d,Z){if(!this._indices||!this._positions)return;const I=3*(Math.random()*(this._indices.length/3)|0),g=Math.random(),l=Math.random()*(1-g),r=1-g-l,t=this._indices[I],S=this._indices[I+1],M=this._indices[I+2],V=n.TmpVectors.wH[0],C=n.TmpVectors.wH[1],w=n.TmpVectors.wH[2],R=n.TmpVectors.wH[3];n.wH.FromArrayToRef(this._positions,3*t,V),n.wH.FromArrayToRef(this._positions,3*S,C),n.wH.FromArrayToRef(this._positions,3*M,w),R.x=g*V.x+l*C.x+r*w.x,R.y=g*V.y+l*C.y+r*w.y,R.z=g*V.z+l*C.z+r*w.z,Z?H.en(R.x,R.y,R.z):n.wH.TransformCoordinatesFromFloatsToRef(R.x,R.y,R.z,E,H),this.useMeshNormalsForDirection&&this._normals&&(n.wH.FromArrayToRef(this._normals,3*t,V),n.wH.FromArrayToRef(this._normals,3*S,C),n.wH.FromArrayToRef(this._normals,3*M,w),this._storedNormal.x=g*V.x+l*C.x+r*w.x,this._storedNormal.y=g*V.y+l*C.y+r*w.y,this._storedNormal.z=g*V.z+l*C.z+r*w.z)}clone(){const E=new p(this.mesh);return S.b.DeepCopy(this,E),E}applyToShader(E){E.setVector3("direction1",this.direction1),E.setVector3("direction2",this.direction2)}buildUniformLayout(E){E.addUniform("direction1",3),E.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var E;const H={};return H.type=this.getClassName(),H.direction1=this.direction1.kd(),H.direction2=this.direction2.kd(),H.meshId=null===(E=this.mesh)||void 0===E?void 0:E.id,H.useMeshNormalsForDirection=this.useMeshNormalsForDirection,H}parse(E,H){n.wH.FromArrayToRef(E.direction1,0,this.direction1),n.wH.FromArrayToRef(E.direction2,0,this.direction2),E.meshId&&H&&(this.mesh=H.getLastMeshById(E.meshId)),this.useMeshNormalsForDirection=E.useMeshNormalsForDirection}}class f{_isUbo(E){return void 0!==E.addUniform}constructor(E){this._isUbo(E)?(this.setMatrix3x3=E.updateMatrix3x3.bind(E),this.setMatrix2x2=E.updateMatrix2x2.bind(E),this.setFloat=E.updateFloat.bind(E),this.setFloat2=E.updateFloat2.bind(E),this.setFloat3=E.updateFloat3.bind(E),this.setFloat4=E.updateFloat4.bind(E),this.setFloatArray=E.updateFloatArray.bind(E),this.setArray=E.updateArray.bind(E),this.setIntArray=E.updateIntArray.bind(E),this.setMatrix=E.bd.bind(E),this.setMatrices=E.updateMatrices.bind(E),this.setVector3=E.updateVector3.bind(E),this.setVector4=E.updateVector4.bind(E),this.setColor3=E.updateColor3.bind(E),this.setColor4=E.updateColor4.bind(E),this.setDirectColor4=E.updateDirectColor4.bind(E),this.setInt=E.updateInt.bind(E),this.setInt2=E.updateInt2.bind(E),this.setInt3=E.updateInt3.bind(E),this.setInt4=E.updateInt4.bind(E)):(this.setMatrix3x3=E.setMatrix3x3.bind(E),this.setMatrix2x2=E.setMatrix2x2.bind(E),this.setFloat=E.setFloat.bind(E),this.setFloat2=E.setFloat2.bind(E),this.setFloat3=E.setFloat3.bind(E),this.setFloat4=E.setFloat4.bind(E),this.setFloatArray=E.setFloatArray.bind(E),this.setArray=E.setArray.bind(E),this.setIntArray=E.setIntArray.bind(E),this.setMatrix=E.setMatrix.bind(E),this.setMatrices=E.setMatrices.bind(E),this.setVector3=E.setVector3.bind(E),this.setVector4=E.setVector4.bind(E),this.setColor3=E.setColor3.bind(E),this.setColor4=E.setColor4.bind(E),this.setDirectColor4=E.setDirectColor4.bind(E),this.setInt=E.setInt.bind(E),this.setInt2=E.setInt2.bind(E),this.setInt3=E.setInt3.bind(E),this.setInt4=E.setInt4.bind(E))}}var P=d(12307);const j="gpuUpdateParticlesPixelShader",X="#version 300 es\nvoid main() {discard;}\n";P.e.ShadersStore[j]||(P.e.ShadersStore[j]=X);const W="gpuUpdateParticlesVertexShader",U="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";P.e.ShadersStore[W]||(P.e.ShadersStore[W]=U);(0,l.e)("BABYLON.WebGL2ParticleSystem",class{constructor(E,H){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=E,this._engine=H,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var E;return(null===(E=this._updateEffect)||void 0===E?void 0:E.isReady())??!1}createUpdateBuffer(E){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof s&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=E,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new f(this._updateEffect)}createVertexBuffers(E,H){this._updateVAO.push(this._createUpdateVAO(E)),this._renderVAO.push(this._engine.recordVertexArrayObject(H,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=H}createParticleBuffer(E){return E}bindDrawBuffers(E,H,d){d?this._engine.bindBuffers(this._renderVertexBuffers,d,H):this._engine.bindVertexArrayObject(this._renderVAO[E],null)}preUpdateParticleBuffer(){const E=this._engine;if(this._engine.enableEffect(this._updateEffect),!E.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(E,H,d){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[E],null);const n=this._engine;n.bindTransformFeedbackBuffer(H.getBuffer()),n.setRasterizerState(!1),n.beginTransformFeedback(!0),n.drawArraysType(3,0,d),n.endTransformFeedback(),n.setRasterizerState(!0),n.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let E=0;E<this._updateVAO.length;E++)this._engine.releaseVertexArrayObject(this._updateVAO[E]);this._updateVAO.length=0;for(let E=0;E<this._renderVAO.length;E++)this._engine.releaseVertexArrayObject(this._renderVAO[E]);this._renderVAO.length=0}_createUpdateVAO(E){const H={};H.position=E.createVertexBuffer("position",0,3);let d=3;H.age=E.createVertexBuffer("age",d,1),d+=1,H.size=E.createVertexBuffer("size",d,3),d+=3,H.life=E.createVertexBuffer("life",d,1),d+=1,H.seed=E.createVertexBuffer("seed",d,4),d+=4,H.direction=E.createVertexBuffer("direction",d,3),d+=3,this._parent.particleEmitterType instanceof s&&(H.initialPosition=E.createVertexBuffer("initialPosition",d,3),d+=3),this._parent._colorGradientsTexture||(H.color=E.createVertexBuffer("color",d,4),d+=4),this._parent._isBillboardBased||(H.initialDirection=E.createVertexBuffer("initialDirection",d,3),d+=3),this._parent.noiseTexture&&(H.noiseCoordinates1=E.createVertexBuffer("noiseCoordinates1",d,3),d+=3,H.noiseCoordinates2=E.createVertexBuffer("noiseCoordinates2",d,3),d+=3),this._parent._angularSpeedGradientsTexture?(H.angle=E.createVertexBuffer("angle",d,1),d+=1):(H.angle=E.createVertexBuffer("angle",d,2),d+=2),this._parent._isAnimationSheetEnabled&&(H.cellIndex=E.createVertexBuffer("cellIndex",d,1),d+=1,this._parent.spriteRandomStartCell&&(H.cellStartOffset=E.createVertexBuffer("cellStartOffset",d,1),d+=1));const n=this._engine.recordVertexArrayObject(H,null,this._updateEffect);return this._engine.bindArrayBuffer(null),n}});class Y{constructor(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3?arguments[3]:void 0;this._engine=E,this._label=n,this._engine._storageBuffers.push(this),this._create(H,d)}_create(E,H){this._bufferSize=E,this._creationFlags=H,this._buffer=this._engine.createStorageBuffer(E,H,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(E,H,d){this._buffer&&this._engine.updateStorageBuffer(this._buffer,E,H,d)}async read(E,H,d,n){return await this._engine.readFromStorageBuffer(this._buffer,E,H,d,n)}dispose(){const E=this._engine._storageBuffers,H=E.indexOf(this);-1!==H&&(E[H]=E[E.length-1],E.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var c=d(12369),u=d(12372),o=d(12428),F=d(12366),a=d(12696),k=d(12237),O=d(12325),G=d(12612);class x{constructor(){this._gpuTimeInFrameId=-1,this.counter=new G.e}_addDuration(E,H){E<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==E?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(H,!1),this._gpuTimeInFrameId=E):this.counter.addCount(H,!1))}}var q=d(12287);class b{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=E,this._engine=H,this.uniqueId=a.c.UniqueId,H.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new x),this._engine.getCaps().supportComputeShaders?n.bindingsMapping?(this._context=H.createComputeContext(),this._shaderPath=d,this._options={bindingsMapping:{},defines:[],...n}):k.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):k.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(E,H){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=this._bindings[E];this._bindings[E]={type:d?0:4,object:H,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!n||n.object!==H||n.type!==this._bindings[E].type)}setStorageTexture(E,H){const d=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==H),this._bindings[E]={type:1,object:H,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setExternalTexture(E,H){const d=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==H),this._bindings[E]={type:6,object:H,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setVideoTexture(E,H){return!!H.externalTexture&&(this.setExternalTexture(E,H.externalTexture),!0)}setUniformBuffer(E,H){const d=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==H),this._bindings[E]={type:b._BufferIsDataBuffer(H)?7:2,object:H,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setStorageBuffer(E,H){const d=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!d||d.object!==H),this._bindings[E]={type:b._BufferIsDataBuffer(H)?7:3,object:H,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}setTextureSampler(E,H){const d=this._bindings[E];this._contextIsDirty||(this._contextIsDirty=!d||!H.compareSampler(d.object)),this._bindings[E]={type:5,object:H,indexInGroupEntries:null===d||void 0===d?void 0:d.indexInGroupEntries}}isReady(){let E=this._effect;for(const Z in this._bindings){const E=this._bindings[Z],H=E.type,d=E.object;switch(H){case 0:case 4:case 1:if(!d.isReady())return!1;break;case 6:if(!d.isReady())return!1;break}}const H=[],d=this._shaderPath;if(this._options.defines)for(let Z=0;Z<this._options.defines.length;Z++)H.push(this._options.defines[Z]);const n=H.join("\n");return this._cachedDefines!==n&&(this._cachedDefines=n,E=this._engine.createComputeEffect(d,{defines:n,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=E),!!E.isReady()}dispatch(E,H,d){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,E,H,d,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const d=b._BufferIsDataBuffer(E)?E:E.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,d,H,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const H in this._bindings){const d=this._bindings[H];if(!this._options.bindingsMapping[H])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+H+"'");switch(d.type){case 0:{const n=this._samplers[H],Z=d.object;var E;if(!n||!Z._texture||!n.compareSampler(Z._texture))this._samplers[H]=(new O.b).setParameters(Z.wrapU,Z.wrapV,Z.wrapR,Z.anisotropicFilteringLevel,Z._texture.samplingMode,null===(E=Z._texture)||void 0===E?void 0:E._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const E=d.object;E.getBuffer()!==d.buffer&&(d.buffer=E.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((Z=>{(0,q.d)((()=>this.dispatch(E,H,d)),Z,void 0,n)}))}serialize(){const E=o.c.Serialize(this);E.options=this._options,E.shaderPath=this._shaderPath,E.wV={},E.textures={};for(const H in this._bindings){const d=this._bindings[H],n=d.object;switch(d.type){case 0:case 4:case 1:{const Z=n.serialize();Z&&(E.textures[H]=Z,E.wV[H]={type:d.type});break}}}return E}static Parse(E,H,d){const n=o.c.Parse((()=>new b(E.name,H.getEngine(),E.shaderPath,E.options)),E,H,d);for(const Z in E.textures){const I=E.wV[Z],g=F.c.Parse(E.textures[Z],H,d);0===I.type?n.setTexture(Z,g):4===I.type?n.setTexture(Z,g,!1):n.setStorageTexture(Z,g)}return n}static _BufferIsDataBuffer(E){return void 0!==E.underlyingResource}}(0,c.e)([(0,u.K)()],b.prototype,"name",void 0),(0,c.e)([(0,u.K)()],b.prototype,"fastMode",void 0),(0,l.e)("BABYLON.ComputeShader",b);var h=d(12656);const y="gpuUpdateParticlesComputeShader",v="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";P.e.ShadersStoreWGSL[y]||(P.e.ShadersStoreWGSL[y]=v);(0,l.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(E,H){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=E,this._engine=H}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var E;return(null===(E=this._updateComputeShader)||void 0===E?void 0:E.isReady())??!1}createUpdateBuffer(E){var H;const d={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(d.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(d.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(d.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(d.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(d.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(d.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(d.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new b("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:d,defines:E.split("\n")}),null===(H=this._simParamsComputeShader)||void 0===H||H.dispose(),this._simParamsComputeShader=new h.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new f(this._simParamsComputeShader)}createVertexBuffers(E,H){this._renderVertexBuffers.push(H)}createParticleBuffer(E){const H=new Y(this._engine,4*E.length,11,"ComputeShaderParticleSystemBuffer");return H.update(E),this._bufferComputeShader.push(H),H.getBuffer()}bindDrawBuffers(E,H,d){this._engine.bindBuffers(this._renderVertexBuffers[E],d,H)}preUpdateParticleBuffer(){}updateParticleBuffer(E,H,d){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[E]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^E]),this._updateComputeShader.dispatch(Math.ceil(d/64))}releaseBuffers(){var E;for(let H=0;H<this._bufferComputeShader.length;++H)this._bufferComputeShader[H].dispose();this._bufferComputeShader.length=0,null===(E=this._simParamsComputeShader)||void 0===E||E.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class z{constructor(E,H,d){this.gradient=E,this.color1=H,this.color2=d}getColorToRef(E){this.color2?g.gg.LerpToRef(this.color1,this.color2,Math.random(),E):E.l(this.color1)}}class K{constructor(E,H){this.gradient=E,this.color=H}}class N{constructor(E,H,d){this.gradient=E,this.factor1=H,this.factor2=d}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class mE{static GetCurrentGradient(E,H,d){if(H[0].gradient>E)return void d(H[0],H[0],1);for(let Z=0;Z<H.length-1;Z++){const n=H[Z],I=H[Z+1];if(E>=n.gradient&&E<=I.gradient){return void d(n,I,(E-n.gradient)/(I.gradient-n.gradient))}}const n=H.length-1;d(H[n],H[n],1)}}var T=d(12230),A=d(12860),B=d(12268);class J{constructor(E){this.particleSystem=E,this.position=n.wH.Zero(),this.direction=n.wH.Zero(),this.color=new g.gg(0,0,0,0),this.colorStep=new g.gg(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new n.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new g.gg(0,0,0,0),this._currentColor2=new g.gg(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=J._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let E=this.age,H=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===H?(H=1,E=this._randomCellOffset):E+=this._randomCellOffset);const d=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let n;n=this._initialSpriteCellLoop?(0,t.Clamp)(E*H%this.lifeTime/this.lifeTime):(0,t.Clamp)(E*H/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+n*d|0}_inheritParticleInfoToSubEmitter(E){if(E.particleSystem.nH.position){const H=E.particleSystem.nH;if(H.position.l(this.position),E.inheritDirection){const E=n.TmpVectors.wH[0];this.direction.normalizeToRef(E),H.setDirection(E,0,Math.PI/2)}}else{E.particleSystem.nH.l(this.position)}this.direction.scaleToRef(E.inheritedVelocityAmount/2,n.TmpVectors.wH[0]),E.particleSystem._inheritedVelocityOffset.l(n.TmpVectors.wH[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const E of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(E)}_reset(){this.age=0,this.id=J._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(E){E.position.l(this.position),this._initialDirection?E._initialDirection?E._initialDirection.l(this._initialDirection):E._initialDirection=this._initialDirection.clone():E._initialDirection=null,E.direction.l(this.direction),this.Er&&(E.Er?E.Er.l(this.Er):E.Er=this.Er.clone()),E.color.l(this.color),E.colorStep.l(this.colorStep),E.lifeTime=this.lifeTime,E.age=this.age,E._randomCellOffset=this._randomCellOffset,E.size=this.size,E.scale.l(this.scale),E.angle=this.angle,E.angularSpeed=this.angularSpeed,E.particleSystem=this.particleSystem,E.cellIndex=this.cellIndex,E.id=this.id,E._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(E._currentColorGradient=this._currentColorGradient,E._currentColor1.l(this._currentColor1),E._currentColor2.l(this._currentColor2)),this._currentSizeGradient&&(E._currentSizeGradient=this._currentSizeGradient,E._currentSize1=this._currentSize1,E._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(E._currentAngularSpeedGradient=this._currentAngularSpeedGradient,E._currentAngularSpeed1=this._currentAngularSpeed1,E._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(E._currentVelocityGradient=this._currentVelocityGradient,E._currentVelocity1=this._currentVelocity1,E._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(E._currentLimitVelocityGradient=this._currentLimitVelocityGradient,E._currentLimitVelocity1=this._currentLimitVelocity1,E._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(E._currentDragGradient=this._currentDragGradient,E._currentDrag1=this._currentDrag1,E._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(E._initialStartSpriteCellId=this._initialStartSpriteCellId,E._initialEndSpriteCellId=this._initialEndSpriteCellId,E._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(E.remapData&&this.remapData?E.remapData.l(this.remapData):E.remapData=new n.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(E._randomNoiseCoordinates1?(E._randomNoiseCoordinates1.l(this._randomNoiseCoordinates1),E._randomNoiseCoordinates2.l(this._randomNoiseCoordinates2)):(E._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),E._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}J._Count=0;var EE=d(12516),HE=(d(12560),d(12768)),dE=d(12763),nE=d(12650);function ZE(E,H){const d=(0,t.RandomRange)(0,1);g.gg.LerpToRef(H.color1,H.color2,d,E.color),H.colorDead.subtractToRef(E.color,H._colorDiff),H._colorDiff.scaleToRef(1/E.lifeTime,E.colorStep)}function IE(E,H){E._currentColorGradient=H._colorGradients[0],E._currentColorGradient.getColorToRef(E.color),E._currentColor1.l(E.color),H._colorGradients.length>1?H._colorGradients[1].getColorToRef(E._currentColor2):E._currentColor2.l(E.color)}function gE(E,H){const d=H._colorGradients;mE.GetCurrentGradient(H._ratio,d,((H,d,n)=>{H!==E._currentColorGradient&&(E._currentColor1.l(E._currentColor2),d.getColorToRef(E._currentColor2),E._currentColorGradient=H),g.gg.LerpToRef(E._currentColor1,E._currentColor2,n,E.color)}))}function lE(E,H){E.colorStep.scaleToRef(H._scaledUpdateSpeed,H._scaledColorStep),E.color.addInPlace(H._scaledColorStep),E.color.a<0&&(E.color.a=0)}function rE(E,H){mE.GetCurrentGradient(H._ratio,H._angularSpeedGradients,((H,d,n)=>{H!==E._currentAngularSpeedGradient&&(E._currentAngularSpeed1=E._currentAngularSpeed2,E._currentAngularSpeed2=d.getFactor(),E._currentAngularSpeedGradient=H),E.angularSpeed=(0,t.Lerp)(E._currentAngularSpeed1,E._currentAngularSpeed2,n)}))}function tE(E,H){E.angle+=E.angularSpeed*H._scaledUpdateSpeed}function SE(E,H){H.particleEmitterType.startDirectionFunction(H._emitterWorldMatrix,E.direction,E,H.isLocal,H._emitterInverseWorldMatrix)}function ME(E,H){H.startDirectionFunction(H._emitterWorldMatrix,E.direction,E,H.isLocal)}function VE(E,H){E._currentVelocityGradient=H._velocityGradients[0],E._currentVelocity1=E._currentVelocityGradient.getFactor(),H._velocityGradients.length>1?E._currentVelocity2=H._velocityGradients[1].getFactor():E._currentVelocity2=E._currentVelocity1}function CE(E,H){E._currentLimitVelocityGradient=H._limitVelocityGradients[0],E._currentLimitVelocity1=E._currentLimitVelocityGradient.getFactor(),H._limitVelocityGradients.length>1?E._currentLimitVelocity2=H._limitVelocityGradients[1].getFactor():E._currentLimitVelocity2=E._currentLimitVelocity1}function wE(E,H){mE.GetCurrentGradient(H._ratio,H._velocityGradients,((d,n,Z)=>{d!==E._currentVelocityGradient&&(E._currentVelocity1=E._currentVelocity2,E._currentVelocity2=n.getFactor(),E._currentVelocityGradient=d),H._directionScale*=(0,t.Lerp)(E._currentVelocity1,E._currentVelocity2,Z)}))}function RE(E,H){mE.GetCurrentGradient(H._ratio,H._limitVelocityGradients,((d,n,Z)=>{d!==E._currentLimitVelocityGradient&&(E._currentLimitVelocity1=E._currentLimitVelocity2,E._currentLimitVelocity2=n.getFactor(),E._currentLimitVelocityGradient=d);const I=(0,t.Lerp)(E._currentLimitVelocity1,E._currentLimitVelocity2,Z);E.direction.length()>I&&E.direction.scaleInPlace(H.limitVelocityDamping)}))}function QE(E,H){E.direction.scaleToRef(H._directionScale,H._scaledDirection)}function LE(E,H){H.particleEmitterType.startPositionFunction(H._emitterWorldMatrix,E.position,E,H.isLocal)}function DE(E,H){H.startPositionFunction(H._emitterWorldMatrix,E.position,E,H.isLocal)}function eE(E,H){E.Er?E.Er.l(E.position):E.Er=E.position.clone(),n.wH.TransformCoordinatesToRef(E.Er,H._emitterWorldMatrix,E.position)}function sE(E,H){H.isLocal&&E.Er?(E.Er.addInPlace(H._scaledDirection),n.wH.TransformCoordinatesToRef(E.Er,H._emitterWorldMatrix,E.position)):E.position.addInPlace(H._scaledDirection)}function iE(E,H){E._currentDragGradient=H._dragGradients[0],E._currentDrag1=E._currentDragGradient.getFactor(),H._dragGradients.length>1?E._currentDrag2=H._dragGradients[1].getFactor():E._currentDrag2=E._currentDrag1}function pE(E,H){mE.GetCurrentGradient(H._ratio,H._dragGradients,((d,n,Z)=>{d!==E._currentDragGradient&&(E._currentDrag1=E._currentDrag2,E._currentDrag2=n.getFactor(),E._currentDragGradient=d);const I=(0,t.Lerp)(E._currentDrag1,E._currentDrag2,Z);H._scaledDirection.scaleInPlace(1-I)}))}function fE(E,H){E._randomNoiseCoordinates1?(E._randomNoiseCoordinates1.en(Math.random(),Math.random(),Math.random()),E._randomNoiseCoordinates2.en(Math.random(),Math.random(),Math.random())):(E._randomNoiseCoordinates1=new n.wH(Math.random(),Math.random(),Math.random()),E._randomNoiseCoordinates2=new n.wH(Math.random(),Math.random(),Math.random()))}function PE(E,H){const d=H._noiseTextureData,Z=H._noiseTextureSize;if(d&&Z&&E._randomNoiseCoordinates1){const I=H._fetchR(E._randomNoiseCoordinates1.x,E._randomNoiseCoordinates1.y,Z.width,Z.height,d),g=H._fetchR(E._randomNoiseCoordinates1.z,E._randomNoiseCoordinates2.x,Z.width,Z.height,d),l=H._fetchR(E._randomNoiseCoordinates2.y,E._randomNoiseCoordinates2.z,Z.width,Z.height,d),r=n.TmpVectors.wH[0],t=n.TmpVectors.wH[1];r.en((2*I-1)*H.noiseStrength.x,(2*g-1)*H.noiseStrength.y,(2*l-1)*H.noiseStrength.z),r.scaleToRef(H._tempScaledUpdateSpeed,t),E.direction.addInPlace(t)}}function jE(E,H){H.gravity.scaleToRef(H._tempScaledUpdateSpeed,H._scaledGravity),E.direction.addInPlace(H._scaledGravity)}function XE(E,H){E.size=(0,t.RandomRange)(H.minSize,H.maxSize),E.scale.en((0,t.RandomRange)(H.minScaleX,H.maxScaleX),(0,t.RandomRange)(H.minScaleY,H.maxScaleY))}function WE(E,H){E._currentSizeGradient=H._sizeGradients[0],E._currentSize1=E._currentSizeGradient.getFactor(),E.size=E._currentSize1,H._sizeGradients.length>1?E._currentSize2=H._sizeGradients[1].getFactor():E._currentSize2=E._currentSize1,E.scale.en((0,t.RandomRange)(H.minScaleX,H.maxScaleX),(0,t.RandomRange)(H.minScaleY,H.maxScaleY))}function UE(E,H){const d=H._actualFrame/H.targetStopDuration;mE.GetCurrentGradient(d,H._startSizeGradients,((d,n,Z)=>{d!==H._currentStartSizeGradient&&(H._currentStartSize1=H._currentStartSize2,H._currentStartSize2=n.getFactor(),H._currentStartSizeGradient=d);const I=(0,t.Lerp)(H._currentStartSize1,H._currentStartSize2,Z);E.scale.scaleInPlace(I)}))}function YE(E,H){mE.GetCurrentGradient(H._ratio,H._sizeGradients,((H,d,n)=>{H!==E._currentSizeGradient&&(E._currentSize1=E._currentSize2,E._currentSize2=d.getFactor(),E._currentSizeGradient=H),E.size=(0,t.Lerp)(E._currentSize1,E._currentSize2,n)}))}function cE(E,H){E.remapData=new n.Vector4(0,1,0,1)}function uE(E,H){H._colorRemapGradients&&H._colorRemapGradients.length>0&&mE.GetCurrentGradient(H._ratio,H._colorRemapGradients,((H,d,n)=>{const Z=(0,t.Lerp)(H.factor1,d.factor1,n),I=(0,t.Lerp)(H.factor2,d.factor2,n);E.remapData.x=Z,E.remapData.y=I-Z})),H._alphaRemapGradients&&H._alphaRemapGradients.length>0&&mE.GetCurrentGradient(H._ratio,H._alphaRemapGradients,((H,d,n)=>{const Z=(0,t.Lerp)(H.factor1,d.factor1,n),I=(0,t.Lerp)(H.factor2,d.factor2,n);E.remapData.z=Z,E.remapData.w=I-Z}))}function oE(E,H){const d=(0,t.Clamp)(H._actualFrame/H.targetStopDuration);mE.GetCurrentGradient(d,H._lifeTimeGradients,((H,n)=>{const Z=H,I=n,g=Z.getFactor(),l=I.getFactor(),r=(d-Z.gradient)/(I.gradient-Z.gradient);E.lifeTime=(0,t.Lerp)(g,l,r)})),H._emitPower=(0,t.RandomRange)(H.minEmitPower,H.maxEmitPower)}function FE(E,H){E.lifeTime=(0,t.RandomRange)(H.minLifeTime,H.maxLifeTime),H._emitPower=(0,t.RandomRange)(H.minEmitPower,H.maxEmitPower)}function aE(E,H){0===H._emitPower?(E._initialDirection?E._initialDirection.l(E.direction):E._initialDirection=E.direction.clone(),E.direction.set(0,0,0)):(E._initialDirection=null,E.direction.scaleInPlace(H._emitPower)),E.direction.addInPlace(H._inheritedVelocityOffset)}function kE(E,H){E.angularSpeed=(0,t.RandomRange)(H.minAngularSpeed,H.maxAngularSpeed),E.angle=(0,t.RandomRange)(H.minInitialRotation,H.maxInitialRotation)}function OE(E,H){E._currentAngularSpeedGradient=H._angularSpeedGradients[0],E.angularSpeed=E._currentAngularSpeedGradient.getFactor(),E._currentAngularSpeed1=E.angularSpeed,H._angularSpeedGradients.length>1?E._currentAngularSpeed2=H._angularSpeedGradients[1].getFactor():E._currentAngularSpeed2=E._currentAngularSpeed1,E.angle=(0,t.RandomRange)(H.minInitialRotation,H.maxInitialRotation)}function GE(E,H){E._initialStartSpriteCellId=H.startSpriteCellID,E._initialEndSpriteCellId=H.endSpriteCellID,E._initialSpriteCellLoop=H.spriteCellLoop}function xE(E,H){E.previousItem=H.previousItem,E.nextItem=H,H.previousItem&&(H.previousItem.nextItem=E),H.previousItem=E}function qE(E,H){E.previousItem=H,E.nextItem=H.nextItem,H.nextItem&&(H.nextItem.previousItem=E),H.nextItem=E}function bE(E,H){let d=H;for(;d.nextItem;)d=d.nextItem;E.previousItem=d,E.nextItem=d.nextItem,d.nextItem=E}function hE(E){E.previousItem&&(E.previousItem.nextItem=E.nextItem),E.nextItem&&(E.nextItem.previousItem=E.previousItem)}class yE extends r{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(E){this._startDirectionFunction!==E&&(this._startDirectionFunction=E,this._directionProcessing.process=E?ME:SE)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(E){this._startPositionFunction!==E&&(this._startPositionFunction=E,this._positionCreation.process=E?DE:LE)}set onDispose(E){this._onDisposeObserver&&this.Qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qd.add(E)}get M(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(E){this._useRampGradients!==E&&(this._useRampGradients=E,this._resetEffect(),E?(this._rampCreation={process:cE,previousItem:null,nextItem:null},qE(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:uE,previousItem:null,nextItem:null},qE(this._remapGradientProcessing,this._gravityProcessing)):(hE(this._rampCreation),hE(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(E){this._isLocal!==E&&(this._isLocal=E,E?(this._isLocalCreation={process:eE,previousItem:null,nextItem:null},qE(this._isLocalCreation,this._positionCreation)):hE(this._isLocalCreation))}get particles(){return this.tV}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(E){this._animationSheetEnabled!==E&&(this._animationSheetEnabled=E,E?(this._sheetCreation={process:GE,previousItem:null,nextItem:null},qE(this._sheetCreation,this._colorCreation)):hE(this._sheetCreation),this._reset())}getActiveCount(){return this.tV.length}getClassName(){return"Pg"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var E;let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(E=this._customWrappers[H])||void 0===E?void 0:E.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[E]??this._customWrappers[0]}setCustomEffect(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[H]=new EE.c(this._engine),this._customWrappers[H].effect=E,this._customWrappers[H].drawContext&&(this._customWrappers[H].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new T.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(E){if(this.noiseTexture!==E){if(this._noiseTexture=E,!E)return hE(this._noiseCreation),void hE(this._noiseProcessing);this._noiseCreation={process:fE,previousItem:null,nextItem:null},qE(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:PE,previousItem:null,nextItem:null},qE(this._noiseProcessing,this._positionProcessing)}}constructor(E,H,d){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(E),this._emitterInverseWorldMatrix=n.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new n.wH,this.Qd=new T.e,this.onStoppedObservable=new T.e,this.onStartedObservable=new T.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.tV=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new g.gg(0,0,0,0),this._colorDiff=new g.gg(0,0,0,0),this._scaledDirection=n.wH.Zero(),this._scaledGravity=n.wH.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=E=>{},this.recycleParticle=E=>{const H=this.tV.pop();H!==E&&H.copyTo(E),this._stockParticles.push(H)},this._createParticle=()=>{let E;return 0!==this._stockParticles.length?(E=this._stockParticles.pop(),E._reset()):E=new J(this),this._prepareParticle(E),E},this.paused=!1,this._shadersLoaded=!1,this._capacity=H,this._epsilon=l,d&&"Scene"!==d.getClassName()?(this._engine=d,this.defaultProjectionMatrix=n.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=d||B.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.lV.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:FE,previousItem:null,nextItem:null},this._positionCreation={process:LE,previousItem:null,nextItem:null},qE(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:SE,previousItem:null,nextItem:null},qE(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:aE,previousItem:null,nextItem:null},qE(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:XE,previousItem:null,nextItem:null},qE(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:kE,previousItem:null,nextItem:null},qE(this._angleCreation,this._sizeCreation),this._colorCreation={process:ZE,previousItem:null,nextItem:null},qE(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,r||(this._colorProcessing={process:lE,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:tE,previousItem:null,nextItem:null},qE(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:QE,previousItem:null,nextItem:null},qE(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:sE,previousItem:null,nextItem:null},qE(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:jE,previousItem:null,nextItem:null},qE(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=I,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new EE.c(this._engine)},this._customWrappers[0].effect=Z,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new M,this.updateFunction=E=>{var H;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(H=this.noiseTexture.getContent())||void 0===H||H.then((E=>{this._noiseTextureData=E})));const d=E===this.tV;for(let n=0;n<E.length;n++){const H=E[n];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const Z=H.age;if(H.age+=this._tempScaledUpdateSpeed,H.age>H.lifeTime){const E=H.age-Z,d=H.lifeTime-Z;this._tempScaledUpdateSpeed=d*this._tempScaledUpdateSpeed/E,H.age=H.lifeTime}this._ratio=H.age/H.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let I=this._updateQueueStart;for(;I;)I.process(H,this),I=I.nextItem;if(this._isAnimationSheetEnabled&&!r&&H.updateCellIndex(),H._inheritParticleInfoToSubEmitters(),H.age>=H.lifeTime){if(this._emitFromParticle(H),H._attachedSubEmitters){for(const E of H._attachedSubEmitters)E.particleSystem.disposeOnStop=!0,E.particleSystem.stop();H._attachedSubEmitters=null}this.recycleParticle(H),d&&n--}else;}}}serialize(E){throw new Error("Method not implemented.")}clone(E,H){throw new Error("Method not implemented.")}_addFactorGradient(E,H,d,n){const Z=new N(H,d,n);E.push(Z),E.sort(((E,H)=>E.gradient<H.gradient?-1:E.gradient>H.gradient?1:0))}_removeFactorGradient(E,H){if(!E)return;let d=0;for(const n of E){if(n.gradient===H){E.splice(d,1);break}d++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=oE:this._lifeTimeCreation.process=FE}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:UE,previousItem:null,nextItem:null},qE(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(hE(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(E){this.targetStopDuration!==E&&(this._targetStopDuration=E,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(E,H,d){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,E,H,d),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(E){return this._removeFactorGradient(this._lifeTimeGradients,E),this._syncLifeTimeCreation(),this}addSizeGradient(E,H,d){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=WE,this._sizeGradientProcessing={process:YE,previousItem:null,nextItem:null},xE(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,E,H,d),this}removeSizeGradient(E){var H;return this._removeFactorGradient(this._sizeGradients,E),0===(null===(H=this._sizeGradients)||void 0===H?void 0:H.length)&&(hE(this._sizeGradientProcessing),this._sizeCreation.process=XE),this}addColorRemapGradient(E,H,d){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,E,H,d),this}removeColorRemapGradient(E){return this._removeFactorGradient(this._colorRemapGradients,E),this}addAlphaRemapGradient(E,H,d){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,E,H,d),this}removeAlphaRemapGradient(E){return this._removeFactorGradient(this._alphaRemapGradients,E),this}addAngularSpeedGradient(E,H,d){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=OE,this._angularSpeedGradientProcessing={process:rE,previousItem:null,nextItem:null},xE(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,E,H,d),this}removeAngularSpeedGradient(E){var H;return this._removeFactorGradient(this._angularSpeedGradients,E),0===(null===(H=this._angularSpeedGradients)||void 0===H?void 0:H.length)&&(this._angleCreation.process=kE,hE(this._angularSpeedGradientProcessing)),this}addVelocityGradient(E,H,d){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:VE,previousItem:null,nextItem:null},qE(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:wE,previousItem:null,nextItem:null},xE(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,E,H,d),this}removeVelocityGradient(E){var H;return this._removeFactorGradient(this._velocityGradients,E),0===(null===(H=this._velocityGradients)||void 0===H?void 0:H.length)&&(hE(this._velocityCreation),hE(this._velocityGradientProcessing)),this}addLimitVelocityGradient(E,H,d){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:CE,previousItem:null,nextItem:null},qE(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:RE,previousItem:null,nextItem:null},qE(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,E,H,d),this}removeLimitVelocityGradient(E){var H;return this._removeFactorGradient(this._limitVelocityGradients,E),0===(null===(H=this._limitVelocityGradients)||void 0===H?void 0:H.length)&&(hE(this._limitVelocityCreation),hE(this._limitVelocityGradientProcessing)),this}addDragGradient(E,H,d){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:iE,previousItem:null,nextItem:null},xE(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:pE,previousItem:null,nextItem:null},xE(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,E,H,d),this}removeDragGradient(E){var H;return this._removeFactorGradient(this._dragGradients,E),0===(null===(H=this._dragGradients)||void 0===H?void 0:H.length)&&(hE(this._dragCreation),hE(this._dragGradientProcessing)),this}addEmitRateGradient(E,H,d){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,E,H,d),this}removeEmitRateGradient(E){return this._removeFactorGradient(this._emitRateGradients,E),this}addStartSizeGradient(E,H,d){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,E,H,d),this._syncStartSizeCreation(),this}removeStartSizeGradient(E){return this._removeFactorGradient(this._startSizeGradients,E),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const E=new Uint8Array(4*this._rawTextureWidth),H=g.TmpColors.DH[0];for(let d=0;d<this._rawTextureWidth;d++){const n=d/this._rawTextureWidth;mE.GetCurrentGradient(n,this._rampGradients,((n,Z,I)=>{g.DH.LerpToRef(n.color,Z.color,I,H),E[4*d]=255*H.r,E[4*d+1]=255*H.g,E[4*d+2]=255*H.b,E[4*d+3]=255}))}this._rampGradientsTexture=A.b.CreateRGBATexture(E,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((E,H)=>E.gradient<H.gradient?-1:E.gradient>H.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(E,H){this._rampGradients||(this._rampGradients=[]);const d=new K(E,H);return this._rampGradients.push(d),this._syncRampGradientTexture(),this}removeRampGradient(E){return this._removeGradientAndTexture(E,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(E,H,d){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=IE,this._colorProcessing.process=gE);const n=new z(E,H,d);return this._colorGradients.push(n),this._colorGradients.sort(((E,H)=>E.gradient<H.gradient?-1:E.gradient>H.gradient?1:0)),this}removeColorGradient(E){if(!this._colorGradients)return this;let H=0;for(const d of this._colorGradients){if(d.gradient===E){this._colorGradients.splice(H,1);break}H++}return 0===this._colorGradients.length&&(this._colorCreation.process=ZE,this._colorProcessing.process=lE),this}resetDrawCache(){if(this._drawWrappers){for(const E of this._drawWrappers)if(E)for(const H of E)null===H||void 0===H||H.dispose();this._drawWrappers=[]}}_fetchR(E,H,d,n,Z){return Z[4*(((E=.5*Math.abs(E)+.5)*d%d|0)+((H=.5*Math.abs(H)+.5)*n%n|0)*d)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const E=this._engine,H=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*H),this._vertexBuffer=new i.e(E,this._vertexData,!0,H);let d=0;const n=this._vertexBuffer.createVertexBuffer(i.g.PositionKind,d,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[i.g.PositionKind]=n,d+=3;const Z=this._vertexBuffer.createVertexBuffer(i.g.ColorKind,d,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[i.g.ColorKind]=Z,d+=4;const I=this._vertexBuffer.createVertexBuffer("angle",d,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=I,d+=1;const g=this._vertexBuffer.createVertexBuffer("size",d,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=g,d+=2,this._isAnimationSheetEnabled){const E=this._vertexBuffer.createVertexBuffer("cellIndex",d,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=E,d+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const E=this._vertexBuffer.createVertexBuffer("direction",d,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=E,d+=3}if(this._useRampGradients){const E=this._vertexBuffer.createVertexBuffer("remapData",d,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=E,d+=4}let l;if(this._useInstancing){const H=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new i.e(E,H,!1,2),l=this._spriteBuffer.createVertexBuffer("offset",0,2)}else l=this._vertexBuffer.createVertexBuffer("offset",d,2,this._vertexBufferSize,this._useInstancing),d+=2;this._vertexBuffers.offset=l,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const E=[],H=[];let d=0;for(let n=0;n<this._capacity;n++)E.push(d),E.push(d+1),E.push(d+2),E.push(d),E.push(d+2),E.push(d+3),H.push(d,d+1,d+1,d+2,d+2,d+3,d+3,d,d,d+3),d+=4;this._indexBuffer=this._engine.createIndexBuffer(E),this._linesIndexBuffer=this._engine.createIndexBuffer(H)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(E)setTimeout((()=>{this.start(0)}),E);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var H;-1!==(null===(H=this.nH)||void 0===H?void 0:H.getClassName().indexOf("Mesh"))&&this.nH.yd(!0);const E=this.noiseTexture;if(E&&E.onGeneratedObservable)E.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let H=0;H<this.preWarmCycles;H++)this.animate(!0),E.render()}))}));else for(let H=0;H<this.preWarmCycles;H++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(E))}_postStop(E){}reset(){this._stockParticles.length=0,this.tV.length=0}_appendParticleVertex(E,H,d,Z){let I=E*this._vertexBufferSize;if(this._vertexData[I++]=H.position.x+this.jt.x,this._vertexData[I++]=H.position.y+this.jt.y,this._vertexData[I++]=H.position.z+this.jt.z,this._vertexData[I++]=H.color.r,this._vertexData[I++]=H.color.g,this._vertexData[I++]=H.color.b,this._vertexData[I++]=H.color.a,this._vertexData[I++]=H.angle,this._vertexData[I++]=H.scale.x*H.size,this._vertexData[I++]=H.scale.y*H.size,this._isAnimationSheetEnabled&&(this._vertexData[I++]=H.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[I++]=H.direction.x,this._vertexData[I++]=H.direction.y,this._vertexData[I++]=H.direction.z);else if(H._initialDirection){let E=H._initialDirection;this.isLocal&&(n.wH.TransformNormalToRef(E,this._emitterWorldMatrix,n.TmpVectors.wH[0]),E=n.TmpVectors.wH[0]),0===E.x&&0===E.z&&(E.x=.001),this._vertexData[I++]=E.x,this._vertexData[I++]=E.y,this._vertexData[I++]=E.z}else{let E=H.direction;this.isLocal&&(n.wH.TransformNormalToRef(E,this._emitterWorldMatrix,n.TmpVectors.wH[0]),E=n.TmpVectors.wH[0]),0===E.x&&0===E.z&&(E.x=.001),this._vertexData[I++]=E.x,this._vertexData[I++]=E.y,this._vertexData[I++]=E.z}this._useRampGradients&&H.remapData&&(this._vertexData[I++]=H.remapData.x,this._vertexData[I++]=H.remapData.y,this._vertexData[I++]=H.remapData.z,this._vertexData[I++]=H.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===d?d=this._epsilon:1===d&&(d=1-this._epsilon),0===Z?Z=this._epsilon:1===Z&&(Z=1-this._epsilon)),this._vertexData[I++]=d,this._vertexData[I++]=Z)}_prepareParticle(E){}_createNewOnes(E){let H;for(let d=0;d<E&&this.tV.length!==this._capacity;d++){H=this._createParticle(),this.tV.push(H);let E=this._createQueueStart;for(;E;)E.process(H,this),E=E.nextItem;H._inheritParticleInfoToSubEmitters()}}_update(E){if(this._alive=this.tV.length>0,this.nH.position){const E=this.nH;this._emitterWorldMatrix=E.getWorldMatrix()}else{const E=this.nH;this._emitterWorldMatrix=n.Matrix.Translation(E.x,E.y,E.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.tV),this._createNewOnes(E)}static _GetAttributeNamesOrOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=[i.g.PositionKind,i.g.ColorKind,"angle","offset","size"];return E&&n.push("cellIndex"),H||n.push("direction"),d&&n.push("remapData"),n}static _GetEffectCreationOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,HE.e)(n),E&&n.push("particlesInfos"),H&&n.push("logarithmicDepthConstant"),d&&(n.push("vFogInfos"),n.push("vFogColor")),n}fillDefines(E,H){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,HE.m)(this,this._scene,E),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&E.push("#define FOG")),this._isAnimationSheetEnabled&&E.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&E.push("#define LOGARITHMICDEPTH"),H===r.BLENDMODE_MULTIPLY&&E.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&E.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(E.push("#define BILLBOARD"),this.billboardMode){case 2:E.push("#define BILLBOARDY");break;case 8:case 9:E.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&E.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:E.push("#define BILLBOARDMODE_ALL")}d&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),E.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(E,H,d){H.push(...yE._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),E.push(...yE._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),d.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,nE.f)(E,this._imageProcessingConfigurationDefines),(0,nE.c)(d,this._imageProcessingConfigurationDefines))}_getWrapper(E){const H=this._getCustomDrawWrapper(E);if(null!==H&&void 0!==H&&H.effect)return H;const d=[];this.fillDefines(d,E);const n=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let Z=this._drawWrappers[n];Z||(Z=this._drawWrappers[n]=[]);let I=Z[E];I||(I=new EE.c(this._engine),I.drawContext&&(I.drawContext.useInstancing=this._useInstancing),Z[E]=I);const g=d.join("\n");if(I.defines!==g){const E=[],H=[],d=[];this.fillUniformsAttributesAndSamplerNames(H,E,d),I.setEffect(this._engine.createEffect("particles",E,H,d,g,void 0,void 0,void 0,void 0,this._shaderLanguage),g)}return I}animate(){var E;let H,d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!d&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(d?this.preWarmStepOffset:(null===(E=this._scene)||void 0===E?void 0:E.getAnimationRatio())||1),this.manualEmitCount>-1)H=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let E=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const H=this._actualFrame/this.targetStopDuration;mE.GetCurrentGradient(H,this._emitRateGradients,((H,d,n)=>{H!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=d.getFactor(),this._currentEmitRateGradient=H),E=(0,t.Lerp)(this._currentEmitRate1,this._currentEmitRate2,n)}))}H=E*this._scaledUpdateSpeed|0,this._newPartsExcess+=E*this._scaledUpdateSpeed-H}if(this._newPartsExcess>1&&(H+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?H=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(H),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!d){let E=0;for(let H=0;H<this.tV.length;H++){const d=this.tV[H];this._appendParticleVertices(E,d),E+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.tV.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(E,H){this._appendParticleVertex(E++,H,0,0),this._useInstancing||(this._appendParticleVertex(E++,H,1,0),this._appendParticleVertex(E++,H,1,1),this._appendParticleVertex(E++,H,0,1))}rebuild(){var E;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(E=this._spriteBuffer)||void 0===E||E._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!yE.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(d.bind(d,13863)),Promise.resolve().then(d.bind(d,13809))])):await Promise.all([Promise.resolve().then(d.bind(d,13802)),Promise.resolve().then(d.bind(d,13796))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.nH||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==r.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(r.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(r.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(E){const H=this._getWrapper(E),d=H.effect,Z=this._engine;Z.enableEffect(H);const I=this.defaultViewMatrix??this._scene.getViewMatrix();if(d.setTexture("diffuseSampler",this.particleTexture),d.setMatrix("view",I),d.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const E=this.particleTexture.getBaseSize();d.setFloat3("particlesInfos",this.spriteCellWidth/E.width,this.spriteCellHeight/E.height,this.spriteCellWidth/E.width)}if(d.setVector2("translationPivot",this.translationPivot),d.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const E=this._scene.activeCamera;d.setVector3("eyePosition",E.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),d.setTexture("rampSampler",this._rampGradientsTexture));const g=d.defines;var l,r,t,S,M,V;(this._scene&&((0,HE.f)(d,this,this._scene),this.applyFog&&(0,dE.d)(this._scene,void 0,d)),g.indexOf("#define BILLBOARDMODE_ALL")>=0&&(I.invertToRef(n.TmpVectors.Matrix[0]),d.setMatrix("invView",n.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?Z.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,d):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,d)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?Z.bindBuffers(this._vertexBuffers,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBuffer:this._indexBuffer,d):Z.bindBuffers(this._vertexBuffers,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBufferUseInstancing:null,d);(this.useLogarithmicDepth&&this._scene&&(0,dE.j)(g,d,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(d),this._setEngineBasedOnBlendMode(E),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(d),this._useInstancing)?null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?Z.drawElementsType(6,0,10,this.tV.length):Z.drawArraysType(7,0,4,this.tV.length):null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?Z.drawElementsType(1,0,10*this.tV.length):Z.drawElementsType(0,0,6*this.tV.length);return this.tV.length}render(){if(!this.isReady()||!this.tV.length)return 0;const E=this._engine;E.setState&&(E.setState(!1),this.forceDepthWrite&&E.setDepthWrite(!0));let H=0;return H=this.blendMode===r.BLENDMODE_MULTIPLYADD?this._render(r.BLENDMODE_MULTIPLY)+this._render(r.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),H}_onDispose(){}dispose(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),E&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),E&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(H,d),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const E=this._scene.lV.indexOf(this);E>-1&&this._scene.lV.splice(E,1),this._scene._activeParticleSystems.dispose()}this.Qd.notifyObservers(this),this.Qd.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}yE.ForceGLSL=!1;var vE,zE=d(12256);!function(E){E[E.ATTACHED=0]="ATTACHED",E[E.END=1]="END"}(vE||(vE={}));class KE{constructor(E){if(this.particleSystem=E,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!E.nH||!E.nH.dispose){const H=(0,l.c)("BABYLON.AbstractMesh");E.nH=new H("SubemitterSystemEmitter",E.fE()),E._disposeEmitterOnDispose=!0}}clone(){let E=this.particleSystem.nH;if(E){if(E instanceof n.wH)E=E.clone();else if(-1!==E.getClassName().indexOf("Mesh")){E=new((0,l.c)("BABYLON.Mesh"))("",E.fE()),E.isVisible=!1}}else E=new n.wH;const H=new KE(this.particleSystem.clone(this.particleSystem.name,E));return H.particleSystem.name+="Clone",H.type=this.type,H.inheritDirection=this.inheritDirection,H.inheritedVelocityAmount=this.inheritedVelocityAmount,H.particleSystem._disposeEmitterOnDispose=!0,H.particleSystem.disposeOnStop=!0,H}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={};return H.type=this.type,H.inheritDirection=this.inheritDirection,H.inheritedVelocityAmount=this.inheritedVelocityAmount,H.particleSystem=this.particleSystem.serialize(E),H}static _ParseParticleSystem(E,H,d){throw(0,zE.c)("ParseParticle")}static Parse(E,H,d){const n=E.particleSystem,Z=new KE(KE._ParseParticleSystem(n,H,d,!0));return Z.type=E.type,Z.inheritDirection=E.inheritDirection,Z.inheritedVelocityAmount=E.inheritedVelocityAmount,Z.particleSystem._isSubEmitter=!0,Z}dispose(){this.particleSystem.dispose()}}var NE=d(12296);function mH(E,H){const d=new L;return d.direction1=E,d.direction2=H,d}function TE(){return new Q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function AE(){return new D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function BE(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.wH(0,1,0),d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.wH(0,1,0);return new e(E,H,d)}function JE(){return new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function EH(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.wH(0,1,0),I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.wH(0,1,0);return new R(E,H,d,Z,I)}function HH(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new V(E,H)}function dH(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.wH(0,1,0),Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.wH(0,1,0);return new C(E,H,d,Z)}const nH=n.wH.Zero(),ZH=n.wH.Zero(),IH=n.wH.Zero();class gH{constructor(){this.strength=0,this.position=n.wH.Zero()}_processParticle(E,H){this.position.subtractToRef(E.position,nH);const d=nH.lengthSquared()+1;nH.normalize().scaleToRef(this.strength/d,ZH),ZH.scaleToRef(H._tempScaledUpdateSpeed,IH),E.direction.addInPlace(IH)}serialize(){return{position:this.position.kd(),strength:this.strength}}}class lH extends yE{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=E=>{if(!this._subEmitters||0===this._subEmitters.length)return;const H=Math.floor(Math.random()*this._subEmitters.length);for(const d of this._subEmitters[H])if(1===d.type){const H=d.clone();E._inheritParticleInfoToSubEmitter(H),H.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(H.particleSystem),H.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(E,H){const d=mH(E,H);return this.particleEmitterType=d,d}get flowMap(){return this._flowMap}set flowMap(E){this._flowMap!==E&&(this._flowMap=E,this._flowMapUpdate&&(hE(this._flowMapUpdate),this._flowMapUpdate=null),E&&(this._flowMapUpdate={process:E=>{var H;const d=null===(H=this.fE())||void 0===H?void 0:H.getTransformMatrix();this._flowMap._processParticle(E,this.flowMapStrength*this._tempScaledUpdateSpeed,d)},previousItem:null,nextItem:null},qE(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(E){this._attractors.push(E),1===this._attractors.length&&(this._attractorUpdate={process:E=>{for(const H of this._attractors)H._processParticle(E,this)},previousItem:null,nextItem:null},qE(this._attractorUpdate,this._directionProcessing))}removeAttractor(E){const H=this._attractors.indexOf(E);-1!==H&&this._attractors.splice(H,1),0===this._attractors.length&&hE(this._attractorUpdate)}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(E)}createHemisphericEmitter(){const E=TE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createSphereEmitter(){const E=AE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createDirectedSphereEmitter(){const E=BE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.wH(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.wH(0,1,0));return this.particleEmitterType=E,E}createCylinderEmitter(){const E=JE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=E,E}createDirectedCylinderEmitter(){const E=EH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.wH(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.wH(0,1,0));return this.particleEmitterType=E,E}createConeEmitter(){const E=HH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=E,E}createDirectedConeEmitter(){const E=dH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.wH(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.wH(0,1,0));return this.particleEmitterType=E,E}createBoxEmitter(E,H,d,n){const Z=new M;return this.particleEmitterType=Z,this.direction1=E,this.direction2=H,this.minEmitBox=d,this.maxEmitBox=n,Z}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const E of this.subEmitters)E instanceof lH?this._subEmitters.push([new KE(E)]):E instanceof KE?this._subEmitters.push([E]):E instanceof Array&&this._subEmitters.push(E)}_stopSubEmitters(){if(this.activeSubSystems){for(const E of this.activeSubSystems)E.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const E=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==E&&this._rootParticleSystem.activeSubSystems.splice(E,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(E){E&&this._stopSubEmitters()}_prepareParticle(E){if(this._subEmitters&&this._subEmitters.length>0){const H=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];E._attachedSubEmitters=[];for(const d of H)if(0===d.type){const H=d.clone();E._attachedSubEmitters.push(H),H.particleSystem.start()}}}_onDispose(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),E&&this.particles)for(const d of this.particles)if(d._attachedSubEmitters)for(let E=d._attachedSubEmitters.length-1;E>=0;E-=1)d._attachedSubEmitters[E].dispose();if(H&&this.activeSubSystems)for(let d=this.activeSubSystems.length-1;d>=0;d-=1)this.activeSubSystems[d].dispose();if(this._subEmitters&&this._subEmitters.length){for(let E=0;E<this._subEmitters.length;E++)for(const H of this._subEmitters[E])H.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.nH&&this.nH.dispose&&this.nH.dispose(!0)}static _Parse(E,H,d,Z){let I;I=d instanceof NE.c?null:d;const r=(0,l.c)("BABYLON.Texture");if(r&&I&&(E.texture?H.particleTexture=r.Parse(E.texture,I,Z):E.textureName&&(H.particleTexture=new r(Z+E.textureName,I,!1,void 0===E.invertY||E.invertY),H.particleTexture.name=E.textureName)),E.emitterId||0===E.emitterId||void 0!==E.nH?E.emitterId&&I?H.nH=I.getLastMeshById(E.emitterId):H.nH=n.wH.eH(E.nH):H.nH=n.wH.Zero(),H.isLocal=!!E.isLocal,void 0!==E.renderingGroupId&&(H.renderingGroupId=E.renderingGroupId),void 0!==E.isBillboardBased&&(H.isBillboardBased=E.isBillboardBased),void 0!==E.billboardMode&&(H.billboardMode=E.billboardMode),void 0!==E.useLogarithmicDepth&&(H.useLogarithmicDepth=E.useLogarithmicDepth),E.animations){for(let d=0;d<E.animations.length;d++){const n=E.animations[d],Z=(0,l.c)("BABYLON.Animation");Z&&H.animations.push(Z.Parse(n))}H.beginAnimationOnStart=E.beginAnimationOnStart,H.beginAnimationFrom=E.beginAnimationFrom,H.beginAnimationTo=E.beginAnimationTo,H.beginAnimationLoop=E.beginAnimationLoop}if(E.autoAnimate&&I&&I.beginAnimation(H,E.autoAnimateFrom,E.autoAnimateTo,E.autoAnimateLoop,E.autoAnimateSpeed||1),H.startDelay=0|E.startDelay,H.minAngularSpeed=E.minAngularSpeed,H.maxAngularSpeed=E.maxAngularSpeed,H.minSize=E.minSize,H.maxSize=E.maxSize,E.minScaleX&&(H.minScaleX=E.minScaleX,H.maxScaleX=E.maxScaleX,H.minScaleY=E.minScaleY,H.maxScaleY=E.maxScaleY),void 0!==E.preWarmCycles&&(H.preWarmCycles=E.preWarmCycles,H.preWarmStepOffset=E.preWarmStepOffset),void 0!==E.minInitialRotation&&(H.minInitialRotation=E.minInitialRotation,H.maxInitialRotation=E.maxInitialRotation),H.minLifeTime=E.minLifeTime,H.maxLifeTime=E.maxLifeTime,H.minEmitPower=E.minEmitPower,H.maxEmitPower=E.maxEmitPower,H.emitRate=E.emitRate,H.gravity=n.wH.eH(E.gravity),E.noiseStrength&&(H.noiseStrength=n.wH.eH(E.noiseStrength)),H.color1=g.gg.eH(E.color1),H.color2=g.gg.eH(E.color2),H.colorDead=g.gg.eH(E.colorDead),H.updateSpeed=E.updateSpeed,H.targetStopDuration=E.targetStopDuration,H.blendMode=E.blendMode,E.colorGradients)for(const n of E.colorGradients)H.addColorGradient(n.gradient,g.gg.eH(n.color1),n.color2?g.gg.eH(n.color2):void 0);if(E.rampGradients){for(const d of E.rampGradients)H.addRampGradient(d.gradient,g.DH.eH(d.color));H.useRampGradients=E.useRampGradients}if(E.colorRemapGradients)for(const n of E.colorRemapGradients)H.addColorRemapGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(E.alphaRemapGradients)for(const n of E.alphaRemapGradients)H.addAlphaRemapGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(E.sizeGradients)for(const n of E.sizeGradients)H.addSizeGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(E.angularSpeedGradients)for(const n of E.angularSpeedGradients)H.addAngularSpeedGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(E.velocityGradients)for(const n of E.velocityGradients)H.addVelocityGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(E.dragGradients)for(const n of E.dragGradients)H.addDragGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(E.emitRateGradients)for(const n of E.emitRateGradients)H.addEmitRateGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(E.startSizeGradients)for(const n of E.startSizeGradients)H.addStartSizeGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(E.lifeTimeGradients)for(const n of E.lifeTimeGradients)H.addLifeTimeGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(E.limitVelocityGradients){for(const d of E.limitVelocityGradients)H.addLimitVelocityGradient(d.gradient,void 0!==d.factor1?d.factor1:d.factor,d.factor2);H.limitVelocityDamping=E.limitVelocityDamping}if(E.noiseTexture&&I){const d=(0,l.c)("BABYLON.ProceduralTexture");H.noiseTexture=d.Parse(E.noiseTexture,I,Z)}let t;if(E.particleEmitterType){switch(E.particleEmitterType.type){case"SphereParticleEmitter":t=new D;break;case"SphereDirectedParticleEmitter":t=new e;break;case"ConeEmitter":case"ConeParticleEmitter":t=new V;break;case"ConeDirectedParticleEmitter":t=new C;break;case"CylinderParticleEmitter":t=new w;break;case"CylinderDirectedParticleEmitter":t=new R;break;case"HemisphericParticleEmitter":t=new Q;break;case"PointParticleEmitter":t=new L;break;case"MeshParticleEmitter":t=new p;break;case"CustomParticleEmitter":t=new s;break;default:t=new M}t.parse(E.particleEmitterType,I)}else t=new M,t.parse(E,I);H.particleEmitterType=t,H.startSpriteCellID=E.startSpriteCellID,H.endSpriteCellID=E.endSpriteCellID,H.spriteCellLoop=E.spriteCellLoop??!0,H.spriteCellWidth=E.spriteCellWidth,H.spriteCellHeight=E.spriteCellHeight,H.spriteCellChangeSpeed=E.spriteCellChangeSpeed,H.spriteRandomStartCell=E.spriteRandomStartCell,H.disposeOnStop=E.disposeOnStop??!1,H.manualEmitCount=E.manualEmitCount??-1}static Parse(E,H,d){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],I=arguments.length>4?arguments[4]:void 0;const l=E.name;let r,t,S=null,M=null;if(H instanceof NE.c?r=H:(t=H,r=t.getEngine()),E.customShader&&r.createEffectForParticles){M=E.customShader;const H=M.shaderOptions.defines.length>0?M.shaderOptions.defines.join("\n"):"";S=r.createEffectForParticles(M.shaderPath.fragmentElement,M.shaderOptions.uniforms,M.shaderOptions.samplers,H)}const V=new lH(l,I||E.Ld,H,S,E.isAnimationSheetEnabled);if(V.customShader=M,V._rootUrl=d,E.id&&(V.id=E.id),E.subEmitters){V.subEmitters=[];for(const n of E.subEmitters){const E=[];for(const Z of n)E.push(KE.Parse(Z,H,d));V.subEmitters.push(E)}}if(E.attractors)for(const g of E.attractors){const E=new gH;E.position=n.wH.eH(g.position),E.strength=g.strength,V.addAttractor(E)}return lH._Parse(E,V,H,d),E.textureMask&&(V.textureMask=g.gg.eH(E.textureMask)),E.jt&&(V.jt=n.wH.eH(E.jt)),E.preventAutoStart&&(V.preventAutoStart=E.preventAutoStart),Z||V.preventAutoStart||V.start(),V}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={};if(lH._Serialize(H,this,E),H.textureMask=this.textureMask.kd(),H.customShader=this.customShader,H.preventAutoStart=this.preventAutoStart,H.jt=this.jt.kd(),this.subEmitters){H.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const d of this._subEmitters){const n=[];for(const H of d)n.push(H.serialize(E));H.subEmitters.push(n)}}if(this._attractors&&this._attractors.length){H.attractors=[];for(const E of this._attractors)H.attractors.push(E.serialize())}return H}static _Serialize(E,H,d){if(E.name=H.name,E.id=H.id,E.Ld=H.getCapacity(),E.disposeOnStop=H.disposeOnStop,E.manualEmitCount=H.manualEmitCount,H.nH.position){const d=H.nH;E.emitterId=d.id}else{const d=H.nH;E.nH=d.kd()}H.particleEmitterType&&(E.particleEmitterType=H.particleEmitterType.serialize()),H.particleTexture&&(d?E.texture=H.particleTexture.serialize():(E.textureName=H.particleTexture.name,E.invertY=!!H.particleTexture._invertY)),E.isLocal=H.isLocal,o.c.AppendSerializedAnimations(H,E),E.beginAnimationOnStart=H.beginAnimationOnStart,E.beginAnimationFrom=H.beginAnimationFrom,E.beginAnimationTo=H.beginAnimationTo,E.beginAnimationLoop=H.beginAnimationLoop,E.startDelay=H.startDelay,E.renderingGroupId=H.renderingGroupId,E.isBillboardBased=H.isBillboardBased,E.billboardMode=H.billboardMode,E.minAngularSpeed=H.minAngularSpeed,E.maxAngularSpeed=H.maxAngularSpeed,E.minSize=H.minSize,E.maxSize=H.maxSize,E.minScaleX=H.minScaleX,E.maxScaleX=H.maxScaleX,E.minScaleY=H.minScaleY,E.maxScaleY=H.maxScaleY,E.minEmitPower=H.minEmitPower,E.maxEmitPower=H.maxEmitPower,E.minLifeTime=H.minLifeTime,E.maxLifeTime=H.maxLifeTime,E.emitRate=H.emitRate,E.gravity=H.gravity.kd(),E.noiseStrength=H.noiseStrength.kd(),E.color1=H.color1.kd(),E.color2=H.color2.kd(),E.colorDead=H.colorDead.kd(),E.updateSpeed=H.updateSpeed,E.targetStopDuration=H.targetStopDuration,E.blendMode=H.blendMode,E.preWarmCycles=H.preWarmCycles,E.preWarmStepOffset=H.preWarmStepOffset,E.minInitialRotation=H.minInitialRotation,E.maxInitialRotation=H.maxInitialRotation,E.startSpriteCellID=H.startSpriteCellID,E.spriteCellLoop=H.spriteCellLoop,E.endSpriteCellID=H.endSpriteCellID,E.spriteCellChangeSpeed=H.spriteCellChangeSpeed,E.spriteCellWidth=H.spriteCellWidth,E.spriteCellHeight=H.spriteCellHeight,E.spriteRandomStartCell=H.spriteRandomStartCell,E.isAnimationSheetEnabled=H.isAnimationSheetEnabled,E.useLogarithmicDepth=H.useLogarithmicDepth;const n=H.getColorGradients();if(n){E.colorGradients=[];for(const H of n){const d={gradient:H.gradient,color1:H.color1.kd()};H.color2?d.color2=H.color2.kd():d.color2=H.color1.kd(),E.colorGradients.push(d)}}const Z=H.getRampGradients();if(Z){E.rampGradients=[];for(const H of Z){const d={gradient:H.gradient,color:H.color.kd()};E.rampGradients.push(d)}E.useRampGradients=H.useRampGradients}const I=H.getColorRemapGradients();if(I){E.colorRemapGradients=[];for(const H of I){const d={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?d.factor2=H.factor2:d.factor2=H.factor1,E.colorRemapGradients.push(d)}}const g=H.getAlphaRemapGradients();if(g){E.alphaRemapGradients=[];for(const H of g){const d={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?d.factor2=H.factor2:d.factor2=H.factor1,E.alphaRemapGradients.push(d)}}const l=H.getSizeGradients();if(l){E.sizeGradients=[];for(const H of l){const d={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?d.factor2=H.factor2:d.factor2=H.factor1,E.sizeGradients.push(d)}}const r=H.getAngularSpeedGradients();if(r){E.angularSpeedGradients=[];for(const H of r){const d={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?d.factor2=H.factor2:d.factor2=H.factor1,E.angularSpeedGradients.push(d)}}const t=H.getVelocityGradients();if(t){E.velocityGradients=[];for(const H of t){const d={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?d.factor2=H.factor2:d.factor2=H.factor1,E.velocityGradients.push(d)}}const S=H.getDragGradients();if(S){E.dragGradients=[];for(const H of S){const d={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?d.factor2=H.factor2:d.factor2=H.factor1,E.dragGradients.push(d)}}const M=H.getEmitRateGradients();if(M){E.emitRateGradients=[];for(const H of M){const d={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?d.factor2=H.factor2:d.factor2=H.factor1,E.emitRateGradients.push(d)}}const V=H.getStartSizeGradients();if(V){E.startSizeGradients=[];for(const H of V){const d={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?d.factor2=H.factor2:d.factor2=H.factor1,E.startSizeGradients.push(d)}}const C=H.getLifeTimeGradients();if(C){E.lifeTimeGradients=[];for(const H of C){const d={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?d.factor2=H.factor2:d.factor2=H.factor1,E.lifeTimeGradients.push(d)}}const w=H.getLimitVelocityGradients();if(w){E.limitVelocityGradients=[];for(const H of w){const d={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?d.factor2=H.factor2:d.factor2=H.factor1,E.limitVelocityGradients.push(d)}E.limitVelocityDamping=H.limitVelocityDamping}H.noiseTexture&&(E.noiseTexture=H.noiseTexture.serialize())}clone(E,H){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n={...this._customWrappers};let Z=null;const I=this._engine;if(I.createEffectForParticles&&null!=this.customShader){Z=this.customShader;const E=Z.shaderOptions.defines.length>0?Z.shaderOptions.defines.join("\n"):"",H=I.createEffectForParticles(Z.shaderPath.fragmentElement,Z.shaderOptions.uniforms,Z.shaderOptions.samplers,E);n[0]?n[0].effect=H:this.setCustomEffect(H,0)}const g=this.serialize(d),l=lH.Parse(g,this._scene||this._engine,this._rootUrl);return l.name=E,l.customShader=Z,l._customWrappers=n,void 0===H&&(H=this.nH),this.noiseTexture&&(l.noiseTexture=this.noiseTexture.clone()),l.nH=H,this.preventAutoStart||l.start(),l}}lH.BILLBOARDMODE_Y=2,lH.BILLBOARDMODE_ALL=7,lH.BILLBOARDMODE_STRETCHED=8,lH.BILLBOARDMODE_STRETCHED_LOCAL=9,KE._ParseParticleSystem=lH.Parse;var rH=d(12638),tH=d(12634),SH=d(12522);SH.b.prototype.createTransformFeedback=function(){const E=this._gl.createTransformFeedback();if(!E)throw new Error("Unable to create Transform Feedback");return E},SH.b.prototype.deleteTransformFeedback=function(E){this._gl.deleteTransformFeedback(E)},SH.b.prototype.bindTransformFeedback=function(E){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,E)},SH.b.prototype.beginTransformFeedback=function(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(E?this._gl.POINTS:this._gl.TRIANGLES)},SH.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},SH.b.prototype.setTranformFeedbackVaryings=function(E,H){this._gl.transformFeedbackVaryings(E,H,this._gl.INTERLEAVED_ATTRIBS)},SH.b.prototype.bindTransformFeedbackBuffer=function(E){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,E?E.underlyingResource:null)},SH.b.prototype.readTransformFeedbackBuffer=function(E){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,E)};const MH="clipPlaneFragmentDeclaration2",VH="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";P.e.IncludesShadersStore[MH]||(P.e.IncludesShadersStore[MH]=VH);d(13705),d(13711),d(13715),d(13722),d(13725),d(13733),d(13735),d(13742);const CH="gpuRenderParticlesPixelShader",wH="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";P.e.ShadersStore[CH]||(P.e.ShadersStore[CH]=wH);const RH="clipPlaneVertexDeclaration2",QH="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";P.e.IncludesShadersStore[RH]||(P.e.IncludesShadersStore[RH]=QH);d(13750),d(13759),d(13767),d(13772);const LH="gpuRenderParticlesVertexShader",DH="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";P.e.ShadersStore[LH]||(P.e.ShadersStore[LH]=DH);class eH extends r{static get IsSupported(){if(!B.b.LastCreatedEngine)return!1;const E=B.b.LastCreatedEngine.getCaps();return E.supportTransformFeedbacks||E.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(E){this._maxActiveParticleCount=Math.min(E,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(E){this.maxActiveParticleCount=E}createPointEmitter(E,H){const d=mH(E,H);return this.particleEmitterType=d,d}createHemisphericEmitter(){const E=TE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createSphereEmitter(){const E=AE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=E,E}createDirectedSphereEmitter(){const E=BE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.wH(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.wH(0,1,0));return this.particleEmitterType=E,E}createCylinderEmitter(){const E=JE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=E,E}createDirectedCylinderEmitter(){const E=EH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.wH(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.wH(0,1,0));return this.particleEmitterType=E,E}createConeEmitter(){const E=HH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=E,E}createDirectedConeEmitter(){const E=dH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.wH(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.wH(0,1,0));return this.particleEmitterType=E,E}createBoxEmitter(E,H,d,n){const Z=new M;return this.particleEmitterType=Z,this.direction1=E,this.direction2=H,this.minEmitBox=d,this.maxEmitBox=n,Z}get flowMap(){return this._flowMap}set flowMap(E){this._flowMap!==E&&(this._flowMap=E)}isReady(){if(!this.nH||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==lH.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(lH.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(lH.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";E?setTimeout((()=>{this.start(0)}),E):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var E;let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(E=this._customWrappers[H])||void 0===E?void 0:E.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[E]??this._customWrappers[0]}setCustomEffect(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[H]=new EE.c(this._engine),this._customWrappers[H].effect=E}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new T.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(E,H,d){return super._removeGradientAndTexture(E,H,d),this._releaseBuffers(),this}addColorGradient(E,H){this._colorGradients||(this._colorGradients=[]);const d=new z(E,H);return this._colorGradients.push(d),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(E&&this._colorGradients.sort(((E,H)=>E.gradient<H.gradient?-1:E.gradient>H.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(E){return this._removeGradientAndTexture(E,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const H in this._drawWrappers){var E;null===(E=this._drawWrappers[H].drawContext)||void 0===E||E.reset()}}_addFactorGradient(E,H,d){const n=new N(H,d);E.push(n),this._releaseBuffers()}addSizeGradient(E,H){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,E,H),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(E){return this._removeGradientAndTexture(E,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(E,H){if(!E)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&E.sort(((E,H)=>E.gradient<H.gradient?-1:E.gradient>H.gradient?1:0));const d=this;d[H]&&(d[H].dispose(),d[H]=null)}addAngularSpeedGradient(E,H){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,E,H),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(E){return this._removeGradientAndTexture(E,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(E,H){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,E,H),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(E){return this._removeGradientAndTexture(E,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(E,H){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,E,H),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(E){return this._removeGradientAndTexture(E,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(E,H){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,E,H),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(E){return this._removeGradientAndTexture(E,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(E){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(E,H,d){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(E),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Qd=new T.e,this.onStoppedObservable=new T.e,this.onStartedObservable=new T.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,d&&"Scene"!==d.getClassName()?(this._engine=d,this.defaultProjectionMatrix=n.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=d||B.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.lV.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,l.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,l.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,l.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,l.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new EE.c(this._engine)},this._customWrappers[0].effect=Z,this._drawWrappers={0:new EE.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(H=H??{}).randomTextureSize||delete H.randomTextureSize;const g={Ld:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...H},r=H;isFinite(r)&&(g.Ld=r),this._capacity=g.Ld,this._maxActiveParticleCount=g.Ld,this._currentActiveCount=0,this._isAnimationSheetEnabled=I,this.particleEmitterType=new M;const t=Math.min(this._engine.getCaps().maxTextureSize,g.randomTextureSize);let S=[];for(let n=0;n<t;++n)S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),S.push(Math.random());this._randomTexture=new A.b(new Float32Array(S),t,1,5,d,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,S=[];for(let n=0;n<t;++n)S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),S.push(Math.random());this._randomTexture2=new A.b(new Float32Array(S),t,1,5,d,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=t}_reset(){this._releaseBuffers()}_createVertexBuffers(E,H,d){const n={};n.position=H.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let Z=3;n.age=H.createVertexBuffer("age",Z,1,this._attributesStrideSize,!0),Z+=1,n.size=H.createVertexBuffer("size",Z,3,this._attributesStrideSize,!0),Z+=3,n.life=H.createVertexBuffer("life",Z,1,this._attributesStrideSize,!0),Z+=1,Z+=4,this.billboardMode===lH.BILLBOARDMODE_STRETCHED&&(n.direction=H.createVertexBuffer("direction",Z,3,this._attributesStrideSize,!0)),Z+=3,this._platform.alignDataInBuffer&&(Z+=1),this.particleEmitterType instanceof s&&(Z+=3,this._platform.alignDataInBuffer&&(Z+=1)),this._colorGradientsTexture||(n.color=H.createVertexBuffer("color",Z,4,this._attributesStrideSize,!0),Z+=4),this._isBillboardBased||(n.initialDirection=H.createVertexBuffer("initialDirection",Z,3,this._attributesStrideSize,!0),Z+=3,this._platform.alignDataInBuffer&&(Z+=1)),this.noiseTexture&&(n.noiseCoordinates1=H.createVertexBuffer("noiseCoordinates1",Z,3,this._attributesStrideSize,!0),Z+=3,this._platform.alignDataInBuffer&&(Z+=1),n.noiseCoordinates2=H.createVertexBuffer("noiseCoordinates2",Z,3,this._attributesStrideSize,!0),Z+=3,this._platform.alignDataInBuffer&&(Z+=1)),n.angle=H.createVertexBuffer("angle",Z,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?Z++:Z+=2,this._isAnimationSheetEnabled&&(n.cellIndex=H.createVertexBuffer("cellIndex",Z,1,this._attributesStrideSize,!0),Z+=1,this.spriteRandomStartCell&&(n.cellStartOffset=H.createVertexBuffer("cellStartOffset",Z,1,this._attributesStrideSize,!0),Z+=1)),n.offset=d.createVertexBuffer("offset",0,2),n.uv=d.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(n),this._platform.createVertexBuffers(E,n),this.resetDrawCache()}_initialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!E)return;const H=this._engine,d=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof s&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const Z=this.particleEmitterType instanceof s,I=n.TmpVectors.wH[0];let g=0;for(let n=0;n<this._capacity;n++)if(d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),Z?(this.particleEmitterType.particleDestinationGenerator(n,null,I),d.push(I.x),d.push(I.y),d.push(I.z)):(d.push(0),d.push(0),d.push(0)),this._platform.alignDataInBuffer&&d.push(0),g+=16,Z&&(this.particleEmitterType.particlePositionGenerator(n,null,I),d.push(I.x),d.push(I.y),d.push(I.z),this._platform.alignDataInBuffer&&d.push(0),g+=4),this._colorGradientsTexture||(d.push(0),d.push(0),d.push(0),d.push(0),g+=4),this.isBillboardBased||(d.push(0),d.push(0),d.push(0),this._platform.alignDataInBuffer&&d.push(0),g+=4),this.noiseTexture&&(d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),this._platform.alignDataInBuffer&&d.push(0),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),this._platform.alignDataInBuffer&&d.push(0),g+=8),d.push(0),g+=1,this._angularSpeedGradientsTexture||(d.push(0),g+=1),this._isAnimationSheetEnabled&&(d.push(0),g+=1,this.spriteRandomStartCell&&(d.push(0),g+=1)),this._platform.alignDataInBuffer){let E=3-(g+3&3);for(g+=E;E-- >0;)d.push(0)}const l=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),r=this._platform.createParticleBuffer(d),t=this._platform.createParticleBuffer(d);this._buffer0=new i.e(H,r,!1,this._attributesStrideSize),this._buffer1=new i.e(H,t,!1,this._attributesStrideSize),this._spriteBuffer=new i.e(H,l,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let E=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(E+="\n#define BILLBOARD"),this._colorGradientsTexture&&(E+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(E+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(E+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(E+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(E+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(E+="\n#define DRAGGRADIENTS"),this._flowMap&&(E+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(E+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(E+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(E+="\n#define NOISE"),this.isLocal&&(E+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===E||(this._cachedUpdateDefines=E,this._updateBuffer=this._platform.createUpdateBuffer(E)),this._platform.isUpdateBufferReady()}_getWrapper(E){const H=this._getCustomDrawWrapper(E);if(null!==H&&void 0!==H&&H.effect)return H;const d=[];this.fillDefines(d,E);let n=this._drawWrappers[E];n||(n=new EE.c(this._engine),n.drawContext&&(n.drawContext.useInstancing=!0),this._drawWrappers[E]=n);const Z=d.join("\n");if(n.defines!==Z){const E=[],H=[],d=[];this.fillUniformsAttributesAndSamplerNames(H,E,d),n.setEffect(this._engine.createEffect("gpuRenderParticles",E,H,d,Z),Z)}return n}static _GetAttributeNamesOrOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Z=[i.g.PositionKind,"age","life","size","angle"];return E||Z.push(i.g.ColorKind),H&&Z.push("cellIndex"),d||Z.push("initialDirection"),n&&Z.push("direction"),Z.push("offset",i.g.UVKind),Z}static _GetEffectCreationOptions(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=["emitterWM","jt","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,HE.e)(n),E&&n.push("sheetInfos"),H&&n.push("logarithmicDepthConstant"),d&&(n.push("vFogInfos"),n.push("vFogColor")),n}fillDefines(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,HE.m)(this,this._scene,E),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==tH.c.FOGMODE_NONE&&E.push("#define FOG")),H===lH.BLENDMODE_MULTIPLY&&E.push("#define BLENDMULTIPLYMODE"),this.isLocal&&E.push("#define LOCAL"),this.useLogarithmicDepth&&E.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(E.push("#define BILLBOARD"),this.billboardMode){case lH.BILLBOARDMODE_Y:E.push("#define BILLBOARDY");break;case lH.BILLBOARDMODE_STRETCHED:E.push("#define BILLBOARDSTRETCHED");break;case lH.BILLBOARDMODE_ALL:E.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&E.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&E.push("#define ANIMATESHEET"),d&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),E.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(E,H,d){H.push(...eH._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===lH.BILLBOARDMODE_STRETCHED)),E.push(...eH._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),d.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(rH.d.PrepareUniforms(E,this._imageProcessingConfigurationDefines),rH.d.PrepareSamplers(d,this._imageProcessingConfigurationDefines))}animate(){var E;let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(H?this.preWarmStepOffset:(null===(E=this._scene)||void 0===E?void 0:E.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(E,H){const d=this[H];if(!E||!E.length||d)return;const n=new Float32Array(this._rawTextureWidth);for(let Z=0;Z<this._rawTextureWidth;Z++){const H=Z/this._rawTextureWidth;mE.GetCurrentGradient(H,E,((E,H,d)=>{n[Z]=(0,t.Lerp)(E.factor1,H.factor1,d)}))}this[H]=A.b.CreateRTexture(n,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[H].name=H.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const E=new Uint8Array(4*this._rawTextureWidth),H=g.TmpColors.gg[0];for(let d=0;d<this._rawTextureWidth;d++){const n=d/this._rawTextureWidth;mE.GetCurrentGradient(n,this._colorGradients,((n,Z,I)=>{g.gg.LerpToRef(n.color1,Z.color1,I,H),E[4*d]=255*H.r,E[4*d+1]=255*H.g,E[4*d+2]=255*H.b,E[4*d+3]=255*H.a}))}this._colorGradientsTexture=A.b.CreateRGBATexture(E,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(E,H){var d,Z,I,g;const l=this._getWrapper(E),r=l.effect;this._engine.enableEffect(l);const t=(null===(d=this._scene)||void 0===d?void 0:d.getViewMatrix())||n.Matrix.IdentityReadOnly;if(r.setMatrix("view",t),r.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),r.setTexture("diffuseSampler",this.particleTexture),r.setVector2("translationPivot",this.translationPivot),r.setVector3("jt",this.jt),this.isLocal&&r.setMatrix("emitterWM",H),this._colorGradientsTexture?r.setTexture("colorGradientSampler",this._colorGradientsTexture):r.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const E=this.particleTexture.getBaseSize();r.setFloat3("sheetInfos",this.spriteCellWidth/E.width,this.spriteCellHeight/E.height,E.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const E=this._scene.activeCamera;r.setVector3("eyePosition",E.globalPosition)}const S=r.defines;if(this._scene&&((0,HE.f)(r,this,this._scene),this.applyFog&&(0,dE.d)(this._scene,void 0,r)),S.indexOf("#define BILLBOARDMODE_ALL")>=0){const E=t.clone();E.invert(),r.setMatrix("invView",E)}return this.useLogarithmicDepth&&this._scene&&(0,dE.j)(S,r,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(r),this._setEngineBasedOnBlendMode(E),this._platform.bindDrawBuffers(this._targetIndex,r,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(r),null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(g=this._scene)&&void 0!==g&&g.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(E){if(!this.nH||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!E)if(this.nH.position){E=this.nH.getWorldMatrix()}else{const H=this.nH;E=n.TmpVectors.Matrix[0],n.Matrix.TranslationToRef(H.x,H.y,H.z,E)}const H=this._engine,d=H.getDepthWrite();if(H.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const E=this.fE();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",E.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",E),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const Z=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=Z,H.setDepthWrite(d)}render(){let E,H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!H&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let E=0;E<this.preWarmCycles;E++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const E=0|this._accumulatedCount;this._accumulatedCount-=E,this._currentActiveCount+=E}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.nH.position){E=this.nH.getWorldMatrix()}else{const H=this.nH;E=n.TmpVectors.Matrix[0],n.Matrix.TranslationToRef(H.x,H.y,H.z,E)}const Z=this._engine;this.updateInAnimate||this._update(E);let I=0;return H||d||(Z.setState(!1),this.forceDepthWrite&&Z.setDepthWrite(!0),I=this.blendMode===lH.BLENDMODE_MULTIPLYADD?this._render(lH.BLENDMODE_MULTIPLY,E)+this._render(lH.BLENDMODE_ADD,E):this._render(this.blendMode,E),this._engine.setAlphaMode(0)),I}rebuild(){const E=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(E,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,E()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const H in this._drawWrappers){this._drawWrappers[H].dispose()}if(this._drawWrappers={},this._scene){const E=this._scene.lV.indexOf(this);E>-1&&this._scene.lV.splice(E,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let H=0;H<this._renderVertexBuffers.length;++H){const E=this._renderVertexBuffers[H];for(const H in E)E[H].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),E&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),E&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Qd.notifyObservers(this),this.Qd.clear()}clone(E,H){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n={...this._customWrappers};let Z=null;const I=this._engine;if(I.createEffectForParticles&&null!=this.customShader){Z=this.customShader;const E=Z.shaderOptions.defines.length>0?Z.shaderOptions.defines.join("\n"):"";n[0]=I.createEffectForParticles(Z.shaderPath.fragmentElement,Z.shaderOptions.uniforms,Z.shaderOptions.samplers,E,void 0,void 0,void 0,this)}const g=this.serialize(d),l=eH.Parse(g,this._scene||this._engine,this._rootUrl);return l.name=E,l.customShader=Z,l._customWrappers=n,void 0===H&&(H=this.nH),this.noiseTexture&&(l.noiseTexture=this.noiseTexture.clone()),l.nH=H,l}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={};return lH._Serialize(H,this,E),H.activeParticleCount=this.activeParticleCount,H.randomTextureSize=this._randomTextureSize,H.customShader=this.customShader,H}static Parse(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4?arguments[4]:void 0;const I=E.name;let g,l;H instanceof NE.c?g=H:(l=H,g=l.getEngine());const r=new eH(I,{Ld:Z||E.Ld,randomTextureSize:E.randomTextureSize},H,null,E.isAnimationSheetEnabled);if(r._rootUrl=d,E.customShader&&g.createEffectForParticles){const H=E.customShader,d=H.shaderOptions.defines.length>0?H.shaderOptions.defines.join("\n"):"",n=g.createEffectForParticles(H.shaderPath.fragmentElement,H.shaderOptions.uniforms,H.shaderOptions.samplers,d,void 0,void 0,void 0,r);r.setCustomEffect(n,0),r.customShader=H}return E.id&&(r.id=E.id),E.activeParticleCount&&(r.activeParticleCount=E.activeParticleCount),lH._Parse(E,r,H,d),E.preventAutoStart&&(r.preventAutoStart=E.preventAutoStart),n||r.preventAutoStart||r.start(),r}}var sH=d(12228),iH=d(13775),pH=d(12770);class fH{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(E){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const H of this.systems)H.nH=E;this._emitterNode=E}setEmitterAsSphere(E,H,d){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:E,renderingGroupId:H};const n=(0,iH.b)("emitterSphere",{diameter:E.diameter,segments:E.segments},d);n.renderingGroupId=H;const Z=new pH.LH("emitterSphereMaterial",d);Z.emissiveColor=E.color,n.material=Z;for(const I of this.systems)I.nH=n;this._emitterNode=n}start(E){for(const H of this.systems)E&&(H.nH=E),H.start()}dispose(){for(const E of this.systems)E.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={systems:[]};for(const d of this.systems)H.systems.push(d.serialize(E));return this._emitterNode&&(H.nH=this._emitterCreationOptions),H}static Parse(E,H){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;const Z=new fH,I=this.BaseAssetsUrl+"/textures/";H=H||B.b.LastCreatedScene;for(const g of E.systems)Z.systems.push(d?eH.Parse(g,H,I,!0,n):lH.Parse(g,H,I,!0,n));if(E.nH){const d=E.nH.options;if("Sphere"===E.nH.kind)Z.setEmitterAsSphere({diameter:d.diameter,segments:d.segments,color:g.DH.eH(d.color)},E.nH.renderingGroupId,H)}return Z}}fH.BaseAssetsUrl="https://assets.babylonjs.com/particles";var PH=d(12260);class jH{static CreateDefault(E){let H,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2?arguments[2]:void 0;H=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new eH("default system",{Ld:d},n):new lH("default system",d,n),H.nH=E;const Z=sH.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return H.particleTexture=new F.c(Z,H.fE()),H.createConeEmitter(.1,Math.PI/4),H.color1=new g.gg(1,1,1,1),H.color2=new g.gg(1,1,1,1),H.colorDead=new g.gg(1,1,1,0),H.minSize=.1,H.maxSize=.1,H.minEmitPower=2,H.maxEmitPower=2,H.updateSpeed=1/60,H.emitRate=30,H}static CreateAsync(E,H){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;H||(H=B.b.LastCreatedScene);const Z={};return H.addPendingData(Z),new Promise(((I,g)=>{if(d&&!eH.IsSupported)return H.removePendingData(Z),g("Particle system with GPU is not supported.");sH.Tools.LoadFile(`${jH.BaseAssetsUrl}/systems/${E}.json`,(E=>{H.removePendingData(Z);const g=JSON.parse(E.toString());return I(fH.Parse(g,H,d,n))}),void 0,void 0,void 0,(()=>(H.removePendingData(Z),g(`An error occurred with the creation of your particle system. Check if your type '${E}' exists.`))))}))}static ExportSet(E){const H=new fH;for(const d of E)H.systems.push(d);return H}static ParseFromFileAsync(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",I=arguments.length>5?arguments[5]:void 0;return new Promise(((g,l)=>{const r=new PH.b;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const H=JSON.parse(r.responseText);let l;l=n?eH.Parse(H,d,Z,!1,I):lH.Parse(H,d,Z,!1,I),E&&(l.name=E),g(l)}else l("Unable to load the particle system")})),r.open("GET",H),r.send()}))}static ParseFromSnippetAsync(E,H){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Z=arguments.length>4?arguments[4]:void 0;if("_BLANK"===E){const E=this.CreateDefault(null);return E.start(),Promise.resolve(E)}return new Promise(((I,g)=>{const l=new PH.b;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const g=JSON.parse(JSON.parse(l.responseText).jsonPayload),r=JSON.parse(g.particleSystem);let t;t=d?eH.Parse(r,H,n,!1,Z):lH.Parse(r,H,n,!1,Z),t.snippetId=E,I(t)}else g("Unable to load the snippet "+E)})),l.open("GET",this.SnippetUrl+"/"+E.replace(/#/g,"/")),l.send()}))}}jH.BaseAssetsUrl=fH.BaseAssetsUrl,jH.SnippetUrl="https://snippet.babylonjs.com",jH.CreateFromSnippetAsync=jH.ParseFromSnippetAsync;var XH=d(12840),WH=d(12666),UH=d(13782);(0,UH.f)(WH.e.NAME_PARTICLESYSTEM,((E,H,d,n)=>{const Z=(0,UH.j)(WH.e.NAME_PARTICLESYSTEM);if(Z&&void 0!==E.lV&&null!==E.lV)for(let I=0,g=E.lV.length;I<g;I++){const g=E.lV[I];d.lV.push(Z(g,H,n))}})),(0,UH.e)(WH.e.NAME_PARTICLESYSTEM,((E,H,d)=>{if(E.activeParticleCount){return eH.Parse(E,H,d)}return lH.Parse(E,H,d)})),NE.c.prototype.createEffectForParticles=function(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",I=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,r=arguments.length>7?arguments[7]:void 0,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,S=arguments.length>9?arguments[9]:void 0,M=[],V=[];const C=[];return r?r.fillUniformsAttributesAndSamplerNames(V,M,C):(M=lH._GetAttributeNamesOrOptions(),V=lH._GetEffectCreationOptions()),-1===Z.indexOf(" BILLBOARD")&&(Z+="\n#define BILLBOARD\n"),null!==r&&void 0!==r&&r.isAnimationSheetEnabled&&-1===Z.indexOf(" ANIMATESHEET")&&(Z+="\n#define ANIMATESHEET\n"),-1===n.indexOf("diffuseSampler")&&n.push("diffuseSampler"),this.createEffect({vertex:S??(null===r||void 0===r?void 0:r.vertexShaderName)??"particles",fragmentElement:E},M,V.concat(H),C.concat(n),Z,I,g,l,void 0,t,(async()=>{0===t?await Promise.resolve().then(d.bind(d,13802)):await Promise.resolve().then(d.bind(d,13863))}))},XH.e.prototype.getEmittedParticleSystems=function(){const E=[];for(let H=0;H<this.fE().lV.length;H++){const d=this.fE().lV[H];d.nH===this&&E.push(d)}return E},XH.e.prototype.getHierarchyEmittedParticleSystems=function(){const E=[],H=this.getDescendants();H.push(this);for(let d=0;d<this.fE().lV.length;d++){const n=this.fE().lV[d],Z=n.nH;Z.position&&-1!==H.indexOf(Z)&&E.push(n)}return E};d(12738),d(12748),d(12817);d(12825),d(13785),d(12594),d(12733),d(12854);d(12587);var YH;d(13788),d(12414);!function(E){E[E.Color=2]="Color",E[E.UV=1]="UV",E[E.Random=0]="Random",E[E.Stated=3]="Stated"}(YH||(YH={}));var cH=d(12622);const uH=new n.wH(0,0,0),oH=new n.wH(0,0,0),FH=new n.wH(0,0,0);class aH{constructor(E,H,d){this.width=E,this.height=H,this.data=d}processFlowable(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2?arguments[2]:void 0;if(!d)return;d instanceof n.Matrix?n.wH.TransformCoordinatesToRef(E.position,d,FH):(FH.x=d.x,FH.y=d.y,FH.z=d.z);const Z=.5*FH.x+.5,I=1-(.5*FH.y+.5),g=Math.floor(Z*this.width),l=Math.floor(I*this.height);if(g<0||g>=this.width||l<0||l>=this.height)return;const r=4*(l*this.width+g),t=this.data[r]/255*2-1,S=this.data[r+1]/255*2-1,M=this.data[r+2]/255*2-1,V=this.data[r+3]/255;uH.set(t,S,M),uH.scaleToRef(H*V,oH),E.direction.addInPlace(oH)}_processParticle(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,d=arguments.length>2?arguments[2]:void 0;this.processFlowable(E,H,d)}static async FromUrlAsync(E){return await new Promise(((H,d)=>{const n=document.createElement("canvas"),Z=n.getContext("2d");let I=null;const g=new Image;g.crossOrigin="anonymous",g.src=E,g.onerror=H=>{d(new Error(`Failed to load image: ${E} : ${H}`))},g.onload=()=>{n.width=g.width,n.height=g.height,Z.drawImage(g,0,0),I=Z.getImageData(0,0,n.width,n.height),H(new aH(n.width,n.height,I.data))}}))}static async ExtractFromTextureAsync(E){return await new Promise(((H,d)=>{if(!E.isReady())return void E.onLoadObservable.addOnce((async()=>{try{const d=await this.ExtractFromTextureAsync(E);H(d)}catch(n){d(n)}}));const n=E.getSize();cH.n.GetTextureDataAsync(E,n.width,n.height).then((E=>{H(new aH(n.width,n.height,new Uint8ClampedArray(E)))})).catch(d)}))}}var kH,OH,GH,xH,qH,bH,hH,yH,vH;!function(E){E[E.Int=1]="Int",E[E.Float=2]="Float",E[E.Vector2=4]="Vector2",E[E.wH=8]="wH",E[E.Matrix=16]="Matrix",E[E.Particle=32]="Particle",E[E.Texture=64]="Texture",E[E.gg=128]="gg",E[E.FloatGradient=256]="FloatGradient",E[E.Vector2Gradient=512]="Vector2Gradient",E[E.Vector3Gradient=1024]="Vector3Gradient",E[E.Color4Gradient=2048]="Color4Gradient",E[E.System=4096]="System",E[E.AutoDetect=8192]="AutoDetect",E[E.BasedOnInput=16384]="BasedOnInput",E[E.Undefined=32768]="Undefined",E[E.All=65535]="All"}(kH||(kH={})),function(E){E[E.Compatible=0]="Compatible",E[E.TypeIncompatible=1]="TypeIncompatible",E[E.HierarchyIssue=2]="HierarchyIssue"}(OH||(OH={})),function(E){E[E.Input=0]="Input",E[E.Output=1]="Output"}(GH||(GH={}));class zH{get direction(){return this._direction}get type(){if(this._type===kH.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===kH.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(E){this._type=E}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((E=>E.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(E,H,d){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=kH.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new T.e,this.onDisconnectionObservable=new T.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=H,this.name=E,this._direction=d}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(E){var H;return this.isConnected?null!==(H=this._connectedPoint)&&void 0!==H&&H._storedFunction?this._connectedPoint._storedFunction(E):this._connectedPoint._storedValue:this.value}canConnectTo(E){return 0===this.checkCompatibilityState(E)}checkCompatibilityState(E){const H=this._ownerBlock,d=E.ownerBlock;if(this.type!==E.type&&E.innerType!==kH.AutoDetect)return E.acceptedConnectionPointTypes&&-1!==E.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(E.excludedConnectionPointTypes&&-1!==E.excludedConnectionPointTypes.indexOf(this.type))return 1;let n=d,Z=H;return 0===this.direction&&(n=H,Z=d),n.isAnAncestorOf(Z)?2:0}connectTo(E){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(E))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${E.ownerBlock.name}".${E.name}`;return this._endpoints.push(E),E._connectedPoint=this,this.onConnectionObservable.notifyObservers(E),E.onConnectionObservable.notifyObservers(this),this}disconnectFrom(E){const H=this._endpoints.indexOf(E);return-1===H||(this._endpoints.splice(H,1),E._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(E),E.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(E){let H=1;for(;H<kH.All;)E&H||this.excludedConnectionPointTypes.push(H),H<<=1}serialize(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const H={};return H.name=this.name,H.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.kd?(H.valueType="BABYLON."+this.value.getClassName(),H.value=this.value.kd()):(H.valueType="number",H.value=this.value)),E&&this.connectedPoint&&(H.inputName=this.name,H.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,H.targetConnectionName=this.connectedPoint.name,H.isExposedOnFrame=!0,H.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(H.isExposedOnFrame=!0,H.exposedPortPosition=this.exposedPortPosition),H}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class KH{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(E){this._name=E}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(E){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new T.e,this.Qd=new T.e,this.onInputChangedObservable=new T.e,this.visibleOnFrame=!1,this._name=E,this.uniqueId=a.c.UniqueId}_inputRename(E){return E}_outputRename(E){return E}isAnAncestorOf(E){for(const H of this._outputs)if(H.hasEndpoints)for(const d of H.endpoints){if(d.ownerBlock===E)return!0;if(d.ownerBlock.isAnAncestorOf(E))return!0}return!1}isAnAncestorOfType(E){if(this.getClassName()===E)return!0;for(const H of this._outputs)if(H.hasEndpoints)for(const d of H.endpoints)if(d.ownerBlock.isAnAncestorOfType(E))return!0;return!1}getInputByName(E){const H=this._inputs.filter((H=>H.name===E));return H.length?H[0]:null}_linkConnectionTypes(E,H){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[H]._acceptedConnectionPointType=this._inputs[E]:(this._inputs[E]._linkedConnectionSource=this._inputs[H],this._inputs[E]._isMainLinkSource=!0),this._inputs[H]._linkedConnectionSource=this._inputs[E]}registerInput(E,H){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,Z=arguments.length>4?arguments[4]:void 0,I=arguments.length>5?arguments[5]:void 0;const g=new zH(E,this,0);return g.type=H,g.isOptional=d,g.defaultValue=n,g.value=n,g.valueMin=Z,g.valueMax=I,this._inputs.push(g),this.onInputChangedObservable.notifyObservers(g),this}registerOutput(E,H,d){return(d=d??new zH(E,this,1)).type=H,this._outputs.push(d),this}_build(E){}_customBuildStep(E){}build(E){if(this._buildId===E.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((E=>E.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=E.buildId;for(const H of this._inputs){if(!H.connectedPoint){H.isOptional||E.notConnectedNonOptionalInputs.push(H);continue}const d=H.connectedPoint.ownerBlock;d&&d!==this&&!d.isSystem&&d.build(E)}return this._customBuildStep(E),E.verbose&&k.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(E),this.onBuildObservable.notifyObservers(this),!1}serialize(){const E={};E.customType="BABYLON."+this.getClassName(),E.id=this.uniqueId,E.name=this.name,E.visibleOnFrame=this.visibleOnFrame,E.inputs=[],E.outputs=[];for(const H of this.inputs)E.inputs.push(H.serialize());for(const H of this.outputs)E.outputs.push(H.serialize(!1));return E}_deserialize(E){this._name=E.name,this.comments=E.comments,this.visibleOnFrame=!!E.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(E)}_deserializePortDisplayNamesAndExposedOnFrame(E){const H=E.inputs,d=E.outputs;if(H)for(const n of H){const E=this.inputs.find((E=>E.name===n.name));if(!E)return;if(n.displayName&&(E.displayName=n.displayName),n.isExposedOnFrame&&(E.isExposedOnFrame=n.isExposedOnFrame,E.exposedPortPosition=n.exposedPortPosition),void 0!==n.value&&null!==n.value)if("number"===n.valueType)E.value=n.value;else{const H=(0,l.c)(n.valueType);H&&(E.value=H.eH(n.value))}}if(d)for(let n=0;n<d.length;n++){const E=d[n];E.displayName&&(this.outputs[n].displayName=E.displayName),E.isExposedOnFrame&&(this.outputs[n].isExposedOnFrame=E.isExposedOnFrame,this.outputs[n].exposedPortPosition=E.exposedPortPosition)}}clone(){const E=this.serialize(),H=(0,l.c)(E.customType);if(H){const d=new H;return d._deserialize(E),d}return null}dispose(){this.Qd.notifyObservers(this),this.Qd.clear();for(const E of this.inputs)E.dispose();for(const E of this.outputs)E.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function NH(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",n=arguments.length>3?arguments[3]:void 0;return(Z,I)=>{let g=Z._propStore;g||(g=[],Z._propStore=g),g.push({propertyName:I,displayName:E,type:H,groupName:d,options:n??{},className:Z.getClassName()})}}(0,c.e)([(0,u.K)("comment")],KH.prototype,"comments",void 0),function(E){E[E.Boolean=0]="Boolean",E[E.Float=1]="Float",E[E.Int=2]="Int",E[E.Vector2=3]="Vector2",E[E.List=4]="List",E[E.gg=5]="gg",E[E.SamplingMode=6]="SamplingMode",E[E.TextureFormat=7]="TextureFormat",E[E.TextureType=8]="TextureType"}(xH||(xH={})),function(E){E[E.None=0]="None",E[E.Position=1]="Position",E[E.Direction=2]="Direction",E[E.Age=3]="Age",E[E.Lifetime=4]="Lifetime",E[E.Color=5]="Color",E[E.ScaledDirection=6]="ScaledDirection",E[E.Scale=7]="Scale",E[E.AgeGradient=8]="AgeGradient",E[E.Angle=9]="Angle",E[E.SpriteCellIndex=16]="SpriteCellIndex",E[E.SpriteCellStart=17]="SpriteCellStart",E[E.SpriteCellEnd=18]="SpriteCellEnd"}(qH||(qH={})),function(E){E[E.None=0]="None",E[E.Time=1]="Time",E[E.Delta=2]="Delta",E[E.Emitter=3]="Emitter"}(bH||(bH={}));class md{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let E="";for(const H of this.notConnectedNonOptionalInputs)E+=`input ${H.name} from block ${H.ownerBlock.name}[${H.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(E)throw"Build of Node Particle System Set failed:\n"+E}adapt(E,H){const d=E.getConnectedValue(this)||0;if(E.type===H)return d;switch(H){case kH.Vector2:return new n.Vector2(d,d);case kH.wH:return new n.wH(d,d,d);case kH.gg:return new g.gg(d,d,d,d)}return null}getContextualValue(E){if(!this.particleContext||!this.systemContext)return null;switch(E){case qH.Position:return this.particleContext.position;case qH.Direction:return this.particleContext.direction;case qH.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case qH.Color:return this.particleContext.color;case qH.Age:return this.particleContext.age;case qH.Lifetime:return this.particleContext.lifeTime;case qH.Angle:return this.particleContext.angle;case qH.Scale:return this.particleContext.scale;case qH.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case qH.SpriteCellEnd:return this.systemContext.endSpriteCellID;case qH.SpriteCellIndex:return this.particleContext.cellIndex;case qH.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.nH.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.nH.absolutePosition:this.systemContext.nH:null}getSystemValue(E){if(!this.particleContext||!this.systemContext)return null;switch(E){case bH.Time:return this.systemContext._actualFrame;case bH.Delta:return this.systemContext._scaledUpdateSpeed;case bH.Emitter:if(this.isEmitterTransformNode){return this.systemContext.nH.absolutePosition}return this.systemContext.nH}return null}}function TH(E,H,d){const n=new md;n.QH=H;const Z=E.createSystem(n);return Z.canStart=()=>!0,Z.nH=d.clone(),Z.disposeOnStop=!0,Z.start(),Z}class AH extends KH{constructor(E){super(E),this.blendMode=r.BLENDMODE_ONEONE,this.Ld=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",kH.Particle),this.registerInput("texture",kH.Texture),this.registerInput("onStart",kH.System,!0),this.registerInput("onEnd",kH.System,!0),this.registerOutput("system",kH.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(E){E.Ld=this.Ld,E.buildId=this._buildId++,this.build(E);const H=this.particle.getConnectedValue(E);return H.particleTexture=this.texture.getConnectedValue(E),H.emitRate=this.emitRate,H.blendMode=this.blendMode,H.name=this.name,H._nodeGenerated=!0,H._targetStopDuration=this.targetStopDuration,H.startDelay=this.startDelay,this.system._storedValue=this,H.canStart=()=>!this.doNoStart,H.onStartedObservable.add((d=>{const n=this.onStart.getConnectedValue(E);n&&d.onStartedObservable.addOnce((()=>{E.systemContext=H;const d=TH(n,E.QH,E.emitterPosition);this.Qd.addOnce((()=>{d.dispose()}))}));const Z=this.onEnd.getConnectedValue(E);Z&&d.onStoppedObservable.addOnce((()=>{E.systemContext=H;const d=TH(Z,E.QH,E.emitterPosition);this.Qd.addOnce((()=>{d.dispose()}))}))})),this.Qd.addOnce((()=>{H.dispose()})),H}serialize(){const E=super.serialize();return E.Ld=this.Ld,E.emitRate=this.emitRate,E.blendMode=this.blendMode,E.doNoStart=this.doNoStart,E.targetStopDuration=this.targetStopDuration,E.startDelay=this.startDelay,E}_deserialize(E){super._deserialize(E),this.Ld=E.Ld,this.emitRate=E.emitRate,this.doNoStart=!!E.doNoStart,void 0!==E.blendMode&&(this.blendMode=E.blendMode),void 0!==E.targetStopDuration&&(this.targetStopDuration=E.targetStopDuration),void 0!==E.startDelay&&(this.startDelay=E.startDelay)}}(0,c.e)([NH("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:r.BLENDMODE_ONEONE},{label:"Standard",value:r.BLENDMODE_STANDARD},{label:"Add",value:r.BLENDMODE_ADD},{label:"Multiply",value:r.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:r.BLENDMODE_MULTIPLYADD}]})],AH.prototype,"blendMode",void 0),(0,c.e)([NH("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],AH.prototype,"Ld",void 0),(0,c.e)([NH("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],AH.prototype,"emitRate",void 0),(0,c.e)([NH("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],AH.prototype,"targetStopDuration",void 0),(0,c.e)([NH("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],AH.prototype,"startDelay",void 0),(0,c.e)([NH("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],AH.prototype,"doNoStart",void 0),(0,l.e)("BABYLON.SystemBlock",AH);class BH extends KH{get type(){if(this._type===kH.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=kH.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=kH.Vector2,this._type;case"wH":return this._type=kH.wH,this._type;case"gg":return this._type=kH.gg,this._type;case"Matrix":return this._type=kH.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===qH.None&&this._systemSource!==bH.None}get systemSource(){return this._systemSource}set systemSource(E){if(this._systemSource=E,E!==bH.None){switch(this._contextualSource=qH.None,this._type=kH.Float,E){case bH.Time:case bH.Delta:this._type=kH.Float;break;case bH.Emitter:this._type=kH.wH}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==qH.None}get contextualValue(){return this._contextualSource}set contextualValue(E){if(this._contextualSource=E,E!==qH.None){switch(this._systemSource=bH.None,E){case qH.Scale:this._type=kH.Vector2;break;case qH.Position:case qH.Direction:case qH.ScaledDirection:this._type=kH.wH;break;case qH.Color:this._type=kH.gg;break;case qH.Age:case qH.Lifetime:case qH.Angle:case qH.AgeGradient:this._type=kH.Float;break;case qH.SpriteCellEnd:case qH.SpriteCellStart:case qH.SpriteCellIndex:this._type=kH.Int}this.output&&(this.output.type=this._type)}}constructor(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kH.AutoDetect;super(E),this._type=kH.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new T.e,this._systemSource=bH.None,this._contextualSource=qH.None,this._type=H,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",H)}get value(){return this._storedValue}set value(E){this.type===kH.Float&&this.min!==this.max&&(E=Math.max(this.min,E),E=Math.min(this.max,E)),this._storedValue=E,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(E){this._valueCallback=E}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case kH.Int:case kH.Float:this.value=0;break;case kH.Vector2:this.value=n.Vector2.Zero();break;case kH.wH:this.value=n.wH.Zero();break;case kH.gg:this.value=new g.gg(1,1,1,1);break;case kH.Matrix:this.value=n.Matrix.Identity()}}_build(E){super._build(E),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=E=>E.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=E=>E.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const E=super.serialize();return E.type=this.type,E.contextualValue=this.contextualValue,E.systemSource=this.systemSource,E.min=this.min,E.max=this.max,E.groupInInspector=this.groupInInspector,E.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.kd?(E.valueType="BABYLON."+this._storedValue.getClassName(),E.value=this._storedValue.kd()):(E.valueType="number",E.value=this._storedValue)),E}_deserialize(E){if(super._deserialize(E),this._type=E.type,this.contextualValue=E.contextualValue,this.systemSource=E.systemSource||bH.None,this.min=E.min||0,this.max=E.max||0,this.groupInInspector=E.groupInInspector||"",void 0!==E.displayInInspector&&(this.displayInInspector=E.displayInInspector),E.valueType)if("number"===E.valueType)this._storedValue=E.value;else{const H=(0,l.c)(E.valueType);H&&(this._storedValue=H.eH(E.value))}}}(0,l.e)("BABYLON.ParticleInputBlock",BH);class JH extends KH{get url(){return this._url}set url(E){this._url!==E&&(this._cachedData=null,this._url=E,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(E){this._textureDataUrl!==E&&(this._cachedData=null,this._textureDataUrl=E,this._url="",this._sourceTexture=null)}set sourceTexture(E){this._sourceTexture!==E&&(this._cachedData=null,this._sourceTexture=E,this._url="",this._textureDataUrl="")}constructor(E){super(E),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",kH.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const E=this.texture._storedValue;return await new Promise(((H,d)=>{if(!E.isReady())return void E.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),H(this._cachedData)}catch(E){d(E)}}));const n=E.getSize();cH.n.GetTextureDataAsync(E,n.width,n.height).then((d=>{this._cachedData={width:n.width,height:n.height,data:new Uint8ClampedArray(d)},E.dispose(),H(this._cachedData)})).catch(d)}))}_build(E){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new F.c(this._textureDataUrl,E.QH):this.texture._storedValue=new F.c(this._url,E.QH):this.texture._storedValue=null}serialize(){const E=super.serialize();return E.url=this.url,E.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(E.textureDataUrl=this.textureDataUrl),E}_deserialize(E){super._deserialize(E),this.url=E.url,this.serializedCachedData=!!E.serializedCachedData,E.textureDataUrl&&(this.textureDataUrl=E.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,l.e)("BABYLON.ParticleTextureSourceBlock",JH);class Ed extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerInput("position",kH.wH),this.registerOutput("output",kH.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(E){const H=this.particle.getConnectedValue(E);if(this.output._storedValue=H,!this.position.isConnected)return;const d={process:d=>{E.particleContext=d,E.systemContext=H,d.position.l(this.position.getConnectedValue(E))},previousItem:null,nextItem:null};H._updateQueueStart?bE(d,H._updateQueueStart):H._updateQueueStart=d}}(0,l.e)("BABYLON.UpdatePositionBlock",Ed),function(E){E[E.Add=0]="Add",E[E.Subtract=1]="Subtract",E[E.Multiply=2]="Multiply",E[E.Divide=3]="Divide",E[E.Max=4]="Max",E[E.Min=5]="Min"}(hH||(hH={}));class Hd extends KH{constructor(E){super(E),this.operation=hH.Add,this.registerInput("left",kH.AutoDetect),this.registerInput("right",kH.AutoDetect),this.registerOutput("output",kH.BasedOnInput),this.output._typeConnectionSource=this.left;const H=[kH.Matrix,kH.Particle,kH.Texture,kH.System,kH.FloatGradient,kH.Color4Gradient,kH.Vector2Gradient,kH.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...H),this.right.excludedConnectionPointTypes.push(...H),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(E){let H;const d=this.left,Z=this.right;if(!d.isConnected||!Z.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const I=d.type===kH.Float||d.type===kH.Int,l=Z.type===kH.Float||Z.type===kH.Int,r=I&&l;switch(this.operation){case hH.Add:H=r?E=>d.getConnectedValue(E)+Z.getConnectedValue(E):I?E=>E.adapt(d,Z.type).add(Z.getConnectedValue(E)):E=>d.getConnectedValue(E).add(E.adapt(Z,d.type));break;case hH.Subtract:H=r?E=>d.getConnectedValue(E)-Z.getConnectedValue(E):I?E=>E.adapt(d,Z.type).RH(Z.getConnectedValue(E)):E=>d.getConnectedValue(E).RH(E.adapt(Z,d.type));break;case hH.Multiply:H=r?E=>d.getConnectedValue(E)*Z.getConnectedValue(E):I?E=>E.adapt(d,Z.type).multiply(Z.getConnectedValue(E)):E=>d.getConnectedValue(E).multiply(E.adapt(Z,d.type));break;case hH.Divide:H=r?E=>d.getConnectedValue(E)/Z.getConnectedValue(E):I?E=>E.adapt(d,Z.type).divide(Z.getConnectedValue(E)):E=>d.getConnectedValue(E).divide(E.adapt(Z,d.type));break;case hH.Min:if(r)H=E=>Math.min(d.getConnectedValue(E),Z.getConnectedValue(E));else{const[E,l]=I?[Z,d]:[d,Z];switch(E.type){case kH.Vector2:H=H=>n.Vector2.Minimize(E.getConnectedValue(H),H.adapt(l,E.type));break;case kH.wH:H=H=>n.wH.Minimize(E.getConnectedValue(H),H.adapt(l,E.type));break;case kH.gg:H=H=>{const d=E.getConnectedValue(H),{r:n,g:Z,b:I,a:r}=H.adapt(l,E.type);return new g.gg(Math.min(d.r,n),Math.min(d.g,Z),Math.min(d.b,I),Math.min(d.a,r))}}}break;case hH.Max:if(!r){const[E,l]=I?[Z,d]:[d,Z];switch(E.type){case kH.Vector2:H=H=>n.Vector2.Maximize(E.getConnectedValue(H),H.adapt(l,E.type));break;case kH.wH:H=H=>n.wH.Maximize(E.getConnectedValue(H),H.adapt(l,E.type));break;case kH.gg:H=H=>{const d=E.getConnectedValue(H),{r:n,g:Z,b:I,a:r}=H.adapt(l,E.type);return new g.gg(Math.max(d.r,n),Math.min(d.g,Z),Math.min(d.b,I),Math.min(d.a,r))}}break}H=E=>Math.max(d.getConnectedValue(E),Z.getConnectedValue(E))}this.output._storedFunction=E=>d.type===kH.Int?0|H(E):H(E)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===kH.Int||this.left.type===kH.Float&&this.right.type!==kH.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[E,H]of[[this.left,this.right],[this.right,this.left]])E.acceptedConnectionPointTypes=[kH.Int,kH.Float],H.isConnected&&(E.acceptedConnectionPointTypes.push(H.type),H.type!==kH.Int&&H.type!==kH.Float||E.acceptedConnectionPointTypes.push(kH.Vector2,kH.wH,kH.gg))}dispose(){super.dispose();for(const E of this._connectionObservers)E.remove();this._connectionObservers.length=0}serialize(){const E=super.serialize();return E.operation=this.operation,E}_deserialize(E){super._deserialize(E),this.operation=E.operation}}(0,c.e)([NH("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:hH.Add},{label:"Subtract",value:hH.Subtract},{label:"Multiply",value:hH.Multiply},{label:"Divide",value:hH.Divide},{label:"Max",value:hH.Max},{label:"Min",value:hH.Min}]})],Hd.prototype,"operation",void 0),(0,l.e)("BABYLON.ParticleMathBlock",Hd);class dd extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerInput("direction1",kH.wH,!0,new n.wH(0,1,0)),this.registerInput("direction2",kH.wH,!0,new n.wH(0,1,0)),this.registerInput("minEmitBox",kH.wH,!0,new n.wH(-.5,-.5,-.5)),this.registerInput("maxEmitBox",kH.wH,!0,new n.wH(.5,.5,.5)),this.registerOutput("output",kH.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(E){const H=this.particle.getConnectedValue(E);H._directionCreation.process=d=>{E.particleContext=d,E.systemContext=H;const Z=this.direction1.getConnectedValue(E),I=this.direction2.getConnectedValue(E),g=(0,t.RandomRange)(Z.x,I.x),l=(0,t.RandomRange)(Z.y,I.y),r=(0,t.RandomRange)(Z.z,I.z);E.isEmitterTransformNode?n.wH.TransformNormalFromFloatsToRef(g,l,r,E.emitterWorldMatrix,d.direction):d.direction.en(g,l,r)},H._positionCreation.process=d=>{E.particleContext=d,E.systemContext=H;const Z=this.minEmitBox.getConnectedValue(E),I=this.maxEmitBox.getConnectedValue(E),g=(0,t.RandomRange)(Z.x,I.x),l=(0,t.RandomRange)(Z.y,I.y),r=(0,t.RandomRange)(Z.z,I.z);E.isEmitterTransformNode?n.wH.TransformCoordinatesFromFloatsToRef(g,l,r,E.emitterWorldMatrix,d.position):(d.position.en(g,l,r),d.position.addInPlace(E.emitterPosition))},this.output._storedValue=H}}(0,l.e)("BABYLON.BoxShapeBlock",dd);class nd extends KH{constructor(E){super(E),this.registerInput("emitPower",kH.Float,!0,1),this.registerInput("lifeTime",kH.Float,!0,1),this.registerInput("color",kH.gg,!0,new g.gg(1,1,1,1)),this.registerInput("scale",kH.Vector2,!0,new n.Vector2(1,1)),this.registerInput("angle",kH.Float,!0,0),this.registerOutput("particle",kH.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(E){const H=new lH(this.name,E.Ld,E.QH,null,!1,void 0,!0);H.particleEmitterType=new L,H._lifeTimeCreation.process=(H,d)=>{E.particleContext=H,H.lifeTime=this.lifeTime.getConnectedValue(E),d._emitPower=this.emitPower.getConnectedValue(E)},H._colorCreation.process=H=>{E.particleContext=H,H.color.l(this.color.getConnectedValue(E))},H._sizeCreation.process=H=>{E.particleContext=H,H.size=1,H.scale.l(this.scale.getConnectedValue(E))},H._angleCreation.process=H=>{E.particleContext=H,H.angle=this.angle.getConnectedValue(E)},this.particle._storedValue=H}}(0,l.e)("BABYLON.CreateParticleBlock",nd);class Zd{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const E=[];for(const H of this.attachedBlocks)H.isInput&&E.push(H);return E}constructor(E){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new T.e,this.name=E}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(E){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(E)&&this.attachedBlocks.push(E);for(const d of E.inputs){const n=d.connectedPoint;if(n){const d=n.ownerBlock;d!==E&&this._initializeBlock(d,H)}}}async buildAsync(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((d=>{const n=new fH;for(const E of this._systemBlocks)this._initializeBlock(E);for(const Z of this.systemBlocks){const d=new md;d.buildId=this._buildId++,d.QH=E,d.verbose=H;const I=Z.createSystem(d);d.emitErrors(),n.systems.push(I)}this.onBuildObservable.notifyObservers(this),d(n)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const E=new AH("Particle system"),H=new Ed("Update position");H.output.connectTo(E.particle);const d=new BH("Position");d.contextualValue=qH.Position;const n=new BH("Scaled direction");n.contextualValue=qH.ScaledDirection;const Z=new Hd("Add");Z.operation=hH.Add,d.output.connectTo(Z.left),n.output.connectTo(Z.right),Z.output.connectTo(H.position);const I=new nd("Create particle"),g=new dd("Box shape");I.particle.connectTo(g.particle),g.output.connectTo(H.particle);const l=new JH("Texture");l.texture.connectTo(E.texture),l.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(E)}removeBlock(E){const H=this.attachedBlocks.indexOf(E);if(H>-1&&this.attachedBlocks.splice(H,1),E.isSystem){const H=this._systemBlocks.indexOf(E);H>-1&&this._systemBlocks.splice(H,1)}}parseSerializedObject(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H||this.clear();const d={};for(const n of E.XS){const E=(0,l.c)(n.customType);if(E){const H=new E;H._deserialize(n),d[n.id]=H,this.attachedBlocks.push(H),H.isSystem&&this._systemBlocks.push(H)}}for(const n of this.attachedBlocks)if(n.isTeleportOut){const E=n,H=E._tempEntryPointUniqueId;if(H){const n=d[H];n&&n.attachToEndpoint(E)}}for(let n=0;n<E.XS.length;n++){const Z=E.XS[n],I=d[Z.id];I&&(I.inputs.length&&Z.inputs.some((E=>E.targetConnectionName))&&!H||this._restoreConnections(I,E,d))}if(E.locations||E.editorData&&E.editorData.locations){const n=E.locations||E.editorData.locations;for(const E of n)d[E.VI]&&(E.VI=d[E.VI].uniqueId);H&&this.editorData&&this.editorData.locations&&n.concat(this.editorData.locations),E.locations?this.editorData={locations:n}:(this.editorData=E.editorData,this.editorData.locations=n);const Z=[];for(const E in d)Z[E]=d[E].uniqueId;this.editorData.map=Z}this.comment=E.comment}_restoreConnections(E,H,d){for(const n of E.outputs)for(const Z of H.XS){const I=d[Z.id];if(I)for(const g of Z.inputs)if(d[g.targetBlockId]!==E||g.targetConnectionName!==n.name);else{const E=I.getInputByName(g.inputName);if(!E||E.isConnected)continue;n.connectTo(E,!0),this._restoreConnections(I,H,d)}}}serialize(E){const H=E?{}:o.c.Serialize(this);H.editorData=JSON.parse(JSON.stringify(this.editorData));let d=[];E?d=E:H.customType="BABYLON.NodeParticleSystemSet",H.XS=[];for(const n of d)H.XS.push(n.serialize());if(!E)for(const n of this.attachedBlocks)-1===d.indexOf(n)&&H.XS.push(n.serialize());return H}dispose(){for(const E of this.attachedBlocks)E.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(E){const H=new Zd(E);return H.setToDefault(),H}static Parse(E){const H=o.c.Parse((()=>new Zd(E.name)),E,null);return H.parseSerializedObject(E),H}static ParseFromSnippetAsync(E,H){return"_BLANK"===E?Promise.resolve(Zd.CreateDefault("blank")):new Promise(((d,n)=>{const Z=new PH.b;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const g=JSON.parse(JSON.parse(Z.responseText).jsonPayload),l=JSON.parse(g.nodeParticle);H||(H=o.c.Parse((()=>new Zd(E)),l,null)),H.parseSerializedObject(l),H.snippetId=E;try{d(H)}catch(I){n(I)}}else n("Unable to load the snippet "+E)})),Z.open("GET",this.SnippetUrl+"/"+E.replace(/#/g,"/")),Z.send()}))}}Zd.EditorURL=`${sH.Tools._DefaultCdnUrl}/v${NE.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Zd.SnippetUrl="https://snippet.babylonjs.com",(0,c.e)([(0,u.K)()],Zd.prototype,"name",void 0),(0,c.e)([(0,u.K)("comment")],Zd.prototype,"comment",void 0),function(E){E[E.None=0]="None",E[E.PerParticle=1]="PerParticle",E[E.PerSystem=2]="PerSystem"}(yH||(yH={}));class Id extends KH{constructor(E){super(E),this._currentLockId=-2,this.lockMode=yH.PerParticle,this.registerInput("min",kH.AutoDetect,!0,0),this.registerInput("max",kH.AutoDetect,!0,1),this.registerOutput("output",kH.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kH.Float|kH.Int|kH.Vector2|kH.wH|kH.gg),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(kH.Float|kH.Int|kH.Vector2|kH.wH|kH.gg),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=kH.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let E=null;switch(this._currentLockId=-2,this.min.type){case kH.AutoDetect:case kH.Int:case kH.Float:E=E=>{const H=this.min.getConnectedValue(E)||0,d=this.max.getConnectedValue(E)||1;return H+Math.random()*(d-H)};break;case kH.Vector2:E=E=>{const H=this.min.getConnectedValue(E)||n.Vector2.Zero(),d=this.max.getConnectedValue(E)||n.Vector2.One();return new n.Vector2(H.x+Math.random()*(d.x-H.x),H.y+Math.random()*(d.y-H.y))};break;case kH.wH:E=E=>{const H=this.min.getConnectedValue(E)||n.wH.Zero(),d=this.max.getConnectedValue(E)||n.wH.One();return new n.wH(H.x+Math.random()*(d.x-H.x),H.y+Math.random()*(d.y-H.y),H.z+Math.random()*(d.z-H.z))};break;case kH.gg:E=E=>{const H=this.min.getConnectedValue(E)||new g.gg(0,0,0,0),d=this.max.getConnectedValue(E)||new g.gg(1,1,1,1);return new g.gg(H.x+Math.random()*(d.x-H.x),H.y+Math.random()*(d.y-H.y),H.z+Math.random()*(d.z-H.z),H.w+Math.random()*(d.w-H.w))}}this.output._storedFunction=H=>{var d;let n=0;switch(this.lockMode){case yH.PerParticle:n=(null===(d=H.particleContext)||void 0===d?void 0:d.id)||-1;break;case yH.PerSystem:n=H.buildId||0}return this._currentLockId!==n&&(this.lockMode!==yH.None&&(this._currentLockId=n),this.output._storedValue=E(H)),this.output._storedValue}}serialize(){const E=super.serialize();return E.lockMode=this.lockMode,E}_deserialize(E){super._deserialize(E),this.lockMode=E.lockMode}}(0,c.e)([NH("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:yH.None},{label:"Per particle",value:yH.PerParticle},{label:"Per system",value:yH.PerSystem}]})],Id.prototype,"lockMode",void 0),(0,l.e)("BABYLON.ParticleRandomBlock",Id);class gd extends KH{constructor(E){super(E),this._currentLockId=-2,this.lockMode=yH.PerParticle,this.registerInput("min",kH.AutoDetect),this.registerInput("max",kH.AutoDetect),this.registerOutput("output",kH.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const H=[kH.Matrix,kH.Particle,kH.Texture,kH.System,kH.FloatGradient,kH.Color4Gradient,kH.Vector2Gradient,kH.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...H),this.max.excludedConnectionPointTypes.push(...H)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let E=null;switch(this._currentLockId=-2,this.min.type){case kH.Float:case kH.Int:E=E=>{const H=this.min.getConnectedValue(E),d=this.max.getConnectedValue(E);return Math.random()*(d-H)+H};break;case kH.Vector2:E=E=>{const H=this.min.getConnectedValue(E),d=this.max.getConnectedValue(E);return new n.Vector2(Math.random()*(d.x-H.x)+H.x,Math.random()*(d.y-H.y)+H.y)};break;case kH.wH:E=E=>{const H=this.min.getConnectedValue(E),d=this.max.getConnectedValue(E);return new n.wH(Math.random()*(d.x-H.x)+H.x,Math.random()*(d.y-H.y)+H.y,Math.random()*(d.z-H.z)+H.z)};break;case kH.gg:E=E=>{const H=this.min.getConnectedValue(E),d=this.max.getConnectedValue(E);return new g.gg(Math.random()*(d.r-H.r)+H.r,Math.random()*(d.g-H.g)+H.g,Math.random()*(d.b-H.b)+H.b,Math.random()*(d.a-H.a)+H.a)}}this.output._storedFunction=H=>{var d;let n=0;switch(this.lockMode){case yH.PerParticle:n=(null===(d=H.particleContext)||void 0===d?void 0:d.id)||-1;break;case yH.PerSystem:n=H.buildId||0}return this._currentLockId!==n&&(this.lockMode!==yH.None&&(this._currentLockId=n),this.output._storedValue=E(H)),this.output._storedValue}}serialize(){const E=super.serialize();return E.lockMode=this.lockMode,E}_deserialize(E){super._deserialize(E),void 0!==E.lockMode&&(this.lockMode=E.lockMode)}}(0,c.e)([NH("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:yH.None},{label:"Per particle",value:yH.PerParticle},{label:"Per system",value:yH.PerSystem}]})],gd.prototype,"lockMode",void 0),(0,l.e)("BABYLON.RandomRangeBlock",gd);(0,l.e)("BABYLON.ParticleLerpBlock",class extends KH{constructor(E){super(E),this.registerInput("left",kH.AutoDetect),this.registerInput("right",kH.AutoDetect),this.registerInput("gradient",kH.Float,!0,0,0,1),this.registerOutput("output",kH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kH.Float|kH.Int|kH.Vector2|kH.wH|kH.gg)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const E=(E,H,d)=>(1-E)*H+E*d;this.output._storedFunction=H=>{const d=this.left.getConnectedValue(H),Z=this.right.getConnectedValue(H),I=this.gradient.getConnectedValue(H);switch(this.left.type){case kH.Int:case kH.Float:return E(I,d,Z);case kH.Vector2:return new n.Vector2(E(I,d.x,Z.x),E(I,d.y,Z.y));case kH.wH:return new n.wH(E(I,d.x,Z.x),E(I,d.y,Z.y),E(I,d.z,Z.z));case kH.gg:return new g.gg(E(I,d.r,Z.r),E(I,d.g,Z.g),E(I,d.b,Z.b),E(I,d.a,Z.a))}return 0}}});(0,l.e)("BABYLON.UpdateDirectionBlock",class extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerInput("direction",kH.wH),this.registerOutput("output",kH.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(E){const H=this.particle.getConnectedValue(E);if(this.output._storedValue=H,!this.direction.isConnected)return;const d={process:d=>{E.particleContext=d,E.systemContext=H,d.direction.l(this.direction.getConnectedValue(E))},previousItem:null,nextItem:null};H._updateQueueStart?bE(d,H._updateQueueStart):H._updateQueueStart=d}});(0,l.e)("BABYLON.UpdateColorBlock",class extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerInput("color",kH.gg),this.registerOutput("output",kH.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(E){const H=this.particle.getConnectedValue(E);if(this.output._storedValue=H,!this.color.isConnected)return;const d={process:d=>{E.particleContext=d,E.systemContext=H,d.color.l(this.color.getConnectedValue(E))},previousItem:null,nextItem:null};H._updateQueueStart?bE(d,H._updateQueueStart):H._updateQueueStart=d}});(0,l.e)("BABYLON.UpdateScaleBlock",class extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerInput("scale",kH.Vector2),this.registerOutput("output",kH.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(E){const H=this.particle.getConnectedValue(E);if(this.output._storedValue=H,!this.scale.isConnected)return;const d={process:d=>{E.particleContext=d,E.systemContext=H,d.scale.l(this.scale.getConnectedValue(E))},previousItem:null,nextItem:null};H._updateQueueStart?bE(d,H._updateQueueStart):H._updateQueueStart=d}});(0,l.e)("BABYLON.UpdateAngleBlock",class extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerInput("angle",kH.Float),this.registerOutput("output",kH.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(E){const H=this.particle.getConnectedValue(E);if(this.output._storedValue=H,!this.angle.isConnected)return;const d={process:d=>{E.particleContext=d,E.systemContext=H,d.angle=this.angle.getConnectedValue(E)},previousItem:null,nextItem:null};H._updateQueueStart?bE(d,H._updateQueueStart):H._updateQueueStart=d}});(0,l.e)("BABYLON.BasicPositionUpdateBlock",class extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerOutput("output",kH.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(E){const H=this.particle.getConnectedValue(E),d={process:d=>{E.particleContext=d,E.systemContext=H,d.direction.scaleToRef(H._directionScale,H._scaledDirection),d.position.addInPlace(H._scaledDirection)},previousItem:null,nextItem:null};H._updateQueueStart?bE(d,H._updateQueueStart):H._updateQueueStart=d,this.output._storedValue=H}});(0,l.e)("BABYLON.BasicSpriteUpdateBlock",class extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerOutput("output",kH.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(E){const H=this.particle.getConnectedValue(E),d={process:d=>{E.particleContext=d,E.systemContext=H,d.updateCellIndex()},previousItem:null,nextItem:null};H._updateQueueStart?bE(d,H._updateQueueStart):H._updateQueueStart=d,this.output._storedValue=H}});(0,l.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerInput("cellIndex",kH.Int),this.registerOutput("output",kH.Particle),this.cellIndex.acceptedConnectionPointTypes=[kH.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(E){const H=this.particle.getConnectedValue(E);if(this.output._storedValue=H,!this.cellIndex.isConnected)return;const d={process:d=>{E.particleContext=d,E.systemContext=H,d.cellIndex=Math.floor(this.cellIndex.getConnectedValue(E))},previousItem:null,nextItem:null};H._updateQueueStart?bE(d,H._updateQueueStart):H._updateQueueStart=d}});class ld extends KH{constructor(E){super(E),this.strength=1,this.registerInput("particle",kH.Particle),this.registerInput("flowMap",kH.Texture),this.registerOutput("output",kH.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(E){var H;const d=this.particle.getConnectedValue(E),n=E.QH;let Z;(null===(H=this.flowMap.connectedPoint)||void 0===H?void 0:H.ownerBlock).extractTextureContentAsync().then((E=>{E&&(Z=new aH(E.width,E.height,E.data))}));const I={process:E=>{const H=n.getTransformMatrix();Z&&Z._processParticle(E,this.strength*d._tempScaledUpdateSpeed,H)},previousItem:null,nextItem:null};d._updateQueueStart?bE(I,d._updateQueueStart):d._updateQueueStart=I,this.output._storedValue=d}serialize(){const E=super.serialize();return E.strength=this.strength,E}_deserialize(E){super._deserialize(E),this.strength=E.strength}}(0,c.e)([NH("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ld.prototype,"strength",void 0),(0,l.e)("BABYLON.UpdateFlowMapBlock",ld);(0,l.e)("BABYLON.SphereShapeBlock",class extends KH{constructor(E){super(E),this.registerInput("input",kH.Particle),this.registerInput("radius",kH.Float,!0,1),this.registerInput("radiusRange",kH.Float,!0,1,0,1),this.registerInput("directionRandomizer",kH.Float,!0,0,0,1),this.registerOutput("output",kH.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(E){const H=this.input.getConnectedValue(E);H._directionCreation.process=d=>{E.particleContext=d,E.systemContext=H;const Z=this.directionRandomizer.getConnectedValue(E),I=d.position.RH(E.emitterPosition).normalize(),g=(0,t.RandomRange)(0,Z),l=(0,t.RandomRange)(0,Z),r=(0,t.RandomRange)(0,Z);I.x+=g,I.y+=l,I.z+=r,I.normalize(),E.isEmitterTransformNode?n.wH.TransformNormalFromFloatsToRef(g,l,r,E.emitterWorldMatrix,d.direction):d.direction.en(g,l,r)},H._positionCreation.process=d=>{E.particleContext=d,E.systemContext=H;const Z=this.radius.getConnectedValue(E),I=this.radiusRange.getConnectedValue(E),g=Z-(0,t.RandomRange)(0,Z*I),l=(0,t.RandomRange)(0,1),r=(0,t.RandomRange)(0,2*Math.PI),S=Math.acos(2*l-1),M=g*Math.cos(r)*Math.sin(S),V=g*Math.cos(S),C=g*Math.sin(r)*Math.sin(S);E.isEmitterTransformNode?n.wH.TransformCoordinatesFromFloatsToRef(M,V,C,E.emitterWorldMatrix,d.position):(d.position.en(M,V,C),d.position.addInPlace(E.emitterPosition))},this.output._storedValue=H}});(0,l.e)("BABYLON.PointShapeBlock",class extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerInput("direction1",kH.wH,!0,new n.wH(0,1,0)),this.registerInput("direction2",kH.wH,!0,new n.wH(0,1,0)),this.registerOutput("output",kH.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(E){const H=this.particle.getConnectedValue(E);H._directionCreation.process=d=>{E.particleContext=d,E.systemContext=H;const Z=this.direction1.getConnectedValue(E),I=this.direction2.getConnectedValue(E),g=(0,t.RandomRange)(Z.x,I.x),l=(0,t.RandomRange)(Z.y,I.y),r=(0,t.RandomRange)(Z.z,I.z);E.isEmitterTransformNode?n.wH.TransformNormalFromFloatsToRef(g,l,r,E.emitterWorldMatrix,d.direction):d.direction.en(g,l,r)},H._positionCreation.process=d=>{E.systemContext=H,E.isEmitterTransformNode?n.wH.TransformCoordinatesFromFloatsToRef(0,0,0,E.emitterWorldMatrix,d.position):d.position.l(E.emitterPosition)},this.output._storedValue=H}});(0,l.e)("BABYLON.CustomShapeBlock",class extends KH{constructor(E){super(E),this.registerInput("particle",kH.Particle),this.registerInput("position",kH.wH,!0,new n.wH(0,0,0)),this.registerInput("direction",kH.wH,!0,new n.wH(0,1,0)),this.registerOutput("output",kH.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(E){const H=this.particle.getConnectedValue(E);H._directionCreation.process=d=>{E.particleContext=d,E.systemContext=H;const Z=this.direction.getConnectedValue(E);E.isEmitterTransformNode?n.wH.TransformNormalToRef(Z,E.emitterWorldMatrix,d.direction):d.direction.l(Z)},H._positionCreation.process=d=>{E.particleContext=d,E.systemContext=H;const Z=this.position.getConnectedValue(E);E.isEmitterTransformNode?n.wH.TransformCoordinatesToRef(Z,E.emitterWorldMatrix,d.position):(d.position.l(Z),d.position.addInPlace(E.emitterPosition))},this.output._storedValue=H}});(0,l.e)("BABYLON.CylinderShapeBlock",class extends KH{constructor(E){super(E),this._tempVector=n.wH.Zero(),this.registerInput("particle",kH.Particle),this.registerInput("radius",kH.Float,!0,1),this.registerInput("height",kH.Float,!0,1,0),this.registerInput("radiusRange",kH.Float,!0,1,0,1),this.registerInput("directionRandomizer",kH.Float,!0,0,0,1),this.registerOutput("output",kH.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(E){const H=this.particle.getConnectedValue(E);H._directionCreation.process=d=>{E.particleContext=d,E.systemContext=H;const Z=this.directionRandomizer.getConnectedValue(E);d.position.subtractToRef(E.emitterPosition,this._tempVector),this._tempVector.normalize(),E.isEmitterTransformNode&&n.wH.TransformNormalToRef(this._tempVector,E.emitterInverseWorldMatrix,this._tempVector);const I=(0,t.RandomRange)(-Z/2,Z/2);let g=Math.atan2(this._tempVector.x,this._tempVector.z);g+=(0,t.RandomRange)(-Math.PI/2,Math.PI/2)*Z,this._tempVector.y=I,this._tempVector.x=Math.sin(g),this._tempVector.z=Math.cos(g),this._tempVector.normalize(),E.isEmitterTransformNode?n.wH.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,E.emitterWorldMatrix,d.direction):d.direction.l(this._tempVector)},H._positionCreation.process=d=>{E.particleContext=d,E.systemContext=H;const Z=this.height.getConnectedValue(E),I=this.radiusRange.getConnectedValue(E),g=this.radius.getConnectedValue(E),l=(0,t.RandomRange)(-Z/2,Z/2),r=(0,t.RandomRange)(0,2*Math.PI),S=(0,t.RandomRange)((1-I)*(1-I),1),M=Math.sqrt(S)*g,V=M*Math.cos(r),C=M*Math.sin(r);E.isEmitterTransformNode?n.wH.TransformCoordinatesFromFloatsToRef(V,l,C,E.emitterWorldMatrix,d.position):(d.position.en(V,l,C),d.position.addInPlace(E.emitterPosition))},this.output._storedValue=H}});class rd extends KH{constructor(E){super(E),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",kH.Particle),this.registerOutput("output",kH.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){super._build(E);const H=this.particle.getConnectedValue(E);H._isAnimationSheetEnabled=!0,H.spriteCellWidth=this.width,H.spriteCellHeight=this.height,H.startSpriteCellID=this.start,H.endSpriteCellID=this.end,H.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=H}serialize(){const E=super.serialize();return E.width=this.width,E.height=this.height,E.start=this.start,E.end=this.end,E.randomStartCell=this.randomStartCell,E}_deserialize(E){super._deserialize(E),this.width=E.width,this.height=E.height,this.start=E.start,this.end=E.end,this.randomStartCell=E.randomStartCell}}(0,c.e)([NH("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rd.prototype,"start",void 0),(0,c.e)([NH("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rd.prototype,"end",void 0),(0,c.e)([NH("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rd.prototype,"width",void 0),(0,c.e)([NH("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rd.prototype,"height",void 0),(0,c.e)([NH("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rd.prototype,"loop",void 0),(0,c.e)([NH("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rd.prototype,"randomStartCell",void 0),(0,l.e)("BABYLON.SetupSpriteSheetBlock",rd);class td extends KH{constructor(E){super(E),this.reference=0,this.registerInput("value",kH.AutoDetect),this.registerOutput("output",kH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=E=>{switch(E){case kH.Float:return kH.FloatGradient;case kH.Vector2:return kH.Vector2Gradient;case kH.wH:return kH.Vector3Gradient;case kH.gg:return kH.Color4Gradient}return E},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kH.Float|kH.Vector2|kH.wH|kH.gg)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=E=>null}serialize(){const E=super.serialize();return E.reference=this.reference,E}_deserialize(E){super._deserialize(E),this.reference=E.reference}}(0,c.e)([NH("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],td.prototype,"reference",void 0),(0,l.e)("BABYLON.ParticleGradientValueBlock",td);(0,l.e)("BABYLON.ParticleGradientBlock",class extends KH{constructor(E){super(E),this._entryCount=1,this.registerInput("gradient",kH.Float,!0,1,0,1),this.registerInput("value0",kH.AutoDetect),this.registerOutput("output",kH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=E=>{switch(E){case kH.FloatGradient:return kH.Float;case kH.Vector2Gradient:return kH.Vector2;case kH.Vector3Gradient:return kH.wH;case kH.Color4Gradient:return kH.gg}return E},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(kH.FloatGradient|kH.Vector2Gradient|kH.Vector3Gradient|kH.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(E){this._inputs[E].onConnectionObservable.add((()=>{this._entryCount>E||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),kH.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const E=[];for(let d=1;d<this._inputs.length;d++){var H;if(this._inputs[d].isConnected)E.push(null===(H=this._inputs[d].connectedPoint)||void 0===H?void 0:H.ownerBlock)}E.sort(((E,H)=>E.reference-H.reference)),this.output._storedFunction=H=>{const d=this.gradient.getConnectedValue(H);if(1===E.length)return E[0].value.getConnectedValue(H);let Z=null;for(let I=E.length-1;I>=0;I--){const l=E[I];if(l.reference<=d){const E=l.value.getConnectedValue(H);if(Z){const I=Z.value.getConnectedValue(H),r=Z.reference,S=l.reference,M=Math.max(0,Math.min(1,(d-S)/(r-S)));switch(this.output.type){case kH.Float:return(0,t.Lerp)(E,I,M);case kH.Vector2:return n.Vector2.Lerp(E,I,M);case kH.wH:return n.wH.Lerp(E,I,M);case kH.gg:return g.gg.Lerp(E,I,M)}}return E}Z=l}return 0}}});(0,l.e)("BABYLON.ParticleConverterBlock",class extends KH{constructor(E){super(E),this.registerInput("color ",kH.gg,!0),this.registerInput("xyz ",kH.wH,!0),this.registerInput("xy ",kH.Vector2,!0),this.registerInput("zw ",kH.Vector2,!0),this.registerInput("x ",kH.Float,!0),this.registerInput("y ",kH.Float,!0),this.registerInput("z ",kH.Float,!0),this.registerInput("w ",kH.Float,!0),this.registerOutput("color",kH.gg),this.registerOutput("xyz",kH.wH),this.registerOutput("xy",kH.Vector2),this.registerOutput("zw",kH.Vector2),this.registerOutput("x",kH.Float),this.registerOutput("y",kH.Float),this.registerOutput("z",kH.Float),this.registerOutput("w",kH.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(E){return"color "===E?"colorIn":"xyz "===E?"xyzIn":"xy "===E?"xyIn":"zw "===E?"zwIn":"x "===E?"xIn":"y "===E?"yIn":"z "===E?"zIn":"w "===E?"wIn":E}_outputRename(E){switch(E){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return E}}_build(E){super._build(E);const H=this.xIn,d=this.yIn,Z=this.zIn,I=this.wIn,l=this.xyIn,r=this.zwIn,t=this.xyzIn,S=this.colorIn,M=this.colorOut,V=this.xyzOut,C=this.xyOut,w=this.zwOut,R=this.xOut,Q=this.yOut,L=this.zOut,D=this.wOut,e=E=>{if(S.isConnected)return S.getConnectedValue(E);let n=0,M=0,V=0,C=0;if(H.isConnected&&(n=H.getConnectedValue(E)),d.isConnected&&(M=d.getConnectedValue(E)),Z.isConnected&&(V=Z.getConnectedValue(E)),I.isConnected&&(C=I.getConnectedValue(E)),l.isConnected){const H=l.getConnectedValue(E);H&&(n=H.x,M=H.y)}if(r.isConnected){const H=r.getConnectedValue(E);H&&(V=H.x,C=H.y)}if(t.isConnected){const H=t.getConnectedValue(E);H&&(n=H.x,M=H.y,V=H.z)}return new g.gg(n,M,V,C)};M._storedFunction=E=>e(E),V._storedFunction=E=>{const H=e(E);return new n.wH(H.r,H.g,H.b)},C._storedFunction=E=>{const H=e(E);return new n.Vector2(H.r,H.g)},w._storedFunction=E=>{const H=e(E);return new n.Vector2(H.b,H.a)},R._storedFunction=E=>e(E).r,Q._storedFunction=E=>e(E).g,L._storedFunction=E=>e(E).b,D._storedFunction=E=>e(E).a}}),function(E){E[E.Cos=0]="Cos",E[E.Sin=1]="Sin",E[E.Abs=2]="Abs",E[E.Exp=3]="Exp",E[E.Exp2=4]="Exp2",E[E.Round=5]="Round",E[E.Floor=6]="Floor",E[E.Ceiling=7]="Ceiling",E[E.Sqrt=8]="Sqrt",E[E.Log=9]="Log",E[E.Tan=10]="Tan",E[E.ArcTan=11]="ArcTan",E[E.ArcCos=12]="ArcCos",E[E.ArcSin=13]="ArcSin",E[E.Sign=14]="Sign",E[E.Negate=15]="Negate",E[E.OneMinus=16]="OneMinus",E[E.Reciprocal=17]="Reciprocal",E[E.ToDegrees=18]="ToDegrees",E[E.ToRadians=19]="ToRadians",E[E.Fract=20]="Fract"}(vH||(vH={}));class Sd extends KH{constructor(E){super(E),this.operation=vH.Cos,this.registerInput("input",kH.AutoDetect),this.registerOutput("output",kH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kH.Float|kH.Int|kH.Vector2|kH.wH|kH.gg)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){super._build(E);let H=null;switch(this.operation){case vH.Cos:H=E=>Math.cos(E);break;case vH.Sin:H=E=>Math.sin(E);break;case vH.Abs:H=E=>Math.abs(E);break;case vH.Exp:H=E=>Math.exp(E);break;case vH.Exp2:H=E=>Math.pow(2,E);break;case vH.Round:H=E=>Math.round(E);break;case vH.Floor:H=E=>Math.floor(E);break;case vH.Ceiling:H=E=>Math.ceil(E);break;case vH.Sqrt:H=E=>Math.sqrt(E);break;case vH.Log:H=E=>Math.log(E);break;case vH.Tan:H=E=>Math.tan(E);break;case vH.ArcTan:H=E=>Math.atan(E);break;case vH.ArcCos:H=E=>Math.acos(E);break;case vH.ArcSin:H=E=>Math.asin(E);break;case vH.Sign:H=E=>Math.sign(E);break;case vH.Negate:H=E=>-E;break;case vH.OneMinus:H=E=>1-E;break;case vH.Reciprocal:H=E=>1/E;break;case vH.ToRadians:H=E=>E*Math.PI/180;break;case vH.ToDegrees:H=E=>180*E/Math.PI;break;case vH.Fract:H=E=>E>=0?E-Math.floor(E):E-Math.ceil(E)}if(!H)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case kH.Int:case kH.Float:this.output._storedFunction=E=>{const d=this.input.getConnectedValue(E);return H(d)};break;case kH.Vector2:this.output._storedFunction=E=>{const d=this.input.getConnectedValue(E);return new n.Vector2(H(d.x),H(d.y))};break;case kH.wH:this.output._storedFunction=E=>{const d=this.input.getConnectedValue(E);return new n.wH(H(d.x),H(d.y),H(d.z))};break;case kH.gg:this.output._storedFunction=E=>{const d=this.input.getConnectedValue(E);return new g.gg(H(d.r),H(d.g),H(d.b),H(d.a))}}return this}serialize(){const E=super.serialize();return E.operation=this.operation,E}_deserialize(E){super._deserialize(E),this.operation=E.operation}}(0,c.e)([NH("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:vH.Cos},{label:"Sin",value:vH.Sin},{label:"Abs",value:vH.Abs},{label:"Exp",value:vH.Exp},{label:"Exp2",value:vH.Exp2},{label:"Round",value:vH.Round},{label:"Floor",value:vH.Floor},{label:"Ceiling",value:vH.Ceiling},{label:"Sqrt",value:vH.Sqrt},{label:"Log",value:vH.Log},{label:"Tan",value:vH.Tan},{label:"ArcTan",value:vH.ArcTan},{label:"ArcCos",value:vH.ArcCos},{label:"ArcSin",value:vH.ArcSin},{label:"Sign",value:vH.Sign},{label:"Negate",value:vH.Negate},{label:"OneMinus",value:vH.OneMinus},{label:"Reciprocal",value:vH.Reciprocal},{label:"ToDegrees",value:vH.ToDegrees},{label:"ToRadians",value:vH.ToRadians},{label:"Fract",value:vH.Fract}]})],Sd.prototype,"operation",void 0),(0,l.e)("BABYLON.ParticleTrigonometryBlock",Sd);var Md,Vd=d(13792);class Cd extends KH{constructor(E){super(E),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",kH.AutoDetect),this.registerOutput("output",kH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(kH.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(kH.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(kH.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(kH.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(kH.System),this._inputs[0].excludedConnectionPointTypes.push(kH.Particle),this._inputs[0].excludedConnectionPointTypes.push(kH.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const H=E=>{const H=this.input.getConnectedValue(E);if(this.log.length>=this.stackSize)return H;if(null===H||void 0===H)return this.log.push(["null",""]),H;switch(this.input.type){case kH.Vector2:this.log.push([(0,Vd.g)(H,4),H.toString()]);break;case kH.wH:this.log.push([(0,Vd.i)(H,4),H.toString()]);break;case kH.gg:this.log.push([`{R: ${H.r.toFixed(4)} G: ${H.g.toFixed(4)} B: ${H.b.toFixed(4)} A: ${H.a.toFixed(4)}}`,H.toString()]);break;default:this.log.push([H.toString(),H.toString()])}return H};this.output.isConnected?this.output._storedFunction=H:this.output._storedValue=H(E)}serialize(){const E=super.serialize();return E.stackSize=this.stackSize,E}_deserialize(E){super._deserialize(E),this.stackSize=E.stackSize}}(0,c.e)([NH("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Cd.prototype,"stackSize",void 0),(0,l.e)("BABYLON.ParticleDebugBlock",Cd);(0,l.e)("BABYLON.ParticleElbowBlock",class extends KH{constructor(E){super(E),this.registerInput("input",kH.AutoDetect),this.registerOutput("output",kH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(E){super._build(E);const H=this._outputs[0],d=this._inputs[0];H._storedFunction=E=>d.getConnectedValue(E)}});(0,l.e)("BABYLON.ParticleTeleportInBlock",class extends KH{get endpoints(){return this._endpoints}constructor(E){super(E),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",kH.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(E){if(this.getClassName()===E)return!0;for(const H of this.endpoints)if(H.isAnAncestorOfType(E))return!0;return!1}isAnAncestorOf(E){for(const H of this.endpoints){if(H===E)return!0;if(H.isAnAncestorOf(E))return!0}return!1}attachToEndpoint(E){E.detach(),this._endpoints.push(E),E._entryPoint=this,E._outputs[0]._typeConnectionSource=this._inputs[0],E._tempEntryPointUniqueId=null,E.name="> "+this.name}detachFromEndpoint(E){const H=this._endpoints.indexOf(E);-1!==H&&(this._endpoints.splice(H,1),E._outputs[0]._typeConnectionSource=null,E._entryPoint=null)}_build(){for(const E of this._endpoints)E.output._storedFunction=E=>this.input.getConnectedValue(E)}});(0,l.e)("BABYLON.ParticleTeleportOutBlock",class extends KH{constructor(E){super(E),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",kH.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(E){this.entryPoint&&this.entryPoint.build(E)}clone(){const E=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(E),E}serialize(){var E;const H=super.serialize();return H.entryPoint=(null===(E=this.entryPoint)||void 0===E?void 0:E.uniqueId)??"",H}_deserialize(E){super._deserialize(E),this._tempEntryPointUniqueId=E.entryPoint}}),function(E){E[E.Equal=0]="Equal",E[E.NotEqual=1]="NotEqual",E[E.LessThan=2]="LessThan",E[E.GreaterThan=3]="GreaterThan",E[E.LessOrEqual=4]="LessOrEqual",E[E.GreaterOrEqual=5]="GreaterOrEqual",E[E.Xor=6]="Xor",E[E.Or=7]="Or",E[E.And=8]="And"}(Md||(Md={}));class wd extends KH{constructor(E){super(E),this.test=Md.Equal,this.epsilon=0,this.registerInput("left",kH.Float),this.registerInput("right",kH.Float,!0,0),this.registerInput("ifTrue",kH.AutoDetect,!0,1),this.registerInput("ifFalse",kH.AutoDetect,!0,0),this.registerOutput("output",kH.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=kH.Float,this._inputs[0].acceptedConnectionPointTypes.push(kH.Int),this._inputs[1].acceptedConnectionPointTypes.push(kH.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const E=E=>{const H=this.left.getConnectedValue(E),d=this.right.getConnectedValue(E);let n=!1;switch(this.test){case Md.Equal:n=(0,t.WithinEpsilon)(H,d,this.epsilon);break;case Md.NotEqual:n=!(0,t.WithinEpsilon)(H,d,this.epsilon);break;case Md.LessThan:n=H<d+this.epsilon;break;case Md.GreaterThan:n=H>d-this.epsilon;break;case Md.LessOrEqual:n=H<=d+this.epsilon;break;case Md.GreaterOrEqual:n=H>=d-this.epsilon;break;case Md.Xor:n=!!H&&!d||!H&&!!d;break;case Md.Or:n=!!H||!!d;break;case Md.And:n=!!H&&!!d}return n};this.output._storedFunction=H=>E(H)?this.ifTrue.getConnectedValue(H):this.ifFalse.getConnectedValue(H)}serialize(){const E=super.serialize();return E.test=this.test,E.epsilon=this.epsilon,E}_deserialize(E){super._deserialize(E),this.test=E.test,void 0!==E.epsilon&&(this.epsilon=E.epsilon)}}(0,c.e)([NH("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Md.Equal},{label:"NotEqual",value:Md.NotEqual},{label:"LessThan",value:Md.LessThan},{label:"GreaterThan",value:Md.GreaterThan},{label:"LessOrEqual",value:Md.LessOrEqual},{label:"GreaterOrEqual",value:Md.GreaterOrEqual},{label:"Xor",value:Md.Xor},{label:"Or",value:Md.Or},{label:"And",value:Md.And}]})],wd.prototype,"test",void 0),(0,c.e)([NH("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wd.prototype,"epsilon",void 0),(0,l.e)("BABYLON.ParticleConditionBlock",wd);class Rd extends KH{constructor(E){super(E),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",kH.Particle),this.registerInput("condition",kH.Float,!0,0),this.registerInput("system",kH.System),this.registerOutput("output",kH.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(E){this._triggerCount=0;const H=this.input.getConnectedValue(E),d={process:d=>{if(E.particleContext=d,E.systemContext=H,0!==this.condition.getConnectedValue(E)&&(0===this.limit||this._triggerCount<this.limit)){const n=(new Date).getTime();if(this._previousOne&&n-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=n;const Z=this.system.getConnectedValue(E);if(Z){const n=TH(Z,E.QH,d.position);n.Qd.addOnce((()=>{this._triggerCount--})),H.Qd.addOnce((()=>{n.dispose()}))}}},previousItem:null,nextItem:null};H._updateQueueStart?bE(d,H._updateQueueStart):H._updateQueueStart=d,this.output._storedValue=H}serialize(){const E=super.serialize();return E.limit=this.limit,E.delay=this.delay,E}_deserialize(E){super._deserialize(E),void 0!==E.limit&&(this.limit=E.limit),void 0!==E.delay&&(this.delay=E.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,c.e)([NH("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Rd.prototype,"limit",void 0),(0,c.e)([NH("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Rd.prototype,"delay",void 0),(0,l.e)("BABYLON.ParticleTriggerBlock",Rd);d(13796),d(13802),d(13809),d(13863)},13847:(E,H,d)=>{"use strict";var n=d(12307);const Z="clipPlaneFragment",I="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13813:(E,H,d)=>{"use strict";var n=d(12307);const Z="clipPlaneFragmentDeclaration",I="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13884:(E,H,d)=>{"use strict";var n=d(12307);const Z="clipPlaneVertex",I="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13871:(E,H,d)=>{"use strict";var n=d(12307);const Z="clipPlaneVertexDeclaration",I="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13857:(E,H,d)=>{"use strict";var n=d(12307);const Z="fogFragment",I="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13841:(E,H,d)=>{"use strict";var n=d(12307);const Z="fogFragmentDeclaration",I="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13886:(E,H,d)=>{"use strict";var n=d(12307);const Z="fogVertex",I="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13879:(E,H,d)=>{"use strict";var n=d(12307);const Z="fogVertexDeclaration",I="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13833:(E,H,d)=>{"use strict";var n=d(12307);const Z="helperFunctions",I="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13822:(E,H,d)=>{"use strict";var n=d(12307);const Z="imageProcessingDeclaration",I="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13835:(E,H,d)=>{"use strict";var n=d(12307);const Z="imageProcessingFunctions",I="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13830:(E,H,d)=>{"use strict";var n=d(12307);const Z="logDepthDeclaration",I="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13850:(E,H,d)=>{"use strict";var n=d(12307);const Z="logDepthFragment",I="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13890:(E,H,d)=>{"use strict";var n=d(12307);const Z="logDepthVertex",I="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";n.e.IncludesShadersStoreWGSL[Z]||(n.e.IncludesShadersStoreWGSL[Z]=I)},13809:(E,H,d)=>{"use strict";d.r(H),d.d(H,{particlesPixelShaderWGSL:()=>g});var n=d(12307);d(13813),d(13822),d(13830),d(13833),d(13835),d(13841),d(13847),d(13850),d(13857);const Z="particlesPixelShader",I="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";n.e.ShadersStoreWGSL[Z]||(n.e.ShadersStoreWGSL[Z]=I);const g={name:Z,shader:I}},13863:(E,H,d)=>{"use strict";d.r(H),d.d(H,{particlesVertexShaderWGSL:()=>g});var n=d(12307);d(13871),d(13879),d(13830),d(13884),d(13886),d(13890);const Z="particlesVertexShader",I="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";n.e.ShadersStoreWGSL[Z]||(n.e.ShadersStoreWGSL[Z]=I);const g={name:Z,shader:I}},13733:(E,H,d)=>{"use strict";var n=d(12307);const Z="clipPlaneFragment",I="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13800:(E,H,d)=>{"use strict";var n=d(12307);const Z="clipPlaneFragmentDeclaration",I="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13759:(E,H,d)=>{"use strict";var n=d(12307);const Z="clipPlaneVertex",I="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13807:(E,H,d)=>{"use strict";var n=d(12307);const Z="clipPlaneVertexDeclaration",I="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13742:(E,H,d)=>{"use strict";var n=d(12307);const Z="fogFragment",I="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13725:(E,H,d)=>{"use strict";var n=d(12307);const Z="fogFragmentDeclaration",I="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13767:(E,H,d)=>{"use strict";var n=d(12307);const Z="fogVertex",I="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13750:(E,H,d)=>{"use strict";var n=d(12307);const Z="fogVertexDeclaration",I="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13715:(E,H,d)=>{"use strict";var n=d(12307);const Z="helperFunctions",I="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13705:(E,H,d)=>{"use strict";var n=d(12307);const Z="imageProcessingDeclaration",I="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13722:(E,H,d)=>{"use strict";var n=d(12307);const Z="imageProcessingFunctions",I="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13711:(E,H,d)=>{"use strict";var n=d(12307);const Z="logDepthDeclaration",I="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13735:(E,H,d)=>{"use strict";var n=d(12307);const Z="logDepthFragment",I="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13772:(E,H,d)=>{"use strict";var n=d(12307);const Z="logDepthVertex",I="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";n.e.IncludesShadersStore[Z]||(n.e.IncludesShadersStore[Z]=I)},13796:(E,H,d)=>{"use strict";d.r(H),d.d(H,{particlesPixelShader:()=>g});var n=d(12307);d(13800),d(13705),d(13711),d(13715),d(13722),d(13725),d(13733),d(13735),d(13742);const Z="particlesPixelShader",I="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";n.e.ShadersStore[Z]||(n.e.ShadersStore[Z]=I);const g={name:Z,shader:I}},13802:(E,H,d)=>{"use strict";d.r(H),d.d(H,{particlesVertexShader:()=>g});var n=d(12307);d(13807),d(13750),d(13711),d(13759),d(13767),d(13772);const Z="particlesVertexShader",I="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";n.e.ShadersStore[Z]||(n.e.ShadersStore[Z]=I);const g={name:Z,shader:I}},14142:(E,H,d)=>{"use strict";d.r(H),d.d(H,{FlowGraphGLTFDataProvider:()=>I});var n=d(14125),Z=d(14103);class I extends n.c{constructor(E){var H,d;super();const n=E.glTF,I=(null===(H=n.animations)||void 0===H?void 0:H.map((E=>E._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",Z.e,I);const g=(null===(d=n.nodes)||void 0===d?void 0:d.map((E=>E._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",Z.e,g)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14043:(E,H,d)=>{"use strict";d.d(H,{c:()=>Q,d:()=>w,e:()=>C,h:()=>R});var n=d(12384),Z=d(12866),I=d(12437),g=d(14049);const l=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class r{constructor(E,H){this._gltf=E,this._infoTree=H}convert(E){let H,d=this._gltf,n=this._infoTree;if(!E.startsWith("/"))throw new Error("Path must start with a /");const Z=E.split("/");if(Z.shift(),Z[Z.length-1].includes(".length")){const E=Z[Z.length-1].split(".");Z.pop(),Z.push(...E)}let I=!1;for(const r of Z){const Z="length"===r;if(Z&&!n.__array__)throw new Error(`Path ${E} is invalid`);if(n.__ignoreObjectTree__&&(I=!0),n.__array__&&!Z)n=n.__array__;else if(n=n[r],!n)throw new Error(`Path ${E} is invalid`);if(!I)if(void 0===d){if(!l.find((H=>H.regex.test(E))))throw new Error(`Path ${E} is invalid`)}else if(!Z){var g;d=null===(g=d)||void 0===g?void 0:g[r]}(n.__target__||Z)&&(H=d)}return{object:H,info:n}}}function t(E,H,d,n){const Z=S(E,H);return n?Z[d][n]:Z[d]}function S(E,H,d){var n,I;return null===(n=E._data)||void 0===n||null===(I=n[(null===d||void 0===d?void 0:d.fillMode)??Z.e.MATERIAL_TriangleFillMode])||void 0===I?void 0:I.babylonMaterial}function M(E,H){return{offset:{componentsCount:2,type:"Vector2",get:(d,Z,I)=>{const g=t(d,I,E,H);return new n.Vector2(null===g||void 0===g?void 0:g.uOffset,null===g||void 0===g?void 0:g.vOffset)},getTarget:S,set:(d,n,Z,I)=>{const g=t(n,I,E,H);g.uOffset=d.x,g.vOffset=d.y},getPropertyName:[()=>`${E}${H?"."+H:""}.uOffset`,()=>`${E}${H?"."+H:""}.vOffset`]},rotation:{type:"number",get:(d,n,Z)=>{var I;return null===(I=t(d,Z,E,H))||void 0===I?void 0:I.wAng},getTarget:S,set:(d,n,Z,I)=>t(n,I,E,H).wAng=d,getPropertyName:[()=>`${E}${H?"."+H:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(d,Z,I)=>{const g=t(d,I,E,H);return new n.Vector2(null===g||void 0===g?void 0:g.uScale,null===g||void 0===g?void 0:g.vScale)},getTarget:S,set:(d,n,Z,I)=>{const g=t(n,I,E,H);g.uScale=d.x,g.vScale=d.y},getPropertyName:[()=>`${E}${H?"."+H:""}.uScale`,()=>`${E}${H?"."+H:""}.vScale`]}}}const V={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:E=>{var H,d;return new n.Vector2((null===(H=E._babylonCamera)||void 0===H?void 0:H.orthoLeft)??0,(null===(d=E._babylonCamera)||void 0===d?void 0:d.orthoRight)??0)},set:(E,H)=>{H._babylonCamera&&(H._babylonCamera.orthoLeft=E.x,H._babylonCamera.orthoRight=E.y)},getTarget:E=>E,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:E=>{var H,d;return new n.Vector2((null===(H=E._babylonCamera)||void 0===H?void 0:H.orthoBottom)??0,(null===(d=E._babylonCamera)||void 0===d?void 0:d.orthoTop)??0)},set:(E,H)=>{H._babylonCamera&&(H._babylonCamera.orthoBottom=E.x,H._babylonCamera.orthoTop=E.y)},getTarget:E=>E,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:E=>{var H;return null===(H=E._babylonCamera)||void 0===H?void 0:H.maxZ},set:(E,H)=>{H._babylonCamera&&(H._babylonCamera.maxZ=E)},getTarget:E=>E,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:E=>{var H;return null===(H=E._babylonCamera)||void 0===H?void 0:H.Gd},set:(E,H)=>{H._babylonCamera&&(H._babylonCamera.Gd=E)},getTarget:E=>E,getPropertyName:[()=>"Gd"]}},perspective:{aspectRatio:{type:"number",get:E=>{var H;return null===(H=E._babylonCamera)||void 0===H?void 0:H.getEngine().getAspectRatio(E._babylonCamera)},getTarget:E=>E,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:E=>{var H;return null===(H=E._babylonCamera)||void 0===H?void 0:H.fov},set:(E,H)=>{H._babylonCamera&&(H._babylonCamera.fov=E)},getTarget:E=>E,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:E=>{var H;return null===(H=E._babylonCamera)||void 0===H?void 0:H.maxZ},set:(E,H)=>{H._babylonCamera&&(H._babylonCamera.maxZ=E)},getTarget:E=>E,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:E=>{var H;return null===(H=E._babylonCamera)||void 0===H?void 0:H.Gd},set:(E,H)=>{H._babylonCamera&&(H._babylonCamera.Gd=E)},getTarget:E=>E,getPropertyName:[()=>"Gd"]}}}},nodes:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"wH",get:E=>{var H;return null===(H=E._babylonTransformNode)||void 0===H?void 0:H.position},set:(E,H)=>{var d;return null===(d=H._babylonTransformNode)||void 0===d?void 0:d.position.l(E)},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:E=>{var H;return null===(H=E._babylonTransformNode)||void 0===H?void 0:H.rotationQuaternion},set:(E,H)=>{var d,n;return null===(d=H._babylonTransformNode)||void 0===d||null===(n=d.rotationQuaternion)||void 0===n?void 0:n.l(E)},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"wH",get:E=>{var H;return null===(H=E._babylonTransformNode)||void 0===H?void 0:H.mg},set:(E,H)=>{var d;return null===(d=H._babylonTransformNode)||void 0===d?void 0:d.mg.l(E)},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"mg"]},weights:{length:{type:"number",get:E=>E._numMorphTargets,getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(E,H)=>{var d,n;return void 0!==H?null===(d=E._primitiveBabylonMeshes)||void 0===d||null===(n=d[0].morphTargetManager)||void 0===n?void 0:n.getTarget(H).influence:void 0},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(E,H)=>[0],getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:E=>{var H,d,Z;return n.Matrix.Compose(null===(H=E._babylonTransformNode)||void 0===H?void 0:H.mg,null===(d=E._babylonTransformNode)||void 0===d?void 0:d.rotationQuaternion,null===(Z=E._babylonTransformNode)||void 0===Z?void 0:Z.position)},getTarget:E=>E._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:E=>{var H,d,Z,I;const g=n.Matrix.Identity();let l=E.parent;for(;l&&l.parent;)l=l.parent;const r=(null===(H=E._babylonTransformNode)||void 0===H?void 0:H.position._isDirty)||(null===(d=E._babylonTransformNode)||void 0===d||null===(Z=d.rotationQuaternion)||void 0===Z?void 0:Z._isDirty)||(null===(I=E._babylonTransformNode)||void 0===I?void 0:I.mg._isDirty);if(l){var t;const H=null===(t=l._babylonTransformNode)||void 0===t?void 0:t.yd(!0).invert();var S,M;if(H)null===(S=E._babylonTransformNode)||void 0===S||null===(M=S.yd(r))||void 0===M||M.multiplyToRef(H,g)}else E._babylonTransformNode&&g.l(E._babylonTransformNode.yd(r));return g},getTarget:E=>E._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:E=>{var H,d;return null===(H=E._babylonTransformNode)||void 0===H||null===(d=H.getChildren((E=>E instanceof g.e),!0)[0])||void 0===d?void 0:d.Lg},getTarget:E=>{var H;return null===(H=E._babylonTransformNode)||void 0===H?void 0:H.getChildren((E=>E instanceof g.e),!0)[0]},set:(E,H)=>{if(H._babylonTransformNode){const d=H._babylonTransformNode.getChildren((E=>E instanceof g.e),!0)[0];d&&(d.Lg=E)}}},color:{type:"DH",get:E=>{var H,d;return null===(H=E._babylonTransformNode)||void 0===H||null===(d=H.getChildren((E=>E instanceof g.e),!0)[0])||void 0===d?void 0:d.eg},getTarget:E=>{var H;return null===(H=E._babylonTransformNode)||void 0===H?void 0:H.getChildren((E=>E instanceof g.e),!0)[0]},set:(E,H)=>{if(H._babylonTransformNode){const d=H._babylonTransformNode.getChildren((E=>E instanceof g.e),!0)[0];d&&(d.eg=E)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"DH",get:(E,H,d)=>S(E,H,d).emissiveColor,set:(E,H,d,n)=>S(H,d,n).emissiveColor.l(E),getTarget:(E,H,d)=>S(E,H,d),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:M("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(E,H,d)=>{var n;return null===(n=t(E,d,"bumpTexture"))||void 0===n?void 0:n.level},set:(E,H,d,n)=>{const Z=t(H,n,"bumpTexture");Z&&(Z.level=E)},getTarget:(E,H,d)=>S(E,H,d),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:M("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(E,H,d)=>S(E,H,d).ambientTextureStrength,set:(E,H,d,n)=>{const Z=S(H,d,n);Z&&(Z.ambientTextureStrength=E)},getTarget:(E,H,d)=>S(E,H,d),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:M("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"gg",get:(E,H,d)=>{const n=S(E,H,d);return I.gg.FromColor3(n.albedoColor,n.alpha)},set:(E,H,d,n)=>{const Z=S(H,d,n);Z.albedoColor.set(E.r,E.g,E.b),Z.alpha=E.a},getTarget:(E,H,d)=>S(E,H,d),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:M("albedoTexture")}},metallicFactor:{type:"number",get:(E,H,d)=>S(E,H,d).metallic,set:(E,H,d,n)=>{const Z=S(H,d,n);Z&&(Z.metallic=E)},getTarget:(E,H,d)=>S(E,H,d),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(E,H,d)=>S(E,H,d).roughness,set:(E,H,d,n)=>{const Z=S(H,d,n);Z&&(Z.roughness=E)},getTarget:(E,H,d)=>S(E,H,d),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:M("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(E,H,d)=>S(E,H,d).anisotropy.Lg,set:(E,H,d,n)=>{S(H,d,n).anisotropy.Lg=E},getTarget:(E,H,d)=>S(E,H,d),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(E,H,d)=>S(E,H,d).anisotropy.angle,set:(E,H,d,n)=>{S(H,d,n).anisotropy.angle=E},getTarget:(E,H,d)=>S(E,H,d),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:M("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(E,H,d)=>S(E,H,d).clearCoat.Lg,set:(E,H,d,n)=>{S(H,d,n).clearCoat.Lg=E},getTarget:(E,H,d)=>S(E,H,d),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(E,H,d)=>S(E,H,d).clearCoat.roughness,set:(E,H,d,n)=>{S(H,d,n).clearCoat.roughness=E},getTarget:(E,H,d)=>S(E,H,d),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:M("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(E,H,d)=>{var n;return null===(n=S(E,H,d).clearCoat.bumpTexture)||void 0===n?void 0:n.level},getTarget:S,set:(E,H,d,n)=>S(H,d,n).clearCoat.bumpTexture.level=E},extensions:{KHR_texture_transform:M("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:M("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(E,H,d)=>S(E,H,d).subSurface.dispersion,getTarget:S,set:(E,H,d,n)=>S(H,d,n).subSurface.dispersion=E}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(E,H,d)=>S(E,H,d).emissiveIntensity,getTarget:S,set:(E,H,d,n)=>S(H,d,n).emissiveIntensity=E}},KHR_materials_ior:{ior:{type:"number",get:(E,H,d)=>S(E,H,d).indexOfRefraction,getTarget:S,set:(E,H,d,n)=>S(H,d,n).indexOfRefraction=E}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(E,H,d)=>S(E,H,d).iridescence.Lg,getTarget:S,set:(E,H,d,n)=>S(H,d,n).iridescence.Lg=E},iridescenceIor:{type:"number",get:(E,H,d)=>S(E,H,d).iridescence.indexOfRefraction,getTarget:S,set:(E,H,d,n)=>S(H,d,n).iridescence.indexOfRefraction=E},iridescenceTexture:{extensions:{KHR_texture_transform:M("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(E,H,d)=>S(E,H,d).iridescence.maximumThickness,getTarget:S,set:(E,H,d,n)=>S(H,d,n).iridescence.maximumThickness=E},iridescenceThicknessMinimum:{type:"number",get:(E,H,d)=>S(E,H,d).iridescence.minimumThickness,getTarget:S,set:(E,H,d,n)=>S(H,d,n).iridescence.minimumThickness=E},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:M("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"DH",get:(E,H,d)=>S(E,H,d).sheen.color,getTarget:S,set:(E,H,d,n)=>S(H,d,n).sheen.color.l(E)},sheenColorTexture:{extensions:{KHR_texture_transform:M("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(E,H,d)=>S(E,H,d).sheen.Lg,getTarget:S,set:(E,H,d,n)=>S(H,d,n).sheen.Lg=E},sheenRoughnessTexture:{extensions:{KHR_texture_transform:M("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(E,H,d)=>S(E,H,d).metallicF0Factor,getTarget:S,set:(E,H,d,n)=>S(H,d,n).metallicF0Factor=E,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"DH",get:(E,H,d)=>S(E,H,d).metallicReflectanceColor,getTarget:S,set:(E,H,d,n)=>S(H,d,n).metallicReflectanceColor.l(E),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:M("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:M("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(E,H,d)=>S(E,H,d).subSurface.refractionIntensity,getTarget:S,set:(E,H,d,n)=>S(H,d,n).subSurface.refractionIntensity=E,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:M("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(E,H,d)=>S(E,H,d).subSurface.translucencyIntensity,getTarget:S,set:(E,H,d,n)=>S(H,d,n).subSurface.translucencyIntensity=E},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:M("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"DH",get:(E,H,d)=>S(E,H,d).subSurface.translucencyColor,getTarget:S,set:(E,H,d,n)=>{var Z;return E&&(null===(Z=S(H,d,n).subSurface.translucencyColor)||void 0===Z?void 0:Z.l(E))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:M("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"DH",get:(E,H,d)=>S(E,H,d).subSurface.tintColor,getTarget:S,set:(E,H,d,n)=>S(H,d,n).subSurface.tintColor.l(E)},attenuationDistance:{type:"number",get:(E,H,d)=>S(E,H,d).subSurface.tintColorAtDistance,getTarget:S,set:(E,H,d,n)=>S(H,d,n).subSurface.tintColorAtDistance=E},thicknessFactor:{type:"number",get:(E,H,d)=>S(E,H,d).subSurface.maximumThickness,getTarget:S,set:(E,H,d,n)=>S(H,d,n).subSurface.maximumThickness=E},thicknessTexture:{extensions:{KHR_texture_transform:M("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonLight)),getPropertyName:[E=>"length"]},__array__:{__target__:!0,color:{type:"DH",get:E=>{var H;return null===(H=E._babylonLight)||void 0===H?void 0:H.eg},set:(E,H)=>{var d;return null===(d=H._babylonLight)||void 0===d?void 0:d.eg.l(E)},getTarget:E=>E._babylonLight,getPropertyName:[E=>"diffuse"]},Lg:{type:"number",get:E=>{var H;return null===(H=E._babylonLight)||void 0===H?void 0:H.Lg},set:(E,H)=>H._babylonLight?H._babylonLight.Lg=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"intensity"]},range:{type:"number",get:E=>{var H;return null===(H=E._babylonLight)||void 0===H?void 0:H.range},set:(E,H)=>H._babylonLight?H._babylonLight.range=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"range"]},spot:{innerConeAngle:{type:"number",get:E=>{var H;return null===(H=E._babylonLight)||void 0===H?void 0:H.innerAngle},set:(E,H)=>H._babylonLight?H._babylonLight.innerAngle=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"innerConeAngle"]},outerConeAngle:{type:"number",get:E=>{var H;return null===(H=E._babylonLight)||void 0===H?void 0:H.angle},set:(E,H)=>H._babylonLight?H._babylonLight.angle=E:void 0,getTarget:E=>E._babylonLight,getPropertyName:[E=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonLight)),getPropertyName:[E=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonTexture)),getPropertyName:[E=>"length"]},__array__:{__target__:!0,Lg:{type:"number",get:E=>{var H;return null===(H=E._babylonTexture)||void 0===H?void 0:H.level},set:(E,H)=>{H._babylonTexture&&(H._babylonTexture.level=E)},getTarget:E=>E._babylonTexture},rotation:{type:"Quaternion",get:E=>{var H;return E._babylonTexture&&n.Quaternion.FromRotationMatrix(null===(H=E._babylonTexture)||void 0===H?void 0:H.getReflectionTextureMatrix())},set:(E,H)=>{var d;H._babylonTexture&&(null!==(d=H._babylonTexture.fE())&&void 0!==d&&d.useRightHandedSystem||(E=n.Quaternion.Inverse(E)),n.Matrix.FromQuaternionToRef(E,H._babylonTexture.getReflectionTextureMatrix()))},getTarget:E=>E._babylonTexture}}}}},animations:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>E._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:E=>E.length,getTarget:E=>E.map((E=>{var H;return null===(H=E.primitives[0]._instanceData)||void 0===H?void 0:H.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function C(E){return new r(E,V)}function w(E){const H=E.split("/").map((E=>E.replace(/{}/g,"__array__")));let d=V;for(const n of H)n&&(d=d[n]);if(d&&d.type&&d.get)return d}function R(E,H){const d=E.split("/").map((E=>E.replace(/{}/g,"__array__")));let n=V;for(const Z of d)Z&&(n=n[Z]);n&&n.type&&n.get&&(n.interpolation=H)}function Q(E,H){const d=E.split("/").map((E=>E.replace(/{}/g,"__array__")));let n=V;for(const Z of d)if(Z){if(!n[Z]){if("?"===Z){n.__ignoreObjectTree__=!0;continue}n[Z]={},"__array__"===Z&&(n[Z].__target__=!0)}n=n[Z]}Object.assign(n,H)}},14051:(E,H,d)=>{"use strict";d.r(H),d.d(H,{AnimationPropertyInfo:()=>t,TransformNodeAnimationPropertyInfo:()=>S,WeightAnimationPropertyInfo:()=>M,getQuaternion:()=>l,getVector3:()=>g,getWeights:()=>r});var n=d(12910),Z=d(12384),I=d(14043);function g(E,H,d,n){return Z.wH.eH(H,d).scaleInPlace(n)}function l(E,H,d,n){return Z.Quaternion.eH(H,d).scaleInPlace(n)}function r(E,H,d,n){const Z=new Array(E._numMorphTargets);for(let I=0;I<Z.length;I++)Z[I]=H[d++]*n;return Z}class t{constructor(E,H,d,n){this.type=E,this.name=H,this.getValue=d,this.getStride=n}_buildAnimation(E,H,d){const Z=new n.b(E,this.name,H,this.type);return Z.setKeys(d),Z}}class S extends t{buildAnimations(E,H,d,n){const Z=[];return Z.push({babylonAnimatable:E._babylonTransformNode,babylonAnimation:this._buildAnimation(H,d,n)}),Z}}class M extends t{buildAnimations(E,H,d,Z){const I=[];if(E._numMorphTargets)for(let g=0;g<E._numMorphTargets;g++){const l=new n.b(`${H}_${g}`,this.name,d,this.type);if(l.setKeys(Z.map((E=>({frame:E.frame,inTangent:E.inTangent?E.inTangent[g]:void 0,value:E.value[g],outTangent:E.outTangent?E.outTangent[g]:void 0,interpolation:E.interpolation})))),E._primitiveBabylonMeshes)for(const H of E._primitiveBabylonMeshes)if(H.morphTargetManager){const E=H.morphTargetManager.getTarget(g),d=l.clone();E.animations.push(d),I.push({babylonAnimatable:E,babylonAnimation:d})}}return I}}(0,I.h)("/nodes/{}/translation",[new S(n.b.ANIMATIONTYPE_VECTOR3,"position",g,(()=>3))]),(0,I.h)("/nodes/{}/rotation",[new S(n.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",l,(()=>4))]),(0,I.h)("/nodes/{}/scale",[new S(n.b.ANIMATIONTYPE_VECTOR3,"mg",g,(()=>3))]),(0,I.h)("/nodes/{}/weights",[new M(n.b.ANIMATIONTYPE_FLOAT,"influence",r,(E=>E._numMorphTargets))])},14004:(E,H,d)=>{"use strict";class n{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((E,H)=>{this._resolve=E,this._reject=H}))}}var Z=d(12384),I=d(12437),g=d(12228),l=d(12845),r=d(14011),t=d(14027),S=d(12230),M=d(12860),V=d(12910),C=d(12914),w=d(12268),R=d(12237),Q=d(12244);class L{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(E){this._useTextureToStoreBoneMatrices=E,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(E){this._animationPropertiesOverride=E}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(E,H,d){this.name=E,this.id=H,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=Z.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new S.e,this.bones=[],this._scene=d||w.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const n=this._scene.getEngine().getCaps();this._canUseTextureForBones=n.textureFloat&&n.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((E=>!E.getParent()))}getTransformMatrices(E){if(this.needInitialSkinMatrix){if(!E)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return E._bonesTransformMatrices||this.prepare(!0),E._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(E){return this.needInitialSkinMatrix&&E._transformMatrixTexture?E._transformMatrixTexture:this._transformMatrixTexture}fE(){return this._scene}toString(E){let H=`Name: ${this.name}, nBones: ${this.bones.length}`;if(H+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,E){H+=", Ranges: {";let E=!0;for(const d in this._ranges)E&&(H+=", ",E=!1),H+=d;H+="}"}return H}getBoneIndexByName(E){for(let H=0,d=this.bones.length;H<d;H++)if(this.bones[H].name===E)return H;return-1}createAnimationRange(E,H,d){if(!this._ranges[E]){this._ranges[E]=new C.c(E,H,d);for(let n=0,Z=this.bones.length;n<Z;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].createRange(E,H,d)}}deleteAnimationRange(E){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let d=0,n=this.bones.length;d<n;d++)this.bones[d].animations[0]&&this.bones[d].animations[0].deleteRange(E,H);this._ranges[E]=null}getAnimationRange(E){return this._ranges[E]||null}getAnimationRanges(){const E=[];let H;for(H in this._ranges)E.push(this._ranges[H]);return E}copyAnimationRange(E,H){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[H]||!E.getAnimationRange(H))return!1;let n=!0;const Z=this._getHighestAnimationFrame()+1,I={},g=E.bones;let l,r;for(r=0,l=g.length;r<l;r++)I[g[r].name]=g[r];this.bones.length!==g.length&&(R.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${g.length}`),n=!1);const t=d&&this.dimensionsAtRest&&E.dimensionsAtRest?this.dimensionsAtRest.divide(E.dimensionsAtRest):null;for(r=0,l=this.bones.length;r<l;r++){const E=this.bones[r].name,g=I[E];g?n=n&&this.bones[r].copyAnimationRange(g,H,Z,d,t):(R.b.Warn("copyAnimationRange: not same rig, missing source bone "+E),n=!1)}const S=E.getAnimationRange(H);return S&&(this._ranges[H]=new C.c(H,S.from+Z,S.to+Z)),n}returnToRest(){for(const E of this.bones)-1!==E._index&&E.returnToRest()}_getHighestAnimationFrame(){let E=0;for(let H=0,d=this.bones.length;H<d;H++)if(this.bones[H].animations[0]){const d=this.bones[H].animations[0].getHighestFrame();E<d&&(E=d)}return E}beginAnimation(E,H,d,n){const Z=this.getAnimationRange(E);return Z?this._scene.beginAnimation(this,Z.from,Z.to,H,d,n):null}static MakeAnimationAdditive(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;const n=E.getAnimationRange(d);if(!n)return null;const Z=E._scene.getAllAnimatablesByTarget(E);let I=null;for(let l=0;l<Z.length;l++){const E=Z[l];if(E.fromFrame===(null===n||void 0===n?void 0:n.from)&&E.toFrame===(null===n||void 0===n?void 0:n.to)){I=E;break}}const g=E.getAnimatables();for(let l=0;l<g.length;l++){const E=g[l].animations;if(E)for(let n=0;n<E.length;n++)V.b.MakeAnimationAdditive(E[n],H,d)}return I&&(I.isAdditive=!0),E}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(E){this._meshesWithPoseMatrix.push(E)}_unregisterMeshWithPoseMatrix(E){const H=this._meshesWithPoseMatrix.indexOf(E);H>-1&&this._meshesWithPoseMatrix.splice(H,1)}_computeTransformMatrices(E,H){this.onBeforeComputeObservable.notifyObservers(this);for(let d=0;d<this.bones.length;d++){const n=this.bones[d];n._childUpdateId++;const Z=n.getParent();if(Z?n.getLocalMatrix().multiplyToRef(Z.getFinalMatrix(),n.getFinalMatrix()):H?n.getLocalMatrix().multiplyToRef(H,n.getFinalMatrix()):n.getFinalMatrix().l(n.getLocalMatrix()),-1!==n._index){const H=null===n._index?d:n._index;n.getAbsoluteInverseBindMatrix().multiplyToArray(n.getFinalMatrix(),E,16*H)}}this._identity.copyToArray(E,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const E=this.fE().getRenderId();if(this._currentRenderId===E)return;this._currentRenderId=E}if(this._numBonesWithLinkedTransformNode>0)for(const E of this.bones)if(E._linkedTransformNode){const H=E._linkedTransformNode;E.position=H.position,H.rotationQuaternion?E.rotationQuaternion=H.rotationQuaternion:E.rotation=H.rotation,E.mg=H.mg}if(this.needInitialSkinMatrix)for(const E of this._meshesWithPoseMatrix){const H=E.getPoseMatrix();let d=this._isDirty;if(E._bonesTransformMatrices&&E._bonesTransformMatrices.length===16*(this.bones.length+1)||(E._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),d=!0),d){if(this._synchronizedWithMesh!==E){this._synchronizedWithMesh=E;for(const E of this.bones)if(!E.getParent()){E.getBindMatrix().multiplyToRef(H,Z.TmpVectors.Matrix[1]),E._updateAbsoluteBindMatrices(Z.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const H=4*(this.bones.length+1);E._transformMatrixTexture&&E._transformMatrixTexture.getSize().width===H||(E._transformMatrixTexture&&E._transformMatrixTexture.dispose(),E._transformMatrixTexture=M.b.CreateRGBATexture(E._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(E._bonesTransformMatrices,H),this.isUsingTextureForMatrices&&E._transformMatrixTexture&&E._transformMatrixTexture.update(E._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=M.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let E=0;E<this.bones.length;E++)this._animatables.push(this.bones[E])}return this._animatables}clone(E,H){const d=new L(E,H||E,this._scene);d.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let n=0;n<this.bones.length;n++){const E=this.bones[n];let H=null;const Z=E.getParent();if(Z){const E=this.bones.indexOf(Z);H=d.bones[E]}const I=new t.e(E.name,d,H,E.getBindMatrix().clone(),E.getRestMatrix().clone());I._index=E._index,E._linkedTransformNode&&I.linkTransformNode(E._linkedTransformNode),Q.b.DeepCopy(E.animations,I.animations)}if(this._ranges){d._ranges={};for(const E in this._ranges){const H=this._ranges[E];H&&(d._ranges[E]=H.clone())}}return this._isDirty=!0,d.prepare(!0),d}enableBlending(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const H of this.bones)for(const d of H.animations)d.enableBlending=!0,d.blendingSpeed=E}dispose(){if(this._meshesWithPoseMatrix.length=0,this.fE().stopAnimation(this),this.fE().removeSkeleton(this),this._parentContainer){const E=this._parentContainer.skeletons.indexOf(this);E>-1&&this._parentContainer.skeletons.splice(E,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const E={};E.name=this.name,E.id=this.id,this.dimensionsAtRest&&(E.dimensionsAtRest=this.dimensionsAtRest.kd()),E.bones=[],E.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let d=0;d<this.bones.length;d++){var H;const n=this.bones[d],Z=n.getParent(),I={parentBoneIndex:Z?this.bones.indexOf(Z):-1,index:n.getIndex(),name:n.name,id:n.id,matrix:n.getBindMatrix().kd(),rest:n.getRestMatrix().kd(),linkedTransformNodeId:null===(H=n.getTransformNode())||void 0===H?void 0:H.id};E.bones.push(I),n.length&&(I.length=n.length),n.metadata&&(I.metadata=n.metadata),n.animations&&n.animations.length>0&&(I.animation=n.animations[0].serialize()),E.ranges=[];for(const H in this._ranges){const d=this._ranges[H];if(!d)continue;const n={};n.name=H,n.from=d.from,n.to=d.to,E.ranges.push(n)}}return E}static Parse(E,H){const d=new L(E.name,E.id,H);let n;for(E.dimensionsAtRest&&(d.dimensionsAtRest=Z.wH.eH(E.dimensionsAtRest)),d.needInitialSkinMatrix=E.needInitialSkinMatrix,n=0;n<E.bones.length;n++){const H=E.bones[n],I=E.bones[n].index;let g=null;H.parentBoneIndex>-1&&(g=d.bones[H.parentBoneIndex]);const l=H.rest?Z.Matrix.eH(H.rest):null,r=new t.e(H.name,d,g,Z.Matrix.eH(H.matrix),l,null,I);void 0!==H.id&&null!==H.id&&(r.id=H.id),H.length&&(r.length=H.length),H.metadata&&(r.metadata=H.metadata),H.animation&&r.animations.push(V.b.Parse(H.animation)),void 0!==H.linkedTransformNodeId&&null!==H.linkedTransformNodeId&&(d._hasWaitingData=!0,r._waitingTransformNodeId=H.linkedTransformNodeId)}if(E.ranges)for(n=0;n<E.ranges.length;n++){const H=E.ranges[n];d.createAnimationRange(H.name,H.from,H.to)}return d}computeAbsoluteMatrices(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||E)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(E)}getPoseMatrix(){let E=null;return this._meshesWithPoseMatrix.length>0&&(E=this._meshesWithPoseMatrix[0].getPoseMatrix()),E}sortBones(){const E=[],H=new Array(this.bones.length);for(let d=0;d<this.bones.length;d++)this._sortBones(d,E,H);this.bones=E}_sortBones(E,H,d){if(d[E])return;d[E]=!0;const n=this.bones[E];if(!n)return;void 0===n._index&&(n._index=E);const Z=n.getParent();Z&&this._sortBones(this.bones.indexOf(Z),H,d),H.push(n)}setCurrentPoseAsRest(){for(const E of this.bones)E.setCurrentPoseAsRest()}}var D=d(12729),e=d(12873),s=d(12366),i=d(12809),p=d(12463),f=d(12848),P=d(12817),j=d(12840),X=d(12916),W=d(12491),U=d(13970);class Y{set areUpdatesFrozen(E){E?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new W.c(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,E||(E=w.b.LastCreatedScene),this._scene=E,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const E=this._scene.getEngine().getCaps();this._canUseTextureForTargets=E.canUseGLVertexID&&E.textureFloat&&E.maxVertexTextureImageUnits>0&&E.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return Y.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?Y.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(E){this._numMaxInfluencers!==E&&(this._numMaxInfluencers=E,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(E){this._useTextureToStoreTargets!==E&&(this._useTextureToStoreTargets=E,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var E;return Y.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(E=this._scene)&&void 0!==E&&E.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(E){return this._activeTargets.data[E]}getTarget(E){return this._targets[E]}getTargetByName(E){for(const H of this._targets)if(H.name===E)return H;return null}addTarget(E){this._targets.push(E),this._targetInfluenceChangedObservers.push(E.onInfluenceChanged.add((E=>{this.areUpdatesFrozen&&E&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(E)}))),this._targetDataLayoutChangedObservers.push(E._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(E){const H=this._targets.indexOf(E);H>=0&&(this._targets.splice(H,1),E.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(H,1)[0]),E._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(H,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(E)}_bind(E){E.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),E.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),E.setTexture("morphTargets",this._targetStoreTexture),E.setInt("morphTargetCount",this.numInfluencers)}clone(){const E=new Y(this._scene);for(const H of this._targets)E.addTarget(H.clone());return E.enablePositionMorphing=this.enablePositionMorphing,E.enableNormalMorphing=this.enableNormalMorphing,E.enableTangentMorphing=this.enableTangentMorphing,E.enableUVMorphing=this.enableUVMorphing,E.enableUV2Morphing=this.enableUV2Morphing,E.enableColorMorphing=this.enableColorMorphing,E}serialize(){const E={};E.id=this.uniqueId,E.targets=[];for(const H of this._targets)E.targets.push(H.serialize());return E}_syncActiveTargets(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const H=!!this._targetStoreTexture,d=this.isUsingTextureForTargets;(this._mustSynchronize||H!==d)&&(this._mustSynchronize=!1,this.synchronize());let n=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let Z=-1;for(const I of this._targets)if(Z++,0!==I.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=Y.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(I),this._morphTargetTextureIndices[n]=Z,this._tempInfluences[n++]=I.influence}this._morphTargetTextureIndices.length!==n&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,n)),this._influences&&this._influences.length===n||(this._influences=new Float32Array(n));for(let I=0;I<n;I++)this._influences[I]=this._tempInfluences[I];if(E&&this._scene)for(const I of this._scene.meshes)I.morphTargetManager===this&&(d?I._markSubMeshesAsAttributesDirty():I._syncGeometryWithMorphTargetManager())}synchronize(){var E;if(!this._scene||this.areUpdatesFrozen)return;const H=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(E=this._targetStoreTexture)||void 0===E||E.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>H.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const d of this._targets){this._supportsPositions=this._supportsPositions&&d.hasPositions,this._supportsNormals=this._supportsNormals&&d.hasNormals,this._supportsTangents=this._supportsTangents&&d.hasTangents,this._supportsUVs=this._supportsUVs&&d.hasUVs,this._supportsUV2s=this._supportsUV2s&&d.hasUV2s,this._supportsColors=this._supportsColors&&d.hasColors;const E=d.vertexCount;if(0===this._vertexCount)this._vertexCount=E;else if(this._vertexCount!==E)return void R.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${d.name}": ${E}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const E=H.getCaps().maxTextureSize;this._textureWidth>E&&(this._textureHeight=Math.ceil(this._textureWidth/E),this._textureWidth=E);const d=this._targets.length,n=new Float32Array(d*this._textureWidth*this._textureHeight*4);let Z=0;for(let H=0;H<d;H++){const E=this._targets[H],d=E.getPositions(),I=E.getNormals(),g=E.getUVs(),l=E.getTangents(),r=E.getUV2s(),t=E.getColors();Z=H*this._textureWidth*this._textureHeight*4;for(let H=0;H<this._vertexCount;H++)this._supportsPositions&&d&&(n[Z]=d[3*H],n[Z+1]=d[3*H+1],n[Z+2]=d[3*H+2],Z+=4),this._supportsNormals&&I&&(n[Z]=I[3*H],n[Z+1]=I[3*H+1],n[Z+2]=I[3*H+2],Z+=4),this._supportsUVs&&g&&(n[Z]=g[2*H],n[Z+1]=g[2*H+1],Z+=4),this._supportsTangents&&l&&(n[Z]=l[3*H],n[Z+1]=l[3*H+1],n[Z+2]=l[3*H+2],Z+=4),this._supportsUV2s&&r&&(n[Z]=r[2*H],n[Z+1]=r[2*H+1],Z+=4),this._supportsColors&&t&&(n[Z]=t[4*H],n[Z+1]=t[4*H+1],n[Z+2]=t[4*H+2],n[Z+3]=t[4*H+3],Z+=4)}this._targetStoreTexture=U.e.CreateRGBATexture(n,this._textureWidth,this._textureHeight,d,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const d of this._scene.meshes)d.morphTargetManager===this&&d._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const E=this._parentContainer.morphTargetManagers.indexOf(this);E>-1&&this._parentContainer.morphTargetManagers.splice(E,1),this._parentContainer=null}for(const E of this._targets)this._scene.stopAnimation(E)}}static Parse(E,H){const d=new Y(H);for(const n of E.targets)d.addTarget(X.e.Parse(n,H));return d}}Y.EnableTextureStorage=!0,Y.MaxActiveMorphTargetsInVertexAttributeMode=8,Y.ConstantTargetCountForTextureMode=0;var c=d(14032),u=d(12271),o=d(12738);const F=new Map,a=F;function k(E,H,d){O(E)&&R.b.Warn(`Extension with the name '${E}' already exists`),F.set(E,{isGLTFExtension:H,factory:d})}function O(E){return F.delete(E)}var G=d(14043),x=d(12974),q=d(12480);class b{static Get(E,H,d){if(!H||void 0==d||!H[d])throw new Error(`${E}: Failed to find index (${d})`);return H[d]}static TryGet(E,H){return E&&void 0!=H&&E[H]?E[H]:null}static Assign(E){if(E)for(let H=0;H<E.length;H++)E[H].index=H}}function h(E){if(E.min&&E.max){const H=E.min,d=E.max,n=Z.TmpVectors.wH[0].en(H[0],H[1],H[2]),I=Z.TmpVectors.wH[1].en(d[0],d[1],d[2]);if(E.normalized&&5126!==E.componentType){let H=1;switch(E.componentType){case 5120:H=127;break;case 5121:H=255;break;case 5122:H=32767;break;case 5123:H=65535}const d=1/H;n.scaleInPlace(d),I.scaleInPlace(d)}return new o.e(n,I)}return null}class y{static RegisterExtension(E,H){k(E,!1,H)}static UnregisterExtension(E){return O(E)}get jd(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(E){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=E}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((E=>E.dispose&&E.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(E,H,d,n,Z,I){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=H,this._assetContainer=d,this._loadData(n);let I=null;if(E){const H={};if(this._gltf.nodes)for(const E of this._gltf.nodes)E.name&&(H[E.name]=E.index);I=(E instanceof Array?E:[E]).map((E=>{const d=H[E];if(void 0===d)throw new Error(`Failed to find node '${E}'`);return d}))}return await this._loadAsync(Z,g,I,(()=>({meshes:this._getMeshes(),lV:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=E,this._loadData(H),await this._loadAsync(d,Z,null,(()=>{}))}async _loadAsync(E,H,d,n){return await Promise.resolve().then((async()=>{this._rootUrl=E,this._uniqueRootUrl=!E.startsWith("file:")&&H?E:`${E}${Date.now()}/`,this._fileName=H,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const Z=`${c.p[c.p.LOADING]} => ${c.p[c.p.READY]}`,I=`${c.p[c.p.LOADING]} => ${c.p[c.p.COMPLETE]}`;this._parent._startPerformanceCounter(Z),this._parent._startPerformanceCounter(I),this._parent._setState(c.p.LOADING),this._extensionsOnLoading();const l=new Array;if(!this.parent.loadOnlyMaterials)if(d)l.push(this.loadSceneAsync("/nodes",{nodes:d,index:-1}));else if(void 0!=this._gltf.QH||this._gltf.scenes&&this._gltf.scenes[0]){const E=b.Get("/scene",this._gltf.scenes,this._gltf.QH||0);l.push(this.loadSceneAsync(`/scenes/${E.index}`,E))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let E=0;E<this._gltf.materials.length;++E){const H=this._gltf.materials[E],d="/materials/"+E,n=D.b.TriangleFillMode;l.push(this._loadMaterialAsync(d,H,null,n,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&l.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&l.push(this._compileShadowGeneratorsAsync());const r=Promise.all(l).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Bl(!0);for(const E of this._babylonScene.materials){const H=E;void 0!==H.maxSimultaneousLights&&(H.maxSimultaneousLights=Math.max(H.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(c.p.READY),this._skipStartAnimationStep||this._startAnimations(),n()}));return await r.then((E=>(this._parent._endPerformanceCounter(Z),g.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(I),this._parent._setState(c.p.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(E=>{this._parent.onErrorObservable.notifyObservers(E),this._parent.onErrorObservable.clear(),this.dispose()}))})),E)))})).catch((E=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(E),this._parent.onErrorObservable.clear(),this.dispose()),E}))}_loadData(E){if(this._gltf=E.json,this._setupData(),E.bin){const H=this._gltf.buffers;if(H&&H[0]&&!H[0].uri){const d=H[0];(d.byteLength<E.bin.byteLength-3||d.byteLength>E.bin.byteLength)&&R.b.Warn(`Binary buffer length (${d.byteLength}) from JSON does not match chunk length (${E.bin.byteLength})`),this._bin=E.bin}else R.b.Warn("Unexpected BIN chunk")}}_setupData(){if(b.Assign(this._gltf.accessors),b.Assign(this._gltf.animations),b.Assign(this._gltf.buffers),b.Assign(this._gltf.bufferViews),b.Assign(this._gltf.cameras),b.Assign(this._gltf.images),b.Assign(this._gltf.materials),b.Assign(this._gltf.meshes),b.Assign(this._gltf.nodes),b.Assign(this._gltf.samplers),b.Assign(this._gltf.scenes),b.Assign(this._gltf.skins),b.Assign(this._gltf.textures),this._gltf.nodes){const E={};for(const d of this._gltf.nodes)if(d.children)for(const H of d.children)E[H]=d.index;const H=this._createRootNode();for(const d of this._gltf.nodes){const n=E[d.index];d.parent=void 0===n?H:this._gltf.nodes[n]}}}async _loadExtensionsAsync(){const E=[];if(a.forEach(((H,d)=>{var n;!1===(null===(n=this.parent.extensionOptions[d])||void 0===n?void 0:n.enabled)?H.isGLTFExtension&&this.isExtensionUsed(d)&&R.b.Warn(`Extension ${d} is used but has been explicitly disabled.`):H.isGLTFExtension&&!this.isExtensionUsed(d)||E.push((async()=>{const E=await H.factory(this);return E.name!==d&&R.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${E.name} !== ${d}`),this._parent.onExtensionLoadedObservable.notifyObservers(E),E})())})),this._extensions.push(...await Promise.all(E)),this._extensions.sort(((E,H)=>(E.order||Number.MAX_VALUE)-(H.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const d of this._gltf.extensionsRequired){if(!this._extensions.some((E=>E.name===d&&E.enabled))){var H;if(!1===(null===(H=this.parent.extensionOptions[d])||void 0===H?void 0:H.enabled))throw new Error(`Required extension ${d} is disabled`);throw new Error(`Required extension ${d} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new j.e("__root__",this._babylonScene);this._rootBabylonMesh=E,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Bl(!1);const H={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case c.l.AUTO:this._babylonScene.useRightHandedSystem||(H.rotation=[0,1,0,0],H.scale=[1,1,-1],y._LoadTransform(H,this._rootBabylonMesh));break;case c.l.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(E),H}loadSceneAsync(E,H){const d=this._extensionsLoadSceneAsync(E,H);if(d)return d;const n=new Array;if(this.logOpen(`${E} ${H.name||""}`),H.nodes)for(const Z of H.nodes){const H=b.Get(`${E}/nodes/${Z}`,this._gltf.nodes,Z);n.push(this.loadNodeAsync(`/nodes/${H.index}`,H,(E=>{E.parent=this._rootBabylonMesh})))}for(const Z of this._postSceneLoadActions)Z();return n.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(n).then((()=>{}))}_forEachPrimitive(E,H){if(E._primitiveBabylonMeshes)for(const d of E._primitiveBabylonMeshes)H(d)}_getGeometries(){const E=[],H=this._gltf.nodes;if(H)for(const d of H)this._forEachPrimitive(d,(H=>{const d=H.Kd;d&&-1===E.indexOf(d)&&E.push(d)}));return E}_getMeshes(){const E=[];this._rootBabylonMesh instanceof P.b&&E.push(this._rootBabylonMesh);const H=this._gltf.nodes;if(H)for(const d of H)this._forEachPrimitive(d,(H=>{E.push(H)}));return E}_getTransformNodes(){const E=[],H=this._gltf.nodes;if(H)for(const d of H)d._babylonTransformNode&&"Fg"===d._babylonTransformNode.getClassName()&&E.push(d._babylonTransformNode),d._babylonTransformNodeForSkin&&E.push(d._babylonTransformNodeForSkin);return E}_getSkeletons(){const E=[],H=this._gltf.skins;if(H)for(const d of H)d._data&&E.push(d._data.babylonSkeleton);return E}_getAnimationGroups(){const E=[],H=this._gltf.animations;if(H)for(const d of H)d._babylonAnimationGroup&&E.push(d._babylonAnimationGroup);return E}_startAnimations(){switch(this._parent.animationStartMode){case c.h.NONE:break;case c.h.FIRST:{const E=this._getAnimationGroups();0!==E.length&&E[0].start(!0);break}case c.h.ALL:{const E=this._getAnimationGroups();for(const H of E)H.start(!0);break}default:return void R.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadNodeAsync(E,H,d);if(n)return n;if(H._babylonTransformNode)throw new Error(`${E}: Invalid recursive node hierarchy`);const Z=new Array;this.logOpen(`${E} ${H.name||""}`);const I=n=>{if(y.AddPointerMetadata(n,E),y._LoadTransform(H,n),void 0!=H.camera){const d=b.Get(`${E}/camera`,this._gltf.cameras,H.camera);Z.push(this.loadCameraAsync(`/cameras/${d.index}`,d,(E=>{E.parent=n,this._babylonScene.useRightHandedSystem||(n.mg.x=-1)})))}if(H.children)for(const d of H.children){const H=b.Get(`${E}/children/${d}`,this._gltf.nodes,d);Z.push(this.loadNodeAsync(`/nodes/${H.index}`,H,(E=>{E.parent=n})))}d(n)},g=void 0!=H.mesh,l=this._parent.loadSkins&&void 0!=H.skin;if(!g||l){const E=H.name||`node${H.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const d=new i.e(E,this._babylonScene);d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==H.mesh?H._babylonTransformNode=d:H._babylonTransformNodeForSkin=d,I(d)}if(g)if(l){const d=b.Get(`${E}/mesh`,this._gltf.meshes,H.mesh);Z.push(this._loadMeshAsync(`/meshes/${d.index}`,H,d,(d=>{const n=H._babylonTransformNodeForSkin;d.metadata=(0,x.d)(n.metadata,d.metadata||{});const I=b.Get(`${E}/skin`,this._gltf.skins,H.skin);Z.push(this._loadSkinAsync(`/skins/${I.index}`,H,I,(E=>{this._forEachPrimitive(H,(H=>{H.skeleton=E})),this._postSceneLoadActions.push((()=>{if(void 0!=I.skeleton){const E=b.Get(`/skins/${I.index}/skeleton`,this._gltf.nodes,I.skeleton).parent;H.index===E.index?d.parent=n.parent:d.parent=E._babylonTransformNode}else d.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:n,skinnedNode:d})}))})))})))}else{const d=b.Get(`${E}/mesh`,this._gltf.meshes,H.mesh);Z.push(this._loadMeshAsync(`/meshes/${d.index}`,H,d,I))}return this.logClose(),Promise.all(Z).then((()=>(this._forEachPrimitive(H,(E=>{const H=E;!H.isAnInstance&&H.Kd&&H.Kd.useBoundingInfoFromGeometry?E.oE():E.refreshBoundingInfo(!0,!0)})),H._babylonTransformNode)))}_loadMeshAsync(E,H,d,n){const Z=d.primitives;if(!Z||!Z.length)throw new Error(`${E}: Primitives are missing`);void 0==Z[0].index&&b.Assign(Z);const I=new Array;this.logOpen(`${E} ${d.name||""}`);const g=H.name||`node${H.index}`;if(1===Z.length){const n=d.primitives[0];I.push(this._loadMeshPrimitiveAsync(`${E}/primitives/${n.index}`,g,H,d,n,(E=>{H._babylonTransformNode=E,H._primitiveBabylonMeshes=[E]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,H._babylonTransformNode=new i.e(g,this._babylonScene),H._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H._primitiveBabylonMeshes=[];for(const n of Z)I.push(this._loadMeshPrimitiveAsync(`${E}/primitives/${n.index}`,`${g}_primitive${n.index}`,H,d,n,(E=>{E.parent=H._babylonTransformNode,H._primitiveBabylonMeshes.push(E)})))}return n(H._babylonTransformNode),this.logClose(),Promise.all(I).then((()=>H._babylonTransformNode))}_loadMeshPrimitiveAsync(E,H,d,n,Z,I){const g=this._extensionsLoadMeshPrimitiveAsync(E,H,d,n,Z,I);if(g)return g;this.logOpen(`${E}`);const l=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==d.skin&&!n.primitives[0].targets;let r,t;if(l&&Z._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,r=Z._instanceData.babylonSourceMesh.createInstance(H),r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t=Z._instanceData.promise;else{const I=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new j.e(H,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.sideOrientation=this._babylonScene.useRightHandedSystem?D.b.CounterClockWiseSideOrientation:D.b.ClockWiseSideOrientation,this._createMorphTargets(E,d,n,Z,g),I.push(this._loadVertexDataAsync(E,Z,g).then((async H=>await this._loadMorphTargetsAsync(E,Z,g,H).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,H.cE(g),H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const S=y._GetDrawMode(E,Z.mode);if(void 0==Z.material){let E=this._defaultBabylonMaterialData[S];E||(E=this._createDefaultMaterial("__GLTFLoader._default",S),this._parent.onMaterialLoadedObservable.notifyObservers(E),this._defaultBabylonMaterialData[S]=E),g.material=E}else if(!this.parent.skipMaterials){const H=b.Get(`${E}/material`,this._gltf.materials,Z.material);I.push(this._loadMaterialAsync(`/materials/${H.index}`,H,g,S,(E=>{g.material=E})))}t=Promise.all(I),l&&(Z._instanceData={babylonSourceMesh:g,promise:t}),r=g}return y.AddPointerMetadata(r,E),this._parent.onMeshLoadedObservable.notifyObservers(r),I(r),this.logClose(),t.then((()=>r))}_loadVertexDataAsync(E,H,d){const n=this._extensionsLoadVertexDataAsync(E,H,d);if(n)return n;const Z=H.attributes;if(!Z)throw new Error(`${E}: Attributes are missing`);const I=new Array,g=new f.c(d.name,this._babylonScene);if(void 0==H.indices)d.isUnIndexed=!0;else{const d=b.Get(`${E}/indices`,this._gltf.accessors,H.indices);I.push(this._loadIndicesAccessorAsync(`/accessors/${d.index}`,d).then((E=>{g.setIndices(E)})))}const l=(H,n,l)=>{if(void 0==Z[H])return;d._delayInfo=d._delayInfo||[],-1===d._delayInfo.indexOf(n)&&d._delayInfo.push(n);const r=b.Get(`${E}/attributes/${H}`,this._gltf.accessors,Z[H]);I.push(this._loadVertexAccessorAsync(`/accessors/${r.index}`,r,n).then((E=>{if(E.getKind()===p.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!d.skeleton){const E=h(r);E&&(g._boundingInfo=E,g.useBoundingInfoFromGeometry=!0)}g.setVerticesBuffer(E,r.count)}))),n==p.g.MatricesIndicesExtraKind&&(d.numBoneInfluencers=8),l&&l(r)};return l("POSITION",p.g.PositionKind),l("NORMAL",p.g.NormalKind),l("TANGENT",p.g.TangentKind),l("TEXCOORD_0",p.g.UVKind),l("TEXCOORD_1",p.g.UV2Kind),l("TEXCOORD_2",p.g.UV3Kind),l("TEXCOORD_3",p.g.UV4Kind),l("TEXCOORD_4",p.g.UV5Kind),l("TEXCOORD_5",p.g.UV6Kind),l("JOINTS_0",p.g.MatricesIndicesKind),l("WEIGHTS_0",p.g.MatricesWeightsKind),l("JOINTS_1",p.g.MatricesIndicesExtraKind),l("WEIGHTS_1",p.g.MatricesWeightsExtraKind),l("COLOR_0",p.g.ColorKind,(E=>{"VEC4"===E.type&&(d.hasVertexAlpha=!0)})),Promise.all(I).then((()=>g))}_createMorphTargets(E,H,d,n,Z){if(!n.targets||!this._parent.loadMorphTargets)return;if(void 0==H._numMorphTargets)H._numMorphTargets=n.targets.length;else if(n.targets.length!==H._numMorphTargets)throw new Error(`${E}: Primitives do not have the same number of targets`);const I=d.extras?d.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,Z.morphTargetManager=new Y(this._babylonScene),Z.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z.morphTargetManager.areUpdatesFrozen=!0;for(let g=0;g<n.targets.length;g++){const E=H.weights?H.weights[g]:d.weights?d.weights[g]:0,n=I?I[g]:`morphTarget${g}`;Z.morphTargetManager.addTarget(new X.e(n,E,Z.fE()))}}_loadMorphTargetsAsync(E,H,d,n){if(!H.targets||!this._parent.loadMorphTargets)return Promise.resolve();const Z=new Array,I=d.morphTargetManager;for(let g=0;g<I.numTargets;g++){const d=I.getTarget(g);Z.push(this._loadMorphTargetVertexDataAsync(`${E}/targets/${g}`,n,H.targets[g],d))}return Promise.all(Z).then((()=>{I.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(E,H,d,n){const Z=new Array,I=(n,I,g)=>{if(void 0==d[n])return;const l=H.getVertexBuffer(I);if(!l)return;const r=b.Get(`${E}/${n}`,this._gltf.accessors,d[n]);Z.push(this._loadFloatAccessorAsync(`/accessors/${r.index}`,r).then((E=>{g(l,E)})))};return I("POSITION",p.g.PositionKind,((E,H)=>{const d=new Float32Array(H.length);E.forEach(H.length,((E,n)=>{d[n]=H[n]+E})),n.setPositions(d)})),I("NORMAL",p.g.NormalKind,((E,H)=>{const d=new Float32Array(H.length);E.forEach(d.length,((E,n)=>{d[n]=H[n]+E})),n.setNormals(d)})),I("TANGENT",p.g.TangentKind,((E,H)=>{const d=new Float32Array(H.length/3*4);let Z=0;E.forEach(H.length/3*4,((E,n)=>{(n+1)%4!==0&&(d[Z]=H[Z]+E,Z++)})),n.setTangents(d)})),I("TEXCOORD_0",p.g.UVKind,((E,H)=>{const d=new Float32Array(H.length);E.forEach(H.length,((E,n)=>{d[n]=H[n]+E})),n.setUVs(d)})),I("TEXCOORD_1",p.g.UV2Kind,((E,H)=>{const d=new Float32Array(H.length);E.forEach(H.length,((E,n)=>{d[n]=H[n]+E})),n.setUV2s(d)})),I("COLOR_0",p.g.ColorKind,((H,d)=>{let Z=null;const I=H.getSize();if(3===I){Z=new Float32Array(d.length/3*4),H.forEach(d.length,((E,H)=>{const n=Math.floor(H/3),I=H%3;Z[4*n+I]=d[3*n+I]+E}));for(let E=0;E<d.length/3;++E)Z[4*E+3]=1}else{if(4!==I)throw new Error(`${E}: Invalid number of components (${I}) for COLOR_0 attribute`);Z=new Float32Array(d.length),H.forEach(d.length,((E,H)=>{Z[H]=d[H]+E}))}n.setColors(Z)})),await Promise.all(Z).then((()=>{}))}static _LoadTransform(E,H){if(void 0!=E.skin)return;let d=Z.wH.Zero(),n=Z.Quaternion.Identity(),I=Z.wH.One();if(E.matrix){Z.Matrix.eH(E.matrix).decompose(I,n,d)}else E.translation&&(d=Z.wH.eH(E.translation)),E.rotation&&(n=Z.Quaternion.eH(E.rotation)),E.scale&&(I=Z.wH.eH(E.scale));H.position=d,H.rotationQuaternion=n,H.mg=I}_loadSkinAsync(E,H,d,n){if(!this._parent.loadSkins)return Promise.resolve();const Z=this._extensionsLoadSkinAsync(E,H,d);if(Z)return Z;if(d._data)return n(d._data.babylonSkeleton),d._data.promise;const I=`skeleton${d.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new L(d.name||I,I,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(E,d,g);const l=this._loadSkinInverseBindMatricesDataAsync(E,d).then((E=>{this._updateBoneMatrices(g,E)}));return d._data={babylonSkeleton:g,promise:l},n(g),l}_loadBones(E,H,d){if(void 0==H.skeleton||this._parent.alwaysComputeSkeletonRootNode){const d=this._findSkeletonRootNode(`${E}/joints`,H.joints);if(d)if(void 0===H.skeleton)H.skeleton=d.index;else{const n=(E,H)=>{for(;H.parent;H=H.parent)if(H.parent===E)return!0;return!1},Z=b.Get(`${E}/skeleton`,this._gltf.nodes,H.skeleton);Z===d||n(Z,d)||(R.b.Warn(`${E}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),H.skeleton=d.index)}else R.b.Warn(`${E}: Failed to find common root`)}const n={};for(const Z of H.joints){const I=b.Get(`${E}/joints/${Z}`,this._gltf.nodes,Z);this._loadBone(I,H,d,n)}}_findSkeletonRootNode(E,H){if(0===H.length)return null;const d={};for(const Z of H){const H=[];let n=b.Get(`${E}/${Z}`,this._gltf.nodes,Z);for(;-1!==n.index;)H.unshift(n),n=n.parent;d[Z]=H}let n=null;for(let Z=0;;++Z){let E=d[H[0]];if(Z>=E.length)return n;const I=E[Z];for(let g=1;g<H.length;++g)if(E=d[H[g]],Z>=E.length||I!==E[Z])return n;n=I}}_loadBone(E,H,d,n){E._isJoint=!0;let Z=n[E.index];if(Z)return Z;let I=null;E.index!==H.skeleton&&(E.parent&&-1!==E.parent.index?I=this._loadBone(E.parent,H,d,n):void 0!==H.skeleton&&R.b.Warn(`/skins/${H.index}/skeleton: Skeleton node is not a common root`));const g=H.joints.indexOf(E.index);return Z=new t.e(E.name||`joint${E.index}`,d,I,this._getNodeMatrix(E),null,null,g),n[E.index]=Z,this._postSceneLoadActions.push((()=>{Z.linkTransformNode(E._babylonTransformNode)})),Z}_loadSkinInverseBindMatricesDataAsync(E,H){if(void 0==H.inverseBindMatrices)return Promise.resolve(null);const d=b.Get(`${E}/inverseBindMatrices`,this._gltf.accessors,H.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${d.index}`,d)}_updateBoneMatrices(E,H){for(const d of E.bones){const E=Z.Matrix.Identity(),n=d._index;H&&-1!==n&&(Z.Matrix.FromArrayToRef(H,16*n,E),E.invertToRef(E));const I=d.getParent();I&&E.multiplyToRef(I.getAbsoluteInverseBindMatrix(),E),d.bd(E,!1,!1),d._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(E){return E.matrix?Z.Matrix.eH(E.matrix):Z.Matrix.Compose(E.scale?Z.wH.eH(E.scale):Z.wH.One(),E.rotation?Z.Quaternion.eH(E.rotation):Z.Quaternion.Identity(),E.translation?Z.wH.eH(E.translation):Z.wH.Zero())}loadCameraAsync(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadCameraAsync(E,H,d);if(n)return n;const I=new Array;this.logOpen(`${E} ${H.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new r.e(H.name||`camera${H.index}`,Z.wH.Zero(),this._babylonScene,!1);switch(g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H._babylonCamera=g,g.setTarget(new Z.wH(0,0,-1)),H.type){case"perspective":{const d=H.perspective;if(!d)throw new Error(`${E}: Camera perspective properties are missing`);g.fov=d.yfov,g.Gd=d.znear,g.maxZ=d.zfar||0;break}case"orthographic":if(!H.orthographic)throw new Error(`${E}: Camera orthographic properties are missing`);g.mode=l.b.ORTHOGRAPHIC_CAMERA,g.orthoLeft=-H.orthographic.xmag,g.orthoRight=H.orthographic.xmag,g.orthoBottom=-H.orthographic.ymag,g.orthoTop=H.orthographic.ymag,g.Gd=H.orthographic.znear,g.maxZ=H.orthographic.zfar;break;default:throw new Error(`${E}: Invalid camera type (${H.type})`)}return y.AddPointerMetadata(g,E),this._parent.onCameraLoadedObservable.notifyObservers(g),d(g),this.logClose(),Promise.all(I).then((()=>g))}_loadAnimationsAsync(){const E=this._gltf.animations;if(!E)return Promise.resolve();const H=new Array;for(let d=0;d<E.length;d++){const n=E[d];H.push(this.loadAnimationAsync(`/animations/${n.index}`,n).then((E=>{0===E.targetedAnimations.length&&E.dispose()})))}return Promise.all(H).then((()=>{}))}loadAnimationAsync(E,H){const n=this._extensionsLoadAnimationAsync(E,H);return n||d.e(78).then(d.bind(d,15548)).then((d=>{let{AnimationGroup:n}=d;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new n(H.name||`animation${H.index}`,this._babylonScene);Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H._babylonAnimationGroup=Z;const I=new Array;b.Assign(H.channels),b.Assign(H.samplers);for(const g of H.channels)I.push(this._loadAnimationChannelAsync(`${E}/channels/${g.index}`,E,H,g,((E,H)=>{E.animations=E.animations||[],E.animations.push(H),Z.addTargetedAnimation(H,E)})));return Promise.all(I).then((()=>(Z.normalize(0),Z)))}))}async _loadAnimationChannelAsync(E,H,n,Z,I){const g=this._extensionsLoadAnimationChannelAsync(E,H,n,Z,I);if(g)return await g;if(void 0==Z.target.node)return await Promise.resolve();const l=b.Get(`${E}/target/node`,this._gltf.nodes,Z.target.node),r=Z.target.path,t="weights"===r;if(t&&!l._numMorphTargets||!t&&!l._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!t&&!l._isJoint)return await Promise.resolve();let S;switch(await Promise.resolve().then(d.bind(d,14051)),r){case"translation":var M;S=null===(M=(0,G.d)("/nodes/{}/translation"))||void 0===M?void 0:M.interpolation;break;case"rotation":var V;S=null===(V=(0,G.d)("/nodes/{}/rotation"))||void 0===V?void 0:V.interpolation;break;case"scale":var C;S=null===(C=(0,G.d)("/nodes/{}/scale"))||void 0===C?void 0:C.interpolation;break;case"weights":var w;S=null===(w=(0,G.d)("/nodes/{}/weights"))||void 0===w?void 0:w.interpolation;break;default:throw new Error(`${E}/target/path: Invalid value (${Z.target.path})`)}if(!S)throw new Error(`${E}/target/path: Could not find interpolation properties for target path (${Z.target.path})`);const R={object:l,info:S};return await this._loadAnimationChannelFromTargetInfoAsync(E,H,n,Z,R,I)}_loadAnimationChannelFromTargetInfoAsync(E,H,d,n,Z,I){const g=this.parent.targetFps,l=1/g,r=b.Get(`${E}/sampler`,d.samplers,n.sampler);return this._loadAnimationSamplerAsync(`${H}/samplers/${n.sampler}`,r).then((E=>{let H=0;const r=Z.object,t=Z.info;for(const Z of t){const t=Z.getStride(r),S=E.input,M=E.output,V=new Array(S.length);let C=0;switch(E.interpolation){case"STEP":for(let E=0;E<S.length;E++){const H=Z.getValue(r,M,C,1);C+=t,V[E]={frame:S[E]*g,value:H,interpolation:1}}break;case"CUBICSPLINE":for(let E=0;E<S.length;E++){const H=Z.getValue(r,M,C,l);C+=t;const d=Z.getValue(r,M,C,1);C+=t;const n=Z.getValue(r,M,C,l);C+=t,V[E]={frame:S[E]*g,inTangent:H,value:d,outTangent:n}}break;case"LINEAR":for(let E=0;E<S.length;E++){const H=Z.getValue(r,M,C,1);C+=t,V[E]={frame:S[E]*g,value:H}}}if(C>0){const E=`${d.name||`animation${d.index}`}_channel${n.index}_${H}`,l=Z.buildAnimations(r,E,g,V);for(const d of l)H++,I(d.babylonAnimatable,d.babylonAnimation)}}}))}_loadAnimationSamplerAsync(E,H){if(H._data)return H._data;const d=H.interpolation||"LINEAR";switch(d){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${E}/interpolation: Invalid value (${H.interpolation})`)}const n=b.Get(`${E}/input`,this._gltf.accessors,H.input),Z=b.Get(`${E}/output`,this._gltf.accessors,H.output);return H._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${n.index}`,n),this._loadFloatAccessorAsync(`/accessors/${Z.index}`,Z)]).then((E=>{let[H,n]=E;return{input:H,interpolation:d,output:n}})),H._data}loadBufferAsync(E,H,d,n){const Z=this._extensionsLoadBufferAsync(E,H,d,n);if(Z)return Z;if(!H._data)if(H.uri)H._data=this.loadUriAsync(`${E}/uri`,H,H.uri);else{if(!this._bin)throw new Error(`${E}: Uri is missing or the binary glTF is missing its binary chunk`);H._data=this._bin.readAsync(0,H.byteLength)}return H._data.then((H=>{try{return new Uint8Array(H.buffer,H.byteOffset+d,n)}catch(Z){throw new Error(`${E}: ${Z.message}`)}}))}loadBufferViewAsync(E,H){const d=this._extensionsLoadBufferViewAsync(E,H);if(d)return d;if(H._data)return H._data;const n=b.Get(`${E}/buffer`,this._gltf.buffers,H.buffer);return H._data=this.loadBufferAsync(`/buffers/${n.index}`,n,H.byteOffset||0,H.byteLength),H._data}_loadAccessorAsync(E,H,d){if(H._data)return H._data;const n=y._GetNumComponents(E,H.type),Z=n*p.g.GetTypeByteLength(H.componentType),I=n*H.count;if(void 0==H.bufferView)H._data=Promise.resolve(new d(I));else{const g=b.Get(`${E}/bufferView`,this._gltf.bufferViews,H.bufferView);H._data=this.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((l=>{if(5126!==H.componentType||H.normalized||g.byteStride&&g.byteStride!==Z){const E=new d(I);return p.g.ForEach(l,H.byteOffset||0,g.byteStride||Z,n,H.componentType,E.length,H.normalized||!1,((H,d)=>{E[d]=H})),E}return y._GetTypedArray(E,H.componentType,l,H.byteOffset,I)}))}if(H.sparse){const I=H.sparse;H._data=H._data.then((g=>{const l=g,r=b.Get(`${E}/sparse/indices/bufferView`,this._gltf.bufferViews,I.indices.bufferView),t=b.Get(`${E}/sparse/values/bufferView`,this._gltf.bufferViews,I.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${r.index}`,r),this.loadBufferViewAsync(`/bufferViews/${t.index}`,t)]).then((g=>{let[r,t]=g;const S=y._GetTypedArray(`${E}/sparse/indices`,I.indices.componentType,r,I.indices.byteOffset,I.count),M=n*I.count;let V;if(5126!==H.componentType||H.normalized){const g=y._GetTypedArray(`${E}/sparse/values`,H.componentType,t,I.values.byteOffset,M);V=new d(M),p.g.ForEach(g,0,Z,n,H.componentType,V.length,H.normalized||!1,((E,H)=>{V[H]=E}))}else V=y._GetTypedArray(`${E}/sparse/values`,H.componentType,t,I.values.byteOffset,M);let C=0;for(let E=0;E<S.length;E++){let H=S[E]*n;for(let E=0;E<n;E++)l[H++]=V[C++]}return l}))}))}return H._data}_loadFloatAccessorAsync(E,H){return this._loadAccessorAsync(E,H,Float32Array)}_loadIndicesAccessorAsync(E,H){if("SCALAR"!==H.type)throw new Error(`${E}/type: Invalid value ${H.type}`);if(5121!==H.componentType&&5123!==H.componentType&&5125!==H.componentType)throw new Error(`${E}/componentType: Invalid value ${H.componentType}`);if(H._data)return H._data;if(H.sparse){const d=y._GetTypedArrayConstructor(`${E}/componentType`,H.componentType);H._data=this._loadAccessorAsync(E,H,d)}else{const d=b.Get(`${E}/bufferView`,this._gltf.bufferViews,H.bufferView);H._data=this.loadBufferViewAsync(`/bufferViews/${d.index}`,d).then((d=>y._GetTypedArray(E,H.componentType,d,H.byteOffset,H.count)))}return H._data}_loadVertexBufferViewAsync(E){if(E._babylonBuffer)return E._babylonBuffer;const H=this._babylonScene.getEngine();return E._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${E.index}`,E).then((E=>new p.e(H,E,!1))),E._babylonBuffer}_loadVertexAccessorAsync(E,H,d){var n;if(null!==(n=H._babylonVertexBuffer)&&void 0!==n&&n[d])return H._babylonVertexBuffer[d];H._babylonVertexBuffer||(H._babylonVertexBuffer={});const Z=this._babylonScene.getEngine();if(H.sparse||void 0==H.bufferView)H._babylonVertexBuffer[d]=this._loadFloatAccessorAsync(E,H).then((E=>new p.g(Z,E,d,!1)));else{const n=b.Get(`${E}/bufferView`,this._gltf.bufferViews,H.bufferView);H._babylonVertexBuffer[d]=this._loadVertexBufferViewAsync(n).then((I=>{const g=y._GetNumComponents(E,H.type);return new p.g(Z,I,d,!1,void 0,n.byteStride,void 0,H.byteOffset,g,H.componentType,H.normalized,!0,void 0,!0)}))}return H._babylonVertexBuffer[d]}_loadMaterialMetallicRoughnessPropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const n=new Array;return H&&(H.baseColorFactor?(d.albedoColor=I.DH.eH(H.baseColorFactor),d.alpha=H.baseColorFactor[3]):d.albedoColor=I.DH.White(),d.metallic=void 0==H.metallicFactor?1:H.metallicFactor,d.roughness=void 0==H.roughnessFactor?1:H.roughnessFactor,H.baseColorTexture&&n.push(this.loadTextureInfoAsync(`${E}/baseColorTexture`,H.baseColorTexture,(E=>{E.name=`${d.name} (Base Color)`,d.albedoTexture=E}))),H.metallicRoughnessTexture&&(H.metallicRoughnessTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${E}/metallicRoughnessTexture`,H.metallicRoughnessTexture,(E=>{E.name=`${d.name} (Metallic Roughness)`,d.metallicTexture=E}))),d.useMetallnessFromMetallicTextureBlue=!0,d.useRoughnessFromMetallicTextureGreen=!0,d.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(n).then((()=>{}))}_loadMaterialAsync(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const I=this._extensionsLoadMaterialAsync(E,H,d,n,Z);if(I)return I;H._data=H._data||{};let g=H._data[n];if(!g){this.logOpen(`${E} ${H.name||""}`);const d=this.createMaterial(E,H,n);g={babylonMaterial:d,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(E,H,d)},H._data[n]=g,y.AddPointerMetadata(d,E),this._parent.onMaterialLoadedObservable.notifyObservers(d),this.logClose()}return d&&(g.babylonMeshes.push(d),d.Qd.addOnce((()=>{const E=g.babylonMeshes.indexOf(d);-1!==E&&g.babylonMeshes.splice(E,1)}))),Z(g.babylonMaterial),g.promise.then((()=>g.babylonMaterial))}_createDefaultMaterial(E,H){this._babylonScene._blockEntityCollection=!!this._assetContainer;const d=new e.c(E,this._babylonScene);return d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d.fillMode=H,d.enableSpecularAntiAliasing=!0,d.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,d.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,d.transparencyMode=e.c.PBRMATERIAL_OPAQUE,d.metallic=1,d.roughness=1,d}createMaterial(E,H,d){const n=this._extensionsCreateMaterial(E,H,d);if(n)return n;const Z=H.name||`material${H.index}`;return this._createDefaultMaterial(Z,d)}loadMaterialPropertiesAsync(E,H,d){const n=this._extensionsLoadMaterialPropertiesAsync(E,H,d);if(n)return n;const Z=new Array;return Z.push(this.loadMaterialBasePropertiesAsync(E,H,d)),H.pbrMetallicRoughness&&Z.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${E}/pbrMetallicRoughness`,H.pbrMetallicRoughness,d)),this.loadMaterialAlphaProperties(E,H,d),Promise.all(Z).then((()=>{}))}loadMaterialBasePropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const n=new Array;return d.emissiveColor=H.emissiveFactor?I.DH.eH(H.emissiveFactor):new I.DH(0,0,0),H.doubleSided&&(d.ln=!1,d.twoSidedLighting=!0),H.normalTexture&&(H.normalTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${E}/normalTexture`,H.normalTexture,(E=>{E.name=`${d.name} (Normal)`,d.bumpTexture=E}))),d.invertNormalMapX=!this._babylonScene.useRightHandedSystem,d.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=H.normalTexture.scale&&d.bumpTexture&&(d.bumpTexture.level=H.normalTexture.scale),d.forceIrradianceInFragment=!0),H.occlusionTexture&&(H.occlusionTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${E}/occlusionTexture`,H.occlusionTexture,(E=>{E.name=`${d.name} (Occlusion)`,d.ambientTexture=E}))),d.useAmbientInGrayScale=!0,void 0!=H.occlusionTexture.strength&&(d.ambientTextureStrength=H.occlusionTexture.strength)),H.emissiveTexture&&n.push(this.loadTextureInfoAsync(`${E}/emissiveTexture`,H.emissiveTexture,(E=>{E.name=`${d.name} (Emissive)`,d.emissiveTexture=E}))),Promise.all(n).then((()=>{}))}loadMaterialAlphaProperties(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);switch(H.alphaMode||"OPAQUE"){case"OPAQUE":d.transparencyMode=e.c.PBRMATERIAL_OPAQUE,d.alpha=1;break;case"MASK":d.transparencyMode=e.c.PBRMATERIAL_ALPHATEST,d.alphaCutOff=void 0==H.alphaCutoff?.5:H.alphaCutoff,d.albedoTexture&&(d.albedoTexture.Od=!0);break;case"BLEND":d.transparencyMode=e.c.PBRMATERIAL_ALPHABLEND,d.albedoTexture&&(d.albedoTexture.Od=!0,d.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${E}/alphaMode: Invalid value (${H.alphaMode})`)}}loadTextureInfoAsync(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadTextureInfoAsync(E,H,d);if(n)return n;if(this.logOpen(`${E}`),H.texCoord>=6)throw new Error(`${E}/texCoord: Invalid value (${H.texCoord})`);const Z=b.Get(`${E}/index`,this._gltf.textures,H.index);Z._textureInfo=H;const I=this._loadTextureAsync(`/textures/${H.index}`,Z,(n=>{n.coordinatesIndex=H.texCoord||0,y.AddPointerMetadata(n,E),this._parent.onTextureLoadedObservable.notifyObservers(n),d(n)}));return this.logClose(),I}_loadTextureAsync(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadTextureAsync(E,H,d);if(n)return n;this.logOpen(`${E} ${H.name||""}`);const Z=void 0==H.sampler?y.DefaultSampler:b.Get(`${E}/sampler`,this._gltf.samplers,H.sampler),I=b.Get(`${E}/source`,this._gltf.images,H.source),g=this._createTextureAsync(E,Z,I,d,void 0,!H._textureInfo.nonColorData);return this.logClose(),g}_createTextureAsync(E,H,d){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},I=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0;const l=this._loadSampler(`/samplers/${H.index}`,H),r=new Array,t=new n;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S={noMipmap:l.noMipMaps,invertY:!1,samplingMode:l.samplingMode,A:()=>{this._disposed||t.resolve()},onError:(H,d)=>{this._disposed||t.reject(new Error(`${E}: ${d&&d.message?d.message:H||"Failed to load texture"}`))},mimeType:d.mimeType??(0,u.g)(d.uri??""),loaderOptions:I,useSRGBBuffer:!!g&&this._parent.useSRGBBuffers},M=new s.c(null,this._babylonScene,S);return M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.push(t.promise),r.push(this.loadImageAsync(`/images/${d.index}`,d).then((E=>{const H=d.uri||`${this._fileName}#image${d.index}`,n=`data:${this._uniqueRootUrl}${H}`;M.updateURL(n,E);const Z=M.getInternalTexture();Z&&(Z.label=d.name)}))),M.wrapU=l.wrapU,M.wrapV=l.wrapV,Z(M),this._parent.useGltfTextureNames&&(M.name=d.name||d.uri||`image${d.index}`),Promise.all(r).then((()=>M))}_loadSampler(E,H){return H._data||(H._data={noMipMaps:9728===H.minFilter||9729===H.minFilter,samplingMode:y._GetTextureSamplingMode(E,H),wrapU:y._GetTextureWrapMode(`${E}/wrapS`,H.wrapS),wrapV:y._GetTextureWrapMode(`${E}/wrapT`,H.wrapT)}),H._data}loadImageAsync(E,H){if(!H._data){if(this.logOpen(`${E} ${H.name||""}`),H.uri)H._data=this.loadUriAsync(`${E}/uri`,H,H.uri);else{const d=b.Get(`${E}/bufferView`,this._gltf.bufferViews,H.bufferView);H._data=this.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}this.logClose()}return H._data}loadUriAsync(E,H,d){const n=this._extensionsLoadUriAsync(E,H,d);if(n)return n;if(!y._ValidateUri(d))throw new Error(`${E}: '${d}' is invalid`);if((0,u.i)(d)){const H=new Uint8Array((0,u.b)(d));return this.log(`${E}: Decoded ${d.substring(0,64)}... (${H.length} bytes)`),Promise.resolve(H)}return this.log(`${E}: Loading ${d}`),this._parent.preprocessUrlAsync(this._rootUrl+d).then((H=>new Promise(((n,Z)=>{this._parent._loadFile(this._babylonScene,H,(H=>{this._disposed||(this.log(`${E}: Loaded ${d} (${H.byteLength} bytes)`),n(new Uint8Array(H)))}),!0,(H=>{Z(new u.l(`${E}: Failed to load '${d}'${H?": "+H.status+" "+H.statusText:""}`,H))}))}))))}static AddPointerMetadata(E,H){E.metadata=E.metadata||{};const d=E._internalMetadata=E._internalMetadata||{},n=d.jd=d.jd||{};(n.pointers=n.pointers||[]).push(H)}static _GetTextureWrapMode(E,H){switch(H=void 0==H?10497:H){case 33071:return s.c.CLAMP_ADDRESSMODE;case 33648:return s.c.MIRROR_ADDRESSMODE;case 10497:return s.c.WRAP_ADDRESSMODE;default:return R.b.Warn(`${E}: Invalid value (${H})`),s.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(E,H){const d=void 0==H.magFilter?9729:H.magFilter,n=void 0==H.minFilter?9987:H.minFilter;if(9729===d)switch(n){case 9728:return s.c.LINEAR_NEAREST;case 9729:return s.c.LINEAR_LINEAR;case 9984:return s.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return s.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return s.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return s.c.LINEAR_LINEAR_MIPLINEAR;default:return R.b.Warn(`${E}/minFilter: Invalid value (${n})`),s.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==d&&R.b.Warn(`${E}/magFilter: Invalid value (${d})`),n){case 9728:return s.c.NEAREST_NEAREST;case 9729:return s.c.NEAREST_LINEAR;case 9984:return s.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return s.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return s.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return s.c.NEAREST_LINEAR_MIPLINEAR;default:return R.b.Warn(`${E}/minFilter: Invalid value (${n})`),s.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(E,H){try{return(0,q.r)(H)}catch(d){throw new Error(`${E}: ${d.message}`)}}static _GetTypedArray(E,H,d,n,Z){const I=d.buffer;n=d.byteOffset+(n||0);const g=y._GetTypedArrayConstructor(`${E}/componentType`,H),l=p.g.GetTypeByteLength(H);return n%l!==0?(R.b.Warn(`${E}: Copying buffer as byte offset (${n}) is not a multiple of component type byte length (${l})`),new g(I.slice(n,n+Z*l),0)):new g(I,n,Z)}static _GetNumComponents(E,H){switch(H){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${E}: Invalid type (${H})`)}static _ValidateUri(E){return g.Tools.IsBase64(E)||-1===E.indexOf("..")}static _GetDrawMode(E,H){switch(void 0==H&&(H=4),H){case 0:return D.b.PointListDrawMode;case 1:return D.b.LineListDrawMode;case 2:return D.b.LineLoopDrawMode;case 3:return D.b.LineStripDrawMode;case 4:return D.b.TriangleFillMode;case 5:return D.b.TriangleStripDrawMode;case 6:return D.b.TriangleFanDrawMode}throw new Error(`${E}: Invalid mesh primitive mode (${H})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const E=new Array;if(this._gltf.materials)for(const H of this._gltf.materials)if(H._data)for(const d in H._data){const n=H._data[d];for(const H of n.babylonMeshes){H.yd(!0);const d=n.babylonMaterial;E.push(d.forceCompilationAsync(H)),E.push(d.forceCompilationAsync(H,{useInstances:!0})),this._parent.useClipPlane&&(E.push(d.forceCompilationAsync(H,{clipPlane:!0})),E.push(d.forceCompilationAsync(H,{clipPlane:!0,useInstances:!0})))}}return Promise.all(E).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const E=new Array,H=this._babylonScene.lights;for(const d of H){const H=d.getShadowGenerator();H&&E.push(H.forceCompilationAsync())}return Promise.all(E).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(E){for(const H of this._extensions)H.enabled&&E(H)}_applyExtensions(E,H,d){for(const n of this._extensions)if(n.enabled){const Z=`${n.name}.${H}`,I=E;I._activeLoaderExtensionFunctions=I._activeLoaderExtensionFunctions||{};const g=I._activeLoaderExtensionFunctions;if(!g[Z]){g[Z]=!0;try{const E=d(n);if(E)return E}finally{delete g[Z]}}}return null}_extensionsOnLoading(){this._forEachExtensions((E=>E.onLoading&&E.onLoading()))}_extensionsOnReady(){this._forEachExtensions((E=>E.onReady&&E.onReady()))}_extensionsLoadSceneAsync(E,H){return this._applyExtensions(H,"loadScene",(d=>d.loadSceneAsync&&d.loadSceneAsync(E,H)))}_extensionsLoadNodeAsync(E,H,d){return this._applyExtensions(H,"loadNode",(n=>n.loadNodeAsync&&n.loadNodeAsync(E,H,d)))}_extensionsLoadCameraAsync(E,H,d){return this._applyExtensions(H,"loadCamera",(n=>n.loadCameraAsync&&n.loadCameraAsync(E,H,d)))}_extensionsLoadVertexDataAsync(E,H,d){return this._applyExtensions(H,"loadVertexData",(n=>n._loadVertexDataAsync&&n._loadVertexDataAsync(E,H,d)))}_extensionsLoadMeshPrimitiveAsync(E,H,d,n,Z,I){return this._applyExtensions(Z,"loadMeshPrimitive",(g=>g._loadMeshPrimitiveAsync&&g._loadMeshPrimitiveAsync(E,H,d,n,Z,I)))}_extensionsLoadMaterialAsync(E,H,d,n,Z){return this._applyExtensions(H,"loadMaterial",(I=>I._loadMaterialAsync&&I._loadMaterialAsync(E,H,d,n,Z)))}_extensionsCreateMaterial(E,H,d){return this._applyExtensions(H,"createMaterial",(n=>n.createMaterial&&n.createMaterial(E,H,d)))}_extensionsLoadMaterialPropertiesAsync(E,H,d){return this._applyExtensions(H,"loadMaterialProperties",(n=>n.loadMaterialPropertiesAsync&&n.loadMaterialPropertiesAsync(E,H,d)))}_extensionsLoadTextureInfoAsync(E,H,d){return this._applyExtensions(H,"loadTextureInfo",(n=>n.loadTextureInfoAsync&&n.loadTextureInfoAsync(E,H,d)))}_extensionsLoadTextureAsync(E,H,d){return this._applyExtensions(H,"loadTexture",(n=>n._loadTextureAsync&&n._loadTextureAsync(E,H,d)))}_extensionsLoadAnimationAsync(E,H){return this._applyExtensions(H,"loadAnimation",(d=>d.loadAnimationAsync&&d.loadAnimationAsync(E,H)))}_extensionsLoadAnimationChannelAsync(E,H,d,n,Z){return this._applyExtensions(d,"loadAnimationChannel",(I=>I._loadAnimationChannelAsync&&I._loadAnimationChannelAsync(E,H,d,n,Z)))}_extensionsLoadSkinAsync(E,H,d){return this._applyExtensions(d,"loadSkin",(n=>n._loadSkinAsync&&n._loadSkinAsync(E,H,d)))}_extensionsLoadUriAsync(E,H,d){return this._applyExtensions(H,"loadUri",(n=>n._loadUriAsync&&n._loadUriAsync(E,H,d)))}_extensionsLoadBufferViewAsync(E,H){return this._applyExtensions(H,"loadBufferView",(d=>d.loadBufferViewAsync&&d.loadBufferViewAsync(E,H)))}_extensionsLoadBufferAsync(E,H,d,n){return this._applyExtensions(H,"loadBuffer",(Z=>Z.loadBufferAsync&&Z.loadBufferAsync(E,H,d,n)))}static LoadExtensionAsync(E,H,d,n){if(!H.extensions)return null;const Z=H.extensions[d];return Z?n(`${E}/extensions/${d}`,Z):null}static LoadExtraAsync(E,H,d,n){if(!H.extras)return null;const Z=H.extras[d];return Z?n(`${E}/extras/${d}`,Z):null}isExtensionUsed(E){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(E)}logOpen(E){this._parent._logOpen(E)}logClose(){this._parent._logClose()}log(E){this._parent._log(E)}startPerformanceCounter(E){this._parent._startPerformanceCounter(E)}endPerformanceCounter(E){this._parent._endPerformanceCounter(E)}}y.DefaultSampler={index:-1},c.d._CreateGLTF2Loader=E=>new y(E);var v=d(14051),z=d(12582),K=d(12428),N=d(14053),mE=d(14060);class T extends mE.e{constructor(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",E),this._texture=E.getEngine().createRawCubeTexture(H,d,n,Z,I,g,l,r)}update(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,E,H,d,n,Z)}updateRGBDAsync(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,N.j)(this._texture,E,H,d,n).then((()=>{}))}clone(){return K.c.Clone((()=>{const E=this.fE(),H=this._texture,d=new T(E,H._bufferViewArray,H.width,H.format,H.type,H.generateMipMaps,H.invertY,H.samplingMode,H._compression);return 13===H.source&&d.updateRGBDAsync(H._bufferViewArrayArray,H._sphericalPolynomial,H._lodGenerationScale,H._lodGenerationOffset),d}),this)}}const A="EXT_lights_image_based";class B{constructor(E){this.name=A,this._loader=E,this.enabled=this._loader.isExtensionUsed(A)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.jd.extensions;if(E&&E[this.name]){const H=E[this.name];this._lights=H.lights}}loadSceneAsync(E,H){return y.LoadExtensionAsync(E,H,this.name,(async(d,n)=>{this._loader._allMaterialsDirtyRequired=!0;const Z=new Array;Z.push(this._loader.loadSceneAsync(E,H)),this._loader.logOpen(`${d}`);const I=b.Get(`${d}/light`,this._lights,n.rd);return Z.push(this._loadLightAsync(`/extensions/${this.name}/lights/${n.rd}`,I).then((E=>{this._loader.babylonScene.environmentTexture=E}))),this._loader.logClose(),await Promise.all(Z).then((()=>{}))}))}_loadLightAsync(E,H){if(!H._loaded){const d=new Array;this._loader.logOpen(`${E}`);const n=new Array(H.specularImages.length);for(let Z=0;Z<H.specularImages.length;Z++){const I=H.specularImages[Z];n[Z]=new Array(I.length);for(let H=0;H<I.length;H++){const g=`${E}/specularImages/${Z}/${H}`;this._loader.logOpen(`${g}`);const l=I[H],r=b.Get(g,this._loader.jd.images,l);d.push(this._loader.loadImageAsync(`/images/${l}`,r).then((E=>{n[Z][H]=E}))),this._loader.logClose()}}this._loader.logClose(),H._loaded=Promise.all(d).then((async()=>{const d=new T(this._loader.babylonScene,null,H.specularImageSize);if(d.name=H.name||"environment",H._babylonTexture=d,void 0!=H.Lg&&(d.level=H.Lg),H.rotation){let E=Z.Quaternion.eH(H.rotation);this._loader.babylonScene.useRightHandedSystem||(E=Z.Quaternion.Inverse(E)),Z.Matrix.FromQuaternionToRef(E,d.getReflectionTextureMatrix())}if(!H.irradianceCoefficients)throw new Error(`${E}: Irradiance coefficients are missing`);const I=z.b.eH(H.irradianceCoefficients);I.scaleInPlace(H.Lg),I.convertIrradianceToLambertianRadiance();const g=z.e.FromHarmonics(I),l=(n.length-1)/Math.log2(H.specularImageSize);return await d.updateRGBDAsync(n,g,l)}))}return H._loaded.then((()=>H._babylonTexture))}}O(A),k(A,!0,(E=>new B(E)));d(12944);const J="EXT_mesh_gpu_instancing";class EE{constructor(E){this.name=J,this._loader=E,this.enabled=this._loader.isExtensionUsed(J)}dispose(){this._loader=null}loadNodeAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(E,n)=>{this._loader._disableInstancedMesh++;const I=this._loader.loadNodeAsync(`/nodes/${H.index}`,H,d);if(this._loader._disableInstancedMesh--,!H._primitiveBabylonMeshes)return await I;const g=new Array;let l=0;const r=H=>{if(void 0==n.attributes[H])return void g.push(Promise.resolve(null));const d=b.Get(`${E}/attributes/${H}`,this._loader.jd.accessors,n.attributes[H]);if(g.push(this._loader._loadFloatAccessorAsync(`/accessors/${d.bufferView}`,d)),0===l)l=d.count;else if(l!==d.count)throw new Error(`${E}/attributes: Instance buffer accessors do not have the same count.`)};return r("TRANSLATION"),r("ROTATION"),r("SCALE"),await I.then((async E=>{const[d,n,I]=await Promise.all(g),r=new Float32Array(16*l);Z.TmpVectors.wH[0].en(0,0,0),Z.TmpVectors.Quaternion[0].en(0,0,0,1),Z.TmpVectors.wH[1].en(1,1,1);for(let H=0;H<l;++H)d&&Z.wH.FromArrayToRef(d,3*H,Z.TmpVectors.wH[0]),n&&Z.Quaternion.FromArrayToRef(n,4*H,Z.TmpVectors.Quaternion[0]),I&&Z.wH.FromArrayToRef(I,3*H,Z.TmpVectors.wH[1]),Z.Matrix.ComposeToRef(Z.TmpVectors.wH[1],Z.TmpVectors.Quaternion[0],Z.TmpVectors.wH[0],Z.TmpVectors.Matrix[0]),Z.TmpVectors.Matrix[0].copyToArray(r,16*H);for(const Z of H._primitiveBabylonMeshes)Z.WM("matrix",r,16,!0);return E}))}))}}O(J),k(J,!0,(E=>new EE(E)));let HE=0,dE=null;class nE{static get Default(){return nE._Default||(nE._Default=new nE),nE._Default}constructor(){const E=nE.Configuration.decoder;this._decoderModulePromise=g.Tools.LoadBabylonScriptAsync(E.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(E,H,d,n,Z){await this._decoderModulePromise,0===HE&&(MeshoptDecoder.useWorkers(1),HE=1);const I=await MeshoptDecoder.decodeGltfBufferAsync(H,d,E,n,Z);return null!==dE&&clearTimeout(dE),dE=setTimeout((()=>{MeshoptDecoder.useWorkers(0),HE=0,dE=null}),1e3),I}}nE.Configuration={decoder:{url:`${g.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},nE._Default=null;const ZE="EXT_meshopt_compression";class IE{constructor(E){this.name=ZE,this.enabled=E.isExtensionUsed(ZE),this._loader=E}dispose(){this._loader=null}loadBufferViewAsync(E,H){return y.LoadExtensionAsync(E,H,this.name,(async(d,n)=>{const Z=H;if(Z._meshOptData)return await Z._meshOptData;const I=b.Get(`${E}/buffer`,this._loader.jd.buffers,n.buffer);return Z._meshOptData=this._loader.loadBufferAsync(`/buffers/${I.index}`,I,n.byteOffset||0,n.byteLength).then((async E=>await nE.Default.decodeGltfBufferAsync(E,n.count,n.byteStride,n.mode,n.filter))),await Z._meshOptData}))}}O(ZE),k(ZE,!0,(E=>new IE(E)));const gE="EXT_texture_webp";class lE{constructor(E){this.name=gE,this._loader=E,this.enabled=E.isExtensionUsed(gE)}dispose(){this._loader=null}_loadTextureAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=void 0==H.sampler?y.DefaultSampler:b.Get(`${E}/sampler`,this._loader.jd.samplers,H.sampler),g=b.Get(`${n}/source`,this._loader.jd.images,Z.source);return await this._loader._createTextureAsync(E,I,g,(E=>{d(E)}),void 0,!H._textureInfo.nonColorData)}))}}O(gE),k(gE,!0,(E=>new lE(E)));const rE="EXT_texture_avif";class tE{constructor(E){this.name=rE,this._loader=E,this.enabled=E.isExtensionUsed(rE)}dispose(){this._loader=null}_loadTextureAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=void 0==H.sampler?y.DefaultSampler:b.Get(`${E}/sampler`,this._loader.jd.samplers,H.sampler),g=b.Get(`${n}/source`,this._loader.jd.images,Z.source);return await this._loader._createTextureAsync(E,I,g,(E=>{d(E)}),void 0,!H._textureInfo.nonColorData)}))}}O(rE),k(rE,!0,(E=>new tE(E)));var SE=d(14049),ME=d(12919);const VE="EXT_lights_ies";class CE{constructor(E){this.name=VE,this._loader=E,this.enabled=this._loader.isExtensionUsed(VE)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.jd.extensions;if(E&&E[this.name]){const H=E[this.name];this._lights=H.lights,b.Assign(this._lights)}}loadNodeAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,g)=>{let l,r;this._loader._allMaterialsDirtyRequired=!0;const t=await this._loader.loadNodeAsync(E,H,(E=>{r=b.Get(n,this._lights,g.rd);const H=r.name||E.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,l=new SE.e(H,Z.wH.Zero(),Z.wH.Backward(),0,1,this._loader.babylonScene),l.angle=Math.PI/2,l.innerAngle=0,l._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,r._babylonLight=l,l.falloffType=ME.e.FALLOFF_GLTF,l.eg=g.color?I.DH.eH(g.color):I.DH.White(),l.Lg=g.multiplier||1,l.range=Number.MAX_VALUE,l.parent=E,this._loader._babylonLights.push(l),y.AddPointerMetadata(l,n),d(E)}));let S;if(r.uri)S=await this._loader.loadUriAsync(E,r,r.uri);else{const H=b.Get(`${E}/bufferView`,this._loader.jd.bufferViews,r.bufferView);S=await this._loader.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}return l.iesProfileTexture=new s.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,S,!0,void 0,void 0,void 0,void 0,".ies"),t}))}}O(VE),k(VE,!0,(E=>new CE(E)));var wE=d(14073);const RE="KHR_draco_mesh_compression";class QE{constructor(E){this.name=RE,this.useNormalizedFlagFromAccessor=!0,this._loader=E,this.enabled=wE.e.DefaultAvailable&&this._loader.isExtensionUsed(RE)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{if(void 0!=H.mode&&4!==H.mode&&5!==H.mode)throw new Error(`${E}: Unsupported mode ${H.mode}`);const I={},g={},l=(E,n)=>{const l=Z.attributes[E];if(void 0!=l&&(d._delayInfo=d._delayInfo||[],-1===d._delayInfo.indexOf(n)&&d._delayInfo.push(n),I[n]=l,this.useNormalizedFlagFromAccessor)){const d=b.TryGet(this._loader.jd.accessors,H.attributes[E]);d&&(g[n]=d.normalized||!1)}};l("POSITION",p.g.PositionKind),l("NORMAL",p.g.NormalKind),l("TANGENT",p.g.TangentKind),l("TEXCOORD_0",p.g.UVKind),l("TEXCOORD_1",p.g.UV2Kind),l("TEXCOORD_2",p.g.UV3Kind),l("TEXCOORD_3",p.g.UV4Kind),l("TEXCOORD_4",p.g.UV5Kind),l("TEXCOORD_5",p.g.UV6Kind),l("JOINTS_0",p.g.MatricesIndicesKind),l("WEIGHTS_0",p.g.MatricesWeightsKind),l("COLOR_0",p.g.ColorKind);const r=b.Get(n,this._loader.jd.bufferViews,Z.bufferView);return r._dracoBabylonGeometry||(r._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${r.index}`,r).then((async n=>{const Z=this.dracoDecoder||wE.e.Default,l=b.TryGet(this._loader.jd.accessors,H.attributes.POSITION),r=this._loader.parent.alwaysComputeBoundingBox||d.skeleton||!l?null:h(l);return await Z._decodeMeshToGeometryForGltfAsync(d.name,this._loader.babylonScene,n,I,g,r).catch((H=>{throw new Error(`${E}: ${H.message}`)}))}))),await r._dracoBabylonGeometry}))}}O(RE),k(RE,!0,(E=>new QE(E)));var LE=d(14075),DE=d(12369),eE=d(12372),sE=d(12815),iE=d(12976),pE=d(12344);sE.c.AddNodeConstructor("Light_Type_0",((E,H)=>()=>new fE(E,Z.wH.Zero(),H)));class fE extends iE.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(E){this._shadowAngle=E,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(E){const H=this.needCube();if(this._direction=E,this.needCube()!==H&&this._shadowGenerators){const E=this._shadowGenerators.values();for(let H=E.next();!0!==H.done;H=E.next()){H.value.recreateShadowMap()}}}constructor(E,H,d){super(E,d),this._shadowAngle=Math.PI/2,this.position=H}getClassName(){return"PointLight"}getTypeID(){return ME.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(E){if(this.direction)return super.getShadowDirection(E);switch(E){case 0:return new Z.wH(1,0,0);case 1:return new Z.wH(-1,0,0);case 2:return new Z.wH(0,-1,0);case 3:return new Z.wH(0,1,0);case 4:return new Z.wH(0,0,1);case 5:return new Z.wH(0,0,-1)}return Z.wH.Zero()}_setDefaultShadowProjectionMatrix(E,H,d){const n=this.fE().activeCamera;if(!n)return;const I=void 0!==this.shadowMinZ?this.shadowMinZ:n.Gd,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,l=this.fE().getEngine().o;Z.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,l?g:I,l?I:g,E,!0,this._scene.getEngine().isNDCHalfZRange,void 0,l)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(E,H){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,H):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,H),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,H),this}transferToNodeMaterialEffect(E,H){return this.computeTransformedInformation()?E.setFloat3(H,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):E.setFloat3(H,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(E,H){E["POINTLIGHT"+H]=!0}}(0,DE.e)([(0,eE.K)()],fE.prototype,"shadowAngle",null),(0,pE.e)("BABYLON.PointLight",fE);const PE="KHR_lights_punctual";class jE{constructor(E){this.name=PE,this._loader=E,this.enabled=this._loader.isExtensionUsed(PE)}dispose(){this._loader=null,delete this._lights}onLoading(){const E=this._loader.jd.extensions;if(E&&E[this.name]){const H=E[this.name];this._lights=H.lights,b.Assign(this._lights)}}loadNodeAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,g)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(E,H,(E=>{let H;const l=b.Get(n,this._lights,g.rd),r=l.name||E.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,l.type){case"directional":{const E=new LE.d(r,Z.wH.Backward(),this._loader.babylonScene);E.position.ng(0),H=E;break}case"point":H=new fE(r,Z.wH.Zero(),this._loader.babylonScene);break;case"spot":{const E=new SE.e(r,Z.wH.Zero(),Z.wH.Backward(),0,1,this._loader.babylonScene);E.angle=2*(l.spot&&l.spot.outerConeAngle||Math.PI/4),E.innerAngle=2*(l.spot&&l.spot.innerConeAngle||0),H=E;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${n}: Invalid light type (${l.type})`)}H._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,l._babylonLight=H,H.falloffType=ME.e.FALLOFF_GLTF,H.eg=l.color?I.DH.eH(l.color):I.DH.White(),H.Lg=void 0==l.Lg?1:l.Lg,H.range=void 0==l.range?Number.MAX_VALUE:l.range,H.parent=E,this._loader._babylonLights.push(H),y.AddPointerMetadata(H,n),d(E)})))))}}O(PE),k(PE,!0,(E=>new jE(E)));const XE="KHR_materials_pbrSpecularGlossiness";class WE{constructor(E){this.name=XE,this.order=200,this._loader=E,this.enabled=this._loader.isExtensionUsed(XE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;return I.push(this._loader.loadMaterialBasePropertiesAsync(E,H,d)),I.push(this._loadSpecularGlossinessPropertiesAsync(n,Z,d)),this._loader.loadMaterialAlphaProperties(E,H,d),await Promise.all(I).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const n=new Array;return d.metallic=null,d.roughness=null,H.diffuseFactor?(d.albedoColor=I.DH.eH(H.diffuseFactor),d.alpha=H.diffuseFactor[3]):d.albedoColor=I.DH.White(),d.reflectivityColor=H.specularFactor?I.DH.eH(H.specularFactor):I.DH.White(),d.microSurface=void 0==H.glossinessFactor?1:H.glossinessFactor,H.diffuseTexture&&n.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTexture`,H.diffuseTexture,(E=>{E.name=`${d.name} (Diffuse)`,d.albedoTexture=E}))),H.specularGlossinessTexture&&(n.push(this._loader.loadTextureInfoAsync(`${E}/specularGlossinessTexture`,H.specularGlossinessTexture,(E=>{E.name=`${d.name} (Specular Glossiness)`,d.reflectivityTexture=E,d.reflectivityTexture.Od=!0}))),d.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(n).then((()=>{}))}}O(XE),k(XE,!0,(E=>new WE(E)));const UE="KHR_materials_unlit";class YE{constructor(E){this.name=UE,this.order=210,this._loader=E,this.enabled=this._loader.isExtensionUsed(UE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async()=>await this._loadUnlitPropertiesAsync(E,H,d)))}_loadUnlitPropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const n=new Array;d.unlit=!0;const Z=H.pbrMetallicRoughness;return Z&&(Z.baseColorFactor?(d.albedoColor=I.DH.eH(Z.baseColorFactor),d.alpha=Z.baseColorFactor[3]):d.albedoColor=I.DH.White(),Z.baseColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${E}/baseColorTexture`,Z.baseColorTexture,(E=>{E.name=`${d.name} (Base Color)`,d.albedoTexture=E})))),H.doubleSided&&(d.ln=!1,d.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(E,H,d),Promise.all(n).then((()=>{}))}}O(UE),k(UE,!0,(E=>new YE(E)));const cE="KHR_materials_clearcoat";class uE{constructor(E){this.name=cE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(cE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadClearCoatPropertiesAsync(n,Z,d)),await Promise.all(I)}))}_loadClearCoatPropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const n=new Array;return d.clearCoat.isEnabled=!0,d.clearCoat.useRoughnessFromMainTexture=!1,d.clearCoat.remapF0OnInterfaceChange=!1,void 0!=H.clearcoatFactor?d.clearCoat.Lg=H.clearcoatFactor:d.clearCoat.Lg=0,H.clearcoatTexture&&n.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatTexture`,H.clearcoatTexture,(E=>{E.name=`${d.name} (ClearCoat)`,d.clearCoat.texture=E}))),void 0!=H.clearcoatRoughnessFactor?d.clearCoat.roughness=H.clearcoatRoughnessFactor:d.clearCoat.roughness=0,H.clearcoatRoughnessTexture&&(H.clearcoatRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatRoughnessTexture`,H.clearcoatRoughnessTexture,(E=>{E.name=`${d.name} (ClearCoat Roughness)`,d.clearCoat.textureRoughness=E})))),H.clearcoatNormalTexture&&(H.clearcoatNormalTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${E}/clearcoatNormalTexture`,H.clearcoatNormalTexture,(E=>{E.name=`${d.name} (ClearCoat Normal)`,d.clearCoat.bumpTexture=E}))),d.invertNormalMapX=!d.fE().useRightHandedSystem,d.invertNormalMapY=d.fE().useRightHandedSystem,void 0!=H.clearcoatNormalTexture.scale&&(d.clearCoat.bumpTexture.level=H.clearcoatNormalTexture.scale)),Promise.all(n).then((()=>{}))}}O(cE),k(cE,!0,(E=>new uE(E)));const oE="KHR_materials_iridescence";class FE{constructor(E){this.name=oE,this.order=195,this._loader=E,this.enabled=this._loader.isExtensionUsed(oE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadIridescencePropertiesAsync(n,Z,d)),await Promise.all(I).then((()=>{}))}))}_loadIridescencePropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const n=new Array;return d.iridescence.isEnabled=!0,d.iridescence.Lg=H.iridescenceFactor??0,d.iridescence.indexOfRefraction=H.iridescenceIor??H.iridescenceIOR??1.3,d.iridescence.minimumThickness=H.iridescenceThicknessMinimum??100,d.iridescence.maximumThickness=H.iridescenceThicknessMaximum??400,H.iridescenceTexture&&n.push(this._loader.loadTextureInfoAsync(`${E}/iridescenceTexture`,H.iridescenceTexture,(E=>{E.name=`${d.name} (Iridescence)`,d.iridescence.texture=E}))),H.iridescenceThicknessTexture&&n.push(this._loader.loadTextureInfoAsync(`${E}/iridescenceThicknessTexture`,H.iridescenceThicknessTexture,(E=>{E.name=`${d.name} (Iridescence Thickness)`,d.iridescence.thicknessTexture=E}))),Promise.all(n).then((()=>{}))}}O(oE),k(oE,!0,(E=>new FE(E)));const aE="KHR_materials_anisotropy";class kE{constructor(E){this.name=aE,this.order=195,this._loader=E,this.enabled=this._loader.isExtensionUsed(aE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadIridescencePropertiesAsync(n,Z,d)),await Promise.all(I)}))}async _loadIridescencePropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const n=new Array;d.anisotropy.isEnabled=!0,d.anisotropy.Lg=H.anisotropyStrength??0,d.anisotropy.angle=H.anisotropyRotation??0,H.anisotropyTexture&&(H.anisotropyTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${E}/anisotropyTexture`,H.anisotropyTexture,(E=>{E.name=`${d.name} (Anisotropy Intensity)`,d.anisotropy.texture=E})))),await Promise.all(n)}}O(aE),k(aE,!0,(E=>new kE(E)));const OE="KHR_materials_emissive_strength";class GE{constructor(E){this.name=OE,this.order=170,this._loader=E,this.enabled=this._loader.isExtensionUsed(OE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>await this._loader.loadMaterialPropertiesAsync(E,H,d).then((()=>{this._loadEmissiveProperties(n,Z,d)}))))}_loadEmissiveProperties(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);void 0!==H.emissiveStrength&&(d.emissiveIntensity=H.emissiveStrength)}}O(OE),k(OE,!0,(E=>new GE(E)));const xE="KHR_materials_sheen";class qE{constructor(E){this.name=xE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(xE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadSheenPropertiesAsync(n,Z,d)),await Promise.all(I).then((()=>{}))}))}_loadSheenPropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const n=new Array;return d.sheen.isEnabled=!0,d.sheen.Lg=1,void 0!=H.sheenColorFactor?d.sheen.color=I.DH.eH(H.sheenColorFactor):d.sheen.color=I.DH.Black(),H.sheenColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${E}/sheenColorTexture`,H.sheenColorTexture,(E=>{E.name=`${d.name} (Sheen Color)`,d.sheen.texture=E}))),void 0!==H.sheenRoughnessFactor?d.sheen.roughness=H.sheenRoughnessFactor:d.sheen.roughness=0,H.sheenRoughnessTexture&&(H.sheenRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${E}/sheenRoughnessTexture`,H.sheenRoughnessTexture,(E=>{E.name=`${d.name} (Sheen Roughness)`,d.sheen.textureRoughness=E})))),d.sheen.albedoScaling=!0,d.sheen.useRoughnessFromMainTexture=!1,Promise.all(n).then((()=>{}))}}O(xE),k(xE,!0,(E=>new qE(E)));var bE=d(12866);const hE="KHR_materials_specular";class yE{constructor(E){this.name=hE,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(hE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;if(I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadSpecularPropertiesAsync(n,Z,d)),Z.extensions&&Z.extensions.EXT_materials_specular_edge_color&&d instanceof e.c){Z.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(d.brdf.dielectricSpecularModel=bE.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,d.brdf.conductorSpecularModel=bE.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(I).then((()=>{}))}))}_loadSpecularPropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const n=new Array;return void 0!==H.specularFactor&&(d.metallicF0Factor=H.specularFactor),void 0!==H.specularColorFactor&&(d.metallicReflectanceColor=I.DH.eH(H.specularColorFactor)),H.specularTexture&&(H.specularTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${E}/specularTexture`,H.specularTexture,(E=>{E.name=`${d.name} (Specular)`,d.metallicReflectanceTexture=E,d.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),H.specularColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${E}/specularColorTexture`,H.specularColorTexture,(E=>{E.name=`${d.name} (Specular Color)`,d.reflectanceTexture=E}))),Promise.all(n).then((()=>{}))}}O(hE),k(hE,!0,(E=>new yE(E)));const vE="KHR_materials_ior";class zE{constructor(E){this.name=vE,this.order=180,this._loader=E,this.enabled=this._loader.isExtensionUsed(vE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadIorPropertiesAsync(n,Z,d)),await Promise.all(I).then((()=>{}))}))}_loadIorPropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);return void 0!==H.ior?d.indexOfRefraction=H.ior:d.indexOfRefraction=zE._DEFAULT_IOR,Promise.resolve()}}zE._DEFAULT_IOR=1.5,O(vE),k(vE,!0,(E=>new zE(E)));const KE="KHR_materials_variants";class NE{constructor(E){this.name=KE,this._loader=E,this.enabled=this._loader.isExtensionUsed(KE)}dispose(){this._loader=null}static GetAvailableVariants(E){const H=this._GetExtensionMetadata(E);return H?Object.keys(H.variants):[]}getAvailableVariants(E){return NE.GetAvailableVariants(E)}static SelectVariant(E,H){const d=this._GetExtensionMetadata(E);if(!d)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${KE} extension`);const n=E=>{const H=d.variants[E];if(H)for(const d of H)d.mesh.material=d.material};if(H instanceof Array)for(const Z of H)n(Z);else n(H);d.lastSelected=H}selectVariant(E,H){NE.SelectVariant(E,H)}static Reset(E){const H=this._GetExtensionMetadata(E);if(!H)throw new Error(`Cannot reset on a glTF mesh that does not have the ${KE} extension`);for(const d of H.original)d.mesh.material=d.material;H.lastSelected=null}reset(E){NE.Reset(E)}static GetLastSelectedVariant(E){const H=this._GetExtensionMetadata(E);if(!H)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${KE} extension`);return H.lastSelected}getLastSelectedVariant(E){return NE.GetLastSelectedVariant(E)}static _GetExtensionMetadata(E){var H,d;return(null===E||void 0===E||null===(H=E._internalMetadata)||void 0===H||null===(d=H.jd)||void 0===d?void 0:d[KE])||null}onLoading(){const E=this._loader.jd.extensions;if(E&&E[this.name]){const H=E[this.name];this._variants=H.variants}}onReady(){const E=this._loader.rootBabylonMesh;if(E){var H;const d=this._loader.parent.extensionOptions[KE];null!==d&&void 0!==d&&d.defaultVariant&&NE.SelectVariant(E,d.defaultVariant),null===d||void 0===d||null===(H=d.onLoaded)||void 0===H||H.call(d,{get variants(){return NE.GetAvailableVariants(E)},get selectedVariant(){const H=NE.GetLastSelectedVariant(E);return H?Array.isArray(H)?H[0]:H:NE.GetAvailableVariants(E)[0]},set selectedVariant(H){NE.SelectVariant(E,H)}})}}_loadMeshPrimitiveAsync(E,H,d,n,Z,I){return y.LoadExtensionAsync(E,Z,this.name,(async(g,l)=>{const r=new Array;return r.push(this._loader._loadMeshPrimitiveAsync(E,H,d,n,Z,(H=>{if(I(H),H instanceof j.e){const d=y._GetDrawMode(E,Z.mode),n=this._loader.rootBabylonMesh,I=n?n._internalMetadata=n._internalMetadata||{}:{},t=I.jd=I.jd||{},S=t[KE]=t[KE]||{lastSelected:null,original:[],variants:{}};S.original.push({mesh:H,material:H.material});for(let E=0;E<l.mappings.length;++E){const Z=l.mappings[E],I=b.Get(`${g}/mappings/${E}/material`,this._loader.jd.materials,Z.material);r.push(this._loader._loadMaterialAsync(`#/materials/${Z.material}`,I,H,d,(E=>{for(let d=0;d<Z.variants.length;++d){const I=Z.variants[d],g=b.Get(`/extensions/${KE}/variants/${I}`,this._variants,I);S.variants[g.name]=S.variants[g.name]||[],S.variants[g.name].push({mesh:H,material:E}),H.onClonedObservable.add((E=>{const d=E;let Z=null,I=d;do{if(I=I.parent,!I)return;Z=NE._GetExtensionMetadata(I)}while(null===Z);if(n&&Z===NE._GetExtensionMetadata(n)){I._internalMetadata={};for(const E in n._internalMetadata)I._internalMetadata[E]=n._internalMetadata[E];I._internalMetadata.jd=[];for(const E in n._internalMetadata.jd)I._internalMetadata.jd[E]=n._internalMetadata.jd[E];I._internalMetadata.jd[KE]={lastSelected:null,original:[],variants:{}};for(const E of Z.original)I._internalMetadata.jd[KE].original.push({mesh:E.mesh,material:E.material});for(const E in Z.variants)if(Object.prototype.hasOwnProperty.call(Z.variants,E)){I._internalMetadata.jd[KE].variants[E]=[];for(const H of Z.variants[E])I._internalMetadata.jd[KE].variants[E].push({mesh:H.mesh,material:H.material})}Z=I._internalMetadata.jd[KE]}for(const n of Z.original)n.mesh===H&&(n.mesh=d);for(const n of Z.variants[g.name])n.mesh===H&&(n.mesh=d)}))}})))}}}))),await Promise.all(r).then((E=>{let[H]=E;return H}))}))}}O(KE),k(KE,!0,(E=>new NE(E)));var mH=d(12452);class TE{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:bE.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(E,H){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...TE._GetDefaultOptions(),...E},this._scene=H,this._scene._transmissionHelper=this,this.onErrorObservable=new S.e,this._scene.Qd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(E){if(!Object.keys(E).filter((H=>this._options[H]!==E[H])).length)return;const H={...this._options,...E},d=this._options;this._options=H,H.renderSize===d.renderSize&&H.renderTargetTextureType===d.renderTargetTextureType&&H.generateMipmaps===d.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=H.samples,this._opaqueRenderTarget.lodGenerationScale=H.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=H.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(E){return!!E&&!!(E instanceof e.c&&E.subSurface.isRefractionEnabled)}_addMesh(E){this._materialObservers[E.uniqueId]=E.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),g.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(E.material)?(E.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(E)&&this._transparentMeshesCache.push(E)):-1===this._opaqueMeshesCache.indexOf(E)&&this._opaqueMeshesCache.push(E)}))}_removeMesh(E){E.onMaterialChangedObservable.remove(this._materialObservers[E.uniqueId]),delete this._materialObservers[E.uniqueId];let H=this._transparentMeshesCache.indexOf(E);-1!==H&&this._transparentMeshesCache.splice(H,1),H=this._opaqueMeshesCache.indexOf(E),-1!==H&&this._opaqueMeshesCache.splice(H,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(E){const H=this._transparentMeshesCache.indexOf(E),d=this._opaqueMeshesCache.indexOf(E);this._shouldRenderAsTransmission(E.material)?(E.material instanceof e.c&&(E.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==d?(this._opaqueMeshesCache.splice(d,1),this._transparentMeshesCache.push(E)):-1===H&&this._transparentMeshesCache.push(E)):-1!==H?(this._transparentMeshesCache.splice(H,1),this._opaqueMeshesCache.push(E)):-1===d&&this._opaqueMeshesCache.push(E)}_isRenderTargetValid(){var E;return null!==(null===(E=this._opaqueRenderTarget)||void 0===E?void 0:E.getInternalTexture())}_setupRenderTargets(){var E;let H;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new mH.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(E=this._options.clearColor)||void 0===E?void 0:E.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((E=>{H=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?E.clearColor.l(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(E.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=H}));for(const d of this._transparentMeshesCache)this._shouldRenderAsTransmission(d.material)&&(d.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const AE="KHR_materials_transmission";class BE{constructor(E){this.name=AE,this.order=175,this._loader=E,this.enabled=this._loader.isExtensionUsed(AE),this.enabled&&(E.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadTransparentPropertiesAsync(n,H,d,Z)),await Promise.all(I).then((()=>{}))}))}_loadTransparentPropertiesAsync(E,H,d,n){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const Z=d;if(Z.subSurface.isRefractionEnabled=!0,Z.subSurface.volumeIndexOfRefraction=1,Z.subSurface.useAlbedoToTintRefraction=!0,void 0===n.transmissionFactor)return Z.subSurface.refractionIntensity=0,Z.subSurface.isRefractionEnabled=!1,Promise.resolve();{var I;Z.subSurface.refractionIntensity=n.transmissionFactor;const E=Z.fE();if(Z.subSurface.refractionIntensity&&!E._transmissionHelper)new TE({},Z.fE());else if(Z.subSurface.refractionIntensity&&(null===(I=E._transmissionHelper)||void 0===I||!I._isRenderTargetValid())){var g;null===(g=E._transmissionHelper)||void 0===g||g._setupRenderTargets()}}return Z.subSurface.minimumThickness=0,Z.subSurface.maximumThickness=0,n.transmissionTexture?(n.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${E}/transmissionTexture`,n.transmissionTexture,void 0).then((E=>{E.name=`${d.name} (Transmission)`,Z.subSurface.refractionIntensityTexture=E,Z.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}O(AE),k(AE,!0,(E=>new BE(E)));const JE="KHR_materials_diffuse_transmission";class EH{constructor(E){this.name=JE,this.order=174,this._loader=E,this.enabled=this._loader.isExtensionUsed(JE),this.enabled&&(E.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadTranslucentPropertiesAsync(n,H,d,Z)),await Promise.all(I).then((()=>{}))}))}_loadTranslucentPropertiesAsync(E,H,d,n){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const Z=d;if(Z.subSurface.isTranslucencyEnabled=!0,Z.subSurface.volumeIndexOfRefraction=1,Z.subSurface.minimumThickness=0,Z.subSurface.maximumThickness=0,Z.subSurface.useAlbedoToTintTranslucency=!1,void 0===n.diffuseTransmissionFactor)return Z.subSurface.translucencyIntensity=0,Z.subSurface.isTranslucencyEnabled=!1,Promise.resolve();Z.subSurface.translucencyIntensity=n.diffuseTransmissionFactor;const g=new Array;return Z.subSurface.useGltfStyleTextures=!0,n.diffuseTransmissionTexture&&(n.diffuseTransmissionTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTransmissionTexture`,n.diffuseTransmissionTexture).then((E=>{E.name=`${d.name} (Diffuse Transmission)`,Z.subSurface.translucencyIntensityTexture=E})))),void 0!==n.diffuseTransmissionColorFactor?Z.subSurface.translucencyColor=I.DH.eH(n.diffuseTransmissionColorFactor):Z.subSurface.translucencyColor=I.DH.White(),n.diffuseTransmissionColorTexture&&g.push(this._loader.loadTextureInfoAsync(`${E}/diffuseTransmissionColorTexture`,n.diffuseTransmissionColorTexture).then((E=>{E.name=`${d.name} (Diffuse Transmission Color)`,Z.subSurface.translucencyColorTexture=E}))),Promise.all(g).then((()=>{}))}}O(JE),k(JE,!0,(E=>new EH(E)));const HH="KHR_materials_volume";class dH{constructor(E){this.name=HH,this.order=173,this._loader=E,this.enabled=this._loader.isExtensionUsed(HH),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadVolumePropertiesAsync(n,H,d,Z)),await Promise.all(I).then((()=>{}))}))}_loadVolumePropertiesAsync(E,H,d,n){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);if(!d.subSurface.isRefractionEnabled&&!d.subSurface.isTranslucencyEnabled||!n.thicknessFactor)return Promise.resolve();d.subSurface.volumeIndexOfRefraction=d.indexOfRefraction;const Z=void 0!==n.attenuationDistance?n.attenuationDistance:Number.MAX_VALUE;return d.subSurface.tintColorAtDistance=Z,void 0!==n.attenuationColor&&3==n.attenuationColor.length&&d.subSurface.tintColor.en(n.attenuationColor[0],n.attenuationColor[1],n.attenuationColor[2]),d.subSurface.minimumThickness=0,d.subSurface.maximumThickness=n.thicknessFactor,d.subSurface.useThicknessAsDepth=!0,n.thicknessTexture?(n.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${E}/thicknessTexture`,n.thicknessTexture).then((E=>{E.name=`${d.name} (Thickness)`,d.subSurface.thicknessTexture=E,d.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}O(HH),k(HH,!0,(E=>new dH(E)));const nH="KHR_materials_dispersion";class ZH{constructor(E){this.name=nH,this.order=174,this._loader=E,this.enabled=this._loader.isExtensionUsed(nH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadDispersionPropertiesAsync(n,H,d,Z)),await Promise.all(I).then((()=>{}))}))}_loadDispersionPropertiesAsync(E,H,d,n){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);return d.subSurface.isRefractionEnabled&&n.dispersion?(d.subSurface.isDispersionEnabled=!0,d.subSurface.dispersion=n.dispersion,Promise.resolve()):Promise.resolve()}}O(nH),k(nH,!0,(E=>new ZH(E)));const IH="EXT_materials_diffuse_roughness";class gH{constructor(E){this.name=IH,this.order=190,this._loader=E,this.enabled=this._loader.isExtensionUsed(IH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=new Array;return I.push(this._loader.loadMaterialPropertiesAsync(E,H,d)),I.push(this._loadDiffuseRoughnessPropertiesAsync(n,Z,d)),await Promise.all(I).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(E,H,d){if(!(d instanceof e.c))throw new Error(`${E}: Material type not supported`);const n=new Array;return d.brdf.baseDiffuseModel=bE.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=H.diffuseRoughnessFactor?d.baseDiffuseRoughness=H.diffuseRoughnessFactor:d.baseDiffuseRoughness=0,H.diffuseRoughnessTexture&&n.push(this._loader.loadTextureInfoAsync(`${E}/diffuseRoughnessTexture`,H.diffuseRoughnessTexture,(E=>{E.name=`${d.name} (Diffuse Roughness)`,d.baseDiffuseRoughnessTexture=E}))),Promise.all(n).then((()=>{}))}}O(IH),k(IH,!0,(E=>new gH(E)));const lH="KHR_mesh_quantization";class rH{constructor(E){this.name=lH,this.enabled=E.isExtensionUsed(lH)}dispose(){}}O(lH),k(lH,!0,(E=>new rH(E)));const tH="KHR_texture_basisu";class SH{constructor(E){this.name=tH,this._loader=E,this.enabled=E.isExtensionUsed(tH)}dispose(){this._loader=null}_loadTextureAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>{const I=void 0==H.sampler?y.DefaultSampler:b.Get(`${E}/sampler`,this._loader.jd.samplers,H.sampler),g=b.Get(`${n}/source`,this._loader.jd.images,Z.source);return await this._loader._createTextureAsync(E,I,g,(E=>{d(E)}),H._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!H._textureInfo.nonColorData)}))}}O(tH),k(tH,!0,(E=>new SH(E)));const MH="KHR_texture_transform";class VH{constructor(E){this.name=MH,this._loader=E,this.enabled=this._loader.isExtensionUsed(MH)}dispose(){this._loader=null}loadTextureInfoAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(n,Z)=>await this._loader.loadTextureInfoAsync(E,H,(E=>{if(!(E instanceof s.c))throw new Error(`${n}: Texture type not supported`);Z.offset&&(E.uOffset=Z.offset[0],E.vOffset=Z.offset[1]),E.uRotationCenter=0,E.vRotationCenter=0,Z.rotation&&(E.wAng=-Z.rotation),Z.scale&&(E.uScale=Z.scale[0],E.vScale=Z.scale[1]),void 0!=Z.texCoord&&(E.coordinatesIndex=Z.texCoord),d(E)}))))}}O(MH),k(MH,!0,(E=>new VH(E)));const CH="KHR_xmp_json_ld";class wH{constructor(E){this.name=CH,this.order=100,this._loader=E,this.enabled=this._loader.isExtensionUsed(CH)}dispose(){this._loader=null}onLoading(){var E,H,d;if(null===this._loader.rootBabylonMesh)return;const n=null===(E=this._loader.jd.extensions)||void 0===E?void 0:E.KHR_xmp_json_ld,Z=null===(H=this._loader.jd.asset)||void 0===H||null===(d=H.extensions)||void 0===d?void 0:d.KHR_xmp_json_ld;if(n&&Z){const E=+Z.packet;n.packets&&E<n.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=n.packets[E])}}}function RH(E,H,d,n){return I.DH.eH(H,d).scale(n)}function QH(E,H,d,n){return H[d]*n}function LH(E,H,d,n){return-H[d]*n}function DH(E,H,d,n){return H[d+1]*n}function eH(E,H,d,n){return H[d]*n*2}function sH(E){return{scale:[new pH(V.b.ANIMATIONTYPE_FLOAT,`${E}.uScale`,QH,(()=>2)),new pH(V.b.ANIMATIONTYPE_FLOAT,`${E}.vScale`,DH,(()=>2))],offset:[new pH(V.b.ANIMATIONTYPE_FLOAT,`${E}.uOffset`,QH,(()=>2)),new pH(V.b.ANIMATIONTYPE_FLOAT,`${E}.vOffset`,DH,(()=>2))],rotation:[new pH(V.b.ANIMATIONTYPE_FLOAT,`${E}.wAng`,LH,(()=>1))]}}O(CH),k(CH,!0,(E=>new wH(E)));class iH extends v.AnimationPropertyInfo{buildAnimations(E,H,d,n){return[{babylonAnimatable:E._babylonCamera,babylonAnimation:this._buildAnimation(H,d,n)}]}}class pH extends v.AnimationPropertyInfo{buildAnimations(E,H,d,n){const Z=[];for(const I in E._data)Z.push({babylonAnimatable:E._data[I].babylonMaterial,babylonAnimation:this._buildAnimation(H,d,n)});return Z}}class fH extends v.AnimationPropertyInfo{buildAnimations(E,H,d,n){return[{babylonAnimatable:E._babylonLight,babylonAnimation:this._buildAnimation(H,d,n)}]}}(0,G.h)("/cameras/{}/orthographic/xmag",[new iH(V.b.ANIMATIONTYPE_FLOAT,"orthoLeft",LH,(()=>1)),new iH(V.b.ANIMATIONTYPE_FLOAT,"orthoRight",DH,(()=>1))]),(0,G.h)("/cameras/{}/orthographic/ymag",[new iH(V.b.ANIMATIONTYPE_FLOAT,"orthoBottom",LH,(()=>1)),new iH(V.b.ANIMATIONTYPE_FLOAT,"orthoTop",DH,(()=>1))]),(0,G.h)("/cameras/{}/orthographic/zfar",[new iH(V.b.ANIMATIONTYPE_FLOAT,"maxZ",QH,(()=>1))]),(0,G.h)("/cameras/{}/orthographic/znear",[new iH(V.b.ANIMATIONTYPE_FLOAT,"Gd",QH,(()=>1))]),(0,G.h)("/cameras/{}/perspective/yfov",[new iH(V.b.ANIMATIONTYPE_FLOAT,"fov",QH,(()=>1))]),(0,G.h)("/cameras/{}/perspective/zfar",[new iH(V.b.ANIMATIONTYPE_FLOAT,"maxZ",QH,(()=>1))]),(0,G.h)("/cameras/{}/perspective/znear",[new iH(V.b.ANIMATIONTYPE_FLOAT,"Gd",QH,(()=>1))]),(0,G.h)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new pH(V.b.ANIMATIONTYPE_COLOR3,"albedoColor",RH,(()=>4)),new pH(V.b.ANIMATIONTYPE_FLOAT,"alpha",(function(E,H,d,n){return H[d+3]*n}),(()=>4))]),(0,G.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"metallic",QH,(()=>1))]),(0,G.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"roughness",QH,(()=>1))]);const PH=sH("albedoTexture");(0,G.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",PH.scale),(0,G.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",PH.offset),(0,G.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",PH.rotation);const jH=sH("metallicTexture");(0,G.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",jH.scale),(0,G.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",jH.offset),(0,G.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",jH.rotation),(0,G.h)("/materials/{}/emissiveFactor",[new pH(V.b.ANIMATIONTYPE_COLOR3,"emissiveColor",RH,(()=>3))]);const XH=sH("bumpTexture");(0,G.h)("/materials/{}/normalTexture/scale",[new pH(V.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",QH,(()=>1))]),(0,G.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",XH.scale),(0,G.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",XH.offset),(0,G.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",XH.rotation),(0,G.h)("/materials/{}/occlusionTexture/strength",[new pH(V.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",QH,(()=>1))]);const WH=sH("ambientTexture");(0,G.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",WH.scale),(0,G.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",WH.offset),(0,G.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",WH.rotation);const UH=sH("emissiveTexture");(0,G.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",UH.scale),(0,G.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",UH.offset),(0,G.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",UH.rotation),(0,G.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new pH(V.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new pH(V.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",QH,(()=>1))]);const YH=sH("anisotropy.texture");(0,G.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",YH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",YH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",YH.rotation),(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",QH,(()=>1))]);const cH=sH("clearCoat.texture");(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",cH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",cH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",cH.rotation);const uH=sH("clearCoat.bumpTexture");(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new pH(V.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",uH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",uH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",uH.rotation);const oH=sH("clearCoat.textureRoughness");(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",oH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",oH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",oH.rotation),(0,G.h)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new pH(V.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_ior/ior",[new pH(V.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new pH(V.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new pH(V.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",QH,(()=>1))]);const FH=sH("iridescence.texture");(0,G.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",FH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",FH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",FH.rotation);const aH=sH("iridescence.thicknessTexture");(0,G.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",aH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",aH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",aH.rotation),(0,G.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new pH(V.b.ANIMATIONTYPE_COLOR3,"sheen.color",RH,(()=>3))]),(0,G.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",QH,(()=>1))]);const kH=sH("sheen.texture");(0,G.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",kH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",kH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",kH.rotation);const OH=sH("sheen.textureRoughness");(0,G.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",OH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",OH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",OH.rotation),(0,G.h)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new pH(V.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",RH,(()=>3))]);const GH=sH("metallicReflectanceTexture");(0,G.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",GH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",GH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",GH.rotation);const xH=sH("reflectanceTexture");(0,G.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",xH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",xH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",xH.rotation),(0,G.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",QH,(()=>1))]);const qH=sH("subSurface.refractionIntensityTexture");(0,G.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",qH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",qH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",qH.rotation),(0,G.h)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new pH(V.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",RH,(()=>3))]),(0,G.h)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new pH(V.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",QH,(()=>1))]),(0,G.h)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",QH,(()=>1))]);const bH=sH("subSurface.thicknessTexture");(0,G.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",bH.scale),(0,G.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",bH.offset),(0,G.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",bH.rotation),(0,G.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new pH(V.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",QH,(()=>1))]);const hH=sH("subSurface.translucencyIntensityTexture");(0,G.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",hH.scale),(0,G.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",hH.offset),(0,G.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",hH.rotation),(0,G.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new pH(V.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",RH,(()=>3))]);const yH=sH("subSurface.translucencyColorTexture");(0,G.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",yH.scale),(0,G.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",yH.offset),(0,G.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",yH.rotation),(0,G.h)("/extensions/KHR_lights_punctual/lights/{}/color",[new fH(V.b.ANIMATIONTYPE_COLOR3,"diffuse",RH,(()=>3))]),(0,G.h)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new fH(V.b.ANIMATIONTYPE_FLOAT,"intensity",QH,(()=>1))]),(0,G.h)("/extensions/KHR_lights_punctual/lights/{}/range",[new fH(V.b.ANIMATIONTYPE_FLOAT,"range",QH,(()=>1))]),(0,G.h)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new fH(V.b.ANIMATIONTYPE_FLOAT,"innerAngle",eH,(()=>1))]),(0,G.h)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new fH(V.b.ANIMATIONTYPE_FLOAT,"angle",eH,(()=>1))]),(0,G.h)("/nodes/{}/extensions/EXT_lights_ies/color",[new fH(V.b.ANIMATIONTYPE_COLOR3,"diffuse",RH,(()=>3))]),(0,G.h)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new fH(V.b.ANIMATIONTYPE_FLOAT,"intensity",QH,(()=>1))]);const vH="KHR_animation_pointer";class zH{constructor(E){this.name=vH,this._loader=E,this._pathToObjectConverter=(0,G.e)(this._loader.jd)}get enabled(){return this._loader.isExtensionUsed(vH)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(E,H,d,n,Z){var I;const g=null===(I=n.target.extensions)||void 0===I?void 0:I.KHR_animation_pointer;if(!g||!this._pathToObjectConverter)return null;"pointer"!==n.target.path&&R.b.Warn(`${E}/target/path: Value (${n.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=n.target.node&&R.b.Warn(`${E}/target/node: Value (${n.target.node}) must not be present when using the ${this.name} extension`);const l=`${E}/extensions/${this.name}`,r=g.pointer;if(!r)throw new Error(`${l}: Pointer is missing`);try{const I=this._pathToObjectConverter.convert(r);if(!I.info.interpolation)throw new Error(`${l}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(E,H,d,n,{object:I.object,info:I.info.interpolation},Z)}catch(t){return R.b.Warn(`${l}/pointer: Invalid pointer (${r}) skipped`),null}}}O(vH),k(vH,!0,(E=>new zH(E)));class KH{constructor(E,H,d){this.frame=E,this.action=H,this.onlyOnce=d,this.isDone=!1}_clone(){return new KH(this.frame,this.action,this.onlyOnce)}}var NH=d(12256),md=d(12296),TH=d(12287);class AH{get loop(){return this._loop}set loop(E){E!==this._loop&&(this._loop=E,this.updateOptions({loop:E}))}get currentTime(){var E;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(E=md.c.audioEngine)&&void 0!==E&&E.audioContext&&(this.isPlaying||this.isPaused)){const E=this.isPaused?0:md.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+E}return 0}get spatialSound(){return this._spatialSound}set spatialSound(E){if(E==this._spatialSound)return;const H=this.isPlaying;this.pause(),E?(this._spatialSound=E,this._updateSpatialParameters()):this._disableSpatialSound(),H&&this.play()}constructor(E,H,d){var n;let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new S.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=Z.wH.Zero(),this._localDirection=new Z.wH(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=E,d=d||w.b.LastCreatedScene)if(this._scene=d,AH._SceneComponentInitialization(d),this._readyToPlayCallback=I,this._customAttenuationFunction=(E,H,d,n,Z)=>H<d?E*(1-H/d):0,l&&(this.autoplay=l.autoplay||!1,this._loop=l.loop||!1,void 0!==l.volume&&(this._volume=l.volume),this._spatialSound=l.spatialSound??!1,this.maxDistance=l.maxDistance??100,this.useCustomAttenuation=l.useCustomAttenuation??!1,this.rolloffFactor=l.rolloffFactor||1,this.refDistance=l.refDistance||1,this.distanceModel=l.distanceModel||"linear",this._playbackRate=l.playbackRate||1,this._streaming=l.streaming??!1,this._length=l.length,this._offset=l.offset),null!==(n=md.c.audioEngine)&&void 0!==n&&n.canUseWebAudio&&md.c.audioEngine.audioContext){this._soundGain=md.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let E=!0;if(H)try{"string"===typeof H?(this._urlType="String",this._url=H):H instanceof ArrayBuffer?this._urlType="ArrayBuffer":H instanceof HTMLMediaElement?this._urlType="MediaElement":H instanceof MediaStream?this._urlType="MediaStream":H instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(H)&&(this._urlType="Array");let d=[],n=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=md.c.audioEngine.audioContext.createMediaElementSource(H),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=md.c.audioEngine.audioContext.createMediaStreamSource(H),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":H.byteLength>0&&(n=!0,this._soundLoaded(H));break;case"AudioBuffer":this._audioBufferLoaded(H);break;case"String":d.push(H);case"Array":0===d.length&&(d=H);for(let E=0;E<d.length;E++){const H=d[E];if(n=l&&l.skipCodecCheck||-1!==H.indexOf(".mp3",H.length-4)&&md.c.audioEngine.isMP3supported||-1!==H.indexOf(".ogg",H.length-4)&&md.c.audioEngine.isOGGsupported||-1!==H.indexOf(".wav",H.length-4)||-1!==H.indexOf(".m4a",H.length-4)||-1!==H.indexOf(".mp4",H.length-4)||-1!==H.indexOf("blob:"),n){this._streaming?(this._htmlAudioElement=new Audio(H),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,g.Tools.SetCorsBehavior(H,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(H,(E=>{this._soundLoaded(E)}),void 0,!0,!0,(E=>{E&&R.b.Error("XHR "+E.status+" error on: "+H+"."),R.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:E=!1}E?n||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):R.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(r){R.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),md.c.audioEngine&&!md.c.audioEngine.WarnedWebAudioUnsupported&&(R.b.Error("Web Audio is not supported by your browser."),md.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var E;null!==(E=md.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(E){var H;null!==(H=md.c.audioEngine)&&void 0!==H&&H.audioContext&&(this._audioBuffer=E,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(E){var H;null!==(H=md.c.audioEngine)&&void 0!==H&&H.audioContext&&md.c.audioEngine.audioContext.decodeAudioData(E,(E=>{this._audioBufferLoaded(E)}),(E=>{R.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+E)}))}setAudioBuffer(E){var H;null!==(H=md.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&(this._audioBuffer=E,this._isReadyToPlay=!0)}updateOptions(E){E&&(this.loop=E.loop??this.loop,this.maxDistance=E.maxDistance??this.maxDistance,this.useCustomAttenuation=E.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=E.rolloffFactor??this.rolloffFactor,this.refDistance=E.refDistance??this.refDistance,this.distanceModel=E.distanceModel??this.distanceModel,this._playbackRate=E.playbackRate??this._playbackRate,this._length=E.length??void 0,this.spatialSound=E.spatialSound??this._spatialSound,this._setOffset(E.offset??void 0),this.setVolume(E.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var E;null!==(E=md.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&md.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??md.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var E;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(E=this._soundPanner)||void 0===E||E.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var E;null!==(E=md.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(E){var H;null!==(H=md.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(E),this._isOutputConnected=!0)}setDirectionalCone(E,H,d){H<E?R.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=E,this._coneOuterAngle=H,this._coneOuterGain=d,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(E){if(E!=this._coneInnerAngle){var H;if(this._coneOuterAngle<E)return void R.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=E,null!==(H=md.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(E){if(E!=this._coneOuterAngle){var H;if(E<this._coneInnerAngle)return void R.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=E,null!==(H=md.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(E){var H;E.equals(this._position)||(this._position.l(E),null!==(H=md.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(E){var H;this._localDirection=E,null!==(H=md.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const E=this._connectedTransformNode.getWorldMatrix(),H=Z.wH.TransformNormal(this._localDirection,E);H.normalize(),this._soundPanner.orientationX.value=H.x,this._soundPanner.orientationY.value=H.y,this._soundPanner.orientationZ.value=H.z}updateDistanceFromListener(){var E;if(null!==(E=md.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const E=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.RH(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,E,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(E){this._customAttenuationFunction=E}play(E,H,d){var n;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(n=md.c.audioEngine)&&void 0!==n&&n.audioContext)try{var Z,I;this._clearTimeoutsAndObservers();let n=E?(null===(Z=md.c.audioEngine)||void 0===Z?void 0:Z.audioContext.currentTime)+E:null===(I=md.c.audioEngine)||void 0===I?void 0:I.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=md.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const E=()=>{var d;if(null!==(d=md.c.audioEngine)&&void 0!==d&&d.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=H??0;const d=this._htmlAudioElement.play();void 0!==d&&d.catch((()=>{var H,d;(null===(H=md.c.audioEngine)||void 0===H||H.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(d=md.c.audioEngine)||void 0===d?void 0:d.onAudioUnlockedObservable.addOnce((()=>{E()})))}))}else{var n;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(n=md.c.audioEngine)||void 0===n?void 0:n.onAudioUnlockedObservable.addOnce((()=>{E()}))}};E()}}else{var g;const Z=()=>{var Z;if(null!==(Z=md.c.audioEngine)&&void 0!==Z&&Z.audioContext){var I;if(d=d||this._length,void 0!==H&&this._setOffset(H),this._soundSource){const E=this._soundSource;E.onended=()=>{E.disconnect()}}if(this._soundSource=null===(I=md.c.audioEngine)||void 0===I?void 0:I.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var g;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==H&&(this._soundSource.loopStart=H),void 0!==d&&(this._soundSource.loopEnd=(0|H)+d),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},n=E?(null===(g=md.c.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+E:md.c.audioEngine.audioContext.currentTime;const Z=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(n,Z,this.loop?void 0:d)}}};"suspended"===(null===(g=md.c.audioEngine)||void 0===g?void 0:g.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var E;"suspended"===(null===(E=md.c.audioEngine)||void 0===E?void 0:E.audioContext.state)?(md.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=md.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{Z()})))):Z()}),500):Z()}this._startTime=n,this.isPlaying=!0,this.isPaused=!1}catch(l){R.b.Error("Error while trying to play audio: "+this.name+", "+l.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(E){var H;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var d;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(d=this._streamingSource)||void 0===d||d.disconnect();this.isPlaying=!1}else if(null!==(H=md.c.audioEngine)&&void 0!==H&&H.audioContext&&this._soundSource){const H=E?md.c.audioEngine.audioContext.currentTime+E:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(H)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var E;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var H;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(H=this._streamingSource)||void 0===H||H.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(E=md.c.audioEngine)&&void 0!==E&&E.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=md.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(E,H){var d;null!==(d=md.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._soundGain&&(H&&md.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(md.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,md.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(E,md.c.audioEngine.audioContext.currentTime+H)):this._soundGain.gain.value=E),this._volume=E}setPlaybackRate(E){this._playbackRate=E,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(E){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=E,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=E=>this._onRegisterAfterWorldMatrixUpdate(E),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(E){var H;if(E.getBoundingInfo){const H=E.getBoundingInfo();this.setPosition(H.boundingSphere.centerWorld)}else this.setPosition(E.absolutePosition);null!==(H=md.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const E=()=>{(0,TH.d)((()=>this._isReadyToPlay),(()=>{d._audioBuffer=this.getAudioBuffer(),d._isReadyToPlay=!0,d.autoplay&&d.play(0,this._offset,this._length)}),void 0,300)},H={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},d=new AH(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,H);return this.useCustomAttenuation&&d.setAttenuationFunction(this._customAttenuationFunction),d.setPosition(this._position),d.setPlaybackRate(this._playbackRate),E(),d}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const E={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(E.connectedMeshId=this._connectedTransformNode.id),E.position=this._position.kd(),E.refDistance=this.refDistance,E.distanceModel=this.distanceModel,E.isDirectional=this._isDirectional,E.localDirectionToMesh=this._localDirection.kd(),E.coneInnerAngle=this._coneInnerAngle,E.coneOuterAngle=this._coneOuterAngle,E.coneOuterGain=this._coneOuterGain),E}static Parse(E,H,d,n){const I=E.name;let g;g=E.url?d+E.url:d+I;const l={autoplay:E.autoplay,loop:E.loop,volume:E.volume,spatialSound:E.spatialSound,maxDistance:E.maxDistance,rolloffFactor:E.rolloffFactor,refDistance:E.refDistance,distanceModel:E.distanceModel,playbackRate:E.playbackRate};let r;if(n){const E=()=>{(0,TH.d)((()=>n._isReadyToPlay),(()=>{r._audioBuffer=n.getAudioBuffer(),r._isReadyToPlay=!0,r.autoplay&&r.play(0,r._offset,r._length)}),void 0,300)};r=new AH(I,new ArrayBuffer(0),H,null,l),E()}else r=new AH(I,g,H,(()=>{H.removePendingData(r)}),l),H.addPendingData(r);if(E.position){const H=Z.wH.eH(E.position);r.setPosition(H)}if(E.isDirectional&&(r.setDirectionalCone(E.coneInnerAngle||360,E.coneOuterAngle||360,E.coneOuterGain||0),E.localDirectionToMesh)){const H=Z.wH.eH(E.localDirectionToMesh);r.setLocalDirectionToMesh(H)}if(E.connectedMeshId){const d=H.getMeshById(E.connectedMeshId);d&&r.attachToMesh(d)}return E.metadata&&(r.metadata=E.metadata),r}_setOffset(E){this._offset!==E&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=E)}_clearTimeoutsAndObservers(){var E;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(E=md.c.audioEngine)||void 0===E||E.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}AH._SceneComponentInitialization=E=>{throw(0,NH.c)("AudioSceneComponent")},(0,pE.e)("BABYLON.Sound",AH);class BH{constructor(E,H,d){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],H.length!==d.length)throw new Error("Sounds length does not equal weights length");this.loop=E,this._weights=d;let n=0;for(const I of d)n+=I;const Z=n>0?1/n:0;for(let I=0;I<this._weights.length;I++)this._weights[I]*=Z;this._sounds=H;for(const I of this._sounds)I.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(E){if(E!==this._coneInnerAngle){if(this._coneOuterAngle<E)return void R.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=E;for(const H of this._sounds)H.directionalConeInnerAngle=E}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(E){if(E!==this._coneOuterAngle){if(E<this._coneInnerAngle)return void R.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=E;for(const H of this._sounds)H.directionalConeOuterAngle=E}}get volume(){return this._volume}set volume(E){if(E!==this._volume)for(const H of this._sounds)H.setVolume(E)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(E){if(!this.isPaused){this.stop();const E=Math.random();let H=0;for(let d=0;d<this._weights.length;d++)if(H+=this._weights[d],E<=H){this._currentIndex=d;break}}const H=this._sounds[this._currentIndex??0];H.isReady()?H.play(0,this.isPaused?void 0:E):H.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class JH{constructor(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(E=E||w.b.LastCreatedScene)&&(this._scene=E,this.soundCollection=[],this._options=H,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var E;null!==(E=md.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&md.c.audioEngine.audioContext&&(this._outputAudioNode=md.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(md.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(md.c.audioEngine&&md.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(E){var H;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(H=md.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&E.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==E.soundTrackId&&(-1===E.soundTrackId?this._scene.mainSoundTrack.removeSound(E):this._scene.soundTracks&&this._scene.soundTracks[E.soundTrackId].removeSound(E)),this.soundCollection.push(E),E.soundTrackId=this.id}removeSound(E){const H=this.soundCollection.indexOf(E);-1!==H&&this.soundCollection.splice(H,1)}setVolume(E){var H;null!==(H=md.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=E)}switchPanningModelToHRTF(){var E;if(null!==(E=md.c.audioEngine)&&void 0!==E&&E.canUseWebAudio)for(let H=0;H<this.soundCollection.length;H++)this.soundCollection[H].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var E;if(null!==(E=md.c.audioEngine)&&void 0!==E&&E.canUseWebAudio)for(let H=0;H<this.soundCollection.length;H++)this.soundCollection[H].switchPanningModelToEqualPower()}connectToAnalyser(E){var H;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=E,null!==(H=md.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,md.c.audioEngine.masterGain))}}var Ed=d(12666),Hd=d(12634),dd=d(12234);md.c.AudioEngineFactory=(E,H,d)=>new nd(E,H,d);class nd{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new S.e,this.onAudioLockedObservable=new S.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,dd.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const n=document.createElement("audio");this._hostElement=E,this._audioContext=H,this._audioDestination=d;try{n&&n.canPlayType&&(n.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||n.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(Z){}try{n&&n.canPlayType&&n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(Z){}}lock(){this._triggerSuspendedState()}unlock(){var E,H;if("running"===(null===(E=this._audioContext)||void 0===E?void 0:E.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(H=this._audioContext)||void 0===H||H.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{R.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var E;null===(E=this._audioContext)||void 0===E||E.addEventListener("statechange",(()=>{var E;this.unlocked&&"running"!==(null===(E=this._audioContext)||void 0===E?void 0:E.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var E;return null!==(E=this._audioContext)&&void 0!==E&&E.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(E){this.canUseWebAudio=!1,R.b.Error("Web Audio: "+E.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(E){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const E=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",H=document.createElement("style");H.appendChild(document.createTextNode(E)),document.getElementsByTagName("head")[0].appendChild(H),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var E;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(E=this._audioContext)||void 0===E||E.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(E){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=E)}connectToAnalyser(E){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=E,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Zd=d(12247);(0,d(13782).f)(Ed.e.NAME_AUDIO,((E,H,d,n)=>{let Z,I=[];if(d.bV=d.bV||[],void 0!==E.bV&&null!==E.bV)for(let l=0,r=E.bV.length;l<r;l++){var g;const r=E.bV[l];null!==(g=md.c.audioEngine)&&void 0!==g&&g.canUseWebAudio?(r.url||(r.url=r.name),I[r.url]?d.bV.push(AH.Parse(r,H,n,I[r.url])):(Z=AH.Parse(r,H,n),I[r.url]=Z,d.bV.push(Z))):d.bV.push(new AH(r.name,null,H))}I=[]})),Object.defineProperty(Hd.c.prototype,"mainSoundTrack",{get:function(){let E=this._getComponent(Ed.e.NAME_AUDIO);return E||(E=new Id(this),this.Md(E)),this._mainSoundTrack||(this._mainSoundTrack=new JH(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Hd.c.prototype.getSoundByName=function(E){let H;for(H=0;H<this.mainSoundTrack.soundCollection.length;H++)if(this.mainSoundTrack.soundCollection[H].name===E)return this.mainSoundTrack.soundCollection[H];if(this.soundTracks)for(let d=0;d<this.soundTracks.length;d++)for(H=0;H<this.soundTracks[d].soundCollection.length;H++)if(this.soundTracks[d].soundCollection[H].name===E)return this.soundTracks[d].soundCollection[H];return null},Object.defineProperty(Hd.c.prototype,"audioEnabled",{get:function(){let E=this._getComponent(Ed.e.NAME_AUDIO);return E||(E=new Id(this),this.Md(E)),E.audioEnabled},set:function(E){let H=this._getComponent(Ed.e.NAME_AUDIO);H||(H=new Id(this),this.Md(H)),E?H.enableAudio():H.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Hd.c.prototype,"headphone",{get:function(){let E=this._getComponent(Ed.e.NAME_AUDIO);return E||(E=new Id(this),this.Md(E)),E.headphone},set:function(E){let H=this._getComponent(Ed.e.NAME_AUDIO);H||(H=new Id(this),this.Md(H)),E?H.switchAudioModeForHeadphones():H.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Hd.c.prototype,"audioListenerPositionProvider",{get:function(){let E=this._getComponent(Ed.e.NAME_AUDIO);return E||(E=new Id(this),this.Md(E)),E.audioListenerPositionProvider},set:function(E){let H=this._getComponent(Ed.e.NAME_AUDIO);if(H||(H=new Id(this),this.Md(H)),E&&"function"!==typeof E)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");H.audioListenerPositionProvider=E},enumerable:!0,configurable:!0}),Object.defineProperty(Hd.c.prototype,"audioListenerRotationProvider",{get:function(){let E=this._getComponent(Ed.e.NAME_AUDIO);return E||(E=new Id(this),this.Md(E)),E.audioListenerRotationProvider},set:function(E){let H=this._getComponent(Ed.e.NAME_AUDIO);if(H||(H=new Id(this),this.Md(H)),E&&"function"!==typeof E)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");H.audioListenerRotationProvider=E},enumerable:!0,configurable:!0}),Object.defineProperty(Hd.c.prototype,"audioPositioningRefreshRate",{get:function(){let E=this._getComponent(Ed.e.NAME_AUDIO);return E||(E=new Id(this),this.Md(E)),E.audioPositioningRefreshRate},set:function(E){let H=this._getComponent(Ed.e.NAME_AUDIO);H||(H=new Id(this),this.Md(H)),H.audioPositioningRefreshRate=E},enumerable:!0,configurable:!0});class Id{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(E){this.name=Ed.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new Z.wH,this._cachedCameraPosition=new Z.wH,this._lastCheck=0,this._invertMatrixTemp=new Z.Matrix,this._cameraDirectionTemp=new Z.wH,(E=E||w.b.LastCreatedScene)&&(this.QH=E,E.soundTracks=[],E.bV=[])}register(){this.QH._afterRenderStage.registerStep(Ed.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(E){if(E.bV=[],this.QH.soundTracks)for(let H=0;H<this.QH.soundTracks.length;H++){const d=this.QH.soundTracks[H];for(let H=0;H<d.soundCollection.length;H++)E.bV.push(d.soundCollection[H].serialize())}}addFromContainer(E){if(E.bV)for(const H of E.bV)H.play(),H.autoplay=!0,this.QH.mainSoundTrack.addSound(H)}removeFromContainer(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(E.bV)for(const d of E.bV)d.stop(),d.autoplay=!1,this.QH.mainSoundTrack.removeSound(d),H&&d.dispose()}dispose(){const E=this.QH;if(E._mainSoundTrack&&E.mainSoundTrack.dispose(),E.soundTracks)for(let H=0;H<E.soundTracks.length;H++)E.soundTracks[H].dispose()}disableAudio(){const E=this.QH;let H;for(this._audioEnabled=!1,md.c.audioEngine&&md.c.audioEngine.audioContext&&md.c.audioEngine.audioContext.suspend(),H=0;H<E.mainSoundTrack.soundCollection.length;H++)E.mainSoundTrack.soundCollection[H].pause();if(E.soundTracks)for(H=0;H<E.soundTracks.length;H++)for(let d=0;d<E.soundTracks[H].soundCollection.length;d++)E.soundTracks[H].soundCollection[d].pause()}enableAudio(){const E=this.QH;let H;for(this._audioEnabled=!0,md.c.audioEngine&&md.c.audioEngine.audioContext&&md.c.audioEngine.audioContext.resume(),H=0;H<E.mainSoundTrack.soundCollection.length;H++)E.mainSoundTrack.soundCollection[H].isPaused&&E.mainSoundTrack.soundCollection[H].play();if(E.soundTracks)for(H=0;H<E.soundTracks.length;H++)for(let d=0;d<E.soundTracks[H].soundCollection.length;d++)E.soundTracks[H].soundCollection[d].isPaused&&E.soundTracks[H].soundCollection[d].play()}switchAudioModeForHeadphones(){const E=this.QH;if(this._headphone=!0,E.mainSoundTrack.switchPanningModelToHRTF(),E.soundTracks)for(let H=0;H<E.soundTracks.length;H++)E.soundTracks[H].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const E=this.QH;if(this._headphone=!1,E.mainSoundTrack.switchPanningModelToEqualPower(),E.soundTracks)for(let H=0;H<E.soundTracks.length;H++)E.soundTracks[H].switchPanningModelToEqualPower()}_afterRender(){const E=Zd.b.Now;if(this._lastCheck&&E-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=E;const H=this.QH;if(!this._audioEnabled||!H._mainSoundTrack||!H.soundTracks||0===H._mainSoundTrack.soundCollection.length&&1===H.soundTracks.length)return;const d=md.c.audioEngine;if(d&&d.audioContext){let E,n=H.activeCamera;if(H.activeCameras&&H.activeCameras.length>0&&(n=H.activeCameras[0]),this.audioListenerPositionProvider){const E=this.audioListenerPositionProvider();d.audioContext.listener.setPosition(E.x||0,E.y||0,E.z||0)}else n?this._cachedCameraPosition.equals(n.globalPosition)||(this._cachedCameraPosition.l(n.globalPosition),d.audioContext.listener.setPosition(n.globalPosition.x,n.globalPosition.y,n.globalPosition.z)):d.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const E=this.audioListenerRotationProvider();d.audioContext.listener.setOrientation(E.x||0,E.y||0,E.z||0,0,1,0)}else n?(n.rigCameras&&n.rigCameras.length>0&&(n=n.rigCameras[0]),n.getViewMatrix().invertToRef(this._invertMatrixTemp),Z.wH.TransformNormalToRef(Id._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.l(this._cameraDirectionTemp),d.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):d.audioContext.listener.setOrientation(0,0,0,0,1,0);for(E=0;E<H.mainSoundTrack.soundCollection.length;E++){const d=H.mainSoundTrack.soundCollection[E];d.useCustomAttenuation&&d.updateDistanceFromListener()}if(H.soundTracks)for(E=0;E<H.soundTracks.length;E++)for(let d=0;d<H.soundTracks[E].soundCollection.length;d++){const n=H.soundTracks[E].soundCollection[d];n.useCustomAttenuation&&n.updateDistanceFromListener()}}}}Id._CameraDirection=new Z.wH(0,0,-1),AH._SceneComponentInitialization=E=>{let H=E._getComponent(Ed.e.NAME_AUDIO);H||(H=new Id(E),E.Md(H))};const gd="MSFT_audio_emitter";class ld{constructor(E){this.name=gd,this._loader=E,this.enabled=this._loader.isExtensionUsed(gd)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const E=this._loader.jd.extensions;if(E&&E[this.name]){const H=E[this.name];this._clips=H.clips,this._emitters=H.emitters,b.Assign(this._clips),b.Assign(this._emitters)}}loadSceneAsync(E,H){return y.LoadExtensionAsync(E,H,this.name,(async(d,n)=>{const Z=new Array;Z.push(this._loader.loadSceneAsync(E,H));for(const E of n.emitters){const H=b.Get(`${d}/emitters`,this._emitters,E);if(void 0!=H.refDistance||void 0!=H.maxDistance||void 0!=H.rolloffFactor||void 0!=H.distanceModel||void 0!=H.innerAngle||void 0!=H.outerAngle)throw new Error(`${d}: Direction or Distance properties are not allowed on emitters attached to a scene`);Z.push(this._loadEmitterAsync(`${d}/emitters/${H.index}`,H))}await Promise.all(Z)}))}loadNodeAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(E,n)=>{const I=new Array,l=await this._loader.loadNodeAsync(E,H,(H=>{for(const d of n.emitters){const n=b.Get(`${E}/emitters`,this._emitters,d);I.push(this._loadEmitterAsync(`${E}/emitters/${n.index}`,n).then((()=>{for(const E of n._babylonSounds)E.attachToMesh(H),void 0==n.innerAngle&&void 0==n.outerAngle||(E.setLocalDirectionToMesh(Z.wH.Forward()),E.setDirectionalCone(2*g.Tools.ToDegrees(void 0==n.innerAngle?Math.PI:n.innerAngle),2*g.Tools.ToDegrees(void 0==n.outerAngle?Math.PI:n.outerAngle),0))})))}d(H)}));return await Promise.all(I),l}))}loadAnimationAsync(E,H){return y.LoadExtensionAsync(E,H,this.name,(async(d,n)=>{const Z=await this._loader.loadAnimationAsync(E,H),I=new Array;b.Assign(n.events);for(const g of n.events)I.push(this._loadAnimationEventAsync(`${d}/events/${g.index}`,E,H,g,Z));return await Promise.all(I),Z}))}_loadClipAsync(E,H){if(H._objectURL)return H._objectURL;let d;if(H.uri)d=this._loader.loadUriAsync(E,H,H.uri);else{const n=b.Get(`${E}/bufferView`,this._loader.jd.bufferViews,H.bufferView);d=this._loader.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}return H._objectURL=d.then((E=>URL.createObjectURL(new Blob([E],{type:H.mimeType})))),H._objectURL}_loadEmitterAsync(E,H){if(H._babylonSounds=H._babylonSounds||[],!H._babylonData){const E=new Array,d=H.name||`emitter${H.index}`,n={loop:!1,autoplay:!1,volume:void 0==H.volume?1:H.volume};for(let I=0;I<H.clips.length;I++){const Z=`/extensions/${this.name}/clips`,g=b.Get(Z,this._clips,H.clips[I].clip);E.push(this._loadClipAsync(`${Z}/${H.clips[I].clip}`,g).then((E=>{const Z=H._babylonSounds[I]=new AH(d,E,this._loader.babylonScene,null,n);Z.refDistance=H.refDistance||1,Z.maxDistance=H.maxDistance||256,Z.rolloffFactor=H.rolloffFactor||1,Z.distanceModel=H.distanceModel||"exponential"})))}const Z=Promise.all(E).then((()=>{const E=H.clips.map((E=>E.weight||1)),d=new BH(H.loop||!1,H._babylonSounds,E);H.innerAngle&&(d.directionalConeInnerAngle=2*g.Tools.ToDegrees(H.innerAngle)),H.outerAngle&&(d.directionalConeOuterAngle=2*g.Tools.ToDegrees(H.outerAngle)),H.volume&&(d.volume=H.volume),H._babylonData.sound=d}));H._babylonData={loaded:Z}}return H._babylonData.loaded}_getEventAction(E,H,d,n,Z){switch(d){case"play":return E=>{const d=(Z||0)+(E-n);H.play(d)};case"stop":return()=>{H.stop()};case"pause":return()=>{H.pause()};default:throw new Error(`${E}: Unsupported action ${d}`)}}_loadAnimationEventAsync(E,H,d,n,Z){if(0==Z.targetedAnimations.length)return Promise.resolve();const I=Z.targetedAnimations[0],g=n.nH,l=b.Get(`/extensions/${this.name}/emitters`,this._emitters,g);return this._loadEmitterAsync(E,l).then((()=>{const H=l._babylonData.sound;if(H){const d=new KH(n.time,this._getEventAction(E,H,n.action,n.time,n.startOffset));I.animation.addEvent(d),Z.onAnimationGroupEndObservable.add((()=>{H.stop()})),Z.onAnimationGroupPauseObservable.add((()=>{H.pause()}))}}))}}O(gd),k(gd,!0,(E=>new ld(E)));const rd="MSFT_lod";class td{constructor(E){var H;this.name=rd,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new S.e,this.onMaterialLODsLoadedObservable=new S.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=E,this.maxLODsToLoad=(null===(H=this._loader.parent.extensionOptions[rd])||void 0===H?void 0:H.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(rd)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let E=0;E<this._nodePromiseLODs.length;E++){const H=Promise.all(this._nodePromiseLODs[E]).then((()=>{0!==E&&(this._loader.endPerformanceCounter(`Node LOD ${E}`),this._loader.log(`Loaded node LOD ${E}`)),this.onNodeLODsLoadedObservable.notifyObservers(E),E!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${E+1}`),this._loadBufferLOD(this._nodeBufferLODs,E+1),this._nodeSignalLODs[E]&&this._nodeSignalLODs[E].resolve())}));this._loader._completePromises.push(H)}for(let E=0;E<this._materialPromiseLODs.length;E++){const H=Promise.all(this._materialPromiseLODs[E]).then((()=>{0!==E&&(this._loader.endPerformanceCounter(`Material LOD ${E}`),this._loader.log(`Loaded material LOD ${E}`)),this.onMaterialLODsLoadedObservable.notifyObservers(E),E!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${E+1}`),this._loadBufferLOD(this._materialBufferLODs,E+1),this._materialSignalLODs[E]&&this._materialSignalLODs[E].resolve())}));this._loader._completePromises.push(H)}}loadSceneAsync(E,H){const d=this._loader.loadSceneAsync(E,H);return this._loadBufferLOD(this._bufferLODs,0),d}loadNodeAsync(E,H,d){return y.LoadExtensionAsync(E,H,this.name,(async(E,Z)=>{let I;const g=this._getLODs(E,H,this._loader.jd.nodes,Z.ids);this._loader.logOpen(`${E}`);for(let H=0;H<g.length;H++){const E=g[H];0!==H&&(this._nodeIndexLOD=H,this._nodeSignalLODs[H]=this._nodeSignalLODs[H]||new n);const Z=E=>{d(E),E.Bl(!1)},l=this._loader.loadNodeAsync(`/nodes/${E.index}`,E,Z).then((E=>{if(0!==H){const E=g[H-1];E._babylonTransformNode&&(this._disposeTransformNode(E._babylonTransformNode),delete E._babylonTransformNode)}return E.Bl(!0),E}));this._nodePromiseLODs[H]=this._nodePromiseLODs[H]||[],0===H?I=l:(this._nodeIndexLOD=null,this._nodePromiseLODs[H].push(l))}return this._loader.logClose(),await I}))}_loadMaterialAsync(E,H,d,n,Z){return this._nodeIndexLOD?null:y.LoadExtensionAsync(E,H,this.name,(async(E,I)=>{let g;const l=this._getLODs(E,H,this._loader.jd.materials,I.ids);this._loader.logOpen(`${E}`);for(let H=0;H<l.length;H++){const E=l[H];0!==H&&(this._materialIndexLOD=H);const I=this._loader._loadMaterialAsync(`/materials/${E.index}`,E,d,n,(E=>{0===H&&Z(E)})).then((E=>{if(0!==H){Z(E);const d=l[H-1]._data;d[n]&&(this._disposeMaterials([d[n].babylonMaterial]),delete d[n])}return E}));this._materialPromiseLODs[H]=this._materialPromiseLODs[H]||[],0===H?g=I:(this._materialIndexLOD=null,this._materialPromiseLODs[H].push(I))}return this._loader.logClose(),await g}))}_loadUriAsync(E,H,d){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const Z=this._nodeIndexLOD-1;return this._nodeSignalLODs[Z]=this._nodeSignalLODs[Z]||new n,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(E,H,d)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const Z=this._materialIndexLOD-1;return this._materialSignalLODs[Z]=this._materialSignalLODs[Z]||new n,this._materialSignalLODs[Z].promise.then((async()=>await this._loader.loadUriAsync(E,H,d)))}return null}loadBufferAsync(E,H,d,Z){if(this._loader.parent.useRangeRequests&&!H.uri){if(!this._loader.bin)throw new Error(`${E}: Uri is missing or the binary glTF is missing its binary chunk`);const H=async(E,H)=>{const I=d,g=I+Z-1;let l=E[H];return l?(l.start=Math.min(l.start,I),l.end=Math.max(l.end,g)):(l={start:I,end:g,loaded:new n},E[H]=l),await l.loaded.promise.then((E=>new Uint8Array(E.buffer,E.byteOffset+d-l.start,Z)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?H(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?H(this._materialBufferLODs,this._materialIndexLOD):H(this._bufferLODs,0)}return null}_loadBufferLOD(E,H){const d=E[H];d&&(this._loader.log(`Loading buffer range [${d.start}-${d.end}]`),this._loader.bin.readAsync(d.start,d.end-d.start+1).then((E=>{d.loaded.resolve(E)}),(E=>{d.loaded.reject(E)})))}_getLODs(E,H,d,n){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const Z=[];for(let I=n.length-1;I>=0;I--)if(Z.push(b.Get(`${E}/ids/${n[I]}`,d,n[I])),Z.length===this.maxLODsToLoad)return Z;return Z.push(H),Z}_disposeTransformNode(E){const H=[],d=E.material;d&&H.push(d);for(const Z of E.getChildMeshes())Z.material&&H.push(Z.material);E.dispose();const n=H.filter((E=>this._loader.babylonScene.meshes.every((H=>H.material!=E))));this._disposeMaterials(n)}_disposeMaterials(E){const H={};for(const d of E){for(const E of d.getActiveTextures())H[E.uniqueId]=E;d.dispose()}for(const d in H)for(const E of this._loader.babylonScene.materials)E.hasTexture(H[d])&&delete H[d];for(const d in H)H[d].dispose()}}O(rd),k(rd,!0,(E=>new td(E)));const Sd="MSFT_minecraftMesh";class Md{constructor(E){this.name=Sd,this._loader=E,this.enabled=this._loader.isExtensionUsed(Sd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtraAsync(E,H,this.name,(async(n,Z)=>{if(Z){if(!(d instanceof e.c))throw new Error(`${n}: Material type not supported`);const Z=this._loader.loadMaterialPropertiesAsync(E,H,d);return d.needAlphaBlending()&&(d.forceDepthWrite=!0,d.separateCullingPass=!0),d.ln=d.forceDepthWrite,d.twoSidedLighting=!0,await Z}}))}}O(Sd),k(Sd,!0,(E=>new Md(E)));const Vd="MSFT_sRGBFactors";class Cd{constructor(E){this.name=Vd,this._loader=E,this.enabled=this._loader.isExtensionUsed(Vd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(E,H,d){return y.LoadExtraAsync(E,H,this.name,(async(n,Z)=>{if(Z){if(!(d instanceof e.c))throw new Error(`${n}: Material type not supported`);const Z=this._loader.loadMaterialPropertiesAsync(E,H,d),I=d.fE().getEngine().useExactSrgbConversions;return d.albedoTexture||d.albedoColor.toLinearSpaceToRef(d.albedoColor,I),d.reflectivityTexture||d.reflectivityColor.toLinearSpaceToRef(d.reflectivityColor,I),await Z}}))}}O(Vd),k(Vd,!0,(E=>new Cd(E)));var wd=d(14084);const Rd={};var Qd=d(14134),Ld=d(14123),Dd=d(14089),ed=d(14103);function sd(E,H){for(const d of E)for(const E of d.dataOutputs)if(E.uniqueId===H)return E;throw new Error("Could not find data out connection with unique id "+H)}function id(E,H){for(const d of E)if(d instanceof Ld.e)for(const E of d.signalInputs)if(E.uniqueId===H)return E;throw new Error("Could not find signal in connection with unique id "+H)}async function pd(E,H){const n=await Promise.all(E.allBlocks.map((async E=>{const H=function(E){switch(E){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([d.e(78),d.e(79)]).then(d.bind(d,15551))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await d.e(80).then(d.bind(d,15553))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await d.e(81).then(d.bind(d,15558))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await d.e(82).then(d.bind(d,15564))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await d.e(83).then(d.bind(d,15566))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await d.e(84).then(d.bind(d,15575))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await d.e(85).then(d.bind(d,15578))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await d.e(86).then(d.bind(d,15582))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await d.e(87).then(d.bind(d,15589))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await d.e(90).then(d.bind(d,15624))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await d.e(90).then(d.bind(d,15624))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await d.e(90).then(d.bind(d,15624))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await d.e(90).then(d.bind(d,15624))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await d.e(95).then(d.bind(d,15629))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await d.e(96).then(d.bind(d,15635))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await d.e(97).then(d.bind(d,15641))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await d.e(98).then(d.bind(d,15650))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await d.e(99).then(d.bind(d,15656))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await d.e(100).then(d.bind(d,15659))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await d.e(101).then(d.bind(d,15666))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await d.e(102).then(d.bind(d,15668))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await d.e(103).then(d.bind(d,15671))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await d.e(104).then(d.bind(d,15676))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await d.e(105).then(d.bind(d,15679))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await d.e(106).then(d.bind(d,15686))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await d.e(107).then(d.bind(d,15694))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await d.e(108).then(d.bind(d,15699))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await d.e(109).then(d.bind(d,15702))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await d.e(110).then(d.bind(d,15709))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await d.e(111).then(d.bind(d,15716))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await d.e(112).then(d.bind(d,15723))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await d.e(113).then(d.bind(d,15728))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await d.e(92).then(d.bind(d,15736))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await d.e(114).then(d.bind(d,15743))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await d.e(115).then(d.bind(d,15746))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await d.e(116).then(d.bind(d,15748))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await d.e(93).then(d.bind(d,15756))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await d.e(88).then(d.bind(d,15594))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await d.e(94).then(d.bind(d,15758))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await d.e(94).then(d.bind(d,15758))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await d.e(94).then(d.bind(d,15758))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await d.e(94).then(d.bind(d,15758))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await d.e(94).then(d.bind(d,15758))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await d.e(94).then(d.bind(d,15758))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await d.e(94).then(d.bind(d,15758))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await d.e(94).then(d.bind(d,15758))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await d.e(89).then(d.bind(d,15621))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await d.e(90).then(d.bind(d,15624))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await d.e(90).then(d.bind(d,15624))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await d.e(91).then(d.bind(d,15767))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await d.e(91).then(d.bind(d,15767))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await d.e(91).then(d.bind(d,15767))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await d.e(91).then(d.bind(d,15767))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await d.e(91).then(d.bind(d,15767))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await d.e(91).then(d.bind(d,15767))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await d.e(117).then(d.bind(d,15769))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await d.e(118).then(d.bind(d,15774))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await d.e(119).then(d.bind(d,15782))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await d.e(120).then(d.bind(d,15790))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await d.e(121).then(d.bind(d,15795))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await d.e(122).then(d.bind(d,15800))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await d.e(123).then(d.bind(d,15807))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await d.e(124).then(d.bind(d,15810))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await d.e(125).then(d.bind(d,15814))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await d.e(126).then(d.bind(d,15817))).FlowGraphDataSwitchBlock;default:if(Rd[E])return Rd[E];throw new Error(`Unknown block name ${E}`)}}(E.className);return await H()})));return function(E,H,d){const n=H.coordinator.createGraph(),Z=[],I=H.valueParseFunction??Dd.e;for(let g=0;g<E.allBlocks.length;g++){const l=Pd(E.allBlocks[g],{QH:H.coordinator.config.QH,pathConverter:H.pathConverter,assetsContainer:H.coordinator.config.QH,valueParseFunction:I},d[g]);Z.push(l),l instanceof Qd.d&&n.addEventBlock(l)}for(const g of Z){for(const E of g.dataInputs)for(const H of E.connectedPointIds){const d=sd(Z,H);E.connectTo(d)}if(g instanceof Ld.e)for(const E of g.signalOutputs)for(const H of E.connectedPointIds){const d=id(Z,H);E.connectTo(d)}}for(const g of E.executionContexts)fd(g,{graph:n,valueParseFunction:I},E.rightHanded);return n}(E,H,n)}function fd(E,H,d){const n=H.graph.createContext();E.enableLogging&&(n.enableLogging=!0),n.treatDataAsRightHanded=d||!1;const Z=H.valueParseFunction??Dd.e;n.uniqueId=E.uniqueId;const I=n.fE();if(E._assetsContext){var g,l,r,t,S,M,V,C,w,R;const H=E._assetsContext,d={meshes:null===(g=H.meshes)||void 0===g?void 0:g.map((E=>I.getMeshById(E))),lights:null===(l=H.lights)||void 0===l?void 0:l.map((E=>I.getLightByName(E))),cameras:null===(r=H.cameras)||void 0===r?void 0:r.map((E=>I.getCameraByName(E))),materials:null===(t=H.materials)||void 0===t?void 0:t.map((E=>I.getMaterialById(E))),textures:null===(S=H.textures)||void 0===S?void 0:S.map((E=>I.getTextureByName(E))),animations:null===(M=H.animations)||void 0===M?void 0:M.map((E=>I.animations.find((H=>H.name===E)))),skeletons:null===(V=H.skeletons)||void 0===V?void 0:V.map((E=>I.getSkeletonByName(E))),lV:null===(C=H.lV)||void 0===C?void 0:C.map((E=>I.getParticleSystemById(E))),animationGroups:null===(w=H.animationGroups)||void 0===w?void 0:w.map((E=>I.getAnimationGroupByName(E))),transformNodes:null===(R=H.transformNodes)||void 0===R?void 0:R.map((E=>I.getTransformNodeById(E))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],bV:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};n.assetsContext=d}for(const Q in E._userVariables){const H=Z(Q,E._userVariables,n.assetsContext,I);n.userVariables[Q]=H}for(const Q in E._connectionValues){const H=Z(Q,E._connectionValues,n.assetsContext,I);n._setConnectionValueByKey(Q,H)}return n}function Pd(E,H,d){const n={},Z=H.valueParseFunction??Dd.e;if(E.config)for(const g in E.config)n[g]=Z(g,E.config,H.assetsContainer||H.QH,H.QH);if((0,Dd.l)(E.className)){if(!H.pathConverter)throw new Error("Path converter is required for this block");n.pathConverter=H.pathConverter}const I=new d(n);I.uniqueId=E.uniqueId;for(let g=0;g<E.dataInputs.length;g++){const H=I.getDataInput(E.dataInputs[g].name);if(!H)throw new Error("Could not find data input with name "+E.dataInputs[g].name+" in block "+E.className);H.deserialize(E.dataInputs[g])}for(let g=0;g<E.dataOutputs.length;g++){const H=I.getDataOutput(E.dataOutputs[g].name);if(!H)throw new Error("Could not find data output with name "+E.dataOutputs[g].name+" in block "+E.className);H.deserialize(E.dataOutputs[g])}return I.metadata=E.metadata,I.deserialize&&I.deserialize(E),I}function jd(E){const[H,d]=E.split(":");return Xd({op:H,extension:d})}function Xd(E){var H;let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=E.extension?null===(H=Ud[E.extension])||void 0===H?void 0:H[E.op]:Yd[E.op];if(!n&&(R.b.Warn(`No mapping found for operation ${E.op} and extension ${E.extension||"KHR_interactivity"}`),d)){const H={},d={flows:{}};if(E.inputValueSockets){H.values={};for(const d in E.inputValueSockets)H.values[d]={name:d}}return E.outputValueSockets&&(d.values={},Object.keys(E.outputValueSockets).forEach((E=>{d.values[E]={name:E}}))),{XS:[],inputs:H,outputs:d}}return n}function Wd(E,H,d){Ud[H]||(Ud[H]={}),Ud[H][E]=d}const Ud={BABYLON:{"flow/log":{XS:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Yd={"event/onStart":{XS:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{XS:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{XS:["FlowGraphSendCustomEventBlock"],extraProcessor(E,H,d,n,Z){if("event/send"!==H.op||!E.configuration||1!==Object.keys(E.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const I=E.configuration.event.value[0];if("number"!==typeof I)throw new Error("Event id should be a number");const g=n.arrays.events[I],l=Z[0];return l.config||(l.config={}),l.config.eventId=g.eventId,l.config.eventData=g.eventData,Z}},"event/receive":{XS:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(E,H){var d;if(!E.configuration)return R.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const n=E.configuration.event;if(!n)return R.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const Z=n.value[0];if("number"!==typeof Z)return R.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(d=H.events)||void 0===d?void 0:d[Z])?{valid:!0}:(R.b.Error(`Event with id ${Z} not found`),{valid:!1,error:`Event with id ${Z} not found`})},extraProcessor(E,H,d,n,Z){if("event/receive"!==H.op||!E.configuration||1!==Object.keys(E.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const I=E.configuration.event.value[0];if("number"!==typeof I)throw new Error("Event id should be a number");const g=n.arrays.events[I],l=Z[0];return l.config||(l.config={}),l.config.eventId=g.eventId,l.config.eventData=g.eventData,Z}},"math/e":cd("FlowGraphEBlock"),"math/pi":cd("FlowGraphPIBlock"),"math/inf":cd("FlowGraphInfBlock"),"math/nan":cd("FlowGraphNaNBlock"),"math/abs":cd("FlowGraphAbsBlock"),"math/sign":cd("FlowGraphSignBlock"),"math/trunc":cd("FlowGraphTruncBlock"),"math/floor":cd("FlowGraphFloorBlock"),"math/ceil":cd("FlowGraphCeilBlock"),"math/round":{XS:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,H,d,n,Z){var I;return(I=Z[0]).config||(I.config={}),Z[0].config.roundHalfAwayFromZero=!0,Z}},"math/fract":cd("FlowGraphFractBlock"),"math/neg":cd("FlowGraphNegationBlock"),"math/add":cd("FlowGraphAddBlock",["a","b"],!0),"math/sub":cd("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{XS:["FlowGraphMultiplyBlock"],extraProcessor(E,H,d,n,Z){var I;(I=Z[0]).config||(I.config={}),Z[0].config.useMatrixPerComponent=!0,Z[0].config.preventIntegerFloatArithmetic=!0;let g=-1;return Object.keys(E.values||{}).find((H=>{var d;return void 0!==(null===(d=E.values)||void 0===d?void 0:d[H].type)&&(g=E.values[H].type,!0)})),-1!==g&&(Z[0].config.type=n.arrays.types[g].flowGraphType),Z},validation:E=>E.values?ud(E):{valid:!0}},"math/div":cd("FlowGraphDivideBlock",["a","b"],!0),"math/rem":cd("FlowGraphModuloBlock",["a","b"]),"math/min":cd("FlowGraphMinBlock",["a","b"]),"math/max":cd("FlowGraphMaxBlock",["a","b"]),"math/clamp":cd("FlowGraphClampBlock",["a","b","c"]),"math/saturate":cd("FlowGraphSaturateBlock"),"math/mix":cd("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":cd("FlowGraphEqualityBlock",["a","b"]),"math/lt":cd("FlowGraphLessThanBlock",["a","b"]),"math/le":cd("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":cd("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":cd("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":cd("FlowGraphIsNaNBlock"),"math/isinf":cd("FlowGraphIsInfBlock"),"math/select":{XS:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{XS:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":cd("FlowGraphSinBlock"),"math/cos":cd("FlowGraphCosBlock"),"math/tan":cd("FlowGraphTanBlock"),"math/asin":cd("FlowGraphASinBlock"),"math/acos":cd("FlowGraphACosBlock"),"math/atan":cd("FlowGraphATanBlock"),"math/atan2":cd("FlowGraphATan2Block",["a","b"]),"math/sinh":cd("FlowGraphSinhBlock"),"math/cosh":cd("FlowGraphCoshBlock"),"math/tanh":cd("FlowGraphTanhBlock"),"math/asinh":cd("FlowGraphASinhBlock"),"math/acosh":cd("FlowGraphACoshBlock"),"math/atanh":cd("FlowGraphATanhBlock"),"math/exp":cd("FlowGraphExponentialBlock"),"math/log":cd("FlowGraphLogBlock"),"math/log2":cd("FlowGraphLog2Block"),"math/log10":cd("FlowGraphLog10Block"),"math/sqrt":cd("FlowGraphSquareRootBlock"),"math/cbrt":cd("FlowGraphCubeRootBlock"),"math/pow":cd("FlowGraphPowerBlock",["a","b"]),"math/length":cd("FlowGraphLengthBlock"),"math/normalize":cd("FlowGraphNormalizeBlock"),"math/dot":cd("FlowGraphDotBlock",["a","b"]),"math/cross":cd("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":cd("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":cd("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{XS:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{XS:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{XS:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{XS:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{XS:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{XS:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{XS:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":cd("FlowGraphTransposeBlock"),"math/determinant":cd("FlowGraphDeterminantBlock"),"math/inverse":cd("FlowGraphInvertMatrixBlock"),"math/matmul":cd("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{XS:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"mg",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,H,d,n,Z,I){const g=Z[0].dataInputs.find((E=>"rotationQuaternion"===E.name));if(!g)throw new Error("Rotation quaternion input not found");return I._connectionValues[g.uniqueId]&&(I._connectionValues[g.uniqueId].type="Quaternion"),Z}},"math/matDecompose":{XS:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"mg"}}}},"math/quatConjugate":cd("FlowGraphConjugateBlock",["a"]),"math/quatMul":{XS:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,H,d,n,Z){var I;return(I=Z[0]).config||(I.config={}),Z[0].config.type="Quaternion",Z}},"math/quatAngleBetween":cd("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{XS:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":cd("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":cd("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{XS:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,H,d,n,Z){var I;return(I=Z[0]).config||(I.config={}),Z[0].config.inputIsColumnMajor=!0,Z}},"math/extract2x2":{XS:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{XS:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,H,d,n,Z){var I;return(I=Z[0]).config||(I.config={}),Z[0].config.inputIsColumnMajor=!0,Z}},"math/extract3x3":{XS:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{XS:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,H,d,n,Z){var I;return(I=Z[0]).config||(I.config={}),Z[0].config.inputIsColumnMajor=!0,Z}},"math/extract4x4":{XS:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{XS:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,H,d,n,Z,I){var g,l;(l=Z[0]).config||(l.config={});const r=Z[0].dataInputs[0];return Z[0].config.valueType=(null===(g=I._connectionValues[r.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",Z}},"math/and":{XS:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,H,d,n,Z,I){var g,l,r;(r=Z[0]).config||(r.config={});const t=Z[0].dataInputs[0],S=Z[0].dataInputs[1];return Z[0].config.valueType=(null===(g=I._connectionValues[t.uniqueId])||void 0===g?void 0:g.type)??(null===(l=I._connectionValues[S.uniqueId])||void 0===l?void 0:l.type)??"FlowGraphInteger",Z}},"math/or":{XS:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,H,d,n,Z,I){var g,l,r;(r=Z[0]).config||(r.config={});const t=Z[0].dataInputs[0],S=Z[0].dataInputs[1];return Z[0].config.valueType=(null===(g=I._connectionValues[t.uniqueId])||void 0===g?void 0:g.type)??(null===(l=I._connectionValues[S.uniqueId])||void 0===l?void 0:l.type)??"FlowGraphInteger",Z}},"math/xor":{XS:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(E,H,d,n,Z,I){var g,l,r;(r=Z[0]).config||(r.config={});const t=Z[0].dataInputs[0],S=Z[0].dataInputs[1];return Z[0].config.valueType=(null===(g=I._connectionValues[t.uniqueId])||void 0===g?void 0:g.type)??(null===(l=I._connectionValues[S.uniqueId])||void 0===l?void 0:l.type)??"FlowGraphInteger",Z}},"math/asr":cd("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":cd("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":cd("FlowGraphLeadingZerosBlock"),"math/ctz":cd("FlowGraphTrailingZerosBlock"),"math/popcnt":cd("FlowGraphOneBitsCounterBlock"),"math/rad":cd("FlowGraphDegToRadBlock"),"math/deg":cd("FlowGraphRadToDegBlock"),"type/boolToInt":cd("FlowGraphBooleanToInt"),"type/boolToFloat":cd("FlowGraphBooleanToFloat"),"type/intToBool":cd("FlowGraphIntToBoolean"),"type/intToFloat":cd("FlowGraphIntToFloat"),"type/floatToInt":cd("FlowGraphFloatToInt"),"type/floatToBool":cd("FlowGraphFloatToBoolean"),"flow/sequence":{XS:["FlowGraphSequenceBlock"],extraProcessor(E,H,d,n,Z){const I=Z[0];return I.config||(I.config={}),I.config.outputSignalCount=Object.keys(E.flows||[]).length,I.signalOutputs.forEach(((E,H)=>{E.name="out_"+H})),Z}},"flow/branch":{XS:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{XS:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(E){if(E.configuration&&E.configuration.cases){const H=E.configuration.cases.value;if(!H.every((E=>"number"===typeof E&&/^-?\d+$/.test(E.toString()))))return R.b.Warn("Switch cases should be integers. Using empty array instead."),E.configuration.cases.value=[],{valid:!0};const d=new Set(H);E.configuration.cases.value=Array.from(d)}return{valid:!0}},extraProcessor(E,H,d,n,Z){if("flow/switch"!==H.op||!E.flows||0===Object.keys(E.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return Z[0].signalOutputs.forEach((E=>{"default"!==E.name&&(E.name="out_"+E.name)})),Z}},"flow/while":{XS:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{XS:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(E,H,d,n,Z){const I=Z[0];return I.config||(I.config={}),I.config.incrementIndexWhenLoopDone=!0,Z}},"flow/doN":{XS:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{XS:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(E,H,d,n,Z){if("flow/multiGate"!==H.op||!E.flows||0===Object.keys(E.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const I=Z[0];return I.config||(I.config={}),I.config.outputSignalCount=Object.keys(E.flows).length,I.signalOutputs.forEach(((E,H)=>{E.name="out_"+H})),Z}},"flow/waitAll":{XS:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(E){var H,d;return"number"!==typeof(null===(H=E.configuration)||void 0===H||null===(d=H.inputFlows)||void 0===d?void 0:d.value[0])&&(E.configuration=E.configuration||{inputFlows:{value:[0]}},E.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{XS:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{XS:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{XS:["FlowGraphCancelDelayBlock"]},"variable/get":{XS:["FlowGraphGetVariableBlock"],validation(E){var H,d;return null!==(H=E.configuration)&&void 0!==H&&null!==(d=H.variable)&&void 0!==d&&d.value?{valid:!0}:(R.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(E,H)=>[H.getVariableName(E[0])]}}},"variable/set":{XS:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(E,H)=>[H.getVariableName(E[0])]}}},"variable/setMultiple":{XS:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(E,H)=>[E[0].map((E=>H.getVariableName(E)))]}},extraProcessor:(E,H,d,n,Z)=>(Z[0].dataInputs.forEach((E=>{E.name=n.getVariableName(+E.name)})),Z)},"variable/interpolate":{XS:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(E,H)=>[H.getVariableName(E[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:E=>!0===E[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Fd:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Fd:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Fd:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Fd:"FlowGraphPlayAnimationBlock"},out:{name:"out",Fd:"FlowGraphPlayAnimationBlock"},done:{name:"done",Fd:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(E,H,d,n,Z){var I,g,l;const r=Z[0],t=null===(I=E.configuration)||void 0===I?void 0:I.variable.value[0];if("number"!==typeof t)throw R.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const S=n.arrays.staticVariables[t];"undefined"===typeof r.config.animationType.value&&(n.arrays.staticVariables,r.config.animationType.value=(0,ed.H)(S.type));const M=Z[4];return M.config||(M.config={}),(g=M.config).variable||(g.variable={}),M.config.variable.value=n.getVariableName(t),(l=Z[3]).config||(l.config={}),Z}},"pointer/get":{XS:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Fd:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Fd:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(E,H,d,n,Z)=>(Z.forEach((E=>{"FlowGraphJsonPointerParserBlock"===E.className&&(E.config||(E.config={}),E.config.outputValue=!0)})),Z)},"pointer/set":{XS:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Fd:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Fd:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(E,H,d,n,Z)=>(Z.forEach((E=>{"FlowGraphJsonPointerParserBlock"===E.className&&(E.config||(E.config={}),E.config.outputValue=!0)})),Z)},"pointer/interpolate":{XS:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Fd:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Fd:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Fd:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Fd:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Fd:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Fd:"FlowGraphPlayAnimationBlock"},out:{name:"out",Fd:"FlowGraphPlayAnimationBlock"},done:{name:"done",Fd:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(E,H,d,n,Z)=>(Z.forEach((H=>{"FlowGraphJsonPointerParserBlock"===H.className?(H.config||(H.config={}),H.config.outputValue=!0):"FlowGraphInterpolationBlock"===H.className&&(H.config||(H.config={}),Object.keys(E.values||[]).forEach((d=>{var Z;const I=null===(Z=E.values)||void 0===Z?void 0:Z[d];if("value"===d&&I){const E=I.type;void 0!==E&&(H.config.animationType=n.arrays.types[E].flowGraphType)}})))})),Z)},"animation/start":{XS:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Fd:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(E,H)=>[E[0]*H._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(E,H)=>[E[0]*H._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(E,H,d,n,Z,I,g){const l=Z[Z.length-1];return l.config||(l.config={}),l.config.glTF=g,Z}},"animation/stop":{XS:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Fd:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(E,H,d,n,Z,I,g){const l=Z[Z.length-1];return l.config||(l.config={}),l.config.glTF=g,Z}},"animation/stopAt":{XS:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Fd:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(E,H)=>[E[0]*H._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(E,H,d,n,Z,I,g){const l=Z[Z.length-1];return l.config||(l.config={}),l.config.glTF=g,Z}},"math/switch":{XS:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(E){if(E.configuration&&E.configuration.cases){const H=E.configuration.cases.value;if(!H.every((E=>"number"===typeof E&&/^-?\d+$/.test(E.toString()))))return R.b.Warn("Switch cases should be integers. Using empty array instead."),E.configuration.cases.value=[],{valid:!0};const d=new Set(H);E.configuration.cases.value=Array.from(d)}return{valid:!0}},extraProcessor(E,H,d,n,Z){const I=Z[0];return I.dataInputs.forEach((E=>{"default"!==E.name&&"case"!==E.name&&(E.name="in_"+E.name)})),I.config||(I.config={}),I.config.treatCasesAsIntegers=!0,Z}},"debug/log":{XS:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function cd(E){let H=arguments.length>2?arguments[2]:void 0;return{XS:[E],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((E,H)=>(E[H]={name:H},E)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(E,d,n,Z,I){var g;if(H){(g=I[0]).config||(g.config={}),I[0].config.preventIntegerFloatArithmetic=!0;let H=-1;Object.keys(E.values||{}).find((d=>{var n;return void 0!==(null===(n=E.values)||void 0===n?void 0:n[d].type)&&(H=E.values[d].type,!0)})),-1!==H&&(I[0].config.type=Z.arrays.types[H].flowGraphType)}return I},validation:E=>H?ud(E):{valid:!0}}}function ud(E){if(E.values){const H=Object.keys(E.values).map((H=>E.values[H].type)).filter((E=>void 0!==E));if(!H.every((E=>E===H[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Yd["math/compose"]=Yd["math/matCompose"],Yd["math/decompose"]=Yd["math/matDecompose"];var od=d(12350);const Fd={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"wH",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class ad{constructor(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=E,this._gltf=H,this._animationTargetFps=d,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const E of this._interactivityGraph.types)this._types.push(Fd[E.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const E of this._interactivityGraph.declarations){const H=Xd(E);if(!H)throw R.b.Error(["No mapping found for declaration",E]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:H,fullOperationName:E.extension?E.op+":"+E.extension:E.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const E of this._interactivityGraph.variables){const H=this._parseVariable(E);this._staticVariables.push(H)}}_parseVariable(E,H){const d=this._types[E.type];if(!d)throw R.b.Error(["No type found for variable",E]),new Error("Error parsing variables");if(E.value&&E.value.length!==d.length)throw R.b.Error(["Invalid value length for variable",E,d]),new Error("Error parsing variables");const n=E.value||[];if(!n.length)switch(d.flowGraphType){case"boolean":n.push(!1);break;case"FlowGraphInteger":n.push(0);break;case"number":n.push(NaN);break;case"Vector2":n.push(NaN,NaN);break;case"wH":n.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":n.fill(NaN,0,4);break;case"Matrix":n.fill(NaN,0,16);break;case"Matrix3D":n.fill(NaN,0,9)}return"number"===d.elementType&&"string"===typeof n[0]&&(n[0]=parseFloat(n[0])),{type:d.flowGraphType,value:H?H(n,this):n}}_parseEvents(){if(this._interactivityGraph.events)for(const E of this._interactivityGraph.events){const H={eventId:E.id||"internalEvent_"+this._internalEventsCounter++};E.values&&(H.eventData=Object.keys(E.values).map((H=>{var d;const n=null===(d=E.values)||void 0===d?void 0:d[H];if(!n)throw R.b.Error(["No value found for event key",H]),new Error("Error parsing events");const Z=this._types[n.type];if(!Z)throw R.b.Error(["No type found for event value",n]),new Error("Error parsing events");const I="undefined"!==typeof n.value?this._parseVariable(n):void 0;return{id:H,type:Z.flowGraphType,eventData:!0,value:I}}))),this._events.push(H)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const H of this._interactivityGraph.nodes){if("number"!==typeof H.declaration)throw R.b.Error(["No declaration found for node",H]),new Error("Error parsing nodes");const d=this._mappings[H.declaration];if(!d)throw R.b.Error(["No mapping found for node",H]),new Error("Error parsing nodes");if(d.flowGraphMapping.validation){const n=d.flowGraphMapping.validation(H,this._interactivityGraph,this._gltf);var E;if(!n.valid)throw new Error(`Error validating interactivity node ${null===(E=this._interactivityGraph.declarations)||void 0===E?void 0:E[H.declaration].op} - ${n.error}`)}const n=[];for(const E of d.flowGraphMapping.XS){const Z=this._getEmptyBlock(E,d.fullOperationName);this._parseNodeConfiguration(H,Z,d.flowGraphMapping,E),n.push(Z)}this._nodes.push({XS:n,fullOperationName:d.fullOperationName})}}_getEmptyBlock(E,H){return{uniqueId:(0,od.e)(),className:E,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:H,metadata:{}}}_parseNodeConfiguration(E,H,d,n){const Z=H.config;if(E.configuration){const H=Object.keys(E.configuration);for(const l of H){var I,g;const H=null===(I=E.configuration)||void 0===I?void 0:I[l];if(!H)throw R.b.Error(["No value found for node configuration",l]),new Error("Error parsing node configuration");const r=null===(g=d.configuration)||void 0===g?void 0:g[l];if(r&&r.Fd?r.Fd===n:0===d.XS.indexOf(n)){const E=(null===r||void 0===r?void 0:r.name)||l;H&&"undefined"!==typeof H.value||"undefined"===typeof(null===r||void 0===r?void 0:r.defaultValue)?H.value.length>=0?Z[E]={value:1===H.value.length?H.value[0]:H.value}:R.b.Warn(["Invalid value for node configuration",H]):Z[E]={value:r.defaultValue},r&&r.dataTransformer&&(Z[E].value=r.dataTransformer([Z[E].value],this)[0])}}}}_parseNodeConnections(E){for(let p=0;p<this._nodes.length;p++){var H;const f=null===(H=this._interactivityGraph.nodes)||void 0===H?void 0:H[p];if(!f)throw R.b.Error(["No node found for interactivity node",this._nodes[p]]),new Error("Error parsing node connections");const P=this._nodes[p],j=this._mappings[f.declaration];if(!j)throw R.b.Error(["No mapping found for node",f]),new Error("Error parsing node connections");const X=f.flows||{},W=Object.keys(X).sort();for(const E of W){var d,n,Z,I;const H=X[E],t=null===(d=j.flowGraphMapping.outputs)||void 0===d||null===(n=d.flows)||void 0===n?void 0:n[E],S=(null===t||void 0===t?void 0:t.name)||E,M=this._createNewSocketConnection(S,!0);(t&&t.Fd&&P.XS.find((E=>E.className===t.Fd))||P.XS[0]).signalOutputs.push(M);const V=H.node,C=this._nodes[V];if(!C)throw R.b.Error(["No node found for input node id",V]),new Error("Error parsing node connections");const w=jd(C.fullOperationName);if(!w)throw R.b.Error(["No mapping found for input node",C]),new Error("Error parsing node connections");let Q=null===(Z=w.inputs)||void 0===Z||null===(I=Z.flows)||void 0===I?void 0:I[H.socket||"in"],L=!1;if(!Q)for(const E in null===(g=w.inputs)||void 0===g?void 0:g.flows){var g,l,r;if(E.startsWith("[")&&E.endsWith("]"))L=!0,Q=null===(l=w.inputs)||void 0===l||null===(r=l.flows)||void 0===r?void 0:r[E]}const D=Q?L?Q.name.replace("$1",H.socket||""):Q.name:H.socket||"in",e=Q&&Q.Fd&&C.XS.find((E=>E.className===Q.Fd))||C.XS[0];let s=e.signalInputs.find((E=>E.name===D));s||(s=this._createNewSocketConnection(D),e.signalInputs.push(s)),s.connectedPointIds.push(M.uniqueId),M.connectedPointIds.push(s.uniqueId)}const U=f.values||{},Y=Object.keys(U);for(const H of Y){var t,S;const d=U[H];let n=null===(t=j.flowGraphMapping.inputs)||void 0===t||null===(S=t.values)||void 0===S?void 0:S[H],Z=!1;if(!n)for(const E in null===(M=j.flowGraphMapping.inputs)||void 0===M?void 0:M.values){var M,V,C;if(E.startsWith("[")&&E.endsWith("]"))Z=!0,n=null===(V=j.flowGraphMapping.inputs)||void 0===V||null===(C=V.values)||void 0===C?void 0:C[E]}const I=n?Z?n.name.replace("$1",H):n.name:H,g=this._createNewSocketConnection(I);if((n&&n.Fd&&P.XS.find((E=>E.className===n.Fd))||P.XS[0]).dataInputs.push(g),void 0!==d.value){const H=this._parseVariable(d,n&&n.dataTransformer);E._connectionValues[g.uniqueId]=H}else{if("undefined"===typeof d.node)throw R.b.Error(["Invalid value for value connection",d]),new Error("Error parsing node connections");{var w,Q,L;const E=d.node,H=d.socket||"value",n=this._nodes[E];if(!n)throw R.b.Error(["No node found for output socket reference",d]),new Error("Error parsing node connections");const Z=jd(n.fullOperationName);if(!Z)throw R.b.Error(["No mapping found for output socket reference",d]),new Error("Error parsing node connections");let I=null===(w=Z.outputs)||void 0===w||null===(Q=w.values)||void 0===Q?void 0:Q[H],l=!1;if(!I)for(const d in null===(D=Z.outputs)||void 0===D?void 0:D.values){var D,e,s;if(d.startsWith("[")&&d.endsWith("]"))l=!0,I=null===(e=Z.outputs)||void 0===e||null===(s=e.values)||void 0===s?void 0:s[d]}const r=I?l?I.name.replace("$1",H):null===(L=I)||void 0===L?void 0:L.name:H,t=I&&I.Fd&&n.XS.find((E=>E.className===I.Fd))||n.XS[0];let S=t.dataOutputs.find((E=>E.name===r));S||(S=this._createNewSocketConnection(r,!0),t.dataOutputs.push(S)),g.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(g.uniqueId)}}}if(j.flowGraphMapping.interBlockConnectors)for(const E of j.flowGraphMapping.interBlockConnectors){const H=E.input,d=E.output,n=E.isVariable;this._connectFlowGraphNodes(H,d,P.XS[E.inputBlockIndex],P.XS[E.outputBlockIndex],n)}if(j.flowGraphMapping.extraProcessor){var i;const H=null===(i=this._interactivityGraph.declarations)||void 0===i?void 0:i[f.declaration];if(!H)throw R.b.Error(["No declaration found for extra processor",f]),new Error("Error parsing node connections");P.XS=j.flowGraphMapping.extraProcessor(f,H,j.flowGraphMapping,this,P.XS,E,this._gltf)}}}_createNewSocketConnection(E,H){return{uniqueId:(0,od.e)(),name:E,_connectionType:H?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(E,H,d,n,Z){const I=Z?d.dataInputs:d.signalInputs,g=Z?n.dataOutputs:n.signalOutputs,l=I.find((H=>H.name===E))||this._createNewSocketConnection(E),r=g.find((E=>E.name===H))||this._createNewSocketConnection(H,!0);I.find((H=>H.name===E))||I.push(l),g.find((E=>E.name===H))||g.push(r),l.connectedPointIds.push(r.uniqueId),r.connectedPointIds.push(l.uniqueId)}getVariableName(E){return"staticVariable_"+E}serializeToFlowGraph(){const E={uniqueId:(0,od.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(E);for(let H=0;H<this._staticVariables.length;H++){const d=this._staticVariables[H];E._userVariables[this.getVariableName(H)]=d}return{rightHanded:!0,allBlocks:this._nodes.reduce(((E,H)=>E.concat(H.XS)),[]),executionContexts:[E]}}}const kd="KHR_interactivity";class Od{constructor(E){this._loader=E,this.name=kd,this.enabled=this._loader.isExtensionUsed(kd),this._pathConverter=(0,G.e)(this._loader.jd),E._skipStartAnimationStep=!0;const H=E.babylonScene;H&&function(E){(0,G.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!E.activeCamera)return new Z.Quaternion(NaN,NaN,NaN,NaN);const H=Z.Quaternion.FromRotationMatrix(E.activeCamera.getWorldMatrix()).normalize();return E.useRightHandedSystem||(H.w*=-1,H.x*=-1),H},type:"Quaternion",getTarget:()=>E.activeCamera}),(0,G.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!E.activeCamera)return new Z.wH(NaN,NaN,NaN);const H=E.activeCamera.getWorldMatrix().getTranslation();return E.useRightHandedSystem||(H.x*=-1),H},type:"wH",getTarget:()=>E.activeCamera}),(0,G.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:E=>{var H;return(null===(H=E._babylonAnimationGroup)||void 0===H?void 0:H.isPlaying)??!1},type:"boolean",getTarget:E=>E._babylonAnimationGroup}),(0,G.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:E=>{var H;return((null===(H=E._babylonAnimationGroup)||void 0===H?void 0:H.from)??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup}),(0,G.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:E=>{var H;return((null===(H=E._babylonAnimationGroup)||void 0===H?void 0:H.to)??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup}),(0,G.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:E=>{var H;return((null===(H=E._babylonAnimationGroup)||void 0===H?void 0:H.getCurrentFrame())??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup}),(0,G.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:E=>{var H;return((null===(H=E._babylonAnimationGroup)||void 0===H?void 0:H.getCurrentFrame())??0)/60},type:"number",getTarget:E=>E._babylonAnimationGroup})}(H)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var E;if(!this._loader.babylonScene||!this._pathConverter)return;const H=this._loader.babylonScene,d=null===(E=this._loader.jd.extensions)||void 0===E?void 0:E.KHR_interactivity;if(!d)return;const n=new wd.b({QH:H});n.dispatchEventsSynchronously=!1;const Z=d.graphs.map((E=>new ad(E,this._loader.jd,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(Z.map((async E=>await pd(E,{coordinator:n,pathConverter:this._pathConverter})))),n.start()}}var Gd;Gd=async()=>(await Promise.resolve().then(d.bind(d,14142))).FlowGraphGLTFDataProvider,Rd[`${kd}/${"FlowGraphGLTFDataProvider"}`]=Gd,O(kd),k(kd,!0,(E=>new Od(E)));const xd="KHR_node_visibility";(0,G.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:E=>{const H=E._babylonTransformNode;return!H||void 0===H.isVisible||H.isVisible},set:(E,H)=>{var d,n;null===(d=H._primitiveBabylonMeshes)||void 0===d||d.forEach((E=>{E.inheritVisibility=!0})),H._babylonTransformNode&&(H._babylonTransformNode.isVisible=E),null===(n=H._primitiveBabylonMeshes)||void 0===n||n.forEach((H=>{H.isVisible=E}))},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class qd{constructor(E){this.name=xd,this._loader=E,this.enabled=E.isExtensionUsed(xd)}async onReady(){var E;null===(E=this._loader.jd.nodes)||void 0===E||E.forEach((E=>{var H,d,n,Z;(null===(H=E._primitiveBabylonMeshes)||void 0===H||H.forEach((E=>{E.inheritVisibility=!0})),null!==(d=E.extensions)&&void 0!==d&&d.KHR_node_visibility)&&(!1===(null===(n=E.extensions)||void 0===n?void 0:n.KHR_node_visibility.visible)&&(E._babylonTransformNode&&(E._babylonTransformNode.isVisible=!1),null===(Z=E._primitiveBabylonMeshes)||void 0===Z||Z.forEach((E=>{E.isVisible=!1}))))}))}dispose(){this._loader=null}}O(xd),k(xd,!0,(E=>new qd(E)));const bd="KHR_node_selectability";Wd("event/onSelect",bd,{XS:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Fd:"FlowGraphGetVariableBlock",dataTransformer:E=>["pickedMesh_"+E[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Fd:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(E,H,d,n,Z,I,g){var l,r,t,S,M,V;const C=Z[Z.length-1];C.config=C.config||{},C.config.glTF=g;const w=null===(l=E.configuration)||void 0===l||null===(r=l.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const R="pickedMesh_"+w;return Z[1].config.variable=R,I._userVariables[R]={className:"Mesh",id:null===g||void 0===g||null===(t=g.nodes)||void 0===t||null===(S=t[w]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===g||void 0===g||null===(M=g.nodes)||void 0===M||null===(V=M[w]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},Z}}),(0,G.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:E=>{const H=E._babylonTransformNode;return!H||void 0===H.Tr||H.Tr},set:(E,H)=>{var d;null===(d=H._primitiveBabylonMeshes)||void 0===d||d.forEach((H=>{H.Tr=E}))},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"Tr"],type:"boolean"});class hd{constructor(E){this.name=bd,this._loader=E,this.enabled=E.isExtensionUsed(bd)}async onReady(){var E;null===(E=this._loader.jd.nodes)||void 0===E||E.forEach((E=>{var H,d,n;null!==(H=E.extensions)&&void 0!==H&&H.KHR_node_selectability&&!1===(null===(d=E.extensions)||void 0===d?void 0:d.KHR_node_selectability.selectable)&&(null===(n=E._babylonTransformNode)||void 0===n||n.getChildMeshes().forEach((E=>{E.Tr=!1})))}))}dispose(){this._loader=null}}O(bd),k(bd,!0,(E=>new hd(E)));const yd="KHR_node_hoverability",vd="targetMeshPointerOver_";Wd("event/onHoverIn",yd,{XS:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Fd:"FlowGraphGetVariableBlock",dataTransformer:E=>[vd+E[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Fd:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(E,H,d,n,Z,I,g){var l,r,t,S,M,V;const C=Z[Z.length-1];C.config=C.config||{},C.config.glTF=g;const w=null===(l=E.configuration)||void 0===l||null===(r=l.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const R=vd+w;return Z[1].config.variable=R,I._userVariables[R]={className:"Mesh",id:null===g||void 0===g||null===(t=g.nodes)||void 0===t||null===(S=t[w]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===g||void 0===g||null===(M=g.nodes)||void 0===M||null===(V=M[w]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},Z}});const zd="targetMeshPointerOut_";Wd("event/onHoverOut",yd,{XS:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Fd:"FlowGraphGetVariableBlock",dataTransformer:E=>[zd+E[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Fd:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(E,H,d,n,Z,I,g){var l,r,t,S,M,V;const C=Z[Z.length-1];C.config=C.config||{},C.config.glTF=g;const w=null===(l=E.configuration)||void 0===l||null===(r=l.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const R=zd+w;return Z[1].config.variable=R,I._userVariables[R]={className:"Mesh",id:null===g||void 0===g||null===(t=g.nodes)||void 0===t||null===(S=t[w]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===g||void 0===g||null===(M=g.nodes)||void 0===M||null===(V=M[w]._babylonTransformNode)||void 0===V?void 0:V.uniqueId},Z}}),(0,G.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:E=>{const H=E._babylonTransformNode;return!H||void 0===H.pointerOverDisableMeshTesting||H.pointerOverDisableMeshTesting},set:(E,H)=>{var d;null===(d=H._primitiveBabylonMeshes)||void 0===d||d.forEach((H=>{H.pointerOverDisableMeshTesting=!E}))},getTarget:E=>E._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Kd{constructor(E){this.name=yd,this._loader=E,this.enabled=E.isExtensionUsed(yd)}async onReady(){var E;null===(E=this._loader.jd.nodes)||void 0===E||E.forEach((E=>{var H,d,n;null!==(H=E.extensions)&&void 0!==H&&H.KHR_node_hoverability&&!1===(null===(d=E.extensions)||void 0===d?void 0:d.KHR_node_hoverability.hoverable)&&(null===(n=E._babylonTransformNode)||void 0===n||n.getChildMeshes().forEach((E=>{E.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}O(yd),k(yd,!0,(E=>new Kd(E)));const Nd="ExtrasAsMetadata";class mn{_assignExtras(E,H){if(H.extras&&Object.keys(H.extras).length>0){const d=E.metadata=E.metadata||{};(d.jd=d.jd||{}).extras=H.extras}}constructor(E){this.name=Nd,this.enabled=!0,this._loader=E}dispose(){this._loader=null}loadNodeAsync(E,H,d){return this._loader.loadNodeAsync(E,H,(E=>{this._assignExtras(E,H),d(E)}))}loadCameraAsync(E,H,d){return this._loader.loadCameraAsync(E,H,(E=>{this._assignExtras(E,H),d(E)}))}createMaterial(E,H,d){const n=this._loader.createMaterial(E,H,d);return this._assignExtras(n,H),n}}O(Nd),k(Nd,!1,(E=>new mn(E)));d(14142)},14032:(E,H,d)=>{"use strict";d.d(H,{d:()=>u,h:()=>j,l:()=>P,p:()=>X});var n=d(12230),Z=d(12228),I=d(13681),g=d(12840),l=d(12809),r=d(12817),t=d(12237),S=d(12268),M=d(12832),V=d(12919),C=d(12845),w=d(12432);class R{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.lV=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.bV=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(E){this._environmentTexture=E}getNodes(){let E=[];E=E.concat(this.meshes),E=E.concat(this.lights),E=E.concat(this.cameras),E=E.concat(this.transformNodes);for(const H of this.skeletons)E=E.concat(H.bones);return E}}class Q extends R{}class L{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const E=this.rootNodes;for(const n of E)n.dispose();E.length=0;const H=this.skeletons;for(const n of H)n.dispose();H.length=0;const d=this.animationGroups;for(const n of d)n.dispose();d.length=0}}class D extends R{constructor(E){super(),this._wasAddedToScene=!1,(E=E||S.b.LastCreatedScene)&&(this.QH=E,this.proceduralTextures=[],E.Qd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=E.getEngine().onContextRestoredObservable.add((()=>{for(const E of this.geometries)E._rebuild();for(const E of this.meshes)E._rebuild();for(const E of this.lV)E.rebuild();for(const E of this.textures)E._rebuild()})))}_topologicalSort(E){const H=new Map;for(const g of E)H.set(g.uniqueId,g);const d={dependsOn:new Map,dependedBy:new Map};for(const g of E){const E=g.uniqueId;d.dependsOn.set(E,new Set),d.dependedBy.set(E,new Set)}for(const g of E){const E=g.uniqueId,n=d.dependsOn.get(E);if(g instanceof M.c){const Z=g.sourceMesh;H.has(Z.uniqueId)&&(n.add(Z.uniqueId),d.dependedBy.get(Z.uniqueId).add(E))}const Z=d.dependedBy.get(E);for(const I of g.getDescendants()){const n=I.uniqueId;if(H.has(n)){Z.add(n);d.dependsOn.get(n).add(E)}}}const n=[],Z=[];for(const g of E){const E=g.uniqueId;0===d.dependsOn.get(E).size&&(Z.push(g),H.delete(E))}const I=Z;for(;I.length>0;){const E=I.shift();n.push(E);const Z=d.dependedBy.get(E.uniqueId);for(const n of Array.from(Z.values())){const Z=d.dependsOn.get(n);Z.delete(E.uniqueId),0===Z.size&&H.get(n)&&(I.push(H.get(n)),H.delete(n))}}return H.size>0&&(t.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),H.forEach((E=>{t.b.Error(E.name)}))),n}_addNodeAndDescendantsToList(E,H,d,n){if(d&&(!n||n(d))&&!H.has(d.uniqueId)){E.push(d),H.add(d.uniqueId);for(const Z of d.getDescendants(!0))this._addNodeAndDescendantsToList(E,H,Z,n)}}_isNodeInContainer(E){return E instanceof r.b&&-1!==this.meshes.indexOf(E)||(E instanceof l.e&&-1!==this.transformNodes.indexOf(E)||(E instanceof V.e&&-1!==this.lights.indexOf(E)||E instanceof C.b&&-1!==this.cameras.indexOf(E)))}_isValidHierarchy(){for(const E of this.meshes)if(E.parent&&!this._isNodeInContainer(E.parent))return t.b.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.transformNodes)if(E.parent&&!this._isNodeInContainer(E.parent))return t.b.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.lights)if(E.parent&&!this._isNodeInContainer(E.parent))return t.b.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;for(const E of this.cameras)if(E.parent&&!this._isNodeInContainer(E.parent))return t.b.Warn(`Node ${E.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||Z.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const n={},I={},l=new L,r=[],t=[],S={doNotInstantiate:!0,...d},M=[],V=new Set;for(const Z of this.transformNodes)null===Z.parent&&this._addNodeAndDescendantsToList(M,V,Z,S.predicate);for(const Z of this.meshes)null===Z.parent&&this._addNodeAndDescendantsToList(M,V,Z,S.predicate);const C=this._topologicalSort(M),w=(d,Z)=>{if(((H,d)=>{if(n[H.uniqueId]=d.uniqueId,I[d.uniqueId]=d,E&&(d.name=E(H.name)),d instanceof g.e){const E=d;if(E.morphTargetManager){const d=H.morphTargetManager;E.morphTargetManager=d.clone();for(let H=0;H<d.numTargets;H++){const Z=d.getTarget(H),g=E.morphTargetManager.getTarget(H);n[Z.uniqueId]=g.uniqueId,I[g.uniqueId]=g}}}})(d,Z),d.parent){const E=n[d.parent.uniqueId],H=I[E];Z.parent=H||d.parent}if(Z.position&&d.position&&Z.position.l(d.position),Z.rotationQuaternion&&d.rotationQuaternion&&Z.rotationQuaternion.l(d.rotationQuaternion),Z.rotation&&d.rotation&&Z.rotation.l(d.rotation),Z.mg&&d.mg&&Z.mg.l(d.mg),Z.material){const g=Z;if(g.material)if(H){const H=d.material;if(-1===t.indexOf(H)){let d=H.clone(E?E(H.name):"Clone of "+H.name);if(t.push(H),n[H.uniqueId]=d.uniqueId,I[d.uniqueId]=d,"MultiMaterial"===H.getClassName()){const Z=H;for(const H of Z.wg)H&&(d=H.clone(E?E(H.name):"Clone of "+H.name),t.push(H),n[H.uniqueId]=d.uniqueId,I[d.uniqueId]=d);Z.wg=Z.wg.map((E=>E&&I[n[E.uniqueId]]))}}"InstancedMesh"!==g.getClassName()&&(g.material=I[n[H.uniqueId]])}else"MultiMaterial"===g.material.getClassName()?-1===this.QH.multiMaterials.indexOf(g.material)&&this.QH.addMultiMaterial(g.material):-1===this.QH.materials.indexOf(g.material)&&this.QH.addMaterial(g.material)}null===Z.parent&&l.rootNodes.push(Z)};for(const Z of C)if("InstancedMesh"===Z.getClassName()){const E=Z,H=E.sourceMesh,d=n[H.uniqueId];w(E,("number"===typeof d?I[d]:H).createInstance(E.name))}else{let E=!0;"Fg"===Z.getClassName()||"Node"===Z.getClassName()||Z.skeleton||!Z.getTotalVertices||0===Z.getTotalVertices()?E=!1:S.doNotInstantiate&&(E="function"===typeof S.doNotInstantiate?!S.doNotInstantiate(Z):!S.doNotInstantiate);const H=E?Z.createInstance(`instance of ${Z.name}`):Z.clone(`Clone of ${Z.name}`,null,!0);if(!H)throw new Error(`Could not clone or instantiate node on Asset Container ${Z.name}`);w(Z,H)}for(const Z of this.skeletons){if(S.predicate&&!S.predicate(Z))continue;const H=Z.clone(E?E(Z.name):"Clone of "+Z.name);for(const E of this.meshes)if(E.skeleton===Z&&!E.isAnInstance){const d=I[n[E.uniqueId]];if(!d||d.isAnInstance)continue;if(d.skeleton=H,-1!==r.indexOf(H))continue;r.push(H);for(const E of H.bones)E._linkedTransformNode&&(E._linkedTransformNode=I[n[E._linkedTransformNode.uniqueId]])}l.skeletons.push(H)}for(const Z of this.animationGroups){if(S.predicate&&!S.predicate(Z))continue;const H=Z.clone(E?E(Z.name):"Clone of "+Z.name,(E=>I[n[E.uniqueId]]||E));l.animationGroups.push(H)}return l}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||Z.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.QH.environmentTexture=this.environmentTexture);for(const E of this.QH._serializableComponents)E.addFromContainer(this);this.QH.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const H=[];for(const d of this.cameras)E&&!E(d)||(this.QH.addCamera(d),H.push(d));for(const d of this.lights)E&&!E(d)||(this.QH.addLight(d),H.push(d));for(const d of this.meshes)E&&!E(d)||(this.QH.wS(d),H.push(d));for(const d of this.skeletons)E&&!E(d)||this.QH.addSkeleton(d);for(const d of this.animations)E&&!E(d)||this.QH.addAnimation(d);for(const d of this.animationGroups)E&&!E(d)||this.QH.addAnimationGroup(d);for(const d of this.multiMaterials)E&&!E(d)||this.QH.addMultiMaterial(d);for(const d of this.materials)E&&!E(d)||this.QH.addMaterial(d);for(const d of this.morphTargetManagers)E&&!E(d)||this.QH.addMorphTargetManager(d);for(const d of this.geometries)E&&!E(d)||this.QH.addGeometry(d);for(const d of this.transformNodes)E&&!E(d)||(this.QH.addTransformNode(d),H.push(d));for(const d of this.actionManagers)E&&!E(d)||this.QH.addActionManager(d);for(const d of this.textures)E&&!E(d)||this.QH.addTexture(d);for(const d of this.reflectionProbes)E&&!E(d)||this.QH.addReflectionProbe(d);for(const d of H)d.parent&&-1===this.QH.getNodes().indexOf(d.parent)&&(d.setParent?d.setParent(null):d.parent=null)}removeAllFromScene(){this._isValidHierarchy()||Z.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.QH.environmentTexture&&(this.QH.environmentTexture=null);for(const E of this.QH._serializableComponents)E.removeFromContainer(this)}removeFromScene(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const H of this.cameras)E&&!E(H)||this.QH.removeCamera(H);for(const H of this.lights)E&&!E(H)||this.QH.removeLight(H);for(const H of this.meshes)E&&!E(H)||this.QH.CS(H,!0);for(const H of this.skeletons)E&&!E(H)||this.QH.removeSkeleton(H);for(const H of this.animations)E&&!E(H)||this.QH.removeAnimation(H);for(const H of this.animationGroups)E&&!E(H)||this.QH.removeAnimationGroup(H);for(const H of this.multiMaterials)E&&!E(H)||this.QH.removeMultiMaterial(H);for(const H of this.materials)E&&!E(H)||this.QH.removeMaterial(H);for(const H of this.morphTargetManagers)E&&!E(H)||this.QH.removeMorphTargetManager(H);for(const H of this.geometries)E&&!E(H)||this.QH.removeGeometry(H);for(const H of this.transformNodes)E&&!E(H)||this.QH.removeTransformNode(H);for(const H of this.actionManagers)E&&!E(H)||this.QH.removeActionManager(H);for(const H of this.textures)E&&!E(H)||this.QH.removeTexture(H);for(const H of this.reflectionProbes)E&&!E(H)||this.QH.removeReflectionProbe(H)}dispose(){const E=this.cameras.slice(0);for(const C of E)C.dispose();this.cameras.length=0;const H=this.lights.slice(0);for(const C of H)C.dispose();this.lights.length=0;const d=this.meshes.slice(0);for(const C of d)C.dispose();this.meshes.length=0;const n=this.skeletons.slice(0);for(const C of n)C.dispose();this.skeletons.length=0;const Z=this.animationGroups.slice(0);for(const C of Z)C.dispose();this.animationGroups.length=0;const I=this.multiMaterials.slice(0);for(const C of I)C.dispose();this.multiMaterials.length=0;const g=this.materials.slice(0);for(const C of g)C.dispose();this.materials.length=0;const l=this.geometries.slice(0);for(const C of l)C.dispose();this.geometries.length=0;const r=this.transformNodes.slice(0);for(const C of r)C.dispose();this.transformNodes.length=0;const t=this.actionManagers.slice(0);for(const C of t)C.dispose();this.actionManagers.length=0;const S=this.textures.slice(0);for(const C of S)C.dispose();this.textures.length=0;const M=this.reflectionProbes.slice(0);for(const C of M)C.dispose();this.reflectionProbes.length=0;const V=this.morphTargetManagers.slice(0);for(const C of V)C.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const C of this.QH._serializableComponents)C.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.QH.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(E,H,d){if(E&&H)for(const n of E){let E=!0;if(d)for(const H of d)if(n===H){E=!1;break}E&&(H.push(n),n._parentContainer=this)}}moveAllFromScene(E){this._wasAddedToScene=!1,void 0===E&&(E=new Q);for(const H in this)Object.prototype.hasOwnProperty.call(this,H)&&(this[H]=this[H]||("_environmentTexture"===H?null:[]),this._moveAssets(this.QH[H],this[H],E[H]));this.environmentTexture=this.QH.environmentTexture,this.removeAllFromScene()}createRootMesh(){const E=new g.e("assetContainerRootMesh",this.QH);for(const H of this.meshes)H.parent||E.addChild(H);return this.meshes.unshift(E),E}mergeAnimationsTo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.b.LastCreatedScene,H=arguments.length>1?arguments[1]:void 0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!E)return t.b.Error("No scene available to merge animations to"),[];const n=d||(H=>{let d=null;const n=H.animations.length?H.animations[0].targetProperty:"",Z=H.name.split(".").join("").split("_primitive")[0];switch(n){case"position":case"rotationQuaternion":d=E.getTransformNodeByName(H.name)||E.getTransformNodeByName(Z);break;case"influence":d=E.getMorphTargetByName(H.name)||E.getMorphTargetByName(Z);break;default:d=E.getNodeByName(H.name)||E.getNodeByName(Z)}return d}),Z=this.getNodes();for(const l of Z){const E=n(l);if(null!==E){for(const H of l.animations){const d=E.animations.filter((E=>E.targetProperty===H.targetProperty));for(const H of d){const d=E.animations.indexOf(H,0);d>-1&&E.animations.splice(d,1)}}E.animations=E.animations.concat(l.animations)}}const I=[],g=this.animationGroups.slice();for(const l of g){I.push(l.clone(l.name,n));for(const E of l.animatables)E.stop()}for(const l of H){const H=n(l.target);H&&(E.beginAnimation(H,l.fromFrame,l.toFrame,l.loopAnimation,l.speedRatio,l.onAnimationEnd?l.onAnimationEnd:void 0,void 0,!0,void 0,l.onAnimationLoop?l.onAnimationLoop:void 0),E.stopAnimation(l.target))}return I}populateRootNodes(){this.rootNodes.length=0;for(const E of this.meshes)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E);for(const E of this.transformNodes)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E);for(const E of this.lights)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E);for(const E of this.cameras)E.parent||-1!==this.rootNodes.indexOf(E)||this.rootNodes.push(E)}addAllAssetsToContainer(E){if(!E)return;const H=[],d=new Set;for(H.push(E);H.length>0;){const E=H.pop();if(E instanceof g.e?(E.Kd&&-1===this.geometries.indexOf(E.Kd)&&this.geometries.push(E.Kd),this.meshes.push(E)):E instanceof M.c?this.meshes.push(E):E instanceof l.e?this.transformNodes.push(E):E instanceof V.e?this.lights.push(E):E instanceof C.b&&this.cameras.push(E),E instanceof r.b){if(E.material&&-1===this.materials.indexOf(E.material)){this.materials.push(E.material);for(const H of E.material.getActiveTextures())-1===this.textures.indexOf(H)&&this.textures.push(H)}E.skeleton&&-1===this.skeletons.indexOf(E.skeleton)&&this.skeletons.push(E.skeleton),E.morphTargetManager&&-1===this.morphTargetManagers.indexOf(E.morphTargetManager)&&this.morphTargetManagers.push(E.morphTargetManager)}for(const n of E.getChildren())d.has(n)||H.push(n);d.add(E)}this.populateRootNodes()}_getByTags(E,H,d){if(void 0===H)return E;const n=[];for(const Z in E){const I=E[Z];w.e&&w.e.MatchesQuery(I,H)&&(!d||d(I))&&n.push(I)}return n}getMeshesByTags(E,H){return this._getByTags(this.meshes,E,H)}getCamerasByTags(E,H){return this._getByTags(this.cameras,E,H)}getLightsByTags(E,H){return this._getByTags(this.lights,E,H)}getMaterialsByTags(E,H){return this._getByTags(this.materials,E,H).concat(this._getByTags(this.multiMaterials,E,H))}getTransformNodesByTags(E,H){return this._getByTags(this.transformNodes,E,H)}}var e=d(12279);class s{constructor(E){this.byteOffset=0,this.buffer=E}async loadAsync(E){const H=await this.buffer.readAsync(this.byteOffset,E);this._dataView=new DataView(H.buffer,H.byteOffset,H.byteLength),this._dataByteOffset=0}readUint32(){const E=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,E}readUint8Array(E){const H=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,E);return this._dataByteOffset+=E,this.byteOffset+=E,H}readString(E){return(0,e.h)(this.readUint8Array(E))}skipBytes(E){this._dataByteOffset+=E,this.byteOffset+=E}}var i=d(14041);const p="Z2xURg",f={name:"jd",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:E=>-1!==E.indexOf("asset")&&-1!==E.indexOf("version")||E.startsWith("data:base64,"+p)||E.startsWith("data:;base64,"+p)||E.startsWith("data:application/octet-stream;base64,"+p)||E.startsWith("data:model/gltf-binary;base64,"+p)};var P,j,X,W=d(12271),U=d(12275);function Y(E,H,d){try{return Promise.resolve(new Uint8Array(E,H,d))}catch(n){return Promise.reject(n)}}!function(E){E[E.AUTO=0]="AUTO",E[E.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(P||(P={})),function(E){E[E.NONE=0]="NONE",E[E.FIRST=1]="FIRST",E[E.ALL=2]="ALL"}(j||(j={})),function(E){E[E.LOADING=0]="LOADING",E[E.READY=1]="READY",E[E.COMPLETE=2]="COMPLETE"}(X||(X={}));class c{constructor(){this.coordinateSystemMode=P.AUTO,this.animationStartMode=j.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=E=>Promise.resolve(E),this.extensionOptions={}}l(E){E&&(this.onParsed=E.onParsed,this.coordinateSystemMode=E.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=E.animationStartMode??this.animationStartMode,this.loadNodeAnimations=E.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=E.loadSkins??this.loadSkins,this.loadMorphTargets=E.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=E.compileMaterials??this.compileMaterials,this.useClipPlane=E.useClipPlane??this.useClipPlane,this.compileShadowGenerators=E.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=E.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=E.useRangeRequests??this.useRangeRequests,this.createInstances=E.createInstances??this.createInstances,this.alwaysComputeBoundingBox=E.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=E.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=E.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=E.skipMaterials??this.skipMaterials,this.useSRGBBuffers=E.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=E.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=E.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=E.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=E.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=E.customRootNode,this.onMeshLoaded=E.onMeshLoaded,this.onSkinLoaded=E.onSkinLoaded,this.onTextureLoaded=E.onTextureLoaded,this.onMaterialLoaded=E.onMaterialLoaded,this.onCameraLoaded=E.onCameraLoaded,this.extensionOptions=E.extensionOptions??this.extensionOptions)}}class u extends c{constructor(E){super(),this.onParsedObservable=new n.e,this.onMeshLoadedObservable=new n.e,this.onSkinLoadedObservable=new n.e,this.onTextureLoadedObservable=new n.e,this.onMaterialLoadedObservable=new n.e,this.onCameraLoadedObservable=new n.e,this.onCompleteObservable=new n.e,this.onErrorObservable=new n.e,this.Qd=new n.e,this.onExtensionLoadedObservable=new n.e,this.validate=!1,this.onValidatedObservable=new n.e,this._loader=null,this._state=null,this._requests=new Array,this.name=f.name,this.extensions=f.extensions,this.onLoaderStateChangedObservable=new n.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.l(E)}set onParsed(E){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),E&&(this._onParsedObserver=this.onParsedObservable.add(E))}set onMeshLoaded(E){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),E&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(E))}set onSkinLoaded(E){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),E&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((H=>E(H.node,H.skinnedNode))))}set onTextureLoaded(E){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),E&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(E))}set onMaterialLoaded(E){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),E&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(E))}set onCameraLoaded(E){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),E&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(E))}set onComplete(E){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(E)}set onError(E){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(E)}set onDispose(E){this._onDisposeObserver&&this.Qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qd.add(E)}set onExtensionLoaded(E){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(E)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(E){this._loggingEnabled!==E&&(this._loggingEnabled=E,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(E){this._capturePerformanceCounters!==E&&(this._capturePerformanceCounters=E,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(E){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(E)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const E of this._requests)E.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=E=>Promise.resolve(E),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Qd.notifyObservers(void 0),this.Qd.clear()}loadFile(E,H,d,I,g,l,r,S){if(ArrayBuffer.isView(H))return this._loadBinary(E,H,d,I,r,S),null;this._progressCallback=g;const M=H.name||Z.Tools.GetFilename(H);if(l){if(this.useRangeRequests){this.validate&&t.b.Warn("glTF validation is not supported when range requests are enabled");const d={abort:()=>{},onCompleteObservable:new n.e},Z={readAsync:(d,n)=>new Promise(((Z,I)=>{this._loadFile(E,H,(E=>{Z(new Uint8Array(E))}),!0,(E=>{I(E)}),(E=>{E.setRequestHeader("Range",`bytes=${d}-${d+n-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new s(Z)).then((E=>{d.onCompleteObservable.notifyObservers(d),I(E)}),r?E=>r(void 0,E):void 0),d}return this._loadFile(E,H,(H=>{this._validate(E,new Uint8Array(H,0,H.byteLength),d,M),this._unpackBinaryAsync(new s({readAsync:(E,d)=>Y(H,E,d),byteLength:H.byteLength})).then((E=>{I(E)}),r?E=>r(void 0,E):void 0)}),!0,r)}return this._loadFile(E,H,(H=>{try{this._validate(E,H,d,M),I({json:this._parseJson(H)})}catch{r&&r()}}),!1,r)}_loadBinary(E,H,d,n,Z,I){this._validate(E,new Uint8Array(H.buffer,H.byteOffset,H.byteLength),d,I),this._unpackBinaryAsync(new s({readAsync:(E,d)=>function(E,H,d){try{if(H<0||H>=E.byteLength)throw new RangeError("Offset is out of range.");if(H+d>E.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(E.buffer,E.byteOffset+H,d))}catch(n){return Promise.reject(n)}}(H,E,d),byteLength:H.byteLength})).then((E=>{n(E)}),Z?E=>Z(void 0,E):void 0)}importMeshAsync(E,H,d,n,Z,I){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${I||""}`),this._loader=this._getLoader(d),this._loader.importMeshAsync(E,H,null,d,n,Z,I))))}loadAsync(E,H,d,n,Z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${Z||""}`),this._loader=this._getLoader(H),this._loader.loadAsync(E,H,d,n,Z))))}loadAssetContainerAsync(E,H,d,n,Z){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${Z||""}`),this._loader=this._getLoader(H);const I=new D(E),g=[];this.onMaterialLoadedObservable.add((E=>{g.push(E)}));const l=[];this.onTextureLoadedObservable.add((E=>{l.push(E)}));const r=[];this.onCameraLoadedObservable.add((E=>{r.push(E)}));const t=[];return this.onMeshLoadedObservable.add((E=>{E.morphTargetManager&&t.push(E.morphTargetManager)})),this._loader.importMeshAsync(null,E,I,H,d,n,Z).then((E=>(Array.prototype.push.apply(I.geometries,E.geometries),Array.prototype.push.apply(I.meshes,E.meshes),Array.prototype.push.apply(I.lV,E.lV),Array.prototype.push.apply(I.skeletons,E.skeletons),Array.prototype.push.apply(I.animationGroups,E.animationGroups),Array.prototype.push.apply(I.materials,g),Array.prototype.push.apply(I.textures,l),Array.prototype.push.apply(I.lights,E.lights),Array.prototype.push.apply(I.transformNodes,E.transformNodes),Array.prototype.push.apply(I.cameras,r),Array.prototype.push.apply(I.morphTargetManagers,t),I)))}))}canDirectLoad(E){return f.canDirectLoad(E)}directLoad(E,H){if(H.startsWith("base64,"+p)||H.startsWith(";base64,"+p)||H.startsWith("application/octet-stream;base64,"+p)||H.startsWith("model/gltf-binary;base64,"+p)){const d=(0,W.b)(H);return this._validate(E,new Uint8Array(d,0,d.byteLength)),this._unpackBinaryAsync(new s({readAsync:(E,H)=>Y(d,E,H),byteLength:d.byteLength}))}return this._validate(E,H),Promise.resolve({json:this._parseJson(H)})}createPlugin(E){return new u(E[f.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((E,H)=>{this.onCompleteObservable.addOnce((()=>{E()})),this.onErrorObservable.addOnce((E=>{H(E)}))}))}_setState(E){this._state!==E&&(this._state=E,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(X[this._state]))}_loadFile(E,H,d,n,Z,I){const g=E._loadFile(H,d,(E=>{this._onProgress(E,g)}),!0,n,Z,I);return g.onCompleteObservable.add((()=>{g._lengthComputable=!0,g._total=g._loaded})),this._requests.push(g),g}_onProgress(E,H){if(!this._progressCallback)return;H._lengthComputable=E.lengthComputable,H._loaded=E.loaded,H._total=E.total;let d=!0,n=0,Z=0;for(const I of this._requests){if(void 0===I._lengthComputable||void 0===I._loaded||void 0===I._total)return;d=d&&I._lengthComputable,n+=I._loaded,Z+=I._total}this._progressCallback({lengthComputable:d,loaded:n,total:d?Z:0})}_validate(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),i.c.ValidateAsync(H,d,n,(H=>this.preprocessUrlAsync(d+H).then((H=>E._loadFileAsync(H,void 0,!0,!0).then((E=>new Uint8Array(E,0,E.byteLength))))))).then((E=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(E),this.onValidatedObservable.clear()}),(E=>{this._endPerformanceCounter("Validate JSON"),Z.Tools.Warn(`Failed to validate: ${E.message}`),this.onValidatedObservable.clear()})))}_getLoader(E){const H=E.json.asset||{};this._log(`Asset version: ${H.version}`),H.minVersion&&this._log(`Asset minimum version: ${H.minVersion}`),H.generator&&this._log(`Asset generator: ${H.generator}`);const d=u._parseVersion(H.version);if(!d)throw new Error("Invalid version: "+H.version);if(void 0!==H.minVersion){const E=u._parseVersion(H.minVersion);if(!E)throw new Error("Invalid minimum version: "+H.minVersion);if(u._compareVersion(E,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+H.minVersion)}const n={1:u._CreateGLTF1Loader,2:u._CreateGLTF2Loader}[d.major];if(!n)throw new Error("Unsupported version: "+H.version);return n(this)}_parseJson(E){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${E.length}`);const H=JSON.parse(E);return this._endPerformanceCounter("Parse JSON"),H}_unpackBinaryAsync(E){return this._startPerformanceCounter("Unpack Binary"),E.loadAsync(20).then((()=>{const H=E.readUint32();if(1179937895!==H)throw new U.f("Unexpected magic: "+H,U.d.GLTFLoaderUnexpectedMagicError);const d=E.readUint32();this.loggingEnabled&&this._log(`Binary version: ${d}`);const n=E.readUint32();let Z;switch(this.useRangeRequests||n===E.buffer.byteLength||t.b.Warn(`Length in header does not match actual data length: ${n} != ${E.buffer.byteLength}`),d){case 1:Z=this._unpackBinaryV1Async(E,n);break;case 2:Z=this._unpackBinaryV2Async(E,n);break;default:throw new Error("Unsupported version: "+d)}return this._endPerformanceCounter("Unpack Binary"),Z}))}_unpackBinaryV1Async(E,H){const d=E.readUint32(),n=E.readUint32();if(0!==n)throw new Error(`Unexpected content format: ${n}`);const Z=H-E.byteOffset,I={json:this._parseJson(E.readString(d)),bin:null};if(0!==Z){const H=E.byteOffset;I.bin={readAsync:(d,n)=>E.buffer.readAsync(H+d,n),byteLength:Z}}return Promise.resolve(I)}_unpackBinaryV2Async(E,H){const d=1313821514,n=5130562,Z=E.readUint32();if(E.readUint32()!==d)throw new Error("First chunk format is not JSON");return E.byteOffset+Z===H?E.loadAsync(Z).then((()=>({json:this._parseJson(E.readString(Z)),bin:null}))):E.loadAsync(Z+8).then((()=>{const I={json:this._parseJson(E.readString(Z)),bin:null},g=()=>{const Z=E.readUint32();switch(E.readUint32()){case d:throw new Error("Unexpected JSON chunk");case n:{const H=E.byteOffset;I.bin={readAsync:(d,n)=>E.buffer.readAsync(H+d,n),byteLength:Z},E.skipBytes(Z);break}default:E.skipBytes(Z)}return E.byteOffset!==H?E.loadAsync(8).then(g):Promise.resolve(I)};return g()}))}static _parseVersion(E){if("1.0"===E||"1.0.1"===E)return{major:1,minor:0};const H=(E+"").match(/^(\d+)\.(\d+)/);return H?{major:parseInt(H[1]),minor:parseInt(H[2])}:null}static _compareVersion(E,H){return E.major>H.major?1:E.major<H.major?-1:E.minor>H.minor?1:E.minor<H.minor?-1:0}_logOpen(E){this._log(E),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(E){const H=u._logSpaces.substring(0,2*this._logIndentLevel);t.b.Log(`${H}${E}`)}_logDisabled(E){}_startPerformanceCounterEnabled(E){Z.Tools.StartPerformanceCounter(E)}_startPerformanceCounterDisabled(E){}_endPerformanceCounterEnabled(E){Z.Tools.EndPerformanceCounter(E)}_endPerformanceCounterDisabled(E){}}u.IncrementalLoading=!0,u.HomogeneousCoordinates=!1,u._logSpaces="                                ",(0,I.d)(new u)},14041:(E,H,d)=>{"use strict";d.d(H,{c:()=>g});var n=d(12228);function Z(E,H,d,n){const Z={externalResourceFunction:n};return d&&(Z.uri="file:"===H?d:H+d),ArrayBuffer.isView(E)?GLTFValidator.validateBytes(E,Z):GLTFValidator.validateString(E,Z)}function I(){const E=[];onmessage=H=>{const d=H.data;switch(d.id){case"init":importScripts(d.url);break;case"validate":Z(d.data,d.rootUrl,d.fileName,(H=>new Promise(((d,n)=>{const Z=E.length;E.push({resolve:d,reject:n}),postMessage({id:"getExternalResource",index:Z,uri:H})})))).then((E=>{postMessage({id:"validate.resolve",value:E})}),(E=>{postMessage({id:"validate.reject",reason:E})}));break;case"getExternalResource.resolve":E[d.index].resolve(d.value);break;case"getExternalResource.reject":E[d.index].reject(d.reason)}}}class g{static ValidateAsync(E,H,d,g){return"function"===typeof Worker?new Promise(((l,r)=>{const t=`${Z}(${I})()`,S=URL.createObjectURL(new Blob([t],{type:"application/javascript"})),M=new Worker(S),V=E=>{M.removeEventListener("error",V),M.removeEventListener("message",C),r(E)},C=E=>{const H=E.data;switch(H.id){case"getExternalResource":g(H.uri).then((E=>{M.postMessage({id:"getExternalResource.resolve",index:H.index,value:E},[E.buffer])}),(E=>{M.postMessage({id:"getExternalResource.reject",index:H.index,reason:E})}));break;case"validate.resolve":M.removeEventListener("error",V),M.removeEventListener("message",C),l(H.value),M.terminate();break;case"validate.reject":M.removeEventListener("error",V),M.removeEventListener("message",C),r(H.reason),M.terminate()}};if(M.addEventListener("error",V),M.addEventListener("message",C),M.postMessage({id:"init",url:n.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(E)){const n=E.slice();M.postMessage({id:"validate",data:n,rootUrl:H,fileName:d},[n.buffer])}else M.postMessage({id:"validate",data:E,rootUrl:H,fileName:d})})):(this._LoadScriptPromise||(this._LoadScriptPromise=n.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>Z(E,H,d,g))))}}g.Configuration={url:`${n.Tools._DefaultCdnUrl}/gltf_validator.js`}},14570:(E,H,d)=>{"use strict";d.d(H,{c:()=>f});var n=d(12369),Z=d(12372),I=d(12428),g=d(12384),l=d(12781),r=d(12721),t=d(12463),S=d(12634),M=d(12344),V=d(12307);d(13800),d(13711),d(13725),d(13715),d(13733),d(13735),d(13742);const C="imageProcessingCompatibility",w="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";V.e.IncludesShadersStore[C]||(V.e.IncludesShadersStore[C]=w);const R="skyPixelShader",Q="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";V.e.ShadersStore[R]||(V.e.ShadersStore[R]=Q);d(13807),d(13750),d(13759),d(13772),d(13767);const L="skyVertexShader",D="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";V.e.ShadersStore[L]||(V.e.ShadersStore[L]=D);var e=d(12712),s=d(12768),i=d(12763);class p extends l.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class f extends r.d{constructor(E,H){super(E,H),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new g.wH(0,100,0),this.useSunPosition=!1,this.cameraOffset=g.wH.Zero(),this.up=g.wH.Up(),this.dithering=!1,this._cameraPosition=g.wH.Zero(),this._skyOrientation=new g.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(E,H){const d=H._drawWrapper;if(this.isFrozen&&d.effect&&d._wasPreviouslyReady)return!0;H.materialDefines||(H.materialDefines=new p);const n=H.materialDefines,Z=this.fE();if(this._isReadyForSubMesh(H))return!0;if((0,i.S)(E,Z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,n),(0,i.H)(E,n,!0,!1),n.IMAGEPROCESSINGPOSTPROCESS!==Z.imageProcessingConfiguration.applyByPostProcess&&n.markAsMiscDirty(),n.DITHER!==this.dithering&&n.markAsMiscDirty(),n.isDirty){n.markAsProcessed(),Z.resetCachedMaterial();const E=new e.c;n.FOG&&E.addFallback(1,"FOG"),n.IMAGEPROCESSINGPOSTPROCESS=Z.imageProcessingConfiguration.applyByPostProcess,n.DITHER=this.dithering;const d=[t.g.PositionKind];n.VERTEXCOLOR&&d.push(t.g.ColorKind);const I="sky",g=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,s.e)(g);const l=n.toString();H.setEffect(Z.getEngine().createEffect(I,d,g,[],l,E,this.onCompiled,this.onError),n,this._materialContext)}return!(!H.effect||!H.effect.isReady())&&(n._renderId=Z.getRenderId(),d._wasPreviouslyReady=!0,!0)}bindForSubMesh(E,H,d){const n=this.fE(),Z=d.materialDefines;if(!Z)return;const I=d.effect;if(!I)return;this._activeEffect=I,this.bindOnlyWorldMatrix(E),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),this._mustRebind(n,I,d)&&((0,s.f)(I,this,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,i.j)(Z,I,n)),n.fogEnabled&&H.applyFog&&n.fogMode!==S.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),(0,i.d)(n,H,this._activeEffect);const l=n.activeCamera;if(l){const E=l.getWorldMatrix();this._cameraPosition.x=E.m[12],this._cameraPosition.y=E.m[13],this._cameraPosition.z=E.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const E=Math.PI*(this.inclination-.5),H=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(H)*Math.cos(E),this.sunPosition.y=this.distance*Math.sin(-E),this.sunPosition.z=this.distance*Math.sin(H)*Math.cos(E),g.Quaternion.FromUnitVectorsToRef(g.wH.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(H,this._activeEffect,d)}getAnimatables(){return[]}dispose(E){super.dispose(E)}clone(E){return I.c.Clone((()=>new f(E,this.fE())),this)}serialize(){const E=super.serialize();return E.customType="BABYLON.SkyMaterial",E}getClassName(){return"SkyMaterial"}static Parse(E,H,d){return I.c.Parse((()=>new f(E.name,H)),E,H,d)}}(0,n.e)([(0,Z.K)()],f.prototype,"luminance",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"turbidity",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"rayleigh",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"mieCoefficient",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"mieDirectionalG",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"distance",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"inclination",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"azimuth",void 0),(0,n.e)([(0,Z.I)()],f.prototype,"sunPosition",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"useSunPosition",void 0),(0,n.e)([(0,Z.I)()],f.prototype,"cameraOffset",void 0),(0,n.e)([(0,Z.I)()],f.prototype,"up",void 0),(0,n.e)([(0,Z.K)()],f.prototype,"dithering",void 0),(0,M.e)("BABYLON.SkyMaterial",f)},13079:(E,H,d)=>{"use strict";function n(E,H){H.headers=E.headers||{},H.statusMessage=E.statusText,H.statusCode=E.status,H.data=E.response}function Z(E,H,d){return new Promise((function(Z,I){d=d||{};var g,l,r,t=new XMLHttpRequest,S=d.body,M=d.headers||{};for(g in d.timeout&&(t.timeout=d.timeout),t.ontimeout=t.onerror=function(E){E.timeout="timeout"==E.type,I(E)},t.open(E,H.href||H),t.onload=function(){for(r=t.getAllResponseHeaders().trim().split(/[\r\n]+/),n(t,t);l=r.shift();)l=l.split(": "),t.headers[l.shift().toLowerCase()]=l.join(": ");if((l=t.headers["content-type"])&&~l.indexOf("application/json"))try{t.data=JSON.parse(t.data,d.reviver)}catch(E){return n(t,E),I(E)}(t.status>=400?I:Z)(t)},typeof FormData<"u"&&S instanceof FormData||S&&"object"==typeof S&&(M["content-type"]="application/json",S=JSON.stringify(S)),t.withCredentials=!!d.withCredentials,M)t.setRequestHeader(g,M[g]);t.send(S)}))}d.r(H),d.d(H,{del:()=>r,get:()=>I,patch:()=>l,post:()=>g,put:()=>t,send:()=>Z});var I=Z.bind(Z,"GET"),g=Z.bind(Z,"POST"),l=Z.bind(Z,"PATCH"),r=Z.bind(Z,"DELETE"),t=Z.bind(Z,"PUT")},14686:(E,H,d)=>{"use strict";d.d(H,{c:()=>M});const n=.5*(Math.sqrt(3)-1),Z=(3-Math.sqrt(3))/6,I=1/3,g=1/6,l=(Math.sqrt(5)-1)/4,r=(5-Math.sqrt(5))/20,t=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),S=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const M=class{constructor(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const H="function"==typeof E?E:function(E){let H=0,d=0,n=0,Z=1;const I=function(){let E=4022871197;return function(H){H=H.toString();for(let d=0;d<H.length;d++){E+=H.charCodeAt(d);let n=.02519603282416938*E;E=n>>>0,n-=E,n*=E,E=n>>>0,n-=E,E+=4294967296*n}return 2.3283064365386963e-10*(E>>>0)}}();H=I(" "),d=I(" "),n=I(" "),H-=I(E),H<0&&(H+=1);d-=I(E),d<0&&(d+=1);n-=I(E),n<0&&(n+=1);return function(){const E=2091639*H+2.3283064365386963e-10*Z;return H=d,d=n,n=E-(Z=0|E)}}(E);this.p=function(E){const H=new Uint8Array(256);for(let d=0;d<256;d++)H[d]=d;for(let d=0;d<255;d++){const n=d+~~(E()*(256-d)),Z=H[d];H[d]=H[n],H[n]=Z}return H}(H),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let d=0;d<512;d++)this.perm[d]=this.p[255&d],this.permMod12[d]=this.perm[d]%12}noise2D(E,H){const d=this.permMod12,I=this.perm;let g=0,l=0,r=0;const S=(E+H)*n,M=Math.floor(E+S),V=Math.floor(H+S),C=(M+V)*Z,w=E-(M-C),R=H-(V-C);let Q,L;w>R?(Q=1,L=0):(Q=0,L=1);const D=w-Q+Z,e=R-L+Z,s=w-1+2*Z,i=R-1+2*Z,p=255&M,f=255&V;let P=.5-w*w-R*R;if(P>=0){const E=3*d[p+I[f]];P*=P,g=P*P*(t[E]*w+t[E+1]*R)}let j=.5-D*D-e*e;if(j>=0){const E=3*d[p+Q+I[f+L]];j*=j,l=j*j*(t[E]*D+t[E+1]*e)}let X=.5-s*s-i*i;if(X>=0){const E=3*d[p+1+I[f+1]];X*=X,r=X*X*(t[E]*s+t[E+1]*i)}return 70*(g+l+r)}noise3D(E,H,d){const n=this.permMod12,Z=this.perm;let l,r,S,M;const V=(E+H+d)*I,C=Math.floor(E+V),w=Math.floor(H+V),R=Math.floor(d+V),Q=(C+w+R)*g,L=E-(C-Q),D=H-(w-Q),e=d-(R-Q);let s,i,p,f,P,j;L>=D?D>=e?(s=1,i=0,p=0,f=1,P=1,j=0):L>=e?(s=1,i=0,p=0,f=1,P=0,j=1):(s=0,i=0,p=1,f=1,P=0,j=1):D<e?(s=0,i=0,p=1,f=0,P=1,j=1):L<e?(s=0,i=1,p=0,f=0,P=1,j=1):(s=0,i=1,p=0,f=1,P=1,j=0);const X=L-s+g,W=D-i+g,U=e-p+g,Y=L-f+2*g,c=D-P+2*g,u=e-j+2*g,o=L-1+.5,F=D-1+.5,a=e-1+.5,k=255&C,O=255&w,G=255&R;let x=.6-L*L-D*D-e*e;if(x<0)l=0;else{const E=3*n[k+Z[O+Z[G]]];x*=x,l=x*x*(t[E]*L+t[E+1]*D+t[E+2]*e)}let q=.6-X*X-W*W-U*U;if(q<0)r=0;else{const E=3*n[k+s+Z[O+i+Z[G+p]]];q*=q,r=q*q*(t[E]*X+t[E+1]*W+t[E+2]*U)}let b=.6-Y*Y-c*c-u*u;if(b<0)S=0;else{const E=3*n[k+f+Z[O+P+Z[G+j]]];b*=b,S=b*b*(t[E]*Y+t[E+1]*c+t[E+2]*u)}let h=.6-o*o-F*F-a*a;if(h<0)M=0;else{const E=3*n[k+1+Z[O+1+Z[G+1]]];h*=h,M=h*h*(t[E]*o+t[E+1]*F+t[E+2]*a)}return 32*(l+r+S+M)}noise4D(E,H,d,n){const Z=this.perm;let I,g,t,M,V;const C=(E+H+d+n)*l,w=Math.floor(E+C),R=Math.floor(H+C),Q=Math.floor(d+C),L=Math.floor(n+C),D=(w+R+Q+L)*r,e=E-(w-D),s=H-(R-D),i=d-(Q-D),p=n-(L-D);let f=0,P=0,j=0,X=0;e>s?f++:P++,e>i?f++:j++,e>p?f++:X++,s>i?P++:j++,s>p?P++:X++,i>p?j++:X++;const W=f>=3?1:0,U=P>=3?1:0,Y=j>=3?1:0,c=X>=3?1:0,u=f>=2?1:0,o=P>=2?1:0,F=j>=2?1:0,a=X>=2?1:0,k=f>=1?1:0,O=P>=1?1:0,G=j>=1?1:0,x=X>=1?1:0,q=e-W+r,b=s-U+r,h=i-Y+r,y=p-c+r,v=e-u+2*r,z=s-o+2*r,K=i-F+2*r,N=p-a+2*r,mE=e-k+3*r,T=s-O+3*r,A=i-G+3*r,B=p-x+3*r,J=e-1+4*r,EE=s-1+4*r,HE=i-1+4*r,dE=p-1+4*r,nE=255&w,ZE=255&R,IE=255&Q,gE=255&L;let lE=.6-e*e-s*s-i*i-p*p;if(lE<0)I=0;else{const E=Z[nE+Z[ZE+Z[IE+Z[gE]]]]%32*4;lE*=lE,I=lE*lE*(S[E]*e+S[E+1]*s+S[E+2]*i+S[E+3]*p)}let rE=.6-q*q-b*b-h*h-y*y;if(rE<0)g=0;else{const E=Z[nE+W+Z[ZE+U+Z[IE+Y+Z[gE+c]]]]%32*4;rE*=rE,g=rE*rE*(S[E]*q+S[E+1]*b+S[E+2]*h+S[E+3]*y)}let tE=.6-v*v-z*z-K*K-N*N;if(tE<0)t=0;else{const E=Z[nE+u+Z[ZE+o+Z[IE+F+Z[gE+a]]]]%32*4;tE*=tE,t=tE*tE*(S[E]*v+S[E+1]*z+S[E+2]*K+S[E+3]*N)}let SE=.6-mE*mE-T*T-A*A-B*B;if(SE<0)M=0;else{const E=Z[nE+k+Z[ZE+O+Z[IE+G+Z[gE+x]]]]%32*4;SE*=SE,M=SE*SE*(S[E]*mE+S[E+1]*T+S[E+2]*A+S[E+3]*B)}let ME=.6-J*J-EE*EE-HE*HE-dE*dE;if(ME<0)V=0;else{const E=Z[nE+1+Z[ZE+1+Z[IE+1+Z[gE+1]]]]%32*4;ME*=ME,V=ME*ME*(S[E]*J+S[E+1]*EE+S[E+2]*HE+S[E+3]*dE)}return 27*(I+g+t+M+V)}}}}]);