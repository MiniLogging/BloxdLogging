/*! For license information please see 3b8e12.32.01bc9e53.chunk.js.LICENSE.txt */
(self["9s4i8ue3jq"]=self["9s4i8ue3jq"]||[]).push([[32],{14614:(a,c,o)=>{"use strict";var s=o(14622),q=o(14627),t=o(14633);o.g.__TYPEDARRAY_POOL||(o.g.__TYPEDARRAY_POOL={UINT8:q([32,0]),UINT16:q([32,0]),UINT32:q([32,0]),INT8:q([32,0]),INT16:q([32,0]),INT32:q([32,0]),FLOAT:q([32,0]),DOUBLE:q([32,0]),DATA:q([32,0]),UINT8C:q([32,0]),BUFFER:q([32,0])});var i="undefined"!==typeof Uint8ClampedArray,p=o.g.__TYPEDARRAY_POOL;p.UINT8C||(p.UINT8C=q([32,0])),p.BUFFER||(p.BUFFER=q([32,0]));var G=p.DATA,T=p.BUFFER;function C(a){if(a){var c=a.length||a.byteLength,o=s.log2(c);G[o].push(a)}}function j(a){a=s.nextPow2(a);var c=s.log2(a),o=G[c];return o.length>0?o.pop():new ArrayBuffer(a)}function L(a){return new Uint8Array(j(a),0,a)}function e(a){return new Uint16Array(j(2*a),0,a)}function g(a){return new Uint32Array(j(4*a),0,a)}function M(a){return new Int8Array(j(a),0,a)}function N(a){return new Int16Array(j(2*a),0,a)}function y(a){return new Int32Array(j(4*a),0,a)}function k(a){return new Float32Array(j(4*a),0,a)}function n(a){return new Float64Array(j(8*a),0,a)}function f(a){return i?new Uint8ClampedArray(j(a),0,a):L(a)}function J(a){return new DataView(j(a),0,a)}c.free=function(a){if(t(a))T[s.log2(a.length)].push(a);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(a)&&(a=a.buffer),!a)return;var c=a.length||a.byteLength,o=0|s.log2(c);G[o].push(a)}},c.freeUint8=c.freeUint16=c.freeUint32=c.freeInt8=c.freeInt16=c.freeInt32=c.freeFloat32=c.freeFloat=c.freeFloat64=c.freeDouble=c.freeUint8Clamped=c.freeDataView=function(a){C(a.buffer)},c.freeArrayBuffer=C,c.freeBuffer=function(a){T[s.log2(a.length)].push(a)},c.malloc=function(a,c){if(void 0===c||"arraybuffer"===c)return j(a);switch(c){case"uint8":return L(a);case"uint16":return e(a);case"uint32":return g(a);case"int8":return M(a);case"int16":return N(a);case"int32":return y(a);case"float":case"float32":return k(a);case"double":case"float64":return n(a);case"uint8_clamped":return f(a);case"buffer":throw"Buffer not supported";case"data":case"dataview":return J(a);default:return null}return null},c.mallocArrayBuffer=j,c.mallocUint8=L,c.mallocUint16=e,c.mallocUint32=g,c.mallocInt8=M,c.mallocInt16=N,c.mallocInt32=y,c.mallocFloat32=c.mallocFloat=k,c.mallocFloat64=c.mallocDouble=n,c.mallocUint8Clamped=f,c.mallocDataView=J,c.clearCache=function(){for(var a=0;a<32;++a)p.UINT8[a].length=0,p.UINT16[a].length=0,p.UINT32[a].length=0,p.INT8[a].length=0,p.INT16[a].length=0,p.INT32[a].length=0,p.FLOAT[a].length=0,p.DOUBLE[a].length=0,p.UINT8C[a].length=0,G[a].length=0,T[a].length=0}},14716:(a,c,o)=>{a.exports=q;var s=o(13610);function q(a,c){if(!(this instanceof q))return new q(a,c);var o=s.create();s.add(o,a,c),this.base=s.min(s.create(),a,o),this.PC=s.clone(c),this.max=s.max(s.create(),a,o),this.mag=s.length(this.PC)}var t=q.prototype;t.width=function(){return this.PC[0]},t.height=function(){return this.PC[1]},t.depth=function(){return this.PC[2]},t.x0=function(){return this.base[0]},t.y0=function(){return this.base[1]},t.z0=function(){return this.base[2]},t.x1=function(){return this.max[0]},t.y1=function(){return this.max[1]},t.z1=function(){return this.max[2]},t.translate=function(a){return s.add(this.max,this.max,a),s.add(this.base,this.base,a),this},t.setPosition=function(a){return s.add(this.max,a,this.PC),s.k(this.base,a),this},t.expand=function(a){var c=s.create(),o=s.create();return s.max(c,a.max,this.max),s.min(o,a.base,this.base),s.vc(c,c,o),new q(o,c)},t.intersects=function(a){return!(a.base[0]>this.max[0])&&(!(a.base[1]>this.max[1])&&(!(a.base[2]>this.max[2])&&(!(a.max[0]<this.base[0])&&(!(a.max[1]<this.base[1])&&!(a.max[2]<this.base[2])))))},t.touches=function(a){var c=this.union(a);return null!==c&&(0==c.width()||0==c.height()||0==c.depth())},t.union=function(a){if(!this.intersects(a))return null;var c=Math.max(a.base[0],this.base[0]),o=Math.max(a.base[1],this.base[1]),s=Math.max(a.base[2],this.base[2]);return new q([c,o,s],[Math.min(a.max[0],this.max[0])-c,Math.min(a.max[1],this.max[1])-o,Math.min(a.max[2],this.max[2])-s])}},14622:(a,c)=>{"use strict";function o(a){var c=32;return(a&=-a)&&c--,65535&a&&(c-=16),16711935&a&&(c-=8),252645135&a&&(c-=4),858993459&a&&(c-=2),1431655765&a&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(a){return(a>0)-(a<0)},c.abs=function(a){var c=a>>31;return(a^c)-c},c.min=function(a,c){return c^(a^c)&-(a<c)},c.max=function(a,c){return a^(a^c)&-(a<c)},c.isPow2=function(a){return!(a&a-1)&&!!a},c.log2=function(a){var c,o;return c=(a>65535)<<4,c|=o=((a>>>=c)>255)<<3,c|=o=((a>>>=o)>15)<<2,(c|=o=((a>>>=o)>3)<<1)|(a>>>=o)>>1},c.log10=function(a){return a>=1e9?9:a>=1e8?8:a>=1e7?7:a>=1e6?6:a>=1e5?5:a>=1e4?4:a>=1e3?3:a>=100?2:a>=10?1:0},c.popCount=function(a){return 16843009*((a=(858993459&(a-=a>>>1&1431655765))+(a>>>2&858993459))+(a>>>4)&252645135)>>>24},c.countTrailingZeros=o,c.nextPow2=function(a){return a+=0===a,--a,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)+1},c.prevPow2=function(a){return a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)-(a>>>1)},c.parity=function(a){return a^=a>>>16,a^=a>>>8,a^=a>>>4,27030>>>(a&=15)&1};var s=new Array(256);!function(a){for(var c=0;c<256;++c){var o=c,s=c,q=7;for(o>>>=1;o;o>>>=1)s<<=1,s|=1&o,--q;a[c]=s<<q&255}}(s),c.reverse=function(a){return s[255&a]<<24|s[a>>>8&255]<<16|s[a>>>16&255]<<8|s[a>>>24&255]},c.interleave2=function(a,c){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(a,c){return(a=65535&((a=16711935&((a=252645135&((a=858993459&((a=a>>>c&1431655765)|a>>>1))|a>>>2))|a>>>4))|a>>>16))<<16>>16},c.interleave3=function(a,c,o){return a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2),(a|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<2},c.deinterleave3=function(a,c){return(a=1023&((a=4278190335&((a=251719695&((a=3272356035&((a=a>>>c&1227133513)|a>>>2))|a>>>4))|a>>>8))|a>>>16))<<22>>22},c.nextCombination=function(a){var c=a|a-1;return c+1|(~c&-~c)-1>>>o(a)+1}},14607:(a,c,o)=>{"use strict";a.exports=function(a,c,o){switch(arguments.length){case 1:return s=[],T(q=a,q,C,!0),s;case 2:return"function"===typeof c?T(a,a,c,!0):function(a,c){return s=[],T(a,c,C,!1),s}(a,c);case 3:return T(a,c,o,!1);default:throw new Error("box-intersect: Invalid arguments")}var q};var s,q=o(14614),t=o(14641),i=o(14651);function p(a,c){for(var o=0;o<a;++o)if(!(c[o]<=c[o+a]))return!0;return!1}function G(a,c,o,s){for(var q=0,t=0,i=0,G=a.length;i<G;++i){var T=a[i];if(!p(c,T)){for(var C=0;C<2*c;++C)o[q++]=T[C];s[t++]=i}}return t}function T(a,c,o,s){var p=a.length,T=c.length;if(!(p<=0||T<=0)){var C=a[0].length>>>1;if(!(C<=0)){var j,L=q.mallocDouble(2*C*p),e=q.mallocInt32(p);if((p=G(a,C,L,e))>0){if(1===C&&s)t.init(p),j=t.sweepComplete(C,o,0,p,L,e,0,p,L,e);else{var g=q.mallocDouble(2*C*T),M=q.mallocInt32(T);(T=G(c,C,g,M))>0&&(t.init(p+T),j=1===C?t.sweepBipartite(C,o,0,p,L,e,0,T,g,M):i(C,o,s,p,L,e,T,g,M),q.free(g),q.free(M))}q.free(L),q.free(e)}return j}}}function C(a,c){s.push([a,c])}},14657:(a,c)=>{"use strict";var o="d",s="ax",q="fp",t="es",i="rs",p="re",G="rb",T="bs",C="be",j="bb",L=[o,s,"vv",i,p,G,"ri",T,C,j,"bi"];function e(a){var c="bruteForce"+(a?"Full":"Partial"),s=[],i=L.slice();a||i.splice(3,0,q);var p=["function "+c+"("+i.join()+"){"];function G(c,q){var i=function(a,c,s){var q="bruteForce"+(a?"Red":"Blue")+(c?"Flip":"")+(s?"Full":""),i=["function ",q,"(",L.join(),"){","var ",t,"=2*",o,";"],p="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",G="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(s?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return a?i.push(p,"Q",":",G):i.push(G,"Q",":",p),s?i.push("if(y1<x0||x1<y0)continue;"):c?i.push("if(y0<=x0||x1<y0)continue;"):i.push("if(y0<x0||x1<y0)continue;"),i.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),c?i.push("yi,xi"):i.push("xi,yi"),i.push(");if(rv!==void 0)return rv;}}}"),{name:q,code:i.join("")}}(c,q,a);s.push(i.code),p.push("return "+i.name+"("+L.join()+");")}p.push("if(re-rs>be-bs){"),a?(G(!0,!1),p.push("}else{"),G(!1,!1)):(p.push("if(fp){"),G(!0,!0),p.push("}else{"),G(!0,!1),p.push("}}else{if(fp){"),G(!1,!0),p.push("}else{"),G(!1,!1),p.push("}")),p.push("}}return "+c);var T=s.join("")+p.join("");return new Function(T)()}c.partial=e(!1),c.full=e(!0)},14651:(a,c,o)=>{"use strict";a.exports=function(a,c,o,t,C,r,x,R,d){!function(a,c){var o=8*q.log2(c+1)*(a+1)|0,t=q.nextPow2(f*o);w.length<t&&(s.free(w),w=s.mallocInt32(t));var i=q.nextPow2(J*o);Z.length<i&&(s.free(Z),Z=s.mallocDouble(i))}(a,t+x);var X,W=0,F=2*a;h(W++,0,0,t,0,x,o?16:0,-1/0,1/0),o||h(W++,0,0,x,0,t,1,-1/0,1/0);for(;W>0;){var O=(W-=1)*f,B=w[O],u=w[O+1],K=w[O+2],D=w[O+3],I=w[O+4],Y=w[O+5],P=W*J,ma=Z[P],V=Z[P+1],E=1&Y,H=!!(16&Y),b=C,A=r,v=R,l=d;if(E&&(b=R,A=d,v=C,l=r),!(2&Y&&u>=(K=N(a,B,u,K,b,A,V)))&&!(4&Y&&(u=y(a,B,u,K,b,A,ma))>=K)){var Q=K-u,z=I-D;if(H){if(a*Q*(Q+z)<e){if(void 0!==(X=G.scanComplete(a,B,c,u,K,b,A,D,I,v,l)))return X;continue}}else{if(a*Math.min(Q,z)<j){if(void 0!==(X=i(a,B,c,E,u,K,b,A,D,I,v,l)))return X;continue}if(a*Q*z<L){if(void 0!==(X=G.scanBipartite(a,B,c,E,u,K,b,A,D,I,v,l)))return X;continue}}var aa=g(a,B,u,K,b,A,ma,V);if(u<aa)if(a*(aa-u)<j){if(void 0!==(X=p(a,B+1,c,u,aa,b,A,D,I,v,l)))return X}else if(B===a-2){if(void 0!==(X=E?G.sweepBipartite(a,c,D,I,v,l,u,aa,b,A):G.sweepBipartite(a,c,u,aa,b,A,D,I,v,l)))return X}else h(W++,B+1,u,aa,D,I,E,-1/0,1/0),h(W++,B+1,D,I,u,aa,1^E,-1/0,1/0);if(aa<K){var ca=T(a,B,D,I,v,l),oa=v[F*ca+B],sa=M(a,B,ca,I,v,l,oa);if(sa<I&&h(W++,B,aa,K,sa,I,(4|E)+(H?16:0),oa,V),D<ca&&h(W++,B,aa,K,D,ca,(2|E)+(H?16:0),ma,oa),ca+1===sa){if(void 0!==(X=H?S(a,B,c,aa,K,b,A,ca,v,l[ca]):U(a,B,c,E,aa,K,b,A,ca,v,l[ca])))return X}else if(ca<sa){var qa;if(H){if(aa<(qa=k(a,B,aa,K,b,A,oa))){var ta=M(a,B,aa,qa,b,A,oa);if(B===a-2){if(aa<ta&&void 0!==(X=G.sweepComplete(a,c,aa,ta,b,A,ca,sa,v,l)))return X;if(ta<qa&&void 0!==(X=G.sweepBipartite(a,c,ta,qa,b,A,ca,sa,v,l)))return X}else aa<ta&&h(W++,B+1,aa,ta,ca,sa,16,-1/0,1/0),ta<qa&&(h(W++,B+1,ta,qa,ca,sa,0,-1/0,1/0),h(W++,B+1,ca,sa,ta,qa,1,-1/0,1/0))}}else aa<(qa=E?n(a,B,aa,K,b,A,oa):k(a,B,aa,K,b,A,oa))&&(B===a-2?X=E?G.sweepBipartite(a,c,ca,sa,v,l,aa,qa,b,A):G.sweepBipartite(a,c,aa,qa,b,A,ca,sa,v,l):(h(W++,B+1,aa,qa,ca,sa,E,-1/0,1/0),h(W++,B+1,ca,sa,aa,qa,1^E,-1/0,1/0)))}}}}};var s=o(14614),q=o(14622),t=o(14657),i=t.partial,p=t.full,G=o(14641),T=o(14664),C=o(14668),j=128,L=1<<22,e=1<<22,g=C("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),M=C("lo===p0",["p0"]),N=C("lo<p0",["p0"]),y=C("hi<=p0",["p0"]),k=C("lo<=p0&&p0<=hi",["p0"]),n=C("lo<p0&&p0<=hi",["p0"]),f=6,J=2,w=s.mallocInt32(1024),Z=s.mallocDouble(1024);function h(a,c,o,s,q,t,i,p,G){var T=f*a;w[T]=c,w[T+1]=o,w[T+2]=s,w[T+3]=q,w[T+4]=t,w[T+5]=i;var C=J*a;Z[C]=p,Z[C+1]=G}function U(a,c,o,s,q,t,i,p,G,T,C){var j=2*a,L=G*j,e=T[L+c];a:for(var g=q,M=q*j;g<t;++g,M+=j){var N=i[M+c],y=i[M+c+a];if(!(e<N||y<e)&&(!s||e!==N)){for(var k,n=p[g],f=c+1;f<a;++f){N=i[M+f],y=i[M+f+a];var J=T[L+f],w=T[L+f+a];if(y<J||w<N)continue a}if(void 0!==(k=s?o(C,n):o(n,C)))return k}}}function S(a,c,o,s,q,t,i,p,G,T){var C=2*a,j=p*C,L=G[j+c];a:for(var e=s,g=s*C;e<q;++e,g+=C){var M=i[e];if(M!==T){var N=t[g+c],y=t[g+c+a];if(!(L<N||y<L)){for(var k=c+1;k<a;++k){N=t[g+k],y=t[g+k+a];var n=G[j+k],f=G[j+k+a];if(y<n||f<N)continue a}var J=o(M,T);if(void 0!==J)return J}}}}},14664:(a,c,o)=>{"use strict";a.exports=function(a,c,o,i,p,G){if(i<=o+1)return o;var T=o,C=i,j=i+o>>>1,L=2*a,e=j,g=p[L*j+c];for(;T<C;){if(C-T<q){t(a,c,T,C,p,G),g=p[L*j+c];break}var M=C-T,N=Math.random()*M+T|0,y=p[L*N+c],k=Math.random()*M+T|0,n=p[L*k+c],f=Math.random()*M+T|0,J=p[L*f+c];y<=n?J>=n?(e=k,g=n):y>=J?(e=N,g=y):(e=f,g=J):n>=J?(e=k,g=n):J>=y?(e=N,g=y):(e=f,g=J);for(var w=L*(C-1),Z=L*e,h=0;h<L;++h,++w,++Z){var U=p[w];p[w]=p[Z],p[Z]=U}var S=G[C-1];G[C-1]=G[e],G[e]=S;for(w=L*(C-1),Z=L*(e=s(a,c,T,C-1,p,G,g)),h=0;h<L;++h,++w,++Z){U=p[w];p[w]=p[Z],p[Z]=U}S=G[C-1];if(G[C-1]=G[e],G[e]=S,j<e){for(C=e-1;T<C&&p[L*(C-1)+c]===g;)C-=1;C+=1}else{if(!(e<j))break;for(T=e+1;T<C&&p[L*T+c]===g;)T+=1}}return s(a,c,o,j,p,G,p[L*j+c])};var s=o(14668)("lo<p0",["p0"]),q=8;function t(a,c,o,s,q,t){for(var i=2*a,p=i*(o+1)+c,G=o+1;G<s;++G,p+=i)for(var T=q[p],C=G,j=i*(G-1);C>o&&q[j+c]>T;--C,j-=i){for(var L=j,e=j+i,g=0;g<i;++g,++L,++e){var M=q[L];q[L]=q[e],q[e]=M}var N=t[C];t[C]=t[C-1],t[C-1]=N}}},14668:a=>{"use strict";a.exports=function(a,o){var s="abcdef".split("").concat(o),q=[];a.indexOf("lo")>=0&&q.push("lo=e[k+n]");a.indexOf("hi")>=0&&q.push("hi=e[k+o]");return s.push(c.replace("_",q.join()).replace("$",a)),Function.apply(void 0,s)};var c="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14643:a=>{"use strict";a.exports=function(a,s){s<=4*c?o(0,s-1,a):T(0,s-1,a)};var c=32;function o(a,c,o){for(var s=2*(a+1),q=a+1;q<=c;++q){for(var t=o[s++],i=o[s++],p=q,G=s-2;p-- >a;){var T=o[G-2],C=o[G-1];if(T<t)break;if(T===t&&C<i)break;o[G]=T,o[G+1]=C,G-=2}o[G]=t,o[G+1]=i}}function s(a,c,o){c*=2;var s=o[a*=2],q=o[a+1];o[a]=o[c],o[a+1]=o[c+1],o[c]=s,o[c+1]=q}function q(a,c,o){c*=2,o[a*=2]=o[c],o[a+1]=o[c+1]}function t(a,c,o,s){c*=2,o*=2;var q=s[a*=2],t=s[a+1];s[a]=s[c],s[a+1]=s[c+1],s[c]=s[o],s[c+1]=s[o+1],s[o]=q,s[o+1]=t}function i(a,c,o,s,q){c*=2,q[a*=2]=q[c],q[c]=o,q[a+1]=q[c+1],q[c+1]=s}function p(a,c,o){c*=2;var s=o[a*=2],q=o[c];return!(s<q)&&(s!==q||o[a+1]>o[c+1])}function G(a,c,o,s){var q=s[a*=2];return q<c||q===c&&s[a+1]<o}function T(a,C,j){var L=(C-a+1)/6|0,e=a+L,g=C-L,M=a+C>>1,N=M-L,y=M+L,k=e,n=N,f=M,J=y,w=g,Z=a+1,h=C-1,U=0;p(k,n,j)&&(U=k,k=n,n=U),p(J,w,j)&&(U=J,J=w,w=U),p(k,f,j)&&(U=k,k=f,f=U),p(n,f,j)&&(U=n,n=f,f=U),p(k,J,j)&&(U=k,k=J,J=U),p(f,J,j)&&(U=f,f=J,J=U),p(n,w,j)&&(U=n,n=w,w=U),p(n,f,j)&&(U=n,n=f,f=U),p(J,w,j)&&(U=J,J=w,w=U);for(var S=j[2*n],r=j[2*n+1],x=j[2*J],R=j[2*J+1],d=2*k,X=2*f,W=2*w,F=2*e,O=2*M,B=2*g,u=0;u<2;++u){var K=j[d+u],D=j[X+u],I=j[W+u];j[F+u]=K,j[O+u]=D,j[B+u]=I}q(N,a,j),q(y,C,j);for(var Y=Z;Y<=h;++Y)if(G(Y,S,r,j))Y!==Z&&s(Y,Z,j),++Z;else if(!G(Y,x,R,j))for(;;){if(G(h,x,R,j)){G(h,S,r,j)?(t(Y,Z,h,j),++Z,--h):(s(Y,h,j),--h);break}if(--h<Y)break}i(a,Z-1,S,r,j),i(C,h+1,x,R,j),Z-2-a<=c?o(a,Z-2,j):T(a,Z-2,j),C-(h+2)<=c?o(h+2,C,j):T(h+2,C,j),h-Z<=c?o(Z,h,j):T(Z,h,j)}},14641:(a,c,o)=>{"use strict";a.exports={init:function(a){var c=q.nextPow2(a);G.length<c&&(s.free(G),G=s.mallocInt32(c));T.length<c&&(s.free(T),T=s.mallocInt32(c));C.length<c&&(s.free(C),C=s.mallocInt32(c));j.length<c&&(s.free(j),j=s.mallocInt32(c));L.length<c&&(s.free(L),L=s.mallocInt32(c));e.length<c&&(s.free(e),e=s.mallocInt32(c));var o=8*c;g.length<o&&(s.free(g),g=s.mallocDouble(o))},sweepBipartite:function(a,c,o,s,q,p,L,e,y,k){for(var n=0,f=2*a,J=a-1,w=f-1,Z=o;Z<s;++Z){var h=p[Z],U=f*Z;g[n++]=q[U+J],g[n++]=-(h+1),g[n++]=q[U+w],g[n++]=h}for(Z=L;Z<e;++Z){h=k[Z]+i;var S=f*Z;g[n++]=y[S+J],g[n++]=-h,g[n++]=y[S+w],g[n++]=h}var r=n>>>1;t(g,r);var x=0,R=0;for(Z=0;Z<r;++Z){var d=0|g[2*Z+1];if(d>=i)M(C,j,R--,d=d-i|0);else if(d>=0)M(G,T,x--,d);else if(d<=-i){d=-d-i|0;for(var X=0;X<x;++X){if(void 0!==(W=c(G[X],d)))return W}N(C,j,R++,d)}else{d=-d-1|0;for(X=0;X<R;++X){var W;if(void 0!==(W=c(d,C[X])))return W}N(G,T,x++,d)}}},sweepComplete:function(a,c,o,s,q,i,p,y,k,n){for(var f=0,J=2*a,w=a-1,Z=J-1,h=o;h<s;++h){var U=i[h]+1<<1,S=J*h;g[f++]=q[S+w],g[f++]=-U,g[f++]=q[S+Z],g[f++]=U}for(h=p;h<y;++h){U=n[h]+1<<1;var r=J*h;g[f++]=k[r+w],g[f++]=1|-U,g[f++]=k[r+Z],g[f++]=1|U}var x=f>>>1;t(g,x);var R=0,d=0,X=0;for(h=0;h<x;++h){var W=0|g[2*h+1],F=1&W;if(h<x-1&&W>>1===g[2*h+3]>>1&&(F=2,h+=1),W<0){for(var O=-(W>>1)-1,B=0;B<X;++B){if(void 0!==(u=c(L[B],O)))return u}if(0!==F)for(B=0;B<R;++B){if(void 0!==(u=c(G[B],O)))return u}if(1!==F)for(B=0;B<d;++B){var u;if(void 0!==(u=c(C[B],O)))return u}0===F?N(G,T,R++,O):1===F?N(C,j,d++,O):2===F&&N(L,e,X++,O)}else{O=(W>>1)-1;0===F?M(G,T,R--,O):1===F?M(C,j,d--,O):2===F&&M(L,e,X--,O)}}},scanBipartite:function(a,c,o,s,q,p,C,j,L,e,y,k){var n=0,f=2*a,J=c,w=c+a,Z=1,h=1;s?h=i:Z=i;for(var U=q;U<p;++U){var S=U+Z,r=f*U;g[n++]=C[r+J],g[n++]=-S,g[n++]=C[r+w],g[n++]=S}for(U=L;U<e;++U){S=U+h;var x=f*U;g[n++]=y[x+J],g[n++]=-S}var R=n>>>1;t(g,R);var d=0;for(U=0;U<R;++U){var X=0|g[2*U+1];if(X<0){var W=!1;if((S=-X)>=i?(W=!s,S-=i):(W=!!s,S-=1),W)N(G,T,d++,S);else{var F=k[S],O=f*S,B=y[O+c+1],u=y[O+c+1+a];a:for(var K=0;K<d;++K){var D=G[K],I=f*D;if(!(u<C[I+c+1]||C[I+c+1+a]<B)){for(var Y=c+2;Y<a;++Y)if(y[O+Y+a]<C[I+Y]||C[I+Y+a]<y[O+Y])continue a;var P,ma=j[D];if(void 0!==(P=s?o(F,ma):o(ma,F)))return P}}}}else M(G,T,d--,X-Z)}},scanComplete:function(a,c,o,s,q,p,T,C,j,L,e){for(var M=0,N=2*a,y=c,k=c+a,n=s;n<q;++n){var f=n+i,J=N*n;g[M++]=p[J+y],g[M++]=-f,g[M++]=p[J+k],g[M++]=f}for(n=C;n<j;++n){f=n+1;var w=N*n;g[M++]=L[w+y],g[M++]=-f}var Z=M>>>1;t(g,Z);var h=0;for(n=0;n<Z;++n){var U=0|g[2*n+1];if(U<0){if((f=-U)>=i)G[h++]=f-i;else{var S=e[f-=1],r=N*f,x=L[r+c+1],R=L[r+c+1+a];a:for(var d=0;d<h;++d){var X=G[d],W=T[X];if(W===S)break;var F=N*X;if(!(R<p[F+c+1]||p[F+c+1+a]<x)){for(var O=c+2;O<a;++O)if(L[r+O+a]<p[F+O]||p[F+O+a]<L[r+O])continue a;var B=o(W,S);if(void 0!==B)return B}}}}else{for(f=U-i,d=h-1;d>=0;--d)if(G[d]===f){for(O=d+1;O<h;++O)G[O-1]=G[O];break}--h}}}};var s=o(14614),q=o(14622),t=o(14643),i=1<<28,p=1024,G=s.mallocInt32(p),T=s.mallocInt32(p),C=s.mallocInt32(p),j=s.mallocInt32(p),L=s.mallocInt32(p),e=s.mallocInt32(p),g=s.mallocDouble(8192);function M(a,c,o,s){var q=c[s],t=a[o-1];a[q]=t,c[t]=q}function N(a,c,o,s){a[o]=s,c[s]=o}},14627:a=>{"use strict";function c(a,o,s){var q=0|a[s];if(q<=0)return[];var t,i=new Array(q);if(s===a.length-1)for(t=0;t<q;++t)i[t]=o;else for(t=0;t<q;++t)i[t]=c(a,o,s+1);return i}a.exports=function(a,o){switch("undefined"===typeof o&&(o=0),typeof a){case"number":if(a>0)return function(a,c){var o,s;for(o=new Array(a),s=0;s<a;++s)o[s]=c;return o}(0|a,o);break;case"object":if("number"===typeof a.length)return c(a,o,0)}return[]}},14577:(a,c,o)=>{a.exports=function(){var a=this;this.components={},this.comps=this.components;var c=this.components,o=1,q={},t=[],i=[],p={timeout:!1,removals:[],multiComps:[]};function G(a,o){var s=c[o],t=q[o],i=t.hash[a];i&&(t.remove(a),s.tc&&(s.multi?(i.forEach((c=>{c&&s.tc(a,c)})),i.length=0):s.tc(a,i)),p.removals.push(t),T())}function T(){p.timeout||(p.timeout=!0,setTimeout(C,1))}function C(){p.timeout=!1,j()}function j(){p.multiComps.length&&function(a){for(var c=0;c<a.length;c++){var{entID:o,data:s}=a[c],q=s.hash[o];if(q){for(var t=0;t<q.length;t++)q[t]||(q.splice(t,1),t--);0===q.length&&(s.remove(o),p.removals.push(s))}}a.length=0}(p.multiComps),p.removals.length&&function(a){for(var c=0;c<a.length;c++){a[c].flush()}a.length=0}(p.removals)}this.sL=q,this._systems=t,this._renderSystems=i,this.uT=function(c){var s=o++;return Array.isArray(c)&&c.forEach((c=>a.xT(s,c))),s},this.deleteEntity=function(c){return Object.keys(q).forEach((a=>{q[a].hash[c]&&G(c,a)})),a},this.pj=function(a){if(!a)throw new Error("Missing component definition");var o=a.name;if(!o)throw new Error("Component definition must have a name property.");if("string"!==typeof o)throw new Error("Component name must be a string.");if(""===o)throw new Error("Component name must be a non-empty string.");if(q[o])throw new Error(`Component ${o} already exists.`);var p={};return p.name=o,p.multi=!!a.multi,p.order=isNaN(a.order)?99:a.order,p.stateConstructor=a.stateConstructor||null,p.state=a.state||{},p.gt=a.gt||null,p.tc=a.tc||null,p.system=a.system||null,p.FG=a.FG||null,c[o]=p,q[o]=new s,q[o]._pendingMultiCleanup=!1,q[o]._multiCleanupIDs=p.multi?[]:null,p.system&&(t.push(o),t.sort(((a,o)=>c[a].order-c[o].order))),p.FG&&(i.push(o),i.sort(((a,o)=>c[a].order-c[o].order))),o},this.overwriteComponent=function(a,o){var s=c[a];if(!s)throw new Error(`Unknown component: ${a}`);if(!o)throw new Error("Missing component definition");if(s.name!==o.name)throw new Error("Overwriting component must use the same name property.");var p={};p.name=a,p.multi=!!o.multi,p.order=isNaN(o.order)?99:o.order,p.state=o.state||{},p.gt=o.gt||null,p.tc=o.tc||null,p.system=o.system||null,p.FG=o.FG||null,c[a]=p,q[a]._pendingMultiCleanup=!1,q[a]._multiCleanupIDs=p.multi?[]:null;var G=t.indexOf(a);p.system&&G<0&&t.push(a),!p.system&&G>=0&&t.splice(G,1),t.sort(((a,o)=>c[a].order-c[o].order));var T=i.indexOf(a);p.FG&&T<0&&i.push(a),!p.FG&&T>=0&&i.splice(T,1),i.sort(((a,o)=>c[a].order-c[o].order));var C=p.state;return this.SC(a).forEach((a=>{for(var c in C)c in a||(a[c]=C[c]);p.gt&&p.gt(a.XG,a)})),a},this.deleteComponent=function(o){var s=q[o];if(!s)throw new Error(`Unknown component: ${o}`);s.flush(),s.list.forEach((a=>{a&&G(a.XG||a[0].XG,o)}));var p=t.indexOf(o),T=i.indexOf(o);return p>-1&&t.splice(p,1),T>-1&&i.splice(T,1),q[o].dispose(),delete q[o],delete c[o],a},this.xT=function(a,o,s){var t,i=c[o],p=q[o];if(!p)throw new Error(`Unknown component: ${o}.`);if(p.hash[a]&&!i.multi)throw new Error(`Entity ${a} already has component: ${o}.`);if(i.stateConstructor){if(!(t=new i.stateConstructor).hasOwnProperty("XG"))throw new Error(`Component ${i.name} stateConstructor type does not have property __id`)}else t=Object.assign({},{XG:a},i.state,s);if(t.XG=a,i.multi){var G=p.hash[a];G||(G=[],p.add(a,G)),G.push(t)}else p.add(a,t);return i.gt&&i.gt(a,t),this},this.IT=function(a,c){var o=q[c];if(!o)throw new Error(`Unknown component: ${c}.`);return!!o.hash[a]},this.WT=function(c,o){if(!q[o])throw new Error(`Unknown component: ${o}.`);return G(c,o),a},this.getState=function(a,c){var o=q[c];if(!o)throw new Error(`Unknown component: ${c}.`);return o.hash[a]},this.SC=function(a){var c=q[a];if(!c)throw new Error(`Unknown component: ${a}.`);return j(),c.list},this.pg=function(a){if(!q[a])throw new Error(`Unknown component: ${a}.`);var c=q[a].hash;return a=>c[a]},this.eg=function(a){if(!q[a])throw new Error(`Unknown component: ${a}.`);var c=q[a].hash;return a=>!!c[a]},this.dG=function(o){j();for(var s=0;s<t.length;s++){var i=t[s],p=c[i],G=q[i];p.system(o,G.list),j()}return a},this.render=function(o){j();for(var s=0;s<i.length;s++){var t=i[s],p=c[t],G=q[t];p.FG(o,G.list),j()}return a},this.removeMultiComponent=function(o,s,t){var i=c[s],G=q[s];if(!G)throw new Error(`Unknown component: ${s}.`);if(!i.multi)throw new Error("removeMultiComponent called on non-multi component");return function(a,c,o,s){var q=o.hash[a];if(q){var t=q[s];t&&(q[s]=null,c.tc&&c.tc(a,t),p.multiComps.push({entID:a,data:o}),T())}}(o,i,G,t),a}};var s=o(14584)},14584:a=>{function c(a,c){var o=a._map[c];if(delete a.hash[c],delete a._map[c],o===a.list.length-1)a.list.pop();else{var s=a.list.pop();if(a.list[o]=s,null===s||null===s[0]){var q=a.list.length;for(var t in a._map)if(a._map[t]===q)return void(a._map[t]=o)}else{var i=s.XG||s[0].XG;a._map[i]=o}}}a.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(a,c){if("number"===typeof this._map[a]){var o=this._map[a];this.hash[a]=c,this.list[o]=c}else this._map[a]=this.list.length,this.hash[a]=c,this.list.push(c)}remove(a){var c=this._map[a];this.hash[a]=null,this.list[c]=null,this._pendingRemovals.push(a)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var a=0;a<this._pendingRemovals.length;a++){var o=this._pendingRemovals[a];null===this.hash[o]&&c(this,o)}this._pendingRemovals.length=0}}},14539:a=>{"use strict";var c,o="object"===typeof Reflect?Reflect:null,s=function(a,c,o){return Function.prototype.apply.call(a,c,o)};c=o&&"function"===typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:function(a){return Object.getOwnPropertyNames(a)};var q=Number.isNaN||function(a){return a!==a};function t(){t.init.call(this)}a.exports=t,a.exports.once=function(a,c){return new Promise((function(o,s){function q(o){a.removeListener(c,t),s(o)}function t(){"function"===typeof a.removeListener&&a.removeListener("error",q),o([].slice.call(arguments))}M(a,c,t,{once:!0}),"error"!==c&&function(a,c,o){"function"===typeof a.on&&M(a,"error",c,o)}(a,q,{once:!0})}))},t.EventEmitter=t,t.prototype._events=void 0,t.prototype._eventsCount=0,t.prototype._maxListeners=void 0;var i=10;function p(a){if("function"!==typeof a)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}function G(a){return void 0===a._maxListeners?t.defaultMaxListeners:a._maxListeners}function T(a,c,o,s){var q,t,i,T;if(p(o),void 0===(t=a._events)?(t=a._events=Object.create(null),a._eventsCount=0):(void 0!==t.newListener&&(a.emit("newListener",c,o.listener?o.listener:o),t=a._events),i=t[c]),void 0===i)i=t[c]=o,++a._eventsCount;else if("function"===typeof i?i=t[c]=s?[o,i]:[i,o]:s?i.unshift(o):i.push(o),(q=G(a))>0&&i.length>q&&!i.warned){i.warned=!0;var C=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");C.name="MaxListenersExceededWarning",C.sc=a,C.type=c,C.count=i.length,T=C,console&&console.warn&&console.warn(T)}return a}function C(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function j(a,c,o){var s={fired:!1,wrapFn:void 0,target:a,type:c,listener:o},q=C.bind(s);return q.listener=o,s.wrapFn=q,q}function L(a,c,o){var s=a._events;if(void 0===s)return[];var q=s[c];return void 0===q?[]:"function"===typeof q?o?[q.listener||q]:[q]:o?function(a){for(var c=new Array(a.length),o=0;o<c.length;++o)c[o]=a[o].listener||a[o];return c}(q):g(q,q.length)}function e(a){var c=this._events;if(void 0!==c){var o=c[a];if("function"===typeof o)return 1;if(void 0!==o)return o.length}return 0}function g(a,c){for(var o=new Array(c),s=0;s<c;++s)o[s]=a[s];return o}function M(a,c,o,s){if("function"===typeof a.on)s.once?a.once(c,o):a.on(c,o);else{if("function"!==typeof a.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a);a.addEventListener(c,(function q(t){s.once&&a.removeEventListener(c,q),o(t)}))}}Object.defineProperty(t,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(a){if("number"!==typeof a||a<0||q(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");i=a}}),t.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(a){if("number"!==typeof a||a<0||q(a))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+a+".");return this._maxListeners=a,this},t.prototype.getMaxListeners=function(){return G(this)},t.prototype.emit=function(a){for(var c=[],o=1;o<arguments.length;o++)c.push(arguments[o]);var q="error"===a,t=this._events;if(void 0!==t)q=q&&void 0===t.error;else if(!q)return!1;if(q){var i;if(c.length>0&&(i=c[0]),i instanceof Error)throw i;var p=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw p.context=i,p}var G=t[a];if(void 0===G)return!1;if("function"===typeof G)s(G,this,c);else{var T=G.length,C=g(G,T);for(o=0;o<T;++o)s(C[o],this,c)}return!0},t.prototype.addListener=function(a,c){return T(this,a,c,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(a,c){return T(this,a,c,!0)},t.prototype.once=function(a,c){return p(c),this.on(a,j(this,a,c)),this},t.prototype.prependOnceListener=function(a,c){return p(c),this.prependListener(a,j(this,a,c)),this},t.prototype.removeListener=function(a,c){var o,s,q,t,i;if(p(c),void 0===(s=this._events))return this;if(void 0===(o=s[a]))return this;if(o===c||o.listener===c)0===--this._eventsCount?this._events=Object.create(null):(delete s[a],s.removeListener&&this.emit("removeListener",a,o.listener||c));else if("function"!==typeof o){for(q=-1,t=o.length-1;t>=0;t--)if(o[t]===c||o[t].listener===c){i=o[t].listener,q=t;break}if(q<0)return this;0===q?o.shift():function(a,c){for(;c+1<a.length;c++)a[c]=a[c+1];a.pop()}(o,q),1===o.length&&(s[a]=o[0]),void 0!==s.removeListener&&this.emit("removeListener",a,i||c)}return this},t.prototype.off=t.prototype.removeListener,t.prototype.qc=function(a){var c,o,s;if(void 0===(o=this._events))return this;if(void 0===o.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==o[a]&&(0===--this._eventsCount?this._events=Object.create(null):delete o[a]),this;if(0===arguments.length){var q,t=Object.keys(o);for(s=0;s<t.length;++s)"removeListener"!==(q=t[s])&&this.qc(q);return this.qc("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(c=o[a]))this.removeListener(a,c);else if(void 0!==c)for(s=c.length-1;s>=0;s--)this.removeListener(a,c[s]);return this},t.prototype.listeners=function(a){return L(this,a,!0)},t.prototype.rawListeners=function(a){return L(this,a,!1)},t.listenerCount=function(a,c){return"function"===typeof a.listenerCount?a.listenerCount(c):e.call(a,c)},t.prototype.listenerCount=e,t.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]}},14992:a=>{"use strict";a.exports=function(a,c,o,s,q,t){var i=+c[0],p=+c[1],G=+c[2],T=+o[0],C=+o[1],j=+o[2],L=Math.sqrt(T*T+C*C+j*j);if(0===L)throw new Error("Can't raycast along a zero vector");return function(a,c,o,s,q,t,i,p,G,T){for(var C=0,j=Math.floor,L=0|j(c),e=0|j(o),g=0|j(s),M=q>0?1:-1,N=t>0?1:-1,y=i>0?1:-1,k=Math.abs(1/q),n=Math.abs(1/t),f=Math.abs(1/i),J=k<1/0?k*(M>0?L+1-c:c-L):1/0,w=n<1/0?n*(N>0?e+1-o:o-e):1/0,Z=f<1/0?f*(y>0?g+1-s:s-g):1/0,h=-1;C<=p;){var U=a(L,e,g);if(U)return G&&(G[0]=c+C*q,G[1]=o+C*t,G[2]=s+C*i),T&&(T[0]=T[1]=T[2]=0,0===h&&(T[0]=-M),1===h&&(T[1]=-N),2===h&&(T[2]=-y)),U;J<w?J<Z?(L+=M,C=J,J+=k,h=0):(g+=y,C=Z,Z+=f,h=2):w<Z?(e+=N,C=w,w+=n,h=1):(g+=y,C=Z,Z+=f,h=2)}return G&&(G[0]=c+C*q,G[1]=o+C*t,G[2]=s+C*i),T&&(T[0]=T[1]=T[2]=0),0}(a,i,p,G,T/=L,C/=L,j/=L,s="undefined"===typeof s?64:+s,q,t)}},15019:(a,c,o)=>{"use strict";o.d(c,{e:()=>t});var s=o(14539);function q(){this.EL=!1,this.stopPropagation=!1,this.HL=!1,this.disabled=!1}class t{constructor(a,c){this.version="0.7.0";var o=Object.assign({},new q,c||{});this.element=a||document,this.EL=!!o.EL,this.stopPropagation=!!o.stopPropagation,this.HL=!!o.HL,this.disabled=!!o.disabled,this.filterEvents=(a,c)=>!0,this.down=new s.EventEmitter,this.up=new s.EventEmitter,this.state={},this.JC={dx:0,dy:0,Ae:0,fC:0,ze:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?p(this):document.addEventListener("DOMContentLoaded",(a=>{p(this)}),{once:!0})}bind(a){for(var c=arguments.length,o=new Array(c>1?c-1:0),s=1;s<c;s++)o[s-1]=arguments[s];o.forEach((c=>{var o=this._keyBindmap[c]||[];o.includes(a)||(o.push(a),this._keyBindmap[c]=o)})),this.state[a]=!!this.state[a],this.pressCount[a]=this.pressCount[a]||0,this.releaseCount[a]=this.releaseCount[a]||0}unbind(a){for(var c in this._keyBindmap){var o=this._keyBindmap[c],s=o.indexOf(a);s>-1&&o.splice(s,1)}}getBindings(){var a={};for(var c in this._keyBindmap){this._keyBindmap[c].forEach((o=>{a[o]=a[o]||[],a[o].push(c)}))}return a}dG(){i(this.JC),i(this.pressCount),i(this.releaseCount)}}function i(a){for(var c in a)a[c]=0}function p(a){window.addEventListener("keydown",g.bind(null,a,!0),!1),window.addEventListener("keyup",g.bind(null,a,!1),!1);var c={passive:!0};a.element.addEventListener("touchstart",j.bind(void 0,a),{passive:!1}),a.element.addEventListener("touchend",e.bind(void 0,a),c),a.element.addEventListener("mousedown",M.bind(null,a,!0),c),window.document.addEventListener("mouseup",M.bind(null,a,!1),c),a.element.addEventListener("touchmove",N.bind(null,a),c),a.element.addEventListener("mousemove",N.bind(null,a),c),window.PointerEvent,a.element.addEventListener("wheel",y.bind(null,a),c),a.element.addEventListener("contextmenu",k.bind(null,a),!1),window.addEventListener("blur",n.bind(null,a),!1)}var G=0,T=0,C=null;function j(a,c){c.preventDefault(),L(c)}function L(a){let c=!1;for(let o=0;o<a.touches.length;++o)if(a.touches[o].identifier===C){c=!0;break}if(!c){const c=a.changedTouches[0];G=c.clientX,T=c.clientY,C=c.identifier}}function e(a,c){for(var o=c.changedTouches,s=0;s<o.length;++s)o[s].identifier===C&&(C=null)}function g(a,c,o){f(o.code,c,a,o)}function M(a,c,o){if("pointerId"in o)if(c){if(null!==a._touches.currID)return;a._touches.currID=o.pointerId}else{if(a._touches.currID!==o.pointerId)return;a._touches.currID=null}return f("Mouse"+("button"in o?o.button+1:1),c,a,o),!1}function N(a,c){var o=c.movementX||c.mozMovementX||0,s=c.movementY||c.mozMovementY||0;if(c.touches&&0===(o|s)){var q=function(a){L(a);for(let c=0;c<a.changedTouches.length;++c)if(a.changedTouches[c].identifier==C){const o=a.changedTouches[c],s=[o.clientX-G,o.clientY-T];return G=o.clientX,T=o.clientY,s}return console.error(`Did not find touch id ${C}`),[0,0]}(c);o=q[0],s=q[1]}a.JC.dx+=o,a.JC.dy+=s}function y(a,c){var o=1;switch(c.deltaMode){case 0:o=1;break;case 1:o=12;break;case 2:o=a.element.clientHeight||window.innerHeight}a.JC.Ae+=(c.deltaX||0)*o,a.JC.fC+=(c.deltaY||0)*o,a.JC.ze+=(c.deltaZ||0)*o}function k(a,c){if(!a.HL)return c.preventDefault(),!1}function n(a){for(var c in a._keyStates)a._keyStates[c]&&(/^Mouse\d/.test(c)||f(c,!1,a,{code:c,note:"sxyfpfavn8k",preventDefault:()=>{},stopPropagation:()=>{}}))}function f(a,c,o,s){var q=o._keyBindmap[a];q&&(J(o._keyStates[a],c)&&(o._keyStates[a]=c,q.forEach((a=>{(!o.filterEvents||o.filterEvents(s,a))&&function(a,c,o,s){var q=c?o.pressCount:o.releaseCount;q[a]=(q[a]||0)+1;var t=o._bindPressCount[a]||0;(t+=c?1:-1)<0&&(t=0);o._bindPressCount[a]=t;var i=o.state[a];if(J(i,t)){o.state[a]=t>0;var p=c?o.down:o.up;o.disabled||p.emit(a,s)}}(a,c,o,s)}))),"button"in s||(o.EL&&!s.defaultPrevented&&s.preventDefault(),o.stopPropagation&&s.stopPropagation()))}function J(a,c){return a?!c:c}},13683:a=>{a.exports=function(a,c,o){return a[0]=c[0]+o[0],a[1]=c[1]+o[1],a[2]=c[2]+o[2],a}},13631:(a,c,o)=>{a.exports=function(a,c){var o=s(a[0],a[1],a[2]),i=s(c[0],c[1],c[2]);q(o,o),q(i,i);var p=t(o,i);return p>1?0:Math.acos(p)};var s=o(13638),q=o(13647),t=o(13656)},13737:a=>{a.exports=function(a,c){return a[0]=Math.ceil(c[0]),a[1]=Math.ceil(c[1]),a[2]=Math.ceil(c[2]),a}},13628:a=>{a.exports=function(a){var c=new Float32Array(3);return c[0]=a[0],c[1]=a[1],c[2]=a[2],c}},13664:a=>{a.exports=function(a,c){return a[0]=c[0],a[1]=c[1],a[2]=c[2],a}},13626:a=>{a.exports=function(){var a=new Float32Array(3);return a[0]=0,a[1]=0,a[2]=0,a}},13824:a=>{a.exports=function(a,c,o){var s=c[0],q=c[1],t=c[2],i=o[0],p=o[1],G=o[2];return a[0]=q*G-t*p,a[1]=t*i-s*G,a[2]=s*p-q*i,a}},13763:(a,c,o)=>{a.exports=o(13758)},13758:a=>{a.exports=function(a,c){var o=c[0]-a[0],s=c[1]-a[1],q=c[2]-a[2];return Math.sqrt(o*o+s*s+q*q)}},13709:(a,c,o)=>{a.exports=o(13704)},13704:a=>{a.exports=function(a,c,o){return a[0]=c[0]/o[0],a[1]=c[1]/o[1],a[2]=c[2]/o[2],a}},13656:a=>{a.exports=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]}},13619:a=>{a.exports=1e-6},13673:(a,c,o)=>{a.exports=function(a,c){var o=a[0],q=a[1],t=a[2],i=c[0],p=c[1],G=c[2];return Math.abs(o-i)<=s*Math.max(1,Math.abs(o),Math.abs(i))&&Math.abs(q-p)<=s*Math.max(1,Math.abs(q),Math.abs(p))&&Math.abs(t-G)<=s*Math.max(1,Math.abs(t),Math.abs(G))};var s=o(13619)},13677:a=>{a.exports=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}},13729:a=>{a.exports=function(a,c){return a[0]=Math.floor(c[0]),a[1]=Math.floor(c[1]),a[2]=Math.floor(c[2]),a}},13862:(a,c,o)=>{a.exports=function(a,c,o,q,t,i){var p,G;c||(c=3);o||(o=0);G=q?Math.min(q*c+o,a.length):a.length;for(p=o;p<G;p+=c)s[0]=a[p],s[1]=a[p+1],s[2]=a[p+2],t(s,s,i),a[p]=s[0],a[p+1]=s[1],a[p+2]=s[2];return a};var s=o(13626)()},13638:a=>{a.exports=function(a,c,o){var s=new Float32Array(3);return s[0]=a,s[1]=c,s[2]=o,s}},13610:(a,c,o)=>{a.exports={EPSILON:o(13619),create:o(13626),clone:o(13628),angle:o(13631),fG:o(13638),k:o(13664),set:o(13669),equals:o(13673),exactEquals:o(13677),add:o(13683),vc:o(13687),sub:o(13695),multiply:o(13697),mul:o(13700),divide:o(13704),div:o(13709),min:o(13717),max:o(13725),floor:o(13729),ceil:o(13737),round:o(13745),scale:o(13750),JG:o(13753),distance:o(13758),i:o(13763),squaredDistance:o(13771),sqrDist:o(13778),length:o(13787),len:o(13795),squaredLength:o(13803),wG:o(13810),negate:o(13813),inverse:o(13821),normalize:o(13647),dot:o(13656),cross:o(13824),pG:o(13826),random:o(13835),transformMat4:o(13838),transformMat3:o(13844),transformQuat:o(13847),ZG:o(13852),hG:o(13854),UG:o(13857),forEach:o(13862)}},13821:a=>{a.exports=function(a,c){return a[0]=1/c[0],a[1]=1/c[1],a[2]=1/c[2],a}},13795:(a,c,o)=>{a.exports=o(13787)},13787:a=>{a.exports=function(a){var c=a[0],o=a[1],s=a[2];return Math.sqrt(c*c+o*o+s*s)}},13826:a=>{a.exports=function(a,c,o,s){var q=c[0],t=c[1],i=c[2];return a[0]=q+s*(o[0]-q),a[1]=t+s*(o[1]-t),a[2]=i+s*(o[2]-i),a}},13725:a=>{a.exports=function(a,c,o){return a[0]=Math.max(c[0],o[0]),a[1]=Math.max(c[1],o[1]),a[2]=Math.max(c[2],o[2]),a}},13717:a=>{a.exports=function(a,c,o){return a[0]=Math.min(c[0],o[0]),a[1]=Math.min(c[1],o[1]),a[2]=Math.min(c[2],o[2]),a}},13700:(a,c,o)=>{a.exports=o(13697)},13697:a=>{a.exports=function(a,c,o){return a[0]=c[0]*o[0],a[1]=c[1]*o[1],a[2]=c[2]*o[2],a}},13813:a=>{a.exports=function(a,c){return a[0]=-c[0],a[1]=-c[1],a[2]=-c[2],a}},13647:a=>{a.exports=function(a,c){var o=c[0],s=c[1],q=c[2],t=o*o+s*s+q*q;t>0&&(t=1/Math.sqrt(t),a[0]=c[0]*t,a[1]=c[1]*t,a[2]=c[2]*t);return a}},13835:a=>{a.exports=function(a,c){c=c||1;var o=2*Math.random()*Math.PI,s=2*Math.random()-1,q=Math.sqrt(1-s*s)*c;return a[0]=Math.cos(o)*q,a[1]=Math.sin(o)*q,a[2]=s*c,a}},13852:a=>{a.exports=function(a,c,o,s){var q=o[1],t=o[2],i=c[1]-q,p=c[2]-t,G=Math.sin(s),T=Math.cos(s);return a[0]=c[0],a[1]=q+i*T-p*G,a[2]=t+i*G+p*T,a}},13854:a=>{a.exports=function(a,c,o,s){var q=o[0],t=o[2],i=c[0]-q,p=c[2]-t,G=Math.sin(s),T=Math.cos(s);return a[0]=q+p*G+i*T,a[1]=c[1],a[2]=t+p*T-i*G,a}},13857:a=>{a.exports=function(a,c,o,s){var q=o[0],t=o[1],i=c[0]-q,p=c[1]-t,G=Math.sin(s),T=Math.cos(s);return a[0]=q+i*T-p*G,a[1]=t+i*G+p*T,a[2]=c[2],a}},13745:a=>{a.exports=function(a,c){return a[0]=Math.round(c[0]),a[1]=Math.round(c[1]),a[2]=Math.round(c[2]),a}},13750:a=>{a.exports=function(a,c,o){return a[0]=c[0]*o,a[1]=c[1]*o,a[2]=c[2]*o,a}},13753:a=>{a.exports=function(a,c,o,s){return a[0]=c[0]+o[0]*s,a[1]=c[1]+o[1]*s,a[2]=c[2]+o[2]*s,a}},13669:a=>{a.exports=function(a,c,o,s){return a[0]=c,a[1]=o,a[2]=s,a}},13778:(a,c,o)=>{a.exports=o(13771)},13810:(a,c,o)=>{a.exports=o(13803)},13771:a=>{a.exports=function(a,c){var o=c[0]-a[0],s=c[1]-a[1],q=c[2]-a[2];return o*o+s*s+q*q}},13803:a=>{a.exports=function(a){var c=a[0],o=a[1],s=a[2];return c*c+o*o+s*s}},13695:(a,c,o)=>{a.exports=o(13687)},13687:a=>{a.exports=function(a,c,o){return a[0]=c[0]-o[0],a[1]=c[1]-o[1],a[2]=c[2]-o[2],a}},13844:a=>{a.exports=function(a,c,o){var s=c[0],q=c[1],t=c[2];return a[0]=s*o[0]+q*o[3]+t*o[6],a[1]=s*o[1]+q*o[4]+t*o[7],a[2]=s*o[2]+q*o[5]+t*o[8],a}},13838:a=>{a.exports=function(a,c,o){var s=c[0],q=c[1],t=c[2],i=o[3]*s+o[7]*q+o[11]*t+o[15];return i=i||1,a[0]=(o[0]*s+o[4]*q+o[8]*t+o[12])/i,a[1]=(o[1]*s+o[5]*q+o[9]*t+o[13])/i,a[2]=(o[2]*s+o[6]*q+o[10]*t+o[14])/i,a}},13847:a=>{a.exports=function(a,c,o){var s=c[0],q=c[1],t=c[2],i=o[0],p=o[1],G=o[2],T=o[3],C=T*s+p*t-G*q,j=T*q+G*s-i*t,L=T*t+i*q-p*s,e=-i*s-p*q-G*t;return a[0]=C*T+e*-i+j*-G-L*-p,a[1]=j*T+e*-p+L*-i-C*-G,a[2]=L*T+e*-G+C*-p-j*-i,a}},14558:a=>{"use strict";a.exports=function(a){for(var c=new Array(a),o=0;o<a;++o)c[o]=o;return c}},14633:a=>{a.exports=function(a){return null!=a&&null!=a.constructor&&"function"===typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}},14995:(a,c,o)=>{"use strict";o.d(c,{e:()=>s});class s{constructor(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.rj=!1,this.xj=!1,this.Uj=30,this.Sj=0,this.uj=!1,this.fullscreen=!1,this.dj=function(a){},this.Xj=function(){},this.Oj=function(){},this.Gc=function(){},this.Wj=function(a){},this.onFullscreenChanged=function(a){},T((()=>{!function(a,c){a._nowObject=performance||Date,a._lastTick=0,a._renderAccum=0,a._rt=0,a._frameCB=p.bind(null,a),requestAnimationFrame(a._frameCB),c>0&&(a._intervalCB=i.bind(null,a),a._interval=setInterval(a._intervalCB,Math.max(c,1e3/a.Uj/2)))}(this,c),function(a,c){if(!c)return;var o=!1,s=!1;document.addEventListener("pointerlockchange",(s=>{o=document.pointerLockElement===c,a.Wj(o)})),document.addEventListener("fullscreenchange",(o=>{s=document.fullscreenElement===c,a.onFullscreenChanged(s)})),Object.defineProperty(a,"uj",{get:()=>o,set:a=>{a&&!o?G(c):o&&!a&&function(a){a.exitPointerLock&&a.exitPointerLock()}(document)}}),Object.defineProperty(a,"fullscreen",{get:()=>s,set:a=>{a&&!s?c.requestFullscreen():s&&!a&&document.exitFullscreen()}}),c.addEventListener("click",(q=>{a.rj&&!o&&G(c),a.xj&&!s&&c.requestFullscreen()}));var q=()=>a.Gc();if(window.ResizeObserver){new ResizeObserver(q).observe(c)}else window.addEventListener("resize",q)}(this,a),this.Oj()}))}}var q=3,t=20;function i(a){for(var c=1e3/a.Uj,o=a._nowObject.now()+t,s=0;a._nowObject.now()>=a._lastTick+c&&a._nowObject.now()<o&&++s<=q;)a.dj(c),a._lastTick+=c;var i=5*(c+5),p=a._nowObject.now();if(p-a._lastTick>i)for(;p>=a._lastTick+c;)a._lastTick+=c}function p(a){requestAnimationFrame(a._frameCB),i(a);var c=a._nowObject.now(),o=c-a._rt;if(a._rt=c,a.Sj>0){a._renderAccum+=o;var s=1e3/a.Sj;if(a._renderAccum<s)return;a._renderAccum=Math.min(a._renderAccum-s,s)}var q=1e3/a.Uj,t=(c-a._lastTick)/q;a.Xj(o,t,q)}function G(a){a.requestPointerLock&&a.requestPointerLock()}var T=a=>{if("loading"===document.readyState){var c=()=>{document.removeEventListener("readystatechange",c),a()};document.addEventListener("readystatechange",c)}else setTimeout(a,1)}},14549:(a,c,o)=>{var s=o(14558),q=o(14563),t="undefined"!==typeof Float64Array;function i(a,c){return a[0]-c[0]}function p(){var a,c=this.stride,o=new Array(c.length);for(a=0;a<o.length;++a)o[a]=[Math.abs(c[a]),a];o.sort(i);var s=new Array(o.length);for(a=0;a<s.length;++a)s[a]=o[a][1];return s}function G(a,c){var o=["View",c,"d",a].join("");c<0&&(o="View_Nil"+a);var q="generic"===a;if(-1===c){var t="function "+o+"(a){this.data=a;};var proto="+o+".prototype;proto.dtype='"+a+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+o+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+o+"(a){return new "+o+"(a);}";return new Function(t)()}if(0===c){t="function "+o+"(a,d) {this.data = a;this.offset = d};var proto="+o+".prototype;proto.dtype='"+a+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+o+"_copy() {return new "+o+"(this.data,this.offset)};proto.pick=function "+o+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+o+"_get(){return "+(q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+o+"_set(v){return "+(q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+o+"(a,b,c,d){return new "+o+"(a,d)}";return new Function("TrivialArray",t)(T[a][0])}t=["'use strict'"];var i=s(c),G=i.map((function(a){return"i"+a})),C="this.offset+"+i.map((function(a){return"this.stride["+a+"]*i"+a})).join("+"),j=i.map((function(a){return"b"+a})).join(","),L=i.map((function(a){return"c"+a})).join(",");t.push("function "+o+"(a,"+j+","+L+",d){this.data=a","this.shape=["+j+"]","this.stride=["+L+"]","this.offset=d|0}","var proto="+o+".prototype","proto.dtype='"+a+"'","proto.dimension="+c),t.push("Object.defineProperty(proto,'size',{get:function "+o+"_size(){return "+i.map((function(a){return"this.shape["+a+"]"})).join("*"),"}})"),1===c?t.push("proto.order=[0]"):(t.push("Object.defineProperty(proto,'order',{get:"),c<4?(t.push("function "+o+"_order(){"),2===c?t.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&t.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):t.push("ORDER})")),t.push("proto.set=function "+o+"_set("+G.join(",")+",v){"),q?t.push("return this.data.set("+C+",v)}"):t.push("return this.data["+C+"]=v}"),t.push("proto.get=function "+o+"_get("+G.join(",")+"){"),q?t.push("return this.data.get("+C+")}"):t.push("return this.data["+C+"]}"),t.push("proto.index=function "+o+"_index(",G.join(),"){return "+C+"}"),t.push("proto.hi=function "+o+"_hi("+G.join(",")+"){return new "+o+"(this.data,"+i.map((function(a){return["(typeof i",a,"!=='number'||i",a,"<0)?this.shape[",a,"]:i",a,"|0"].join("")})).join(",")+","+i.map((function(a){return"this.stride["+a+"]"})).join(",")+",this.offset)}");var e=i.map((function(a){return"a"+a+"=this.shape["+a+"]"})),g=i.map((function(a){return"c"+a+"=this.stride["+a+"]"}));t.push("proto.lo=function "+o+"_lo("+G.join(",")+"){var b=this.offset,d=0,"+e.join(",")+","+g.join(","));for(var M=0;M<c;++M)t.push("if(typeof i"+M+"==='number'&&i"+M+">=0){d=i"+M+"|0;b+=c"+M+"*d;a"+M+"-=d}");t.push("return new "+o+"(this.data,"+i.map((function(a){return"a"+a})).join(",")+","+i.map((function(a){return"c"+a})).join(",")+",b)}"),t.push("proto.step=function "+o+"_step("+G.join(",")+"){var "+i.map((function(a){return"a"+a+"=this.shape["+a+"]"})).join(",")+","+i.map((function(a){return"b"+a+"=this.stride["+a+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(M=0;M<c;++M)t.push("if(typeof i"+M+"==='number'){d=i"+M+"|0;if(d<0){c+=b"+M+"*(a"+M+"-1);a"+M+"=ceil(-a"+M+"/d)}else{a"+M+"=ceil(a"+M+"/d)}b"+M+"*=d}");t.push("return new "+o+"(this.data,"+i.map((function(a){return"a"+a})).join(",")+","+i.map((function(a){return"b"+a})).join(",")+",c)}");var N=new Array(c),y=new Array(c);for(M=0;M<c;++M)N[M]="a[i"+M+"]",y[M]="b[i"+M+"]";t.push("proto.transpose=function "+o+"_transpose("+G+"){"+G.map((function(a,c){return a+"=("+a+"===undefined?"+c+":"+a+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+o+"(this.data,"+N.join(",")+","+y.join(",")+",this.offset)}"),t.push("proto.pick=function "+o+"_pick("+G+"){var a=[],b=[],c=this.offset");for(M=0;M<c;++M)t.push("if(typeof i"+M+"==='number'&&i"+M+">=0){c=(c+this.stride["+M+"]*i"+M+")|0}else{a.push(this.shape["+M+"]);b.push(this.stride["+M+"])}");return t.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),t.push("return function construct_"+o+"(data,shape,stride,offset){return new "+o+"(data,"+i.map((function(a){return"shape["+a+"]"})).join(",")+","+i.map((function(a){return"stride["+a+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",t.join("\n"))(T[a],p)}var T={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};a.exports=function(a,c,o,s){if(void 0===a)return(0,T.array[0])([]);"number"===typeof a&&(a=[a]),void 0===c&&(c=[a.length]);var i=c.length;if(void 0===o){o=new Array(i);for(var p=i-1,C=1;p>=0;--p)o[p]=C,C*=c[p]}if(void 0===s){s=0;for(p=0;p<i;++p)o[p]<0&&(s-=(c[p]-1)*o[p])}for(var j=function(a){if(q(a))return"buffer";if(t)switch(Object.prototype.toString.call(a)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(a)?"array":"generic"}(a),L=T[j];L.length<=i+1;)L.push(G(j,L.length-1));return(0,L[i+1])(a,c,o,s)}},14563:a=>{function c(a){return!!a.constructor&&"function"===typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}a.exports=function(a){return null!=a&&(c(a)||function(a){return"function"===typeof a.readFloatLE&&"function"===typeof a.slice&&c(a.slice(0,0))}(a)||!!a._isBuffer)}},14719:a=>{"use strict";var c=[],o=[],s=[],q=[],t=[],i=[],p=[],G=[],T=[],C=[],j=[],L=[];a.exports=function(a,e,g,M,N,y){for(var k=p,n=T,f=C,J=L,w=0;w<3;w++)k[w]=+g[w],f[w]=+e.max[w],n[w]=+e.base[w];y||(y=1e-10);var Z=function(a,p,T,C,L,e){var g=c,M=o,N=s,y=q,k=t,n=i,f=G,J=Math.floor,w=0,Z=0,h=0,U=0,S=0;if(r(),0===h)return 0;for(U=d();Z<=h;){if(x(U)&&R())return w;U=d()}for(w+=h,S=0;S<3;S++)C[S]+=T[S],L[S]+=T[S];return w;function r(){if(Z=0,0!==(h=Math.sqrt(T[0]*T[0]+T[1]*T[1]+T[2]*T[2])))for(var a=0;a<3;a++){var c=T[a]>=0;y[a]=c?1:-1;var o=c?L[a]:C[a];g[a]=c?C[a]:L[a],M[a]=X(o,y[a]),N[a]=W(g[a],y[a]),f[a]=T[a]/h,k[a]=Math.abs(1/f[a]);var s=c?M[a]+1-o:o-M[a];n[a]=k[a]<1/0?k[a]*s:1/0}}function x(c){for(var o=y[0],s=0===c?M[0]:N[0],q=M[0]+o,t=y[1],i=1===c?M[1]:N[1],p=M[1]+t,G=y[2],T=2===c?M[2]:N[2],C=M[2]+G,j=s;j!=q;j+=o)for(var L=i;L!=p;L+=t)for(var e=T;e!=C;e+=G)if(a(j,L,e))return!0;return!1}function R(){w+=Z;var a=y[U],c=Z/h,o=j;for(S=0;S<3;S++){var s=T[S]*c;C[S]+=s,L[S]+=s,o[S]=T[S]-s}if(a>0?L[U]=Math.round(L[U]):C[U]=Math.round(C[U]),p(w,U,a,o))return!0;for(S=0;S<3;S++)T[S]=o[S];return r(),0===h}function d(){var a=n[0]<n[1]?n[0]<n[2]?0:2:n[1]<n[2]?1:2,c=n[a]-Z;for(Z=n[a],M[a]+=y[a],n[a]+=k[a],S=0;S<3;S++)g[S]+=c*f[S],N[S]=W(g[S],y[S]);return a}function X(a,c){return J(a-c*e)}function W(a,c){return J(a+c*e)}}(a,M,k,n,f,y);if(!N){for(w=0;w<3;w++)J[w]=g[w]>0?f[w]-e.max[w]:n[w]-e.base[w];e.translate(J)}return Z}},15023:(a,c,o)=>{"use strict";o.d(c,{b:()=>j});var s=o(14716),q=o(13610);class t{constructor(a,c,o,t,i,p,G){this.UC=new s(a.base,a.PC),this.Xt=c,this.friction=o,this.restitution=t,this.aG=i,this.xg=p,this.cG=!!G,this.YC=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.fM=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.VT=q.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=q.create(),this._impulses=q.create(),this._sleepFrameCount=10}loadFromCopy(a){q.k(this.UC.base,a.UC.base),q.k(this.UC.PC,a.UC.PC),q.k(this.UC.max,a.UC.max),this.UC.mag=a.UC.mag,this.Xt=a.Xt,this.friction=a.friction,this.restitution=a.restitution,this.aG=a.aG,this.xg=a.xg,this.cG=a.cG,this.YC=a.YC,this.fluidDrag=a.fluidDrag,this.fM=a.fM,this.preventFallOffEdge=a.preventFallOffEdge,this.rolledBackLastTick=a.rolledBackLastTick,q.k(this.VT,a.VT),q.k(this.resting,a.resting),this.inFluid=a.inFluid,this._ratioInFluid=a._ratioInFluid,q.k(this._forces,a._forces),q.k(this._impulses,a._impulses),this._sleepFrameCount=a._sleepFrameCount}setPosition(a){i(a),q.vc(a,a,this.UC.base),this.UC.translate(a),this.ET()}Tc(){return q.clone(this.UC.base)}applyForce(a){i(a),q.add(this._forces,this._forces,a),this.ET()}applyImpulse(a){i(a),q.add(this._impulses,this._impulses,a),this.ET()}ET(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var i=a=>{};var p=o(14716),G=o(13610),T=o(14719);function C(){this.YC=.1,this.fluidDrag=.4,this.iG=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function j(a,c,o){a=Object.assign(new C,a),this.gravity=a.gravity||[0,-10,0],this.YC=a.YC||.1,this.iG=a.iG||2,this.fluidDrag=a.fluidDrag||.4,this.minBounceImpulse=a.minBounceImpulse,this.bodies=[],this.Fe=a.Fe,this.testSolid=c,this.testFluid=o}j.prototype.Ig=function(a,c,o,s,q,i){a=a||new p([0,0,0],[1,1,1]),"undefined"==typeof c&&(c=1),"undefined"==typeof o&&(o=1),"undefined"==typeof s&&(s=0),"undefined"==typeof q&&(q=1);var G=new t(a,c,o,s,q,i);return this.bodies.push(G),G},j.prototype.Pg=function(a){var c=this.bodies.indexOf(a);c<0||(this.bodies.splice(c,1),a.UC=a.xg=null)};var L=G.create(),e=G.create(),g=G.create(),M=G.create(),N=G.create(),y=G.create(),k=G.create(),n=new p([0,0,0],[1,1,1]),f=new t(n,1,1,0,1,(()=>{}),!1);function J(a,c,o){return c=o,c*=1-(1-a.ratioInFluid)**2}j.prototype.dG=function(a){a/=1e3;var c=K(0,G.squaredLength(this.gravity));this.bodies.forEach((o=>function(a,c,o,s){G.k(N,c.resting),a.Fe&&f.loadFromCopy(c);if(c.Xt<=0)return G.set(c.VT,0,0,0),G.set(c._forces,0,0,0),void G.set(c._impulses,0,0,0);var q=s||0===c.aG;if(function(a,c,o,s){if(c._sleepFrameCount>0)return!1;if(s)return!0;var q=!1,t=.5*o*o*c.aG;return G.scale(u,a.gravity,t),T(a.testSolid,c.UC,u,(function(){return q=!0,!0}),!0),q}(a,c,o,q))return;c._sleepFrameCount--,function(a,c){var o=c.UC,s=Math.floor(o.base[0]),q=Math.floor(o.base[2]),t=Math.floor(o.base[1]),i=Math.floor(o.max[1]);if(!a.testFluid(s,t,q))return c.inFluid=!1,void(c.ratioInFluid=0);var p=1,T=t+1;for(;T<=i&&a.testFluid(s,T,q);)p++,T++;var C=(t+p-o.base[1])/o.PC[1];C>1&&(C=1);var j=o.PC[0]*o.PC[1]*o.PC[2]*C,L=Z;G.scale(L,a.gravity,-a.iG*j*c.aG),c.applyForce(L),c.inFluid=!0,c.ratioInFluid=C}(a,c),I(c._forces),I(c._impulses),I(c.VT),I(c.resting),G.scale(L,c._forces,1/c.Xt),G.JG(L,L,a.gravity,c.aG),G.scale(e,c._impulses,1/c.Xt),G.JG(e,e,L,o),G.add(c.VT,c.VT,e),c.friction&&(h(a,0,c,e,o),h(a,1,c,e,o),h(a,2,c,e,o));var t=c.fluidDrag>=0?c.fluidDrag:a.fluidDrag,i=c.YC>=0?c.YC:a.YC,p=i,C=i;c.inFluid&&(p=J(c,p,c.fluidDragHoriz>=0?c.fluidDragHoriz:t),C=J(c,C,c.fluidDragVert>=0?c.fluidDragVert:t));p=Math.max(1-p*o/c.Xt,0),C=Math.max(1-C*o/c.Xt,0),G.set(w,p,C,p),G.multiply(c.VT,c.VT,w),G.scale(g,c.VT,o),G.set(c._forces,0,0,0),G.set(c._impulses,0,0,0),c.cG&&D(r,c.UC);G.k(y,g),G.set(k,0,0,0),c.preventFallOffEdge&&function(a,c,o,s){if(!c.resting[1]||o[1]>0)return;var q=F;D(q,c.UC);for(var t=0;t<3;t+=2){G.set(W,0,0,0),W[t]=o[t];var i=!0;(i=(i=(i=(i=i&&!B(a,q.base[0]+W[0]+1e-5,q.base[1],q.base[2]+W[2]+1e-5))&&!B(a,q.max[0]+W[0]-1e-5,q.base[1],q.base[2]+W[2]+1e-5))&&!B(a,q.base[0]+W[0]+1e-5,q.base[1],q.max[2]+W[2]-1e-5))&&!B(a,q.max[0]+W[0]-1e-5,q.base[1],q.max[2]+W[2]-1e-5))?(s[t]=o[t]>0?1:-1,o[t]=0):0===t&&(G.set(O,o[0],0,0),S(a,q,O,s,c.slideOnCollision))}}(a,c,g,k);S(a,c.UC,g,c.resting,c.slideOnCollision),c.cG&&function(a,c,o,s){if(c.resting[1]>=0&&!c.inFluid)return;var q=0!==c.resting[0],t=0!==c.resting[2];if(!q&&!t)return;var i=Math.abs(s[0]/s[2]),p=4;if(!q&&i>p)return;if(!t&&i<1/p)return;G.add(R,o.base,s);var C=a.testSolid;T(C,o,s,(function(a,c,o,s){if(1!==c)return!0;s[c]=0}));var j=o.base[1],L=c.inFluid?1.951:1.001,e=Math.floor(j+L)-j;G.set(d,0,e,0);var g=!1;if(T(C,o,d,(function(a,c,o,s){return g=!0,!0})),g)return;G.vc(X,R,o.base),X[1]=0,S(a,o,X,x,!0);var M=K(o.base[0],R[0]),N=K(o.base[2],R[2]);if(q&&!M&&(!N||!t))return;if(t&&(!M||!q)&&!N)return;var y=!0;if(y=y&&!B(a,o.base[0]+1e-5,o.base[1],o.base[2]+1e-5),y=y&&!B(a,o.max[0]-1e-5,o.base[1],o.base[2]+1e-5),y=y&&!B(a,o.base[0]+1e-5,o.base[1],o.max[2]-1e-5),y=y&&!B(a,o.max[0]-1e-5,o.base[1],o.max[2]-1e-5),y)return;D(c.UC,o),c.resting[0]=x[0],c.resting[2]=x[2],c.fM&&c.fM()}(a,c,r,y);for(var j=0;j<3;++j)c.resting[j]=c.resting[j]||k[j],M[j]=0,c.resting[j]&&(N[j]||(M[j]=-c.VT[j]),c.VT[j]=0);var n=G.length(M);n>.001&&(G.scale(M,M,c.Xt),c.xg&&c.xg(M),c.restitution>0&&n>a.minBounceImpulse&&(G.scale(M,M,c.restitution),c.applyImpulse(M)));var U=G.squaredLength(c.VT);U>1e-5&&c.ET();a.Fe&&a.Fe(c)?(c.loadFromCopy(f),c.rolledBackLastTick=!0):c.rolledBackLastTick=!1}(this,o,a,c)))};var w=G.create([0,0,0]);var Z=G.create();function h(a,c,o,s,q){var t=o.resting[c],i=s[c];if(!o.alwaysApplyHorizFriction||1!==c){if(0===t)return;if(t*i<=0)return}G.k(U,o.VT),U[c]=0;var p=G.length(U);if(!K(p,0)){var T=Math.abs(o.friction*a.gravity[c]*q),C=p>T?(p-T)/p:0;o.VT[(c+1)%3]*=C,o.VT[(c+2)%3]*=C}}var U=G.create();function S(a,c,o,s,q){return G.set(s,0,0,0),T(a.testSolid,c,o,(function(a,c,o,t){s[c]=o,t[c]=0,q||(t[0]=0,t[1]=0,t[2]=0)}))}var r=new p([],[]),x=G.create(),R=G.create(),d=G.create(),X=G.create();var W=G.create(),F=new p([],[]),O=G.create();function B(a,c,o,s){return a.testSolid(Math.floor(c),Math.floor(o-1),Math.floor(s))}var u=G.create();function K(a,c){return Math.abs(a-c)<1e-5}function D(a,c){for(var o=0;o<3;o++)a.base[o]=c.base[o],a.max[o]=c.max[o],a.PC[o]=c.PC[o]}var I=function(a){}},13474:function(a,c){!function(a){"use strict";var c=function(a,o){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&(a[o]=c[o])},c(a,o)};function o(a,o){if("function"!==typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function s(){this.constructor=a}c(a,o),a.prototype=null===o?Object.create(o):(s.prototype=o.prototype,new s)}function s(a,c,o,s){var q,t=arguments.length,i=t<3?c:null===s?s=Object.getOwnPropertyDescriptor(c,o):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)i=Reflect.decorate(a,c,o,s);else for(var p=a.length-1;p>=0;p--)(q=a[p])&&(i=(t<3?q(i):t>3?q(c,o,i):q(c,o))||i);return t>3&&i&&Object.defineProperty(c,o,i),i}function q(a,c,o){if(o||2===arguments.length)for(var s,q=0,t=c.length;q<t;q++)!s&&q in c||(s||(s=Array.prototype.slice.call(c,0,q)),s[q]=c[q]);return a.concat(s||Array.prototype.slice.call(c))}var t,i=255,p=213;a.OPERATION=void 0,(t=a.OPERATION||(a.OPERATION={}))[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR";var G=function(){function c(a,c,o){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=a,this.setParent(c,o)}return c.prototype.setParent=function(a,c,o){var s=this;if(this.indexes||(this.indexes=this.ref instanceof Xa?this.ref._definition.indexes:{}),this.parent=a,this.parentIndex=o,c)if(this.root=c,this.ref instanceof Xa){var q=this.ref._definition;for(var t in q.schema){var i=this.ref[t];if(i&&i.$changes){var p=q.indexes[t];i.$changes.setParent(this.ref,c,p)}}}else"object"===typeof this.ref&&this.ref.forEach((function(a,c){if(a instanceof Xa){var o=a.$changes,q=s.ref.$changes.indexes[c];o.setParent(s.ref,s.root,q)}}))},c.prototype.operation=function(a){this.changes.set(--this.currentCustomOperation,a)},c.prototype.change=function(c,o){void 0===o&&(o=a.OPERATION.ADD);var s="number"===typeof c?c:this.indexes[c];this.assertValidIndex(s,c);var q=this.changes.get(s);q&&q.op!==a.OPERATION.DELETE&&q.op!==a.OPERATION.TOUCH||this.changes.set(s,{op:q&&q.op===a.OPERATION.DELETE?a.OPERATION.DELETE_AND_ADD:o,index:s}),this.allChanges.add(s),this.changed=!0,this.touchParents()},c.prototype.touch=function(c){var o="number"===typeof c?c:this.indexes[c];this.assertValidIndex(o,c),this.changes.has(o)||this.changes.set(o,{op:a.OPERATION.TOUCH,index:o}),this.allChanges.add(o),this.touchParents()},c.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},c.prototype.getType=function(a){if(this.ref._definition)return(c=this.ref._definition).schema[c.fieldsByIndex[a]];var c,o=(c=this.parent._definition).schema[c.fieldsByIndex[this.parentIndex]];return Object.values(o)[0]},c.prototype.getChildrenFilter=function(){var a=this.parent._definition.childFilters;return a&&a[this.parentIndex]},c.prototype.getValue=function(a){return this.ref.getByIndex(a)},c.prototype.delete=function(c){var o="number"===typeof c?c:this.indexes[c];if(void 0!==o){var s=this.getValue(o);this.changes.set(o,{op:a.OPERATION.DELETE,index:o}),this.allChanges.delete(o),delete this.caches[o],s&&s.$changes&&(s.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(c," (").concat(o,")"))},c.prototype.discard=function(c,o){var s=this;void 0===c&&(c=!1),void 0===o&&(o=!1),this.ref instanceof Xa||this.changes.forEach((function(c){if(c.op===a.OPERATION.DELETE){var o=s.ref.getIndex(c.index);delete s.indexes[o]}})),this.changes.clear(),this.changed=c,o&&this.allChanges.clear(),this.currentCustomOperation=0},c.prototype.discardAll=function(){var a=this;this.changes.forEach((function(c){var o=a.getValue(c.index);o&&o.$changes&&o.$changes.discardAll()})),this.discard()},c.prototype.cache=function(a,c){this.caches[a]=c},c.prototype.clone=function(){return new c(this.ref,this.parent,this.root)},c.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},c.prototype.assertValidIndex=function(a,c){if(void 0===a)throw new Error('ChangeTree: missing index for field "'.concat(c,'"'))},c}();function T(a,c,o,s){return a[c]||(a[c]=[]),a[c].push(o),null===s||void 0===s||s.forEach((function(a,c){return o(a,c)})),function(){return j(a[c],a[c].indexOf(o))}}function C(c){var o=this,s="string"!==typeof this.$changes.getType();this.$items.forEach((function(q,t){c.push({refId:o.$changes.refId,op:a.OPERATION.DELETE,field:t,value:void 0,previousValue:q}),s&&o.$changes.root.removeRef(q.$changes.refId)}))}function j(a,c){if(-1===c||c>=a.length)return!1;for(var o=a.length-1,s=c;s<o;s++)a[s]=a[s+1];return a.length=o,!0}var L=function(a,c){var o=a.toString(),s=c.toString();return o<s?-1:o>s?1:0};function e(a){return a.$proxy=!0,a=new Proxy(a,{get:function(a,c){return"symbol"===typeof c||isNaN(c)?a[c]:a.at(c)},set:function(a,c,o){if("symbol"===typeof c||isNaN(c))a[c]=o;else{var s=Array.from(a.$items.keys()),q=parseInt(s[c]||c);void 0===o||null===o?a.deleteAt(q):a.setAt(q,o)}return!0},deleteProperty:function(a,c){return"number"===typeof c?a.deleteAt(c):delete a[c],!0}})}var g=function(){function c(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,a)}return c.prototype.gt=function(c,o){return void 0===o&&(o=!0),T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,c,o?this.$items:void 0)},c.prototype.tc=function(c){return T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,c)},c.is=function(a){return Array.isArray(a)||void 0!==a.array},Object.defineProperty(c.prototype,"length",{get:function(){return this.$items.size},set:function(a){0===a?this.clear():this.splice(a,this.length-a)},enumerable:!1,configurable:!0}),c.prototype.push=function(){for(var a,c=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return o.forEach((function(o){a=c.$refId++,c.setAt(a,o)})),a},c.prototype.pop=function(){var a=Array.from(this.$indexes.values()).pop();if(void 0!==a){this.$changes.delete(a),this.$indexes.delete(a);var c=this.$items.get(a);return this.$items.delete(a),c}},c.prototype.at=function(a){var c=Array.from(this.$items.keys())[a];return this.$items.get(c)},c.prototype.setAt=function(c,o){var s,q;if(void 0!==o&&null!==o){if(this.$items.get(c)!==o){void 0!==o.$changes&&o.$changes.setParent(this,this.$changes.root,c);var t=null!==(q=null===(s=this.$changes.indexes[c])||void 0===s?void 0:s.op)&&void 0!==q?q:a.OPERATION.ADD;this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,o),this.$changes.change(c,t)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},c.prototype.deleteAt=function(a){var c=Array.from(this.$items.keys())[a];return void 0!==c&&this.$deleteAt(c)},c.prototype.$deleteAt=function(a){return this.$changes.delete(a),this.$indexes.delete(a),this.$items.delete(a)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&C.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.concat=function(){for(var a,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new(c.bind.apply(c,q([void 0],(a=Array.from(this.$items.values())).concat.apply(a,o),!1)))},c.prototype.join=function(a){return Array.from(this.$items.values()).join(a)},c.prototype.reverse=function(){var a=this,c=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(o,s){a.setAt(c[s],o)})),this},c.prototype.shift=function(){var a=Array.from(this.$items.keys()).shift();if(void 0!==a){var c=this.$items.get(a);return this.$deleteAt(a),c}},c.prototype.slice=function(a,o){var s=new c;return s.push.apply(s,Array.from(this.$items.values()).slice(a,o)),s},c.prototype.sort=function(a){var c=this;void 0===a&&(a=L);var o=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(a).forEach((function(a,s){c.setAt(o[s],a)})),this},c.prototype.splice=function(a,c){void 0===c&&(c=this.length-a);for(var o=Array.from(this.$items.keys()),s=[],q=a;q<a+c;q++)s.push(this.$items.get(o[q])),this.$deleteAt(o[q]);return s},c.prototype.unshift=function(){for(var a=this,c=[],o=0;o<arguments.length;o++)c[o]=arguments[o];var s=this.length,q=c.length,t=Array.from(this.$items.values());return c.forEach((function(c,o){a.setAt(o,c)})),t.forEach((function(c,o){a.setAt(q+o,c)})),s+q},c.prototype.indexOf=function(a,c){return Array.from(this.$items.values()).indexOf(a,c)},c.prototype.lastIndexOf=function(a,c){return void 0===c&&(c=this.length-1),Array.from(this.$items.values()).lastIndexOf(a,c)},c.prototype.every=function(a,c){return Array.from(this.$items.values()).every(a,c)},c.prototype.some=function(a,c){return Array.from(this.$items.values()).some(a,c)},c.prototype.forEach=function(a,c){Array.from(this.$items.values()).forEach(a,c)},c.prototype.map=function(a,c){return Array.from(this.$items.values()).map(a,c)},c.prototype.filter=function(a,c){return Array.from(this.$items.values()).filter(a,c)},c.prototype.reduce=function(a,c){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},c.prototype.reduceRight=function(a,c){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},c.prototype.find=function(a,c){return Array.from(this.$items.values()).find(a,c)},c.prototype.findIndex=function(a,c){return Array.from(this.$items.values()).findIndex(a,c)},c.prototype.fill=function(a,c,o){throw new Error("ArraySchema#fill() not implemented")},c.prototype.copyWithin=function(a,c,o){throw new Error("ArraySchema#copyWithin() not implemented")},c.prototype.toString=function(){return this.$items.toString()},c.prototype.toLocaleString=function(){return this.$items.toLocaleString()},c.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},c.prototype.includes=function(a,c){return Array.from(this.$items.values()).includes(a,c)},c.prototype.flatMap=function(a,c){throw new Error("ArraySchema#flatMap() is not supported.")},c.prototype.flat=function(a){throw new Error("ArraySchema#flat() is not supported.")},c.prototype.findLast=function(){var a=Array.from(this.$items.values());return a.findLast.apply(a,arguments)},c.prototype.findLastIndex=function(){var a=Array.from(this.$items.values());return a.findLastIndex.apply(a,arguments)},c.prototype.setIndex=function(a,c){this.$indexes.set(a,c)},c.prototype.getIndex=function(a){return this.$indexes.get(a)},c.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},c.prototype.deleteByIndex=function(a){var c=this.$indexes.get(a);this.$items.delete(c),this.$indexes.delete(a)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){return this.toArray().map((function(a){return"function"===typeof a.toJSON?a.toJSON():a}))},c.prototype.clone=function(a){return a?new(c.bind.apply(c,q([void 0],Array.from(this.$items.values()),!1))):new(c.bind.apply(c,q([void 0],this.map((function(a){return a.$changes?a.clone():a})),!1)))},c}();function M(a){return a.$proxy=!0,a=new Proxy(a,{get:function(a,c){return"symbol"!==typeof c&&"undefined"===typeof a[c]?a.get(c):a[c]},set:function(a,c,o){return"symbol"!==typeof c&&-1===c.indexOf("$")&&"gt"!==c&&"tc"!==c&&"onChange"!==c?a.set(c,o):a[c]=o,!0},deleteProperty:function(a,c){return a.delete(c),!0}})}var N=function(){function c(a){var o=this;if(this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,a)if(a instanceof Map||a instanceof c)a.forEach((function(a,c){return o.set(c,a)}));else for(var s in a)this.set(s,a[s])}return c.prototype.gt=function(c,o){return void 0===o&&(o=!0),T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,c,o?this.$items:void 0)},c.prototype.tc=function(c){return T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,c)},c.is=function(a){return void 0!==a.map},c.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.set=function(c,o){if(void 0===o||null===o)throw new Error("MapSchema#set('".concat(c,"', ").concat(o,"): trying to set ").concat(o," value on '").concat(c,"'."));c=c.toString();var s="undefined"!==typeof this.$changes.indexes[c],q=s?this.$changes.indexes[c]:this.$refId++,t=s?a.OPERATION.REPLACE:a.OPERATION.ADD,i=void 0!==o.$changes;if(i&&o.$changes.setParent(this,this.$changes.root,q),s){if(!i&&this.$items.get(c)===o)return;i&&this.$items.get(c)!==o&&(t=a.OPERATION.ADD)}else this.$changes.indexes[c]=q,this.$indexes.set(q,c);return this.$items.set(c,o),this.$changes.change(c,t),this},c.prototype.get=function(a){return this.$items.get(a)},c.prototype.delete=function(a){return this.$changes.delete(a),this.$items.delete(a)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&C.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(a){return this.$items.has(a)},c.prototype.forEach=function(a){this.$items.forEach(a)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(a,c){this.$indexes.set(a,c)},c.prototype.getIndex=function(a){return this.$indexes.get(a)},c.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},c.prototype.deleteByIndex=function(a){var c=this.$indexes.get(a);this.$items.delete(c),this.$indexes.delete(a)},c.prototype.toJSON=function(){var a={};return this.forEach((function(c,o){a[o]="function"===typeof c.toJSON?c.toJSON():c})),a},c.prototype.clone=function(a){var o;return a?o=Object.assign(new c,this):(o=new c,this.forEach((function(a,c){a.$changes?o.set(c,a.clone()):o.set(c,a)}))),o},c}(),y={};function k(a,c){y[a]=c}function n(a){return y[a]}var f=function(){function a(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return a.create=function(c){var o=new a;return o.schema=Object.assign({},c&&c.schema||{}),o.indexes=Object.assign({},c&&c.indexes||{}),o.fieldsByIndex=Object.assign({},c&&c.fieldsByIndex||{}),o.descriptors=Object.assign({},c&&c.descriptors||{}),o.deprecated=Object.assign({},c&&c.deprecated||{}),o},a.prototype.addField=function(a,c){var o=this.getNextFieldIndex();this.fieldsByIndex[o]=a,this.indexes[a]=o,this.schema[a]=Array.isArray(c)?{array:c[0]}:c},a.prototype.hasField=function(a){return void 0!==this.indexes[a]},a.prototype.addFilter=function(a,c){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[a]]=c,this.indexesWithFilters.push(this.indexes[a]),!0},a.prototype.addChildrenFilter=function(a,c){var o=this.indexes[a],s=this.schema[a];if(n(Object.keys(s)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[o]=c,!0;console.warn("@filterChildren: field '".concat(a,"' can't have children. Ignoring filter."))},a.prototype.getChildrenFilter=function(a){return this.childFilters&&this.childFilters[this.indexes[a]]},a.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},a}();function J(a){return a._context&&a._context.useFilters}var w=function(){function a(){this.types={},this.schemas=new Map,this.useFilters=!1}return a.prototype.has=function(a){return this.schemas.has(a)},a.prototype.get=function(a){return this.types[a]},a.prototype.add=function(a,c){void 0===c&&(c=this.schemas.size),a._definition=f.create(a._definition),a._typeid=c,this.types[c]=a,this.schemas.set(a,c)},a.create=function(c){return void 0===c&&(c={}),function(o){return c.context||(c.context=new a),h(o,c)}},a}(),Z=new w;function h(a,c){return void 0===c&&(c={}),function(o,s){var t=c.context||Z,i=o.constructor;if(i._context=t,!a)throw new Error("".concat(i.name,': @type() reference provided for "').concat(s,"\" is undefined. Make sure you don't have any circular dependencies."));t.has(i)||t.add(i);var p=i._definition;if(p.addField(s,a),p.descriptors[s]){if(p.deprecated[s])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(s,"' definition on '").concat(i.name,"'.\nCheck @type() annotation"))}catch(y){var G=y.stack.split("\n")[4].trim();throw new Error("".concat(y.message," ").concat(G))}}var T=g.is(a),C=!T&&N.is(a);if("string"!==typeof a&&!Xa.is(a)){var j=Object.values(a)[0];"string"===typeof j||t.has(j)||t.add(j)}if(c.manual)p.descriptors[s]={enumerable:!0,configurable:!0,writable:!0};else{var L="_".concat(s);p.descriptors[L]={enumerable:!1,configurable:!1,writable:!0},p.descriptors[s]={get:function(){return this[L]},set:function(a){a!==this[L]&&(void 0!==a&&null!==a?(!T||a instanceof g||(a=new(g.bind.apply(g,q([void 0],a,!1)))),!C||a instanceof N||(a=new N(a)),void 0===a.$proxy&&(C?a=M(a):T&&(a=e(a))),this.$changes.change(s),a.$changes&&a.$changes.setParent(this,this.$changes.root,this._definition.indexes[s])):this[L]&&this.$changes.delete(s),this[L]=a)},enumerable:!0,configurable:!0}}}}function U(a){return function(c,o){var s=c.constructor;s._definition.addFilter(o,a)&&(s._context.useFilters=!0)}}function S(a){return function(c,o){var s=c.constructor;s._definition.addChildrenFilter(o,a)&&(s._context.useFilters=!0)}}function r(a){return void 0===a&&(a=!0),function(c,o){var s=c.constructor._definition;s.deprecated[o]=!0,a&&(s.descriptors[o]={get:function(){throw new Error("".concat(o," is deprecated."))},set:function(a){},enumerable:!1,configurable:!0})}}function x(a,c,o){for(var s in void 0===o&&(o={}),o.context||(o.context=a._context||o.context||Z),c)h(c[s],o)(a.prototype,s);return a}function R(a){for(var c=0,o=0,s=0,q=a.length;s<q;s++)(c=a.charCodeAt(s))<128?o+=1:c<2048?o+=2:c<55296||c>=57344?o+=3:(s++,o+=4);return o}function d(a,c,o){for(var s=0,q=0,t=o.length;q<t;q++)(s=o.charCodeAt(q))<128?a[c++]=s:s<2048?(a[c++]=192|s>>6,a[c++]=128|63&s):s<55296||s>=57344?(a[c++]=224|s>>12,a[c++]=128|s>>6&63,a[c++]=128|63&s):(q++,s=65536+((1023&s)<<10|1023&o.charCodeAt(q)),a[c++]=240|s>>18,a[c++]=128|s>>12&63,a[c++]=128|s>>6&63,a[c++]=128|63&s)}function X(a,c){a.push(255&c)}function W(a,c){a.push(255&c)}function F(a,c){a.push(255&c),a.push(c>>8&255)}function O(a,c){a.push(255&c),a.push(c>>8&255)}function B(a,c){a.push(255&c),a.push(c>>8&255),a.push(c>>16&255),a.push(c>>24&255)}function u(a,c){var o=c>>24,s=c>>16,q=c>>8,t=c;a.push(255&t),a.push(255&q),a.push(255&s),a.push(255&o)}function K(a,c){var o=Math.floor(c/Math.pow(2,32));u(a,c>>>0),u(a,o)}function D(a,c){var o=c/Math.pow(2,32)|0;u(a,c>>>0),u(a,o)}function I(a,c){E(a,c)}function Y(a,c){H(a,c)}var P=new Int32Array(2),ma=new Float32Array(P.buffer),V=new Float64Array(P.buffer);function E(a,c){ma[0]=c,B(a,P[0])}function H(a,c){V[0]=c,B(a,P[0]),B(a,P[1])}function b(a,c){return W(a,c?1:0)}function A(a,c){c||(c="");var o=R(c),s=0;if(o<32)a.push(160|o),s=1;else if(o<256)a.push(217),W(a,o),s=2;else if(o<65536)a.push(218),O(a,o),s=3;else{if(!(o<4294967296))throw new Error("String too long");a.push(219),u(a,o),s=5}return d(a,a.length,c),s+o}function v(a,c){return isNaN(c)?v(a,0):isFinite(c)?c!==(0|c)?(a.push(203),H(a,c),9):c>=0?c<128?(W(a,c),1):c<256?(a.push(204),W(a,c),2):c<65536?(a.push(205),O(a,c),3):c<4294967296?(a.push(206),u(a,c),5):(a.push(207),D(a,c),9):c>=-32?(a.push(224|c+32),1):c>=-128?(a.push(208),X(a,c),2):c>=-32768?(a.push(209),F(a,c),3):c>=-2147483648?(a.push(210),B(a,c),5):(a.push(211),K(a,c),9):v(a,c>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var l=Object.freeze({__proto__:null,utf8Write:d,int8:X,uint8:W,int16:F,uint16:O,int32:B,uint32:u,int64:K,uint64:D,float32:I,float64:Y,writeFloat32:E,writeFloat64:H,boolean:b,string:A,number:v});function Q(a,c,o){for(var s="",q=0,t=c,i=c+o;t<i;t++){var p=a[t];0!==(128&p)?192!==(224&p)?224!==(240&p)?240!==(248&p)?console.error("Invalid byte "+p.toString(16)):(q=(7&p)<<18|(63&a[++t])<<12|(63&a[++t])<<6|63&a[++t])>=65536?(q-=65536,s+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):s+=String.fromCharCode(q):s+=String.fromCharCode((15&p)<<12|(63&a[++t])<<6|63&a[++t]):s+=String.fromCharCode((31&p)<<6|63&a[++t]):s+=String.fromCharCode(p)}return s}function z(a,c){return aa(a,c)<<24>>24}function aa(a,c){return a[c.offset++]}function ca(a,c){return oa(a,c)<<16>>16}function oa(a,c){return a[c.offset++]|a[c.offset++]<<8}function sa(a,c){return a[c.offset++]|a[c.offset++]<<8|a[c.offset++]<<16|a[c.offset++]<<24}function qa(a,c){return sa(a,c)>>>0}function ta(a,c){return La(a,c)}function ia(a,c){return ea(a,c)}function pa(a,c){var o=qa(a,c);return sa(a,c)*Math.pow(2,32)+o}function Ga(a,c){var o=qa(a,c);return qa(a,c)*Math.pow(2,32)+o}var Ta=new Int32Array(2),Ca=new Float32Array(Ta.buffer),ja=new Float64Array(Ta.buffer);function La(a,c){return Ta[0]=sa(a,c),Ca[0]}function ea(a,c){return Ta[0]=sa(a,c),Ta[1]=sa(a,c),ja[0]}function ga(a,c){return aa(a,c)>0}function Ma(a,c){var o,s=a[c.offset++];s<192?o=31&s:217===s?o=aa(a,c):218===s?o=oa(a,c):219===s&&(o=qa(a,c));var q=Q(a,c.offset,o);return c.offset+=o,q}function Na(a,c){var o=a[c.offset];return o<192&&o>160||217===o||218===o||219===o}function ya(a,c){var o=a[c.offset++];return o<128?o:202===o?La(a,c):203===o?ea(a,c):204===o?aa(a,c):205===o?oa(a,c):206===o?qa(a,c):207===o?Ga(a,c):208===o?z(a,c):209===o?ca(a,c):210===o?sa(a,c):211===o?pa(a,c):o>223?-1*(255-o+1):void 0}function ka(a,c){var o=a[c.offset];return o<128||o>=202&&o<=211}function na(a,c){return a[c.offset]<160}function fa(a,c){return a[c.offset-1]===i&&(a[c.offset]<128||a[c.offset]>=202&&a[c.offset]<=211)}var Ja=Object.freeze({__proto__:null,int8:z,uint8:aa,int16:ca,uint16:oa,int32:sa,uint32:qa,float32:ta,float64:ia,int64:pa,uint64:Ga,readFloat32:La,readFloat64:ea,boolean:ga,string:Ma,stringCheck:Na,number:ya,numberCheck:ka,arrayCheck:na,switchStructureCheck:fa}),wa=function(){function c(a){var c=this;this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,a&&a.forEach((function(a){return c.add(a)}))}return c.prototype.gt=function(c,o){return void 0===o&&(o=!0),T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,c,o?this.$items:void 0)},c.prototype.tc=function(c){return T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,c)},c.is=function(a){return void 0!==a.collection},c.prototype.add=function(a){var c=this.$refId++;return void 0!==a.$changes&&a.$changes.setParent(this,this.$changes.root,c),this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,a),this.$changes.change(c),c},c.prototype.at=function(a){var c=Array.from(this.$items.keys())[a];return this.$items.get(c)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(a){for(var c,o,s=this.$items.entries();(o=s.next())&&!o.done;)if(a===o.value[1]){c=o.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&C.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(a){return Array.from(this.$items.values()).some((function(c){return c===a}))},c.prototype.forEach=function(a){var c=this;this.$items.forEach((function(o,s,q){return a(o,s,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(a,c){this.$indexes.set(a,c)},c.prototype.getIndex=function(a){return this.$indexes.get(a)},c.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},c.prototype.deleteByIndex=function(a){var c=this.$indexes.get(a);this.$items.delete(c),this.$indexes.delete(a)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var a=[];return this.forEach((function(c,o){a.push("function"===typeof c.toJSON?c.toJSON():c)})),a},c.prototype.clone=function(a){var o;return a?o=Object.assign(new c,this):(o=new c,this.forEach((function(a){a.$changes?o.add(a.clone()):o.add(a)}))),o},c}(),Za=function(){function c(a){var c=this;this.$changes=new G(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,a&&a.forEach((function(a){return c.add(a)}))}return c.prototype.gt=function(c,o){return void 0===o&&(o=!0),T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,c,o?this.$items:void 0)},c.prototype.tc=function(c){return T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,c)},c.is=function(a){return void 0!==a.set},c.prototype.add=function(c){var o,s;if(this.has(c))return!1;var q=this.$refId++;void 0!==c.$changes&&c.$changes.setParent(this,this.$changes.root,q);var t=null!==(s=null===(o=this.$changes.indexes[q])||void 0===o?void 0:o.op)&&void 0!==s?s:a.OPERATION.ADD;return this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,c),this.$changes.change(q,t),q},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(a){for(var c,o,s=this.$items.entries();(o=s.next())&&!o.done;)if(a===o.value[1]){c=o.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&C.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(a){for(var c,o=this.$items.values(),s=!1;(c=o.next())&&!c.done;)if(a===c.value){s=!0;break}return s},c.prototype.forEach=function(a){var c=this;this.$items.forEach((function(o,s,q){return a(o,s,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(a,c){this.$indexes.set(a,c)},c.prototype.getIndex=function(a){return this.$indexes.get(a)},c.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},c.prototype.deleteByIndex=function(a){var c=this.$indexes.get(a);this.$items.delete(c),this.$indexes.delete(a)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var a=[];return this.forEach((function(c,o){a.push("function"===typeof c.toJSON?c.toJSON():c)})),a},c.prototype.clone=function(a){var o;return a?o=Object.assign(new c,this):(o=new c,this.forEach((function(a){a.$changes?o.add(a.clone()):o.add(a)}))),o},c}(),ha=function(){function a(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return a.prototype.addRefId=function(a){this.refIds.has(a)||(this.refIds.add(a),this.containerIndexes.set(a,new Set))},a.get=function(c){return void 0===c.$filterState&&(c.$filterState=new a),c.$filterState},a}(),Ua=function(){function a(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return a.prototype.getNextUniqueId=function(){return this.nextUniqueId++},a.prototype.addRef=function(a,c,o){void 0===o&&(o=!0),this.refs.set(a,c),o&&(this.refCounts[a]=(this.refCounts[a]||0)+1)},a.prototype.removeRef=function(a){this.refCounts[a]=this.refCounts[a]-1,this.deletedRefs.add(a)},a.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},a.prototype.garbageCollectDeletedRefs=function(){var a=this;this.deletedRefs.forEach((function(c){if(!(a.refCounts[c]>0)){var o=a.refs.get(c);if(o instanceof Xa)for(var s in o._definition.schema)"string"!==typeof o._definition.schema[s]&&o[s]&&o[s].$changes&&a.removeRef(o[s].$changes.refId);else{var q=o.$changes.parent._definition,t=q.schema[q.fieldsByIndex[o.$changes.parentIndex]];"function"===typeof Object.values(t)[0]&&Array.from(o.values()).forEach((function(c){return a.removeRef(c.$changes.refId)}))}a.refs.delete(c),delete a.refCounts[c]}})),this.deletedRefs.clear()},a}(),Sa=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return o(c,a),c}(Error);function ra(a,c,o,s){var q,t=!1;switch(c){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":q="number",isNaN(a)&&console.log('trying to encode "NaN" in '.concat(o.constructor.name,"#").concat(s));break;case"string":q="string",t=!0;break;case"boolean":return}if(typeof a!==q&&(!t||t&&null!==a)){var i="'".concat(JSON.stringify(a),"'").concat(a&&a.constructor&&" (".concat(a.constructor.name,")")||"");throw new Sa("a '".concat(q,"' was expected, but ").concat(i," was provided in ").concat(o.constructor.name,"#").concat(s))}}function xa(a,c,o,s){if(!(a instanceof c))throw new Sa("a '".concat(c.name,"' was expected, but '").concat(a.constructor.name,"' was provided in ").concat(o.constructor.name,"#").concat(s))}function Ra(a,c,o,s,q){ra(o,a,s,q);var t=l[a];if(!t)throw new Sa("a '".concat(a,"' was expected, but ").concat(o," was provided in ").concat(s.constructor.name,"#").concat(q));t(c,o)}function da(a,c,o){return Ja[a](c,o)}var Xa=function(){function c(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];Object.defineProperties(this,{$changes:{value:new G(this,void 0,new Ua),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var o=this._definition.descriptors;o&&Object.defineProperties(this,o),a[0]&&this.assign(a[0])}return c.onError=function(a){console.error(a)},c.is=function(a){return a._definition&&void 0!==a._definition.schema},c.prototype.onChange=function(c){return T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,c)},c.prototype.tc=function(c){return T(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,c)},c.prototype.assign=function(a){return Object.assign(this,a),this},Object.defineProperty(c.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),c.prototype.setDirty=function(a,c){this.$changes.change(a,c)},c.prototype.listen=function(a,c,o){var s=this;return void 0===o&&(o=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[a]||(this.$callbacks[a]=[]),this.$callbacks[a].push(c),o&&void 0!==this[a]&&c(this[a],void 0),function(){return j(s.$callbacks[a],s.$callbacks[a].indexOf(c))}},c.prototype.decode=function(o,s,q){var t;void 0===s&&(s={offset:0}),void 0===q&&(q=this);var p=[],G=this.$changes.root,T=o.length,C=0;for(G.refs.set(C,this);s.offset<T;){var j=o[s.offset++];if(j!=i){var L=q.$changes,e=void 0!==q._definition,M=e?j>>6<<6:j;if(M!==a.OPERATION.CLEAR){var y=e?j%(M||255):ya(o,s),k=e?q._definition.fieldsByIndex[y]:"",f=L.getType(y),J=void 0,w=void 0,Z=void 0;if(e?w=q["_".concat(k)]:(w=q.getByIndex(y),(M&a.OPERATION.ADD)===a.OPERATION.ADD?(Z=q instanceof N?Ma(o,s):y,q.setIndex(y,Z)):Z=q.getIndex(y)),(M&a.OPERATION.DELETE)===a.OPERATION.DELETE&&(M!==a.OPERATION.DELETE_AND_ADD&&q.deleteByIndex(y),w&&w.$changes&&G.removeRef(w.$changes.refId),J=null),void 0!==k){if(M===a.OPERATION.DELETE);else if(c.is(f)){var h=ya(o,s);if(J=G.refs.get(h),M!==a.OPERATION.REPLACE){var U=this.getSchemaType(o,s,f);J||((J=this.createTypeInstance(U)).$changes.refId=h,w&&(J.$callbacks=w.$callbacks,w.$changes.refId&&h!==w.$changes.refId&&G.removeRef(w.$changes.refId))),G.addRef(h,J,J!==w)}}else if("string"===typeof f)J=da(f,o,s);else{var S=n(Object.keys(f)[0]),r=ya(o,s),x=G.refs.has(r)?w||G.refs.get(r):new S.constructor;if((J=x.clone(!0)).$changes.refId=r,w&&(J.$callbacks=w.$callbacks,w.$changes.refId&&r!==w.$changes.refId)){G.removeRef(w.$changes.refId);for(var R=w.entries(),d=void 0;(d=R.next())&&!d.done;){var X=(t=d.value)[0],W=t[1];p.push({refId:r,op:a.OPERATION.DELETE,field:X,value:void 0,previousValue:W})}}G.addRef(r,J,x!==w)}if(null!==J&&void 0!==J)if(J.$changes&&J.$changes.setParent(L.ref,L.root,y),q instanceof c)q[k]=J;else if(q instanceof N)X=Z,q.$items.set(X,J),q.$changes.allChanges.add(y);else if(q instanceof g)q.setAt(y,J);else if(q instanceof wa){var F=q.add(J);q.setIndex(y,F)}else q instanceof Za&&!1!==(F=q.add(J))&&q.setIndex(y,F);w!==J&&p.push({refId:C,op:M,field:k,dynamicIndex:Z,value:J,previousValue:w})}else{console.warn("@colyseus/schema: definition mismatch");for(var O={offset:s.offset};s.offset<T&&(!fa(o,s)||(O.offset=s.offset+1,!G.refs.has(ya(o,O))));)s.offset++}}else q.clear(p)}else{C=ya(o,s);var B=G.refs.get(C);if(!B)throw new Error('"refId" not found: '.concat(C));q=B}}return this._triggerChanges(p),G.garbageCollectDeletedRefs(),p},c.prototype.encode=function(o,s,q){void 0===o&&(o=!1),void 0===s&&(s=[]),void 0===q&&(q=!1);for(var t=this.$changes,p=new WeakSet,G=[t],T=1,C=0;C<T;C++){var j=G[C],L=j.ref,e=L instanceof c;j.ensureRefId(),p.add(j),j!==t&&(j.changed||o)&&(W(s,i),v(s,j.refId));for(var g=o?Array.from(j.allChanges):Array.from(j.changes.values()),M=0,y=g.length;M<y;M++){var k=o?{op:a.OPERATION.ADD,index:g[M]}:g[M],f=k.index,J=e?L._definition.fieldsByIndex&&L._definition.fieldsByIndex[f]:f,w=s.length;if(k.op!==a.OPERATION.TOUCH)if(e)W(s,f|k.op);else{if(W(s,k.op),k.op===a.OPERATION.CLEAR)continue;v(s,f)}if(e||(k.op&a.OPERATION.ADD)!=a.OPERATION.ADD||L instanceof N&&A(s,j.ref.$indexes.get(f)),k.op!==a.OPERATION.DELETE){var Z=j.getType(f),h=j.getValue(f);if(h&&h.$changes&&!p.has(h.$changes)&&(G.push(h.$changes),h.$changes.ensureRefId(),T++),k.op!==a.OPERATION.TOUCH){if(c.is(Z))xa(h,Z,L,J),v(s,h.$changes.refId),(k.op&a.OPERATION.ADD)===a.OPERATION.ADD&&this.tryEncodeTypeId(s,Z,h.constructor);else if("string"===typeof Z)Ra(Z,s,h,L,J);else{var U=n(Object.keys(Z)[0]);xa(L["_".concat(J)],U.constructor,L,J),v(s,h.$changes.refId)}q&&j.cache(f,s.slice(w))}}}o||q||j.discard()}return s},c.prototype.encodeAll=function(a){return this.encode(!0,[],a)},c.prototype.applyFilters=function(o,s){var q,t;void 0===s&&(s=!1);for(var p=this,G=new Set,T=ha.get(o),C=[this.$changes],j=1,L=[],e=function(e){var g=C[e];if(G.has(g.refId))return"continue";var M=g.ref,y=M instanceof c;W(L,i),v(L,g.refId);var k=T.refIds.has(g),n=s||!k;T.addRefId(g);var f=T.containerIndexes.get(g),J=n?Array.from(g.allChanges):Array.from(g.changes.values());!s&&y&&M._definition.indexesWithFilters&&M._definition.indexesWithFilters.forEach((function(c){!f.has(c)&&g.allChanges.has(c)&&(n?J.push(c):J.push({op:a.OPERATION.ADD,index:c}))}));for(var w=0,Z=J.length;w<Z;w++){var h=n?{op:a.OPERATION.ADD,index:J[w]}:J[w];if(h.op!==a.OPERATION.CLEAR){var U=h.index;if(h.op!==a.OPERATION.DELETE){var S=g.getValue(U),r=g.getType(U);if(y){if((x=M._definition.filters&&M._definition.filters[U])&&!x.call(M,o,S,p)){S&&S.$changes&&G.add(S.$changes.refId);continue}}else{var x,R=g.parent;if((x=g.getChildrenFilter())&&!x.call(R,o,M.$indexes.get(U),S,p)){S&&S.$changes&&G.add(S.$changes.refId);continue}}if(S.$changes&&(C.push(S.$changes),j++),h.op!==a.OPERATION.TOUCH)if(h.op===a.OPERATION.ADD||y)L.push.apply(L,null!==(q=g.caches[U])&&void 0!==q?q:[]),f.add(U);else if(f.has(U))L.push.apply(L,null!==(t=g.caches[U])&&void 0!==t?t:[]);else{if(f.add(U),W(L,a.OPERATION.ADD),v(L,U),M instanceof N){var d=g.ref.$indexes.get(U);A(L,d)}S.$changes?v(L,S.$changes.refId):l[r](L,S)}else S.$changes&&!y&&(W(L,a.OPERATION.ADD),v(L,U),M instanceof N&&(d=g.ref.$indexes.get(U),A(L,d)),v(L,S.$changes.refId))}else y?W(L,h.op|U):(W(L,h.op),v(L,U))}else W(L,h.op)}},g=0;g<j;g++)e(g);return L},c.prototype.clone=function(){var a,c=new this.constructor,o=this._definition.schema;for(var s in o)"object"===typeof this[s]&&"function"===typeof(null===(a=this[s])||void 0===a?void 0:a.clone)?c[s]=this[s].clone():c[s]=this[s];return c},c.prototype.toJSON=function(){var a=this._definition.schema,c=this._definition.deprecated,o={};for(var s in a)c[s]||null===this[s]||"undefined"===typeof this[s]||(o[s]="function"===typeof this[s].toJSON?this[s].toJSON():this["_".concat(s)]);return o},c.prototype.discardAllChanges=function(){this.$changes.discardAll()},c.prototype.getByIndex=function(a){return this[this._definition.fieldsByIndex[a]]},c.prototype.deleteByIndex=function(a){this[this._definition.fieldsByIndex[a]]=void 0},c.prototype.tryEncodeTypeId=function(a,c,o){c._typeid!==o._typeid&&(W(a,p),v(a,o._typeid))},c.prototype.getSchemaType=function(a,c,o){var s;return a[c.offset]===p&&(c.offset++,s=this.constructor._context.get(ya(a,c))),s||o},c.prototype.createTypeInstance=function(a){var c=new a;return c.$changes.root=this.$changes.root,c},c.prototype._triggerChanges=function(o){for(var s,q,t,i,p,G,T,C,j,L=new Set,e=this.$changes.root.refs,g=function(g){var M=o[g],N=M.refId,y=e.get(N),k=y.$callbacks;if((M.op&a.OPERATION.DELETE)===a.OPERATION.DELETE&&M.previousValue instanceof c&&(null===(q=null===(s=M.previousValue.$callbacks)||void 0===s?void 0:s[a.OPERATION.DELETE])||void 0===q||q.forEach((function(a){return a()}))),!k)return"continue";if(y instanceof c){if(!L.has(N))try{null===(t=null===k||void 0===k?void 0:k[a.OPERATION.REPLACE])||void 0===t||t.forEach((function(a){return a()}))}catch(n){c.onError(n)}try{k.hasOwnProperty(M.field)&&(null===(i=k[M.field])||void 0===i||i.forEach((function(a){return a(M.value,M.previousValue)})))}catch(n){c.onError(n)}}else M.op===a.OPERATION.ADD&&void 0===M.previousValue?null===(p=k[a.OPERATION.ADD])||void 0===p||p.forEach((function(a){var c;return a(M.value,null!==(c=M.dynamicIndex)&&void 0!==c?c:M.field)})):M.op===a.OPERATION.DELETE?void 0!==M.previousValue&&(null===(G=k[a.OPERATION.DELETE])||void 0===G||G.forEach((function(a){var c;return a(M.previousValue,null!==(c=M.dynamicIndex)&&void 0!==c?c:M.field)}))):M.op===a.OPERATION.DELETE_AND_ADD&&(void 0!==M.previousValue&&(null===(T=k[a.OPERATION.DELETE])||void 0===T||T.forEach((function(a){var c;return a(M.previousValue,null!==(c=M.dynamicIndex)&&void 0!==c?c:M.field)}))),null===(C=k[a.OPERATION.ADD])||void 0===C||C.forEach((function(a){var c;return a(M.value,null!==(c=M.dynamicIndex)&&void 0!==c?c:M.field)}))),M.value!==M.previousValue&&(null===(j=k[a.OPERATION.REPLACE])||void 0===j||j.forEach((function(a){var c;return a(M.value,null!==(c=M.dynamicIndex)&&void 0!==c?c:M.field)})));L.add(N)},M=0;M<o.length;M++)g(M)},c._definition=f.create(),c}();function Wa(a){for(var c=[a.$changes],o=1,s={},q=s,t=function(a){var o=c[a];o.changes.forEach((function(a){var c=o.ref,s=a.index,t=c._definition?c._definition.fieldsByIndex[s]:c.$indexes.get(s);q[t]=o.getValue(s)}))},i=0;i<o;i++)t(i);return s}var Fa={context:new w},Oa=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return o(c,a),s([h("string",Fa)],c.prototype,"name",void 0),s([h("string",Fa)],c.prototype,"type",void 0),s([h("number",Fa)],c.prototype,"referencedType",void 0),c}(Xa),Ba=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;return c.fields=new g,c}return o(c,a),s([h("number",Fa)],c.prototype,"id",void 0),s([h([Oa],Fa)],c.prototype,"fields",void 0),c}(Xa),ua=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;return c.types=new g,c}return o(c,a),c.encode=function(a){var o=a.constructor,s=new c;s.rootType=o._typeid;var q=function(a,c){for(var o in c){var q=new Oa;q.name=o;var t=void 0;if("string"===typeof c[o])t=c[o];else{var i=c[o],p=void 0;Xa.is(i)?(t="ref",p=c[o]):"string"===typeof i[t=Object.keys(i)[0]]?t+=":"+i[t]:p=i[t],q.referencedType=p?p._typeid:-1}q.type=t,a.fields.push(q)}s.types.push(a)},t=o._context.types;for(var i in t){var p=new Ba;p.id=Number(i),q(p,t[i]._definition.schema)}return s.encodeAll()},c.decode=function(a,s){var q=new w,t=new c;t.decode(a,s);var i=t.types.reduce((function(a,c){var s=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return o(c,a),c}(Xa),t=c.id;return a[t]=s,q.add(s,t),a}),{});t.types.forEach((function(a){var c=i[a.id];a.fields.forEach((function(a){var o;if(void 0!==a.referencedType){var s=a.type,t=i[a.referencedType];if(!t){var p=a.type.split(":");s=p[0],t=p[1]}"ref"===s?h(t,{context:q})(c.prototype,a.name):h(((o={})[s]=t,o),{context:q})(c.prototype,a.name)}else h(a.type,{context:q})(c.prototype,a.name)}))}));var p=i[t.rootType],G=new p;for(var T in p._definition.schema){var C=p._definition.schema[T];"string"!==typeof C&&(G[T]="function"===typeof C?new C:new(n(Object.keys(C)[0]).constructor))}return G},s([h([Ba],Fa)],c.prototype,"types",void 0),s([h("number",Fa)],c.prototype,"rootType",void 0),c}(Xa);k("map",{constructor:N}),k("array",{constructor:g}),k("set",{constructor:Za}),k("collection",{constructor:wa}),a.ArraySchema=g,a.CollectionSchema=wa,a.Context=w,a.MapSchema=N,a.Reflection=ua,a.ReflectionField=Oa,a.ReflectionType=Ba,a.Schema=Xa,a.SchemaDefinition=f,a.SetSchema=Za,a.decode=Ja,a.defineTypes=x,a.deprecated=r,a.dumpChanges=Wa,a.encode=l,a.filter=U,a.filterChildren=S,a.hasFilter=J,a.registerType=k,a.type=h,Object.defineProperty(a,"__esModule",{value:!0})}(c)},14906:a=>{"use strict";a.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14900:(a,c,o)=>{var s=o(14906),q=o(14914),t=Object.hasOwnProperty,i=Object.create(null);for(var p in s)t.call(s,p)&&(i[s[p]]=p);var G=a.exports={to:{},get:{}};function T(a,c,o){return Math.min(Math.max(c,a),o)}function C(a){var c=Math.round(a).toString(16).toUpperCase();return c.length<2?"0"+c:c}G.get=function(a){var c,o;switch(a.substring(0,3).toLowerCase()){case"hsl":c=G.get.hsl(a),o="hsl";break;case"hwb":c=G.get.hwb(a),o="hwb";break;default:c=G.get.rgb(a),o="rgb"}return c?{model:o,value:c}:null},G.get.rgb=function(a){if(!a)return null;var c,o,q,i=[0,0,0,1];if(c=a.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(q=c[2],c=c[1],o=0;o<3;o++){var p=2*o;i[o]=parseInt(c.slice(p,p+2),16)}q&&(i[3]=parseInt(q,16)/255)}else if(c=a.match(/^#([a-f0-9]{3,4})$/i)){for(q=(c=c[1])[3],o=0;o<3;o++)i[o]=parseInt(c[o]+c[o],16);q&&(i[3]=parseInt(q+q,16)/255)}else if(c=a.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(o=0;o<3;o++)i[o]=parseInt(c[o+1],0);c[4]&&(c[5]?i[3]=.01*parseFloat(c[4]):i[3]=parseFloat(c[4]))}else{if(!(c=a.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(c=a.match(/^(\w+)$/))?"transparent"===c[1]?[0,0,0,0]:t.call(s,c[1])?((i=s[c[1]])[3]=1,i):null:null;for(o=0;o<3;o++)i[o]=Math.round(2.55*parseFloat(c[o+1]));c[4]&&(c[5]?i[3]=.01*parseFloat(c[4]):i[3]=parseFloat(c[4]))}for(o=0;o<3;o++)i[o]=T(i[o],0,255);return i[3]=T(i[3],0,1),i},G.get.hsl=function(a){if(!a)return null;var c=a.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var o=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,T(parseFloat(c[2]),0,100),T(parseFloat(c[3]),0,100),T(isNaN(o)?1:o,0,1)]}return null},G.get.hwb=function(a){if(!a)return null;var c=a.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var o=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,T(parseFloat(c[2]),0,100),T(parseFloat(c[3]),0,100),T(isNaN(o)?1:o,0,1)]}return null},G.to.hex=function(){var a=q(arguments);return"#"+C(a[0])+C(a[1])+C(a[2])+(a[3]<1?C(Math.round(255*a[3])):"")},G.to.rgb=function(){var a=q(arguments);return a.length<4||1===a[3]?"rgb("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+")":"rgba("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+", "+a[3]+")"},G.to.rgb.percent=function(){var a=q(arguments),c=Math.round(a[0]/255*100),o=Math.round(a[1]/255*100),s=Math.round(a[2]/255*100);return a.length<4||1===a[3]?"rgb("+c+"%, "+o+"%, "+s+"%)":"rgba("+c+"%, "+o+"%, "+s+"%, "+a[3]+")"},G.to.hsl=function(){var a=q(arguments);return a.length<4||1===a[3]?"hsl("+a[0]+", "+a[1]+"%, "+a[2]+"%)":"hsla("+a[0]+", "+a[1]+"%, "+a[2]+"%, "+a[3]+")"},G.to.hwb=function(){var a=q(arguments),c="";return a.length>=4&&1!==a[3]&&(c=", "+a[3]),"hwb("+a[0]+", "+a[1]+"%, "+a[2]+"%"+c+")"},G.to.keyword=function(a){return i[a.slice(0,3)]}},14896:(a,c,o)=>{const s=o(14900),q=o(14925),t=["keyword","gray","hex"],i={};for(const e of Object.keys(q))i[[...q[e].labels].sort().join("")]=e;const p={};function G(a,c){if(!(this instanceof G))return new G(a,c);if(c&&c in t&&(c=null),c&&!(c in q))throw new Error("Unknown model: "+c);let o,T;if(null==a)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(a instanceof G)this.model=a.model,this.color=[...a.color],this.valpha=a.valpha;else if("string"===typeof a){const c=s.get(a);if(null===c)throw new Error("Unable to parse color from string: "+a);this.model=c.model,T=q[this.model].channels,this.color=c.value.slice(0,T),this.valpha="number"===typeof c.value[T]?c.value[T]:1}else if(a.length>0){this.model=c||"rgb",T=q[this.model].channels;const o=Array.prototype.slice.call(a,0,T);this.color=L(o,T),this.valpha="number"===typeof a[T]?a[T]:1}else if("number"===typeof a)this.model="rgb",this.color=[a>>16&255,a>>8&255,255&a],this.valpha=1;else{this.valpha=1;const c=Object.keys(a);"alpha"in a&&(c.splice(c.indexOf("alpha"),1),this.valpha="number"===typeof a.alpha?a.alpha:0);const s=c.sort().join("");if(!(s in i))throw new Error("Unable to parse color from object: "+JSON.stringify(a));this.model=i[s];const{labels:t}=q[this.model],p=[];for(o=0;o<t.length;o++)p.push(a[t[o]]);this.color=L(p)}if(p[this.model])for(T=q[this.model].channels,o=0;o<T;o++){const a=p[this.model][o];a&&(this.color[o]=a(this.color[o]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}G.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(a){let c=this.model in s.to?this:this.rgb();c=c.round("number"===typeof a?a:1);const o=1===c.valpha?c.color:[...c.color,this.valpha];return s.to[c.model](o)},percentString(a){const c=this.rgb().round("number"===typeof a?a:1),o=1===c.valpha?c.color:[...c.color,this.valpha];return s.to.rgb.percent(o)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const a={},{channels:c}=q[this.model],{labels:o}=q[this.model];for(let s=0;s<c;s++)a[o[s]]=this.color[s];return 1!==this.valpha&&(a.alpha=this.valpha),a},unitArray(){const a=this.rgb().color;return a[0]/=255,a[1]/=255,a[2]/=255,1!==this.valpha&&a.push(this.valpha),a},unitObject(){const a=this.rgb().object();return a.r/=255,a.g/=255,a.b/=255,1!==this.valpha&&(a.alpha=this.valpha),a},round(a){return a=Math.max(a||0,0),new G([...this.color.map(T(a)),this.valpha],this.model)},alpha(a){return void 0!==a?new G([...this.color,Math.max(0,Math.min(1,a))],this.model):this.valpha},red:C("rgb",0,j(255)),green:C("rgb",1,j(255)),blue:C("rgb",2,j(255)),hue:C(["hsl","hsv","hsl","hwb","hcg"],0,(a=>(a%360+360)%360)),saturationl:C("hsl",1,j(100)),lightness:C("hsl",2,j(100)),saturationv:C("hsv",1,j(100)),value:C("hsv",2,j(100)),chroma:C("hcg",1,j(100)),gray:C("hcg",2,j(100)),white:C("hwb",1,j(100)),wblack:C("hwb",2,j(100)),cyan:C("cmyk",0,j(100)),magenta:C("cmyk",1,j(100)),yellow:C("cmyk",2,j(100)),black:C("cmyk",3,j(100)),x:C("xyz",0,j(95.047)),y:C("xyz",1,j(100)),z:C("xyz",2,j(108.833)),l:C("lab",0,j(100)),a:C("lab",1),b:C("lab",2),keyword(a){return void 0!==a?new G(a):q[this.model].keyword(this.color)},hex(a){return void 0!==a?new G(a):s.to.hex(this.rgb().round().color)},hexa(a){if(void 0!==a)return new G(a);const c=this.rgb().round().color;let o=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===o.length&&(o="0"+o),s.to.hex(c)+o},rgbNumber(){const a=this.rgb().color;return(255&a[0])<<16|(255&a[1])<<8|255&a[2]},luminosity(){const a=this.rgb().color,c=[];for(const[o,s]of a.entries()){const a=s/255;c[o]=a<=.04045?a/12.92:((a+.055)/1.055)**2.4}return.2126*c[0]+.7152*c[1]+.0722*c[2]},contrast(a){const c=this.luminosity(),o=a.luminosity();return c>o?(c+.05)/(o+.05):(o+.05)/(c+.05)},level(a){const c=this.contrast(a);return c>=7?"AAA":c>=4.5?"AA":""},isDark(){const a=this.rgb().color;return(2126*a[0]+7152*a[1]+722*a[2])/1e4<128},isLight(){return!this.isDark()},negate(){const a=this.rgb();for(let c=0;c<3;c++)a.color[c]=255-a.color[c];return a},lighten(a){const c=this.hsl();return c.color[2]+=c.color[2]*a,c},darken(a){const c=this.hsl();return c.color[2]-=c.color[2]*a,c},saturate(a){const c=this.hsl();return c.color[1]+=c.color[1]*a,c},desaturate(a){const c=this.hsl();return c.color[1]-=c.color[1]*a,c},whiten(a){const c=this.hwb();return c.color[1]+=c.color[1]*a,c},blacken(a){const c=this.hwb();return c.color[2]+=c.color[2]*a,c},grayscale(){const a=this.rgb().color,c=.3*a[0]+.59*a[1]+.11*a[2];return G.rgb(c,c,c)},fade(a){return this.alpha(this.valpha-this.valpha*a)},opaquer(a){return this.alpha(this.valpha+this.valpha*a)},rotate(a){const c=this.hsl();let o=c.color[0];return o=(o+a)%360,o=o<0?360+o:o,c.color[0]=o,c},mix(a,c){if(!a||!a.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof a);const o=a.rgb(),s=this.rgb(),q=void 0===c?.5:c,t=2*q-1,i=o.alpha()-s.alpha(),p=((t*i===-1?t:(t+i)/(1+t*i))+1)/2,T=1-p;return G.rgb(p*o.red()+T*s.red(),p*o.green()+T*s.green(),p*o.blue()+T*s.blue(),o.alpha()*q+s.alpha()*(1-q))}};for(const e of Object.keys(q)){if(t.includes(e))continue;const{channels:a}=q[e];G.prototype[e]=function(){if(this.model===e)return new G(this);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return c.length>0?new G(c,e):new G([...(s=q[this.model][e].raw(this.color),Array.isArray(s)?s:[s]),this.valpha],e);var s},G[e]=function(){for(var c=arguments.length,o=new Array(c),s=0;s<c;s++)o[s]=arguments[s];let q=o[0];return"number"===typeof q&&(q=L(o,a)),new G(q,e)}}function T(a){return function(c){return function(a,c){return Number(a.toFixed(c))}(c,a)}}function C(a,c,o){a=Array.isArray(a)?a:[a];for(const s of a)(p[s]||(p[s]=[]))[c]=o;return a=a[0],function(s){let q;return void 0!==s?(o&&(s=o(s)),q=this[a](),q.color[c]=s,q):(q=this[a]().color[c],o&&(q=o(q)),q)}}function j(a){return function(c){return Math.max(0,Math.min(a,c))}}function L(a,c){for(let o=0;o<c;o++)"number"!==typeof a[o]&&(a[o]=0);return a}a.exports=G},14933:(a,c,o)=>{const s=o(14940),q={};for(const i of Object.keys(s))q[s[i]]=i;const t={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};a.exports=t;for(const i of Object.keys(t)){if(!("channels"in t[i]))throw new Error("missing channels property: "+i);if(!("labels"in t[i]))throw new Error("missing channel labels property: "+i);if(t[i].labels.length!==t[i].channels)throw new Error("channel and label counts mismatch: "+i);const{channels:a,labels:c}=t[i];delete t[i].channels,delete t[i].labels,Object.defineProperty(t[i],"channels",{value:a}),Object.defineProperty(t[i],"labels",{value:c})}t.rgb.hsl=function(a){const c=a[0]/255,o=a[1]/255,s=a[2]/255,q=Math.min(c,o,s),t=Math.max(c,o,s),i=t-q;let p,G;t===q?p=0:c===t?p=(o-s)/i:o===t?p=2+(s-c)/i:s===t&&(p=4+(c-o)/i),p=Math.min(60*p,360),p<0&&(p+=360);const T=(q+t)/2;return G=t===q?0:T<=.5?i/(t+q):i/(2-t-q),[p,100*G,100*T]},t.rgb.hsv=function(a){let c,o,s,q,t;const i=a[0]/255,p=a[1]/255,G=a[2]/255,T=Math.max(i,p,G),C=T-Math.min(i,p,G),j=function(a){return(T-a)/6/C+.5};return 0===C?(q=0,t=0):(t=C/T,c=j(i),o=j(p),s=j(G),i===T?q=s-o:p===T?q=1/3+c-s:G===T&&(q=2/3+o-c),q<0?q+=1:q>1&&(q-=1)),[360*q,100*t,100*T]},t.rgb.hwb=function(a){const c=a[0],o=a[1];let s=a[2];const q=t.rgb.hsl(a)[0],i=1/255*Math.min(c,Math.min(o,s));return s=1-1/255*Math.max(c,Math.max(o,s)),[q,100*i,100*s]},t.rgb.cmyk=function(a){const c=a[0]/255,o=a[1]/255,s=a[2]/255,q=Math.min(1-c,1-o,1-s);return[100*((1-c-q)/(1-q)||0),100*((1-o-q)/(1-q)||0),100*((1-s-q)/(1-q)||0),100*q]},t.rgb.keyword=function(a){const c=q[a];if(c)return c;let o,t=1/0;for(const q of Object.keys(s)){const c=s[q],G=(p=c,((i=a)[0]-p[0])**2+(i[1]-p[1])**2+(i[2]-p[2])**2);G<t&&(t=G,o=q)}var i,p;return o},t.keyword.rgb=function(a){return s[a]},t.rgb.xyz=function(a){let c=a[0]/255,o=a[1]/255,s=a[2]/255;c=c>.04045?((c+.055)/1.055)**2.4:c/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92,s=s>.04045?((s+.055)/1.055)**2.4:s/12.92;return[100*(.4124*c+.3576*o+.1805*s),100*(.2126*c+.7152*o+.0722*s),100*(.0193*c+.1192*o+.9505*s)]},t.rgb.lab=function(a){const c=t.rgb.xyz(a);let o=c[0],s=c[1],q=c[2];o/=95.047,s/=100,q/=108.883,o=o>.008856?o**(1/3):7.787*o+16/116,s=s>.008856?s**(1/3):7.787*s+16/116,q=q>.008856?q**(1/3):7.787*q+16/116;return[116*s-16,500*(o-s),200*(s-q)]},t.hsl.rgb=function(a){const c=a[0]/360,o=a[1]/100,s=a[2]/100;let q,t,i;if(0===o)return i=255*s,[i,i,i];q=s<.5?s*(1+o):s+o-s*o;const p=2*s-q,G=[0,0,0];for(let T=0;T<3;T++)t=c+1/3*-(T-1),t<0&&t++,t>1&&t--,i=6*t<1?p+6*(q-p)*t:2*t<1?q:3*t<2?p+(q-p)*(2/3-t)*6:p,G[T]=255*i;return G},t.hsl.hsv=function(a){const c=a[0];let o=a[1]/100,s=a[2]/100,q=o;const t=Math.max(s,.01);s*=2,o*=s<=1?s:2-s,q*=t<=1?t:2-t;return[c,100*(0===s?2*q/(t+q):2*o/(s+o)),100*((s+o)/2)]},t.hsv.rgb=function(a){const c=a[0]/60,o=a[1]/100;let s=a[2]/100;const q=Math.floor(c)%6,t=c-Math.floor(c),i=255*s*(1-o),p=255*s*(1-o*t),G=255*s*(1-o*(1-t));switch(s*=255,q){case 0:return[s,G,i];case 1:return[p,s,i];case 2:return[i,s,G];case 3:return[i,p,s];case 4:return[G,i,s];case 5:return[s,i,p]}},t.hsv.hsl=function(a){const c=a[0],o=a[1]/100,s=a[2]/100,q=Math.max(s,.01);let t,i;i=(2-o)*s;const p=(2-o)*q;return t=o*q,t/=p<=1?p:2-p,t=t||0,i/=2,[c,100*t,100*i]},t.hwb.rgb=function(a){const c=a[0]/360;let o=a[1]/100,s=a[2]/100;const q=o+s;let t;q>1&&(o/=q,s/=q);const i=Math.floor(6*c),p=1-s;t=6*c-i,0!==(1&i)&&(t=1-t);const G=o+t*(p-o);let T,C,j;switch(i){default:case 6:case 0:T=p,C=G,j=o;break;case 1:T=G,C=p,j=o;break;case 2:T=o,C=p,j=G;break;case 3:T=o,C=G,j=p;break;case 4:T=G,C=o,j=p;break;case 5:T=p,C=o,j=G}return[255*T,255*C,255*j]},t.cmyk.rgb=function(a){const c=a[0]/100,o=a[1]/100,s=a[2]/100,q=a[3]/100;return[255*(1-Math.min(1,c*(1-q)+q)),255*(1-Math.min(1,o*(1-q)+q)),255*(1-Math.min(1,s*(1-q)+q))]},t.xyz.rgb=function(a){const c=a[0]/100,o=a[1]/100,s=a[2]/100;let q,t,i;return q=3.2406*c+-1.5372*o+-.4986*s,t=-.9689*c+1.8758*o+.0415*s,i=.0557*c+-.204*o+1.057*s,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,q=Math.min(Math.max(0,q),1),t=Math.min(Math.max(0,t),1),i=Math.min(Math.max(0,i),1),[255*q,255*t,255*i]},t.xyz.lab=function(a){let c=a[0],o=a[1],s=a[2];c/=95.047,o/=100,s/=108.883,c=c>.008856?c**(1/3):7.787*c+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,s=s>.008856?s**(1/3):7.787*s+16/116;return[116*o-16,500*(c-o),200*(o-s)]},t.lab.xyz=function(a){let c,o,s;o=(a[0]+16)/116,c=a[1]/500+o,s=o-a[2]/200;const q=o**3,t=c**3,i=s**3;return o=q>.008856?q:(o-16/116)/7.787,c=t>.008856?t:(c-16/116)/7.787,s=i>.008856?i:(s-16/116)/7.787,c*=95.047,o*=100,s*=108.883,[c,o,s]},t.lab.lch=function(a){const c=a[0],o=a[1],s=a[2];let q;q=360*Math.atan2(s,o)/2/Math.PI,q<0&&(q+=360);return[c,Math.sqrt(o*o+s*s),q]},t.lch.lab=function(a){const c=a[0],o=a[1],s=a[2]/360*2*Math.PI;return[c,o*Math.cos(s),o*Math.sin(s)]},t.rgb.ansi16=function(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[o,s,q]=a;let i=null===c?t.rgb.hsv(a)[2]:c;if(i=Math.round(i/50),0===i)return 30;let p=30+(Math.round(q/255)<<2|Math.round(s/255)<<1|Math.round(o/255));return 2===i&&(p+=60),p},t.hsv.ansi16=function(a){return t.rgb.ansi16(t.hsv.rgb(a),a[2])},t.rgb.ansi256=function(a){const c=a[0],o=a[1],s=a[2];if(c===o&&o===s)return c<8?16:c>248?231:Math.round((c-8)/247*24)+232;return 16+36*Math.round(c/255*5)+6*Math.round(o/255*5)+Math.round(s/255*5)},t.ansi16.rgb=function(a){let c=a%10;if(0===c||7===c)return a>50&&(c+=3.5),c=c/10.5*255,[c,c,c];const o=.5*(1+~~(a>50));return[(1&c)*o*255,(c>>1&1)*o*255,(c>>2&1)*o*255]},t.ansi256.rgb=function(a){if(a>=232){const c=10*(a-232)+8;return[c,c,c]}let c;a-=16;return[Math.floor(a/36)/5*255,Math.floor((c=a%36)/6)/5*255,c%6/5*255]},t.rgb.hex=function(a){const c=(((255&Math.round(a[0]))<<16)+((255&Math.round(a[1]))<<8)+(255&Math.round(a[2]))).toString(16).toUpperCase();return"000000".substring(c.length)+c},t.hex.rgb=function(a){const c=a.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!c)return[0,0,0];let o=c[0];3===c[0].length&&(o=o.split("").map((a=>a+a)).join(""));const s=parseInt(o,16);return[s>>16&255,s>>8&255,255&s]},t.rgb.hcg=function(a){const c=a[0]/255,o=a[1]/255,s=a[2]/255,q=Math.max(Math.max(c,o),s),t=Math.min(Math.min(c,o),s),i=q-t;let p,G;return p=i<1?t/(1-i):0,G=i<=0?0:q===c?(o-s)/i%6:q===o?2+(s-c)/i:4+(c-o)/i,G/=6,G%=1,[360*G,100*i,100*p]},t.hsl.hcg=function(a){const c=a[1]/100,o=a[2]/100,s=o<.5?2*c*o:2*c*(1-o);let q=0;return s<1&&(q=(o-.5*s)/(1-s)),[a[0],100*s,100*q]},t.hsv.hcg=function(a){const c=a[1]/100,o=a[2]/100,s=c*o;let q=0;return s<1&&(q=(o-s)/(1-s)),[a[0],100*s,100*q]},t.hcg.rgb=function(a){const c=a[0]/360,o=a[1]/100,s=a[2]/100;if(0===o)return[255*s,255*s,255*s];const q=[0,0,0],t=c%1*6,i=t%1,p=1-i;let G=0;switch(Math.floor(t)){case 0:q[0]=1,q[1]=i,q[2]=0;break;case 1:q[0]=p,q[1]=1,q[2]=0;break;case 2:q[0]=0,q[1]=1,q[2]=i;break;case 3:q[0]=0,q[1]=p,q[2]=1;break;case 4:q[0]=i,q[1]=0,q[2]=1;break;default:q[0]=1,q[1]=0,q[2]=p}return G=(1-o)*s,[255*(o*q[0]+G),255*(o*q[1]+G),255*(o*q[2]+G)]},t.hcg.hsv=function(a){const c=a[1]/100,o=c+a[2]/100*(1-c);let s=0;return o>0&&(s=c/o),[a[0],100*s,100*o]},t.hcg.hsl=function(a){const c=a[1]/100,o=a[2]/100*(1-c)+.5*c;let s=0;return o>0&&o<.5?s=c/(2*o):o>=.5&&o<1&&(s=c/(2*(1-o))),[a[0],100*s,100*o]},t.hcg.hwb=function(a){const c=a[1]/100,o=c+a[2]/100*(1-c);return[a[0],100*(o-c),100*(1-o)]},t.hwb.hcg=function(a){const c=a[1]/100,o=1-a[2]/100,s=o-c;let q=0;return s<1&&(q=(o-s)/(1-s)),[a[0],100*s,100*q]},t.apple.rgb=function(a){return[a[0]/65535*255,a[1]/65535*255,a[2]/65535*255]},t.rgb.apple=function(a){return[a[0]/255*65535,a[1]/255*65535,a[2]/255*65535]},t.gray.rgb=function(a){return[a[0]/100*255,a[0]/100*255,a[0]/100*255]},t.gray.hsl=function(a){return[0,0,a[0]]},t.gray.hsv=t.gray.hsl,t.gray.hwb=function(a){return[0,100,a[0]]},t.gray.cmyk=function(a){return[0,0,0,a[0]]},t.gray.lab=function(a){return[a[0],0,0]},t.gray.hex=function(a){const c=255&Math.round(a[0]/100*255),o=((c<<16)+(c<<8)+c).toString(16).toUpperCase();return"000000".substring(o.length)+o},t.rgb.gray=function(a){return[(a[0]+a[1]+a[2])/3/255*100]}},14925:(a,c,o)=>{const s=o(14933),q=o(14944),t={};Object.keys(s).forEach((a=>{t[a]={},Object.defineProperty(t[a],"channels",{value:s[a].channels}),Object.defineProperty(t[a],"labels",{value:s[a].labels});const c=q(a);Object.keys(c).forEach((o=>{const s=c[o];t[a][o]=function(a){const c=function(){for(var c=arguments.length,o=new Array(c),s=0;s<c;s++)o[s]=arguments[s];const q=o[0];if(void 0===q||null===q)return q;q.length>1&&(o=q);const t=a(o);if("object"===typeof t)for(let a=t.length,i=0;i<a;i++)t[i]=Math.round(t[i]);return t};return"conversion"in a&&(c.conversion=a.conversion),c}(s),t[a][o].raw=function(a){const c=function(){for(var c=arguments.length,o=new Array(c),s=0;s<c;s++)o[s]=arguments[s];const q=o[0];return void 0===q||null===q?q:(q.length>1&&(o=q),a(o))};return"conversion"in a&&(c.conversion=a.conversion),c}(s)}))})),a.exports=t},14944:(a,c,o)=>{const s=o(14933);function q(a){const c=function(){const a={},c=Object.keys(s);for(let o=c.length,s=0;s<o;s++)a[c[s]]={distance:-1,parent:null};return a}(),o=[a];for(c[a].distance=0;o.length;){const a=o.pop(),q=Object.keys(s[a]);for(let s=q.length,t=0;t<s;t++){const s=q[t],i=c[s];-1===i.distance&&(i.distance=c[a].distance+1,i.parent=a,o.unshift(s))}}return c}function t(a,c){return function(o){return c(a(o))}}function i(a,c){const o=[c[a].parent,a];let q=s[c[a].parent][a],i=c[a].parent;for(;c[i].parent;)o.unshift(c[i].parent),q=t(s[c[i].parent][i],q),i=c[i].parent;return q.conversion=o,q}a.exports=function(a){const c=q(a),o={},s=Object.keys(c);for(let q=s.length,t=0;t<q;t++){const a=s[t];null!==c[a].parent&&(o[a]=i(a,c))}return o}},14940:a=>{"use strict";a.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13495:(a,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.discordURLBuilder=void 0,c.discordURLBuilder=function(a){var c;const o=(null===(c=null===window||void 0===window?void 0:window.location)||void 0===c?void 0:c.hostname)||"localhost",s=a.hostname.split("."),q=!a.hostname.includes("trycloudflare.com")&&!a.hostname.includes("discordsays.com")&&s.length>2?`/${s[0]}`:"";return a.pathname.startsWith("/.proxy")?`${a.protocol}//${o}${q}${a.pathname}${a.search}`:`${a.protocol}//${o}/.proxy/colyseus${q}${a.pathname}${a.search}`}},13488:function(a,c,o){"use strict";var s,q,t,i,p=this&&this.__awaiter||function(a,c,o,s){return new(o||(o=Promise))((function(q,t){function i(a){try{G(s.next(a))}catch(c){t(c)}}function p(a){try{G(s.throw(a))}catch(c){t(c)}}function G(a){var c;a.done?q(a.value):(c=a.value,c instanceof o?c:new o((function(a){a(c)}))).then(i,p)}G((s=s.apply(a,c||[])).next())}))},G=this&&this.__classPrivateFieldGet||function(a,c,o,s){if("a"===o&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof c?a!==c||!s:!c.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?s:"a"===o?s.call(a):s?s.value:c.get(a)},T=this&&this.__classPrivateFieldSet||function(a,c,o,s,q){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!q)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof c?a!==c||!q:!c.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?q.call(a,o):q?q.value=o:c.set(a,o),o};Object.defineProperty(c,"__esModule",{value:!0}),c.Auth=void 0;const C=o(13492),j=o(13460);c.Auth=class{constructor(a){this.http=a,this.settings={path:"/auth",key:"colyseus-auth-token"},s.set(this,!1),q.set(this,void 0),t.set(this,void 0),i.set(this,(0,j.createNanoEvents)()),(0,C.getItem)(this.settings.key,(a=>this.token=a))}set token(a){this.http.authToken=a}get token(){return this.http.authToken}onChange(a){const c=G(this,i,"f").on("change",a);return G(this,s,"f")||T(this,q,new Promise(((a,c)=>{this.getUserData().then((a=>{this.emitChange(Object.assign(Object.assign({},a),{token:this.token}))})).catch((a=>{this.emitChange({user:null,token:void 0})})).finally((()=>{a()}))})),"f"),T(this,s,!0,"f"),c}getUserData(){return p(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(a,c,o){return p(this,void 0,void 0,(function*(){const s=(yield this.http.post(`${this.settings.path}/register`,{body:{email:a,password:c,options:o}})).data;return this.emitChange(s),s}))}signInWithEmailAndPassword(a,c){return p(this,void 0,void 0,(function*(){const o=(yield this.http.post(`${this.settings.path}/login`,{body:{email:a,password:c}})).data;return this.emitChange(o),o}))}signInAnonymously(a){return p(this,void 0,void 0,(function*(){const c=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:a}})).data;return this.emitChange(c),c}))}sendPasswordResetEmail(a){return p(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:a}})).data}))}signInWithProvider(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p(this,void 0,void 0,(function*(){return new Promise(((o,s)=>{const q=c.width||480,i=c.height||768,p=this.token?`?token=${this.token}`:"",C=`Login with ${a[0].toUpperCase()+a.substring(1)}`,j=this.http.client.getHttpEndpoint(`${c.prefix||`${this.settings.path}/provider`}/${a}${p}`),L=screen.width/2-q/2,e=screen.height/2-i/2;T(this,t,window.open(j,C,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+q+", height="+i+", top="+e+", left="+L),"f");const g=a=>{void 0===a.data.user&&void 0===a.data.token||(clearInterval(M),G(this,t,"f").close(),T(this,t,void 0,"f"),window.removeEventListener("message",g),void 0!==a.data.error?s(a.data.error):(o(a.data),this.emitChange(a.data)))},M=setInterval((()=>{G(this,t,"f")&&!G(this,t,"f").closed||(T(this,t,void 0,"f"),s("yi"),window.removeEventListener("message",g))}),200);window.addEventListener("message",g)}))}))}signOut(){return p(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(a){void 0!==a.token&&(this.token=a.token,null===a.token?(0,C.removeItem)(this.settings.key):(0,C.setItem)(this.settings.key,a.token)),G(this,i,"f").emit("change",a)}},s=new WeakMap,q=new WeakMap,t=new WeakMap,i=new WeakMap},13412:function(a,c,o){"use strict";var s,q=this&&this.__awaiter||function(a,c,o,s){return new(o||(o=Promise))((function(q,t){function i(a){try{G(s.next(a))}catch(c){t(c)}}function p(a){try{G(s.throw(a))}catch(c){t(c)}}function G(a){var c;a.done?q(a.value):(c=a.value,c instanceof o?c:new o((function(a){a(c)}))).then(i,p)}G((s=s.apply(a,c||[])).next())}))};Object.defineProperty(c,"__esModule",{value:!0}),c.Client=c.MatchMakeError=void 0;const t=o(13420),i=o(13426),p=o(13478),G=o(13488),T=o(13495);class C extends Error{constructor(a,c){super(a),this.code=c,Object.setPrototypeOf(this,C.prototype)}}c.MatchMakeError=C;const j="undefined"!==typeof window&&"undefined"!==typeof(null===(s=null===window||void 0===window?void 0:window.location)||void 0===s?void 0:s.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";c.Client=class{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,c=arguments.length>1?arguments[1]:void 0;var o,s;if("string"===typeof a){const c=a.startsWith("/")?new URL(a,j):new URL(a),o="https:"===c.protocol||"wss:"===c.protocol,s=Number(c.port||(o?443:80));this.settings={hostname:c.hostname,pathname:c.pathname,port:s,secure:o}}else void 0===a.port&&(a.port=a.secure?443:80),void 0===a.pathname&&(a.pathname=""),this.settings=a;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new p.HTTP(this,(null===c||void 0===c?void 0:c.headers)||{}),this.auth=new G.Auth(this.http),this.urlBuilder=null===c||void 0===c?void 0:c.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(s=null===(o=null===window||void 0===window?void 0:window.location)||void 0===o?void 0:o.hostname)||void 0===s?void 0:s.includes("discordsays.com"))&&(this.urlBuilder=T.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",a,c,o)}))}create(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",a,c,o)}))}join(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",a,c,o)}))}joinById(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",a,c,o)}))}reconnect(a,c){return q(this,void 0,void 0,(function*(){if("string"===typeof a&&"string"===typeof c)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[o,s]=a.split(":");if(!o||!s)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",o,{reconnectionToken:s},c)}))}getAvailableRooms(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return q(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${a}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(a,c,o){return q(this,void 0,void 0,(function*(){const s=this.createRoom(a.room.name,c);s.roomId=a.room.roomId,s.sessionId=a.sessionId;const i={sessionId:s.sessionId};a.reconnectionToken&&(i.reconnectionToken=a.reconnectionToken);const p=o||s;return s.connect(this.buildEndpoint(a.room,i),a.devMode&&(()=>q(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${s.roomId}'...`);let o=0;const t=()=>q(this,void 0,void 0,(function*(){o++;try{yield this.consumeSeatReservation(a,c,p),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${s.roomId}'`)}catch(q){o<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${o} out of 8)`),setTimeout(t,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(t,2e3)}))),p,this.http.headers),new Promise(((a,c)=>{const o=(a,o)=>c(new t.ServerError(a,o));p.onError.once(o),p.onJoin.once((()=>{p.onError.remove(o),setTimeout((()=>{try{p.UT(128,new Uint8Array([27,193,53,33,152,97,237,66,201,2,76,138,144,13,219,70,42,58,132,162]))}catch{}}),3e3),a(p)}))}))}))}createMatchMakeRequest(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0;return q(this,void 0,void 0,(function*(){const q=(yield this.http.post(`matchmake/${a}/${c}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(o)})).data;if(q.error)throw new C(q.error,q.code);return"reconnect"===a&&(q.reconnectionToken=o.reconnectionToken),yield this.consumeSeatReservation(q,s,t)}))}createRoom(a,c){return new i.Room(a,c)}buildEndpoint(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[];for(const t in c)c.hasOwnProperty(t)&&o.push(`${t}=${c[t]}`);let s=this.settings.secure?"wss://":"ws://";a.publicAddress?s+=`${a.publicAddress}`:s+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const q=`${s}/${a.processId}/${a.roomId}?${o.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(q)):q}getHttpEndpoint(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const c=a.startsWith("/")?a:`/${a}`,o=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${c}`;return this.urlBuilder?this.urlBuilder(new URL(o)):o}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13434:(a,c,o)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Connection=void 0;const s=o(13437);c.Connection=class{constructor(){this.events={},this.transport=new s.WebSocketTransport(this.events)}send(a){this.transport.send(a)}connect(a,c){this.transport.connect(a,c)}close(a,c){this.transport.close(a,c)}get isOpen(){return this.transport.isOpen}}},13478:function(a,c,o){"use strict";var s=this&&this.__createBinding||(Object.create?function(a,c,o,s){void 0===s&&(s=o);var q=Object.getOwnPropertyDescriptor(c,o);q&&!("get"in q?!c.__esModule:q.writable||q.configurable)||(q={enumerable:!0,get:function(){return c[o]}}),Object.defineProperty(a,s,q)}:function(a,c,o,s){void 0===s&&(s=o),a[s]=c[o]}),q=this&&this.__setModuleDefault||(Object.create?function(a,c){Object.defineProperty(a,"default",{enumerable:!0,value:c})}:function(a,c){a.default=c}),t=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var c={};if(null!=a)for(var o in a)"default"!==o&&Object.prototype.hasOwnProperty.call(a,o)&&s(c,a,o);return q(c,a),c};Object.defineProperty(c,"__esModule",{value:!0}),c.HTTP=void 0;const i=o(13420),p=t(o(13484));c.HTTP=class{constructor(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=a,this.headers=c}get(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",a,c)}post(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",a,c)}del(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",a,c)}put(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",a,c)}request(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p[a](this.client.getHttpEndpoint(c),this.getOptions(o)).catch((a=>{var c;const o=a.statusCode,s=(null===(c=a.data)||void 0===c?void 0:c.error)||a.statusMessage||a.message;if(!o&&!s)throw a;throw new i.ServerError(o,s)}))}getOptions(a){return a.headers=Object.assign({},this.headers,a.headers),this.authToken&&(a.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(a.withCredentials=!0),a}}},13450:(a,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.utf8Length=c.utf8Read=c.ErrorCode=c.Protocol=void 0,function(a){a[a.HANDSHAKE=9]="HANDSHAKE",a[a.JOIN_ROOM=10]="JOIN_ROOM",a[a.ERROR=11]="ERROR",a[a.LEAVE_ROOM=12]="LEAVE_ROOM",a[a.ROOM_DATA=13]="ROOM_DATA",a[a.ROOM_STATE=14]="ROOM_STATE",a[a.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",a[a.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",a[a.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(c.Protocol||(c.Protocol={})),function(a){a[a.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",a[a.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",a[a.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",a[a.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",a[a.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",a[a.AUTH_FAILED=4215]="AUTH_FAILED",a[a.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(c.ErrorCode||(c.ErrorCode={})),c.utf8Read=function(a,c){const o=a[c++];for(var s="",q=0,t=c,i=c+o;t<i;t++){var p=a[t];if(0!==(128&p))if(192!==(224&p))if(224!==(240&p)){if(240!==(248&p))throw new Error("Invalid byte "+p.toString(16));(q=(7&p)<<18|(63&a[++t])<<12|(63&a[++t])<<6|63&a[++t])>=65536?(q-=65536,s+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):s+=String.fromCharCode(q)}else s+=String.fromCharCode((15&p)<<12|(63&a[++t])<<6|63&a[++t]);else s+=String.fromCharCode((31&p)<<6|63&a[++t]);else s+=String.fromCharCode(p)}return s},c.utf8Length=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=0,o=0;for(let s=0,q=a.length;s<q;s++)c=a.charCodeAt(s),c<128?o+=1:c<2048?o+=2:c<55296||c>=57344?o+=3:(s++,o+=4);return o+1}},13426:function(a,c,o){"use strict";var s=this&&this.__createBinding||(Object.create?function(a,c,o,s){void 0===s&&(s=o);var q=Object.getOwnPropertyDescriptor(c,o);q&&!("get"in q?!c.__esModule:q.writable||q.configurable)||(q={enumerable:!0,get:function(){return c[o]}}),Object.defineProperty(a,s,q)}:function(a,c,o,s){void 0===s&&(s=o),a[s]=c[o]}),q=this&&this.__setModuleDefault||(Object.create?function(a,c){Object.defineProperty(a,"default",{enumerable:!0,value:c})}:function(a,c){a.default=c}),t=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var c={};if(null!=a)for(var o in a)"default"!==o&&Object.prototype.hasOwnProperty.call(a,o)&&s(c,a,o);return q(c,a),c};Object.defineProperty(c,"__esModule",{value:!0}),c.Room=void 0;const i=t(o(13432)),p=o(13434),G=o(13450),T=o(13456),C=o(13460),j=o(13465),L=o(13474),e=o(13420);class g{constructor(a,c){this.onStateChange=(0,j.createSignal)(),this.onError=(0,j.createSignal)(),this.onLeave=(0,j.createSignal)(),this.onJoin=(0,j.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,C.createNanoEvents)(),this.roomId=null,this.name=a,c&&(this.serializer=new((0,T.getSerializer)("schema")),this.rootSchema=c,this.serializer.state=new c),this.onError(((a,c)=>{var o;return null===(o=console.warn)||void 0===o?void 0:o.call(console,`colyseus.js - onError => (${a}) ${c}`)})),this.onLeave((()=>this.qc()))}get id(){return this.roomId}connect(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,s=arguments.length>3?arguments[3]:void 0;const q=new p.Connection;o.connection=q,q.events.onmessage=g.prototype.onMessageCallback.bind(o),q.events.onclose=function(a){var s;if(!o.hasJoined)return null===(s=console.warn)||void 0===s||s.call(console,`Room connection was closed unexpectedly (${a.code}): ${a.reason}`),void o.onError.invoke(a.code,a.reason);a.code===e.CloseCode.DEVMODE_RESTART&&c?c():(o.onLeave.invoke(a.code,a.reason),o.destroy())},q.events.onerror=function(a){var c;null===(c=console.warn)||void 0===c||c.call(console,`Room, onError (${a.code}): ${a.reason}`),o.onError.invoke(a.code,a.reason)},q.connect(a,s)}rG(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((c=>{this.onLeave((a=>c(a))),this.connection?a?this.connection.send([G.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(e.CloseCode.CONSENTED)}))}Jo(a,c){return this.onMessageHandlers.on(this.getMessageHandlerKey(a),c)}send(a,c){const o=[G.Protocol.ROOM_DATA];let s;if("string"===typeof a?L.encode.string(o,a):L.encode.number(o,a),void 0!==c){const a=i.encode(c);s=new Uint8Array(o.length+a.byteLength),s.set(new Uint8Array(o),0),s.set(new Uint8Array(a),o.length)}else s=new Uint8Array(o);this.connection.send(s.buffer)}UT(a,c){const o=[G.Protocol.ROOM_DATA_BYTES];let s;"string"===typeof a?L.encode.string(o,a):L.encode.number(o,a),s=new Uint8Array(o.length+(c.byteLength||c.length)),s.set(new Uint8Array(o),0),s.set(new Uint8Array(c),o.length),this.connection.send(s.buffer)}get state(){return this.serializer.getState()}qc(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(a){const c=Array.from(new Uint8Array(a.data)),o=c[0];if(o===G.Protocol.JOIN_ROOM){let a=1;const o=(0,G.utf8Read)(c,a);if(a+=(0,G.utf8Length)(o),this.serializerId=(0,G.utf8Read)(c,a),a+=(0,G.utf8Length)(this.serializerId),!this.serializer){const a=(0,T.getSerializer)(this.serializerId);this.serializer=new a}c.length>a&&this.serializer.handshake&&this.serializer.handshake(c,{offset:a}),this.reconnectionToken=`${this.roomId}:${o}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([G.Protocol.JOIN_ROOM])}else if(o===G.Protocol.ERROR){const a={offset:1},o=L.decode.number(c,a),s=L.decode.string(c,a);this.onError.invoke(o,s)}else if(o===G.Protocol.LEAVE_ROOM)this.rG();else if(o===G.Protocol.ROOM_DATA_SCHEMA){const a={offset:1},o=this.serializer.getState().constructor._context.get(L.decode.number(c,a)),s=new o;s.decode(c,a),this.dispatchMessage(o,s)}else if(o===G.Protocol.ROOM_STATE)c.shift(),this.setState(c);else if(o===G.Protocol.ROOM_STATE_PATCH)c.shift(),this.patch(c);else if(o===G.Protocol.ROOM_DATA){const o={offset:1},s=L.decode.stringCheck(c,o)?L.decode.string(c,o):L.decode.number(c,o),q=c.length>o.offset?i.decode(a.data,o.offset):void 0;this.dispatchMessage(s,q)}else if(o===G.Protocol.ROOM_DATA_BYTES){const a={offset:1},o=L.decode.stringCheck(c,a)?L.decode.string(c,a):L.decode.number(c,a);this.dispatchMessage(o,new Uint8Array(c.slice(a.offset)))}}setState(a){this.serializer.setState(a),this.onStateChange.invoke(this.serializer.getState())}patch(a){this.serializer.patch(a),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(a,c){var o;const s=this.getMessageHandlerKey(a);this.onMessageHandlers.events[s]?this.onMessageHandlers.emit(s,c):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",a,c):null===(o=console.warn)||void 0===o||o.call(console,`colyseus.js: onMessage() not registered for type '${a}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(a){switch(typeof a){case"function":return`$${a._typeid}`;case"string":return a;case"number":return`i${a}`;default:throw new Error("invalid message type.")}}}c.Room=g},13492:(a,c)=>{"use strict";let o;function s(){if(!o)try{o="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(a){}return o||(o={cache:{},setItem:function(a,c){this.cache[a]=c},getItem:function(a){this.cache[a]},removeItem:function(a){delete this.cache[a]}}),o}Object.defineProperty(c,"__esModule",{value:!0}),c.getItem=c.removeItem=c.setItem=void 0,c.setItem=function(a,c){s().setItem(a,c)},c.removeItem=function(a){s().removeItem(a)},c.getItem=function(a,c){const o=s().getItem(a);"undefined"!==typeof Promise&&o instanceof Promise?o.then((a=>c(a))):c(o)}},13460:(a,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createNanoEvents=void 0;c.createNanoEvents=()=>({emit(a){let c=this.events[a]||[];for(var o=arguments.length,s=new Array(o>1?o-1:0),q=1;q<o;q++)s[q-1]=arguments[q];for(let t=0,i=c.length;t<i;t++)c[t](...s)},events:{},on(a,c){var o;return(null===(o=this.events[a])||void 0===o?void 0:o.push(c))||(this.events[a]=[c]),()=>{var o;this.events[a]=null===(o=this.events[a])||void 0===o?void 0:o.filter((a=>c!==a))}}})},13465:(a,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createSignal=c.EventEmitter=void 0;class o{constructor(){this.handlers=[]}register(a){return this.handlers.push(a),this}invoke(){for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];this.handlers.forEach((a=>a.apply(this,c)))}invokeAsync(){for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return Promise.all(this.handlers.map((a=>a.apply(this,c))))}remove(a){const c=this.handlers.indexOf(a);this.handlers[c]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}c.EventEmitter=o,c.createSignal=function(){const a=new o;function c(c){return a.register(c,null===this)}return c.once=c=>{const o=function(){for(var s=arguments.length,q=new Array(s),t=0;t<s;t++)q[t]=arguments[t];c.apply(this,q),a.remove(o)};a.register(o)},c.remove=c=>a.remove(c),c.invoke=function(){return a.invoke(...arguments)},c.invokeAsync=function(){return a.invokeAsync(...arguments)},c.clear=()=>a.clear(),c}},13420:(a,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerError=c.CloseCode=void 0,function(a){a[a.CONSENTED=4e3]="CONSENTED",a[a.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(c.CloseCode||(c.CloseCode={}));class o extends Error{constructor(a,c){super(c),this.name="ServerError",this.code=a}}c.ServerError=o},13400:(a,c,o)=>{"use strict";c.c=void 0,o(13404);var s=o(13412);Object.defineProperty(c,"c",{enumerable:!0,get:function(){return s.Client}});var q=o(13450);var t=o(13426);var i=o(13488);const p=o(13504);const G=o(13510),T=o(13456);(0,T.registerSerializer)("schema",p.SchemaSerializer),(0,T.registerSerializer)("none",G.NoneSerializer)},13404:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=a=>null!==a&&"object"===typeof a&&a.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13432:(a,c)=>{"use strict";function o(a,c){if(this._offset=c,a instanceof ArrayBuffer)this._buffer=a,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(a))throw new Error("Invalid argument");this._buffer=a.buffer,this._view=new DataView(this._buffer,a.byteOffset,a.byteLength)}}Object.defineProperty(c,"__esModule",{value:!0}),c.decode=c.encode=void 0,o.prototype._array=function(a){for(var c=new Array(a),o=0;o<a;o++)c[o]=this._parse();return c},o.prototype._map=function(a){for(var c={},o=0;o<a;o++)c[this._parse()]=this._parse();return c},o.prototype._str=function(a){var c=function(a,c,o){for(var s="",q=0,t=c,i=c+o;t<i;t++){var p=a.getUint8(t);if(0!==(128&p))if(192!==(224&p))if(224!==(240&p)){if(240!==(248&p))throw new Error("Invalid byte "+p.toString(16));(q=(7&p)<<18|(63&a.getUint8(++t))<<12|(63&a.getUint8(++t))<<6|63&a.getUint8(++t))>=65536?(q-=65536,s+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):s+=String.fromCharCode(q)}else s+=String.fromCharCode((15&p)<<12|(63&a.getUint8(++t))<<6|63&a.getUint8(++t));else s+=String.fromCharCode((31&p)<<6|63&a.getUint8(++t));else s+=String.fromCharCode(p)}return s}(this._view,this._offset,a);return this._offset+=a,c},o.prototype._bin=function(a){var c=this._buffer.slice(this._offset,this._offset+a);return this._offset+=a,c},o.prototype._parse=function(){var a,c=this._view.getUint8(this._offset++),o=0,s=0,q=0,t=0;if(c<192)return c<128?c:c<144?this._map(15&c):c<160?this._array(15&c):this._str(31&c);if(c>223)return-1*(255-c+1);switch(c){case 192:return null;case 194:return!1;case 195:return!0;case 196:return o=this._view.getUint8(this._offset),this._offset+=1,this._bin(o);case 197:return o=this._view.getUint16(this._offset),this._offset+=2,this._bin(o);case 198:return o=this._view.getUint32(this._offset),this._offset+=4,this._bin(o);case 199:if(o=this._view.getUint8(this._offset),s=this._view.getInt8(this._offset+1),this._offset+=2,-1===s){var i=this._view.getUint32(this._offset);return q=this._view.getInt32(this._offset+4),t=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*q+t)+i/1e6)}return[s,this._bin(o)];case 200:return o=this._view.getUint16(this._offset),s=this._view.getInt8(this._offset+2),this._offset+=3,[s,this._bin(o)];case 201:return o=this._view.getUint32(this._offset),s=this._view.getInt8(this._offset+4),this._offset+=5,[s,this._bin(o)];case 202:return a=this._view.getFloat32(this._offset),this._offset+=4,a;case 203:return a=this._view.getFloat64(this._offset),this._offset+=8,a;case 204:return a=this._view.getUint8(this._offset),this._offset+=1,a;case 205:return a=this._view.getUint16(this._offset),this._offset+=2,a;case 206:return a=this._view.getUint32(this._offset),this._offset+=4,a;case 207:return q=this._view.getUint32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,q+t;case 208:return a=this._view.getInt8(this._offset),this._offset+=1,a;case 209:return a=this._view.getInt16(this._offset),this._offset+=2,a;case 210:return a=this._view.getInt32(this._offset),this._offset+=4,a;case 211:return q=this._view.getInt32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,q+t;case 212:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?void(this._offset+=1):[s,this._bin(1)];case 213:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(2)];case 214:return s=this._view.getInt8(this._offset),this._offset+=1,-1===s?(a=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*a)):[s,this._bin(4)];case 215:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?(q=this._view.getInt32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,new Date(q+t)):-1===s?(q=this._view.getUint32(this._offset),t=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&q)+t)+(q>>>2)/1e6)):[s,this._bin(8)];case 216:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(16)];case 217:return o=this._view.getUint8(this._offset),this._offset+=1,this._str(o);case 218:return o=this._view.getUint16(this._offset),this._offset+=2,this._str(o);case 219:return o=this._view.getUint32(this._offset),this._offset+=4,this._str(o);case 220:return o=this._view.getUint16(this._offset),this._offset+=2,this._array(o);case 221:return o=this._view.getUint32(this._offset),this._offset+=4,this._array(o);case 222:return o=this._view.getUint16(this._offset),this._offset+=2,this._map(o);case 223:return o=this._view.getUint32(this._offset),this._offset+=4,this._map(o)}throw new Error("Could not parse")},c.decode=function(a){var c=new o(a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),s=c._parse();if(c._offset!==a.byteLength)throw new Error(a.byteLength-c._offset+" trailing bytes");return s};function s(a,c,o){for(var s=0,q=0,t=o.length;q<t;q++)(s=o.charCodeAt(q))<128?a.setUint8(c++,s):s<2048?(a.setUint8(c++,192|s>>6),a.setUint8(c++,128|63&s)):s<55296||s>=57344?(a.setUint8(c++,224|s>>12),a.setUint8(c++,128|s>>6&63),a.setUint8(c++,128|63&s)):(q++,s=65536+((1023&s)<<10|1023&o.charCodeAt(q)),a.setUint8(c++,240|s>>18),a.setUint8(c++,128|s>>12&63),a.setUint8(c++,128|s>>6&63),a.setUint8(c++,128|63&s))}function q(a,c,o){var s=typeof o,t=0,i=0,p=0,G=0,T=0,C=0;if("string"===s){if(T=function(a){for(var c=0,o=0,s=0,q=a.length;s<q;s++)(c=a.charCodeAt(s))<128?o+=1:c<2048?o+=2:c<55296||c>=57344?o+=3:(s++,o+=4);return o}(o),T<32)a.push(160|T),C=1;else if(T<256)a.push(217,T),C=2;else if(T<65536)a.push(218,T>>8,T),C=3;else{if(!(T<4294967296))throw new Error("String too long");a.push(219,T>>24,T>>16,T>>8,T),C=5}return c.push({_str:o,_length:T,_offset:a.length}),C+T}if("number"===s)return Math.floor(o)===o&&isFinite(o)?o>=0?o<128?(a.push(o),1):o<256?(a.push(204,o),2):o<65536?(a.push(205,o>>8,o),3):o<4294967296?(a.push(206,o>>24,o>>16,o>>8,o),5):(p=o/Math.pow(2,32)|0,G=o>>>0,a.push(207,p>>24,p>>16,p>>8,p,G>>24,G>>16,G>>8,G),9):o>=-32?(a.push(o),1):o>=-128?(a.push(208,o),2):o>=-32768?(a.push(209,o>>8,o),3):o>=-2147483648?(a.push(210,o>>24,o>>16,o>>8,o),5):(p=Math.floor(o/Math.pow(2,32)),G=o>>>0,a.push(211,p>>24,p>>16,p>>8,p,G>>24,G>>16,G>>8,G),9):(a.push(203),c.push({_float:o,_length:8,_offset:a.length}),9);if("object"===s){if(null===o)return a.push(192),1;if(Array.isArray(o)){if((T=o.length)<16)a.push(144|T),C=1;else if(T<65536)a.push(220,T>>8,T),C=3;else{if(!(T<4294967296))throw new Error("Array too large");a.push(221,T>>24,T>>16,T>>8,T),C=5}for(t=0;t<T;t++)C+=q(a,c,o[t]);return C}if(o instanceof Date){var j=o.getTime(),L=Math.floor(j/1e3),e=1e6*(j-1e3*L);return L>=0&&e>=0&&L<=17179869183?0===e&&L<=4294967295?(a.push(214,255,L>>24,L>>16,L>>8,L),6):(p=L/4294967296,G=4294967295&L,a.push(215,255,e>>22,e>>14,e>>6,p,G>>24,G>>16,G>>8,G),10):(p=Math.floor(L/4294967296),G=L>>>0,a.push(199,12,255,e>>24,e>>16,e>>8,e,p>>24,p>>16,p>>8,p,G>>24,G>>16,G>>8,G),15)}if(o instanceof ArrayBuffer){if((T=o.byteLength)<256)a.push(196,T),C=2;else if(T<65536)a.push(197,T>>8,T),C=3;else{if(!(T<4294967296))throw new Error("Buffer too large");a.push(198,T>>24,T>>16,T>>8,T),C=5}return c.push({_bin:o,_length:T,_offset:a.length}),C+T}if("function"===typeof o.toJSON)return q(a,c,o.toJSON());var g=[],M="",N=Object.keys(o);for(t=0,i=N.length;t<i;t++)void 0!==o[M=N[t]]&&"function"!==typeof o[M]&&g.push(M);if((T=g.length)<16)a.push(128|T),C=1;else if(T<65536)a.push(222,T>>8,T),C=3;else{if(!(T<4294967296))throw new Error("Object too large");a.push(223,T>>24,T>>16,T>>8,T),C=5}for(t=0;t<T;t++)C+=q(a,c,M=g[t]),C+=q(a,c,o[M]);return C}if("boolean"===s)return a.push(o?195:194),1;if("undefined"===s)return a.push(192),1;if("function"===typeof o.toJSON)return q(a,c,o.toJSON());throw new Error("Could not encode")}c.encode=function(a){var c=[],o=[],t=q(c,o,a),i=new ArrayBuffer(t),p=new DataView(i),G=0,T=0,C=-1;o.length>0&&(C=o[0]._offset);for(var j,L=0,e=0,g=0,M=c.length;g<M;g++)if(p.setUint8(T+g,c[g]),g+1===C){if(L=(j=o[G])._length,e=T+C,j._bin)for(var N=new Uint8Array(j._bin),y=0;y<L;y++)p.setUint8(e+y,N[y]);else j._str?s(p,e,j._str):void 0!==j._float&&p.setFloat64(e,j._float);T+=L,o[++G]&&(C=o[G]._offset)}return i}},13510:(a,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.NoneSerializer=void 0;c.NoneSerializer=class{setState(a){}getState(){return null}patch(a){}teardown(){}handshake(a){}}},13504:(a,c,o)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.SchemaSerializer=void 0;const s=o(13474);c.SchemaSerializer=class{setState(a){return this.state.decode(a)}getState(){return this.state}patch(a){return this.state.decode(a)}teardown(){var a,c;null===(c=null===(a=this.state)||void 0===a?void 0:a.$changes)||void 0===c||c.root.clearRefs()}handshake(a,c){if(this.state){(new s.Reflection).decode(a,c)}else this.state=s.Reflection.decode(a,c)}}},13456:(a,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSerializer=c.registerSerializer=void 0;const o={};c.registerSerializer=function(a,c){o[a]=c},c.getSerializer=function(a){const c=o[a];if(!c)throw new Error("missing serializer: "+a);return c}},13437:function(a,c,o){"use strict";var s=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0}),c.WebSocketTransport=void 0;const q=s(o(13444)),t=globalThis.WebSocket||q.default;c.WebSocketTransport=class{constructor(a){this.events=a}send(a){a instanceof ArrayBuffer?this.ws.send(a):Array.isArray(a)&&this.ws.send(new Uint8Array(a).buffer)}connect(a,c){try{this.ws=new t(a,{headers:c,protocols:this.protocols})}catch(o){this.ws=new t(a,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(a,c){this.ws.close(a,c)}get isOpen(){return this.ws.readyState===t.OPEN}}},13444:a=>{"use strict";a.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14779:a=>{"use strict";a.exports=function(a){for(var c=new Array(a),o=0;o<a;++o)c[o]=o;return c}},14783:a=>{function c(a){return!!a.constructor&&"function"===typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}a.exports=function(a){return null!=a&&(c(a)||function(a){return"function"===typeof a.readFloatLE&&"function"===typeof a.slice&&c(a.slice(0,0))}(a)||!!a._isBuffer)}},14770:(a,c,o)=>{var s=o(14779),q=o(14783),t="undefined"!==typeof Float64Array;function i(a,c){return a[0]-c[0]}function p(){var a,c=this.stride,o=new Array(c.length);for(a=0;a<o.length;++a)o[a]=[Math.abs(c[a]),a];o.sort(i);var s=new Array(o.length);for(a=0;a<s.length;++a)s[a]=o[a][1];return s}function G(a,c){var o=["View",c,"d",a].join("");c<0&&(o="View_Nil"+a);var q="generic"===a;if(-1===c){var t="function "+o+"(a){this.data=a;};var proto="+o+".prototype;proto.dtype='"+a+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+o+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+o+"(a){return new "+o+"(a);}";return new Function(t)()}if(0===c){t="function "+o+"(a,d) {this.data = a;this.offset = d};var proto="+o+".prototype;proto.dtype='"+a+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+o+"_copy() {return new "+o+"(this.data,this.offset)};proto.pick=function "+o+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+o+"_get(){return "+(q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+o+"_set(v){return "+(q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+o+"(a,b,c,d){return new "+o+"(a,d)}";return new Function("TrivialArray",t)(T[a][0])}t=["'use strict'"];var i=s(c),G=i.map((function(a){return"i"+a})),C="this.offset+"+i.map((function(a){return"this.stride["+a+"]*i"+a})).join("+"),j=i.map((function(a){return"b"+a})).join(","),L=i.map((function(a){return"c"+a})).join(",");t.push("function "+o+"(a,"+j+","+L+",d){this.data=a","this.shape=["+j+"]","this.stride=["+L+"]","this.offset=d|0}","var proto="+o+".prototype","proto.dtype='"+a+"'","proto.dimension="+c),t.push("Object.defineProperty(proto,'size',{get:function "+o+"_size(){return "+i.map((function(a){return"this.shape["+a+"]"})).join("*"),"}})"),1===c?t.push("proto.order=[0]"):(t.push("Object.defineProperty(proto,'order',{get:"),c<4?(t.push("function "+o+"_order(){"),2===c?t.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&t.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):t.push("ORDER})")),t.push("proto.set=function "+o+"_set("+G.join(",")+",v){"),q?t.push("return this.data.set("+C+",v)}"):t.push("return this.data["+C+"]=v}"),t.push("proto.get=function "+o+"_get("+G.join(",")+"){"),q?t.push("return this.data.get("+C+")}"):t.push("return this.data["+C+"]}"),t.push("proto.index=function "+o+"_index(",G.join(),"){return "+C+"}"),t.push("proto.hi=function "+o+"_hi("+G.join(",")+"){return new "+o+"(this.data,"+i.map((function(a){return["(typeof i",a,"!=='number'||i",a,"<0)?this.shape[",a,"]:i",a,"|0"].join("")})).join(",")+","+i.map((function(a){return"this.stride["+a+"]"})).join(",")+",this.offset)}");var e=i.map((function(a){return"a"+a+"=this.shape["+a+"]"})),g=i.map((function(a){return"c"+a+"=this.stride["+a+"]"}));t.push("proto.lo=function "+o+"_lo("+G.join(",")+"){var b=this.offset,d=0,"+e.join(",")+","+g.join(","));for(var M=0;M<c;++M)t.push("if(typeof i"+M+"==='number'&&i"+M+">=0){d=i"+M+"|0;b+=c"+M+"*d;a"+M+"-=d}");t.push("return new "+o+"(this.data,"+i.map((function(a){return"a"+a})).join(",")+","+i.map((function(a){return"c"+a})).join(",")+",b)}"),t.push("proto.step=function "+o+"_step("+G.join(",")+"){var "+i.map((function(a){return"a"+a+"=this.shape["+a+"]"})).join(",")+","+i.map((function(a){return"b"+a+"=this.stride["+a+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(M=0;M<c;++M)t.push("if(typeof i"+M+"==='number'){d=i"+M+"|0;if(d<0){c+=b"+M+"*(a"+M+"-1);a"+M+"=ceil(-a"+M+"/d)}else{a"+M+"=ceil(a"+M+"/d)}b"+M+"*=d}");t.push("return new "+o+"(this.data,"+i.map((function(a){return"a"+a})).join(",")+","+i.map((function(a){return"b"+a})).join(",")+",c)}");var N=new Array(c),y=new Array(c);for(M=0;M<c;++M)N[M]="a[i"+M+"]",y[M]="b[i"+M+"]";t.push("proto.transpose=function "+o+"_transpose("+G+"){"+G.map((function(a,c){return a+"=("+a+"===undefined?"+c+":"+a+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+o+"(this.data,"+N.join(",")+","+y.join(",")+",this.offset)}"),t.push("proto.pick=function "+o+"_pick("+G+"){var a=[],b=[],c=this.offset");for(M=0;M<c;++M)t.push("if(typeof i"+M+"==='number'&&i"+M+">=0){c=(c+this.stride["+M+"]*i"+M+")|0}else{a.push(this.shape["+M+"]);b.push(this.stride["+M+"])}");return t.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),t.push("return function construct_"+o+"(data,shape,stride,offset){return new "+o+"(data,"+i.map((function(a){return"shape["+a+"]"})).join(",")+","+i.map((function(a){return"stride["+a+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",t.join("\n"))(T[a],p)}var T={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};a.exports=function(a,c,o,s){if(void 0===a)return(0,T.array[0])([]);"number"===typeof a&&(a=[a]),void 0===c&&(c=[a.length]);var i=c.length;if(void 0===o){o=new Array(i);for(var p=i-1,C=1;p>=0;--p)o[p]=C,C*=c[p]}if(void 0===s){s=0;for(p=0;p<i;++p)o[p]<0&&(s-=(c[p]-1)*o[p])}for(var j=function(a){if(q(a))return"buffer";if(t)switch(Object.prototype.toString.call(a)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(a)?"array":"generic"}(a),L=T[j];L.length<=i+1;)L.push(G(j,L.length-1));return(0,L[i+1])(a,c,o,s)}},14731:a=>{var c;self,c=()=>(()=>{"use strict";var a={d:(c,o)=>{for(var s in o)a.o(o,s)&&!a.o(c,s)&&Object.defineProperty(c,s,{enumerable:!0,get:o[s]})},o:(a,c)=>Object.prototype.hasOwnProperty.call(a,c)},c={};a.d(c,{default:()=>W});var o,s=function(a,c){var o=c.x-a.x,s=c.y-a.y;return Math.sqrt(o*o+s*s)},q=function(a){return a*(Math.PI/180)},t=new Map,i=function(a){t.has(a)&&clearTimeout(t.get(a)),t.set(a,setTimeout(a,100))},p=function(a,c,o){for(var s,q=c.split(/[ ,]+/g),t=0;t<q.length;t+=1)s=q[t],a.addEventListener?a.addEventListener(s,o,!1):a.attachEvent&&a.attachEvent(s,o)},G=function(a,c,o){for(var s,q=c.split(/[ ,]+/g),t=0;t<q.length;t+=1)s=q[t],a.removeEventListener?a.removeEventListener(s,o):a.detachEvent&&a.detachEvent(s,o)},T=function(a){return a.preventDefault(),a.type.match(/^touch/)?a.changedTouches:a},C=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},j=function(a,c){c.top||c.right||c.bottom||c.left?(a.style.top=c.top,a.style.right=c.right,a.style.bottom=c.bottom,a.style.left=c.left):(a.style.left=c.x+"px",a.style.top=c.y+"px")},L=function(a,c,o){var s=e(a);for(var q in s)if(s.hasOwnProperty(q))if("string"==typeof c)s[q]=c+" "+o;else{for(var t="",i=0,p=c.length;i<p;i+=1)t+=c[i]+" "+o+", ";s[q]=t.slice(0,-2)}return s},e=function(a){var c={};return c[a]="",["webkit","Moz","o"].forEach((function(o){c[o+a.charAt(0).toUpperCase()+a.slice(1)]=""})),c},g=function(a,c){for(var o in c)c.hasOwnProperty(o)&&(a[o]=c[o]);return a},M=function(a,c){if(a.length)for(var o=0,s=a.length;o<s;o+=1)c(a[o]);else c(a)},N="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,y=window.matchMedia("(any-hover: none)").matches,k=!!("ontouchstart"in window),n=!!window.PointerEvent,f=!!window.MSPointerEvent,J={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},w={start:"mousedown",move:"mousemove",end:"mouseup"},Z={};function h(){}N&&!y?o=J:n?o={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:f?o={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:k?(o=J,Z=w):o=w,h.prototype.on=function(a,c){var o,s=this,q=a.split(/[ ,]+/g);s._handlers_=s._handlers_||{};for(var t=0;t<q.length;t+=1)o=q[t],s._handlers_[o]=s._handlers_[o]||[],s._handlers_[o].push(c);return s},h.prototype.off=function(a,c){var o=this;return o._handlers_=o._handlers_||{},void 0===a?o._handlers_={}:void 0===c?o._handlers_[a]=null:o._handlers_[a]&&o._handlers_[a].indexOf(c)>=0&&o._handlers_[a].splice(o._handlers_[a].indexOf(c),1),o},h.prototype.trigger=function(a,c){var o,s=this,q=a.split(/[ ,]+/g);s._handlers_=s._handlers_||{};for(var t=0;t<q.length;t+=1)o=q[t],s._handlers_[o]&&s._handlers_[o].length&&s._handlers_[o].forEach((function(a){a.call(s,{type:o,target:s},c)}))},h.prototype.config=function(a){var c=this;c.options=c.defaults||{},a&&(c.options=function(a,c){var o={};for(var s in a)a.hasOwnProperty(s)&&c.hasOwnProperty(s)?o[s]=c[s]:a.hasOwnProperty(s)&&(o[s]=a[s]);return o}(c.options,a))},h.prototype.bindEvt=function(a,c){var s=this;return s._domHandlers_=s._domHandlers_||{},s._domHandlers_[c]=function(){"function"==typeof s["on"+c]?s["on"+c].apply(s,arguments):console.warn('[WARNING] : Missing "on'+c+'" handler.')},p(a,o[c],s._domHandlers_[c]),Z[c]&&p(a,Z[c],s._domHandlers_[c]),s},h.prototype.unbindEvt=function(a,c){var s=this;return s._domHandlers_=s._domHandlers_||{},G(a,o[c],s._domHandlers_[c]),Z[c]&&G(a,Z[c],s._domHandlers_[c]),delete s._domHandlers_[c],this};const U=h;function S(a,c){return this.identifier=c.identifier,this.position=c.position,this.frontPosition=c.frontPosition,this.collection=a,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(c),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=S.id,S.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}S.prototype=new U,S.constructor=S,S.id=0,S.prototype.buildEl=function(a){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},S.prototype.stylize=function(){if(this.options.dataOnly)return this;var a=this.options.fadeTime+"ms",c=function(){var a=e("borderRadius");for(var c in a)a.hasOwnProperty(c)&&(a[c]="50%");return a}(),o=L("transition","opacity",a),s={};return s.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},s.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},s.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},g(s.el,o),"circle"===this.options.shape&&g(s.back,c),g(s.front,c),this.applyStyles(s),this},S.prototype.applyStyles=function(a){for(var c in this.ui)if(this.ui.hasOwnProperty(c))for(var o in a[c])this.ui[c].style[o]=a[c][o];return this},S.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},S.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},S.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},S.prototype.show=function(a){var c=this;return c.options.dataOnly||(clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.addToDom(),c.restCallback(),setTimeout((function(){c.ui.el.style.opacity=1}),0),c.showTimeout=setTimeout((function(){c.trigger("shown",c.instance),"function"==typeof a&&a.call(this)}),c.options.fadeTime)),c},S.prototype.hide=function(a){var c=this;if(c.options.dataOnly)return c;if(c.ui.el.style.opacity=c.options.restOpacity,clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.removeTimeout=setTimeout((function(){var o="dynamic"===c.options.mode?"none":"block";c.ui.el.style.display=o,"function"==typeof a&&a.call(c),c.trigger("hidden",c.instance)}),c.options.fadeTime),c.options.restJoystick){var o=c.options.restJoystick,s={};s.x=!0===o||!1!==o.x?0:c.instance.frontPosition.x,s.y=!0===o||!1!==o.y?0:c.instance.frontPosition.y,c.setPosition(a,s)}return c},S.prototype.setPosition=function(a,c){var o=this;o.frontPosition={x:c.x,y:c.y};var s=o.options.fadeTime+"ms",q={};q.front=L("transition",["transform"],s);var t={front:{}};t.front={transform:"translate("+o.frontPosition.x+"px,"+o.frontPosition.y+"px)"},o.applyStyles(q),o.applyStyles(t),o.restTimeout=setTimeout((function(){"function"==typeof a&&a.call(o),o.restCallback()}),o.options.fadeTime)},S.prototype.restCallback=function(){var a=this,c={};c.front=L("transition","none",""),a.applyStyles(c),a.trigger("rested",a.instance)},S.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},S.prototype.computeDirection=function(a){var c,o,s,q=a.angle.radian,t=Math.PI/4,i=Math.PI/2;if(q>t&&q<3*t&&!a.lockX?c="up":q>-t&&q<=t&&!a.lockY?c="left":q>3*-t&&q<=-t&&!a.lockX?c="down":a.lockY||(c="right"),a.lockY||(o=q>-i&&q<i?"left":"right"),a.lockX||(s=q>0?"up":"down"),a.force>this.options.threshold){var p,G={};for(p in this.direction)this.direction.hasOwnProperty(p)&&(G[p]=this.direction[p]);var T={};for(p in this.direction={x:o,y:s,angle:c},a.direction=this.direction,G)G[p]===this.direction[p]&&(T[p]=!0);if(T.x&&T.y&&T.angle)return a;T.x&&T.y||this.trigger("plain",a),T.x||this.trigger("plain:"+o,a),T.y||this.trigger("plain:"+s,a),T.angle||this.trigger("dir dir:"+c,a)}else this.resetDirection();return a};const r=S;function x(a,c){var o=this;o.nipples=[],o.idles=[],o.actives=[],o.ids=[],o.pressureIntervals={},o.manager=a,o.id=x.id,x.id+=1,o.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},o.config(c),"static"!==o.options.mode&&"semi"!==o.options.mode||(o.options.multitouch=!1),o.options.multitouch||(o.options.maxNumberOfNipples=1);var s=getComputedStyle(o.options.zone.parentElement);return s&&"flex"===s.display&&(o.parentIsFlex=!0),o.updateBox(),o.prepareNipples(),o.bL(),o.begin(),o.nipples}x.prototype=new U,x.constructor=x,x.id=0,x.prototype.prepareNipples=function(){var a=this,c=a.nipples;c.on=a.on.bind(a),c.off=a.off.bind(a),c.options=a.options,c.destroy=a.destroy.bind(a),c.ids=a.ids,c.id=a.id,c.processOnMove=a.processOnMove.bind(a),c.processOnEnd=a.processOnEnd.bind(a),c.get=function(a){if(void 0===a)return c[0];for(var o=0,s=c.length;o<s;o+=1)if(c[o].identifier===a)return c[o];return!1}},x.prototype.bL=function(){var a=this;a.bindEvt(a.options.zone,"start"),a.options.zone.style.touchAction="none",a.options.zone.style.msTouchAction="none"},x.prototype.begin=function(){var a=this,c=a.options;if("static"===c.mode){var o=a.createNipple(c.position,a.manager.getIdentifier());o.add(),a.idles.push(o)}},x.prototype.createNipple=function(a,c){var o=this,s=o.manager.scroll,q={},t=o.options,i=o.parentIsFlex?s.x:s.x+o.box.left,p=o.parentIsFlex?s.y:s.y+o.box.top;if(a.x&&a.y)q={x:a.x-i,y:a.y-p};else if(a.top||a.right||a.bottom||a.left){var G=document.createElement("DIV");G.style.display="hidden",G.style.top=a.top,G.style.right=a.right,G.style.bottom=a.bottom,G.style.left=a.left,G.style.position="absolute",t.zone.appendChild(G);var T=G.getBoundingClientRect();t.zone.removeChild(G),q=a,a={x:T.left+s.x,y:T.top+s.y}}var C=new r(o,{color:t.color,size:t.size,threshold:t.threshold,fadeTime:t.fadeTime,dataOnly:t.dataOnly,restJoystick:t.restJoystick,restOpacity:t.restOpacity,mode:t.mode,identifier:c,position:a,zone:t.zone,frontPosition:{x:0,y:0},shape:t.shape});return t.dataOnly||(j(C.ui.el,q),j(C.ui.front,C.frontPosition)),o.nipples.push(C),o.trigger("added "+C.identifier+":added",C),o.manager.trigger("added "+C.identifier+":added",C),o.bindNipple(C),C},x.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},x.prototype.bindNipple=function(a){var c,o=this,s=function(a,s){c=a.type+" "+s.id+":"+a.type,o.trigger(c,s)};a.on("destroyed",o.onDestroyed.bind(o)),a.on("shown hidden rested dir plain",s),a.on("dir:up dir:right dir:down dir:left",s),a.on("plain:up plain:right plain:down plain:left",s)},x.prototype.pressureFn=function(a,c,o){var s=this,q=0;clearInterval(s.pressureIntervals[o]),s.pressureIntervals[o]=setInterval(function(){var o=a.force||a.pressure||a.webkitForce||0;o!==q&&(c.trigger("pressure",o),s.trigger("pressure "+c.identifier+":pressure",o),q=o)}.bind(s),100)},x.prototype.onstart=function(a){var c=this,o=c.options,s=a;return a=T(a),c.updateBox(),M(a,(function(q){c.actives.length<o.maxNumberOfNipples?c.processOnStart(q):s.type.match(/^touch/)&&(Object.keys(c.manager.ids).forEach((function(o){if(Object.values(s.touches).findIndex((function(a){return a.identifier===o}))<0){var q=[a[0]];q.identifier=o,c.processOnEnd(q)}})),c.actives.length<o.maxNumberOfNipples&&c.processOnStart(q))})),c.manager.bindDocument(),!1},x.prototype.processOnStart=function(a){var c,o=this,q=o.options,t=o.manager.getIdentifier(a),i=a.force||a.pressure||a.webkitForce||0,p={x:a.pageX,y:a.pageY},G=o.getOrCreate(t,p);G.identifier!==t&&o.manager.removeIdentifier(G.identifier),G.identifier=t;var T=function(c){c.trigger("start",c),o.trigger("start "+c.id+":start",c),c.show(),i>0&&o.pressureFn(a,c,c.identifier),o.processOnMove(a)};if((c=o.idles.indexOf(G))>=0&&o.idles.splice(c,1),o.actives.push(G),o.ids.push(G.identifier),"semi"!==q.mode)T(G);else{if(!(s(p,G.position)<=q.catchDistance))return G.destroy(),void o.processOnStart(a);T(G)}return G},x.prototype.getOrCreate=function(a,c){var o,s=this,q=s.options;return/(semi|static)/.test(q.mode)?(o=s.idles[0])?(s.idles.splice(0,1),o):"semi"===q.mode?s.createNipple(c,a):(console.warn("Coudln't find the needed nipple."),!1):o=s.createNipple(c,a)},x.prototype.processOnMove=function(a){var c=this,o=c.options,t=c.manager.getIdentifier(a),i=c.nipples.get(t),p=c.manager.scroll;if(function(a){return isNaN(a.buttons)?0!==a.pressure:0!==a.buttons}(a)){if(!i)return console.error("Found zombie joystick with ID "+t),void c.manager.removeIdentifier(t);if(o.dynamicPage){var G=i.el.getBoundingClientRect();i.position={x:p.x+G.left,y:p.y+G.top}}i.identifier=t;var T=i.options.size/2,C={x:a.pageX,y:a.pageY};o.lockX&&(C.y=i.position.y),o.lockY&&(C.x=i.position.x);var j,L,e,g,M,N,y,k,n,f,J=s(C,i.position),w=(j=C,e=(L=i.position).x-j.x,g=L.y-j.y,function(a){return a*(180/Math.PI)}(Math.atan2(g,e))),Z=q(w),h=J/T,U={distance:J,position:C};if("circle"===i.options.shape?(M=Math.min(J,T),y=i.position,k=M,f={x:0,y:0},n=q(n=w),f.x=y.x-k*Math.cos(n),f.y=y.y-k*Math.sin(n),N=f):(N=function(a,c,o){return{x:Math.min(Math.max(a.x,c.x-o),c.x+o),y:Math.min(Math.max(a.y,c.y-o),c.y+o)}}(C,i.position,T),M=s(N,i.position)),o.follow){if(J>T){var S=C.x-N.x,r=C.y-N.y;i.position.x+=S,i.position.y+=r,i.el.style.top=i.position.y-(c.box.top+p.y)+"px",i.el.style.left=i.position.x-(c.box.left+p.x)+"px",J=s(C,i.position)}}else C=N,J=M;var x=C.x-i.position.x,R=C.y-i.position.y;i.frontPosition={x:x,y:R},o.dataOnly||(i.ui.front.style.transform="translate("+x+"px,"+R+"px)");var d={identifier:i.identifier,position:C,force:h,pressure:a.force||a.pressure||a.webkitForce||0,distance:J,angle:{radian:Z,degree:w},vector:{x:x/T,y:-R/T},raw:U,instance:i,lockX:o.lockX,lockY:o.lockY};(d=i.computeDirection(d)).angle={radian:q(180-w),degree:180-w},i.trigger("move",d),c.trigger("move "+i.id+":move",d)}else this.processOnEnd(a)},x.prototype.processOnEnd=function(a){var c=this,o=c.options,s=c.manager.getIdentifier(a),q=c.nipples.get(s),t=c.manager.removeIdentifier(q.identifier);q&&(o.dataOnly||q.hide((function(){"dynamic"===o.mode&&(q.trigger("removed",q),c.trigger("removed "+q.id+":removed",q),c.manager.trigger("removed "+q.id+":removed",q),q.destroy())})),clearInterval(c.pressureIntervals[q.identifier]),q.resetDirection(),q.trigger("end",q),c.trigger("end "+q.id+":end",q),c.ids.indexOf(q.identifier)>=0&&c.ids.splice(c.ids.indexOf(q.identifier),1),c.actives.indexOf(q)>=0&&c.actives.splice(c.actives.indexOf(q),1),/(semi|static)/.test(o.mode)?c.idles.push(q):c.nipples.indexOf(q)>=0&&c.nipples.splice(c.nipples.indexOf(q),1),c.manager.unbindDocument(),/(semi|static)/.test(o.mode)&&(c.manager.ids[t.id]=t.identifier))},x.prototype.onDestroyed=function(a,c){var o=this;o.nipples.indexOf(c)>=0&&o.nipples.splice(o.nipples.indexOf(c),1),o.actives.indexOf(c)>=0&&o.actives.splice(o.actives.indexOf(c),1),o.idles.indexOf(c)>=0&&o.idles.splice(o.idles.indexOf(c),1),o.ids.indexOf(c.identifier)>=0&&o.ids.splice(o.ids.indexOf(c.identifier),1),o.manager.removeIdentifier(c.identifier),o.manager.unbindDocument()},x.prototype.destroy=function(){var a=this;for(var c in a.unbindEvt(a.options.zone,"start"),a.nipples.forEach((function(a){a.destroy()})),a.pressureIntervals)a.pressureIntervals.hasOwnProperty(c)&&clearInterval(a.pressureIntervals[c]);a.trigger("destroyed",a.nipples),a.manager.unbindDocument(),a.off()};const R=x;function d(a){var c=this;c.ids={},c.index=0,c.collections=[],c.scroll=C(),c.config(a),c.prepareCollections();var o=function(){var a;c.collections.forEach((function(o){o.forEach((function(o){a=o.el.getBoundingClientRect(),o.position={x:c.scroll.x+a.left,y:c.scroll.y+a.top}}))}))};p(window,"resize",(function(){i(o)}));var s=function(){c.scroll=C()};return p(window,"scroll",(function(){i(s)})),c.collections}d.prototype=new U,d.constructor=d,d.prototype.prepareCollections=function(){var a=this;a.collections.create=a.create.bind(a),a.collections.on=a.on.bind(a),a.collections.off=a.off.bind(a),a.collections.destroy=a.destroy.bind(a),a.collections.get=function(c){var o;return a.collections.every((function(a){return!(o=a.get(c))})),o}},d.prototype.create=function(a){return this.createCollection(a)},d.prototype.createCollection=function(a){var c=this,o=new R(c,a);return c.bindCollection(o),c.collections.push(o),o},d.prototype.bindCollection=function(a){var c,o=this,s=function(a,s){c=a.type+" "+s.id+":"+a.type,o.trigger(c,s)};a.on("destroyed",o.onDestroyed.bind(o)),a.on("shown hidden rested dir plain",s),a.on("dir:up dir:right dir:down dir:left",s),a.on("plain:up plain:right plain:down plain:left",s)},d.prototype.bindDocument=function(){var a=this;a.binded||(a.bindEvt(document,"move").bindEvt(document,"end"),a.binded=!0)},d.prototype.unbindDocument=function(a){var c=this;Object.keys(c.ids).length&&!0!==a||(c.unbindEvt(document,"move").unbindEvt(document,"end"),c.binded=!1)},d.prototype.getIdentifier=function(a){var c;return a?void 0===(c=void 0===a.identifier?a.pointerId:a.identifier)&&(c=this.latest||0):c=this.index,void 0===this.ids[c]&&(this.ids[c]=this.index,this.index+=1),this.latest=c,this.ids[c]},d.prototype.removeIdentifier=function(a){var c={};for(var o in this.ids)if(this.ids[o]===a){c.id=o,c.identifier=this.ids[o],delete this.ids[o];break}return c},d.prototype.onmove=function(a){return this.onAny("move",a),!1},d.prototype.onend=function(a){return this.onAny("end",a),!1},d.prototype.oncancel=function(a){return this.onAny("end",a),!1},d.prototype.onAny=function(a,c){var o,s=this,q="processOn"+a.charAt(0).toUpperCase()+a.slice(1);c=T(c);var t=function(a,c,o){o.ids.indexOf(c)>=0&&(o[q](a),a._found_=!0)};return M(c,(function(a){o=s.getIdentifier(a),M(s.collections,t.bind(null,a,o)),a._found_||s.removeIdentifier(o)})),!1},d.prototype.destroy=function(){var a=this;a.unbindDocument(!0),a.ids={},a.index=0,a.collections.forEach((function(a){a.destroy()})),a.off()},d.prototype.onDestroyed=function(a,c){var o=this;if(o.collections.indexOf(c)<0)return!1;o.collections.splice(o.collections.indexOf(c),1)};var X=new d;const W={create:function(a){return X.create(a)},factory:X};return c.default})(),a.exports=c()},14797:(a,c,o)=>{"use strict";const{Deflate:s,deflate:q,deflateRaw:t,gzip:i}=o(14806),{Inflate:p,inflate:G,inflateRaw:T,ungzip:C}=o(14873),j=o(14852);a.exports.Deflate=s,a.exports.deflate=q,a.exports.deflateRaw=t,a.exports.gzip=i,a.exports.Inflate=p,a.exports.inflate=G,a.exports.inflateRaw=T,a.exports.ungzip=C,a.exports.constants=j},14806:(a,c,o)=>{"use strict";const s=o(14813),q=o(14858),t=o(14864),i=o(14843),p=o(14871),G=Object.prototype.toString,{Z_NO_FLUSH:T,Z_SYNC_FLUSH:C,Z_FULL_FLUSH:j,Z_FINISH:L,Z_OK:e,Z_STREAM_END:g,Z_DEFAULT_COMPRESSION:M,Z_DEFAULT_STRATEGY:N,Z_DEFLATED:y}=o(14852);function k(a){this.options=q.assign({level:M,method:y,Ka:16384,windowBits:15,memLevel:8,strategy:N},a||{});let c=this.options;c.raw&&c.windowBits>0?c.windowBits=-c.windowBits:c.gzip&&c.windowBits>0&&c.windowBits<16&&(c.windowBits+=16),this.err=0,this.Oc="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;let o=s.deflateInit2(this.strm,c.level,c.method,c.windowBits,c.memLevel,c.strategy);if(o!==e)throw new Error(i[o]);if(c.header&&s.deflateSetHeader(this.strm,c.header),c.dictionary){let a;if(a="string"===typeof c.dictionary?t.string2buf(c.dictionary):"[object ArrayBuffer]"===G.call(c.dictionary)?new Uint8Array(c.dictionary):c.dictionary,o=s.deflateSetDictionary(this.strm,a),o!==e)throw new Error(i[o]);this._dict_set=!0}}function n(a,c){const o=new k(c);if(o.push(a,!0),o.err)throw o.Oc||i[o.err];return o.result}k.prototype.push=function(a,c){const o=this.strm,q=this.options.Ka;let i,p;if(this.ended)return!1;for(p=c===~~c?c:!0===c?L:T,"string"===typeof a?o.input=t.string2buf(a):"[object ArrayBuffer]"===G.call(a)?o.input=new Uint8Array(a):o.input=a,o.next_in=0,o.avail_in=o.input.length;;)if(0===o.avail_out&&(o.output=new Uint8Array(q),o.next_out=0,o.avail_out=q),(p===C||p===j)&&o.avail_out<=6)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else{if(i=s.deflate(o,p),i===g)return o.next_out>0&&this.onData(o.output.subarray(0,o.next_out)),i=s.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===e;if(0!==o.avail_out){if(p>0&&o.next_out>0)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else if(0===o.avail_in)break}else this.onData(o.output)}return!0},k.prototype.onData=function(a){this.chunks.push(a)},k.prototype.onEnd=function(a){a===e&&(this.result=q.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.Oc=this.strm.Oc},a.exports.Deflate=k,a.exports.deflate=n,a.exports.deflateRaw=function(a,c){return(c=c||{}).raw=!0,n(a,c)},a.exports.gzip=function(a,c){return(c=c||{}).gzip=!0,n(a,c)},a.exports.constants=o(14852)},14873:(a,c,o)=>{"use strict";const s=o(14875),q=o(14858),t=o(14864),i=o(14843),p=o(14871),G=o(14890),T=Object.prototype.toString,{Z_NO_FLUSH:C,Z_FINISH:j,Z_OK:L,Z_STREAM_END:e,Z_NEED_DICT:g,Z_STREAM_ERROR:M,Z_DATA_ERROR:N,Z_MEM_ERROR:y}=o(14852);function k(a){this.options=q.assign({Ka:65536,windowBits:15,to:""},a||{});const c=this.options;c.raw&&c.windowBits>=0&&c.windowBits<16&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15)),!(c.windowBits>=0&&c.windowBits<16)||a&&a.windowBits||(c.windowBits+=32),c.windowBits>15&&c.windowBits<48&&0===(15&c.windowBits)&&(c.windowBits|=15),this.err=0,this.Oc="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;let o=s.inflateInit2(this.strm,c.windowBits);if(o!==L)throw new Error(i[o]);if(this.header=new G,s.inflateGetHeader(this.strm,this.header),c.dictionary&&("string"===typeof c.dictionary?c.dictionary=t.string2buf(c.dictionary):"[object ArrayBuffer]"===T.call(c.dictionary)&&(c.dictionary=new Uint8Array(c.dictionary)),c.raw&&(o=s.inflateSetDictionary(this.strm,c.dictionary),o!==L)))throw new Error(i[o])}function n(a,c){const o=new k(c);if(o.push(a),o.err)throw o.Oc||i[o.err];return o.result}k.prototype.push=function(a,c){const o=this.strm,q=this.options.Ka,i=this.options.dictionary;let p,G,k;if(this.ended)return!1;for(G=c===~~c?c:!0===c?j:C,"[object ArrayBuffer]"===T.call(a)?o.input=new Uint8Array(a):o.input=a,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(q),o.next_out=0,o.avail_out=q),p=s.inflate(o,G),p===g&&i&&(p=s.inflateSetDictionary(o,i),p===L?p=s.inflate(o,G):p===N&&(p=g));o.avail_in>0&&p===e&&o.state.wrap>0&&0!==a[o.next_in];)s.inflateReset(o),p=s.inflate(o,G);switch(p){case M:case N:case g:case y:return this.onEnd(p),this.ended=!0,!1}if(k=o.avail_out,o.next_out&&(0===o.avail_out||p===e))if("string"===this.options.to){let a=t.utf8border(o.output,o.next_out),c=o.next_out-a,s=t.buf2string(o.output,a);o.next_out=c,o.avail_out=q-c,c&&o.output.set(o.output.subarray(a,a+c),0),this.onData(s)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(p!==L||0!==k){if(p===e)return p=s.inflateEnd(this.strm),this.onEnd(p),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},k.prototype.onData=function(a){this.chunks.push(a)},k.prototype.onEnd=function(a){a===L&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=q.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.Oc=this.strm.Oc},a.exports.Inflate=k,a.exports.inflate=n,a.exports.inflateRaw=function(a,c){return(c=c||{}).raw=!0,n(a,c)},a.exports.ungzip=n,a.exports.constants=o(14852)},14858:a=>{"use strict";const c=(a,c)=>Object.prototype.hasOwnProperty.call(a,c);a.exports.assign=function(a){const o=Array.prototype.slice.call(arguments,1);for(;o.length;){const s=o.shift();if(s){if("object"!==typeof s)throw new TypeError(s+"must be non-object");for(const o in s)c(s,o)&&(a[o]=s[o])}}return a},a.exports.flattenChunks=a=>{let c=0;for(let s=0,q=a.length;s<q;s++)c+=a[s].length;const o=new Uint8Array(c);for(let s=0,q=0,t=a.length;s<t;s++){let c=a[s];o.set(c,q),q+=c.length}return o}},14864:a=>{"use strict";let c=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(s){c=!1}const o=new Uint8Array(256);for(let q=0;q<256;q++)o[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;o[254]=o[254]=1,a.exports.string2buf=a=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(a);let c,o,s,q,t,i=a.length,p=0;for(q=0;q<i;q++)o=a.charCodeAt(q),55296===(64512&o)&&q+1<i&&(s=a.charCodeAt(q+1),56320===(64512&s)&&(o=65536+(o-55296<<10)+(s-56320),q++)),p+=o<128?1:o<2048?2:o<65536?3:4;for(c=new Uint8Array(p),t=0,q=0;t<p;q++)o=a.charCodeAt(q),55296===(64512&o)&&q+1<i&&(s=a.charCodeAt(q+1),56320===(64512&s)&&(o=65536+(o-55296<<10)+(s-56320),q++)),o<128?c[t++]=o:o<2048?(c[t++]=192|o>>>6,c[t++]=128|63&o):o<65536?(c[t++]=224|o>>>12,c[t++]=128|o>>>6&63,c[t++]=128|63&o):(c[t++]=240|o>>>18,c[t++]=128|o>>>12&63,c[t++]=128|o>>>6&63,c[t++]=128|63&o);return c};a.exports.buf2string=(a,s)=>{const q=s||a.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(a.subarray(0,s));let t,i;const p=new Array(2*q);for(i=0,t=0;t<q;){let c=a[t++];if(c<128){p[i++]=c;continue}let s=o[c];if(s>4)p[i++]=65533,t+=s-1;else{for(c&=2===s?31:3===s?15:7;s>1&&t<q;)c=c<<6|63&a[t++],s--;s>1?p[i++]=65533:c<65536?p[i++]=c:(c-=65536,p[i++]=55296|c>>10&1023,p[i++]=56320|1023&c)}}return((a,o)=>{if(o<65534&&a.subarray&&c)return String.fromCharCode.apply(null,a.length===o?a:a.subarray(0,o));let s="";for(let c=0;c<o;c++)s+=String.fromCharCode(a[c]);return s})(p,i)},a.exports.utf8border=(a,c)=>{(c=c||a.length)>a.length&&(c=a.length);let s=c-1;for(;s>=0&&128===(192&a[s]);)s--;return s<0||0===s?c:s+o[a[s]]>c?s:c}},14826:a=>{"use strict";a.exports=(a,c,o,s)=>{let q=65535&a,t=a>>>16&65535,i=0;for(;0!==o;){i=o>2e3?2e3:o,o-=i;do{q=q+c[s++]|0,t=t+q|0}while(--i);q%=65521,t%=65521}return q|t<<16}},14852:a=>{"use strict";a.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14835:a=>{"use strict";const c=new Uint32Array((()=>{let a,c=[];for(var o=0;o<256;o++){a=o;for(var s=0;s<8;s++)a=1&a?3988292384^a>>>1:a>>>1;c[o]=a}return c})());a.exports=(a,o,s,q)=>{const t=c,i=q+s;a^=-1;for(let c=q;c<i;c++)a=a>>>8^t[255&(a^o[c])];return~a}},14813:(a,c,o)=>{"use strict";const{_tr_init:s,_tr_stored_block:q,_tr_flush_block:t,_tr_tally:i,_tr_align:p}=o(14821),G=o(14826),T=o(14835),C=o(14843),{Z_NO_FLUSH:j,Z_PARTIAL_FLUSH:L,Z_FULL_FLUSH:e,Z_FINISH:g,Z_BLOCK:M,Z_OK:N,Z_STREAM_END:y,Z_STREAM_ERROR:k,Z_DATA_ERROR:n,Z_BUF_ERROR:f,Z_DEFAULT_COMPRESSION:J,Z_FILTERED:w,Z_HUFFMAN_ONLY:Z,Z_RLE:h,Z_FIXED:U,Z_DEFAULT_STRATEGY:S,Z_UNKNOWN:r,Z_DEFLATED:x}=o(14852),R=258,d=262,X=103,W=113,F=666,O=(a,c)=>(a.Oc=C[c],c),B=a=>(a<<1)-(a>4?9:0),u=a=>{let c=a.length;for(;--c>=0;)a[c]=0};let K=(a,c,o)=>(c<<a.hash_shift^o)&a.hash_mask;const D=a=>{const c=a.state;let o=c.pending;o>a.avail_out&&(o=a.avail_out),0!==o&&(a.output.set(c.pending_buf.subarray(c.pending_out,c.pending_out+o),a.next_out),a.next_out+=o,c.pending_out+=o,a.total_out+=o,a.avail_out-=o,c.pending-=o,0===c.pending&&(c.pending_out=0))},I=(a,c)=>{t(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,c),a.block_start=a.strstart,D(a.strm)},Y=(a,c)=>{a.pending_buf[a.pending++]=c},P=(a,c)=>{a.pending_buf[a.pending++]=c>>>8&255,a.pending_buf[a.pending++]=255&c},ma=(a,c,o,s)=>{let q=a.avail_in;return q>s&&(q=s),0===q?0:(a.avail_in-=q,c.set(a.input.subarray(a.next_in,a.next_in+q),o),1===a.state.wrap?a.adler=G(a.adler,c,q,o):2===a.state.wrap&&(a.adler=T(a.adler,c,q,o)),a.next_in+=q,a.total_in+=q,q)},V=(a,c)=>{let o,s,q=a.max_chain_length,t=a.strstart,i=a.prev_length,p=a.nice_match;const G=a.strstart>a.w_size-d?a.strstart-(a.w_size-d):0,T=a.window,C=a.w_mask,j=a.prev,L=a.strstart+R;let e=T[t+i-1],g=T[t+i];a.prev_length>=a.good_match&&(q>>=2),p>a.lookahead&&(p=a.lookahead);do{if(o=c,T[o+i]===g&&T[o+i-1]===e&&T[o]===T[t]&&T[++o]===T[t+1]){t+=2,o++;do{}while(T[++t]===T[++o]&&T[++t]===T[++o]&&T[++t]===T[++o]&&T[++t]===T[++o]&&T[++t]===T[++o]&&T[++t]===T[++o]&&T[++t]===T[++o]&&T[++t]===T[++o]&&t<L);if(s=R-(L-t),t=L-R,s>i){if(a.match_start=c,i=s,s>=p)break;e=T[t+i-1],g=T[t+i]}}}while((c=j[c&C])>G&&0!==--q);return i<=a.lookahead?i:a.lookahead},E=a=>{const c=a.w_size;let o,s,q,t,i;do{if(t=a.window_size-a.lookahead-a.strstart,a.strstart>=c+(c-d)){a.window.set(a.window.subarray(c,c+c),0),a.match_start-=c,a.strstart-=c,a.block_start-=c,s=a.hash_size,o=s;do{q=a.head[--o],a.head[o]=q>=c?q-c:0}while(--s);s=c,o=s;do{q=a.prev[--o],a.prev[o]=q>=c?q-c:0}while(--s);t+=c}if(0===a.strm.avail_in)break;if(s=ma(a.strm,a.window,a.strstart+a.lookahead,t),a.lookahead+=s,a.lookahead+a.insert>=3)for(i=a.strstart-a.insert,a.ins_h=a.window[i],a.ins_h=K(a,a.ins_h,a.window[i+1]);a.insert&&(a.ins_h=K(a,a.ins_h,a.window[i+3-1]),a.prev[i&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=i,i++,a.insert--,!(a.lookahead+a.insert<3)););}while(a.lookahead<d&&0!==a.strm.avail_in)},H=(a,c)=>{let o,s;for(;;){if(a.lookahead<d){if(E(a),a.lookahead<d&&c===j)return 1;if(0===a.lookahead)break}if(o=0,a.lookahead>=3&&(a.ins_h=K(a,a.ins_h,a.window[a.strstart+3-1]),o=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==o&&a.strstart-o<=a.w_size-d&&(a.match_length=V(a,o)),a.match_length>=3)if(s=i(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=3){a.match_length--;do{a.strstart++,a.ins_h=K(a,a.ins_h,a.window[a.strstart+3-1]),o=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart}while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=K(a,a.ins_h,a.window[a.strstart+1]);else s=i(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(s&&(I(a,!1),0===a.strm.avail_out))return 1}return a.insert=a.strstart<2?a.strstart:2,c===g?(I(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(I(a,!1),0===a.strm.avail_out)?1:2},b=(a,c)=>{let o,s,q;for(;;){if(a.lookahead<d){if(E(a),a.lookahead<d&&c===j)return 1;if(0===a.lookahead)break}if(o=0,a.lookahead>=3&&(a.ins_h=K(a,a.ins_h,a.window[a.strstart+3-1]),o=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=2,0!==o&&a.prev_length<a.max_lazy_match&&a.strstart-o<=a.w_size-d&&(a.match_length=V(a,o),a.match_length<=5&&(a.strategy===w||3===a.match_length&&a.strstart-a.match_start>4096)&&(a.match_length=2)),a.prev_length>=3&&a.match_length<=a.prev_length){q=a.strstart+a.lookahead-3,s=i(a,a.strstart-1-a.prev_match,a.prev_length-3),a.lookahead-=a.prev_length-1,a.prev_length-=2;do{++a.strstart<=q&&(a.ins_h=K(a,a.ins_h,a.window[a.strstart+3-1]),o=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart)}while(0!==--a.prev_length);if(a.match_available=0,a.match_length=2,a.strstart++,s&&(I(a,!1),0===a.strm.avail_out))return 1}else if(a.match_available){if(s=i(a,0,a.window[a.strstart-1]),s&&I(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(s=i(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<2?a.strstart:2,c===g?(I(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(I(a,!1),0===a.strm.avail_out)?1:2};function A(a,c,o,s,q){this.good_length=a,this.max_lazy=c,this.nice_length=o,this.max_chain=s,this.func=q}const v=[new A(0,0,0,0,((a,c)=>{let o=65535;for(o>a.pending_buf_size-5&&(o=a.pending_buf_size-5);;){if(a.lookahead<=1){if(E(a),0===a.lookahead&&c===j)return 1;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;const s=a.block_start+o;if((0===a.strstart||a.strstart>=s)&&(a.lookahead=a.strstart-s,a.strstart=s,I(a,!1),0===a.strm.avail_out))return 1;if(a.strstart-a.block_start>=a.w_size-d&&(I(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,c===g?(I(a,!0),0===a.strm.avail_out?3:4):(a.strstart>a.block_start&&(I(a,!1),a.strm.avail_out),1)})),new A(4,4,8,4,H),new A(4,5,16,8,H),new A(4,6,32,32,H),new A(4,4,16,16,b),new A(8,16,32,32,b),new A(8,16,128,128,b),new A(8,32,128,256,b),new A(32,128,258,1024,b),new A(32,258,258,4096,b)];function l(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),u(this.dyn_ltree),u(this.dyn_dtree),u(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),u(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),u(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Q=a=>{if(!a||!a.state)return O(a,k);a.total_in=a.total_out=0,a.data_type=r;const c=a.state;return c.pending=0,c.pending_out=0,c.wrap<0&&(c.wrap=-c.wrap),c.status=c.wrap?42:W,a.adler=2===c.wrap?0:1,c.last_flush=j,s(c),N},z=a=>{const c=Q(a);var o;return c===N&&((o=a.state).window_size=2*o.w_size,u(o.head),o.max_lazy_match=v[o.level].max_lazy,o.good_match=v[o.level].good_length,o.nice_match=v[o.level].nice_length,o.max_chain_length=v[o.level].max_chain,o.strstart=0,o.block_start=0,o.lookahead=0,o.insert=0,o.match_length=o.prev_length=2,o.match_available=0,o.ins_h=0),c},aa=(a,c,o,s,q,t)=>{if(!a)return k;let i=1;if(c===J&&(c=6),s<0?(i=0,s=-s):s>15&&(i=2,s-=16),q<1||q>9||o!==x||s<8||s>15||c<0||c>9||t<0||t>U)return O(a,k);8===s&&(s=9);const p=new l;return a.state=p,p.strm=a,p.wrap=i,p.gzhead=null,p.w_bits=s,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=q+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<q+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.d_buf=1*p.lit_bufsize,p.l_buf=3*p.lit_bufsize,p.level=c,p.strategy=t,p.method=o,z(a)};a.exports.deflateInit=(a,c)=>aa(a,c,x,15,8,S),a.exports.deflateInit2=aa,a.exports.deflateReset=z,a.exports.deflateResetKeep=Q,a.exports.deflateSetHeader=(a,c)=>a&&a.state?2!==a.state.wrap?k:(a.state.gzhead=c,N):k,a.exports.deflate=(a,c)=>{let o,s;if(!a||!a.state||c>M||c<0)return a?O(a,k):k;const t=a.state;if(!a.output||!a.input&&0!==a.avail_in||t.status===F&&c!==g)return O(a,0===a.avail_out?f:k);t.strm=a;const G=t.last_flush;if(t.last_flush=c,42===t.status)if(2===t.wrap)a.adler=0,Y(t,31),Y(t,139),Y(t,8),t.gzhead?(Y(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),Y(t,255&t.gzhead.time),Y(t,t.gzhead.time>>8&255),Y(t,t.gzhead.time>>16&255),Y(t,t.gzhead.time>>24&255),Y(t,9===t.level?2:t.strategy>=Z||t.level<2?4:0),Y(t,255&t.gzhead.os),t.gzhead.extra&&t.gzhead.extra.length&&(Y(t,255&t.gzhead.extra.length),Y(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(a.adler=T(a.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69):(Y(t,0),Y(t,0),Y(t,0),Y(t,0),Y(t,0),Y(t,9===t.level?2:t.strategy>=Z||t.level<2?4:0),Y(t,3),t.status=W);else{let c=x+(t.w_bits-8<<4)<<8,o=-1;o=t.strategy>=Z||t.level<2?0:t.level<6?1:6===t.level?2:3,c|=o<<6,0!==t.strstart&&(c|=32),c+=31-c%31,t.status=W,P(t,c),0!==t.strstart&&(P(t,a.adler>>>16),P(t,65535&a.adler)),a.adler=1}if(69===t.status)if(t.gzhead.extra){for(o=t.pending;t.gzindex<(65535&t.gzhead.extra.length)&&(t.pending!==t.pending_buf_size||(t.gzhead.hcrc&&t.pending>o&&(a.adler=T(a.adler,t.pending_buf,t.pending-o,o)),D(a),o=t.pending,t.pending!==t.pending_buf_size));)Y(t,255&t.gzhead.extra[t.gzindex]),t.gzindex++;t.gzhead.hcrc&&t.pending>o&&(a.adler=T(a.adler,t.pending_buf,t.pending-o,o)),t.gzindex===t.gzhead.extra.length&&(t.gzindex=0,t.status=73)}else t.status=73;if(73===t.status)if(t.gzhead.name){o=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>o&&(a.adler=T(a.adler,t.pending_buf,t.pending-o,o)),D(a),o=t.pending,t.pending===t.pending_buf_size)){s=1;break}s=t.gzindex<t.gzhead.name.length?255&t.gzhead.name.charCodeAt(t.gzindex++):0,Y(t,s)}while(0!==s);t.gzhead.hcrc&&t.pending>o&&(a.adler=T(a.adler,t.pending_buf,t.pending-o,o)),0===s&&(t.gzindex=0,t.status=91)}else t.status=91;if(91===t.status)if(t.gzhead.comment){o=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>o&&(a.adler=T(a.adler,t.pending_buf,t.pending-o,o)),D(a),o=t.pending,t.pending===t.pending_buf_size)){s=1;break}s=t.gzindex<t.gzhead.comment.length?255&t.gzhead.comment.charCodeAt(t.gzindex++):0,Y(t,s)}while(0!==s);t.gzhead.hcrc&&t.pending>o&&(a.adler=T(a.adler,t.pending_buf,t.pending-o,o)),0===s&&(t.status=X)}else t.status=X;if(t.status===X&&(t.gzhead.hcrc?(t.pending+2>t.pending_buf_size&&D(a),t.pending+2<=t.pending_buf_size&&(Y(t,255&a.adler),Y(t,a.adler>>8&255),a.adler=0,t.status=W)):t.status=W),0!==t.pending){if(D(a),0===a.avail_out)return t.last_flush=-1,N}else if(0===a.avail_in&&B(c)<=B(G)&&c!==g)return O(a,f);if(t.status===F&&0!==a.avail_in)return O(a,f);if(0!==a.avail_in||0!==t.lookahead||c!==j&&t.status!==F){let o=t.strategy===Z?((a,c)=>{let o;for(;;){if(0===a.lookahead&&(E(a),0===a.lookahead)){if(c===j)return 1;break}if(a.match_length=0,o=i(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,o&&(I(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,c===g?(I(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(I(a,!1),0===a.strm.avail_out)?1:2})(t,c):t.strategy===h?((a,c)=>{let o,s,q,t;const p=a.window;for(;;){if(a.lookahead<=R){if(E(a),a.lookahead<=R&&c===j)return 1;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(q=a.strstart-1,s=p[q],s===p[++q]&&s===p[++q]&&s===p[++q])){t=a.strstart+R;do{}while(s===p[++q]&&s===p[++q]&&s===p[++q]&&s===p[++q]&&s===p[++q]&&s===p[++q]&&s===p[++q]&&s===p[++q]&&q<t);a.match_length=R-(t-q),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(o=i(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(o=i(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),o&&(I(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,c===g?(I(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(I(a,!1),0===a.strm.avail_out)?1:2})(t,c):v[t.level].func(t,c);if(3!==o&&4!==o||(t.status=F),1===o||3===o)return 0===a.avail_out&&(t.last_flush=-1),N;if(2===o&&(c===L?p(t):c!==M&&(q(t,0,0,!1),c===e&&(u(t.head),0===t.lookahead&&(t.strstart=0,t.block_start=0,t.insert=0))),D(a),0===a.avail_out))return t.last_flush=-1,N}return c!==g?N:t.wrap<=0?y:(2===t.wrap?(Y(t,255&a.adler),Y(t,a.adler>>8&255),Y(t,a.adler>>16&255),Y(t,a.adler>>24&255),Y(t,255&a.total_in),Y(t,a.total_in>>8&255),Y(t,a.total_in>>16&255),Y(t,a.total_in>>24&255)):(P(t,a.adler>>>16),P(t,65535&a.adler)),D(a),t.wrap>0&&(t.wrap=-t.wrap),0!==t.pending?N:y)},a.exports.deflateEnd=a=>{if(!a||!a.state)return k;const c=a.state.status;return 42!==c&&69!==c&&73!==c&&91!==c&&c!==X&&c!==W&&c!==F?O(a,k):(a.state=null,c===W?O(a,n):N)},a.exports.deflateSetDictionary=(a,c)=>{let o=c.length;if(!a||!a.state)return k;const s=a.state,q=s.wrap;if(2===q||1===q&&42!==s.status||s.lookahead)return k;if(1===q&&(a.adler=G(a.adler,c,o,0)),s.wrap=0,o>=s.w_size){0===q&&(u(s.head),s.strstart=0,s.block_start=0,s.insert=0);let a=new Uint8Array(s.w_size);a.set(c.subarray(o-s.w_size,o),0),c=a,o=s.w_size}const t=a.avail_in,i=a.next_in,p=a.input;for(a.avail_in=o,a.next_in=0,a.input=c,E(s);s.lookahead>=3;){let a=s.strstart,c=s.lookahead-2;do{s.ins_h=K(s,s.ins_h,s.window[a+3-1]),s.prev[a&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=a,a++}while(--c);s.strstart=a,s.lookahead=2,E(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,a.next_in=i,a.input=p,a.avail_in=t,s.wrap=q,N},a.exports.deflateInfo="pako deflate (from Nodeca project)"},14890:a=>{"use strict";a.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14881:a=>{"use strict";a.exports=function(a,c){let o,s,q,t,i,p,G,T,C,j,L,e,g,M,N,y,k,n,f,J,w,Z,h,U;const S=a.state;o=a.next_in,h=a.input,s=o+(a.avail_in-5),q=a.next_out,U=a.output,t=q-(c-a.avail_out),i=q+(a.avail_out-257),p=S.dmax,G=S.wsize,T=S.whave,C=S.wnext,j=S.window,L=S.hold,e=S.bits,g=S.lencode,M=S.distcode,N=(1<<S.lenbits)-1,y=(1<<S.distbits)-1;a:do{e<15&&(L+=h[o++]<<e,e+=8,L+=h[o++]<<e,e+=8),k=g[L&N];c:for(;;){if(n=k>>>24,L>>>=n,e-=n,n=k>>>16&255,0===n)U[q++]=65535&k;else{if(!(16&n)){if(0===(64&n)){k=g[(65535&k)+(L&(1<<n)-1)];continue c}if(32&n){S.mode=12;break a}a.Oc="invalid literal/length code",S.mode=30;break a}f=65535&k,n&=15,n&&(e<n&&(L+=h[o++]<<e,e+=8),f+=L&(1<<n)-1,L>>>=n,e-=n),e<15&&(L+=h[o++]<<e,e+=8,L+=h[o++]<<e,e+=8),k=M[L&y];o:for(;;){if(n=k>>>24,L>>>=n,e-=n,n=k>>>16&255,!(16&n)){if(0===(64&n)){k=M[(65535&k)+(L&(1<<n)-1)];continue o}a.Oc="invalid distance code",S.mode=30;break a}if(J=65535&k,n&=15,e<n&&(L+=h[o++]<<e,e+=8,e<n&&(L+=h[o++]<<e,e+=8)),J+=L&(1<<n)-1,J>p){a.Oc="invalid distance too far back",S.mode=30;break a}if(L>>>=n,e-=n,n=q-t,J>n){if(n=J-n,n>T&&S.sane){a.Oc="invalid distance too far back",S.mode=30;break a}if(w=0,Z=j,0===C){if(w+=G-n,n<f){f-=n;do{U[q++]=j[w++]}while(--n);w=q-J,Z=U}}else if(C<n){if(w+=G+C-n,n-=C,n<f){f-=n;do{U[q++]=j[w++]}while(--n);if(w=0,C<f){n=C,f-=n;do{U[q++]=j[w++]}while(--n);w=q-J,Z=U}}}else if(w+=C-n,n<f){f-=n;do{U[q++]=j[w++]}while(--n);w=q-J,Z=U}for(;f>2;)U[q++]=Z[w++],U[q++]=Z[w++],U[q++]=Z[w++],f-=3;f&&(U[q++]=Z[w++],f>1&&(U[q++]=Z[w++]))}else{w=q-J;do{U[q++]=U[w++],U[q++]=U[w++],U[q++]=U[w++],f-=3}while(f>2);f&&(U[q++]=U[w++],f>1&&(U[q++]=U[w++]))}break}}break}}while(o<s&&q<i);f=e>>3,o-=f,e-=f<<3,L&=(1<<e)-1,a.next_in=o,a.next_out=q,a.avail_in=o<s?s-o+5:5-(o-s),a.avail_out=q<i?i-q+257:257-(q-i),S.hold=L,S.bits=e}},14875:(a,c,o)=>{"use strict";const s=o(14826),q=o(14835),t=o(14881),i=o(14885),{Z_FINISH:p,Z_BLOCK:G,Z_TREES:T,Z_OK:C,Z_STREAM_END:j,Z_NEED_DICT:L,Z_STREAM_ERROR:e,Z_DATA_ERROR:g,Z_MEM_ERROR:M,Z_BUF_ERROR:N,Z_DEFLATED:y}=o(14852),k=12,n=30,f=a=>(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24);function J(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const w=a=>{if(!a||!a.state)return e;const c=a.state;return a.total_in=a.total_out=c.total=0,a.Oc="",c.wrap&&(a.adler=1&c.wrap),c.mode=1,c.last=0,c.havedict=0,c.dmax=32768,c.head=null,c.hold=0,c.bits=0,c.lencode=c.lendyn=new Int32Array(852),c.distcode=c.distdyn=new Int32Array(592),c.sane=1,c.back=-1,C},Z=a=>{if(!a||!a.state)return e;const c=a.state;return c.wsize=0,c.whave=0,c.wnext=0,w(a)},h=(a,c)=>{let o;if(!a||!a.state)return e;const s=a.state;return c<0?(o=0,c=-c):(o=1+(c>>4),c<48&&(c&=15)),c&&(c<8||c>15)?e:(null!==s.window&&s.wbits!==c&&(s.window=null),s.wrap=o,s.wbits=c,Z(a))},U=(a,c)=>{if(!a)return e;const o=new J;a.state=o,o.window=null;const s=h(a,c);return s!==C&&(a.state=null),s};let S,r,x=!0;const R=a=>{if(x){S=new Int32Array(512),r=new Int32Array(32);let c=0;for(;c<144;)a.lens[c++]=8;for(;c<256;)a.lens[c++]=9;for(;c<280;)a.lens[c++]=7;for(;c<288;)a.lens[c++]=8;for(i(1,a.lens,0,288,S,0,a.work,{bits:9}),c=0;c<32;)a.lens[c++]=5;i(2,a.lens,0,32,r,0,a.work,{bits:5}),x=!1}a.lencode=S,a.lenbits=9,a.distcode=r,a.distbits=5},d=(a,c,o,s)=>{let q;const t=a.state;return null===t.window&&(t.wsize=1<<t.wbits,t.wnext=0,t.whave=0,t.window=new Uint8Array(t.wsize)),s>=t.wsize?(t.window.set(c.subarray(o-t.wsize,o),0),t.wnext=0,t.whave=t.wsize):(q=t.wsize-t.wnext,q>s&&(q=s),t.window.set(c.subarray(o-s,o-s+q),t.wnext),(s-=q)?(t.window.set(c.subarray(o-s,o),0),t.wnext=s,t.whave=t.wsize):(t.wnext+=q,t.wnext===t.wsize&&(t.wnext=0),t.whave<t.wsize&&(t.whave+=q))),0};a.exports.inflateReset=Z,a.exports.inflateReset2=h,a.exports.inflateResetKeep=w,a.exports.inflateInit=a=>U(a,15),a.exports.inflateInit2=U,a.exports.inflate=(a,c)=>{let o,J,w,Z,h,U,S,r,x,X,W,F,O,B,u,K,D,I,Y,P,ma,V,E=0;const H=new Uint8Array(4);let b,A;const v=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return e;o=a.state,o.mode===k&&(o.mode=13),h=a.next_out,w=a.output,S=a.avail_out,Z=a.next_in,J=a.input,U=a.avail_in,r=o.hold,x=o.bits,X=U,W=S,V=C;a:for(;;)switch(o.mode){case 1:if(0===o.wrap){o.mode=13;break}for(;x<16;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}if(2&o.wrap&&35615===r){o.check=0,H[0]=255&r,H[1]=r>>>8&255,o.check=q(o.check,H,2,0),r=0,x=0,o.mode=2;break}if(o.flags=0,o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&r)<<8)+(r>>8))%31){a.Oc="incorrect header check",o.mode=n;break}if((15&r)!==y){a.Oc="unknown compression method",o.mode=n;break}if(r>>>=4,x-=4,ma=8+(15&r),0===o.wbits)o.wbits=ma;else if(ma>o.wbits){a.Oc="invalid window size",o.mode=n;break}o.dmax=1<<o.wbits,a.adler=o.check=1,o.mode=512&r?10:k,r=0,x=0;break;case 2:for(;x<16;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}if(o.flags=r,(255&o.flags)!==y){a.Oc="unknown compression method",o.mode=n;break}if(57344&o.flags){a.Oc="unknown header flags set",o.mode=n;break}o.head&&(o.head.text=r>>8&1),512&o.flags&&(H[0]=255&r,H[1]=r>>>8&255,o.check=q(o.check,H,2,0)),r=0,x=0,o.mode=3;case 3:for(;x<32;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}o.head&&(o.head.time=r),512&o.flags&&(H[0]=255&r,H[1]=r>>>8&255,H[2]=r>>>16&255,H[3]=r>>>24&255,o.check=q(o.check,H,4,0)),r=0,x=0,o.mode=4;case 4:for(;x<16;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}o.head&&(o.head.xflags=255&r,o.head.os=r>>8),512&o.flags&&(H[0]=255&r,H[1]=r>>>8&255,o.check=q(o.check,H,2,0)),r=0,x=0,o.mode=5;case 5:if(1024&o.flags){for(;x<16;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}o.length=r,o.head&&(o.head.extra_len=r),512&o.flags&&(H[0]=255&r,H[1]=r>>>8&255,o.check=q(o.check,H,2,0)),r=0,x=0}else o.head&&(o.head.extra=null);o.mode=6;case 6:if(1024&o.flags&&(F=o.length,F>U&&(F=U),F&&(o.head&&(ma=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(J.subarray(Z,Z+F),ma)),512&o.flags&&(o.check=q(o.check,J,F,Z)),U-=F,Z+=F,o.length-=F),o.length))break a;o.length=0,o.mode=7;case 7:if(2048&o.flags){if(0===U)break a;F=0;do{ma=J[Z+F++],o.head&&ma&&o.length<65536&&(o.head.name+=String.fromCharCode(ma))}while(ma&&F<U);if(512&o.flags&&(o.check=q(o.check,J,F,Z)),U-=F,Z+=F,ma)break a}else o.head&&(o.head.name=null);o.length=0,o.mode=8;case 8:if(4096&o.flags){if(0===U)break a;F=0;do{ma=J[Z+F++],o.head&&ma&&o.length<65536&&(o.head.comment+=String.fromCharCode(ma))}while(ma&&F<U);if(512&o.flags&&(o.check=q(o.check,J,F,Z)),U-=F,Z+=F,ma)break a}else o.head&&(o.head.comment=null);o.mode=9;case 9:if(512&o.flags){for(;x<16;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}if(r!==(65535&o.check)){a.Oc="header crc mismatch",o.mode=n;break}r=0,x=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),a.adler=o.check=0,o.mode=k;break;case 10:for(;x<32;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}a.adler=o.check=f(r),r=0,x=0,o.mode=11;case 11:if(0===o.havedict)return a.next_out=h,a.avail_out=S,a.next_in=Z,a.avail_in=U,o.hold=r,o.bits=x,L;a.adler=o.check=1,o.mode=k;case k:if(c===G||c===T)break a;case 13:if(o.last){r>>>=7&x,x-=7&x,o.mode=27;break}for(;x<3;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}switch(o.last=1&r,r>>>=1,x-=1,3&r){case 0:o.mode=14;break;case 1:if(R(o),o.mode=20,c===T){r>>>=2,x-=2;break a}break;case 2:o.mode=17;break;case 3:a.Oc="invalid block type",o.mode=n}r>>>=2,x-=2;break;case 14:for(r>>>=7&x,x-=7&x;x<32;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}if((65535&r)!==(r>>>16^65535)){a.Oc="invalid stored block lengths",o.mode=n;break}if(o.length=65535&r,r=0,x=0,o.mode=15,c===T)break a;case 15:o.mode=16;case 16:if(F=o.length,F){if(F>U&&(F=U),F>S&&(F=S),0===F)break a;w.set(J.subarray(Z,Z+F),h),U-=F,Z+=F,S-=F,h+=F,o.length-=F;break}o.mode=k;break;case 17:for(;x<14;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}if(o.nlen=257+(31&r),r>>>=5,x-=5,o.ndist=1+(31&r),r>>>=5,x-=5,o.ncode=4+(15&r),r>>>=4,x-=4,o.nlen>286||o.ndist>30){a.Oc="too many length or distance symbols",o.mode=n;break}o.have=0,o.mode=18;case 18:for(;o.have<o.ncode;){for(;x<3;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}o.lens[v[o.have++]]=7&r,r>>>=3,x-=3}for(;o.have<19;)o.lens[v[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,b={bits:o.lenbits},V=i(0,o.lens,0,19,o.lencode,0,o.work,b),o.lenbits=b.bits,V){a.Oc="invalid code lengths set",o.mode=n;break}o.have=0,o.mode=19;case 19:for(;o.have<o.nlen+o.ndist;){for(;E=o.lencode[r&(1<<o.lenbits)-1],u=E>>>24,K=E>>>16&255,D=65535&E,!(u<=x);){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}if(D<16)r>>>=u,x-=u,o.lens[o.have++]=D;else{if(16===D){for(A=u+2;x<A;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}if(r>>>=u,x-=u,0===o.have){a.Oc="invalid bit length repeat",o.mode=n;break}ma=o.lens[o.have-1],F=3+(3&r),r>>>=2,x-=2}else if(17===D){for(A=u+3;x<A;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}r>>>=u,x-=u,ma=0,F=3+(7&r),r>>>=3,x-=3}else{for(A=u+7;x<A;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}r>>>=u,x-=u,ma=0,F=11+(127&r),r>>>=7,x-=7}if(o.have+F>o.nlen+o.ndist){a.Oc="invalid bit length repeat",o.mode=n;break}for(;F--;)o.lens[o.have++]=ma}}if(o.mode===n)break;if(0===o.lens[256]){a.Oc="invalid code -- missing end-of-block",o.mode=n;break}if(o.lenbits=9,b={bits:o.lenbits},V=i(1,o.lens,0,o.nlen,o.lencode,0,o.work,b),o.lenbits=b.bits,V){a.Oc="invalid literal/lengths set",o.mode=n;break}if(o.distbits=6,o.distcode=o.distdyn,b={bits:o.distbits},V=i(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,b),o.distbits=b.bits,V){a.Oc="invalid distances set",o.mode=n;break}if(o.mode=20,c===T)break a;case 20:o.mode=21;case 21:if(U>=6&&S>=258){a.next_out=h,a.avail_out=S,a.next_in=Z,a.avail_in=U,o.hold=r,o.bits=x,t(a,W),h=a.next_out,w=a.output,S=a.avail_out,Z=a.next_in,J=a.input,U=a.avail_in,r=o.hold,x=o.bits,o.mode===k&&(o.back=-1);break}for(o.back=0;E=o.lencode[r&(1<<o.lenbits)-1],u=E>>>24,K=E>>>16&255,D=65535&E,!(u<=x);){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}if(K&&0===(240&K)){for(I=u,Y=K,P=D;E=o.lencode[P+((r&(1<<I+Y)-1)>>I)],u=E>>>24,K=E>>>16&255,D=65535&E,!(I+u<=x);){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}r>>>=I,x-=I,o.back+=I}if(r>>>=u,x-=u,o.back+=u,o.length=D,0===K){o.mode=26;break}if(32&K){o.back=-1,o.mode=k;break}if(64&K){a.Oc="invalid literal/length code",o.mode=n;break}o.extra=15&K,o.mode=22;case 22:if(o.extra){for(A=o.extra;x<A;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}o.length+=r&(1<<o.extra)-1,r>>>=o.extra,x-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=23;case 23:for(;E=o.distcode[r&(1<<o.distbits)-1],u=E>>>24,K=E>>>16&255,D=65535&E,!(u<=x);){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}if(0===(240&K)){for(I=u,Y=K,P=D;E=o.distcode[P+((r&(1<<I+Y)-1)>>I)],u=E>>>24,K=E>>>16&255,D=65535&E,!(I+u<=x);){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}r>>>=I,x-=I,o.back+=I}if(r>>>=u,x-=u,o.back+=u,64&K){a.Oc="invalid distance code",o.mode=n;break}o.offset=D,o.extra=15&K,o.mode=24;case 24:if(o.extra){for(A=o.extra;x<A;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}o.offset+=r&(1<<o.extra)-1,r>>>=o.extra,x-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){a.Oc="invalid distance too far back",o.mode=n;break}o.mode=25;case 25:if(0===S)break a;if(F=W-S,o.offset>F){if(F=o.offset-F,F>o.whave&&o.sane){a.Oc="invalid distance too far back",o.mode=n;break}F>o.wnext?(F-=o.wnext,O=o.wsize-F):O=o.wnext-F,F>o.length&&(F=o.length),B=o.window}else B=w,O=h-o.offset,F=o.length;F>S&&(F=S),S-=F,o.length-=F;do{w[h++]=B[O++]}while(--F);0===o.length&&(o.mode=21);break;case 26:if(0===S)break a;w[h++]=o.length,S--,o.mode=21;break;case 27:if(o.wrap){for(;x<32;){if(0===U)break a;U--,r|=J[Z++]<<x,x+=8}if(W-=S,a.total_out+=W,o.total+=W,W&&(a.adler=o.check=o.flags?q(o.check,w,W,h-W):s(o.check,w,W,h-W)),W=S,(o.flags?r:f(r))!==o.check){a.Oc="incorrect data check",o.mode=n;break}r=0,x=0}o.mode=28;case 28:if(o.wrap&&o.flags){for(;x<32;){if(0===U)break a;U--,r+=J[Z++]<<x,x+=8}if(r!==(4294967295&o.total)){a.Oc="incorrect length check",o.mode=n;break}r=0,x=0}o.mode=29;case 29:V=j;break a;case n:V=g;break a;case 31:return M;default:return e}return a.next_out=h,a.avail_out=S,a.next_in=Z,a.avail_in=U,o.hold=r,o.bits=x,(o.wsize||W!==a.avail_out&&o.mode<n&&(o.mode<27||c!==p))&&d(a,a.output,a.next_out,W-a.avail_out)?(o.mode=31,M):(X-=a.avail_in,W-=a.avail_out,a.total_in+=X,a.total_out+=W,o.total+=W,o.wrap&&W&&(a.adler=o.check=o.flags?q(o.check,w,W,a.next_out-W):s(o.check,w,W,a.next_out-W)),a.data_type=o.bits+(o.last?64:0)+(o.mode===k?128:0)+(20===o.mode||15===o.mode?256:0),(0===X&&0===W||c===p)&&V===C&&(V=N),V)},a.exports.inflateEnd=a=>{if(!a||!a.state)return e;let c=a.state;return c.window&&(c.window=null),a.state=null,C},a.exports.inflateGetHeader=(a,c)=>{if(!a||!a.state)return e;const o=a.state;return 0===(2&o.wrap)?e:(o.head=c,c.done=!1,C)},a.exports.inflateSetDictionary=(a,c)=>{const o=c.length;let q,t,i;return a&&a.state?(q=a.state,0!==q.wrap&&11!==q.mode?e:11===q.mode&&(t=1,t=s(t,c,o,0),t!==q.check)?g:(i=d(a,c,o,o),i?(q.mode=31,M):(q.havedict=1,C))):e},a.exports.inflateInfo="pako inflate (from Nodeca project)"},14885:a=>{"use strict";const c=15,o=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),s=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),q=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),t=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);a.exports=(a,i,p,G,T,C,j,L)=>{const e=L.bits;let g,M,N,y,k,n,f=0,J=0,w=0,Z=0,h=0,U=0,S=0,r=0,x=0,R=0,d=null,X=0;const W=new Uint16Array(16),F=new Uint16Array(16);let O,B,u,K=null,D=0;for(f=0;f<=c;f++)W[f]=0;for(J=0;J<G;J++)W[i[p+J]]++;for(h=e,Z=c;Z>=1&&0===W[Z];Z--);if(h>Z&&(h=Z),0===Z)return T[C++]=20971520,T[C++]=20971520,L.bits=1,0;for(w=1;w<Z&&0===W[w];w++);for(h<w&&(h=w),r=1,f=1;f<=c;f++)if(r<<=1,r-=W[f],r<0)return-1;if(r>0&&(0===a||1!==Z))return-1;for(F[1]=0,f=1;f<c;f++)F[f+1]=F[f]+W[f];for(J=0;J<G;J++)0!==i[p+J]&&(j[F[i[p+J]]++]=J);if(0===a?(d=K=j,n=19):1===a?(d=o,X-=257,K=s,D-=257,n=256):(d=q,K=t,n=-1),R=0,J=0,f=w,k=C,U=h,S=0,N=-1,x=1<<h,y=x-1,1===a&&x>852||2===a&&x>592)return 1;for(;;){O=f-S,j[J]<n?(B=0,u=j[J]):j[J]>n?(B=K[D+j[J]],u=d[X+j[J]]):(B=96,u=0),g=1<<f-S,M=1<<U,w=M;do{M-=g,T[k+(R>>S)+M]=O<<24|B<<16|u}while(0!==M);for(g=1<<f-1;R&g;)g>>=1;if(0!==g?(R&=g-1,R+=g):R=0,J++,0===--W[f]){if(f===Z)break;f=i[p+j[J]]}if(f>h&&(R&y)!==N){for(0===S&&(S=h),k+=w,U=f-S,r=1<<U;U+S<Z&&(r-=W[U+S],!(r<=0));)U++,r<<=1;if(x+=1<<U,1===a&&x>852||2===a&&x>592)return 1;N=R&y,T[N]=h<<24|U<<16|k-C}}return 0!==R&&(T[k+R]=f-S<<24|64<<16),L.bits=h,0}},14843:a=>{"use strict";a.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14821:a=>{"use strict";function c(a){let c=a.length;for(;--c>=0;)a[c]=0}const o=256,s=286,q=30,t=15,i=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),p=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),G=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),C=new Array(576);c(C);const j=new Array(60);c(j);const L=new Array(512);c(L);const e=new Array(256);c(e);const g=new Array(29);c(g);const M=new Array(q);function N(a,c,o,s,q){this.static_tree=a,this.extra_bits=c,this.extra_base=o,this.elems=s,this.max_length=q,this.has_stree=a&&a.length}let y,k,n;function f(a,c){this.dyn_tree=a,this.max_code=0,this.stat_desc=c}c(M);const J=a=>a<256?L[a]:L[256+(a>>>7)],w=(a,c)=>{a.pending_buf[a.pending++]=255&c,a.pending_buf[a.pending++]=c>>>8&255},Z=(a,c,o)=>{a.bi_valid>16-o?(a.bi_buf|=c<<a.bi_valid&65535,w(a,a.bi_buf),a.bi_buf=c>>16-a.bi_valid,a.bi_valid+=o-16):(a.bi_buf|=c<<a.bi_valid&65535,a.bi_valid+=o)},h=(a,c,o)=>{Z(a,o[2*c],o[2*c+1])},U=(a,c)=>{let o=0;do{o|=1&a,a>>>=1,o<<=1}while(--c>0);return o>>>1},S=(a,c,o)=>{const s=new Array(16);let q,i,p=0;for(q=1;q<=t;q++)s[q]=p=p+o[q-1]<<1;for(i=0;i<=c;i++){let c=a[2*i+1];0!==c&&(a[2*i]=U(s[c]++,c))}},r=a=>{let c;for(c=0;c<s;c++)a.dyn_ltree[2*c]=0;for(c=0;c<q;c++)a.dyn_dtree[2*c]=0;for(c=0;c<19;c++)a.bl_tree[2*c]=0;a.dyn_ltree[512]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0},x=a=>{a.bi_valid>8?w(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0},R=(a,c,o,s)=>{const q=2*c,t=2*o;return a[q]<a[t]||a[q]===a[t]&&s[c]<=s[o]},d=(a,c,o)=>{const s=a.heap[o];let q=o<<1;for(;q<=a.heap_len&&(q<a.heap_len&&R(c,a.heap[q+1],a.heap[q],a.depth)&&q++,!R(c,s,a.heap[q],a.depth));)a.heap[o]=a.heap[q],o=q,q<<=1;a.heap[o]=s},X=(a,c,s)=>{let q,t,G,T,C=0;if(0!==a.last_lit)do{q=a.pending_buf[a.d_buf+2*C]<<8|a.pending_buf[a.d_buf+2*C+1],t=a.pending_buf[a.l_buf+C],C++,0===q?h(a,t,c):(G=e[t],h(a,G+o+1,c),T=i[G],0!==T&&(t-=g[G],Z(a,t,T)),q--,G=J(q),h(a,G,s),T=p[G],0!==T&&(q-=M[G],Z(a,q,T)))}while(C<a.last_lit);h(a,256,c)},W=(a,c)=>{const o=c.dyn_tree,s=c.stat_desc.static_tree,q=c.stat_desc.has_stree,i=c.stat_desc.elems;let p,G,T,C=-1;for(a.heap_len=0,a.heap_max=573,p=0;p<i;p++)0!==o[2*p]?(a.heap[++a.heap_len]=C=p,a.depth[p]=0):o[2*p+1]=0;for(;a.heap_len<2;)T=a.heap[++a.heap_len]=C<2?++C:0,o[2*T]=1,a.depth[T]=0,a.opt_len--,q&&(a.static_len-=s[2*T+1]);for(c.max_code=C,p=a.heap_len>>1;p>=1;p--)d(a,o,p);T=i;do{p=a.heap[1],a.heap[1]=a.heap[a.heap_len--],d(a,o,1),G=a.heap[1],a.heap[--a.heap_max]=p,a.heap[--a.heap_max]=G,o[2*T]=o[2*p]+o[2*G],a.depth[T]=(a.depth[p]>=a.depth[G]?a.depth[p]:a.depth[G])+1,o[2*p+1]=o[2*G+1]=T,a.heap[1]=T++,d(a,o,1)}while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],((a,c)=>{const o=c.dyn_tree,s=c.max_code,q=c.stat_desc.static_tree,i=c.stat_desc.has_stree,p=c.stat_desc.extra_bits,G=c.stat_desc.extra_base,T=c.stat_desc.max_length;let C,j,L,e,g,M,N=0;for(e=0;e<=t;e++)a.bl_count[e]=0;for(o[2*a.heap[a.heap_max]+1]=0,C=a.heap_max+1;C<573;C++)j=a.heap[C],e=o[2*o[2*j+1]+1]+1,e>T&&(e=T,N++),o[2*j+1]=e,j>s||(a.bl_count[e]++,g=0,j>=G&&(g=p[j-G]),M=o[2*j],a.opt_len+=M*(e+g),i&&(a.static_len+=M*(q[2*j+1]+g)));if(0!==N){do{for(e=T-1;0===a.bl_count[e];)e--;a.bl_count[e]--,a.bl_count[e+1]+=2,a.bl_count[T]--,N-=2}while(N>0);for(e=T;0!==e;e--)for(j=a.bl_count[e];0!==j;)L=a.heap[--C],L>s||(o[2*L+1]!==e&&(a.opt_len+=(e-o[2*L+1])*o[2*L],o[2*L+1]=e),j--)}})(a,c),S(o,C,a.bl_count)},F=(a,c,o)=>{let s,q,t=-1,i=c[1],p=0,G=7,T=4;for(0===i&&(G=138,T=3),c[2*(o+1)+1]=65535,s=0;s<=o;s++)q=i,i=c[2*(s+1)+1],++p<G&&q===i||(p<T?a.bl_tree[2*q]+=p:0!==q?(q!==t&&a.bl_tree[2*q]++,a.bl_tree[32]++):p<=10?a.bl_tree[34]++:a.bl_tree[36]++,p=0,t=q,0===i?(G=138,T=3):q===i?(G=6,T=3):(G=7,T=4))},O=(a,c,o)=>{let s,q,t=-1,i=c[1],p=0,G=7,T=4;for(0===i&&(G=138,T=3),s=0;s<=o;s++)if(q=i,i=c[2*(s+1)+1],!(++p<G&&q===i)){if(p<T)do{h(a,q,a.bl_tree)}while(0!==--p);else 0!==q?(q!==t&&(h(a,q,a.bl_tree),p--),h(a,16,a.bl_tree),Z(a,p-3,2)):p<=10?(h(a,17,a.bl_tree),Z(a,p-3,3)):(h(a,18,a.bl_tree),Z(a,p-11,7));p=0,t=q,0===i?(G=138,T=3):q===i?(G=6,T=3):(G=7,T=4)}};let B=!1;const u=(a,c,o,s)=>{Z(a,0+(s?1:0),3),((a,c,o,s)=>{x(a),s&&(w(a,o),w(a,~o)),a.pending_buf.set(a.window.subarray(c,c+o),a.pending),a.pending+=o})(a,c,o,!0)};a.exports._tr_init=a=>{B||((()=>{let a,c,o,T,f;const J=new Array(16);for(o=0,T=0;T<28;T++)for(g[T]=o,a=0;a<1<<i[T];a++)e[o++]=T;for(e[o-1]=T,f=0,T=0;T<16;T++)for(M[T]=f,a=0;a<1<<p[T];a++)L[f++]=T;for(f>>=7;T<q;T++)for(M[T]=f<<7,a=0;a<1<<p[T]-7;a++)L[256+f++]=T;for(c=0;c<=t;c++)J[c]=0;for(a=0;a<=143;)C[2*a+1]=8,a++,J[8]++;for(;a<=255;)C[2*a+1]=9,a++,J[9]++;for(;a<=279;)C[2*a+1]=7,a++,J[7]++;for(;a<=287;)C[2*a+1]=8,a++,J[8]++;for(S(C,287,J),a=0;a<q;a++)j[2*a+1]=5,j[2*a]=U(a,5);y=new N(C,i,257,s,t),k=new N(j,p,0,q,t),n=new N(new Array(0),G,0,19,7)})(),B=!0),a.l_desc=new f(a.dyn_ltree,y),a.d_desc=new f(a.dyn_dtree,k),a.bl_desc=new f(a.bl_tree,n),a.bi_buf=0,a.bi_valid=0,r(a)},a.exports._tr_stored_block=u,a.exports._tr_flush_block=(a,c,s,q)=>{let t,i,p=0;a.level>0?(2===a.strm.data_type&&(a.strm.data_type=(a=>{let c,s=4093624447;for(c=0;c<=31;c++,s>>>=1)if(1&s&&0!==a.dyn_ltree[2*c])return 0;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return 1;for(c=32;c<o;c++)if(0!==a.dyn_ltree[2*c])return 1;return 0})(a)),W(a,a.l_desc),W(a,a.d_desc),p=(a=>{let c;for(F(a,a.dyn_ltree,a.l_desc.max_code),F(a,a.dyn_dtree,a.d_desc.max_code),W(a,a.bl_desc),c=18;c>=3&&0===a.bl_tree[2*T[c]+1];c--);return a.opt_len+=3*(c+1)+5+5+4,c})(a),t=a.opt_len+3+7>>>3,i=a.static_len+3+7>>>3,i<=t&&(t=i)):t=i=s+5,s+4<=t&&-1!==c?u(a,c,s,q):4===a.strategy||i===t?(Z(a,2+(q?1:0),3),X(a,C,j)):(Z(a,4+(q?1:0),3),((a,c,o,s)=>{let q;for(Z(a,c-257,5),Z(a,o-1,5),Z(a,s-4,4),q=0;q<s;q++)Z(a,a.bl_tree[2*T[q]+1],3);O(a,a.dyn_ltree,c-1),O(a,a.dyn_dtree,o-1)})(a,a.l_desc.max_code+1,a.d_desc.max_code+1,p+1),X(a,a.dyn_ltree,a.dyn_dtree)),r(a),q&&x(a)},a.exports._tr_tally=(a,c,s)=>(a.pending_buf[a.d_buf+2*a.last_lit]=c>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&c,a.pending_buf[a.l_buf+a.last_lit]=255&s,a.last_lit++,0===c?a.dyn_ltree[2*s]++:(a.matches++,c--,a.dyn_ltree[2*(e[s]+o+1)]++,a.dyn_dtree[2*J(c)]++),a.last_lit===a.lit_bufsize-1),a.exports._tr_align=a=>{Z(a,2,3),h(a,256,C),(a=>{16===a.bi_valid?(w(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)})(a)}},14871:a=>{"use strict";a.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Oc="",this.state=null,this.data_type=2,this.adler=0}},13596:a=>{function c(a,c,o){for(var s=a.length,q=-1/0,t=1/0,i=0;i<s;i++){var p=(o[0][i]-a[i])/c[i],G=(o[1][i]-a[i])/c[i];if(p>G){var T=p;p=G,G=T}if(G<q||p>t)return 1/0;p>q&&(q=p),G<t&&(t=G)}return q>t?1/0:q}a.exports=function(a,o,s,q){var t=c(o,s,q);if(t===1/0)a=null;else{a=a||[];for(var i=0;i<o.length;i++)a[i]=o[i]+s[i]*t}return a},a.exports.distance=c},14951:(a,c,o)=>{"use strict";o.d(c,{c:()=>i});var s=o(43);const q=s.useLayoutEffect;const t=function(a){var c=(0,s.useRef)(a);return q((function(){c.current=a})),c};var i=function(a){var c=t(a);(0,s.Zc)((function(){var a=function(a){var o;if(null!=c.current&&(o=c.current(a)),a.defaultPrevented&&(a.returnValue=""),"string"===typeof o)return a.returnValue=o,o};return window.addEventListener("beforeunload",a),function(){window.removeEventListener("beforeunload",a)}}),[])}},14914:(a,c,o)=>{"use strict";var s=o(14921),q=Array.prototype.concat,t=Array.prototype.slice,i=a.exports=function(a){for(var c=[],o=0,i=a.length;o<i;o++){var p=a[o];s(p)?c=q.call(c,t.call(p)):c.push(p)}return c};i.wrap=function(a){return function(){return a(i(arguments))}}},14921:a=>{a.exports=function(a){return!(!a||"string"===typeof a)&&(a instanceof Array||Array.isArray(a)||a.length>=0&&(a.splice instanceof Function||Object.getOwnPropertyDescriptor(a,a.length-1)&&"String"!==a.constructor.name))}},14760:(a,c,o)=>{var s=o(14764);function q(a){for(var c,o,q=0,t=a.length,i=0;i<a.length;){for(c=a[i],o=0;i<t&&a[i]===c;)++i,++o;q+=s.log2(o)/7|0,q+=s.log2(c>>>0)/7|0,q+=2}return q}c.size=q,c.encode=function(a,c){c||(c=new Uint8Array(q(a)));for(var o,s,t=0,i=c.length,p=0;p<a.length;){for(o=a[p],s=0;p<a.length&&a[p]===o;)++p,++s;for(;t<i&&s>=128;)c[t++]=128+(127&s),s>>>=7;if(t>=i)throw new Error("RLE buffer overflow");for(c[t++]=s,o>>>=0;t<i&&o>=128;)c[t++]=128+(127&o),o>>>=7;if(t>=i)throw new Error("RLE buffer overflow");c[t++]=o}return c},c.decode=function(a,c){for(var o,s,q,t,i=c.length,p=a.length,G=0,T=0;T<p;){for(o=0,s=0;T<p&&a[T]>=128;)o+=(127&a[T++])<<s,s+=7;if(o+=a[T++]<<s,T>=p)throw new Error("RLE buffer underrun");if(G+o>i)throw new Error("Chunk buffer overflow");for(q=0,s=0;T<p&&a[T]>=128;)q+=(127&a[T++])<<s,s+=7;if(T>=p)throw new Error("RLE buffer underrun");for(q+=a[T++]<<s,t=0;t<o;++t)c[G++]=q}return c}},14764:(a,c)=>{"use strict";function o(a){var c=32;return(a&=-a)&&c--,65535&a&&(c-=16),16711935&a&&(c-=8),252645135&a&&(c-=4),858993459&a&&(c-=2),1431655765&a&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(a){return(a>0)-(a<0)},c.abs=function(a){var c=a>>31;return(a^c)-c},c.min=function(a,c){return c^(a^c)&-(a<c)},c.max=function(a,c){return a^(a^c)&-(a<c)},c.isPow2=function(a){return!(a&a-1)&&!!a},c.log2=function(a){var c,o;return c=(a>65535)<<4,c|=o=((a>>>=c)>255)<<3,c|=o=((a>>>=o)>15)<<2,(c|=o=((a>>>=o)>3)<<1)|(a>>>=o)>>1},c.log10=function(a){return a>=1e9?9:a>=1e8?8:a>=1e7?7:a>=1e6?6:a>=1e5?5:a>=1e4?4:a>=1e3?3:a>=100?2:a>=10?1:0},c.popCount=function(a){return 16843009*((a=(858993459&(a-=a>>>1&1431655765))+(a>>>2&858993459))+(a>>>4)&252645135)>>>24},c.countTrailingZeros=o,c.nextPow2=function(a){return a+=0===a,--a,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)+1},c.prevPow2=function(a){return a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)-(a>>>1)},c.parity=function(a){return a^=a>>>16,a^=a>>>8,a^=a>>>4,27030>>>(a&=15)&1};var s=new Array(256);!function(a){for(var c=0;c<256;++c){var o=c,s=c,q=7;for(o>>>=1;o;o>>>=1)s<<=1,s|=1&o,--q;a[c]=s<<q&255}}(s),c.reverse=function(a){return s[255&a]<<24|s[a>>>8&255]<<16|s[a>>>16&255]<<8|s[a>>>24&255]},c.interleave2=function(a,c){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(a,c){return(a=65535&((a=16711935&((a=252645135&((a=858993459&((a=a>>>c&1431655765)|a>>>1))|a>>>2))|a>>>4))|a>>>16))<<16>>16},c.interleave3=function(a,c,o){return a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2),(a|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<2},c.deinterleave3=function(a,c){return(a=1023&((a=4278190335&((a=251719695&((a=3272356035&((a=a>>>c&1227133513)|a>>>2))|a>>>4))|a>>>8))|a>>>16))<<22>>22},c.nextCombination=function(a){var c=a|a-1;return c+1|(~c&-~c)-1>>>o(a)+1}},14791:a=>{"use strict";a.exports=function(a,c,o,s){var q=self||window;try{try{var t;try{t=new q.Blob([a])}catch(T){(t=new(q.BlobBuilder||q.WebKitBlobBuilder||q.MozBlobBuilder||q.MSBlobBuilder)).append(a),t=t.getBlob()}var i=q.URL||q.webkitURL,p=i.createObjectURL(t),G=new q[c](p,o);return i.revokeObjectURL(p),G}catch(T){return new q[c]("data:application/javascript,".concat(encodeURIComponent(a)),o)}}catch(T){if(!s)throw Error("Inline worker is not supported");return new q[c](s,o)}}},13575:(a,c,o)=>{"use strict";function s(a,c,o,s,q){var t={};return Object.keys(s).forEach((function(a){t[a]=s[a]})),t.enumerable=!!t.enumerable,t.configurable=!!t.configurable,("value"in t||t.initializer)&&(t.writable=!0),t=o.slice().reverse().reduce((function(o,s){return s(a,c,o)||o}),t),q&&void 0!==t.initializer&&(t.value=t.initializer?t.initializer.call(q):void 0,t.initializer=void 0),void 0===t.initializer&&(Object.defineProperty(a,c,t),t=null),t}o.d(c,{c:()=>s})},13573:(a,c,o)=>{"use strict";function s(a,c,o,s){o&&Object.defineProperty(a,c,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(s):void 0})}o.d(c,{b:()=>s})},14962:(a,c,o)=>{"use strict";o.d(c,{b:()=>i,f:()=>j,i:()=>p,m:()=>t,o:()=>G,p:()=>q,t:()=>T,u:()=>C});var s=o(13016);class q{constructor(){this._easingMode=q.EASINGMODE_EASEIN}setEasingMode(a){const c=Math.min(Math.max(a,0),2);this._easingMode=c}getEasingMode(){return this._easingMode}easeInCore(a){throw new Error("You must implement this method")}ease(a){switch(this._easingMode){case q.EASINGMODE_EASEIN:return this.easeInCore(a);case q.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-a)}return a>=.5?.5*(1-this.easeInCore(2*(1-a)))+.5:.5*this.easeInCore(2*a)}}q.EASINGMODE_EASEIN=0,q.EASINGMODE_EASEOUT=1,q.EASINGMODE_EASEINOUT=2;class t extends q{easeInCore(a){return a=Math.max(0,Math.min(1,a)),1-Math.sqrt(1-a*a)}}class i extends q{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=a}easeInCore(a){const c=Math.max(0,this.amplitude);return Math.pow(a,3)-a*c*Math.sin(3.141592653589793*a)}}class p extends q{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=a,this.bounciness=c}easeInCore(a){const c=Math.max(0,this.bounces);let o=this.bounciness;o<=1&&(o=1.001);const s=Math.pow(o,c),q=1-o,t=(1-s)/q+.5*s,i=a*t,p=Math.log(-i*(1-o)+1)/Math.log(o),G=Math.floor(p),T=G+1,C=(1-Math.pow(o,G))/(q*t),j=.5*(C+(1-Math.pow(o,T))/(q*t)),L=a-j,e=j-C;return-Math.pow(1/o,c-G)/(e*e)*(L-e)*(L+e)}}class G extends q{easeInCore(a){return a*a*a}}class T extends q{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=a,this.springiness=c}easeInCore(a){let c;const o=Math.max(0,this.oscillations),s=Math.max(0,this.springiness);return c=0==s?a:(Math.exp(s*a)-1)/(Math.exp(s)-1),c*Math.sin((6.283185307179586*o+1.5707963267948966)*a)}}class C extends q{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=a}easeInCore(a){return this.exponent<=0?a:(Math.exp(this.exponent*a)-1)/(Math.exp(this.exponent)-1)}}class j extends q{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=a,this.y1=c,this.x2=o,this.y2=s}easeInCore(a){return s.b.Interpolate(a,this.x1,this.y1,this.x2,this.y2)}}},14328:(a,c,o)=>{"use strict";o.d(c,{e:()=>i});var s=o(12810),q=o(12820),t=o(13211);class i extends t.b{get _matrix(){return this._compose(),this.ge}set _matrix(a){(a.updateFlag!==this.ge.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.ge.G(a),this._markAsDirtyAndDecompose())}constructor(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(a,c.Za(),!1),this.name=a,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=c,this.ge=(null===q||void 0===q?void 0:q.clone())??s.Matrix.Identity(),this._restMatrix=t??this.ge.clone(),this._bindMatrix=i??this.ge.clone(),this._index=p,this._absoluteMatrix=new s.Matrix,this._absoluteBindMatrix=new s.Matrix,this._absoluteInverseBindMatrix=new s.Matrix,this._finalMatrix=new s.Matrix,c.bones.push(this),this.setParent(o,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(a){this.setParent(a)}setParent(a){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==a){if(this.parent){const a=this.parent.children.indexOf(this);-1!==a&&this.parent.children.splice(a,1)}this._parentNode=a,this.parent&&this.parent.children.push(this),c&&this._updateAbsoluteBindMatrices(),this.FC()}}getLocalMatrix(){return this._compose(),this.ge}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(a){this._restMatrix.G(a)}setRestPose(a){this.setRestMatrix(a)}getBindPose(){return this.getBindMatrix()}setBindMatrix(a){this.xc(a)}setBindPose(a){this.setBindMatrix(a)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const a=s.TmpVectors.Hc[0],c=s.TmpVectors.Quaternion[0],o=s.TmpVectors.Hc[1];this.getRestMatrix().decompose(a,c,o),this._linkedTransformNode.position.G(o),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??s.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.G(c),this._linkedTransformNode.uc.G(a)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(a){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=a,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.IG}set position(a){this._decompose(),this.IG.G(a),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(a){this.setRotation(a)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(a){this.setRotationQuaternion(a)}get uc(){return this.getScale()}set uc(a){this.setScale(a)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=s.Hc.Zero(),this._localRotation=s.Quaternion.Zero(),this.IG=s.Hc.Zero()),this.ge.decompose(this._localScaling,this._localRotation,this.IG))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,s.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.IG,this.ge)):this._needToCompose=!1)}xc(a){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.G(a),c&&this._updateAbsoluteBindMatrices(),o?this._matrix=a:this.FC()}_updateAbsoluteBindMatrices(a){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(a||(a=this._bindMatrix),this.parent?a.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.G(a),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),c)for(let o=0;o<this.children.length;o++)this.children[o]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}FC(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.FC(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.FC(),this._needToDecompose=!0}_updatePosition(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=this.getLocalMatrix();if(0==c)q?(t.addAtIndex(12,a.x),t.addAtIndex(13,a.y),t.addAtIndex(14,a.z)):t.setTranslationFromFloats(a.x,a.y,a.z);else{let c=null;o&&(c=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=i._TmpMats[0],G=i._TmpVecs[0];this.parent?o&&c?(p.G(this.parent.getAbsoluteMatrix()),p.multiplyToRef(c,p)):p.G(this.parent.getAbsoluteMatrix()):s.Matrix.IdentityToRef(p),q&&p.setTranslationFromFloats(0,0,0),p.invert(),s.Hc.TransformCoordinatesToRef(a,p,G),q?(t.addAtIndex(12,G.x),t.addAtIndex(13,G.y),t.addAtIndex(14,G.z)):t.setTranslationFromFloats(G.x,G.y,G.z)}this._markAsDirtyAndDecompose()}translate(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this._updatePosition(a,c,o,!0)}setPosition(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this._updatePosition(a,c,o,!1)}setAbsolutePosition(a,c){this.setPosition(a,1,c)}scale(a,c,o){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=this.getLocalMatrix(),p=i._TmpMats[0];s.Matrix.ScalingToRef(a,c,o,p),p.multiplyToRef(t,t),p.invert();for(const s of this.children){const q=s.getLocalMatrix();q.multiplyToRef(p,q),q.multiplyAtIndex(12,a),q.multiplyAtIndex(13,c),q.multiplyAtIndex(14,o),s._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),q)for(const s of this.children)s.scale(a,c,o,q)}setScale(a){this._decompose(),this._localScaling.G(a),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(a){this._decompose(),a.G(this._localScaling)}setYawPitchRoll(a,c,o){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4?arguments[4]:void 0;if(0===q){const p=i._TmpQuat;return s.Quaternion.RotationYawPitchRollToRef(a,c,o,p),void this.setRotationQuaternion(p,q,t)}const p=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,t))return;const G=i._TmpMats[1];s.Matrix.RotationYawPitchRollToRef(a,c,o,G),p.multiplyToRef(G,G),this._rotateWithMatrix(G,q,t)}rotate(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3?arguments[3]:void 0;const t=i._TmpMats[0];t.setTranslationFromFloats(0,0,0),s.Matrix.RotationAxisToRef(a,c,t),this._rotateWithMatrix(t,o,q)}setAxisAngle(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3?arguments[3]:void 0;if(0===o){const t=i._TmpQuat;return s.Quaternion.RotationAxisToRef(a,c,t),void this.setRotationQuaternion(t,o,q)}const t=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,q))return;const p=i._TmpMats[1];s.Matrix.RotationAxisToRef(a,c,p),t.multiplyToRef(p,p),this._rotateWithMatrix(p,o,q)}setRotation(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(a.y,a.x,a.z,c,o)}setRotationQuaternion(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(0===c)return this._decompose(),this._localRotation.G(a),void this._markAsDirtyAndCompose();const q=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,o))return;const t=i._TmpMats[1];s.Matrix.FromQuaternionToRef(a,t),q.multiplyToRef(t,t),this._rotateWithMatrix(t,c,o)}setRotationMatrix(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(0===c){const q=i._TmpQuat;return s.Quaternion.FromRotationMatrixToRef(a,q),void this.setRotationQuaternion(q,c,o)}const q=i._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,o))return;const t=i._TmpMats[1];t.G(a),q.multiplyToRef(a,t),this._rotateWithMatrix(t,c,o)}_rotateWithMatrix(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;const s=this.getLocalMatrix(),q=s.m[12],t=s.m[13],p=s.m[14],G=this.getParent(),T=i._TmpMats[3],C=i._TmpMats[4];G&&1==c?(o?(T.G(o.getWorldMatrix()),G.getAbsoluteMatrix().multiplyToRef(T,T)):T.G(G.getAbsoluteMatrix()),C.G(T),C.invert(),s.multiplyToRef(T,s),s.multiplyToRef(a,s),s.multiplyToRef(C,s)):1==c&&o?(T.G(o.getWorldMatrix()),C.G(T),C.invert(),s.multiplyToRef(T,s),s.multiplyToRef(a,s),s.multiplyToRef(C,s)):s.multiplyToRef(a,s),s.setTranslationFromFloats(q,t,p),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(a,c){const o=i._TmpMats[2];return a.G(this.getAbsoluteMatrix()),c?(a.multiplyToRef(c.getWorldMatrix(),a),s.Matrix.ScalingToRef(c.uc.x,c.uc.y,c.uc.z,o)):s.Matrix.IdentityToRef(o),a.invert(),!isNaN(a.m[0])&&(o.multiplyAtIndex(0,this._scalingDeterminant),a.multiplyToRef(o,a),!0)}Tc(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=s.Hc.Zero();return this.getPositionToRef(a,c,o),o}getPositionToRef(){let a=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const a=this.getLocalMatrix();c.x=a.m[12],c.y=a.m[13],c.z=a.m[14]}else{let o=null;a&&(o=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let s=i._TmpMats[0];a&&o?(s.G(this.getAbsoluteMatrix()),s.multiplyToRef(o,s)):s=this.getAbsoluteMatrix(),c.x=s.m[12],c.y=s.m[13],c.z=s.m[14]}}getAbsolutePosition(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=s.Hc.Zero();return this.getPositionToRef(1,a,c),c}getAbsolutePositionToRef(a,c){this.getPositionToRef(1,a,c)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.ge.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.G(this.ge);const a=this._skeleton.getPoseMatrix();a&&this._absoluteMatrix.multiplyToRef(a,this._absoluteMatrix)}const a=this.children,c=a.length;for(let o=0;o<c;o++)a[o].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}eT(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=s.Hc.Zero();return this.getDirectionToRef(a,c,o),o}getDirectionToRef(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,q=null;c&&(q=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=i._TmpMats[0];t.G(this.getAbsoluteMatrix()),c&&q&&t.multiplyToRef(q,t),s.Hc.TransformNormalToRef(a,t,o),o.normalize()}getRotation(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=s.Hc.Zero();return this.getRotationToRef(a,c,o),o}getRotationToRef(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0;const s=i._TmpQuat;this.getRotationQuaternionToRef(a,c,s),s.toEulerAnglesToRef(o)}getRotationQuaternion(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=s.Quaternion.Identity();return this.getRotationQuaternionToRef(a,c,o),o}getRotationQuaternionToRef(){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),c.G(this._localRotation);else{const o=i._TmpMats[0],s=this.getAbsoluteMatrix();a?s.multiplyToRef(a.getWorldMatrix(),o):o.G(s),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.decompose(void 0,c,void 0)}}getRotationMatrix(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0;const o=s.Matrix.Identity();return this.getRotationMatrixToRef(a,c,o),o}getRotationMatrixToRef(){let a=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(c);else{const o=i._TmpMats[0],s=this.getAbsoluteMatrix();a?s.multiplyToRef(a.getWorldMatrix(),o):o.G(s),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.getRotationMatrixToRef(c)}}getAbsolutePositionFromLocal(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=s.Hc.Zero();return this.getAbsolutePositionFromLocalToRef(a,c,o),o}getAbsolutePositionFromLocalToRef(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,q=null;c&&(q=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=i._TmpMats[0];t.G(this.getAbsoluteMatrix()),c&&q&&t.multiplyToRef(q,t),s.Hc.TransformCoordinatesToRef(a,t,o)}getLocalPositionFromAbsolute(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=s.Hc.Zero();return this.getLocalPositionFromAbsoluteToRef(a,c,o),o}getLocalPositionFromAbsoluteToRef(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,q=null;c&&(q=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=i._TmpMats[0];t.G(this.getAbsoluteMatrix()),c&&q&&t.multiplyToRef(q,t),t.invert(),s.Hc.TransformCoordinatesToRef(a,t,o)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const a=this._skeleton.bones.indexOf(this);if(-1!==a&&this._skeleton.bones.splice(a,1),this._parentNode&&this._parentNode.children){const a=this._parentNode.children,c=a.indexOf(this);-1!==c&&a.splice(c,1)}super.dispose()}}i._TmpVecs=(0,q.b)(2,s.Hc.Zero),i._TmpQuat=s.Quaternion.Identity(),i._TmpMats=(0,q.b)(5,s.Matrix.Identity)},14954:(a,c,o)=>{"use strict";o.d(c,{c:()=>W});var s=o(12798),q=o(12800),t=o(12639),i=o(12810),p=o(12824),G=o(13211),T=o(13241),C=o(13087),j=o(12661),L=o(12812);class e{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(a){this._zoomStopsAnimation=a}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(a){this._idleRotationSpeed=a}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(a){this._idleRotationWaitTime=a}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(a){this._idleRotationSpinupTime=a}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(a){this._attachedCamera=a;const c=this._attachedCamera.Za();this._onPrePointerObservableObserver=c.onPrePointerObservable.add((a=>{a.type!==C.e.POINTERDOWN?a.type===C.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const a=j.b.Now;let c=0;null!=this._lastFrameTime&&(c=a-this._lastFrameTime),this._lastFrameTime=a,this._applyUserInteraction();const o=a-this._lastInteractionTime-this._idleRotationWaitTime,s=Math.max(Math.min(o/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*s,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(c/1e3))}))}detach(){if(!this._attachedCamera)return;const a=this._attachedCamera.Za();this._onPrePointerObservableObserver&&a.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(a){this._lastInteractionTime=a??j.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<L.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let a=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(a=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?a:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=j.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var g=o(14962),M=o(13322);class N{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(a){if(this._autoTransitionRange===a)return;this._autoTransitionRange=a;const c=this._attachedCamera;c&&(a?this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add((a=>{if(a&&(a.Rc(!0),a.getBoundingInfo)){const c=a.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*c,this.upperRadiusTransitionRange=.05*c}})):this._onMeshTargetChangedObserver&&c.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(a){this._attachedCamera=a,this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(a){return!!this._attachedCamera&&(this._attachedCamera.radius===a&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(a){if(!this._attachedCamera)return;this._radiusBounceTransition||(N.EasingFunction.setEasingMode(N.EasingMode),this._radiusBounceTransition=M.b.CreateAnimation("radius",M.b.ANIMATIONTYPE_FLOAT,60,N.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const c=M.b.TransitionTo("radius",this._attachedCamera.radius+a,this._attachedCamera,this._attachedCamera.Za(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));c&&this._animatables.push(c)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}N.EasingFunction=new g.b(.3),N.EasingMode=g.p.EASINGMODE_EASEOUT;class y{constructor(){this.onTargetFramingAnimationEndObservable=new t.d,this._mode=y.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(a){this._mode=a}get mode(){return this._mode}set radiusScale(a){this._radiusScale=a}get radiusScale(){return this._radiusScale}set positionScale(a){this._positionScale=a}get positionScale(){return this._positionScale}set defaultElevation(a){this._defaultElevation=a}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(a){this._elevationReturnTime=a}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(a){this._elevationReturnWaitTime=a}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(a){this._zoomStopsAnimation=a}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(a){this._framingTime=a}get framingTime(){return this._framingTime}init(){}attach(a){this._attachedCamera=a;const c=this._attachedCamera.Za();y.EasingFunction.setEasingMode(y.EasingMode),this._onPrePointerObservableObserver=c.onPrePointerObservable.add((a=>{a.type!==C.e.POINTERDOWN?a.type===C.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=a.onMeshTargetChangedObservable.add((a=>{a&&a.getBoundingInfo&&this.zoomOnMesh(a,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const a=this._attachedCamera.Za();this._onPrePointerObservableObserver&&a.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a.Rc(!0);const s=a.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(s.minimumWorld,s.maximumWorld,c,o)}zoomOnMeshHierarchy(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a.Rc(!0);const s=a.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(s.min,s.max,c,o)}zoomOnMeshesHierarchy(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new i.Hc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),q=new i.Hc(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let t=0;t<a.length;t++){const c=a[t].getHierarchyBoundingVectors(!0);i.Hc.CheckExtends(c.min,s,q),i.Hc.CheckExtends(c.max,s,q)}this.zoomOnBoundingInfo(s,q,c,o)}zoomOnBoundingInfo(a,c){let o,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const t=a.y,p=t+(c.y-t)*this._positionScale,G=c.vc(a).scale(.5);if(!isFinite(p))return!1;if(s)o=new i.Hc(0,p,0);else{const c=a.add(G);o=new i.Hc(c.x,p,c.z)}this._vectorTransition||(this._vectorTransition=M.b.CreateAnimation("target",M.b.ANIMATIONTYPE_VECTOR3,60,y.EasingFunction)),this._betaIsAnimating=!0;let T=M.b.TransitionTo("target",o,this._attachedCamera,this._attachedCamera.Za(),60,this._vectorTransition,this._framingTime);T&&this._animatables.push(T);let C=0;if(this._mode===y.FitFrustumSidesMode){const o=this._calculateLowerRadiusFromModelBoundingSphere(a,c);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=G.length()+this._attachedCamera.rc),C=o}else this._mode===y.IgnoreBoundsSizeMode&&(C=this._calculateLowerRadiusFromModelBoundingSphere(a,c),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.rc));if(this.autoCorrectCameraLimitsAndSensibility){const o=c.vc(a).length();this._attachedCamera.panningSensibility=5e3/o,this._attachedCamera.wheelPrecision=100/C}return this._radiusTransition||(this._radiusTransition=M.b.CreateAnimation("radius",M.b.ANIMATIONTYPE_FLOAT,60,y.EasingFunction)),T=M.b.TransitionTo("radius",C,this._attachedCamera,this._attachedCamera.Za(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),q&&q(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),T&&this._animatables.push(T),!0}_calculateLowerRadiusFromModelBoundingSphere(a,c){const o=this._attachedCamera;if(!o)return 0;let s=o._calculateLowerRadiusFromModelBoundingSphere(a,c,this._radiusScale);return o.lowerRadiusLimit&&this._mode===y.IgnoreBoundsSizeMode&&(s=s<o.lowerRadiusLimit?o.lowerRadiusLimit:s),o.upperRadiusLimit&&(s=s>o.upperRadiusLimit?o.upperRadiusLimit:s),s}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const a=j.b.Now-this._lastInteractionTime,c=.5*Math.PI-this._defaultElevation,o=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>o&&a>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=M.b.CreateAnimation("beta",M.b.ANIMATIONTYPE_FLOAT,60,y.EasingFunction));const a=M.b.TransitionTo("beta",c,this._attachedCamera,this._attachedCamera.Za(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));a&&this._animatables.push(a)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=j.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}y.EasingFunction=new g.u,y.EasingMode=g.p.EASINGMODE_EASEINOUT,y.IgnoreBoundsSizeMode=0,y.FitFrustumSidesMode=1;var k=o(13246),n=o(13278),f=o(14319),J=o(12637);class w{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(a){a=J.Tools.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),o=c.getInputElement();let s=0,q=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=t=>{var i,p;const G=t.event,T="touch"===G.pointerType;if(t.type!==C.e.POINTERMOVE&&-1===this.buttons.indexOf(G.button))return;const j=G.target;if(this._altKey=G.altKey,this._ctrlKey=G.ctrlKey,this._metaKey=G.metaKey,this._shiftKey=G.shiftKey,this._buttonsPressed=G.buttons,c.isPointerLock){const a=G.movementX,c=G.movementY;this.onTouch(null,a,c),this._pointA=null,this._pointB=null}else{if(t.type!==C.e.POINTERDOWN&&t.type!==C.e.POINTERDOUBLETAP&&T&&(null===(i=this._pointA)||void 0===i?void 0:i.pointerId)!==G.pointerId&&(null===(p=this._pointB)||void 0===p?void 0:p.pointerId)!==G.pointerId)return;if(t.type!==C.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!T)if(t.type===C.e.POINTERDOUBLETAP)this.onDoubleTap(G.pointerType);else if(t.type!==C.e.POINTERUP||this._currentMousePointerIdDown!==G.pointerId&&!T){if(t.type===C.e.POINTERMOVE)if(a||G.preventDefault(),this._pointA&&null===this._pointB){const a=G.clientX-this._pointA.x,c=G.clientY-this._pointA.y;this._pointA.x=G.clientX,this._pointA.y=G.clientY,this.onTouch(this._pointA,a,c)}else if(this._pointA&&this._pointB){const a=this._pointA.pointerId===G.pointerId?this._pointA:this._pointB;a.x=G.clientX,a.y=G.clientY;const c=this._pointA.x-this._pointB.x,o=this._pointA.y-this._pointB.y,i=c*c+o*o,p={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:G.pointerId,type:t.type};this.onMultiTouch(this._pointA,this._pointB,s,i,q,p),q=p,s=i}}else{try{null===j||void 0===j||j.releasePointerCapture(G.pointerId)}catch(L){}T||(this._pointB=null),c._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==G.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==G.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==s||q)&&(this.onMultiTouch(this._pointA,this._pointB,s,0,q,null),s=0,q=null),this._currentMousePointerIdDown=-1,this.onButtonUp(G),a||G.preventDefault()}else{try{null===j||void 0===j||j.setPointerCapture(G.pointerId)}catch(L){}if(null===this._pointA)this._pointA={x:G.clientX,y:G.clientY,pointerId:G.pointerId,type:G.pointerType};else{if(null!==this._pointB)return;this._pointB={x:G.clientX,y:G.clientY,pointerId:G.pointerId,type:G.pointerType}}-1!==this._currentMousePointerIdDown||T||(this._currentMousePointerIdDown=G.pointerId),this.onButtonDown(G),a||(G.preventDefault(),o&&o.focus())}}},this._observer=this.camera.Za()._inputManager._addCameraPointerObserver(this._pointerInput,C.e.POINTERDOWN|C.e.POINTERUP|C.e.POINTERMOVE|C.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,s=0,q=null,this.onLostFocus()},this._contextMenuBind=a=>this.onContextMenu(a),o&&o.addEventListener("contextmenu",this._contextMenuBind,!1);const t=this.camera.Za().getEngine().getHostWindow();t&&J.Tools.RegisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}nL(){if(this._onLostFocus){const a=this.camera.Za().getEngine().getHostWindow();a&&J.Tools.UnregisterTopRootEvents(a,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Za()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const a=this.camera.Za().getEngine().getInputElement();a&&a.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(a){}onTouch(a,c,o){}onMultiTouch(a,c,o,s,q,t){}onContextMenu(a){a.preventDefault()}onButtonDown(a){}onButtonUp(a){}onLostFocus(){}}(0,s.d)([(0,q.E)()],w.prototype,"buttons",void 0);class Z extends w{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(a,c){if(0!==this.panningSensibility&&a&&c){const o=c.x-a.x,s=c.y-a.y;this.camera.inertialPanningX+=-o/this.panningSensibility,this.camera.inertialPanningY+=s/this.panningSensibility}}_computePinchZoom(a,c){const o=this.camera.radius||Z.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=o*Math.sqrt(a)/Math.sqrt(c):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(c-a)*o*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(c-a)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(a,c,o){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-c/this.panningSensibility,this.camera.inertialPanningY+=o/this.panningSensibility):(this.camera.inertialAlphaOffset-=c/this.angularSensibilityX,this.camera.inertialBetaOffset-=o/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(a,c,o,s,q,t){0===o&&null===q||0===s&&null===t||(this.multiTouchPanAndZoom?(this._computePinchZoom(o,s),this._computeMultiTouchPanning(q,t)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(s)-Math.sqrt(o))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(o,s),this._isPinching=!0):this._computeMultiTouchPanning(q,t)):this.multiTouchPanning?this._computeMultiTouchPanning(q,t):this.pinchZoom&&this._computePinchZoom(o,s))}onButtonDown(a){this._isPanClick=a.button===this.camera._panningMouseButton}onButtonUp(a){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Z.MinimumRadiusForPinch=.001,(0,s.d)([(0,q.E)()],Z.prototype,"buttons",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"angularSensibilityX",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"angularSensibilityY",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"pinchPrecision",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"pinchDeltaPercentage",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"useNaturalPinchZoom",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"pinchZoom",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"panningSensibility",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"multiTouchPanning",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"multiTouchPanAndZoom",void 0),f.c.ArcRotateCameraPointersInput=Z;var h=o(13092);class U{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(a){a=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Za(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const o=c.event;if(!o.metaKey)if(c.type===h.d.KEYDOWN){if(this._ctrlPressed=o.ctrlKey,this._altPressed=o.altKey,-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysReset.indexOf(o.keyCode)){-1===this._keys.indexOf(o.keyCode)&&this._keys.push(o.keyCode),o.preventDefault&&(a||o.preventDefault())}}else if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysReset.indexOf(o.keyCode)){const c=this._keys.indexOf(o.keyCode);c>=0&&this._keys.splice(c,1),o.preventDefault&&(a||o.preventDefault())}})))}nL(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const a=this.camera;for(let c=0;c<this._keys.length;c++){const o=this._keys[c];-1!==this.keysLeft.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningX-=1/this.panningSensibility:a.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?a.inertialRadiusOffset+=1/this.zoomingSensibility:a.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningX+=1/this.panningSensibility:a.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?a.inertialRadiusOffset-=1/this.zoomingSensibility:a.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(o)&&a.useInputToRestoreState&&a.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,s.d)([(0,q.E)()],U.prototype,"keysUp",void 0),(0,s.d)([(0,q.E)()],U.prototype,"keysDown",void 0),(0,s.d)([(0,q.E)()],U.prototype,"keysLeft",void 0),(0,s.d)([(0,q.E)()],U.prototype,"keysRight",void 0),(0,s.d)([(0,q.E)()],U.prototype,"keysReset",void 0),(0,s.d)([(0,q.E)()],U.prototype,"panningSensibility",void 0),(0,s.d)([(0,q.E)()],U.prototype,"zoomingSensibility",void 0),(0,s.d)([(0,q.E)()],U.prototype,"useAltToZoom",void 0),(0,s.d)([(0,q.E)()],U.prototype,"angularSpeed",void 0),f.c.ArcRotateCameraKeyboardMoveInput=U;var S=o(12862),r=o(13099);class x{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new i.Hc(0,0,0),this._globalOffset=new i.Hc(0,0,0),this._inertialPanning=i.Hc.Zero()}_computeDeltaFromMouseWheelLegacyEvent(a,c){let o=0;const s=.01*a*this.wheelDeltaPercentage*c;return o=a>0?s/(1+this.wheelDeltaPercentage):s*(1+this.wheelDeltaPercentage),o}attachControl(a){a=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==C.e.POINTERWHEEL)return;const o=c.event;let s=0;const q=o.deltaMode===r.d.DOM_DELTA_LINE?40:1,t=-o.deltaY*q;if(this.customComputeDeltaFromMouseWheel)s=this.customComputeDeltaFromMouseWheel(t,this,o);else if(this.wheelDeltaPercentage){if(s=this._computeDeltaFromMouseWheelLegacyEvent(t,this.camera.radius),s>0){let a=this.camera.radius,c=this.camera.inertialRadiusOffset+s;for(let o=0;o<20&&!(a<=c)&&!(Math.abs(c*this.camera.inertia)<.001);o++)a-=c,c*=this.camera.inertia;a=(0,p.Clamp)(a,0,Number.MAX_VALUE),s=this._computeDeltaFromMouseWheelLegacyEvent(t,a)}}else s=t/(40*this.wheelPrecision);s&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(s)):this.camera.inertialRadiusOffset+=s),o.preventDefault&&(a||o.preventDefault())},this._observer=this.camera.Za()._inputManager._addCameraPointerObserver(this._wheel,C.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Dc(0)}nL(){this._observer&&(this.camera.Za()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const a=this.camera;0+a.inertialAlphaOffset+a.inertialBetaOffset+a.inertialRadiusOffset&&(this._updateHitPlane(),a.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(a.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const a=this.camera,c=a.target.vc(a.position);this._hitPlane=S.e.FromPositionAndNormal(a.target,c)}_getPosition(){const a=this.camera,c=a.Za(),o=c.createPickingRay(c.pointerX,c.pointerY,i.Matrix.Identity(),a,!1);0===a.targetScreenOffset.x&&0===a.targetScreenOffset.y||(this._viewOffset.set(a.targetScreenOffset.x,a.targetScreenOffset.y,0),a.getViewMatrix().invertToRef(a._cameraTransformMatrix),this._globalOffset=i.Hc.TransformNormal(this._viewOffset,a._cameraTransformMatrix),o.origin.addInPlace(this._globalOffset));let s=0;return this._hitPlane&&(s=o.intersectsPlane(this._hitPlane)??0),o.origin.addInPlace(o.direction.scaleInPlace(s))}_zoomToMouse(a){const c=this.camera,o=1-c.inertia;if(c.lowerRadiusLimit){const s=c.lowerRadiusLimit??0;c.radius-(c.inertialRadiusOffset+a)/o<s&&(a=(c.radius-s)*o-c.inertialRadiusOffset)}if(c.upperRadiusLimit){const s=c.upperRadiusLimit??0;c.radius-(c.inertialRadiusOffset+a)/o>s&&(a=(c.radius-s)*o-c.inertialRadiusOffset)}const s=a/o/c.radius,q=this._getPosition(),t=i.TmpVectors.Hc[6];q.subtractToRef(c.target,t),t.scaleInPlace(s),t.scaleInPlace(o),this._inertialPanning.addInPlace(t),c.inertialRadiusOffset+=a}_zeroIfClose(a){Math.abs(a.x)<L.b&&(a.x=0),Math.abs(a.y)<L.b&&(a.y=0),Math.abs(a.z)<L.b&&(a.z=0)}}(0,s.d)([(0,q.E)()],x.prototype,"wheelPrecision",void 0),(0,s.d)([(0,q.E)()],x.prototype,"zoomToMouseLocation",void 0),(0,s.d)([(0,q.E)()],x.prototype,"wheelDeltaPercentage",void 0),f.c.ArcRotateCameraMouseWheelInput=x;class R extends f.g{constructor(a){super(a)}addMouseWheel(){return this.add(new x),this}addPointers(){return this.add(new Z),this}addKeyboard(){return this.add(new U),this}}var d=o(12776);function X(a,c){return isNaN(a)?c:a}G.b.AddNodeConstructor("ArcRotateCamera",((a,c)=>()=>new W(a,0,0,1,i.Hc.Zero(),c)));class W extends n.b{get target(){return this._target}set target(a){this.setTarget(a)}get targetHost(){return this._targetHost}set targetHost(a){a&&this.setTarget(a)}getTarget(){return this.target}get position(){return this._position}set position(a){this.setPosition(a)}set upVector(a){this._upToYMatrix||(this._yToUpMatrix=new i.Matrix,this._upToYMatrix=new i.Matrix,this._upVector=i.Hc.Zero()),a.normalize(),this._upVector.G(a),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){i.Matrix.RotationAlignToRef(i.Hc.UpReadOnly,this._upVector,this._yToUpMatrix),i.Matrix.RotationAlignToRef(this._upVector,i.Hc.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const a=this.inputs.attached.pointers;return a?a.angularSensibilityX:0}set angularSensibilityX(a){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=a)}get angularSensibilityY(){const a=this.inputs.attached.pointers;return a?a.angularSensibilityY:0}set angularSensibilityY(a){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=a)}get pinchPrecision(){const a=this.inputs.attached.pointers;return a?a.pinchPrecision:0}set pinchPrecision(a){const c=this.inputs.attached.pointers;c&&(c.pinchPrecision=a)}get pinchDeltaPercentage(){const a=this.inputs.attached.pointers;return a?a.pinchDeltaPercentage:0}set pinchDeltaPercentage(a){const c=this.inputs.attached.pointers;c&&(c.pinchDeltaPercentage=a)}get useNaturalPinchZoom(){const a=this.inputs.attached.pointers;return!!a&&a.useNaturalPinchZoom}set useNaturalPinchZoom(a){const c=this.inputs.attached.pointers;c&&(c.useNaturalPinchZoom=a)}get panningSensibility(){const a=this.inputs.attached.pointers;return a?a.panningSensibility:0}set panningSensibility(a){const c=this.inputs.attached.pointers;c&&(c.panningSensibility=a)}get keysUp(){const a=this.inputs.attached.keyboard;return a?a.keysUp:[]}set keysUp(a){const c=this.inputs.attached.keyboard;c&&(c.keysUp=a)}get keysDown(){const a=this.inputs.attached.keyboard;return a?a.keysDown:[]}set keysDown(a){const c=this.inputs.attached.keyboard;c&&(c.keysDown=a)}get keysLeft(){const a=this.inputs.attached.keyboard;return a?a.keysLeft:[]}set keysLeft(a){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=a)}get keysRight(){const a=this.inputs.attached.keyboard;return a?a.keysRight:[]}set keysRight(a){const c=this.inputs.attached.keyboard;c&&(c.keysRight=a)}get wheelPrecision(){const a=this.inputs.attached.mousewheel;return a?a.wheelPrecision:0}set wheelPrecision(a){const c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=a)}get zoomToMouseLocation(){const a=this.inputs.attached.mousewheel;return!!a&&a.zoomToMouseLocation}set zoomToMouseLocation(a){const c=this.inputs.attached.mousewheel;c&&(c.zoomToMouseLocation=a)}get wheelDeltaPercentage(){const a=this.inputs.attached.mousewheel;return a?a.wheelDeltaPercentage:0}set wheelDeltaPercentage(a){const c=this.inputs.attached.mousewheel;c&&(c.wheelDeltaPercentage=a)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(a){a!==this.useBouncingBehavior&&(a?(this._bouncingBehavior=new N,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(a){a!==this.useFramingBehavior&&(a?(this._framingBehavior=new y,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(a){a!==this.useAutoRotationBehavior&&(a?(this._autoRotationBehavior=new e,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(a,c,o,s,q,p){var G;let T=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(a,i.Hc.Zero(),p,T),G=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=i.Hc.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=i.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new i.Matrix,this.panningAxis=new i.Hc(1,1,0),this._transformedDirection=new i.Hc,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new t.d,this.checkCollisions=!1,this.collisionRadius=new i.Hc(.5,.5,.5),this._previousPosition=i.Hc.Zero(),this._collisionVelocity=i.Hc.Zero(),this._newPosition=i.Hc.Zero(),this._computationVector=i.Hc.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new i.Hc(NaN,NaN,NaN),this._goalTargetScreenOffset=new i.Vector2(NaN,NaN),this._onCollisionPositionChange=function(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o?(G.setPosition(c),G.xg&&G.xg(o)):G._previousPosition.G(G._position);const s=Math.cos(G.alpha),q=Math.sin(G.alpha),t=Math.cos(G.beta);let i=Math.sin(G.beta);0===i&&(i=1e-4);const p=G._getTargetPosition();G._computationVector.Bc(G.radius*s*i,G.radius*t,G.radius*q*i),p.addToRef(G._computationVector,G._newPosition),G._position.G(G._newPosition);let T=G.upVector;G.allowUpsideDown&&G.beta<0&&(T=T.clone(),T=T.negate()),G._computeViewMatrix(G._position,p,T),G._viewMatrix.addAtIndex(12,G.targetScreenOffset.x),G._viewMatrix.addAtIndex(13,G.targetScreenOffset.y),G._collisionTriggered=!1},this._target=i.Hc.Zero(),q&&this.setTarget(q),this.alpha=c,this.beta=o,this.radius=s,this.getViewMatrix(),this.inputs=new R(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new i.Hc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=i.Vector2.Zero()}_updateCache(a){a||super._updateCache(),this._cache._target.G(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.G(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const a=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?a.addToRef(this._targetBoundingCenter,this._target):this._target.G(a)}const a=this._getLockedTargetPosition();return a||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>L.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,t=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=t?this._currentInterpolationFactor=t:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=X(a,this._goalAlpha),this._goalBeta=X(c,this._goalBeta),this._goalRadius=X(o,this._goalRadius),this._goalTarget.set(X(s.x,this._goalTarget.x),X(s.y,this._goalTarget.y),X(s.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(X(q.x,this._goalTargetScreenOffset.x),X(q.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,p.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,p.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,p.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,p.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(a,c){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const q=arguments;c=J.Tools.BackCompatCameraNoPreventDefault(q),this._useCtrlForPanning=o,this._panningMouseButton=s,"boolean"===typeof q[0]&&(q.length>1&&(this._useCtrlForPanning=q[1]),q.length>2&&(this._panningMouseButton=q[2])),this.inputs.attachElement(c),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}nL(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let a=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){a=!0;const c=this.invertRotation?-1:1,o=this._calculateHandednessMultiplier();let s=this.inertialAlphaOffset*o;this.beta<0&&(s*=-1),this.alpha+=s*c,this.beta+=this.inertialBetaOffset*c,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<L.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<L.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*L.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){a=!0;const c=new i.Hc(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),c.multiplyInPlace(this.panningAxis),i.Hc.TransformNormalToRef(c,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const a=this.upVector,c=i.Hc.CrossToRef(this._transformedDirection,a,this._transformedDirection);i.Hc.CrossToRef(a,c,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);i.Hc.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.G(this._transformedDirection)}else{if(this.parent){const a=i.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(a),a.transposeToRef(a),i.Hc.TransformCoordinatesToRef(this._transformedDirection,a,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*L.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*L.b&&(this.inertialPanningY=0)}if(a)this.stopInterpolation();else if(this._isInterpolating){let a=!1;const c=this._scene.getEngine().getDeltaTime()/1e3,o=1-Math.pow(2,-c/this._currentInterpolationFactor),s=X(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const c=i.TmpVectors.Hc[0].set(X(this._goalTarget.x,this._target.x),X(this._goalTarget.y,this._target.y),X(this._goalTarget.z,this._target.z));i.Hc.LerpToRef(this.target,c,o,this._target),10*i.Hc.Distance(this.target,c)/s<L.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.G(c),this.setTarget(this.target,!1,!0,!0)):a=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const c=i.Quaternion.RotationAlphaBetaGammaToRef(X(this._goalAlpha,this.alpha),X(this._goalBeta,this.beta),0,i.TmpVectors.Quaternion[0]),s=i.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,i.TmpVectors.Quaternion[1]),q=i.Quaternion.SlerpToRef(s,c,o,i.TmpVectors.Quaternion[2]);q.normalize();const t=q.toAlphaBetaGammaToRef(i.TmpVectors.Hc[0]);if(this.alpha=t.x,this.beta=t.y,q.isApprox(c,L.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const a=c.toAlphaBetaGammaToRef(i.TmpVectors.Hc[0]);this.alpha=a.x,this.beta=a.y}else a=!0}if(isNaN(this._goalRadius)||(this.radius+=(s-this.radius)*o,Math.abs(s/this.radius-1)<L.b?(this._goalRadius=NaN,this.radius=s):a=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const c=i.TmpVectors.Vector2[0].set(X(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),X(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));i.Vector2.LerpToRef(this.targetScreenOffset,c,o,this.targetScreenOffset),i.Vector2.Distance(this.targetScreenOffset,c)<L.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.G(c)):a=!0}this._isInterpolating=a}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||i.Hc.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const a=this.alpha;var c,o;this.alpha=function(a){let c=Math.PI/2;return 0===a.x&&0===a.z||(c=Math.acos(a.x/Math.sqrt(Math.pow(a.x,2)+Math.pow(a.z,2)))),a.z<0&&(c=2*Math.PI-c),c}(this._computationVector),this.beta=(c=this._computationVector.y,o=this.radius,Math.acos(c/o));const s=Math.round((a-this.alpha)/(2*Math.PI));this.alpha+=2*s*Math.PI,this._checkLimits()}setPosition(a){this._position.equals(a)||(this._position.G(a),this.rebuildAnglesAndRadius())}setTarget(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(s=this.overrideCloneAlphaBetaRadius??s,a.Rc)c&&a.getBoundingInfo?this._targetBoundingCenter=a.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,a.Rc(),this._targetHost=a,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const c=a,s=this._getTargetPosition();if(s&&!o&&s.equals(c))return;this._targetHost=null,this._target=c,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}s||this.rebuildAnglesAndRadius()}_getViewMatrix(){const a=Math.cos(this.alpha),c=Math.sin(this.alpha),o=Math.cos(this.beta);let s=Math.sin(this.beta);0===s&&(s=1e-4),0===this.radius&&(this.radius=1e-4);const q=this._getTargetPosition();if(this._computationVector.Bc(this.radius*a*s,this.radius*o,this.radius*c*s),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||i.Hc.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),q.addToRef(this._computationVector,this._newPosition),this.Za().collisionsEnabled&&this.checkCollisions){const a=this.Za().collisionCoordinator;this._collider||(this._collider=a.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,a.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.G(this._newPosition);let a=this.upVector;this.allowUpsideDown&&s<0&&(a=a.negate()),this._computeViewMatrix(this._position,q,a),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.G(q),this._viewMatrix}zoomOn(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a=a||this.Za().meshes;const o=T.c.MinMax(a);let s=this._calculateLowerRadiusFromModelBoundingSphere(o.min,o.max);if(s=Math.max(Math.min(s,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=s*this.zoomOnFactor,this.mode===k.b.ORTHOGRAPHIC_CAMERA){const a=this.Za().getEngine().getAspectRatio(this),c=s*this.zoomOnFactor/2;this.orthoLeft=-c*a,this.orthoRight=c*a,this.orthoBottom=-c,this.orthoTop=c}this.focusOn({min:o.min,max:o.max,distance:s},c)}focusOn(a){let c,o,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===a.min){const s=a||this.Za().meshes;c=T.c.MinMax(s),o=i.Hc.Distance(c.min,c.max)}else{c=a,o=a.distance}this._target=T.c.Center(c),s||(this.maxZ=2*o)}createRigCamera(a,c){let o=0;switch(this.cameraRigMode){case k.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case k.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case k.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case k.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case k.b.RIG_MODE_VR:o=this._cameraRigParams.stereoHalfAngle*(0===c?1:-1);break;case k.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:o=this._cameraRigParams.stereoHalfAngle*(0===c?-1:1)}const s=new W(a,this.alpha+o,this.beta,this.radius,this._target,this.Za());return s._cameraRigParams={},s.isRigCamera=!0,s.rigParent=this,s.upVector=this.upVector,s.mode=this.mode,s.orthoLeft=this.orthoLeft,s.orthoRight=this.orthoRight,s.orthoBottom=this.orthoBottom,s.orthoTop=this.orthoTop,s}_updateRigCameras(){const a=this._rigCameras[0],c=this._rigCameras[1];switch(a.beta=c.beta=this.beta,this.cameraRigMode){case k.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case k.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case k.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case k.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case k.b.RIG_MODE_VR:a.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case k.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:a.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const s=i.Hc.Distance(a,c),q=this.Za().getEngine().getAspectRatio(this),t=Math.tan(this.fov/2),p=t*q,G=.5*s*o,T=G*Math.sqrt(1+1/(p*p)),C=G*Math.sqrt(1+1/(t*t));return Math.max(T,C)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,s.d)([(0,q.E)()],W.prototype,"alpha",void 0),(0,s.d)([(0,q.E)()],W.prototype,"beta",void 0),(0,s.d)([(0,q.E)()],W.prototype,"radius",void 0),(0,s.d)([(0,q.E)()],W.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,s.d)([(0,q.B)("target")],W.prototype,"_target",void 0),(0,s.d)([(0,q.t)("targetHost")],W.prototype,"_targetHost",void 0),(0,s.d)([(0,q.E)()],W.prototype,"inertialAlphaOffset",void 0),(0,s.d)([(0,q.E)()],W.prototype,"inertialBetaOffset",void 0),(0,s.d)([(0,q.E)()],W.prototype,"inertialRadiusOffset",void 0),(0,s.d)([(0,q.E)()],W.prototype,"lowerAlphaLimit",void 0),(0,s.d)([(0,q.E)()],W.prototype,"upperAlphaLimit",void 0),(0,s.d)([(0,q.E)()],W.prototype,"lowerBetaLimit",void 0),(0,s.d)([(0,q.E)()],W.prototype,"upperBetaLimit",void 0),(0,s.d)([(0,q.E)()],W.prototype,"lowerRadiusLimit",void 0),(0,s.d)([(0,q.E)()],W.prototype,"upperRadiusLimit",void 0),(0,s.d)([(0,q.E)()],W.prototype,"lowerTargetYLimit",void 0),(0,s.d)([(0,q.E)()],W.prototype,"inertialPanningX",void 0),(0,s.d)([(0,q.E)()],W.prototype,"inertialPanningY",void 0),(0,s.d)([(0,q.E)()],W.prototype,"pinchToPanMaxDistance",void 0),(0,s.d)([(0,q.E)()],W.prototype,"panningDistanceLimit",void 0),(0,s.d)([(0,q.B)()],W.prototype,"panningOriginTarget",void 0),(0,s.d)([(0,q.E)()],W.prototype,"panningInertia",void 0),(0,s.d)([(0,q.E)()],W.prototype,"zoomToMouseLocation",null),(0,s.d)([(0,q.E)()],W.prototype,"zoomOnFactor",void 0),(0,s.d)([(0,q.x)()],W.prototype,"targetScreenOffset",void 0),(0,s.d)([(0,q.E)()],W.prototype,"allowUpsideDown",void 0),(0,s.d)([(0,q.E)()],W.prototype,"useInputToRestoreState",void 0),(0,s.d)([(0,q.E)()],W.prototype,"restoreStateInterpolationFactor",void 0),(0,d.d)("BABYLON.ArcRotateCamera",W)},14319:(a,c,o)=>{"use strict";o.d(c,{c:()=>i,g:()=>p});var s=o(12649),q=o(12845),t=o(13246),i={};class p{constructor(a){this.attachedToElement=!1,this.attached={},this.camera=a,this.checkInputs=()=>{}}add(a){const c=a.getSimpleName();this.attached[c]?s.c.Warn("camera input of type "+c+" already exists on camera"):(this.attached[c]=a,a.camera=this.camera,a.checkInputs&&(this.checkInputs=this._addCheckInputs(a.checkInputs.bind(a))),this.attachedToElement&&a.attachControl(this.noPreventDefault))}remove(a){for(const c in this.attached){const o=this.attached[c];if(o===a)return o.nL(),o.camera=null,delete this.attached[c],void this.rebuildInputCheck()}}removeByType(a){for(const c in this.attached){const o=this.attached[c];o.getClassName()===a&&(o.nL(),o.camera=null,delete this.attached[c],this.rebuildInputCheck())}}_addCheckInputs(a){const c=this.checkInputs;return()=>{c(),a()}}attachInput(a){this.attachedToElement&&a.attachControl(this.noPreventDefault)}attachElement(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){a=!t.b.ForceAttachControlToAlwaysPreventDefault&&a,this.attachedToElement=!0,this.noPreventDefault=a;for(const c in this.attached)this.attached[c].attachControl(a)}}detachElement(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const c in this.attached)this.attached[c].nL(),a&&(this.attached[c].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const a in this.attached){const c=this.attached[a];c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(a){const c={};for(const o in this.attached){const a=this.attached[o],s=q.d.Serialize(a);c[a.getClassName()]=s}a.inputsmgr=c}parse(a){const c=a.inputsmgr;if(c){this.clear();for(const a in c){const o=i[a];if(o){const s=c[a],t=q.d.Parse((()=>new o),s,null);this.add(t)}}}else for(const o in this.attached){const c=i[this.attached[o].getClassName()];if(c){const s=q.d.Parse((()=>new c),a,null);this.remove(this.attached[o]),this.add(s)}}}}},14310:(a,c,o)=>{"use strict";o.d(c,{e:()=>w});var s=o(12798),q=o(12800),t=o(12810),i=o(13278),p=o(14319),G=o(13092),T=o(12637);class C{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(a){a=T.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Za(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const o=c.event;if(!o.metaKey)if(c.type===G.d.KEYDOWN){if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysUpward.indexOf(o.keyCode)||-1!==this.keysDownward.indexOf(o.keyCode)||-1!==this.keysRotateLeft.indexOf(o.keyCode)||-1!==this.keysRotateRight.indexOf(o.keyCode)||-1!==this.keysRotateUp.indexOf(o.keyCode)||-1!==this.keysRotateDown.indexOf(o.keyCode)){-1===this._keys.indexOf(o.keyCode)&&this._keys.push(o.keyCode),a||o.preventDefault()}}else if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysUpward.indexOf(o.keyCode)||-1!==this.keysDownward.indexOf(o.keyCode)||-1!==this.keysRotateLeft.indexOf(o.keyCode)||-1!==this.keysRotateRight.indexOf(o.keyCode)||-1!==this.keysRotateUp.indexOf(o.keyCode)||-1!==this.keysRotateDown.indexOf(o.keyCode)){const c=this._keys.indexOf(o.keyCode);c>=0&&this._keys.splice(c,1),a||o.preventDefault()}})))}nL(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const a=this.camera;for(let c=0;c<this._keys.length;c++){const o=this._keys[c],s=a._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(o)?a._localDirection.Bc(-s,0,0):-1!==this.keysUp.indexOf(o)?a._localDirection.Bc(0,0,s):-1!==this.keysRight.indexOf(o)?a._localDirection.Bc(s,0,0):-1!==this.keysDown.indexOf(o)?a._localDirection.Bc(0,0,-s):-1!==this.keysUpward.indexOf(o)?a._localDirection.Bc(0,s,0):-1!==this.keysDownward.indexOf(o)?a._localDirection.Bc(0,-s,0):-1!==this.keysRotateLeft.indexOf(o)?(a._localDirection.Bc(0,0,0),a.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(o)?(a._localDirection.Bc(0,0,0),a.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(o)?(a._localDirection.Bc(0,0,0),a.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(o)&&(a._localDirection.Bc(0,0,0),a.cameraRotation.x+=this._getLocalRotation()),a.Za().useRightHandedSystem&&(a._localDirection.z*=-1),a.getViewMatrix().invertToRef(a._cameraTransformMatrix),t.Hc.TransformNormalToRef(a._localDirection,a._cameraTransformMatrix,a._transformedDirection),a.cameraDirection.addInPlace(a._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const a=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*a}}(0,s.d)([(0,q.E)()],C.prototype,"keysUp",void 0),(0,s.d)([(0,q.E)()],C.prototype,"keysUpward",void 0),(0,s.d)([(0,q.E)()],C.prototype,"keysDown",void 0),(0,s.d)([(0,q.E)()],C.prototype,"keysDownward",void 0),(0,s.d)([(0,q.E)()],C.prototype,"keysLeft",void 0),(0,s.d)([(0,q.E)()],C.prototype,"keysRight",void 0),(0,s.d)([(0,q.E)()],C.prototype,"rotationSpeed",void 0),(0,s.d)([(0,q.E)()],C.prototype,"keysRotateLeft",void 0),(0,s.d)([(0,q.E)()],C.prototype,"keysRotateRight",void 0),(0,s.d)([(0,q.E)()],C.prototype,"keysRotateUp",void 0),(0,s.d)([(0,q.E)()],C.prototype,"keysRotateDown",void 0),p.c.FreeCameraKeyboardMoveInput=C;var j=o(12639),L=o(13087);class e{constructor(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=a,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new j.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(a){a=T.Tools.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),o=c.getInputElement();this._pointerInput||(this._pointerInput=s=>{const q=s.event,t="touch"===q.pointerType;if(!this.touchEnabled&&t)return;if(s.type!==L.e.POINTERMOVE&&-1===this.buttons.indexOf(q.button))return;const i=q.target;if(s.type===L.e.POINTERDOWN){if(t&&-1!==this._activePointerId||!t&&-1!==this._currentActiveButton)return;this._activePointerId=q.pointerId;try{null===i||void 0===i||i.setPointerCapture(q.pointerId)}catch(p){}-1===this._currentActiveButton&&(this._currentActiveButton=q.button),this._previousPosition={x:q.clientX,y:q.clientY},a||(q.preventDefault(),o&&o.focus()),c.isPointerLock&&this._onMouseMove&&this._onMouseMove(s.event)}else if(s.type===L.e.POINTERUP){if(t&&this._activePointerId!==q.pointerId||!t&&this._currentActiveButton!==q.button)return;try{null===i||void 0===i||i.releasePointerCapture(q.pointerId)}catch(p){}this._currentActiveButton=-1,this._previousPosition=null,a||q.preventDefault(),this._activePointerId=-1}else if(s.type===L.e.POINTERMOVE&&(this._activePointerId===q.pointerId||!t))if(c.isPointerLock&&this._onMouseMove)this._onMouseMove(s.event);else if(this._previousPosition){const c=this.camera._calculateHandednessMultiplier(),o=(q.clientX-this._previousPosition.x)*c,s=q.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=o/this.angularSensibility,this.camera.cameraRotation.x+=s/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:o,offsetY:s}),this._previousPosition={x:q.clientX,y:q.clientY},a||q.preventDefault()}}),this._onMouseMove=o=>{if(!c.isPointerLock)return;const s=this.camera._calculateHandednessMultiplier(),q=o.movementX*s;this.camera.cameraRotation.y+=q/this.angularSensibility;const t=o.movementY;this.camera.cameraRotation.x+=t/this.angularSensibility,this._previousPosition=null,a||o.preventDefault()},this._observer=this.camera.Za()._inputManager._addCameraPointerObserver(this._pointerInput,L.e.POINTERDOWN|L.e.POINTERUP|L.e.POINTERMOVE),o&&(this._contextMenuBind=a=>this.onContextMenu(a),o.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(a){a.preventDefault()}nL(){if(this._observer){if(this.camera.Za()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const a=this.camera.getEngine().getInputElement();a&&a.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,s.d)([(0,q.E)()],e.prototype,"buttons",void 0),(0,s.d)([(0,q.E)()],e.prototype,"angularSensibility",void 0),p.c.FreeCameraMouseInput=e;var g,M=o(13099);class N{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new j.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(a){a=T.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==L.e.POINTERWHEEL)return;const o=c.event,s=o.deltaMode===M.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*s*o.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*s*o.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*s*o.deltaZ/this._normalize,o.preventDefault&&(a||o.preventDefault())},this._observer=this.camera.Za()._inputManager._addCameraPointerObserver(this._wheel,L.e.POINTERWHEEL)}nL(){this._observer&&(this.camera.Za()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,s.d)([(0,q.E)()],N.prototype,"wheelPrecisionX",void 0),(0,s.d)([(0,q.E)()],N.prototype,"wheelPrecisionY",void 0),(0,s.d)([(0,q.E)()],N.prototype,"wheelPrecisionZ",void 0),function(a){a[a.MoveRelative=0]="MoveRelative",a[a.RotateRelative=1]="RotateRelative",a[a.MoveScene=2]="MoveScene"}(g||(g={}));class y extends N{constructor(){super(...arguments),this._moveRelative=t.Hc.Zero(),this._rotateRelative=t.Hc.Zero(),this._moveScene=t.Hc.Zero(),this._wheelXAction=g.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=g.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(a){null===a&&this._wheelXAction!==g.MoveRelative||(this._wheelXAction=g.MoveRelative,this._wheelXActionCoordinate=a)}get wheelXMoveRelative(){return this._wheelXAction!==g.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(a){null===a&&this._wheelYAction!==g.MoveRelative||(this._wheelYAction=g.MoveRelative,this._wheelYActionCoordinate=a)}get wheelYMoveRelative(){return this._wheelYAction!==g.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(a){null===a&&this._wheelZAction!==g.MoveRelative||(this._wheelZAction=g.MoveRelative,this._wheelZActionCoordinate=a)}get wheelZMoveRelative(){return this._wheelZAction!==g.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(a){null===a&&this._wheelXAction!==g.RotateRelative||(this._wheelXAction=g.RotateRelative,this._wheelXActionCoordinate=a)}get wheelXRotateRelative(){return this._wheelXAction!==g.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(a){null===a&&this._wheelYAction!==g.RotateRelative||(this._wheelYAction=g.RotateRelative,this._wheelYActionCoordinate=a)}get wheelYRotateRelative(){return this._wheelYAction!==g.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(a){null===a&&this._wheelZAction!==g.RotateRelative||(this._wheelZAction=g.RotateRelative,this._wheelZActionCoordinate=a)}get wheelZRotateRelative(){return this._wheelZAction!==g.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(a){null===a&&this._wheelXAction!==g.MoveScene||(this._wheelXAction=g.MoveScene,this._wheelXActionCoordinate=a)}get wheelXMoveScene(){return this._wheelXAction!==g.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(a){null===a&&this._wheelYAction!==g.MoveScene||(this._wheelYAction=g.MoveScene,this._wheelYActionCoordinate=a)}get wheelYMoveScene(){return this._wheelYAction!==g.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(a){null===a&&this._wheelZAction!==g.MoveScene||(this._wheelZAction=g.MoveScene,this._wheelZActionCoordinate=a)}get wheelZMoveScene(){return this._wheelZAction!==g.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Dc(0),this._rotateRelative.Dc(0),this._moveScene.Dc(0),this._updateCamera(),this.camera.Za().useRightHandedSystem&&(this._moveRelative.z*=-1);const a=t.Matrix.Zero();this.camera.getViewMatrix().invertToRef(a);const c=t.Hc.Zero();t.Hc.TransformNormalToRef(this._moveRelative,a,c),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(c),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(a,c,o){if(0===a)return;if(null===c||null===o)return;let s=null;switch(c){case g.MoveRelative:s=this._moveRelative;break;case g.RotateRelative:s=this._rotateRelative;break;case g.MoveScene:s=this._moveScene}switch(o){case 0:s.set(a,0,0);break;case 1:s.set(0,a,0);break;case 2:s.set(0,0,a)}}}(0,s.d)([(0,q.E)()],y.prototype,"wheelXMoveRelative",null),(0,s.d)([(0,q.E)()],y.prototype,"wheelYMoveRelative",null),(0,s.d)([(0,q.E)()],y.prototype,"wheelZMoveRelative",null),(0,s.d)([(0,q.E)()],y.prototype,"wheelXRotateRelative",null),(0,s.d)([(0,q.E)()],y.prototype,"wheelYRotateRelative",null),(0,s.d)([(0,q.E)()],y.prototype,"wheelZRotateRelative",null),(0,s.d)([(0,q.E)()],y.prototype,"wheelXMoveScene",null),(0,s.d)([(0,q.E)()],y.prototype,"wheelYMoveScene",null),(0,s.d)([(0,q.E)()],y.prototype,"wheelZMoveScene",null),p.c.FreeCameraMouseWheelInput=y;class k{constructor(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=a,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=T.Tools.IsSafari()}attachControl(a){a=T.Tools.BackCompatCameraNoPreventDefault(arguments);let c=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=o=>{const s=o.event,q="mouse"===s.pointerType||this._isSafari&&"undefined"===typeof s.pointerType;if(this.allowMouse||!q)if(o.type===L.e.POINTERDOWN){if(a||s.preventDefault(),this._pointerPressed.push(s.pointerId),1!==this._pointerPressed.length)return;c={x:s.clientX,y:s.clientY}}else if(o.type===L.e.POINTERUP){a||s.preventDefault();const o=this._pointerPressed.indexOf(s.pointerId);if(-1===o)return;if(this._pointerPressed.splice(o,1),0!=o)return;c=null,this._offsetX=null,this._offsetY=null}else if(o.type===L.e.POINTERMOVE){if(a||s.preventDefault(),!c)return;if(0!=this._pointerPressed.indexOf(s.pointerId))return;this._offsetX=s.clientX-c.x,this._offsetY=-(s.clientY-c.y)}}),this._observer=this.camera.Za()._inputManager._addCameraPointerObserver(this._pointerInput,L.e.POINTERDOWN|L.e.POINTERUP|L.e.POINTERMOVE),this._onLostFocus){const a=this.camera.getEngine().getInputElement();a&&a.addEventListener("blur",this._onLostFocus)}}nL(){if(this._pointerInput){if(this._observer&&(this.camera.Za()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const a=this.camera.getEngine().getInputElement();a&&a.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const a=this.camera,c=a._calculateHandednessMultiplier();a.cameraRotation.y=c*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)a.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const c=a._computeLocalCameraSpeed(),o=new t.Hc(0,0,0!==this.touchMoveSensibility?c*this._offsetY/this.touchMoveSensibility:0);t.Matrix.RotationYawPitchRollToRef(a.rotation.y,a.rotation.x,0,a._cameraRotationMatrix),a.cameraDirection.addInPlace(t.Hc.TransformCoordinates(o,a._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,s.d)([(0,q.E)()],k.prototype,"touchAngularSensibility",void 0),(0,s.d)([(0,q.E)()],k.prototype,"touchMoveSensibility",void 0),p.c.FreeCameraTouchInput=k;class n extends p.g{constructor(a){super(a),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new C),this}addMouse(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new e(a),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new y,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new k),this}clear(){super.clear(),this._mouseInput=null}}var f=o(12776),J=o(12721);class w extends i.b{get angularSensibility(){const a=this.inputs.attached.mouse;return a?a.angularSensibility:0}set angularSensibility(a){const c=this.inputs.attached.mouse;c&&(c.angularSensibility=a)}get keysUp(){const a=this.inputs.attached.keyboard;return a?a.keysUp:[]}set keysUp(a){const c=this.inputs.attached.keyboard;c&&(c.keysUp=a)}get keysUpward(){const a=this.inputs.attached.keyboard;return a?a.keysUpward:[]}set keysUpward(a){const c=this.inputs.attached.keyboard;c&&(c.keysUpward=a)}get keysDown(){const a=this.inputs.attached.keyboard;return a?a.keysDown:[]}set keysDown(a){const c=this.inputs.attached.keyboard;c&&(c.keysDown=a)}get keysDownward(){const a=this.inputs.attached.keyboard;return a?a.keysDownward:[]}set keysDownward(a){const c=this.inputs.attached.keyboard;c&&(c.keysDownward=a)}get keysLeft(){const a=this.inputs.attached.keyboard;return a?a.keysLeft:[]}set keysLeft(a){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=a)}get keysRight(){const a=this.inputs.attached.keyboard;return a?a.keysRight:[]}set keysRight(a){const c=this.inputs.attached.keyboard;c&&(c.keysRight=a)}get keysRotateLeft(){const a=this.inputs.attached.keyboard;return a?a.keysRotateLeft:[]}set keysRotateLeft(a){const c=this.inputs.attached.keyboard;c&&(c.keysRotateLeft=a)}get keysRotateRight(){const a=this.inputs.attached.keyboard;return a?a.keysRotateRight:[]}set keysRotateRight(a){const c=this.inputs.attached.keyboard;c&&(c.keysRotateRight=a)}get keysRotateUp(){const a=this.inputs.attached.keyboard;return a?a.keysRotateUp:[]}set keysRotateUp(a){const c=this.inputs.attached.keyboard;c&&(c.keysRotateUp=a)}get keysRotateDown(){const a=this.inputs.attached.keyboard;return a?a.keysRotateDown:[]}set keysRotateDown(a){const c=this.inputs.attached.keyboard;c&&(c.keysRotateDown=a)}constructor(a,c,o){var s;super(a,c,o,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),s=this,this.ellipsoid=new t.Hc(.5,1,.5),this.ellipsoidOffset=new t.Hc(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=t.Hc.Zero(),this._diffPosition=t.Hc.Zero(),this._newPosition=t.Hc.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s._newPosition.G(c),s._newPosition.subtractToRef(s._oldPosition,s._diffPosition),s._diffPosition.length()>J.b.CollisionsEpsilon&&(s.position.addToRef(s._diffPosition,s._deferredPositionUpdate),s._deferOnly?s._deferredUpdated=!0:s.position.G(s._deferredPositionUpdate),s.xg&&o&&s.xg(o))},this.inputs=new n(this),this.inputs.addKeyboard().addMouse()}attachControl(a,c){c=T.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(c)}nL(){this.inputs.detachElement(),this.cameraDirection=new t.Hc(0,0,0),this.cameraRotation=new t.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(a){this._collisionMask=isNaN(a)?-1:a}_collideWithWorld(a){let c;c=this.parent?t.Hc.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,c.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const o=this.Za().collisionCoordinator;this._collider||(this._collider=o.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let s=a;this.applyGravity&&(s=a.add(this.Za().gravity)),o.getNewPosition(this._oldPosition,s,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=t.Hc.Zero(),this._transformedDirection=t.Hc.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(a){this._needMoveForGravity=a}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Za().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"di"}}(0,s.d)([(0,q.B)()],w.prototype,"ellipsoid",void 0),(0,s.d)([(0,q.B)()],w.prototype,"ellipsoidOffset",void 0),(0,s.d)([(0,q.E)()],w.prototype,"checkCollisions",void 0),(0,s.d)([(0,q.E)()],w.prototype,"applyGravity",void 0),(0,f.d)("BABYLON.FreeCamera",w)},14998:(a,c,o)=>{"use strict";o.d(c,{e:()=>t});var s=o(12901),q=o(15001);class t{constructor(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=o,this.Ij=[],this._maxBlockCapacity=c||64,this._selectionContent=new s.b(1024),this._creationFunc=a}update(a,c,o){q.c._CreateBlocks(a,c,o,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}AC(a){for(let c=0;c<this.sj.length;c++){this.sj[c].addEntry(a)}}bC(a){for(let c=0;c<this.sj.length;c++){this.sj[c].removeEntry(a)}}select(a,c){this._selectionContent.reset();for(let o=0;o<this.sj.length;o++){this.sj[o].select(a,this._selectionContent,c)}return c?this._selectionContent.concat(this.Ij):this._selectionContent.concatWithNoDuplicate(this.Ij),this._selectionContent}intersects(a,c,o){this._selectionContent.reset();for(let s=0;s<this.sj.length;s++){this.sj[s].intersects(a,c,this._selectionContent,o)}return o?this._selectionContent.concat(this.Ij):this._selectionContent.concatWithNoDuplicate(this.Ij),this._selectionContent}intersectsRay(a){this._selectionContent.reset();for(let c=0;c<this.sj.length;c++){this.sj[c].intersectsRay(a,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Ij),this._selectionContent}}t.CreationFuncForMeshes=(a,c)=>{const o=a.getBoundingInfo();!a.isBlocked&&o.boundingBox.intersectsMinMax(c.Ej,c.Hj)&&c.entries.push(a)},t.CreationFuncForSubMeshes=(a,c)=>{a.getBoundingInfo().boundingBox.intersectsMinMax(c.Ej,c.Hj)&&c.entries.push(a)}},15001:(a,c,o)=>{"use strict";o.d(c,{c:()=>t});var s=o(12810),q=o(13142);class t{constructor(a,c,o,s,q,t){this.entries=[],this.bj=new Array,this._capacity=o,this._depth=s,this._maxDepth=q,this._creationFunc=t,this._minPoint=a,this._maxPoint=c,this.bj.push(a.clone()),this.bj.push(c.clone()),this.bj.push(a.clone()),this.bj[2].x=c.x,this.bj.push(a.clone()),this.bj[3].y=c.y,this.bj.push(a.clone()),this.bj[4].z=c.z,this.bj.push(c.clone()),this.bj[5].z=a.z,this.bj.push(c.clone()),this.bj[6].x=a.x,this.bj.push(c.clone()),this.bj[7].y=a.y}get zp(){return this._capacity}get Ej(){return this._minPoint}get Hj(){return this._maxPoint}addEntry(a){if(this.sj)for(let c=0;c<this.sj.length;c++){this.sj[c].addEntry(a)}else this._creationFunc(a,this),this.entries.length>this.zp&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(a){if(this.sj){for(let c=0;c<this.sj.length;c++){this.sj[c].removeEntry(a)}return}const c=this.entries.indexOf(a);c>-1&&this.entries.splice(c,1)}addEntries(a){for(let c=0;c<a.length;c++){const o=a[c];this.addEntry(o)}}select(a,c,o){if(q.c.IsInFrustum(this.bj,a)){if(this.sj){for(let s=0;s<this.sj.length;s++){this.sj[s].select(a,c,o)}return}o?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}}intersects(a,c,o,s){if(q.c.IntersectsSphere(this._minPoint,this._maxPoint,a,c)){if(this.sj){for(let q=0;q<this.sj.length;q++){this.sj[q].intersects(a,c,o,s)}return}s?o.concat(this.entries):o.concatWithNoDuplicate(this.entries)}}intersectsRay(a,c){if(a.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.sj){for(let o=0;o<this.sj.length;o++){this.sj[o].intersectsRay(a,c)}return}c.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){t._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(a,c,o,q,i,p,G,T){G.sj=new Array;const C=new s.Hc((c.x-a.x)/2,(c.y-a.y)/2,(c.z-a.z)/2);for(let s=0;s<2;s++)for(let c=0;c<2;c++)for(let j=0;j<2;j++){const L=a.add(C.multiplyByFloats(s,c,j)),e=a.add(C.multiplyByFloats(s+1,c+1,j+1)),g=new t(L,e,q,i+1,p,T);g.addEntries(o),G.sj.push(g)}}}},15009:(a,c,o)=>{"use strict";o.d(c,{b:()=>C});var s=o(13045),q=o(12810),t=o(13220),i=o(14066),p=o(13083),G=o(14998),T=o(12680);s.e.prototype.createOrUpdateSelectionOctree=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=this._getComponent(p.d.NAME_OCTREE);o||(o=new C(this),this.jc(o)),this.Kj||(this.Kj=new G.e(G.e.CreationFuncForMeshes,a,c));const s=this.getWorldExtends();return this.Kj.update(s.min,s.max,this.meshes),this.Kj},Object.defineProperty(s.e.prototype,"selectionOctree",{get:function(){return this.Kj},enumerable:!0,configurable:!0}),t.e.prototype.createOrUpdateSubmeshesOctree=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const o=this.Za();let s=o._getComponent(p.d.NAME_OCTREE);s||(s=new C(o),o.jc(s)),this._submeshesOctree||(this._submeshesOctree=new G.e(G.e.CreationFuncForSubMeshes,a,c)),this.Rc(!0);const q=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(q.minimumWorld,q.maximumWorld,this.wc),this._submeshesOctree};class C{constructor(a){this.name=p.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new i.e(q.Hc.Zero(),new q.Hc(1,1,1)),(a=a||T.b.LastCreatedScene)&&(this.ao=a,this.ao.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.ao.getActiveSubMeshCandidates=a=>this.getActiveSubMeshCandidates(a),this.ao.getCollidingSubMeshCandidates=(a,c)=>this.getCollidingSubMeshCandidates(a,c),this.ao.getIntersectingSubMeshCandidates=(a,c)=>this.getIntersectingSubMeshCandidates(a,c))}register(){this.ao.onMeshRemovedObservable.add((a=>{const c=this.ao.selectionOctree;if(void 0!==c&&null!==c){const o=c.Ij.indexOf(a);-1!==o&&c.Ij.splice(o,1)}})),this.ao.onMeshImportedObservable.add((a=>{const c=this.ao.selectionOctree;void 0!==c&&null!==c&&c.AC(a)}))}getActiveMeshCandidates(){var a;return(null===(a=this.ao.Kj)||void 0===a?void 0:a.select(this.ao.frustumPlanes))||this.ao._getDefaultMeshCandidates()}getActiveSubMeshCandidates(a){if(a._submeshesOctree&&a.useOctreeForRenderingSelection){return a._submeshesOctree.select(this.ao.frustumPlanes)}return this.ao._getDefaultSubMeshCandidates(a)}getIntersectingSubMeshCandidates(a,c){if(a._submeshesOctree&&a.useOctreeForPicking){i.e.TransformToRef(c,a.getWorldMatrix(),this._tempRay);return a._submeshesOctree.intersectsRay(this._tempRay)}return this.ao._getDefaultSubMeshCandidates(a)}getCollidingSubMeshCandidates(a,c){if(a._submeshesOctree&&a.useOctreeForCollisions){const o=c._velocityWorldLength+Math.max(c._radius.x,c._radius.y,c._radius.z);return a._submeshesOctree.intersects(c._basePointWorld,o)}return this.ao._getDefaultSubMeshCandidates(a)}rebuild(){}dispose(){}}},14066:(a,c,o)=>{"use strict";o.d(c,{e:()=>e});var s=o(13045),q=o(13246),t=o(12812),i=o(12810),p=o(12820),G=o(13135),T=o(13076),C=o(12680),j=o(13101);const L={internalPickerForMesh:void 0};class e{constructor(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.b;this.origin=a,this.direction=c,this.length=o,this.epsilon=s}clone(){return new e(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s=e._TmpVector3[0].Bc(a.x-o,a.y-o,a.z-o),q=e._TmpVector3[1].Bc(c.x+o,c.y+o,c.z+o);let t,i,p,G,T=0,C=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<s.x||this.origin.x>q.x)return!1}else if(t=1/this.direction.x,i=(s.x-this.origin.x)*t,p=(q.x-this.origin.x)*t,p===-1/0&&(p=1/0),i>p&&(G=i,i=p,p=G),T=Math.max(i,T),C=Math.min(p,C),T>C)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<s.y||this.origin.y>q.y)return!1}else if(t=1/this.direction.y,i=(s.y-this.origin.y)*t,p=(q.y-this.origin.y)*t,p===-1/0&&(p=1/0),i>p&&(G=i,i=p,p=G),T=Math.max(i,T),C=Math.min(p,C),T>C)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<s.z||this.origin.z>q.z)return!1}else if(t=1/this.direction.z,i=(s.z-this.origin.z)*t,p=(q.z-this.origin.z)*t,p===-1/0&&(p=1/0),i>p&&(G=i,i=p,p=G),T=Math.max(i,T),C=Math.min(p,C),T>C)return!1;return!0}intersectsBox(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(a.minimum,a.maximum,c)}intersectsSphere(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=a.center.x-this.origin.x,s=a.center.y-this.origin.y,q=a.center.z-this.origin.z,t=o*o+s*s+q*q,i=a.radius+c,p=i*i;if(t<=p)return!0;const G=o*this.direction.x+s*this.direction.y+q*this.direction.z;if(G<0)return!1;return t-G*G<=p}intersectsTriangle(a,c,o){const s=e._TmpVector3[0],q=e._TmpVector3[1],t=e._TmpVector3[2],p=e._TmpVector3[3],T=e._TmpVector3[4];c.subtractToRef(a,s),o.subtractToRef(a,q),i.Hc.CrossToRef(this.direction,q,t);const C=i.Hc.Dot(s,t);if(0===C)return null;const j=1/C;this.origin.subtractToRef(a,p);const L=i.Hc.Dot(p,t)*j;if(L<-this.epsilon||L>1+this.epsilon)return null;i.Hc.CrossToRef(p,s,T);const g=i.Hc.Dot(this.direction,T)*j;if(g<-this.epsilon||L+g>1+this.epsilon)return null;const M=i.Hc.Dot(q,T)*j;return M>this.length?null:new G.e(1-L-g,L,M)}intersectsPlane(a){let c;const o=i.Hc.Dot(a.normal,this.direction);if(Math.abs(o)<9.99999997475243e-7)return null;{const s=i.Hc.Dot(a.normal,this.origin);return c=(-a.d-s)/o,c<0?c<-9.99999997475243e-7?null:0:c}}intersectsAxis(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(a){case"y":{const a=(this.origin.y-c)/this.direction.y;return a>0?null:new i.Hc(this.origin.x+this.direction.x*-a,c,this.origin.z+this.direction.z*-a)}case"x":{const a=(this.origin.x-c)/this.direction.x;return a>0?null:new i.Hc(c,this.origin.y+this.direction.y*-a,this.origin.z+this.direction.z*-a)}case"z":{const a=(this.origin.z-c)/this.direction.z;return a>0?null:new i.Hc(this.origin.x+this.direction.x*-a,this.origin.y+this.direction.y*-a,c)}default:return null}}intersectsMesh(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=i.TmpVectors.Matrix[0];return a.getWorldMatrix().invertToRef(p),this._tmpRay?e.TransformToRef(this,p,this._tmpRay):this._tmpRay=e.Transform(this,p),a.intersects(this._tmpRay,c,o,s,q,t)}intersectsMeshes(a,c,o){o?o.length=0:o=[];for(let s=0;s<a.length;s++){const q=this.intersectsMesh(a[s],c);q.hit&&o.push(q)}return o.sort(this._comparePickingInfo),o}_comparePickingInfo(a,c){return a.distance<c.distance?-1:a.distance>c.distance?1:0}intersectionSegment(a,c,o){const s=this.origin,q=i.TmpVectors.Hc[0],t=i.TmpVectors.Hc[1],p=i.TmpVectors.Hc[2],G=i.TmpVectors.Hc[3];c.subtractToRef(a,q),this.direction.scaleToRef(e._Rayl,p),s.addToRef(p,t),a.subtractToRef(s,G);const T=i.Hc.Dot(q,q),C=i.Hc.Dot(q,p),j=i.Hc.Dot(p,p),L=i.Hc.Dot(q,G),g=i.Hc.Dot(p,G),M=T*j-C*C;let N,y,k=M,n=M;M<e._Smallnum?(N=0,k=1,y=g,n=j):(N=C*g-j*L,y=T*g-C*L,N<0?(N=0,y=g,n=j):N>k&&(N=k,y=g+C,n=j)),y<0?(y=0,-L<0?N=0:-L>T?N=k:(N=-L,k=T)):y>n&&(y=n,-L+C<0?N=0:-L+C>T?N=k:(N=-L+C,k=T));const f=Math.abs(N)<e._Smallnum?0:N/k,J=Math.abs(y)<e._Smallnum?0:y/n,w=i.TmpVectors.Hc[4];p.scaleToRef(J,w);const Z=i.TmpVectors.Hc[5];q.scaleToRef(f,Z),Z.addInPlace(G);const h=i.TmpVectors.Hc[6];Z.subtractToRef(w,h);return J>0&&J<=this.length&&h.lengthSquared()<o*o?Z.length():-1}update(a,c,o,s,q,t,p){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){e._RayDistant||(e._RayDistant=e.Zero()),e._RayDistant.unprojectRayToRef(a,c,o,s,i.Matrix.IdentityReadOnly,t,p);const G=i.TmpVectors.Matrix[0];q.invertToRef(G),e.TransformToRef(e._RayDistant,G,this)}else this.unprojectRayToRef(a,c,o,s,q,t,p);return this}static Zero(){return new e(i.Hc.Zero(),i.Hc.Zero())}static CreateNew(a,c,o,s,q,t,i){return e.Zero().update(a,c,o,s,q,t,i)}static CreateNewFromTo(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.Matrix.IdentityReadOnly;const s=new e(new i.Hc(0,0,0),new i.Hc(0,0,0));return e.CreateFromToToRef(a,c,s,o)}static CreateFromToToRef(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Matrix.IdentityReadOnly;o.origin.G(a);const q=c.subtractToRef(a,o.direction),t=Math.sqrt(q.x*q.x+q.y*q.y+q.z*q.z);return o.length=t,o.direction.normalize(),e.TransformToRef(o,s,o)}static Transform(a,c){const o=new e(new i.Hc(0,0,0),new i.Hc(0,0,0));return e.TransformToRef(a,c,o),o}static TransformToRef(a,c,o){i.Hc.TransformCoordinatesToRef(a.origin,c,o.origin),i.Hc.TransformNormalToRef(a.direction,c,o.direction),o.length=a.length,o.epsilon=a.epsilon;const s=o.direction,q=s.length();if(0!==q&&1!==q){const a=1/q;s.x*=a,s.y*=a,s.z*=a,o.length*=q}return o}unprojectRayToRef(a,c,o,s,q,t,p){const G=i.TmpVectors.Matrix[0];q.multiplyToRef(t,G),G.multiplyToRef(p,G),G.invert();const T=C.b.LastCreatedEngine,j=i.TmpVectors.Hc[0];j.x=a/o*2-1,j.y=-(c/s*2-1),j.z=null!==T&&void 0!==T&&T.o?1:null!==T&&void 0!==T&&T.isNDCHalfZRange?0:-1;const L=i.TmpVectors.Hc[1].Bc(j.x,j.y,1-1e-8),e=i.TmpVectors.Hc[2],g=i.TmpVectors.Hc[3];i.Hc._UnprojectFromInvertedMatrixToRef(j,G,e),i.Hc._UnprojectFromInvertedMatrixToRef(L,G,g),this.origin.G(e),g.subtractToRef(e,this.direction),this.direction.normalize()}}function g(a,c,o,s,q){let t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=e.Zero();return M(a,c,o,s,i,q,t),i}function M(a,c,o,s,q,t){let p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const T=a.getEngine();if(!t&&!(t=a.activeCamera))return a;const C=t.viewport,j=T.getRenderHeight(),{x:L,y:e,width:g,height:M}=C.toGlobal(T.getRenderWidth(),j),N=1/T.getHardwareScalingLevel();return c=c*N-L,o=o*N-(j-e-M),q.update(c,o,g,M,s||i.Matrix.IdentityReadOnly,p?i.Matrix.IdentityReadOnly:t.getViewMatrix(),t.getProjectionMatrix(),G),a}function N(a,c,o,s,q){if(!T.d)return a;const t=a.getEngine();if(!q&&!(q=a.activeCamera))throw new Error("Active camera not set");const p=q.viewport,G=t.getRenderHeight(),{x:C,y:j,width:L,height:e}=p.toGlobal(t.getRenderWidth(),G),g=i.Matrix.Identity(),M=1/t.getHardwareScalingLevel();return c=c*M-C,o=o*M-(G-j-e),s.update(c,o,L,e,g,g,q.getProjectionMatrix()),a}function y(a,c,o,s,q,t,i,p){const G=c(s,o.enableDistantPicking),T=o.intersects(G,q,i,t,s,p);return T&&T.hit?!q&&null!=a&&T.distance>=a.distance?null:T:null}function k(a,c,o,s,q,t){let p=null;const G=!!(a.activeCameras&&a.activeCameras.length>1&&a.cameraToUseForPointers!==a.activeCamera),C=a.cameraToUseForPointers||a.activeCamera,j=L.internalPickerForMesh||y;for(let T=0;T<a.meshes.length;T++){const L=a.meshes[T];if(o){if(!o(L,-1))continue}else if(!L.isEnabled()||!L.isVisible||!L.dT)continue;const e=G&&L.isWorldMatrixCameraDependent(),g=L.Rc(e,C);if(L.hasThinInstances&&L.jC){const a=j(p,c,L,g,!0,!0,t);if(a){if(q)return a;const G=i.TmpVectors.Matrix[1],T=L.thinInstanceGetWorldMatrices();for(let a=0;a<T.length;a++){if(o&&!o(L,a))continue;T[a].multiplyToRef(g,G);const i=j(p,c,L,G,s,q,t,!0);if(i&&(p=i,p.thinInstanceIndex=a,s))return p}}}else{const a=j(p,c,L,g,s,q,t);if(a&&(p=a,s))return p}}return p||new T.d}function n(a,c,o,s){if(!T.d)return null;const q=[],t=!!(a.activeCameras&&a.activeCameras.length>1&&a.cameraToUseForPointers!==a.activeCamera),p=a.cameraToUseForPointers||a.activeCamera,G=L.internalPickerForMesh||y;for(let T=0;T<a.meshes.length;T++){const C=a.meshes[T];if(o){if(!o(C,-1))continue}else if(!C.isEnabled()||!C.isVisible||!C.dT)continue;const j=t&&C.isWorldMatrixCameraDependent(),L=C.Rc(j,p);if(C.hasThinInstances&&C.jC){if(G(null,c,C,L,!0,!0,s)){const a=i.TmpVectors.Matrix[1],t=C.thinInstanceGetWorldMatrices();for(let i=0;i<t.length;i++){if(o&&!o(C,i))continue;t[i].multiplyToRef(L,a);const p=G(null,c,C,a,!1,!1,s,!0);p&&(p.thinInstanceIndex=i,q.push(p))}}}else{const a=G(null,c,C,L,!1,!1,s);a&&q.push(a)}}return q}function f(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,s=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;s||(s=a.getWorldMatrix()),c.length=o,q?c.origin.G(q):c.origin.G(a.position);const t=i.TmpVectors.Hc[2];t.set(0,0,a._scene.useRightHandedSystem?-1:1);const p=i.TmpVectors.Hc[3];return i.Hc.TransformNormalToRef(t,s,p),i.Hc.NormalizeToRef(p,c.direction),c}var J,w;e._TmpVector3=(0,p.b)(6,i.Hc.Zero),e._RayDistant=e.Zero(),e._Smallnum=1e-8,e._Rayl=1e9,J=s.e,(w=q.b)&&(w.prototype.getForwardRay=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,c=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;return f(this,new e(i.Hc.Zero(),i.Hc.Zero(),a),a,c,o)},w.prototype.getForwardRayToRef=function(a){return f(this,a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),J&&(j.c._IsPickingAvailable=!0,J.prototype.createPickingRay=function(a,c,o,s){return g(this,a,c,o,s,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),s.e.prototype.createPickingRayToRef=function(a,c,o,s,q){return M(this,a,c,o,s,q,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},s.e.prototype.createPickingRayInCameraSpace=function(a,c,o){return function(a,c,o,s){const q=e.Zero();return N(a,c,o,q,s),q}(this,a,c,o)},s.e.prototype.createPickingRayInCameraSpaceToRef=function(a,c,o,s){return N(this,a,c,o,s)},s.e.prototype.pickWithBoundingInfo=function(a,c,o,s,q){return function(a,c,o,s,q,t){if(!T.d)return null;const p=k(a,(s=>(a._tempPickingRay||(a._tempPickingRay=e.Zero()),M(a,c,o,s,a._tempPickingRay,t||null),a._tempPickingRay)),s,q,!0);return p&&(p.ray=g(a,c,o,i.Matrix.Identity(),t||null)),p}(this,a,c,o,s,q)},s.e.prototype.qs=function(a,c,o,s,q,t){return function(a,c,o,s,q,t,p){const G=k(a,((s,q)=>(a._tempPickingRay||(a._tempPickingRay=e.Zero()),M(a,c,o,s,a._tempPickingRay,t||null,!1,q),a._tempPickingRay)),s,q,!1,p);return G&&(G.ray=g(a,c,o,i.Matrix.Identity(),t||null)),G}(this,a,c,o,s,q,t)},s.e.prototype.pickWithRay=function(a,c,o,s){return function(a,c,o,s,q){const t=k(a,(o=>(a._pickWithRayInverseMatrix||(a._pickWithRayInverseMatrix=i.Matrix.Identity()),o.invertToRef(a._pickWithRayInverseMatrix),a._cachedRayForTransform||(a._cachedRayForTransform=e.Zero()),e.TransformToRef(c,a._pickWithRayInverseMatrix,a._cachedRayForTransform),a._cachedRayForTransform)),o,s,!1,q);return t&&(t.ray=c),t}(this,a,c,o,s)},s.e.prototype.multiPick=function(a,c,o,s,q){return function(a,c,o,s,q,t){return n(a,(s=>g(a,c,o,s,q||null)),s,t)}(this,a,c,o,s,q)},s.e.prototype.multiPickWithRay=function(a,c,o){return function(a,c,o,s){return n(a,(o=>(a._pickWithRayInverseMatrix||(a._pickWithRayInverseMatrix=i.Matrix.Identity()),o.invertToRef(a._pickWithRayInverseMatrix),a._cachedRayForTransform||(a._cachedRayForTransform=e.Zero()),e.TransformToRef(c,a._pickWithRayInverseMatrix,a._cachedRayForTransform),a._cachedRayForTransform)),o,s)}(this,a,c,o)}},14365:(a,c,o)=>{"use strict";var s=o(12757),q=o(12649),t=o(12689),i=o(12779),p=o(12721),G=o(12768);p.b.prototype._partialLoadFile=function(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(a,(a=>{o[c]=a,o._internalCount++,6===o._internalCount&&s(o)}),void 0,void 0,!0,((a,c)=>{q&&a&&q(a.status+" "+a.statusText,c)}))},p.b.prototype._cascadeLoadFiles=function(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const q=[];q._internalCount=0;for(let t=0;t<6;t++)this._partialLoadFile(o[t],t,q,c,s)},p.b.prototype._cascadeLoadImgs=function(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5?arguments[5]:void 0;const i=[];i._internalCount=0;for(let p=0;p<6;p++)this._partialLoadImg(s[p],p,i,a,c,o,q,t)},p.b.prototype._partialLoadImg=function(a,c,o,s,q,p){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7?arguments[7]:void 0;const C=(0,i.d)();(0,t.n)(a,(a=>{o[c]=a,o._internalCount++,s&&s.removePendingData(C),6===o._internalCount&&p&&p(q,o)}),((a,c)=>{s&&s.removePendingData(C),G&&G(a,c)}),s?s.offlineProvider:null,T),s&&s.addPendingData(C)},p.b.prototype.createCubeTextureBase=function(a,c,o,t){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6?arguments[6]:void 0,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8],L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,M=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,N=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,y=arguments.length>14&&void 0!==arguments[14]&&arguments[14],k=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const n=g||new s.b(this,7);n.isCube=!0,n.url=a,n.generateMipMaps=!t,n._lodGenerationScale=L,n._lodGenerationOffset=e,n._useSRGBBuffer=!!y&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!t),n!==g&&(n.label=a.substring(0,60)),this._doNotHandleContextLost||(n._extension=C,n._files=o,n._buffer=k);const f=a;this._transformTextureUrl&&!g&&(a=this._transformTextureUrl(a));const J=C??function(a){const c=a.split("?")[0],o=c.lastIndexOf(".");return o>-1?c.substring(o).toLowerCase():""}(a),w=(0,G.e)(J),Z=(a,c)=>{n.dispose(),p?p(a,c):a&&q.c.Warn(a)},h=(s,p)=>{a===f?s&&Z(s.status+" "+s.statusText,p):(q.c.Warn(`Failed to load ${a}, falling back to the ${f}`),this.createCubeTextureBase(f,c,o,!!t,i,Z,T,C,j,L,e,n,M,N,y,k))};if(w)w.then((s=>{const q=a=>{M&&M(n,a),s.loadCubeData(a,n,j,i,((a,c)=>{Z(a,c)}))};k?q(k):o&&6===o.length?s.supportCascades?this._cascadeLoadFiles(c,(a=>q(a.map((a=>new Uint8Array(a))))),o,Z):Z("Textures type does not support cascades."):this._loadFile(a,(a=>q(new Uint8Array(a))),void 0,void 0,!0,h)}));else{if(!o||0===o.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(c,n,((a,c)=>{N&&N(a,c)}),o,Z)}return this._internalTexturesCache.push(n),n}},15014:(a,c,o)=>{"use strict";o(12649);var s=o(12936);o(12757),o(12891),o(12751),o(12986),o(12951);s.e},14386:(a,c,o)=>{"use strict";o.d(c,{c:()=>q});var s=o(12776);class q{constructor(a){this.value=this._toInt(a)}_toInt(a){return 0|a}add(a){return new q(this.value+a.value)}vc(a){return new q(this.value-a.value)}multiply(a){return new q(Math.imul(this.value,a.value))}divide(a){return new q(this.value/a.value)}getClassName(){return q.ClassName}equals(a){return this.value===a.value}static FromValue(a){return new q(a)}toString(){return this.value.toString()}}q.ClassName="FlowGraphInteger",(0,s.d)("FlowGraphInteger",q)},14400:(a,c,o)=>{"use strict";o.d(c,{c:()=>q,e:()=>t});var s=o(12810);class q{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.yc=a}get m(){return this.yc}transformVector(a){return this.transformVectorToRef(a,new s.Vector2)}transformVectorToRef(a,c){return c.x=a.x*this.yc[0]+a.y*this.yc[1],c.y=a.x*this.yc[2]+a.y*this.yc[3],c}hc(){return this.toArray()}toArray(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<4;c++)a[c]=this.yc[c];return a}ts(a){for(let c=0;c<4;c++)this.yc[c]=a[c];return this}multiplyToRef(a,c){const o=a.yc,s=this.yc,q=c.yc;return q[0]=o[0]*s[0]+o[1]*s[2],q[1]=o[0]*s[1]+o[1]*s[3],q[2]=o[2]*s[0]+o[3]*s[2],q[3]=o[2]*s[1]+o[3]*s[3],c}multiply(a){return this.multiplyToRef(a,new q)}divideToRef(a,c){const o=this.yc,s=a.yc,q=c.yc;return q[0]=o[0]/s[0],q[1]=o[1]/s[1],q[2]=o[2]/s[2],q[3]=o[3]/s[3],c}divide(a){return this.divideToRef(a,new q)}addToRef(a,c){const o=this.yc,s=a.m,q=c.m;return q[0]=o[0]+s[0],q[1]=o[1]+s[1],q[2]=o[2]+s[2],q[3]=o[3]+s[3],c}add(a){return this.addToRef(a,new q)}subtractToRef(a,c){const o=this.yc,s=a.m,q=c.m;return q[0]=o[0]-s[0],q[1]=o[1]-s[1],q[2]=o[2]-s[2],q[3]=o[3]-s[3],c}vc(a){return this.subtractToRef(a,new q)}transpose(){const a=this.yc;return new q([a[0],a[2],a[1],a[3]])}determinant(){const a=this.yc;return a[0]*a[3]-a[1]*a[2]}inverse(){const a=this.determinant();if(0===a)throw new Error("Matrix is not invertible");const c=this.yc,o=1/a;return new q([c[3]*o,-c[1]*o,-c[2]*o,c[0]*o])}equals(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=this.yc,s=a.m;return 0===c?o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2]&&o[3]===s[3]:Math.abs(o[0]-s[0])<c&&Math.abs(o[1]-s[1])<c&&Math.abs(o[2]-s[2])<c&&Math.abs(o[3]-s[3])<c}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.yc.join(", ")})`}}class t{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.yc=a}get m(){return this.yc}transformVector(a){return this.transformVectorToRef(a,new s.Hc)}transformVectorToRef(a,c){const o=this.yc;return c.x=a.x*o[0]+a.y*o[1]+a.z*o[2],c.y=a.x*o[3]+a.y*o[4]+a.z*o[5],c.z=a.x*o[6]+a.y*o[7]+a.z*o[8],c}multiplyToRef(a,c){const o=a.yc,s=this.yc,q=c.m;return q[0]=o[0]*s[0]+o[1]*s[3]+o[2]*s[6],q[1]=o[0]*s[1]+o[1]*s[4]+o[2]*s[7],q[2]=o[0]*s[2]+o[1]*s[5]+o[2]*s[8],q[3]=o[3]*s[0]+o[4]*s[3]+o[5]*s[6],q[4]=o[3]*s[1]+o[4]*s[4]+o[5]*s[7],q[5]=o[3]*s[2]+o[4]*s[5]+o[5]*s[8],q[6]=o[6]*s[0]+o[7]*s[3]+o[8]*s[6],q[7]=o[6]*s[1]+o[7]*s[4]+o[8]*s[7],q[8]=o[6]*s[2]+o[7]*s[5]+o[8]*s[8],c}multiply(a){return this.multiplyToRef(a,new t)}divideToRef(a,c){const o=this.yc,s=a.m,q=c.m;return q[0]=o[0]/s[0],q[1]=o[1]/s[1],q[2]=o[2]/s[2],q[3]=o[3]/s[3],q[4]=o[4]/s[4],q[5]=o[5]/s[5],q[6]=o[6]/s[6],q[7]=o[7]/s[7],q[8]=o[8]/s[8],c}divide(a){return this.divideToRef(a,new t)}addToRef(a,c){const o=this.yc,s=a.m,q=c.m;return q[0]=o[0]+s[0],q[1]=o[1]+s[1],q[2]=o[2]+s[2],q[3]=o[3]+s[3],q[4]=o[4]+s[4],q[5]=o[5]+s[5],q[6]=o[6]+s[6],q[7]=o[7]+s[7],q[8]=o[8]+s[8],c}add(a){return this.addToRef(a,new t)}subtractToRef(a,c){const o=this.yc,s=a.m,q=c.m;return q[0]=o[0]-s[0],q[1]=o[1]-s[1],q[2]=o[2]-s[2],q[3]=o[3]-s[3],q[4]=o[4]-s[4],q[5]=o[5]-s[5],q[6]=o[6]-s[6],q[7]=o[7]-s[7],q[8]=o[8]-s[8],c}vc(a){return this.subtractToRef(a,new t)}toArray(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<9;c++)a[c]=this.yc[c];return a}hc(){return this.toArray()}ts(a){for(let c=0;c<9;c++)this.yc[c]=a[c];return this}transpose(){const a=this.yc;return new t([a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]])}determinant(){const a=this.yc;return a[0]*(a[4]*a[8]-a[5]*a[7])-a[1]*(a[3]*a[8]-a[5]*a[6])+a[2]*(a[3]*a[7]-a[4]*a[6])}inverse(){const a=this.determinant();if(0===a)throw new Error("Matrix is not invertible");const c=this.yc,o=1/a;return new t([(c[4]*c[8]-c[5]*c[7])*o,(c[2]*c[7]-c[1]*c[8])*o,(c[1]*c[5]-c[2]*c[4])*o,(c[5]*c[6]-c[3]*c[8])*o,(c[0]*c[8]-c[2]*c[6])*o,(c[2]*c[3]-c[0]*c[5])*o,(c[3]*c[7]-c[4]*c[6])*o,(c[1]*c[6]-c[0]*c[7])*o,(c[0]*c[4]-c[1]*c[3])*o])}equals(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=this.yc,s=a.m;return 0===c?o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2]&&o[3]===s[3]&&o[4]===s[4]&&o[5]===s[5]&&o[6]===s[6]&&o[7]===s[7]&&o[8]===s[8]:Math.abs(o[0]-s[0])<c&&Math.abs(o[1]-s[1])<c&&Math.abs(o[2]-s[2])<c&&Math.abs(o[3]-s[3])<c&&Math.abs(o[4]-s[4])<c&&Math.abs(o[5]-s[5])<c&&Math.abs(o[6]-s[6])<c&&Math.abs(o[7]-s[7])<c&&Math.abs(o[8]-s[8])<c}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.yc.join(", ")})`}}},14407:(a,c,o)=>{"use strict";var s;function q(a,c,o,s){switch(c){case"Animation":return s?a.animations.find((a=>a.uniqueId===o))??null:a.animations[o]??null;case"AnimationGroup":return s?a.animationGroups.find((a=>a.uniqueId===o))??null:a.animationGroups[o]??null;case"Mesh":return s?a.meshes.find((a=>a.uniqueId===o))??null:a.meshes[o]??null;case"Material":return s?a.materials.find((a=>a.uniqueId===o))??null:a.materials[o]??null;case"tj":return s?a.cameras.find((a=>a.uniqueId===o))??null:a.cameras[o]??null;case"Light":return s?a.lights.find((a=>a.uniqueId===o))??null:a.lights[o]??null;default:return null}}o.d(c,{b:()=>q}),function(a){a.Animation="Animation",a.AnimationGroup="AnimationGroup",a.Mesh="Mesh",a.Material="Material",a.tj="tj",a.Light="Light"}(s||(s={}))},14439:(a,c,o)=>{"use strict";o.d(c,{e:()=>q});var s=o(14442);class q extends s.d{constructor(a,c){if(super(a),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),c)for(const o of c)this._eventsSignalOutputs[o]=this._registerSignalOutput(o+"Event")}_executeOnTick(a){}_startPendingTasks(a){a._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(a),this._resetAfterCanceled(a)),this._preparePendingTasks(a),a._addPendingBlock(this),this.out._activateSignal(a),a._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(a){a._deleteExecutionVariable(this,"_initialized"),a._removePendingBlock(this)}}},14423:(a,c,o)=>{"use strict";o.d(c,{e:()=>T});var s=o(12779),q=o(12776),t=o(14428),i=o(12639),p=o(14382);class G extends t.e{constructor(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:s.defaultValue,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(a,c,o),this.richType=s,this._defaultValue=q,this._optional=t,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new i.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(a){this._isDisabled!==a&&(this._isDisabled=a,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(a,c){c._getConnectionValue(this)!==a&&(c._setConnectionValue(this,a),this.onValueChangedObservable.notifyObservers(a))}resetToDefaultValue(a){a._setConnectionValue(this,this._defaultValue)}connectTo(a){this._isDisabled||super.connectTo(a)}_getValueOrDefault(a){const c=a._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(c):c}getValue(a){if(1===this.connectionType){a._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(a);const c=this._getValueOrDefault(a);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}const c=this.isConnected()?this._connectedPoint[0].getValue(a):this._getValueOrDefault(a);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(a),a.richType={},this.richType.serialize(a.richType),a.optional=this._optional,(0,p.h)("defaultValue",this._defaultValue,a)}}(0,q.d)("FlowGraphDataConnection",G);class T{constructor(a){var c;this.config=a,this.uniqueId=(0,s.d)(),this.name=(null===(c=this.config)||void 0===c?void 0:c.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(a){}registerDataInput(a,c,o){const s=new G(a,0,this,c,o);return this.dataInputs.push(s),s}registerDataOutput(a,c,o){const s=new G(a,1,this,c,o);return this.dataOutputs.push(s),s}getDataInput(a){return this.dataInputs.find((c=>c.name===a))}getDataOutput(a){return this.dataOutputs.find((c=>c.name===a))}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.h;if(a.uniqueId=this.uniqueId,a.config={},this.config){const o=this.config,s=Object.keys(o);for(const q of s)c(q,o[q],a.config)}a.dataInputs=[],a.dataOutputs=[],a.className=this.getClassName();for(const o of this.dataInputs){const c={};o.serialize(c),a.dataInputs.push(c)}for(const o of this.dataOutputs){const c={};o.serialize(c),a.dataOutputs.push(c)}}deserialize(a){}_log(a,c,o){var s;null===(s=a.logger)||void 0===s||s.addLogItem({action:c,ps:o,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14428:(a,c,o)=>{"use strict";o.d(c,{e:()=>t});var s,q=o(12779);!function(a){a[a.Input=0]="Input",a[a.Output=1]="Output"}(s||(s={}));class t{constructor(a,c,o){this._ownerBlock=o,this._connectedPoint=[],this.uniqueId=(0,q.d)(),this.connectedPointIds=[],this.name=a,this._connectionType=c}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(a){if(this._connectionType===a._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||a._isSingularConnection()&&a._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(a),a._connectedPoint.push(this)}disconnectFrom(a){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=this._connectedPoint.indexOf(a),s=a._connectedPoint.indexOf(this);-1!==o&&-1!==s&&(c&&this._connectedPoint.splice(o,1),a._connectedPoint.splice(s,1))}disconnectFromAll(){for(const a of this._connectedPoint)this.disconnectFrom(a,!1);this._connectedPoint.length=0}dispose(){for(const a of this._connectedPoint)this.disconnectFrom(a)}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.uniqueId=this.uniqueId,a.name=this.name,a._connectionType=this._connectionType,a.connectedPointIds=[],a.className=this.getClassName();for(const c of this._connectedPoint)a.connectedPointIds.push(c.uniqueId)}getClassName(){return"FGConnection"}deserialize(a){this.uniqueId=a.uniqueId,this.name=a.name,this._connectionType=a._connectionType,this.connectedPointIds=a.connectedPointIds}}},14377:(a,c,o)=>{"use strict";o.d(c,{c:()=>n});var s,q=o(12639),t=o(12798),i=o(12800),p=o(12779),G=o(14382),T=o(14407),C=o(12649);!function(a){a.ExecuteBlock="ExecuteBlock",a.ExecuteEvent="ExecuteEvent",a.TriggerConnection="TriggerConnection",a.ContextVariableSet="ContextVariableSet",a.GlobalVariableSet="GlobalVariableSet",a.GlobalVariableDelete="GlobalVariableDelete",a.GlobalVariableGet="GlobalVariableGet",a.AddConnection="AddConnection",a.GetConnectionValue="GetConnectionValue",a.SetConnectionValue="SetConnectionValue",a.ActivateSignal="ActivateSignal",a.ContextVariableGet="ContextVariableGet"}(s||(s={}));class j{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(a){if(a.time||(a.time=Date.now()),this.log.push(a),this.logToConsole){var c;const o=null===(c=a.ps)||void 0===c?void 0:c.value;"object"===typeof o&&o.getClassName?C.c.Log(`[FGLog] ${a.className}:${a.uniqueId.split("-")[0]} ${a.action} - ${JSON.stringify(o.getClassName())}: ${o.toString()}`):C.c.Log(`[FGLog] ${a.className}:${a.uniqueId.split("-")[0]} ${a.action} - ${JSON.stringify(a.ps)}`)}}getItemsOfType(a){return this.log.filter((c=>c.action===a))}}class L{get enableLogging(){return this._enableLogging}set enableLogging(a){this._enableLogging!==a&&(this._enableLogging=a,this._enableLogging?(this.logger=new j,this.logger.logToConsole=!0):this.logger=null)}constructor(a){this.uniqueId=(0,p.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new q.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=a,this.assetsContext=a.assetsContext??a.ao}hasVariable(a){return a in this._userVariables}setVariable(a,c){var o;this._userVariables[a]=c,null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",ps:{name:a,value:c}})}getAsset(a,c){return(0,T.b)(this.assetsContext,a,c)}getVariable(a){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",ps:{name:a,value:this._userVariables[a]}}),this._userVariables[a]}get userVariables(){return this._userVariables}Za(){return this._configuration.ao}_getUniqueIdPrefixedName(a,c){return`${a.uniqueId}_${c}`}_getGlobalContextVariable(a,c){var o;return null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",ps:{name:a,defaultValue:c,possibleValue:this._globalContextVariables[a]}}),this._hasGlobalContextVariable(a)?this._globalContextVariables[a]:c}_setGlobalContextVariable(a,c){var o;null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",ps:{name:a,value:c}}),this._globalContextVariables[a]=c}_deleteGlobalContextVariable(a){var c;null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",ps:{name:a}}),delete this._globalContextVariables[a]}_hasGlobalContextVariable(a){return a in this._globalContextVariables}_setExecutionVariable(a,c,o){this._executionVariables[this._getUniqueIdPrefixedName(a,c)]=o}_getExecutionVariable(a,c,o){return this._hasExecutionVariable(a,c)?this._executionVariables[this._getUniqueIdPrefixedName(a,c)]:o}_deleteExecutionVariable(a,c){delete this._executionVariables[this._getUniqueIdPrefixedName(a,c)]}_hasExecutionVariable(a,c){return this._getUniqueIdPrefixedName(a,c)in this._executionVariables}_hasConnectionValue(a){return a.uniqueId in this._connectionValues}_setConnectionValue(a,c){var o;this._connectionValues[a.uniqueId]=c,null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",ps:{connectionPointId:a.uniqueId,value:c}})}_setConnectionValueByKey(a,c){this._connectionValues[a]=c}_getConnectionValue(a){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",ps:{connectionPointId:a.uniqueId,value:this._connectionValues[a.uniqueId]}}),this._connectionValues[a.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(a){this._pendingBlocks.includes(a)||(this._pendingBlocks.push(a),this._pendingBlocks.sort(((a,c)=>a.priority-c.priority)))}_removePendingBlock(a){const c=this._pendingBlocks.indexOf(a);-1!==c&&this._pendingBlocks.splice(c,1)}_clearPendingBlocks(){for(const a of this._pendingBlocks)a._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(a){var c;this.onNodeExecutedObservable.notifyObservers(a),null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:a.getClassName(),uniqueId:a.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(a){this._setGlobalContextVariable("timeSinceStart",a.timeSinceStart),this._setGlobalContextVariable("deltaTime",a.deltaTime);for(const o of this._pendingBlocks){var c;null===(c=o._executeOnTick)||void 0===c||c.call(o,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.h;a.uniqueId=this.uniqueId,a._userVariables={};for(const s in this._userVariables)c(s,this._userVariables[s],a._userVariables);a._connectionValues={};for(const s in this._connectionValues)c(s,this._connectionValues[s],a._connectionValues);var o;this.assetsContext!==this.Za()&&(a._assetsContext={meshes:this.assetsContext.meshes.map((a=>a.id)),materials:this.assetsContext.materials.map((a=>a.id)),textures:this.assetsContext.textures.map((a=>a.name)),animations:this.assetsContext.animations.map((a=>a.name)),lights:this.assetsContext.lights.map((a=>a.id)),cameras:this.assetsContext.cameras.map((a=>a.id)),Re:null===(o=this.assetsContext.Re)||void 0===o?void 0:o.map((a=>a.name)),skeletons:this.assetsContext.skeletons.map((a=>a.id)),IL:this.assetsContext.IL.map((a=>a.name)),geometries:this.assetsContext.geometries.map((a=>a.id)),multiMaterials:this.assetsContext.multiMaterials.map((a=>a.id)),transformNodes:this.assetsContext.transformNodes.map((a=>a.id))})}getClassName(){return"FlowGraphContext"}}(0,t.d)([(0,i.E)()],L.prototype,"uniqueId",void 0);var e=o(14414),g=o(13087);class M{constructor(a){this.onEventTriggeredObservable=new q.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=a,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.gc.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const a=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",ps:{timeSinceStart:this._startingTime,deltaTime:a}}),this._startingTime+=a})),this._meshPickedObserver=this._scene.onPointerObservable.add((a=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",ps:a})}),g.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((a=>{const c=a.pointerId,o=a.mesh,s=this._pointerUnderMeshState[c];!s&&o?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",ps:{pointerId:c,mesh:o}}):s&&!o?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",ps:{pointerId:c,mesh:s}}):s&&o&&s!==o&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",ps:{pointerId:c,mesh:s,over:o}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",ps:{pointerId:c,mesh:o,out:s}})),this._pointerUnderMeshState[c]=o}),g.e.POINTERMOVE)}dispose(){var a,c,o,s,q;null===(a=this._sceneDisposeObserver)||void 0===a||a.remove(),null===(c=this._sceneReadyObserver)||void 0===c||c.remove(),null===(o=this._sceneOnBeforeRenderObserver)||void 0===o||o.remove(),null===(s=this._meshPickedObserver)||void 0===s||s.remove(),null===(q=this._meshUnderPointerObserver)||void 0===q||q.remove(),this.onEventTriggeredObservable.clear()}}var N,y=o(14431);!function(a){a[a.Stopped=0]="Stopped",a[a.Started=1]="Started"}(N||(N={}));class k{get state(){return this._state}set state(a){this._state=a,this.onStateChangedObservable.notifyObservers(a)}constructor(a){this.onStateChangedObservable=new q.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=a.ao,this._sceneEventCoordinator=new M(this._scene),this._coordinator=a.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((a=>{for(const c of this._executionContexts){const o=this._getContextualOrder(a.type,c);for(const s of o)if(!s._executeEvent(c,a.ps))break}switch(a.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const c of this._executionContexts)c._notifyOnTick(a.ps);break;case"SceneDispose":this.dispose()}}))}createContext(){const a=new L({ao:this._scene,coordinator:this._coordinator});return this._executionContexts.push(a),a}getContext(a){return this._executionContexts[a]}addEventBlock(a){if("PointerOver"!==a.type&&"PointerOut"!==a.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==a.type&&this._eventBlocks[a.type].push(a),1===this.state)for(const c of this._executionContexts)a._startPendingTasks(c);else this.onStateChangedObservable.addOnce((c=>{if(1===c)for(const o of this._executionContexts)a._startPendingTasks(o)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((a=>{1===a&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const a of this._executionContexts)for(const c in this._eventBlocks){const o=this._getContextualOrder(c,a);for(const c of o)c._startPendingTasks(a)}}_getContextualOrder(a,c){const o=this._eventBlocks[a].sort(((a,c)=>c.initPriority-a.initPriority));if("MeshPick"===a){const a=[];for(const s of o){const q=s.asset.getValue(c);let t=0;for(;t<o.length;t++){const a=o[t].asset.getValue(c);if(q&&a&&(0,y.k)(q,a))break}a.splice(t,0,s)}return a}return o}dispose(){var a;if(0!==this.state){this.state=0;for(const a of this._executionContexts)a._clearPendingBlocks();this._executionContexts.length=0;for(const a in this._eventBlocks)this._eventBlocks[a].length=0;null===(a=this._eventObserver)||void 0===a||a.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(a){const c=[],o=new Set;for(const s in this._eventBlocks)for(const a of this._eventBlocks[s])c.push(a),o.add(a.uniqueId);for(;c.length>0;){const s=c.pop();a(s);for(const a of s.dataInputs)for(const s of a._connectedPoint)o.has(s._ownerBlock.uniqueId)||(c.push(s._ownerBlock),o.add(s._ownerBlock.uniqueId));if(s instanceof e.e)for(const a of s.signalOutputs)for(const s of a._connectedPoint)o.has(s._ownerBlock.uniqueId)||(c.push(s._ownerBlock),o.add(s._ownerBlock.uniqueId))}}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;a.allBlocks=[],this.visitAllBlocks((c=>{const o={};c.serialize(o),a.allBlocks.push(o)})),a.executionContexts=[];for(const o of this._executionContexts){const s={};o.serialize(s,c),a.executionContexts.push(s)}}}class n{constructor(a){this.config=a,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.ao.gc.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.ao.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const a=this._executeOnNextFrame.slice(0);if(a.length)for(const c of a){this.notifyCustomEvent(c.id,c.data,!1);const a=this._executeOnNextFrame.findIndex((a=>a.uniqueId===c.uniqueId));-1!==a&&this._executeOnNextFrame.splice(a,1)}}));(n.SceneCoordinators.get(this.config.ao)??[]).push(this)}createGraph(){const a=new k({ao:this.config.ao,coordinator:this});return this._flowGraphs.push(a),a}removeGraph(a){const c=this._flowGraphs.indexOf(a);-1!==c&&(a.dispose(),this._flowGraphs.splice(c,1))}start(){for(const a of this._flowGraphs)a.start()}dispose(){var a,c;for(const q of this._flowGraphs)q.dispose();this._flowGraphs.length=0,null===(a=this._disposeObserver)||void 0===a||a.remove(),null===(c=this._onBeforeRenderObserver)||void 0===c||c.remove();const o=n.SceneCoordinators.get(this.config.ao)??[],s=o.indexOf(this);-1!==s&&o.splice(s,1)}serialize(a,c){a._flowGraphs=[];for(const o of this._flowGraphs){const s={};o.serialize(s,c),a._flowGraphs.push(s)}a.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(a){let c=this._customEventsMap.get(a);return c||(c=new q.d,this._customEventsMap.set(a,c)),c}notifyCustomEvent(a,c){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:a,data:c,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(a)){const c=this._eventExecutionCounter.get(a);if(this._eventExecutionCounter.set(a,c+1),c>=n.MaxEventTypeExecutionPerFrame)return void(c===n.MaxEventTypeExecutionPerFrame&&C.c.Warn(`FlowGraphCoordinator: Too many executions of event "${a}".`))}else this._eventExecutionCounter.set(a,1);const o=this._customEventsMap.get(a);o&&o.notifyObservers(c)}}n.MaxEventsPerType=30,n.MaxEventTypeExecutionPerFrame=30,n.SceneCoordinators=new Map},14437:(a,c,o)=>{"use strict";o.d(c,{e:()=>q});var s=o(14439);class q extends s.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(a){a._notifyExecuteNode(this),this.done._activateSignal(a)}}},14414:(a,c,o)=>{"use strict";o.d(c,{e:()=>p});var s=o(14423),q=o(14428),t=o(12776);class i extends q.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(a){super.connectTo(a),this._connectedPoint.sort(((a,c)=>c.priority-a.priority))}_activateSignal(a){var c;if(null===(c=a.logger)||void 0===c||c.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,ps:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)a._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(a,this),a._increaseExecutionId();else for(const o of this._connectedPoint)o._activateSignal(a)}}(0,t.d)("FlowGraphSignalConnection",i);class p extends s.e{constructor(a){super(a),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(a){const c=new i(a,0,this);return this.signalInputs.push(c),c}_registerSignalOutput(a){const c=new i(a,1,this);return this.signalOutputs.push(c),c}_unregisterSignalInput(a){const c=this.signalInputs.findIndex((c=>c.name===a));-1!==c&&(this.signalInputs[c].dispose(),this.signalInputs.splice(c,1))}_unregisterSignalOutput(a){const c=this.signalOutputs.findIndex((c=>c.name===a));-1!==c&&(this.signalOutputs[c].dispose(),this.signalOutputs.splice(c,1))}_reportError(a,c){this.error.ps="string"===typeof c?new Error(c):c,this.error._activateSignal(a)}getSignalInput(a){return this.signalInputs.find((c=>c.name===a))}getSignalOutput(a){return this.signalOutputs.find((c=>c.name===a))}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(a),a.signalInputs=[],a.signalOutputs=[];for(const c of this.signalInputs){const o={};c.serialize(o),a.signalInputs.push(o)}for(const c of this.signalOutputs){const o={};c.serialize(o),a.signalOutputs.push(o)}}deserialize(a){for(let c=0;c<a.signalInputs.length;c++){const o=this.getSignalInput(a.signalInputs[c].name);if(!o)throw new Error("Could not find signal input with name "+a.signalInputs[c].name+" in block "+a.className);o.deserialize(a.signalInputs[c])}for(let c=0;c<a.signalOutputs.length;c++){const o=this.getSignalOutput(a.signalOutputs[c].name);if(!o)throw new Error("Could not find signal output with name "+a.signalOutputs[c].name+" in block "+a.className);o.deserialize(a.signalOutputs[c])}}getClassName(){return"FlowGraphExecutionBlock"}}},14442:(a,c,o)=>{"use strict";o.d(c,{d:()=>q});var s=o(14414);class q extends s.e{constructor(a){super(a),this.out=this._registerSignalOutput("out")}}},14394:(a,c,o)=>{"use strict";o.d(c,{B:()=>U,E:()=>S,G:()=>h,H:()=>Z,c:()=>T,f:()=>L,g:()=>w,k:()=>N,l:()=>y,n:()=>k,o:()=>j,p:()=>J,s:()=>C,u:()=>e,w:()=>g,z:()=>M});var s,q=o(12810),t=o(12858),i=o(14386),p=o(14400);!function(a){a.Any="any",a.String="string",a.Number="number",a.Boolean="boolean",a.Object="object",a.Integer="FlowGraphInteger",a.Vector2="Vector2",a.Hc="Hc",a.Vector4="Vector4",a.Quaternion="Quaternion",a.Matrix="Matrix",a.Matrix2D="Matrix2D",a.Matrix3D="Matrix3D",a.oo="oo",a.Yc="Yc"}(s||(s={}));class G{constructor(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=a,this.defaultValue=c,this.animationType=o}serialize(a){a.typeName=this.typeName,a.defaultValue=this.defaultValue}}const T=new G("any",void 0),C=new G("string",""),j=new G("number",0,0),L=new G("boolean",!1),e=new G("Vector2",q.Vector2.Zero(),5),g=new G("Hc",q.Hc.Zero(),1),M=new G("Vector4",q.Vector4.Zero()),N=new G("Matrix",q.Matrix.Identity(),3),y=new G("Matrix2D",new p.c),k=new G("Matrix3D",new p.e),n=new G("oo",t.oo.Black(),4),f=new G("Yc",new t.Yc(0,0,0,0),7),J=new G("Quaternion",q.Quaternion.Identity(),2);J.typeTransformer=a=>{if(a.getClassName){if("Vector4"===a.getClassName())return q.Quaternion.qo(a.hc());if("Hc"===a.getClassName())return q.Quaternion.FromEulerVector(a);if("Matrix"===a.getClassName())return q.Quaternion.FromRotationMatrix(a)}return a};const w=new G("FlowGraphInteger",new i.c(0),0);function Z(a){const c=a;switch(typeof a){case"string":return C;case"number":return j;case"boolean":return L;case"object":if(c.getClassName)switch(c.getClassName()){case"Vector2":return e;case"Hc":return g;case"Vector4":return M;case"Matrix":return N;case"oo":return n;case"Yc":return f;case"Quaternion":return J;case"FlowGraphInteger":return w;case"Matrix2D":return y;case"Matrix3D":return k}return T;default:return T}}function h(a){switch(a){case"string":return C;case"number":return j;case"boolean":return L;case"Vector2":return e;case"Hc":return g;case"Vector4":return M;case"Matrix":return N;case"oo":return n;case"Yc":return f;case"Quaternion":return J;case"FlowGraphInteger":return w;case"Matrix2D":return y;case"Matrix3D":return k;default:return T}}function U(a){switch(a){case"number":default:return 0;case"Vector2":return 5;case"Hc":return 1;case"Matrix":return 3;case"oo":return 4;case"Yc":return 7;case"Quaternion":return 2}}function S(a){switch(a){case 0:return j;case 5:return e;case 1:return g;case 3:return N;case 4:return n;case 7:return f;case 2:return J;default:return T}}},14382:(a,c,o)=>{"use strict";o.d(c,{d:()=>C,h:()=>T,k:()=>j});var s=o(12858),q=o(12810),t=o(14386),i=o(14394),p=o(14400);function G(a){return"Vector2"===a||"Hc"===a||"Vector4"===a||"Quaternion"===a||"oo"===a||"Yc"===a}function T(a,c,o){var s;const q=(null===c||void 0===c||null===(s=c.getClassName)||void 0===s?void 0:s.call(c))??"";if(G(q)||function(a){return"Matrix"===a||"Matrix2D"===a||"Matrix3D"===a}(q))o[a]={value:c.hc(),className:q};else if("FlowGraphInteger"===q)o[a]={value:c.value,className:q};else if(q&&(c.id||c.name))o[a]={id:c.id,name:c.name,className:q};else{if("object"===typeof c)throw new Error(`Could not serialize value ${c}`);o[a]=c}}function C(a,c,o,T){const j=c[a];let L;const e=(null===j||void 0===j?void 0:j.type)??(null===j||void 0===j?void 0:j.className);if(function(a){return"Mesh"===a||"AbstractMesh"===a||"GroundMesh"===a||"InstanceMesh"===a||"LinesMesh"===a||"GoldbergMesh"===a||"GreasedLineMesh"===a||"TrailMesh"===a}(e)){let a=T.meshes.filter((a=>j.id?a.id===j.id:a.name===j.name));0===a.length&&(a=T.transformNodes.filter((a=>j.id?a.id===j.id:a.name===j.name))),L=j.uniqueId?a.find((a=>a.uniqueId===j.uniqueId)):a[0]}else if(G(e))L=function(a,c){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===a)return q.Vector2.qo(c);if("Hc"===a)return o&&(c[2]*=-1),q.Hc.qo(c);if("Vector4"===a)return q.Vector4.qo(c);if("Quaternion"===a)return o&&(c[2]*=-1,c[3]*=-1),q.Quaternion.qo(c);if("oo"===a)return new s.oo(c[0],c[1],c[2]);if("Yc"===a)return new s.Yc(c[0],c[1],c[2],c[3]);throw new Error(`Unknown vector class name ${a}`)}(e,j.value);else if(function(a){return"AnimationGroup"===a}(e)){const a=T.animationGroups.filter((a=>a.name===j.name));L=1===a.length?a[0]:a.find((a=>a.uniqueId===j.uniqueId))}else L="Matrix"===e?q.Matrix.qo(j.value):"Matrix2D"===e?new p.c(j.value):"Matrix3D"===e?new p.e(j.value):"FlowGraphInteger"===e?t.c.FromValue(j.value):"number"===e||"string"===e||"boolean"===e?j.value[0]:j&&void 0!==j.value?j.value:Array.isArray(j)?j.reduce(((a,c)=>c.eventData?(a[c.id]={type:(0,i.G)(c.type)},"undefined"!==typeof c.value&&(a[c.id].value=C("value",c,o,T)),a):a),{}):j;return L}function j(a){return"FlowGraphJsonPointerParserBlock"===a}},14431:(a,c,o)=>{"use strict";function s(a,c){return!(!a.parent||a.parent!==c&&!s(a.parent,c))}function q(a){if(a.getClassName)return a.getClassName()}function t(a,c){return a===c&&("Vector2"===a||"Hc"===a||"Vector4"===a||"Quaternion"===a)}function i(a,c){return a===c&&("Matrix"===a||"Matrix2D"===a||"Matrix3D"===a)}function p(a,c){return"FlowGraphInteger"===a&&"FlowGraphInteger"===c}function G(a,c){const o="number"===typeof a||"number"===typeof(null===a||void 0===a?void 0:a.value);return o&&!c?!isNaN(T(a)):o}function T(a){return"number"===typeof a?a:a.value}o.d(c,{d:()=>p,e:()=>i,f:()=>t,g:()=>q,k:()=>s,m:()=>T,n:()=>G})},14788:(a,c,o)=>{"use strict";o.r(c),o.d(c,{SceneInstrumentation:()=>t});var s=o(12637),q=o(13023);class t{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(a){a!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=a,a?(this._onBeforeActiveMeshesEvaluationObserver=this.ao.onBeforeActiveMeshesEvaluationObservable.add((()=>{s.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.ao.onAfterActiveMeshesEvaluationObservable.add((()=>{s.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.ao.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ao.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(a){a!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=a,a?(this._onBeforeRenderTargetsRenderObserver=this.ao.onBeforeRenderTargetsRenderObservable.add((()=>{s.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.ao.onAfterRenderTargetsRenderObservable.add((()=>{s.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.ao.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ao.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(a){a!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=a,a?(this._onBeforeParticlesRenderingObserver=this.ao.onBeforeParticlesRenderingObservable.add((()=>{s.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.ao.onAfterParticlesRenderingObservable.add((()=>{s.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.ao.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ao.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(a){a!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=a,this.ao.spriteManagers&&(a?(this._onBeforeSpritesRenderingObserver=this.ao.onBeforeSpritesRenderingObservable.add((()=>{s.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.ao.onAfterSpritesRenderingObservable.add((()=>{s.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.ao.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.ao.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(a){a!==this._capturePhysicsTime&&this.ao.onBeforePhysicsObservable&&(this._capturePhysicsTime=a,a?(this._onBeforePhysicsObserver=this.ao.onBeforePhysicsObservable.add((()=>{s.Tools.StartPerformanceCounter("ip"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.ao.onAfterPhysicsObservable.add((()=>{s.Tools.EndPerformanceCounter("ip"),this._physicsTime.endMonitoring()}))):(this.ao.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.ao.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(a){a!==this._captureAnimationsTime&&(this._captureAnimationsTime=a,a?this._onAfterAnimationsObserver=this.ao.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.ao.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(a){this._captureFrameTime=a}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(a){this._captureInterFrameTime=a}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(a){a!==this._captureRenderTime&&(this._captureRenderTime=a,a?(this._onBeforeDrawPhaseObserver=this.ao.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),s.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.ao.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),s.Tools.EndPerformanceCounter("Main render")}))):(this.ao.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ao.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(a){a!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=a,a?(this._onBeforeCameraRenderObserver=this.ao.onBeforeCameraRenderObservable.add((a=>{this._cameraRenderTime.beginMonitoring(),s.Tools.StartPerformanceCounter(`Rendering camera ${a.name}`)})),this._onAfterCameraRenderObserver=this.ao.onAfterCameraRenderObservable.add((a=>{this._cameraRenderTime.endMonitoring(!1),s.Tools.EndPerformanceCounter(`Rendering camera ${a.name}`)}))):(this.ao.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ao.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.ao.getEngine()._drawCalls}constructor(a){this.ao=a,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new q.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new q.c,this._captureFrameTime=!1,this._frameTime=new q.c,this._captureRenderTime=!1,this._renderTime=new q.c,this._captureInterFrameTime=!1,this._interFrameTime=new q.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new q.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new q.c,this._capturePhysicsTime=!1,this._physicsTime=new q.c,this._captureAnimationsTime=!1,this._animationsTime=new q.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new q.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=a.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(s.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.ao.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=a.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(s.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ec(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ec(),this._captureParticlesRenderTime&&this._particlesRenderTime.ec(),this._captureSpritesRenderTime&&this._spritesRenderTime.ec(),this._captureRenderTime&&this._renderTime.ec(),this._captureCameraRenderTime&&this._cameraRenderTime.ec()}))}dispose(){this._disposed||(this.ao.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.ao.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ao.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.ao.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ao.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.ao.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.ao.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ao.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.ao.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.ao.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.ao.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ao.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.ao.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.ao.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.ao.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.ao.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ao.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.ao=null,this._disposed=!0)}}},14373:(a,c,o)=>{"use strict";o.d(c,{c:()=>C});var s=o(12798),q=o(12800),t=o(12810),i=o(13211),p=o(13344),G=o(13392),T=o(12776);i.b.AddNodeConstructor("Light_Type_1",((a,c)=>()=>new C(a,t.Hc.Zero(),c)));class C extends G.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(a){this._shadowFrustumSize=a,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(a){this._shadowOrthoScale=a,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(a){this._orthoLeft=a}get orthoRight(){return this._orthoRight}set orthoRight(a){this._orthoRight=a}get orthoTop(){return this._orthoTop}set orthoTop(a){this._orthoTop=a}get orthoBottom(){return this._orthoBottom}set orthoBottom(a){this._orthoBottom=a}constructor(a,c,o){super(a,o),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=c.scale(-1),this.direction=c}getClassName(){return"ce"}getTypeID(){return p.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(a,c,o){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(a):this._setDefaultAutoExtendShadowProjectionMatrix(a,c,o)}_setDefaultFixedFrustumShadowProjectionMatrix(a){const c=this.Za().activeCamera;c&&t.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:c.rc,void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,a,this.Za().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(a,c,o){const s=this.Za().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const a=t.Hc.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let s=Number.MAX_VALUE,q=-Number.MAX_VALUE;for(let i=0;i<o.length;i++){const p=o[i];if(!p)continue;const G=p.getBoundingInfo().boundingBox;for(let o=0;o<G.vectorsWorld.length;o++)t.Hc.TransformCoordinatesToRef(G.vectorsWorld[o],c,a),a.x<this._orthoLeft&&(this._orthoLeft=a.x),a.y<this._orthoBottom&&(this._orthoBottom=a.y),a.x>this._orthoRight&&(this._orthoRight=a.x),a.y>this._orthoTop&&(this._orthoTop=a.y),this.autoCalcShadowZBounds&&(a.z<s&&(s=a.z),a.z>q&&(q=a.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=s,this._shadowMaxZ=q)}const q=this._orthoRight-this._orthoLeft,i=this._orthoTop-this._orthoBottom,p=void 0!==this.shadowMinZ?this.shadowMinZ:(null===s||void 0===s?void 0:s.rc)||0,G=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===s||void 0===s?void 0:s.maxZ)||1e4,T=this.Za().getEngine().o;t.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-q*this.shadowOrthoScale,this._orthoRight+q*this.shadowOrthoScale,this._orthoBottom-i*this.shadowOrthoScale,this._orthoTop+i*this.shadowOrthoScale,T?G:p,T?p:G,a,this.Za().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(a,c){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,c),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,c),this)}transferToNodeMaterialEffect(a,c){return this.computeTransformedInformation()?(a.setFloat3(c,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(a.setFloat3(c,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(a){const c=this._scene.getEngine();return!c.o&&c.isNDCHalfZRange?0:1}getDepthMaxZ(a){const c=this._scene.getEngine();return c.o&&c.isNDCHalfZRange?0:1}prepareLightSpecificDefines(a,c){a["DIRLIGHT"+c]=!0}}(0,s.d)([(0,q.E)()],C.prototype,"shadowFrustumSize",null),(0,s.d)([(0,q.E)()],C.prototype,"shadowOrthoScale",null),(0,s.d)([(0,q.E)()],C.prototype,"autoUpdateExtends",void 0),(0,s.d)([(0,q.E)()],C.prototype,"autoCalcShadowZBounds",void 0),(0,s.d)([(0,q.E)("orthoLeft")],C.prototype,"_orthoLeft",void 0),(0,s.d)([(0,q.E)("orthoRight")],C.prototype,"_orthoRight",void 0),(0,s.d)([(0,q.E)("orthoTop")],C.prototype,"_orthoTop",void 0),(0,s.d)([(0,q.E)("orthoBottom")],C.prototype,"_orthoBottom",void 0),(0,T.d)("BABYLON.DirectionalLight",C)},14966:(a,c,o)=>{"use strict";o.d(c,{c:()=>C});var s=o(12798),q=o(12800),t=o(12810),i=o(12858),p=o(13211),G=o(13344),T=o(12776);p.b.AddNodeConstructor("Light_Type_3",((a,c)=>()=>new C(a,t.Hc.Zero(),c)));class C extends G.e{constructor(a,c,o){super(a,o),this.groundColor=new i.oo(0,0,0),this.direction=c||t.Hc.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"oe"}setDirectionToTarget(a){return this.direction=t.Hc.Normalize(a.vc(t.Hc.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(a,c){const o=t.Hc.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",o.x,o.y,o.z,0,c),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.bc),c),this}transferToNodeMaterialEffect(a,c){const o=t.Hc.Normalize(this.direction);return a.setFloat3(c,o.x,o.y,o.z),this}Rc(){return this._worldMatrix||(this._worldMatrix=t.Matrix.Identity()),this._worldMatrix}getTypeID(){return G.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(a,c){a["HEMILIGHT"+c]=!0}}(0,s.d)([(0,q.j)()],C.prototype,"groundColor",void 0),(0,s.d)([(0,q.B)()],C.prototype,"direction",void 0),(0,T.d)("BABYLON.HemisphericLight",C)},14347:(a,c,o)=>{"use strict";o.d(c,{d:()=>j});var s=o(12798),q=o(12800),t=o(12810),i=o(13211),p=o(13344),G=o(13392),T=o(12796),C=o(12776);i.b.AddNodeConstructor("Light_Type_2",((a,c)=>()=>new j(a,t.Hc.Zero(),t.Hc.Zero(),0,0,c)));class j extends G.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(a){this._iesProfileTexture!==a&&(this._iesProfileTexture=a,this._iesProfileTexture&&j._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(a){this._angle=a,this._cosHalfAngle=Math.cos(.5*a),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(a){this._innerAngle=a,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(a){this._shadowAngleScale=a,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(a){this._projectionTextureLightNear=a,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(a){this._projectionTextureLightFar=a,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(a){this._projectionTextureUpDirection=a,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(a){this._projectionTexture!==a&&(this._projectionTexture=a,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(j._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):j._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(a){return void 0!==a.onGeneratedObservable}static _IsTexture(a){return void 0!==a.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(a){this._projectionTextureProjectionLightMatrix=a,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(a,c,o,s,q,i){super(a,i),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=t.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=t.Hc.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=t.Hc.Zero(),this._projectionTextureViewLightMatrix=t.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=t.Matrix.Zero(),this._projectionTextureScalingMatrix=t.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=c,this.direction=o,this.angle=s,this.exponent=q}getClassName(){return"SpotLight"}getTypeID(){return p.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(a){super._setDirection(a),this._projectionTextureViewLightDirty=!0}_setPosition(a){super._setPosition(a),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(a,c,o){const s=this.Za().activeCamera;if(!s)return;this._shadowAngleScale=this._shadowAngleScale||1;const q=this._shadowAngleScale*this._angle,i=void 0!==this.shadowMinZ?this.shadowMinZ:s.rc,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:s.maxZ,G=this.Za().getEngine().o;t.Matrix.PerspectiveFovLHToRef(q,1,G?p:i,G?i:p,a,!0,this._scene.getEngine().isNDCHalfZRange,void 0,G)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),t.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const a=this.projectionTextureLightFar,c=this.projectionTextureLightNear,o=a/(a-c),s=-o*c,q=1/Math.tan(this._angle/2);t.Matrix.FromValuesToRef(q/1,0,0,0,0,q,0,0,0,0,o,1,0,0,s,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof T.e){const a=this._projectionTexture.uScale/2,c=this._projectionTexture.vScale/2;t.Matrix.FromValuesToRef(a,0,0,0,0,c,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(a,c){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),a.setMatrix("textureProjectionMatrix"+c,this._projectionTextureMatrix),a.setTexture("projectionLightTexture"+c,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&a.setTexture("iesLightTexture"+c,this._iesProfileTexture),this}transferToEffect(a,c){let o;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,c),o=t.Hc.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,c),o=t.Hc.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",o.x,o.y,o.z,this._cosHalfAngle,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,c),this}transferToNodeMaterialEffect(a,c){let o;return o=this.computeTransformedInformation()?t.Hc.Normalize(this.transformedDirection):t.Hc.Normalize(this.direction),this.Za().useRightHandedSystem?a.setFloat3(c,-o.x,-o.y,-o.z):a.setFloat3(c,o.x,o.y,o.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(a){const c=this._scene.getEngine(),o=void 0!==this.shadowMinZ?this.shadowMinZ:(null===a||void 0===a?void 0:a.rc)??0;return c.o&&c.isNDCHalfZRange?o:this._scene.getEngine().isNDCHalfZRange?0:o}getDepthMaxZ(a){const c=this._scene.getEngine(),o=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===a||void 0===a?void 0:a.maxZ)??1e4;return c.o&&c.isNDCHalfZRange?0:o}prepareLightSpecificDefines(a,c){a["SPOTLIGHT"+c]=!0,a["PROJECTEDLIGHTTEXTURE"+c]=!(!this.projectionTexture||!this.projectionTexture.isReady()),a["IESLIGHTTEXTURE"+c]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,s.d)([(0,q.E)()],j.prototype,"angle",null),(0,s.d)([(0,q.E)()],j.prototype,"innerAngle",null),(0,s.d)([(0,q.E)()],j.prototype,"shadowAngleScale",null),(0,s.d)([(0,q.E)()],j.prototype,"exponent",void 0),(0,s.d)([(0,q.E)()],j.prototype,"projectionTextureLightNear",null),(0,s.d)([(0,q.E)()],j.prototype,"projectionTextureLightFar",null),(0,s.d)([(0,q.E)()],j.prototype,"projectionTextureUpDirection",null),(0,s.d)([(0,q.v)("projectedLightTexture")],j.prototype,"_projectionTexture",void 0),(0,C.d)("BABYLON.SpotLight",j)},14052:(a,c,o)=>{"use strict";o.d(c,{e:()=>i,h:()=>t,k:()=>p});const s={},q={};function t(a,c){s[a]=c}function i(a,c){q[a]=c}function p(a){return q[a]?q[a]:null}},13934:(a,c,o)=>{"use strict";o.d(c,{d:()=>Z,g:()=>O});var s,q=o(12637),t=o(12639),i=o(13045),p=o(12680),G=o(12649),T=o(13253),C=o(12689),j=o(12691),L=o(12779),e=o(12721),g=o(12672);!function(a){a[a.Clean=0]="Clean",a[a.Stop=1]="Stop",a[a.Sync=2]="Sync",a[a.NoSync=3]="NoSync"}(s||(s={}));const M=new t.d,N={};let y=!1;function k(){return N[".babylon"]}function n(a,c){const o=N[a];return o||(G.c.Warn("Unable to find a plugin to load "+a+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),c?k():void 0)}function f(a,c,o){let s="Unable to load from "+(a.rawData?"binary data":a.url);return c?s+=`: ${c}`:o&&(s+=`: ${o}`),s}async function J(a,c,o,s,q,t,i,p,G){var T;const j="data:"===(L=a.url).substring(0,5)?L.substring(5):null;var L;if(a.rawData&&!i)throw"When using ArrayBufferView to load data the file extension must be provided.";const y=j||i?"":function(a){const c=a.indexOf("?");-1!==c&&(a=a.substring(0,c));const o=a.lastIndexOf(".");return a.substring(o,a.length).toLowerCase()}(a.url);let f=i?n(i,!0):j?function(a){for(const c in N){const o=N[c].plugin;if(o.canDirectLoad&&o.canDirectLoad(a))return N[c]}return k()}(a.url):n(y,!1);if(!f&&y){if(a.url&&!a.url.startsWith("blob:")){const c=await async function(a,c){const o=c.method||"GET";return await new Promise(((s,q)=>{const t=new g.b;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const a={};if(c.responseHeaders)for(const o of c.responseHeaders)a[o]=t.getResponseHeader(o)||"";s({response:t.response,headerValues:a})}else q(`Unable to fetch data from ${a}. Error code: ${t.status}`)})),t.open(o,a),t.send()}))}(a.url,{method:"HEAD",responseHeaders:["Content-Type"]}),o=c.headerValues?c.headerValues["Content-Type"]:"";o&&(f=function(a){for(const c in N){const o=N[c];if(o.mimeType===a)return o}}(o))}f||(f=k())}if(!f)throw new Error(`No plugin or fallback for ${i??a.url}`);if(!1===(null===G||void 0===G||null===(T=G[f.plugin.name])||void 0===T?void 0:T.enabled))throw new Error(`The '${f.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(a.rawData&&!f.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(a=>{if(f.plugin.createPlugin){const c=f.plugin.createPlugin(G??{});return c instanceof Promise?(c.then(a).catch((a=>{q("Error instantiating plugin.",a)})),null):(a(c),c)}return a(f.plugin),f.plugin})((G=>{var T;if(!G)throw`The loader plugin corresponding to the '${i}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(M.notifyObservers(G),j&&(G.canDirectLoad&&G.canDirectLoad(a.url)||!(0,C.h)(a.url))){if(G.directLoad){const a=G.directLoad(c,j);a instanceof Promise?a.then((a=>{o(G,a)})).catch((a=>{q("Error in directLoad of _loadData: "+a,a)})):o(G,a)}else o(G,j);return}const L=f.isBinary,g=(a,s)=>{c.L?q("Scene has been disposed"):o(G,a,s)};let N=null,y=!1;null===(T=G.gc)||void 0===T||T.add((()=>{y=!0,N&&(N.abort(),N=null),t()}));const k=()=>{if(y)return;const o=(a,c)=>{q(null===a||void 0===a?void 0:a.statusText,c)};if(!G.loadFile&&a.rawData)throw"Plugin does not support loading ArrayBufferView.";N=G.loadFile?G.loadFile(c,a.rawData||a.file||a.url,a.rootUrl,g,s,L,o,p):c._loadFile(a.file||a.url,g,s,!0,L,o)},n=c.getEngine();let J=n.enableOfflineSupport;if(J){let o=!1;for(const s of c.disableOfflineSupportExceptionRules)if(s.test(a.url)){o=!0;break}J=!o}J&&e.b.OfflineProviderFactory?c.offlineProvider=e.b.OfflineProviderFactory(a.url,k,n.disableManifestCheck):k()}))}function w(a,c){let o,s,t=null,i=null;if(c)if(c.name)o=`file:${c.name}`,s=c.name,t=c;else if(ArrayBuffer.isView(c))o="",s=(0,L.d)(),i=c;else if(c.startsWith("data:"))o=c,s="";else if(a){const t=c;if("/"===t.substring(0,1))return q.Tools.Error("Wrong sceneFilename parameter"),null;o=a+t,s=t}else o=c,s=q.Tools.GetFilename(c),a=q.Tools.GetFolderPath(c);else o=a,s=q.Tools.GetFilename(a),a=q.Tools.GetFolderPath(a);return{url:o,rootUrl:a,name:s,file:t,rawData:i}}function Z(a){if("string"===typeof a.extensions){const c=a.extensions;N[c.toLowerCase()]={plugin:a,isBinary:!1}}else{const c=a.extensions,o=Object.keys(c);for(const s of o)N[s.toLowerCase()]={plugin:a,isBinary:c[s].isBinary,mimeType:c[s].mimeType}}}async function h(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.b.LastCreatedScene,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!s)return G.c.Error("No scene available to import mesh to"),null;const e=w(c,o);if(!e)return null;const g={};s.addPendingData(g);const M=()=>{s.removePendingData(g)},N=(a,c)=>{const o=f(e,a,c);i?i(s,o,new j.h(o,j.f.SceneLoaderError,c)):G.c.Error(o),M()},y=t?a=>{try{t(a)}catch(c){N("Error in onProgress callback: "+c,c)}}:void 0,k=(a,c,o,t,i,p,G,T)=>{if(s.importedMeshesFiles.push(e.url),q)try{q(a,c,o,t,i,p,G,T)}catch(C){N("Error in onSuccess callback: "+C,C)}s.removePendingData(g)};return await J(e,s,((c,o,q)=>{if(c.rewriteRootURL&&(e.rootUrl=c.rewriteRootURL(e.rootUrl,q)),c.importMesh){const q=[],t=[],i=[];if(!c.importMesh(a,s,o,e.rootUrl,q,t,i,N))return;s.loadingPluginName=c.name,k(q,t,i,[],[],[],[],[])}else{c.importMeshAsync(a,s,o,e.rootUrl,y,e.name).then((a=>{s.loadingPluginName=c.name,k(a.meshes,a.IL,a.skeletons,a.animationGroups,a.transformNodes,a.geometries,a.lights,a.spriteManagers)})).catch((a=>{N(a.message,a)}))}}),y,N,M,T,C,L)}async function U(a,c,o,s,q,t,i,p){return await new Promise(((G,T)=>{try{h(a,c,o,s,((a,c,o,s,q,t,i,p)=>{G({meshes:a,IL:c,skeletons:o,animationGroups:s,transformNodes:q,geometries:t,lights:i,spriteManagers:p})}),q,((a,c,o)=>{T(o||new Error(c))}),t,i,p).catch(T)}catch(j){T(j)}}))}async function S(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.b.LastCreatedEngine,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};o?await x(a,c,new i.e(o),s,t,G,T,C,j):q.Tools.Error("No engine available")}async function r(a,c,o,s,q,t,i){return await new Promise(((p,G)=>{S(a,c,o,(a=>{p(a)}),s,((a,c,o)=>{G(o||new Error(c))}),q,t,i)}))}async function x(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.b.LastCreatedScene,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!o)return G.c.Error("No scene available to append to"),null;const e=w(a,c);if(!e)return null;const g={};o.addPendingData(g);const M=()=>{o.removePendingData(g)};T.c.ShowLoadingScreen&&!y&&(y=!0,o.getEngine().displayLoadingUI(),o.executeWhenReady((()=>{o.getEngine().hideLoadingUI(),y=!1})));const N=(a,c)=>{const s=f(e,a,c);t?t(o,s,new j.h(s,j.f.SceneLoaderError,c)):G.c.Error(s),M()},k=q?a=>{try{q(a)}catch(c){N("Error in onProgress callback",c)}}:void 0,n=()=>{if(s)try{s(o)}catch(a){N("Error in onSuccess callback",a)}o.removePendingData(g)};return await J(e,o,((a,c)=>{if(a.load){if(!a.load(o,c,e.rootUrl,N))return;o.loadingPluginName=a.name,n()}else{a.loadAsync(o,c,e.rootUrl,k,e.name).then((()=>{o.loadingPluginName=a.name,n()})).catch((a=>{N(a.message,a)}))}}),k,N,M,i,C,L)}async function R(a,c,o,s,q,t,i){return await new Promise(((p,G)=>{try{x(a,c,o,(a=>{p(a)}),s,((a,c,o)=>{G(o||new Error(c))}),q,t,i).catch(G)}catch(j){G(j)}}))}async function d(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.b.LastCreatedScene,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!o)return G.c.Error("No scene available to load asset container to"),null;const L=w(a,c);if(!L)return null;const e={};o.addPendingData(e);const g=()=>{o.removePendingData(e)},M=(a,c)=>{const s=f(L,a,c);t?t(o,s,new j.h(s,j.f.SceneLoaderError,c)):G.c.Error(s),g()},N=q?a=>{try{q(a)}catch(c){M("Error in onProgress callback",c)}}:void 0,y=a=>{if(s)try{s(a)}catch(c){M("Error in onSuccess callback",c)}o.removePendingData(e)};return await J(L,o,((a,c)=>{if(a.loadAssetContainer){const s=a.loadAssetContainer(o,c,L.rootUrl,M);if(!s)return;s.populateRootNodes(),o.loadingPluginName=a.name,y(s)}else if(a.loadAssetContainerAsync){a.loadAssetContainerAsync(o,c,L.rootUrl,N,L.name).then((c=>{c.populateRootNodes(),o.loadingPluginName=a.name,y(c)})).catch((a=>{M(a.message,a)}))}else M("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),N,M,g,i,T,C)}async function X(a,c,o,s,q,t,i){return await new Promise(((p,G)=>{try{d(a,c,o,(a=>{p(a)}),s,((a,c,o)=>{G(o||new Error(c))}),q,t,i).catch(G)}catch(j){G(j)}}))}async function W(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.b.LastCreatedScene,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,L=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",e=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!o)return void G.c.Error("No scene available to load animations to");if(s){for(const s of o.animatables)s.reset();o.stopAllAnimations();const a=o.animationGroups.slice();for(const o of a)o.dispose();const c=o.getNodes();for(const o of c)o.animations&&(o.animations=[])}else switch(q){case 0:const a=o.animationGroups.slice();for(const c of a)c.dispose();break;case 1:for(const c of o.animationGroups)c.stop();break;case 2:for(const c of o.animationGroups)c.reset(),c.restart();break;case 3:break;default:return void G.c.Error("Unknown animation group loading mode value '"+q+"'")}const g=o.animatables.length;await d(a,c,o,(a=>{a.mergeAnimationsTo(o,o.animatables.slice(g),t),a.dispose(),o.onAnimationFileImportedObservable.notifyObservers(o),i&&i(o)}),T,C,j,L,e)}async function F(a,c,o,s,q,t,i,p,G,T){return await new Promise(((C,L)=>{try{W(a,c,o,s,q,t,(a=>{C(a)}),i,((a,c,o)=>{L(o||new Error(c))}),p,G,T).catch(L)}catch(j){L(j)}}))}class O{static get ForceFullSceneLoadingForIncremental(){return T.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(a){T.c.ForceFullSceneLoadingForIncremental=a}static get ShowLoadingScreen(){return T.c.ShowLoadingScreen}static set ShowLoadingScreen(a){T.c.ShowLoadingScreen=a}static get loggingLevel(){return T.c.loggingLevel}static set loggingLevel(a){T.c.loggingLevel=a}static get CleanBoneMatrixWeights(){return T.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(a){T.c.CleanBoneMatrixWeights=a}static GetDefaultPlugin(){return k()}static GetPluginForExtension(a){var c;return null===(c=n(a,!0))||void 0===c?void 0:c.plugin}static IsPluginForExtensionAvailable(a){return function(a){return!!N[a]}(a)}static RegisterPlugin(a){Z(a)}static ImportMesh(a,c,o,s,q,t,i,G,T){h(a,c,o,s,q,t,i,G,T).catch((a=>null===i||void 0===i?void 0:i(p.b.LastCreatedScene,null===a||void 0===a?void 0:a.message,a)))}static async ImportMeshAsync(a,c,o,s,q,t,i){return await U(a,c,o,s,q,t,i)}static Load(a,c,o,s,q,t,i,G){S(a,c,o,s,q,t,i,G).catch((a=>null===t||void 0===t?void 0:t(p.b.LastCreatedScene,null===a||void 0===a?void 0:a.message,a)))}static async LoadAsync(a,c,o,s,q,t){return await r(a,c,o,s,q,t)}static Append(a,c,o,s,q,t,i,G){x(a,c,o,s,q,t,i,G).catch((a=>null===t||void 0===t?void 0:t(o??p.b.LastCreatedScene,null===a||void 0===a?void 0:a.message,a)))}static async AppendAsync(a,c,o,s,q,t){return await R(a,c,o,s,q,t)}static LoadAssetContainer(a,c,o,s,q,t,i,G){d(a,c,o,s,q,t,i,G).catch((a=>null===t||void 0===t?void 0:t(o??p.b.LastCreatedScene,null===a||void 0===a?void 0:a.message,a)))}static async LoadAssetContainerAsync(a,c,o,s,q,t){return await X(a,c,o,s,q,t)}static ImportAnimations(a,c,o,s,q,t,i,G,T,C,j){W(a,c,o,s,q,t,i,G,T,C,j).catch((a=>null===T||void 0===T?void 0:T(o??p.b.LastCreatedScene,null===a||void 0===a?void 0:a.message,a)))}static async ImportAnimationsAsync(a,c,o,s,q,t,i,p,G,T,C){return await F(a,c,o,s,q,t,p,T,C)}}O.NO_LOGGING=0,O.MINIMAL_LOGGING=1,O.SUMMARY_LOGGING=2,O.DETAILED_LOGGING=3,O.OnPluginActivatedObservable=M},14358:(a,c,o)=>{"use strict";o.d(c,{b:()=>L});var s=o(12798),q=o(12800),t=o(12637),i=o(12810),p=o(12833),G=o(12796),T=o(12776),C=o(12639),j=o(12845);o(14365);class L extends p.e{set boundingBoxSize(a){if(this._boundingBoxSize&&this._boundingBoxSize.equals(a))return;this._boundingBoxSize=a;const c=this.Za();c&&c.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(a){this._rotationY=a,this.setReflectionTextureMatrix(i.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(a,c,o){let s="";for(const q of a)s+=q;return new L(s,c,null,o,a)}static CreateFromPrefilteredData(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=c.useDelayedTextureLoading;c.useDelayedTextureLoading=!1;const t=new L(a,c,null,!1,null,null,null,void 0,!0,o,s);return c.useDelayedTextureLoading=q,t}constructor(a,c){var o;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,L=arguments.length>8&&void 0!==arguments[8]&&arguments[8],e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]&&arguments[10],M=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,N=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,y=arguments.length>13?arguments[13]:void 0,k=arguments.length>14?arguments[14]:void 0;super(c),this.onLoadObservable=new C.d,this.boundingBoxPosition=i.Hc.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new i.Matrix,this._buffer=null,this.name=a,this.url=a,this._noMipmap=q,this.Uc=!1,this.isCube=!0,this._textureMatrix=i.Matrix.Identity(),this.coordinatesMode=G.e.CUBIC_MODE;let n=null,f=null;null===s||Array.isArray(s)?(this._noMipmap=q,this._format=j,this._createPolynomials=g,n=s,this._loaderOptions=y,this._useSRGBBuffer=k,this._lodScale=M,this._lodOffset=N):(n=s.extensions??null,this._noMipmap=s.noMipmap??!1,t=s.files??null,f=s.buffer??null,this._format=s.format??5,L=s.prefiltered??!1,e=s.forcedExtension??null,this._createPolynomials=s.createPolynomials??!1,this._lodScale=s.lodScale??.8,this._lodOffset=s.lodOffset??0,this._loaderOptions=s.loaderOptions,this._useSRGBBuffer=s.useSRGBBuffer,p=s.A??null,T=s.onError??null),(a||t)&&this.updateURL(a,e,p,L,T,n,null===(o=this.Za())||void 0===o?void 0:o.useDelayedTextureLoading,t,f)}getClassName(){return"CubeTexture"}updateURL(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=a),this.url=a,c&&(this._forcedExtension=c);const T=a.lastIndexOf("."),C=c||(T>-1?a.substring(T).toLowerCase():""),j=0===C.indexOf(".dds"),L=0===C.indexOf(".env"),e=0===C.indexOf(".basis");if(L?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=s,s&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),p)this._files=p;else if(e||L||j||t||(t=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,t){for(let c=0;c<t.length;c++)this._files.push(a+t[c]);this._extensions=t}this._buffer=G,i?(this.delayLoadState=4,this._delayedOnLoad=o,this._delayedOnError=q):this._loadTexture(o,q)}delayLoad(a){4===this.delayLoadState&&(a&&(this._forcedExtension=a),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(a){var c,o;if(a.updateFlag===this._textureMatrix.updateFlag)return;a.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(o=this.Za())||void 0===o||o.markAllMaterialsAsDirty(1,(a=>-1!==a.getActiveTextures().indexOf(this))));if(this._textureMatrix=a,null===(c=this.Za())||void 0===c||!c.useRightHandedSystem)return;const s=i.TmpVectors.Hc[0],q=i.TmpVectors.Quaternion[0],t=i.TmpVectors.Hc[1];this._textureMatrix.decompose(s,q,t),q.z*=-1,q.w*=-1,i.Matrix.ComposeToRef(s,q,t,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var a;return null!==(a=this.Za())&&void 0!==a&&a.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=this.Za(),s=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const q=()=>{var c;(this.onLoadObservable.notifyObservers(this),s)&&(s.dispose(),null===(c=this.Za())||void 0===c||c.markAllMaterialsAsDirty(1));a&&a()},i=(a,o)=>{this._loadingError=!0,this._errorObject={message:a,exception:o},c&&c(a,o),G.e.OnTextureLoadErrorObservable.notifyObservers(this)};var p;this._texture?this._texture.isReady?t.Tools.SetImmediate((()=>q())):this._texture.onLoadedObservable.add((()=>q())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,o,this._lodScale,this._lodOffset,a,i,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,o,this._files,this._noMipmap,a,i,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(p=this._texture)||void 0===p||p.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(a,c,o){const s=j.d.Parse((()=>{let s=!1;return a.prefiltered&&(s=a.prefiltered),new L(o+(a.url??a.name),c,a.extensions,!1,a.files||null,null,null,void 0,s,a.forcedExtension)}),a,c);if(a.boundingBoxPosition&&(s.boundingBoxPosition=i.Hc.qo(a.boundingBoxPosition)),a.boundingBoxSize&&(s.boundingBoxSize=i.Hc.qo(a.boundingBoxSize)),a.animations)for(let q=0;q<a.animations.length;q++){const c=a.animations[q],o=(0,T.c)("BABYLON.Animation");o&&s.animations.push(o.Parse(c))}return s}clone(){let a=0;const c=j.d.Clone((()=>{const c=new L(this.url,this.Za()||this._getEngine(),this._extensions,this._noMipmap,this._files);return a=c.uniqueId,c}),this);return c.uniqueId=a,c}}(0,s.d)([(0,q.E)()],L.prototype,"url",void 0),(0,s.d)([(0,q.B)()],L.prototype,"boundingBoxPosition",void 0),(0,s.d)([(0,q.B)()],L.prototype,"boundingBoxSize",null),(0,s.d)([(0,q.E)("rotationY")],L.prototype,"rotationY",null),(0,s.d)([(0,q.E)("files")],L.prototype,"_files",void 0),(0,s.d)([(0,q.E)("forcedExtension")],L.prototype,"_forcedExtension",void 0),(0,s.d)([(0,q.E)("extensions")],L.prototype,"_extensions",void 0),(0,s.d)([(0,q.s)("textureMatrix")],L.prototype,"_textureMatrix",void 0),(0,s.d)([(0,q.s)("textureMatrixRefraction")],L.prototype,"_textureMatrixRefraction",void 0),G.e._CubeTextureParser=L.Parse,(0,T.d)("BABYLON.CubeTexture",L)},14974:(a,c,o)=>{"use strict";o.d(c,{b:()=>G});var s=o(12649),q=o(12796),t=o(12787),i=o(12945),p=o(12757);i.ThinEngine.prototype.createDynamicTexture=function(a,c,o,s){const q=new p.b(this,4);return q.baseWidth=a,q.baseHeight=c,o&&(a=this.needPOTTextures?(0,t.d)(a,this._caps.maxTextureSize):a,c=this.needPOTTextures?(0,t.d)(c,this._caps.maxTextureSize):c),q.width=a,q.height=c,q.isReady=!1,q.generateMipMaps=o,q.samplingMode=s,this.updateTextureSamplingMode(s,q),this._internalTexturesCache.push(q),q},i.ThinEngine.prototype.updateDynamicTexture=function(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!a)return;const i=this._gl,p=i.TEXTURE_2D,G=this._bindTextureDirectly(p,a,!0,t);this._unpackFlipY(void 0===o?a.invertY:o),s&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const T=this._getWebGLTextureType(a.type),C=this._getInternalFormat(q||a.format),j=this._getRGBABufferInternalSizedFormat(a.type,C);i.texImage2D(p,0,j,C,T,c),a.generateMipMaps&&i.generateMipmap(p),G||this._bindTextureDirectly(p,null),s&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),q&&(a.format=q),a._dynamicTextureSource=c,a._premulAlpha=s,a.invertY=o||!1,a.isReady=!0};class G extends q.e{constructor(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,p=arguments.length>6?arguments[6]:void 0;const G=!o||o._isScene;super(null,G?o:null===o||void 0===o?void 0:o.ao,G?!s:o,p,t,void 0,void 0,void 0,void 0,i),this.name=a,this.wrapU=q.e.CLAMP_ADDRESSMODE,this.wrapV=q.e.CLAMP_ADDRESSMODE,this._generateMipMaps=s;const T=this._getEngine();if(!T)return;if(c.getContext)this._canvas=c,this._ownCanvas=!1,this._texture=T.createDynamicTexture(this._canvas.width,this._canvas.height,s,t);else{this._canvas=T.createCanvas(1,1),this._ownCanvas=!0;const a=c;a.width||0===a.width?this._texture=T.createDynamicTexture(a.width,a.height,s,t):this._texture=T.createDynamicTexture(c,c,s,t)}const C=this.getSize();this._canvas.width!==C.width&&(this._canvas.width=C.width),this._canvas.height!==C.height&&(this._canvas.height=C.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(a){this._canvas.width=a.width,this._canvas.height=a.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(a.width,a.height,this._generateMipMaps,this.samplingMode)}scale(a){const c=this.getSize();c.width*=a,c.height*=a,this._recreate(c)}scaleTo(a,c){const o=this.getSize();o.width=a,o.height=c,this._recreate(o)}getContext(){return this._context}clear(a){const c=this.getSize();a&&(this._context.fillStyle=a),this._context.clearRect(0,0,c.width,c.height)}update(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===a||a,c,this._format||void 0,void 0,o)}drawText(a,c,o,s,q,t,i){let p=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const G=this.getSize();if(t&&(this._context.fillStyle=t,this._context.fillRect(0,0,G.width,G.height)),this._context.font=s,null===c||void 0===c){const o=this._context.measureText(a);c=(G.width-o.width)/2}if(null===o||void 0===o){const a=parseInt(s.replace(/\D/g,""));o=G.height/2+a/3.65}this._context.fillStyle=q||"",this._context.fillText(a,c,o),p&&this.update(i)}dispose(){var a,c;(super.dispose(),this._ownCanvas)&&(null===(a=this._canvas)||void 0===a||null===(c=a.remove)||void 0===c||c.call(a));this._canvas=null,this._context=null}clone(){const a=this.Za();if(!a)return this;const c=this.getSize(),o=new G(this.name,c,a,this._generateMipMaps);return o.Uc=this.Uc,o.level=this.level,o.wrapU=this.wrapU,o.wrapV=this.wrapV,o}serialize(){const a=this.Za();a&&!a.isReady()&&s.c.Warn("The scene must be ready before serializing the dynamic texture");const c=super.serialize();return G._IsCanvasElement(this._canvas)&&(c.base64String=this._canvas.toDataURL()),c.invertY=this._invertY,c.samplingMode=this.samplingMode,c}static _IsCanvasElement(a){return void 0!==a.toDataURL}_rebuild(){this.update()}}},14278:(a,c,o)=>{"use strict";o.d(c,{d:()=>q});var s=o(12796);class q extends s.e{get depth(){return this._depth}constructor(a,c,o,q,t,i){let p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7],T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:s.e.TRILINEAR_SAMPLINGMODE,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,j=arguments.length>10?arguments[10]:void 0;super(null,i,!p,G),this.format=t,this._texture=i.getEngine().createRawTexture2DArray(a,c,o,q,t,p,G,T,null,C,j),this._depth=q,this.is2DArray=!0}update(a){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,a,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(a,c,o,s,t){return new q(a,c,o,s,5,t,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14068:(a,c,o)=>{"use strict";o.d(c,{c:()=>p,d:()=>G,h:()=>t,j:()=>i});var s=o(12824),q=o(12810);function t(a,c){return`{X: ${a.x.toFixed(c)} Y: ${a.y.toFixed(c)}}`}function i(a,c){return`{X: ${a._x.toFixed(c)} Y: ${a._y.toFixed(c)} Z: ${a._z.toFixed(c)}}`}function p(a,c){return 2*Math.acos((0,s.Clamp)(q.Quaternion.Dot(a,c)))}function G(a,c){const o=new q.Quaternion;return function(a,c,o){const t=q.Hc.Cross(a,c),i=Math.acos((0,s.Clamp)(q.Hc.Dot(a,c),-1,1));q.Quaternion.RotationAxisToRef(t,i,o)}(a,c,o),o}},13895:(a,c,o)=>{"use strict";o.d(c,{d:()=>T});var s=o(12810),q=o(12858),t=o(13241),i=o(13224),p=o(12866);o(13901);function G(a){let c=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const o=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],t=[];let G=[];const T=a.width||a.size||1,C=a.height||a.size||1,j=a.depth||a.size||1,L=a.wrap||!1;let e=void 0===a.topBaseAt?1:a.topBaseAt,g=void 0===a.bottomBaseAt?0:a.bottomBaseAt;e=(e+4)%4,g=(g+4)%4;let M=[2,0,3,1][e],N=[2,0,1,3][g],y=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(L){c=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],y=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let a=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],o=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const s=[17,18,19,16],q=[22,23,20,21];for(;M>0;)a.unshift(a.pop()),s.unshift(s.pop()),M--;for(;N>0;)o.unshift(o.pop()),q.unshift(q.pop()),N--;a=a.flat(),o=o.flat(),y=y.concat(a).concat(o),c.push(s[0],s[2],s[3],s[0],s[1],s[2]),c.push(q[0],q[2],q[3],q[0],q[1],q[2])}const k=[T/2,C/2,j/2];G=y.reduce(((a,c,o)=>a.concat(c*k[o%3])),[]);const n=0===a.sideOrientation?0:a.sideOrientation||i.e.DEFAULTSIDE,f=a.faceUV||new Array(6),J=a.faceColors,w=[];for(let i=0;i<6;i++)void 0===f[i]&&(f[i]=new s.Vector4(0,0,1,1)),J&&void 0===J[i]&&(J[i]=new q.Yc(1,1,1,1));for(let s=0;s<6;s++)if(t.push(f[s].z,p.d?1-f[s].w:f[s].w),t.push(f[s].x,p.d?1-f[s].w:f[s].w),t.push(f[s].x,p.d?1-f[s].y:f[s].y),t.push(f[s].z,p.d?1-f[s].y:f[s].y),J)for(let a=0;a<4;a++)w.push(J[s].r,J[s].g,J[s].b,J[s].a);i.e._ComputeSides(n,G,c,o,t,a.frontUVs,a.backUVs);const Z=new i.e;if(Z.indices=c,Z.Ua=G,Z.Sa=o,Z.xa=t,J){const a=n===i.e.DOUBLESIDE?w.concat(w):w;Z.ra=a}return Z}function T(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new t.c(a,o);c.sideOrientation=t.c._GetDefaultSideOrientation(c.sideOrientation),s._originalBuilderSideOrientation=c.sideOrientation;return G(c).da(s,c.updatable),s}i.e.CreateBox=G,t.c.CreateBox=function(a,c){return T(a,{size:c,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14060:(a,c,o)=>{"use strict";o.d(c,{b:()=>p});var s=o(13241),q=o(13224),t=o(12866);function i(a){const c=[],o=[],s=[],i=[],p=a.radius||.5,G=a.tessellation||64,T=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1,C=0===a.sideOrientation?0:a.sideOrientation||q.e.DEFAULTSIDE;c.push(0,0,0),i.push(.5,.5);const j=2*Math.PI*T,L=1===T?j/G:j/(G-1);let e=0;for(let q=0;q<G;q++){const a=Math.cos(e),o=Math.sin(e),s=(a+1)/2,q=(1-o)/2;c.push(p*a,p*o,0),i.push(s,t.d?1-q:q),e+=L}1===T&&(c.push(c[3],c[4],c[5]),i.push(i[2],t.d?1-i[3]:i[3]));const g=c.length/3;for(let q=1;q<g-1;q++)o.push(q+1,0,q);q.e.ComputeNormals(c,o,s),q.e._ComputeSides(C,c,o,s,i,a.frontUVs,a.backUVs);const M=new q.e;return M.indices=o,M.Ua=c,M.Sa=s,M.xa=i,M}function p(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new s.c(a,o);c.sideOrientation=s.c._GetDefaultSideOrientation(c.sideOrientation),q._originalBuilderSideOrientation=c.sideOrientation;return i(c).da(q,c.updatable),q}q.e.CreateDisc=i,s.c.CreateDisc=function(a,c,o){return p(a,{radius:c,tessellation:o,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13901:(a,c,o)=>{"use strict";o.d(c,{f:()=>N,d:()=>k,h:()=>y});var s=o(12810),q=o(12858),t=o(13241),i=o(13224),p=o(12882);t.c._GroundMeshParser=(a,c)=>G.Parse(a,c);class G extends t.c{constructor(a,c){super(a,c),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=a,this._subdivisionsY=a,this.subdivide(a);const o=this;o.createOrUpdateSubmeshesOctree&&o.createOrUpdateSubmeshesOctree(c)}getHeightAtCoordinates(a,c){const o=this.getWorldMatrix(),q=s.TmpVectors.Matrix[5];o.invertToRef(q);const t=s.TmpVectors.Hc[8];if(s.Hc.TransformCoordinatesFromFloatsToRef(a,0,c,q,t),a=t.x,c=t.z,a<this._minX||a>=this._maxX||c<=this._minZ||c>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const i=this._getFacetAt(a,c),p=-(i.x*a+i.z*c+i.w)/i.y;return s.Hc.TransformCoordinatesFromFloatsToRef(0,p,0,o,t),t.y}getNormalAtCoordinates(a,c){const o=new s.Hc(0,1,0);return this.getNormalAtCoordinatesToRef(a,c,o),o}getNormalAtCoordinatesToRef(a,c,o){const q=this.getWorldMatrix(),t=s.TmpVectors.Matrix[5];q.invertToRef(t);const i=s.TmpVectors.Hc[8];if(s.Hc.TransformCoordinatesFromFloatsToRef(a,0,c,t,i),a=i.x,c=i.z,a<this._minX||a>this._maxX||c<this._minZ||c>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const p=this._getFacetAt(a,c);return s.Hc.TransformNormalFromFloatsToRef(p.x,p.y,p.z,q,o),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(a,c){const o=Math.floor((a+this._maxX)*this._subdivisionsX/this._width),s=Math.floor(-(c+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),q=this._heightQuads[s*this._subdivisionsX+o];let t;return t=c<q.slope.x*a+q.slope.y?q.facet1:q.facet2,t}_initHeightQuads(){const a=this._subdivisionsX,c=this._subdivisionsY;this._heightQuads=[];for(let o=0;o<c;o++)for(let c=0;c<a;c++){const q={slope:s.Vector2.Zero(),facet1:new s.Vector4(0,0,0,0),facet2:new s.Vector4(0,0,0,0)};this._heightQuads[o*a+c]=q}return this}_computeHeightQuads(){const a=this.getVerticesData(p.g.PositionKind);if(!a)return this;const c=s.TmpVectors.Hc[3],o=s.TmpVectors.Hc[2],q=s.TmpVectors.Hc[1],t=s.TmpVectors.Hc[0],i=s.TmpVectors.Hc[4],G=s.TmpVectors.Hc[5],T=s.TmpVectors.Hc[6],C=s.TmpVectors.Hc[7],j=s.TmpVectors.Hc[8];let L=0,e=0,g=0,M=0,N=0,y=0,k=0;const n=this._subdivisionsX,f=this._subdivisionsY;for(let p=0;p<f;p++)for(let f=0;f<n;f++){L=3*f,e=p*(n+1)*3,g=(p+1)*(n+1)*3,c.x=a[e+L],c.y=a[e+L+1],c.z=a[e+L+2],o.x=a[e+L+3],o.y=a[e+L+4],o.z=a[e+L+5],q.x=a[g+L],q.y=a[g+L+1],q.z=a[g+L+2],t.x=a[g+L+3],t.y=a[g+L+4],t.z=a[g+L+5],M=(t.z-c.z)/(t.x-c.x),N=c.z-M*c.x,o.subtractToRef(c,i),q.subtractToRef(c,G),t.subtractToRef(c,T),s.Hc.CrossToRef(T,G,C),s.Hc.CrossToRef(i,T,j),C.normalize(),j.normalize(),y=-(C.x*c.x+C.y*c.y+C.z*c.z),k=-(j.x*o.x+j.y*o.y+j.z*o.z);const J=this._heightQuads[p*n+f];J.slope.Bc(M,N),J.facet1.Bc(C.x,C.y,C.z,y),J.facet2.Bc(j.x,j.y,j.z,k)}return this}serialize(a){super.serialize(a),a.subdivisionsX=this._subdivisionsX,a.subdivisionsY=this._subdivisionsY,a.minX=this._minX,a.maxX=this._maxX,a.rc=this._minZ,a.maxZ=this._maxZ,a.width=this._width,a.height=this._height}static Parse(a,c){const o=new G(a.name,c);return o._subdivisionsX=a.subdivisionsX||1,o._subdivisionsY=a.subdivisionsY||1,o._minX=a.minX,o._maxX=a.maxX,o._minZ=a.rc,o._maxZ=a.maxZ,o._width=a.width,o._height=a.height,o}}var T=o(12637),C=o(12680),j=o(12812),L=o(12866);function e(a){const c=[],o=[],q=[],t=[];let p,G;const T=a.width||a.size||1,C=a.height||a.size||1,j=0|(a.subdivisionsX||a.subdivisions||1),e=0|(a.subdivisionsY||a.subdivisions||1);for(p=0;p<=e;p++)for(G=0;G<=j;G++){const a=new s.Hc(G*T/j-T/2,0,(e-p)*C/e-C/2),c=new s.Hc(0,1,0);o.push(a.x,a.y,a.z),q.push(c.x,c.y,c.z),t.push(G/j,L.d?p/e:1-p/e)}for(p=0;p<e;p++)for(G=0;G<j;G++)c.push(G+1+(p+1)*(j+1)),c.push(G+1+p*(j+1)),c.push(G+p*(j+1)),c.push(G+(p+1)*(j+1)),c.push(G+1+(p+1)*(j+1)),c.push(G+p*(j+1));const g=new i.e;return g.indices=c,g.Ua=o,g.Sa=q,g.xa=t,g}function g(a){const c=void 0!==a.xmin&&null!==a.xmin?a.xmin:-1,o=void 0!==a.zmin&&null!==a.zmin?a.zmin:-1,q=void 0!==a.xmax&&null!==a.xmax?a.xmax:1,t=void 0!==a.zmax&&null!==a.zmax?a.zmax:1,p=a.subdivisions||{w:1,h:1},G=a.precision||{w:1,h:1},T=[],C=[],j=[],L=[];let e,g,M,N;p.h=p.h<1?1:p.h,p.w=p.w<1?1:p.w,G.w=G.w<1?1:G.w,G.h=G.h<1?1:G.h;const y=(q-c)/p.w,k=(t-o)/p.h;function n(a,c,o,q){const t=C.length/3,i=G.w+1;for(e=0;e<G.h;e++)for(g=0;g<G.w;g++){const a=[t+g+e*i,t+(g+1)+e*i,t+(g+1)+(e+1)*i,t+g+(e+1)*i];T.push(a[1]),T.push(a[2]),T.push(a[3]),T.push(a[0]),T.push(a[1]),T.push(a[3])}const p=s.Hc.Zero(),M=new s.Hc(0,1,0);for(e=0;e<=G.h;e++)for(p.z=e*(q-c)/G.h+c,g=0;g<=G.w;g++)p.x=g*(o-a)/G.w+a,p.y=0,C.push(p.x,p.y,p.z),j.push(M.x,M.y,M.z),L.push(g/G.w,e/G.h)}for(M=0;M<p.h;M++)for(N=0;N<p.w;N++)n(c+N*y,o+M*k,c+(N+1)*y,o+(M+1)*k);const f=new i.e;return f.indices=T,f.Ua=C,f.Sa=j,f.xa=L,f}function M(a){const c=[],o=[],t=[],p=[];let G,T;const C=a.colorFilter||new q.oo(.3,.59,.11),L=a.alphaFilter||0;let e=!1;if(a.minHeight>a.maxHeight){e=!0;const c=a.maxHeight;a.maxHeight=a.minHeight,a.minHeight=c}for(G=0;G<=a.subdivisions;G++)for(T=0;T<=a.subdivisions;T++){const c=new s.Hc(T*a.width/a.subdivisions-a.width/2,0,(a.subdivisions-G)*a.height/a.subdivisions-a.height/2),q=4*(((c.x+a.width/2)/a.width*(a.bufferWidth-1)|0)+((1-(c.z+a.height/2)/a.height)*(a.bufferHeight-1)|0)*a.bufferWidth);let i=a.buffer[q]/255,g=a.buffer[q+1]/255,M=a.buffer[q+2]/255;const N=a.buffer[q+3]/255;e&&(i=1-i,g=1-g,M=1-M);const y=i*C.r+g*C.g+M*C.b;c.y=N>=L?a.minHeight+(a.maxHeight-a.minHeight)*y:a.minHeight-j.b,a.heightBuffer&&(a.heightBuffer[G*(a.subdivisions+1)+T]=c.y),o.push(c.x,c.y,c.z),t.push(0,0,0),p.push(T/a.subdivisions,1-G/a.subdivisions)}for(G=0;G<a.subdivisions;G++)for(T=0;T<a.subdivisions;T++){const s=T+1+(G+1)*(a.subdivisions+1),q=T+1+G*(a.subdivisions+1),t=T+G*(a.subdivisions+1),i=T+(G+1)*(a.subdivisions+1),p=o[3*s+1]>=a.minHeight,C=o[3*q+1]>=a.minHeight,j=o[3*t+1]>=a.minHeight;p&&C&&j&&(c.push(s),c.push(q),c.push(t));o[3*i+1]>=a.minHeight&&p&&j&&(c.push(i),c.push(s),c.push(t))}i.e.ComputeNormals(o,c,t);const g=new i.e;return g.indices=c,g.Ua=o,g.Sa=t,g.xa=p,g}function N(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=new G(a,arguments.length>2?arguments[2]:void 0);o._setReady(!1),o._subdivisionsX=c.subdivisionsX||c.subdivisions||1,o._subdivisionsY=c.subdivisionsY||c.subdivisions||1,o._width=c.width||1,o._height=c.height||1,o._maxX=o._width/2,o._maxZ=o._height/2,o._minX=-o._maxX,o._minZ=-o._maxZ;return e(c).da(o,c.updatable),o._setReady(!0),o}function y(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new t.c(a,o);return g(c).da(s,c.updatable),s}function k(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=o.width||10,i=o.height||10,p=o.subdivisions||1,j=o.minHeight||0,L=o.maxHeight||1,e=o.colorFilter||new q.oo(.3,.59,.11),g=o.alphaFilter||0,N=o.updatable,y=o.onReady;s=s||C.b.LastCreatedScene;const k=new G(a,s);let n;k._subdivisionsX=p,k._subdivisionsY=p,k._width=t,k._height=i,k._maxX=k._width/2,k._maxZ=k._height/2,k._minX=-k._maxX,k._minZ=-k._maxZ,k._setReady(!1),o.passHeightBufferInCallback&&(n=new Float32Array((p+1)*(p+1)));const f=(a,c,o)=>{M({width:t,height:i,subdivisions:p,minHeight:j,maxHeight:L,colorFilter:e,buffer:a,bufferWidth:c,bufferHeight:o,alphaFilter:g,heightBuffer:n}).da(k,N),y&&y(k,n),k._setReady(!0)};if("string"===typeof c){const a=a=>{var c;const o=a.width,q=a.height;if(s.L)return;const t=null===(c=s)||void 0===c?void 0:c.getEngine().resizeImageBitmap(a,o,q);f(t,o,q)};T.Tools.LoadImage(c,a,o.onError?o.onError:()=>{},s.offlineProvider)}else f(c.data,c.width,c.height);return k}i.e.CreateGround=e,i.e.CreateTiledGround=g,i.e.CreateGroundFromHeightMap=M,t.c.CreateGround=(a,c,o,s,q,t)=>N(a,{width:c,height:o,subdivisions:s,updatable:t},q),t.c.CreateTiledGround=(a,c,o,s,q,t,i,p,G)=>y(a,{xmin:c,zmin:o,xmax:s,zmax:q,subdivisions:t,precision:i,updatable:G},p),t.c.CreateGroundFromHeightMap=(a,c,o,s,q,t,i,p,G,T,C)=>k(a,c,{width:o,height:s,subdivisions:q,minHeight:t,maxHeight:i,updatable:G,onReady:T,alphaFilter:C},p)},14512:(a,c,o)=>{"use strict";o.d(c,{e:()=>e,f:()=>j,i:()=>L});var s=o(12810),q=o(13241),t=o(13224),i=o(13348),p=o(12882),G=o(12649);function T(a){const c=[],o=[],s=a.lines,q=a.ra,i=[];let p=0;for(let t=0;t<s.length;t++){const a=s[t];for(let s=0;s<a.length;s++){const{x:G,y:T,z:C}=a[s];if(o.push(G,T,C),q){const a=q[t],{r:c,g:o,b:p,a:G}=a[s];i.push(c,o,p,G)}s>0&&(c.push(p-1),c.push(p)),p++}}const G=new t.e;return G.indices=c,G.Ua=o,q&&(G.ra=i),G}function C(a){const c=a.dashSize||3,o=a.gapSize||1,q=a.dashNb||200,i=a.points,p=[],G=[],T=s.Hc.Zero();let C=0,j=0,L=0,e=0,g=0,M=0,N=0;for(N=0;N<i.length-1;N++)i[N+1].subtractToRef(i[N],T),C+=T.length();for(L=C/q,e=c*L/(c+o),N=0;N<i.length-1;N++){i[N+1].subtractToRef(i[N],T),j=Math.floor(T.length()/L),T.normalize();for(let a=0;a<j;a++)g=L*a,p.push(i[N].x+g*T.x,i[N].y+g*T.y,i[N].z+g*T.z),p.push(i[N].x+(g+e)*T.x,i[N].y+(g+e)*T.y,i[N].z+(g+e)*T.z),G.push(M,M+1),M+=2}const y=new t.e;return y.Ua=p,y.indices=G,y}function j(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=c.instance,q=c.lines,t=c.ra;if(s){const a=s.getVerticesData(p.g.PositionKind);let c,o;t&&(c=s.getVerticesData(p.g.ColorKind));let i=0,G=0;for(let s=0;s<q.length;s++){const p=q[s];for(let q=0;q<p.length;q++)a[i]=p[q].x,a[i+1]=p[q].y,a[i+2]=p[q].z,t&&c&&(o=t[s],c[G]=o[q].r,c[G+1]=o[q].g,c[G+2]=o[q].b,c[G+3]=o[q].a,G+=4),i+=3}return s.updateVerticesData(p.g.PositionKind,a,!1,!1),t&&c&&s.updateVerticesData(p.g.ColorKind,c,!1,!1),s.refreshBoundingInfo(),s}const G=!!t,C=new i.b(a,o,null,void 0,void 0,G,c.useVertexAlpha,c.material);return T(c).da(C,c.updatable),C}function L(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=c.ra?[c.ra]:null;return j(a,{lines:[c.points],updatable:c.updatable,instance:c.instance,ra:s,useVertexAlpha:c.useVertexAlpha,material:c.material},o)}function e(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=c.points,p=c.instance,T=c.gapSize||1,j=c.dashSize||3;if(p){const a=a=>{const c=s.Hc.Zero(),o=a.length/6;let q=0,i=0,G=0,T=0,C=0,j=0,L=0,e=0;for(L=0;L<t.length-1;L++)t[L+1].subtractToRef(t[L],c),q+=c.length();G=q/o;const g=p._creationDataStorage.dashSize;for(T=g*G/(g+p._creationDataStorage.gapSize),L=0;L<t.length-1;L++)for(t[L+1].subtractToRef(t[L],c),i=Math.floor(c.length()/G),c.normalize(),e=0;e<i&&j<a.length;)C=G*e,a[j]=t[L].x+C*c.x,a[j+1]=t[L].y+C*c.y,a[j+2]=t[L].z+C*c.z,a[j+3]=t[L].x+(C+T)*c.x,a[j+4]=t[L].y+(C+T)*c.y,a[j+5]=t[L].z+(C+T)*c.z,j+=6,e++;for(;j<a.length;)a[j]=t[L].x,a[j+1]=t[L].y,a[j+2]=t[L].z,j+=3};return(c.dashNb||c.dashSize||c.gapSize||c.useVertexAlpha||c.material)&&G.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),p.updateMeshPositions(a,!1),p}const L=new i.b(a,o,null,void 0,void 0,void 0,c.useVertexAlpha,c.material);return C(c).da(L,c.updatable),L._creationDataStorage=new q.f,L._creationDataStorage.dashSize=j,L._creationDataStorage.gapSize=T,L}t.e.CreateLineSystem=T,t.e.CreateDashedLines=C,q.c.CC=function(a,c){return L(a,{points:c,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},q.c.CreateDashedLines=function(a,c,o,s,q){return e(a,{points:c,dashSize:o,gapSize:s,dashNb:q,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13939:(a,c,o)=>{"use strict";o.d(c,{b:()=>p,d:()=>G});var s=o(13241),q=o(13224),t=o(12866);function i(a){const c=[],o=[],s=[],i=[],p=void 0!==a.width?a.width:void 0!==a.size?a.size:1,G=void 0!==a.height?a.height:void 0!==a.size?a.size:1,T=0===a.sideOrientation?0:a.sideOrientation||q.e.DEFAULTSIDE,C=p/2,j=G/2;o.push(-C,-j,0),s.push(0,0,-1),i.push(0,t.d?1:0),o.push(C,-j,0),s.push(0,0,-1),i.push(1,t.d?1:0),o.push(C,j,0),s.push(0,0,-1),i.push(1,t.d?0:1),o.push(-C,j,0),s.push(0,0,-1),i.push(0,t.d?0:1),c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),q.e._ComputeSides(T,o,c,s,i,a.frontUVs,a.backUVs);const L=new q.e;return L.indices=c,L.Ua=o,L.Sa=s,L.xa=i,L}function p(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new s.c(a,o);c.sideOrientation=s.c._GetDefaultSideOrientation(c.sideOrientation),q._originalBuilderSideOrientation=c.sideOrientation;return i(c).da(q,c.updatable),c.sourcePlane&&(q.translate(c.sourcePlane.normal,-c.sourcePlane.d),q.setDirection(c.sourcePlane.normal.scale(-1))),q}const G={eC:p};q.e.eC=i,s.c.eC=(a,c,o,s,q)=>p(a,{size:c,width:c,height:c,sideOrientation:q,updatable:s},o)},14044:(a,c,o)=>{"use strict";o.d(c,{b:()=>G});var s=o(12810),q=o(13241),t=o(13224),i=o(12866);function p(a){const c=0|(a.segments||32),o=a.diameterX||a.diameter||1,q=a.diameterY||a.diameter||1,p=a.diameterZ||a.diameter||1,G=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1,T=a.slice&&a.slice<=0?1:a.slice||1,C=0===a.sideOrientation?0:a.sideOrientation||t.e.DEFAULTSIDE,j=!!a.dedupTopBottomIndices,L=new s.Hc(o/2,q/2,p/2),e=2+c,g=2*e,M=[],N=[],y=[],k=[];for(let t=0;t<=e;t++){const a=t/e,c=a*Math.PI*T;for(let o=0;o<=g;o++){const q=o/g,t=q*Math.PI*2*G,p=s.Matrix.RotationZ(-c),T=s.Matrix.RotationY(t),C=s.Hc.TransformCoordinates(s.Hc.Up(),p),j=s.Hc.TransformCoordinates(C,T),e=j.multiply(L),M=j.divide(L).normalize();N.push(e.x,e.y,e.z),y.push(M.x,M.y,M.z),k.push(q,i.d?1-a:a)}if(t>0){const a=N.length/3;for(let c=a-2*(g+1);c+g+2<a;c++)j?(t>1&&(M.push(c),M.push(c+1),M.push(c+g+1)),(t<e||T<1)&&(M.push(c+g+1),M.push(c+1),M.push(c+g+2))):(M.push(c),M.push(c+1),M.push(c+g+1),M.push(c+g+1),M.push(c+1),M.push(c+g+2))}}t.e._ComputeSides(C,N,M,y,k,a.frontUVs,a.backUVs);const n=new t.e;return n.indices=M,n.Ua=N,n.Sa=y,n.xa=k,n}function G(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new q.c(a,o);c.sideOrientation=q.c._GetDefaultSideOrientation(c.sideOrientation),s._originalBuilderSideOrientation=c.sideOrientation;return p(c).da(s,c.updatable),s}t.e.CreateSphere=p,q.c.CreateSphere=(a,c,o,s,q,t)=>G(a,{segments:c,diameterX:o,diameterY:o,diameterZ:o,sideOrientation:t,updatable:q},s)},14978:(a,c,o)=>{"use strict";o.d(c,{c:()=>p});var s=o(13368),q=o(14369),t=o(13386),i=o(13224);class p{static get Configuration(){return{get decoder(){return q.e.DefaultConfiguration},set decoder(a){q.e.DefaultConfiguration=a}}}static set Configuration(a){q.e.DefaultConfiguration=a.decoder}static get DecoderAvailable(){return(0,s.f)(q.e.DefaultConfiguration)}static get Default(){return p._Default??(p._Default=new p),p._Default}static ResetDefault(a){p._Default&&(a||p._Default.dispose(),p._Default=null)}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.DefaultNumWorkers;const c="number"===typeof a?{...q.e.DefaultConfiguration,numWorkers:a}:{...q.e.DefaultConfiguration,...a};this._decoder=new q.e(c)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(a,c,o){return this._decoder.decodeMeshToMeshDataAsync(a,c,o)}async decodeMeshToGeometryAsync(a,c,o,s){return await this._decoder.decodeMeshToGeometryAsync(a,c,o,s)}async _decodeMeshToGeometryForGltfAsync(a,c,o,s,q,t){return await this._decoder._decodeMeshToGeometryForGltfAsync(a,c,o,s,q,t)}async decodeMeshAsync(a,c){const o=await this._decoder.decodeMeshToMeshDataAsync(a,c),s=new i.e;o.indices&&(s.indices=o.indices);for(const q of o.attributes){const a=t.b.GetFloatData(q.data,q.size,t.b.GetDataType(q.data),q.byteOffset,q.byteStride,q.normalized,o.totalVertices);s.set(a,q.kind)}return s}}p.DefaultNumWorkers=(0,s.e)(),p._Default=null},14369:(a,c,o)=>{"use strict";o.d(c,{e:()=>T});var s=o(13368),q=o(12637),t=o(13248),i=o(13386),p=o(12649),G=o(13378);class T extends s.d{static get DefaultAvailable(){return(0,s.f)(T.DefaultConfiguration)}static get Default(){return T._Default??(T._Default=new T),T._Default}static ResetDefault(a){T._Default&&(a||T._Default.dispose(),T._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(a,c){return{module:await(c||DracoDecoderModule)({wasmBinary:a})}}_getWorkerContent(){return`${G.b}(${G.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.DefaultConfiguration)}decodeMeshToMeshDataAsync(a,c,o){const s=a instanceof ArrayBuffer?new Int8Array(a):new Int8Array(a.buffer,a.byteOffset,a.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async a=>await new Promise(((q,t)=>{a.push(((a,i)=>{let G=null;const T=[],C=c=>{a.removeEventListener("error",C),a.removeEventListener("message",j),t(c),i()},j=c=>{const s=c.data;switch(s.id){case"indices":G=s.data;break;case"attribute":T.push({kind:s.kind,data:s.data,size:s.size,byteOffset:s.byteOffset,byteStride:s.byteStride,normalized:(t=s.kind,L=s.normalized,o&&void 0!==o[t]?(L!==o[t]&&p.c.Warn(`Normalized flag from Draco data (${L}) does not match normalized flag from glTF accessor (${o[t]}). Using flag from glTF accessor.`),o[t]):L)});break;case"decodeMeshDone":a.removeEventListener("error",C),a.removeEventListener("message",j),q({indices:G,attributes:T,totalVertices:s.totalVertices}),i()}var t,L};a.addEventListener("error",C),a.addEventListener("message",j);const L=s.slice();a.postMessage({id:"decodeMesh",dataView:L,attributes:c},[L.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((a=>{let o=null;const q=[],t=(0,G.b)(a.module,s,c,(a=>{o=a}),((a,c,o,s,t,i)=>{q.push({kind:a,data:c,size:o,byteOffset:s,byteStride:t,normalized:i})}));return{indices:o,attributes:q,totalVertices:t}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(a,c,o,s){const q=await this.decodeMeshToMeshDataAsync(o,s),p=new t.d(a,c);q.indices&&p.setIndices(q.indices);for(const t of q.attributes)p.setVerticesBuffer(new i.b(c.getEngine(),t.data,t.kind,!1,void 0,t.byteStride,void 0,t.byteOffset,t.size,void 0,t.normalized,!0),q.totalVertices);return p}async _decodeMeshToGeometryForGltfAsync(a,c,o,s,q,p){const G=await this.decodeMeshToMeshDataAsync(o,s,q),T=new t.d(a,c);p&&(T._boundingInfo=p,T.useBoundingInfoFromGeometry=!0),G.indices&&T.setIndices(G.indices);for(const t of G.attributes)T.setVerticesBuffer(new i.b(c.getEngine(),t.data,t.kind,!1,void 0,t.byteStride,void 0,t.byteOffset,t.size,void 0,t.normalized,!0),G.totalVertices);return T}}T.DefaultConfiguration={wasmUrl:`${q.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${q.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${q.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},T._Default=null},14504:(a,c,o)=>{"use strict";o.d(c,{e:()=>pa});var s=o(12810),q=o(13241),t=o(12882),i=o(13224),p=o(12866);function G(a){let c=a.pathArray;const o=a.closeArray||!1,s=a.closePath||!1,q=a.invertUV||!1,G=Math.floor(c[0].length/2);let T=a.offset||G;T=T>G?G:Math.floor(T);const C=0===a.sideOrientation?0:a.sideOrientation||i.e.DEFAULTSIDE,j=a.xa,L=a.ra,e=[],g=[],M=[],N=[],y=[],k=[],n=[],f=[];let J;const w=[],Z=[];let h,U,S;if(c.length<2){const a=[],o=[];for(U=0;U<c[0].length-T;U++)a.push(c[0][U]),o.push(c[0][U+T]);c=[a,o]}let r=0;const x=s?1:0,R=o?1:0;let d,X,W,F,O,B;for(J=c[0].length,h=0;h<c.length+R;h++){for(n[h]=0,y[h]=[0],d=h===c.length?c[0]:c[h],X=d.length,J=J<X?J:X,S=0;S<X;)e.push(d[S].x,d[S].y,d[S].z),S>0&&(W=d[S].vc(d[S-1]).length(),F=W+n[h],y[h].push(F),n[h]=F),S++;s&&(S--,e.push(d[0].x,d[0].y,d[0].z),W=d[S].vc(d[0]).length(),F=W+n[h],y[h].push(F),n[h]=F),w[h]=X+x,Z[h]=r,r+=X+x}let u,K,D=null,I=null;for(U=0;U<J+x;U++)for(f[U]=0,k[U]=[0],h=0;h<c.length-1+R;h++)O=c[h],B=h===c.length-1?c[0]:c[h+1],U===J?(D=O[0],I=B[0]):(D=O[U],I=B[U]),W=I.vc(D).length(),F=W+f[U],k[U].push(F),f[U]=F;if(j)for(h=0;h<j.length;h++)N.push(j[h].x,p.d?1-j[h].y:j[h].y);else for(h=0;h<c.length+R;h++)for(U=0;U<J+x;U++)u=0!=n[h]?y[h][U]/n[h]:0,K=0!=f[U]?k[U][h]/f[U]:0,q?N.push(K,u):N.push(u,p.d?1-K:K);h=0;let Y=0,P=w[h]-1,ma=w[h+1]-1,V=P<ma?P:ma,E=Z[1]-Z[0];const H=w.length-1;for(;Y<=V&&h<H;)g.push(Y,Y+E,Y+1),g.push(Y+E+1,Y+1,Y+E),Y+=1,Y===V&&(h++,E=Z[h+1]-Z[h],P=w[h]-1,ma=w[h+1]-1,Y=Z[h],V=P<ma?P+Y:ma+Y);if(i.e.ComputeNormals(e,g,M),s){let a=0,o=0;for(h=0;h<c.length;h++){a=3*Z[h],o=h+1<c.length?3*(Z[h+1]-1):M.length-3,M[a]=.5*(M[a]+M[o]),M[a+1]=.5*(M[a+1]+M[o+1]),M[a+2]=.5*(M[a+2]+M[o+2]);const s=Math.sqrt(M[a]*M[a]+M[a+1]*M[a+1]+M[a+2]*M[a+2]);M[a]/=s,M[a+1]/=s,M[a+2]/=s,M[o]=M[a],M[o+1]=M[a+1],M[o+2]=M[a+2]}}if(o){let a=3*Z[0],o=3*Z[c.length];for(U=0;U<J+x;U++){M[a]=.5*(M[a]+M[o]),M[a+1]=.5*(M[a+1]+M[o+1]),M[a+2]=.5*(M[a+2]+M[o+2]);const c=Math.sqrt(M[a]*M[a]+M[a+1]*M[a+1]+M[a+2]*M[a+2]);M[a]/=c,M[a+1]/=c,M[a+2]/=c,M[o]=M[a],M[o+1]=M[a+1],M[o+2]=M[a+2],a+=3,o+=3}}i.e._ComputeSides(C,e,g,M,N,a.frontUVs,a.backUVs);let b=null;if(L){b=new Float32Array(4*L.length);for(let a=0;a<L.length;a++)b[4*a]=L[a].r,b[4*a+1]=L[a].g,b[4*a+2]=L[a].b,b[4*a+3]=L[a].a}const A=new i.e,v=new Float32Array(e),l=new Float32Array(M),Q=new Float32Array(N);return A.indices=g,A.Ua=v,A.Sa=l,A.xa=Q,b&&A.set(b,t.g.ColorKind),s&&(A._idx=Z),A}function T(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=c.pathArray,C=c.closeArray,j=c.closePath,L=q.c._GetDefaultSideOrientation(c.sideOrientation),e=c.instance,g=c.updatable;if(e){const a=s.TmpVectors.Hc[0].Dc(Number.MAX_VALUE),o=s.TmpVectors.Hc[1].Dc(-Number.MAX_VALUE),G=c=>{let s=T[0].length;const t=e;let i=0;const p=t._originalBuilderSideOrientation===q.c.DOUBLESIDE?2:1;for(let q=1;q<=p;++q)for(let p=0;p<T.length;++p){const q=T[p],G=q.length;s=s<G?s:G;for(let t=0;t<s;++t){const s=q[t];c[i]=s.x,c[i+1]=s.y,c[i+2]=s.z,a.minimizeInPlaceFromFloats(s.x,s.y,s.z),o.maximizeInPlaceFromFloats(s.x,s.y,s.z),i+=3}if(t._creationDataStorage&&t._creationDataStorage.closePath){const a=q[0];c[i]=a.x,c[i+1]=a.y,c[i+2]=a.z,i+=3}}},C=e.getVerticesData(t.g.PositionKind);if(G(C),e.hasBoundingInfo?e.getBoundingInfo().reConstruct(a,o,e._worldMatrix):e.buildBoundingInfo(a,o,e._worldMatrix),e.updateVerticesData(t.g.PositionKind,C,!1,!1),c.ra){const a=e.getVerticesData(t.g.ColorKind);for(let o=0,s=0;o<c.ra.length;o++,s+=4){const q=c.ra[o];a[s]=q.r,a[s+1]=q.g,a[s+2]=q.b,a[s+3]=q.a}e.updateVerticesData(t.g.ColorKind,a,!1,!1)}if(c.xa){const a=e.getVerticesData(t.g.UVKind);for(let o=0;o<c.xa.length;o++)a[2*o]=c.xa[o].x,a[2*o+1]=p.d?1-c.xa[o].y:c.xa[o].y;e.updateVerticesData(t.g.UVKind,a,!1,!1)}if(!e.areNormalsFrozen||e.isFacetDataEnabled){const a=e.Wc(),c=e.getVerticesData(t.g.NormalKind),o=e.isFacetDataEnabled?e.getFacetDataParameters():null;if(i.e.ComputeNormals(C,a,c,o),e._creationDataStorage&&e._creationDataStorage.closePath){let a=0,o=0;for(let s=0;s<T.length;s++)a=3*e._creationDataStorage.idx[s],o=s+1<T.length?3*(e._creationDataStorage.idx[s+1]-1):c.length-3,c[a]=.5*(c[a]+c[o]),c[a+1]=.5*(c[a+1]+c[o+1]),c[a+2]=.5*(c[a+2]+c[o+2]),c[o]=c[a],c[o+1]=c[a+1],c[o+2]=c[a+2]}e.areNormalsFrozen||e.updateVerticesData(t.g.NormalKind,c,!1,!1)}return e}{const s=new q.c(a,o);s._originalBuilderSideOrientation=L,s._creationDataStorage=new q.f;const t=G(c);return j&&(s._creationDataStorage.idx=t._idx),s._creationDataStorage.closePath=j,s._creationDataStorage.closeArray=C,t.da(s,g),s}}i.e.CreateRibbon=G,q.c.CreateRibbon=function(a,c){return T(a,{pathArray:c,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var C=o(14060),j=o(13895),L=o(12858);function e(a){const c=a.pattern||q.c.NO_FLIP,o=a.tileWidth||a.tileSize||1,s=a.tileHeight||a.tileSize||1,t=a.alignHorizontal||0,p=a.alignVertical||0,G=a.width||a.size||1,T=Math.floor(G/o);let C=G-T*o;const j=a.height||a.size||1,L=Math.floor(j/s);let e=j-L*s;const g=o*T/2,M=s*L/2;let N=0,y=0,k=0,n=0,f=0,J=0;if(C>0||e>0){switch(k=-g,n=-M,f=g,J=M,t){case q.c.CENTER:C/=2,k-=C,f+=C;break;case q.c.LEFT:f+=C,N=-C/2;break;case q.c.RIGHT:k-=C,N=C/2}switch(p){case q.c.CENTER:e/=2,n-=e,J+=e;break;case q.c.BOTTOM:J+=e,y=-e/2;break;case q.c.TOP:n-=e,y=e/2}}const w=[],Z=[],h=[];h[0]=[0,0,1,0,1,1,0,1],h[1]=[0,0,1,0,1,1,0,1],c!==q.c.ROTATE_TILE&&c!==q.c.ROTATE_ROW||(h[1]=[1,1,0,1,0,0,1,0]),c!==q.c.FLIP_TILE&&c!==q.c.FLIP_ROW||(h[1]=[1,0,0,0,0,1,1,1]),c!==q.c.FLIP_N_ROTATE_TILE&&c!==q.c.FLIP_N_ROTATE_ROW||(h[1]=[0,1,1,1,1,0,0,0]);let U=[];const S=[],r=[];let x=0;for(let i=0;i<L;i++)for(let a=0;a<T;a++)w.push(a*o-g+N,i*s-M+y,0),w.push((a+1)*o-g+N,i*s-M+y,0),w.push((a+1)*o-g+N,(i+1)*s-M+y,0),w.push(a*o-g+N,(i+1)*s-M+y,0),r.push(x,x+1,x+3,x+1,x+2,x+3),U=c===q.c.FLIP_TILE||c===q.c.ROTATE_TILE||c===q.c.FLIP_N_ROTATE_TILE?U.concat(h[(a%2+i%2)%2]):c===q.c.FLIP_ROW||c===q.c.ROTATE_ROW||c===q.c.FLIP_N_ROTATE_ROW?U.concat(h[i%2]):U.concat(h[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),x+=4;if(C>0||e>0){const a=e>0&&(p===q.c.CENTER||p===q.c.TOP),i=e>0&&(p===q.c.CENTER||p===q.c.BOTTOM),G=C>0&&(t===q.c.CENTER||t===q.c.RIGHT),j=C>0&&(t===q.c.CENTER||t===q.c.LEFT);let h,R,d,X,W=[];if(a&&G&&(w.push(k+N,n+y,0),w.push(-g+N,n+y,0),w.push(-g+N,n+e+y,0),w.push(k+N,n+e+y,0),r.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,h=1-C/o,R=1-e/s,d=1,X=1,W=[h,R,d,R,d,X,h,X],c===q.c.ROTATE_ROW&&(W=[1-h,1-R,1-d,1-R,1-d,1-X,1-h,1-X]),c===q.c.FLIP_ROW&&(W=[1-h,R,1-d,R,1-d,X,1-h,X]),c===q.c.FLIP_N_ROTATE_ROW&&(W=[h,1-R,d,1-R,d,1-X,h,1-X]),U=U.concat(W),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&j&&(w.push(g+N,n+y,0),w.push(f+N,n+y,0),w.push(f+N,n+e+y,0),w.push(g+N,n+e+y,0),r.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,h=0,R=1-e/s,d=C/o,X=1,W=[h,R,d,R,d,X,h,X],(c===q.c.ROTATE_ROW||c===q.c.ROTATE_TILE&&T%2===0)&&(W=[1-h,1-R,1-d,1-R,1-d,1-X,1-h,1-X]),(c===q.c.FLIP_ROW||c===q.c.FLIP_TILE&&T%2===0)&&(W=[1-h,R,1-d,R,1-d,X,1-h,X]),(c===q.c.FLIP_N_ROTATE_ROW||c===q.c.FLIP_N_ROTATE_TILE&&T%2===0)&&(W=[h,1-R,d,1-R,d,1-X,h,1-X]),U=U.concat(W),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i&&G&&(w.push(k+N,M+y,0),w.push(-g+N,M+y,0),w.push(-g+N,J+y,0),w.push(k+N,J+y,0),r.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,h=1-C/o,R=0,d=1,X=e/s,W=[h,R,d,R,d,X,h,X],(c===q.c.ROTATE_ROW&&L%2===1||c===q.c.ROTATE_TILE&&L%1===0)&&(W=[1-h,1-R,1-d,1-R,1-d,1-X,1-h,1-X]),(c===q.c.FLIP_ROW&&L%2===1||c===q.c.FLIP_TILE&&L%2===0)&&(W=[1-h,R,1-d,R,1-d,X,1-h,X]),(c===q.c.FLIP_N_ROTATE_ROW&&L%2===1||c===q.c.FLIP_N_ROTATE_TILE&&L%2===0)&&(W=[h,1-R,d,1-R,d,1-X,h,1-X]),U=U.concat(W),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i&&j&&(w.push(g+N,M+y,0),w.push(f+N,M+y,0),w.push(f+N,J+y,0),w.push(g+N,J+y,0),r.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,h=0,R=0,d=C/o,X=e/s,W=[h,R,d,R,d,X,h,X],(c===q.c.ROTATE_ROW&&L%2===1||c===q.c.ROTATE_TILE&&(L+T)%2===1)&&(W=[1-h,1-R,1-d,1-R,1-d,1-X,1-h,1-X]),(c===q.c.FLIP_ROW&&L%2===1||c===q.c.FLIP_TILE&&(L+T)%2===1)&&(W=[1-h,R,1-d,R,1-d,X,1-h,X]),(c===q.c.FLIP_N_ROTATE_ROW&&L%2===1||c===q.c.FLIP_N_ROTATE_TILE&&(L+T)%2===1)&&(W=[h,1-R,d,1-R,d,1-X,h,1-X]),U=U.concat(W),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a){const a=[];h=0,R=1-e/s,d=1,X=1,a[0]=[h,R,d,R,d,X,h,X],a[1]=[h,R,d,R,d,X,h,X],c!==q.c.ROTATE_TILE&&c!==q.c.ROTATE_ROW||(a[1]=[1-h,1-R,1-d,1-R,1-d,1-X,1-h,1-X]),c!==q.c.FLIP_TILE&&c!==q.c.FLIP_ROW||(a[1]=[1-h,R,1-d,R,1-d,X,1-h,X]),c!==q.c.FLIP_N_ROTATE_TILE&&c!==q.c.FLIP_N_ROTATE_ROW||(a[1]=[h,1-R,d,1-R,d,1-X,h,1-X]);for(let s=0;s<T;s++)w.push(s*o-g+N,n+y,0),w.push((s+1)*o-g+N,n+y,0),w.push((s+1)*o-g+N,n+e+y,0),w.push(s*o-g+N,n+e+y,0),r.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,U=c===q.c.FLIP_TILE||c===q.c.ROTATE_TILE||c===q.c.FLIP_N_ROTATE_TILE?U.concat(a[(s+1)%2]):c===q.c.FLIP_ROW||c===q.c.ROTATE_ROW||c===q.c.FLIP_N_ROTATE_ROW?U.concat(a[1]):U.concat(a[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(i){const a=[];h=0,R=0,d=1,X=e/s,a[0]=[h,R,d,R,d,X,h,X],a[1]=[h,R,d,R,d,X,h,X],c!==q.c.ROTATE_TILE&&c!==q.c.ROTATE_ROW||(a[1]=[1-h,1-R,1-d,1-R,1-d,1-X,1-h,1-X]),c!==q.c.FLIP_TILE&&c!==q.c.FLIP_ROW||(a[1]=[1-h,R,1-d,R,1-d,X,1-h,X]),c!==q.c.FLIP_N_ROTATE_TILE&&c!==q.c.FLIP_N_ROTATE_ROW||(a[1]=[h,1-R,d,1-R,d,1-X,h,1-X]);for(let s=0;s<T;s++)w.push(s*o-g+N,J-e+y,0),w.push((s+1)*o-g+N,J-e+y,0),w.push((s+1)*o-g+N,J+y,0),w.push(s*o-g+N,J+y,0),r.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,U=c===q.c.FLIP_TILE||c===q.c.ROTATE_TILE||c===q.c.FLIP_N_ROTATE_TILE?U.concat(a[(s+L)%2]):c===q.c.FLIP_ROW||c===q.c.ROTATE_ROW||c===q.c.FLIP_N_ROTATE_ROW?U.concat(a[L%2]):U.concat(a[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(G){const a=[];h=1-C/o,R=0,d=1,X=1,a[0]=[h,R,d,R,d,X,h,X],a[1]=[h,R,d,R,d,X,h,X],c!==q.c.ROTATE_TILE&&c!==q.c.ROTATE_ROW||(a[1]=[1-h,1-R,1-d,1-R,1-d,1-X,1-h,1-X]),c!==q.c.FLIP_TILE&&c!==q.c.FLIP_ROW||(a[1]=[1-h,R,1-d,R,1-d,X,1-h,X]),c!==q.c.FLIP_N_ROTATE_TILE&&c!==q.c.FLIP_N_ROTATE_ROW||(a[1]=[h,1-R,d,1-R,d,1-X,h,1-X]);for(let o=0;o<L;o++)w.push(k+N,o*s-M+y,0),w.push(k+C+N,o*s-M+y,0),w.push(k+C+N,(o+1)*s-M+y,0),w.push(k+N,(o+1)*s-M+y,0),r.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,U=c===q.c.FLIP_TILE||c===q.c.ROTATE_TILE||c===q.c.FLIP_N_ROTATE_TILE?U.concat(a[(o+1)%2]):c===q.c.FLIP_ROW||c===q.c.ROTATE_ROW||c===q.c.FLIP_N_ROTATE_ROW?U.concat(a[o%2]):U.concat(a[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(j){const a=[];h=0,R=0,d=C/s,X=1,a[0]=[h,R,d,R,d,X,h,X],a[1]=[h,R,d,R,d,X,h,X],c!==q.c.ROTATE_TILE&&c!==q.c.ROTATE_ROW||(a[1]=[1-h,1-R,1-d,1-R,1-d,1-X,1-h,1-X]),c!==q.c.FLIP_TILE&&c!==q.c.FLIP_ROW||(a[1]=[1-h,R,1-d,R,1-d,X,1-h,X]),c!==q.c.FLIP_N_ROTATE_TILE&&c!==q.c.FLIP_N_ROTATE_ROW||(a[1]=[h,1-R,d,1-R,d,1-X,h,1-X]);for(let o=0;o<L;o++)w.push(f-C+N,o*s-M+y,0),w.push(f+N,o*s-M+y,0),w.push(f+N,(o+1)*s-M+y,0),w.push(f-C+N,(o+1)*s-M+y,0),r.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,U=c===q.c.FLIP_TILE||c===q.c.ROTATE_TILE||c===q.c.FLIP_N_ROTATE_TILE?U.concat(a[(o+T)%2]):c===q.c.FLIP_ROW||c===q.c.ROTATE_ROW||c===q.c.FLIP_N_ROTATE_ROW?U.concat(a[o%2]):U.concat(a[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const R=0===a.sideOrientation?0:a.sideOrientation||i.e.DEFAULTSIDE;i.e._ComputeSides(R,w,r,Z,U,a.frontUVs,a.backUVs);const d=new i.e;d.indices=r,d.Ua=w,d.Sa=Z,d.xa=U;const X=R===i.e.DOUBLESIDE?S.concat(S):S;return d.ra=X,d}function g(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new q.c(a,o);c.sideOrientation=q.c._GetDefaultSideOrientation(c.sideOrientation),s._originalBuilderSideOrientation=c.sideOrientation;return e(c).da(s,c.updatable),s}function M(a){const c=a.faceUV||new Array(6),o=a.faceColors,t=a.pattern||q.c.NO_FLIP,G=a.width||a.size||1,T=a.height||a.size||1,C=a.depth||a.size||1,j=a.tileWidth||a.tileSize||1,g=a.tileHeight||a.tileSize||1,M=a.alignHorizontal||0,N=a.alignVertical||0,y=0===a.sideOrientation?0:a.sideOrientation||i.e.DEFAULTSIDE;for(let q=0;q<6;q++)void 0===c[q]&&(c[q]=new s.Vector4(0,0,1,1)),o&&void 0===o[q]&&(o[q]=new L.Yc(1,1,1,1));const k=G/2,n=T/2,f=C/2,J=[];for(let s=0;s<2;s++)J[s]=e({pattern:t,tileWidth:j,tileHeight:g,width:G,height:T,alignVertical:N,alignHorizontal:M,sideOrientation:y});for(let s=2;s<4;s++)J[s]=e({pattern:t,tileWidth:j,tileHeight:g,width:C,height:T,alignVertical:N,alignHorizontal:M,sideOrientation:y});let w=N;N===q.c.BOTTOM?w=q.c.TOP:N===q.c.TOP&&(w=q.c.BOTTOM);for(let s=4;s<6;s++)J[s]=e({pattern:t,tileWidth:j,tileHeight:g,width:G,height:C,alignVertical:w,alignHorizontal:M,sideOrientation:y});let Z=[],h=[],U=[],S=[];const r=[],x=[],R=[],d=[];let X=0,W=0;for(let q=0;q<6;q++){const a=J[q].Ua.length;x[q]=[],R[q]=[];for(let c=0;c<a/3;c++)x[q].push(new s.Hc(J[q].Ua[3*c],J[q].Ua[3*c+1],J[q].Ua[3*c+2])),R[q].push(new s.Hc(J[q].Sa[3*c],J[q].Sa[3*c+1],J[q].Sa[3*c+2]));X=J[q].xa.length,d[q]=[];for(let o=0;o<X;o+=2)d[q][o]=c[q].x+(c[q].z-c[q].x)*J[q].xa[o],d[q][o+1]=c[q].y+(c[q].w-c[q].y)*J[q].xa[o+1],p.d&&(d[q][o+1]=1-d[q][o+1]);if(U=U.concat(d[q]),S=S.concat(J[q].indices.map((a=>a+W))),W+=x[q].length,o)for(let c=0;c<4;c++)r.push(o[q].r,o[q].g,o[q].b,o[q].a)}const F=new s.Hc(0,0,f),O=s.Matrix.RotationY(Math.PI);Z=x[0].map((a=>s.Hc.TransformNormal(a,O).add(F))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[]),h=R[0].map((a=>s.Hc.TransformNormal(a,O))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[]),Z=Z.concat(x[1].map((a=>a.vc(F))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[])),h=h.concat(R[1].map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[]));const B=new s.Hc(k,0,0),u=s.Matrix.RotationY(-Math.PI/2);Z=Z.concat(x[2].map((a=>s.Hc.TransformNormal(a,u).add(B))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[])),h=h.concat(R[2].map((a=>s.Hc.TransformNormal(a,u))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[]));const K=s.Matrix.RotationY(Math.PI/2);Z=Z.concat(x[3].map((a=>s.Hc.TransformNormal(a,K).vc(B))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[])),h=h.concat(R[3].map((a=>s.Hc.TransformNormal(a,K))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[]));const D=new s.Hc(0,n,0),I=s.Matrix.RotationX(Math.PI/2);Z=Z.concat(x[4].map((a=>s.Hc.TransformNormal(a,I).add(D))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[])),h=h.concat(R[4].map((a=>s.Hc.TransformNormal(a,I))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[]));const Y=s.Matrix.RotationX(-Math.PI/2);Z=Z.concat(x[5].map((a=>s.Hc.TransformNormal(a,Y).vc(D))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[])),h=h.concat(R[5].map((a=>s.Hc.TransformNormal(a,Y))).map((a=>[a.x,a.y,a.z])).reduce(((a,c)=>a.concat(c)),[])),i.e._ComputeSides(y,Z,S,h,U);const P=new i.e;if(P.indices=S,P.Ua=Z,P.Sa=h,P.xa=U,o){const a=y===i.e.DOUBLESIDE?r.concat(r):r;P.ra=a}return P}function N(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new q.c(a,o);c.sideOrientation=q.c._GetDefaultSideOrientation(c.sideOrientation),s._originalBuilderSideOrientation=c.sideOrientation;return M(c).da(s,c.updatable),s}i.e.CreateTiledPlane=e;i.e.CreateTiledBox=M;var y=o(14044),k=o(13045),n=o(13009);function f(a){const c=a.height||2;let o=0===a.diameterTop?0:a.diameterTop||a.diameter||1,t=0===a.diameterBottom?0:a.diameterBottom||a.diameter||1;o=o||1e-5,t=t||1e-5;const G=0|(a.tessellation||24),T=0|(a.subdivisions||1),C=!!a.hasRings,j=!!a.enclose,e=0===a.cap?0:a.cap||q.c.CAP_ALL,g=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1,M=0===a.sideOrientation?0:a.sideOrientation||i.e.DEFAULTSIDE,N=a.faceUV||new Array(3),y=a.faceColors,k=2+(1+(1!==g&&j?2:0))*(C?T:1);let f;for(f=0;f<k;f++)y&&void 0===y[f]&&(y[f]=new L.Yc(1,1,1,1));for(f=0;f<k;f++)N&&void 0===N[f]&&(N[f]=new s.Vector4(0,0,1,1));const J=[],w=[],Z=[],h=[],U=[],S=2*Math.PI*g/G;let r,x,R;const d=(t-o)/2/c,X=s.Hc.Zero(),W=s.Hc.Zero(),F=s.Hc.Zero(),O=s.Hc.Zero(),B=s.Hc.Zero(),u=n.d.Y;let K,D,I,Y=1,P=1,ma=0,V=0;for(K=0;K<=T;K++)for(x=K/T,R=(x*(o-t)+t)/2,Y=C&&0!==K&&K!==T?2:1,I=0;I<Y;I++){for(C&&(P+=I),j&&(P+=2*I),D=0;D<=G;D++)r=D*S,X.x=Math.cos(-r)*R,X.y=-c/2+x*c,X.z=Math.sin(-r)*R,0===o&&K===T?(W.x=Z[Z.length-3*(G+1)],W.y=Z[Z.length-3*(G+1)+1],W.z=Z[Z.length-3*(G+1)+2]):(W.x=X.x,W.z=X.z,W.y=Math.sqrt(W.x*W.x+W.z*W.z)*d,W.normalize()),0===D&&(F.G(X),O.G(W)),w.push(X.x,X.y,X.z),Z.push(W.x,W.y,W.z),V=C?ma!==P?N[P].y:N[P].w:N[P].y+(N[P].w-N[P].y)*x,h.push(N[P].x+(N[P].z-N[P].x)*D/G,p.d?1-V:V),y&&U.push(y[P].r,y[P].g,y[P].b,y[P].a);1!==g&&j&&(w.push(X.x,X.y,X.z),w.push(0,X.y,0),w.push(0,X.y,0),w.push(F.x,F.y,F.z),s.Hc.CrossToRef(u,W,B),B.normalize(),Z.push(B.x,B.y,B.z,B.x,B.y,B.z),s.Hc.CrossToRef(O,u,B),B.normalize(),Z.push(B.x,B.y,B.z,B.x,B.y,B.z),V=C?ma!==P?N[P+1].y:N[P+1].w:N[P+1].y+(N[P+1].w-N[P+1].y)*x,h.push(N[P+1].x,p.d?1-V:V),h.push(N[P+1].z,p.d?1-V:V),V=C?ma!==P?N[P+2].y:N[P+2].w:N[P+2].y+(N[P+2].w-N[P+2].y)*x,h.push(N[P+2].x,p.d?1-V:V),h.push(N[P+2].z,p.d?1-V:V),y&&(U.push(y[P+1].r,y[P+1].g,y[P+1].b,y[P+1].a),U.push(y[P+1].r,y[P+1].g,y[P+1].b,y[P+1].a),U.push(y[P+2].r,y[P+2].g,y[P+2].b,y[P+2].a),U.push(y[P+2].r,y[P+2].g,y[P+2].b,y[P+2].a))),ma!==P&&(ma=P)}const E=1!==g&&j?G+4:G;for(K=0,P=0;P<T;P++){let a=0,c=0,o=0,s=0;for(D=0;D<G;D++)a=K*(E+1)+D,c=(K+1)*(E+1)+D,o=K*(E+1)+(D+1),s=(K+1)*(E+1)+(D+1),J.push(a,c,o),J.push(s,o,c);1!==g&&j&&(J.push(a+2,c+2,o+2),J.push(s+2,o+2,c+2),J.push(a+4,c+4,o+4),J.push(s+4,o+4,c+4)),K=C?K+2:K+1}const H=a=>{const q=a?o/2:t/2;if(0===q)return;let i,T,C;const j=a?N[k-1]:N[0];let L=null;y&&(L=a?y[k-1]:y[0]);const e=w.length/3,M=a?c/2:-c/2,n=new s.Hc(0,M,0);w.push(n.x,n.y,n.z),Z.push(0,a?1:-1,0);const f=j.y+.5*(j.w-j.y);h.push(j.x+.5*(j.z-j.x),p.d?1-f:f),L&&U.push(L.r,L.g,L.b,L.a);const S=new s.Vector2(.5,.5);for(C=0;C<=G;C++){i=2*Math.PI*C*g/G;const c=Math.cos(-i),o=Math.sin(-i);T=new s.Hc(c*q,M,o*q);const t=new s.Vector2(c*S.x+.5,o*S.y+.5);w.push(T.x,T.y,T.z),Z.push(0,a?1:-1,0);const e=j.y+(j.w-j.y)*t.y;h.push(j.x+(j.z-j.x)*t.x,p.d?1-e:e),L&&U.push(L.r,L.g,L.b,L.a)}for(C=0;C<G;C++)a?(J.push(e),J.push(e+(C+2)),J.push(e+(C+1))):(J.push(e),J.push(e+(C+1)),J.push(e+(C+2)))};e!==q.c.CAP_START&&e!==q.c.CAP_ALL||H(!1),e!==q.c.CAP_END&&e!==q.c.CAP_ALL||H(!0),i.e._ComputeSides(M,w,J,Z,h,a.frontUVs,a.backUVs);const b=new i.e;return b.indices=J,b.Ua=w,b.Sa=Z,b.xa=h,y&&(b.ra=U),b}function J(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const s=new q.c(a,o);c.sideOrientation=q.c._GetDefaultSideOrientation(c.sideOrientation),s._originalBuilderSideOrientation=c.sideOrientation;return f(c).da(s,c.updatable),s}function w(a){const c=[],o=[],q=[],t=[],G=a.diameter||1,T=a.thickness||.5,C=0|(a.tessellation||16),j=0===a.sideOrientation?0:a.sideOrientation||i.e.DEFAULTSIDE,L=C+1;for(let i=0;i<=C;i++){const a=i/C,j=i*Math.PI*2/C-Math.PI/2,e=s.Matrix.Translation(G/2,0,0).multiply(s.Matrix.RotationY(j));for(let G=0;G<=C;G++){const j=1-G/C,g=G*Math.PI*2/C+Math.PI,M=Math.cos(g),N=Math.sin(g);let y=new s.Hc(M,N,0),k=y.scale(T/2);const n=new s.Vector2(a,j);k=s.Hc.TransformCoordinates(k,e),y=s.Hc.TransformNormal(y,e),o.push(k.x,k.y,k.z),q.push(y.x,y.y,y.z),t.push(n.x,p.d?1-n.y:n.y);const f=(i+1)%L,J=(G+1)%L;c.push(i*L+G),c.push(i*L+J),c.push(f*L+G),c.push(i*L+J),c.push(f*L+J),c.push(f*L+G)}}i.e._ComputeSides(j,o,c,q,t,a.frontUVs,a.backUVs);const e=new i.e;return e.indices=c,e.Ua=o,e.Sa=q,e.xa=t,e}function Z(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const s=new q.c(a,o);c.sideOrientation=q.c._GetDefaultSideOrientation(c.sideOrientation),s._originalBuilderSideOrientation=c.sideOrientation;return w(c).da(s,c.updatable),s}i.e.CreateCylinder=f,q.c.CreateCylinder=(a,c,o,s,t,i,p,G,T)=>{void 0!==p&&p instanceof k.e||(void 0!==p&&(T=G||q.c.DEFAULTSIDE,G=p),p=i,i=1);return J(a,{height:c,diameterTop:o,diameterBottom:s,tessellation:t,subdivisions:i,sideOrientation:T,updatable:G},p)};function h(a){const c=[],o=[],q=[],t=[],G=a.radius||2,T=a.tube||.5,C=a.radialSegments||32,j=a.tubularSegments||32,L=a.p||2,e=a.q||3,g=0===a.sideOrientation?0:a.sideOrientation||i.e.DEFAULTSIDE,M=a=>{const c=Math.cos(a),o=Math.sin(a),q=e/L*a,t=Math.cos(q),i=G*(2+t)*.5*c,p=G*(2+t)*o*.5,T=G*Math.sin(q)*.5;return new s.Hc(i,p,T)};let N,y;for(N=0;N<=C;N++){const a=N%C/C*2*L*Math.PI,c=M(a),q=M(a+.01),i=q.vc(c);let G=q.add(c);const e=s.Hc.Cross(i,G);for(G=s.Hc.Cross(e,i),e.normalize(),G.normalize(),y=0;y<j;y++){const a=y%j/j*2*Math.PI,s=-T*Math.cos(a),q=T*Math.sin(a);o.push(c.x+s*G.x+q*e.x),o.push(c.y+s*G.y+q*e.y),o.push(c.z+s*G.z+q*e.z),t.push(N/C),t.push(p.d?1-y/j:y/j)}}for(N=0;N<C;N++)for(y=0;y<j;y++){const a=(y+1)%j,o=N*j+y,s=(N+1)*j+y,q=(N+1)*j+a,t=N*j+a;c.push(t),c.push(s),c.push(o),c.push(t),c.push(q),c.push(s)}i.e.ComputeNormals(o,c,q),i.e._ComputeSides(g,o,c,q,t,a.frontUVs,a.backUVs);const k=new i.e;return k.indices=c,k.Ua=o,k.Sa=q,k.xa=t,k}function U(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const s=new q.c(a,o);c.sideOrientation=q.c._GetDefaultSideOrientation(c.sideOrientation),s._originalBuilderSideOrientation=c.sideOrientation;return h(c).da(s,c.updatable),s}i.e.CreateTorus=w,q.c.CreateTorus=(a,c,o,s,q,t,i)=>Z(a,{diameter:c,thickness:o,tessellation:s,sideOrientation:i,updatable:t},q);i.e.CreateTorusKnot=h,q.c.CreateTorusKnot=(a,c,o,s,q,t,i,p,G,T)=>U(a,{radius:c,tube:o,radialSegments:s,tubularSegments:q,p:t,q:i,sideOrientation:T,updatable:G},p);var S=o(14512),r=o(13357),x=o(13016);function R(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=c.path,t=c.shape,i=c.scale||1,p=c.rotation||0,G=0===c.cap?0:c.cap||q.c.NO_CAP,T=c.updatable,C=q.c._GetDefaultSideOrientation(c.sideOrientation),j=c.instance||null,L=c.invertUV||!1,e=c.closeShape||!1,g=c.closePath||!1,M=c.capFunction||null;return X(a,t,s,i,p,null,null,g,e,G,!1,o,!!T,C,j,L,c.frontUVs||null,c.backUVs||null,c.firstNormal||null,!!c.adjustFrame,M)}function d(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=c.path,t=c.shape,i=c.scaleFunction||(()=>1),p=c.rotationFunction||(()=>0),G=c.closePath||c.ribbonCloseArray||!1,T=c.closeShape||c.ribbonClosePath||!1,C=0===c.cap?0:c.cap||q.c.NO_CAP,j=c.updatable,L=c.firstNormal||null,e=c.adjustFrame||!1,g=q.c._GetDefaultSideOrientation(c.sideOrientation),M=c.instance,N=c.invertUV||!1,y=c.capFunction||null;return X(a,t,s,null,null,i,p,G,T,C,!0,o,!!j,g,M||null,N,c.frontUVs||null,c.backUVs||null,L,e,y||null)}function X(a,c,o,t,i,p,G,C,j,L,e,g,M,N,y,k,n,f,J,w,Z){const h=(a,c,o,t,i,p,G,T,C,j,L)=>{const e=o.getTangents(),g=o.getNormals(),M=o.getBinormals(),N=o.getDistances();if(L)for(let q=0;q<e.length;q++)if(0==e[q].x&&0==e[q].y&&0==e[q].z&&e[q].G(e[q-1]),0==g[q].x&&0==g[q].y&&0==g[q].z&&g[q].G(g[q-1]),0==M[q].x&&0==M[q].y&&0==M[q].z&&M[q].G(M[q-1]),q>0){let a=e[q-1];s.Hc.Dot(a,e[q])<0&&e[q].scaleInPlace(-1),a=g[q-1],s.Hc.Dot(a,g[q])<0&&g[q].scaleInPlace(-1),a=M[q-1],s.Hc.Dot(a,M[q])<0&&M[q].scaleInPlace(-1)}let y=0;const k=j&&T?T:()=>null!==p?p:0,n=j&&G?G:()=>null!==i?i:1;let f=C===q.c.NO_CAP||C===q.c.CAP_END?0:2;const J=s.TmpVectors.Matrix[0];for(let q=0;q<c.length;q++){const o=[],i=k(q,N[q]),p=n(q,N[q]);s.Matrix.RotationAxisToRef(e[q],y,J);for(let t=0;t<a.length;t++){const i=e[q].scale(a[t].z).add(g[q].scale(a[t].x)).add(M[q].scale(a[t].y)),G=s.Hc.Zero();s.Hc.TransformCoordinatesToRef(i,J,G),G.scaleInPlace(p).addInPlace(c[q]),o[t]=G}t[f]=o,y+=i,f++}const w=Z||(a=>{const c=Array(),o=s.Hc.Zero();let q;for(q=0;q<a.length;q++)o.addInPlace(a[q]);for(o.scaleInPlace(1/a.length),q=0;q<a.length;q++)c.push(o);return c});switch(C){case q.c.NO_CAP:break;case q.c.CAP_START:t[0]=w(t[2]),t[1]=t[2];break;case q.c.CAP_END:t[f]=t[f-1],t[f+1]=w(t[f-1]);break;case q.c.CAP_ALL:t[0]=w(t[2]),t[1]=t[2],t[f]=t[f-1],t[f+1]=w(t[f-1])}return t};let U,S;if(y){const a=y._creationDataStorage;return U=J?a.path3D.update(o,J):a.path3D.update(o),S=h(c,o,a.path3D,a.pathArray,t,i,p,G,a.cap,e,w),y=T("",{pathArray:S,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:y},g||void 0)}U=J?new x.l(o,J):new x.l(o);S=h(c,o,U,new Array,t,i,p,G,L=L<0||L>3?0:L,e,w);const r=T(a,{pathArray:S,closeArray:C,closePath:j,updatable:M,sideOrientation:N,invertUV:k,frontUVs:n||void 0,backUVs:f||void 0},g);return r._creationDataStorage.pathArray=S,r._creationDataStorage.path3D=U,r._creationDataStorage.cap=L,r}function W(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=c.arc?c.arc<=0||c.arc>1?1:c.arc:1,i=void 0===c.closed||c.closed,p=c.shape,G=c.radius||1,C=c.tessellation||64,j=c.clip||0,L=c.updatable,e=q.c._GetDefaultSideOrientation(c.sideOrientation),g=c.cap||q.c.NO_CAP,M=2*Math.PI,N=[],y=c.invertUV||!1;let k=0,n=0;const f=M/C*t;let J,w;for(k=0;k<=C-j;k++){for(w=[],g!=q.c.CAP_START&&g!=q.c.CAP_ALL||(w.push(new s.Hc(0,p[0].y,0)),w.push(new s.Hc(Math.cos(k*f)*p[0].x*G,p[0].y,Math.sin(k*f)*p[0].x*G))),n=0;n<p.length;n++)J=new s.Hc(Math.cos(k*f)*p[n].x*G,p[n].y,Math.sin(k*f)*p[n].x*G),w.push(J);g!=q.c.CAP_END&&g!=q.c.CAP_ALL||(w.push(new s.Hc(Math.cos(k*f)*p[p.length-1].x*G,p[p.length-1].y,Math.sin(k*f)*p[p.length-1].x*G)),w.push(new s.Hc(0,p[p.length-1].y,0))),N.push(w)}return T(a,{pathArray:N,closeArray:i,sideOrientation:e,updatable:L,invertUV:y,frontUVs:c.frontUVs,backUVs:c.backUVs},o)}q.c.ExtrudeShape=function(a,c,o,s,t,i){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7?arguments[7]:void 0,T=arguments.length>8?arguments[8]:void 0,C=arguments.length>9?arguments[9]:void 0;return R(a,{shape:c,path:o,scale:s,rotation:t,cap:0===i?0:i||q.c.NO_CAP,sideOrientation:T,instance:C,updatable:G},p)},q.c.ExtrudeShapeCustom=(a,c,o,s,t,i,p,G,T,C,j,L)=>d(a,{shape:c,path:o,scaleFunction:s,rotationFunction:t,ribbonCloseArray:i,ribbonClosePath:p,cap:0===G?0:G||q.c.NO_CAP,sideOrientation:j,instance:L,updatable:C},T);q.c.CreateLathe=(a,c,o,s,q,t,i)=>W(a,{shape:c,radius:o,tessellation:s,sideOrientation:i,updatable:t},q);var F=o(13939),O=o(13901);function B(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=c.path;let i=c.instance,p=1;void 0!==c.radius?p=c.radius:i&&(p=i._creationDataStorage.radius);const G=c.tessellation||64,C=c.radiusFunction||null;let j=c.cap||q.c.NO_CAP;const L=c.invertUV||!1,e=c.updatable,g=q.c._GetDefaultSideOrientation(c.sideOrientation);c.arc=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1;const M=(a,c,o,t,i,p,G,T)=>{const C=c.getTangents(),j=c.getNormals(),L=c.getDistances(),e=2*Math.PI/i*T,g=p||(()=>t);let M,N,y,k;const n=s.TmpVectors.Matrix[0];let f=G===q.c.NO_CAP||G===q.c.CAP_END?0:2;for(let q=0;q<a.length;q++){N=g(q,L[q]),M=Array(),y=j[q];for(let c=0;c<i;c++)s.Matrix.RotationAxisToRef(C[q],e*c,n),k=M[c]?M[c]:s.Hc.Zero(),s.Hc.TransformCoordinatesToRef(y,n,k),k.scaleInPlace(N).addInPlace(a[q]),M[c]=k;o[f]=M,f++}const J=(c,o)=>{const s=Array();for(let q=0;q<c;q++)s.push(a[o]);return s};switch(G){case q.c.NO_CAP:break;case q.c.CAP_START:o[0]=J(i,0),o[1]=o[2].slice(0);break;case q.c.CAP_END:o[f]=o[f-1].slice(0),o[f+1]=J(i,a.length-1);break;case q.c.CAP_ALL:o[0]=J(i,0),o[1]=o[2].slice(0),o[f]=o[f-1].slice(0),o[f+1]=J(i,a.length-1)}return o};let N,y;if(i){const a=i._creationDataStorage,o=c.arc||a.arc;return N=a.path3D.update(t),y=M(t,N,a.pathArray,p,a.tessellation,C,a.cap,o),i=T("",{pathArray:y,instance:i}),a.path3D=N,a.pathArray=y,a.arc=o,a.radius=p,i}N=new x.l(t);j=j<0||j>3?0:j,y=M(t,N,new Array,p,G,C,j,c.arc);const k=T(a,{pathArray:y,closePath:!0,closeArray:!1,updatable:e,sideOrientation:g,invertUV:L,frontUVs:c.frontUVs,backUVs:c.backUVs},o);return k._creationDataStorage.pathArray=y,k._creationDataStorage.path3D=N,k._creationDataStorage.tessellation=G,k._creationDataStorage.cap=j,k._creationDataStorage.arc=c.arc,k._creationDataStorage.radius=p,k}function u(a){const c=[];c[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},c[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},c[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},c[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},c[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},c[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},c[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},c[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},c[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},c[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},c[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},c[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},c[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},c[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},c[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const o=a.type&&(a.type<0||a.type>=c.length)?0:a.type||0,q=a.size,t=a.sizeX||q||1,G=a.sizeY||q||1,T=a.sizeZ||q||1,C=a.custom||c[o],j=C.face.length,e=a.faceUV||new Array(j),g=a.faceColors,M=void 0===a.flat||a.flat,N=0===a.sideOrientation?0:a.sideOrientation||i.e.DEFAULTSIDE,y=[],k=[],n=[],f=[],J=[];let w=0,Z=0;const h=[];let U,S,r,x,R,d,X=0,W=0;if(M)for(W=0;W<j;W++)g&&void 0===g[W]&&(g[W]=new L.Yc(1,1,1,1)),e&&void 0===e[W]&&(e[W]=new s.Vector4(0,0,1,1));if(M)for(W=0;W<j;W++){const a=C.face[W].length;for(r=2*Math.PI/a,x=.5*Math.tan(r/2),R=.5,X=0;X<a;X++)y.push(C.vertex[C.face[W][X]][0]*t,C.vertex[C.face[W][X]][1]*G,C.vertex[C.face[W][X]][2]*T),h.push(w),w++,U=e[W].x+(e[W].z-e[W].x)*(.5+x),S=e[W].y+(e[W].w-e[W].y)*(R-.5),f.push(U,p.d?1-S:S),d=x*Math.cos(r)-R*Math.sin(r),R=x*Math.sin(r)+R*Math.cos(r),x=d,g&&J.push(g[W].r,g[W].g,g[W].b,g[W].a);for(X=0;X<a-2;X++)k.push(h[0+Z],h[X+2+Z],h[X+1+Z]);Z+=a}else{for(X=0;X<C.vertex.length;X++)y.push(C.vertex[X][0]*t,C.vertex[X][1]*G,C.vertex[X][2]*T),f.push(0,p.d?1:0);for(W=0;W<j;W++)for(X=0;X<C.face[W].length-2;X++)k.push(C.face[W][0],C.face[W][X+2],C.face[W][X+1])}i.e.ComputeNormals(y,k,n),i.e._ComputeSides(N,y,k,n,f,a.frontUVs,a.backUVs);const F=new i.e;return F.Ua=y,F.indices=k,F.Sa=n,F.xa=f,g&&M&&(F.ra=J),F}function K(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new q.c(a,o);c.sideOrientation=q.c._GetDefaultSideOrientation(c.sideOrientation),s._originalBuilderSideOrientation=c.sideOrientation;return u(c).da(s,c.updatable),s}q.c.CreateTube=(a,c,o,s,q,t,i,p,G,T)=>B(a,{path:c,radius:o,tessellation:s,radiusFunction:q,arc:1,cap:t,updatable:p,sideOrientation:G,instance:T},i);function D(a){const c=a.sideOrientation||i.e.DEFAULTSIDE,o=a.radius||1,q=void 0===a.flat||a.flat,t=0|(a.subdivisions||4),G=a.radiusX||o,T=a.radiusY||o,C=a.radiusZ||o,j=(1+Math.sqrt(5))/2,L=[-1,j,-0,1,j,0,-1,-j,0,1,-j,0,0,-1,-j,0,1,-j,0,-1,j,0,1,j,j,0,1,j,0,-1,-j,0,1,-j,0,-1],e=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],g=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],M=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],N=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],y=[],k=[],n=[],f=[];let J=0;const w=new Array(3),Z=new Array(3);let h;for(h=0;h<3;h++)w[h]=s.Hc.Zero(),Z[h]=s.Vector2.Zero();for(let i=0;i<20;i++){for(h=0;h<3;h++){const a=e[3*i+h];w[h].Bc(L[3*g[a]],L[3*g[a]+1],L[3*g[a]+2]),w[h].normalize(),Z[h].Bc(.134765625*M[2*a]+.05859375+-.0390625*N[i],.2333984375*M[2*a+1]+.025390625+.01953125*N[i])}const a=(a,c,o,i)=>{const j=s.Hc.Lerp(w[0],w[2],c/t),L=s.Hc.Lerp(w[1],w[2],c/t),e=t===c?w[2]:s.Hc.Lerp(j,L,a/(t-c));let g;if(e.normalize(),q){const a=s.Hc.Lerp(w[0],w[2],i/t),c=s.Hc.Lerp(w[1],w[2],i/t);g=s.Hc.Lerp(a,c,o/(t-i))}else g=new s.Hc(e.x,e.y,e.z);g.x/=G,g.y/=T,g.z/=C,g.normalize();const M=s.Vector2.Lerp(Z[0],Z[2],c/t),N=s.Vector2.Lerp(Z[1],Z[2],c/t),h=t===c?Z[2]:s.Vector2.Lerp(M,N,a/(t-c));k.push(e.x*G,e.y*T,e.z*C),n.push(g.x,g.y,g.z),f.push(h.x,p.d?1-h.y:h.y),y.push(J),J++};for(let c=0;c<t;c++)for(let o=0;o+c<t;o++)a(o,c,o+1/3,c+1/3),a(o+1,c,o+1/3,c+1/3),a(o,c+1,o+1/3,c+1/3),o+c+1<t&&(a(o+1,c,o+2/3,c+2/3),a(o+1,c+1,o+2/3,c+2/3),a(o,c+1,o+2/3,c+2/3))}i.e._ComputeSides(c,k,y,n,f,a.frontUVs,a.backUVs);const U=new i.e;return U.indices=y,U.Ua=k,U.Sa=n,U.xa=f,U}function I(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=new q.c(a,o);c.sideOrientation=q.c._GetDefaultSideOrientation(c.sideOrientation),s._originalBuilderSideOrientation=c.sideOrientation;return D(c).da(s,c.updatable),s}i.e.CreatePolyhedron=u,q.c.CreatePolyhedron=(a,c,o)=>K(a,c,o);i.e.CreateIcoSphere=D,q.c.CreateIcoSphere=(a,c,o)=>I(a,c,o);var Y=o(12824);const P=new s.Hc(1,0,0),ma=new s.Hc(-1,0,0),V=new s.Hc(0,1,0),E=new s.Hc(0,-1,0),H=new s.Hc(0,0,1),b=new s.Hc(0,0,-1);class A{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.Hc.Zero(),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.Hc.Up(),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.Vector2.Zero(),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=a,this.normal=c,this.uv=o,this.vertexIdx=q,this.vertexIdxForBones=t,this.localPositionOverride=i,this.localNormalOverride=p,this.matrixIndicesOverride=G,this.matrixWeightsOverride=T}clone(){var a,c,o,s;return new A(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(a=this.localPositionOverride)||void 0===a?void 0:a.slice(),null===(c=this.localNormalOverride)||void 0===c?void 0:c.slice(),null===(o=this.matrixIndicesOverride)||void 0===o?void 0:o.slice(),null===(s=this.matrixWeightsOverride)||void 0===s?void 0:s.slice())}}function v(a,c,o){var G,T,C,j,L;const e=!!c.skeleton,g=!(null===(G=c.morphTargetManager)||void 0===G||!G.numTargets),M=o.localMode||e,N=c.Wc(),y=e||g?c.Up(!0,!0):c.getVerticesData(t.g.PositionKind),k=e||g?c.getNormalsData(!0,!0):c.getVerticesData(t.g.NormalKind),n=M?e?c.getVerticesData(t.g.PositionKind):y:null,f=M?e?c.getVerticesData(t.g.NormalKind):k:null,J=c.getVerticesData(t.g.UVKind),w=e?c.getVerticesData(t.g.MatricesIndicesKind):null,Z=e?c.getVerticesData(t.g.MatricesWeightsKind):null,h=e?c.getVerticesData(t.g.MatricesIndicesExtraKind):null,U=e?c.getVerticesData(t.g.MatricesWeightsExtraKind):null,S=o.position||s.Hc.Zero();let r=o.normal||s.Hc.Up();const x=o.size||s.Hc.One(),R=o.angle||0;if(!r){const a=new s.Hc(0,0,1),o=c.Za().activeCamera,q=s.Hc.TransformCoordinates(a,o.getWorldMatrix());r=o.globalPosition.vc(q)}const d=-Math.atan2(r.z,r.x)-Math.PI/2,X=Math.sqrt(r.x*r.x+r.z*r.z),W=Math.atan2(r.y,X),F=new i.e;F.indices=[],F.Ua=[],F.Sa=[],F.xa=[],F.matricesIndices=e?[]:null,F.matricesWeights=e?[]:null,F.matricesIndicesExtra=h?[]:null,F.matricesWeightsExtra=U?[]:null;let O=0;const B=(a,c)=>{const q=new A;if(!N||!y||!k)return q;const t=N[a];if(q.vertexIdx=3*t,q.vertexIdxForBones=4*t,q.position=new s.Hc(y[3*t],y[3*t+1],y[3*t+2]),s.Hc.TransformCoordinatesToRef(q.position,c,q.position),q.normal=new s.Hc(k[3*t],k[3*t+1],k[3*t+2]),s.Hc.TransformNormalToRef(q.normal,c,q.normal),o.captureUVS&&J){const a=J[2*t+1];q.uv=new s.Vector2(J[2*t],p.d?1-a:a)}return q},u=[0,0,0,0],K=(a,c)=>{if(0===a.length)return a;const o=.5*Math.abs(s.Hc.Dot(x,c)),q=(a,c,o,s)=>{for(let q=0;q<s;++q)if(a[o+q]===c)return o+q;return-1},t=(a,t)=>{const i=s.Hc.GetClipFactor(a.position,t.position,c,o);let p=u,G=u;if(w&&Z){const c=a.matrixIndicesOverride?0:a.vertexIdxForBones,o=a.matrixIndicesOverride??w,s=a.matrixWeightsOverride??Z,T=t.matrixIndicesOverride?0:t.vertexIdxForBones,C=t.matrixIndicesOverride??w,j=t.matrixWeightsOverride??Z;p=[0,0,0,0],G=[0,0,0,0];let L=0;for(let a=0;a<4;++a)if(s[c+a]>0){const t=q(C,o[c+a],T,4);p[L]=o[c+a],G[L]=(0,Y.Lerp)(s[c+a],t>=0?j[t]:0,i),L++}for(let a=0;a<4&&L<4;++a){const s=C[T+a];-1===q(o,s,c,4)&&(p[L]=s,G[L]=(0,Y.Lerp)(0,j[T+a],i),L++)}const e=G[0]+G[1]+G[2]+G[3];G[0]/=e,G[1]/=e,G[2]/=e,G[3]/=e}const T=a.localPositionOverride?a.localPositionOverride[0]:(null===n||void 0===n?void 0:n[a.vertexIdx])??0,C=a.localPositionOverride?a.localPositionOverride[1]:(null===n||void 0===n?void 0:n[a.vertexIdx+1])??0,j=a.localPositionOverride?a.localPositionOverride[2]:(null===n||void 0===n?void 0:n[a.vertexIdx+2])??0,L=t.localPositionOverride?t.localPositionOverride[0]:(null===n||void 0===n?void 0:n[t.vertexIdx])??0,e=t.localPositionOverride?t.localPositionOverride[1]:(null===n||void 0===n?void 0:n[t.vertexIdx+1])??0,g=t.localPositionOverride?t.localPositionOverride[2]:(null===n||void 0===n?void 0:n[t.vertexIdx+2])??0,M=a.localNormalOverride?a.localNormalOverride[0]:(null===f||void 0===f?void 0:f[a.vertexIdx])??0,N=a.localNormalOverride?a.localNormalOverride[1]:(null===f||void 0===f?void 0:f[a.vertexIdx+1])??0,y=a.localNormalOverride?a.localNormalOverride[2]:(null===f||void 0===f?void 0:f[a.vertexIdx+2])??0,k=M+((t.localNormalOverride?t.localNormalOverride[0]:(null===f||void 0===f?void 0:f[t.vertexIdx])??0)-M)*i,J=N+((t.localNormalOverride?t.localNormalOverride[1]:(null===f||void 0===f?void 0:f[t.vertexIdx+1])??0)-N)*i,h=y+((t.localNormalOverride?t.localNormalOverride[2]:(null===f||void 0===f?void 0:f[t.vertexIdx+2])??0)-y)*i,U=Math.sqrt(k*k+J*J+h*h);return new A(s.Hc.Lerp(a.position,t.position,i),s.Hc.Lerp(a.normal,t.normal,i).normalize(),s.Vector2.Lerp(a.uv,t.uv,i),-1,-1,n?[T+(L-T)*i,C+(e-C)*i,j+(g-j)*i]:null,f?[k/U,J/U,h/U]:null,p,G)};let i=null;a.length>3&&(i=[]);for(let p=0;p<a.length;p+=3){let q=0,G=null,T=null,C=null,j=null;const L=s.Hc.Dot(a[p].position,c)-o>0,e=s.Hc.Dot(a[p+1].position,c)-o>0,g=s.Hc.Dot(a[p+2].position,c)-o>0;switch(q=(L?1:0)+(e?1:0)+(g?1:0),q){case 0:a.length>3?(i.push(a[p]),i.push(a[p+1]),i.push(a[p+2])):i=a;break;case 1:if(i=i??new Array,L&&(G=a[p+1],T=a[p+2],C=t(a[p],G),j=t(a[p],T)),e){G=a[p],T=a[p+2],C=t(a[p+1],G),j=t(a[p+1],T),i.push(C),i.push(T.clone()),i.push(G.clone()),i.push(T.clone()),i.push(C.clone()),i.push(j);break}g&&(G=a[p],T=a[p+1],C=t(a[p+2],G),j=t(a[p+2],T)),G&&T&&C&&j&&(i.push(G.clone()),i.push(T.clone()),i.push(C),i.push(j),i.push(C.clone()),i.push(T.clone()));break;case 2:i=i??new Array,L||(G=a[p].clone(),T=t(G,a[p+1]),C=t(G,a[p+2]),i.push(G),i.push(T),i.push(C)),e||(G=a[p+1].clone(),T=t(G,a[p+2]),C=t(G,a[p]),i.push(G),i.push(T),i.push(C)),g||(G=a[p+2].clone(),T=t(G,a[p]),C=t(G,a[p+1]),i.push(G),i.push(T),i.push(C))}}return i},D=c instanceof q.c?c:null,I=null===D||void 0===D?void 0:D._thinInstanceDataStorage.matrixData,v=(null===D||void 0===D?void 0:D.Ec)||1,l=s.TmpVectors.Matrix[0];l.G(s.Matrix.IdentityReadOnly);for(let q=0;q<v;++q){if(null!==D&&void 0!==D&&D.hasThinInstances&&I){const a=16*q;l.setRowFromFloats(0,I[a+0],I[a+1],I[a+2],I[a+3]),l.setRowFromFloats(1,I[a+4],I[a+5],I[a+6],I[a+7]),l.setRowFromFloats(2,I[a+8],I[a+9],I[a+10],I[a+11]),l.setRowFromFloats(3,I[a+12],I[a+13],I[a+14],I[a+15])}const a=s.Matrix.RotationYawPitchRoll(d,W,R).multiply(s.Matrix.Translation(S.x,S.y,S.z)),t=s.Matrix.Invert(a),i=c.getWorldMatrix(),G=l.multiply(i).multiply(t),T=new Array(3);for(let c=0;c<N.length;c+=3){let a=T;if(a[0]=B(c,G),a[1]=B(c+1,G),a[2]=B(c+2,G),!(o.cullBackFaces&&-a[0].normal.z<=0&&-a[1].normal.z<=0&&-a[2].normal.z<=0)&&(a=K(a,P),a&&(a=K(a,ma),a&&(a=K(a,V),a&&(a=K(a,E),a&&(a=K(a,H),a&&(a=K(a,b),a)))))))for(let c=0;c<a.length;c++){const s=a[c];if(F.indices.push(O),M?(s.localPositionOverride?(F.Ua[3*O]=s.localPositionOverride[0],F.Ua[3*O+1]=s.localPositionOverride[1],F.Ua[3*O+2]=s.localPositionOverride[2]):n&&(F.Ua[3*O]=n[s.vertexIdx],F.Ua[3*O+1]=n[s.vertexIdx+1],F.Ua[3*O+2]=n[s.vertexIdx+2]),s.localNormalOverride?(F.Sa[3*O]=s.localNormalOverride[0],F.Sa[3*O+1]=s.localNormalOverride[1],F.Sa[3*O+2]=s.localNormalOverride[2]):f&&(F.Sa[3*O]=f[s.vertexIdx],F.Sa[3*O+1]=f[s.vertexIdx+1],F.Sa[3*O+2]=f[s.vertexIdx+2])):(s.position.toArray(F.Ua,3*O),s.normal.toArray(F.Sa,3*O)),F.matricesIndices&&F.matricesWeights&&(s.matrixIndicesOverride?(F.matricesIndices[4*O]=s.matrixIndicesOverride[0],F.matricesIndices[4*O+1]=s.matrixIndicesOverride[1],F.matricesIndices[4*O+2]=s.matrixIndicesOverride[2],F.matricesIndices[4*O+3]=s.matrixIndicesOverride[3]):(w&&(F.matricesIndices[4*O]=w[s.vertexIdxForBones],F.matricesIndices[4*O+1]=w[s.vertexIdxForBones+1],F.matricesIndices[4*O+2]=w[s.vertexIdxForBones+2],F.matricesIndices[4*O+3]=w[s.vertexIdxForBones+3]),h&&F.matricesIndicesExtra&&(F.matricesIndicesExtra[4*O]=h[s.vertexIdxForBones],F.matricesIndicesExtra[4*O+1]=h[s.vertexIdxForBones+1],F.matricesIndicesExtra[4*O+2]=h[s.vertexIdxForBones+2],F.matricesIndicesExtra[4*O+3]=h[s.vertexIdxForBones+3])),s.matrixWeightsOverride?(F.matricesWeights[4*O]=s.matrixWeightsOverride[0],F.matricesWeights[4*O+1]=s.matrixWeightsOverride[1],F.matricesWeights[4*O+2]=s.matrixWeightsOverride[2],F.matricesWeights[4*O+3]=s.matrixWeightsOverride[3]):(Z&&(F.matricesWeights[4*O]=Z[s.vertexIdxForBones],F.matricesWeights[4*O+1]=Z[s.vertexIdxForBones+1],F.matricesWeights[4*O+2]=Z[s.vertexIdxForBones+2],F.matricesWeights[4*O+3]=Z[s.vertexIdxForBones+3]),U&&F.matricesWeightsExtra&&(F.matricesWeightsExtra[4*O]=U[s.vertexIdxForBones],F.matricesWeightsExtra[4*O+1]=U[s.vertexIdxForBones+1],F.matricesWeightsExtra[4*O+2]=U[s.vertexIdxForBones+2],F.matricesWeightsExtra[4*O+3]=U[s.vertexIdxForBones+3]))),o.captureUVS)s.uv.toArray(F.xa,2*O);else{F.xa.push(.5+s.position.x/x.x);const a=.5+s.position.y/x.y;F.xa.push(p.d?1-a:a)}O++}}}0===F.indices.length&&(F.indices=null),0===F.Ua.length&&(F.Ua=null),0===F.Sa.length&&(F.Sa=null),0===F.xa.length&&(F.xa=null),0===(null===(T=F.matricesIndices)||void 0===T?void 0:T.length)&&(F.matricesIndices=null),0===(null===(C=F.matricesWeights)||void 0===C?void 0:C.length)&&(F.matricesWeights=null),0===(null===(j=F.matricesIndicesExtra)||void 0===j?void 0:j.length)&&(F.matricesIndicesExtra=null),0===(null===(L=F.matricesWeightsExtra)||void 0===L?void 0:L.length)&&(F.matricesWeightsExtra=null);const Q=new q.c(a,c.Za());return F.da(Q),M?(Q.skeleton=c.skeleton,Q.parent=c):(Q.position=S.clone(),Q.rotation=new s.Hc(W,d,R)),Q.Rc(!0),Q.refreshBoundingInfo(!0,!0),Q}function l(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const c=0|Math.max(a.subdivisions?a.subdivisions:2,1),o=0|Math.max(a.tessellation?a.tessellation:16,3),q=Math.max(a.height?a.height:1,0),t=Math.max(a.radius?a.radius:.25,0),G=0|Math.max(a.capSubdivisions?a.capSubdivisions:6,1),T=o,C=c,j=Math.max(a.radiusTop?a.radiusTop:t,0),L=Math.max(a.radiusBottom?a.radiusBottom:t,0),e=q-(j+L),g=2*Math.PI,M=Math.max(a.topCapSubdivisions?a.topCapSubdivisions:G,1),N=Math.max(a.bottomCapSubdivisions?a.bottomCapSubdivisions:G,1),y=Math.acos((L-j)/q);let k=[];const n=[],f=[],J=[];let w=0;const Z=[],h=.5*e,U=.5*Math.PI;let S,r;const x=s.Hc.Zero(),R=s.Hc.Zero(),d=Math.cos(y),X=Math.sin(y),W=new s.Vector2(j*X,h+j*d).vc(new s.Vector2(L*X,L*d-h)).length(),F=j*y+W+L*(U-y);let O=0;for(r=0;r<=M;r++){const a=[],c=U-y*(r/M);O+=j*y/M;const o=Math.cos(c),s=Math.sin(c),q=o*j;for(S=0;S<=T;S++){const c=S/T,t=c*g+0,i=Math.sin(t),G=Math.cos(t);R.x=q*i,R.y=h+s*j,R.z=q*G,n.push(R.x,R.y,R.z),x.set(o*i,s,o*G),f.push(x.x,x.y,x.z),J.push(c,p.d?O/F:1-O/F),a.push(w),w++}Z.push(a)}const B=q-j-L+d*j-d*L,u=X*(L-j)/B;for(r=1;r<=C;r++){const a=[];O+=W/C;const c=X*(r*(L-j)/C+j);for(S=0;S<=T;S++){const o=S/T,s=o*g+0,q=Math.sin(s),t=Math.cos(s);R.x=c*q,R.y=h+d*j-r*B/C,R.z=c*t,n.push(R.x,R.y,R.z),x.set(q,u,t).normalize(),f.push(x.x,x.y,x.z),J.push(o,p.d?O/F:1-O/F),a.push(w),w++}Z.push(a)}for(r=1;r<=N;r++){const a=[],c=U-y-(Math.PI-y)*(r/N);O+=L*y/N;const o=Math.cos(c),s=Math.sin(c),q=o*L;for(S=0;S<=T;S++){const c=S/T,t=c*g+0,i=Math.sin(t),G=Math.cos(t);R.x=q*i,R.y=s*L-h,R.z=q*G,n.push(R.x,R.y,R.z),x.set(o*i,s,o*G),f.push(x.x,x.y,x.z),J.push(c,p.d?O/F:1-O/F),a.push(w),w++}Z.push(a)}for(S=0;S<T;S++)for(r=0;r<M+C+N;r++){const a=Z[r][S],c=Z[r+1][S],o=Z[r+1][S+1],s=Z[r][S+1];k.push(a),k.push(c),k.push(s),k.push(c),k.push(o),k.push(s)}if(k=k.reverse(),a.orientation&&!a.orientation.equals(s.Hc.Up())){const c=new s.Matrix;a.orientation.clone().scale(.5*Math.PI).cross(s.Hc.Up()).toQuaternion().toRotationMatrix(c);const o=s.Hc.Zero();for(let a=0;a<n.length;a+=3)o.set(n[a],n[a+1],n[a+2]),s.Hc.TransformCoordinatesToRef(o.clone(),c,o),n[a]=o.x,n[a+1]=o.y,n[a+2]=o.z}const K=new i.e;return K.Ua=n,K.Sa=f,K.xa=J,K.indices=k,K}function Q(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:s.Hc.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new q.c(a,o);return l(c).da(t,c.updatable),t}q.c.CreateDecal=(a,c,o,s,q,t)=>v(a,c,{position:o,normal:s,size:q,angle:t});q.c.CreateCapsule=(a,c,o)=>Q(a,c,o),i.e.CreateCapsule=l;var z=o(12649),aa=o(12812);class ca{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=a,this.y=c,a!==Math.floor(a)&&(a=Math.floor(a),z.c.Warn("x is not an integer, floor(x) used")),c!==Math.floor(c)&&(c=Math.floor(c),z.c.Warn("y is not an integer, floor(y) used"))}clone(){return new ca(this.x,this.y)}rotate60About(a){const c=this.x;return this.x=a.x+a.y-this.y,this.y=c+this.y-a.x,this}rotateNeg60About(a){const c=this.x;return this.x=c+this.y-a.y,this.y=a.x+a.y-c,this}rotate120(a,c){a!==Math.floor(a)&&(a=Math.floor(a),z.c.Warn("m not an integer only floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),z.c.Warn("n not an integer only floor(n) used"));const o=this.x;return this.x=a-o-this.y,this.y=c+o,this}rotateNeg120(a,c){a!==Math.floor(a)&&(a=Math.floor(a),z.c.Warn("m is not an integer, floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),z.c.Warn("n is not an integer,   floor(n) used"));const o=this.x;return this.x=this.y-c,this.y=a+c-o-this.y,this}toCartesianOrigin(a,c){const o=s.Hc.Zero();return o.x=a.x+2*this.x*c+this.y*c,o.y=a.y+Math.sqrt(3)*this.y*c,o}static Zero(){return new ca(0,0)}}class oa{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new sa("icosahedron","Regular",[[0,aa.d,-1],[-aa.d,1,0],[-1,0,-aa.d],[1,0,-aa.d],[aa.d,1,0],[0,aa.d,1],[-1,0,aa.d],[-aa.d,-1,0],[0,-aa.d,-1],[aa.d,-1,0],[1,0,aa.d],[0,-aa.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let a=12;const c={},o=this.m,s=this.n;let q,t,i,p,G,T=o,C=1,j=0;0!==s&&(T=(0,Y.HighestCommonFactor)(o,s)),C=o/T,j=s/T;const L=ca.Zero(),e=new ca(o,s),g=new ca(-s,o+s),M=ca.Zero(),N=ca.Zero(),y=ca.Zero();let k,n,f,J,w=[];const Z=[],h=this.vertByDist,U=(o,s,q,t)=>{k=o+"|"+q,n=s+"|"+t,k in c||n in c?k in c&&!(n in c)?c[n]=c[k]:n in c&&!(k in c)&&(c[k]=c[n]):(c[k]=a,c[n]=a,a++),h[q][0]>2?Z[c[k]]=[-h[q][0],h[q][1],c[k]]:Z[c[k]]=[w[h[q][0]],h[q][1],c[k]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let S=0;S<20;S++){if(w=this.IDATA.face[S],i=w[2],p=w[1],G=w[0],f=L.x+"|"+L.y,k=S+"|"+f,k in c||(c[k]=i,Z[i]=[w[h[f][0]],h[f][1]]),f=e.x+"|"+e.y,k=S+"|"+f,k in c||(c[k]=p,Z[p]=[w[h[f][0]],h[f][1]]),f=g.x+"|"+g.y,k=S+"|"+f,k in c||(c[k]=G,Z[G]=[w[h[f][0]],h[f][1]]),q=this.IDATA.edgematch[S][0],t=this.IDATA.edgematch[S][1],"B"===t)for(let a=1;a<T;a++)N.x=o-a*(C+j),N.y=s+a*C,y.x=-a*j,y.y=a*(C+j),f=N.x+"|"+N.y,J=y.x+"|"+y.y,U(S,q,f,J);if("O"===t)for(let a=1;a<T;a++)y.x=-a*j,y.y=a*(C+j),M.x=a*C,M.y=a*j,f=y.x+"|"+y.y,J=M.x+"|"+M.y,U(S,q,f,J);if(q=this.IDATA.edgematch[S][2],t=this.IDATA.edgematch[S][3],t&&"A"===t)for(let a=1;a<T;a++)M.x=a*C,M.y=a*j,N.x=o-(T-a)*(C+j),N.y=s+(T-a)*C,f=M.x+"|"+M.y,J=N.x+"|"+N.y,U(S,q,f,J);for(let o=0;o<this.vertices.length;o++)f=this.vertices[o].x+"|"+this.vertices[o].y,k=S+"|"+f,k in c||(c[k]=a++,h[f][0]>2?Z[c[k]]=[-h[f][0],h[f][1],c[k]]:Z[c[k]]=[w[h[f][0]],h[f][1],c[k]])}this.closestTo=Z,this.vecToidx=c}calcCoeffs(){const a=this.m,c=this.n,o=Math.sqrt(3)/3,s=a*a+c*c+a*c;this.coau=(a+c)/s,this.cobu=-c/s,this.coav=-o*(a-c)/s,this.cobv=o*(2*a+c)/s}createInnerFacets(){const a=this.m,c=this.n;for(let o=0;o<c+a+1;o++)for(let a=this.min[o];a<this.max[o]+1;a++)a<this.max[o]&&a<this.max[o+1]+1&&this.innerFacets.push(["|"+a+"|"+o,"|"+a+"|"+(o+1),"|"+(a+1)+"|"+o]),o>0&&a<this.max[o-1]&&a+1<this.max[o]+1&&this.innerFacets.push(["|"+a+"|"+o,"|"+(a+1)+"|"+o,"|"+(a+1)+"|"+(o-1)])}edgeVecsABOB(){const a=this.m,c=this.n,o=new ca(-c,a+c);for(let s=1;s<a+c;s++){const a=new ca(this.min[s],s),c=new ca(this.min[s-1],s-1),q=new ca(this.min[s+1],s+1),t=a.clone(),i=c.clone(),p=q.clone();t.rotate60About(o),i.rotate60About(o),p.rotate60About(o);const G=new ca(this.max[t.y],t.y),T=new ca(this.max[t.y-1],t.y-1),C=new ca(this.max[t.y-1]-1,t.y-1);t.x===G.x&&t.y===G.y||(t.x!==T.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([a,T,C]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([a,C,G])):t.y===p.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([a,c,T]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([a,T,q])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([a,c,T]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([a,T,G])))}}mapABOBtoOBOA(){const a=new ca(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const o=[];for(let s=0;s<3;s++)a.x=this.isoVecsABOB[c][s].x,a.y=this.isoVecsABOB[c][s].y,0===this.vertexTypes[c][s]&&a.rotateNeg120(this.m,this.n),o.push(a.clone());this.isoVecsOBOA.push(o)}}mapABOBtoBAOA(){const a=new ca(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const o=[];for(let s=0;s<3;s++)a.x=this.isoVecsABOB[c][s].x,a.y=this.isoVecsABOB[c][s].y,1===this.vertexTypes[c][s]&&a.rotate120(this.m,this.n),o.push(a.clone());this.isoVecsBAOA.push(o)}}MapToFace(a,c){const o=this.IDATA.face[a],q=o[2],t=o[1],i=o[0],p=s.Hc.qo(this.IDATA.vertex[q]),G=s.Hc.qo(this.IDATA.vertex[t]),T=s.Hc.qo(this.IDATA.vertex[i]),C=G.vc(p),j=T.vc(p),L=C.scale(this.coau).add(j.scale(this.cobu)),e=C.scale(this.coav).add(j.scale(this.cobv)),g=[];let M,N=s.TmpVectors.Hc[0];for(let s=0;s<this.cartesian.length;s++)N=L.scale(this.cartesian[s].x).add(e.scale(this.cartesian[s].y)).add(p),g[s]=[N.x,N.y,N.z],M=a+"|"+this.vertices[s].x+"|"+this.vertices[s].y,c.vertex[this.vecToidx[M]]=[N.x,N.y,N.z]}build(a,c){const o=[],s=ca.Zero(),q=new ca(a,c),t=new ca(-c,a+c);o.push(s,q,t);for(let f=c;f<a+1;f++)for(let c=0;c<a+1-f;c++)o.push(new ca(c,f));if(c>0){const s=(0,Y.HighestCommonFactor)(a,c),q=a/s,t=c/s;for(let p=1;p<s;p++)o.push(new ca(p*q,p*t)),o.push(new ca(-p*t,p*(q+t))),o.push(new ca(a-p*(q+t),c+p*q));const i=a/c;for(let p=1;p<c;p++)for(let s=0;s<p*i;s++)o.push(new ca(s,p)),o.push(new ca(s,p).rotate120(a,c)),o.push(new ca(s,p).rotateNeg120(a,c))}o.sort(((a,c)=>a.x-c.x)),o.sort(((a,c)=>a.y-c.y));const i=new Array(a+c+1),p=new Array(a+c+1);for(let f=0;f<i.length;f++)i[f]=1/0,p[f]=-1/0;let G=0,T=0;const C=o.length;for(let f=0;f<C;f++)T=o[f].x,G=o[f].y,i[G]=Math.min(T,i[G]),p[G]=Math.max(T,p[G]);const j=(o,s)=>{const q=o.clone();return"A"===s&&q.rotateNeg120(a,c),"B"===s&&q.rotate120(a,c),q.x<0?q.y:q.x+q.y},L=[],e=[],g=[],M=[],N={},y=[];let k=-1,n=-1;for(let f=0;f<C;f++)L[f]=o[f].toCartesianOrigin(new ca(0,0),.5),e[f]=j(o[f],"O"),g[f]=j(o[f],"A"),M[f]=j(o[f],"B"),e[f]===g[f]&&g[f]===M[f]?(k=3,n=e[f]):e[f]===g[f]?(k=4,n=e[f]):g[f]===M[f]?(k=5,n=g[f]):M[f]===e[f]&&(k=6,n=e[f]),e[f]<g[f]&&e[f]<M[f]&&(k=2,n=e[f]),g[f]<e[f]&&g[f]<M[f]&&(k=1,n=g[f]),M[f]<g[f]&&M[f]<e[f]&&(k=0,n=M[f]),y.push([k,n,o[f].x,o[f].y]);y.sort(((a,c)=>a[2]-c[2])),y.sort(((a,c)=>a[3]-c[3])),y.sort(((a,c)=>a[1]-c[1])),y.sort(((a,c)=>a[0]-c[0]));for(let f=0;f<y.length;f++)N[y[f][2]+"|"+y[f][3]]=[y[f][0],y[f][1],f];return this.m=a,this.n=c,this.vertices=o,this.vertByDist=N,this.cartesian=L,this.min=i,this.max=p,this}}class sa{constructor(a,c,o,s){this.name=a,this.category=c,this.vertex=o,this.face=s}}class qa extends sa{innerToData(a,c){for(let o=0;o<c.innerFacets.length;o++)this.face.push(c.innerFacets[o].map((o=>c.vecToidx[a+o])))}mapABOBtoDATA(a,c){const o=c.IDATA.edgematch[a][0];for(let s=0;s<c.isoVecsABOB.length;s++){const q=[];for(let t=0;t<3;t++)0===c.vertexTypes[s][t]?q.push(a+"|"+c.isoVecsABOB[s][t].x+"|"+c.isoVecsABOB[s][t].y):q.push(o+"|"+c.isoVecsABOB[s][t].x+"|"+c.isoVecsABOB[s][t].y);this.face.push([c.vecToidx[q[0]],c.vecToidx[q[1]],c.vecToidx[q[2]]])}}mapOBOAtoDATA(a,c){const o=c.IDATA.edgematch[a][0];for(let s=0;s<c.isoVecsOBOA.length;s++){const q=[];for(let t=0;t<3;t++)1===c.vertexTypes[s][t]?q.push(a+"|"+c.isoVecsOBOA[s][t].x+"|"+c.isoVecsOBOA[s][t].y):q.push(o+"|"+c.isoVecsOBOA[s][t].x+"|"+c.isoVecsOBOA[s][t].y);this.face.push([c.vecToidx[q[0]],c.vecToidx[q[1]],c.vecToidx[q[2]]])}}mapBAOAtoDATA(a,c){const o=c.IDATA.edgematch[a][2];for(let s=0;s<c.isoVecsBAOA.length;s++){const q=[];for(let t=0;t<3;t++)1===c.vertexTypes[s][t]?q.push(a+"|"+c.isoVecsBAOA[s][t].x+"|"+c.isoVecsBAOA[s][t].y):q.push(o+"|"+c.isoVecsBAOA[s][t].x+"|"+c.isoVecsBAOA[s][t].y);this.face.push([c.vecToidx[q[0]],c.vecToidx[q[1]],c.vecToidx[q[2]]])}}orderData(a){const c=[];for(let t=0;t<13;t++)c[t]=[];const o=a.closestTo;for(let t=0;t<o.length;t++)o[t][0]>-1?o[t][1]>0&&c[o[t][0]].push([t,o[t][1]]):c[12].push([t,o[t][0]]);const s=[];for(let t=0;t<12;t++)s[t]=t;let q=12;for(let t=0;t<12;t++){c[t].sort(((a,c)=>a[1]-c[1]));for(let a=0;a<c[t].length;a++)s[c[t][a][0]]=q++}for(let t=0;t<c[12].length;t++)s[c[12][t][0]]=q++;for(let t=0;t<this.vertex.length;t++)this.vertex[t].push(s[t]);this.vertex.sort(((a,c)=>a[3]-c[3]));for(let t=0;t<this.vertex.length;t++)this.vertex[t].pop();for(let t=0;t<this.face.length;t++)for(let a=0;a<this.face[t].length;a++)this.face[t][a]=s[this.face[t][a]];this.sharedNodes=c[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(a,c){const o=[],s=[];let q=c.pop();s.push(q);let t=this.face[q].indexOf(a);t=(t+2)%3;let i=this.face[q][t];o.push(i);let p=0;for(;c.length>0;)q=c[p],this.face[q].indexOf(i)>-1?(t=(this.face[q].indexOf(i)+1)%3,i=this.face[q][t],o.push(i),s.push(q),c.splice(p,1),p=0):p++;return this.adjacentFaces.push(o),s}toGoldbergPolyhedronData(){const a=new sa("GeoDual","Goldberg",[],[]);a.name="GD dual";const c=this.vertex.length,o=new Array(c);for(let G=0;G<c;G++)o[G]=[];for(let G=0;G<this.face.length;G++)for(let a=0;a<3;a++)o[this.face[G][a]].push(G);let s=0,q=0,t=0,i=[],p=[];this.adjacentFaces=[];for(let G=0;G<o.length;G++){a.face[G]=this.setOrder(G,o[G].concat([]));for(const c of o[G]){s=0,q=0,t=0,i=this.face[c];for(let a=0;a<3;a++)p=this.vertex[i[a]],s+=p[0],q+=p[1],t+=p[2];a.vertex[c]=[s/3,q/3,t/3]}}return a}static BuildGeodesicData(a){const c=new qa("Geodesic-m-n","Geodesic",[[0,aa.d,-1],[-aa.d,1,0],[-1,0,-aa.d],[1,0,-aa.d],[aa.d,1,0],[0,aa.d,1],[-1,0,aa.d],[-aa.d,-1,0],[0,-aa.d,-1],[aa.d,-1,0],[1,0,aa.d],[0,-aa.d,1]],[]);a.setIndices(),a.calcCoeffs(),a.createInnerFacets(),a.edgeVecsABOB(),a.mapABOBtoOBOA(),a.mapABOBtoBAOA();for(let o=0;o<a.IDATA.face.length;o++)a.MapToFace(o,c),c.innerToData(o,a),"B"===a.IDATA.edgematch[o][1]&&c.mapABOBtoDATA(o,a),"O"===a.IDATA.edgematch[o][1]&&c.mapOBOAtoDATA(o,a),"A"===a.IDATA.edgematch[o][3]&&c.mapBAOAtoDATA(o,a);c.orderData(a);return c.vertex=c.vertex.map((function(a){const c=a[0],o=a[1],s=a[2],q=Math.sqrt(c*c+o*o+s*s);return a[0]*=1/q,a[1]*=1/q,a[2]*=1/q,a})),c}}q.c._GoldbergMeshParser=(a,c)=>ta.Parse(a,c);class ta extends q.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(a,c){return void 0===c?(a>this.goldbergData.nbUnsharedFaces-1&&(z.c.Warn("Maximum number of unshared faces used"),a=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+a):(a>11&&(z.c.Warn("Last pole used"),a=11),c>this.goldbergData.nbFacesAtPole-1&&(z.c.Warn("Maximum number of faces at a pole used"),c=this.goldbergData.nbFacesAtPole-1),12+a*this.goldbergData.nbFacesAtPole+c)}_changeGoldbergFaceColors(a){for(let o=0;o<a.length;o++){const c=a[o][0],s=a[o][1],q=a[o][2];for(let a=c;a<s+1;a++)this.goldbergData.faceColors[a]=q}const c=[];for(let o=0;o<12;o++)for(let a=0;a<5;a++)c.push(this.goldbergData.faceColors[o].r,this.goldbergData.faceColors[o].g,this.goldbergData.faceColors[o].b,this.goldbergData.faceColors[o].a);for(let o=12;o<this.goldbergData.faceColors.length;o++)for(let a=0;a<6;a++)c.push(this.goldbergData.faceColors[o].r,this.goldbergData.faceColors[o].g,this.goldbergData.faceColors[o].b,this.goldbergData.faceColors[o].a);return c}setGoldbergFaceColors(a){const c=this._changeGoldbergFaceColors(a);this.Oa(t.g.ColorKind,c)}updateGoldbergFaceColors(a){const c=this._changeGoldbergFaceColors(a);this.updateVerticesData(t.g.ColorKind,c)}_changeGoldbergFaceUVs(a){const c=this.getVerticesData(t.g.UVKind);for(let o=0;o<a.length;o++){const s=a[o][0],q=a[o][1],t=a[o][2],i=a[o][3],p=a[o][4],G=[],T=[];let C,j;for(let a=0;a<5;a++)C=t.x+i*Math.cos(p+a*Math.PI/2.5),j=t.y+i*Math.sin(p+a*Math.PI/2.5),C<0&&(C=0),C>1&&(C=1),G.push(C,j);for(let a=0;a<6;a++)C=t.x+i*Math.cos(p+a*Math.PI/3),j=t.y+i*Math.sin(p+a*Math.PI/3),C<0&&(C=0),C>1&&(C=1),T.push(C,j);for(let a=s;a<Math.min(12,q+1);a++)for(let o=0;o<5;o++)c[10*a+2*o]=G[2*o],c[10*a+2*o+1]=G[2*o+1];for(let a=Math.max(12,s);a<q+1;a++)for(let o=0;o<6;o++)c[12*a-24+2*o]=T[2*o],c[12*a-23+2*o]=T[2*o+1]}return c}setGoldbergFaceUVs(a){const c=this._changeGoldbergFaceUVs(a);this.Oa(t.g.UVKind,c)}updateGoldbergFaceUVs(a){const c=this._changeGoldbergFaceUVs(a);this.updateVerticesData(t.g.UVKind,c)}placeOnGoldbergFaceAt(a,c,o){const q=s.Hc.RotationFromAxis(this.goldbergData.faceXaxis[c],this.goldbergData.faceYaxis[c],this.goldbergData.faceZaxis[c]);a.rotation=q,a.position=this.goldbergData.faceCenters[c].add(this.goldbergData.faceXaxis[c].scale(o.x)).add(this.goldbergData.faceYaxis[c].scale(o.y)).add(this.goldbergData.faceZaxis[c].scale(o.z))}serialize(a){super.serialize(a),a.type="GoldbergMesh";const c={};if(c.adjacentFaces=this.goldbergData.adjacentFaces,c.nbSharedFaces=this.goldbergData.nbSharedFaces,c.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,c.nbFaces=this.goldbergData.nbFaces,c.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){c.faceColors=[];for(const a of this.goldbergData.faceColors)c.faceColors.push(a.hc())}if(this.goldbergData.faceCenters){c.faceCenters=[];for(const a of this.goldbergData.faceCenters)c.faceCenters.push(a.hc())}if(this.goldbergData.faceZaxis){c.faceZaxis=[];for(const a of this.goldbergData.faceZaxis)c.faceZaxis.push(a.hc())}if(this.goldbergData.faceYaxis){c.faceYaxis=[];for(const a of this.goldbergData.faceYaxis)c.faceYaxis.push(a.hc())}if(this.goldbergData.faceXaxis){c.faceXaxis=[];for(const a of this.goldbergData.faceXaxis)c.faceXaxis.push(a.hc())}a.goldbergData=c}static Parse(a,c){const o=a.goldbergData;o.faceColors=o.faceColors.map((a=>L.Yc.qo(a))),o.faceCenters=o.faceCenters.map((a=>s.Hc.qo(a))),o.faceZaxis=o.faceZaxis.map((a=>s.Hc.qo(a))),o.faceXaxis=o.faceXaxis.map((a=>s.Hc.qo(a))),o.faceYaxis=o.faceYaxis.map((a=>s.Hc.qo(a)));const q=new ta(a.name,c);return q.goldbergData=o,q}}var ia=o(13352);const pa={CreateBox:j.d,CreateTiledBox:N,CreateSphere:y.b,CreateDisc:C.b,CreateIcoSphere:I,CreateRibbon:T,CreateCylinder:J,CreateTorus:Z,CreateTorusKnot:U,CreateLineSystem:S.f,CC:S.i,CreateDashedLines:S.e,ExtrudeShape:R,ExtrudeShapeCustom:d,CreateLathe:W,CreateTiledPlane:g,eC:F.b,CreateGround:O.f,CreateTiledGround:O.h,CreateGroundFromHeightMap:O.d,CreatePolygon:r.b,ExtrudePolygon:r.f,CreateTube:B,CreatePolyhedron:K,CreateGeodesic:function(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=c.m||1;s!==Math.floor(s)&&(s=Math.floor(s),z.c.Warn("m not an integer only floor(m) used"));let q=c.n||0;if(q!==Math.floor(q)&&(q=Math.floor(q),z.c.Warn("n not an integer only floor(n) used")),q>s){const a=q;q=s,s=a,z.c.Warn("n > m therefore m and n swapped")}const t=new oa;return t.build(s,q),K(a,{custom:qa.BuildGeodesicData(t),size:c.size,sizeX:c.sizeX,sizeY:c.sizeY,sizeZ:c.sizeZ,faceUV:c.faceUV,faceColors:c.faceColors,flat:c.flat,updatable:c.updatable,sideOrientation:c.sideOrientation,frontUVs:c.frontUVs,backUVs:c.backUVs},o)},CreateGoldberg:function(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=c.size,G=c.sizeX||t||1,T=c.sizeY||t||1,C=c.sizeZ||t||1;let j=c.m||1;j!==Math.floor(j)&&(j=Math.floor(j),z.c.Warn("m not an integer only floor(m) used"));let e=c.n||0;if(e!==Math.floor(e)&&(e=Math.floor(e),z.c.Warn("n not an integer only floor(n) used")),e>j){const a=e;e=j,j=a,z.c.Warn("n > m therefore m and n swapped")}const g=new oa;g.build(j,e);const M=qa.BuildGeodesicData(g),N=M.toGoldbergPolyhedronData(),y=new ta(a,o);c.sideOrientation=q.c._GetDefaultSideOrientation(c.sideOrientation),y._originalBuilderSideOrientation=c.sideOrientation;(function(a,c){const o=a.size,q=a.sizeX||o||1,t=a.sizeY||o||1,G=a.sizeZ||o||1,T=0===a.sideOrientation?0:a.sideOrientation||i.e.DEFAULTSIDE,C=[],j=[],L=[],e=[];let g=1/0,M=-1/0,N=1/0,y=-1/0;for(let s=0;s<c.vertex.length;s++)g=Math.min(g,c.vertex[s][0]*q),M=Math.max(M,c.vertex[s][0]*q),N=Math.min(N,c.vertex[s][1]*t),y=Math.max(y,c.vertex[s][1]*t);let k=0;for(let i=0;i<c.face.length;i++){const a=c.face[i],o=s.Hc.qo(c.vertex[a[0]]),T=s.Hc.qo(c.vertex[a[2]]),n=s.Hc.qo(c.vertex[a[1]]),f=T.vc(o),J=n.vc(o),w=s.Hc.Cross(J,f).normalize();for(let s=0;s<a.length;s++){L.push(w.x,w.y,w.z);const o=c.vertex[a[s]];C.push(o[0]*q,o[1]*t,o[2]*G);const i=(o[1]*t-N)/(y-N);e.push((o[0]*q-g)/(M-g),p.d?1-i:i)}for(let c=0;c<a.length-2;c++)j.push(k,k+c+2,k+c+1);k+=a.length}i.e._ComputeSides(T,C,j,L,e);const n=new i.e;return n.Ua=C,n.indices=j,n.Sa=L,n.xa=e,n})(c,N).da(y,c.updatable),y.goldbergData.nbSharedFaces=M.sharedNodes,y.goldbergData.nbUnsharedFaces=M.poleNodes,y.goldbergData.adjacentFaces=M.adjacentFaces,y.goldbergData.nbFaces=y.goldbergData.nbSharedFaces+y.goldbergData.nbUnsharedFaces,y.goldbergData.nbFacesAtPole=(y.goldbergData.nbUnsharedFaces-12)/12;for(let q=0;q<M.vertex.length;q++)y.goldbergData.faceCenters.push(s.Hc.qo(M.vertex[q])),y.goldbergData.faceCenters[q].x*=G,y.goldbergData.faceCenters[q].y*=T,y.goldbergData.faceCenters[q].z*=C,y.goldbergData.faceColors.push(new L.Yc(1,1,1,1));for(let q=0;q<N.face.length;q++){const a=N.face[q],c=s.Hc.qo(N.vertex[a[0]]),o=s.Hc.qo(N.vertex[a[2]]),t=s.Hc.qo(N.vertex[a[1]]),i=o.vc(c),p=t.vc(c),G=s.Hc.Cross(p,i).normalize(),T=s.Hc.Cross(p,G).normalize();y.goldbergData.faceXaxis.push(p.normalize()),y.goldbergData.faceYaxis.push(G),y.goldbergData.faceZaxis.push(T)}return y},CreateDecal:v,CreateCapsule:Q,CreateText:ia.f}},13959:(a,c,o)=>{"use strict";o.d(c,{c:()=>pc});var s=o(12810),q=o(13173);class t extends q.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var i=o(12858),p=(o(12978),o(12776));class G{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(a){this._targetStopDuration!==a&&(this._targetStopDuration=a)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(a){this._noiseTexture!==a&&(this._noiseTexture=a,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(a){this._animationSheetEnabled!==a&&(this._animationSheetEnabled=a)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(a){this._isAnimationSheetEnabled!=a&&(this._isAnimationSheetEnabled=a,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(a){this._useLogarithmicDepth=a&&this.Za().getEngine().getCaps().fragmentDepthSupported}Za(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(a){switch(a){case G.BLENDMODE_MULTIPLYADD:return;case G.BLENDMODE_ADD:a=1;break;case G.BLENDMODE_ONEONE:a=6;break;case G.BLENDMODE_STANDARD:a=2;break;case G.BLENDMODE_MULTIPLY:a=4;break;case G.BLENDMODE_SUBTRACT:a=3}this._engine.setAlphaMode(a)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:s.Hc.Zero()}set direction1(a){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=a)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:s.Hc.Zero()}set direction2(a){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=a)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:s.Hc.Zero()}set minEmitBox(a){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=a)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:s.Hc.Zero()}set maxEmitBox(a){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=a)}get billboardMode(){return this._billboardMode}set billboardMode(a){this._billboardMode!==a&&(this._billboardMode=a,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(a){this._isBillboardBased!==a&&(this._isBillboardBased=a,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(a){this._attachImageProcessingConfiguration(a)}_attachImageProcessingConfiguration(a){a!==this._imageProcessingConfiguration&&(!a&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=a)}_reset(){}_removeGradientAndTexture(a,c,o){if(!c)return this;let s=0;for(const q of c){if(q.gradient===a){c.splice(s,1);break}s++}return o&&o.dispose(),this}constructor(a){this.animations=[],this.renderingGroupId=0,this.sc=s.Hc.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new s.Hc(10,10,10),this.onAnimationEnd=null,this.blendMode=G.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new s.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.pC=new s.Hc(0,0,0),this._useLogarithmicDepth=!1,this.gravity=s.Hc.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new i.Yc(1,1,1,1),this.color2=new i.Yc(1,1,1,1),this.colorDead=new i.Yc(0,0,0,1),this.textureMask=new i.Yc(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new t,this.id=a,this.name=a}createPointEmitter(a,c){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new s.Hc(0,1,0),arguments.length>2&&void 0!==arguments[2]||new s.Hc(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new s.Hc(0,1,0),arguments.length>4&&void 0!==arguments[4]||new s.Hc(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new s.Hc(0,1,0),arguments.length>3&&void 0!==arguments[3]||new s.Hc(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(a,c,o,s){throw new Error("Method not implemented.")}}G.BLENDMODE_ONEONE=0,G.BLENDMODE_STANDARD=1,G.BLENDMODE_ADD=2,G.BLENDMODE_MULTIPLY=3,G.BLENDMODE_MULTIPLYADD=4,G.BLENDMODE_SUBTRACT=-1,(0,p.d)("BABYLON.BaseParticleSystem",G);var T=o(12824),C=o(12657);class j{constructor(){this.direction1=new s.Hc(0,1,0),this.direction2=new s.Hc(0,1,0),this.minEmitBox=new s.Hc(-.5,-.5,-.5),this.maxEmitBox=new s.Hc(.5,.5,.5)}startDirectionFunction(a,c,o,q){const t=(0,T.RandomRange)(this.direction1.x,this.direction2.x),i=(0,T.RandomRange)(this.direction1.y,this.direction2.y),p=(0,T.RandomRange)(this.direction1.z,this.direction2.z);if(q)return c.x=t,c.y=i,void(c.z=p);s.Hc.TransformNormalFromFloatsToRef(t,i,p,a,c)}startPositionFunction(a,c,o,q){const t=(0,T.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),i=(0,T.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),p=(0,T.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(q)return c.x=t,c.y=i,void(c.z=p);s.Hc.TransformCoordinatesFromFloatsToRef(t,i,p,a,c)}clone(){const a=new j;return C.b.DeepCopy(this,a),a}applyToShader(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2),a.setVector3("minEmitBox",this.minEmitBox),a.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(a){a.addUniform("direction1",3),a.addUniform("direction2",3),a.addUniform("minEmitBox",3),a.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.direction1=this.direction1.hc(),a.direction2=this.direction2.hc(),a.minEmitBox=this.minEmitBox.hc(),a.maxEmitBox=this.maxEmitBox.hc(),a}parse(a){s.Hc.FromArrayToRef(a.direction1,0,this.direction1),s.Hc.FromArrayToRef(a.direction2,0,this.direction2),s.Hc.FromArrayToRef(a.minEmitBox,0,this.minEmitBox),s.Hc.FromArrayToRef(a.maxEmitBox,0,this.maxEmitBox)}}class L{get radius(){return this._radius}set radius(a){this._radius=a,this._buildHeight()}get angle(){return this._angle}set angle(a){this._angle=a,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=o,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=c,this.radius=a}startDirectionFunction(a,c,o,q){q?s.TmpVectors.Hc[0].G(o.IG).normalize():o.position.subtractToRef(a.getTranslation(),s.TmpVectors.Hc[0]).normalize();const t=(0,T.RandomRange)(0,this.directionRandomizer),i=(0,T.RandomRange)(0,this.directionRandomizer),p=(0,T.RandomRange)(0,this.directionRandomizer);c.x=s.TmpVectors.Hc[0].x+t,c.y=s.TmpVectors.Hc[0].y+i,c.z=s.TmpVectors.Hc[0].z+p,c.normalize()}startPositionFunction(a,c,o,q){const t=(0,T.RandomRange)(0,2*Math.PI);let i;this.emitFromSpawnPointOnly?i=1e-4:(i=(0,T.RandomRange)(0,this.heightRange),i=1-i*i);let p=this._radius-(0,T.RandomRange)(0,this._radius*this.radiusRange);p*=i;const G=p*Math.sin(t),C=p*Math.cos(t),j=i*this._height;if(q)return c.x=G,c.y=j,void(c.z=C);s.Hc.TransformCoordinatesFromFloatsToRef(G,j,C,a,c)}clone(){const a=new L(this._radius,this._angle,this.directionRandomizer);return C.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat2("radius",this._radius,this.radiusRange),a.setFloat("coneAngle",this._angle),a.setFloat2("height",this._height,this.heightRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",2),a.addUniform("coneAngle",1),a.addUniform("height",2),a.addUniform("directionRandomizer",1)}getEffectDefines(){let a="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(a+="\n#define CONEEMITTERSPAWNPOINT"),a}getClassName(){return"ConeParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this._radius,a.angle=this._angle,a.directionRandomizer=this.directionRandomizer,a.radiusRange=this.radiusRange,a.heightRange=this.heightRange,a.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,a}parse(a){this.radius=a.radius,this.angle=a.angle,this.directionRandomizer=a.directionRandomizer,this.radiusRange=void 0!==a.radiusRange?a.radiusRange:1,this.heightRange=void 0!==a.radiusRange?a.heightRange:1,this.emitFromSpawnPointOnly=void 0!==a.emitFromSpawnPointOnly&&a.emitFromSpawnPointOnly}}class e extends L{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Hc(0,1,0),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Hc(0,1,0);super(a,c),this.direction1=o,this.direction2=q}startDirectionFunction(a,c){const o=(0,T.RandomRange)(this.direction1.x,this.direction2.x),q=(0,T.RandomRange)(this.direction1.y,this.direction2.y),t=(0,T.RandomRange)(this.direction1.z,this.direction2.z);s.Hc.TransformNormalFromFloatsToRef(o,q,t,a,c)}clone(){const a=new e(this.radius,this.angle,this.direction1,this.direction2);return C.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const a=super.serialize();return a.direction1=this.direction1.hc(),a.direction2=this.direction2.hc(),a}parse(a){super.parse(a),this.direction1.G(a.direction1),this.direction2.G(a.direction2)}}class g{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=a,this.height=c,this.radiusRange=o,this.directionRandomizer=q,this._tempVector=s.Hc.Zero()}startDirectionFunction(a,c,o,q,t){o.position.subtractToRef(a.getTranslation(),this._tempVector),this._tempVector.normalize(),s.Hc.TransformNormalToRef(this._tempVector,t,this._tempVector);const i=(0,T.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let p=Math.atan2(this._tempVector.x,this._tempVector.z);p+=(0,T.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=i,this._tempVector.x=Math.sin(p),this._tempVector.z=Math.cos(p),this._tempVector.normalize(),q?c.G(this._tempVector):s.Hc.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,a,c)}startPositionFunction(a,c,o,q){const t=(0,T.RandomRange)(-this.height/2,this.height/2),i=(0,T.RandomRange)(0,2*Math.PI),p=(0,T.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),G=Math.sqrt(p)*this.radius,C=G*Math.cos(i),j=G*Math.sin(i);q?c.Bc(C,t,j):s.Hc.TransformCoordinatesFromFloatsToRef(C,t,j,a,c)}clone(){const a=new g(this.radius,this.directionRandomizer);return C.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("height",this.height),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("height",1),a.addUniform("radiusRange",1),a.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this.radius,a.height=this.height,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a}parse(a){this.radius=a.radius,this.height=a.height,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer}}class M extends g{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Hc(0,1,0),t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new s.Hc(0,1,0);super(a,c,o),this.direction1=q,this.direction2=t}startDirectionFunction(a,c,o,q){const t=(0,T.RandomRange)(this.direction1.x,this.direction2.x),i=(0,T.RandomRange)(this.direction1.y,this.direction2.y),p=(0,T.RandomRange)(this.direction1.z,this.direction2.z);q?c.Bc(t,i,p):s.Hc.TransformNormalFromFloatsToRef(t,i,p,a,c)}clone(){const a=new M(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return C.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("height",this.height),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("height",1),a.addUniform("radiusRange",1),a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const a=super.serialize();return a.direction1=this.direction1.hc(),a.direction2=this.direction2.hc(),a}parse(a){super.parse(a),s.Hc.FromArrayToRef(a.direction1,0,this.direction1),s.Hc.FromArrayToRef(a.direction2,0,this.direction2)}}class N{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=a,this.radiusRange=c,this.directionRandomizer=o}startDirectionFunction(a,c,o,q){const t=o.position.vc(a.getTranslation()).normalize(),i=(0,T.RandomRange)(0,this.directionRandomizer),p=(0,T.RandomRange)(0,this.directionRandomizer),G=(0,T.RandomRange)(0,this.directionRandomizer);t.x+=i,t.y+=p,t.z+=G,t.normalize(),q?c.G(t):s.Hc.TransformNormalFromFloatsToRef(t.x,t.y,t.z,a,c)}startPositionFunction(a,c,o,q){const t=this.radius-(0,T.RandomRange)(0,this.radius*this.radiusRange),i=(0,T.RandomRange)(0,1),p=(0,T.RandomRange)(0,2*Math.PI),G=Math.acos(2*i-1),C=t*Math.cos(p)*Math.sin(G),j=t*Math.cos(G),L=t*Math.sin(p)*Math.sin(G);q?c.Bc(C,Math.abs(j),L):s.Hc.TransformCoordinatesFromFloatsToRef(C,Math.abs(j),L,a,c)}clone(){const a=new N(this.radius,this.directionRandomizer);return C.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this.radius,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a}parse(a){this.radius=a.radius,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer}}class y{constructor(){this.direction1=new s.Hc(0,1,0),this.direction2=new s.Hc(0,1,0)}startDirectionFunction(a,c,o,q){const t=(0,T.RandomRange)(this.direction1.x,this.direction2.x),i=(0,T.RandomRange)(this.direction1.y,this.direction2.y),p=(0,T.RandomRange)(this.direction1.z,this.direction2.z);q?c.Bc(t,i,p):s.Hc.TransformNormalFromFloatsToRef(t,i,p,a,c)}startPositionFunction(a,c,o,q){q?c.Bc(0,0,0):s.Hc.TransformCoordinatesFromFloatsToRef(0,0,0,a,c)}clone(){const a=new y;return C.b.DeepCopy(this,a),a}applyToShader(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.direction1=this.direction1.hc(),a.direction2=this.direction2.hc(),a}parse(a){s.Hc.FromArrayToRef(a.direction1,0,this.direction1),s.Hc.FromArrayToRef(a.direction2,0,this.direction2)}}class k{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=a,this.radiusRange=c,this.directionRandomizer=o}startDirectionFunction(a,c,o,q){const t=o.position.vc(a.getTranslation()).normalize(),i=(0,T.RandomRange)(0,this.directionRandomizer),p=(0,T.RandomRange)(0,this.directionRandomizer),G=(0,T.RandomRange)(0,this.directionRandomizer);t.x+=i,t.y+=p,t.z+=G,t.normalize(),q?c.G(t):s.Hc.TransformNormalFromFloatsToRef(t.x,t.y,t.z,a,c)}startPositionFunction(a,c,o,q){const t=this.radius-(0,T.RandomRange)(0,this.radius*this.radiusRange),i=(0,T.RandomRange)(0,1),p=(0,T.RandomRange)(0,2*Math.PI),G=Math.acos(2*i-1),C=t*Math.cos(p)*Math.sin(G),j=t*Math.cos(G),L=t*Math.sin(p)*Math.sin(G);q?c.Bc(C,j,L):s.Hc.TransformCoordinatesFromFloatsToRef(C,j,L,a,c)}clone(){const a=new k(this.radius,this.directionRandomizer);return C.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this.radius,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a}parse(a){this.radius=a.radius,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer}}class n extends k{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Hc(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Hc(0,1,0);super(a),this.direction1=c,this.direction2=o}startDirectionFunction(a,c){const o=(0,T.RandomRange)(this.direction1.x,this.direction2.x),q=(0,T.RandomRange)(this.direction1.y,this.direction2.y),t=(0,T.RandomRange)(this.direction1.z,this.direction2.z);s.Hc.TransformNormalFromFloatsToRef(o,q,t,a,c)}clone(){const a=new n(this.radius,this.direction1,this.direction2);return C.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const a=super.serialize();return a.direction1=this.direction1.hc(),a.direction2=this.direction2.hc(),a}parse(a){super.parse(a),this.direction1.G(a.direction1),this.direction2.G(a.direction2)}}class f{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(a,c,o,q){const t=s.TmpVectors.Hc[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,o,t);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,o,t);const a=s.TmpVectors.Hc[1];t.subtractToRef(o.position,a),a.scaleToRef(1/o.lifeTime,t)}else t.set(0,0,0);q?c.G(t):s.Hc.TransformNormalToRef(t,a,c)}startPositionFunction(a,c,o,q){const t=s.TmpVectors.Hc[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,o,t):t.set(0,0,0),q?c.G(t):s.Hc.TransformCoordinatesToRef(t,a,c)}clone(){const a=new f;return C.b.DeepCopy(this,a),a}applyToShader(a){}buildUniformLayout(a){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.particlePositionGenerator=this.particlePositionGenerator,a.particleDestinationGenerator=this.particleDestinationGenerator,a}parse(a){a.particlePositionGenerator&&(this.particlePositionGenerator=a.particlePositionGenerator),a.particleDestinationGenerator&&(this.particleDestinationGenerator=a.particleDestinationGenerator)}}var J=o(12882);class w{get mesh(){return this._mesh}set mesh(a){this._mesh!==a&&(this._mesh=a,a?(this._indices=a.Wc(),this._positions=a.getVerticesData(J.g.PositionKind),this._normals=a.getVerticesData(J.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=s.Hc.Zero(),this._mesh=null,this.direction1=new s.Hc(0,1,0),this.direction2=new s.Hc(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=a}startDirectionFunction(a,c,o,q){if(this.useMeshNormalsForDirection&&this._normals)return void s.Hc.TransformNormalToRef(this._storedNormal,a,c);const t=(0,T.RandomRange)(this.direction1.x,this.direction2.x),i=(0,T.RandomRange)(this.direction1.y,this.direction2.y),p=(0,T.RandomRange)(this.direction1.z,this.direction2.z);q?c.Bc(t,i,p):s.Hc.TransformNormalFromFloatsToRef(t,i,p,a,c)}startPositionFunction(a,c,o,q){if(!this._indices||!this._positions)return;const t=3*(Math.random()*(this._indices.length/3)|0),i=Math.random(),p=Math.random()*(1-i),G=1-i-p,T=this._indices[t],C=this._indices[t+1],j=this._indices[t+2],L=s.TmpVectors.Hc[0],e=s.TmpVectors.Hc[1],g=s.TmpVectors.Hc[2],M=s.TmpVectors.Hc[3];s.Hc.FromArrayToRef(this._positions,3*T,L),s.Hc.FromArrayToRef(this._positions,3*C,e),s.Hc.FromArrayToRef(this._positions,3*j,g),M.x=i*L.x+p*e.x+G*g.x,M.y=i*L.y+p*e.y+G*g.y,M.z=i*L.z+p*e.z+G*g.z,q?c.Bc(M.x,M.y,M.z):s.Hc.TransformCoordinatesFromFloatsToRef(M.x,M.y,M.z,a,c),this.useMeshNormalsForDirection&&this._normals&&(s.Hc.FromArrayToRef(this._normals,3*T,L),s.Hc.FromArrayToRef(this._normals,3*C,e),s.Hc.FromArrayToRef(this._normals,3*j,g),this._storedNormal.x=i*L.x+p*e.x+G*g.x,this._storedNormal.y=i*L.y+p*e.y+G*g.y,this._storedNormal.z=i*L.z+p*e.z+G*g.z)}clone(){const a=new w(this.mesh);return C.b.DeepCopy(this,a),a}applyToShader(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var a;const c={};return c.type=this.getClassName(),c.direction1=this.direction1.hc(),c.direction2=this.direction2.hc(),c.meshId=null===(a=this.mesh)||void 0===a?void 0:a.id,c.useMeshNormalsForDirection=this.useMeshNormalsForDirection,c}parse(a,c){s.Hc.FromArrayToRef(a.direction1,0,this.direction1),s.Hc.FromArrayToRef(a.direction2,0,this.direction2),a.meshId&&c&&(this.mesh=c.getLastMeshById(a.meshId)),this.useMeshNormalsForDirection=a.useMeshNormalsForDirection}}class Z{_isUbo(a){return void 0!==a.addUniform}constructor(a){this._isUbo(a)?(this.setMatrix3x3=a.updateMatrix3x3.bind(a),this.setMatrix2x2=a.updateMatrix2x2.bind(a),this.setFloat=a.updateFloat.bind(a),this.setFloat2=a.updateFloat2.bind(a),this.setFloat3=a.updateFloat3.bind(a),this.setFloat4=a.updateFloat4.bind(a),this.setFloatArray=a.updateFloatArray.bind(a),this.setArray=a.updateArray.bind(a),this.setIntArray=a.updateIntArray.bind(a),this.setMatrix=a.xc.bind(a),this.setMatrices=a.updateMatrices.bind(a),this.setVector3=a.updateVector3.bind(a),this.setVector4=a.updateVector4.bind(a),this.setColor3=a.updateColor3.bind(a),this.setColor4=a.updateColor4.bind(a),this.setDirectColor4=a.updateDirectColor4.bind(a),this.setInt=a.updateInt.bind(a),this.setInt2=a.updateInt2.bind(a),this.setInt3=a.updateInt3.bind(a),this.setInt4=a.updateInt4.bind(a)):(this.setMatrix3x3=a.setMatrix3x3.bind(a),this.setMatrix2x2=a.setMatrix2x2.bind(a),this.setFloat=a.setFloat.bind(a),this.setFloat2=a.setFloat2.bind(a),this.setFloat3=a.setFloat3.bind(a),this.setFloat4=a.setFloat4.bind(a),this.setFloatArray=a.setFloatArray.bind(a),this.setArray=a.setArray.bind(a),this.setIntArray=a.setIntArray.bind(a),this.setMatrix=a.setMatrix.bind(a),this.setMatrices=a.setMatrices.bind(a),this.setVector3=a.setVector3.bind(a),this.setVector4=a.setVector4.bind(a),this.setColor3=a.setColor3.bind(a),this.setColor4=a.setColor4.bind(a),this.setDirectColor4=a.setDirectColor4.bind(a),this.setInt=a.setInt.bind(a),this.setInt2=a.setInt2.bind(a),this.setInt3=a.setInt3.bind(a),this.setInt4=a.setInt4.bind(a))}}var h=o(12732);const U="gpuUpdateParticlesPixelShader",S="#version 300 es\nvoid main() {discard;}\n";h.c.ShadersStore[U]||(h.c.ShadersStore[U]=S);const r="gpuUpdateParticlesVertexShader",x="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";h.c.ShadersStore[r]||(h.c.ShadersStore[r]=x);(0,p.d)("BABYLON.WebGL2ParticleSystem",class{constructor(a,c){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=a,this._engine=c,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var a;return(null===(a=this._updateEffect)||void 0===a?void 0:a.isReady())??!1}createUpdateBuffer(a){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof f&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=a,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new Z(this._updateEffect)}createVertexBuffers(a,c){this._updateVAO.push(this._createUpdateVAO(a)),this._renderVAO.push(this._engine.recordVertexArrayObject(c,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=c}createParticleBuffer(a){return a}bindDrawBuffers(a,c,o){o?this._engine.bindBuffers(this._renderVertexBuffers,o,c):this._engine.bindVertexArrayObject(this._renderVAO[a],null)}preUpdateParticleBuffer(){const a=this._engine;if(this._engine.enableEffect(this._updateEffect),!a.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(a,c,o){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[a],null);const s=this._engine;s.bindTransformFeedbackBuffer(c.getBuffer()),s.setRasterizerState(!1),s.beginTransformFeedback(!0),s.drawArraysType(3,0,o),s.endTransformFeedback(),s.setRasterizerState(!0),s.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let a=0;a<this._updateVAO.length;a++)this._engine.releaseVertexArrayObject(this._updateVAO[a]);this._updateVAO.length=0;for(let a=0;a<this._renderVAO.length;a++)this._engine.releaseVertexArrayObject(this._renderVAO[a]);this._renderVAO.length=0}_createUpdateVAO(a){const c={};c.position=a.createVertexBuffer("position",0,3);let o=3;c.age=a.createVertexBuffer("age",o,1),o+=1,c.size=a.createVertexBuffer("size",o,3),o+=3,c.life=a.createVertexBuffer("life",o,1),o+=1,c.seed=a.createVertexBuffer("seed",o,4),o+=4,c.direction=a.createVertexBuffer("direction",o,3),o+=3,this._parent.particleEmitterType instanceof f&&(c.initialPosition=a.createVertexBuffer("initialPosition",o,3),o+=3),this._parent._colorGradientsTexture||(c.color=a.createVertexBuffer("color",o,4),o+=4),this._parent._isBillboardBased||(c.initialDirection=a.createVertexBuffer("initialDirection",o,3),o+=3),this._parent.noiseTexture&&(c.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",o,3),o+=3,c.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",o,3),o+=3),this._parent._angularSpeedGradientsTexture?(c.angle=a.createVertexBuffer("angle",o,1),o+=1):(c.angle=a.createVertexBuffer("angle",o,2),o+=2),this._parent._isAnimationSheetEnabled&&(c.cellIndex=a.createVertexBuffer("cellIndex",o,1),o+=1,this._parent.spriteRandomStartCell&&(c.cellStartOffset=a.createVertexBuffer("cellStartOffset",o,1),o+=1));const s=this._engine.recordVertexArrayObject(c,null,this._updateEffect);return this._engine.bindArrayBuffer(null),s}});class R{constructor(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,s=arguments.length>3?arguments[3]:void 0;this._engine=a,this._label=s,this._engine._storageBuffers.push(this),this._create(c,o)}_create(a,c){this._bufferSize=a,this._creationFlags=c,this._buffer=this._engine.createStorageBuffer(a,c,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(a,c,o){this._buffer&&this._engine.updateStorageBuffer(this._buffer,a,c,o)}async read(a,c,o,s){return await this._engine.readFromStorageBuffer(this._buffer,a,c,o,s)}dispose(){const a=this._engine._storageBuffers,c=a.indexOf(this);-1!==c&&(a[c]=a[a.length-1],a.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var d=o(12798),X=o(12800),W=o(12845),F=o(12796),O=o(13104),B=o(12649),u=o(12763),K=o(13023);class D{constructor(){this._gpuTimeInFrameId=-1,this.counter=new K.c}_addDuration(a,c){a<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==a?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(c,!1),this._gpuTimeInFrameId=a):this.counter.addCount(c,!1))}}var I=o(12712);class Y{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=a,this._engine=c,this.uniqueId=O.e.UniqueId,c.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new D),this._engine.getCaps().supportComputeShaders?s.bindingsMapping?(this._context=c.createComputeContext(),this._shaderPath=o,this._options={bindingsMapping:{},defines:[],...s}):B.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):B.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(a,c){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=this._bindings[a];this._bindings[a]={type:o?0:4,object:c,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!s||s.object!==c||s.type!==this._bindings[a].type)}setStorageTexture(a,c){const o=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==c),this._bindings[a]={type:1,object:c,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setExternalTexture(a,c){const o=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==c),this._bindings[a]={type:6,object:c,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setVideoTexture(a,c){return!!c.externalTexture&&(this.setExternalTexture(a,c.externalTexture),!0)}setUniformBuffer(a,c){const o=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==c),this._bindings[a]={type:Y._BufferIsDataBuffer(c)?7:2,object:c,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setStorageBuffer(a,c){const o=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==c),this._bindings[a]={type:Y._BufferIsDataBuffer(c)?7:3,object:c,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setTextureSampler(a,c){const o=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!o||!c.compareSampler(o.object)),this._bindings[a]={type:5,object:c,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}isReady(){let a=this._effect;for(const q in this._bindings){const a=this._bindings[q],c=a.type,o=a.object;switch(c){case 0:case 4:case 1:if(!o.isReady())return!1;break;case 6:if(!o.isReady())return!1;break}}const c=[],o=this._shaderPath;if(this._options.defines)for(let q=0;q<this._options.defines.length;q++)c.push(this._options.defines[q]);const s=c.join("\n");return this._cachedDefines!==s&&(this._cachedDefines=s,a=this._engine.createComputeEffect(o,{defines:s,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=a),!!a.isReady()}dispatch(a,c,o){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,a,c,o,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const o=Y._BufferIsDataBuffer(a)?a:a.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,o,c,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const c in this._bindings){const o=this._bindings[c];if(!this._options.bindingsMapping[c])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+c+"'");switch(o.type){case 0:{const s=this._samplers[c],q=o.object;var a;if(!s||!q._texture||!s.compareSampler(q._texture))this._samplers[c]=(new u.b).setParameters(q.wrapU,q.wrapV,q.wrapR,q.anisotropicFilteringLevel,q._texture.samplingMode,null===(a=q._texture)||void 0===a?void 0:a._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const a=o.object;a.getBuffer()!==o.buffer&&(o.buffer=a.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((q=>{(0,I.h)((()=>this.dispatch(a,c,o)),q,void 0,s)}))}serialize(){const a=W.d.Serialize(this);a.options=this._options,a.shaderPath=this._shaderPath,a.bL={},a.textures={};for(const c in this._bindings){const o=this._bindings[c],s=o.object;switch(o.type){case 0:case 4:case 1:{const q=s.serialize();q&&(a.textures[c]=q,a.bL[c]={type:o.type});break}}}return a}static Parse(a,c,o){const s=W.d.Parse((()=>new Y(a.name,c.getEngine(),a.shaderPath,a.options)),a,c,o);for(const q in a.textures){const t=a.bL[q],i=F.e.Parse(a.textures[q],c,o);0===t.type?s.setTexture(q,i):4===t.type?s.setTexture(q,i,!1):s.setStorageTexture(q,i)}return s}static _BufferIsDataBuffer(a){return void 0!==a.underlyingResource}}(0,d.d)([(0,X.E)()],Y.prototype,"name",void 0),(0,d.d)([(0,X.E)()],Y.prototype,"fastMode",void 0),(0,p.d)("BABYLON.ComputeShader",Y);var P=o(13071);const ma="gpuUpdateParticlesComputeShader",V="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";h.c.ShadersStoreWGSL[ma]||(h.c.ShadersStoreWGSL[ma]=V);(0,p.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(a,c){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=a,this._engine=c}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var a;return(null===(a=this._updateComputeShader)||void 0===a?void 0:a.isReady())??!1}createUpdateBuffer(a){var c;const o={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(o.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(o.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(o.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(o.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(o.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(o.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(o.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new Y("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:o,defines:a.split("\n")}),null===(c=this._simParamsComputeShader)||void 0===c||c.dispose(),this._simParamsComputeShader=new P.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new Z(this._simParamsComputeShader)}createVertexBuffers(a,c){this._renderVertexBuffers.push(c)}createParticleBuffer(a){const c=new R(this._engine,4*a.length,11,"ComputeShaderParticleSystemBuffer");return c.update(a),this._bufferComputeShader.push(c),c.getBuffer()}bindDrawBuffers(a,c,o){this._engine.bindBuffers(this._renderVertexBuffers[a],o,c)}preUpdateParticleBuffer(){}updateParticleBuffer(a,c,o){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[a]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^a]),this._updateComputeShader.dispatch(Math.ceil(o/64))}releaseBuffers(){var a;for(let c=0;c<this._bufferComputeShader.length;++c)this._bufferComputeShader[c].dispose();this._bufferComputeShader.length=0,null===(a=this._simParamsComputeShader)||void 0===a||a.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class E{constructor(a,c,o){this.gradient=a,this.color1=c,this.color2=o}getColorToRef(a){this.color2?i.Yc.LerpToRef(this.color1,this.color2,Math.random(),a):a.G(this.color1)}}class H{constructor(a,c){this.gradient=a,this.color=c}}class b{constructor(a,c,o){this.gradient=a,this.factor1=c,this.factor2=o}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class A{static GetCurrentGradient(a,c,o){if(c[0].gradient>a)return void o(c[0],c[0],1);for(let q=0;q<c.length-1;q++){const s=c[q],t=c[q+1];if(a>=s.gradient&&a<=t.gradient){return void o(s,t,(a-s.gradient)/(t.gradient-s.gradient))}}const s=c.length-1;o(c[s],c[s],1)}}var v=o(12639),l=o(13263),Q=o(12680);class z{constructor(a){this.particleSystem=a,this.position=s.Hc.Zero(),this.direction=s.Hc.Zero(),this.color=new i.Yc(0,0,0,0),this.colorStep=new i.Yc(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new s.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new i.Yc(0,0,0,0),this._currentColor2=new i.Yc(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=z._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let a=this.age,c=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===c?(c=1,a=this._randomCellOffset):a+=this._randomCellOffset);const o=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let s;s=this._initialSpriteCellLoop?(0,T.Clamp)(a*c%this.lifeTime/this.lifeTime):(0,T.Clamp)(a*c/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+s*o|0}_inheritParticleInfoToSubEmitter(a){if(a.particleSystem.sc.position){const c=a.particleSystem.sc;if(c.position.G(this.position),a.inheritDirection){const a=s.TmpVectors.Hc[0];this.direction.normalizeToRef(a),c.setDirection(a,0,Math.PI/2)}}else{a.particleSystem.sc.G(this.position)}this.direction.scaleToRef(a.inheritedVelocityAmount/2,s.TmpVectors.Hc[0]),a.particleSystem._inheritedVelocityOffset.G(s.TmpVectors.Hc[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const a of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(a)}_reset(){this.age=0,this.id=z._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(a){a.position.G(this.position),this._initialDirection?a._initialDirection?a._initialDirection.G(this._initialDirection):a._initialDirection=this._initialDirection.clone():a._initialDirection=null,a.direction.G(this.direction),this.IG&&(a.IG?a.IG.G(this.IG):a.IG=this.IG.clone()),a.color.G(this.color),a.colorStep.G(this.colorStep),a.lifeTime=this.lifeTime,a.age=this.age,a._randomCellOffset=this._randomCellOffset,a.size=this.size,a.scale.G(this.scale),a.angle=this.angle,a.angularSpeed=this.angularSpeed,a.particleSystem=this.particleSystem,a.cellIndex=this.cellIndex,a.id=this.id,a._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(a._currentColorGradient=this._currentColorGradient,a._currentColor1.G(this._currentColor1),a._currentColor2.G(this._currentColor2)),this._currentSizeGradient&&(a._currentSizeGradient=this._currentSizeGradient,a._currentSize1=this._currentSize1,a._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(a._currentAngularSpeedGradient=this._currentAngularSpeedGradient,a._currentAngularSpeed1=this._currentAngularSpeed1,a._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(a._currentVelocityGradient=this._currentVelocityGradient,a._currentVelocity1=this._currentVelocity1,a._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(a._currentLimitVelocityGradient=this._currentLimitVelocityGradient,a._currentLimitVelocity1=this._currentLimitVelocity1,a._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(a._currentDragGradient=this._currentDragGradient,a._currentDrag1=this._currentDrag1,a._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(a._initialStartSpriteCellId=this._initialStartSpriteCellId,a._initialEndSpriteCellId=this._initialEndSpriteCellId,a._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(a.remapData&&this.remapData?a.remapData.G(this.remapData):a.remapData=new s.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(a._randomNoiseCoordinates1?(a._randomNoiseCoordinates1.G(this._randomNoiseCoordinates1),a._randomNoiseCoordinates2.G(this._randomNoiseCoordinates2)):(a._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),a._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}z._Count=0;var aa=o(12925),ca=(o(12970),o(13164)),oa=o(13155),sa=o(13063);function qa(a,c){const o=(0,T.RandomRange)(0,1);i.Yc.LerpToRef(c.color1,c.color2,o,a.color),c.colorDead.subtractToRef(a.color,c._colorDiff),c._colorDiff.scaleToRef(1/a.lifeTime,a.colorStep)}function ta(a,c){a._currentColorGradient=c._colorGradients[0],a._currentColorGradient.getColorToRef(a.color),a._currentColor1.G(a.color),c._colorGradients.length>1?c._colorGradients[1].getColorToRef(a._currentColor2):a._currentColor2.G(a.color)}function ia(a,c){const o=c._colorGradients;A.GetCurrentGradient(c._ratio,o,((c,o,s)=>{c!==a._currentColorGradient&&(a._currentColor1.G(a._currentColor2),o.getColorToRef(a._currentColor2),a._currentColorGradient=c),i.Yc.LerpToRef(a._currentColor1,a._currentColor2,s,a.color)}))}function pa(a,c){a.colorStep.scaleToRef(c._scaledUpdateSpeed,c._scaledColorStep),a.color.addInPlace(c._scaledColorStep),a.color.a<0&&(a.color.a=0)}function Ga(a,c){A.GetCurrentGradient(c._ratio,c._angularSpeedGradients,((c,o,s)=>{c!==a._currentAngularSpeedGradient&&(a._currentAngularSpeed1=a._currentAngularSpeed2,a._currentAngularSpeed2=o.getFactor(),a._currentAngularSpeedGradient=c),a.angularSpeed=(0,T.Lerp)(a._currentAngularSpeed1,a._currentAngularSpeed2,s)}))}function Ta(a,c){a.angle+=a.angularSpeed*c._scaledUpdateSpeed}function Ca(a,c){c.particleEmitterType.startDirectionFunction(c._emitterWorldMatrix,a.direction,a,c.isLocal,c._emitterInverseWorldMatrix)}function ja(a,c){c.startDirectionFunction(c._emitterWorldMatrix,a.direction,a,c.isLocal)}function La(a,c){a._currentVelocityGradient=c._velocityGradients[0],a._currentVelocity1=a._currentVelocityGradient.getFactor(),c._velocityGradients.length>1?a._currentVelocity2=c._velocityGradients[1].getFactor():a._currentVelocity2=a._currentVelocity1}function ea(a,c){a._currentLimitVelocityGradient=c._limitVelocityGradients[0],a._currentLimitVelocity1=a._currentLimitVelocityGradient.getFactor(),c._limitVelocityGradients.length>1?a._currentLimitVelocity2=c._limitVelocityGradients[1].getFactor():a._currentLimitVelocity2=a._currentLimitVelocity1}function ga(a,c){A.GetCurrentGradient(c._ratio,c._velocityGradients,((o,s,q)=>{o!==a._currentVelocityGradient&&(a._currentVelocity1=a._currentVelocity2,a._currentVelocity2=s.getFactor(),a._currentVelocityGradient=o),c._directionScale*=(0,T.Lerp)(a._currentVelocity1,a._currentVelocity2,q)}))}function Ma(a,c){A.GetCurrentGradient(c._ratio,c._limitVelocityGradients,((o,s,q)=>{o!==a._currentLimitVelocityGradient&&(a._currentLimitVelocity1=a._currentLimitVelocity2,a._currentLimitVelocity2=s.getFactor(),a._currentLimitVelocityGradient=o);const t=(0,T.Lerp)(a._currentLimitVelocity1,a._currentLimitVelocity2,q);a.direction.length()>t&&a.direction.scaleInPlace(c.limitVelocityDamping)}))}function Na(a,c){a.direction.scaleToRef(c._directionScale,c._scaledDirection)}function ya(a,c){c.particleEmitterType.startPositionFunction(c._emitterWorldMatrix,a.position,a,c.isLocal)}function ka(a,c){c.startPositionFunction(c._emitterWorldMatrix,a.position,a,c.isLocal)}function na(a,c){a.IG?a.IG.G(a.position):a.IG=a.position.clone(),s.Hc.TransformCoordinatesToRef(a.IG,c._emitterWorldMatrix,a.position)}function fa(a,c){c.isLocal&&a.IG?(a.IG.addInPlace(c._scaledDirection),s.Hc.TransformCoordinatesToRef(a.IG,c._emitterWorldMatrix,a.position)):a.position.addInPlace(c._scaledDirection)}function Ja(a,c){a._currentDragGradient=c._dragGradients[0],a._currentDrag1=a._currentDragGradient.getFactor(),c._dragGradients.length>1?a._currentDrag2=c._dragGradients[1].getFactor():a._currentDrag2=a._currentDrag1}function wa(a,c){A.GetCurrentGradient(c._ratio,c._dragGradients,((o,s,q)=>{o!==a._currentDragGradient&&(a._currentDrag1=a._currentDrag2,a._currentDrag2=s.getFactor(),a._currentDragGradient=o);const t=(0,T.Lerp)(a._currentDrag1,a._currentDrag2,q);c._scaledDirection.scaleInPlace(1-t)}))}function Za(a,c){a._randomNoiseCoordinates1?(a._randomNoiseCoordinates1.Bc(Math.random(),Math.random(),Math.random()),a._randomNoiseCoordinates2.Bc(Math.random(),Math.random(),Math.random())):(a._randomNoiseCoordinates1=new s.Hc(Math.random(),Math.random(),Math.random()),a._randomNoiseCoordinates2=new s.Hc(Math.random(),Math.random(),Math.random()))}function ha(a,c){const o=c._noiseTextureData,q=c._noiseTextureSize;if(o&&q&&a._randomNoiseCoordinates1){const t=c._fetchR(a._randomNoiseCoordinates1.x,a._randomNoiseCoordinates1.y,q.width,q.height,o),i=c._fetchR(a._randomNoiseCoordinates1.z,a._randomNoiseCoordinates2.x,q.width,q.height,o),p=c._fetchR(a._randomNoiseCoordinates2.y,a._randomNoiseCoordinates2.z,q.width,q.height,o),G=s.TmpVectors.Hc[0],T=s.TmpVectors.Hc[1];G.Bc((2*t-1)*c.noiseStrength.x,(2*i-1)*c.noiseStrength.y,(2*p-1)*c.noiseStrength.z),G.scaleToRef(c._tempScaledUpdateSpeed,T),a.direction.addInPlace(T)}}function Ua(a,c){c.gravity.scaleToRef(c._tempScaledUpdateSpeed,c._scaledGravity),a.direction.addInPlace(c._scaledGravity)}function Sa(a,c){a.size=(0,T.RandomRange)(c.minSize,c.maxSize),a.scale.Bc((0,T.RandomRange)(c.minScaleX,c.maxScaleX),(0,T.RandomRange)(c.minScaleY,c.maxScaleY))}function ra(a,c){a._currentSizeGradient=c._sizeGradients[0],a._currentSize1=a._currentSizeGradient.getFactor(),a.size=a._currentSize1,c._sizeGradients.length>1?a._currentSize2=c._sizeGradients[1].getFactor():a._currentSize2=a._currentSize1,a.scale.Bc((0,T.RandomRange)(c.minScaleX,c.maxScaleX),(0,T.RandomRange)(c.minScaleY,c.maxScaleY))}function xa(a,c){const o=c._actualFrame/c.targetStopDuration;A.GetCurrentGradient(o,c._startSizeGradients,((o,s,q)=>{o!==c._currentStartSizeGradient&&(c._currentStartSize1=c._currentStartSize2,c._currentStartSize2=s.getFactor(),c._currentStartSizeGradient=o);const t=(0,T.Lerp)(c._currentStartSize1,c._currentStartSize2,q);a.scale.scaleInPlace(t)}))}function Ra(a,c){A.GetCurrentGradient(c._ratio,c._sizeGradients,((c,o,s)=>{c!==a._currentSizeGradient&&(a._currentSize1=a._currentSize2,a._currentSize2=o.getFactor(),a._currentSizeGradient=c),a.size=(0,T.Lerp)(a._currentSize1,a._currentSize2,s)}))}function da(a,c){a.remapData=new s.Vector4(0,1,0,1)}function Xa(a,c){c._colorRemapGradients&&c._colorRemapGradients.length>0&&A.GetCurrentGradient(c._ratio,c._colorRemapGradients,((c,o,s)=>{const q=(0,T.Lerp)(c.factor1,o.factor1,s),t=(0,T.Lerp)(c.factor2,o.factor2,s);a.remapData.x=q,a.remapData.y=t-q})),c._alphaRemapGradients&&c._alphaRemapGradients.length>0&&A.GetCurrentGradient(c._ratio,c._alphaRemapGradients,((c,o,s)=>{const q=(0,T.Lerp)(c.factor1,o.factor1,s),t=(0,T.Lerp)(c.factor2,o.factor2,s);a.remapData.z=q,a.remapData.w=t-q}))}function Wa(a,c){const o=(0,T.Clamp)(c._actualFrame/c.targetStopDuration);A.GetCurrentGradient(o,c._lifeTimeGradients,((c,s)=>{const q=c,t=s,i=q.getFactor(),p=t.getFactor(),G=(o-q.gradient)/(t.gradient-q.gradient);a.lifeTime=(0,T.Lerp)(i,p,G)})),c._emitPower=(0,T.RandomRange)(c.minEmitPower,c.maxEmitPower)}function Fa(a,c){a.lifeTime=(0,T.RandomRange)(c.minLifeTime,c.maxLifeTime),c._emitPower=(0,T.RandomRange)(c.minEmitPower,c.maxEmitPower)}function Oa(a,c){0===c._emitPower?(a._initialDirection?a._initialDirection.G(a.direction):a._initialDirection=a.direction.clone(),a.direction.set(0,0,0)):(a._initialDirection=null,a.direction.scaleInPlace(c._emitPower)),a.direction.addInPlace(c._inheritedVelocityOffset)}function Ba(a,c){a.angularSpeed=(0,T.RandomRange)(c.minAngularSpeed,c.maxAngularSpeed),a.angle=(0,T.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function ua(a,c){a._currentAngularSpeedGradient=c._angularSpeedGradients[0],a.angularSpeed=a._currentAngularSpeedGradient.getFactor(),a._currentAngularSpeed1=a.angularSpeed,c._angularSpeedGradients.length>1?a._currentAngularSpeed2=c._angularSpeedGradients[1].getFactor():a._currentAngularSpeed2=a._currentAngularSpeed1,a.angle=(0,T.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function Ka(a,c){a._initialStartSpriteCellId=c.startSpriteCellID,a._initialEndSpriteCellId=c.endSpriteCellID,a._initialSpriteCellLoop=c.spriteCellLoop}function Da(a,c){a.previousItem=c.previousItem,a.nextItem=c,c.previousItem&&(c.previousItem.nextItem=a),c.previousItem=a}function Ia(a,c){a.previousItem=c,a.nextItem=c.nextItem,c.nextItem&&(c.nextItem.previousItem=a),c.nextItem=a}function Ya(a,c){let o=c;for(;o.nextItem;)o=o.nextItem;a.previousItem=o,a.nextItem=o.nextItem,o.nextItem=a}function Pa(a){a.previousItem&&(a.previousItem.nextItem=a.nextItem),a.nextItem&&(a.nextItem.previousItem=a.previousItem)}class mc extends G{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(a){this._startDirectionFunction!==a&&(this._startDirectionFunction=a,this._directionProcessing.process=a?ja:Ca)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(a){this._startPositionFunction!==a&&(this._startPositionFunction=a,this._positionCreation.process=a?ka:ya)}set onDispose(a){this._onDisposeObserver&&this.gc.remove(this._onDisposeObserver),this._onDisposeObserver=this.gc.add(a)}get L(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(a){this._useRampGradients!==a&&(this._useRampGradients=a,this._resetEffect(),a?(this._rampCreation={process:da,previousItem:null,nextItem:null},Ia(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Xa,previousItem:null,nextItem:null},Ia(this._remapGradientProcessing,this._gravityProcessing)):(Pa(this._rampCreation),Pa(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(a){this._isLocal!==a&&(this._isLocal=a,a?(this._isLocalCreation={process:na,previousItem:null,nextItem:null},Ia(this._isLocalCreation,this._positionCreation)):Pa(this._isLocalCreation))}get particles(){return this.PL}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(a){this._animationSheetEnabled!==a&&(this._animationSheetEnabled=a,a?(this._sheetCreation={process:Ka,previousItem:null,nextItem:null},Ia(this._sheetCreation,this._colorCreation)):Pa(this._sheetCreation),this._reset())}getActiveCount(){return this.PL.length}getClassName(){return"lc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var a;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(a=this._customWrappers[c])||void 0===a?void 0:a.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[a]??this._customWrappers[0]}setCustomEffect(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new aa.e(this._engine),this._customWrappers[c].effect=a,this._customWrappers[c].drawContext&&(this._customWrappers[c].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new v.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(a){if(this.noiseTexture!==a){if(this._noiseTexture=a,!a)return Pa(this._noiseCreation),void Pa(this._noiseProcessing);this._noiseCreation={process:Za,previousItem:null,nextItem:null},Ia(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:ha,previousItem:null,nextItem:null},Ia(this._noiseProcessing,this._positionProcessing)}}constructor(a,c,o){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(a),this._emitterInverseWorldMatrix=s.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new s.Hc,this.gc=new v.d,this.onStoppedObservable=new v.d,this.onStartedObservable=new v.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.PL=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new i.Yc(0,0,0,0),this._colorDiff=new i.Yc(0,0,0,0),this._scaledDirection=s.Hc.Zero(),this._scaledGravity=s.Hc.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=a=>{},this.recycleParticle=a=>{const c=this.PL.pop();c!==a&&c.copyTo(a),this._stockParticles.push(c)},this._createParticle=()=>{let a;return 0!==this._stockParticles.length?(a=this._stockParticles.pop(),a._reset()):a=new z(this),this._prepareParticle(a),a},this.paused=!1,this._shadersLoaded=!1,this._capacity=c,this._epsilon=p,o&&"Scene"!==o.getClassName()?(this._engine=o,this.defaultProjectionMatrix=s.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=o||Q.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.IL.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Fa,previousItem:null,nextItem:null},this._positionCreation={process:ya,previousItem:null,nextItem:null},Ia(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Ca,previousItem:null,nextItem:null},Ia(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Oa,previousItem:null,nextItem:null},Ia(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Sa,previousItem:null,nextItem:null},Ia(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Ba,previousItem:null,nextItem:null},Ia(this._angleCreation,this._sizeCreation),this._colorCreation={process:qa,previousItem:null,nextItem:null},Ia(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,G||(this._colorProcessing={process:pa,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Ta,previousItem:null,nextItem:null},Ia(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Na,previousItem:null,nextItem:null},Ia(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:fa,previousItem:null,nextItem:null},Ia(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Ua,previousItem:null,nextItem:null},Ia(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=t,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new aa.e(this._engine)},this._customWrappers[0].effect=q,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new j,this.updateFunction=a=>{var c;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(c=this.noiseTexture.getContent())||void 0===c||c.then((a=>{this._noiseTextureData=a})));const o=a===this.PL;for(let s=0;s<a.length;s++){const c=a[s];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const q=c.age;if(c.age+=this._tempScaledUpdateSpeed,c.age>c.lifeTime){const a=c.age-q,o=c.lifeTime-q;this._tempScaledUpdateSpeed=o*this._tempScaledUpdateSpeed/a,c.age=c.lifeTime}this._ratio=c.age/c.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let t=this._updateQueueStart;for(;t;)t.process(c,this),t=t.nextItem;if(this._isAnimationSheetEnabled&&!G&&c.updateCellIndex(),c._inheritParticleInfoToSubEmitters(),c.age>=c.lifeTime){if(this._emitFromParticle(c),c._attachedSubEmitters){for(const a of c._attachedSubEmitters)a.particleSystem.disposeOnStop=!0,a.particleSystem.stop();c._attachedSubEmitters=null}this.recycleParticle(c),o&&s--}else;}}}serialize(a){throw new Error("Method not implemented.")}clone(a,c){throw new Error("Method not implemented.")}_addFactorGradient(a,c,o,s){const q=new b(c,o,s);a.push(q),a.sort(((a,c)=>a.gradient<c.gradient?-1:a.gradient>c.gradient?1:0))}_removeFactorGradient(a,c){if(!a)return;let o=0;for(const s of a){if(s.gradient===c){a.splice(o,1);break}o++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Wa:this._lifeTimeCreation.process=Fa}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:xa,previousItem:null,nextItem:null},Ia(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Pa(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(a){this.targetStopDuration!==a&&(this._targetStopDuration=a,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(a,c,o){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,a,c,o),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(a){return this._removeFactorGradient(this._lifeTimeGradients,a),this._syncLifeTimeCreation(),this}addSizeGradient(a,c,o){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=ra,this._sizeGradientProcessing={process:Ra,previousItem:null,nextItem:null},Da(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,a,c,o),this}removeSizeGradient(a){var c;return this._removeFactorGradient(this._sizeGradients,a),0===(null===(c=this._sizeGradients)||void 0===c?void 0:c.length)&&(Pa(this._sizeGradientProcessing),this._sizeCreation.process=Sa),this}addColorRemapGradient(a,c,o){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,a,c,o),this}removeColorRemapGradient(a){return this._removeFactorGradient(this._colorRemapGradients,a),this}addAlphaRemapGradient(a,c,o){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,a,c,o),this}removeAlphaRemapGradient(a){return this._removeFactorGradient(this._alphaRemapGradients,a),this}addAngularSpeedGradient(a,c,o){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=ua,this._angularSpeedGradientProcessing={process:Ga,previousItem:null,nextItem:null},Da(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,a,c,o),this}removeAngularSpeedGradient(a){var c;return this._removeFactorGradient(this._angularSpeedGradients,a),0===(null===(c=this._angularSpeedGradients)||void 0===c?void 0:c.length)&&(this._angleCreation.process=Ba,Pa(this._angularSpeedGradientProcessing)),this}addVelocityGradient(a,c,o){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:La,previousItem:null,nextItem:null},Ia(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:ga,previousItem:null,nextItem:null},Da(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,a,c,o),this}removeVelocityGradient(a){var c;return this._removeFactorGradient(this._velocityGradients,a),0===(null===(c=this._velocityGradients)||void 0===c?void 0:c.length)&&(Pa(this._velocityCreation),Pa(this._velocityGradientProcessing)),this}addLimitVelocityGradient(a,c,o){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:ea,previousItem:null,nextItem:null},Ia(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Ma,previousItem:null,nextItem:null},Ia(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,a,c,o),this}removeLimitVelocityGradient(a){var c;return this._removeFactorGradient(this._limitVelocityGradients,a),0===(null===(c=this._limitVelocityGradients)||void 0===c?void 0:c.length)&&(Pa(this._limitVelocityCreation),Pa(this._limitVelocityGradientProcessing)),this}addDragGradient(a,c,o){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Ja,previousItem:null,nextItem:null},Da(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:wa,previousItem:null,nextItem:null},Da(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,a,c,o),this}removeDragGradient(a){var c;return this._removeFactorGradient(this._dragGradients,a),0===(null===(c=this._dragGradients)||void 0===c?void 0:c.length)&&(Pa(this._dragCreation),Pa(this._dragGradientProcessing)),this}addEmitRateGradient(a,c,o){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,a,c,o),this}removeEmitRateGradient(a){return this._removeFactorGradient(this._emitRateGradients,a),this}addStartSizeGradient(a,c,o){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,a,c,o),this._syncStartSizeCreation(),this}removeStartSizeGradient(a){return this._removeFactorGradient(this._startSizeGradients,a),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const a=new Uint8Array(4*this._rawTextureWidth),c=i.TmpColors.oo[0];for(let o=0;o<this._rawTextureWidth;o++){const s=o/this._rawTextureWidth;A.GetCurrentGradient(s,this._rampGradients,((s,q,t)=>{i.oo.LerpToRef(s.color,q.color,t,c),a[4*o]=255*c.r,a[4*o+1]=255*c.g,a[4*o+2]=255*c.b,a[4*o+3]=255}))}this._rampGradientsTexture=l.b.CreateRGBATexture(a,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((a,c)=>a.gradient<c.gradient?-1:a.gradient>c.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(a,c){this._rampGradients||(this._rampGradients=[]);const o=new H(a,c);return this._rampGradients.push(o),this._syncRampGradientTexture(),this}removeRampGradient(a){return this._removeGradientAndTexture(a,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(a,c,o){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=ta,this._colorProcessing.process=ia);const s=new E(a,c,o);return this._colorGradients.push(s),this._colorGradients.sort(((a,c)=>a.gradient<c.gradient?-1:a.gradient>c.gradient?1:0)),this}removeColorGradient(a){if(!this._colorGradients)return this;let c=0;for(const o of this._colorGradients){if(o.gradient===a){this._colorGradients.splice(c,1);break}c++}return 0===this._colorGradients.length&&(this._colorCreation.process=qa,this._colorProcessing.process=pa),this}resetDrawCache(){if(this._drawWrappers){for(const a of this._drawWrappers)if(a)for(const c of a)null===c||void 0===c||c.dispose();this._drawWrappers=[]}}_fetchR(a,c,o,s,q){return q[4*(((a=.5*Math.abs(a)+.5)*o%o|0)+((c=.5*Math.abs(c)+.5)*s%s|0)*o)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const a=this._engine,c=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*c),this._vertexBuffer=new J.d(a,this._vertexData,!0,c);let o=0;const s=this._vertexBuffer.createVertexBuffer(J.g.PositionKind,o,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[J.g.PositionKind]=s,o+=3;const q=this._vertexBuffer.createVertexBuffer(J.g.ColorKind,o,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[J.g.ColorKind]=q,o+=4;const t=this._vertexBuffer.createVertexBuffer("angle",o,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=t,o+=1;const i=this._vertexBuffer.createVertexBuffer("size",o,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=i,o+=2,this._isAnimationSheetEnabled){const a=this._vertexBuffer.createVertexBuffer("cellIndex",o,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=a,o+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const a=this._vertexBuffer.createVertexBuffer("direction",o,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=a,o+=3}if(this._useRampGradients){const a=this._vertexBuffer.createVertexBuffer("remapData",o,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=a,o+=4}let p;if(this._useInstancing){const c=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new J.d(a,c,!1,2),p=this._spriteBuffer.createVertexBuffer("offset",0,2)}else p=this._vertexBuffer.createVertexBuffer("offset",o,2,this._vertexBufferSize,this._useInstancing),o+=2;this._vertexBuffers.offset=p,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const a=[],c=[];let o=0;for(let s=0;s<this._capacity;s++)a.push(o),a.push(o+1),a.push(o+2),a.push(o),a.push(o+2),a.push(o+3),c.push(o,o+1,o+1,o+2,o+2,o+3,o+3,o,o,o+3),o+=4;this._indexBuffer=this._engine.createIndexBuffer(a),this._linesIndexBuffer=this._engine.createIndexBuffer(c)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(a)setTimeout((()=>{this.start(0)}),a);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var c;-1!==(null===(c=this.sc)||void 0===c?void 0:c.getClassName().indexOf("Mesh"))&&this.sc.Rc(!0);const a=this.noiseTexture;if(a&&a.onGeneratedObservable)a.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let c=0;c<this.preWarmCycles;c++)this.animate(!0),a.render()}))}));else for(let c=0;c<this.preWarmCycles;c++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(a))}_postStop(a){}reset(){this._stockParticles.length=0,this.PL.length=0}_appendParticleVertex(a,c,o,q){let t=a*this._vertexBufferSize;if(this._vertexData[t++]=c.position.x+this.pC.x,this._vertexData[t++]=c.position.y+this.pC.y,this._vertexData[t++]=c.position.z+this.pC.z,this._vertexData[t++]=c.color.r,this._vertexData[t++]=c.color.g,this._vertexData[t++]=c.color.b,this._vertexData[t++]=c.color.a,this._vertexData[t++]=c.angle,this._vertexData[t++]=c.scale.x*c.size,this._vertexData[t++]=c.scale.y*c.size,this._isAnimationSheetEnabled&&(this._vertexData[t++]=c.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[t++]=c.direction.x,this._vertexData[t++]=c.direction.y,this._vertexData[t++]=c.direction.z);else if(c._initialDirection){let a=c._initialDirection;this.isLocal&&(s.Hc.TransformNormalToRef(a,this._emitterWorldMatrix,s.TmpVectors.Hc[0]),a=s.TmpVectors.Hc[0]),0===a.x&&0===a.z&&(a.x=.001),this._vertexData[t++]=a.x,this._vertexData[t++]=a.y,this._vertexData[t++]=a.z}else{let a=c.direction;this.isLocal&&(s.Hc.TransformNormalToRef(a,this._emitterWorldMatrix,s.TmpVectors.Hc[0]),a=s.TmpVectors.Hc[0]),0===a.x&&0===a.z&&(a.x=.001),this._vertexData[t++]=a.x,this._vertexData[t++]=a.y,this._vertexData[t++]=a.z}this._useRampGradients&&c.remapData&&(this._vertexData[t++]=c.remapData.x,this._vertexData[t++]=c.remapData.y,this._vertexData[t++]=c.remapData.z,this._vertexData[t++]=c.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===o?o=this._epsilon:1===o&&(o=1-this._epsilon),0===q?q=this._epsilon:1===q&&(q=1-this._epsilon)),this._vertexData[t++]=o,this._vertexData[t++]=q)}_prepareParticle(a){}_createNewOnes(a){let c;for(let o=0;o<a&&this.PL.length!==this._capacity;o++){c=this._createParticle(),this.PL.push(c);let a=this._createQueueStart;for(;a;)a.process(c,this),a=a.nextItem;c._inheritParticleInfoToSubEmitters()}}_update(a){if(this._alive=this.PL.length>0,this.sc.position){const a=this.sc;this._emitterWorldMatrix=a.getWorldMatrix()}else{const a=this.sc;this._emitterWorldMatrix=s.Matrix.Translation(a.x,a.y,a.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.PL),this._createNewOnes(a)}static _GetAttributeNamesOrOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=[J.g.PositionKind,J.g.ColorKind,"angle","offset","size"];return a&&s.push("cellIndex"),c||s.push("direction"),o&&s.push("remapData"),s}static _GetEffectCreationOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,ca.e)(s),a&&s.push("particlesInfos"),c&&s.push("logarithmicDepthConstant"),o&&(s.push("vFogInfos"),s.push("vFogColor")),s}fillDefines(a,c){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ca.o)(this,this._scene,a),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&a.push("#define FOG")),this._isAnimationSheetEnabled&&a.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&a.push("#define LOGARITHMICDEPTH"),c===G.BLENDMODE_MULTIPLY&&a.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&a.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(a.push("#define BILLBOARD"),this.billboardMode){case 2:a.push("#define BILLBOARDY");break;case 8:case 9:a.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&a.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:a.push("#define BILLBOARDMODE_ALL")}o&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),a.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(a,c,o){c.push(...mc._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),a.push(...mc._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),o.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,sa.i)(a,this._imageProcessingConfigurationDefines),(0,sa.e)(o,this._imageProcessingConfigurationDefines))}_getWrapper(a){const c=this._getCustomDrawWrapper(a);if(null!==c&&void 0!==c&&c.effect)return c;const o=[];this.fillDefines(o,a);const s=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let q=this._drawWrappers[s];q||(q=this._drawWrappers[s]=[]);let t=q[a];t||(t=new aa.e(this._engine),t.drawContext&&(t.drawContext.useInstancing=this._useInstancing),q[a]=t);const i=o.join("\n");if(t.defines!==i){const a=[],c=[],o=[];this.fillUniformsAttributesAndSamplerNames(c,a,o),t.setEffect(this._engine.createEffect("particles",a,c,o,i,void 0,void 0,void 0,void 0,this._shaderLanguage),i)}return t}animate(){var a;let c,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!o&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(o?this.preWarmStepOffset:(null===(a=this._scene)||void 0===a?void 0:a.getAnimationRatio())||1),this.manualEmitCount>-1)c=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let a=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const c=this._actualFrame/this.targetStopDuration;A.GetCurrentGradient(c,this._emitRateGradients,((c,o,s)=>{c!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=o.getFactor(),this._currentEmitRateGradient=c),a=(0,T.Lerp)(this._currentEmitRate1,this._currentEmitRate2,s)}))}c=a*this._scaledUpdateSpeed|0,this._newPartsExcess+=a*this._scaledUpdateSpeed-c}if(this._newPartsExcess>1&&(c+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?c=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(c),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!o){let a=0;for(let c=0;c<this.PL.length;c++){const o=this.PL[c];this._appendParticleVertices(a,o),a+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.PL.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(a,c){this._appendParticleVertex(a++,c,0,0),this._useInstancing||(this._appendParticleVertex(a++,c,1,0),this._appendParticleVertex(a++,c,1,1),this._appendParticleVertex(a++,c,0,1))}rebuild(){var a;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(a=this._spriteBuffer)||void 0===a||a._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!mc.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(o.bind(o,14150)),Promise.resolve().then(o.bind(o,14097))])):await Promise.all([Promise.resolve().then(o.bind(o,14090)),Promise.resolve().then(o.bind(o,14073))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.sc||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==G.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(G.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(G.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(a){const c=this._getWrapper(a),o=c.effect,q=this._engine;q.enableEffect(c);const t=this.defaultViewMatrix??this._scene.getViewMatrix();if(o.setTexture("diffuseSampler",this.particleTexture),o.setMatrix("view",t),o.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const a=this.particleTexture.getBaseSize();o.setFloat3("particlesInfos",this.spriteCellWidth/a.width,this.spriteCellHeight/a.height,this.spriteCellWidth/a.width)}if(o.setVector2("translationPivot",this.translationPivot),o.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const a=this._scene.activeCamera;o.setVector3("eyePosition",a.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),o.setTexture("rampSampler",this._rampGradientsTexture));const i=o.defines;var p,G,T,C,j,L;(this._scene&&((0,ca.i)(o,this,this._scene),this.applyFog&&(0,oa.h)(this._scene,void 0,o)),i.indexOf("#define BILLBOARDMODE_ALL")>=0&&(t.invertToRef(s.TmpVectors.Matrix[0]),o.setMatrix("invView",s.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?q.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,o):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,o)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?q.bindBuffers(this._vertexBuffers,null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?this._linesIndexBuffer:this._indexBuffer,o):q.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:null,o);(this.useLogarithmicDepth&&this._scene&&(0,oa.n)(i,o,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(o),this._setEngineBasedOnBlendMode(a),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(o),this._useInstancing)?null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?q.drawElementsType(6,0,10,this.PL.length):q.drawArraysType(7,0,4,this.PL.length):null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?q.drawElementsType(1,0,10*this.PL.length):q.drawElementsType(0,0,6*this.PL.length);return this.PL.length}render(){if(!this.isReady()||!this.PL.length)return 0;const a=this._engine;a.setState&&(a.setState(!1),this.forceDepthWrite&&a.setDepthWrite(!0));let c=0;return c=this.blendMode===G.BLENDMODE_MULTIPLYADD?this._render(G.BLENDMODE_MULTIPLY)+this._render(G.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),c}_onDispose(){}dispose(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),a&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),a&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(c,o),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const a=this._scene.IL.indexOf(this);a>-1&&this._scene.IL.splice(a,1),this._scene._activeParticleSystems.dispose()}this.gc.notifyObservers(this),this.gc.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}mc.ForceGLSL=!1;var Va,Ea=o(12667);!function(a){a[a.ATTACHED=0]="ATTACHED",a[a.END=1]="END"}(Va||(Va={}));class Ha{constructor(a){if(this.particleSystem=a,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!a.sc||!a.sc.dispose){const c=(0,p.c)("BABYLON.AbstractMesh");a.sc=new c("SubemitterSystemEmitter",a.Za()),a._disposeEmitterOnDispose=!0}}clone(){let a=this.particleSystem.sc;if(a){if(a instanceof s.Hc)a=a.clone();else if(-1!==a.getClassName().indexOf("Mesh")){a=new((0,p.c)("BABYLON.Mesh"))("",a.Za()),a.isVisible=!1}}else a=new s.Hc;const c=new Ha(this.particleSystem.clone(this.particleSystem.name,a));return c.particleSystem.name+="Clone",c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem._disposeEmitterOnDispose=!0,c.particleSystem.disposeOnStop=!0,c}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem=this.particleSystem.serialize(a),c}static _ParseParticleSystem(a,c,o){throw(0,Ea.b)("ParseParticle")}static Parse(a,c,o){const s=a.particleSystem,q=new Ha(Ha._ParseParticleSystem(s,c,o,!0));return q.type=a.type,q.inheritDirection=a.inheritDirection,q.inheritedVelocityAmount=a.inheritedVelocityAmount,q.particleSystem._isSubEmitter=!0,q}dispose(){this.particleSystem.dispose()}}var ba=o(12721);function Aa(a,c){const o=new y;return o.direction1=a,o.direction2=c,o}function va(){return new N(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function la(){return new k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Qa(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Hc(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Hc(0,1,0);return new n(a,c,o)}function za(){return new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function ac(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Hc(0,1,0),t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new s.Hc(0,1,0);return new M(a,c,o,q,t)}function cc(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new L(a,c)}function oc(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Hc(0,1,0),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Hc(0,1,0);return new e(a,c,o,q)}const sc=s.Hc.Zero(),qc=s.Hc.Zero(),tc=s.Hc.Zero();class ic{constructor(){this.strength=0,this.position=s.Hc.Zero()}_processParticle(a,c){this.position.subtractToRef(a.position,sc);const o=sc.lengthSquared()+1;sc.normalize().scaleToRef(this.strength/o,qc),qc.scaleToRef(c._tempScaledUpdateSpeed,tc),a.direction.addInPlace(tc)}serialize(){return{position:this.position.hc(),strength:this.strength}}}class pc extends mc{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=a=>{if(!this._subEmitters||0===this._subEmitters.length)return;const c=Math.floor(Math.random()*this._subEmitters.length);for(const o of this._subEmitters[c])if(1===o.type){const c=o.clone();a._inheritParticleInfoToSubEmitter(c),c.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(c.particleSystem),c.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(a,c){const o=Aa(a,c);return this.particleEmitterType=o,o}get flowMap(){return this._flowMap}set flowMap(a){this._flowMap!==a&&(this._flowMap=a,this._flowMapUpdate&&(Pa(this._flowMapUpdate),this._flowMapUpdate=null),a&&(this._flowMapUpdate={process:a=>{var c;const o=null===(c=this.Za())||void 0===c?void 0:c.getTransformMatrix();this._flowMap._processParticle(a,this.flowMapStrength*this._tempScaledUpdateSpeed,o)},previousItem:null,nextItem:null},Ia(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(a){this._attractors.push(a),1===this._attractors.length&&(this._attractorUpdate={process:a=>{for(const c of this._attractors)c._processParticle(a,this)},previousItem:null,nextItem:null},Ia(this._attractorUpdate,this._directionProcessing))}removeAttractor(a){const c=this._attractors.indexOf(a);-1!==c&&this._attractors.splice(c,1),0===this._attractors.length&&Pa(this._attractorUpdate)}start(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(a)}createHemisphericEmitter(){const a=va(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createSphereEmitter(){const a=la(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createDirectedSphereEmitter(){const a=Qa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Hc(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Hc(0,1,0));return this.particleEmitterType=a,a}createCylinderEmitter(){const a=za(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=a,a}createDirectedCylinderEmitter(){const a=ac(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Hc(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new s.Hc(0,1,0));return this.particleEmitterType=a,a}createConeEmitter(){const a=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=a,a}createDirectedConeEmitter(){const a=oc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Hc(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Hc(0,1,0));return this.particleEmitterType=a,a}createBoxEmitter(a,c,o,s){const q=new j;return this.particleEmitterType=q,this.direction1=a,this.direction2=c,this.minEmitBox=o,this.maxEmitBox=s,q}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const a of this.subEmitters)a instanceof pc?this._subEmitters.push([new Ha(a)]):a instanceof Ha?this._subEmitters.push([a]):a instanceof Array&&this._subEmitters.push(a)}_stopSubEmitters(){if(this.activeSubSystems){for(const a of this.activeSubSystems)a.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const a=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==a&&this._rootParticleSystem.activeSubSystems.splice(a,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(a){a&&this._stopSubEmitters()}_prepareParticle(a){if(this._subEmitters&&this._subEmitters.length>0){const c=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];a._attachedSubEmitters=[];for(const o of c)if(0===o.type){const c=o.clone();a._attachedSubEmitters.push(c),c.particleSystem.start()}}}_onDispose(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),a&&this.particles)for(const o of this.particles)if(o._attachedSubEmitters)for(let a=o._attachedSubEmitters.length-1;a>=0;a-=1)o._attachedSubEmitters[a].dispose();if(c&&this.activeSubSystems)for(let o=this.activeSubSystems.length-1;o>=0;o-=1)this.activeSubSystems[o].dispose();if(this._subEmitters&&this._subEmitters.length){for(let a=0;a<this._subEmitters.length;a++)for(const c of this._subEmitters[a])c.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.sc&&this.sc.dispose&&this.sc.dispose(!0)}static _Parse(a,c,o,q){let t;t=o instanceof ba.b?null:o;const G=(0,p.c)("BABYLON.Texture");if(G&&t&&(a.texture?c.particleTexture=G.Parse(a.texture,t,q):a.textureName&&(c.particleTexture=new G(q+a.textureName,t,!1,void 0===a.invertY||a.invertY),c.particleTexture.name=a.textureName)),a.emitterId||0===a.emitterId||void 0!==a.sc?a.emitterId&&t?c.sc=t.getLastMeshById(a.emitterId):c.sc=s.Hc.qo(a.sc):c.sc=s.Hc.Zero(),c.isLocal=!!a.isLocal,void 0!==a.renderingGroupId&&(c.renderingGroupId=a.renderingGroupId),void 0!==a.isBillboardBased&&(c.isBillboardBased=a.isBillboardBased),void 0!==a.billboardMode&&(c.billboardMode=a.billboardMode),void 0!==a.useLogarithmicDepth&&(c.useLogarithmicDepth=a.useLogarithmicDepth),a.animations){for(let o=0;o<a.animations.length;o++){const s=a.animations[o],q=(0,p.c)("BABYLON.Animation");q&&c.animations.push(q.Parse(s))}c.beginAnimationOnStart=a.beginAnimationOnStart,c.beginAnimationFrom=a.beginAnimationFrom,c.beginAnimationTo=a.beginAnimationTo,c.beginAnimationLoop=a.beginAnimationLoop}if(a.autoAnimate&&t&&t.beginAnimation(c,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),c.startDelay=0|a.startDelay,c.minAngularSpeed=a.minAngularSpeed,c.maxAngularSpeed=a.maxAngularSpeed,c.minSize=a.minSize,c.maxSize=a.maxSize,a.minScaleX&&(c.minScaleX=a.minScaleX,c.maxScaleX=a.maxScaleX,c.minScaleY=a.minScaleY,c.maxScaleY=a.maxScaleY),void 0!==a.preWarmCycles&&(c.preWarmCycles=a.preWarmCycles,c.preWarmStepOffset=a.preWarmStepOffset),void 0!==a.minInitialRotation&&(c.minInitialRotation=a.minInitialRotation,c.maxInitialRotation=a.maxInitialRotation),c.minLifeTime=a.minLifeTime,c.maxLifeTime=a.maxLifeTime,c.minEmitPower=a.minEmitPower,c.maxEmitPower=a.maxEmitPower,c.emitRate=a.emitRate,c.gravity=s.Hc.qo(a.gravity),a.noiseStrength&&(c.noiseStrength=s.Hc.qo(a.noiseStrength)),c.color1=i.Yc.qo(a.color1),c.color2=i.Yc.qo(a.color2),c.colorDead=i.Yc.qo(a.colorDead),c.updateSpeed=a.updateSpeed,c.targetStopDuration=a.targetStopDuration,c.blendMode=a.blendMode,a.colorGradients)for(const s of a.colorGradients)c.addColorGradient(s.gradient,i.Yc.qo(s.color1),s.color2?i.Yc.qo(s.color2):void 0);if(a.rampGradients){for(const o of a.rampGradients)c.addRampGradient(o.gradient,i.oo.qo(o.color));c.useRampGradients=a.useRampGradients}if(a.colorRemapGradients)for(const s of a.colorRemapGradients)c.addColorRemapGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);if(a.alphaRemapGradients)for(const s of a.alphaRemapGradients)c.addAlphaRemapGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);if(a.sizeGradients)for(const s of a.sizeGradients)c.addSizeGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);if(a.angularSpeedGradients)for(const s of a.angularSpeedGradients)c.addAngularSpeedGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);if(a.velocityGradients)for(const s of a.velocityGradients)c.addVelocityGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);if(a.dragGradients)for(const s of a.dragGradients)c.addDragGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);if(a.emitRateGradients)for(const s of a.emitRateGradients)c.addEmitRateGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);if(a.startSizeGradients)for(const s of a.startSizeGradients)c.addStartSizeGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);if(a.lifeTimeGradients)for(const s of a.lifeTimeGradients)c.addLifeTimeGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);if(a.limitVelocityGradients){for(const o of a.limitVelocityGradients)c.addLimitVelocityGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);c.limitVelocityDamping=a.limitVelocityDamping}if(a.noiseTexture&&t){const o=(0,p.c)("BABYLON.ProceduralTexture");c.noiseTexture=o.Parse(a.noiseTexture,t,q)}let T;if(a.particleEmitterType){switch(a.particleEmitterType.type){case"SphereParticleEmitter":T=new k;break;case"SphereDirectedParticleEmitter":T=new n;break;case"ConeEmitter":case"ConeParticleEmitter":T=new L;break;case"ConeDirectedParticleEmitter":T=new e;break;case"CylinderParticleEmitter":T=new g;break;case"CylinderDirectedParticleEmitter":T=new M;break;case"HemisphericParticleEmitter":T=new N;break;case"PointParticleEmitter":T=new y;break;case"MeshParticleEmitter":T=new w;break;case"CustomParticleEmitter":T=new f;break;default:T=new j}T.parse(a.particleEmitterType,t)}else T=new j,T.parse(a,t);c.particleEmitterType=T,c.startSpriteCellID=a.startSpriteCellID,c.endSpriteCellID=a.endSpriteCellID,c.spriteCellLoop=a.spriteCellLoop??!0,c.spriteCellWidth=a.spriteCellWidth,c.spriteCellHeight=a.spriteCellHeight,c.spriteCellChangeSpeed=a.spriteCellChangeSpeed,c.spriteRandomStartCell=a.spriteRandomStartCell,c.disposeOnStop=a.disposeOnStop??!1,c.manualEmitCount=a.manualEmitCount??-1}static Parse(a,c,o){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0;const p=a.name;let G,T,C=null,j=null;if(c instanceof ba.b?G=c:(T=c,G=T.getEngine()),a.customShader&&G.createEffectForParticles){j=a.customShader;const c=j.shaderOptions.defines.length>0?j.shaderOptions.defines.join("\n"):"";C=G.createEffectForParticles(j.shaderPath.fragmentElement,j.shaderOptions.uniforms,j.shaderOptions.samplers,c)}const L=new pc(p,t||a.zp,c,C,a.isAnimationSheetEnabled);if(L.customShader=j,L._rootUrl=o,a.id&&(L.id=a.id),a.subEmitters){L.subEmitters=[];for(const s of a.subEmitters){const a=[];for(const q of s)a.push(Ha.Parse(q,c,o));L.subEmitters.push(a)}}if(a.attractors)for(const i of a.attractors){const a=new ic;a.position=s.Hc.qo(i.position),a.strength=i.strength,L.addAttractor(a)}return pc._Parse(a,L,c,o),a.textureMask&&(L.textureMask=i.Yc.qo(a.textureMask)),a.pC&&(L.pC=s.Hc.qo(a.pC)),a.preventAutoStart&&(L.preventAutoStart=a.preventAutoStart),q||L.preventAutoStart||L.start(),L}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};if(pc._Serialize(c,this,a),c.textureMask=this.textureMask.hc(),c.customShader=this.customShader,c.preventAutoStart=this.preventAutoStart,c.pC=this.pC.hc(),this.subEmitters){c.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const o of this._subEmitters){const s=[];for(const c of o)s.push(c.serialize(a));c.subEmitters.push(s)}}if(this._attractors&&this._attractors.length){c.attractors=[];for(const a of this._attractors)c.attractors.push(a.serialize())}return c}static _Serialize(a,c,o){if(a.name=c.name,a.id=c.id,a.zp=c.getCapacity(),a.disposeOnStop=c.disposeOnStop,a.manualEmitCount=c.manualEmitCount,c.sc.position){const o=c.sc;a.emitterId=o.id}else{const o=c.sc;a.sc=o.hc()}c.particleEmitterType&&(a.particleEmitterType=c.particleEmitterType.serialize()),c.particleTexture&&(o?a.texture=c.particleTexture.serialize():(a.textureName=c.particleTexture.name,a.invertY=!!c.particleTexture._invertY)),a.isLocal=c.isLocal,W.d.AppendSerializedAnimations(c,a),a.beginAnimationOnStart=c.beginAnimationOnStart,a.beginAnimationFrom=c.beginAnimationFrom,a.beginAnimationTo=c.beginAnimationTo,a.beginAnimationLoop=c.beginAnimationLoop,a.startDelay=c.startDelay,a.renderingGroupId=c.renderingGroupId,a.isBillboardBased=c.isBillboardBased,a.billboardMode=c.billboardMode,a.minAngularSpeed=c.minAngularSpeed,a.maxAngularSpeed=c.maxAngularSpeed,a.minSize=c.minSize,a.maxSize=c.maxSize,a.minScaleX=c.minScaleX,a.maxScaleX=c.maxScaleX,a.minScaleY=c.minScaleY,a.maxScaleY=c.maxScaleY,a.minEmitPower=c.minEmitPower,a.maxEmitPower=c.maxEmitPower,a.minLifeTime=c.minLifeTime,a.maxLifeTime=c.maxLifeTime,a.emitRate=c.emitRate,a.gravity=c.gravity.hc(),a.noiseStrength=c.noiseStrength.hc(),a.color1=c.color1.hc(),a.color2=c.color2.hc(),a.colorDead=c.colorDead.hc(),a.updateSpeed=c.updateSpeed,a.targetStopDuration=c.targetStopDuration,a.blendMode=c.blendMode,a.preWarmCycles=c.preWarmCycles,a.preWarmStepOffset=c.preWarmStepOffset,a.minInitialRotation=c.minInitialRotation,a.maxInitialRotation=c.maxInitialRotation,a.startSpriteCellID=c.startSpriteCellID,a.spriteCellLoop=c.spriteCellLoop,a.endSpriteCellID=c.endSpriteCellID,a.spriteCellChangeSpeed=c.spriteCellChangeSpeed,a.spriteCellWidth=c.spriteCellWidth,a.spriteCellHeight=c.spriteCellHeight,a.spriteRandomStartCell=c.spriteRandomStartCell,a.isAnimationSheetEnabled=c.isAnimationSheetEnabled,a.useLogarithmicDepth=c.useLogarithmicDepth;const s=c.getColorGradients();if(s){a.colorGradients=[];for(const c of s){const o={gradient:c.gradient,color1:c.color1.hc()};c.color2?o.color2=c.color2.hc():o.color2=c.color1.hc(),a.colorGradients.push(o)}}const q=c.getRampGradients();if(q){a.rampGradients=[];for(const c of q){const o={gradient:c.gradient,color:c.color.hc()};a.rampGradients.push(o)}a.useRampGradients=c.useRampGradients}const t=c.getColorRemapGradients();if(t){a.colorRemapGradients=[];for(const c of t){const o={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?o.factor2=c.factor2:o.factor2=c.factor1,a.colorRemapGradients.push(o)}}const i=c.getAlphaRemapGradients();if(i){a.alphaRemapGradients=[];for(const c of i){const o={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?o.factor2=c.factor2:o.factor2=c.factor1,a.alphaRemapGradients.push(o)}}const p=c.getSizeGradients();if(p){a.sizeGradients=[];for(const c of p){const o={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?o.factor2=c.factor2:o.factor2=c.factor1,a.sizeGradients.push(o)}}const G=c.getAngularSpeedGradients();if(G){a.angularSpeedGradients=[];for(const c of G){const o={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?o.factor2=c.factor2:o.factor2=c.factor1,a.angularSpeedGradients.push(o)}}const T=c.getVelocityGradients();if(T){a.velocityGradients=[];for(const c of T){const o={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?o.factor2=c.factor2:o.factor2=c.factor1,a.velocityGradients.push(o)}}const C=c.getDragGradients();if(C){a.dragGradients=[];for(const c of C){const o={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?o.factor2=c.factor2:o.factor2=c.factor1,a.dragGradients.push(o)}}const j=c.getEmitRateGradients();if(j){a.emitRateGradients=[];for(const c of j){const o={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?o.factor2=c.factor2:o.factor2=c.factor1,a.emitRateGradients.push(o)}}const L=c.getStartSizeGradients();if(L){a.startSizeGradients=[];for(const c of L){const o={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?o.factor2=c.factor2:o.factor2=c.factor1,a.startSizeGradients.push(o)}}const e=c.getLifeTimeGradients();if(e){a.lifeTimeGradients=[];for(const c of e){const o={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?o.factor2=c.factor2:o.factor2=c.factor1,a.lifeTimeGradients.push(o)}}const g=c.getLimitVelocityGradients();if(g){a.limitVelocityGradients=[];for(const c of g){const o={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?o.factor2=c.factor2:o.factor2=c.factor1,a.limitVelocityGradients.push(o)}a.limitVelocityDamping=c.limitVelocityDamping}c.noiseTexture&&(a.noiseTexture=c.noiseTexture.serialize())}clone(a,c){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s={...this._customWrappers};let q=null;const t=this._engine;if(t.createEffectForParticles&&null!=this.customShader){q=this.customShader;const a=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"",c=t.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,a);s[0]?s[0].effect=c:this.setCustomEffect(c,0)}const i=this.serialize(o),p=pc.Parse(i,this._scene||this._engine,this._rootUrl);return p.name=a,p.customShader=q,p._customWrappers=s,void 0===c&&(c=this.sc),this.noiseTexture&&(p.noiseTexture=this.noiseTexture.clone()),p.sc=c,this.preventAutoStart||p.start(),p}}pc.BILLBOARDMODE_Y=2,pc.BILLBOARDMODE_ALL=7,pc.BILLBOARDMODE_STRETCHED=8,pc.BILLBOARDMODE_STRETCHED_LOCAL=9,Ha._ParseParticleSystem=pc.Parse;var Gc=o(13050),Tc=o(13045),Cc=o(12936);Cc.e.prototype.createTransformFeedback=function(){const a=this._gl.createTransformFeedback();if(!a)throw new Error("Unable to create Transform Feedback");return a},Cc.e.prototype.deleteTransformFeedback=function(a){this._gl.deleteTransformFeedback(a)},Cc.e.prototype.bindTransformFeedback=function(a){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,a)},Cc.e.prototype.beginTransformFeedback=function(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(a?this._gl.POINTS:this._gl.TRIANGLES)},Cc.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Cc.e.prototype.setTranformFeedbackVaryings=function(a,c){this._gl.transformFeedbackVaryings(a,c,this._gl.INTERLEAVED_ATTRIBS)},Cc.e.prototype.bindTransformFeedbackBuffer=function(a){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,a?a.underlyingResource:null)},Cc.e.prototype.readTransformFeedbackBuffer=function(a){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,a)};const jc="clipPlaneFragmentDeclaration2",Lc="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";h.c.IncludesShadersStore[jc]||(h.c.IncludesShadersStore[jc]=Lc);o(13968),o(13977),o(13986),o(13995),o(14001),o(14003),o(14006),o(14015);const ec="gpuRenderParticlesPixelShader",gc="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";h.c.ShadersStore[ec]||(h.c.ShadersStore[ec]=gc);const Mc="clipPlaneVertexDeclaration2",Nc="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";h.c.IncludesShadersStore[Mc]||(h.c.IncludesShadersStore[Mc]=Nc);o(14023),o(14026),o(14032),o(14041);const yc="gpuRenderParticlesVertexShader",kc="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";h.c.ShadersStore[yc]||(h.c.ShadersStore[yc]=kc);class nc extends G{static get IsSupported(){if(!Q.b.LastCreatedEngine)return!1;const a=Q.b.LastCreatedEngine.getCaps();return a.supportTransformFeedbacks||a.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(a){this._maxActiveParticleCount=Math.min(a,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(a){this.maxActiveParticleCount=a}createPointEmitter(a,c){const o=Aa(a,c);return this.particleEmitterType=o,o}createHemisphericEmitter(){const a=va(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createSphereEmitter(){const a=la(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createDirectedSphereEmitter(){const a=Qa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Hc(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Hc(0,1,0));return this.particleEmitterType=a,a}createCylinderEmitter(){const a=za(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=a,a}createDirectedCylinderEmitter(){const a=ac(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Hc(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new s.Hc(0,1,0));return this.particleEmitterType=a,a}createConeEmitter(){const a=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=a,a}createDirectedConeEmitter(){const a=oc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Hc(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Hc(0,1,0));return this.particleEmitterType=a,a}createBoxEmitter(a,c,o,s){const q=new j;return this.particleEmitterType=q,this.direction1=a,this.direction2=c,this.minEmitBox=o,this.maxEmitBox=s,q}get flowMap(){return this._flowMap}set flowMap(a){this._flowMap!==a&&(this._flowMap=a)}isReady(){if(!this.sc||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==pc.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(pc.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(pc.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";a?setTimeout((()=>{this.start(0)}),a):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var a;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(a=this._customWrappers[c])||void 0===a?void 0:a.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[a]??this._customWrappers[0]}setCustomEffect(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new aa.e(this._engine),this._customWrappers[c].effect=a}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new v.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(a,c,o){return super._removeGradientAndTexture(a,c,o),this._releaseBuffers(),this}addColorGradient(a,c){this._colorGradients||(this._colorGradients=[]);const o=new E(a,c);return this._colorGradients.push(o),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(a&&this._colorGradients.sort(((a,c)=>a.gradient<c.gradient?-1:a.gradient>c.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(a){return this._removeGradientAndTexture(a,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const c in this._drawWrappers){var a;null===(a=this._drawWrappers[c].drawContext)||void 0===a||a.reset()}}_addFactorGradient(a,c,o){const s=new b(c,o);a.push(s),this._releaseBuffers()}addSizeGradient(a,c){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,a,c),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(a){return this._removeGradientAndTexture(a,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(a,c){if(!a)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&a.sort(((a,c)=>a.gradient<c.gradient?-1:a.gradient>c.gradient?1:0));const o=this;o[c]&&(o[c].dispose(),o[c]=null)}addAngularSpeedGradient(a,c){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,a,c),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(a){return this._removeGradientAndTexture(a,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(a,c){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,a,c),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(a){return this._removeGradientAndTexture(a,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(a,c){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,a,c),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(a){return this._removeGradientAndTexture(a,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(a,c){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,a,c),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(a){return this._removeGradientAndTexture(a,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(a){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(a,c,o){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(a),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.gc=new v.d,this.onStoppedObservable=new v.d,this.onStartedObservable=new v.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,o&&"Scene"!==o.getClassName()?(this._engine=o,this.defaultProjectionMatrix=s.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=o||Q.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.IL.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,p.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,p.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,p.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,p.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new aa.e(this._engine)},this._customWrappers[0].effect=q,this._drawWrappers={0:new aa.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(c=c??{}).randomTextureSize||delete c.randomTextureSize;const i={zp:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...c},G=c;isFinite(G)&&(i.zp=G),this._capacity=i.zp,this._maxActiveParticleCount=i.zp,this._currentActiveCount=0,this._isAnimationSheetEnabled=t,this.particleEmitterType=new j;const T=Math.min(this._engine.getCaps().maxTextureSize,i.randomTextureSize);let C=[];for(let s=0;s<T;++s)C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random());this._randomTexture=new l.b(new Float32Array(C),T,1,5,o,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,C=[];for(let s=0;s<T;++s)C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random());this._randomTexture2=new l.b(new Float32Array(C),T,1,5,o,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=T}_reset(){this._releaseBuffers()}_createVertexBuffers(a,c,o){const s={};s.position=c.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let q=3;s.age=c.createVertexBuffer("age",q,1,this._attributesStrideSize,!0),q+=1,s.size=c.createVertexBuffer("size",q,3,this._attributesStrideSize,!0),q+=3,s.life=c.createVertexBuffer("life",q,1,this._attributesStrideSize,!0),q+=1,q+=4,this.billboardMode===pc.BILLBOARDMODE_STRETCHED&&(s.direction=c.createVertexBuffer("direction",q,3,this._attributesStrideSize,!0)),q+=3,this._platform.alignDataInBuffer&&(q+=1),this.particleEmitterType instanceof f&&(q+=3,this._platform.alignDataInBuffer&&(q+=1)),this._colorGradientsTexture||(s.color=c.createVertexBuffer("color",q,4,this._attributesStrideSize,!0),q+=4),this._isBillboardBased||(s.initialDirection=c.createVertexBuffer("initialDirection",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1)),this.noiseTexture&&(s.noiseCoordinates1=c.createVertexBuffer("noiseCoordinates1",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1),s.noiseCoordinates2=c.createVertexBuffer("noiseCoordinates2",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1)),s.angle=c.createVertexBuffer("angle",q,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?q++:q+=2,this._isAnimationSheetEnabled&&(s.cellIndex=c.createVertexBuffer("cellIndex",q,1,this._attributesStrideSize,!0),q+=1,this.spriteRandomStartCell&&(s.cellStartOffset=c.createVertexBuffer("cellStartOffset",q,1,this._attributesStrideSize,!0),q+=1)),s.offset=o.createVertexBuffer("offset",0,2),s.uv=o.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(s),this._platform.createVertexBuffers(a,s),this.resetDrawCache()}_initialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!a)return;const c=this._engine,o=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof f&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const q=this.particleEmitterType instanceof f,t=s.TmpVectors.Hc[0];let i=0;for(let s=0;s<this._capacity;s++)if(o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),q?(this.particleEmitterType.particleDestinationGenerator(s,null,t),o.push(t.x),o.push(t.y),o.push(t.z)):(o.push(0),o.push(0),o.push(0)),this._platform.alignDataInBuffer&&o.push(0),i+=16,q&&(this.particleEmitterType.particlePositionGenerator(s,null,t),o.push(t.x),o.push(t.y),o.push(t.z),this._platform.alignDataInBuffer&&o.push(0),i+=4),this._colorGradientsTexture||(o.push(0),o.push(0),o.push(0),o.push(0),i+=4),this.isBillboardBased||(o.push(0),o.push(0),o.push(0),this._platform.alignDataInBuffer&&o.push(0),i+=4),this.noiseTexture&&(o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),this._platform.alignDataInBuffer&&o.push(0),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),this._platform.alignDataInBuffer&&o.push(0),i+=8),o.push(0),i+=1,this._angularSpeedGradientsTexture||(o.push(0),i+=1),this._isAnimationSheetEnabled&&(o.push(0),i+=1,this.spriteRandomStartCell&&(o.push(0),i+=1)),this._platform.alignDataInBuffer){let a=3-(i+3&3);for(i+=a;a-- >0;)o.push(0)}const p=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),G=this._platform.createParticleBuffer(o),T=this._platform.createParticleBuffer(o);this._buffer0=new J.d(c,G,!1,this._attributesStrideSize),this._buffer1=new J.d(c,T,!1,this._attributesStrideSize),this._spriteBuffer=new J.d(c,p,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let a=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(a+="\n#define BILLBOARD"),this._colorGradientsTexture&&(a+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(a+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(a+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(a+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(a+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(a+="\n#define DRAGGRADIENTS"),this._flowMap&&(a+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(a+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(a+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(a+="\n#define NOISE"),this.isLocal&&(a+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===a||(this._cachedUpdateDefines=a,this._updateBuffer=this._platform.createUpdateBuffer(a)),this._platform.isUpdateBufferReady()}_getWrapper(a){const c=this._getCustomDrawWrapper(a);if(null!==c&&void 0!==c&&c.effect)return c;const o=[];this.fillDefines(o,a);let s=this._drawWrappers[a];s||(s=new aa.e(this._engine),s.drawContext&&(s.drawContext.useInstancing=!0),this._drawWrappers[a]=s);const q=o.join("\n");if(s.defines!==q){const a=[],c=[],o=[];this.fillUniformsAttributesAndSamplerNames(c,a,o),s.setEffect(this._engine.createEffect("gpuRenderParticles",a,c,o,q),q)}return s}static _GetAttributeNamesOrOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const q=[J.g.PositionKind,"age","life","size","angle"];return a||q.push(J.g.ColorKind),c&&q.push("cellIndex"),o||q.push("initialDirection"),s&&q.push("direction"),q.push("offset",J.g.UVKind),q}static _GetEffectCreationOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=["emitterWM","pC","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,ca.e)(s),a&&s.push("sheetInfos"),c&&s.push("logarithmicDepthConstant"),o&&(s.push("vFogInfos"),s.push("vFogColor")),s}fillDefines(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ca.o)(this,this._scene,a),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Tc.e.FOGMODE_NONE&&a.push("#define FOG")),c===pc.BLENDMODE_MULTIPLY&&a.push("#define BLENDMULTIPLYMODE"),this.isLocal&&a.push("#define LOCAL"),this.useLogarithmicDepth&&a.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(a.push("#define BILLBOARD"),this.billboardMode){case pc.BILLBOARDMODE_Y:a.push("#define BILLBOARDY");break;case pc.BILLBOARDMODE_STRETCHED:a.push("#define BILLBOARDSTRETCHED");break;case pc.BILLBOARDMODE_ALL:a.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&a.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&a.push("#define ANIMATESHEET"),o&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),a.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(a,c,o){c.push(...nc._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===pc.BILLBOARDMODE_STRETCHED)),a.push(...nc._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),o.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Gc.e.PrepareUniforms(a,this._imageProcessingConfigurationDefines),Gc.e.PrepareSamplers(o,this._imageProcessingConfigurationDefines))}animate(){var a;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(c?this.preWarmStepOffset:(null===(a=this._scene)||void 0===a?void 0:a.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(a,c){const o=this[c];if(!a||!a.length||o)return;const s=new Float32Array(this._rawTextureWidth);for(let q=0;q<this._rawTextureWidth;q++){const c=q/this._rawTextureWidth;A.GetCurrentGradient(c,a,((a,c,o)=>{s[q]=(0,T.Lerp)(a.factor1,c.factor1,o)}))}this[c]=l.b.CreateRTexture(s,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[c].name=c.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const a=new Uint8Array(4*this._rawTextureWidth),c=i.TmpColors.Yc[0];for(let o=0;o<this._rawTextureWidth;o++){const s=o/this._rawTextureWidth;A.GetCurrentGradient(s,this._colorGradients,((s,q,t)=>{i.Yc.LerpToRef(s.color1,q.color1,t,c),a[4*o]=255*c.r,a[4*o+1]=255*c.g,a[4*o+2]=255*c.b,a[4*o+3]=255*c.a}))}this._colorGradientsTexture=l.b.CreateRGBATexture(a,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(a,c){var o,q,t,i;const p=this._getWrapper(a),G=p.effect;this._engine.enableEffect(p);const T=(null===(o=this._scene)||void 0===o?void 0:o.getViewMatrix())||s.Matrix.IdentityReadOnly;if(G.setMatrix("view",T),G.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),G.setTexture("diffuseSampler",this.particleTexture),G.setVector2("translationPivot",this.translationPivot),G.setVector3("pC",this.pC),this.isLocal&&G.setMatrix("emitterWM",c),this._colorGradientsTexture?G.setTexture("colorGradientSampler",this._colorGradientsTexture):G.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const a=this.particleTexture.getBaseSize();G.setFloat3("sheetInfos",this.spriteCellWidth/a.width,this.spriteCellHeight/a.height,a.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const a=this._scene.activeCamera;G.setVector3("eyePosition",a.globalPosition)}const C=G.defines;if(this._scene&&((0,ca.i)(G,this,this._scene),this.applyFog&&(0,oa.h)(this._scene,void 0,G)),C.indexOf("#define BILLBOARDMODE_ALL")>=0){const a=T.clone();a.invert(),G.setMatrix("invView",a)}return this.useLogarithmicDepth&&this._scene&&(0,oa.n)(C,G,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(G),this._setEngineBasedOnBlendMode(a),this._platform.bindDrawBuffers(this._targetIndex,G,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(G),null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(i=this._scene)&&void 0!==i&&i.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(a){if(!this.sc||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!a)if(this.sc.position){a=this.sc.getWorldMatrix()}else{const c=this.sc;a=s.TmpVectors.Matrix[0],s.Matrix.TranslationToRef(c.x,c.y,c.z,a)}const c=this._engine,o=c.getDepthWrite();if(c.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const a=this.Za();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",a.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",a),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=q,c.setDepthWrite(o)}render(){let a,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!c&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let a=0;a<this.preWarmCycles;a++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const a=0|this._accumulatedCount;this._accumulatedCount-=a,this._currentActiveCount+=a}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.sc.position){a=this.sc.getWorldMatrix()}else{const c=this.sc;a=s.TmpVectors.Matrix[0],s.Matrix.TranslationToRef(c.x,c.y,c.z,a)}const q=this._engine;this.updateInAnimate||this._update(a);let t=0;return c||o||(q.setState(!1),this.forceDepthWrite&&q.setDepthWrite(!0),t=this.blendMode===pc.BLENDMODE_MULTIPLYADD?this._render(pc.BLENDMODE_MULTIPLY,a)+this._render(pc.BLENDMODE_ADD,a):this._render(this.blendMode,a),this._engine.setAlphaMode(0)),t}rebuild(){const a=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(a,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,a()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const c in this._drawWrappers){this._drawWrappers[c].dispose()}if(this._drawWrappers={},this._scene){const a=this._scene.IL.indexOf(this);a>-1&&this._scene.IL.splice(a,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let c=0;c<this._renderVertexBuffers.length;++c){const a=this._renderVertexBuffers[c];for(const c in a)a[c].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),a&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),a&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.gc.notifyObservers(this),this.gc.clear()}clone(a,c){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s={...this._customWrappers};let q=null;const t=this._engine;if(t.createEffectForParticles&&null!=this.customShader){q=this.customShader;const a=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"";s[0]=t.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,a,void 0,void 0,void 0,this)}const i=this.serialize(o),p=nc.Parse(i,this._scene||this._engine,this._rootUrl);return p.name=a,p.customShader=q,p._customWrappers=s,void 0===c&&(c=this.sc),this.noiseTexture&&(p.noiseTexture=this.noiseTexture.clone()),p.sc=c,p}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return pc._Serialize(c,this,a),c.activeParticleCount=this.activeParticleCount,c.randomTextureSize=this._randomTextureSize,c.customShader=this.customShader,c}static Parse(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0;const t=a.name;let i,p;c instanceof ba.b?i=c:(p=c,i=p.getEngine());const G=new nc(t,{zp:q||a.zp,randomTextureSize:a.randomTextureSize},c,null,a.isAnimationSheetEnabled);if(G._rootUrl=o,a.customShader&&i.createEffectForParticles){const c=a.customShader,o=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",s=i.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,o,void 0,void 0,void 0,G);G.setCustomEffect(s,0),G.customShader=c}return a.id&&(G.id=a.id),a.activeParticleCount&&(G.activeParticleCount=a.activeParticleCount),pc._Parse(a,G,c,o),a.preventAutoStart&&(G.preventAutoStart=a.preventAutoStart),s||G.preventAutoStart||G.start(),G}}var fc=o(12637),Jc=o(14044),wc=o(13166);class Zc{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(a){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const c of this.systems)c.sc=a;this._emitterNode=a}setEmitterAsSphere(a,c,o){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:a,renderingGroupId:c};const s=(0,Jc.b)("emitterSphere",{diameter:a.diameter,segments:a.segments},o);s.renderingGroupId=c;const q=new wc.co("emitterSphereMaterial",o);q.emissiveColor=a.color,s.material=q;for(const t of this.systems)t.sc=s;this._emitterNode=s}start(a){for(const c of this.systems)a&&(c.sc=a),c.start()}dispose(){for(const a of this.systems)a.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={systems:[]};for(const o of this.systems)c.systems.push(o.serialize(a));return this._emitterNode&&(c.sc=this._emitterCreationOptions),c}static Parse(a,c){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0;const q=new Zc,t=this.BaseAssetsUrl+"/textures/";c=c||Q.b.LastCreatedScene;for(const i of a.systems)q.systems.push(o?nc.Parse(i,c,t,!0,s):pc.Parse(i,c,t,!0,s));if(a.sc){const o=a.sc.options;if("Sphere"===a.sc.kind)q.setEmitterAsSphere({diameter:o.diameter,segments:o.segments,color:i.oo.qo(o.color)},a.sc.renderingGroupId,c)}return q}}Zc.BaseAssetsUrl="https://assets.babylonjs.com/particles";var hc=o(12672);class Uc{static CreateDefault(a){let c,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,s=arguments.length>2?arguments[2]:void 0;c=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new nc("default system",{zp:o},s):new pc("default system",o,s),c.sc=a;const q=fc.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return c.particleTexture=new F.e(q,c.Za()),c.createConeEmitter(.1,Math.PI/4),c.color1=new i.Yc(1,1,1,1),c.color2=new i.Yc(1,1,1,1),c.colorDead=new i.Yc(1,1,1,0),c.minSize=.1,c.maxSize=.1,c.minEmitPower=2,c.maxEmitPower=2,c.updateSpeed=1/60,c.emitRate=30,c}static CreateAsync(a,c){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0;c||(c=Q.b.LastCreatedScene);const q={};return c.addPendingData(q),new Promise(((t,i)=>{if(o&&!nc.IsSupported)return c.removePendingData(q),i("Particle system with GPU is not supported.");fc.Tools.LoadFile(`${Uc.BaseAssetsUrl}/systems/${a}.json`,(a=>{c.removePendingData(q);const i=JSON.parse(a.toString());return t(Zc.Parse(i,c,o,s))}),void 0,void 0,void 0,(()=>(c.removePendingData(q),i(`An error occurred with the creation of your particle system. Check if your type '${a}' exists.`))))}))}static ExportSet(a){const c=new Zc;for(const o of a)c.systems.push(o);return c}static ParseFromFileAsync(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",t=arguments.length>5?arguments[5]:void 0;return new Promise(((i,p)=>{const G=new hc.b;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const c=JSON.parse(G.responseText);let p;p=s?nc.Parse(c,o,q,!1,t):pc.Parse(c,o,q,!1,t),a&&(p.name=a),i(p)}else p("Unable to load the particle system")})),G.open("GET",c),G.send()}))}static ParseFromSnippetAsync(a,c){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",q=arguments.length>4?arguments[4]:void 0;if("_BLANK"===a){const a=this.CreateDefault(null);return a.start(),Promise.resolve(a)}return new Promise(((t,i)=>{const p=new hc.b;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const i=JSON.parse(JSON.parse(p.responseText).jsonPayload),G=JSON.parse(i.particleSystem);let T;T=o?nc.Parse(G,c,s,!1,q):pc.Parse(G,c,s,!1,q),T.snippetId=a,t(T)}else i("Unable to load the snippet "+a)})),p.open("GET",this.SnippetUrl+"/"+a.replace(/#/g,"/")),p.send()}))}}Uc.BaseAssetsUrl=Zc.BaseAssetsUrl,Uc.SnippetUrl="https://snippet.babylonjs.com",Uc.CreateFromSnippetAsync=Uc.ParseFromSnippetAsync;var Sc=o(13241),rc=o(13083),xc=o(14052);(0,xc.h)(rc.d.NAME_PARTICLESYSTEM,((a,c,o,s)=>{const q=(0,xc.k)(rc.d.NAME_PARTICLESYSTEM);if(q&&void 0!==a.IL&&null!==a.IL)for(let t=0,i=a.IL.length;t<i;t++){const i=a.IL[t];o.IL.push(q(i,c,s))}})),(0,xc.e)(rc.d.NAME_PARTICLESYSTEM,((a,c,o)=>{if(a.activeParticleCount){return nc.Parse(a,c,o)}return pc.Parse(a,c,o)})),ba.b.prototype.createEffectForParticles=function(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",t=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0,G=arguments.length>7?arguments[7]:void 0,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,C=arguments.length>9?arguments[9]:void 0,j=[],L=[];const e=[];return G?G.fillUniformsAttributesAndSamplerNames(L,j,e):(j=pc._GetAttributeNamesOrOptions(),L=pc._GetEffectCreationOptions()),-1===q.indexOf(" BILLBOARD")&&(q+="\n#define BILLBOARD\n"),null!==G&&void 0!==G&&G.isAnimationSheetEnabled&&-1===q.indexOf(" ANIMATESHEET")&&(q+="\n#define ANIMATESHEET\n"),-1===s.indexOf("diffuseSampler")&&s.push("diffuseSampler"),this.createEffect({vertex:C??(null===G||void 0===G?void 0:G.vertexShaderName)??"particles",fragmentElement:a},j,L.concat(c),e.concat(s),q,t,i,p,void 0,T,(async()=>{0===T?await Promise.resolve().then(o.bind(o,14090)):await Promise.resolve().then(o.bind(o,14150))}))},Sc.c.prototype.getEmittedParticleSystems=function(){const a=[];for(let c=0;c<this.Za().IL.length;c++){const o=this.Za().IL[c];o.sc===this&&a.push(o)}return a},Sc.c.prototype.getHierarchyEmittedParticleSystems=function(){const a=[],c=this.getDescendants();c.push(this);for(let o=0;o<this.Za().IL.length;o++){const s=this.Za().IL[o],q=s.sc;q.position&&-1!==c.indexOf(q)&&a.push(s)}return a};o(13140),o(13147),o(13220);o(13224),o(14060),o(13009),o(13130),o(13261);o(13002);var Rc;o(14066),o(12833);!function(a){a[a.Color=2]="Color",a[a.UV=1]="UV",a[a.Random=0]="Random",a[a.Stated=3]="Stated"}(Rc||(Rc={}));var dc=o(13035);const Xc=new s.Hc(0,0,0),Wc=new s.Hc(0,0,0),Fc=new s.Hc(0,0,0);class Oc{constructor(a,c,o){this.width=a,this.height=c,this.data=o}processFlowable(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;if(!o)return;o instanceof s.Matrix?s.Hc.TransformCoordinatesToRef(a.position,o,Fc):(Fc.x=o.x,Fc.y=o.y,Fc.z=o.z);const q=.5*Fc.x+.5,t=1-(.5*Fc.y+.5),i=Math.floor(q*this.width),p=Math.floor(t*this.height);if(i<0||i>=this.width||p<0||p>=this.height)return;const G=4*(p*this.width+i),T=this.data[G]/255*2-1,C=this.data[G+1]/255*2-1,j=this.data[G+2]/255*2-1,L=this.data[G+3]/255;Xc.set(T,C,j),Xc.scaleToRef(c*L,Wc),a.direction.addInPlace(Wc)}_processParticle(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;this.processFlowable(a,c,o)}static async FromUrlAsync(a){return await new Promise(((c,o)=>{const s=document.createElement("canvas"),q=s.getContext("2d");let t=null;const i=new Image;i.crossOrigin="anonymous",i.src=a,i.onerror=c=>{o(new Error(`Failed to load image: ${a} : ${c}`))},i.onload=()=>{s.width=i.width,s.height=i.height,q.drawImage(i,0,0),t=q.getImageData(0,0,s.width,s.height),c(new Oc(s.width,s.height,t.data))}}))}static async ExtractFromTextureAsync(a){return await new Promise(((c,o)=>{if(!a.isReady())return void a.onLoadObservable.addOnce((async()=>{try{const o=await this.ExtractFromTextureAsync(a);c(o)}catch(s){o(s)}}));const s=a.getSize();dc.o.GetTextureDataAsync(a,s.width,s.height).then((a=>{c(new Oc(s.width,s.height,new Uint8ClampedArray(a)))})).catch(o)}))}}var Bc,uc,Kc,Dc,Ic,Yc,Pc,mo,Vc;!function(a){a[a.Int=1]="Int",a[a.Float=2]="Float",a[a.Vector2=4]="Vector2",a[a.Hc=8]="Hc",a[a.Matrix=16]="Matrix",a[a.Particle=32]="Particle",a[a.Texture=64]="Texture",a[a.Yc=128]="Yc",a[a.FloatGradient=256]="FloatGradient",a[a.Vector2Gradient=512]="Vector2Gradient",a[a.Vector3Gradient=1024]="Vector3Gradient",a[a.Color4Gradient=2048]="Color4Gradient",a[a.System=4096]="System",a[a.AutoDetect=8192]="AutoDetect",a[a.BasedOnInput=16384]="BasedOnInput",a[a.Undefined=32768]="Undefined",a[a.All=65535]="All"}(Bc||(Bc={})),function(a){a[a.Compatible=0]="Compatible",a[a.TypeIncompatible=1]="TypeIncompatible",a[a.HierarchyIssue=2]="HierarchyIssue"}(uc||(uc={})),function(a){a[a.Input=0]="Input",a[a.Output=1]="Output"}(Kc||(Kc={}));class Ec{get direction(){return this._direction}get type(){if(this._type===Bc.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Bc.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(a){this._type=a}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((a=>a.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(a,c,o){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Bc.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new v.d,this.onDisconnectionObservable=new v.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=c,this.name=a,this._direction=o}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(a){var c;return this.isConnected?null!==(c=this._connectedPoint)&&void 0!==c&&c._storedFunction?this._connectedPoint._storedFunction(a):this._connectedPoint._storedValue:this.value}canConnectTo(a){return 0===this.checkCompatibilityState(a)}checkCompatibilityState(a){const c=this._ownerBlock,o=a.ownerBlock;if(this.type!==a.type&&a.innerType!==Bc.AutoDetect)return a.acceptedConnectionPointTypes&&-1!==a.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(a.excludedConnectionPointTypes&&-1!==a.excludedConnectionPointTypes.indexOf(this.type))return 1;let s=o,q=c;return 0===this.direction&&(s=c,q=o),s.isAnAncestorOf(q)?2:0}connectTo(a){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(a))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${a.ownerBlock.name}".${a.name}`;return this._endpoints.push(a),a._connectedPoint=this,this.onConnectionObservable.notifyObservers(a),a.onConnectionObservable.notifyObservers(this),this}disconnectFrom(a){const c=this._endpoints.indexOf(a);return-1===c||(this._endpoints.splice(c,1),a._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(a),a.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(a){let c=1;for(;c<Bc.All;)a&c||this.excludedConnectionPointTypes.push(c),c<<=1}serialize(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c={};return c.name=this.name,c.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.hc?(c.valueType="BABYLON."+this.value.getClassName(),c.value=this.value.hc()):(c.valueType="number",c.value=this.value)),a&&this.connectedPoint&&(c.inputName=this.name,c.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,c.targetConnectionName=this.connectedPoint.name,c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),c}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Hc{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(a){this._name=a}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(a){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new v.d,this.gc=new v.d,this.onInputChangedObservable=new v.d,this.visibleOnFrame=!1,this._name=a,this.uniqueId=O.e.UniqueId}_inputRename(a){return a}_outputRename(a){return a}isAnAncestorOf(a){for(const c of this._outputs)if(c.hasEndpoints)for(const o of c.endpoints){if(o.ownerBlock===a)return!0;if(o.ownerBlock.isAnAncestorOf(a))return!0}return!1}isAnAncestorOfType(a){if(this.getClassName()===a)return!0;for(const c of this._outputs)if(c.hasEndpoints)for(const o of c.endpoints)if(o.ownerBlock.isAnAncestorOfType(a))return!0;return!1}getInputByName(a){const c=this._inputs.filter((c=>c.name===a));return c.length?c[0]:null}_linkConnectionTypes(a,c){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[c]._acceptedConnectionPointType=this._inputs[a]:(this._inputs[a]._linkedConnectionSource=this._inputs[c],this._inputs[a]._isMainLinkSource=!0),this._inputs[c]._linkedConnectionSource=this._inputs[a]}registerInput(a,c){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0,t=arguments.length>5?arguments[5]:void 0;const i=new Ec(a,this,0);return i.type=c,i.isOptional=o,i.defaultValue=s,i.value=s,i.valueMin=q,i.valueMax=t,this._inputs.push(i),this.onInputChangedObservable.notifyObservers(i),this}registerOutput(a,c,o){return(o=o??new Ec(a,this,1)).type=c,this._outputs.push(o),this}_build(a){}_customBuildStep(a){}build(a){if(this._buildId===a.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((a=>a.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=a.buildId;for(const c of this._inputs){if(!c.connectedPoint){c.isOptional||a.notConnectedNonOptionalInputs.push(c);continue}const o=c.connectedPoint.ownerBlock;o&&o!==this&&!o.isSystem&&o.build(a)}return this._customBuildStep(a),a.verbose&&B.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(a),this.onBuildObservable.notifyObservers(this),!1}serialize(){const a={};a.customType="BABYLON."+this.getClassName(),a.id=this.uniqueId,a.name=this.name,a.visibleOnFrame=this.visibleOnFrame,a.inputs=[],a.outputs=[];for(const c of this.inputs)a.inputs.push(c.serialize());for(const c of this.outputs)a.outputs.push(c.serialize(!1));return a}_deserialize(a){this._name=a.name,this.comments=a.comments,this.visibleOnFrame=!!a.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(a)}_deserializePortDisplayNamesAndExposedOnFrame(a){const c=a.inputs,o=a.outputs;if(c)for(const s of c){const a=this.inputs.find((a=>a.name===s.name));if(!a)return;if(s.displayName&&(a.displayName=s.displayName),s.isExposedOnFrame&&(a.isExposedOnFrame=s.isExposedOnFrame,a.exposedPortPosition=s.exposedPortPosition),void 0!==s.value&&null!==s.value)if("number"===s.valueType)a.value=s.value;else{const c=(0,p.c)(s.valueType);c&&(a.value=c.qo(s.value))}}if(o)for(let s=0;s<o.length;s++){const a=o[s];a.displayName&&(this.outputs[s].displayName=a.displayName),a.isExposedOnFrame&&(this.outputs[s].isExposedOnFrame=a.isExposedOnFrame,this.outputs[s].exposedPortPosition=a.exposedPortPosition)}}clone(){const a=this.serialize(),c=(0,p.c)(a.customType);if(c){const o=new c;return o._deserialize(a),o}return null}dispose(){this.gc.notifyObservers(this),this.gc.clear();for(const a of this.inputs)a.dispose();for(const a of this.outputs)a.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function bc(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",s=arguments.length>3?arguments[3]:void 0;return(q,t)=>{let i=q._propStore;i||(i=[],q._propStore=i),i.push({propertyName:t,displayName:a,type:c,groupName:o,options:s??{},className:q.getClassName()})}}(0,d.d)([(0,X.E)("comment")],Hc.prototype,"comments",void 0),function(a){a[a.Boolean=0]="Boolean",a[a.Float=1]="Float",a[a.Int=2]="Int",a[a.Vector2=3]="Vector2",a[a.List=4]="List",a[a.Yc=5]="Yc",a[a.SamplingMode=6]="SamplingMode",a[a.TextureFormat=7]="TextureFormat",a[a.TextureType=8]="TextureType"}(Dc||(Dc={})),function(a){a[a.None=0]="None",a[a.Position=1]="Position",a[a.Direction=2]="Direction",a[a.Age=3]="Age",a[a.Lifetime=4]="Lifetime",a[a.Color=5]="Color",a[a.ScaledDirection=6]="ScaledDirection",a[a.Scale=7]="Scale",a[a.AgeGradient=8]="AgeGradient",a[a.Angle=9]="Angle",a[a.SpriteCellIndex=16]="SpriteCellIndex",a[a.SpriteCellStart=17]="SpriteCellStart",a[a.SpriteCellEnd=18]="SpriteCellEnd"}(Ic||(Ic={})),function(a){a[a.None=0]="None",a[a.Time=1]="Time",a[a.Delta=2]="Delta",a[a.Emitter=3]="Emitter"}(Yc||(Yc={}));class Ac{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let a="";for(const c of this.notConnectedNonOptionalInputs)a+=`input ${c.name} from block ${c.ownerBlock.name}[${c.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(a)throw"Build of Node Particle System Set failed:\n"+a}adapt(a,c){const o=a.getConnectedValue(this)||0;if(a.type===c)return o;switch(c){case Bc.Vector2:return new s.Vector2(o,o);case Bc.Hc:return new s.Hc(o,o,o);case Bc.Yc:return new i.Yc(o,o,o,o)}return null}getContextualValue(a){if(!this.particleContext||!this.systemContext)return null;switch(a){case Ic.Position:return this.particleContext.position;case Ic.Direction:return this.particleContext.direction;case Ic.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Ic.Color:return this.particleContext.color;case Ic.Age:return this.particleContext.age;case Ic.Lifetime:return this.particleContext.lifeTime;case Ic.Angle:return this.particleContext.angle;case Ic.Scale:return this.particleContext.scale;case Ic.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Ic.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Ic.SpriteCellIndex:return this.particleContext.cellIndex;case Ic.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.sc.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.sc.absolutePosition:this.systemContext.sc:null}getSystemValue(a){if(!this.particleContext||!this.systemContext)return null;switch(a){case Yc.Time:return this.systemContext._actualFrame;case Yc.Delta:return this.systemContext._scaledUpdateSpeed;case Yc.Emitter:if(this.isEmitterTransformNode){return this.systemContext.sc.absolutePosition}return this.systemContext.sc}return null}}function vc(a,c,o){const s=new Ac;s.ao=c;const q=a.createSystem(s);return q.canStart=()=>!0,q.sc=o.clone(),q.disposeOnStop=!0,q.start(),q}class lc extends Hc{constructor(a){super(a),this.blendMode=G.BLENDMODE_ONEONE,this.zp=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Bc.Particle),this.registerInput("texture",Bc.Texture),this.registerInput("onStart",Bc.System,!0),this.registerInput("onEnd",Bc.System,!0),this.registerOutput("system",Bc.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(a){a.zp=this.zp,a.buildId=this._buildId++,this.build(a);const c=this.particle.getConnectedValue(a);return c.particleTexture=this.texture.getConnectedValue(a),c.emitRate=this.emitRate,c.blendMode=this.blendMode,c.name=this.name,c._nodeGenerated=!0,c._targetStopDuration=this.targetStopDuration,c.startDelay=this.startDelay,this.system._storedValue=this,c.canStart=()=>!this.doNoStart,c.onStartedObservable.add((o=>{const s=this.onStart.getConnectedValue(a);s&&o.onStartedObservable.addOnce((()=>{a.systemContext=c;const o=vc(s,a.ao,a.emitterPosition);this.gc.addOnce((()=>{o.dispose()}))}));const q=this.onEnd.getConnectedValue(a);q&&o.onStoppedObservable.addOnce((()=>{a.systemContext=c;const o=vc(q,a.ao,a.emitterPosition);this.gc.addOnce((()=>{o.dispose()}))}))})),this.gc.addOnce((()=>{c.dispose()})),c}serialize(){const a=super.serialize();return a.zp=this.zp,a.emitRate=this.emitRate,a.blendMode=this.blendMode,a.doNoStart=this.doNoStart,a.targetStopDuration=this.targetStopDuration,a.startDelay=this.startDelay,a}_deserialize(a){super._deserialize(a),this.zp=a.zp,this.emitRate=a.emitRate,this.doNoStart=!!a.doNoStart,void 0!==a.blendMode&&(this.blendMode=a.blendMode),void 0!==a.targetStopDuration&&(this.targetStopDuration=a.targetStopDuration),void 0!==a.startDelay&&(this.startDelay=a.startDelay)}}(0,d.d)([bc("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:G.BLENDMODE_ONEONE},{label:"Standard",value:G.BLENDMODE_STANDARD},{label:"Add",value:G.BLENDMODE_ADD},{label:"Multiply",value:G.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:G.BLENDMODE_MULTIPLYADD}]})],lc.prototype,"blendMode",void 0),(0,d.d)([bc("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],lc.prototype,"zp",void 0),(0,d.d)([bc("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lc.prototype,"emitRate",void 0),(0,d.d)([bc("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lc.prototype,"targetStopDuration",void 0),(0,d.d)([bc("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lc.prototype,"startDelay",void 0),(0,d.d)([bc("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],lc.prototype,"doNoStart",void 0),(0,p.d)("BABYLON.SystemBlock",lc);class Qc extends Hc{get type(){if(this._type===Bc.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Bc.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Bc.Vector2,this._type;case"Hc":return this._type=Bc.Hc,this._type;case"Yc":return this._type=Bc.Yc,this._type;case"Matrix":return this._type=Bc.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Ic.None&&this._systemSource!==Yc.None}get systemSource(){return this._systemSource}set systemSource(a){if(this._systemSource=a,a!==Yc.None){switch(this._contextualSource=Ic.None,this._type=Bc.Float,a){case Yc.Time:case Yc.Delta:this._type=Bc.Float;break;case Yc.Emitter:this._type=Bc.Hc}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Ic.None}get contextualValue(){return this._contextualSource}set contextualValue(a){if(this._contextualSource=a,a!==Ic.None){switch(this._systemSource=Yc.None,a){case Ic.Scale:this._type=Bc.Vector2;break;case Ic.Position:case Ic.Direction:case Ic.ScaledDirection:this._type=Bc.Hc;break;case Ic.Color:this._type=Bc.Yc;break;case Ic.Age:case Ic.Lifetime:case Ic.Angle:case Ic.AgeGradient:this._type=Bc.Float;break;case Ic.SpriteCellEnd:case Ic.SpriteCellStart:case Ic.SpriteCellIndex:this._type=Bc.Int}this.output&&(this.output.type=this._type)}}constructor(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bc.AutoDetect;super(a),this._type=Bc.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new v.d,this._systemSource=Yc.None,this._contextualSource=Ic.None,this._type=c,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",c)}get value(){return this._storedValue}set value(a){this.type===Bc.Float&&this.min!==this.max&&(a=Math.max(this.min,a),a=Math.min(this.max,a)),this._storedValue=a,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(a){this._valueCallback=a}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Bc.Int:case Bc.Float:this.value=0;break;case Bc.Vector2:this.value=s.Vector2.Zero();break;case Bc.Hc:this.value=s.Hc.Zero();break;case Bc.Yc:this.value=new i.Yc(1,1,1,1);break;case Bc.Matrix:this.value=s.Matrix.Identity()}}_build(a){super._build(a),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=a=>a.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=a=>a.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const a=super.serialize();return a.type=this.type,a.contextualValue=this.contextualValue,a.systemSource=this.systemSource,a.min=this.min,a.max=this.max,a.groupInInspector=this.groupInInspector,a.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.hc?(a.valueType="BABYLON."+this._storedValue.getClassName(),a.value=this._storedValue.hc()):(a.valueType="number",a.value=this._storedValue)),a}_deserialize(a){if(super._deserialize(a),this._type=a.type,this.contextualValue=a.contextualValue,this.systemSource=a.systemSource||Yc.None,this.min=a.min||0,this.max=a.max||0,this.groupInInspector=a.groupInInspector||"",void 0!==a.displayInInspector&&(this.displayInInspector=a.displayInInspector),a.valueType)if("number"===a.valueType)this._storedValue=a.value;else{const c=(0,p.c)(a.valueType);c&&(this._storedValue=c.qo(a.value))}}}(0,p.d)("BABYLON.ParticleInputBlock",Qc);class zc extends Hc{get url(){return this._url}set url(a){this._url!==a&&(this._cachedData=null,this._url=a,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(a){this._textureDataUrl!==a&&(this._cachedData=null,this._textureDataUrl=a,this._url="",this._sourceTexture=null)}set sourceTexture(a){this._sourceTexture!==a&&(this._cachedData=null,this._sourceTexture=a,this._url="",this._textureDataUrl="")}constructor(a){super(a),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Bc.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const a=this.texture._storedValue;return await new Promise(((c,o)=>{if(!a.isReady())return void a.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),c(this._cachedData)}catch(a){o(a)}}));const s=a.getSize();dc.o.GetTextureDataAsync(a,s.width,s.height).then((o=>{this._cachedData={width:s.width,height:s.height,data:new Uint8ClampedArray(o)},a.dispose(),c(this._cachedData)})).catch(o)}))}_build(a){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new F.e(this._textureDataUrl,a.ao):this.texture._storedValue=new F.e(this._url,a.ao):this.texture._storedValue=null}serialize(){const a=super.serialize();return a.url=this.url,a.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(a.textureDataUrl=this.textureDataUrl),a}_deserialize(a){super._deserialize(a),this.url=a.url,this.serializedCachedData=!!a.serializedCachedData,a.textureDataUrl&&(this.textureDataUrl=a.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,p.d)("BABYLON.ParticleTextureSourceBlock",zc);class ao extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerInput("position",Bc.Hc),this.registerOutput("output",Bc.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(a){const c=this.particle.getConnectedValue(a);if(this.output._storedValue=c,!this.position.isConnected)return;const o={process:o=>{a.particleContext=o,a.systemContext=c,o.position.G(this.position.getConnectedValue(a))},previousItem:null,nextItem:null};c._updateQueueStart?Ya(o,c._updateQueueStart):c._updateQueueStart=o}}(0,p.d)("BABYLON.UpdatePositionBlock",ao),function(a){a[a.Add=0]="Add",a[a.Subtract=1]="Subtract",a[a.Multiply=2]="Multiply",a[a.Divide=3]="Divide",a[a.Max=4]="Max",a[a.Min=5]="Min"}(Pc||(Pc={}));class co extends Hc{constructor(a){super(a),this.operation=Pc.Add,this.registerInput("left",Bc.AutoDetect),this.registerInput("right",Bc.AutoDetect),this.registerOutput("output",Bc.BasedOnInput),this.output._typeConnectionSource=this.left;const c=[Bc.Matrix,Bc.Particle,Bc.Texture,Bc.System,Bc.FloatGradient,Bc.Color4Gradient,Bc.Vector2Gradient,Bc.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...c),this.right.excludedConnectionPointTypes.push(...c),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(a){let c;const o=this.left,q=this.right;if(!o.isConnected||!q.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const t=o.type===Bc.Float||o.type===Bc.Int,p=q.type===Bc.Float||q.type===Bc.Int,G=t&&p;switch(this.operation){case Pc.Add:c=G?a=>o.getConnectedValue(a)+q.getConnectedValue(a):t?a=>a.adapt(o,q.type).add(q.getConnectedValue(a)):a=>o.getConnectedValue(a).add(a.adapt(q,o.type));break;case Pc.Subtract:c=G?a=>o.getConnectedValue(a)-q.getConnectedValue(a):t?a=>a.adapt(o,q.type).vc(q.getConnectedValue(a)):a=>o.getConnectedValue(a).vc(a.adapt(q,o.type));break;case Pc.Multiply:c=G?a=>o.getConnectedValue(a)*q.getConnectedValue(a):t?a=>a.adapt(o,q.type).multiply(q.getConnectedValue(a)):a=>o.getConnectedValue(a).multiply(a.adapt(q,o.type));break;case Pc.Divide:c=G?a=>o.getConnectedValue(a)/q.getConnectedValue(a):t?a=>a.adapt(o,q.type).divide(q.getConnectedValue(a)):a=>o.getConnectedValue(a).divide(a.adapt(q,o.type));break;case Pc.Min:if(G)c=a=>Math.min(o.getConnectedValue(a),q.getConnectedValue(a));else{const[a,p]=t?[q,o]:[o,q];switch(a.type){case Bc.Vector2:c=c=>s.Vector2.Minimize(a.getConnectedValue(c),c.adapt(p,a.type));break;case Bc.Hc:c=c=>s.Hc.Minimize(a.getConnectedValue(c),c.adapt(p,a.type));break;case Bc.Yc:c=c=>{const o=a.getConnectedValue(c),{r:s,g:q,b:t,a:G}=c.adapt(p,a.type);return new i.Yc(Math.min(o.r,s),Math.min(o.g,q),Math.min(o.b,t),Math.min(o.a,G))}}}break;case Pc.Max:if(!G){const[a,p]=t?[q,o]:[o,q];switch(a.type){case Bc.Vector2:c=c=>s.Vector2.Maximize(a.getConnectedValue(c),c.adapt(p,a.type));break;case Bc.Hc:c=c=>s.Hc.Maximize(a.getConnectedValue(c),c.adapt(p,a.type));break;case Bc.Yc:c=c=>{const o=a.getConnectedValue(c),{r:s,g:q,b:t,a:G}=c.adapt(p,a.type);return new i.Yc(Math.max(o.r,s),Math.min(o.g,q),Math.min(o.b,t),Math.min(o.a,G))}}break}c=a=>Math.max(o.getConnectedValue(a),q.getConnectedValue(a))}this.output._storedFunction=a=>o.type===Bc.Int?0|c(a):c(a)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Bc.Int||this.left.type===Bc.Float&&this.right.type!==Bc.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[a,c]of[[this.left,this.right],[this.right,this.left]])a.acceptedConnectionPointTypes=[Bc.Int,Bc.Float],c.isConnected&&(a.acceptedConnectionPointTypes.push(c.type),c.type!==Bc.Int&&c.type!==Bc.Float||a.acceptedConnectionPointTypes.push(Bc.Vector2,Bc.Hc,Bc.Yc))}dispose(){super.dispose();for(const a of this._connectionObservers)a.remove();this._connectionObservers.length=0}serialize(){const a=super.serialize();return a.operation=this.operation,a}_deserialize(a){super._deserialize(a),this.operation=a.operation}}(0,d.d)([bc("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Pc.Add},{label:"Subtract",value:Pc.Subtract},{label:"Multiply",value:Pc.Multiply},{label:"Divide",value:Pc.Divide},{label:"Max",value:Pc.Max},{label:"Min",value:Pc.Min}]})],co.prototype,"operation",void 0),(0,p.d)("BABYLON.ParticleMathBlock",co);class oo extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerInput("direction1",Bc.Hc,!0,new s.Hc(0,1,0)),this.registerInput("direction2",Bc.Hc,!0,new s.Hc(0,1,0)),this.registerInput("minEmitBox",Bc.Hc,!0,new s.Hc(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Bc.Hc,!0,new s.Hc(.5,.5,.5)),this.registerOutput("output",Bc.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(a){const c=this.particle.getConnectedValue(a);c._directionCreation.process=o=>{a.particleContext=o,a.systemContext=c;const q=this.direction1.getConnectedValue(a),t=this.direction2.getConnectedValue(a),i=(0,T.RandomRange)(q.x,t.x),p=(0,T.RandomRange)(q.y,t.y),G=(0,T.RandomRange)(q.z,t.z);a.isEmitterTransformNode?s.Hc.TransformNormalFromFloatsToRef(i,p,G,a.emitterWorldMatrix,o.direction):o.direction.Bc(i,p,G)},c._positionCreation.process=o=>{a.particleContext=o,a.systemContext=c;const q=this.minEmitBox.getConnectedValue(a),t=this.maxEmitBox.getConnectedValue(a),i=(0,T.RandomRange)(q.x,t.x),p=(0,T.RandomRange)(q.y,t.y),G=(0,T.RandomRange)(q.z,t.z);a.isEmitterTransformNode?s.Hc.TransformCoordinatesFromFloatsToRef(i,p,G,a.emitterWorldMatrix,o.position):(o.position.Bc(i,p,G),o.position.addInPlace(a.emitterPosition))},this.output._storedValue=c}}(0,p.d)("BABYLON.BoxShapeBlock",oo);class so extends Hc{constructor(a){super(a),this.registerInput("emitPower",Bc.Float,!0,1),this.registerInput("lifeTime",Bc.Float,!0,1),this.registerInput("color",Bc.Yc,!0,new i.Yc(1,1,1,1)),this.registerInput("scale",Bc.Vector2,!0,new s.Vector2(1,1)),this.registerInput("angle",Bc.Float,!0,0),this.registerOutput("particle",Bc.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(a){const c=new pc(this.name,a.zp,a.ao,null,!1,void 0,!0);c.particleEmitterType=new y,c._lifeTimeCreation.process=(c,o)=>{a.particleContext=c,c.lifeTime=this.lifeTime.getConnectedValue(a),o._emitPower=this.emitPower.getConnectedValue(a)},c._colorCreation.process=c=>{a.particleContext=c,c.color.G(this.color.getConnectedValue(a))},c._sizeCreation.process=c=>{a.particleContext=c,c.size=1,c.scale.G(this.scale.getConnectedValue(a))},c._angleCreation.process=c=>{a.particleContext=c,c.angle=this.angle.getConnectedValue(a)},this.particle._storedValue=c}}(0,p.d)("BABYLON.CreateParticleBlock",so);class qo{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const a=[];for(const c of this.attachedBlocks)c.isInput&&a.push(c);return a}constructor(a){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new v.d,this.name=a}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(a){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(a)&&this.attachedBlocks.push(a);for(const o of a.inputs){const s=o.connectedPoint;if(s){const o=s.ownerBlock;o!==a&&this._initializeBlock(o,c)}}}async buildAsync(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((o=>{const s=new Zc;for(const a of this._systemBlocks)this._initializeBlock(a);for(const q of this.systemBlocks){const o=new Ac;o.buildId=this._buildId++,o.ao=a,o.verbose=c;const t=q.createSystem(o);o.emitErrors(),s.systems.push(t)}this.onBuildObservable.notifyObservers(this),o(s)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const a=new lc("Particle system"),c=new ao("Update position");c.output.connectTo(a.particle);const o=new Qc("Position");o.contextualValue=Ic.Position;const s=new Qc("Scaled direction");s.contextualValue=Ic.ScaledDirection;const q=new co("Add");q.operation=Pc.Add,o.output.connectTo(q.left),s.output.connectTo(q.right),q.output.connectTo(c.position);const t=new so("Create particle"),i=new oo("Box shape");t.particle.connectTo(i.particle),i.output.connectTo(c.particle);const p=new zc("Texture");p.texture.connectTo(a.texture),p.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(a)}removeBlock(a){const c=this.attachedBlocks.indexOf(a);if(c>-1&&this.attachedBlocks.splice(c,1),a.isSystem){const c=this._systemBlocks.indexOf(a);c>-1&&this._systemBlocks.splice(c,1)}}parseSerializedObject(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c||this.clear();const o={};for(const s of a.sj){const a=(0,p.c)(s.customType);if(a){const c=new a;c._deserialize(s),o[s.id]=c,this.attachedBlocks.push(c),c.isSystem&&this._systemBlocks.push(c)}}for(const s of this.attachedBlocks)if(s.isTeleportOut){const a=s,c=a._tempEntryPointUniqueId;if(c){const s=o[c];s&&s.attachToEndpoint(a)}}for(let s=0;s<a.sj.length;s++){const q=a.sj[s],t=o[q.id];t&&(t.inputs.length&&q.inputs.some((a=>a.targetConnectionName))&&!c||this._restoreConnections(t,a,o))}if(a.locations||a.editorData&&a.editorData.locations){const s=a.locations||a.editorData.locations;for(const a of s)o[a.Wq]&&(a.Wq=o[a.Wq].uniqueId);c&&this.editorData&&this.editorData.locations&&s.concat(this.editorData.locations),a.locations?this.editorData={locations:s}:(this.editorData=a.editorData,this.editorData.locations=s);const q=[];for(const a in o)q[a]=o[a].uniqueId;this.editorData.map=q}this.comment=a.comment}_restoreConnections(a,c,o){for(const s of a.outputs)for(const q of c.sj){const t=o[q.id];if(t)for(const i of q.inputs)if(o[i.targetBlockId]!==a||i.targetConnectionName!==s.name);else{const a=t.getInputByName(i.inputName);if(!a||a.isConnected)continue;s.connectTo(a,!0),this._restoreConnections(t,c,o)}}}serialize(a){const c=a?{}:W.d.Serialize(this);c.editorData=JSON.parse(JSON.stringify(this.editorData));let o=[];a?o=a:c.customType="BABYLON.NodeParticleSystemSet",c.sj=[];for(const s of o)c.sj.push(s.serialize());if(!a)for(const s of this.attachedBlocks)-1===o.indexOf(s)&&c.sj.push(s.serialize());return c}dispose(){for(const a of this.attachedBlocks)a.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(a){const c=new qo(a);return c.setToDefault(),c}static Parse(a){const c=W.d.Parse((()=>new qo(a.name)),a,null);return c.parseSerializedObject(a),c}static ParseFromSnippetAsync(a,c){return"_BLANK"===a?Promise.resolve(qo.CreateDefault("blank")):new Promise(((o,s)=>{const q=new hc.b;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const i=JSON.parse(JSON.parse(q.responseText).jsonPayload),p=JSON.parse(i.nodeParticle);c||(c=W.d.Parse((()=>new qo(a)),p,null)),c.parseSerializedObject(p),c.snippetId=a;try{o(c)}catch(t){s(t)}}else s("Unable to load the snippet "+a)})),q.open("GET",this.SnippetUrl+"/"+a.replace(/#/g,"/")),q.send()}))}}qo.EditorURL=`${fc.Tools._DefaultCdnUrl}/v${ba.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,qo.SnippetUrl="https://snippet.babylonjs.com",(0,d.d)([(0,X.E)()],qo.prototype,"name",void 0),(0,d.d)([(0,X.E)("comment")],qo.prototype,"comment",void 0),function(a){a[a.None=0]="None",a[a.PerParticle=1]="PerParticle",a[a.PerSystem=2]="PerSystem"}(mo||(mo={}));class to extends Hc{constructor(a){super(a),this._currentLockId=-2,this.lockMode=mo.PerParticle,this.registerInput("min",Bc.AutoDetect,!0,0),this.registerInput("max",Bc.AutoDetect,!0,1),this.registerOutput("output",Bc.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Bc.Float|Bc.Int|Bc.Vector2|Bc.Hc|Bc.Yc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Bc.Float|Bc.Int|Bc.Vector2|Bc.Hc|Bc.Yc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Bc.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let a=null;switch(this._currentLockId=-2,this.min.type){case Bc.AutoDetect:case Bc.Int:case Bc.Float:a=a=>{const c=this.min.getConnectedValue(a)||0,o=this.max.getConnectedValue(a)||1;return c+Math.random()*(o-c)};break;case Bc.Vector2:a=a=>{const c=this.min.getConnectedValue(a)||s.Vector2.Zero(),o=this.max.getConnectedValue(a)||s.Vector2.One();return new s.Vector2(c.x+Math.random()*(o.x-c.x),c.y+Math.random()*(o.y-c.y))};break;case Bc.Hc:a=a=>{const c=this.min.getConnectedValue(a)||s.Hc.Zero(),o=this.max.getConnectedValue(a)||s.Hc.One();return new s.Hc(c.x+Math.random()*(o.x-c.x),c.y+Math.random()*(o.y-c.y),c.z+Math.random()*(o.z-c.z))};break;case Bc.Yc:a=a=>{const c=this.min.getConnectedValue(a)||new i.Yc(0,0,0,0),o=this.max.getConnectedValue(a)||new i.Yc(1,1,1,1);return new i.Yc(c.x+Math.random()*(o.x-c.x),c.y+Math.random()*(o.y-c.y),c.z+Math.random()*(o.z-c.z),c.w+Math.random()*(o.w-c.w))}}this.output._storedFunction=c=>{var o;let s=0;switch(this.lockMode){case mo.PerParticle:s=(null===(o=c.particleContext)||void 0===o?void 0:o.id)||-1;break;case mo.PerSystem:s=c.buildId||0}return this._currentLockId!==s&&(this.lockMode!==mo.None&&(this._currentLockId=s),this.output._storedValue=a(c)),this.output._storedValue}}serialize(){const a=super.serialize();return a.lockMode=this.lockMode,a}_deserialize(a){super._deserialize(a),this.lockMode=a.lockMode}}(0,d.d)([bc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:mo.None},{label:"Per particle",value:mo.PerParticle},{label:"Per system",value:mo.PerSystem}]})],to.prototype,"lockMode",void 0),(0,p.d)("BABYLON.ParticleRandomBlock",to);class io extends Hc{constructor(a){super(a),this._currentLockId=-2,this.lockMode=mo.PerParticle,this.registerInput("min",Bc.AutoDetect),this.registerInput("max",Bc.AutoDetect),this.registerOutput("output",Bc.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const c=[Bc.Matrix,Bc.Particle,Bc.Texture,Bc.System,Bc.FloatGradient,Bc.Color4Gradient,Bc.Vector2Gradient,Bc.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...c),this.max.excludedConnectionPointTypes.push(...c)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let a=null;switch(this._currentLockId=-2,this.min.type){case Bc.Float:case Bc.Int:a=a=>{const c=this.min.getConnectedValue(a),o=this.max.getConnectedValue(a);return Math.random()*(o-c)+c};break;case Bc.Vector2:a=a=>{const c=this.min.getConnectedValue(a),o=this.max.getConnectedValue(a);return new s.Vector2(Math.random()*(o.x-c.x)+c.x,Math.random()*(o.y-c.y)+c.y)};break;case Bc.Hc:a=a=>{const c=this.min.getConnectedValue(a),o=this.max.getConnectedValue(a);return new s.Hc(Math.random()*(o.x-c.x)+c.x,Math.random()*(o.y-c.y)+c.y,Math.random()*(o.z-c.z)+c.z)};break;case Bc.Yc:a=a=>{const c=this.min.getConnectedValue(a),o=this.max.getConnectedValue(a);return new i.Yc(Math.random()*(o.r-c.r)+c.r,Math.random()*(o.g-c.g)+c.g,Math.random()*(o.b-c.b)+c.b,Math.random()*(o.a-c.a)+c.a)}}this.output._storedFunction=c=>{var o;let s=0;switch(this.lockMode){case mo.PerParticle:s=(null===(o=c.particleContext)||void 0===o?void 0:o.id)||-1;break;case mo.PerSystem:s=c.buildId||0}return this._currentLockId!==s&&(this.lockMode!==mo.None&&(this._currentLockId=s),this.output._storedValue=a(c)),this.output._storedValue}}serialize(){const a=super.serialize();return a.lockMode=this.lockMode,a}_deserialize(a){super._deserialize(a),void 0!==a.lockMode&&(this.lockMode=a.lockMode)}}(0,d.d)([bc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:mo.None},{label:"Per particle",value:mo.PerParticle},{label:"Per system",value:mo.PerSystem}]})],io.prototype,"lockMode",void 0),(0,p.d)("BABYLON.RandomRangeBlock",io);(0,p.d)("BABYLON.ParticleLerpBlock",class extends Hc{constructor(a){super(a),this.registerInput("left",Bc.AutoDetect),this.registerInput("right",Bc.AutoDetect),this.registerInput("gradient",Bc.Float,!0,0,0,1),this.registerOutput("output",Bc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Bc.Float|Bc.Int|Bc.Vector2|Bc.Hc|Bc.Yc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const a=(a,c,o)=>(1-a)*c+a*o;this.output._storedFunction=c=>{const o=this.left.getConnectedValue(c),q=this.right.getConnectedValue(c),t=this.gradient.getConnectedValue(c);switch(this.left.type){case Bc.Int:case Bc.Float:return a(t,o,q);case Bc.Vector2:return new s.Vector2(a(t,o.x,q.x),a(t,o.y,q.y));case Bc.Hc:return new s.Hc(a(t,o.x,q.x),a(t,o.y,q.y),a(t,o.z,q.z));case Bc.Yc:return new i.Yc(a(t,o.r,q.r),a(t,o.g,q.g),a(t,o.b,q.b),a(t,o.a,q.a))}return 0}}});(0,p.d)("BABYLON.UpdateDirectionBlock",class extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerInput("direction",Bc.Hc),this.registerOutput("output",Bc.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(a){const c=this.particle.getConnectedValue(a);if(this.output._storedValue=c,!this.direction.isConnected)return;const o={process:o=>{a.particleContext=o,a.systemContext=c,o.direction.G(this.direction.getConnectedValue(a))},previousItem:null,nextItem:null};c._updateQueueStart?Ya(o,c._updateQueueStart):c._updateQueueStart=o}});(0,p.d)("BABYLON.UpdateColorBlock",class extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerInput("color",Bc.Yc),this.registerOutput("output",Bc.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(a){const c=this.particle.getConnectedValue(a);if(this.output._storedValue=c,!this.color.isConnected)return;const o={process:o=>{a.particleContext=o,a.systemContext=c,o.color.G(this.color.getConnectedValue(a))},previousItem:null,nextItem:null};c._updateQueueStart?Ya(o,c._updateQueueStart):c._updateQueueStart=o}});(0,p.d)("BABYLON.UpdateScaleBlock",class extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerInput("scale",Bc.Vector2),this.registerOutput("output",Bc.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(a){const c=this.particle.getConnectedValue(a);if(this.output._storedValue=c,!this.scale.isConnected)return;const o={process:o=>{a.particleContext=o,a.systemContext=c,o.scale.G(this.scale.getConnectedValue(a))},previousItem:null,nextItem:null};c._updateQueueStart?Ya(o,c._updateQueueStart):c._updateQueueStart=o}});(0,p.d)("BABYLON.UpdateAngleBlock",class extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerInput("angle",Bc.Float),this.registerOutput("output",Bc.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(a){const c=this.particle.getConnectedValue(a);if(this.output._storedValue=c,!this.angle.isConnected)return;const o={process:o=>{a.particleContext=o,a.systemContext=c,o.angle=this.angle.getConnectedValue(a)},previousItem:null,nextItem:null};c._updateQueueStart?Ya(o,c._updateQueueStart):c._updateQueueStart=o}});(0,p.d)("BABYLON.BasicPositionUpdateBlock",class extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerOutput("output",Bc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(a){const c=this.particle.getConnectedValue(a),o={process:o=>{a.particleContext=o,a.systemContext=c,o.direction.scaleToRef(c._directionScale,c._scaledDirection),o.position.addInPlace(c._scaledDirection)},previousItem:null,nextItem:null};c._updateQueueStart?Ya(o,c._updateQueueStart):c._updateQueueStart=o,this.output._storedValue=c}});(0,p.d)("BABYLON.BasicSpriteUpdateBlock",class extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerOutput("output",Bc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(a){const c=this.particle.getConnectedValue(a),o={process:o=>{a.particleContext=o,a.systemContext=c,o.updateCellIndex()},previousItem:null,nextItem:null};c._updateQueueStart?Ya(o,c._updateQueueStart):c._updateQueueStart=o,this.output._storedValue=c}});(0,p.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerInput("cellIndex",Bc.Int),this.registerOutput("output",Bc.Particle),this.cellIndex.acceptedConnectionPointTypes=[Bc.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(a){const c=this.particle.getConnectedValue(a);if(this.output._storedValue=c,!this.cellIndex.isConnected)return;const o={process:o=>{a.particleContext=o,a.systemContext=c,o.cellIndex=Math.floor(this.cellIndex.getConnectedValue(a))},previousItem:null,nextItem:null};c._updateQueueStart?Ya(o,c._updateQueueStart):c._updateQueueStart=o}});class po extends Hc{constructor(a){super(a),this.strength=1,this.registerInput("particle",Bc.Particle),this.registerInput("flowMap",Bc.Texture),this.registerOutput("output",Bc.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(a){var c;const o=this.particle.getConnectedValue(a),s=a.ao;let q;(null===(c=this.flowMap.connectedPoint)||void 0===c?void 0:c.ownerBlock).extractTextureContentAsync().then((a=>{a&&(q=new Oc(a.width,a.height,a.data))}));const t={process:a=>{const c=s.getTransformMatrix();q&&q._processParticle(a,this.strength*o._tempScaledUpdateSpeed,c)},previousItem:null,nextItem:null};o._updateQueueStart?Ya(t,o._updateQueueStart):o._updateQueueStart=t,this.output._storedValue=o}serialize(){const a=super.serialize();return a.strength=this.strength,a}_deserialize(a){super._deserialize(a),this.strength=a.strength}}(0,d.d)([bc("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],po.prototype,"strength",void 0),(0,p.d)("BABYLON.UpdateFlowMapBlock",po);(0,p.d)("BABYLON.SphereShapeBlock",class extends Hc{constructor(a){super(a),this.registerInput("input",Bc.Particle),this.registerInput("radius",Bc.Float,!0,1),this.registerInput("radiusRange",Bc.Float,!0,1,0,1),this.registerInput("directionRandomizer",Bc.Float,!0,0,0,1),this.registerOutput("output",Bc.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(a){const c=this.input.getConnectedValue(a);c._directionCreation.process=o=>{a.particleContext=o,a.systemContext=c;const q=this.directionRandomizer.getConnectedValue(a),t=o.position.vc(a.emitterPosition).normalize(),i=(0,T.RandomRange)(0,q),p=(0,T.RandomRange)(0,q),G=(0,T.RandomRange)(0,q);t.x+=i,t.y+=p,t.z+=G,t.normalize(),a.isEmitterTransformNode?s.Hc.TransformNormalFromFloatsToRef(i,p,G,a.emitterWorldMatrix,o.direction):o.direction.Bc(i,p,G)},c._positionCreation.process=o=>{a.particleContext=o,a.systemContext=c;const q=this.radius.getConnectedValue(a),t=this.radiusRange.getConnectedValue(a),i=q-(0,T.RandomRange)(0,q*t),p=(0,T.RandomRange)(0,1),G=(0,T.RandomRange)(0,2*Math.PI),C=Math.acos(2*p-1),j=i*Math.cos(G)*Math.sin(C),L=i*Math.cos(C),e=i*Math.sin(G)*Math.sin(C);a.isEmitterTransformNode?s.Hc.TransformCoordinatesFromFloatsToRef(j,L,e,a.emitterWorldMatrix,o.position):(o.position.Bc(j,L,e),o.position.addInPlace(a.emitterPosition))},this.output._storedValue=c}});(0,p.d)("BABYLON.PointShapeBlock",class extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerInput("direction1",Bc.Hc,!0,new s.Hc(0,1,0)),this.registerInput("direction2",Bc.Hc,!0,new s.Hc(0,1,0)),this.registerOutput("output",Bc.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(a){const c=this.particle.getConnectedValue(a);c._directionCreation.process=o=>{a.particleContext=o,a.systemContext=c;const q=this.direction1.getConnectedValue(a),t=this.direction2.getConnectedValue(a),i=(0,T.RandomRange)(q.x,t.x),p=(0,T.RandomRange)(q.y,t.y),G=(0,T.RandomRange)(q.z,t.z);a.isEmitterTransformNode?s.Hc.TransformNormalFromFloatsToRef(i,p,G,a.emitterWorldMatrix,o.direction):o.direction.Bc(i,p,G)},c._positionCreation.process=o=>{a.systemContext=c,a.isEmitterTransformNode?s.Hc.TransformCoordinatesFromFloatsToRef(0,0,0,a.emitterWorldMatrix,o.position):o.position.G(a.emitterPosition)},this.output._storedValue=c}});(0,p.d)("BABYLON.CustomShapeBlock",class extends Hc{constructor(a){super(a),this.registerInput("particle",Bc.Particle),this.registerInput("position",Bc.Hc,!0,new s.Hc(0,0,0)),this.registerInput("direction",Bc.Hc,!0,new s.Hc(0,1,0)),this.registerOutput("output",Bc.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(a){const c=this.particle.getConnectedValue(a);c._directionCreation.process=o=>{a.particleContext=o,a.systemContext=c;const q=this.direction.getConnectedValue(a);a.isEmitterTransformNode?s.Hc.TransformNormalToRef(q,a.emitterWorldMatrix,o.direction):o.direction.G(q)},c._positionCreation.process=o=>{a.particleContext=o,a.systemContext=c;const q=this.position.getConnectedValue(a);a.isEmitterTransformNode?s.Hc.TransformCoordinatesToRef(q,a.emitterWorldMatrix,o.position):(o.position.G(q),o.position.addInPlace(a.emitterPosition))},this.output._storedValue=c}});(0,p.d)("BABYLON.CylinderShapeBlock",class extends Hc{constructor(a){super(a),this._tempVector=s.Hc.Zero(),this.registerInput("particle",Bc.Particle),this.registerInput("radius",Bc.Float,!0,1),this.registerInput("height",Bc.Float,!0,1,0),this.registerInput("radiusRange",Bc.Float,!0,1,0,1),this.registerInput("directionRandomizer",Bc.Float,!0,0,0,1),this.registerOutput("output",Bc.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(a){const c=this.particle.getConnectedValue(a);c._directionCreation.process=o=>{a.particleContext=o,a.systemContext=c;const q=this.directionRandomizer.getConnectedValue(a);o.position.subtractToRef(a.emitterPosition,this._tempVector),this._tempVector.normalize(),a.isEmitterTransformNode&&s.Hc.TransformNormalToRef(this._tempVector,a.emitterInverseWorldMatrix,this._tempVector);const t=(0,T.RandomRange)(-q/2,q/2);let i=Math.atan2(this._tempVector.x,this._tempVector.z);i+=(0,T.RandomRange)(-Math.PI/2,Math.PI/2)*q,this._tempVector.y=t,this._tempVector.x=Math.sin(i),this._tempVector.z=Math.cos(i),this._tempVector.normalize(),a.isEmitterTransformNode?s.Hc.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,a.emitterWorldMatrix,o.direction):o.direction.G(this._tempVector)},c._positionCreation.process=o=>{a.particleContext=o,a.systemContext=c;const q=this.height.getConnectedValue(a),t=this.radiusRange.getConnectedValue(a),i=this.radius.getConnectedValue(a),p=(0,T.RandomRange)(-q/2,q/2),G=(0,T.RandomRange)(0,2*Math.PI),C=(0,T.RandomRange)((1-t)*(1-t),1),j=Math.sqrt(C)*i,L=j*Math.cos(G),e=j*Math.sin(G);a.isEmitterTransformNode?s.Hc.TransformCoordinatesFromFloatsToRef(L,p,e,a.emitterWorldMatrix,o.position):(o.position.Bc(L,p,e),o.position.addInPlace(a.emitterPosition))},this.output._storedValue=c}});class Go extends Hc{constructor(a){super(a),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Bc.Particle),this.registerOutput("output",Bc.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(a){super._build(a);const c=this.particle.getConnectedValue(a);c._isAnimationSheetEnabled=!0,c.spriteCellWidth=this.width,c.spriteCellHeight=this.height,c.startSpriteCellID=this.start,c.endSpriteCellID=this.end,c.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=c}serialize(){const a=super.serialize();return a.width=this.width,a.height=this.height,a.start=this.start,a.end=this.end,a.randomStartCell=this.randomStartCell,a}_deserialize(a){super._deserialize(a),this.width=a.width,this.height=a.height,this.start=a.start,this.end=a.end,this.randomStartCell=a.randomStartCell}}(0,d.d)([bc("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Go.prototype,"start",void 0),(0,d.d)([bc("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Go.prototype,"end",void 0),(0,d.d)([bc("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Go.prototype,"width",void 0),(0,d.d)([bc("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Go.prototype,"height",void 0),(0,d.d)([bc("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Go.prototype,"loop",void 0),(0,d.d)([bc("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Go.prototype,"randomStartCell",void 0),(0,p.d)("BABYLON.SetupSpriteSheetBlock",Go);class To extends Hc{constructor(a){super(a),this.reference=0,this.registerInput("value",Bc.AutoDetect),this.registerOutput("output",Bc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=a=>{switch(a){case Bc.Float:return Bc.FloatGradient;case Bc.Vector2:return Bc.Vector2Gradient;case Bc.Hc:return Bc.Vector3Gradient;case Bc.Yc:return Bc.Color4Gradient}return a},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Bc.Float|Bc.Vector2|Bc.Hc|Bc.Yc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=a=>null}serialize(){const a=super.serialize();return a.reference=this.reference,a}_deserialize(a){super._deserialize(a),this.reference=a.reference}}(0,d.d)([bc("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],To.prototype,"reference",void 0),(0,p.d)("BABYLON.ParticleGradientValueBlock",To);(0,p.d)("BABYLON.ParticleGradientBlock",class extends Hc{constructor(a){super(a),this._entryCount=1,this.registerInput("gradient",Bc.Float,!0,1,0,1),this.registerInput("value0",Bc.AutoDetect),this.registerOutput("output",Bc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=a=>{switch(a){case Bc.FloatGradient:return Bc.Float;case Bc.Vector2Gradient:return Bc.Vector2;case Bc.Vector3Gradient:return Bc.Hc;case Bc.Color4Gradient:return Bc.Yc}return a},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Bc.FloatGradient|Bc.Vector2Gradient|Bc.Vector3Gradient|Bc.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(a){this._inputs[a].onConnectionObservable.add((()=>{this._entryCount>a||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Bc.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const a=[];for(let o=1;o<this._inputs.length;o++){var c;if(this._inputs[o].isConnected)a.push(null===(c=this._inputs[o].connectedPoint)||void 0===c?void 0:c.ownerBlock)}a.sort(((a,c)=>a.reference-c.reference)),this.output._storedFunction=c=>{const o=this.gradient.getConnectedValue(c);if(1===a.length)return a[0].value.getConnectedValue(c);let q=null;for(let t=a.length-1;t>=0;t--){const p=a[t];if(p.reference<=o){const a=p.value.getConnectedValue(c);if(q){const t=q.value.getConnectedValue(c),G=q.reference,C=p.reference,j=Math.max(0,Math.min(1,(o-C)/(G-C)));switch(this.output.type){case Bc.Float:return(0,T.Lerp)(a,t,j);case Bc.Vector2:return s.Vector2.Lerp(a,t,j);case Bc.Hc:return s.Hc.Lerp(a,t,j);case Bc.Yc:return i.Yc.Lerp(a,t,j)}}return a}q=p}return 0}}});(0,p.d)("BABYLON.ParticleConverterBlock",class extends Hc{constructor(a){super(a),this.registerInput("color ",Bc.Yc,!0),this.registerInput("xyz ",Bc.Hc,!0),this.registerInput("xy ",Bc.Vector2,!0),this.registerInput("zw ",Bc.Vector2,!0),this.registerInput("x ",Bc.Float,!0),this.registerInput("y ",Bc.Float,!0),this.registerInput("z ",Bc.Float,!0),this.registerInput("w ",Bc.Float,!0),this.registerOutput("color",Bc.Yc),this.registerOutput("xyz",Bc.Hc),this.registerOutput("xy",Bc.Vector2),this.registerOutput("zw",Bc.Vector2),this.registerOutput("x",Bc.Float),this.registerOutput("y",Bc.Float),this.registerOutput("z",Bc.Float),this.registerOutput("w",Bc.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(a){return"color "===a?"colorIn":"xyz "===a?"xyzIn":"xy "===a?"xyIn":"zw "===a?"zwIn":"x "===a?"xIn":"y "===a?"yIn":"z "===a?"zIn":"w "===a?"wIn":a}_outputRename(a){switch(a){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return a}}_build(a){super._build(a);const c=this.xIn,o=this.yIn,q=this.zIn,t=this.wIn,p=this.xyIn,G=this.zwIn,T=this.xyzIn,C=this.colorIn,j=this.colorOut,L=this.xyzOut,e=this.xyOut,g=this.zwOut,M=this.xOut,N=this.yOut,y=this.zOut,k=this.wOut,n=a=>{if(C.isConnected)return C.getConnectedValue(a);let s=0,j=0,L=0,e=0;if(c.isConnected&&(s=c.getConnectedValue(a)),o.isConnected&&(j=o.getConnectedValue(a)),q.isConnected&&(L=q.getConnectedValue(a)),t.isConnected&&(e=t.getConnectedValue(a)),p.isConnected){const c=p.getConnectedValue(a);c&&(s=c.x,j=c.y)}if(G.isConnected){const c=G.getConnectedValue(a);c&&(L=c.x,e=c.y)}if(T.isConnected){const c=T.getConnectedValue(a);c&&(s=c.x,j=c.y,L=c.z)}return new i.Yc(s,j,L,e)};j._storedFunction=a=>n(a),L._storedFunction=a=>{const c=n(a);return new s.Hc(c.r,c.g,c.b)},e._storedFunction=a=>{const c=n(a);return new s.Vector2(c.r,c.g)},g._storedFunction=a=>{const c=n(a);return new s.Vector2(c.b,c.a)},M._storedFunction=a=>n(a).r,N._storedFunction=a=>n(a).g,y._storedFunction=a=>n(a).b,k._storedFunction=a=>n(a).a}}),function(a){a[a.Cos=0]="Cos",a[a.Sin=1]="Sin",a[a.Abs=2]="Abs",a[a.Exp=3]="Exp",a[a.Exp2=4]="Exp2",a[a.Round=5]="Round",a[a.Floor=6]="Floor",a[a.Ceiling=7]="Ceiling",a[a.Sqrt=8]="Sqrt",a[a.Log=9]="Log",a[a.Tan=10]="Tan",a[a.ArcTan=11]="ArcTan",a[a.ArcCos=12]="ArcCos",a[a.ArcSin=13]="ArcSin",a[a.Sign=14]="Sign",a[a.Negate=15]="Negate",a[a.OneMinus=16]="OneMinus",a[a.Reciprocal=17]="Reciprocal",a[a.ToDegrees=18]="ToDegrees",a[a.ToRadians=19]="ToRadians",a[a.Fract=20]="Fract"}(Vc||(Vc={}));class Co extends Hc{constructor(a){super(a),this.operation=Vc.Cos,this.registerInput("input",Bc.AutoDetect),this.registerOutput("output",Bc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Bc.Float|Bc.Int|Bc.Vector2|Bc.Hc|Bc.Yc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(a){super._build(a);let c=null;switch(this.operation){case Vc.Cos:c=a=>Math.cos(a);break;case Vc.Sin:c=a=>Math.sin(a);break;case Vc.Abs:c=a=>Math.abs(a);break;case Vc.Exp:c=a=>Math.exp(a);break;case Vc.Exp2:c=a=>Math.pow(2,a);break;case Vc.Round:c=a=>Math.round(a);break;case Vc.Floor:c=a=>Math.floor(a);break;case Vc.Ceiling:c=a=>Math.ceil(a);break;case Vc.Sqrt:c=a=>Math.sqrt(a);break;case Vc.Log:c=a=>Math.log(a);break;case Vc.Tan:c=a=>Math.tan(a);break;case Vc.ArcTan:c=a=>Math.atan(a);break;case Vc.ArcCos:c=a=>Math.acos(a);break;case Vc.ArcSin:c=a=>Math.asin(a);break;case Vc.Sign:c=a=>Math.sign(a);break;case Vc.Negate:c=a=>-a;break;case Vc.OneMinus:c=a=>1-a;break;case Vc.Reciprocal:c=a=>1/a;break;case Vc.ToRadians:c=a=>a*Math.PI/180;break;case Vc.ToDegrees:c=a=>180*a/Math.PI;break;case Vc.Fract:c=a=>a>=0?a-Math.floor(a):a-Math.ceil(a)}if(!c)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Bc.Int:case Bc.Float:this.output._storedFunction=a=>{const o=this.input.getConnectedValue(a);return c(o)};break;case Bc.Vector2:this.output._storedFunction=a=>{const o=this.input.getConnectedValue(a);return new s.Vector2(c(o.x),c(o.y))};break;case Bc.Hc:this.output._storedFunction=a=>{const o=this.input.getConnectedValue(a);return new s.Hc(c(o.x),c(o.y),c(o.z))};break;case Bc.Yc:this.output._storedFunction=a=>{const o=this.input.getConnectedValue(a);return new i.Yc(c(o.r),c(o.g),c(o.b),c(o.a))}}return this}serialize(){const a=super.serialize();return a.operation=this.operation,a}_deserialize(a){super._deserialize(a),this.operation=a.operation}}(0,d.d)([bc("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Vc.Cos},{label:"Sin",value:Vc.Sin},{label:"Abs",value:Vc.Abs},{label:"Exp",value:Vc.Exp},{label:"Exp2",value:Vc.Exp2},{label:"Round",value:Vc.Round},{label:"Floor",value:Vc.Floor},{label:"Ceiling",value:Vc.Ceiling},{label:"Sqrt",value:Vc.Sqrt},{label:"Log",value:Vc.Log},{label:"Tan",value:Vc.Tan},{label:"ArcTan",value:Vc.ArcTan},{label:"ArcCos",value:Vc.ArcCos},{label:"ArcSin",value:Vc.ArcSin},{label:"Sign",value:Vc.Sign},{label:"Negate",value:Vc.Negate},{label:"OneMinus",value:Vc.OneMinus},{label:"Reciprocal",value:Vc.Reciprocal},{label:"ToDegrees",value:Vc.ToDegrees},{label:"ToRadians",value:Vc.ToRadians},{label:"Fract",value:Vc.Fract}]})],Co.prototype,"operation",void 0),(0,p.d)("BABYLON.ParticleTrigonometryBlock",Co);var jo,Lo=o(14068);class eo extends Hc{constructor(a){super(a),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Bc.AutoDetect),this.registerOutput("output",Bc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Bc.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Bc.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Bc.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Bc.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Bc.System),this._inputs[0].excludedConnectionPointTypes.push(Bc.Particle),this._inputs[0].excludedConnectionPointTypes.push(Bc.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(a){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const c=a=>{const c=this.input.getConnectedValue(a);if(this.log.length>=this.stackSize)return c;if(null===c||void 0===c)return this.log.push(["null",""]),c;switch(this.input.type){case Bc.Vector2:this.log.push([(0,Lo.h)(c,4),c.toString()]);break;case Bc.Hc:this.log.push([(0,Lo.j)(c,4),c.toString()]);break;case Bc.Yc:this.log.push([`{R: ${c.r.toFixed(4)} G: ${c.g.toFixed(4)} B: ${c.b.toFixed(4)} A: ${c.a.toFixed(4)}}`,c.toString()]);break;default:this.log.push([c.toString(),c.toString()])}return c};this.output.isConnected?this.output._storedFunction=c:this.output._storedValue=c(a)}serialize(){const a=super.serialize();return a.stackSize=this.stackSize,a}_deserialize(a){super._deserialize(a),this.stackSize=a.stackSize}}(0,d.d)([bc("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],eo.prototype,"stackSize",void 0),(0,p.d)("BABYLON.ParticleDebugBlock",eo);(0,p.d)("BABYLON.ParticleElbowBlock",class extends Hc{constructor(a){super(a),this.registerInput("input",Bc.AutoDetect),this.registerOutput("output",Bc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(a){super._build(a);const c=this._outputs[0],o=this._inputs[0];c._storedFunction=a=>o.getConnectedValue(a)}});(0,p.d)("BABYLON.ParticleTeleportInBlock",class extends Hc{get endpoints(){return this._endpoints}constructor(a){super(a),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Bc.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(a){if(this.getClassName()===a)return!0;for(const c of this.endpoints)if(c.isAnAncestorOfType(a))return!0;return!1}isAnAncestorOf(a){for(const c of this.endpoints){if(c===a)return!0;if(c.isAnAncestorOf(a))return!0}return!1}attachToEndpoint(a){a.detach(),this._endpoints.push(a),a._entryPoint=this,a._outputs[0]._typeConnectionSource=this._inputs[0],a._tempEntryPointUniqueId=null,a.name="> "+this.name}detachFromEndpoint(a){const c=this._endpoints.indexOf(a);-1!==c&&(this._endpoints.splice(c,1),a._outputs[0]._typeConnectionSource=null,a._entryPoint=null)}_build(){for(const a of this._endpoints)a.output._storedFunction=a=>this.input.getConnectedValue(a)}});(0,p.d)("BABYLON.ParticleTeleportOutBlock",class extends Hc{constructor(a){super(a),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Bc.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(a){this.entryPoint&&this.entryPoint.build(a)}clone(){const a=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(a),a}serialize(){var a;const c=super.serialize();return c.entryPoint=(null===(a=this.entryPoint)||void 0===a?void 0:a.uniqueId)??"",c}_deserialize(a){super._deserialize(a),this._tempEntryPointUniqueId=a.entryPoint}}),function(a){a[a.Equal=0]="Equal",a[a.NotEqual=1]="NotEqual",a[a.LessThan=2]="LessThan",a[a.GreaterThan=3]="GreaterThan",a[a.LessOrEqual=4]="LessOrEqual",a[a.GreaterOrEqual=5]="GreaterOrEqual",a[a.Xor=6]="Xor",a[a.Or=7]="Or",a[a.And=8]="And"}(jo||(jo={}));class go extends Hc{constructor(a){super(a),this.test=jo.Equal,this.epsilon=0,this.registerInput("left",Bc.Float),this.registerInput("right",Bc.Float,!0,0),this.registerInput("ifTrue",Bc.AutoDetect,!0,1),this.registerInput("ifFalse",Bc.AutoDetect,!0,0),this.registerOutput("output",Bc.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Bc.Float,this._inputs[0].acceptedConnectionPointTypes.push(Bc.Int),this._inputs[1].acceptedConnectionPointTypes.push(Bc.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const a=a=>{const c=this.left.getConnectedValue(a),o=this.right.getConnectedValue(a);let s=!1;switch(this.test){case jo.Equal:s=(0,T.WithinEpsilon)(c,o,this.epsilon);break;case jo.NotEqual:s=!(0,T.WithinEpsilon)(c,o,this.epsilon);break;case jo.LessThan:s=c<o+this.epsilon;break;case jo.GreaterThan:s=c>o-this.epsilon;break;case jo.LessOrEqual:s=c<=o+this.epsilon;break;case jo.GreaterOrEqual:s=c>=o-this.epsilon;break;case jo.Xor:s=!!c&&!o||!c&&!!o;break;case jo.Or:s=!!c||!!o;break;case jo.And:s=!!c&&!!o}return s};this.output._storedFunction=c=>a(c)?this.ifTrue.getConnectedValue(c):this.ifFalse.getConnectedValue(c)}serialize(){const a=super.serialize();return a.test=this.test,a.epsilon=this.epsilon,a}_deserialize(a){super._deserialize(a),this.test=a.test,void 0!==a.epsilon&&(this.epsilon=a.epsilon)}}(0,d.d)([bc("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:jo.Equal},{label:"NotEqual",value:jo.NotEqual},{label:"LessThan",value:jo.LessThan},{label:"GreaterThan",value:jo.GreaterThan},{label:"LessOrEqual",value:jo.LessOrEqual},{label:"GreaterOrEqual",value:jo.GreaterOrEqual},{label:"Xor",value:jo.Xor},{label:"Or",value:jo.Or},{label:"And",value:jo.And}]})],go.prototype,"test",void 0),(0,d.d)([bc("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],go.prototype,"epsilon",void 0),(0,p.d)("BABYLON.ParticleConditionBlock",go);class Mo extends Hc{constructor(a){super(a),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Bc.Particle),this.registerInput("condition",Bc.Float,!0,0),this.registerInput("system",Bc.System),this.registerOutput("output",Bc.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(a){this._triggerCount=0;const c=this.input.getConnectedValue(a),o={process:o=>{if(a.particleContext=o,a.systemContext=c,0!==this.condition.getConnectedValue(a)&&(0===this.limit||this._triggerCount<this.limit)){const s=(new Date).getTime();if(this._previousOne&&s-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=s;const q=this.system.getConnectedValue(a);if(q){const s=vc(q,a.ao,o.position);s.gc.addOnce((()=>{this._triggerCount--})),c.gc.addOnce((()=>{s.dispose()}))}}},previousItem:null,nextItem:null};c._updateQueueStart?Ya(o,c._updateQueueStart):c._updateQueueStart=o,this.output._storedValue=c}serialize(){const a=super.serialize();return a.limit=this.limit,a.delay=this.delay,a}_deserialize(a){super._deserialize(a),void 0!==a.limit&&(this.limit=a.limit),void 0!==a.delay&&(this.delay=a.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,d.d)([bc("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Mo.prototype,"limit",void 0),(0,d.d)([bc("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Mo.prototype,"delay",void 0),(0,p.d)("BABYLON.ParticleTriggerBlock",Mo);o(14073),o(14090),o(14097),o(14150)},14134:(a,c,o)=>{"use strict";var s=o(12732);const q="clipPlaneFragment",t="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14105:(a,c,o)=>{"use strict";var s=o(12732);const q="clipPlaneFragmentDeclaration",t="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14173:(a,c,o)=>{"use strict";var s=o(12732);const q="clipPlaneVertex",t="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14156:(a,c,o)=>{"use strict";var s=o(12732);const q="clipPlaneVertexDeclaration",t="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14143:(a,c,o)=>{"use strict";var s=o(12732);const q="fogFragment",t="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14127:(a,c,o)=>{"use strict";var s=o(12732);const q="fogFragmentDeclaration",t="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14181:(a,c,o)=>{"use strict";var s=o(12732);const q="fogVertex",t="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14165:(a,c,o)=>{"use strict";var s=o(12732);const q="fogVertexDeclaration",t="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14118:(a,c,o)=>{"use strict";var s=o(12732);const q="helperFunctions",t="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14107:(a,c,o)=>{"use strict";var s=o(12732);const q="imageProcessingDeclaration",t="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14121:(a,c,o)=>{"use strict";var s=o(12732);const q="imageProcessingFunctions",t="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14114:(a,c,o)=>{"use strict";var s=o(12732);const q="logDepthDeclaration",t="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14140:(a,c,o)=>{"use strict";var s=o(12732);const q="logDepthFragment",t="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14185:(a,c,o)=>{"use strict";var s=o(12732);const q="logDepthVertex",t="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";s.c.IncludesShadersStoreWGSL[q]||(s.c.IncludesShadersStoreWGSL[q]=t)},14097:(a,c,o)=>{"use strict";o.r(c),o.d(c,{particlesPixelShaderWGSL:()=>i});var s=o(12732);o(14105),o(14107),o(14114),o(14118),o(14121),o(14127),o(14134),o(14140),o(14143);const q="particlesPixelShader",t="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";s.c.ShadersStoreWGSL[q]||(s.c.ShadersStoreWGSL[q]=t);const i={name:q,shader:t}},14150:(a,c,o)=>{"use strict";o.r(c),o.d(c,{particlesVertexShaderWGSL:()=>i});var s=o(12732);o(14156),o(14165),o(14114),o(14173),o(14181),o(14185);const q="particlesVertexShader",t="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";s.c.ShadersStoreWGSL[q]||(s.c.ShadersStoreWGSL[q]=t);const i={name:q,shader:t}},14003:(a,c,o)=>{"use strict";var s=o(12732);const q="clipPlaneFragment",t="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},14082:(a,c,o)=>{"use strict";var s=o(12732);const q="clipPlaneFragmentDeclaration",t="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},14026:(a,c,o)=>{"use strict";var s=o(12732);const q="clipPlaneVertex",t="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},14094:(a,c,o)=>{"use strict";var s=o(12732);const q="clipPlaneVertexDeclaration",t="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},14015:(a,c,o)=>{"use strict";var s=o(12732);const q="fogFragment",t="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},14001:(a,c,o)=>{"use strict";var s=o(12732);const q="fogFragmentDeclaration",t="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},14032:(a,c,o)=>{"use strict";var s=o(12732);const q="fogVertex",t="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},14023:(a,c,o)=>{"use strict";var s=o(12732);const q="fogVertexDeclaration",t="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},13986:(a,c,o)=>{"use strict";var s=o(12732);const q="helperFunctions",t="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},13968:(a,c,o)=>{"use strict";var s=o(12732);const q="imageProcessingDeclaration",t="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},13995:(a,c,o)=>{"use strict";var s=o(12732);const q="imageProcessingFunctions",t="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},13977:(a,c,o)=>{"use strict";var s=o(12732);const q="logDepthDeclaration",t="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},14006:(a,c,o)=>{"use strict";var s=o(12732);const q="logDepthFragment",t="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},14041:(a,c,o)=>{"use strict";var s=o(12732);const q="logDepthVertex",t="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";s.c.IncludesShadersStore[q]||(s.c.IncludesShadersStore[q]=t)},14073:(a,c,o)=>{"use strict";o.r(c),o.d(c,{particlesPixelShader:()=>i});var s=o(12732);o(14082),o(13968),o(13977),o(13986),o(13995),o(14001),o(14003),o(14006),o(14015);const q="particlesPixelShader",t="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";s.c.ShadersStore[q]||(s.c.ShadersStore[q]=t);const i={name:q,shader:t}},14090:(a,c,o)=>{"use strict";o.r(c),o.d(c,{particlesVertexShader:()=>i});var s=o(12732);o(14094),o(14023),o(13977),o(14026),o(14032),o(14041);const q="particlesVertexShader",t="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";s.c.ShadersStore[q]||(s.c.ShadersStore[q]=t);const i={name:q,shader:t}},14449:(a,c,o)=>{"use strict";o.r(c),o.d(c,{FlowGraphGLTFDataProvider:()=>t});var s=o(14423),q=o(14394);class t extends s.e{constructor(a){var c,o;super();const s=a.glTF,t=(null===(c=s.animations)||void 0===c?void 0:c.map((a=>a._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",q.c,t);const i=(null===(o=s.nodes)||void 0===o?void 0:o.map((a=>a._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",q.c,i)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14344:(a,c,o)=>{"use strict";o.d(c,{e:()=>N,f:()=>g,j:()=>e,n:()=>M});var s=o(12810),q=o(13269),t=o(12858),i=o(14347);const p=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class G{constructor(a,c){this._gltf=a,this._infoTree=c}convert(a){let c,o=this._gltf,s=this._infoTree;if(!a.startsWith("/"))throw new Error("Path must start with a /");const q=a.split("/");if(q.shift(),q[q.length-1].includes(".length")){const a=q[q.length-1].split(".");q.pop(),q.push(...a)}let t=!1;for(const G of q){const q="length"===G;if(q&&!s.__array__)throw new Error(`Path ${a} is invalid`);if(s.__ignoreObjectTree__&&(t=!0),s.__array__&&!q)s=s.__array__;else if(s=s[G],!s)throw new Error(`Path ${a} is invalid`);if(!t)if(void 0===o){if(!p.find((c=>c.regex.test(a))))throw new Error(`Path ${a} is invalid`)}else if(!q){var i;o=null===(i=o)||void 0===i?void 0:i[G]}(s.__target__||q)&&(c=o)}return{object:c,info:s}}}function T(a,c,o,s){const q=C(a,c);return s?q[o][s]:q[o]}function C(a,c,o){var s,t;return null===(s=a._data)||void 0===s||null===(t=s[(null===o||void 0===o?void 0:o.fillMode)??q.e.MATERIAL_TriangleFillMode])||void 0===t?void 0:t.babylonMaterial}function j(a,c){return{offset:{componentsCount:2,type:"Vector2",get:(o,q,t)=>{const i=T(o,t,a,c);return new s.Vector2(null===i||void 0===i?void 0:i.uOffset,null===i||void 0===i?void 0:i.vOffset)},getTarget:C,set:(o,s,q,t)=>{const i=T(s,t,a,c);i.uOffset=o.x,i.vOffset=o.y},getPropertyName:[()=>`${a}${c?"."+c:""}.uOffset`,()=>`${a}${c?"."+c:""}.vOffset`]},rotation:{type:"number",get:(o,s,q)=>{var t;return null===(t=T(o,q,a,c))||void 0===t?void 0:t.wAng},getTarget:C,set:(o,s,q,t)=>T(s,t,a,c).wAng=o,getPropertyName:[()=>`${a}${c?"."+c:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(o,q,t)=>{const i=T(o,t,a,c);return new s.Vector2(null===i||void 0===i?void 0:i.uScale,null===i||void 0===i?void 0:i.vScale)},getTarget:C,set:(o,s,q,t)=>{const i=T(s,t,a,c);i.uScale=o.x,i.vScale=o.y},getPropertyName:[()=>`${a}${c?"."+c:""}.uScale`,()=>`${a}${c?"."+c:""}.vScale`]}}}const L={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:a=>{var c,o;return new s.Vector2((null===(c=a._babylonCamera)||void 0===c?void 0:c.orthoLeft)??0,(null===(o=a._babylonCamera)||void 0===o?void 0:o.orthoRight)??0)},set:(a,c)=>{c._babylonCamera&&(c._babylonCamera.orthoLeft=a.x,c._babylonCamera.orthoRight=a.y)},getTarget:a=>a,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:a=>{var c,o;return new s.Vector2((null===(c=a._babylonCamera)||void 0===c?void 0:c.orthoBottom)??0,(null===(o=a._babylonCamera)||void 0===o?void 0:o.orthoTop)??0)},set:(a,c)=>{c._babylonCamera&&(c._babylonCamera.orthoBottom=a.x,c._babylonCamera.orthoTop=a.y)},getTarget:a=>a,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:a=>{var c;return null===(c=a._babylonCamera)||void 0===c?void 0:c.maxZ},set:(a,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=a)},getTarget:a=>a,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:a=>{var c;return null===(c=a._babylonCamera)||void 0===c?void 0:c.rc},set:(a,c)=>{c._babylonCamera&&(c._babylonCamera.rc=a)},getTarget:a=>a,getPropertyName:[()=>"rc"]}},perspective:{aspectRatio:{type:"number",get:a=>{var c;return null===(c=a._babylonCamera)||void 0===c?void 0:c.getEngine().getAspectRatio(a._babylonCamera)},getTarget:a=>a,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:a=>{var c;return null===(c=a._babylonCamera)||void 0===c?void 0:c.fov},set:(a,c)=>{c._babylonCamera&&(c._babylonCamera.fov=a)},getTarget:a=>a,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:a=>{var c;return null===(c=a._babylonCamera)||void 0===c?void 0:c.maxZ},set:(a,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=a)},getTarget:a=>a,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:a=>{var c;return null===(c=a._babylonCamera)||void 0===c?void 0:c.rc},set:(a,c)=>{c._babylonCamera&&(c._babylonCamera.rc=a)},getTarget:a=>a,getPropertyName:[()=>"rc"]}}}},nodes:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>a._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Hc",get:a=>{var c;return null===(c=a._babylonTransformNode)||void 0===c?void 0:c.position},set:(a,c)=>{var o;return null===(o=c._babylonTransformNode)||void 0===o?void 0:o.position.G(a)},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:a=>{var c;return null===(c=a._babylonTransformNode)||void 0===c?void 0:c.rotationQuaternion},set:(a,c)=>{var o,s;return null===(o=c._babylonTransformNode)||void 0===o||null===(s=o.rotationQuaternion)||void 0===s?void 0:s.G(a)},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Hc",get:a=>{var c;return null===(c=a._babylonTransformNode)||void 0===c?void 0:c.uc},set:(a,c)=>{var o;return null===(o=c._babylonTransformNode)||void 0===o?void 0:o.uc.G(a)},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"uc"]},weights:{length:{type:"number",get:a=>a._numMorphTargets,getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(a,c)=>{var o,s;return void 0!==c?null===(o=a._primitiveBabylonMeshes)||void 0===o||null===(s=o[0].morphTargetManager)||void 0===s?void 0:s.getTarget(c).influence:void 0},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(a,c)=>[0],getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:a=>{var c,o,q;return s.Matrix.Compose(null===(c=a._babylonTransformNode)||void 0===c?void 0:c.uc,null===(o=a._babylonTransformNode)||void 0===o?void 0:o.rotationQuaternion,null===(q=a._babylonTransformNode)||void 0===q?void 0:q.position)},getTarget:a=>a._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:a=>{var c,o,q,t;const i=s.Matrix.Identity();let p=a.parent;for(;p&&p.parent;)p=p.parent;const G=(null===(c=a._babylonTransformNode)||void 0===c?void 0:c.position._isDirty)||(null===(o=a._babylonTransformNode)||void 0===o||null===(q=o.rotationQuaternion)||void 0===q?void 0:q._isDirty)||(null===(t=a._babylonTransformNode)||void 0===t?void 0:t.uc._isDirty);if(p){var T;const c=null===(T=p._babylonTransformNode)||void 0===T?void 0:T.Rc(!0).invert();var C,j;if(c)null===(C=a._babylonTransformNode)||void 0===C||null===(j=C.Rc(G))||void 0===j||j.multiplyToRef(c,i)}else a._babylonTransformNode&&i.G(a._babylonTransformNode.Rc(G));return i},getTarget:a=>a._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:a=>{var c,o;return null===(c=a._babylonTransformNode)||void 0===c||null===(o=c.getChildren((a=>a instanceof i.d),!0)[0])||void 0===o?void 0:o.bc},getTarget:a=>{var c;return null===(c=a._babylonTransformNode)||void 0===c?void 0:c.getChildren((a=>a instanceof i.d),!0)[0]},set:(a,c)=>{if(c._babylonTransformNode){const o=c._babylonTransformNode.getChildren((a=>a instanceof i.d),!0)[0];o&&(o.bc=a)}}},color:{type:"oo",get:a=>{var c,o;return null===(c=a._babylonTransformNode)||void 0===c||null===(o=c.getChildren((a=>a instanceof i.d),!0)[0])||void 0===o?void 0:o.Ac},getTarget:a=>{var c;return null===(c=a._babylonTransformNode)||void 0===c?void 0:c.getChildren((a=>a instanceof i.d),!0)[0]},set:(a,c)=>{if(c._babylonTransformNode){const o=c._babylonTransformNode.getChildren((a=>a instanceof i.d),!0)[0];o&&(o.Ac=a)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"oo",get:(a,c,o)=>C(a,c,o).emissiveColor,set:(a,c,o,s)=>C(c,o,s).emissiveColor.G(a),getTarget:(a,c,o)=>C(a,c,o),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:j("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(a,c,o)=>{var s;return null===(s=T(a,o,"bumpTexture"))||void 0===s?void 0:s.level},set:(a,c,o,s)=>{const q=T(c,s,"bumpTexture");q&&(q.level=a)},getTarget:(a,c,o)=>C(a,c,o),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:j("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(a,c,o)=>C(a,c,o).ambientTextureStrength,set:(a,c,o,s)=>{const q=C(c,o,s);q&&(q.ambientTextureStrength=a)},getTarget:(a,c,o)=>C(a,c,o),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:j("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Yc",get:(a,c,o)=>{const s=C(a,c,o);return t.Yc.FromColor3(s.albedoColor,s.alpha)},set:(a,c,o,s)=>{const q=C(c,o,s);q.albedoColor.set(a.r,a.g,a.b),q.alpha=a.a},getTarget:(a,c,o)=>C(a,c,o),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:j("albedoTexture")}},metallicFactor:{type:"number",get:(a,c,o)=>C(a,c,o).metallic,set:(a,c,o,s)=>{const q=C(c,o,s);q&&(q.metallic=a)},getTarget:(a,c,o)=>C(a,c,o),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(a,c,o)=>C(a,c,o).roughness,set:(a,c,o,s)=>{const q=C(c,o,s);q&&(q.roughness=a)},getTarget:(a,c,o)=>C(a,c,o),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:j("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(a,c,o)=>C(a,c,o).anisotropy.bc,set:(a,c,o,s)=>{C(c,o,s).anisotropy.bc=a},getTarget:(a,c,o)=>C(a,c,o),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(a,c,o)=>C(a,c,o).anisotropy.angle,set:(a,c,o,s)=>{C(c,o,s).anisotropy.angle=a},getTarget:(a,c,o)=>C(a,c,o),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:j("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(a,c,o)=>C(a,c,o).clearCoat.bc,set:(a,c,o,s)=>{C(c,o,s).clearCoat.bc=a},getTarget:(a,c,o)=>C(a,c,o),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(a,c,o)=>C(a,c,o).clearCoat.roughness,set:(a,c,o,s)=>{C(c,o,s).clearCoat.roughness=a},getTarget:(a,c,o)=>C(a,c,o),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:j("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(a,c,o)=>{var s;return null===(s=C(a,c,o).clearCoat.bumpTexture)||void 0===s?void 0:s.level},getTarget:C,set:(a,c,o,s)=>C(c,o,s).clearCoat.bumpTexture.level=a},extensions:{KHR_texture_transform:j("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:j("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(a,c,o)=>C(a,c,o).subSurface.dispersion,getTarget:C,set:(a,c,o,s)=>C(c,o,s).subSurface.dispersion=a}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(a,c,o)=>C(a,c,o).emissiveIntensity,getTarget:C,set:(a,c,o,s)=>C(c,o,s).emissiveIntensity=a}},KHR_materials_ior:{ior:{type:"number",get:(a,c,o)=>C(a,c,o).indexOfRefraction,getTarget:C,set:(a,c,o,s)=>C(c,o,s).indexOfRefraction=a}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(a,c,o)=>C(a,c,o).iridescence.bc,getTarget:C,set:(a,c,o,s)=>C(c,o,s).iridescence.bc=a},iridescenceIor:{type:"number",get:(a,c,o)=>C(a,c,o).iridescence.indexOfRefraction,getTarget:C,set:(a,c,o,s)=>C(c,o,s).iridescence.indexOfRefraction=a},iridescenceTexture:{extensions:{KHR_texture_transform:j("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(a,c,o)=>C(a,c,o).iridescence.maximumThickness,getTarget:C,set:(a,c,o,s)=>C(c,o,s).iridescence.maximumThickness=a},iridescenceThicknessMinimum:{type:"number",get:(a,c,o)=>C(a,c,o).iridescence.minimumThickness,getTarget:C,set:(a,c,o,s)=>C(c,o,s).iridescence.minimumThickness=a},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:j("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"oo",get:(a,c,o)=>C(a,c,o).sheen.color,getTarget:C,set:(a,c,o,s)=>C(c,o,s).sheen.color.G(a)},sheenColorTexture:{extensions:{KHR_texture_transform:j("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(a,c,o)=>C(a,c,o).sheen.bc,getTarget:C,set:(a,c,o,s)=>C(c,o,s).sheen.bc=a},sheenRoughnessTexture:{extensions:{KHR_texture_transform:j("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(a,c,o)=>C(a,c,o).metallicF0Factor,getTarget:C,set:(a,c,o,s)=>C(c,o,s).metallicF0Factor=a,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"oo",get:(a,c,o)=>C(a,c,o).metallicReflectanceColor,getTarget:C,set:(a,c,o,s)=>C(c,o,s).metallicReflectanceColor.G(a),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:j("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:j("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(a,c,o)=>C(a,c,o).subSurface.refractionIntensity,getTarget:C,set:(a,c,o,s)=>C(c,o,s).subSurface.refractionIntensity=a,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:j("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(a,c,o)=>C(a,c,o).subSurface.translucencyIntensity,getTarget:C,set:(a,c,o,s)=>C(c,o,s).subSurface.translucencyIntensity=a},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:j("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"oo",get:(a,c,o)=>C(a,c,o).subSurface.translucencyColor,getTarget:C,set:(a,c,o,s)=>{var q;return a&&(null===(q=C(c,o,s).subSurface.translucencyColor)||void 0===q?void 0:q.G(a))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:j("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"oo",get:(a,c,o)=>C(a,c,o).subSurface.tintColor,getTarget:C,set:(a,c,o,s)=>C(c,o,s).subSurface.tintColor.G(a)},attenuationDistance:{type:"number",get:(a,c,o)=>C(a,c,o).subSurface.tintColorAtDistance,getTarget:C,set:(a,c,o,s)=>C(c,o,s).subSurface.tintColorAtDistance=a},thicknessFactor:{type:"number",get:(a,c,o)=>C(a,c,o).subSurface.maximumThickness,getTarget:C,set:(a,c,o,s)=>C(c,o,s).subSurface.maximumThickness=a},thicknessTexture:{extensions:{KHR_texture_transform:j("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>a._babylonLight)),getPropertyName:[a=>"length"]},__array__:{__target__:!0,color:{type:"oo",get:a=>{var c;return null===(c=a._babylonLight)||void 0===c?void 0:c.Ac},set:(a,c)=>{var o;return null===(o=c._babylonLight)||void 0===o?void 0:o.Ac.G(a)},getTarget:a=>a._babylonLight,getPropertyName:[a=>"diffuse"]},bc:{type:"number",get:a=>{var c;return null===(c=a._babylonLight)||void 0===c?void 0:c.bc},set:(a,c)=>c._babylonLight?c._babylonLight.bc=a:void 0,getTarget:a=>a._babylonLight,getPropertyName:[a=>"intensity"]},range:{type:"number",get:a=>{var c;return null===(c=a._babylonLight)||void 0===c?void 0:c.range},set:(a,c)=>c._babylonLight?c._babylonLight.range=a:void 0,getTarget:a=>a._babylonLight,getPropertyName:[a=>"range"]},spot:{innerConeAngle:{type:"number",get:a=>{var c;return null===(c=a._babylonLight)||void 0===c?void 0:c.innerAngle},set:(a,c)=>c._babylonLight?c._babylonLight.innerAngle=a:void 0,getTarget:a=>a._babylonLight,getPropertyName:[a=>"innerConeAngle"]},outerConeAngle:{type:"number",get:a=>{var c;return null===(c=a._babylonLight)||void 0===c?void 0:c.angle},set:(a,c)=>c._babylonLight?c._babylonLight.angle=a:void 0,getTarget:a=>a._babylonLight,getPropertyName:[a=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>a._babylonLight)),getPropertyName:[a=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>a._babylonTexture)),getPropertyName:[a=>"length"]},__array__:{__target__:!0,bc:{type:"number",get:a=>{var c;return null===(c=a._babylonTexture)||void 0===c?void 0:c.level},set:(a,c)=>{c._babylonTexture&&(c._babylonTexture.level=a)},getTarget:a=>a._babylonTexture},rotation:{type:"Quaternion",get:a=>{var c;return a._babylonTexture&&s.Quaternion.FromRotationMatrix(null===(c=a._babylonTexture)||void 0===c?void 0:c.getReflectionTextureMatrix())},set:(a,c)=>{var o;c._babylonTexture&&(null!==(o=c._babylonTexture.Za())&&void 0!==o&&o.useRightHandedSystem||(a=s.Quaternion.Inverse(a)),s.Matrix.FromQuaternionToRef(a,c._babylonTexture.getReflectionTextureMatrix()))},getTarget:a=>a._babylonTexture}}}}},animations:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>a._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>{var c;return null===(c=a.primitives[0]._instanceData)||void 0===c?void 0:c.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function e(a){return new G(a,L)}function g(a){const c=a.split("/").map((a=>a.replace(/{}/g,"__array__")));let o=L;for(const s of c)s&&(o=o[s]);if(o&&o.type&&o.get)return o}function M(a,c){const o=a.split("/").map((a=>a.replace(/{}/g,"__array__")));let s=L;for(const q of o)q&&(s=s[q]);s&&s.type&&s.get&&(s.interpolation=c)}function N(a,c){const o=a.split("/").map((a=>a.replace(/{}/g,"__array__")));let s=L;for(const q of o)if(q){if(!s[q]){if("?"===q){s.__ignoreObjectTree__=!0;continue}s[q]={},"__array__"===q&&(s[q].__target__=!0)}s=s[q]}Object.assign(s,c)}},14349:(a,c,o)=>{"use strict";o.r(c),o.d(c,{AnimationPropertyInfo:()=>T,TransformNodeAnimationPropertyInfo:()=>C,WeightAnimationPropertyInfo:()=>j,getQuaternion:()=>p,getVector3:()=>i,getWeights:()=>G});var s=o(13322),q=o(12810),t=o(14344);function i(a,c,o,s){return q.Hc.qo(c,o).scaleInPlace(s)}function p(a,c,o,s){return q.Quaternion.qo(c,o).scaleInPlace(s)}function G(a,c,o,s){const q=new Array(a._numMorphTargets);for(let t=0;t<q.length;t++)q[t]=c[o++]*s;return q}class T{constructor(a,c,o,s){this.type=a,this.name=c,this.getValue=o,this.getStride=s}_buildAnimation(a,c,o){const q=new s.b(a,this.name,c,this.type);return q.setKeys(o),q}}class C extends T{buildAnimations(a,c,o,s){const q=[];return q.push({babylonAnimatable:a._babylonTransformNode,babylonAnimation:this._buildAnimation(c,o,s)}),q}}class j extends T{buildAnimations(a,c,o,q){const t=[];if(a._numMorphTargets)for(let i=0;i<a._numMorphTargets;i++){const p=new s.b(`${c}_${i}`,this.name,o,this.type);if(p.setKeys(q.map((a=>({frame:a.frame,inTangent:a.inTangent?a.inTangent[i]:void 0,value:a.value[i],outTangent:a.outTangent?a.outTangent[i]:void 0,interpolation:a.interpolation})))),a._primitiveBabylonMeshes)for(const c of a._primitiveBabylonMeshes)if(c.morphTargetManager){const a=c.morphTargetManager.getTarget(i),o=p.clone();a.animations.push(o),t.push({babylonAnimatable:a,babylonAnimation:o})}}return t}}(0,t.n)("/nodes/{}/translation",[new C(s.b.ANIMATIONTYPE_VECTOR3,"position",i,(()=>3))]),(0,t.n)("/nodes/{}/rotation",[new C(s.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",p,(()=>4))]),(0,t.n)("/nodes/{}/scale",[new C(s.b.ANIMATIONTYPE_VECTOR3,"uc",i,(()=>3))]),(0,t.n)("/nodes/{}/weights",[new j(s.b.ANIMATIONTYPE_FLOAT,"influence",G,(a=>a._numMorphTargets))])},14307:(a,c,o)=>{"use strict";class s{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((a,c)=>{this._resolve=a,this._reject=c}))}}var q=o(12810),t=o(12858),i=o(12637),p=o(13246),G=o(14310),T=o(14328),C=o(12639),j=o(13263),L=o(13322),e=o(13327),g=o(12680),M=o(12649),N=o(12657);class y{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(a){this._useTextureToStoreBoneMatrices=a,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(a){this._animationPropertiesOverride=a}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(a,c,o){this.name=a,this.id=c,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=q.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new C.d,this.bones=[],this._scene=o||g.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const s=this._scene.getEngine().getCaps();this._canUseTextureForBones=s.textureFloat&&s.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((a=>!a.getParent()))}getTransformMatrices(a){if(this.needInitialSkinMatrix){if(!a)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return a._bonesTransformMatrices||this.prepare(!0),a._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(a){return this.needInitialSkinMatrix&&a._transformMatrixTexture?a._transformMatrixTexture:this._transformMatrixTexture}Za(){return this._scene}toString(a){let c=`Name: ${this.name}, nBones: ${this.bones.length}`;if(c+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,a){c+=", Ranges: {";let a=!0;for(const o in this._ranges)a&&(c+=", ",a=!1),c+=o;c+="}"}return c}getBoneIndexByName(a){for(let c=0,o=this.bones.length;c<o;c++)if(this.bones[c].name===a)return c;return-1}createAnimationRange(a,c,o){if(!this._ranges[a]){this._ranges[a]=new e.c(a,c,o);for(let s=0,q=this.bones.length;s<q;s++)this.bones[s].animations[0]&&this.bones[s].animations[0].createRange(a,c,o)}}deleteAnimationRange(a){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let o=0,s=this.bones.length;o<s;o++)this.bones[o].animations[0]&&this.bones[o].animations[0].deleteRange(a,c);this._ranges[a]=null}getAnimationRange(a){return this._ranges[a]||null}getAnimationRanges(){const a=[];let c;for(c in this._ranges)a.push(this._ranges[c]);return a}copyAnimationRange(a,c){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[c]||!a.getAnimationRange(c))return!1;let s=!0;const q=this._getHighestAnimationFrame()+1,t={},i=a.bones;let p,G;for(G=0,p=i.length;G<p;G++)t[i[G].name]=i[G];this.bones.length!==i.length&&(M.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${i.length}`),s=!1);const T=o&&this.dimensionsAtRest&&a.dimensionsAtRest?this.dimensionsAtRest.divide(a.dimensionsAtRest):null;for(G=0,p=this.bones.length;G<p;G++){const a=this.bones[G].name,i=t[a];i?s=s&&this.bones[G].copyAnimationRange(i,c,q,o,T):(M.c.Warn("copyAnimationRange: not same rig, missing source bone "+a),s=!1)}const C=a.getAnimationRange(c);return C&&(this._ranges[c]=new e.c(c,C.from+q,C.to+q)),s}returnToRest(){for(const a of this.bones)-1!==a._index&&a.returnToRest()}_getHighestAnimationFrame(){let a=0;for(let c=0,o=this.bones.length;c<o;c++)if(this.bones[c].animations[0]){const o=this.bones[c].animations[0].getHighestFrame();a<o&&(a=o)}return a}beginAnimation(a,c,o,s){const q=this.getAnimationRange(a);return q?this._scene.beginAnimation(this,q.from,q.to,c,o,s):null}static MakeAnimationAdditive(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;const s=a.getAnimationRange(o);if(!s)return null;const q=a._scene.getAllAnimatablesByTarget(a);let t=null;for(let p=0;p<q.length;p++){const a=q[p];if(a.fromFrame===(null===s||void 0===s?void 0:s.from)&&a.toFrame===(null===s||void 0===s?void 0:s.to)){t=a;break}}const i=a.getAnimatables();for(let p=0;p<i.length;p++){const a=i[p].animations;if(a)for(let s=0;s<a.length;s++)L.b.MakeAnimationAdditive(a[s],c,o)}return t&&(t.isAdditive=!0),a}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(a){this._meshesWithPoseMatrix.push(a)}_unregisterMeshWithPoseMatrix(a){const c=this._meshesWithPoseMatrix.indexOf(a);c>-1&&this._meshesWithPoseMatrix.splice(c,1)}_computeTransformMatrices(a,c){this.onBeforeComputeObservable.notifyObservers(this);for(let o=0;o<this.bones.length;o++){const s=this.bones[o];s._childUpdateId++;const q=s.getParent();if(q?s.getLocalMatrix().multiplyToRef(q.getFinalMatrix(),s.getFinalMatrix()):c?s.getLocalMatrix().multiplyToRef(c,s.getFinalMatrix()):s.getFinalMatrix().G(s.getLocalMatrix()),-1!==s._index){const c=null===s._index?o:s._index;s.getAbsoluteInverseBindMatrix().multiplyToArray(s.getFinalMatrix(),a,16*c)}}this._identity.copyToArray(a,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const a=this.Za().getRenderId();if(this._currentRenderId===a)return;this._currentRenderId=a}if(this._numBonesWithLinkedTransformNode>0)for(const a of this.bones)if(a._linkedTransformNode){const c=a._linkedTransformNode;a.position=c.position,c.rotationQuaternion?a.rotationQuaternion=c.rotationQuaternion:a.rotation=c.rotation,a.uc=c.uc}if(this.needInitialSkinMatrix)for(const a of this._meshesWithPoseMatrix){const c=a.getPoseMatrix();let o=this._isDirty;if(a._bonesTransformMatrices&&a._bonesTransformMatrices.length===16*(this.bones.length+1)||(a._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),o=!0),o){if(this._synchronizedWithMesh!==a){this._synchronizedWithMesh=a;for(const a of this.bones)if(!a.getParent()){a.getBindMatrix().multiplyToRef(c,q.TmpVectors.Matrix[1]),a._updateAbsoluteBindMatrices(q.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const c=4*(this.bones.length+1);a._transformMatrixTexture&&a._transformMatrixTexture.getSize().width===c||(a._transformMatrixTexture&&a._transformMatrixTexture.dispose(),a._transformMatrixTexture=j.b.CreateRGBATexture(a._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(a._bonesTransformMatrices,c),this.isUsingTextureForMatrices&&a._transformMatrixTexture&&a._transformMatrixTexture.update(a._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=j.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let a=0;a<this.bones.length;a++)this._animatables.push(this.bones[a])}return this._animatables}clone(a,c){const o=new y(a,c||a,this._scene);o.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let s=0;s<this.bones.length;s++){const a=this.bones[s];let c=null;const q=a.getParent();if(q){const a=this.bones.indexOf(q);c=o.bones[a]}const t=new T.e(a.name,o,c,a.getBindMatrix().clone(),a.getRestMatrix().clone());t._index=a._index,a._linkedTransformNode&&t.linkTransformNode(a._linkedTransformNode),N.b.DeepCopy(a.animations,t.animations)}if(this._ranges){o._ranges={};for(const a in this._ranges){const c=this._ranges[a];c&&(o._ranges[a]=c.clone())}}return this._isDirty=!0,o.prepare(!0),o}enableBlending(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const c of this.bones)for(const o of c.animations)o.enableBlending=!0,o.blendingSpeed=a}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Za().stopAnimation(this),this.Za().removeSkeleton(this),this._parentContainer){const a=this._parentContainer.skeletons.indexOf(this);a>-1&&this._parentContainer.skeletons.splice(a,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const a={};a.name=this.name,a.id=this.id,this.dimensionsAtRest&&(a.dimensionsAtRest=this.dimensionsAtRest.hc()),a.bones=[],a.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let o=0;o<this.bones.length;o++){var c;const s=this.bones[o],q=s.getParent(),t={parentBoneIndex:q?this.bones.indexOf(q):-1,index:s.getIndex(),name:s.name,id:s.id,matrix:s.getBindMatrix().hc(),rest:s.getRestMatrix().hc(),linkedTransformNodeId:null===(c=s.getTransformNode())||void 0===c?void 0:c.id};a.bones.push(t),s.length&&(t.length=s.length),s.metadata&&(t.metadata=s.metadata),s.animations&&s.animations.length>0&&(t.animation=s.animations[0].serialize()),a.ranges=[];for(const c in this._ranges){const o=this._ranges[c];if(!o)continue;const s={};s.name=c,s.from=o.from,s.to=o.to,a.ranges.push(s)}}return a}static Parse(a,c){const o=new y(a.name,a.id,c);let s;for(a.dimensionsAtRest&&(o.dimensionsAtRest=q.Hc.qo(a.dimensionsAtRest)),o.needInitialSkinMatrix=a.needInitialSkinMatrix,s=0;s<a.bones.length;s++){const c=a.bones[s],t=a.bones[s].index;let i=null;c.parentBoneIndex>-1&&(i=o.bones[c.parentBoneIndex]);const p=c.rest?q.Matrix.qo(c.rest):null,G=new T.e(c.name,o,i,q.Matrix.qo(c.matrix),p,null,t);void 0!==c.id&&null!==c.id&&(G.id=c.id),c.length&&(G.length=c.length),c.metadata&&(G.metadata=c.metadata),c.animation&&G.animations.push(L.b.Parse(c.animation)),void 0!==c.linkedTransformNodeId&&null!==c.linkedTransformNodeId&&(o._hasWaitingData=!0,G._waitingTransformNodeId=c.linkedTransformNodeId)}if(a.ranges)for(s=0;s<a.ranges.length;s++){const c=a.ranges[s];o.createAnimationRange(c.name,c.from,c.to)}return o}computeAbsoluteMatrices(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||a)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(a)}getPoseMatrix(){let a=null;return this._meshesWithPoseMatrix.length>0&&(a=this._meshesWithPoseMatrix[0].getPoseMatrix()),a}sortBones(){const a=[],c=new Array(this.bones.length);for(let o=0;o<this.bones.length;o++)this._sortBones(o,a,c);this.bones=a}_sortBones(a,c,o){if(o[a])return;o[a]=!0;const s=this.bones[a];if(!s)return;void 0===s._index&&(s._index=a);const q=s.getParent();q&&this._sortBones(this.bones.indexOf(q),c,o),c.push(s)}setCurrentPoseAsRest(){for(const a of this.bones)a.setCurrentPoseAsRest()}}var k=o(13127),n=o(13286),f=o(12796),J=o(13209),w=o(12882),Z=o(13248),h=o(13220),U=o(13241),S=o(13335),r=o(12901),x=o(14278);class R{set areUpdatesFrozen(a){a?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new r.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,a||(a=g.b.LastCreatedScene),this._scene=a,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const a=this._scene.getEngine().getCaps();this._canUseTextureForTargets=a.canUseGLVertexID&&a.textureFloat&&a.maxVertexTextureImageUnits>0&&a.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return R.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?R.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(a){this._numMaxInfluencers!==a&&(this._numMaxInfluencers=a,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(a){this._useTextureToStoreTargets!==a&&(this._useTextureToStoreTargets=a,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var a;return R.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(a=this._scene)&&void 0!==a&&a.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(a){return this._activeTargets.data[a]}getTarget(a){return this._targets[a]}getTargetByName(a){for(const c of this._targets)if(c.name===a)return c;return null}addTarget(a){this._targets.push(a),this._targetInfluenceChangedObservers.push(a.onInfluenceChanged.add((a=>{this.areUpdatesFrozen&&a&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(a)}))),this._targetDataLayoutChangedObservers.push(a._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(a){const c=this._targets.indexOf(a);c>=0&&(this._targets.splice(c,1),a.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(c,1)[0]),a._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(c,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(a)}_bind(a){a.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),a.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),a.setTexture("morphTargets",this._targetStoreTexture),a.setInt("morphTargetCount",this.numInfluencers)}clone(){const a=new R(this._scene);for(const c of this._targets)a.addTarget(c.clone());return a.enablePositionMorphing=this.enablePositionMorphing,a.enableNormalMorphing=this.enableNormalMorphing,a.enableTangentMorphing=this.enableTangentMorphing,a.enableUVMorphing=this.enableUVMorphing,a.enableUV2Morphing=this.enableUV2Morphing,a.enableColorMorphing=this.enableColorMorphing,a}serialize(){const a={};a.id=this.uniqueId,a.targets=[];for(const c of this._targets)a.targets.push(c.serialize());return a}_syncActiveTargets(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const c=!!this._targetStoreTexture,o=this.isUsingTextureForTargets;(this._mustSynchronize||c!==o)&&(this._mustSynchronize=!1,this.synchronize());let s=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let q=-1;for(const t of this._targets)if(q++,0!==t.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=R.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(t),this._morphTargetTextureIndices[s]=q,this._tempInfluences[s++]=t.influence}this._morphTargetTextureIndices.length!==s&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,s)),this._influences&&this._influences.length===s||(this._influences=new Float32Array(s));for(let t=0;t<s;t++)this._influences[t]=this._tempInfluences[t];if(a&&this._scene)for(const t of this._scene.meshes)t.morphTargetManager===this&&(o?t._markSubMeshesAsAttributesDirty():t._syncGeometryWithMorphTargetManager())}synchronize(){var a;if(!this._scene||this.areUpdatesFrozen)return;const c=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(a=this._targetStoreTexture)||void 0===a||a.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>c.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const o of this._targets){this._supportsPositions=this._supportsPositions&&o.hasPositions,this._supportsNormals=this._supportsNormals&&o.hasNormals,this._supportsTangents=this._supportsTangents&&o.hasTangents,this._supportsUVs=this._supportsUVs&&o.hasUVs,this._supportsUV2s=this._supportsUV2s&&o.hasUV2s,this._supportsColors=this._supportsColors&&o.hasColors;const a=o.vertexCount;if(0===this._vertexCount)this._vertexCount=a;else if(this._vertexCount!==a)return void M.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${o.name}": ${a}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const a=c.getCaps().maxTextureSize;this._textureWidth>a&&(this._textureHeight=Math.ceil(this._textureWidth/a),this._textureWidth=a);const o=this._targets.length,s=new Float32Array(o*this._textureWidth*this._textureHeight*4);let q=0;for(let c=0;c<o;c++){const a=this._targets[c],o=a.getPositions(),t=a.getNormals(),i=a.getUVs(),p=a.getTangents(),G=a.getUV2s(),T=a.getColors();q=c*this._textureWidth*this._textureHeight*4;for(let c=0;c<this._vertexCount;c++)this._supportsPositions&&o&&(s[q]=o[3*c],s[q+1]=o[3*c+1],s[q+2]=o[3*c+2],q+=4),this._supportsNormals&&t&&(s[q]=t[3*c],s[q+1]=t[3*c+1],s[q+2]=t[3*c+2],q+=4),this._supportsUVs&&i&&(s[q]=i[2*c],s[q+1]=i[2*c+1],q+=4),this._supportsTangents&&p&&(s[q]=p[3*c],s[q+1]=p[3*c+1],s[q+2]=p[3*c+2],q+=4),this._supportsUV2s&&G&&(s[q]=G[2*c],s[q+1]=G[2*c+1],q+=4),this._supportsColors&&T&&(s[q]=T[4*c],s[q+1]=T[4*c+1],s[q+2]=T[4*c+2],s[q+3]=T[4*c+3],q+=4)}this._targetStoreTexture=x.d.CreateRGBATexture(s,this._textureWidth,this._textureHeight,o,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const o of this._scene.meshes)o.morphTargetManager===this&&o._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const a=this._parentContainer.morphTargetManagers.indexOf(this);a>-1&&this._parentContainer.morphTargetManagers.splice(a,1),this._parentContainer=null}for(const a of this._targets)this._scene.stopAnimation(a)}}static Parse(a,c){const o=new R(c);for(const s of a.targets)o.addTarget(S.c.Parse(s,c));return o}}R.EnableTextureStorage=!0,R.MaxActiveMorphTargetsInVertexAttributeMode=8,R.ConstantTargetCountForTextureMode=0;var d=o(14331),X=o(12689),W=o(13140);const F=new Map,O=F;function B(a,c,o){u(a)&&M.c.Warn(`Extension with the name '${a}' already exists`),F.set(a,{isGLTFExtension:c,factory:o})}function u(a){return F.delete(a)}var K=o(14344),D=o(13389),I=o(12894);class Y{static Get(a,c,o){if(!c||void 0==o||!c[o])throw new Error(`${a}: Failed to find index (${o})`);return c[o]}static TryGet(a,c){return a&&void 0!=c&&a[c]?a[c]:null}static Assign(a){if(a)for(let c=0;c<a.length;c++)a[c].index=c}}function P(a){if(a.min&&a.max){const c=a.min,o=a.max,s=q.TmpVectors.Hc[0].Bc(c[0],c[1],c[2]),t=q.TmpVectors.Hc[1].Bc(o[0],o[1],o[2]);if(a.normalized&&5126!==a.componentType){let c=1;switch(a.componentType){case 5120:c=127;break;case 5121:c=255;break;case 5122:c=32767;break;case 5123:c=65535}const o=1/c;s.scaleInPlace(o),t.scaleInPlace(o)}return new W.b(s,t)}return null}class ma{static RegisterExtension(a,c){B(a,!1,c)}static UnregisterExtension(a){return u(a)}get nc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(a){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=a}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((a=>a.dispose&&a.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(a,c,o,s,q,t){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=c,this._assetContainer=o,this._loadData(s);let t=null;if(a){const c={};if(this._gltf.nodes)for(const a of this._gltf.nodes)a.name&&(c[a.name]=a.index);t=(a instanceof Array?a:[a]).map((a=>{const o=c[a];if(void 0===o)throw new Error(`Failed to find node '${a}'`);return o}))}return await this._loadAsync(q,i,t,(()=>({meshes:this._getMeshes(),IL:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=a,this._loadData(c),await this._loadAsync(o,q,null,(()=>{}))}async _loadAsync(a,c,o,s){return await Promise.resolve().then((async()=>{this._rootUrl=a,this._uniqueRootUrl=!a.startsWith("file:")&&c?a:`${a}${Date.now()}/`,this._fileName=c,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const q=`${d.l[d.l.LOADING]} => ${d.l[d.l.READY]}`,t=`${d.l[d.l.LOADING]} => ${d.l[d.l.COMPLETE]}`;this._parent._startPerformanceCounter(q),this._parent._startPerformanceCounter(t),this._parent._setState(d.l.LOADING),this._extensionsOnLoading();const p=new Array;if(!this.parent.loadOnlyMaterials)if(o)p.push(this.loadSceneAsync("/nodes",{nodes:o,index:-1}));else if(void 0!=this._gltf.ao||this._gltf.scenes&&this._gltf.scenes[0]){const a=Y.Get("/scene",this._gltf.scenes,this._gltf.ao||0);p.push(this.loadSceneAsync(`/scenes/${a.index}`,a))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let a=0;a<this._gltf.materials.length;++a){const c=this._gltf.materials[a],o="/materials/"+a,s=k.b.TriangleFillMode;p.push(this._loadMaterialAsync(o,c,null,s,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&p.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&p.push(this._compileShadowGeneratorsAsync());const G=Promise.all(p).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.KG(!0);for(const a of this._babylonScene.materials){const c=a;void 0!==c.maxSimultaneousLights&&(c.maxSimultaneousLights=Math.max(c.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(d.l.READY),this._skipStartAnimationStep||this._startAnimations(),s()}));return await G.then((a=>(this._parent._endPerformanceCounter(q),i.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(t),this._parent._setState(d.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(a=>{this._parent.onErrorObservable.notifyObservers(a),this._parent.onErrorObservable.clear(),this.dispose()}))})),a)))})).catch((a=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(a),this._parent.onErrorObservable.clear(),this.dispose()),a}))}_loadData(a){if(this._gltf=a.json,this._setupData(),a.bin){const c=this._gltf.buffers;if(c&&c[0]&&!c[0].uri){const o=c[0];(o.byteLength<a.bin.byteLength-3||o.byteLength>a.bin.byteLength)&&M.c.Warn(`Binary buffer length (${o.byteLength}) from JSON does not match chunk length (${a.bin.byteLength})`),this._bin=a.bin}else M.c.Warn("Unexpected BIN chunk")}}_setupData(){if(Y.Assign(this._gltf.accessors),Y.Assign(this._gltf.animations),Y.Assign(this._gltf.buffers),Y.Assign(this._gltf.bufferViews),Y.Assign(this._gltf.cameras),Y.Assign(this._gltf.images),Y.Assign(this._gltf.materials),Y.Assign(this._gltf.meshes),Y.Assign(this._gltf.nodes),Y.Assign(this._gltf.samplers),Y.Assign(this._gltf.scenes),Y.Assign(this._gltf.skins),Y.Assign(this._gltf.textures),this._gltf.nodes){const a={};for(const o of this._gltf.nodes)if(o.children)for(const c of o.children)a[c]=o.index;const c=this._createRootNode();for(const o of this._gltf.nodes){const s=a[o.index];o.parent=void 0===s?c:this._gltf.nodes[s]}}}async _loadExtensionsAsync(){const a=[];if(O.forEach(((c,o)=>{var s;!1===(null===(s=this.parent.extensionOptions[o])||void 0===s?void 0:s.enabled)?c.isGLTFExtension&&this.isExtensionUsed(o)&&M.c.Warn(`Extension ${o} is used but has been explicitly disabled.`):c.isGLTFExtension&&!this.isExtensionUsed(o)||a.push((async()=>{const a=await c.factory(this);return a.name!==o&&M.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${a.name} !== ${o}`),this._parent.onExtensionLoadedObservable.notifyObservers(a),a})())})),this._extensions.push(...await Promise.all(a)),this._extensions.sort(((a,c)=>(a.order||Number.MAX_VALUE)-(c.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const o of this._gltf.extensionsRequired){if(!this._extensions.some((a=>a.name===o&&a.enabled))){var c;if(!1===(null===(c=this.parent.extensionOptions[o])||void 0===c?void 0:c.enabled))throw new Error(`Required extension ${o} is disabled`);throw new Error(`Required extension ${o} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new U.c("__root__",this._babylonScene);this._rootBabylonMesh=a,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.KG(!1);const c={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case d.h.AUTO:this._babylonScene.useRightHandedSystem||(c.rotation=[0,1,0,0],c.scale=[1,1,-1],ma._LoadTransform(c,this._rootBabylonMesh));break;case d.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(a),c}loadSceneAsync(a,c){const o=this._extensionsLoadSceneAsync(a,c);if(o)return o;const s=new Array;if(this.logOpen(`${a} ${c.name||""}`),c.nodes)for(const q of c.nodes){const c=Y.Get(`${a}/nodes/${q}`,this._gltf.nodes,q);s.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(a=>{a.parent=this._rootBabylonMesh})))}for(const q of this._postSceneLoadActions)q();return s.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(s).then((()=>{}))}_forEachPrimitive(a,c){if(a._primitiveBabylonMeshes)for(const o of a._primitiveBabylonMeshes)c(o)}_getGeometries(){const a=[],c=this._gltf.nodes;if(c)for(const o of c)this._forEachPrimitive(o,(c=>{const o=c.dc;o&&-1===a.indexOf(o)&&a.push(o)}));return a}_getMeshes(){const a=[];this._rootBabylonMesh instanceof h.e&&a.push(this._rootBabylonMesh);const c=this._gltf.nodes;if(c)for(const o of c)this._forEachPrimitive(o,(c=>{a.push(c)}));return a}_getTransformNodes(){const a=[],c=this._gltf.nodes;if(c)for(const o of c)o._babylonTransformNode&&"ci"===o._babylonTransformNode.getClassName()&&a.push(o._babylonTransformNode),o._babylonTransformNodeForSkin&&a.push(o._babylonTransformNodeForSkin);return a}_getSkeletons(){const a=[],c=this._gltf.skins;if(c)for(const o of c)o._data&&a.push(o._data.babylonSkeleton);return a}_getAnimationGroups(){const a=[],c=this._gltf.animations;if(c)for(const o of c)o._babylonAnimationGroup&&a.push(o._babylonAnimationGroup);return a}_startAnimations(){switch(this._parent.animationStartMode){case d.g.NONE:break;case d.g.FIRST:{const a=this._getAnimationGroups();0!==a.length&&a[0].start(!0);break}case d.g.ALL:{const a=this._getAnimationGroups();for(const c of a)c.start(!0);break}default:return void M.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const s=this._extensionsLoadNodeAsync(a,c,o);if(s)return s;if(c._babylonTransformNode)throw new Error(`${a}: Invalid recursive node hierarchy`);const q=new Array;this.logOpen(`${a} ${c.name||""}`);const t=s=>{if(ma.AddPointerMetadata(s,a),ma._LoadTransform(c,s),void 0!=c.camera){const o=Y.Get(`${a}/camera`,this._gltf.cameras,c.camera);q.push(this.loadCameraAsync(`/cameras/${o.index}`,o,(a=>{a.parent=s,this._babylonScene.useRightHandedSystem||(s.uc.x=-1)})))}if(c.children)for(const o of c.children){const c=Y.Get(`${a}/children/${o}`,this._gltf.nodes,o);q.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(a=>{a.parent=s})))}o(s)},i=void 0!=c.mesh,p=this._parent.loadSkins&&void 0!=c.skin;if(!i||p){const a=c.name||`node${c.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new J.b(a,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==c.mesh?c._babylonTransformNode=o:c._babylonTransformNodeForSkin=o,t(o)}if(i)if(p){const o=Y.Get(`${a}/mesh`,this._gltf.meshes,c.mesh);q.push(this._loadMeshAsync(`/meshes/${o.index}`,c,o,(o=>{const s=c._babylonTransformNodeForSkin;o.metadata=(0,D.e)(s.metadata,o.metadata||{});const t=Y.Get(`${a}/skin`,this._gltf.skins,c.skin);q.push(this._loadSkinAsync(`/skins/${t.index}`,c,t,(a=>{this._forEachPrimitive(c,(c=>{c.skeleton=a})),this._postSceneLoadActions.push((()=>{if(void 0!=t.skeleton){const a=Y.Get(`/skins/${t.index}/skeleton`,this._gltf.nodes,t.skeleton).parent;c.index===a.index?o.parent=s.parent:o.parent=a._babylonTransformNode}else o.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:s,skinnedNode:o})}))})))})))}else{const o=Y.Get(`${a}/mesh`,this._gltf.meshes,c.mesh);q.push(this._loadMeshAsync(`/meshes/${o.index}`,c,o,t))}return this.logClose(),Promise.all(q).then((()=>(this._forEachPrimitive(c,(a=>{const c=a;!c.isAnInstance&&c.dc&&c.dc.useBoundingInfoFromGeometry?a.Wa():a.refreshBoundingInfo(!0,!0)})),c._babylonTransformNode)))}_loadMeshAsync(a,c,o,s){const q=o.primitives;if(!q||!q.length)throw new Error(`${a}: Primitives are missing`);void 0==q[0].index&&Y.Assign(q);const t=new Array;this.logOpen(`${a} ${o.name||""}`);const i=c.name||`node${c.index}`;if(1===q.length){const s=o.primitives[0];t.push(this._loadMeshPrimitiveAsync(`${a}/primitives/${s.index}`,i,c,o,s,(a=>{c._babylonTransformNode=a,c._primitiveBabylonMeshes=[a]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,c._babylonTransformNode=new J.b(i,this._babylonScene),c._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._primitiveBabylonMeshes=[];for(const s of q)t.push(this._loadMeshPrimitiveAsync(`${a}/primitives/${s.index}`,`${i}_primitive${s.index}`,c,o,s,(a=>{a.parent=c._babylonTransformNode,c._primitiveBabylonMeshes.push(a)})))}return s(c._babylonTransformNode),this.logClose(),Promise.all(t).then((()=>c._babylonTransformNode))}_loadMeshPrimitiveAsync(a,c,o,s,q,t){const i=this._extensionsLoadMeshPrimitiveAsync(a,c,o,s,q,t);if(i)return i;this.logOpen(`${a}`);const p=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==o.skin&&!s.primitives[0].targets;let G,T;if(p&&q._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,G=q._instanceData.babylonSourceMesh.createInstance(c),G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T=q._instanceData.promise;else{const t=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new U.c(c,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.sideOrientation=this._babylonScene.useRightHandedSystem?k.b.CounterClockWiseSideOrientation:k.b.ClockWiseSideOrientation,this._createMorphTargets(a,o,s,q,i),t.push(this._loadVertexDataAsync(a,q,i).then((async c=>await this._loadMorphTargetsAsync(a,q,i,c).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,c.da(i),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const C=ma._GetDrawMode(a,q.mode);if(void 0==q.material){let a=this._defaultBabylonMaterialData[C];a||(a=this._createDefaultMaterial("__GLTFLoader._default",C),this._parent.onMaterialLoadedObservable.notifyObservers(a),this._defaultBabylonMaterialData[C]=a),i.material=a}else if(!this.parent.skipMaterials){const c=Y.Get(`${a}/material`,this._gltf.materials,q.material);t.push(this._loadMaterialAsync(`/materials/${c.index}`,c,i,C,(a=>{i.material=a})))}T=Promise.all(t),p&&(q._instanceData={babylonSourceMesh:i,promise:T}),G=i}return ma.AddPointerMetadata(G,a),this._parent.onMeshLoadedObservable.notifyObservers(G),t(G),this.logClose(),T.then((()=>G))}_loadVertexDataAsync(a,c,o){const s=this._extensionsLoadVertexDataAsync(a,c,o);if(s)return s;const q=c.attributes;if(!q)throw new Error(`${a}: Attributes are missing`);const t=new Array,i=new Z.d(o.name,this._babylonScene);if(void 0==c.indices)o.isUnIndexed=!0;else{const o=Y.Get(`${a}/indices`,this._gltf.accessors,c.indices);t.push(this._loadIndicesAccessorAsync(`/accessors/${o.index}`,o).then((a=>{i.setIndices(a)})))}const p=(c,s,p)=>{if(void 0==q[c])return;o._delayInfo=o._delayInfo||[],-1===o._delayInfo.indexOf(s)&&o._delayInfo.push(s);const G=Y.Get(`${a}/attributes/${c}`,this._gltf.accessors,q[c]);t.push(this._loadVertexAccessorAsync(`/accessors/${G.index}`,G,s).then((a=>{if(a.getKind()===w.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!o.skeleton){const a=P(G);a&&(i._boundingInfo=a,i.useBoundingInfoFromGeometry=!0)}i.setVerticesBuffer(a,G.count)}))),s==w.g.MatricesIndicesExtraKind&&(o.numBoneInfluencers=8),p&&p(G)};return p("POSITION",w.g.PositionKind),p("NORMAL",w.g.NormalKind),p("TANGENT",w.g.TangentKind),p("TEXCOORD_0",w.g.UVKind),p("TEXCOORD_1",w.g.UV2Kind),p("TEXCOORD_2",w.g.UV3Kind),p("TEXCOORD_3",w.g.UV4Kind),p("TEXCOORD_4",w.g.UV5Kind),p("TEXCOORD_5",w.g.UV6Kind),p("JOINTS_0",w.g.MatricesIndicesKind),p("WEIGHTS_0",w.g.MatricesWeightsKind),p("JOINTS_1",w.g.MatricesIndicesExtraKind),p("WEIGHTS_1",w.g.MatricesWeightsExtraKind),p("COLOR_0",w.g.ColorKind,(a=>{"VEC4"===a.type&&(o.hasVertexAlpha=!0)})),Promise.all(t).then((()=>i))}_createMorphTargets(a,c,o,s,q){if(!s.targets||!this._parent.loadMorphTargets)return;if(void 0==c._numMorphTargets)c._numMorphTargets=s.targets.length;else if(s.targets.length!==c._numMorphTargets)throw new Error(`${a}: Primitives do not have the same number of targets`);const t=o.extras?o.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,q.morphTargetManager=new R(this._babylonScene),q.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.morphTargetManager.areUpdatesFrozen=!0;for(let i=0;i<s.targets.length;i++){const a=c.weights?c.weights[i]:o.weights?o.weights[i]:0,s=t?t[i]:`morphTarget${i}`;q.morphTargetManager.addTarget(new S.c(s,a,q.Za()))}}_loadMorphTargetsAsync(a,c,o,s){if(!c.targets||!this._parent.loadMorphTargets)return Promise.resolve();const q=new Array,t=o.morphTargetManager;for(let i=0;i<t.numTargets;i++){const o=t.getTarget(i);q.push(this._loadMorphTargetVertexDataAsync(`${a}/targets/${i}`,s,c.targets[i],o))}return Promise.all(q).then((()=>{t.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(a,c,o,s){const q=new Array,t=(s,t,i)=>{if(void 0==o[s])return;const p=c.getVertexBuffer(t);if(!p)return;const G=Y.Get(`${a}/${s}`,this._gltf.accessors,o[s]);q.push(this._loadFloatAccessorAsync(`/accessors/${G.index}`,G).then((a=>{i(p,a)})))};return t("POSITION",w.g.PositionKind,((a,c)=>{const o=new Float32Array(c.length);a.forEach(c.length,((a,s)=>{o[s]=c[s]+a})),s.setPositions(o)})),t("NORMAL",w.g.NormalKind,((a,c)=>{const o=new Float32Array(c.length);a.forEach(o.length,((a,s)=>{o[s]=c[s]+a})),s.setNormals(o)})),t("TANGENT",w.g.TangentKind,((a,c)=>{const o=new Float32Array(c.length/3*4);let q=0;a.forEach(c.length/3*4,((a,s)=>{(s+1)%4!==0&&(o[q]=c[q]+a,q++)})),s.setTangents(o)})),t("TEXCOORD_0",w.g.UVKind,((a,c)=>{const o=new Float32Array(c.length);a.forEach(c.length,((a,s)=>{o[s]=c[s]+a})),s.setUVs(o)})),t("TEXCOORD_1",w.g.UV2Kind,((a,c)=>{const o=new Float32Array(c.length);a.forEach(c.length,((a,s)=>{o[s]=c[s]+a})),s.setUV2s(o)})),t("COLOR_0",w.g.ColorKind,((c,o)=>{let q=null;const t=c.getSize();if(3===t){q=new Float32Array(o.length/3*4),c.forEach(o.length,((a,c)=>{const s=Math.floor(c/3),t=c%3;q[4*s+t]=o[3*s+t]+a}));for(let a=0;a<o.length/3;++a)q[4*a+3]=1}else{if(4!==t)throw new Error(`${a}: Invalid number of components (${t}) for COLOR_0 attribute`);q=new Float32Array(o.length),c.forEach(o.length,((a,c)=>{q[c]=o[c]+a}))}s.setColors(q)})),await Promise.all(q).then((()=>{}))}static _LoadTransform(a,c){if(void 0!=a.skin)return;let o=q.Hc.Zero(),s=q.Quaternion.Identity(),t=q.Hc.One();if(a.matrix){q.Matrix.qo(a.matrix).decompose(t,s,o)}else a.translation&&(o=q.Hc.qo(a.translation)),a.rotation&&(s=q.Quaternion.qo(a.rotation)),a.scale&&(t=q.Hc.qo(a.scale));c.position=o,c.rotationQuaternion=s,c.uc=t}_loadSkinAsync(a,c,o,s){if(!this._parent.loadSkins)return Promise.resolve();const q=this._extensionsLoadSkinAsync(a,c,o);if(q)return q;if(o._data)return s(o._data.babylonSkeleton),o._data.promise;const t=`skeleton${o.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new y(o.name||t,t,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(a,o,i);const p=this._loadSkinInverseBindMatricesDataAsync(a,o).then((a=>{this._updateBoneMatrices(i,a)}));return o._data={babylonSkeleton:i,promise:p},s(i),p}_loadBones(a,c,o){if(void 0==c.skeleton||this._parent.alwaysComputeSkeletonRootNode){const o=this._findSkeletonRootNode(`${a}/joints`,c.joints);if(o)if(void 0===c.skeleton)c.skeleton=o.index;else{const s=(a,c)=>{for(;c.parent;c=c.parent)if(c.parent===a)return!0;return!1},q=Y.Get(`${a}/skeleton`,this._gltf.nodes,c.skeleton);q===o||s(q,o)||(M.c.Warn(`${a}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),c.skeleton=o.index)}else M.c.Warn(`${a}: Failed to find common root`)}const s={};for(const q of c.joints){const t=Y.Get(`${a}/joints/${q}`,this._gltf.nodes,q);this._loadBone(t,c,o,s)}}_findSkeletonRootNode(a,c){if(0===c.length)return null;const o={};for(const q of c){const c=[];let s=Y.Get(`${a}/${q}`,this._gltf.nodes,q);for(;-1!==s.index;)c.unshift(s),s=s.parent;o[q]=c}let s=null;for(let q=0;;++q){let a=o[c[0]];if(q>=a.length)return s;const t=a[q];for(let i=1;i<c.length;++i)if(a=o[c[i]],q>=a.length||t!==a[q])return s;s=t}}_loadBone(a,c,o,s){a._isJoint=!0;let q=s[a.index];if(q)return q;let t=null;a.index!==c.skeleton&&(a.parent&&-1!==a.parent.index?t=this._loadBone(a.parent,c,o,s):void 0!==c.skeleton&&M.c.Warn(`/skins/${c.index}/skeleton: Skeleton node is not a common root`));const i=c.joints.indexOf(a.index);return q=new T.e(a.name||`joint${a.index}`,o,t,this._getNodeMatrix(a),null,null,i),s[a.index]=q,this._postSceneLoadActions.push((()=>{q.linkTransformNode(a._babylonTransformNode)})),q}_loadSkinInverseBindMatricesDataAsync(a,c){if(void 0==c.inverseBindMatrices)return Promise.resolve(null);const o=Y.Get(`${a}/inverseBindMatrices`,this._gltf.accessors,c.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${o.index}`,o)}_updateBoneMatrices(a,c){for(const o of a.bones){const a=q.Matrix.Identity(),s=o._index;c&&-1!==s&&(q.Matrix.FromArrayToRef(c,16*s,a),a.invertToRef(a));const t=o.getParent();t&&a.multiplyToRef(t.getAbsoluteInverseBindMatrix(),a),o.xc(a,!1,!1),o._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(a){return a.matrix?q.Matrix.qo(a.matrix):q.Matrix.Compose(a.scale?q.Hc.qo(a.scale):q.Hc.One(),a.rotation?q.Quaternion.qo(a.rotation):q.Quaternion.Identity(),a.translation?q.Hc.qo(a.translation):q.Hc.Zero())}loadCameraAsync(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const s=this._extensionsLoadCameraAsync(a,c,o);if(s)return s;const t=new Array;this.logOpen(`${a} ${c.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new G.e(c.name||`camera${c.index}`,q.Hc.Zero(),this._babylonScene,!1);switch(i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonCamera=i,i.setTarget(new q.Hc(0,0,-1)),c.type){case"perspective":{const o=c.perspective;if(!o)throw new Error(`${a}: Camera perspective properties are missing`);i.fov=o.yfov,i.rc=o.znear,i.maxZ=o.zfar||0;break}case"orthographic":if(!c.orthographic)throw new Error(`${a}: Camera orthographic properties are missing`);i.mode=p.b.ORTHOGRAPHIC_CAMERA,i.orthoLeft=-c.orthographic.xmag,i.orthoRight=c.orthographic.xmag,i.orthoBottom=-c.orthographic.ymag,i.orthoTop=c.orthographic.ymag,i.rc=c.orthographic.znear,i.maxZ=c.orthographic.zfar;break;default:throw new Error(`${a}: Invalid camera type (${c.type})`)}return ma.AddPointerMetadata(i,a),this._parent.onCameraLoadedObservable.notifyObservers(i),o(i),this.logClose(),Promise.all(t).then((()=>i))}_loadAnimationsAsync(){const a=this._gltf.animations;if(!a)return Promise.resolve();const c=new Array;for(let o=0;o<a.length;o++){const s=a[o];c.push(this.loadAnimationAsync(`/animations/${s.index}`,s).then((a=>{0===a.targetedAnimations.length&&a.dispose()})))}return Promise.all(c).then((()=>{}))}loadAnimationAsync(a,c){const s=this._extensionsLoadAnimationAsync(a,c);return s||o.e(78).then(o.bind(o,15949)).then((o=>{let{AnimationGroup:s}=o;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new s(c.name||`animation${c.index}`,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonAnimationGroup=q;const t=new Array;Y.Assign(c.channels),Y.Assign(c.samplers);for(const i of c.channels)t.push(this._loadAnimationChannelAsync(`${a}/channels/${i.index}`,a,c,i,((a,c)=>{a.animations=a.animations||[],a.animations.push(c),q.addTargetedAnimation(c,a)})));return Promise.all(t).then((()=>(q.normalize(0),q)))}))}async _loadAnimationChannelAsync(a,c,s,q,t){const i=this._extensionsLoadAnimationChannelAsync(a,c,s,q,t);if(i)return await i;if(void 0==q.target.node)return await Promise.resolve();const p=Y.Get(`${a}/target/node`,this._gltf.nodes,q.target.node),G=q.target.path,T="weights"===G;if(T&&!p._numMorphTargets||!T&&!p._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!T&&!p._isJoint)return await Promise.resolve();let C;switch(await Promise.resolve().then(o.bind(o,14349)),G){case"translation":var j;C=null===(j=(0,K.f)("/nodes/{}/translation"))||void 0===j?void 0:j.interpolation;break;case"rotation":var L;C=null===(L=(0,K.f)("/nodes/{}/rotation"))||void 0===L?void 0:L.interpolation;break;case"scale":var e;C=null===(e=(0,K.f)("/nodes/{}/scale"))||void 0===e?void 0:e.interpolation;break;case"weights":var g;C=null===(g=(0,K.f)("/nodes/{}/weights"))||void 0===g?void 0:g.interpolation;break;default:throw new Error(`${a}/target/path: Invalid value (${q.target.path})`)}if(!C)throw new Error(`${a}/target/path: Could not find interpolation properties for target path (${q.target.path})`);const M={object:p,info:C};return await this._loadAnimationChannelFromTargetInfoAsync(a,c,s,q,M,t)}_loadAnimationChannelFromTargetInfoAsync(a,c,o,s,q,t){const i=this.parent.targetFps,p=1/i,G=Y.Get(`${a}/sampler`,o.samplers,s.sampler);return this._loadAnimationSamplerAsync(`${c}/samplers/${s.sampler}`,G).then((a=>{let c=0;const G=q.object,T=q.info;for(const q of T){const T=q.getStride(G),C=a.input,j=a.output,L=new Array(C.length);let e=0;switch(a.interpolation){case"STEP":for(let a=0;a<C.length;a++){const c=q.getValue(G,j,e,1);e+=T,L[a]={frame:C[a]*i,value:c,interpolation:1}}break;case"CUBICSPLINE":for(let a=0;a<C.length;a++){const c=q.getValue(G,j,e,p);e+=T;const o=q.getValue(G,j,e,1);e+=T;const s=q.getValue(G,j,e,p);e+=T,L[a]={frame:C[a]*i,inTangent:c,value:o,outTangent:s}}break;case"LINEAR":for(let a=0;a<C.length;a++){const c=q.getValue(G,j,e,1);e+=T,L[a]={frame:C[a]*i,value:c}}}if(e>0){const a=`${o.name||`animation${o.index}`}_channel${s.index}_${c}`,p=q.buildAnimations(G,a,i,L);for(const o of p)c++,t(o.babylonAnimatable,o.babylonAnimation)}}}))}_loadAnimationSamplerAsync(a,c){if(c._data)return c._data;const o=c.interpolation||"LINEAR";switch(o){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${a}/interpolation: Invalid value (${c.interpolation})`)}const s=Y.Get(`${a}/input`,this._gltf.accessors,c.input),q=Y.Get(`${a}/output`,this._gltf.accessors,c.output);return c._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${s.index}`,s),this._loadFloatAccessorAsync(`/accessors/${q.index}`,q)]).then((a=>{let[c,s]=a;return{input:c,interpolation:o,output:s}})),c._data}loadBufferAsync(a,c,o,s){const q=this._extensionsLoadBufferAsync(a,c,o,s);if(q)return q;if(!c._data)if(c.uri)c._data=this.loadUriAsync(`${a}/uri`,c,c.uri);else{if(!this._bin)throw new Error(`${a}: Uri is missing or the binary glTF is missing its binary chunk`);c._data=this._bin.readAsync(0,c.byteLength)}return c._data.then((c=>{try{return new Uint8Array(c.buffer,c.byteOffset+o,s)}catch(q){throw new Error(`${a}: ${q.message}`)}}))}loadBufferViewAsync(a,c){const o=this._extensionsLoadBufferViewAsync(a,c);if(o)return o;if(c._data)return c._data;const s=Y.Get(`${a}/buffer`,this._gltf.buffers,c.buffer);return c._data=this.loadBufferAsync(`/buffers/${s.index}`,s,c.byteOffset||0,c.byteLength),c._data}_loadAccessorAsync(a,c,o){if(c._data)return c._data;const s=ma._GetNumComponents(a,c.type),q=s*w.g.GetTypeByteLength(c.componentType),t=s*c.count;if(void 0==c.bufferView)c._data=Promise.resolve(new o(t));else{const i=Y.Get(`${a}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then((p=>{if(5126!==c.componentType||c.normalized||i.byteStride&&i.byteStride!==q){const a=new o(t);return w.g.ForEach(p,c.byteOffset||0,i.byteStride||q,s,c.componentType,a.length,c.normalized||!1,((c,o)=>{a[o]=c})),a}return ma._GetTypedArray(a,c.componentType,p,c.byteOffset,t)}))}if(c.sparse){const t=c.sparse;c._data=c._data.then((i=>{const p=i,G=Y.Get(`${a}/sparse/indices/bufferView`,this._gltf.bufferViews,t.indices.bufferView),T=Y.Get(`${a}/sparse/values/bufferView`,this._gltf.bufferViews,t.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${G.index}`,G),this.loadBufferViewAsync(`/bufferViews/${T.index}`,T)]).then((i=>{let[G,T]=i;const C=ma._GetTypedArray(`${a}/sparse/indices`,t.indices.componentType,G,t.indices.byteOffset,t.count),j=s*t.count;let L;if(5126!==c.componentType||c.normalized){const i=ma._GetTypedArray(`${a}/sparse/values`,c.componentType,T,t.values.byteOffset,j);L=new o(j),w.g.ForEach(i,0,q,s,c.componentType,L.length,c.normalized||!1,((a,c)=>{L[c]=a}))}else L=ma._GetTypedArray(`${a}/sparse/values`,c.componentType,T,t.values.byteOffset,j);let e=0;for(let a=0;a<C.length;a++){let c=C[a]*s;for(let a=0;a<s;a++)p[c++]=L[e++]}return p}))}))}return c._data}_loadFloatAccessorAsync(a,c){return this._loadAccessorAsync(a,c,Float32Array)}_loadIndicesAccessorAsync(a,c){if("SCALAR"!==c.type)throw new Error(`${a}/type: Invalid value ${c.type}`);if(5121!==c.componentType&&5123!==c.componentType&&5125!==c.componentType)throw new Error(`${a}/componentType: Invalid value ${c.componentType}`);if(c._data)return c._data;if(c.sparse){const o=ma._GetTypedArrayConstructor(`${a}/componentType`,c.componentType);c._data=this._loadAccessorAsync(a,c,o)}else{const o=Y.Get(`${a}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((o=>ma._GetTypedArray(a,c.componentType,o,c.byteOffset,c.count)))}return c._data}_loadVertexBufferViewAsync(a){if(a._babylonBuffer)return a._babylonBuffer;const c=this._babylonScene.getEngine();return a._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then((a=>new w.d(c,a,!1))),a._babylonBuffer}_loadVertexAccessorAsync(a,c,o){var s;if(null!==(s=c._babylonVertexBuffer)&&void 0!==s&&s[o])return c._babylonVertexBuffer[o];c._babylonVertexBuffer||(c._babylonVertexBuffer={});const q=this._babylonScene.getEngine();if(c.sparse||void 0==c.bufferView)c._babylonVertexBuffer[o]=this._loadFloatAccessorAsync(a,c).then((a=>new w.g(q,a,o,!1)));else{const s=Y.Get(`${a}/bufferView`,this._gltf.bufferViews,c.bufferView);c._babylonVertexBuffer[o]=this._loadVertexBufferViewAsync(s).then((t=>{const i=ma._GetNumComponents(a,c.type);return new w.g(q,t,o,!1,void 0,s.byteStride,void 0,c.byteOffset,i,c.componentType,c.normalized,!0,void 0,!0)}))}return c._babylonVertexBuffer[o]}_loadMaterialMetallicRoughnessPropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const s=new Array;return c&&(c.baseColorFactor?(o.albedoColor=t.oo.qo(c.baseColorFactor),o.alpha=c.baseColorFactor[3]):o.albedoColor=t.oo.White(),o.metallic=void 0==c.metallicFactor?1:c.metallicFactor,o.roughness=void 0==c.roughnessFactor?1:c.roughnessFactor,c.baseColorTexture&&s.push(this.loadTextureInfoAsync(`${a}/baseColorTexture`,c.baseColorTexture,(a=>{a.name=`${o.name} (Base Color)`,o.albedoTexture=a}))),c.metallicRoughnessTexture&&(c.metallicRoughnessTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${a}/metallicRoughnessTexture`,c.metallicRoughnessTexture,(a=>{a.name=`${o.name} (Metallic Roughness)`,o.metallicTexture=a}))),o.useMetallnessFromMetallicTextureBlue=!0,o.useRoughnessFromMetallicTextureGreen=!0,o.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(s).then((()=>{}))}_loadMaterialAsync(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const t=this._extensionsLoadMaterialAsync(a,c,o,s,q);if(t)return t;c._data=c._data||{};let i=c._data[s];if(!i){this.logOpen(`${a} ${c.name||""}`);const o=this.createMaterial(a,c,s);i={babylonMaterial:o,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(a,c,o)},c._data[s]=i,ma.AddPointerMetadata(o,a),this._parent.onMaterialLoadedObservable.notifyObservers(o),this.logClose()}return o&&(i.babylonMeshes.push(o),o.gc.addOnce((()=>{const a=i.babylonMeshes.indexOf(o);-1!==a&&i.babylonMeshes.splice(a,1)}))),q(i.babylonMaterial),i.promise.then((()=>i.babylonMaterial))}_createDefaultMaterial(a,c){this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new n.b(a,this._babylonScene);return o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.fillMode=c,o.enableSpecularAntiAliasing=!0,o.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,o.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,o.transparencyMode=n.b.PBRMATERIAL_OPAQUE,o.metallic=1,o.roughness=1,o}createMaterial(a,c,o){const s=this._extensionsCreateMaterial(a,c,o);if(s)return s;const q=c.name||`material${c.index}`;return this._createDefaultMaterial(q,o)}loadMaterialPropertiesAsync(a,c,o){const s=this._extensionsLoadMaterialPropertiesAsync(a,c,o);if(s)return s;const q=new Array;return q.push(this.loadMaterialBasePropertiesAsync(a,c,o)),c.pbrMetallicRoughness&&q.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${a}/pbrMetallicRoughness`,c.pbrMetallicRoughness,o)),this.loadMaterialAlphaProperties(a,c,o),Promise.all(q).then((()=>{}))}loadMaterialBasePropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const s=new Array;return o.emissiveColor=c.emissiveFactor?t.oo.qo(c.emissiveFactor):new t.oo(0,0,0),c.doubleSided&&(o.Fc=!1,o.twoSidedLighting=!0),c.normalTexture&&(c.normalTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${a}/normalTexture`,c.normalTexture,(a=>{a.name=`${o.name} (Normal)`,o.bumpTexture=a}))),o.invertNormalMapX=!this._babylonScene.useRightHandedSystem,o.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=c.normalTexture.scale&&o.bumpTexture&&(o.bumpTexture.level=c.normalTexture.scale),o.forceIrradianceInFragment=!0),c.occlusionTexture&&(c.occlusionTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${a}/occlusionTexture`,c.occlusionTexture,(a=>{a.name=`${o.name} (Occlusion)`,o.ambientTexture=a}))),o.useAmbientInGrayScale=!0,void 0!=c.occlusionTexture.strength&&(o.ambientTextureStrength=c.occlusionTexture.strength)),c.emissiveTexture&&s.push(this.loadTextureInfoAsync(`${a}/emissiveTexture`,c.emissiveTexture,(a=>{a.name=`${o.name} (Emissive)`,o.emissiveTexture=a}))),Promise.all(s).then((()=>{}))}loadMaterialAlphaProperties(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);switch(c.alphaMode||"OPAQUE"){case"OPAQUE":o.transparencyMode=n.b.PBRMATERIAL_OPAQUE,o.alpha=1;break;case"MASK":o.transparencyMode=n.b.PBRMATERIAL_ALPHATEST,o.alphaCutOff=void 0==c.alphaCutoff?.5:c.alphaCutoff,o.albedoTexture&&(o.albedoTexture.Uc=!0);break;case"BLEND":o.transparencyMode=n.b.PBRMATERIAL_ALPHABLEND,o.albedoTexture&&(o.albedoTexture.Uc=!0,o.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${a}/alphaMode: Invalid value (${c.alphaMode})`)}}loadTextureInfoAsync(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const s=this._extensionsLoadTextureInfoAsync(a,c,o);if(s)return s;if(this.logOpen(`${a}`),c.texCoord>=6)throw new Error(`${a}/texCoord: Invalid value (${c.texCoord})`);const q=Y.Get(`${a}/index`,this._gltf.textures,c.index);q._textureInfo=c;const t=this._loadTextureAsync(`/textures/${c.index}`,q,(s=>{s.coordinatesIndex=c.texCoord||0,ma.AddPointerMetadata(s,a),this._parent.onTextureLoadedObservable.notifyObservers(s),o(s)}));return this.logClose(),t}_loadTextureAsync(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const s=this._extensionsLoadTextureAsync(a,c,o);if(s)return s;this.logOpen(`${a} ${c.name||""}`);const q=void 0==c.sampler?ma.DefaultSampler:Y.Get(`${a}/sampler`,this._gltf.samplers,c.sampler),t=Y.Get(`${a}/source`,this._gltf.images,c.source),i=this._createTextureAsync(a,q,t,o,void 0,!c._textureInfo.nonColorData);return this.logClose(),i}_createTextureAsync(a,c,o){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},t=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;const p=this._loadSampler(`/samplers/${c.index}`,c),G=new Array,T=new s;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C={noMipmap:p.noMipMaps,invertY:!1,samplingMode:p.samplingMode,A:()=>{this._disposed||T.resolve()},onError:(c,o)=>{this._disposed||T.reject(new Error(`${a}: ${o&&o.message?o.message:c||"Failed to load texture"}`))},mimeType:o.mimeType??(0,X.e)(o.uri??""),loaderOptions:t,useSRGBBuffer:!!i&&this._parent.useSRGBBuffers},j=new f.e(null,this._babylonScene,C);return j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.push(T.promise),G.push(this.loadImageAsync(`/images/${o.index}`,o).then((a=>{const c=o.uri||`${this._fileName}#image${o.index}`,s=`data:${this._uniqueRootUrl}${c}`;j.updateURL(s,a);const q=j.getInternalTexture();q&&(q.label=o.name)}))),j.wrapU=p.wrapU,j.wrapV=p.wrapV,q(j),this._parent.useGltfTextureNames&&(j.name=o.name||o.uri||`image${o.index}`),Promise.all(G).then((()=>j))}_loadSampler(a,c){return c._data||(c._data={noMipMaps:9728===c.minFilter||9729===c.minFilter,samplingMode:ma._GetTextureSamplingMode(a,c),wrapU:ma._GetTextureWrapMode(`${a}/wrapS`,c.wrapS),wrapV:ma._GetTextureWrapMode(`${a}/wrapT`,c.wrapT)}),c._data}loadImageAsync(a,c){if(!c._data){if(this.logOpen(`${a} ${c.name||""}`),c.uri)c._data=this.loadUriAsync(`${a}/uri`,c,c.uri);else{const o=Y.Get(`${a}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}this.logClose()}return c._data}loadUriAsync(a,c,o){const s=this._extensionsLoadUriAsync(a,c,o);if(s)return s;if(!ma._ValidateUri(o))throw new Error(`${a}: '${o}' is invalid`);if((0,X.h)(o)){const c=new Uint8Array((0,X.b)(o));return this.log(`${a}: Decoded ${o.substring(0,64)}... (${c.length} bytes)`),Promise.resolve(c)}return this.log(`${a}: Loading ${o}`),this._parent.preprocessUrlAsync(this._rootUrl+o).then((c=>new Promise(((s,q)=>{this._parent._loadFile(this._babylonScene,c,(c=>{this._disposed||(this.log(`${a}: Loaded ${o} (${c.byteLength} bytes)`),s(new Uint8Array(c)))}),!0,(c=>{q(new X.j(`${a}: Failed to load '${o}'${c?": "+c.status+" "+c.statusText:""}`,c))}))}))))}static AddPointerMetadata(a,c){a.metadata=a.metadata||{};const o=a._internalMetadata=a._internalMetadata||{},s=o.nc=o.nc||{};(s.pointers=s.pointers||[]).push(c)}static _GetTextureWrapMode(a,c){switch(c=void 0==c?10497:c){case 33071:return f.e.CLAMP_ADDRESSMODE;case 33648:return f.e.MIRROR_ADDRESSMODE;case 10497:return f.e.WRAP_ADDRESSMODE;default:return M.c.Warn(`${a}: Invalid value (${c})`),f.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(a,c){const o=void 0==c.magFilter?9729:c.magFilter,s=void 0==c.minFilter?9987:c.minFilter;if(9729===o)switch(s){case 9728:return f.e.LINEAR_NEAREST;case 9729:return f.e.LINEAR_LINEAR;case 9984:return f.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return f.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return f.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return f.e.LINEAR_LINEAR_MIPLINEAR;default:return M.c.Warn(`${a}/minFilter: Invalid value (${s})`),f.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==o&&M.c.Warn(`${a}/magFilter: Invalid value (${o})`),s){case 9728:return f.e.NEAREST_NEAREST;case 9729:return f.e.NEAREST_LINEAR;case 9984:return f.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return f.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return f.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return f.e.NEAREST_LINEAR_MIPLINEAR;default:return M.c.Warn(`${a}/minFilter: Invalid value (${s})`),f.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(a,c){try{return(0,I.u)(c)}catch(o){throw new Error(`${a}: ${o.message}`)}}static _GetTypedArray(a,c,o,s,q){const t=o.buffer;s=o.byteOffset+(s||0);const i=ma._GetTypedArrayConstructor(`${a}/componentType`,c),p=w.g.GetTypeByteLength(c);return s%p!==0?(M.c.Warn(`${a}: Copying buffer as byte offset (${s}) is not a multiple of component type byte length (${p})`),new i(t.slice(s,s+q*p),0)):new i(t,s,q)}static _GetNumComponents(a,c){switch(c){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${a}: Invalid type (${c})`)}static _ValidateUri(a){return i.Tools.IsBase64(a)||-1===a.indexOf("..")}static _GetDrawMode(a,c){switch(void 0==c&&(c=4),c){case 0:return k.b.PointListDrawMode;case 1:return k.b.LineListDrawMode;case 2:return k.b.LineLoopDrawMode;case 3:return k.b.LineStripDrawMode;case 4:return k.b.TriangleFillMode;case 5:return k.b.TriangleStripDrawMode;case 6:return k.b.TriangleFanDrawMode}throw new Error(`${a}: Invalid mesh primitive mode (${c})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const a=new Array;if(this._gltf.materials)for(const c of this._gltf.materials)if(c._data)for(const o in c._data){const s=c._data[o];for(const c of s.babylonMeshes){c.Rc(!0);const o=s.babylonMaterial;a.push(o.forceCompilationAsync(c)),a.push(o.forceCompilationAsync(c,{useInstances:!0})),this._parent.useClipPlane&&(a.push(o.forceCompilationAsync(c,{clipPlane:!0})),a.push(o.forceCompilationAsync(c,{clipPlane:!0,useInstances:!0})))}}return Promise.all(a).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const a=new Array,c=this._babylonScene.lights;for(const o of c){const c=o.getShadowGenerator();c&&a.push(c.forceCompilationAsync())}return Promise.all(a).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(a){for(const c of this._extensions)c.enabled&&a(c)}_applyExtensions(a,c,o){for(const s of this._extensions)if(s.enabled){const q=`${s.name}.${c}`,t=a;t._activeLoaderExtensionFunctions=t._activeLoaderExtensionFunctions||{};const i=t._activeLoaderExtensionFunctions;if(!i[q]){i[q]=!0;try{const a=o(s);if(a)return a}finally{delete i[q]}}}return null}_extensionsOnLoading(){this._forEachExtensions((a=>a.onLoading&&a.onLoading()))}_extensionsOnReady(){this._forEachExtensions((a=>a.onReady&&a.onReady()))}_extensionsLoadSceneAsync(a,c){return this._applyExtensions(c,"loadScene",(o=>o.loadSceneAsync&&o.loadSceneAsync(a,c)))}_extensionsLoadNodeAsync(a,c,o){return this._applyExtensions(c,"loadNode",(s=>s.loadNodeAsync&&s.loadNodeAsync(a,c,o)))}_extensionsLoadCameraAsync(a,c,o){return this._applyExtensions(c,"loadCamera",(s=>s.loadCameraAsync&&s.loadCameraAsync(a,c,o)))}_extensionsLoadVertexDataAsync(a,c,o){return this._applyExtensions(c,"loadVertexData",(s=>s._loadVertexDataAsync&&s._loadVertexDataAsync(a,c,o)))}_extensionsLoadMeshPrimitiveAsync(a,c,o,s,q,t){return this._applyExtensions(q,"loadMeshPrimitive",(i=>i._loadMeshPrimitiveAsync&&i._loadMeshPrimitiveAsync(a,c,o,s,q,t)))}_extensionsLoadMaterialAsync(a,c,o,s,q){return this._applyExtensions(c,"loadMaterial",(t=>t._loadMaterialAsync&&t._loadMaterialAsync(a,c,o,s,q)))}_extensionsCreateMaterial(a,c,o){return this._applyExtensions(c,"createMaterial",(s=>s.createMaterial&&s.createMaterial(a,c,o)))}_extensionsLoadMaterialPropertiesAsync(a,c,o){return this._applyExtensions(c,"loadMaterialProperties",(s=>s.loadMaterialPropertiesAsync&&s.loadMaterialPropertiesAsync(a,c,o)))}_extensionsLoadTextureInfoAsync(a,c,o){return this._applyExtensions(c,"loadTextureInfo",(s=>s.loadTextureInfoAsync&&s.loadTextureInfoAsync(a,c,o)))}_extensionsLoadTextureAsync(a,c,o){return this._applyExtensions(c,"loadTexture",(s=>s._loadTextureAsync&&s._loadTextureAsync(a,c,o)))}_extensionsLoadAnimationAsync(a,c){return this._applyExtensions(c,"loadAnimation",(o=>o.loadAnimationAsync&&o.loadAnimationAsync(a,c)))}_extensionsLoadAnimationChannelAsync(a,c,o,s,q){return this._applyExtensions(o,"loadAnimationChannel",(t=>t._loadAnimationChannelAsync&&t._loadAnimationChannelAsync(a,c,o,s,q)))}_extensionsLoadSkinAsync(a,c,o){return this._applyExtensions(o,"loadSkin",(s=>s._loadSkinAsync&&s._loadSkinAsync(a,c,o)))}_extensionsLoadUriAsync(a,c,o){return this._applyExtensions(c,"loadUri",(s=>s._loadUriAsync&&s._loadUriAsync(a,c,o)))}_extensionsLoadBufferViewAsync(a,c){return this._applyExtensions(c,"loadBufferView",(o=>o.loadBufferViewAsync&&o.loadBufferViewAsync(a,c)))}_extensionsLoadBufferAsync(a,c,o,s){return this._applyExtensions(c,"loadBuffer",(q=>q.loadBufferAsync&&q.loadBufferAsync(a,c,o,s)))}static LoadExtensionAsync(a,c,o,s){if(!c.extensions)return null;const q=c.extensions[o];return q?s(`${a}/extensions/${o}`,q):null}static LoadExtraAsync(a,c,o,s){if(!c.extras)return null;const q=c.extras[o];return q?s(`${a}/extras/${o}`,q):null}isExtensionUsed(a){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(a)}logOpen(a){this._parent._logOpen(a)}logClose(){this._parent._logClose()}log(a){this._parent._log(a)}startPerformanceCounter(a){this._parent._startPerformanceCounter(a)}endPerformanceCounter(a){this._parent._endPerformanceCounter(a)}}ma.DefaultSampler={index:-1},d.d._CreateGLTF2Loader=a=>new ma(a);var V=o(14349),E=o(12993),H=o(12845),b=o(14353),A=o(14358);class v extends A.b{constructor(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",a),this._texture=a.getEngine().createRawCubeTexture(c,o,s,q,t,i,p,G)}update(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,a,c,o,s,q)}updateRGBDAsync(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,b.g)(this._texture,a,c,o,s).then((()=>{}))}clone(){return H.d.Clone((()=>{const a=this.Za(),c=this._texture,o=new v(a,c._bufferViewArray,c.width,c.format,c.type,c.generateMipMaps,c.invertY,c.samplingMode,c._compression);return 13===c.source&&o.updateRGBDAsync(c._bufferViewArrayArray,c._sphericalPolynomial,c._lodGenerationScale,c._lodGenerationOffset),o}),this)}}const l="EXT_lights_image_based";class Q{constructor(a){this.name=l,this._loader=a,this.enabled=this._loader.isExtensionUsed(l)}dispose(){this._loader=null,delete this._lights}onLoading(){const a=this._loader.nc.extensions;if(a&&a[this.name]){const c=a[this.name];this._lights=c.lights}}loadSceneAsync(a,c){return ma.LoadExtensionAsync(a,c,this.name,(async(o,s)=>{this._loader._allMaterialsDirtyRequired=!0;const q=new Array;q.push(this._loader.loadSceneAsync(a,c)),this._loader.logOpen(`${o}`);const t=Y.Get(`${o}/light`,this._lights,s.Cc);return q.push(this._loadLightAsync(`/extensions/${this.name}/lights/${s.Cc}`,t).then((a=>{this._loader.babylonScene.environmentTexture=a}))),this._loader.logClose(),await Promise.all(q).then((()=>{}))}))}_loadLightAsync(a,c){if(!c._loaded){const o=new Array;this._loader.logOpen(`${a}`);const s=new Array(c.specularImages.length);for(let q=0;q<c.specularImages.length;q++){const t=c.specularImages[q];s[q]=new Array(t.length);for(let c=0;c<t.length;c++){const i=`${a}/specularImages/${q}/${c}`;this._loader.logOpen(`${i}`);const p=t[c],G=Y.Get(i,this._loader.nc.images,p);o.push(this._loader.loadImageAsync(`/images/${p}`,G).then((a=>{s[q][c]=a}))),this._loader.logClose()}}this._loader.logClose(),c._loaded=Promise.all(o).then((async()=>{const o=new v(this._loader.babylonScene,null,c.specularImageSize);if(o.name=c.name||"environment",c._babylonTexture=o,void 0!=c.bc&&(o.level=c.bc),c.rotation){let a=q.Quaternion.qo(c.rotation);this._loader.babylonScene.useRightHandedSystem||(a=q.Quaternion.Inverse(a)),q.Matrix.FromQuaternionToRef(a,o.getReflectionTextureMatrix())}if(!c.irradianceCoefficients)throw new Error(`${a}: Irradiance coefficients are missing`);const t=E.d.qo(c.irradianceCoefficients);t.scaleInPlace(c.bc),t.convertIrradianceToLambertianRadiance();const i=E.e.FromHarmonics(t),p=(s.length-1)/Math.log2(c.specularImageSize);return await o.updateRGBDAsync(s,i,p)}))}return c._loaded.then((()=>c._babylonTexture))}}u(l),B(l,!0,(a=>new Q(a)));o(13363);const z="EXT_mesh_gpu_instancing";class aa{constructor(a){this.name=z,this._loader=a,this.enabled=this._loader.isExtensionUsed(z)}dispose(){this._loader=null}loadNodeAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(a,s)=>{this._loader._disableInstancedMesh++;const t=this._loader.loadNodeAsync(`/nodes/${c.index}`,c,o);if(this._loader._disableInstancedMesh--,!c._primitiveBabylonMeshes)return await t;const i=new Array;let p=0;const G=c=>{if(void 0==s.attributes[c])return void i.push(Promise.resolve(null));const o=Y.Get(`${a}/attributes/${c}`,this._loader.nc.accessors,s.attributes[c]);if(i.push(this._loader._loadFloatAccessorAsync(`/accessors/${o.bufferView}`,o)),0===p)p=o.count;else if(p!==o.count)throw new Error(`${a}/attributes: Instance buffer accessors do not have the same count.`)};return G("TRANSLATION"),G("ROTATION"),G("SCALE"),await t.then((async a=>{const[o,s,t]=await Promise.all(i),G=new Float32Array(16*p);q.TmpVectors.Hc[0].Bc(0,0,0),q.TmpVectors.Quaternion[0].Bc(0,0,0,1),q.TmpVectors.Hc[1].Bc(1,1,1);for(let c=0;c<p;++c)o&&q.Hc.FromArrayToRef(o,3*c,q.TmpVectors.Hc[0]),s&&q.Quaternion.FromArrayToRef(s,4*c,q.TmpVectors.Quaternion[0]),t&&q.Hc.FromArrayToRef(t,3*c,q.TmpVectors.Hc[1]),q.Matrix.ComposeToRef(q.TmpVectors.Hc[1],q.TmpVectors.Quaternion[0],q.TmpVectors.Hc[0],q.TmpVectors.Matrix[0]),q.TmpVectors.Matrix[0].copyToArray(G,16*c);for(const q of c._primitiveBabylonMeshes)q.iL("matrix",G,16,!0);return a}))}))}}u(z),B(z,!0,(a=>new aa(a)));let ca=0,oa=null;class sa{static get Default(){return sa._Default||(sa._Default=new sa),sa._Default}constructor(){const a=sa.Configuration.decoder;this._decoderModulePromise=i.Tools.LoadBabylonScriptAsync(a.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(a,c,o,s,q){await this._decoderModulePromise,0===ca&&(MeshoptDecoder.useWorkers(1),ca=1);const t=await MeshoptDecoder.decodeGltfBufferAsync(c,o,a,s,q);return null!==oa&&clearTimeout(oa),oa=setTimeout((()=>{MeshoptDecoder.useWorkers(0),ca=0,oa=null}),1e3),t}}sa.Configuration={decoder:{url:`${i.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},sa._Default=null;const qa="EXT_meshopt_compression";class ta{constructor(a){this.name=qa,this.enabled=a.isExtensionUsed(qa),this._loader=a}dispose(){this._loader=null}loadBufferViewAsync(a,c){return ma.LoadExtensionAsync(a,c,this.name,(async(o,s)=>{const q=c;if(q._meshOptData)return await q._meshOptData;const t=Y.Get(`${a}/buffer`,this._loader.nc.buffers,s.buffer);return q._meshOptData=this._loader.loadBufferAsync(`/buffers/${t.index}`,t,s.byteOffset||0,s.byteLength).then((async a=>await sa.Default.decodeGltfBufferAsync(a,s.count,s.byteStride,s.mode,s.filter))),await q._meshOptData}))}}u(qa),B(qa,!0,(a=>new ta(a)));const ia="EXT_texture_webp";class pa{constructor(a){this.name=ia,this._loader=a,this.enabled=a.isExtensionUsed(ia)}dispose(){this._loader=null}_loadTextureAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=void 0==c.sampler?ma.DefaultSampler:Y.Get(`${a}/sampler`,this._loader.nc.samplers,c.sampler),i=Y.Get(`${s}/source`,this._loader.nc.images,q.source);return await this._loader._createTextureAsync(a,t,i,(a=>{o(a)}),void 0,!c._textureInfo.nonColorData)}))}}u(ia),B(ia,!0,(a=>new pa(a)));const Ga="EXT_texture_avif";class Ta{constructor(a){this.name=Ga,this._loader=a,this.enabled=a.isExtensionUsed(Ga)}dispose(){this._loader=null}_loadTextureAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=void 0==c.sampler?ma.DefaultSampler:Y.Get(`${a}/sampler`,this._loader.nc.samplers,c.sampler),i=Y.Get(`${s}/source`,this._loader.nc.images,q.source);return await this._loader._createTextureAsync(a,t,i,(a=>{o(a)}),void 0,!c._textureInfo.nonColorData)}))}}u(Ga),B(Ga,!0,(a=>new Ta(a)));var Ca=o(14347),ja=o(13344);const La="EXT_lights_ies";class ea{constructor(a){this.name=La,this._loader=a,this.enabled=this._loader.isExtensionUsed(La)}dispose(){this._loader=null,delete this._lights}onLoading(){const a=this._loader.nc.extensions;if(a&&a[this.name]){const c=a[this.name];this._lights=c.lights,Y.Assign(this._lights)}}loadNodeAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,i)=>{let p,G;this._loader._allMaterialsDirtyRequired=!0;const T=await this._loader.loadNodeAsync(a,c,(a=>{G=Y.Get(s,this._lights,i.Cc);const c=G.name||a.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,p=new Ca.d(c,q.Hc.Zero(),q.Hc.Backward(),0,1,this._loader.babylonScene),p.angle=Math.PI/2,p.innerAngle=0,p._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,G._babylonLight=p,p.falloffType=ja.e.FALLOFF_GLTF,p.Ac=i.color?t.oo.qo(i.color):t.oo.White(),p.bc=i.multiplier||1,p.range=Number.MAX_VALUE,p.parent=a,this._loader._babylonLights.push(p),ma.AddPointerMetadata(p,s),o(a)}));let C;if(G.uri)C=await this._loader.loadUriAsync(a,G,G.uri);else{const c=Y.Get(`${a}/bufferView`,this._loader.nc.bufferViews,G.bufferView);C=await this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c)}return p.iesProfileTexture=new f.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,C,!0,void 0,void 0,void 0,void 0,".ies"),T}))}}u(La),B(La,!0,(a=>new ea(a)));var ga=o(14369);const Ma="KHR_draco_mesh_compression";class Na{constructor(a){this.name=Ma,this.useNormalizedFlagFromAccessor=!0,this._loader=a,this.enabled=ga.e.DefaultAvailable&&this._loader.isExtensionUsed(Ma)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{if(void 0!=c.mode&&4!==c.mode&&5!==c.mode)throw new Error(`${a}: Unsupported mode ${c.mode}`);const t={},i={},p=(a,s)=>{const p=q.attributes[a];if(void 0!=p&&(o._delayInfo=o._delayInfo||[],-1===o._delayInfo.indexOf(s)&&o._delayInfo.push(s),t[s]=p,this.useNormalizedFlagFromAccessor)){const o=Y.TryGet(this._loader.nc.accessors,c.attributes[a]);o&&(i[s]=o.normalized||!1)}};p("POSITION",w.g.PositionKind),p("NORMAL",w.g.NormalKind),p("TANGENT",w.g.TangentKind),p("TEXCOORD_0",w.g.UVKind),p("TEXCOORD_1",w.g.UV2Kind),p("TEXCOORD_2",w.g.UV3Kind),p("TEXCOORD_3",w.g.UV4Kind),p("TEXCOORD_4",w.g.UV5Kind),p("TEXCOORD_5",w.g.UV6Kind),p("JOINTS_0",w.g.MatricesIndicesKind),p("WEIGHTS_0",w.g.MatricesWeightsKind),p("COLOR_0",w.g.ColorKind);const G=Y.Get(s,this._loader.nc.bufferViews,q.bufferView);return G._dracoBabylonGeometry||(G._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((async s=>{const q=this.dracoDecoder||ga.e.Default,p=Y.TryGet(this._loader.nc.accessors,c.attributes.POSITION),G=this._loader.parent.alwaysComputeBoundingBox||o.skeleton||!p?null:P(p);return await q._decodeMeshToGeometryForGltfAsync(o.name,this._loader.babylonScene,s,t,i,G).catch((c=>{throw new Error(`${a}: ${c.message}`)}))}))),await G._dracoBabylonGeometry}))}}u(Ma),B(Ma,!0,(a=>new Na(a)));var ya=o(14373),ka=o(12798),na=o(12800),fa=o(13211),Ja=o(13392),wa=o(12776);fa.b.AddNodeConstructor("Light_Type_0",((a,c)=>()=>new Za(a,q.Hc.Zero(),c)));class Za extends Ja.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(a){this._shadowAngle=a,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(a){const c=this.needCube();if(this._direction=a,this.needCube()!==c&&this._shadowGenerators){const a=this._shadowGenerators.values();for(let c=a.next();!0!==c.done;c=a.next()){c.value.recreateShadowMap()}}}constructor(a,c,o){super(a,o),this._shadowAngle=Math.PI/2,this.position=c}getClassName(){return"PointLight"}getTypeID(){return ja.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(a){if(this.direction)return super.getShadowDirection(a);switch(a){case 0:return new q.Hc(1,0,0);case 1:return new q.Hc(-1,0,0);case 2:return new q.Hc(0,-1,0);case 3:return new q.Hc(0,1,0);case 4:return new q.Hc(0,0,1);case 5:return new q.Hc(0,0,-1)}return q.Hc.Zero()}_setDefaultShadowProjectionMatrix(a,c,o){const s=this.Za().activeCamera;if(!s)return;const t=void 0!==this.shadowMinZ?this.shadowMinZ:s.rc,i=void 0!==this.shadowMaxZ?this.shadowMaxZ:s.maxZ,p=this.Za().getEngine().o;q.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,p?i:t,p?t:i,a,!0,this._scene.getEngine().isNDCHalfZRange,void 0,p)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(a,c){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,c):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,c),this}transferToNodeMaterialEffect(a,c){return this.computeTransformedInformation()?a.setFloat3(c,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):a.setFloat3(c,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(a,c){a["POINTLIGHT"+c]=!0}}(0,ka.d)([(0,na.E)()],Za.prototype,"shadowAngle",null),(0,wa.d)("BABYLON.PointLight",Za);const ha="KHR_lights_punctual";class Ua{constructor(a){this.name=ha,this._loader=a,this.enabled=this._loader.isExtensionUsed(ha)}dispose(){this._loader=null,delete this._lights}onLoading(){const a=this._loader.nc.extensions;if(a&&a[this.name]){const c=a[this.name];this._lights=c.lights,Y.Assign(this._lights)}}loadNodeAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,i)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(a,c,(a=>{let c;const p=Y.Get(s,this._lights,i.Cc),G=p.name||a.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,p.type){case"directional":{const a=new ya.c(G,q.Hc.Backward(),this._loader.babylonScene);a.position.Dc(0),c=a;break}case"point":c=new Za(G,q.Hc.Zero(),this._loader.babylonScene);break;case"spot":{const a=new Ca.d(G,q.Hc.Zero(),q.Hc.Backward(),0,1,this._loader.babylonScene);a.angle=2*(p.spot&&p.spot.outerConeAngle||Math.PI/4),a.innerAngle=2*(p.spot&&p.spot.innerConeAngle||0),c=a;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${s}: Invalid light type (${p.type})`)}c._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,p._babylonLight=c,c.falloffType=ja.e.FALLOFF_GLTF,c.Ac=p.color?t.oo.qo(p.color):t.oo.White(),c.bc=void 0==p.bc?1:p.bc,c.range=void 0==p.range?Number.MAX_VALUE:p.range,c.parent=a,this._loader._babylonLights.push(c),ma.AddPointerMetadata(c,s),o(a)})))))}}u(ha),B(ha,!0,(a=>new Ua(a)));const Sa="KHR_materials_pbrSpecularGlossiness";class ra{constructor(a){this.name=Sa,this.order=200,this._loader=a,this.enabled=this._loader.isExtensionUsed(Sa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;return t.push(this._loader.loadMaterialBasePropertiesAsync(a,c,o)),t.push(this._loadSpecularGlossinessPropertiesAsync(s,q,o)),this._loader.loadMaterialAlphaProperties(a,c,o),await Promise.all(t).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const s=new Array;return o.metallic=null,o.roughness=null,c.diffuseFactor?(o.albedoColor=t.oo.qo(c.diffuseFactor),o.alpha=c.diffuseFactor[3]):o.albedoColor=t.oo.White(),o.reflectivityColor=c.specularFactor?t.oo.qo(c.specularFactor):t.oo.White(),o.microSurface=void 0==c.glossinessFactor?1:c.glossinessFactor,c.diffuseTexture&&s.push(this._loader.loadTextureInfoAsync(`${a}/diffuseTexture`,c.diffuseTexture,(a=>{a.name=`${o.name} (Diffuse)`,o.albedoTexture=a}))),c.specularGlossinessTexture&&(s.push(this._loader.loadTextureInfoAsync(`${a}/specularGlossinessTexture`,c.specularGlossinessTexture,(a=>{a.name=`${o.name} (Specular Glossiness)`,o.reflectivityTexture=a,o.reflectivityTexture.Uc=!0}))),o.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(s).then((()=>{}))}}u(Sa),B(Sa,!0,(a=>new ra(a)));const xa="KHR_materials_unlit";class Ra{constructor(a){this.name=xa,this.order=210,this._loader=a,this.enabled=this._loader.isExtensionUsed(xa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async()=>await this._loadUnlitPropertiesAsync(a,c,o)))}_loadUnlitPropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const s=new Array;o.unlit=!0;const q=c.pbrMetallicRoughness;return q&&(q.baseColorFactor?(o.albedoColor=t.oo.qo(q.baseColorFactor),o.alpha=q.baseColorFactor[3]):o.albedoColor=t.oo.White(),q.baseColorTexture&&s.push(this._loader.loadTextureInfoAsync(`${a}/baseColorTexture`,q.baseColorTexture,(a=>{a.name=`${o.name} (Base Color)`,o.albedoTexture=a})))),c.doubleSided&&(o.Fc=!1,o.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(a,c,o),Promise.all(s).then((()=>{}))}}u(xa),B(xa,!0,(a=>new Ra(a)));const da="KHR_materials_clearcoat";class Xa{constructor(a){this.name=da,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(da)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadClearCoatPropertiesAsync(s,q,o)),await Promise.all(t)}))}_loadClearCoatPropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const s=new Array;return o.clearCoat.isEnabled=!0,o.clearCoat.useRoughnessFromMainTexture=!1,o.clearCoat.remapF0OnInterfaceChange=!1,void 0!=c.clearcoatFactor?o.clearCoat.bc=c.clearcoatFactor:o.clearCoat.bc=0,c.clearcoatTexture&&s.push(this._loader.loadTextureInfoAsync(`${a}/clearcoatTexture`,c.clearcoatTexture,(a=>{a.name=`${o.name} (ClearCoat)`,o.clearCoat.texture=a}))),void 0!=c.clearcoatRoughnessFactor?o.clearCoat.roughness=c.clearcoatRoughnessFactor:o.clearCoat.roughness=0,c.clearcoatRoughnessTexture&&(c.clearcoatRoughnessTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${a}/clearcoatRoughnessTexture`,c.clearcoatRoughnessTexture,(a=>{a.name=`${o.name} (ClearCoat Roughness)`,o.clearCoat.textureRoughness=a})))),c.clearcoatNormalTexture&&(c.clearcoatNormalTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${a}/clearcoatNormalTexture`,c.clearcoatNormalTexture,(a=>{a.name=`${o.name} (ClearCoat Normal)`,o.clearCoat.bumpTexture=a}))),o.invertNormalMapX=!o.Za().useRightHandedSystem,o.invertNormalMapY=o.Za().useRightHandedSystem,void 0!=c.clearcoatNormalTexture.scale&&(o.clearCoat.bumpTexture.level=c.clearcoatNormalTexture.scale)),Promise.all(s).then((()=>{}))}}u(da),B(da,!0,(a=>new Xa(a)));const Wa="KHR_materials_iridescence";class Fa{constructor(a){this.name=Wa,this.order=195,this._loader=a,this.enabled=this._loader.isExtensionUsed(Wa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadIridescencePropertiesAsync(s,q,o)),await Promise.all(t).then((()=>{}))}))}_loadIridescencePropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const s=new Array;return o.iridescence.isEnabled=!0,o.iridescence.bc=c.iridescenceFactor??0,o.iridescence.indexOfRefraction=c.iridescenceIor??c.iridescenceIOR??1.3,o.iridescence.minimumThickness=c.iridescenceThicknessMinimum??100,o.iridescence.maximumThickness=c.iridescenceThicknessMaximum??400,c.iridescenceTexture&&s.push(this._loader.loadTextureInfoAsync(`${a}/iridescenceTexture`,c.iridescenceTexture,(a=>{a.name=`${o.name} (Iridescence)`,o.iridescence.texture=a}))),c.iridescenceThicknessTexture&&s.push(this._loader.loadTextureInfoAsync(`${a}/iridescenceThicknessTexture`,c.iridescenceThicknessTexture,(a=>{a.name=`${o.name} (Iridescence Thickness)`,o.iridescence.thicknessTexture=a}))),Promise.all(s).then((()=>{}))}}u(Wa),B(Wa,!0,(a=>new Fa(a)));const Oa="KHR_materials_anisotropy";class Ba{constructor(a){this.name=Oa,this.order=195,this._loader=a,this.enabled=this._loader.isExtensionUsed(Oa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadIridescencePropertiesAsync(s,q,o)),await Promise.all(t)}))}async _loadIridescencePropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const s=new Array;o.anisotropy.isEnabled=!0,o.anisotropy.bc=c.anisotropyStrength??0,o.anisotropy.angle=c.anisotropyRotation??0,c.anisotropyTexture&&(c.anisotropyTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${a}/anisotropyTexture`,c.anisotropyTexture,(a=>{a.name=`${o.name} (Anisotropy Intensity)`,o.anisotropy.texture=a})))),await Promise.all(s)}}u(Oa),B(Oa,!0,(a=>new Ba(a)));const ua="KHR_materials_emissive_strength";class Ka{constructor(a){this.name=ua,this.order=170,this._loader=a,this.enabled=this._loader.isExtensionUsed(ua)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>await this._loader.loadMaterialPropertiesAsync(a,c,o).then((()=>{this._loadEmissiveProperties(s,q,o)}))))}_loadEmissiveProperties(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);void 0!==c.emissiveStrength&&(o.emissiveIntensity=c.emissiveStrength)}}u(ua),B(ua,!0,(a=>new Ka(a)));const Da="KHR_materials_sheen";class Ia{constructor(a){this.name=Da,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(Da)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadSheenPropertiesAsync(s,q,o)),await Promise.all(t).then((()=>{}))}))}_loadSheenPropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const s=new Array;return o.sheen.isEnabled=!0,o.sheen.bc=1,void 0!=c.sheenColorFactor?o.sheen.color=t.oo.qo(c.sheenColorFactor):o.sheen.color=t.oo.Black(),c.sheenColorTexture&&s.push(this._loader.loadTextureInfoAsync(`${a}/sheenColorTexture`,c.sheenColorTexture,(a=>{a.name=`${o.name} (Sheen Color)`,o.sheen.texture=a}))),void 0!==c.sheenRoughnessFactor?o.sheen.roughness=c.sheenRoughnessFactor:o.sheen.roughness=0,c.sheenRoughnessTexture&&(c.sheenRoughnessTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${a}/sheenRoughnessTexture`,c.sheenRoughnessTexture,(a=>{a.name=`${o.name} (Sheen Roughness)`,o.sheen.textureRoughness=a})))),o.sheen.albedoScaling=!0,o.sheen.useRoughnessFromMainTexture=!1,Promise.all(s).then((()=>{}))}}u(Da),B(Da,!0,(a=>new Ia(a)));var Ya=o(13269);const Pa="KHR_materials_specular";class mc{constructor(a){this.name=Pa,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(Pa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;if(t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadSpecularPropertiesAsync(s,q,o)),q.extensions&&q.extensions.EXT_materials_specular_edge_color&&o instanceof n.b){q.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(o.brdf.dielectricSpecularModel=Ya.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,o.brdf.conductorSpecularModel=Ya.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(t).then((()=>{}))}))}_loadSpecularPropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const s=new Array;return void 0!==c.specularFactor&&(o.metallicF0Factor=c.specularFactor),void 0!==c.specularColorFactor&&(o.metallicReflectanceColor=t.oo.qo(c.specularColorFactor)),c.specularTexture&&(c.specularTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${a}/specularTexture`,c.specularTexture,(a=>{a.name=`${o.name} (Specular)`,o.metallicReflectanceTexture=a,o.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),c.specularColorTexture&&s.push(this._loader.loadTextureInfoAsync(`${a}/specularColorTexture`,c.specularColorTexture,(a=>{a.name=`${o.name} (Specular Color)`,o.reflectanceTexture=a}))),Promise.all(s).then((()=>{}))}}u(Pa),B(Pa,!0,(a=>new mc(a)));const Va="KHR_materials_ior";class Ea{constructor(a){this.name=Va,this.order=180,this._loader=a,this.enabled=this._loader.isExtensionUsed(Va)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadIorPropertiesAsync(s,q,o)),await Promise.all(t).then((()=>{}))}))}_loadIorPropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);return void 0!==c.ior?o.indexOfRefraction=c.ior:o.indexOfRefraction=Ea._DEFAULT_IOR,Promise.resolve()}}Ea._DEFAULT_IOR=1.5,u(Va),B(Va,!0,(a=>new Ea(a)));const Ha="KHR_materials_variants";class ba{constructor(a){this.name=Ha,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ha)}dispose(){this._loader=null}static GetAvailableVariants(a){const c=this._GetExtensionMetadata(a);return c?Object.keys(c.variants):[]}getAvailableVariants(a){return ba.GetAvailableVariants(a)}static SelectVariant(a,c){const o=this._GetExtensionMetadata(a);if(!o)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Ha} extension`);const s=a=>{const c=o.variants[a];if(c)for(const o of c)o.mesh.material=o.material};if(c instanceof Array)for(const q of c)s(q);else s(c);o.lastSelected=c}selectVariant(a,c){ba.SelectVariant(a,c)}static Reset(a){const c=this._GetExtensionMetadata(a);if(!c)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Ha} extension`);for(const o of c.original)o.mesh.material=o.material;c.lastSelected=null}reset(a){ba.Reset(a)}static GetLastSelectedVariant(a){const c=this._GetExtensionMetadata(a);if(!c)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Ha} extension`);return c.lastSelected}getLastSelectedVariant(a){return ba.GetLastSelectedVariant(a)}static _GetExtensionMetadata(a){var c,o;return(null===a||void 0===a||null===(c=a._internalMetadata)||void 0===c||null===(o=c.nc)||void 0===o?void 0:o[Ha])||null}onLoading(){const a=this._loader.nc.extensions;if(a&&a[this.name]){const c=a[this.name];this._variants=c.variants}}onReady(){const a=this._loader.rootBabylonMesh;if(a){var c;const o=this._loader.parent.extensionOptions[Ha];null!==o&&void 0!==o&&o.defaultVariant&&ba.SelectVariant(a,o.defaultVariant),null===o||void 0===o||null===(c=o.onLoaded)||void 0===c||c.call(o,{get variants(){return ba.GetAvailableVariants(a)},get selectedVariant(){const c=ba.GetLastSelectedVariant(a);return c?Array.isArray(c)?c[0]:c:ba.GetAvailableVariants(a)[0]},set selectedVariant(c){ba.SelectVariant(a,c)}})}}_loadMeshPrimitiveAsync(a,c,o,s,q,t){return ma.LoadExtensionAsync(a,q,this.name,(async(i,p)=>{const G=new Array;return G.push(this._loader._loadMeshPrimitiveAsync(a,c,o,s,q,(c=>{if(t(c),c instanceof U.c){const o=ma._GetDrawMode(a,q.mode),s=this._loader.rootBabylonMesh,t=s?s._internalMetadata=s._internalMetadata||{}:{},T=t.nc=t.nc||{},C=T[Ha]=T[Ha]||{lastSelected:null,original:[],variants:{}};C.original.push({mesh:c,material:c.material});for(let a=0;a<p.mappings.length;++a){const q=p.mappings[a],t=Y.Get(`${i}/mappings/${a}/material`,this._loader.nc.materials,q.material);G.push(this._loader._loadMaterialAsync(`#/materials/${q.material}`,t,c,o,(a=>{for(let o=0;o<q.variants.length;++o){const t=q.variants[o],i=Y.Get(`/extensions/${Ha}/variants/${t}`,this._variants,t);C.variants[i.name]=C.variants[i.name]||[],C.variants[i.name].push({mesh:c,material:a}),c.onClonedObservable.add((a=>{const o=a;let q=null,t=o;do{if(t=t.parent,!t)return;q=ba._GetExtensionMetadata(t)}while(null===q);if(s&&q===ba._GetExtensionMetadata(s)){t._internalMetadata={};for(const a in s._internalMetadata)t._internalMetadata[a]=s._internalMetadata[a];t._internalMetadata.nc=[];for(const a in s._internalMetadata.nc)t._internalMetadata.nc[a]=s._internalMetadata.nc[a];t._internalMetadata.nc[Ha]={lastSelected:null,original:[],variants:{}};for(const a of q.original)t._internalMetadata.nc[Ha].original.push({mesh:a.mesh,material:a.material});for(const a in q.variants)if(Object.prototype.hasOwnProperty.call(q.variants,a)){t._internalMetadata.nc[Ha].variants[a]=[];for(const c of q.variants[a])t._internalMetadata.nc[Ha].variants[a].push({mesh:c.mesh,material:c.material})}q=t._internalMetadata.nc[Ha]}for(const s of q.original)s.mesh===c&&(s.mesh=o);for(const s of q.variants[i.name])s.mesh===c&&(s.mesh=o)}))}})))}}}))),await Promise.all(G).then((a=>{let[c]=a;return c}))}))}}u(Ha),B(Ha,!0,(a=>new ba(a)));var Aa=o(12870);class va{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Ya.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(a,c){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...va._GetDefaultOptions(),...a},this._scene=c,this._scene._transmissionHelper=this,this.onErrorObservable=new C.d,this._scene.gc.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(a){if(!Object.keys(a).filter((c=>this._options[c]!==a[c])).length)return;const c={...this._options,...a},o=this._options;this._options=c,c.renderSize===o.renderSize&&c.renderTargetTextureType===o.renderTargetTextureType&&c.generateMipmaps===o.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=c.samples,this._opaqueRenderTarget.lodGenerationScale=c.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=c.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(a){return!!a&&!!(a instanceof n.b&&a.subSurface.isRefractionEnabled)}_addMesh(a){this._materialObservers[a.uniqueId]=a.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),i.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(a.material)?(a.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(a)&&this._transparentMeshesCache.push(a)):-1===this._opaqueMeshesCache.indexOf(a)&&this._opaqueMeshesCache.push(a)}))}_removeMesh(a){a.onMaterialChangedObservable.remove(this._materialObservers[a.uniqueId]),delete this._materialObservers[a.uniqueId];let c=this._transparentMeshesCache.indexOf(a);-1!==c&&this._transparentMeshesCache.splice(c,1),c=this._opaqueMeshesCache.indexOf(a),-1!==c&&this._opaqueMeshesCache.splice(c,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(a){const c=this._transparentMeshesCache.indexOf(a),o=this._opaqueMeshesCache.indexOf(a);this._shouldRenderAsTransmission(a.material)?(a.material instanceof n.b&&(a.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==o?(this._opaqueMeshesCache.splice(o,1),this._transparentMeshesCache.push(a)):-1===c&&this._transparentMeshesCache.push(a)):-1!==c?(this._transparentMeshesCache.splice(c,1),this._opaqueMeshesCache.push(a)):-1===o&&this._opaqueMeshesCache.push(a)}_isRenderTargetValid(){var a;return null!==(null===(a=this._opaqueRenderTarget)||void 0===a?void 0:a.getInternalTexture())}_setupRenderTargets(){var a;let c;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Aa.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(a=this._options.clearColor)||void 0===a?void 0:a.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((a=>{c=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?a.clearColor.G(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(a.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=c}));for(const o of this._transparentMeshesCache)this._shouldRenderAsTransmission(o.material)&&(o.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const la="KHR_materials_transmission";class Qa{constructor(a){this.name=la,this.order=175,this._loader=a,this.enabled=this._loader.isExtensionUsed(la),this.enabled&&(a.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadTransparentPropertiesAsync(s,c,o,q)),await Promise.all(t).then((()=>{}))}))}_loadTransparentPropertiesAsync(a,c,o,s){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const q=o;if(q.subSurface.isRefractionEnabled=!0,q.subSurface.volumeIndexOfRefraction=1,q.subSurface.useAlbedoToTintRefraction=!0,void 0===s.transmissionFactor)return q.subSurface.refractionIntensity=0,q.subSurface.isRefractionEnabled=!1,Promise.resolve();{var t;q.subSurface.refractionIntensity=s.transmissionFactor;const a=q.Za();if(q.subSurface.refractionIntensity&&!a._transmissionHelper)new va({},q.Za());else if(q.subSurface.refractionIntensity&&(null===(t=a._transmissionHelper)||void 0===t||!t._isRenderTargetValid())){var i;null===(i=a._transmissionHelper)||void 0===i||i._setupRenderTargets()}}return q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=0,s.transmissionTexture?(s.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${a}/transmissionTexture`,s.transmissionTexture,void 0).then((a=>{a.name=`${o.name} (Transmission)`,q.subSurface.refractionIntensityTexture=a,q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}u(la),B(la,!0,(a=>new Qa(a)));const za="KHR_materials_diffuse_transmission";class ac{constructor(a){this.name=za,this.order=174,this._loader=a,this.enabled=this._loader.isExtensionUsed(za),this.enabled&&(a.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadTranslucentPropertiesAsync(s,c,o,q)),await Promise.all(t).then((()=>{}))}))}_loadTranslucentPropertiesAsync(a,c,o,s){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const q=o;if(q.subSurface.isTranslucencyEnabled=!0,q.subSurface.volumeIndexOfRefraction=1,q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=0,q.subSurface.useAlbedoToTintTranslucency=!1,void 0===s.diffuseTransmissionFactor)return q.subSurface.translucencyIntensity=0,q.subSurface.isTranslucencyEnabled=!1,Promise.resolve();q.subSurface.translucencyIntensity=s.diffuseTransmissionFactor;const i=new Array;return q.subSurface.useGltfStyleTextures=!0,s.diffuseTransmissionTexture&&(s.diffuseTransmissionTexture.nonColorData=!0,i.push(this._loader.loadTextureInfoAsync(`${a}/diffuseTransmissionTexture`,s.diffuseTransmissionTexture).then((a=>{a.name=`${o.name} (Diffuse Transmission)`,q.subSurface.translucencyIntensityTexture=a})))),void 0!==s.diffuseTransmissionColorFactor?q.subSurface.translucencyColor=t.oo.qo(s.diffuseTransmissionColorFactor):q.subSurface.translucencyColor=t.oo.White(),s.diffuseTransmissionColorTexture&&i.push(this._loader.loadTextureInfoAsync(`${a}/diffuseTransmissionColorTexture`,s.diffuseTransmissionColorTexture).then((a=>{a.name=`${o.name} (Diffuse Transmission Color)`,q.subSurface.translucencyColorTexture=a}))),Promise.all(i).then((()=>{}))}}u(za),B(za,!0,(a=>new ac(a)));const cc="KHR_materials_volume";class oc{constructor(a){this.name=cc,this.order=173,this._loader=a,this.enabled=this._loader.isExtensionUsed(cc),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadVolumePropertiesAsync(s,c,o,q)),await Promise.all(t).then((()=>{}))}))}_loadVolumePropertiesAsync(a,c,o,s){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);if(!o.subSurface.isRefractionEnabled&&!o.subSurface.isTranslucencyEnabled||!s.thicknessFactor)return Promise.resolve();o.subSurface.volumeIndexOfRefraction=o.indexOfRefraction;const q=void 0!==s.attenuationDistance?s.attenuationDistance:Number.MAX_VALUE;return o.subSurface.tintColorAtDistance=q,void 0!==s.attenuationColor&&3==s.attenuationColor.length&&o.subSurface.tintColor.Bc(s.attenuationColor[0],s.attenuationColor[1],s.attenuationColor[2]),o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=s.thicknessFactor,o.subSurface.useThicknessAsDepth=!0,s.thicknessTexture?(s.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${a}/thicknessTexture`,s.thicknessTexture).then((a=>{a.name=`${o.name} (Thickness)`,o.subSurface.thicknessTexture=a,o.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}u(cc),B(cc,!0,(a=>new oc(a)));const sc="KHR_materials_dispersion";class qc{constructor(a){this.name=sc,this.order=174,this._loader=a,this.enabled=this._loader.isExtensionUsed(sc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadDispersionPropertiesAsync(s,c,o,q)),await Promise.all(t).then((()=>{}))}))}_loadDispersionPropertiesAsync(a,c,o,s){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);return o.subSurface.isRefractionEnabled&&s.dispersion?(o.subSurface.isDispersionEnabled=!0,o.subSurface.dispersion=s.dispersion,Promise.resolve()):Promise.resolve()}}u(sc),B(sc,!0,(a=>new qc(a)));const tc="EXT_materials_diffuse_roughness";class ic{constructor(a){this.name=tc,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(tc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(a,c,o)),t.push(this._loadDiffuseRoughnessPropertiesAsync(s,q,o)),await Promise.all(t).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(a,c,o){if(!(o instanceof n.b))throw new Error(`${a}: Material type not supported`);const s=new Array;return o.brdf.baseDiffuseModel=Ya.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=c.diffuseRoughnessFactor?o.baseDiffuseRoughness=c.diffuseRoughnessFactor:o.baseDiffuseRoughness=0,c.diffuseRoughnessTexture&&s.push(this._loader.loadTextureInfoAsync(`${a}/diffuseRoughnessTexture`,c.diffuseRoughnessTexture,(a=>{a.name=`${o.name} (Diffuse Roughness)`,o.baseDiffuseRoughnessTexture=a}))),Promise.all(s).then((()=>{}))}}u(tc),B(tc,!0,(a=>new ic(a)));const pc="KHR_mesh_quantization";class Gc{constructor(a){this.name=pc,this.enabled=a.isExtensionUsed(pc)}dispose(){}}u(pc),B(pc,!0,(a=>new Gc(a)));const Tc="KHR_texture_basisu";class Cc{constructor(a){this.name=Tc,this._loader=a,this.enabled=a.isExtensionUsed(Tc)}dispose(){this._loader=null}_loadTextureAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>{const t=void 0==c.sampler?ma.DefaultSampler:Y.Get(`${a}/sampler`,this._loader.nc.samplers,c.sampler),i=Y.Get(`${s}/source`,this._loader.nc.images,q.source);return await this._loader._createTextureAsync(a,t,i,(a=>{o(a)}),c._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!c._textureInfo.nonColorData)}))}}u(Tc),B(Tc,!0,(a=>new Cc(a)));const jc="KHR_texture_transform";class Lc{constructor(a){this.name=jc,this._loader=a,this.enabled=this._loader.isExtensionUsed(jc)}dispose(){this._loader=null}loadTextureInfoAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(s,q)=>await this._loader.loadTextureInfoAsync(a,c,(a=>{if(!(a instanceof f.e))throw new Error(`${s}: Texture type not supported`);q.offset&&(a.uOffset=q.offset[0],a.vOffset=q.offset[1]),a.uRotationCenter=0,a.vRotationCenter=0,q.rotation&&(a.wAng=-q.rotation),q.scale&&(a.uScale=q.scale[0],a.vScale=q.scale[1]),void 0!=q.texCoord&&(a.coordinatesIndex=q.texCoord),o(a)}))))}}u(jc),B(jc,!0,(a=>new Lc(a)));const ec="KHR_xmp_json_ld";class gc{constructor(a){this.name=ec,this.order=100,this._loader=a,this.enabled=this._loader.isExtensionUsed(ec)}dispose(){this._loader=null}onLoading(){var a,c,o;if(null===this._loader.rootBabylonMesh)return;const s=null===(a=this._loader.nc.extensions)||void 0===a?void 0:a.KHR_xmp_json_ld,q=null===(c=this._loader.nc.asset)||void 0===c||null===(o=c.extensions)||void 0===o?void 0:o.KHR_xmp_json_ld;if(s&&q){const a=+q.packet;s.packets&&a<s.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=s.packets[a])}}}function Mc(a,c,o,s){return t.oo.qo(c,o).scale(s)}function Nc(a,c,o,s){return c[o]*s}function yc(a,c,o,s){return-c[o]*s}function kc(a,c,o,s){return c[o+1]*s}function nc(a,c,o,s){return c[o]*s*2}function fc(a){return{scale:[new wc(L.b.ANIMATIONTYPE_FLOAT,`${a}.uScale`,Nc,(()=>2)),new wc(L.b.ANIMATIONTYPE_FLOAT,`${a}.vScale`,kc,(()=>2))],offset:[new wc(L.b.ANIMATIONTYPE_FLOAT,`${a}.uOffset`,Nc,(()=>2)),new wc(L.b.ANIMATIONTYPE_FLOAT,`${a}.vOffset`,kc,(()=>2))],rotation:[new wc(L.b.ANIMATIONTYPE_FLOAT,`${a}.wAng`,yc,(()=>1))]}}u(ec),B(ec,!0,(a=>new gc(a)));class Jc extends V.AnimationPropertyInfo{buildAnimations(a,c,o,s){return[{babylonAnimatable:a._babylonCamera,babylonAnimation:this._buildAnimation(c,o,s)}]}}class wc extends V.AnimationPropertyInfo{buildAnimations(a,c,o,s){const q=[];for(const t in a._data)q.push({babylonAnimatable:a._data[t].babylonMaterial,babylonAnimation:this._buildAnimation(c,o,s)});return q}}class Zc extends V.AnimationPropertyInfo{buildAnimations(a,c,o,s){return[{babylonAnimatable:a._babylonLight,babylonAnimation:this._buildAnimation(c,o,s)}]}}(0,K.n)("/cameras/{}/orthographic/xmag",[new Jc(L.b.ANIMATIONTYPE_FLOAT,"orthoLeft",yc,(()=>1)),new Jc(L.b.ANIMATIONTYPE_FLOAT,"orthoRight",kc,(()=>1))]),(0,K.n)("/cameras/{}/orthographic/ymag",[new Jc(L.b.ANIMATIONTYPE_FLOAT,"orthoBottom",yc,(()=>1)),new Jc(L.b.ANIMATIONTYPE_FLOAT,"orthoTop",kc,(()=>1))]),(0,K.n)("/cameras/{}/orthographic/zfar",[new Jc(L.b.ANIMATIONTYPE_FLOAT,"maxZ",Nc,(()=>1))]),(0,K.n)("/cameras/{}/orthographic/znear",[new Jc(L.b.ANIMATIONTYPE_FLOAT,"rc",Nc,(()=>1))]),(0,K.n)("/cameras/{}/perspective/yfov",[new Jc(L.b.ANIMATIONTYPE_FLOAT,"fov",Nc,(()=>1))]),(0,K.n)("/cameras/{}/perspective/zfar",[new Jc(L.b.ANIMATIONTYPE_FLOAT,"maxZ",Nc,(()=>1))]),(0,K.n)("/cameras/{}/perspective/znear",[new Jc(L.b.ANIMATIONTYPE_FLOAT,"rc",Nc,(()=>1))]),(0,K.n)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new wc(L.b.ANIMATIONTYPE_COLOR3,"albedoColor",Mc,(()=>4)),new wc(L.b.ANIMATIONTYPE_FLOAT,"alpha",(function(a,c,o,s){return c[o+3]*s}),(()=>4))]),(0,K.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"metallic",Nc,(()=>1))]),(0,K.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"roughness",Nc,(()=>1))]);const hc=fc("albedoTexture");(0,K.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",hc.scale),(0,K.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",hc.offset),(0,K.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",hc.rotation);const Uc=fc("metallicTexture");(0,K.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Uc.scale),(0,K.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Uc.offset),(0,K.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Uc.rotation),(0,K.n)("/materials/{}/emissiveFactor",[new wc(L.b.ANIMATIONTYPE_COLOR3,"emissiveColor",Mc,(()=>3))]);const Sc=fc("bumpTexture");(0,K.n)("/materials/{}/normalTexture/scale",[new wc(L.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Nc,(()=>1))]),(0,K.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Sc.scale),(0,K.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Sc.offset),(0,K.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Sc.rotation),(0,K.n)("/materials/{}/occlusionTexture/strength",[new wc(L.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Nc,(()=>1))]);const rc=fc("ambientTexture");(0,K.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",rc.scale),(0,K.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",rc.offset),(0,K.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",rc.rotation);const xc=fc("emissiveTexture");(0,K.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",xc.scale),(0,K.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",xc.offset),(0,K.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",xc.rotation),(0,K.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new wc(L.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new wc(L.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Nc,(()=>1))]);const Rc=fc("anisotropy.texture");(0,K.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Rc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Rc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Rc.rotation),(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Nc,(()=>1))]);const dc=fc("clearCoat.texture");(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",dc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",dc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",dc.rotation);const Xc=fc("clearCoat.bumpTexture");(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new wc(L.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Xc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Xc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Xc.rotation);const Wc=fc("clearCoat.textureRoughness");(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Wc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Wc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Wc.rotation),(0,K.n)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new wc(L.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_ior/ior",[new wc(L.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new wc(L.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new wc(L.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Nc,(()=>1))]);const Fc=fc("iridescence.texture");(0,K.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Fc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Fc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Fc.rotation);const Oc=fc("iridescence.thicknessTexture");(0,K.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Oc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Oc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Oc.rotation),(0,K.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new wc(L.b.ANIMATIONTYPE_COLOR3,"sheen.color",Mc,(()=>3))]),(0,K.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Nc,(()=>1))]);const Bc=fc("sheen.texture");(0,K.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Bc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Bc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Bc.rotation);const uc=fc("sheen.textureRoughness");(0,K.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",uc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",uc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",uc.rotation),(0,K.n)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new wc(L.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Mc,(()=>3))]);const Kc=fc("metallicReflectanceTexture");(0,K.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Kc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Kc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Kc.rotation);const Dc=fc("reflectanceTexture");(0,K.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Dc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Dc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Dc.rotation),(0,K.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Nc,(()=>1))]);const Ic=fc("subSurface.refractionIntensityTexture");(0,K.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Ic.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Ic.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Ic.rotation),(0,K.n)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new wc(L.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Mc,(()=>3))]),(0,K.n)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new wc(L.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Nc,(()=>1))]),(0,K.n)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Nc,(()=>1))]);const Yc=fc("subSurface.thicknessTexture");(0,K.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Yc.scale),(0,K.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Yc.offset),(0,K.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Yc.rotation),(0,K.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new wc(L.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Nc,(()=>1))]);const Pc=fc("subSurface.translucencyIntensityTexture");(0,K.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Pc.scale),(0,K.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Pc.offset),(0,K.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Pc.rotation),(0,K.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new wc(L.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Mc,(()=>3))]);const mo=fc("subSurface.translucencyColorTexture");(0,K.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",mo.scale),(0,K.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",mo.offset),(0,K.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",mo.rotation),(0,K.n)("/extensions/KHR_lights_punctual/lights/{}/color",[new Zc(L.b.ANIMATIONTYPE_COLOR3,"diffuse",Mc,(()=>3))]),(0,K.n)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Zc(L.b.ANIMATIONTYPE_FLOAT,"intensity",Nc,(()=>1))]),(0,K.n)("/extensions/KHR_lights_punctual/lights/{}/range",[new Zc(L.b.ANIMATIONTYPE_FLOAT,"range",Nc,(()=>1))]),(0,K.n)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Zc(L.b.ANIMATIONTYPE_FLOAT,"innerAngle",nc,(()=>1))]),(0,K.n)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Zc(L.b.ANIMATIONTYPE_FLOAT,"angle",nc,(()=>1))]),(0,K.n)("/nodes/{}/extensions/EXT_lights_ies/color",[new Zc(L.b.ANIMATIONTYPE_COLOR3,"diffuse",Mc,(()=>3))]),(0,K.n)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Zc(L.b.ANIMATIONTYPE_FLOAT,"intensity",Nc,(()=>1))]);const Vc="KHR_animation_pointer";class Ec{constructor(a){this.name=Vc,this._loader=a,this._pathToObjectConverter=(0,K.j)(this._loader.nc)}get enabled(){return this._loader.isExtensionUsed(Vc)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(a,c,o,s,q){var t;const i=null===(t=s.target.extensions)||void 0===t?void 0:t.KHR_animation_pointer;if(!i||!this._pathToObjectConverter)return null;"pointer"!==s.target.path&&M.c.Warn(`${a}/target/path: Value (${s.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=s.target.node&&M.c.Warn(`${a}/target/node: Value (${s.target.node}) must not be present when using the ${this.name} extension`);const p=`${a}/extensions/${this.name}`,G=i.pointer;if(!G)throw new Error(`${p}: Pointer is missing`);try{const t=this._pathToObjectConverter.convert(G);if(!t.info.interpolation)throw new Error(`${p}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(a,c,o,s,{object:t.object,info:t.info.interpolation},q)}catch(T){return M.c.Warn(`${p}/pointer: Invalid pointer (${G}) skipped`),null}}}u(Vc),B(Vc,!0,(a=>new Ec(a)));class Hc{constructor(a,c,o){this.frame=a,this.action=c,this.onlyOnce=o,this.isDone=!1}_clone(){return new Hc(this.frame,this.action,this.onlyOnce)}}var bc=o(12667),Ac=o(12721),vc=o(12712);class lc{get loop(){return this._loop}set loop(a){a!==this._loop&&(this._loop=a,this.updateOptions({loop:a}))}get currentTime(){var a;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(a=Ac.b.audioEngine)&&void 0!==a&&a.audioContext&&(this.isPlaying||this.isPaused)){const a=this.isPaused?0:Ac.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+a}return 0}get spatialSound(){return this._spatialSound}set spatialSound(a){if(a==this._spatialSound)return;const c=this.isPlaying;this.pause(),a?(this._spatialSound=a,this._updateSpatialParameters()):this._disableSpatialSound(),c&&this.play()}constructor(a,c,o){var s;let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new C.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=q.Hc.Zero(),this._localDirection=new q.Hc(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=a,o=o||g.b.LastCreatedScene)if(this._scene=o,lc._SceneComponentInitialization(o),this._readyToPlayCallback=t,this._customAttenuationFunction=(a,c,o,s,q)=>c<o?a*(1-c/o):0,p&&(this.autoplay=p.autoplay||!1,this._loop=p.loop||!1,void 0!==p.volume&&(this._volume=p.volume),this._spatialSound=p.spatialSound??!1,this.maxDistance=p.maxDistance??100,this.useCustomAttenuation=p.useCustomAttenuation??!1,this.rolloffFactor=p.rolloffFactor||1,this.refDistance=p.refDistance||1,this.distanceModel=p.distanceModel||"linear",this._playbackRate=p.playbackRate||1,this._streaming=p.streaming??!1,this._length=p.length,this._offset=p.offset),null!==(s=Ac.b.audioEngine)&&void 0!==s&&s.canUseWebAudio&&Ac.b.audioEngine.audioContext){this._soundGain=Ac.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let a=!0;if(c)try{"string"===typeof c?(this._urlType="String",this._url=c):c instanceof ArrayBuffer?this._urlType="ArrayBuffer":c instanceof HTMLMediaElement?this._urlType="MediaElement":c instanceof MediaStream?this._urlType="MediaStream":c instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(c)&&(this._urlType="Array");let o=[],s=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ac.b.audioEngine.audioContext.createMediaElementSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ac.b.audioEngine.audioContext.createMediaStreamSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":c.byteLength>0&&(s=!0,this._soundLoaded(c));break;case"AudioBuffer":this._audioBufferLoaded(c);break;case"String":o.push(c);case"Array":0===o.length&&(o=c);for(let a=0;a<o.length;a++){const c=o[a];if(s=p&&p.skipCodecCheck||-1!==c.indexOf(".mp3",c.length-4)&&Ac.b.audioEngine.isMP3supported||-1!==c.indexOf(".ogg",c.length-4)&&Ac.b.audioEngine.isOGGsupported||-1!==c.indexOf(".wav",c.length-4)||-1!==c.indexOf(".m4a",c.length-4)||-1!==c.indexOf(".mp4",c.length-4)||-1!==c.indexOf("blob:"),s){this._streaming?(this._htmlAudioElement=new Audio(c),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,i.Tools.SetCorsBehavior(c,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(c,(a=>{this._soundLoaded(a)}),void 0,!0,!0,(a=>{a&&M.c.Error("XHR "+a.status+" error on: "+c+"."),M.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:a=!1}a?s||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):M.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(G){M.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Ac.b.audioEngine&&!Ac.b.audioEngine.WarnedWebAudioUnsupported&&(M.c.Error("Web Audio is not supported by your browser."),Ac.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var a;null!==(a=Ac.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(a){var c;null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.audioContext&&(this._audioBuffer=a,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(a){var c;null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.audioContext&&Ac.b.audioEngine.audioContext.decodeAudioData(a,(a=>{this._audioBufferLoaded(a)}),(a=>{M.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+a)}))}setAudioBuffer(a){var c;null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&(this._audioBuffer=a,this._isReadyToPlay=!0)}updateOptions(a){a&&(this.loop=a.loop??this.loop,this.maxDistance=a.maxDistance??this.maxDistance,this.useCustomAttenuation=a.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=a.rolloffFactor??this.rolloffFactor,this.refDistance=a.refDistance??this.refDistance,this.distanceModel=a.distanceModel??this.distanceModel,this._playbackRate=a.playbackRate??this._playbackRate,this._length=a.length??void 0,this.spatialSound=a.spatialSound??this._spatialSound,this._setOffset(a.offset??void 0),this.setVolume(a.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var a;null!==(a=Ac.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&Ac.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Ac.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var a;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(a=this._soundPanner)||void 0===a||a.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var a;null!==(a=Ac.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(a){var c;null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(a),this._isOutputConnected=!0)}setDirectionalCone(a,c,o){c<a?M.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=a,this._coneOuterAngle=c,this._coneOuterGain=o,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(a){if(a!=this._coneInnerAngle){var c;if(this._coneOuterAngle<a)return void M.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=a,null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(a){if(a!=this._coneOuterAngle){var c;if(a<this._coneInnerAngle)return void M.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=a,null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(a){var c;a.equals(this._position)||(this._position.G(a),null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(a){var c;this._localDirection=a,null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const a=this._connectedTransformNode.getWorldMatrix(),c=q.Hc.TransformNormal(this._localDirection,a);c.normalize(),this._soundPanner.orientationX.value=c.x,this._soundPanner.orientationY.value=c.y,this._soundPanner.orientationZ.value=c.z}updateDistanceFromListener(){var a;if(null!==(a=Ac.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const a=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.vc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,a,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(a){this._customAttenuationFunction=a}play(a,c,o){var s;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(s=Ac.b.audioEngine)&&void 0!==s&&s.audioContext)try{var q,t;this._clearTimeoutsAndObservers();let s=a?(null===(q=Ac.b.audioEngine)||void 0===q?void 0:q.audioContext.currentTime)+a:null===(t=Ac.b.audioEngine)||void 0===t?void 0:t.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Ac.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const a=()=>{var o;if(null!==(o=Ac.b.audioEngine)&&void 0!==o&&o.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=c??0;const o=this._htmlAudioElement.play();void 0!==o&&o.catch((()=>{var c,o;(null===(c=Ac.b.audioEngine)||void 0===c||c.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(o=Ac.b.audioEngine)||void 0===o?void 0:o.onAudioUnlockedObservable.addOnce((()=>{a()})))}))}else{var s;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(s=Ac.b.audioEngine)||void 0===s?void 0:s.onAudioUnlockedObservable.addOnce((()=>{a()}))}};a()}}else{var i;const q=()=>{var q;if(null!==(q=Ac.b.audioEngine)&&void 0!==q&&q.audioContext){var t;if(o=o||this._length,void 0!==c&&this._setOffset(c),this._soundSource){const a=this._soundSource;a.onended=()=>{a.disconnect()}}if(this._soundSource=null===(t=Ac.b.audioEngine)||void 0===t?void 0:t.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var i;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==c&&(this._soundSource.loopStart=c),void 0!==o&&(this._soundSource.loopEnd=(0|c)+o),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},s=a?(null===(i=Ac.b.audioEngine)||void 0===i?void 0:i.audioContext.currentTime)+a:Ac.b.audioEngine.audioContext.currentTime;const q=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(s,q,this.loop?void 0:o)}}};"suspended"===(null===(i=Ac.b.audioEngine)||void 0===i?void 0:i.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var a;"suspended"===(null===(a=Ac.b.audioEngine)||void 0===a?void 0:a.audioContext.state)?(Ac.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Ac.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{q()})))):q()}),500):q()}this._startTime=s,this.isPlaying=!0,this.isPaused=!1}catch(p){M.c.Error("Error while trying to play audio: "+this.name+", "+p.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(a){var c;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var o;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(o=this._streamingSource)||void 0===o||o.disconnect();this.isPlaying=!1}else if(null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.audioContext&&this._soundSource){const c=a?Ac.b.audioEngine.audioContext.currentTime+a:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(c)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var a;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var c;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(c=this._streamingSource)||void 0===c||c.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(a=Ac.b.audioEngine)&&void 0!==a&&a.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Ac.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(a,c){var o;null!==(o=Ac.b.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._soundGain&&(c&&Ac.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Ac.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Ac.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(a,Ac.b.audioEngine.audioContext.currentTime+c)):this._soundGain.gain.value=a),this._volume=a}setPlaybackRate(a){this._playbackRate=a,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(a){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=a,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=a=>this._onRegisterAfterWorldMatrixUpdate(a),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(a){var c;if(a.getBoundingInfo){const c=a.getBoundingInfo();this.setPosition(c.boundingSphere.centerWorld)}else this.setPosition(a.absolutePosition);null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const a=()=>{(0,vc.h)((()=>this._isReadyToPlay),(()=>{o._audioBuffer=this.getAudioBuffer(),o._isReadyToPlay=!0,o.autoplay&&o.play(0,this._offset,this._length)}),void 0,300)},c={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},o=new lc(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,c);return this.useCustomAttenuation&&o.setAttenuationFunction(this._customAttenuationFunction),o.setPosition(this._position),o.setPlaybackRate(this._playbackRate),a(),o}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const a={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(a.connectedMeshId=this._connectedTransformNode.id),a.position=this._position.hc(),a.refDistance=this.refDistance,a.distanceModel=this.distanceModel,a.isDirectional=this._isDirectional,a.localDirectionToMesh=this._localDirection.hc(),a.coneInnerAngle=this._coneInnerAngle,a.coneOuterAngle=this._coneOuterAngle,a.coneOuterGain=this._coneOuterGain),a}static Parse(a,c,o,s){const t=a.name;let i;i=a.url?o+a.url:o+t;const p={autoplay:a.autoplay,loop:a.loop,volume:a.volume,spatialSound:a.spatialSound,maxDistance:a.maxDistance,rolloffFactor:a.rolloffFactor,refDistance:a.refDistance,distanceModel:a.distanceModel,playbackRate:a.playbackRate};let G;if(s){const a=()=>{(0,vc.h)((()=>s._isReadyToPlay),(()=>{G._audioBuffer=s.getAudioBuffer(),G._isReadyToPlay=!0,G.autoplay&&G.play(0,G._offset,G._length)}),void 0,300)};G=new lc(t,new ArrayBuffer(0),c,null,p),a()}else G=new lc(t,i,c,(()=>{c.removePendingData(G)}),p),c.addPendingData(G);if(a.position){const c=q.Hc.qo(a.position);G.setPosition(c)}if(a.isDirectional&&(G.setDirectionalCone(a.coneInnerAngle||360,a.coneOuterAngle||360,a.coneOuterGain||0),a.localDirectionToMesh)){const c=q.Hc.qo(a.localDirectionToMesh);G.setLocalDirectionToMesh(c)}if(a.connectedMeshId){const o=c.getMeshById(a.connectedMeshId);o&&G.attachToMesh(o)}return a.metadata&&(G.metadata=a.metadata),G}_setOffset(a){this._offset!==a&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=a)}_clearTimeoutsAndObservers(){var a;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(a=Ac.b.audioEngine)||void 0===a||a.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}lc._SceneComponentInitialization=a=>{throw(0,bc.b)("AudioSceneComponent")},(0,wa.d)("BABYLON.Sound",lc);class Qc{constructor(a,c,o){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],c.length!==o.length)throw new Error("Sounds length does not equal weights length");this.loop=a,this._weights=o;let s=0;for(const t of o)s+=t;const q=s>0?1/s:0;for(let t=0;t<this._weights.length;t++)this._weights[t]*=q;this._sounds=c;for(const t of this._sounds)t.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(a){if(a!==this._coneInnerAngle){if(this._coneOuterAngle<a)return void M.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=a;for(const c of this._sounds)c.directionalConeInnerAngle=a}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(a){if(a!==this._coneOuterAngle){if(a<this._coneInnerAngle)return void M.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=a;for(const c of this._sounds)c.directionalConeOuterAngle=a}}get volume(){return this._volume}set volume(a){if(a!==this._volume)for(const c of this._sounds)c.setVolume(a)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(a){if(!this.isPaused){this.stop();const a=Math.random();let c=0;for(let o=0;o<this._weights.length;o++)if(c+=this._weights[o],a<=c){this._currentIndex=o;break}}const c=this._sounds[this._currentIndex??0];c.isReady()?c.play(0,this.isPaused?void 0:a):c.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class zc{constructor(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(a=a||g.b.LastCreatedScene)&&(this._scene=a,this.soundCollection=[],this._options=c,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var a;null!==(a=Ac.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&Ac.b.audioEngine.audioContext&&(this._outputAudioNode=Ac.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Ac.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Ac.b.audioEngine&&Ac.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(a){var c;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&a.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==a.soundTrackId&&(-1===a.soundTrackId?this._scene.mainSoundTrack.removeSound(a):this._scene.soundTracks&&this._scene.soundTracks[a.soundTrackId].removeSound(a)),this.soundCollection.push(a),a.soundTrackId=this.id}removeSound(a){const c=this.soundCollection.indexOf(a);-1!==c&&this.soundCollection.splice(c,1)}setVolume(a){var c;null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=a)}switchPanningModelToHRTF(){var a;if(null!==(a=Ac.b.audioEngine)&&void 0!==a&&a.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var a;if(null!==(a=Ac.b.audioEngine)&&void 0!==a&&a.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToEqualPower()}connectToAnalyser(a){var c;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=a,null!==(c=Ac.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Ac.b.audioEngine.masterGain))}}var ao=o(13083),co=o(13045),oo=o(12642);Ac.b.AudioEngineFactory=(a,c,o)=>new so(a,c,o);class so{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new C.d,this.onAudioLockedObservable=new C.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,oo.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const s=document.createElement("audio");this._hostElement=a,this._audioContext=c,this._audioDestination=o;try{s&&s.canPlayType&&(s.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||s.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(q){}try{s&&s.canPlayType&&s.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(q){}}lock(){this._triggerSuspendedState()}unlock(){var a,c;if("running"===(null===(a=this._audioContext)||void 0===a?void 0:a.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(c=this._audioContext)||void 0===c||c.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{M.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var a;null===(a=this._audioContext)||void 0===a||a.addEventListener("statechange",(()=>{var a;this.unlocked&&"running"!==(null===(a=this._audioContext)||void 0===a?void 0:a.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var a;return null!==(a=this._audioContext)&&void 0!==a&&a.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(a){this.canUseWebAudio=!1,M.c.Error("Web Audio: "+a.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(a){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const a=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",c=document.createElement("style");c.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(c),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var a;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(a=this._audioContext)||void 0===a||a.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(a){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=a)}connectToAnalyser(a){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=a,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var qo=o(12661);(0,o(14052).h)(ao.d.NAME_AUDIO,((a,c,o,s)=>{let q,t=[];if(o.Re=o.Re||[],void 0!==a.Re&&null!==a.Re)for(let p=0,G=a.Re.length;p<G;p++){var i;const G=a.Re[p];null!==(i=Ac.b.audioEngine)&&void 0!==i&&i.canUseWebAudio?(G.url||(G.url=G.name),t[G.url]?o.Re.push(lc.Parse(G,c,s,t[G.url])):(q=lc.Parse(G,c,s),t[G.url]=q,o.Re.push(q))):o.Re.push(new lc(G.name,null,c))}t=[]})),Object.defineProperty(co.e.prototype,"mainSoundTrack",{get:function(){let a=this._getComponent(ao.d.NAME_AUDIO);return a||(a=new to(this),this.jc(a)),this._mainSoundTrack||(this._mainSoundTrack=new zc(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),co.e.prototype.getSoundByName=function(a){let c;for(c=0;c<this.mainSoundTrack.soundCollection.length;c++)if(this.mainSoundTrack.soundCollection[c].name===a)return this.mainSoundTrack.soundCollection[c];if(this.soundTracks)for(let o=0;o<this.soundTracks.length;o++)for(c=0;c<this.soundTracks[o].soundCollection.length;c++)if(this.soundTracks[o].soundCollection[c].name===a)return this.soundTracks[o].soundCollection[c];return null},Object.defineProperty(co.e.prototype,"audioEnabled",{get:function(){let a=this._getComponent(ao.d.NAME_AUDIO);return a||(a=new to(this),this.jc(a)),a.audioEnabled},set:function(a){let c=this._getComponent(ao.d.NAME_AUDIO);c||(c=new to(this),this.jc(c)),a?c.enableAudio():c.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(co.e.prototype,"headphone",{get:function(){let a=this._getComponent(ao.d.NAME_AUDIO);return a||(a=new to(this),this.jc(a)),a.headphone},set:function(a){let c=this._getComponent(ao.d.NAME_AUDIO);c||(c=new to(this),this.jc(c)),a?c.switchAudioModeForHeadphones():c.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(co.e.prototype,"audioListenerPositionProvider",{get:function(){let a=this._getComponent(ao.d.NAME_AUDIO);return a||(a=new to(this),this.jc(a)),a.audioListenerPositionProvider},set:function(a){let c=this._getComponent(ao.d.NAME_AUDIO);if(c||(c=new to(this),this.jc(c)),a&&"function"!==typeof a)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");c.audioListenerPositionProvider=a},enumerable:!0,configurable:!0}),Object.defineProperty(co.e.prototype,"audioListenerRotationProvider",{get:function(){let a=this._getComponent(ao.d.NAME_AUDIO);return a||(a=new to(this),this.jc(a)),a.audioListenerRotationProvider},set:function(a){let c=this._getComponent(ao.d.NAME_AUDIO);if(c||(c=new to(this),this.jc(c)),a&&"function"!==typeof a)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");c.audioListenerRotationProvider=a},enumerable:!0,configurable:!0}),Object.defineProperty(co.e.prototype,"audioPositioningRefreshRate",{get:function(){let a=this._getComponent(ao.d.NAME_AUDIO);return a||(a=new to(this),this.jc(a)),a.audioPositioningRefreshRate},set:function(a){let c=this._getComponent(ao.d.NAME_AUDIO);c||(c=new to(this),this.jc(c)),c.audioPositioningRefreshRate=a},enumerable:!0,configurable:!0});class to{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(a){this.name=ao.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new q.Hc,this._cachedCameraPosition=new q.Hc,this._lastCheck=0,this._invertMatrixTemp=new q.Matrix,this._cameraDirectionTemp=new q.Hc,(a=a||g.b.LastCreatedScene)&&(this.ao=a,a.soundTracks=[],a.Re=[])}register(){this.ao._afterRenderStage.registerStep(ao.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(a){if(a.Re=[],this.ao.soundTracks)for(let c=0;c<this.ao.soundTracks.length;c++){const o=this.ao.soundTracks[c];for(let c=0;c<o.soundCollection.length;c++)a.Re.push(o.soundCollection[c].serialize())}}addFromContainer(a){if(a.Re)for(const c of a.Re)c.play(),c.autoplay=!0,this.ao.mainSoundTrack.addSound(c)}removeFromContainer(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a.Re)for(const o of a.Re)o.stop(),o.autoplay=!1,this.ao.mainSoundTrack.removeSound(o),c&&o.dispose()}dispose(){const a=this.ao;if(a._mainSoundTrack&&a.mainSoundTrack.dispose(),a.soundTracks)for(let c=0;c<a.soundTracks.length;c++)a.soundTracks[c].dispose()}disableAudio(){const a=this.ao;let c;for(this._audioEnabled=!1,Ac.b.audioEngine&&Ac.b.audioEngine.audioContext&&Ac.b.audioEngine.audioContext.suspend(),c=0;c<a.mainSoundTrack.soundCollection.length;c++)a.mainSoundTrack.soundCollection[c].pause();if(a.soundTracks)for(c=0;c<a.soundTracks.length;c++)for(let o=0;o<a.soundTracks[c].soundCollection.length;o++)a.soundTracks[c].soundCollection[o].pause()}enableAudio(){const a=this.ao;let c;for(this._audioEnabled=!0,Ac.b.audioEngine&&Ac.b.audioEngine.audioContext&&Ac.b.audioEngine.audioContext.resume(),c=0;c<a.mainSoundTrack.soundCollection.length;c++)a.mainSoundTrack.soundCollection[c].isPaused&&a.mainSoundTrack.soundCollection[c].play();if(a.soundTracks)for(c=0;c<a.soundTracks.length;c++)for(let o=0;o<a.soundTracks[c].soundCollection.length;o++)a.soundTracks[c].soundCollection[o].isPaused&&a.soundTracks[c].soundCollection[o].play()}switchAudioModeForHeadphones(){const a=this.ao;if(this._headphone=!0,a.mainSoundTrack.switchPanningModelToHRTF(),a.soundTracks)for(let c=0;c<a.soundTracks.length;c++)a.soundTracks[c].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const a=this.ao;if(this._headphone=!1,a.mainSoundTrack.switchPanningModelToEqualPower(),a.soundTracks)for(let c=0;c<a.soundTracks.length;c++)a.soundTracks[c].switchPanningModelToEqualPower()}_afterRender(){const a=qo.b.Now;if(this._lastCheck&&a-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=a;const c=this.ao;if(!this._audioEnabled||!c._mainSoundTrack||!c.soundTracks||0===c._mainSoundTrack.soundCollection.length&&1===c.soundTracks.length)return;const o=Ac.b.audioEngine;if(o&&o.audioContext){let a,s=c.activeCamera;if(c.activeCameras&&c.activeCameras.length>0&&(s=c.activeCameras[0]),this.audioListenerPositionProvider){const a=this.audioListenerPositionProvider();o.audioContext.listener.setPosition(a.x||0,a.y||0,a.z||0)}else s?this._cachedCameraPosition.equals(s.globalPosition)||(this._cachedCameraPosition.G(s.globalPosition),o.audioContext.listener.setPosition(s.globalPosition.x,s.globalPosition.y,s.globalPosition.z)):o.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const a=this.audioListenerRotationProvider();o.audioContext.listener.setOrientation(a.x||0,a.y||0,a.z||0,0,1,0)}else s?(s.rigCameras&&s.rigCameras.length>0&&(s=s.rigCameras[0]),s.getViewMatrix().invertToRef(this._invertMatrixTemp),q.Hc.TransformNormalToRef(to._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.G(this._cameraDirectionTemp),o.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):o.audioContext.listener.setOrientation(0,0,0,0,1,0);for(a=0;a<c.mainSoundTrack.soundCollection.length;a++){const o=c.mainSoundTrack.soundCollection[a];o.useCustomAttenuation&&o.updateDistanceFromListener()}if(c.soundTracks)for(a=0;a<c.soundTracks.length;a++)for(let o=0;o<c.soundTracks[a].soundCollection.length;o++){const s=c.soundTracks[a].soundCollection[o];s.useCustomAttenuation&&s.updateDistanceFromListener()}}}}to._CameraDirection=new q.Hc(0,0,-1),lc._SceneComponentInitialization=a=>{let c=a._getComponent(ao.d.NAME_AUDIO);c||(c=new to(a),a.jc(c))};const io="MSFT_audio_emitter";class po{constructor(a){this.name=io,this._loader=a,this.enabled=this._loader.isExtensionUsed(io)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const a=this._loader.nc.extensions;if(a&&a[this.name]){const c=a[this.name];this._clips=c.clips,this._emitters=c.emitters,Y.Assign(this._clips),Y.Assign(this._emitters)}}loadSceneAsync(a,c){return ma.LoadExtensionAsync(a,c,this.name,(async(o,s)=>{const q=new Array;q.push(this._loader.loadSceneAsync(a,c));for(const a of s.emitters){const c=Y.Get(`${o}/emitters`,this._emitters,a);if(void 0!=c.refDistance||void 0!=c.maxDistance||void 0!=c.rolloffFactor||void 0!=c.distanceModel||void 0!=c.innerAngle||void 0!=c.outerAngle)throw new Error(`${o}: Direction or Distance properties are not allowed on emitters attached to a scene`);q.push(this._loadEmitterAsync(`${o}/emitters/${c.index}`,c))}await Promise.all(q)}))}loadNodeAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(a,s)=>{const t=new Array,p=await this._loader.loadNodeAsync(a,c,(c=>{for(const o of s.emitters){const s=Y.Get(`${a}/emitters`,this._emitters,o);t.push(this._loadEmitterAsync(`${a}/emitters/${s.index}`,s).then((()=>{for(const a of s._babylonSounds)a.attachToMesh(c),void 0==s.innerAngle&&void 0==s.outerAngle||(a.setLocalDirectionToMesh(q.Hc.Forward()),a.setDirectionalCone(2*i.Tools.ToDegrees(void 0==s.innerAngle?Math.PI:s.innerAngle),2*i.Tools.ToDegrees(void 0==s.outerAngle?Math.PI:s.outerAngle),0))})))}o(c)}));return await Promise.all(t),p}))}loadAnimationAsync(a,c){return ma.LoadExtensionAsync(a,c,this.name,(async(o,s)=>{const q=await this._loader.loadAnimationAsync(a,c),t=new Array;Y.Assign(s.events);for(const i of s.events)t.push(this._loadAnimationEventAsync(`${o}/events/${i.index}`,a,c,i,q));return await Promise.all(t),q}))}_loadClipAsync(a,c){if(c._objectURL)return c._objectURL;let o;if(c.uri)o=this._loader.loadUriAsync(a,c,c.uri);else{const s=Y.Get(`${a}/bufferView`,this._loader.nc.bufferViews,c.bufferView);o=this._loader.loadBufferViewAsync(`/bufferViews/${s.index}`,s)}return c._objectURL=o.then((a=>URL.createObjectURL(new Blob([a],{type:c.mimeType})))),c._objectURL}_loadEmitterAsync(a,c){if(c._babylonSounds=c._babylonSounds||[],!c._babylonData){const a=new Array,o=c.name||`emitter${c.index}`,s={loop:!1,autoplay:!1,volume:void 0==c.volume?1:c.volume};for(let t=0;t<c.clips.length;t++){const q=`/extensions/${this.name}/clips`,i=Y.Get(q,this._clips,c.clips[t].clip);a.push(this._loadClipAsync(`${q}/${c.clips[t].clip}`,i).then((a=>{const q=c._babylonSounds[t]=new lc(o,a,this._loader.babylonScene,null,s);q.refDistance=c.refDistance||1,q.maxDistance=c.maxDistance||256,q.rolloffFactor=c.rolloffFactor||1,q.distanceModel=c.distanceModel||"exponential"})))}const q=Promise.all(a).then((()=>{const a=c.clips.map((a=>a.weight||1)),o=new Qc(c.loop||!1,c._babylonSounds,a);c.innerAngle&&(o.directionalConeInnerAngle=2*i.Tools.ToDegrees(c.innerAngle)),c.outerAngle&&(o.directionalConeOuterAngle=2*i.Tools.ToDegrees(c.outerAngle)),c.volume&&(o.volume=c.volume),c._babylonData.sound=o}));c._babylonData={loaded:q}}return c._babylonData.loaded}_getEventAction(a,c,o,s,q){switch(o){case"play":return a=>{const o=(q||0)+(a-s);c.play(o)};case"stop":return()=>{c.stop()};case"pause":return()=>{c.pause()};default:throw new Error(`${a}: Unsupported action ${o}`)}}_loadAnimationEventAsync(a,c,o,s,q){if(0==q.targetedAnimations.length)return Promise.resolve();const t=q.targetedAnimations[0],i=s.sc,p=Y.Get(`/extensions/${this.name}/emitters`,this._emitters,i);return this._loadEmitterAsync(a,p).then((()=>{const c=p._babylonData.sound;if(c){const o=new Hc(s.time,this._getEventAction(a,c,s.action,s.time,s.startOffset));t.animation.addEvent(o),q.onAnimationGroupEndObservable.add((()=>{c.stop()})),q.onAnimationGroupPauseObservable.add((()=>{c.pause()}))}}))}}u(io),B(io,!0,(a=>new po(a)));const Go="MSFT_lod";class To{constructor(a){var c;this.name=Go,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new C.d,this.onMaterialLODsLoadedObservable=new C.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=a,this.maxLODsToLoad=(null===(c=this._loader.parent.extensionOptions[Go])||void 0===c?void 0:c.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Go)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let a=0;a<this._nodePromiseLODs.length;a++){const c=Promise.all(this._nodePromiseLODs[a]).then((()=>{0!==a&&(this._loader.endPerformanceCounter(`Node LOD ${a}`),this._loader.log(`Loaded node LOD ${a}`)),this.onNodeLODsLoadedObservable.notifyObservers(a),a!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${a+1}`),this._loadBufferLOD(this._nodeBufferLODs,a+1),this._nodeSignalLODs[a]&&this._nodeSignalLODs[a].resolve())}));this._loader._completePromises.push(c)}for(let a=0;a<this._materialPromiseLODs.length;a++){const c=Promise.all(this._materialPromiseLODs[a]).then((()=>{0!==a&&(this._loader.endPerformanceCounter(`Material LOD ${a}`),this._loader.log(`Loaded material LOD ${a}`)),this.onMaterialLODsLoadedObservable.notifyObservers(a),a!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${a+1}`),this._loadBufferLOD(this._materialBufferLODs,a+1),this._materialSignalLODs[a]&&this._materialSignalLODs[a].resolve())}));this._loader._completePromises.push(c)}}loadSceneAsync(a,c){const o=this._loader.loadSceneAsync(a,c);return this._loadBufferLOD(this._bufferLODs,0),o}loadNodeAsync(a,c,o){return ma.LoadExtensionAsync(a,c,this.name,(async(a,q)=>{let t;const i=this._getLODs(a,c,this._loader.nc.nodes,q.ids);this._loader.logOpen(`${a}`);for(let c=0;c<i.length;c++){const a=i[c];0!==c&&(this._nodeIndexLOD=c,this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new s);const q=a=>{o(a),a.KG(!1)},p=this._loader.loadNodeAsync(`/nodes/${a.index}`,a,q).then((a=>{if(0!==c){const a=i[c-1];a._babylonTransformNode&&(this._disposeTransformNode(a._babylonTransformNode),delete a._babylonTransformNode)}return a.KG(!0),a}));this._nodePromiseLODs[c]=this._nodePromiseLODs[c]||[],0===c?t=p:(this._nodeIndexLOD=null,this._nodePromiseLODs[c].push(p))}return this._loader.logClose(),await t}))}_loadMaterialAsync(a,c,o,s,q){return this._nodeIndexLOD?null:ma.LoadExtensionAsync(a,c,this.name,(async(a,t)=>{let i;const p=this._getLODs(a,c,this._loader.nc.materials,t.ids);this._loader.logOpen(`${a}`);for(let c=0;c<p.length;c++){const a=p[c];0!==c&&(this._materialIndexLOD=c);const t=this._loader._loadMaterialAsync(`/materials/${a.index}`,a,o,s,(a=>{0===c&&q(a)})).then((a=>{if(0!==c){q(a);const o=p[c-1]._data;o[s]&&(this._disposeMaterials([o[s].babylonMaterial]),delete o[s])}return a}));this._materialPromiseLODs[c]=this._materialPromiseLODs[c]||[],0===c?i=t:(this._materialIndexLOD=null,this._materialPromiseLODs[c].push(t))}return this._loader.logClose(),await i}))}_loadUriAsync(a,c,o){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const q=this._nodeIndexLOD-1;return this._nodeSignalLODs[q]=this._nodeSignalLODs[q]||new s,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(a,c,o)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const q=this._materialIndexLOD-1;return this._materialSignalLODs[q]=this._materialSignalLODs[q]||new s,this._materialSignalLODs[q].promise.then((async()=>await this._loader.loadUriAsync(a,c,o)))}return null}loadBufferAsync(a,c,o,q){if(this._loader.parent.useRangeRequests&&!c.uri){if(!this._loader.bin)throw new Error(`${a}: Uri is missing or the binary glTF is missing its binary chunk`);const c=async(a,c)=>{const t=o,i=t+q-1;let p=a[c];return p?(p.start=Math.min(p.start,t),p.end=Math.max(p.end,i)):(p={start:t,end:i,loaded:new s},a[c]=p),await p.loaded.promise.then((a=>new Uint8Array(a.buffer,a.byteOffset+o-p.start,q)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?c(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?c(this._materialBufferLODs,this._materialIndexLOD):c(this._bufferLODs,0)}return null}_loadBufferLOD(a,c){const o=a[c];o&&(this._loader.log(`Loading buffer range [${o.start}-${o.end}]`),this._loader.bin.readAsync(o.start,o.end-o.start+1).then((a=>{o.loaded.resolve(a)}),(a=>{o.loaded.reject(a)})))}_getLODs(a,c,o,s){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const q=[];for(let t=s.length-1;t>=0;t--)if(q.push(Y.Get(`${a}/ids/${s[t]}`,o,s[t])),q.length===this.maxLODsToLoad)return q;return q.push(c),q}_disposeTransformNode(a){const c=[],o=a.material;o&&c.push(o);for(const q of a.getChildMeshes())q.material&&c.push(q.material);a.dispose();const s=c.filter((a=>this._loader.babylonScene.meshes.every((c=>c.material!=a))));this._disposeMaterials(s)}_disposeMaterials(a){const c={};for(const o of a){for(const a of o.getActiveTextures())c[a.uniqueId]=a;o.dispose()}for(const o in c)for(const a of this._loader.babylonScene.materials)a.hasTexture(c[o])&&delete c[o];for(const o in c)c[o].dispose()}}u(Go),B(Go,!0,(a=>new To(a)));const Co="MSFT_minecraftMesh";class jo{constructor(a){this.name=Co,this._loader=a,this.enabled=this._loader.isExtensionUsed(Co)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtraAsync(a,c,this.name,(async(s,q)=>{if(q){if(!(o instanceof n.b))throw new Error(`${s}: Material type not supported`);const q=this._loader.loadMaterialPropertiesAsync(a,c,o);return o.needAlphaBlending()&&(o.forceDepthWrite=!0,o.separateCullingPass=!0),o.Fc=o.forceDepthWrite,o.twoSidedLighting=!0,await q}}))}}u(Co),B(Co,!0,(a=>new jo(a)));const Lo="MSFT_sRGBFactors";class eo{constructor(a){this.name=Lo,this._loader=a,this.enabled=this._loader.isExtensionUsed(Lo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,c,o){return ma.LoadExtraAsync(a,c,this.name,(async(s,q)=>{if(q){if(!(o instanceof n.b))throw new Error(`${s}: Material type not supported`);const q=this._loader.loadMaterialPropertiesAsync(a,c,o),t=o.Za().getEngine().useExactSrgbConversions;return o.albedoTexture||o.albedoColor.toLinearSpaceToRef(o.albedoColor,t),o.reflectivityTexture||o.reflectivityColor.toLinearSpaceToRef(o.reflectivityColor,t),await q}}))}}u(Lo),B(Lo,!0,(a=>new eo(a)));var go=o(14377);const Mo={};var No=o(14437),yo=o(14414),ko=o(14382),no=o(14394);function fo(a,c){for(const o of a)for(const a of o.dataOutputs)if(a.uniqueId===c)return a;throw new Error("Could not find data out connection with unique id "+c)}function Jo(a,c){for(const o of a)if(o instanceof yo.e)for(const a of o.signalInputs)if(a.uniqueId===c)return a;throw new Error("Could not find signal in connection with unique id "+c)}async function wo(a,c){const s=await Promise.all(a.allBlocks.map((async a=>{const c=function(a){switch(a){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([o.e(78),o.e(79)]).then(o.bind(o,15957))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await o.e(80).then(o.bind(o,15960))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await o.e(81).then(o.bind(o,15966))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await o.e(82).then(o.bind(o,15969))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await o.e(83).then(o.bind(o,15978))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await o.e(84).then(o.bind(o,15982))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await o.e(85).then(o.bind(o,15988))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await o.e(86).then(o.bind(o,15995))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await o.e(87).then(o.bind(o,16e3))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await o.e(90).then(o.bind(o,16041))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await o.e(90).then(o.bind(o,16041))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await o.e(90).then(o.bind(o,16041))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await o.e(90).then(o.bind(o,16041))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await o.e(95).then(o.bind(o,16047))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await o.e(96).then(o.bind(o,16054))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await o.e(97).then(o.bind(o,16062))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await o.e(98).then(o.bind(o,16066))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await o.e(99).then(o.bind(o,16075))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await o.e(100).then(o.bind(o,16079))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await o.e(101).then(o.bind(o,16088))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await o.e(102).then(o.bind(o,16094))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await o.e(103).then(o.bind(o,16097))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await o.e(104).then(o.bind(o,16101))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await o.e(105).then(o.bind(o,16105))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await o.e(106).then(o.bind(o,16113))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await o.e(107).then(o.bind(o,16115))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await o.e(108).then(o.bind(o,16117))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await o.e(109).then(o.bind(o,16122))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await o.e(110).then(o.bind(o,16127))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await o.e(111).then(o.bind(o,16129))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await o.e(112).then(o.bind(o,16136))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await o.e(113).then(o.bind(o,16138))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await o.e(92).then(o.bind(o,16142))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await o.e(114).then(o.bind(o,16149))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await o.e(115).then(o.bind(o,16156))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await o.e(116).then(o.bind(o,16164))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await o.e(93).then(o.bind(o,16168))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await o.e(88).then(o.bind(o,16007))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await o.e(94).then(o.bind(o,16175))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await o.e(94).then(o.bind(o,16175))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await o.e(94).then(o.bind(o,16175))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await o.e(94).then(o.bind(o,16175))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await o.e(94).then(o.bind(o,16175))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await o.e(94).then(o.bind(o,16175))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await o.e(94).then(o.bind(o,16175))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await o.e(94).then(o.bind(o,16175))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await o.e(89).then(o.bind(o,16034))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await o.e(90).then(o.bind(o,16041))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await o.e(90).then(o.bind(o,16041))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await o.e(91).then(o.bind(o,16184))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await o.e(91).then(o.bind(o,16184))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await o.e(91).then(o.bind(o,16184))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await o.e(91).then(o.bind(o,16184))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await o.e(91).then(o.bind(o,16184))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await o.e(91).then(o.bind(o,16184))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await o.e(117).then(o.bind(o,16189))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await o.e(118).then(o.bind(o,16197))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await o.e(119).then(o.bind(o,16204))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await o.e(120).then(o.bind(o,16209))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await o.e(121).then(o.bind(o,16216))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await o.e(122).then(o.bind(o,16223))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await o.e(123).then(o.bind(o,16230))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await o.e(124).then(o.bind(o,16236))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await o.e(125).then(o.bind(o,16244))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await o.e(126).then(o.bind(o,16251))).FlowGraphDataSwitchBlock;default:if(Mo[a])return Mo[a];throw new Error(`Unknown block name ${a}`)}}(a.className);return await c()})));return function(a,c,o){const s=c.coordinator.createGraph(),q=[],t=c.valueParseFunction??ko.d;for(let i=0;i<a.allBlocks.length;i++){const p=ho(a.allBlocks[i],{ao:c.coordinator.config.ao,pathConverter:c.pathConverter,assetsContainer:c.coordinator.config.ao,valueParseFunction:t},o[i]);q.push(p),p instanceof No.e&&s.addEventBlock(p)}for(const i of q){for(const a of i.dataInputs)for(const c of a.connectedPointIds){const o=fo(q,c);a.connectTo(o)}if(i instanceof yo.e)for(const a of i.signalOutputs)for(const c of a.connectedPointIds){const o=Jo(q,c);a.connectTo(o)}}for(const i of a.executionContexts)Zo(i,{graph:s,valueParseFunction:t},a.rightHanded);return s}(a,c,s)}function Zo(a,c,o){const s=c.graph.createContext();a.enableLogging&&(s.enableLogging=!0),s.treatDataAsRightHanded=o||!1;const q=c.valueParseFunction??ko.d;s.uniqueId=a.uniqueId;const t=s.Za();if(a._assetsContext){var i,p,G,T,C,j,L,e,g,M;const c=a._assetsContext,o={meshes:null===(i=c.meshes)||void 0===i?void 0:i.map((a=>t.getMeshById(a))),lights:null===(p=c.lights)||void 0===p?void 0:p.map((a=>t.getLightByName(a))),cameras:null===(G=c.cameras)||void 0===G?void 0:G.map((a=>t.getCameraByName(a))),materials:null===(T=c.materials)||void 0===T?void 0:T.map((a=>t.getMaterialById(a))),textures:null===(C=c.textures)||void 0===C?void 0:C.map((a=>t.getTextureByName(a))),animations:null===(j=c.animations)||void 0===j?void 0:j.map((a=>t.animations.find((c=>c.name===a)))),skeletons:null===(L=c.skeletons)||void 0===L?void 0:L.map((a=>t.getSkeletonByName(a))),IL:null===(e=c.IL)||void 0===e?void 0:e.map((a=>t.getParticleSystemById(a))),animationGroups:null===(g=c.animationGroups)||void 0===g?void 0:g.map((a=>t.getAnimationGroupByName(a))),transformNodes:null===(M=c.transformNodes)||void 0===M?void 0:M.map((a=>t.getTransformNodeById(a))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Re:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};s.assetsContext=o}for(const N in a._userVariables){const c=q(N,a._userVariables,s.assetsContext,t);s.userVariables[N]=c}for(const N in a._connectionValues){const c=q(N,a._connectionValues,s.assetsContext,t);s._setConnectionValueByKey(N,c)}return s}function ho(a,c,o){const s={},q=c.valueParseFunction??ko.d;if(a.config)for(const i in a.config)s[i]=q(i,a.config,c.assetsContainer||c.ao,c.ao);if((0,ko.k)(a.className)){if(!c.pathConverter)throw new Error("Path converter is required for this block");s.pathConverter=c.pathConverter}const t=new o(s);t.uniqueId=a.uniqueId;for(let i=0;i<a.dataInputs.length;i++){const c=t.getDataInput(a.dataInputs[i].name);if(!c)throw new Error("Could not find data input with name "+a.dataInputs[i].name+" in block "+a.className);c.deserialize(a.dataInputs[i])}for(let i=0;i<a.dataOutputs.length;i++){const c=t.getDataOutput(a.dataOutputs[i].name);if(!c)throw new Error("Could not find data output with name "+a.dataOutputs[i].name+" in block "+a.className);c.deserialize(a.dataOutputs[i])}return t.metadata=a.metadata,t.deserialize&&t.deserialize(a),t}function Uo(a){const[c,o]=a.split(":");return So({op:c,extension:o})}function So(a){var c;let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=a.extension?null===(c=xo[a.extension])||void 0===c?void 0:c[a.op]:Ro[a.op];if(!s&&(M.c.Warn(`No mapping found for operation ${a.op} and extension ${a.extension||"KHR_interactivity"}`),o)){const c={},o={flows:{}};if(a.inputValueSockets){c.values={};for(const o in a.inputValueSockets)c.values[o]={name:o}}return a.outputValueSockets&&(o.values={},Object.keys(a.outputValueSockets).forEach((a=>{o.values[a]={name:a}}))),{sj:[],inputs:c,outputs:o}}return s}function ro(a,c,o){xo[c]||(xo[c]={}),xo[c][a]=o}const xo={BABYLON:{"flow/log":{sj:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Ro={"event/onStart":{sj:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{sj:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{sj:["FlowGraphSendCustomEventBlock"],extraProcessor(a,c,o,s,q){if("event/send"!==c.op||!a.configuration||1!==Object.keys(a.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const t=a.configuration.event.value[0];if("number"!==typeof t)throw new Error("Event id should be a number");const i=s.arrays.events[t],p=q[0];return p.config||(p.config={}),p.config.eventId=i.eventId,p.config.eventData=i.eventData,q}},"event/receive":{sj:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(a,c){var o;if(!a.configuration)return M.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const s=a.configuration.event;if(!s)return M.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const q=s.value[0];if("number"!==typeof q)return M.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(o=c.events)||void 0===o?void 0:o[q])?{valid:!0}:(M.c.Error(`Event with id ${q} not found`),{valid:!1,error:`Event with id ${q} not found`})},extraProcessor(a,c,o,s,q){if("event/receive"!==c.op||!a.configuration||1!==Object.keys(a.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const t=a.configuration.event.value[0];if("number"!==typeof t)throw new Error("Event id should be a number");const i=s.arrays.events[t],p=q[0];return p.config||(p.config={}),p.config.eventId=i.eventId,p.config.eventData=i.eventData,q}},"math/e":Xo("FlowGraphEBlock"),"math/pi":Xo("FlowGraphPIBlock"),"math/inf":Xo("FlowGraphInfBlock"),"math/nan":Xo("FlowGraphNaNBlock"),"math/abs":Xo("FlowGraphAbsBlock"),"math/sign":Xo("FlowGraphSignBlock"),"math/trunc":Xo("FlowGraphTruncBlock"),"math/floor":Xo("FlowGraphFloorBlock"),"math/ceil":Xo("FlowGraphCeilBlock"),"math/round":{sj:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,c,o,s,q){var t;return(t=q[0]).config||(t.config={}),q[0].config.roundHalfAwayFromZero=!0,q}},"math/fract":Xo("FlowGraphFractBlock"),"math/neg":Xo("FlowGraphNegationBlock"),"math/add":Xo("FlowGraphAddBlock",["a","b"],!0),"math/sub":Xo("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{sj:["FlowGraphMultiplyBlock"],extraProcessor(a,c,o,s,q){var t;(t=q[0]).config||(t.config={}),q[0].config.useMatrixPerComponent=!0,q[0].config.preventIntegerFloatArithmetic=!0;let i=-1;return Object.keys(a.values||{}).find((c=>{var o;return void 0!==(null===(o=a.values)||void 0===o?void 0:o[c].type)&&(i=a.values[c].type,!0)})),-1!==i&&(q[0].config.type=s.arrays.types[i].flowGraphType),q},validation:a=>a.values?Wo(a):{valid:!0}},"math/div":Xo("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Xo("FlowGraphModuloBlock",["a","b"]),"math/min":Xo("FlowGraphMinBlock",["a","b"]),"math/max":Xo("FlowGraphMaxBlock",["a","b"]),"math/clamp":Xo("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Xo("FlowGraphSaturateBlock"),"math/mix":Xo("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Xo("FlowGraphEqualityBlock",["a","b"]),"math/lt":Xo("FlowGraphLessThanBlock",["a","b"]),"math/le":Xo("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Xo("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Xo("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Xo("FlowGraphIsNaNBlock"),"math/isinf":Xo("FlowGraphIsInfBlock"),"math/select":{sj:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{sj:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Xo("FlowGraphSinBlock"),"math/cos":Xo("FlowGraphCosBlock"),"math/tan":Xo("FlowGraphTanBlock"),"math/asin":Xo("FlowGraphASinBlock"),"math/acos":Xo("FlowGraphACosBlock"),"math/atan":Xo("FlowGraphATanBlock"),"math/atan2":Xo("FlowGraphATan2Block",["a","b"]),"math/sinh":Xo("FlowGraphSinhBlock"),"math/cosh":Xo("FlowGraphCoshBlock"),"math/tanh":Xo("FlowGraphTanhBlock"),"math/asinh":Xo("FlowGraphASinhBlock"),"math/acosh":Xo("FlowGraphACoshBlock"),"math/atanh":Xo("FlowGraphATanhBlock"),"math/exp":Xo("FlowGraphExponentialBlock"),"math/log":Xo("FlowGraphLogBlock"),"math/log2":Xo("FlowGraphLog2Block"),"math/log10":Xo("FlowGraphLog10Block"),"math/sqrt":Xo("FlowGraphSquareRootBlock"),"math/cbrt":Xo("FlowGraphCubeRootBlock"),"math/pow":Xo("FlowGraphPowerBlock",["a","b"]),"math/length":Xo("FlowGraphLengthBlock"),"math/normalize":Xo("FlowGraphNormalizeBlock"),"math/dot":Xo("FlowGraphDotBlock",["a","b"]),"math/cross":Xo("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Xo("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Xo("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{sj:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{sj:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{sj:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{sj:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{sj:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{sj:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{sj:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Xo("FlowGraphTransposeBlock"),"math/determinant":Xo("FlowGraphDeterminantBlock"),"math/inverse":Xo("FlowGraphInvertMatrixBlock"),"math/matmul":Xo("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{sj:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"uc",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,c,o,s,q,t){const i=q[0].dataInputs.find((a=>"rotationQuaternion"===a.name));if(!i)throw new Error("Rotation quaternion input not found");return t._connectionValues[i.uniqueId]&&(t._connectionValues[i.uniqueId].type="Quaternion"),q}},"math/matDecompose":{sj:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"uc"}}}},"math/quatConjugate":Xo("FlowGraphConjugateBlock",["a"]),"math/quatMul":{sj:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,c,o,s,q){var t;return(t=q[0]).config||(t.config={}),q[0].config.type="Quaternion",q}},"math/quatAngleBetween":Xo("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{sj:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Xo("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Xo("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{sj:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,c,o,s,q){var t;return(t=q[0]).config||(t.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract2x2":{sj:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{sj:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,c,o,s,q){var t;return(t=q[0]).config||(t.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract3x3":{sj:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{sj:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,c,o,s,q){var t;return(t=q[0]).config||(t.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract4x4":{sj:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{sj:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,c,o,s,q,t){var i,p;(p=q[0]).config||(p.config={});const G=q[0].dataInputs[0];return q[0].config.valueType=(null===(i=t._connectionValues[G.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",q}},"math/and":{sj:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,c,o,s,q,t){var i,p,G;(G=q[0]).config||(G.config={});const T=q[0].dataInputs[0],C=q[0].dataInputs[1];return q[0].config.valueType=(null===(i=t._connectionValues[T.uniqueId])||void 0===i?void 0:i.type)??(null===(p=t._connectionValues[C.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",q}},"math/or":{sj:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,c,o,s,q,t){var i,p,G;(G=q[0]).config||(G.config={});const T=q[0].dataInputs[0],C=q[0].dataInputs[1];return q[0].config.valueType=(null===(i=t._connectionValues[T.uniqueId])||void 0===i?void 0:i.type)??(null===(p=t._connectionValues[C.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",q}},"math/xor":{sj:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,c,o,s,q,t){var i,p,G;(G=q[0]).config||(G.config={});const T=q[0].dataInputs[0],C=q[0].dataInputs[1];return q[0].config.valueType=(null===(i=t._connectionValues[T.uniqueId])||void 0===i?void 0:i.type)??(null===(p=t._connectionValues[C.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",q}},"math/asr":Xo("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Xo("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Xo("FlowGraphLeadingZerosBlock"),"math/ctz":Xo("FlowGraphTrailingZerosBlock"),"math/popcnt":Xo("FlowGraphOneBitsCounterBlock"),"math/rad":Xo("FlowGraphDegToRadBlock"),"math/deg":Xo("FlowGraphRadToDegBlock"),"type/boolToInt":Xo("FlowGraphBooleanToInt"),"type/boolToFloat":Xo("FlowGraphBooleanToFloat"),"type/intToBool":Xo("FlowGraphIntToBoolean"),"type/intToFloat":Xo("FlowGraphIntToFloat"),"type/floatToInt":Xo("FlowGraphFloatToInt"),"type/floatToBool":Xo("FlowGraphFloatToBoolean"),"flow/sequence":{sj:["FlowGraphSequenceBlock"],extraProcessor(a,c,o,s,q){const t=q[0];return t.config||(t.config={}),t.config.outputSignalCount=Object.keys(a.flows||[]).length,t.signalOutputs.forEach(((a,c)=>{a.name="out_"+c})),q}},"flow/branch":{sj:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{sj:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(a){if(a.configuration&&a.configuration.cases){const c=a.configuration.cases.value;if(!c.every((a=>"number"===typeof a&&/^-?\d+$/.test(a.toString()))))return M.c.Warn("Switch cases should be integers. Using empty array instead."),a.configuration.cases.value=[],{valid:!0};const o=new Set(c);a.configuration.cases.value=Array.from(o)}return{valid:!0}},extraProcessor(a,c,o,s,q){if("flow/switch"!==c.op||!a.flows||0===Object.keys(a.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return q[0].signalOutputs.forEach((a=>{"default"!==a.name&&(a.name="out_"+a.name)})),q}},"flow/while":{sj:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{sj:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(a,c,o,s,q){const t=q[0];return t.config||(t.config={}),t.config.incrementIndexWhenLoopDone=!0,q}},"flow/doN":{sj:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{sj:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(a,c,o,s,q){if("flow/multiGate"!==c.op||!a.flows||0===Object.keys(a.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const t=q[0];return t.config||(t.config={}),t.config.outputSignalCount=Object.keys(a.flows).length,t.signalOutputs.forEach(((a,c)=>{a.name="out_"+c})),q}},"flow/waitAll":{sj:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(a){var c,o;return"number"!==typeof(null===(c=a.configuration)||void 0===c||null===(o=c.inputFlows)||void 0===o?void 0:o.value[0])&&(a.configuration=a.configuration||{inputFlows:{value:[0]}},a.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{sj:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{sj:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{sj:["FlowGraphCancelDelayBlock"]},"variable/get":{sj:["FlowGraphGetVariableBlock"],validation(a){var c,o;return null!==(c=a.configuration)&&void 0!==c&&null!==(o=c.variable)&&void 0!==o&&o.value?{valid:!0}:(M.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(a,c)=>[c.getVariableName(a[0])]}}},"variable/set":{sj:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(a,c)=>[c.getVariableName(a[0])]}}},"variable/setMultiple":{sj:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(a,c)=>[a[0].map((a=>c.getVariableName(a)))]}},extraProcessor:(a,c,o,s,q)=>(q[0].dataInputs.forEach((a=>{a.name=s.getVariableName(+a.name)})),q)},"variable/interpolate":{sj:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(a,c)=>[c.getVariableName(a[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:a=>!0===a[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",js:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",js:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",js:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",js:"FlowGraphPlayAnimationBlock"},out:{name:"out",js:"FlowGraphPlayAnimationBlock"},done:{name:"done",js:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(a,c,o,s,q){var t,i,p;const G=q[0],T=null===(t=a.configuration)||void 0===t?void 0:t.variable.value[0];if("number"!==typeof T)throw M.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const C=s.arrays.staticVariables[T];"undefined"===typeof G.config.animationType.value&&(s.arrays.staticVariables,G.config.animationType.value=(0,no.B)(C.type));const j=q[4];return j.config||(j.config={}),(i=j.config).variable||(i.variable={}),j.config.variable.value=s.getVariableName(T),(p=q[3]).config||(p.config={}),q}},"pointer/get":{sj:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",js:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",js:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(a,c,o,s,q)=>(q.forEach((a=>{"FlowGraphJsonPointerParserBlock"===a.className&&(a.config||(a.config={}),a.config.outputValue=!0)})),q)},"pointer/set":{sj:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",js:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",js:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(a,c,o,s,q)=>(q.forEach((a=>{"FlowGraphJsonPointerParserBlock"===a.className&&(a.config||(a.config={}),a.config.outputValue=!0)})),q)},"pointer/interpolate":{sj:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",js:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",js:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",js:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",js:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",js:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",js:"FlowGraphPlayAnimationBlock"},out:{name:"out",js:"FlowGraphPlayAnimationBlock"},done:{name:"done",js:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(a,c,o,s,q)=>(q.forEach((c=>{"FlowGraphJsonPointerParserBlock"===c.className?(c.config||(c.config={}),c.config.outputValue=!0):"FlowGraphInterpolationBlock"===c.className&&(c.config||(c.config={}),Object.keys(a.values||[]).forEach((o=>{var q;const t=null===(q=a.values)||void 0===q?void 0:q[o];if("value"===o&&t){const a=t.type;void 0!==a&&(c.config.animationType=s.arrays.types[a].flowGraphType)}})))})),q)},"animation/start":{sj:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",js:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(a,c)=>[a[0]*c._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(a,c)=>[a[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(a,c,o,s,q,t,i){const p=q[q.length-1];return p.config||(p.config={}),p.config.glTF=i,q}},"animation/stop":{sj:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",js:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(a,c,o,s,q,t,i){const p=q[q.length-1];return p.config||(p.config={}),p.config.glTF=i,q}},"animation/stopAt":{sj:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",js:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(a,c)=>[a[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(a,c,o,s,q,t,i){const p=q[q.length-1];return p.config||(p.config={}),p.config.glTF=i,q}},"math/switch":{sj:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(a){if(a.configuration&&a.configuration.cases){const c=a.configuration.cases.value;if(!c.every((a=>"number"===typeof a&&/^-?\d+$/.test(a.toString()))))return M.c.Warn("Switch cases should be integers. Using empty array instead."),a.configuration.cases.value=[],{valid:!0};const o=new Set(c);a.configuration.cases.value=Array.from(o)}return{valid:!0}},extraProcessor(a,c,o,s,q){const t=q[0];return t.dataInputs.forEach((a=>{"default"!==a.name&&"case"!==a.name&&(a.name="in_"+a.name)})),t.config||(t.config={}),t.config.treatCasesAsIntegers=!0,q}},"debug/log":{sj:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Xo(a){let c=arguments.length>2?arguments[2]:void 0;return{sj:[a],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((a,c)=>(a[c]={name:c},a)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(a,o,s,q,t){var i;if(c){(i=t[0]).config||(i.config={}),t[0].config.preventIntegerFloatArithmetic=!0;let c=-1;Object.keys(a.values||{}).find((o=>{var s;return void 0!==(null===(s=a.values)||void 0===s?void 0:s[o].type)&&(c=a.values[o].type,!0)})),-1!==c&&(t[0].config.type=q.arrays.types[c].flowGraphType)}return t},validation:a=>c?Wo(a):{valid:!0}}}function Wo(a){if(a.values){const c=Object.keys(a.values).map((c=>a.values[c].type)).filter((a=>void 0!==a));if(!c.every((a=>a===c[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Ro["math/compose"]=Ro["math/matCompose"],Ro["math/decompose"]=Ro["math/matDecompose"];var Fo=o(12779);const Oo={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Hc",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Bo{constructor(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=a,this._gltf=c,this._animationTargetFps=o,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const a of this._interactivityGraph.types)this._types.push(Oo[a.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const a of this._interactivityGraph.declarations){const c=So(a);if(!c)throw M.c.Error(["No mapping found for declaration",a]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:c,fullOperationName:a.extension?a.op+":"+a.extension:a.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const a of this._interactivityGraph.variables){const c=this._parseVariable(a);this._staticVariables.push(c)}}_parseVariable(a,c){const o=this._types[a.type];if(!o)throw M.c.Error(["No type found for variable",a]),new Error("Error parsing variables");if(a.value&&a.value.length!==o.length)throw M.c.Error(["Invalid value length for variable",a,o]),new Error("Error parsing variables");const s=a.value||[];if(!s.length)switch(o.flowGraphType){case"boolean":s.push(!1);break;case"FlowGraphInteger":s.push(0);break;case"number":s.push(NaN);break;case"Vector2":s.push(NaN,NaN);break;case"Hc":s.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":s.fill(NaN,0,4);break;case"Matrix":s.fill(NaN,0,16);break;case"Matrix3D":s.fill(NaN,0,9)}return"number"===o.elementType&&"string"===typeof s[0]&&(s[0]=parseFloat(s[0])),{type:o.flowGraphType,value:c?c(s,this):s}}_parseEvents(){if(this._interactivityGraph.events)for(const a of this._interactivityGraph.events){const c={eventId:a.id||"internalEvent_"+this._internalEventsCounter++};a.values&&(c.eventData=Object.keys(a.values).map((c=>{var o;const s=null===(o=a.values)||void 0===o?void 0:o[c];if(!s)throw M.c.Error(["No value found for event key",c]),new Error("Error parsing events");const q=this._types[s.type];if(!q)throw M.c.Error(["No type found for event value",s]),new Error("Error parsing events");const t="undefined"!==typeof s.value?this._parseVariable(s):void 0;return{id:c,type:q.flowGraphType,eventData:!0,value:t}}))),this._events.push(c)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const c of this._interactivityGraph.nodes){if("number"!==typeof c.declaration)throw M.c.Error(["No declaration found for node",c]),new Error("Error parsing nodes");const o=this._mappings[c.declaration];if(!o)throw M.c.Error(["No mapping found for node",c]),new Error("Error parsing nodes");if(o.flowGraphMapping.validation){const s=o.flowGraphMapping.validation(c,this._interactivityGraph,this._gltf);var a;if(!s.valid)throw new Error(`Error validating interactivity node ${null===(a=this._interactivityGraph.declarations)||void 0===a?void 0:a[c.declaration].op} - ${s.error}`)}const s=[];for(const a of o.flowGraphMapping.sj){const q=this._getEmptyBlock(a,o.fullOperationName);this._parseNodeConfiguration(c,q,o.flowGraphMapping,a),s.push(q)}this._nodes.push({sj:s,fullOperationName:o.fullOperationName})}}_getEmptyBlock(a,c){return{uniqueId:(0,Fo.d)(),className:a,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:c,metadata:{}}}_parseNodeConfiguration(a,c,o,s){const q=c.config;if(a.configuration){const c=Object.keys(a.configuration);for(const p of c){var t,i;const c=null===(t=a.configuration)||void 0===t?void 0:t[p];if(!c)throw M.c.Error(["No value found for node configuration",p]),new Error("Error parsing node configuration");const G=null===(i=o.configuration)||void 0===i?void 0:i[p];if(G&&G.js?G.js===s:0===o.sj.indexOf(s)){const a=(null===G||void 0===G?void 0:G.name)||p;c&&"undefined"!==typeof c.value||"undefined"===typeof(null===G||void 0===G?void 0:G.defaultValue)?c.value.length>=0?q[a]={value:1===c.value.length?c.value[0]:c.value}:M.c.Warn(["Invalid value for node configuration",c]):q[a]={value:G.defaultValue},G&&G.dataTransformer&&(q[a].value=G.dataTransformer([q[a].value],this)[0])}}}}_parseNodeConnections(a){for(let w=0;w<this._nodes.length;w++){var c;const Z=null===(c=this._interactivityGraph.nodes)||void 0===c?void 0:c[w];if(!Z)throw M.c.Error(["No node found for interactivity node",this._nodes[w]]),new Error("Error parsing node connections");const h=this._nodes[w],U=this._mappings[Z.declaration];if(!U)throw M.c.Error(["No mapping found for node",Z]),new Error("Error parsing node connections");const S=Z.flows||{},r=Object.keys(S).sort();for(const a of r){var o,s,q,t;const c=S[a],T=null===(o=U.flowGraphMapping.outputs)||void 0===o||null===(s=o.flows)||void 0===s?void 0:s[a],C=(null===T||void 0===T?void 0:T.name)||a,j=this._createNewSocketConnection(C,!0);(T&&T.js&&h.sj.find((a=>a.className===T.js))||h.sj[0]).signalOutputs.push(j);const L=c.node,e=this._nodes[L];if(!e)throw M.c.Error(["No node found for input node id",L]),new Error("Error parsing node connections");const g=Uo(e.fullOperationName);if(!g)throw M.c.Error(["No mapping found for input node",e]),new Error("Error parsing node connections");let N=null===(q=g.inputs)||void 0===q||null===(t=q.flows)||void 0===t?void 0:t[c.socket||"in"],y=!1;if(!N)for(const a in null===(i=g.inputs)||void 0===i?void 0:i.flows){var i,p,G;if(a.startsWith("[")&&a.endsWith("]"))y=!0,N=null===(p=g.inputs)||void 0===p||null===(G=p.flows)||void 0===G?void 0:G[a]}const k=N?y?N.name.replace("$1",c.socket||""):N.name:c.socket||"in",n=N&&N.js&&e.sj.find((a=>a.className===N.js))||e.sj[0];let f=n.signalInputs.find((a=>a.name===k));f||(f=this._createNewSocketConnection(k),n.signalInputs.push(f)),f.connectedPointIds.push(j.uniqueId),j.connectedPointIds.push(f.uniqueId)}const x=Z.values||{},R=Object.keys(x);for(const c of R){var T,C;const o=x[c];let s=null===(T=U.flowGraphMapping.inputs)||void 0===T||null===(C=T.values)||void 0===C?void 0:C[c],q=!1;if(!s)for(const a in null===(j=U.flowGraphMapping.inputs)||void 0===j?void 0:j.values){var j,L,e;if(a.startsWith("[")&&a.endsWith("]"))q=!0,s=null===(L=U.flowGraphMapping.inputs)||void 0===L||null===(e=L.values)||void 0===e?void 0:e[a]}const t=s?q?s.name.replace("$1",c):s.name:c,i=this._createNewSocketConnection(t);if((s&&s.js&&h.sj.find((a=>a.className===s.js))||h.sj[0]).dataInputs.push(i),void 0!==o.value){const c=this._parseVariable(o,s&&s.dataTransformer);a._connectionValues[i.uniqueId]=c}else{if("undefined"===typeof o.node)throw M.c.Error(["Invalid value for value connection",o]),new Error("Error parsing node connections");{var g,N,y;const a=o.node,c=o.socket||"value",s=this._nodes[a];if(!s)throw M.c.Error(["No node found for output socket reference",o]),new Error("Error parsing node connections");const q=Uo(s.fullOperationName);if(!q)throw M.c.Error(["No mapping found for output socket reference",o]),new Error("Error parsing node connections");let t=null===(g=q.outputs)||void 0===g||null===(N=g.values)||void 0===N?void 0:N[c],p=!1;if(!t)for(const o in null===(k=q.outputs)||void 0===k?void 0:k.values){var k,n,f;if(o.startsWith("[")&&o.endsWith("]"))p=!0,t=null===(n=q.outputs)||void 0===n||null===(f=n.values)||void 0===f?void 0:f[o]}const G=t?p?t.name.replace("$1",c):null===(y=t)||void 0===y?void 0:y.name:c,T=t&&t.js&&s.sj.find((a=>a.className===t.js))||s.sj[0];let C=T.dataOutputs.find((a=>a.name===G));C||(C=this._createNewSocketConnection(G,!0),T.dataOutputs.push(C)),i.connectedPointIds.push(C.uniqueId),C.connectedPointIds.push(i.uniqueId)}}}if(U.flowGraphMapping.interBlockConnectors)for(const a of U.flowGraphMapping.interBlockConnectors){const c=a.input,o=a.output,s=a.isVariable;this._connectFlowGraphNodes(c,o,h.sj[a.inputBlockIndex],h.sj[a.outputBlockIndex],s)}if(U.flowGraphMapping.extraProcessor){var J;const c=null===(J=this._interactivityGraph.declarations)||void 0===J?void 0:J[Z.declaration];if(!c)throw M.c.Error(["No declaration found for extra processor",Z]),new Error("Error parsing node connections");h.sj=U.flowGraphMapping.extraProcessor(Z,c,U.flowGraphMapping,this,h.sj,a,this._gltf)}}}_createNewSocketConnection(a,c){return{uniqueId:(0,Fo.d)(),name:a,_connectionType:c?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(a,c,o,s,q){const t=q?o.dataInputs:o.signalInputs,i=q?s.dataOutputs:s.signalOutputs,p=t.find((c=>c.name===a))||this._createNewSocketConnection(a),G=i.find((a=>a.name===c))||this._createNewSocketConnection(c,!0);t.find((c=>c.name===a))||t.push(p),i.find((a=>a.name===c))||i.push(G),p.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(p.uniqueId)}getVariableName(a){return"staticVariable_"+a}serializeToFlowGraph(){const a={uniqueId:(0,Fo.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(a);for(let c=0;c<this._staticVariables.length;c++){const o=this._staticVariables[c];a._userVariables[this.getVariableName(c)]=o}return{rightHanded:!0,allBlocks:this._nodes.reduce(((a,c)=>a.concat(c.sj)),[]),executionContexts:[a]}}}const uo="KHR_interactivity";class Ko{constructor(a){this._loader=a,this.name=uo,this.enabled=this._loader.isExtensionUsed(uo),this._pathConverter=(0,K.j)(this._loader.nc),a._skipStartAnimationStep=!0;const c=a.babylonScene;c&&function(a){(0,K.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!a.activeCamera)return new q.Quaternion(NaN,NaN,NaN,NaN);const c=q.Quaternion.FromRotationMatrix(a.activeCamera.getWorldMatrix()).normalize();return a.useRightHandedSystem||(c.w*=-1,c.x*=-1),c},type:"Quaternion",getTarget:()=>a.activeCamera}),(0,K.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!a.activeCamera)return new q.Hc(NaN,NaN,NaN);const c=a.activeCamera.getWorldMatrix().getTranslation();return a.useRightHandedSystem||(c.x*=-1),c},type:"Hc",getTarget:()=>a.activeCamera}),(0,K.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:a=>{var c;return(null===(c=a._babylonAnimationGroup)||void 0===c?void 0:c.isPlaying)??!1},type:"boolean",getTarget:a=>a._babylonAnimationGroup}),(0,K.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:a=>{var c;return((null===(c=a._babylonAnimationGroup)||void 0===c?void 0:c.from)??0)/60},type:"number",getTarget:a=>a._babylonAnimationGroup}),(0,K.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:a=>{var c;return((null===(c=a._babylonAnimationGroup)||void 0===c?void 0:c.to)??0)/60},type:"number",getTarget:a=>a._babylonAnimationGroup}),(0,K.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:a=>{var c;return((null===(c=a._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:a=>a._babylonAnimationGroup}),(0,K.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:a=>{var c;return((null===(c=a._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:a=>a._babylonAnimationGroup})}(c)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var a;if(!this._loader.babylonScene||!this._pathConverter)return;const c=this._loader.babylonScene,o=null===(a=this._loader.nc.extensions)||void 0===a?void 0:a.KHR_interactivity;if(!o)return;const s=new go.c({ao:c});s.dispatchEventsSynchronously=!1;const q=o.graphs.map((a=>new Bo(a,this._loader.nc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(q.map((async a=>await wo(a,{coordinator:s,pathConverter:this._pathConverter})))),s.start()}}var Do;Do=async()=>(await Promise.resolve().then(o.bind(o,14449))).FlowGraphGLTFDataProvider,Mo[`${uo}/${"FlowGraphGLTFDataProvider"}`]=Do,u(uo),B(uo,!0,(a=>new Ko(a)));const Io="KHR_node_visibility";(0,K.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:a=>{const c=a._babylonTransformNode;return!c||void 0===c.isVisible||c.isVisible},set:(a,c)=>{var o,s;null===(o=c._primitiveBabylonMeshes)||void 0===o||o.forEach((a=>{a.inheritVisibility=!0})),c._babylonTransformNode&&(c._babylonTransformNode.isVisible=a),null===(s=c._primitiveBabylonMeshes)||void 0===s||s.forEach((c=>{c.isVisible=a}))},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Yo{constructor(a){this.name=Io,this._loader=a,this.enabled=a.isExtensionUsed(Io)}async onReady(){var a;null===(a=this._loader.nc.nodes)||void 0===a||a.forEach((a=>{var c,o,s,q;(null===(c=a._primitiveBabylonMeshes)||void 0===c||c.forEach((a=>{a.inheritVisibility=!0})),null!==(o=a.extensions)&&void 0!==o&&o.KHR_node_visibility)&&(!1===(null===(s=a.extensions)||void 0===s?void 0:s.KHR_node_visibility.visible)&&(a._babylonTransformNode&&(a._babylonTransformNode.isVisible=!1),null===(q=a._primitiveBabylonMeshes)||void 0===q||q.forEach((a=>{a.isVisible=!1}))))}))}dispose(){this._loader=null}}u(Io),B(Io,!0,(a=>new Yo(a)));const Po="KHR_node_selectability";ro("event/onSelect",Po,{sj:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",js:"FlowGraphGetVariableBlock",dataTransformer:a=>["pickedMesh_"+a[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",js:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(a,c,o,s,q,t,i){var p,G,T,C,j,L;const e=q[q.length-1];e.config=e.config||{},e.config.glTF=i;const g=null===(p=a.configuration)||void 0===p||null===(G=p.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===g||"number"!==typeof g)throw new Error("nodeIndex not found in configuration");const M="pickedMesh_"+g;return q[1].config.variable=M,t._userVariables[M]={className:"Mesh",id:null===i||void 0===i||null===(T=i.nodes)||void 0===T||null===(C=T[g]._babylonTransformNode)||void 0===C?void 0:C.id,uniqueId:null===i||void 0===i||null===(j=i.nodes)||void 0===j||null===(L=j[g]._babylonTransformNode)||void 0===L?void 0:L.uniqueId},q}}),(0,K.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:a=>{const c=a._babylonTransformNode;return!c||void 0===c.dT||c.dT},set:(a,c)=>{var o;null===(o=c._primitiveBabylonMeshes)||void 0===o||o.forEach((c=>{c.dT=a}))},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"dT"],type:"boolean"});class ms{constructor(a){this.name=Po,this._loader=a,this.enabled=a.isExtensionUsed(Po)}async onReady(){var a;null===(a=this._loader.nc.nodes)||void 0===a||a.forEach((a=>{var c,o,s;null!==(c=a.extensions)&&void 0!==c&&c.KHR_node_selectability&&!1===(null===(o=a.extensions)||void 0===o?void 0:o.KHR_node_selectability.selectable)&&(null===(s=a._babylonTransformNode)||void 0===s||s.getChildMeshes().forEach((a=>{a.dT=!1})))}))}dispose(){this._loader=null}}u(Po),B(Po,!0,(a=>new ms(a)));const Vo="KHR_node_hoverability",Eo="targetMeshPointerOver_";ro("event/onHoverIn",Vo,{sj:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",js:"FlowGraphGetVariableBlock",dataTransformer:a=>[Eo+a[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",js:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(a,c,o,s,q,t,i){var p,G,T,C,j,L;const e=q[q.length-1];e.config=e.config||{},e.config.glTF=i;const g=null===(p=a.configuration)||void 0===p||null===(G=p.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===g||"number"!==typeof g)throw new Error("nodeIndex not found in configuration");const M=Eo+g;return q[1].config.variable=M,t._userVariables[M]={className:"Mesh",id:null===i||void 0===i||null===(T=i.nodes)||void 0===T||null===(C=T[g]._babylonTransformNode)||void 0===C?void 0:C.id,uniqueId:null===i||void 0===i||null===(j=i.nodes)||void 0===j||null===(L=j[g]._babylonTransformNode)||void 0===L?void 0:L.uniqueId},q}});const Ho="targetMeshPointerOut_";ro("event/onHoverOut",Vo,{sj:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",js:"FlowGraphGetVariableBlock",dataTransformer:a=>[Ho+a[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",js:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(a,c,o,s,q,t,i){var p,G,T,C,j,L;const e=q[q.length-1];e.config=e.config||{},e.config.glTF=i;const g=null===(p=a.configuration)||void 0===p||null===(G=p.nodeIndex)||void 0===G?void 0:G.value[0];if(void 0===g||"number"!==typeof g)throw new Error("nodeIndex not found in configuration");const M=Ho+g;return q[1].config.variable=M,t._userVariables[M]={className:"Mesh",id:null===i||void 0===i||null===(T=i.nodes)||void 0===T||null===(C=T[g]._babylonTransformNode)||void 0===C?void 0:C.id,uniqueId:null===i||void 0===i||null===(j=i.nodes)||void 0===j||null===(L=j[g]._babylonTransformNode)||void 0===L?void 0:L.uniqueId},q}}),(0,K.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:a=>{const c=a._babylonTransformNode;return!c||void 0===c.pointerOverDisableMeshTesting||c.pointerOverDisableMeshTesting},set:(a,c)=>{var o;null===(o=c._primitiveBabylonMeshes)||void 0===o||o.forEach((c=>{c.pointerOverDisableMeshTesting=!a}))},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class bo{constructor(a){this.name=Vo,this._loader=a,this.enabled=a.isExtensionUsed(Vo)}async onReady(){var a;null===(a=this._loader.nc.nodes)||void 0===a||a.forEach((a=>{var c,o,s;null!==(c=a.extensions)&&void 0!==c&&c.KHR_node_hoverability&&!1===(null===(o=a.extensions)||void 0===o?void 0:o.KHR_node_hoverability.hoverable)&&(null===(s=a._babylonTransformNode)||void 0===s||s.getChildMeshes().forEach((a=>{a.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}u(Vo),B(Vo,!0,(a=>new bo(a)));const Ao="ExtrasAsMetadata";class vo{_assignExtras(a,c){if(c.extras&&Object.keys(c.extras).length>0){const o=a.metadata=a.metadata||{};(o.nc=o.nc||{}).extras=c.extras}}constructor(a){this.name=Ao,this.enabled=!0,this._loader=a}dispose(){this._loader=null}loadNodeAsync(a,c,o){return this._loader.loadNodeAsync(a,c,(a=>{this._assignExtras(a,c),o(a)}))}loadCameraAsync(a,c,o){return this._loader.loadCameraAsync(a,c,(a=>{this._assignExtras(a,c),o(a)}))}createMaterial(a,c,o){const s=this._loader.createMaterial(a,c,o);return this._assignExtras(s,c),s}}u(Ao),B(Ao,!1,(a=>new vo(a)));o(14449)},14331:(a,c,o)=>{"use strict";o.d(c,{d:()=>X,g:()=>U,h:()=>h,l:()=>S});var s=o(12639),q=o(12637),t=o(13934),i=o(13241),p=o(13209),G=o(13220),T=o(12649),C=o(12680),j=o(13237),L=o(13344),e=o(13246),g=o(12852);class M{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.IL=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Re=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(a){this._environmentTexture=a}getNodes(){let a=[];a=a.concat(this.meshes),a=a.concat(this.lights),a=a.concat(this.cameras),a=a.concat(this.transformNodes);for(const c of this.skeletons)a=a.concat(c.bones);return a}}class N extends M{}class y{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const a=this.rootNodes;for(const s of a)s.dispose();a.length=0;const c=this.skeletons;for(const s of c)s.dispose();c.length=0;const o=this.animationGroups;for(const s of o)s.dispose();o.length=0}}class k extends M{constructor(a){super(),this._wasAddedToScene=!1,(a=a||C.b.LastCreatedScene)&&(this.ao=a,this.proceduralTextures=[],a.gc.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=a.getEngine().onContextRestoredObservable.add((()=>{for(const a of this.geometries)a._rebuild();for(const a of this.meshes)a._rebuild();for(const a of this.IL)a.rebuild();for(const a of this.textures)a._rebuild()})))}_topologicalSort(a){const c=new Map;for(const i of a)c.set(i.uniqueId,i);const o={dependsOn:new Map,dependedBy:new Map};for(const i of a){const a=i.uniqueId;o.dependsOn.set(a,new Set),o.dependedBy.set(a,new Set)}for(const i of a){const a=i.uniqueId,s=o.dependsOn.get(a);if(i instanceof j.d){const q=i.sourceMesh;c.has(q.uniqueId)&&(s.add(q.uniqueId),o.dependedBy.get(q.uniqueId).add(a))}const q=o.dependedBy.get(a);for(const t of i.getDescendants()){const s=t.uniqueId;if(c.has(s)){q.add(s);o.dependsOn.get(s).add(a)}}}const s=[],q=[];for(const i of a){const a=i.uniqueId;0===o.dependsOn.get(a).size&&(q.push(i),c.delete(a))}const t=q;for(;t.length>0;){const a=t.shift();s.push(a);const q=o.dependedBy.get(a.uniqueId);for(const s of Array.from(q.values())){const q=o.dependsOn.get(s);q.delete(a.uniqueId),0===q.size&&c.get(s)&&(t.push(c.get(s)),c.delete(s))}}return c.size>0&&(T.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),c.forEach((a=>{T.c.Error(a.name)}))),s}_addNodeAndDescendantsToList(a,c,o,s){if(o&&(!s||s(o))&&!c.has(o.uniqueId)){a.push(o),c.add(o.uniqueId);for(const q of o.getDescendants(!0))this._addNodeAndDescendantsToList(a,c,q,s)}}_isNodeInContainer(a){return a instanceof G.e&&-1!==this.meshes.indexOf(a)||(a instanceof p.b&&-1!==this.transformNodes.indexOf(a)||(a instanceof L.e&&-1!==this.lights.indexOf(a)||a instanceof e.b&&-1!==this.cameras.indexOf(a)))}_isValidHierarchy(){for(const a of this.meshes)if(a.parent&&!this._isNodeInContainer(a.parent))return T.c.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;for(const a of this.transformNodes)if(a.parent&&!this._isNodeInContainer(a.parent))return T.c.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;for(const a of this.lights)if(a.parent&&!this._isNodeInContainer(a.parent))return T.c.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;for(const a of this.cameras)if(a.parent&&!this._isNodeInContainer(a.parent))return T.c.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const s={},t={},p=new y,G=[],T=[],C={doNotInstantiate:!0,...o},j=[],L=new Set;for(const q of this.transformNodes)null===q.parent&&this._addNodeAndDescendantsToList(j,L,q,C.predicate);for(const q of this.meshes)null===q.parent&&this._addNodeAndDescendantsToList(j,L,q,C.predicate);const e=this._topologicalSort(j),g=(o,q)=>{if(((c,o)=>{if(s[c.uniqueId]=o.uniqueId,t[o.uniqueId]=o,a&&(o.name=a(c.name)),o instanceof i.c){const a=o;if(a.morphTargetManager){const o=c.morphTargetManager;a.morphTargetManager=o.clone();for(let c=0;c<o.numTargets;c++){const q=o.getTarget(c),i=a.morphTargetManager.getTarget(c);s[q.uniqueId]=i.uniqueId,t[i.uniqueId]=i}}}})(o,q),o.parent){const a=s[o.parent.uniqueId],c=t[a];q.parent=c||o.parent}if(q.position&&o.position&&q.position.G(o.position),q.rotationQuaternion&&o.rotationQuaternion&&q.rotationQuaternion.G(o.rotationQuaternion),q.rotation&&o.rotation&&q.rotation.G(o.rotation),q.uc&&o.uc&&q.uc.G(o.uc),q.material){const i=q;if(i.material)if(c){const c=o.material;if(-1===T.indexOf(c)){let o=c.clone(a?a(c.name):"Clone of "+c.name);if(T.push(c),s[c.uniqueId]=o.uniqueId,t[o.uniqueId]=o,"MultiMaterial"===c.getClassName()){const q=c;for(const c of q.Vc)c&&(o=c.clone(a?a(c.name):"Clone of "+c.name),T.push(c),s[c.uniqueId]=o.uniqueId,t[o.uniqueId]=o);q.Vc=q.Vc.map((a=>a&&t[s[a.uniqueId]]))}}"InstancedMesh"!==i.getClassName()&&(i.material=t[s[c.uniqueId]])}else"MultiMaterial"===i.material.getClassName()?-1===this.ao.multiMaterials.indexOf(i.material)&&this.ao.addMultiMaterial(i.material):-1===this.ao.materials.indexOf(i.material)&&this.ao.addMaterial(i.material)}null===q.parent&&p.rootNodes.push(q)};for(const q of e)if("InstancedMesh"===q.getClassName()){const a=q,c=a.sourceMesh,o=s[c.uniqueId];g(a,("number"===typeof o?t[o]:c).createInstance(a.name))}else{let a=!0;"ci"===q.getClassName()||"Node"===q.getClassName()||q.skeleton||!q.getTotalVertices||0===q.getTotalVertices()?a=!1:C.doNotInstantiate&&(a="function"===typeof C.doNotInstantiate?!C.doNotInstantiate(q):!C.doNotInstantiate);const c=a?q.createInstance(`instance of ${q.name}`):q.clone(`Clone of ${q.name}`,null,!0);if(!c)throw new Error(`Could not clone or instantiate node on Asset Container ${q.name}`);g(q,c)}for(const q of this.skeletons){if(C.predicate&&!C.predicate(q))continue;const c=q.clone(a?a(q.name):"Clone of "+q.name);for(const a of this.meshes)if(a.skeleton===q&&!a.isAnInstance){const o=t[s[a.uniqueId]];if(!o||o.isAnInstance)continue;if(o.skeleton=c,-1!==G.indexOf(c))continue;G.push(c);for(const a of c.bones)a._linkedTransformNode&&(a._linkedTransformNode=t[s[a._linkedTransformNode.uniqueId]])}p.skeletons.push(c)}for(const q of this.animationGroups){if(C.predicate&&!C.predicate(q))continue;const c=q.clone(a?a(q.name):"Clone of "+q.name,(a=>t[s[a.uniqueId]]||a));p.animationGroups.push(c)}return p}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.ao.environmentTexture=this.environmentTexture);for(const a of this.ao._serializableComponents)a.addFromContainer(this);this.ao.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=[];for(const o of this.cameras)a&&!a(o)||(this.ao.addCamera(o),c.push(o));for(const o of this.lights)a&&!a(o)||(this.ao.addLight(o),c.push(o));for(const o of this.meshes)a&&!a(o)||(this.ao.AC(o),c.push(o));for(const o of this.skeletons)a&&!a(o)||this.ao.addSkeleton(o);for(const o of this.animations)a&&!a(o)||this.ao.addAnimation(o);for(const o of this.animationGroups)a&&!a(o)||this.ao.addAnimationGroup(o);for(const o of this.multiMaterials)a&&!a(o)||this.ao.addMultiMaterial(o);for(const o of this.materials)a&&!a(o)||this.ao.addMaterial(o);for(const o of this.morphTargetManagers)a&&!a(o)||this.ao.addMorphTargetManager(o);for(const o of this.geometries)a&&!a(o)||this.ao.addGeometry(o);for(const o of this.transformNodes)a&&!a(o)||(this.ao.addTransformNode(o),c.push(o));for(const o of this.actionManagers)a&&!a(o)||this.ao.addActionManager(o);for(const o of this.textures)a&&!a(o)||this.ao.addTexture(o);for(const o of this.reflectionProbes)a&&!a(o)||this.ao.addReflectionProbe(o);for(const o of c)o.parent&&-1===this.ao.getNodes().indexOf(o.parent)&&(o.setParent?o.setParent(null):o.parent=null)}removeAllFromScene(){this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.ao.environmentTexture&&(this.ao.environmentTexture=null);for(const a of this.ao._serializableComponents)a.removeFromContainer(this)}removeFromScene(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const c of this.cameras)a&&!a(c)||this.ao.removeCamera(c);for(const c of this.lights)a&&!a(c)||this.ao.removeLight(c);for(const c of this.meshes)a&&!a(c)||this.ao.bC(c,!0);for(const c of this.skeletons)a&&!a(c)||this.ao.removeSkeleton(c);for(const c of this.animations)a&&!a(c)||this.ao.removeAnimation(c);for(const c of this.animationGroups)a&&!a(c)||this.ao.removeAnimationGroup(c);for(const c of this.multiMaterials)a&&!a(c)||this.ao.removeMultiMaterial(c);for(const c of this.materials)a&&!a(c)||this.ao.removeMaterial(c);for(const c of this.morphTargetManagers)a&&!a(c)||this.ao.removeMorphTargetManager(c);for(const c of this.geometries)a&&!a(c)||this.ao.removeGeometry(c);for(const c of this.transformNodes)a&&!a(c)||this.ao.removeTransformNode(c);for(const c of this.actionManagers)a&&!a(c)||this.ao.removeActionManager(c);for(const c of this.textures)a&&!a(c)||this.ao.removeTexture(c);for(const c of this.reflectionProbes)a&&!a(c)||this.ao.removeReflectionProbe(c)}dispose(){const a=this.cameras.slice(0);for(const e of a)e.dispose();this.cameras.length=0;const c=this.lights.slice(0);for(const e of c)e.dispose();this.lights.length=0;const o=this.meshes.slice(0);for(const e of o)e.dispose();this.meshes.length=0;const s=this.skeletons.slice(0);for(const e of s)e.dispose();this.skeletons.length=0;const q=this.animationGroups.slice(0);for(const e of q)e.dispose();this.animationGroups.length=0;const t=this.multiMaterials.slice(0);for(const e of t)e.dispose();this.multiMaterials.length=0;const i=this.materials.slice(0);for(const e of i)e.dispose();this.materials.length=0;const p=this.geometries.slice(0);for(const e of p)e.dispose();this.geometries.length=0;const G=this.transformNodes.slice(0);for(const e of G)e.dispose();this.transformNodes.length=0;const T=this.actionManagers.slice(0);for(const e of T)e.dispose();this.actionManagers.length=0;const C=this.textures.slice(0);for(const e of C)e.dispose();this.textures.length=0;const j=this.reflectionProbes.slice(0);for(const e of j)e.dispose();this.reflectionProbes.length=0;const L=this.morphTargetManagers.slice(0);for(const e of L)e.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const e of this.ao._serializableComponents)e.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.ao.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(a,c,o){if(a&&c)for(const s of a){let a=!0;if(o)for(const c of o)if(s===c){a=!1;break}a&&(c.push(s),s._parentContainer=this)}}moveAllFromScene(a){this._wasAddedToScene=!1,void 0===a&&(a=new N);for(const c in this)Object.prototype.hasOwnProperty.call(this,c)&&(this[c]=this[c]||("_environmentTexture"===c?null:[]),this._moveAssets(this.ao[c],this[c],a[c]));this.environmentTexture=this.ao.environmentTexture,this.removeAllFromScene()}createRootMesh(){const a=new i.c("assetContainerRootMesh",this.ao);for(const c of this.meshes)c.parent||a.addChild(c);return this.meshes.unshift(a),a}mergeAnimationsTo(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.b.LastCreatedScene,c=arguments.length>1?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!a)return T.c.Error("No scene available to merge animations to"),[];const s=o||(c=>{let o=null;const s=c.animations.length?c.animations[0].targetProperty:"",q=c.name.split(".").join("").split("_primitive")[0];switch(s){case"position":case"rotationQuaternion":o=a.getTransformNodeByName(c.name)||a.getTransformNodeByName(q);break;case"influence":o=a.getMorphTargetByName(c.name)||a.getMorphTargetByName(q);break;default:o=a.getNodeByName(c.name)||a.getNodeByName(q)}return o}),q=this.getNodes();for(const p of q){const a=s(p);if(null!==a){for(const c of p.animations){const o=a.animations.filter((a=>a.targetProperty===c.targetProperty));for(const c of o){const o=a.animations.indexOf(c,0);o>-1&&a.animations.splice(o,1)}}a.animations=a.animations.concat(p.animations)}}const t=[],i=this.animationGroups.slice();for(const p of i){t.push(p.clone(p.name,s));for(const a of p.animatables)a.stop()}for(const p of c){const c=s(p.target);c&&(a.beginAnimation(c,p.fromFrame,p.toFrame,p.loopAnimation,p.speedRatio,p.onAnimationEnd?p.onAnimationEnd:void 0,void 0,!0,void 0,p.onAnimationLoop?p.onAnimationLoop:void 0),a.stopAnimation(p.target))}return t}populateRootNodes(){this.rootNodes.length=0;for(const a of this.meshes)a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a);for(const a of this.transformNodes)a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a);for(const a of this.lights)a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a);for(const a of this.cameras)a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a)}addAllAssetsToContainer(a){if(!a)return;const c=[],o=new Set;for(c.push(a);c.length>0;){const a=c.pop();if(a instanceof i.c?(a.dc&&-1===this.geometries.indexOf(a.dc)&&this.geometries.push(a.dc),this.meshes.push(a)):a instanceof j.d?this.meshes.push(a):a instanceof p.b?this.transformNodes.push(a):a instanceof L.e?this.lights.push(a):a instanceof e.b&&this.cameras.push(a),a instanceof G.e){if(a.material&&-1===this.materials.indexOf(a.material)){this.materials.push(a.material);for(const c of a.material.getActiveTextures())-1===this.textures.indexOf(c)&&this.textures.push(c)}a.skeleton&&-1===this.skeletons.indexOf(a.skeleton)&&this.skeletons.push(a.skeleton),a.morphTargetManager&&-1===this.morphTargetManagers.indexOf(a.morphTargetManager)&&this.morphTargetManagers.push(a.morphTargetManager)}for(const s of a.getChildren())o.has(s)||c.push(s);o.add(a)}this.populateRootNodes()}_getByTags(a,c,o){if(void 0===c)return a;const s=[];for(const q in a){const t=a[q];g.c&&g.c.MatchesQuery(t,c)&&(!o||o(t))&&s.push(t)}return s}getMeshesByTags(a,c){return this._getByTags(this.meshes,a,c)}getCamerasByTags(a,c){return this._getByTags(this.cameras,a,c)}getLightsByTags(a,c){return this._getByTags(this.lights,a,c)}getMaterialsByTags(a,c){return this._getByTags(this.materials,a,c).concat(this._getByTags(this.multiMaterials,a,c))}getTransformNodesByTags(a,c){return this._getByTags(this.transformNodes,a,c)}}var n=o(12695);class f{constructor(a){this.byteOffset=0,this.buffer=a}async loadAsync(a){const c=await this.buffer.readAsync(this.byteOffset,a);this._dataView=new DataView(c.buffer,c.byteOffset,c.byteLength),this._dataByteOffset=0}readUint32(){const a=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,a}readUint8Array(a){const c=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,a);return this._dataByteOffset+=a,this.byteOffset+=a,c}readString(a){return(0,n.g)(this.readUint8Array(a))}skipBytes(a){this._dataByteOffset+=a,this.byteOffset+=a}}var J=o(14336);const w="Z2xURg",Z={name:"nc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:a=>-1!==a.indexOf("asset")&&-1!==a.indexOf("version")||a.startsWith("data:base64,"+w)||a.startsWith("data:;base64,"+w)||a.startsWith("data:application/octet-stream;base64,"+w)||a.startsWith("data:model/gltf-binary;base64,"+w)};var h,U,S,r=o(12689),x=o(12691);function R(a,c,o){try{return Promise.resolve(new Uint8Array(a,c,o))}catch(s){return Promise.reject(s)}}!function(a){a[a.AUTO=0]="AUTO",a[a.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(h||(h={})),function(a){a[a.NONE=0]="NONE",a[a.FIRST=1]="FIRST",a[a.ALL=2]="ALL"}(U||(U={})),function(a){a[a.LOADING=0]="LOADING",a[a.READY=1]="READY",a[a.COMPLETE=2]="COMPLETE"}(S||(S={}));class d{constructor(){this.coordinateSystemMode=h.AUTO,this.animationStartMode=U.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=a=>Promise.resolve(a),this.extensionOptions={}}G(a){a&&(this.onParsed=a.onParsed,this.coordinateSystemMode=a.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=a.animationStartMode??this.animationStartMode,this.loadNodeAnimations=a.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=a.loadSkins??this.loadSkins,this.loadMorphTargets=a.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=a.compileMaterials??this.compileMaterials,this.useClipPlane=a.useClipPlane??this.useClipPlane,this.compileShadowGenerators=a.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=a.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=a.useRangeRequests??this.useRangeRequests,this.createInstances=a.createInstances??this.createInstances,this.alwaysComputeBoundingBox=a.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=a.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=a.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=a.skipMaterials??this.skipMaterials,this.useSRGBBuffers=a.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=a.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=a.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=a.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=a.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=a.customRootNode,this.onMeshLoaded=a.onMeshLoaded,this.onSkinLoaded=a.onSkinLoaded,this.onTextureLoaded=a.onTextureLoaded,this.onMaterialLoaded=a.onMaterialLoaded,this.onCameraLoaded=a.onCameraLoaded,this.extensionOptions=a.extensionOptions??this.extensionOptions)}}class X extends d{constructor(a){super(),this.onParsedObservable=new s.d,this.onMeshLoadedObservable=new s.d,this.onSkinLoadedObservable=new s.d,this.onTextureLoadedObservable=new s.d,this.onMaterialLoadedObservable=new s.d,this.onCameraLoadedObservable=new s.d,this.onCompleteObservable=new s.d,this.onErrorObservable=new s.d,this.gc=new s.d,this.onExtensionLoadedObservable=new s.d,this.validate=!1,this.onValidatedObservable=new s.d,this._loader=null,this._state=null,this._requests=new Array,this.name=Z.name,this.extensions=Z.extensions,this.onLoaderStateChangedObservable=new s.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.G(a)}set onParsed(a){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),a&&(this._onParsedObserver=this.onParsedObservable.add(a))}set onMeshLoaded(a){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),a&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(a))}set onSkinLoaded(a){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),a&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((c=>a(c.node,c.skinnedNode))))}set onTextureLoaded(a){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),a&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(a))}set onMaterialLoaded(a){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),a&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(a))}set onCameraLoaded(a){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),a&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(a))}set onComplete(a){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(a)}set onError(a){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(a)}set onDispose(a){this._onDisposeObserver&&this.gc.remove(this._onDisposeObserver),this._onDisposeObserver=this.gc.add(a)}set onExtensionLoaded(a){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(a)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(a){this._loggingEnabled!==a&&(this._loggingEnabled=a,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(a){this._capturePerformanceCounters!==a&&(this._capturePerformanceCounters=a,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(a){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(a)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const a of this._requests)a.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=a=>Promise.resolve(a),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.gc.notifyObservers(void 0),this.gc.clear()}loadFile(a,c,o,t,i,p,G,C){if(ArrayBuffer.isView(c))return this._loadBinary(a,c,o,t,G,C),null;this._progressCallback=i;const j=c.name||q.Tools.GetFilename(c);if(p){if(this.useRangeRequests){this.validate&&T.c.Warn("glTF validation is not supported when range requests are enabled");const o={abort:()=>{},onCompleteObservable:new s.d},q={readAsync:(o,s)=>new Promise(((q,t)=>{this._loadFile(a,c,(a=>{q(new Uint8Array(a))}),!0,(a=>{t(a)}),(a=>{a.setRequestHeader("Range",`bytes=${o}-${o+s-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new f(q)).then((a=>{o.onCompleteObservable.notifyObservers(o),t(a)}),G?a=>G(void 0,a):void 0),o}return this._loadFile(a,c,(c=>{this._validate(a,new Uint8Array(c,0,c.byteLength),o,j),this._unpackBinaryAsync(new f({readAsync:(a,o)=>R(c,a,o),byteLength:c.byteLength})).then((a=>{t(a)}),G?a=>G(void 0,a):void 0)}),!0,G)}return this._loadFile(a,c,(c=>{try{this._validate(a,c,o,j),t({json:this._parseJson(c)})}catch{G&&G()}}),!1,G)}_loadBinary(a,c,o,s,q,t){this._validate(a,new Uint8Array(c.buffer,c.byteOffset,c.byteLength),o,t),this._unpackBinaryAsync(new f({readAsync:(a,o)=>function(a,c,o){try{if(c<0||c>=a.byteLength)throw new RangeError("Offset is out of range.");if(c+o>a.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(a.buffer,a.byteOffset+c,o))}catch(s){return Promise.reject(s)}}(c,a,o),byteLength:c.byteLength})).then((a=>{s(a)}),q?a=>q(void 0,a):void 0)}importMeshAsync(a,c,o,s,q,t){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(o),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(o),this._loader.importMeshAsync(a,c,null,o,s,q,t))))}loadAsync(a,c,o,s,q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(c),this._loader.loadAsync(a,c,o,s,q))))}loadAssetContainerAsync(a,c,o,s,q){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(c);const t=new k(a),i=[];this.onMaterialLoadedObservable.add((a=>{i.push(a)}));const p=[];this.onTextureLoadedObservable.add((a=>{p.push(a)}));const G=[];this.onCameraLoadedObservable.add((a=>{G.push(a)}));const T=[];return this.onMeshLoadedObservable.add((a=>{a.morphTargetManager&&T.push(a.morphTargetManager)})),this._loader.importMeshAsync(null,a,t,c,o,s,q).then((a=>(Array.prototype.push.apply(t.geometries,a.geometries),Array.prototype.push.apply(t.meshes,a.meshes),Array.prototype.push.apply(t.IL,a.IL),Array.prototype.push.apply(t.skeletons,a.skeletons),Array.prototype.push.apply(t.animationGroups,a.animationGroups),Array.prototype.push.apply(t.materials,i),Array.prototype.push.apply(t.textures,p),Array.prototype.push.apply(t.lights,a.lights),Array.prototype.push.apply(t.transformNodes,a.transformNodes),Array.prototype.push.apply(t.cameras,G),Array.prototype.push.apply(t.morphTargetManagers,T),t)))}))}canDirectLoad(a){return Z.canDirectLoad(a)}directLoad(a,c){if(c.startsWith("base64,"+w)||c.startsWith(";base64,"+w)||c.startsWith("application/octet-stream;base64,"+w)||c.startsWith("model/gltf-binary;base64,"+w)){const o=(0,r.b)(c);return this._validate(a,new Uint8Array(o,0,o.byteLength)),this._unpackBinaryAsync(new f({readAsync:(a,c)=>R(o,a,c),byteLength:o.byteLength}))}return this._validate(a,c),Promise.resolve({json:this._parseJson(c)})}createPlugin(a){return new X(a[Z.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((a,c)=>{this.onCompleteObservable.addOnce((()=>{a()})),this.onErrorObservable.addOnce((a=>{c(a)}))}))}_setState(a){this._state!==a&&(this._state=a,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(S[this._state]))}_loadFile(a,c,o,s,q,t){const i=a._loadFile(c,o,(a=>{this._onProgress(a,i)}),!0,s,q,t);return i.onCompleteObservable.add((()=>{i._lengthComputable=!0,i._total=i._loaded})),this._requests.push(i),i}_onProgress(a,c){if(!this._progressCallback)return;c._lengthComputable=a.lengthComputable,c._loaded=a.loaded,c._total=a.total;let o=!0,s=0,q=0;for(const t of this._requests){if(void 0===t._lengthComputable||void 0===t._loaded||void 0===t._total)return;o=o&&t._lengthComputable,s+=t._loaded,q+=t._total}this._progressCallback({lengthComputable:o,loaded:s,total:o?q:0})}_validate(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),J.b.ValidateAsync(c,o,s,(c=>this.preprocessUrlAsync(o+c).then((c=>a._loadFileAsync(c,void 0,!0,!0).then((a=>new Uint8Array(a,0,a.byteLength))))))).then((a=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(a),this.onValidatedObservable.clear()}),(a=>{this._endPerformanceCounter("Validate JSON"),q.Tools.Warn(`Failed to validate: ${a.message}`),this.onValidatedObservable.clear()})))}_getLoader(a){const c=a.json.asset||{};this._log(`Asset version: ${c.version}`),c.minVersion&&this._log(`Asset minimum version: ${c.minVersion}`),c.generator&&this._log(`Asset generator: ${c.generator}`);const o=X._parseVersion(c.version);if(!o)throw new Error("Invalid version: "+c.version);if(void 0!==c.minVersion){const a=X._parseVersion(c.minVersion);if(!a)throw new Error("Invalid minimum version: "+c.minVersion);if(X._compareVersion(a,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+c.minVersion)}const s={1:X._CreateGLTF1Loader,2:X._CreateGLTF2Loader}[o.major];if(!s)throw new Error("Unsupported version: "+c.version);return s(this)}_parseJson(a){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${a.length}`);const c=JSON.parse(a);return this._endPerformanceCounter("Parse JSON"),c}_unpackBinaryAsync(a){return this._startPerformanceCounter("Unpack Binary"),a.loadAsync(20).then((()=>{const c=a.readUint32();if(1179937895!==c)throw new x.h("Unexpected magic: "+c,x.f.GLTFLoaderUnexpectedMagicError);const o=a.readUint32();this.loggingEnabled&&this._log(`Binary version: ${o}`);const s=a.readUint32();let q;switch(this.useRangeRequests||s===a.buffer.byteLength||T.c.Warn(`Length in header does not match actual data length: ${s} != ${a.buffer.byteLength}`),o){case 1:q=this._unpackBinaryV1Async(a,s);break;case 2:q=this._unpackBinaryV2Async(a,s);break;default:throw new Error("Unsupported version: "+o)}return this._endPerformanceCounter("Unpack Binary"),q}))}_unpackBinaryV1Async(a,c){const o=a.readUint32(),s=a.readUint32();if(0!==s)throw new Error(`Unexpected content format: ${s}`);const q=c-a.byteOffset,t={json:this._parseJson(a.readString(o)),bin:null};if(0!==q){const c=a.byteOffset;t.bin={readAsync:(o,s)=>a.buffer.readAsync(c+o,s),byteLength:q}}return Promise.resolve(t)}_unpackBinaryV2Async(a,c){const o=1313821514,s=5130562,q=a.readUint32();if(a.readUint32()!==o)throw new Error("First chunk format is not JSON");return a.byteOffset+q===c?a.loadAsync(q).then((()=>({json:this._parseJson(a.readString(q)),bin:null}))):a.loadAsync(q+8).then((()=>{const t={json:this._parseJson(a.readString(q)),bin:null},i=()=>{const q=a.readUint32();switch(a.readUint32()){case o:throw new Error("Unexpected JSON chunk");case s:{const c=a.byteOffset;t.bin={readAsync:(o,s)=>a.buffer.readAsync(c+o,s),byteLength:q},a.skipBytes(q);break}default:a.skipBytes(q)}return a.byteOffset!==c?a.loadAsync(8).then(i):Promise.resolve(t)};return i()}))}static _parseVersion(a){if("1.0"===a||"1.0.1"===a)return{major:1,minor:0};const c=(a+"").match(/^(\d+)\.(\d+)/);return c?{major:parseInt(c[1]),minor:parseInt(c[2])}:null}static _compareVersion(a,c){return a.major>c.major?1:a.major<c.major?-1:a.minor>c.minor?1:a.minor<c.minor?-1:0}_logOpen(a){this._log(a),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(a){const c=X._logSpaces.substring(0,2*this._logIndentLevel);T.c.Log(`${c}${a}`)}_logDisabled(a){}_startPerformanceCounterEnabled(a){q.Tools.StartPerformanceCounter(a)}_startPerformanceCounterDisabled(a){}_endPerformanceCounterEnabled(a){q.Tools.EndPerformanceCounter(a)}_endPerformanceCounterDisabled(a){}}X.IncrementalLoading=!0,X.HomogeneousCoordinates=!1,X._logSpaces="                                ",(0,t.d)(new X)},14336:(a,c,o)=>{"use strict";o.d(c,{b:()=>i});var s=o(12637);function q(a,c,o,s){const q={externalResourceFunction:s};return o&&(q.uri="file:"===c?o:c+o),ArrayBuffer.isView(a)?GLTFValidator.validateBytes(a,q):GLTFValidator.validateString(a,q)}function t(){const a=[];onmessage=c=>{const o=c.data;switch(o.id){case"init":importScripts(o.url);break;case"validate":q(o.data,o.rootUrl,o.fileName,(c=>new Promise(((o,s)=>{const q=a.length;a.push({resolve:o,reject:s}),postMessage({id:"getExternalResource",index:q,uri:c})})))).then((a=>{postMessage({id:"validate.resolve",value:a})}),(a=>{postMessage({id:"validate.reject",reason:a})}));break;case"getExternalResource.resolve":a[o.index].resolve(o.value);break;case"getExternalResource.reject":a[o.index].reject(o.reason)}}}class i{static ValidateAsync(a,c,o,i){return"function"===typeof Worker?new Promise(((p,G)=>{const T=`${q}(${t})()`,C=URL.createObjectURL(new Blob([T],{type:"application/javascript"})),j=new Worker(C),L=a=>{j.removeEventListener("error",L),j.removeEventListener("message",e),G(a)},e=a=>{const c=a.data;switch(c.id){case"getExternalResource":i(c.uri).then((a=>{j.postMessage({id:"getExternalResource.resolve",index:c.index,value:a},[a.buffer])}),(a=>{j.postMessage({id:"getExternalResource.reject",index:c.index,reason:a})}));break;case"validate.resolve":j.removeEventListener("error",L),j.removeEventListener("message",e),p(c.value),j.terminate();break;case"validate.reject":j.removeEventListener("error",L),j.removeEventListener("message",e),G(c.reason),j.terminate()}};if(j.addEventListener("error",L),j.addEventListener("message",e),j.postMessage({id:"init",url:s.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(a)){const s=a.slice();j.postMessage({id:"validate",data:s,rootUrl:c,fileName:o},[s.buffer])}else j.postMessage({id:"validate",data:a,rootUrl:c,fileName:o})})):(this._LoadScriptPromise||(this._LoadScriptPromise=s.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>q(a,c,o,i))))}}i.Configuration={url:`${s.Tools._DefaultCdnUrl}/gltf_validator.js`}},14976:(a,c,o)=>{"use strict";o.d(c,{b:()=>Z});var s=o(12798),q=o(12800),t=o(12845),i=o(12810),p=o(13173),G=o(13123),T=o(12882),C=o(13045),j=o(12776),L=o(12732);o(14082),o(13977),o(14001),o(13986),o(14003),o(14006),o(14015);const e="imageProcessingCompatibility",g="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";L.c.IncludesShadersStore[e]||(L.c.IncludesShadersStore[e]=g);const M="skyPixelShader",N="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";L.c.ShadersStore[M]||(L.c.ShadersStore[M]=N);o(14094),o(14023),o(14026),o(14041),o(14032);const y="skyVertexShader",k="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";L.c.ShadersStore[y]||(L.c.ShadersStore[y]=k);var n=o(13118),f=o(13164),J=o(13155);class w extends p.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Z extends G.c{constructor(a,c){super(a,c),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new i.Hc(0,100,0),this.useSunPosition=!1,this.cameraOffset=i.Hc.Zero(),this.up=i.Hc.Up(),this.dithering=!1,this._cameraPosition=i.Hc.Zero(),this._skyOrientation=new i.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(a,c){const o=c._drawWrapper;if(this.isFrozen&&o.effect&&o._wasPreviouslyReady)return!0;c.materialDefines||(c.materialDefines=new w);const s=c.materialDefines,q=this.Za();if(this._isReadyForSubMesh(c))return!0;if((0,J.ab)(a,q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,s),(0,J.P)(a,s,!0,!1),s.IMAGEPROCESSINGPOSTPROCESS!==q.imageProcessingConfiguration.applyByPostProcess&&s.markAsMiscDirty(),s.DITHER!==this.dithering&&s.markAsMiscDirty(),s.isDirty){s.markAsProcessed(),q.resetCachedMaterial();const a=new n.e;s.FOG&&a.addFallback(1,"FOG"),s.IMAGEPROCESSINGPOSTPROCESS=q.imageProcessingConfiguration.applyByPostProcess,s.DITHER=this.dithering;const o=[T.g.PositionKind];s.VERTEXCOLOR&&o.push(T.g.ColorKind);const t="sky",i=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,f.e)(i);const p=s.toString();c.setEffect(q.getEngine().createEffect(t,o,i,[],p,a,this.onCompiled,this.onError),s,this._materialContext)}return!(!c.effect||!c.effect.isReady())&&(s._renderId=q.getRenderId(),o._wasPreviouslyReady=!0,!0)}bindForSubMesh(a,c,o){const s=this.Za(),q=o.materialDefines;if(!q)return;const t=o.effect;if(!t)return;this._activeEffect=t,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._mustRebind(s,t,o)&&((0,f.i)(t,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,J.n)(q,t,s)),s.fogEnabled&&c.applyFog&&s.fogMode!==C.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),(0,J.h)(s,c,this._activeEffect);const p=s.activeCamera;if(p){const a=p.getWorldMatrix();this._cameraPosition.x=a.m[12],this._cameraPosition.y=a.m[13],this._cameraPosition.z=a.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const a=Math.PI*(this.inclination-.5),c=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(c)*Math.cos(a),this.sunPosition.y=this.distance*Math.sin(-a),this.sunPosition.z=this.distance*Math.sin(c)*Math.cos(a),i.Quaternion.FromUnitVectorsToRef(i.Hc.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(c,this._activeEffect,o)}getAnimatables(){return[]}dispose(a){super.dispose(a)}clone(a){return t.d.Clone((()=>new Z(a,this.Za())),this)}serialize(){const a=super.serialize();return a.customType="BABYLON.SkyMaterial",a}getClassName(){return"SkyMaterial"}static Parse(a,c,o){return t.d.Parse((()=>new Z(a.name,c)),a,c,o)}}(0,s.d)([(0,q.E)()],Z.prototype,"luminance",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"turbidity",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"rayleigh",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"mieCoefficient",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"mieDirectionalG",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"distance",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"inclination",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"azimuth",void 0),(0,s.d)([(0,q.B)()],Z.prototype,"sunPosition",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"useSunPosition",void 0),(0,s.d)([(0,q.B)()],Z.prototype,"cameraOffset",void 0),(0,s.d)([(0,q.B)()],Z.prototype,"up",void 0),(0,s.d)([(0,q.E)()],Z.prototype,"dithering",void 0),(0,j.d)("BABYLON.SkyMaterial",Z)},13484:(a,c,o)=>{"use strict";function s(a,c){c.headers=a.headers||{},c.statusMessage=a.statusText,c.statusCode=a.status,c.data=a.response}function q(a,c,o){return new Promise((function(q,t){o=o||{};var i,p,G,T=new XMLHttpRequest,C=o.body,j=o.headers||{};for(i in o.timeout&&(T.timeout=o.timeout),T.ontimeout=T.onerror=function(a){a.timeout="timeout"==a.type,t(a)},T.open(a,c.href||c),T.onload=function(){for(G=T.getAllResponseHeaders().trim().split(/[\r\n]+/),s(T,T);p=G.shift();)p=p.split(": "),T.headers[p.shift().toLowerCase()]=p.join(": ");if((p=T.headers["content-type"])&&~p.indexOf("application/json"))try{T.data=JSON.parse(T.data,o.reviver)}catch(a){return s(T,a),t(a)}(T.status>=400?t:q)(T)},typeof FormData<"u"&&C instanceof FormData||C&&"object"==typeof C&&(j["content-type"]="application/json",C=JSON.stringify(C)),T.withCredentials=!!o.withCredentials,j)T.setRequestHeader(i,j[i]);T.send(C)}))}o.r(c),o.d(c,{del:()=>G,get:()=>t,patch:()=>p,post:()=>i,put:()=>T,send:()=>q});var t=q.bind(q,"GET"),i=q.bind(q,"POST"),p=q.bind(q,"PATCH"),G=q.bind(q,"DELETE"),T=q.bind(q,"PUT")},15067:(a,c,o)=>{"use strict";o.d(c,{d:()=>j});const s=.5*(Math.sqrt(3)-1),q=(3-Math.sqrt(3))/6,t=1/3,i=1/6,p=(Math.sqrt(5)-1)/4,G=(5-Math.sqrt(5))/20,T=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),C=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const j=class{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const c="function"==typeof a?a:function(a){let c=0,o=0,s=0,q=1;const t=function(){let a=4022871197;return function(c){c=c.toString();for(let o=0;o<c.length;o++){a+=c.charCodeAt(o);let s=.02519603282416938*a;a=s>>>0,s-=a,s*=a,a=s>>>0,s-=a,a+=4294967296*s}return 2.3283064365386963e-10*(a>>>0)}}();c=t(" "),o=t(" "),s=t(" "),c-=t(a),c<0&&(c+=1);o-=t(a),o<0&&(o+=1);s-=t(a),s<0&&(s+=1);return function(){const a=2091639*c+2.3283064365386963e-10*q;return c=o,o=s,s=a-(q=0|a)}}(a);this.p=function(a){const c=new Uint8Array(256);for(let o=0;o<256;o++)c[o]=o;for(let o=0;o<255;o++){const s=o+~~(a()*(256-o)),q=c[o];c[o]=c[s],c[s]=q}return c}(c),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let o=0;o<512;o++)this.perm[o]=this.p[255&o],this.permMod12[o]=this.perm[o]%12}noise2D(a,c){const o=this.permMod12,t=this.perm;let i=0,p=0,G=0;const C=(a+c)*s,j=Math.floor(a+C),L=Math.floor(c+C),e=(j+L)*q,g=a-(j-e),M=c-(L-e);let N,y;g>M?(N=1,y=0):(N=0,y=1);const k=g-N+q,n=M-y+q,f=g-1+2*q,J=M-1+2*q,w=255&j,Z=255&L;let h=.5-g*g-M*M;if(h>=0){const a=3*o[w+t[Z]];h*=h,i=h*h*(T[a]*g+T[a+1]*M)}let U=.5-k*k-n*n;if(U>=0){const a=3*o[w+N+t[Z+y]];U*=U,p=U*U*(T[a]*k+T[a+1]*n)}let S=.5-f*f-J*J;if(S>=0){const a=3*o[w+1+t[Z+1]];S*=S,G=S*S*(T[a]*f+T[a+1]*J)}return 70*(i+p+G)}noise3D(a,c,o){const s=this.permMod12,q=this.perm;let p,G,C,j;const L=(a+c+o)*t,e=Math.floor(a+L),g=Math.floor(c+L),M=Math.floor(o+L),N=(e+g+M)*i,y=a-(e-N),k=c-(g-N),n=o-(M-N);let f,J,w,Z,h,U;y>=k?k>=n?(f=1,J=0,w=0,Z=1,h=1,U=0):y>=n?(f=1,J=0,w=0,Z=1,h=0,U=1):(f=0,J=0,w=1,Z=1,h=0,U=1):k<n?(f=0,J=0,w=1,Z=0,h=1,U=1):y<n?(f=0,J=1,w=0,Z=0,h=1,U=1):(f=0,J=1,w=0,Z=1,h=1,U=0);const S=y-f+i,r=k-J+i,x=n-w+i,R=y-Z+2*i,d=k-h+2*i,X=n-U+2*i,W=y-1+.5,F=k-1+.5,O=n-1+.5,B=255&e,u=255&g,K=255&M;let D=.6-y*y-k*k-n*n;if(D<0)p=0;else{const a=3*s[B+q[u+q[K]]];D*=D,p=D*D*(T[a]*y+T[a+1]*k+T[a+2]*n)}let I=.6-S*S-r*r-x*x;if(I<0)G=0;else{const a=3*s[B+f+q[u+J+q[K+w]]];I*=I,G=I*I*(T[a]*S+T[a+1]*r+T[a+2]*x)}let Y=.6-R*R-d*d-X*X;if(Y<0)C=0;else{const a=3*s[B+Z+q[u+h+q[K+U]]];Y*=Y,C=Y*Y*(T[a]*R+T[a+1]*d+T[a+2]*X)}let P=.6-W*W-F*F-O*O;if(P<0)j=0;else{const a=3*s[B+1+q[u+1+q[K+1]]];P*=P,j=P*P*(T[a]*W+T[a+1]*F+T[a+2]*O)}return 32*(p+G+C+j)}noise4D(a,c,o,s){const q=this.perm;let t,i,T,j,L;const e=(a+c+o+s)*p,g=Math.floor(a+e),M=Math.floor(c+e),N=Math.floor(o+e),y=Math.floor(s+e),k=(g+M+N+y)*G,n=a-(g-k),f=c-(M-k),J=o-(N-k),w=s-(y-k);let Z=0,h=0,U=0,S=0;n>f?Z++:h++,n>J?Z++:U++,n>w?Z++:S++,f>J?h++:U++,f>w?h++:S++,J>w?U++:S++;const r=Z>=3?1:0,x=h>=3?1:0,R=U>=3?1:0,d=S>=3?1:0,X=Z>=2?1:0,W=h>=2?1:0,F=U>=2?1:0,O=S>=2?1:0,B=Z>=1?1:0,u=h>=1?1:0,K=U>=1?1:0,D=S>=1?1:0,I=n-r+G,Y=f-x+G,P=J-R+G,ma=w-d+G,V=n-X+2*G,E=f-W+2*G,H=J-F+2*G,b=w-O+2*G,A=n-B+3*G,v=f-u+3*G,l=J-K+3*G,Q=w-D+3*G,z=n-1+4*G,aa=f-1+4*G,ca=J-1+4*G,oa=w-1+4*G,sa=255&g,qa=255&M,ta=255&N,ia=255&y;let pa=.6-n*n-f*f-J*J-w*w;if(pa<0)t=0;else{const a=q[sa+q[qa+q[ta+q[ia]]]]%32*4;pa*=pa,t=pa*pa*(C[a]*n+C[a+1]*f+C[a+2]*J+C[a+3]*w)}let Ga=.6-I*I-Y*Y-P*P-ma*ma;if(Ga<0)i=0;else{const a=q[sa+r+q[qa+x+q[ta+R+q[ia+d]]]]%32*4;Ga*=Ga,i=Ga*Ga*(C[a]*I+C[a+1]*Y+C[a+2]*P+C[a+3]*ma)}let Ta=.6-V*V-E*E-H*H-b*b;if(Ta<0)T=0;else{const a=q[sa+X+q[qa+W+q[ta+F+q[ia+O]]]]%32*4;Ta*=Ta,T=Ta*Ta*(C[a]*V+C[a+1]*E+C[a+2]*H+C[a+3]*b)}let Ca=.6-A*A-v*v-l*l-Q*Q;if(Ca<0)j=0;else{const a=q[sa+B+q[qa+u+q[ta+K+q[ia+D]]]]%32*4;Ca*=Ca,j=Ca*Ca*(C[a]*A+C[a+1]*v+C[a+2]*l+C[a+3]*Q)}let ja=.6-z*z-aa*aa-ca*ca-oa*oa;if(ja<0)L=0;else{const a=q[sa+1+q[qa+1+q[ta+1+q[ia+1]]]]%32*4;ja*=ja,L=ja*ja*(C[a]*z+C[a+1]*aa+C[a+2]*ca+C[a+3]*oa)}return 27*(t+i+T+j+L)}}}}]);